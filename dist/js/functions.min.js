(()=>{let f$=Object.hasOwnProperty,h$={},j$,k$=a$=>{let b$=h$[a$];return b$||(b$=h$[a$]={exports:{}},j$[a$](b$.exports,b$)),b$.exports},l$=a$=>{if(a$&&a$.__esModule)return a$;let b$={};for(let c$ in a$)f$.call(a$,c$)&&(b$[c$]=a$[c$]);return b$.default=a$,b$},p$=a$=>l$(k$(a$));j$={76(c,a){var b=a.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=b)},77(e,a){var b={}.hasOwnProperty;a.exports=function(c,d){return b.call(c,d)}},70(c,a){a.exports=function(b){try{return!!b()}catch(e){return!0}}},64(c,b){b.exports=!k$(70)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},58(c,a){var b=a.exports={version:"2.6.10"};typeof __e=="number"&&(__e=b)},87(c,b){b.exports=function(a){return typeof a==="object"?a!==null:typeof a==="function"}},42(e,c){var d=k$(87);c.exports=function(a){if(!d(a))throw TypeError(a+" is not an object!");return a}},65(g,d){var c=k$(87),a=k$(76).document,e=c(a)&&c(a.createElement);d.exports=function(f){return e?a.createElement(f):{}}},80(c,b){b.exports=!k$(64)&&!k$(70)(function(){return Object.defineProperty(k$(65)("div"),"a",{get:function(){return 7}}).a!=7})},155(h,g){var d=k$(87);g.exports=function(a,e){if(!d(a))return a;var b,c;if(e&&typeof(b=a.toString)=="function"&&!d(c=b.call(a)))return c;if(typeof(b=a.valueOf)=="function"&&!d(c=b.call(a)))return c;if(!e&&typeof(b=a.toString)=="function"&&!d(c=b.call(a)))return c;throw TypeError("Can't convert object to primitive value")}},107(f){var e=k$(42),g=k$(80),h=k$(155),i=Object.defineProperty;f.f=k$(64)?Object.defineProperty:function k(c,d,a){e(c),d=h(d,!0),e(a);if(g)try{return i(c,d,a)}catch(l){}if("get"in a||"set"in a)throw TypeError("Accessors not supported!");return"value"in a&&(c[d]=a.value),c}},125(d,b){b.exports=function(a,c){return{enumerable:!(a&1),configurable:!(a&2),writable:!(a&4),value:c}}},78(h,e){var f=k$(107),g=k$(125);e.exports=k$(64)?function(a,c,d){return f.f(a,c,g(1,d))}:function(a,c,d){return a[c]=d,a}},159(e,b){var c=0,d=Math.random();b.exports=function(a){return"Symbol(".concat(a===void 0?"":a,")_",(++c+d).toString(36))}},95(b,a){a.exports=!1},138(i,g){var h=k$(58),b=k$(76),c="__core-js_shared__",d=b[c]||(b[c]={});(g.exports=function(e,f){return d[e]||(d[e]=f!==void 0?f:{})})("versions",[]).push({version:h.version,mode:k$(95)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},75(c,b){b.exports=k$(138)("native-function-to-string",Function.toString)},127(o,k){var l=k$(76),e=k$(78),h=k$(77),f=k$(159)("src"),g=k$(75),i="toString",m=(""+g).split(i);k$(58).inspectSource=function(a){return g.call(a)},(k.exports=function(a,b,c,n){var j=typeof c=="function";j&&(h(c,"name")||e(c,"name",b));if(a[b]===c)return;j&&(h(c,f)||e(c,f,a[b]?""+a[b]:m.join(String(b)))),a===l?a[b]=c:n?a[b]?a[b]=c:e(a,b,c):(delete a[b],e(a,b,c))})(Function.prototype,i,function a(){return typeof this=="function"&&this[f]||g.call(this)})},37(c,b){b.exports=function(a){if(typeof a!="function")throw TypeError(a+" is not a function!");return a}},60(j,f){var g=k$(37);f.exports=function(a,b,h){g(a);if(b===void 0)return a;switch(h){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,i){return a.call(b,c,d,i)}}return function(){return a.apply(b,arguments)}}},68(y,s){var d=k$(76),i=k$(58),t=k$(78),u=k$(127),o=k$(60),k="prototype",a=function(e,f,l){var v=e&a.F,m=e&a.G,w=e&a.S,p=e&a.P,x=e&a.B,h=m?d:w?d[f]||(d[f]={}):(d[f]||{})[k],j=m?i:i[f]||(i[f]={}),q=j[k]||(j[k]={}),c,n,b,r;m&&(l=f);for(c in l)n=!v&&h&&h[c]!==void 0,b=(n?h:l)[c],r=x&&n?o(b,d):p&&typeof b=="function"?o(Function.call,b):b,h&&u(h,c,b,e&a.U),j[c]!=b&&t(j,c,r),p&&q[c]!=b&&(q[c]=b)};d.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,s.exports=a},101(q,h){var b=k$(159)("meta"),i=k$(87),e=k$(77),j=k$(107).f,k=0,d=Object.isExtensible||function(){return!0},l=!k$(70)(function(){return d(Object.preventExtensions({}))}),f=function(a){j(a,b,{value:{i:"O"+ ++k,w:{}}})},m=function(a,g){if(!i(a))return typeof a=="symbol"?a:(typeof a=="string"?"S":"P")+a;if(!e(a,b)){if(!d(a))return"F";if(!g)return"E";f(a)}return a[b].i},n=function(a,g){if(!e(a,b)){if(!d(a))return!0;if(!g)return!1;f(a)}return a[b].w},o=function(a){return l&&p.NEED&&d(a)&&!e(a,b)&&f(a),a},p=h.exports={KEY:b,NEED:!1,fastKey:m,getWeak:n,onFreeze:o}},164(i,f){var c=k$(138)("wks"),g=k$(159),d=k$(76).Symbol,e=typeof d=="function",h=f.exports=function(a){return c[a]||(c[a]=e&&d[a]||(e?d:g)("Symbol."+a))};h.store=c},136(i,d){var e=k$(107).f,f=k$(77),c=k$(164)("toStringTag");d.exports=function(a,g,h){a&&!f(a=h?a:a.prototype,c)&&e(a,c,{configurable:!0,value:g})}},163(a){a.f=k$(164)},162(j,e){var f=k$(76),c=k$(58),g=k$(95),h=k$(163),i=k$(107).f;e.exports=function(b){var d=c.Symbol||(c.Symbol=g?{}:f.Symbol||{});b.charAt(0)!="_"&&!(b in d)&&i(d,b,{value:h.f(b)})}},53(d,a){var b={}.toString;a.exports=function(c){return b.call(c).slice(8,-1)}},83(e,c){var d=k$(53);c.exports=Object("z").propertyIsEnumerable(0)?Object:function(a){return d(a)=="String"?a.split(""):Object(a)}},63(c,b){b.exports=function(a){if(a==void 0)throw TypeError("Can't call method on  "+a);return a}},152(f,b){var c=k$(83),d=k$(63);b.exports=function(e){return c(d(e))}},151(e,b){var c=Math.ceil,d=Math.floor;b.exports=function(a){return isNaN(a=+a)?0:(a>0?d:c)(a)}},153(f,c){var d=k$(151),e=Math.min;c.exports=function(a){return a>0?e(d(a),9007199254740991):0}},149(h,d){var e=k$(151),f=Math.max,g=Math.min;d.exports=function(a,b){return a=e(a),a<0?f(a+b,0):g(a,b)}},46(n,h){var i=k$(152),j=k$(153),k=k$(149);h.exports=function(b){return function(l,e,m){var c=i(l),f=j(c.length),a=k(m,f),g;if(b&&e!=e)for(;f>a;){g=c[a++];if(g!=g)return!0}else for(;f>a;a++)if(b||a in c){if(c[a]===e)return b||a||0}return!b&&-1}}},137(f,d){var c=k$(138)("keys"),e=k$(159);d.exports=function(a){return c[a]||(c[a]=e(a))}},115(m,h){var e=k$(77),i=k$(152),j=k$(46)(!1),k=k$(137)("IE_PROTO");h.exports=function(l,f){var d=i(l),g=0,c=[],a;for(a in d)a!=k&&(e(d,a)&&c.push(a));for(;f.length>g;)e(d,a=f[g++])&&(~j(c,a)||c.push(a));return c}},66(b,a){a.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},116(f,b){var c=k$(115),d=k$(66);b.exports=Object.keys||function g(e){return c(e,d)}},113(a){a.f=Object.getOwnPropertySymbols},117(a){a.f={}.propertyIsEnumerable},67(m,h){var i=k$(116),j=k$(113),k=k$(117);h.exports=function(b){var c=i(b),d=j.f;if(d)for(var e=d(b),l=k.f,f=0,g;e.length>f;)l.call(b,g=e[f++])&&c.push(g);return c}},85(e,b){var c=k$(53);b.exports=Array.isArray||function f(d){return c(d)=="Array"}},154(e,b){var c=k$(63);b.exports=function(d){return Object(c(d))}},108(l,g){var h=k$(107),i=k$(42),j=k$(116);g.exports=k$(64)?Object.defineProperties:function m(b,c){i(b);for(var d=j(c),k=d.length,e=0,f;k>e;)h.f(b,f=d[e++],c[f]);return b}},79(d,c){var a=k$(76).document;c.exports=a&&a.documentElement},106(o,k){var l=k$(42),m=k$(108),j=k$(66),n=k$(137)("IE_PROTO"),h=function(){},i="prototype",g=function(){var d=k$(65)("iframe"),c=j.length,e="<",a=">",f;for(d.style.display="none",k$(79).appendChild(d),d.src="javascript:",f=d.contentWindow.document,f.open(),f.write(e+"script"+a+"document.F=Object"+e+"/script"+a),f.close(),g=f.F;c--;)delete g[i][j[c]];return g()};k.exports=Object.create||function d(c,e){var a;return c!==null?(h[i]=l(c),a=new h(),h[i]=null,a[n]=c):a=g(),e===void 0?a:m(a,e)}},112(b){var c=k$(115),d=k$(66).concat("length","prototype");b.f=Object.getOwnPropertyNames||function g(e){return c(e,d)}},111(j,f){var g=k$(152),c=k$(112).f,h={}.toString,d=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],i=function(e){try{return c(e)}catch(a){return d.slice()}};f.exports.f=function e(a){return d&&h.call(a)=="[object Window]"?i(a):c(g(a))}},110(e){var f=k$(117),g=k$(125),h=k$(152),i=k$(155),j=k$(77),k=k$(80),d=Object.getOwnPropertyDescriptor;e.f=k$(64)?d:function m(b,c){b=h(b),c=i(c,!0);if(k)try{return d(b,c)}catch(n){}if(j(b,c))return g(!f.f.call(b,c),b[c])}},291(){"use strict";var v=k$(76),f=k$(77),C=k$(64),g=k$(68),N=k$(127),ca=k$(101).KEY,D=k$(70),E=k$(138),F=k$(136),da=k$(159),r=k$(164),ea=k$(163),fa=k$(162),ga=k$(67),ha=k$(85),G=k$(42),ia=k$(87),ja=k$(154),w=k$(152),H=k$(155),I=k$(125),s=k$(106),O=k$(111),P=k$(110),x=k$(113),Q=k$(107),ka=k$(116),R=P.f,p=Q.f,S=O.f,h=v.Symbol,y=v.JSON,z=y&&y.stringify,n="prototype",i=r("_hidden"),T=r("toPrimitive"),la={}.propertyIsEnumerable,t=E("symbol-registry"),m=E("symbols"),u=E("op-symbols"),l=Object[n],q=typeof h=="function"&&!!x.f,J=v.QObject,K=!J||!J[n]||!J[n].findChild,L=C&&D(function(){return s(p({},"a",{get:function(){return p(this,"a",{value:7}).a}})).a!=7})?function(c,a,b){var e=R(l,a);e&&delete l[a],p(c,a,b),e&&c!==l&&p(l,a,e)}:p,U=function(c){var a=m[c]=s(h[n]);return a._k=c,a},M=q&&typeof h.iterator=="symbol"?function(c){return typeof c=="symbol"}:function(c){return c instanceof h},A=function c(a,b,e){return a===l&&A(u,b,e),G(a),b=H(b,!0),G(e),f(m,b)?(e.enumerable?(f(a,i)&&a[i][b]&&(a[i][b]=!1),e=s(e,{enumerable:I(0,!1)})):(f(a,i)||p(a,i,I(1,{})),a[i][b]=!0),L(a,b,e)):p(a,b,e)},V=function c(a,b){G(a);for(var e=ga(b=w(b)),j=0,k=e.length,o;k>j;)A(a,o=e[j++],b[o]);return a},ma=function c(a,b){return b===void 0?s(a):V(s(a),b)},W=function c(a){var b=la.call(this,a=H(a,!0));return this===l&&f(m,a)&&!f(u,a)?!1:b||!f(this,a)||!f(m,a)||f(this,i)&&this[i][a]?b:!0},X=function c(a,b){a=w(a),b=H(b,!0);if(a===l&&f(m,b)&&!f(u,b))return;var e=R(a,b);return e&&f(m,b)&&!(f(a,i)&&a[i][b])&&(e.enumerable=!0),e},Y=function c(a){for(var b=S(w(a)),e=[],j=0,k;b.length>j;)!f(m,k=b[j++])&&k!=i&&k!=ca&&e.push(k);return e},Z=function c(a){for(var b=a===l,e=S(b?u:w(a)),j=[],k=0,o;e.length>k;)f(m,o=e[k++])&&(b?f(l,o):!0)&&j.push(m[o]);return j};q||(h=function c(){if(this instanceof h)throw TypeError("Symbol is not a constructor!");var a=da(arguments.length>0?arguments[0]:void 0),b=function(e){this===l&&b.call(u,e),f(this,i)&&f(this[i],a)&&(this[i][a]=!1),L(this,a,I(1,e))};return C&&K&&L(l,a,{configurable:!0,set:b}),U(a)},N(h[n],"toString",function c(){return this._k}),P.f=X,Q.f=A,k$(112).f=O.f=Y,k$(117).f=W,x.f=Z,C&&!k$(95)&&N(l,"propertyIsEnumerable",W,!0),ea.f=function(c){return U(r(c))}),g(g.G+g.W+g.F*!q,{Symbol:h});for(var _="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),$=0;_.length>$;)r(_[$++]);for(var aa=ka(r.store),ba=0;aa.length>ba;)fa(aa[ba++]);g(g.S+g.F*!q,"Symbol",{for:function(c){return f(t,c+="")?t[c]:t[c]=h(c)},keyFor:function c(a){if(!M(a))throw TypeError(a+" is not a symbol!");for(var b in t)if(t[b]===a)return b},useSetter:function(){K=!0},useSimple:function(){K=!1}}),g(g.S+g.F*!q,"Object",{create:ma,defineProperty:A,defineProperties:V,getOwnPropertyDescriptor:X,getOwnPropertyNames:Y,getOwnPropertySymbols:Z});var na=D(function(){x.f(1)});g(g.S+g.F*na,"Object",{getOwnPropertySymbols:function c(a){return x.f(ja(a))}}),y&&g(g.S+g.F*(!q||D(function(){var c=h();return z([c])!="[null]"||z({a:c})!="{}"||z(Object(c))!="{}"})),"JSON",{stringify:function c(a){for(var b=[a],e=1,j,k;arguments.length>e;)b.push(arguments[e++]);return k=j=b[1],!ia(j)&&a===void 0||M(a)?void 0:(ha(j)||(j=function(o,B){typeof k=="function"&&(B=k.call(this,o,B));if(!M(B))return B}),b[1]=j,z.apply(y,b))}}),h[n][T]||k$(78)(h[n],T,h[n].valueOf),F(h,"Symbol"),F(Math,"Math",!0),F(v.JSON,"JSON",!0)},227(){var b=k$(68);b(b.S,"Object",{create:k$(106)})},229(){var b=k$(68);b(b.S+b.F*!k$(64),"Object",{defineProperty:k$(107).f})},228(){var b=k$(68);b(b.S+b.F*!k$(64),"Object",{defineProperties:k$(108)})},118(j,f){var b=k$(68),g=k$(58),h=k$(70);f.exports=function(c,i){var d=(g.Object||{})[c]||Object[c],e={};e[c]=i(d),b(b.S+b.F*h(function(){d(1)}),"Object",e)}},231(){var b=k$(152),c=k$(110).f;k$(118)("getOwnPropertyDescriptor",function(){return function h(d,e){return c(b(d),e)}})},114(h,d){var e=k$(77),f=k$(154),c=k$(137)("IE_PROTO"),g=Object.prototype;d.exports=Object.getPrototypeOf||function(a){return a=f(a),e(a,c)?a[c]:typeof a.constructor=="function"&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?g:null}},233(){var b=k$(154),c=k$(114);k$(118)("getPrototypeOf",function(){return function g(d){return c(b(d))}})},238(){var b=k$(154),c=k$(116);k$(118)("keys",function(){return function g(d){return c(b(d))}})},232(){k$(118)("getOwnPropertyNames",function(){return k$(111).f})},230(){var d=k$(87),e=k$(101).onFreeze;k$(118)("freeze",function(c){return function h(b){return c&&d(b)?c(e(b)):b}})},240(){var d=k$(87),e=k$(101).onFreeze;k$(118)("seal",function(c){return function h(b){return c&&d(b)?c(e(b)):b}})},239(){var d=k$(87),e=k$(101).onFreeze;k$(118)("preventExtensions",function(c){return function h(b){return c&&d(b)?c(e(b)):b}})},235(){var d=k$(87);k$(118)("isFrozen",function(b){return function g(c){return d(c)?b?b(c):!1:!0}})},236(){var d=k$(87);k$(118)("isSealed",function(b){return function g(c){return d(c)?b?b(c):!1:!0}})},234(){var d=k$(87);k$(118)("isExtensible",function(b){return function g(c){return d(c)?b?b(c):!0:!1}})},105(w,o){"use strict";var p=k$(64),j=k$(116),q=k$(113),r=k$(117),s=k$(154),t=k$(83),d=Object.assign;o.exports=!d||k$(70)(function(){var h={},e={},i=Symbol(),b="abcdefghijklmnopqrst";return h[i]=7,b.split("").forEach(function(f){e[f]=f}),d({},h)[i]!=7||Object.keys(d({},e)).join("")!=b})?function h(e,i){for(var b=s(e),f=arguments.length,k=1,l=q.f,u=r.f;f>k;)for(var c=t(arguments[k++]),m=l?j(c).concat(l(c)):j(c),v=m.length,n=0,g;v>n;)g=m[n++],(!p||u.call(c,g))&&(b[g]=c[g]);return b}:d},226(){var a=k$(68);a(a.S+a.F,"Object",{assign:k$(105)})},131(d,c){c.exports=Object.is||function f(a,b){return a===b?a!==0||1/a===1/b:a!=a&&b!=b}},237(){var b=k$(68);b(b.S,"Object",{is:k$(131)})},134(l,h){var i=k$(87),j=k$(42),g=function(c,a){j(c);if(!i(a)&&a!==null)throw TypeError(a+": can't set as prototype!")};h.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(c,a,e){try{e=k$(60)(Function.call,k$(110).f(Object.prototype,"__proto__").set,2),e(c,[]),a=!(c instanceof Array)}catch(k){a=!0}return function k(d,f){return g(d,f),a?d.__proto__=f:e(d,f),d}}({},!1):void 0),check:g}},241(){var b=k$(68);b(b.S,"Object",{setPrototypeOf:k$(134).set})},52(k,g){var c=k$(53),h=k$(164)("toStringTag"),i=c(function(){return arguments}())=="Arguments",j=function(b,a){try{return b[a]}catch(d){}};g.exports=function(b){var a,d,f;return b===void 0?"Undefined":b===null?"Null":typeof(d=j(a=Object(b),h))=="string"?d:i?c(a):(f=c(a))=="Object"&&typeof a.callee=="function"?"Arguments":f}},242(){"use strict";var c=k$(52),b={};b[k$(164)("toStringTag")]="z",b+""!="[object z]"&&k$(127)(Object.prototype,"toString",function f(){return"[object "+c(this)+"]"},!0)},82(f,e){e.exports=function(b,a,c){var d=c===void 0;switch(a.length){case 0:return d?b():b.call(c);case 1:return d?b(a[0]):b.call(c,a[0]);case 2:return d?b(a[0],a[1]):b.call(c,a[0],a[1]);case 3:return d?b(a[0],a[1],a[2]):b.call(c,a[0],a[1],a[2]);case 4:return d?b(a[0],a[1],a[2],a[3]):b.call(c,a[0],a[1],a[2],a[3])}return b.apply(c,a)}},51(o,j){"use strict";var k=k$(37),l=k$(87),m=k$(82),h=[].slice,f={},n=function(i,b,c){if(!(b in f)){for(var d=[],a=0;a<b;a++)d[a]="a["+a+"]";f[b]=Function("F,a","return new F("+d.join(",")+")")}return f[b](i,c)};j.exports=Function.bind||function i(b){var c=k(this),d=h.call(arguments,1),a=function(){var g=d.concat(h.call(arguments));return this instanceof a?n(c,g.length,g):m(c,g,b)};return l(c.prototype)&&(a.prototype=c.prototype),a}},193(){var b=k$(68);b(b.P,"Function",{bind:k$(51)})},195(){var d=k$(107).f,b=Function.prototype,e=/^\s*function ([^ (]*)/,c="name";c in b||k$(64)&&d(b,c,{configurable:!0,get:function(){try{return(""+this).match(e)[1]}catch(h){return""}}})},194(){"use strict";var c=k$(87),f=k$(114),d=k$(164)("hasInstance"),e=Function.prototype;d in e||k$(107).f(e,d,{value:function(a){if(typeof this!="function"||!c(a))return!1;if(!c(this.prototype))return a instanceof this;for(;a=f(a);)if(this.prototype===a)return!0;return!1}})},147(b,a){a.exports=`	
\v\f\r   ᠎             　\u2028\u2029﻿`},146(s,l){var e=k$(68),m=k$(63),n=k$(70),f=k$(147),c="["+f+"]",h="​",o=RegExp("^"+c+c+"*"),p=RegExp(c+c+"*$"),i=function(a,d,j){var g={},k=n(function(){return!!f[a]()||h[a]()!=h}),r=g[a]=k?d(q):f[a];j&&(g[j]=r),e(e.P+e.F*k,"String",g)},q=i.trim=function(a,d){return a=String(m(a)),d&1&&(a=a.replace(o,"")),d&2&&(a=a.replace(p,"")),a};l.exports=i},122(j,e){var a=k$(76).parseInt,f=k$(146).trim,c=k$(147),g=/^[-+]?0[xX]/;e.exports=a(c+"08")!==8||a(c+"0x16")!==22?function k(h,i){var d=f(String(h),3);return a(d,i>>>0||(g.test(d)?16:10))}:a},244(){var a=k$(68),c=k$(122);a(a.G+a.F*(parseInt!=c),{parseInt:c})},121(h,e){var b=k$(76).parseFloat,f=k$(146).trim;e.exports=1/b(k$(147)+"-0")!==-Infinity?function i(g){var c=f(String(g),3),d=b(c);return d===0&&c.charAt(0)=="-"?-0:d}:b},243(){var a=k$(68),c=k$(121);a(a.G+a.F*(parseFloat!=c),{parseFloat:c})},81(j,g){var h=k$(87),d=k$(134).set;g.exports=function(e,i,f){var a=i.constructor,b;return a!==f&&typeof a=="function"&&(b=a.prototype)!==f.prototype&&h(b)&&d&&d(e,b),e}},214(){"use strict";var p=k$(76),q=k$(77),r=k$(53),v=k$(81),w=k$(155),x=k$(70),y=k$(112).f,z=k$(110).f,A=k$(107).f,B=k$(146).trim,f="Number",b=p[f],g=b,h=b.prototype,C=r(k$(106)(h))==f,D="trim"in String.prototype,s=function(u){var c=w(u,!1);if(typeof c=="string"&&c.length>2){c=D?c.trim():B(c,3);var e=c.charCodeAt(0),d,k,l;if(e===43||e===45){d=c.charCodeAt(2);if(d===88||d===120)return NaN}else if(e===48){switch(c.charCodeAt(1)){case 66:case 98:k=2,l=49;break;case 79:case 111:k=8,l=55;break;default:return+c}for(var m=c.slice(2),n=0,E=m.length,o;n<E;n++){o=m.charCodeAt(n);if(o<48||o>l)return NaN}return parseInt(m,k)}}return+c};if(!b(" 0o1")||!b("0b1")||b("+0x1")){b=function u(c){var e=arguments.length<1?0:c,d=this;return d instanceof b&&(C?x(function(){h.valueOf.call(d)}):r(d)!=f)?v(new g(s(e)),d,b):s(e)};for(var t=k$(64)?y(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),j=0,i;t.length>j;j++)q(g,i=t[j])&&!q(b,i)&&A(b,i,z(g,i));b.prototype=h,h.constructor=b,k$(127)(p,f,b)}},38(f,c){var d=k$(53);c.exports=function(a,e){if(typeof a!="number"&&d(a)!="Number")throw TypeError(e);return+a}},145(i,e){"use strict";var f=k$(151),g=k$(63);e.exports=function j(h){var b=String(g(this)),d="",a=f(h);if(a<0||a==Infinity)throw RangeError("Count can't be negative");for(;a>0;(a>>>=1)&&(b+=b))a&1&&(d+=b);return d}},224(){"use strict";var o=k$(68),w=k$(151),x=k$(38),p=k$(145),s=1 .toFixed,t=Math.floor,h=[0,0,0,0,0,0],u="Number.toFixed: incorrect invocation!",m="0",i=function(c,b){for(var a=-1,d=b;++a<6;)d+=c*h[a],h[a]=d%1e07,d=t(d/1e07)},q=function(c){for(var b=6,a=0;--b>=0;)a+=h[b],h[b]=t(a/c),a=a%c*1e07},v=function(){for(var c=6,b="";--c>=0;)if(b!==""||c===0||h[c]!==0){var a=String(h[c]);b=b===""?a:b+p.call(m,7-a.length)+a}return b},j=function(c,b,a){return b===0?a:b%2===1?j(c,b-1,a*c):j(c*c,b/2,a)},y=function(c){for(var b=0,a=c;a>=4096;)b+=12,a/=4096;for(;a>=2;)b+=1,a/=2;return b};o(o.P+o.F*(!!s&&(8e-05 .toFixed(3)!=="0.000"||.9 .toFixed(0)!=="1"||1.255 .toFixed(2)!=="1.25"||1000000000000000128 .toFixed(0)!=="1000000000000000128")||!k$(70)(function(){s.call({})})),"Number",{toFixed:function c(b){var a=x(this,u),d=w(b),r="",e=m,f,n,g,l;if(d<0||d>20)throw RangeError(u);if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return String(a);a<0&&(r="-",a=-a);if(a>1e-21){f=y(a*j(2,69,1))-69,n=f<0?a*j(2,-f,1):a/j(2,f,1),n*=4503599627370496,f=52-f;if(f>0){for(i(0,n),g=d;g>=7;)i(1e07,0),g-=7;for(i(j(10,g,1),0),g=f-1;g>=23;)q(1<<23),g-=23;q(1<<g),i(1,1),q(2),e=v()}else i(0,n),i(1<<-f,0),e=v()+p.call(m,d)}return d>0?(l=e.length,e=r+(l<=d?"0."+p.call(m,d-l)+e:e.slice(0,l-d)+"."+e.slice(l-d))):e=r+e,e}})},225(){"use strict";var c=k$(68),d=k$(70),g=k$(38),a=1 .toPrecision;c(c.P+c.F*(d(function(){return a.call(1,void 0)!=="1"})||!d(function(){a.call({})})),"Number",{toPrecision:function j(e){var f=g(this,"Number#toPrecision: incorrect invocation!");return e===void 0?a.call(f):a.call(f,e)}})},215(){var a=k$(68);a(a.S,"Number",{EPSILON:Math.pow(2,-52)})},216(){var b=k$(68),d=k$(76).isFinite;b(b.S,"Number",{isFinite:function g(c){return typeof c=="number"&&d(c)}})},86(f,c){var d=k$(87),e=Math.floor;c.exports=function g(a){return!d(a)&&isFinite(a)&&e(a)===a}},217(){var b=k$(68);b(b.S,"Number",{isInteger:k$(86)})},218(){var a=k$(68);a(a.S,"Number",{isNaN:function f(b){return b!=b}})},219(){var b=k$(68),d=k$(86),e=Math.abs;b(b.S,"Number",{isSafeInteger:function h(c){return d(c)&&e(c)<=9007199254740991}})},220(){var a=k$(68);a(a.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},221(){var a=k$(68);a(a.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},222(){var a=k$(68),c=k$(121);a(a.S+a.F*(Number.parseFloat!=c),"Number",{parseFloat:c})},223(){var a=k$(68),c=k$(122);a(a.S+a.F*(Number.parseInt!=c),"Number",{parseInt:c})},98(c,b){b.exports=Math.log1p||function e(a){return(a=+a)>-1e-08&&a<1e-08?a-a*a/2:Math.log(1+a)}},197(){var b=k$(68),f=k$(98),e=Math.sqrt,c=Math.acosh;b(b.S+b.F*!(c&&Math.floor(c(Number.MAX_VALUE))==710&&c(Infinity)==Infinity),"Math",{acosh:function i(a){return(a=+a)<1?NaN:a>9.490626562425156e07?Math.log(a)+Math.LN2:f(a-1+e(a-1)*e(a+1))}})},198(){var b=k$(68),c=Math.asinh;function d(a){return!isFinite(a=+a)||a==0?a:a<0?-d(-a):Math.log(a+Math.sqrt(a*a+1))}b(b.S+b.F*!(c&&1/c(0)>0),"Math",{asinh:d})},199(){var b=k$(68),c=Math.atanh;b(b.S+b.F*!(c&&1/c(-0)<0),"Math",{atanh:function g(a){return(a=+a)==0?a:Math.log((1+a)/(1-a))/2}})},100(c,b){b.exports=Math.sign||function e(a){return(a=+a)==0||a!=a?a:a<0?-1:1}},200(){var c=k$(68),d=k$(100);c(c.S,"Math",{cbrt:function g(a){return d(a=+a)*Math.pow(Math.abs(a),1/3)}})},201(){var a=k$(68);a(a.S,"Math",{clz32:function f(b){return(b>>>=0)?31-Math.floor(Math.log(b+.5)*Math.LOG2E):32}})},202(){var b=k$(68),c=Math.exp;b(b.S,"Math",{cosh:function g(a){return(c(a=+a)+c(-a))/2}})},96(d,c){var b=Math.expm1;c.exports=!b||b(10)>22025.465794806718||b(10)<22025.465794806718||b(-2e-17)!=-2e-17?function f(a){return(a=+a)==0?a:a>-1e-06&&a<1e-06?a+a*a/2:Math.exp(a)-1}:b},203(){var a=k$(68),c=k$(96);a(a.S+a.F*(c!=Math.expm1),"Math",{expm1:c})},97(p,l){var m=k$(100),b=Math.pow,e=b(2,-52),c=b(2,-23),n=b(2,127)*(2-c),f=b(2,-126),o=function(i){return i+1/e-1/e};l.exports=Math.fround||function i(j){var d=Math.abs(j),g=m(j),h,a;return d<f?g*o(d/f/c)*f*c:(h=(1+c/e)*d,a=h-(h-d),a>n||a!=a?g*Infinity:g*a)}},204(){var b=k$(68);b(b.S,"Math",{fround:k$(97)})},205(){var e=k$(68),h=Math.abs;e(e.S,"Math",{hypot:function l(m,n){for(var d=0,f=0,i=arguments.length,b=0,a,c;f<i;)a=h(arguments[f++]),b<a?(c=b/a,d=d*c*c+1,b=a):a>0?(c=a/b,d+=c*c):d+=a;return b===Infinity?Infinity:b*Math.sqrt(d)}})},206(){var b=k$(68),d=Math.imul;b(b.S+b.F*k$(70)(function(){return d(4294967295,5)!=-5||d.length!=2}),"Math",{imul:function m(i,j){var a=65535,e=+i,f=+j,g=a&e,h=a&f;return 0|g*h+((a&e>>>16)*h+g*(a&f>>>16)<<16>>>0)}})},207(){var a=k$(68);a(a.S,"Math",{log10:function f(c){return Math.log(c)*Math.LOG10E}})},208(){var b=k$(68);b(b.S,"Math",{log1p:k$(98)})},209(){var a=k$(68);a(a.S,"Math",{log2:function f(c){return Math.log(c)/Math.LN2}})},210(){var b=k$(68);b(b.S,"Math",{sign:k$(100)})},211(){var c=k$(68),d=k$(96),e=Math.exp;c(c.S+c.F*k$(70)(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function h(a){return Math.abs(a=+a)<1?(d(a)-d(-a))/2:(e(a-1)-e(-a-1))*(Math.E/2)}})},212(){var c=k$(68),d=k$(96),e=Math.exp;c(c.S,"Math",{tanh:function j(a){var f=d(a=+a),g=d(-a);return f==Infinity?1:g==Infinity?-1:(f-g)/(e(a)+e(-a))}})},213(){var a=k$(68);a(a.S,"Math",{trunc:function f(b){return(b>0?Math.floor:Math.ceil)(b)}})},278(){var b=k$(68),h=k$(149),d=String.fromCharCode,e=String.fromCodePoint;b(b.S+b.F*(!!e&&e.length!=1),"String",{fromCodePoint:function l(m){for(var f=[],i=arguments.length,g=0,a;i>g;){a=+arguments[g++];if(h(a,1114111)!==a)throw RangeError(a+" is not a valid code point");f.push(a<65536?d(a):d(((a-=65536)>>10)+55296,a%1024+56320))}return f.join("")}})},283(){var d=k$(68),f=k$(152),g=k$(153);d(d.S,"String",{raw:function m(h){for(var e=f(h.raw),i=g(e.length),j=arguments.length,c=[],a=0;i>a;)c.push(String(e[a++])),a<j&&c.push(String(arguments[a]));return c.join("")}})},290(){"use strict";k$(146)("trim",function(b){return function e(){return b(this,3)}})},141(m,h){var i=k$(151),j=k$(63);h.exports=function(d){return function(k,l){var b=String(j(k)),a=i(l),g=b.length,c,e;return a<0||a>=g?d?"":void 0:(c=b.charCodeAt(a),c<55296||c>56319||a+1===g||(e=b.charCodeAt(a+1))<56320||e>57343?d?b.charAt(a):c:d?b.slice(a,a+2):(c-55296<<10)+(e-56320)+65536)}}},94(b,a){a.exports={}},90(j,d){"use strict";var e=k$(106),f=k$(125),g=k$(136),b={};k$(78)(b,k$(164)("iterator"),function(){return this}),d.exports=function(c,h,i){c.prototype=e(b,{next:f(1,i)}),g(c,h+" Iterator")}},91(L,C){"use strict";var s=k$(95),o=k$(68),D=k$(127),t=k$(78),u=k$(94),E=k$(90),F=k$(136),G=k$(114),h=k$(164)("iterator"),p=!([].keys&&"next"in[].keys()),H="@@iterator",v="keys",k="values",w=function(){return this};C.exports=function(x,i,l,I,d,J,y){E(l,i,I);var m=function(c){if(!p&&c in a)return a[c];switch(c){case v:return function B(){return new l(this,c)};case k:return function B(){return new l(this,c)}}return function B(){return new l(this,c)}},z=i+" Iterator",q=d==k,r=!1,a=x.prototype,e=a[h]||a[H]||d&&a[d],f=e||m(d),K=d?q?m("entries"):f:void 0,A=i=="Array"?a.entries||e:e,j,n,g;A&&(g=G(A.call(new x())),g!==Object.prototype&&g.next&&(F(g,z,!0),!s&&typeof g[h]!="function"&&t(g,h,w))),q&&e&&e.name!==k&&(r=!0,f=function c(){return e.call(this)}),(!s||y)&&(p||r||!a[h])&&t(a,h,f),u[i]=f,u[z]=w;if(d){j={values:q?f:m(k),keys:J?f:m(v),entries:K};if(y)for(n in j)n in a||D(a,n,j[n]);else o(o.P+o.F*(p||r),i,j)}return j}},281(){"use strict";var e=k$(141)(!0);k$(91)(String,"String",function(a){this._t=String(a),this._i=0},function(){var a=this._t,d=this._i,b;return d>=a.length?{value:void 0,done:!0}:(b=e(a,d),this._i+=b.length,{value:b,done:!1})})},273(){"use strict";var b=k$(68),c=k$(141)(!1);b(b.P,"String",{codePointAt:function g(d){return c(this,d)}})},88(h,d){var e=k$(87),f=k$(53),g=k$(164)("match");d.exports=function(b){var c;return e(b)&&((c=b[g])!==void 0?!!c:f(b)=="RegExp")}},142(h,b){var c=k$(88),d=k$(63);b.exports=function(e,f,g){if(c(f))throw TypeError("String#"+g+" doesn't accept regex!");return String(d(e))}},69(f,d){var e=k$(164)("match");d.exports=function(b){var a=/./;try{"/./"[b](a)}catch(g){try{return a[e]=!1,!"/./"[b](a)}catch(h){}}return!0}},274(){"use strict";var b=k$(68),g=k$(153),l=k$(142),c="endsWith",h=""[c];b(b.P+b.F*k$(69)(c),"String",{endsWith:function o(i){var d=l(this,i,c),j=arguments.length>1?arguments[1]:void 0,k=g(d.length),e=j===void 0?k:Math.min(g(j),k),f=String(i);return h?h.call(d,f,e):d.slice(e-f.length,e)===f}})},279(){"use strict";var b=k$(68),e=k$(142),c="includes";b(b.P+b.F*k$(69)(c),"String",{includes:function h(d){return!!~e(this,d,c).indexOf(d,arguments.length>1?arguments[1]:void 0)}})},284(){var b=k$(68);b(b.P,"String",{repeat:k$(145)})},286(){"use strict";var b=k$(68),i=k$(153),j=k$(142),c="startsWith",g=""[c];b(b.P+b.F*k$(69)(c),"String",{startsWith:function m(h){var d=j(this,h,c),e=i(Math.min(arguments.length>1?arguments[1]:void 0,d.length)),f=String(h);return g?g.call(d,f,e):d.slice(e,e+f.length)===f}})},143(n,h){var f=k$(68),i=k$(70),j=k$(63),k=/"/g,l=function(c,d,a,b){var m=String(j(c)),g="<"+d;return a!==""&&(g+=" "+a+'="'+String(b).replace(k,"&quot;")+'"'),g+">"+m+"</"+d+">"};h.exports=function(c,d){var a={};a[c]=d(l),f(f.P+f.F*i(function(){var b=""[c]('"');return b!==b.toLowerCase()||b.split('"').length>3}),"String",a)}},269(){"use strict";k$(143)("anchor",function(b){return function f(c){return b(this,"a","name",c)}})},270(){"use strict";k$(143)("big",function(b){return function e(){return b(this,"big","","")}})},271(){"use strict";k$(143)("blink",function(b){return function e(){return b(this,"blink","","")}})},272(){"use strict";k$(143)("bold",function(b){return function e(){return b(this,"b","","")}})},275(){"use strict";k$(143)("fixed",function(b){return function e(){return b(this,"tt","","")}})},276(){"use strict";k$(143)("fontcolor",function(b){return function f(c){return b(this,"font","color",c)}})},277(){"use strict";k$(143)("fontsize",function(b){return function f(c){return b(this,"font","size",c)}})},280(){"use strict";k$(143)("italics",function(b){return function e(){return b(this,"i","","")}})},282(){"use strict";k$(143)("link",function(b){return function f(c){return b(this,"a","href",c)}})},285(){"use strict";k$(143)("small",function(b){return function e(){return b(this,"small","","")}})},287(){"use strict";k$(143)("strike",function(b){return function e(){return b(this,"strike","","")}})},288(){"use strict";k$(143)("sub",function(b){return function e(){return b(this,"sub","","")}})},289(){"use strict";k$(143)("sup",function(b){return function e(){return b(this,"sup","","")}})},188(){var a=k$(68);a(a.S,"Date",{now:function(){return new Date().getTime()}})},190(){"use strict";var b=k$(68),e=k$(154),f=k$(155);b(b.P+b.F*k$(70)(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1}),"Date",{toJSON:function i(j){var c=e(this),d=f(c);return typeof d=="number"&&!isFinite(d)?null:c.toISOString()}})},61(l,j){"use strict";var g=k$(70),k=Date.prototype.getTime,d=Date.prototype.toISOString,b=function(c){return c>9?c:"0"+c};j.exports=g(function(){return d.call(new Date(-5e13-1))!="0385-07-25T07:06:39.999Z"})||!g(function(){d.call(new Date(NaN))})?function c(){if(!isFinite(k.call(this)))throw RangeError("Invalid time value");var a=this,e=a.getUTCFullYear(),f=a.getUTCMilliseconds(),h=e<0?"-":e>9999?"+":"";return h+("00000"+Math.abs(e)).slice(h?-6:-4)+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"."+(f>99?f:"0"+b(f))+"Z"}:d},189(){var a=k$(68),c=k$(61);a(a.P+a.F*(Date.prototype.toISOString!==c),"Date",{toISOString:c})},192(){var a=Date.prototype,b="Invalid Date",c="toString",f=a[c],g=a.getTime;new Date(NaN)+""!=b&&k$(127)(a,c,function j(){var d=g.call(this);return d===d?f.call(this):b})},62(g,d){"use strict";var e=k$(42),f=k$(155),c="number";d.exports=function(a){if(a!=="string"&&a!==c&&a!=="default")throw TypeError("Incorrect hint");return f(e(this),a!=c)}},191(){var b=k$(164)("toPrimitive"),c=Date.prototype;b in c||k$(78)(c,b,k$(62))},176(){var b=k$(68);b(b.S,"Array",{isArray:k$(85)})},89(j,g){var b=k$(42);g.exports=function(c,d,a,h){try{return h?d(b(a)[0],a[1]):d(a)}catch(i){var e=c.return;throw e!==void 0&&b(e.call(c)),i}}},84(g,c){var d=k$(94),e=k$(164)("iterator"),f=Array.prototype;c.exports=function(a){return a!==void 0&&(d.Array===a||f[e]===a)}},59(h,e){"use strict";var f=k$(107),g=k$(125);e.exports=function(a,b,d){b in a?f.f(a,b,g(0,d)):a[b]=d}},165(g,c){var d=k$(52),e=k$(164)("iterator"),f=k$(94);c.exports=k$(58).getIteratorMethod=function(b){if(b!=void 0)return b[e]||b["@@iterator"]||f[d(b)]}},92(k,i){var a=k$(164)("iterator"),c=!1;try{var d=[7][a]();d.return=function(){c=!0},Array.from(d,function(){throw 2})}catch(e){}i.exports=function(e,j){if(!j&&!c)return!1;var f=!1;try{var b=[7],g=b[a]();g.next=function(){return{done:f=!0}},b[a]=function(){return g},e(b)}catch(l){}return f}},174(){"use strict";var p=k$(60),f=k$(68),q=k$(154),r=k$(89),s=k$(84),t=k$(153),m=k$(59),u=k$(165);f(f.S+f.F*!k$(92)(function(n){Array.from(n)}),"Array",{from:function n(v){var d=q(v),g=typeof this=="function"?this:Array,o=arguments.length,e=o>1?arguments[1]:void 0,h=e!==void 0,a=0,i=u(d),j,c,k,l;h&&(e=p(e,o>2?arguments[2]:void 0,2));if(i!=void 0&&!(g==Array&&s(i)))for(l=i.call(d),c=new g();!(k=l.next()).done;a++)m(c,a,h?r(l,e,[k.value,a],!0):k.value);else for(j=t(d.length),c=new g(j);j>a;a++)m(c,a,h?e(d[a],a):d[a]);return c.length=a,c}})},181(){"use strict";var b=k$(68),g=k$(59);b(b.S+b.F*k$(70)(function(){function c(){}return!(Array.of.call(c)instanceof c)}),"Array",{of:function c(){for(var d=0,e=arguments.length,f=new(typeof this=="function"?this:Array)(e);e>d;)g(f,d,arguments[d++]);return f.length=e,f}})},140(f,c){"use strict";var d=k$(70);c.exports=function(a,e){return!!a&&d(function(){e?a.call(null,function(){},1):a.call(null)})}},178(){"use strict";var b=k$(68),e=k$(152),c=[].join;b(b.P+b.F*(k$(83)!=Object||!k$(140)(c)),"Array",{join:function h(d){return c.call(e(this),d===void 0?",":d)}})},184(){"use strict";var d=k$(68),g=k$(79),o=k$(53),h=k$(149),i=k$(153),j=[].slice;d(d.P+d.F*k$(70)(function(){g&&j.call(g)}),"Array",{slice:function s(k,b){var e=i(this.length),l=o(this);b=b===void 0?e:b;if(l=="Array")return j.call(this,k,b);for(var f=h(k,e),p=h(b,e),m=i(p-f),n=new Array(m),c=0;c<m;c++)n[c]=l=="String"?this.charAt(f+c):this[f+c];return n}})},186(){"use strict";var b=k$(68),h=k$(37),d=k$(154),e=k$(70),c=[].sort,f=[1,2,3];b(b.P+b.F*(e(function(){f.sort(void 0)})||!e(function(){f.sort(null)})||!k$(140)(c)),"Array",{sort:function k(g){return g===void 0?c.call(d(this)):c.call(d(this),h(g))}})},49(h,e){var f=k$(87),c=k$(85),g=k$(164)("species");e.exports=function(d){var a;return c(d)&&(a=d.constructor,typeof a=="function"&&(a===Array||c(a.prototype))&&(a=void 0),f(a)&&(a=a[g],a===null&&(a=void 0))),a===void 0?Array:a}},50(f,b){var c=k$(49);b.exports=function(d,e){return new(c(d))(e)}},47(B,o){var p=k$(60),q=k$(83),r=k$(154),s=k$(153),t=k$(50);o.exports=function(a,u){var j=a==1,v=a==2,w=a==3,e=a==4,k=a==6,x=a==5||k,l=u||t;return function(f,y,z){for(var m=r(f),g=q(m),A=p(y,z,3),n=s(g.length),b=0,h=j?l(f,n):v?l(f,0):void 0,d,i;n>b;b++)if(x||b in g){d=g[b],i=A(d,b,m);if(a){if(j)h[b]=i;else if(i)switch(a){case 3:return!0;case 5:return d;case 6:return b;case 2:h.push(d)}else if(e)return!1}}return k?-1:w||e?e:h}}},173(){"use strict";var b=k$(68),c=k$(47)(0),d=k$(140)([].forEach,!0);b(b.P+b.F*!d,"Array",{forEach:function h(e){return c(this,e,arguments[1])}})},180(){"use strict";var b=k$(68),c=k$(47)(1);b(b.P+b.F*!k$(140)([].map,!0),"Array",{map:function g(d){return c(this,d,arguments[1])}})},170(){"use strict";var b=k$(68),c=k$(47)(2);b(b.P+b.F*!k$(140)([].filter,!0),"Array",{filter:function g(d){return c(this,d,arguments[1])}})},185(){"use strict";var b=k$(68),c=k$(47)(3);b(b.P+b.F*!k$(140)([].some,!0),"Array",{some:function g(d){return c(this,d,arguments[1])}})},168(){"use strict";var b=k$(68),c=k$(47)(4);b(b.P+b.F*!k$(140)([].every,!0),"Array",{every:function g(d){return c(this,d,arguments[1])}})},48(q,j){var k=k$(37),l=k$(154),m=k$(83),n=k$(153);j.exports=function(o,i,p,c,d){k(i);var f=l(o),e=m(f),g=n(f.length),a=d?g-1:0,h=d?-1:1;if(p<2)for(;;){if(a in e){c=e[a],a+=h;break}a+=h;if(d?a<0:g<=a)throw TypeError("Reduce of empty array with no initial value")}for(;d?a>=0:g>a;a+=h)a in e&&(c=i(c,e[a],a,f));return c}},183(){"use strict";var b=k$(68),c=k$(48);b(b.P+b.F*!k$(140)([].reduce,!0),"Array",{reduce:function g(d){return c(this,d,arguments.length,arguments[1],!1)}})},182(){"use strict";var b=k$(68),c=k$(48);b(b.P+b.F*!k$(140)([].reduceRight,!0),"Array",{reduceRight:function g(d){return c(this,d,arguments.length,arguments[1],!0)}})},175(){"use strict";var b=k$(68),e=k$(46)(!1),c=[].indexOf,d=!!c&&1/[1].indexOf(1,-0)<0;b(b.P+b.F*(d||!k$(140)(c)),"Array",{indexOf:function i(f){return d?c.apply(this,arguments)||0:e(this,f,arguments[1])}})},179(){"use strict";var c=k$(68),h=k$(152),i=k$(151),j=k$(153),d=[].lastIndexOf,f=!!d&&1/[1].lastIndexOf(1,-0)<0;c(c.P+c.F*(f||!k$(140)(d)),"Array",{lastIndexOf:function n(k){if(f)return d.apply(this,arguments)||0;var e=h(this),g=j(e.length),a=g-1;for(arguments.length>1&&(a=Math.min(a,i(arguments[1]))),a<0&&(a=g+a);a>=0;a--)if(a in e){if(e[a]===k)return a||0}return-1}})},43(o,j){"use strict";var k=k$(154),g=k$(149),l=k$(153);j.exports=[].copyWithin||function p(m,n){var c=k(this),d=l(c.length),a=g(m,d),b=g(n,d),i=arguments.length>2?arguments[2]:void 0,e=Math.min((i===void 0?d:g(i,d))-b,d-a),h=1;for(b<a&&a<b+e&&(h=-1,b+=e-1,a+=e-1);e-- >0;)b in c?c[a]=c[b]:delete c[a],a+=h,b+=h;return c}},39(f,d){var a=k$(164)("unscopables"),b=Array.prototype;b[a]==void 0&&k$(78)(b,a,{}),d.exports=function(e){b[a][e]=!0}},167(){var b=k$(68);b(b.P,"Array",{copyWithin:k$(43)}),k$(39)("copyWithin")},44(m,h){"use strict";var i=k$(154),d=k$(149),j=k$(153);h.exports=function n(k){for(var b=i(this),c=j(b.length),e=arguments.length,f=d(e>1?arguments[1]:void 0,c),g=e>2?arguments[2]:void 0,l=g===void 0?c:d(g,c);l>f;)b[f++]=k;return b}},169(){var b=k$(68);b(b.P,"Array",{fill:k$(44)}),k$(39)("fill")},172(){"use strict";var b=k$(68),e=k$(47)(5),c="find",d=!0;c in[]&&Array(1)[c](function(){d=!1}),b(b.P+b.F*d,"Array",{find:function i(f){return e(this,f,arguments.length>1?arguments[1]:void 0)}}),k$(39)(c)},171(){"use strict";var b=k$(68),e=k$(47)(6),c="findIndex",d=!0;c in[]&&Array(1)[c](function(){d=!1}),b(b.P+b.F*d,"Array",{findIndex:function i(f){return e(this,f,arguments.length>1?arguments[1]:void 0)}}),k$(39)(c)},135(i,d){"use strict";var e=k$(76),f=k$(107),g=k$(64),c=k$(164)("species");d.exports=function(h){var b=e[h];g&&b&&!b[c]&&f.f(b,c,{configurable:!0,get:function(){return this}})}},187(){k$(135)("Array")},93(d,a){a.exports=function(b,c){return{value:c,done:!!b}}},177(j,h){"use strict";var f=k$(39),d=k$(93),g=k$(94),i=k$(152);h.exports=k$(91)(Array,"Array",function(a,e){this._t=i(a),this._i=0,this._k=e},function(){var a=this._t,e=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,d(1)):e=="keys"?d(0,c):e=="values"?d(0,a[c]):d(0,[c,a[c]])},"values"),g.Arguments=g.Array,f("keys"),f("values"),f("entries")},72(f,d){"use strict";var e=k$(42);d.exports=function(){var b=e(this),a="";return b.global&&(a+="g"),b.ignoreCase&&(a+="i"),b.multiline&&(a+="m"),b.unicode&&(a+="u"),b.sticky&&(a+="y"),a}},260(){var l=k$(76),q=k$(81),r=k$(107).f,s=k$(112).f,t=k$(88),u=k$(72),a=l.RegExp,d=a,h=a.prototype,e=/a/g,i=/a/g,m=new a(e)!==e;if(k$(64)&&(!m||k$(70)(function(){return i[k$(164)("match")]=!1,a(e)!=e||a(i)==i||a(e,"i")!="/a/i"}))){a=function f(c,j){var p=this instanceof a,g=t(c),k=j===void 0;return!p&&g&&c.constructor===a&&k?c:q(m?new d(g&&!k?c.source:c,j):d((g=c instanceof a)?c.source:c,g&&k?u.call(c):j),p?this:h,a)};for(var v=function(f){f in a||r(a,f,{configurable:!0,get:function(){return d[f]},set:function(c){d[f]=c}})},n=s(d),o=0;n.length>o;)v(n[o++]);h.constructor=a,a.prototype=h,k$(127)(l,"RegExp",a)}k$(135)("RegExp")},129(r,n){"use strict";var o=k$(72),d=RegExp.prototype.exec,p=String.prototype.replace,j=d,e="lastIndex",g=function(){var i=/a/,f=/b*/g;return d.call(i,"a"),d.call(f,"a"),i[e]!==0||f[e]!==0}(),h=/()??/.exec("")[1]!==void 0,q=g||h;q&&(j=function i(f){var b=this,k,l,a,c;return h&&(l=new RegExp("^"+b.source+"$(?!\\s)",o.call(b))),g&&(k=b[e]),a=d.call(b,f),g&&a&&(b[e]=b.global?a.index+a[0].length:k),h&&a&&a.length>1&&p.call(a[0],l,function(){for(c=1;c<arguments.length-2;c++)arguments[c]===void 0&&(a[c]=void 0)}),a}),n.exports=j},261(){"use strict";var b=k$(129);k$(68)({target:"RegExp",proto:!0,forced:b!==/./.exec},{exec:b})},262(){k$(64)&&/./g.flags!="g"&&k$(107).f(RegExp.prototype,"flags",{configurable:!0,get:k$(72)})},267(){"use strict";k$(262);var g=k$(42),h=k$(72),i=k$(64),c="toString",d=/./[c],f=function(e){k$(127)(RegExp.prototype,c,e,!0)};k$(70)(function(){return d.call({source:"a",flags:"b"})!="/a/b"})?f(function e(){var b=g(this);return"/".concat(b.source,"/","flags"in b?b.flags:!i&&b instanceof RegExp?h.call(b):void 0)}):d.name!=c&&f(function e(){return d.call(this)})},40(g,c){"use strict";var d=k$(141)(!0);c.exports=function(e,a,f){return a+(f?d(e,a).length:1)}},128(i,f){"use strict";var g=k$(52),h=RegExp.prototype.exec;f.exports=function(a,b){var c=a.exec;if(typeof c==="function"){var d=c.call(a,b);if(typeof d!=="object")throw new TypeError("RegExp exec method returned something other than an Object or null");return d}if(g(a)!=="RegExp")throw new TypeError("RegExp#exec called on incompatible receiver");return h.call(a,b)}},71(B,p){"use strict";k$(261);var q=k$(127),r=k$(78),h=k$(70),s=k$(63),k=k$(164),t=k$(129),u=k("species"),v=!h(function(){var a=/./;return a.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(a,"$<a>")!=="7"}),w=function(){var a=/(?:)/,e=a.exec;a.exec=function(){return e.apply(this,arguments)};var f="ab".split(a);return f.length===2&&f[0]==="a"&&f[1]==="b"}();p.exports=function(a,e,f){var g=k(a),i=!h(function(){var b={};return b[g]=function(){return 7},""[a](b)!=7}),x=i?!h(function(){var b=!1,c=/a/;return c.exec=function(){return b=!0,null},a==="split"&&(c.constructor={},c.constructor[u]=function(){return c}),c[g](""),!b}):void 0;if(!i||!x||a==="replace"&&!v||a==="split"&&!w){var y=/./[g],l=f(s,g,""[a],function b(c,j,n,o,A){return j.exec===t?i&&!A?{done:!0,value:y.call(j,n,o)}:{done:!0,value:c.call(n,j,o)}:{done:!1}}),z=l[0],m=l[1];q(String.prototype,a,z),r(RegExp.prototype,g,e==2?function(b,c){return m.call(b,this,c)}:function(b){return m.call(b,this)})}}},263(){"use strict";var l=k$(42),m=k$(153),n=k$(40),g=k$(128);k$(71)("match",1,function(o,h,p,q){return[function e(b){var a=o(this),c=b==void 0?void 0:b[h];return c!==void 0?c.call(b,a):new RegExp(b)[h](String(a))},function(e){var b=q(p,e,this);if(b.done)return b.value;var a=l(e),c=String(this);if(!a.global)return g(a,c);var r=a.unicode;a.lastIndex=0;for(var i=[],f=0,j;(j=g(a,c))!==null;){var k=String(j[0]);i[f]=k,k===""&&(a.lastIndex=n(c,m(a.lastIndex),r)),f++}return f===0?null:i}]})},264(){"use strict";var y=k$(42),z=k$(154),A=k$(153),B=k$(151),C=k$(40),D=k$(128),E=Math.max,F=Math.min,G=Math.floor,H=/\$([$&`']|\d\d?|<[^>]*>)/g,I=/\$([$&`']|\d\d?)/g,J=function(m){return m===void 0?m:String(m)};k$(71)("replace",2,function(m,K,r,L){return[function k(b,f){var c=m(this),a=b==void 0?void 0:b[K];return a!==void 0?a.call(b,c,f):r.call(String(c),b,f)},function(k,b){var f=L(r,k,this,b);if(f.done)return f.value;var c=y(k),a=String(this),o=typeof b==="function";o||(b=String(b));var p=c.global;if(p){var q=c.unicode;c.lastIndex=0}for(var l=[];;){var d=D(c,a);if(d===null)break;l.push(d);if(!p)break;var i=String(d[0]);i===""&&(c.lastIndex=C(a,A(c.lastIndex),q))}for(var j="",e=0,g=0;g<l.length;g++){d=l[g];for(var s=String(d[0]),n=E(F(B(d.index),a.length),0),t=[],u=1;u<d.length;u++)t.push(J(d[u]));var v=d.groups;if(o){var w=[s].concat(t,n,a);v!==void 0&&w.push(v);var x=String(b.apply(void 0,w))}else x=M(s,a,n,t,v,b);n>=e&&(j+=a.slice(e,n)+x,e=n+s.length)}return j+a.slice(e)}];function M(k,b,f,c,a,o){var p=f+k.length,q=c.length,l=I;return a!==void 0&&(a=z(a),l=H),r.call(o,l,function(d,i){var j;switch(i.charAt(0)){case"$":return"$";case"&":return k;case"`":return b.slice(0,f);case"'":return b.slice(p);case"<":j=a[i.slice(1,-1)];break;default:var e=+i;if(e===0)return d;if(e>q){var g=G(e/10);return g===0?d:g<=q?c[g-1]===void 0?i.charAt(1):c[g-1]+i.charAt(1):d}j=c[e-1]}return j===void 0?"":j})}})},265(){"use strict";var j=k$(42),g=k$(131),k=k$(128);k$(71)("search",1,function(l,h,m,n){return[function e(b){var a=l(this),d=b==void 0?void 0:b[h];return d!==void 0?d.call(b,a):new RegExp(b)[h](String(a))},function(e){var b=n(m,e,this);if(b.done)return b.value;var a=j(e),d=String(this),f=a.lastIndex;g(f,0)||(a.lastIndex=0);var i=k(a,d);return g(a.lastIndex,f)||(a.lastIndex=f),i===null?-1:i.index}]})},139(j,e){var b=k$(42),f=k$(37),g=k$(164)("species");e.exports=function(h,i){var c=b(h).constructor,d;return c===void 0||(d=b(c)[g])==void 0?i:f(d)}},266(){"use strict";var z=k$(88),A=k$(42),B=k$(139),C=k$(40),D=k$(153),x=k$(128),E=k$(129),F=k$(70),G=Math.min,H=[].push,k="split",e="length",t="lastIndex",u=4294967295,q=!F(function(){RegExp(u,"y")});k$(71)("split",2,function(I,J,s,K){var p;return"abbc"[k](/(b)*/)[1]=="c"||"test"[k](/(?:)/,-1)[e]!=4||"ab"[k](/(?:ab)*/)[e]!=2||"."[k](/(.?)(.?)/)[e]!=4||"."[k](/()()/)[e]>1||""[k](/.?/)[e]?p=function(c,b){var f=String(this);if(c===void 0&&b===0)return[];if(!z(c))return s.call(f,c,b);for(var a=[],d=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(c.sticky?"y":""),l=0,r=b===void 0?u:b>>>0,m=new RegExp(c.source,d+"g"),g,n,o;g=E.call(m,f);){n=m[t];if(n>l){a.push(f.slice(l,g.index)),g[e]>1&&g.index<f[e]&&H.apply(a,g.slice(1)),o=g[0][e],l=n;if(a[e]>=r)break}m[t]===g.index&&m[t]++}return l===f[e]?(o||!m.test(""))&&a.push(""):a.push(f.slice(l)),a[e]>r?a.slice(0,r):a}:"0"[k](void 0,0)[e]?p=function(c,b){return c===void 0&&b===0?[]:s.call(this,c,b)}:p=s,[function c(b,f){var a=I(this),d=b==void 0?void 0:b[J];return d!==void 0?d.call(b,a,f):p.call(String(a),b,f)},function(c,b){var f=K(p,c,this,b,p!==s);if(f.done)return f.value;var a=A(c),d=String(this),l=B(a,RegExp),r=a.unicode,m=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(q?"y":"g"),g=new l(q?a:"^(?:"+a.source+")",m),n=b===void 0?u:b>>>0;if(n===0)return[];if(d.length===0)return x(g,d)===null?[d]:[];for(var o=0,i=0,j=[];i<d.length;){g.lastIndex=q?i:0;var v=x(g,q?d:d.slice(i)),y;if(v===null||(y=G(D(g.lastIndex+(q?0:i)),d.length))===o)i=C(d,i,r);else{j.push(d.slice(o,i));if(j.length===n)return j;for(var w=1;w<=v.length-1;w++){j.push(v[w]);if(j.length===n)return j}i=o=y}}return j.push(d.slice(o)),j}]})},41(f,c){c.exports=function(a,d,e,b){if(!(a instanceof d)||b!==void 0&&b in a)throw TypeError(e+": incorrect invocation!");return a}},74(l,n){var o=k$(60),p=k$(89),q=k$(84),r=k$(42),s=k$(153),t=k$(165),f={},g={},l=n.exports=function(b,h,u,v,w){var i=w?function(){return b}:t(b),j=o(u,v,h?2:1),d=0,m,e,k,a;if(typeof i!="function")throw TypeError(b+" is not iterable!");if(q(i))for(m=s(b.length);m>d;d++){a=h?j(r(e=b[d])[0],e[1]):j(b[d]);if(a===f||a===g)return a}else for(k=i.call(b);!(e=k.next()).done;){a=p(k,j,e.value,h);if(a===f||a===g)return a}};l.BREAK=f,l.RETURN=g},148(y,w){var h=k$(60),x=k$(82),o=k$(79),p=k$(65),b=k$(76),q=b.process,i=b.setImmediate,j=b.clearImmediate,r=b.MessageChannel,k=b.Dispatch,l=0,f={},s="onreadystatechange",c,m,n,g=function(){var a=+this;if(f.hasOwnProperty(a)){var d=f[a];delete f[a],d()}},t=function(a){g.call(a.data)};(!i||!j)&&(i=function a(d){for(var u=[],v=1;arguments.length>v;)u.push(arguments[v++]);return f[++l]=function(){x(typeof d=="function"?d:Function(d),u)},c(l),l},j=function a(d){delete f[d]},k$(53)(q)=="process"?c=function(a){q.nextTick(h(g,a,1))}:k&&k.now?c=function(a){k.now(h(g,a,1))}:r?(m=new r(),n=m.port2,m.port1.onmessage=t,c=h(n.postMessage,n,1)):b.addEventListener&&typeof postMessage=="function"&&!b.importScripts?(c=function(a){b.postMessage(a+"","*")},b.addEventListener("message",t,!1)):s in p("script")?c=function(a){o.appendChild(p("script"))[s]=function(){o.removeChild(this),g.call(a)}}:c=function(a){setTimeout(h(g,a,1),0)}),w.exports={set:i,clear:j}},103(s,o){var a=k$(76),p=k$(148).set,k=a.MutationObserver||a.WebKitMutationObserver,i=a.process,j=a.Promise,l=k$(53)(i)=="process";o.exports=function(){var b,f,c,g=function(){var d,e;for(l&&(d=i.domain)&&d.exit();b;){e=b.fn,b=b.next;try{e()}catch(r){throw b?c():f=void 0,r}}f=void 0,d&&d.enter()};if(l)c=function(){i.nextTick(g)};else if(k&&!(a.navigator&&a.navigator.standalone)){var m=!0,n=document.createTextNode("");new k(g).observe(n,{characterData:!0}),c=function(){n.data=m=!m}}else if(j&&j.resolve){var q=j.resolve(void 0);c=function(){q.then(g)}}else c=function(){p.call(a,g)};return function(d){var e={fn:d,next:void 0};f&&(f.next=e),b||(b=e,c()),f=e}}},104(j,f){"use strict";var d=k$(37);function g(a){var b,c;this.promise=new a(function(h,i){if(b!==void 0||c!==void 0)throw TypeError("Bad Promise constructor");b=h,c=i}),this.resolve=d(b),this.reject=d(c)}f.exports.f=function(a){return new g(a)}},123(d,a){a.exports=function(b){try{return{e:!1,v:b()}}catch(c){return{e:!0,v:c}}}},160(e,c){var d=k$(76),a=d.navigator;c.exports=a&&a.userAgent||""},124(j,e){var f=k$(42),g=k$(87),h=k$(104);e.exports=function(c,a){f(c);if(g(a)&&a.constructor===c)return a;var d=h.f(c),i=d.resolve;return i(a),d.promise}},126(h,e){var f=k$(127);e.exports=function(a,b,g){for(var c in b)f(a,c,b[c],g);return a}},245(){"use strict";var F=k$(95),l=k$(76),o=k$(60),R=k$(52),f=k$(68),S=k$(87),T=k$(37),U=k$(41),G=k$(74),V=k$(139),H=k$(148).set,I=k$(103)(),J=k$(104),B=k$(123),W=k$(160),X=k$(124),m="Promise",K=l.TypeError,p=l.process,L=p&&p.versions,Y=L&&L.v8||"",j=l[m],u=R(p)=="process",y=function(){},z,M,N,C,v=M=J.f,w=!!function(){try{var a=j.resolve(1),b=(a.constructor={})[k$(164)("species")]=function(d){d(y,y)};return(u||typeof PromiseRejectionEvent=="function")&&a.then(y)instanceof b&&Y.indexOf("6.6")!==0&&W.indexOf("Chrome/66")===-1}catch(d){}}(),O=function(a){var b;return S(a)&&typeof(b=a.then)=="function"?b:!1},D=function(a,b){if(a._n)return;a._n=!0;var d=a._c;I(function(){for(var c=a._v,g=a._s==1,h=0,r=function(i){var x=g?i.ok:i.fail,s=i.resolve,t=i.reject,n=i.domain,k,A,Q;try{x?(g||(a._h==2&&_(a),a._h=1),x===!0?k=c:(n&&n.enter(),k=x(c),n&&(n.exit(),Q=!0)),k===i.promise?t(K("Promise-chain cycle")):(A=O(k))?A.call(k,s,t):s(k)):t(c)}catch($){n&&!Q&&n.exit(),t($)}};d.length>h;)r(d[h++]);a._c=[],a._n=!1,b&&!a._h&&Z(a)})},Z=function(a){H.call(l,function(){var b=a._v,d=P(a),c,g,h;d&&(c=B(function(){u?p.emit("unhandledRejection",b,a):(g=l.onunhandledrejection)?g({promise:a,reason:b}):(h=l.console)&&h.error&&h.error("Unhandled promise rejection",b)}),a._h=u||P(a)?2:1),a._a=void 0;if(d&&c.e)throw c.v})},P=function(a){return a._h!==1&&(a._a||a._c).length===0},_=function(a){H.call(l,function(){var b;u?p.emit("rejectionHandled",a):(b=l.onrejectionhandled)&&b({promise:a,reason:a._v})})},q=function(a){var b=this;if(b._d)return;b._d=!0,b=b._w||b,b._v=a,b._s=2,b._a||(b._a=b._c.slice()),D(b,!0)},E=function(a){var b=this,d;if(b._d)return;b._d=!0,b=b._w||b;try{if(b===a)throw K("Promise can't be resolved itself");(d=O(a))?I(function(){var c={_w:b,_d:!1};try{d.call(a,o(E,c,1),o(q,c,1))}catch(g){q.call(c,g)}}):(b._v=a,b._s=1,D(b,!1))}catch(c){q.call({_w:b,_d:!1},c)}};w||(j=function a(b){U(this,j,m,"_h"),T(b),z.call(this);try{b(o(E,this,1),o(q,this,1))}catch(d){q.call(this,d)}},z=function a(b){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},z.prototype=k$(126)(j.prototype,{then:function a(b,d){var c=v(V(this,j));return c.ok=typeof b=="function"?b:!0,c.fail=typeof d=="function"&&d,c.domain=u?p.domain:void 0,this._c.push(c),this._a&&this._a.push(c),this._s&&D(this,!1),c.promise},catch:function(a){return this.then(void 0,a)}}),N=function(){var a=new z();this.promise=a,this.resolve=o(E,a,1),this.reject=o(q,a,1)},J.f=v=function(a){return a===j||a===C?new N(a):M(a)}),f(f.G+f.W+f.F*!w,{Promise:j}),k$(136)(j,m),k$(135)(m),C=k$(58)[m],f(f.S+f.F*!w,m,{reject:function a(b){var d=v(this),c=d.reject;return c(b),d.promise}}),f(f.S+f.F*(F||!w),m,{resolve:function a(b){return X(F&&this===C?j:this,b)}}),f(f.S+f.F*!(w&&k$(92)(function(a){j.all(a).catch(y)})),m,{all:function a(b){var d=this,c=v(d),g=c.resolve,h=c.reject,r=B(function(){var i=[],x=0,s=1;G(b,!1,function(t){var n=x++,k=!1;i.push(void 0),s++,d.resolve(t).then(function(A){if(k)return;k=!0,i[n]=A,--s||g(i)},h)}),--s||g(i)});return r.e&&h(r.v),c.promise},race:function a(b){var d=this,c=v(d),g=c.reject,h=B(function(){G(b,!1,function(r){d.resolve(r).then(c.resolve,g)})});return h.e&&g(h.v),c.promise}})},161(f,d){var e=k$(87);d.exports=function(a,b){if(!e(a)||a._t!==b)throw TypeError("Incompatible receiver, "+b+" required!");return a}},54(A,r){"use strict";var s=k$(107).f,t=k$(106),u=k$(126),v=k$(60),w=k$(41),x=k$(74),y=k$(91),m=k$(93),z=k$(135),p=k$(64),q=k$(101).fastKey,k=k$(161),l=p?"_s":"size",n=function(f,e){var j=q(e),b;if(j!=="F")return f._i[j];for(b=f._f;b;b=b.n)if(b.k==e)return b};r.exports={getConstructor:function(f,e,j,b){var g=f(function(a,d){w(a,g,e,"_i"),a._t=e,a._i=t(null),a._f=void 0,a._l=void 0,a[l]=0,d!=void 0&&x(d,j,a[b],a)});return u(g.prototype,{clear:function a(){for(var d=k(this,e),i=d._i,c=d._f;c;c=c.n)c.r=!0,c.p&&(c.p=c.p.n=void 0),delete i[c.i];d._f=d._l=void 0,d[l]=0},delete:function(a){var d=k(this,e),i=n(d,a);if(i){var c=i.n,o=i.p;delete d._i[i.i],i.r=!0,o&&(o.n=c),c&&(c.p=o),d._f==i&&(d._f=c),d._l==i&&(d._l=o),d[l]--}return!!i},forEach:function a(d){k(this,e);for(var i=v(d,arguments.length>1?arguments[1]:void 0,3),c;c=c?c.n:this._f;)for(i(c.v,c.k,this);c&&c.r;)c=c.p},has:function a(d){return!!n(k(this,e),d)}}),p&&s(g.prototype,"size",{get:function(){return k(this,e)[l]}}),g},def:function(f,e,j){var b=n(f,e),g,a;return b?b.v=j:(f._l=b={i:a=q(e,!0),k:e,v:j,p:g=f._l,n:void 0,r:!1},f._f||(f._f=b),g&&(g.n=b),f[l]++,a!=="F"&&(f._i[a]=b)),f},getEntry:n,setStrong:function(f,e,j){y(f,e,function(b,g){this._t=k(b,e),this._k=g,this._l=void 0},function(){for(var b=this,g=b._k,a=b._l;a&&a.r;)a=a.p;return!b._t||!(b._l=a=a?a.n:b._t._f)?(b._t=void 0,m(1)):g=="keys"?m(0,a.k):g=="values"?m(0,a.v):m(0,[a.k,a.v])},j?"entries":"values",!j,!0),z(e)}}},57(K,v){"use strict";var w=k$(76),l=k$(68),x=k$(127),y=k$(126),z=k$(101),A=k$(74),B=k$(41),n=k$(87),o=k$(70),C=k$(92),D=k$(136),E=k$(81);v.exports=function(i,r,F,s,j,g){var p=w[i],a=p,k=j?"set":"add",h=a&&a.prototype,t={},m=function(b){var e=h[b];x(h,b,b=="delete"?function(f){return g&&!n(f)?!1:e.call(this,f===0?0:f)}:b=="has"?function f(c){return g&&!n(c)?!1:e.call(this,c===0?0:c)}:b=="get"?function f(c){return g&&!n(c)?void 0:e.call(this,c===0?0:c)}:b=="add"?function f(c){return e.call(this,c===0?0:c),this}:function f(c,J){return e.call(this,c===0?0:c,J),this})};if(typeof a!="function"||!(g||h.forEach&&!o(function(){new a().entries().next()})))a=s.getConstructor(r,i,j,k),y(a.prototype,F),z.NEED=!0;else{var q=new a(),G=q[k](g?{}:-0,1)!=q,H=o(function(){q.has(1)}),I=C(function(b){new a(b)}),u=!g&&o(function(){for(var b=new a(),e=5;e--;)b[k](e,e);return!b.has(-0)});I||(a=r(function(b,e){B(b,a,i);var f=E(new p(),b,a);return e!=void 0&&A(e,j,f[k],f),f}),a.prototype=h,h.constructor=a),(H||u)&&(m("delete"),m("has"),j&&m("get")),(u||G)&&m(k),g&&h.clear&&delete h.clear}return D(a,i),t[i]=a,l(l.G+l.W+l.F*(a!=p),t),g||s.setStrong(a,i,j),a}},196(i,h){"use strict";var d=k$(54),g=k$(161),e="Map";h.exports=k$(57)(e,function(f){return function a(){return f(this,arguments.length>0?arguments[0]:void 0)}},{get:function f(a){var b=d.getEntry(g(this,e),a);return b&&b.v},set:function f(a,b){return d.def(g(this,e),a===0?0:a,b)}},d,!0)},268(h,f){"use strict";var c=k$(54),g=k$(161),d="Set";f.exports=k$(57)(d,function(e){return function a(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function e(a){return c.def(g(this,d),a=a===0?0:a,a)}},c)},56(z,r){"use strict";var s=k$(126),i=k$(101).getWeak,t=k$(42),m=k$(87),u=k$(41),v=k$(74),n=k$(47),o=k$(77),p=k$(161),w=n(5),x=n(6),y=0,g=function(a){return a._l||(a._l=new q())},q=function(){this.a=[]},j=function(a,b){return w(a.a,function(c){return c[0]===b})};q.prototype={get:function(a){var b=j(this,a);if(b)return b[1]},has:function(a){return!!j(this,a)},set:function(a,b){var c=j(this,a);c?c[1]=b:this.a.push([a,b])},delete:function(a){var b=x(this.a,function(c){return c[0]===a});return~b&&this.a.splice(b,1),!!~b}},r.exports={getConstructor:function(a,b,c,h){var k=a(function(d,e){u(d,k,b,"_i"),d._t=b,d._i=y++,d._l=void 0,e!=void 0&&v(e,c,d[h],d)});return s(k.prototype,{delete:function(d){if(!m(d))return!1;var e=i(d);return e===!0?g(p(this,b)).delete(d):e&&o(e,this._i)&&delete e[this._i]},has:function d(e){if(!m(e))return!1;var l=i(e);return l===!0?g(p(this,b)).has(e):l&&o(l,this._i)}}),k},def:function(a,b,c){var h=i(t(b),!0);return h===!0?g(a).set(b,c):h[a._i]=c,a},ufstore:g}},303(A,p){"use strict";var i=k$(76),q=k$(47)(0),r=k$(127),j=k$(101),s=k$(105),e=k$(56),k=k$(87),l=k$(161),t=k$(161),u=!i.ActiveXObject&&"ActiveXObject"in i,f="WeakMap",v=j.getWeak,w=Object.isExtensible,x=e.ufstore,h,m=function(c){return function b(){return c(this,arguments.length>0?arguments[0]:void 0)}},n={get:function c(b){if(k(b)){var d=v(b);return d===!0?x(l(this,f)).get(b):d?d[this._i]:void 0}},set:function c(b,d){return e.def(l(this,f),b,d)}},y=p.exports=k$(57)(f,m,n,e,!0,!0);t&&u&&(h=e.getConstructor(m,f),s(h.prototype,n),j.NEED=!0,q(["delete","has","get","set"],function(c){var b=y.prototype,d=b[c];r(b,c,function(g,o){if(k(g)&&!w(g)){this._f||(this._f=new h());var z=this._f[c](g,o);return c=="set"?this:z}return d.call(this,g,o)})}))},304(){"use strict";var b=k$(56),f=k$(161),c="WeakSet";k$(57)(c,function(d){return function e(){return d(this,arguments.length>0?arguments[0]:void 0)}},{add:function d(e){return b.def(f(this,c),e,!0)}},b,!1,!0)},158(n,k){for(var b=k$(76),d=k$(78),e=k$(159),f=e("typed_array"),g=e("view"),h=!!(b.ArrayBuffer&&b.DataView),i=h,j=0,l=9,c,m="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");j<l;)(c=b[m[j++]])?(d(c.prototype,f,!0),d(c.prototype,g,!0)):i=!1;k.exports={ABV:h,CONSTR:i,TYPED:f,VIEW:g}},150(h,e){var f=k$(151),g=k$(153);e.exports=function(b){if(b===void 0)return 0;var c=f(b),d=g(c);if(c!==d)throw RangeError("Wrong length!");return d}},157(M){"use strict";var u=k$(76),z=k$(64),ba=k$(95),N=k$(158),O=k$(78),P=k$(126),G=k$(70),A=k$(41),ca=k$(151),da=k$(153),B=k$(150),ea=k$(112).f,fa=k$(107).f,ga=k$(44),Q=k$(136),v="ArrayBuffer",w="DataView",s="prototype",ha="Wrong length!",R="Wrong index!",e=u[v],o=u[w],x=u.Math,C=u.RangeError,H=u.Infinity,D=e,ia=x.abs,p=x.pow,ja=x.floor,ka=x.log,la=x.LN2,S="buffer",I="byteLength",T="byteOffset",J=z?"_b":S,y=z?"_l":I,K=z?"_o":T;function U(a,b,c){var h=new Array(c),j=c*8-b-1,f=(1<<j)-1,g=f>>1,k=b===23?p(2,-24)-p(2,-77):0,m=0,l=a<0||a===0&&1/a<0?1:0,d,n,t;for(a=ia(a),a!=a||a===H?(n=a!=a?1:0,d=f):(d=ja(ka(a)/la),a*(t=p(2,-d))<1&&(d--,t*=2),d+g>=1?a+=k/t:a+=k*p(2,1-g),a*t>=2&&(d++,t/=2),d+g>=f?(n=0,d=f):d+g>=1?(n=(a*t-1)*p(2,b),d=d+g):(n=a*p(2,g-1)*p(2,b),d=0));b>=8;h[m++]=n&255,n/=256,b-=8);for(d=d<<b|n,j+=b;j>0;h[m++]=d&255,d/=256,j-=8);return h[--m]|=l*128,h}function V(a,b,c){var h=c*8-b-1,j=(1<<h)-1,f=j>>1,g=h-7,k=c-1,m=a[k--],l=m&127,d;for(m>>=7;g>0;l=l*256+a[k],k--,g-=8);for(d=l&(1<<-g)-1,l>>=-g,g+=b;g>0;d=d*256+a[k],k--,g-=8);if(l===0)l=1-f;else{if(l===j)return d?NaN:m?-H:H;d=d+p(2,b),l=l-f}return(m?-1:1)*d*p(2,l-b)}function W(a){return a[3]<<24|a[2]<<16|a[1]<<8|a[0]}function X(a){return[a&255]}function Y(a){return[a&255,a>>8&255]}function Z(a){return[a&255,a>>8&255,a>>16&255,a>>24&255]}function ma(a){return U(a,52,8)}function na(a){return U(a,23,4)}function E(a,b,c){fa(a[s],b,{get:function(){return this[c]}})}function q(a,b,c,h){var j=+c,f=B(j);if(f+b>a[y])throw C(R);var g=a[J]._b,k=f+a[K],m=g.slice(k,k+b);return h?m:m.reverse()}function r(a,b,c,h,j,f){var g=+c,k=B(g);if(k+b>a[y])throw C(R);for(var m=a[J]._b,l=k+a[K],d=h(+j),n=0;n<b;n++)m[l+n]=d[f?n:b-n-1]}if(!N.ABV)e=function a(b){A(this,e,v);var c=B(b);this._b=ga.call(new Array(c),0),this[y]=c},o=function a(b,c,h){A(this,o,w),A(b,e,w);var j=b[y],f=ca(c);if(f<0||f>j)throw C("Wrong offset!");h=h===void 0?j-f:da(h);if(f+h>j)throw C(ha);this[J]=b,this[K]=f,this[y]=h},z&&(E(e,I,"_l"),E(o,S,"_b"),E(o,I,"_l"),E(o,T,"_o")),P(o[s],{getInt8:function a(b){return q(this,1,b)[0]<<24>>24},getUint8:function a(b){return q(this,1,b)[0]},getInt16:function a(b){var c=q(this,2,b,arguments[1]);return(c[1]<<8|c[0])<<16>>16},getUint16:function a(b){var c=q(this,2,b,arguments[1]);return c[1]<<8|c[0]},getInt32:function a(b){return W(q(this,4,b,arguments[1]))},getUint32:function a(b){return W(q(this,4,b,arguments[1]))>>>0},getFloat32:function a(b){return V(q(this,4,b,arguments[1]),23,4)},getFloat64:function a(b){return V(q(this,8,b,arguments[1]),52,8)},setInt8:function a(b,c){r(this,1,b,X,c)},setUint8:function a(b,c){r(this,1,b,X,c)},setInt16:function a(b,c){r(this,2,b,Y,c,arguments[2])},setUint16:function a(b,c){r(this,2,b,Y,c,arguments[2])},setInt32:function a(b,c){r(this,4,b,Z,c,arguments[2])},setUint32:function a(b,c){r(this,4,b,Z,c,arguments[2])},setFloat32:function a(b,c){r(this,4,b,na,c,arguments[2])},setFloat64:function a(b,c){r(this,8,b,ma,c,arguments[2])}});else{if(!G(function(){e(1)})||!G(function(){new e(-1)})||G(function(){return new e(),new e(1.5),new e(NaN),e.name!=v})){e=function a(b){return A(this,e),new D(B(b))};for(var oa=e[s]=D[s],_=ea(D),$=0,L;_.length>$;)(L=_[$++])in e||O(e,L,D[L]);ba||(oa.constructor=e)}var F=new o(new e(2)),aa=o[s].setInt8;F.setInt8(0,2147483648),F.setInt8(1,2147483649),(F.getInt8(0)||!F.getInt8(1))&&P(o[s],{setInt8:function a(b,c){aa.call(this,b,c<<24>>24)},setUint8:function a(b,c){aa.call(this,b,c<<24>>24)}},!0)}Q(e,v),Q(o,w),O(o[s],N.VIEW,!0),M[v]=e,M[w]=o},292(){"use strict";var b=k$(68),e=k$(158),j=k$(157),k=k$(42),l=k$(149),s=k$(153),t=k$(87),m=k$(76).ArrayBuffer,u=k$(139),d=j.ArrayBuffer,n=j.DataView,o=e.ABV&&m.isView,p=d.prototype.slice,v=e.VIEW,f="ArrayBuffer";b(b.G+b.W+b.F*(m!==d),{ArrayBuffer:d}),b(b.S+b.F*!e.CONSTR,f,{isView:function w(c){return o&&o(c)||t(c)&&v in c}}),b(b.P+b.U+b.F*k$(70)(function(){return!new d(2).slice(1,void 0).byteLength}),f,{slice:function w(c,g){if(p!==void 0&&g===void 0)return p.call(k(this),c);for(var h=k(this).byteLength,i=l(c,h),q=l(g===void 0?h:g,h),r=new(u(this,d))(s(q-i)),x=new n(this),y=new n(r),z=0;i<q;)y.setUint8(z++,x.getUint8(i++));return r}}),k$(135)(f)},293(){var a=k$(68);a(a.G+a.W+a.F*!k$(158).ABV,{DataView:k$(157).DataView})},156(wb,ia){"use strict";if(k$(64)){var X=k$(95),K=k$(76),p=k$(70),i=k$(68),L=k$(158),ja=k$(157),Oa=k$(60),ka=k$(41),Pa=k$(125),q=k$(78),Y=k$(126),Qa=k$(151),M=k$(153),la=k$(150),ma=k$(149),na=k$(155),B=k$(77),oa=k$(52),x=k$(87),pa=k$(154),Ra=k$(84),Sa=k$(106),Ta=k$(114),Z=k$(112).f,Ua=k$(165),qa=k$(159),ra=k$(164),w=k$(47),sa=k$(46),_=k$(139),$=k$(177),Va=k$(94),Wa=k$(92),Xa=k$(135),Ya=k$(44),Za=k$(43),ta=k$(107),ua=k$(110),C=ta.f,_a=ua.f,D=K.RangeError,va=K.TypeError,y=K.Uint8Array,aa="ArrayBuffer",wa="Shared"+aa,xa="BYTES_PER_ELEMENT",E="prototype",t=Array[E],ba=ja.ArrayBuffer,$a=ja.DataView,ya=w(0),ab=w(2),bb=w(3),cb=w(4),db=w(5),eb=w(6),fb=sa(!0),gb=sa(!1),hb=$.values,ib=$.keys,jb=$.entries,kb=t.lastIndexOf,lb=t.reduce,mb=t.reduceRight,za=t.join,nb=t.sort,Aa=t.slice,F=t.toString,ca=t.toLocaleString,da=ra("iterator"),N=ra("toStringTag"),Ba=qa("typed_constructor"),O=qa("def_constructor"),Ca=L.CONSTR,z=L.TYPED,ob=L.VIEW,P="Wrong length!",pb=w(1,function(b,a){return R(_(b,b[O]),a)}),Da=p(function(){return new y(new Uint16Array([1]).buffer)[0]===1}),qb=!!y&&!!y[E].set&&p(function(){new y(1).set({})}),Q=function(b,a){var c=Qa(b);if(c<0||c%a)throw D("Wrong offset!");return c},j=function(b){if(x(b)&&z in b)return b;throw va(b+" is not a typed array!")},R=function(b,a){if(!(x(b)&&Ba in b))throw va("It is not a typed array constructor!");return new b(a)},Ea=function(b,a){return ea(_(b,b[O]),a)},ea=function(b,a){for(var c=0,f=a.length,g=R(b,f);f>c;)g[c]=a[c++];return g},S=function(b,a,c){C(b,a,{get:function(){return this._d[c]}})},fa=function b(a){var c=pa(a),f=arguments.length,g=f>1?arguments[1]:void 0,n=g!==void 0,s=Ua(c),d,o,A,G,H,k;if(s!=void 0&&!Ra(s)){for(k=s.call(c),A=[],d=0;!(H=k.next()).done;d++)A.push(H.value);c=A}for(n&&f>2&&(g=Oa(g,arguments[2],2)),d=0,o=M(c.length),G=R(this,o);o>d;d++)G[d]=n?g(c[d],d):c[d];return G},rb=function b(){for(var a=0,c=arguments.length,f=R(this,c);c>a;)f[a]=arguments[a++];return f},sb=!!y&&p(function(){ca.call(new y(1))}),Fa=function b(){return ca.apply(sb?Aa.call(j(this)):j(this),arguments)},Ga={copyWithin:function b(a,c){return Za.call(j(this),a,c,arguments.length>2?arguments[2]:void 0)},every:function b(a){return cb(j(this),a,arguments.length>1?arguments[1]:void 0)},fill:function b(a){return Ya.apply(j(this),arguments)},filter:function b(a){return Ea(this,ab(j(this),a,arguments.length>1?arguments[1]:void 0))},find:function b(a){return db(j(this),a,arguments.length>1?arguments[1]:void 0)},findIndex:function b(a){return eb(j(this),a,arguments.length>1?arguments[1]:void 0)},forEach:function b(a){ya(j(this),a,arguments.length>1?arguments[1]:void 0)},indexOf:function b(a){return gb(j(this),a,arguments.length>1?arguments[1]:void 0)},includes:function b(a){return fb(j(this),a,arguments.length>1?arguments[1]:void 0)},join:function b(a){return za.apply(j(this),arguments)},lastIndexOf:function b(a){return kb.apply(j(this),arguments)},map:function b(a){return pb(j(this),a,arguments.length>1?arguments[1]:void 0)},reduce:function b(a){return lb.apply(j(this),arguments)},reduceRight:function b(a){return mb.apply(j(this),arguments)},reverse:function b(){for(var a=this,c=j(a).length,f=Math.floor(c/2),g=0,n;g<f;)n=a[g],a[g++]=a[--c],a[c]=n;return a},some:function b(a){return bb(j(this),a,arguments.length>1?arguments[1]:void 0)},sort:function b(a){return nb.call(j(this),a)},subarray:function b(a,c){var f=j(this),g=f.length,n=ma(a,g);return new(_(f,f[O]))(f.buffer,f.byteOffset+n*f.BYTES_PER_ELEMENT,M((c===void 0?g:ma(c,g))-n))}},Ha=function b(a,c){return Ea(this,Aa.call(j(this),a,c))},Ia=function b(a){j(this);var c=Q(arguments[1],1),f=this.length,g=pa(a),n=M(g.length),s=0;if(n+c>f)throw D(P);for(;s<n;)this[c+s]=g[s++]},T={entries:function b(){return jb.call(j(this))},keys:function b(){return ib.call(j(this))},values:function b(){return hb.call(j(this))}},Ja=function(b,a){return x(b)&&b[z]&&typeof a!="symbol"&&a in b&&String(+a)==String(a)},Ka=function b(a,c){return Ja(a,c=na(c,!0))?Pa(2,a[c]):_a(a,c)},La=function b(a,c,f){return Ja(a,c=na(c,!0))&&x(f)&&B(f,"value")&&!B(f,"get")&&!B(f,"set")&&!f.configurable&&(!B(f,"writable")||f.writable)&&(!B(f,"enumerable")||f.enumerable)?(a[c]=f.value,a):C(a,c,f)};Ca||(ua.f=Ka,ta.f=La),i(i.S+i.F*!Ca,"Object",{getOwnPropertyDescriptor:Ka,defineProperty:La}),p(function(){F.call({})})&&(F=ca=function b(){return za.call(this)});var r=Y({},Ga);Y(r,T),q(r,da,T.values),Y(r,{slice:Ha,set:Ia,constructor:function(){},toString:F,toLocaleString:Fa}),S(r,"buffer","b"),S(r,"byteOffset","o"),S(r,"byteLength","l"),S(r,"length","e"),C(r,N,{get:function(){return this[z]}}),ia.exports=function(b,a,c,f){f=!!f;var g=b+(f?"Clamped":"")+"Array",n="get"+b,s="set"+b,d=K[g],o=d||{},A=d&&Ta(d),G=!d||!L.ABV,H={},k=d&&d[E],tb=function(l,h){var m=l._d;return m.v[n](h*a+m.o,Da)},ub=function(l,h,m){var u=l._d;f&&(m=(m=Math.round(m))<0?0:m>255?255:m&255),u.v[s](h*a+u.o,m,Da)},vb=function(l,h){C(l,h,{get:function(){return tb(this,h)},set:function(m){return ub(this,h,m)},enumerable:!0})};G?(d=c(function(l,h,m,u){ka(l,d,g,"_d");var I=0,V=0,W,v,J,Na;if(!x(h))J=la(h),v=J*a,W=new ba(v);else if(h instanceof ba||(Na=oa(h))==aa||Na==wa){W=h,V=Q(m,a);var ha=h.byteLength;if(u===void 0){if(ha%a)throw D(P);v=ha-V;if(v<0)throw D(P)}else{v=M(u)*a;if(v+V>ha)throw D(P)}J=v/a}else return z in h?ea(d,h):fa.call(d,h);for(q(l,"_d",{b:W,o:V,l:v,e:J,v:new $a(W)});I<J;)vb(l,I++)}),k=d[E]=Sa(r),q(k,"constructor",d)):(!p(function(){d(1)})||!p(function(){new d(-1)})||!Wa(function(l){new d(),new d(null),new d(1.5),new d(l)},!0))&&(d=c(function(l,h,m,u){ka(l,d,g);var I;return x(h)?h instanceof ba||(I=oa(h))==aa||I==wa?u!==void 0?new o(h,Q(m,a),u):m!==void 0?new o(h,Q(m,a)):new o(h):z in h?ea(d,h):fa.call(d,h):new o(la(h))}),ya(A!==Function.prototype?Z(o).concat(Z(A)):Z(o),function(l){l in d||q(d,l,o[l])}),d[E]=k,X||(k.constructor=d));var U=k[da],ga=!!U&&(U.name=="values"||U.name==void 0),Ma=T.values;q(d,Ba,!0),q(k,z,g),q(k,ob,!0),q(k,O,d),(f?new d(1)[N]!=g:!(N in k))&&C(k,N,{get:function(){return g}}),H[g]=d,i(i.G+i.W+i.F*(d!=o),H),i(i.S,g,{BYTES_PER_ELEMENT:a}),i(i.S+i.F*p(function(){o.of.call(d,1)}),g,{from:fa,of:rb}),xa in k||q(k,xa,a),i(i.P,g,Ga),Xa(g),i(i.P+i.F*qb,g,{set:Ia}),i(i.P+i.F*!ga,g,T),!X&&k.toString!=F&&(k.toString=F),i(i.P+i.F*p(function(){new d(1).slice()}),g,{slice:Ha}),i(i.P+i.F*(p(function(){return[1,2].toLocaleString()!=new d([1,2]).toLocaleString()})||!p(function(){k.toLocaleString.call([1,2])})),g,{toLocaleString:Fa}),Va[g]=ga?U:Ma,!X&&!ga&&q(k,da,Ma)}}else ia.exports=function(){}},298(){k$(156)("Int8",1,function(b){return function h(c,d,e){return b(this,c,d,e)}})},301(){k$(156)("Uint8",1,function(b){return function h(c,d,e){return b(this,c,d,e)}})},302(){k$(156)("Uint8",1,function(b){return function h(c,d,e){return b(this,c,d,e)}},!0)},296(){k$(156)("Int16",2,function(b){return function h(c,d,e){return b(this,c,d,e)}})},299(){k$(156)("Uint16",2,function(b){return function h(c,d,e){return b(this,c,d,e)}})},297(){k$(156)("Int32",4,function(b){return function h(c,d,e){return b(this,c,d,e)}})},300(){k$(156)("Uint32",4,function(b){return function h(c,d,e){return b(this,c,d,e)}})},294(){k$(156)("Float32",4,function(b){return function h(c,d,e){return b(this,c,d,e)}})},295(){k$(156)("Float64",8,function(b){return function h(c,d,e){return b(this,c,d,e)}})},246(){var b=k$(68),g=k$(37),h=k$(42),c=(k$(76).Reflect||{}).apply,i=Function.apply;b(b.S+b.F*!k$(70)(function(){c(function(){})}),"Reflect",{apply:function n(j,d,k){var e=g(j),f=h(k);return c?c(e,d,f):i.call(e,d,f)}})},247(){var d=k$(68),q=k$(106),i=k$(37),r=k$(42),j=k$(87),k=k$(70),s=k$(51),e=(k$(76).Reflect||{}).construct,l=k(function(){function f(){}return!(e(function(){},[],f)instanceof f)}),m=!k(function(){e(function(){})});d(d.S+d.F*(l||m),"Reflect",{construct:function f(b,a){i(b),r(a);var g=arguments.length<3?b:i(arguments[2]);if(m&&!l)return e(b,a,g);if(b==g){switch(a.length){case 0:return new b();case 1:return new b(a[0]);case 2:return new b(a[0],a[1]);case 3:return new b(a[0],a[1],a[2]);case 4:return new b(a[0],a[1],a[2],a[3])}var h=[null];return h.push.apply(h,a),new(s.apply(b,h))()}var n=g.prototype,o=q(j(n)?n:Object.prototype),p=Function.apply.call(b,o,a);return j(p)?p:o}})},248(){var d=k$(107),b=k$(68),e=k$(42),h=k$(155);b(b.S+b.F*k$(70)(function(){Reflect.defineProperty(d.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function k(f,c,g){e(f),c=h(c,!0),e(g);try{return d.f(f,c,g),!0}catch(l){return!1}}})},249(){var b=k$(68),f=k$(110).f,g=k$(42);b(b.S,"Reflect",{deleteProperty:function j(c,d){var e=f(g(c),d);return e&&!e.configurable?!1:delete c[d]}})},250(){"use strict";var e=k$(68),g=k$(42),f=function(a){this._t=g(a),this._i=0;var b=this._k=[],c;for(c in a)b.push(c)};k$(90)(f,"Object",function(){var a=this,b=a._k,c;do if(a._i>=b.length)return{value:void 0,done:!0};while(!((c=b[a._i++])in a._t));return{value:c,done:!1}}),e(e.S,"Reflect",{enumerate:function a(b){return new f(b)}})},253(){var i=k$(110),j=k$(114),k=k$(77),f=k$(68),l=k$(87),m=k$(42);function g(b,d){var e=arguments.length<3?b:arguments[2],c,h;if(m(b)===e)return b[d];if(c=i.f(b,d))return k(c,"value")?c.value:c.get!==void 0?c.get.call(e):void 0;if(l(h=j(b)))return g(h,d,e)}f(f.S,"Reflect",{get:g})},251(){var c=k$(110),b=k$(68),d=k$(42);b(b.S,"Reflect",{getOwnPropertyDescriptor:function i(e,f){return c.f(d(e),f)}})},252(){var b=k$(68),c=k$(114),d=k$(42);b(b.S,"Reflect",{getPrototypeOf:function h(e){return c(d(e))}})},254(){var a=k$(68);a(a.S,"Reflect",{has:function g(c,d){return d in c}})},255(){var b=k$(68),e=k$(42),c=Object.isExtensible;b(b.S,"Reflect",{isExtensible:function h(d){return e(d),c?c(d):!0}})},120(j,f){var g=k$(112),h=k$(113),i=k$(42),b=k$(76).Reflect;f.exports=b&&b.ownKeys||function k(c){var d=g.f(i(c)),e=h.f;return e?d.concat(e(c)):d}},256(){var b=k$(68);b(b.S,"Reflect",{ownKeys:k$(120)})},257(){var b=k$(68),e=k$(42),c=Object.preventExtensions;b(b.S,"Reflect",{preventExtensions:function h(d){e(d);try{return c&&c(d),!0}catch(i){return!1}}})},259(){var h=k$(107),i=k$(110),o=k$(114),p=k$(77),j=k$(68),k=k$(125),q=k$(42),l=k$(87);function m(g,e,f){var b=arguments.length<4?g:arguments[3],c=i.f(q(g),e),d,n;if(!c){if(l(n=o(g)))return m(n,e,f,b);c=k(0)}if(p(c,"value")){if(c.writable===!1||!l(b))return!1;if(d=i.f(b,e)){if(d.get||d.set||d.writable===!1)return!1;d.value=f,h.f(b,e,d)}else h.f(b,e,k(0,f));return!0}return c.set===void 0?!1:(c.set.call(b,f),!0)}j(j.S,"Reflect",{set:m})},258(){var c=k$(68),a=k$(134);a&&c(c.S,"Reflect",{setPrototypeOf:function h(d,e){a.check(d,e);try{return a.set(d,e),!0}catch(i){return!1}}})},307(){"use strict";var b=k$(68),c=k$(46)(!0);b(b.P,"Array",{includes:function g(d){return c(this,d,arguments.length>1?arguments[1]:void 0)}}),k$(39)("includes")},73(v,m){"use strict";var n=k$(85),o=k$(87),p=k$(153),q=k$(60),r=k$(164)("isConcatSpreadable");function g(h,i,f,s,t,j,k,u){for(var b=t,c=0,l=k?q(k,u,3):!1,a,d;c<s;){if(c in f){a=l?l(f[c],c,i):f[c],d=!1,o(a)&&(d=a[r],d=d!==void 0?!!d:n(a));if(d&&j>0)b=g(h,i,a,p(a.length),b,j-1)-1;else{if(b>=9007199254740991)throw TypeError();h[b]=a}b++}c++}return b}m.exports=g},305(){"use strict";var d=k$(68),g=k$(73),h=k$(154),i=k$(153),j=k$(37),k=k$(50);d(d.P,"Array",{flatMap:function n(e){var b=h(this),f,c;return j(e),f=i(b.length),c=k(b,0),g(c,b,b,f,0,1,e,arguments[1]),c}}),k$(39)("flatMap")},306(){"use strict";var c=k$(68),f=k$(73),g=k$(154),h=k$(153),i=k$(151),j=k$(50);c(c.P,"Array",{flatten:function n(){var d=arguments[0],b=g(this),k=h(b.length),e=j(b,0);return f(e,b,b,k,0,d===void 0?1:i(d)),e}}),k$(39)("flatten")},348(){"use strict";var b=k$(68),c=k$(141)(!0);b(b.P,"String",{at:function g(d){return c(this,d)}})},144(p,i){var j=k$(153),k=k$(145),l=k$(63);i.exports=function(m,n,f,o){var b=String(l(m)),g=b.length,d=f===void 0?" ":String(f),h=j(n);if(h<=g||d=="")return b;var e=h-g,a=k.call(d,Math.ceil(e/d.length));return a.length>e&&(a=a.slice(0,e)),o?a+b:b+a}},351(){"use strict";var b=k$(68),c=k$(144),d=k$(160),e=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(d);b(b.P+b.F*e,"String",{padStart:function i(f){return c(this,f,arguments.length>1?arguments[1]:void 0,!0)}})},350(){"use strict";var b=k$(68),c=k$(144),d=k$(160),e=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(d);b(b.P+b.F*e,"String",{padEnd:function i(f){return c(this,f,arguments.length>1?arguments[1]:void 0,!1)}})},352(){"use strict";k$(146)("trimLeft",function(b){return function e(){return b(this,1)}},"trimStart")},353(){"use strict";k$(146)("trimRight",function(b){return function e(){return b(this,2)}},"trimEnd")},349(){"use strict";var e=k$(68),h=k$(63),i=k$(153),j=k$(88),k=k$(72),l=RegExp.prototype,f=function(c,a){this._r=c,this._s=a};k$(90)(f,"RegExp String",function c(){var a=this._r.exec(this._s);return{value:a,done:a===null}}),e(e.P,"String",{matchAll:function c(a){h(this);if(!j(a))throw TypeError(a+" is not a regexp!");var m=String(this),d="flags"in l?String(a.flags):k.call(a),g=new RegExp(a.source,~d.indexOf("g")?d:"g"+d);return g.lastIndex=i(a.lastIndex),new f(g,m)}})},354(){k$(162)("asyncIterator")},355(){k$(162)("observable")},329(){var c=k$(68),i=k$(120),j=k$(152),k=k$(110),l=k$(59);c(c.S,"Object",{getOwnPropertyDescriptors:function q(m){for(var d=j(m),n=k.f,e=i(d),f={},g=0,h,b;e.length>g;)b=n(d,h=e[g++]),b!==void 0&&l(f,h,b);return f}})},119(o,g){var h=k$(64),i=k$(116),j=k$(152),k=k$(117).f;g.exports=function(l){return function(m){for(var c=j(m),d=i(c),n=d.length,e=0,f=[],a;n>e;)a=d[e++],(!h||k.call(c,a))&&f.push(l?[a,c[a]]:c[a]);return f}}},332(){var b=k$(68),c=k$(119)(!1);b(b.S,"Object",{values:function g(d){return c(d)}})},328(){var b=k$(68),c=k$(119)(!0);b(b.S,"Object",{entries:function g(d){return c(d)}})},109(d,c){"use strict";c.exports=k$(95)||!k$(70)(function(){var b=Math.random();__defineSetter__.call(null,b,function(){}),delete k$(76)[b]})},326(){"use strict";var b=k$(68),c=k$(154),d=k$(37),e=k$(107);k$(64)&&b(b.P+k$(109),"Object",{__defineGetter__:function j(f,g){e.f(c(this),f,{get:d(g),enumerable:!0,configurable:!0})}})},327(){"use strict";var b=k$(68),c=k$(154),d=k$(37),e=k$(107);k$(64)&&b(b.P+k$(109),"Object",{__defineSetter__:function j(f,g){e.f(c(this),f,{set:d(g),enumerable:!0,configurable:!0})}})},330(){"use strict";var c=k$(68),e=k$(154),f=k$(155),g=k$(114),h=k$(110).f;k$(64)&&c(c.P+k$(109),"Object",{__lookupGetter__:function m(i){var b=e(this),j=f(i,!0),d;do if(d=h(b,j))return d.get;while(b=g(b))}})},331(){"use strict";var c=k$(68),e=k$(154),f=k$(155),g=k$(114),h=k$(110).f;k$(64)&&c(c.P+k$(109),"Object",{__lookupSetter__:function m(i){var b=e(this),j=f(i,!0),d;do if(d=h(b,j))return d.set;while(b=g(b))}})},45(g,c){var d=k$(74);c.exports=function(e,f){var a=[];return d(e,!1,a.push,a,f),a}},55(f,c){var d=k$(52),e=k$(45);c.exports=function(b){return function g(){if(d(this)!=b)throw TypeError(b+"#toJSON isn't generic");return e(this)}}},313(){var a=k$(68);a(a.P+a.R,"Map",{toJSON:k$(55)("Map")})},347(){var a=k$(68);a(a.P+a.R,"Set",{toJSON:k$(55)("Set")})},133(g,e){"use strict";var b=k$(68);e.exports=function(f){b(b.S,f,{of:function h(){for(var a=arguments.length,c=new Array(a);a--;)c[a]=arguments[a];return new this(c)}})}},312(){k$(133)("Map")},346(){k$(133)("Set")},358(){k$(133)("WeakMap")},360(){k$(133)("WeakSet")},132(o,k){"use strict";var f=k$(68),g=k$(37),l=k$(60),h=k$(74);k.exports=function(m){f(f.S,m,{from:function p(c){var d=arguments[1],e,a,i,j;return g(this),e=d!==void 0,e&&g(d),c==void 0?new this():(a=[],e?(i=0,j=l(d,arguments[2],2),h(c,!1,function(n){a.push(j(n,i++))})):h(c,!1,a.push,a),new this(a))}})}},311(){k$(132)("Map")},345(){k$(132)("Set")},357(){k$(132)("WeakMap")},359(){k$(132)("WeakSet")},310(){var b=k$(68);b(b.G,{global:k$(76)})},356(){var b=k$(68);b(b.S,"System",{global:k$(76)})},309(){var b=k$(68),c=k$(53);b(b.S,"Error",{isError:function g(d){return c(d)==="Error"}})},314(){var a=k$(68);a(a.S,"Math",{clamp:function h(c,d,e){return Math.min(e,Math.max(d,c))}})},315(){var a=k$(68);a(a.S,"Math",{DEG_PER_RAD:Math.PI/180})},316(){var a=k$(68),c=180/Math.PI;a(a.S,"Math",{degrees:function g(d){return d*c}})},99(g,f){f.exports=Math.scale||function i(a,b,d,c,e){return arguments.length===0||a!=a||b!=b||d!=d||c!=c||e!=e?NaN:a===Infinity||a===-Infinity?a:(a-b)*(e-c)/(d-b)+c}},317(){var b=k$(68),c=k$(99),d=k$(97);b(b.S,"Math",{fscale:function l(e,f,g,h,i){return d(c(e,f,g,h,i))}})},318(){var c=k$(68);c(c.S,"Math",{iaddh:function l(e,f,g,h){var a=e>>>0,i=f>>>0,b=g>>>0;return i+(h>>>0)+((a&b|(a|b)&~(a+b>>>0))>>>31)|0}})},320(){var c=k$(68);c(c.S,"Math",{isubh:function l(e,f,g,h){var a=e>>>0,i=f>>>0,b=g>>>0;return i-(h>>>0)-((~a&b|~(a^b)&a-b>>>0)>>>31)|0}})},319(){var b=k$(68);b(b.S,"Math",{imulh:function o(k,l){var a=65535,c=+k,d=+l,e=c&a,f=d&a,g=c>>16,h=d>>16,i=(g*f>>>0)+(e*f>>>16);return g*h+(i>>16)+((e*h>>>0)+(i&a)>>16)}})},321(){var a=k$(68);a(a.S,"Math",{RAD_PER_DEG:180/Math.PI})},322(){var a=k$(68),c=Math.PI/180;a(a.S,"Math",{radians:function g(d){return d*c}})},323(){var b=k$(68);b(b.S,"Math",{scale:k$(99)})},325(){var b=k$(68);b(b.S,"Math",{umulh:function o(k,l){var a=65535,c=+k,d=+l,e=c&a,f=d&a,g=c>>>16,h=d>>>16,i=(g*f>>>0)+(e*f>>>16);return g*h+(i>>>16)+((e*h>>>0)+(i&a)>>>16)}})},324(){var b=k$(68);b(b.S,"Math",{signbit:function f(a){return(a=+a)!=a?a:a==0?1/a==Infinity:a>0}})},334(){"use strict";var c=k$(68),h=k$(58),i=k$(76),j=k$(139),e=k$(124);c(c.P+c.R,"Promise",{finally:function(b){var f=j(this,h.Promise||i.Promise),g=typeof b=="function";return this.then(g?function(d){return e(f,b()).then(function(){return d})}:b,g?function(d){return e(f,b()).then(function(){throw d})}:b)}})},335(){"use strict";var c=k$(68),e=k$(104),f=k$(123);c(c.S,"Promise",{try:function(g){var b=e.f(this),d=f(g);return(d.e?b.reject:b.resolve)(d.v),b.promise}})},102(t,l){var i=k$(196),j=k$(68),k=k$(138)("metadata"),h=k.store||(k.store=new(k$(303))()),e=function(a,d,c){var b=h.get(a);if(!b){if(!c)return;h.set(a,b=new i())}var g=b.get(d);if(!g){if(!c)return;b.set(d,g=new i())}return g},m=function(a,d,c){var b=e(d,c,!1);return b===void 0?!1:b.has(a)},n=function(a,d,c){var b=e(d,c,!1);return b===void 0?void 0:b.get(a)},o=function(a,d,c,b){e(c,b,!0).set(a,d)},p=function(a,d){var c=e(a,d,!1),b=[];return c&&c.forEach(function(g,s){b.push(s)}),b},q=function(a){return a===void 0||typeof a=="symbol"?a:String(a)},r=function(a){j(j.S,"Reflect",a)};l.exports={store:h,map:e,has:m,get:n,set:o,keys:p,key:q,exp:r}},336(){var a=k$(102),c=k$(42),d=a.key,e=a.set;a.exp({defineMetadata:function l(f,g,h,i){e(f,g,c(h),d(i))}})},337(){var a=k$(102),h=k$(42),i=a.key,j=a.map,e=a.store;a.exp({deleteMetadata:function n(k,b){var f=arguments.length<3?void 0:i(arguments[2]),c=j(h(b),f,!1);if(c===void 0||!c.delete(k))return!1;if(c.size)return!0;var g=e.get(b);return g.delete(f),!!g.size||e.delete(b)}})},339(){var c=k$(102),h=k$(42),i=k$(114),j=c.has,k=c.get,l=c.key,f=function(d,a,b){var m=j(d,a,b);if(m)return k(d,a,b);var g=i(a);return g!==null?f(d,g,b):void 0};c.exp({getMetadata:function d(a,b){return f(a,h(b),arguments.length<3?void 0:l(arguments[2]))}})},338(){var i=k$(268),j=k$(45),d=k$(102),k=k$(42),l=k$(114),m=d.keys,n=d.key,g=function(e,b){var c=m(e,b),h=l(e);if(h===null)return c;var f=g(h,b);return f.length?c.length?j(new i(c.concat(f))):f:c};d.exp({getMetadataKeys:function e(b){return g(k(b),arguments.length<2?void 0:n(arguments[1]))}})},341(){var a=k$(102),c=k$(42),d=a.get,e=a.key;a.exp({getOwnMetadata:function j(f,g){return d(f,c(g),arguments.length<3?void 0:e(arguments[2]))}})},340(){var a=k$(102),c=k$(42),d=a.keys,e=a.key;a.exp({getOwnMetadataKeys:function i(f){return d(c(f),arguments.length<2?void 0:e(arguments[1]))}})},342(){var d=k$(102),h=k$(42),i=k$(114),j=d.has,k=d.key,f=function(e,a,b){var l=j(e,a,b);if(l)return!0;var g=i(a);return g!==null?f(e,g,b):!1};d.exp({hasMetadata:function e(a,b){return f(a,h(b),arguments.length<3?void 0:k(arguments[2]))}})},343(){var a=k$(102),c=k$(42),d=a.has,e=a.key;a.exp({hasOwnMetadata:function j(f,g){return d(f,c(g),arguments.length<3?void 0:e(arguments[2]))}})},344(){var b=k$(102),d=k$(42),e=k$(37),f=b.key,g=b.set;b.exp({metadata:function m(h,i){return function n(j,c){g(h,i,(c!==void 0?d:e)(j),f(c))}}})},308(){var b=k$(68),f=k$(103)(),c=k$(76).process,g=k$(53)(c)=="process";b(b.G,{asap:function j(d){var e=g&&c.domain;f(e?e.bind(d):d)}})},333(){"use strict";var q=k$(68),y=k$(76),z=k$(58),r=k$(103)(),s=k$(164)("observable"),m=k$(37),p=k$(42),A=k$(41),n=k$(126),B=k$(78),t=k$(74),u=t.RETURN,o=function(c){return c==null?void 0:m(c)},j=function(c){var a=c._c;a&&(c._c=void 0,a())},l=function(c){return c._o===void 0},v=function(c){l(c)||(c._o=void 0,j(c))},w=function(c,a){p(c),this._c=void 0,this._o=c,c=new x(this);try{var b=a(c),e=b;b!=null&&(typeof b.unsubscribe==="function"?b=function(){e.unsubscribe()}:m(b),this._c=b)}catch(d){c.error(d);return}l(this)&&j(this)};w.prototype=n({},{unsubscribe:function c(){v(this)}});var x=function(c){this._s=c};x.prototype=n({},{next:function c(a){var b=this._s;if(!l(b)){var e=b._o;try{var d=o(e.next);if(d)return d.call(e,a)}catch(f){try{v(b)}finally{throw f}}}},error:function c(a){var b=this._s;if(l(b))throw a;var e=b._o;b._o=void 0;try{var d=o(e.error);if(!d)throw a;a=d.call(e,a)}catch(f){try{j(b)}finally{throw f}}return j(b),a},complete:function c(a){var b=this._s;if(!l(b)){var e=b._o;b._o=void 0;try{var d=o(e.complete);a=d?d.call(e,a):void 0}catch(f){try{j(b)}finally{throw f}}return j(b),a}}});var i=function c(a){A(this,i,"Observable","_f")._f=m(a)};n(i.prototype,{subscribe:function c(a){return new w(a,this._f)},forEach:function c(a){var b=this;return new(z.Promise||y.Promise)(function(e,d){m(a);var f=b.subscribe({next:function(h){try{return a(h)}catch(k){d(k),f.unsubscribe()}},error:d,complete:e})})}}),n(i,{from:function c(a){var b=typeof this==="function"?this:i,e=o(p(a)[s]);if(e){var d=p(e.call(a));return d.constructor===b?d:new b(function(f){return d.subscribe(f)})}return new b(function(f){var h=!1;return r(function(){if(!h){try{if(t(a,!1,function(k){f.next(k);if(h)return u})===u)return}catch(k){if(h)throw k;f.error(k);return}f.complete()}}),function(){h=!0}})},of:function c(){for(var a=0,b=arguments.length,e=new Array(b);a<b;)e[a]=arguments[a++];return new(typeof this==="function"?this:i)(function(d){var f=!1;return r(function(){if(!f){for(var h=0;h<e.length;++h){d.next(e[h]);if(f)return}d.complete()}}),function(){f=!0}})}}),B(i.prototype,s,function(){return this}),q(q.G,{Observable:i}),k$(135)("Observable")},363(){var d=k$(76),a=k$(68),g=k$(160),h=[].slice,i=/MSIE .\./.test(g),e=function(j){return function(b,k){var f=arguments.length>2,l=f?h.call(arguments,2):!1;return j(f?function(){(typeof b=="function"?b:Function(b)).apply(this,l)}:b,k)}};a(a.G+a.B+a.F*i,{setTimeout:e(d.setTimeout),setInterval:e(d.setInterval)})},362(){var a=k$(68),c=k$(148);a(a.G+a.B,{setImmediate:c.set,clearImmediate:c.clear})},361(){for(var f=k$(177),p=k$(116),q=k$(127),r=k$(76),g=k$(78),h=k$(94),i=k$(164),j=i("iterator"),k=i("toStringTag"),l=h.Array,m={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},n=p(m),e=0;e<n.length;e++){var c=n[e],s=m[c],o=r[c],b=o&&o.prototype,d;if(b){b[j]||g(b,j,l),b[k]||g(b,k,c),h[c]=l;if(s)for(d in f)b[d]||q(b,d,f[d],!0)}}},364(c,b){k$(291),k$(227),k$(229),k$(228),k$(231),k$(233),k$(238),k$(232),k$(230),k$(240),k$(239),k$(235),k$(236),k$(234),k$(226),k$(237),k$(241),k$(242),k$(193),k$(195),k$(194),k$(244),k$(243),k$(214),k$(224),k$(225),k$(215),k$(216),k$(217),k$(218),k$(219),k$(220),k$(221),k$(222),k$(223),k$(197),k$(198),k$(199),k$(200),k$(201),k$(202),k$(203),k$(204),k$(205),k$(206),k$(207),k$(208),k$(209),k$(210),k$(211),k$(212),k$(213),k$(278),k$(283),k$(290),k$(281),k$(273),k$(274),k$(279),k$(284),k$(286),k$(269),k$(270),k$(271),k$(272),k$(275),k$(276),k$(277),k$(280),k$(282),k$(285),k$(287),k$(288),k$(289),k$(188),k$(190),k$(189),k$(192),k$(191),k$(176),k$(174),k$(181),k$(178),k$(184),k$(186),k$(173),k$(180),k$(170),k$(185),k$(168),k$(183),k$(182),k$(175),k$(179),k$(167),k$(169),k$(172),k$(171),k$(187),k$(177),k$(260),k$(261),k$(267),k$(262),k$(263),k$(264),k$(265),k$(266),k$(245),k$(196),k$(268),k$(303),k$(304),k$(292),k$(293),k$(298),k$(301),k$(302),k$(296),k$(299),k$(297),k$(300),k$(294),k$(295),k$(246),k$(247),k$(248),k$(249),k$(250),k$(253),k$(251),k$(252),k$(254),k$(255),k$(256),k$(257),k$(259),k$(258),k$(307),k$(305),k$(306),k$(348),k$(351),k$(350),k$(352),k$(353),k$(349),k$(354),k$(355),k$(329),k$(332),k$(328),k$(326),k$(327),k$(330),k$(331),k$(313),k$(347),k$(312),k$(346),k$(358),k$(360),k$(311),k$(345),k$(357),k$(359),k$(310),k$(356),k$(309),k$(314),k$(315),k$(316),k$(317),k$(318),k$(320),k$(319),k$(321),k$(322),k$(323),k$(325),k$(324),k$(334),k$(335),k$(336),k$(337),k$(339),k$(338),k$(341),k$(340),k$(342),k$(343),k$(344),k$(308),k$(333),k$(363),k$(362),k$(361),b.exports=k$(58)},386(Q,z){!function(q){"use strict";var I=Object.prototype,n=I.hasOwnProperty,m,A=typeof Symbol==="function"?Symbol:{},t=A.iterator||"@@iterator",R=A.asyncIterator||"@@asyncIterator",u=A.toStringTag||"@@toStringTag",J=typeof z==="object",h=q.regeneratorRuntime;if(h){J&&(z.exports=h);return}h=q.regeneratorRuntime=J?z.exports:{};function K(b,a,c,e){var d=a&&a.prototype instanceof C?a:C,f=Object.create(d.prototype),g=new G(e||[]);return f._invoke=T(b,c,g),f}h.wrap=K;function B(b,a,c){try{return{type:"normal",arg:b.call(a,c)}}catch(e){return{type:"throw",arg:e}}}var L="suspendedStart",S="suspendedYield",M="executing",v="completed",k={};function C(){}function w(){}function o(){}var D={};D[t]=function(){return this};var E=Object.getPrototypeOf,x=E&&E(E(H([])));x&&x!==I&&n.call(x,t)&&(D=x);var p=o.prototype=C.prototype=Object.create(D);w.prototype=p.constructor=o,o.constructor=w,o[u]=w.displayName="GeneratorFunction";function N(b){["next","throw","return"].forEach(function(a){b[a]=function(c){return this._invoke(a,c)}})}h.isGeneratorFunction=function(b){var a=typeof b==="function"&&b.constructor;return a?a===w||(a.displayName||a.name)==="GeneratorFunction":!1},h.mark=function(b){return Object.setPrototypeOf?Object.setPrototypeOf(b,o):(b.__proto__=o,u in b||(b[u]="GeneratorFunction")),b.prototype=Object.create(p),b},h.awrap=function(b){return{__await:b}};function y(b){function a(d,f,g,i){var l=B(b[d],b,f);if(l.type==="throw")i(l.arg);else{var j=l.arg,r=j.value;return r&&typeof r==="object"&&n.call(r,"__await")?Promise.resolve(r.__await).then(function(s){a("next",s,g,i)},function(s){a("throw",s,g,i)}):Promise.resolve(r).then(function(s){j.value=s,g(j)},i)}}typeof q.process==="object"&&q.process.domain&&(a=q.process.domain.bind(a));var c;function e(d,f){function g(){return new Promise(function(i,l){a(d,f,i,l)})}return c=c?c.then(g,g):g()}this._invoke=e}N(y.prototype),y.prototype[R]=function(){return this},h.AsyncIterator=y,h.async=function(b,a,c,e){var d=new y(K(b,a,c,e));return h.isGeneratorFunction(a)?d:d.next().then(function(f){return f.done?f.value:d.next()})};function T(b,a,c){var e=L;return function d(f,g){if(e===M)throw new Error("Generator is already running");if(e===v){if(f==="throw")throw g;return P()}for(c.method=f,c.arg=g;;){var i=c.delegate;if(i){var l=O(i,c);if(l){if(l===k)continue;return l}}if(c.method==="next")c.sent=c._sent=c.arg;else if(c.method==="throw"){if(e===L)throw e=v,c.arg;c.dispatchException(c.arg)}else c.method==="return"&&c.abrupt("return",c.arg);e=M;var j=B(b,a,c);if(j.type==="normal"){e=c.done?v:S;if(j.arg===k)continue;return{value:j.arg,done:c.done}}else j.type==="throw"&&(e=v,c.method="throw",c.arg=j.arg)}}}function O(b,a){var c=b.iterator[a.method];if(c===m){a.delegate=null;if(a.method==="throw"){if(b.iterator.return){a.method="return",a.arg=m,O(b,a);if(a.method==="throw")return k}a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return k}var e=B(c,b.iterator,a.arg);if(e.type==="throw")return a.method="throw",a.arg=e.arg,a.delegate=null,k;var d=e.arg;if(!d)return a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,k;if(d.done)a[b.resultName]=d.value,a.next=b.nextLoc,a.method!=="return"&&(a.method="next",a.arg=m);else return d;return a.delegate=null,k}N(p),p[u]="Generator",p[t]=function(){return this},p.toString=function(){return"[object Generator]"};function U(b){var a={tryLoc:b[0]};1 in b&&(a.catchLoc=b[1]),2 in b&&(a.finallyLoc=b[2],a.afterLoc=b[3]),this.tryEntries.push(a)}function F(b){var a=b.completion||{};a.type="normal",delete a.arg,b.completion=a}function G(b){this.tryEntries=[{tryLoc:"root"}],b.forEach(U,this),this.reset(!0)}h.keys=function(b){var a=[];for(var c in b)a.push(c);return a.reverse(),function e(){for(;a.length;){var d=a.pop();if(d in b)return e.value=d,e.done=!1,e}return e.done=!0,e}};function H(b){if(b){var a=b[t];if(a)return a.call(b);if(typeof b.next==="function")return b;if(!isNaN(b.length)){var c=-1,e=function d(){for(;++c<b.length;)if(n.call(b,c))return d.value=b[c],d.done=!1,d;return d.value=m,d.done=!0,d};return e.next=e}}return{next:P}}h.values=H;function P(){return{value:m,done:!0}}G.prototype={constructor:G,reset:function(b){this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(F);if(!b)for(var a in this)a.charAt(0)==="t"&&n.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=m)},stop:function(){this.done=!0;var b=this.tryEntries[0],a=b.completion;if(a.type==="throw")throw a.arg;return this.rval},dispatchException:function(b){if(this.done)throw b;var a=this;function c(l,j){return f.type="throw",f.arg=b,a.next=l,j&&(a.method="next",a.arg=m),!!j}for(var e=this.tryEntries.length-1;e>=0;--e){var d=this.tryEntries[e],f=d.completion;if(d.tryLoc==="root")return c("end");if(d.tryLoc<=this.prev){var g=n.call(d,"catchLoc"),i=n.call(d,"finallyLoc");if(g&&i){if(this.prev<d.catchLoc)return c(d.catchLoc,!0);if(this.prev<d.finallyLoc)return c(d.finallyLoc)}else if(g){if(this.prev<d.catchLoc)return c(d.catchLoc,!0)}else if(i){if(this.prev<d.finallyLoc)return c(d.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(b,a){for(var c=this.tryEntries.length-1;c>=0;--c){var e=this.tryEntries[c];if(e.tryLoc<=this.prev&&n.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var d=e;break}}d&&(b==="break"||b==="continue")&&d.tryLoc<=a&&a<=d.finallyLoc&&(d=null);var f=d?d.completion:{};return f.type=b,f.arg=a,d?(this.method="next",this.next=d.finallyLoc,k):this.complete(f)},complete:function(b,a){if(b.type==="throw")throw b.arg;return b.type==="break"||b.type==="continue"?this.next=b.arg:b.type==="return"?(this.rval=this.arg=b.arg,this.method="return",this.next="end"):b.type==="normal"&&a&&(this.next=a),k},finish:function(b){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.finallyLoc===b)return this.complete(c.completion,c.afterLoc),F(c),k}},catch:function(b){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.tryLoc===b){var e=c.completion;if(e.type==="throw"){var d=e.arg;F(c)}return d}}throw new Error("illegal catch attempt")},delegateYield:function(b,a,c){return this.delegate={iterator:H(b),resultName:a,nextLoc:c},this.method==="next"&&(this.arg=m),k}}}(typeof global==="object"?global:typeof window==="object"?window:typeof self==="object"?self:Q)},130(f,c){c.exports=function(d,a){var e=a===Object(a)?function(b){return a[b]}:a;return function(b){return String(b).replace(d,e)}}},166(){var b=k$(68),c=k$(130)(/[\\^$*+?.()|[\]{}]/g,"\\$&");b(b.S,"RegExp",{escape:function g(d){return c(d)}})},36(c,b){k$(166),b.exports=k$(58).RegExp.escape},5(){"use strict";k$(364),k$(386),k$(36);if(global._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");global._babelPolyfill=!0;var va="defineProperty";function I(a,d,c){a[d]||Object[va](a,d,{writable:!0,configurable:!0,value:c})}I(String.prototype,"padLeft","".padStart),I(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(a){[][a]&&I(Array,a,Function.call.bind([][a]))});const za=p$(385),Aa=p$(33),Ba=p$(34),Ca=p$(35);class Q extends za.Component{constructor(a){super(a);this.bindEvents=()=>{this.state.hasGyroscope?window.addEventListener("click",this.getGyroscope):window.addEventListener("mousemove",this.getMousePosition),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",a=>{this.getDevicePosition(Math.abs(a.beta),a.gamma)},!0):window.DeviceMotionEvent&&window.addEventListener("devicemotion",a=>{this.getDevicePosition(a.acceleration.x*2,a.acceleration.y*2)},!0),window.addEventListener("resize",this.onWindowResize)};this.onWindowResize=a=>{const d=window.innerWidth;d<768?this.state.camera.position.z=700:this.state.camera.position.z=500};this.getDevicePosition=(a,d)=>{if(this.state.gyroscopeActive){let c=100/180*(a-30)*2.6;c<=0?c=0:null,c>=100?c=100:null;let f=100/180*(d+45)*2.6;f<=0?f=0:null,f>=100?f=100:null,this.turnHead(f,c)}};this.getGyroscope=()=>{let a;DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission?a=DeviceOrientationEvent.requestPermission():a=!0;const d=!this.gyroscopeActive;this.setState({gyroscopeActive:d,orientationPermission:a})};this.getMousePosition=a=>{const d=window.innerWidth,c=window.innerHeight,f=100/d*a.clientX,l=100/c*a.clientY;!this.state.gyroscopeActive&&this.head&&this.turnHead(f,l)};this.turnHead=(a,d)=>{const c=this.head;let f,l;f=(c.rangeRotationX/100*a+c.minRotationX)*-1,l=c.rangeRotationY/100*d+c.minRotationY,c.rotation.x=l,c.rotation.y=f;const b=150,n=5,g=new Ca.Animation("headMoveAnimation","position.z",60,Ca.Animation.ANIMATIONTYPE_FLOAT,Ca.Animation.ANIMATIONLOOPMODE_CONSTANT),i=[{frame:0,value:0},{frame:n,value:b}];g.setKeys(i),c.animations.push(g);const q=-.5,u=-1,v=-1.2,j=-1.8,o=this.pivotEyeLeft;let r=(o.rangeRotationX/100*a+o.minRotationX)*-1,s=o.rangeRotationY/100*d+o.minRotationY,y=r,z=s;this.webcamActive?y=r*q:null,this.webcamActive?z=s*q:null,this.state.stare?y=r*j:null,this.state.stare?z=s*j:null,this.webcamMobile?y=r*u:null,this.webcamMobile?z=s*v:null,o.rotation.x=z,o.rotation.y=y;const w=this.pivotEyeRight;let A=(w.rangeRotationX/100*a+w.minRotationX)*-1,B=w.rangeRotationY/100*d+w.minRotationY,C=A,D=B;this.webcamActive?C=A*q:null,this.webcamActive?D=B*q:null,this.state.stare?C=A*j:null,this.state.stare?D=B*j:null,this.webcamMobile?C=A*u:null,this.webcamMobile?D=B*v:null,w.rotation.x=D,w.rotation.y=C};this.loadObjects=()=>{const a=this,d=new Ca.AssetsManager(this.state.scene);d.useDefaultLoadingScreen=!1;const c=d.addMeshTask("mesh task","","../dist/obj/","head3d.obj");c.onSuccess=function(b){b.loadedMeshes[1].material.diffuseColor=new Ca.Color3(.84,.8,.84),b.loadedMeshes[1].material.specularColor=new Ca.Color3(.4,.4,.4),b.loadedMeshes[2].material.diffuseColor=new Ca.Color3(0,0),b.loadedMeshes[2].material.specularColor=new Ca.Color3(0,0,0);const n=b.loadedMeshes[3];n.material.diffuseColor=new Ca.Color3(1/255*45,1/255*22.5,0),n.material.specularColor=new Ca.Color3(0,0,0),b.loadedMeshes[4].material.alpha=.2,b.loadedMeshes[4].material.diffuseColor=new Ca.Color3(1,1,1),b.loadedMeshes[4].material.specularColor=new Ca.Color3(1,1,1);const g=b.loadedMeshes[0];g.material.emissiveColor=new Ca.Color3(0,0,0),g.material.specularColor=new Ca.Color3(0,0,0),g.material.diffuseTexture.hasAlpha=!0,g.material.backFaceCulling=!1,g.maxRotationX=Math.PI/180*30,g.minRotationX=Math.PI/180*-30,g.rangeRotationX=Math.PI/180*60,g.maxRotationY=Math.PI/180*45,g.minRotationY=Math.PI/180*-45,g.rangeRotationY=Math.PI/180*90;const i=new Ca.TransformNode("pivotEyeRight");i.position=new Ca.Vector3(29.4,27,72.2),i.parent=g,i.maxRotationY=Math.PI/180*5,i.minRotationY=Math.PI/180*-5,i.rangeRotationY=Math.PI/180*10,i.maxRotationX=Math.PI/180*12.5,i.minRotationX=Math.PI/180*-12.5,i.rangeRotationX=Math.PI/180*25;const q=new Ca.MeshBuilder.CreateSphere("pupilRight",{diameter:8,diameterY:2,slice:.5},a.scene);q.parent=i,q.position.z=13,q.position.y=-3.5,q.position.x=2,q.rotation.x=Math.PI/2;const u=new Ca.StandardMaterial("pupilRightMaterial",a.scene);u.diffuseColor=new Ca.Color3(0,0,0),u.specularColor=new Ca.Color3(.1,.1,.1),u.backFaceCulling=!1,q.material=u,b.loadedMeshes[1].parent=i,b.loadedMeshes[2].parent=i,b.loadedMeshes[3].parent=i,b.loadedMeshes[4].parent=i;const v=new Ca.Vector3(-29.4,-27,-72.2);b.loadedMeshes[1].position=v,b.loadedMeshes[2].position=v,b.loadedMeshes[3].position=v,b.loadedMeshes[4].position=v;const j=new Ca.TransformNode("pivotEyeLeft");j.position=new Ca.Vector3(-29.4,27,72.2),j.parent=g,j.maxRotationY=Math.PI/180*10,j.minRotationY=Math.PI/180*-10,j.rangeRotationY=Math.PI/180*20,j.maxRotationX=Math.PI/180*12.5,j.minRotationX=Math.PI/180*-12.5,j.rangeRotationX=Math.PI/180*25;const o=new Ca.MeshBuilder.CreateSphere("pupilLeft",{diameter:8,diameterY:2,slice:.5},a.scene);o.parent=j,o.position.z=13,o.position.y=-3.5,o.position.x=0,o.rotation.x=Math.PI/2;const r=new Ca.StandardMaterial("pupilLeftMaterial",a.scene);r.diffuseColor=new Ca.Color3(0,0,0),r.specularColor=new Ca.Color3(.1,.1,.1),r.backFaceCulling=!1,o.material=r,b.loadedMeshes[5].parent=j,b.loadedMeshes[6].parent=j,b.loadedMeshes[7].parent=j,b.loadedMeshes[8].parent=j;const s=new Ca.Vector3(29.4,-27,-72.2);b.loadedMeshes[5].position=s,b.loadedMeshes[6].position=s,b.loadedMeshes[7].position=s,b.loadedMeshes[8].position=s,g.actionManager=new Ca.ActionManager(a.state.scene),g.actionManager.registerAction(new Ca.ExecuteCodeAction({trigger:Ca.ActionManager.OnPickTrigger},()=>{a.props.setPsychoMode(),g.material.diffuseTexture=a.props.psychoMode?a.psychoTexture:a.normalTexture,n.material.diffuseColor=a.props.psychoMode?new Ca.Color3(1/255*250,1/255*10,1/255*255):new Ca.Color3(1/255*45,1/255*22.5,0),a.setState({stare:!a.state.stare})})),a.head=g,a.pivotEyeRight=i,a.pivotEyeLeft=j,a.setState({headLoaded:!0})},c.onError=function(b,n,g){console.log("error")};const f=d.addTextureTask("face normal","../dist/obj/head3d.png");f.onSuccess=function(b){a.normalTexture=b.texture};const l=d.addTextureTask("face psycho","../dist/obj/head3d_psycho.png");l.onSuccess=function(b){a.psychoTexture=b.texture},d.onFinish=b=>{a.state.engine.runRenderLoop(()=>{a.state.scene.render()})},window.setTimeout(()=>{d.load()},1000)};this.state={currentRoot:window.location.pathname.substr(1),engine:null,scene:null,camera:null,gyroscopeActive:!1,orientationPermission:!1,stare:!1,headLoaded:!1,hasGyroscope:typeof DeviceOrientationEvent!=="undefined"&&DeviceOrientationEvent.requestPermission||navigator.userAgent.match("CriOS")||navigator.userAgent.match("iPhone")}}componentDidMount(){const a=new Ca.Engine(document.getElementById("head"),!0),d=new Ca.Scene(a);d.clearColor=new Ca.Color4(0,0,0,0);const c=new Ca.UniversalCamera("camera",new Ca.Vector3(0,0,500),d);c.setTarget(Ca.Vector3.Zero()),c.lowerRadiusLimit=400,c.upperRadiusLimit=400;const f=new Ca.HemisphericLight("hemisphericLight",new Ca.Vector3(0,200,0),d);f.groundColor=new Ca.Color3(1,1,1),f.diffuse=new Ca.Color3(1,1,1);const l=1,b=new Ca.SpotLight("spotLightFront",new Ca.Vector3(0,0,400),new Ca.Vector3(0,0,0),Math.PI*2,0,d);b.intensity=l;const n=new Ca.SpotLight("spotLightLeft",new Ca.Vector3(400,-200,100),new Ca.Vector3(0,0,0),Math.PI*2,0,d);n.intensity=l;const g=new Ca.SpotLight("spotLightRight",new Ca.Vector3(-400,-200,100),new Ca.Vector3(0,0,0),Math.PI*2,0,d);g.intensity=l;const i=new Ca.SpotLight("spotLightLower",new Ca.Vector3(0,-200,200),new Ca.Vector3(0,0,0),Math.PI*2,0,d);i.intensity=l,this.state.hasGyroscope&&(f.intensity=2,b.position.z=300,n.position.x=300,g.position.x=-300),this.setState({engine:a,scene:d,camera:c,hemisphericLight:f,spotLightFront:b,spotLightLeft:n,spotLightRight:g,spotLightLower:i},()=>{this.loadObjects(),this.bindEvents(),this.state.engine.runRenderLoop(()=>{this.state.scene.render()})})}render(){const a=this.state.currentRoot.length===0&&!this.state.headLoaded;return za.default.createElement(za.Fragment,null,za.default.createElement("canvas",{id:"head",width:"1500",height:"1500"}),a?za.default.createElement("div",{className:"head__loader"}):null)}}const R=Q;const Ga=p$(385),Ha=p$(379);class $ extends Ga.Component{componentDidMount(){this.props.setCurrentRoot(this.props.location.pathname)}render(){return Ga.default.createElement("section",{className:"home"},Ga.default.createElement("div",{className:"home__text"},Ga.default.createElement("h1",{className:"home__name"},"Cyrill Lehmann"),Ga.default.createElement("h2",{className:"home__position"},"Web Developer")),Ga.default.createElement(Ha.Link,{to:"/who",className:"button home__anchorWho",onClick:a=>this.props.gace(a,"who")},"who"),Ga.default.createElement("a",{target:"__blank",rel:"noopener",href:"https://cyrill-lehmann.ch/tutorials",className:"button home__anchorTutorials",onClick:a=>this.props.gace(a,"tutorials")},"tutorials"),Ga.default.createElement(Ha.Link,{to:"/what",className:"button home__anchorWhat",onClick:a=>this.props.gace(a,"what")},"what"))}}const aa=Ha.withRouter($);const ab=p$(385),bb=p$(379);class ka extends ab.Component{componentDidMount(){this.props.setCurrentRoot(this.props.location.pathname)}render(){return ab.default.createElement("section",{className:"who"},ab.default.createElement(bb.Link,{to:"/",className:"button who__anchorBack",onClick:a=>this.props.gace(a,"home")},"back"),ab.default.createElement("ul",{className:"who__list"},ab.default.createElement("li",{className:"who__listEntry"},"based in chur, switzerland"),ab.default.createElement("li",{className:"who__listEntry"},"spending most of my days at"," ",ab.default.createElement("a",{href:"https://clus.ch",rel:"noopener",target:"__blank",onClick:a=>this.props.gace(a,"clus.ch")},"clus.ch")),ab.default.createElement("li",{className:"who__listEntry"},"doing my own thing under Lehmann Webentwicklung"),ab.default.createElement("li",{className:"who__listEntry"},"been having fun with django, laravel, css, react, babylon, raspberrypi,",ab.default.createElement("br",null),"wordpress, processwire, codeigniter, three and other stuff"),ab.default.createElement("li",{className:"who__listEntry"},"interested in skis, salad, cheese, aquaponics and even more"),ab.default.createElement("li",{className:"who__listEntry"},"fluent in (swiss-)german, english and mandarin"),ab.default.createElement("li",{className:"who__listEntry"},"feel free to reach out")),ab.default.createElement("ul",{className:"home__contactList"},ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://github.com/adabs-urdum",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"github")},"github")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://codepen.io/adabs-urdum",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"codepen")},"codepen")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"mailto:cyrill@adabs.ch",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"mail")},"email")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://www.instagram.com/adabs_urdum/",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"instagram")},"instagram")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://www.linkedin.com/in/adabs-urdum",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"linkedin")},"linkedin")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://www.patreon.com/user/creators?u=5977648",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"patreon")},"patreon")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://www.udemy.com/user/cyrill-lehmann/",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"udemy")},"udemy")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://cssbattle.dev/player/adabs",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"cssbattle")},"cssbattle"))))}}const la=bb.withRouter(ka);const Ra=p$(385),Sa=p$(379);class ea extends Ra.Component{constructor(a){super(a);this.onFilterChange=a=>{this.setState({currentFilter:a.currentTarget.value})};this.state={ready:!1,projects:a.projects,tags:a.tags,currentFilter:"all"}}componentDidMount(){this.props.setCurrentRoot(this.props.location.pathname)}componentDidUpdate(){this.props.projects&&!this.state.ready&&window.setTimeout(()=>{this.setState({ready:!0})},200)}render(){const a=this.props.tags?this.props.tags.map(c=>Ra.default.createElement("label",{className:"what__tagListLabel",key:c,onClick:f=>this.props.gace(f,`filter ${c}`)},Ra.default.createElement("input",{className:"what__tagListInput",type:"radio",name:"tagListFilter",value:c,onChange:this.onFilterChange}),Ra.default.createElement("span",{className:"button what__tagListFilter"},c))):null;a&&a.unshift(Ra.default.createElement("label",{className:"what__tagListLabel",key:"all",onClick:c=>this.props.gace(c,"filter all")},Ra.default.createElement("input",{className:"what__tagListInput",type:"radio",name:"tagListFilter",value:"all",onChange:this.onFilterChange,defaultChecked:!0}),Ra.default.createElement("span",{className:"button what__tagListFilter"},"All")));const d=this.props.projects?this.props.projects.map(c=>{const f=c.tags.map(l=>Ra.default.createElement("li",{className:"what__tagListEntry",key:l.replace(" ","")},l));if(this.state.currentFilter=="all"||c.tags.includes(this.state.currentFilter))return Ra.default.createElement("li",{className:"what__listEntry",key:c.name.replace(" ","")},Ra.default.createElement("canvas",{className:"what__canvas",width:"16",height:"9"}),Ra.default.createElement("a",{className:"what__project",target:"__blank",rel:"noopener",href:c.link,onClick:l=>this.props.gace(l,c.name)},Ra.default.createElement("img",{className:"what__projectImage",src:c.imageSrc,srcSet:c.imageSrcset,sizes:"(max-width: 500px) 80vw, 70vw"}),Ra.default.createElement("div",{className:"what__projectContent"},Ra.default.createElement("h2",{className:"what__projectName"},c.name),Ra.default.createElement("p",{className:"what__projectDescription"},c.description),Ra.default.createElement("ul",{className:"what__tagList"},f))))}):null;return Ra.default.createElement("section",{className:"what"},Ra.default.createElement(Sa.Link,{to:"/",className:"button what__anchorBack",onClick:c=>this.props.gace(c,"home")},"back"),Ra.default.createElement("ul",{className:this.state.ready?"what__list ready":"what__list"},Ra.default.createElement("li",{className:"what__listEntry what__listEntry--filter"},a),d))}}const fa=Sa.withRouter(ea);const lb=p$(6),mb=p$(385),nb=p$(379);class ra extends mb.Component{constructor(a){super(a);this.setCurrentRoot=a=>{a=a.replace("/",""),this.setState({currentRoot:a},()=>{this.state.body.classList=this.state.currentRoot})};this.setPsychoMode=()=>{this.setState({psychoMode:!this.state.psychoMode},()=>{const a=this.state.psychoMode?"psycho":"";this.state.html.classList=a})};this.gace=(a,d)=>{ga("send","event","link","click",d,d)};this.state={currentRoot:"",psychoMode:!1,body:document.getElementById("body"),html:document.getElementById("html"),isIeEdge:document.documentMode||/Edge\//.test(navigator.userAgent),projects:null,projectsReady:!1}}componentDidMount(){const a=window.location.hostname=="localhost"?"https://api.adabs.ch.test":"https://api.adabs.ch";lb.default.get(a+"/projects/").then(d=>{const c=d.data.projects,f=[];c.forEach(b=>{f.push({name:b.title,tags:b.tags,description:b.description,link:b.linkout,imageSrc:b.image.url,imageSrcset:b.image.srcset})});const l=f.length?[...new Set(f.map(b=>b.tags).flat())].sort((b,n)=>b>n?1:n>b?-1:0):null;this.setState({projects:f,projectTags:l,projectsReady:!0})})}render(){const a=mb.default.createElement("h3",{className:"internetExplorerWarning"},"why don't you use a good browser. like chrome or something.");return mb.default.createElement(mb.Fragment,null,this.state.isIeEdge?a:null,mb.default.createElement(nb.BrowserRouter,null,mb.default.createElement(nb.Switch,null,mb.default.createElement(nb.Route,{path:"/who",render:()=>mb.default.createElement(la,{setCurrentRoot:this.setCurrentRoot,gace:this.gace})}),mb.default.createElement(nb.Route,{path:"/what",render:()=>mb.default.createElement(fa,{setCurrentRoot:this.setCurrentRoot,projects:this.state.projects,tags:this.state.projectTags,ready:this.state.projectsReady,gace:this.gace})}),mb.default.createElement(nb.Route,{path:"/",render:()=>mb.default.createElement(aa,{setCurrentRoot:this.setCurrentRoot,gace:this.gace})}))),mb.default.createElement(R,{psychoMode:this.state.psychoMode,setPsychoMode:this.setPsychoMode}))}}const sa=ra;const Bb=p$(385),Cb=p$(375);"use strict";Array.prototype.getRandomValue=a=>a[Math.floor(Math.random()*a.length)],document.addEventListener("DOMContentLoaded",function(){Cb.default.render(Bb.default.createElement(sa,null),document.getElementById("root"))})},370(o,j){"use strict";var i=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;function m(c){if(c===null||c===void 0)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(c)}function n(){try{if(!Object.assign)return!1;var c=new String("abc");c[5]="de";if(Object.getOwnPropertyNames(c)[0]==="5")return!1;for(var g={},a=0;a<10;a++)g["_"+String.fromCharCode(a)]=a;var e=Object.getOwnPropertyNames(g).map(function(b){return g[b]});if(e.join("")!=="0123456789")return!1;var d={};return"abcdefghijklmnopqrst".split("").forEach(function(b){d[b]=b}),Object.keys(Object.assign({},d)).join("")!=="abcdefghijklmnopqrst"?!1:!0}catch(b){return!1}}j.exports=n()?Object.assign:function(c,g){for(var a,e=m(c),d,b=1;b<arguments.length;b++){a=Object(arguments[b]);for(var h in a)k.call(a,h)&&(e[h]=a[h]);if(i){d=i(a);for(var f=0;f<d.length;f++)l.call(a,d[f])&&(e[d[f]]=a[d[f]])}}return e}},384(ba,O){"use strict";var q=k$(370),h="function"===typeof Symbol&&Symbol.for,n=h?Symbol.for("react.element"):60103,P=h?Symbol.for("react.portal"):60106,Q=h?Symbol.for("react.fragment"):60107,R=h?Symbol.for("react.strict_mode"):60108,S=h?Symbol.for("react.profiler"):60114,T=h?Symbol.for("react.provider"):60109,U=h?Symbol.for("react.context"):60110,V=h?Symbol.for("react.forward_ref"):60112,W=h?Symbol.for("react.suspense"):60113;h&&Symbol.for("react.suspense_list");var X=h?Symbol.for("react.memo"):60115,Y=h?Symbol.for("react.lazy"):60116;h&&Symbol.for("react.fundamental"),h&&Symbol.for("react.responder"),h&&Symbol.for("react.scope");var z="function"===typeof Symbol&&Symbol.iterator;function o(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},B={};function m(a,b,c){this.props=a,this.context=b,this.refs=B,this.updater=c||A}m.prototype.isReactComponent={},m.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(o(85));this.updater.enqueueSetState(this,a,b,"setState")},m.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};function C(){}C.prototype=m.prototype;function r(a,b,c){this.props=a,this.context=b,this.refs=B,this.updater=c||A}var s=r.prototype=new C();s.constructor=r,q(s,m.prototype),s.isPureReactComponent=!0;var D={current:null},t={current:null},E=Object.prototype.hasOwnProperty,F={key:!0,ref:!0,__self:!0,__source:!0};function G(a,b,c){var e,d={},g=null,j=null;if(null!=b)for(e in void 0!==b.ref&&(j=b.ref),void 0!==b.key&&(g=""+b.key),b)E.call(b,e)&&!F.hasOwnProperty(e)&&(d[e]=b[e]);var f=arguments.length-2;if(1===f)d.children=c;else if(1<f){for(var i=Array(f),l=0;l<f;l++)i[l]=arguments[l+2];d.children=i}if(a&&a.defaultProps)for(e in f=a.defaultProps,f)void 0===d[e]&&(d[e]=f[e]);return{$$typeof:n,type:a,key:g,ref:j,props:d,_owner:t.current}}function Z(a,b){return{$$typeof:n,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function u(a){return"object"===typeof a&&null!==a&&a.$$typeof===n}function _(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(c){return b[c]})}var H=/\/+/g,p=[];function I(a,b,c,e){if(p.length){var d=p.pop();return d.result=a,d.keyPrefix=b,d.func=c,d.context=e,d.count=0,d}return{result:a,keyPrefix:b,func:c,context:e,count:0}}function J(a){a.result=null,a.keyPrefix=null,a.func=null,a.context=null,a.count=0,10>p.length&&p.push(a)}function v(a,b,c,e){var d=typeof a;("undefined"===d||"boolean"===d)&&(a=null);var g=!1;if(null===a)g=!0;else switch(d){case"string":case"number":g=!0;break;case"object":switch(a.$$typeof){case n:case P:g=!0}}if(g)return c(e,a,""===b?"."+x(a,0):b),1;g=0,b=""===b?".":b+":";if(Array.isArray(a))for(var j=0;j<a.length;j++){d=a[j];var f=b+x(d,j);g+=v(d,f,c,e)}else if(null===a||"object"!==typeof a?f=null:(f=z&&a[z]||a["@@iterator"],f="function"===typeof f?f:null),"function"===typeof f)for(a=f.call(a),j=0;!(d=a.next()).done;)d=d.value,f=b+x(d,j++),g+=v(d,f,c,e);else if("object"===d)throw c=""+a,Error(o(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return g}function w(a,b,c){return null==a?0:v(a,"",b,c)}function x(a,b){return"object"===typeof a&&null!==a&&null!=a.key?_(a.key):b.toString(36)}function $(a,b){a.func.call(a.context,b,a.count++)}function aa(a,b,c){var e=a.result,d=a.keyPrefix;a=a.func.call(a.context,b,a.count++),Array.isArray(a)?y(a,e,c,function(g){return g}):null!=a&&(u(a)&&(a=Z(a,d+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(H,"$&/")+"/")+c)),e.push(a))}function y(a,b,c,e,d){var g="";null!=c&&(g=(""+c).replace(H,"$&/")+"/"),b=I(b,g,e,d),w(a,aa,b),J(b)}function k(){var a=D.current;if(null===a)throw Error(o(321));return a}var K={Children:{map:function(a,b,c){if(null==a)return a;var e=[];return y(a,e,null,b,c),e},forEach:function(a,b,c){if(null==a)return a;b=I(null,null,b,c),w(a,$,b),J(b)},count:function(a){return w(a,function(){return null},null)},toArray:function(a){var b=[];return y(a,b,null,function(c){return c}),b},only:function(a){if(!u(a))throw Error(o(143));return a}},createRef:function(){return{current:null}},Component:m,PureComponent:r,createContext:function(a,b){return void 0===b&&(b=null),a={$$typeof:U,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null},a.Provider={$$typeof:T,_context:a},a.Consumer=a},forwardRef:function(a){return{$$typeof:V,render:a}},lazy:function(a){return{$$typeof:Y,_ctor:a,_status:-1,_result:null}},memo:function(a,b){return{$$typeof:X,type:a,compare:void 0===b?null:b}},useCallback:function(a,b){return k().useCallback(a,b)},useContext:function(a,b){return k().useContext(a,b)},useEffect:function(a,b){return k().useEffect(a,b)},useImperativeHandle:function(a,b,c){return k().useImperativeHandle(a,b,c)},useDebugValue:function(){},useLayoutEffect:function(a,b){return k().useLayoutEffect(a,b)},useMemo:function(a,b){return k().useMemo(a,b)},useReducer:function(a,b,c){return k().useReducer(a,b,c)},useRef:function(a){return k().useRef(a)},useState:function(a){return k().useState(a)},Fragment:Q,Profiler:S,StrictMode:R,Suspense:W,createElement:G,cloneElement:function(a,b,c){if(null===a||void 0===a)throw Error(o(267,a));var e=q({},a.props),d=a.key,g=a.ref,j=a._owner;if(null!=b){void 0!==b.ref&&(g=b.ref,j=t.current),void 0!==b.key&&(d=""+b.key);if(a.type&&a.type.defaultProps)var f=a.type.defaultProps;for(i in b)E.call(b,i)&&!F.hasOwnProperty(i)&&(e[i]=void 0===b[i]&&void 0!==f?f[i]:b[i])}var i=arguments.length-2;if(1===i)e.children=c;else if(1<i){f=Array(i);for(var l=0;l<i;l++)f[l]=arguments[l+2];e.children=f}return{$$typeof:n,type:a.type,key:d,ref:g,props:e,_owner:j}},createFactory:function(a){var b=G.bind(null,a);return b.type=a,b},isValidElement:u,version:"16.11.0",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:D,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:t,IsSomeRendererActing:{current:!1},assign:q}},L={default:K},M=L&&K||L;O.exports=M.default||M},385(c,b){"use strict";b.exports=k$(384)},389(c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var o,q,u,v,C;if("undefined"===typeof window||"function"!==typeof MessageChannel){var r=null,J=null,K=function(){if(null!==r)try{var a=c.unstable_now();r(!0,a),r=null}catch(b){throw setTimeout(K,0),b}},Q=Date.now();c.unstable_now=function(){return Date.now()-Q},o=function(a){null!==r?setTimeout(o,0,a):(r=a,setTimeout(K,0))},q=function(a,b){J=setTimeout(a,b)},u=function(){clearTimeout(J)},v=function(){return!1},C=c.unstable_forceFrameRate=function(){}}else{var D=window.performance,L=window.Date,R=window.setTimeout,S=window.clearTimeout,T=window.requestAnimationFrame,U=window.cancelAnimationFrame;"undefined"!==typeof console&&("function"!==typeof T&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof U&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof D&&"function"===typeof D.now)c.unstable_now=function(){return D.now()};else{var V=L.now();c.unstable_now=function(){return L.now()-V}}var w=!1,x=null,E=-1,M=5,N=0;v=function(){return c.unstable_now()>=N},C=function(){},c.unstable_forceFrameRate=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):M=0<a?Math.floor(1000/a):33.33};var O=new MessageChannel(),F=O.port2;O.port1.onmessage=function(){if(null!==x){var a=c.unstable_now();N=a+M;try{x(!0,a)?F.postMessage(null):(w=!1,x=null)}catch(b){throw F.postMessage(null),b}}else w=!1},o=function(a){x=a,w||(w=!0,F.postMessage(null))},q=function(a,b){E=R(function(){a(c.unstable_now())},b)},u=function(){S(E),E=-1}}function G(a,b){var d=a.length;a.push(b);c:for(;;){var e=Math.floor((d-1)/2),f=a[e];if(void 0!==f&&0<z(f,b))a[e]=b,a[d]=f,d=e;else break c}}function i(a){return a=a[0],void 0===a?null:a}function y(a){var b=a[0];if(void 0!==b){var d=a.pop();if(d!==b){a[0]=d;c:for(var e=0,f=a.length;e<f;){var m=2*(e+1)-1,n=a[m],t=m+1,p=a[t];if(void 0!==n&&0>z(n,d))void 0!==p&&0>z(p,n)?(a[e]=p,a[t]=d,e=t):(a[e]=n,a[m]=d,e=m);else if(void 0!==p&&0>z(p,d))a[e]=p,a[t]=d,e=t;else break c}}return b}return null}function z(a,b){var d=a.sortIndex-b.sortIndex;return 0!==d?d:a.id-b.id}var j=[],k=[],W=1,h=null,g=3,A=!1,l=!1,s=!1;function B(a){for(var b=i(k);null!==b;){if(null===b.callback)y(k);else if(b.startTime<=a)y(k),b.sortIndex=b.expirationTime,G(j,b);else break;b=i(k)}}function H(a){s=!1,B(a);if(!l)if(null!==i(j))l=!0,o(I);else{var b=i(k);null!==b&&q(H,b.startTime-a)}}function I(a,b){l=!1,s&&(s=!1,u()),A=!0;var d=g;try{for(B(b),h=i(j);null!==h&&(!(h.expirationTime>b)||a&&!v());){var e=h.callback;if(null!==e){h.callback=null,g=h.priorityLevel;var f=e(h.expirationTime<=b);b=c.unstable_now(),"function"===typeof f?h.callback=f:h===i(j)&&y(j),B(b)}else y(j);h=i(j)}if(null!==h)var m=!0;else{var n=i(k);null!==n&&q(H,n.startTime-b),m=!1}return m}finally{h=null,g=d,A=!1}}function P(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 10000;default:return 5000}}var X=C;c.unstable_ImmediatePriority=1,c.unstable_UserBlockingPriority=2,c.unstable_NormalPriority=3,c.unstable_IdlePriority=5,c.unstable_LowPriority=4,c.unstable_runWithPriority=function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var d=g;g=a;try{return b()}finally{g=d}},c.unstable_next=function(a){switch(g){case 1:case 2:case 3:var b=3;break;default:b=g}var d=g;g=b;try{return a()}finally{g=d}},c.unstable_scheduleCallback=function(a,b,d){var e=c.unstable_now();if("object"===typeof d&&null!==d){var f=d.delay;f="number"===typeof f&&0<f?e+f:e,d="number"===typeof d.timeout?d.timeout:P(a)}else d=P(a),f=e;return d=f+d,a={id:W++,callback:b,priorityLevel:a,startTime:f,expirationTime:d,sortIndex:-1},f>e?(a.sortIndex=f,G(k,a),null===i(j)&&a===i(k)&&(s?u():s=!0,q(H,f-e))):(a.sortIndex=d,G(j,a),l||A||(l=!0,o(I))),a},c.unstable_cancelCallback=function(a){a.callback=null},c.unstable_wrapCallback=function(a){var b=g;return function(){var d=g;g=b;try{return a.apply(this,arguments)}finally{g=d}}},c.unstable_getCurrentPriorityLevel=function(){return g},c.unstable_shouldYield=function(){var a=c.unstable_now();B(a);var b=i(j);return b!==h&&null!==h&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<h.expirationTime||v()},c.unstable_requestPaint=X,c.unstable_continueExecution=function(){l||A||(l=!0,o(I))},c.unstable_pauseExecution=function(){},c.unstable_getFirstCallbackNode=function(){return i(j)},c.unstable_Profiling=null},390(c,b){"use strict";b.exports=k$(389)},374(s,Bi){"use strict";var oc=k$(385),O=k$(370),E=k$(390);function p(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!oc)throw Error(p(227));var pc=null,db={};function uf(){if(pc)for(var a in db){var b=db[a],c=pc.indexOf(a);if(!(-1<c))throw Error(p(96,a));if(!qc[c]){if(!b.extractEvents)throw Error(p(97,a));qc[c]=b,c=b.eventTypes;for(var d in c){var e,f=c[d],g=b,h=d;if(vd.hasOwnProperty(h))throw Error(p(99,h));vd[h]=f;var i=f.phasedRegistrationNames;if(i){for(e in i)i.hasOwnProperty(e)&&vf(i[e],g,h);e=!0}else f.registrationName?(vf(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(p(98,d,a))}}}}function vf(a,b,c){if(eb[a])throw Error(p(100,a));eb[a]=b,wd[a]=b.eventTypes[c].dependencies}var qc=[],vd={},eb={},wd={};function Ci(a,b,c,d,e,f,g,h,i){var k=Array.prototype.slice.call(arguments,3);try{b.apply(c,k)}catch(q){this.onError(q)}}var Db=!1,rc=null,sc=!1,xd=null,Di={onError:function(a){Db=!0,rc=a}};function Ei(a,b,c,d,e,f,g,h,i){Db=!1,rc=null,Ci.apply(Di,arguments)}function Fi(a,b,c,d,e,f,g,h,i){Ei.apply(this,arguments);if(Db){if(Db){var k=rc;Db=!1,rc=null}else throw Error(p(198));sc||(sc=!0,xd=k)}}var yd=null,wf=null,xf=null;function yf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=xf(c),Fi(d,b,void 0,a),a.currentTarget=null}function fb(a,b){if(null==b)throw Error(p(30));return null==a?b:Array.isArray(a)?Array.isArray(b)?(a.push.apply(a,b),a):(a.push(b),a):Array.isArray(b)?[a].concat(b):[a,b]}function zd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}var Eb=null;function Gi(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)yf(a,b[d],c[d]);else b&&yf(a,b,c);a._dispatchListeners=null,a._dispatchInstances=null,a.isPersistent()||a.constructor.release(a)}}function tc(a){null!==a&&(Eb=fb(Eb,a)),a=Eb,Eb=null;if(a){zd(a,Gi);if(Eb)throw Error(p(95));if(sc)throw a=xd,sc=!1,xd=null,a}}var Ad={injectEventPluginOrder:function(a){if(pc)throw Error(p(101));pc=Array.prototype.slice.call(a),uf()},injectEventPluginsByName:function(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!db.hasOwnProperty(c)||db[c]!==d){if(db[c])throw Error(p(102,c));db[c]=d,b=!0}}b&&uf()}};function zf(a,b){var c=a.stateNode;if(!c)return null;var d=yd(c);if(!d)return null;c=d[b];s:switch(b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":(d=!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a)),a=!d;break s;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(p(231,b,typeof c));return c}var aa=oc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;aa.hasOwnProperty("ReactCurrentDispatcher")||(aa.ReactCurrentDispatcher={current:null}),aa.hasOwnProperty("ReactCurrentBatchConfig")||(aa.ReactCurrentBatchConfig={suspense:null});var Hi=/^(.*)[\\\/]/,M="function"===typeof Symbol&&Symbol.for,uc=M?Symbol.for("react.element"):60103,gb=M?Symbol.for("react.portal"):60106,ya=M?Symbol.for("react.fragment"):60107,Af=M?Symbol.for("react.strict_mode"):60108,vc=M?Symbol.for("react.profiler"):60114,Bf=M?Symbol.for("react.provider"):60109,Cf=M?Symbol.for("react.context"):60110,Ii=M?Symbol.for("react.concurrent_mode"):60111,Bd=M?Symbol.for("react.forward_ref"):60112,wc=M?Symbol.for("react.suspense"):60113,Cd=M?Symbol.for("react.suspense_list"):60120,Dd=M?Symbol.for("react.memo"):60115,Df=M?Symbol.for("react.lazy"):60116;M&&Symbol.for("react.fundamental"),M&&Symbol.for("react.responder"),M&&Symbol.for("react.scope");var Ef="function"===typeof Symbol&&Symbol.iterator;function Fb(a){return null===a||"object"!==typeof a?null:(a=Ef&&a[Ef]||a["@@iterator"],"function"===typeof a?a:null)}function Ji(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b(),a._result=b,b.then(function(c){0===a._status&&(c=c.default,a._status=1,a._result=c)},function(c){0===a._status&&(a._status=2,a._result=c)})}}function za(a){if(null==a)return null;if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case ya:return"Fragment";case gb:return"Portal";case vc:return"Profiler";case Af:return"StrictMode";case wc:return"Suspense";case Cd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Cf:return"Context.Consumer";case Bf:return"Context.Provider";case Bd:var b=a.render;return b=b.displayName||b.name||"",a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Dd:return za(a.type);case Df:if(a=1===a._status?a._result:null)return za(a)}return null}function Ed(a){var b="";do{s:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break s;default:var d=a._debugOwner,e=a._debugSource,f=za(a.type);c=null,d&&(c=za(d.type)),d=f,f="",e?f=" (at "+e.fileName.replace(Hi,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")"),c=`
    in `+(d||"Unknown")+f}b+=c,a=a.return}while(a);return b}var Aa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Fd=null,hb=null,ib=null;function Ff(a){if(a=wf(a)){if("function"!==typeof Fd)throw Error(p(280));var b=yd(a.stateNode);Fd(a.stateNode,a.type,b)}}function Gf(a){hb?ib?ib.push(a):ib=[a]:hb=a}function Hf(){if(hb){var a=hb,b=ib;ib=hb=null,Ff(a);if(b)for(a=0;a<b.length;a++)Ff(b[a])}}function Gd(a,b){return a(b)}function If(a,b,c,d){return a(b,c,d)}function Hd(){}var Jf=Gd,Ra=!1,Id=!1;function Jd(){(null!==hb||null!==ib)&&(Hd(),Hf())}new Map();var Ki=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Kf=Object.prototype.hasOwnProperty,Lf={},Mf={};function Li(a){return Kf.call(Mf,a)?!0:Kf.call(Lf,a)?!1:Ki.test(a)?Mf[a]=!0:(Lf[a]=!0,!1)}function Mi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case"function":case"symbol":return!0;case"boolean":return d?!1:null!==c?!c.acceptsBooleans:(a=a.toLowerCase().slice(0,5),"data-"!==a&&"aria-"!==a);default:return!1}}function Ni(a,b,c,d){if(null===b||"undefined"===typeof b||Mi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function P(a,b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b,this.attributeName=d,this.attributeNamespace=e,this.mustUseProperty=c,this.propertyName=a,this.type=b,this.sanitizeURL=f}var L={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){L[a]=new P(a,0,!1,a,null,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];L[b]=new P(b,1,!1,a[1],null,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){L[a]=new P(a,2,!1,a.toLowerCase(),null,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){L[a]=new P(a,2,!1,a,null,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){L[a]=new P(a,3,!1,a.toLowerCase(),null,!1)}),["checked","multiple","muted","selected"].forEach(function(a){L[a]=new P(a,3,!0,a,null,!1)}),["capture","download"].forEach(function(a){L[a]=new P(a,4,!1,a,null,!1)}),["cols","rows","size","span"].forEach(function(a){L[a]=new P(a,6,!1,a,null,!1)}),["rowSpan","start"].forEach(function(a){L[a]=new P(a,5,!1,a.toLowerCase(),null,!1)});var Kd=/[\-:]([a-z])/g;function Ld(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=a.replace(Kd,Ld);L[b]=new P(b,1,!1,a,null,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(Kd,Ld);L[b]=new P(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(Kd,Ld);L[b]=new P(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)}),["tabIndex","crossOrigin"].forEach(function(a){L[a]=new P(a,1,!1,a.toLowerCase(),null,!1)}),L.xlinkHref=new P("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach(function(a){L[a]=new P(a,1,!1,a.toLowerCase(),null,!0)});function Ba(a){switch(typeof a){case"boolean":case"number":case"object":case"string":case"undefined":return a;default:return""}}function Md(a,b,c,d){var e=L.hasOwnProperty(b)?L[b]:null,f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(Ni(b,c,e,d)&&(c=null),d||null===e?Li(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function Nf(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function Oi(a){var b=Nf(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;return Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(g){d=""+g,f.call(this,g)}}),Object.defineProperty(a,b,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(g){d=""+g},stopTracking:function(){a._valueTracker=null,delete a[b]}}}}function xc(a){a._valueTracker||(a._valueTracker=Oi(a))}function Of(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue(),d="";return a&&(d=Nf(a)?a.checked?"true":"false":a.value),a=d,a!==c?(b.setValue(a),!0):!1}function Nd(a,b){var c=b.checked;return O({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=c?c:a._wrapperState.initialChecked})}function Pf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=Ba(null!=b.value?b.value:c),a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function Qf(a,b){b=b.checked,null!=b&&Md(a,"checked",b,!1)}function Od(a,b){Qf(a,b);var c=Ba(b.value),d=b.type;if(null!=c)"number"===d?(0===c&&""===a.value||a.value!=c)&&(a.value=""+c):a.value!==""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Pd(a,b.type,c):b.hasOwnProperty("defaultValue")&&Pd(a,b.type,Ba(b.defaultValue)),null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Rf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue,c||b===a.value||(a.value=b),a.defaultValue=b}c=a.name,""!==c&&(a.name=""),a.defaultChecked=!a.defaultChecked,a.defaultChecked=!!a._wrapperState.initialChecked,""!==c&&(a.name=c)}function Pd(a,b,c){("number"!==b||a.ownerDocument.activeElement!==a)&&(null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c))}function Pi(a){var b="";return oc.Children.forEach(a,function(c){null!=c&&(b+=c)}),b}function Qd(a,b){return a=O({children:void 0},b),(b=Pi(b.children))&&(a.children=b),a}function jb(a,b,c,d){a=a.options;if(b){b={};for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{for(c=""+Ba(c),b=null,e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0,d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Rd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(p(91));return O({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Sf(a,b){var c=b.value;if(null==c){c=b.defaultValue,b=b.children;if(null!=b){if(null!=c)throw Error(p(92));if(Array.isArray(b)){if(!(1>=b.length))throw Error(p(93));b=b[0]}c=b}null==c&&(c="")}a._wrapperState={initialValue:Ba(c)}}function Tf(a,b){var c=Ba(b.value),d=Ba(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c)),null!=d&&(a.defaultValue=""+d)}function Uf(a){var b=a.textContent;b===a._wrapperState.initialValue&&""!==b&&null!==b&&(a.value=b)}var Sd={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function Vf(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Td(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Vf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}var yc,Wf=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if(a.namespaceURI!==Sd.svg||"innerHTML"in a)a.innerHTML=b;else{for(yc=yc||document.createElement("div"),yc.innerHTML="<svg>"+b.valueOf().toString()+"</svg>",b=yc.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}});function Gb(a,b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b}function zc(a,b){var c={};return c[a.toLowerCase()]=b.toLowerCase(),c["Webkit"+a]="webkit"+b,c["Moz"+a]="moz"+b,c}var kb={animationend:zc("Animation","AnimationEnd"),animationiteration:zc("Animation","AnimationIteration"),animationstart:zc("Animation","AnimationStart"),transitionend:zc("Transition","TransitionEnd")},Ud={},Xf={};Aa&&(Xf=document.createElement("div").style,"AnimationEvent"in window||(delete kb.animationend.animation,delete kb.animationiteration.animation,delete kb.animationstart.animation),"TransitionEvent"in window||delete kb.transitionend.transition);function Ac(a){if(Ud[a])return Ud[a];if(!kb[a])return a;var b=kb[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Xf)return Ud[a]=b[c];return a}var Yf=Ac("animationend"),Zf=Ac("animationiteration"),_f=Ac("animationstart"),$f=Ac("transitionend"),Hb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" ");function Sa(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function ag(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function bg(a){if(Sa(a)!==a)throw Error(p(188))}function Qi(a){var b=a.alternate;if(!b){b=Sa(a);if(null===b)throw Error(p(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return bg(e),a;if(f===d)return bg(e),b;f=f.sibling}throw Error(p(188))}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0,c=e,d=f;break}if(h===d){g=!0,d=e,c=f;break}h=h.sibling}if(!g){for(h=f.child;h;){if(h===c){g=!0,c=f,d=e;break}if(h===d){g=!0,d=f,c=e;break}h=h.sibling}if(!g)throw Error(p(189))}}if(c.alternate!==d)throw Error(p(190))}if(3!==c.tag)throw Error(p(188));return c.stateNode.current===c?a:b}function cg(a){a=Qi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}}return null}var dg,Vd,eg,Wd=!1,ga=[],Ca=null,Da=null,Ea=null,Ib=new Map(),Jb=new Map(),Kb=[],Xd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Ri="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Si(a){var b=fe(a);Xd.forEach(function(c){ge(c,a,b)}),Ri.forEach(function(c){ge(c,a,b)})}function Yd(a,b,c,d){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:d}}function fg(a,b){switch(a){case"focus":case"blur":Ca=null;break;case"dragenter":case"dragleave":Da=null;break;case"mouseover":case"mouseout":Ea=null;break;case"pointerover":case"pointerout":Ib.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jb.delete(b.pointerId)}}function Lb(a,b,c,d,e){return null===a||a.nativeEvent!==e?(a=Yd(b,c,d,e),null!==b&&(b=Sb(b),null!==b&&Vd(b)),a):(a.eventSystemFlags|=d,a)}function Ti(a,b,c,d){switch(b){case"focus":return Ca=Lb(Ca,a,b,c,d),!0;case"dragenter":return Da=Lb(Da,a,b,c,d),!0;case"mouseover":return Ea=Lb(Ea,a,b,c,d),!0;case"pointerover":var e=d.pointerId;return Ib.set(e,Lb(Ib.get(e)||null,a,b,c,d)),!0;case"gotpointercapture":return e=d.pointerId,Jb.set(e,Lb(Jb.get(e)||null,a,b,c,d)),!0}return!1}function Ui(a){var b=Rb(a.target);if(null!==b){var c=Sa(b);if(null!==c){if(b=c.tag,13===b){if(b=ag(c),null!==b){a.blockedOn=b,E.unstable_runWithPriority(a.priority,function(){eg(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=3===c.tag?c.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Bc(a){if(null!==a.blockedOn)return!1;var b=ee(a.topLevelType,a.eventSystemFlags,a.nativeEvent);if(null!==b){var c=Sb(b);return null!==c&&Vd(c),a.blockedOn=b,!1}return!0}function gg(a,b,c){Bc(a)&&c.delete(b)}function Vi(){for(Wd=!1;0<ga.length;){var a=ga[0];if(null!==a.blockedOn){a=Sb(a.blockedOn),null!==a&&dg(a);break}var b=ee(a.topLevelType,a.eventSystemFlags,a.nativeEvent);null!==b?a.blockedOn=b:ga.shift()}null!==Ca&&Bc(Ca)&&(Ca=null),null!==Da&&Bc(Da)&&(Da=null),null!==Ea&&Bc(Ea)&&(Ea=null),Ib.forEach(gg),Jb.forEach(gg)}function Mb(a,b){a.blockedOn===b&&(a.blockedOn=null,Wd||(Wd=!0,E.unstable_scheduleCallback(E.unstable_NormalPriority,Vi)))}function hg(a){function b(e){return Mb(e,a)}if(0<ga.length){Mb(ga[0],a);for(var c=1;c<ga.length;c++){var d=ga[c];d.blockedOn===a&&(d.blockedOn=null)}}for(null!==Ca&&Mb(Ca,a),null!==Da&&Mb(Da,a),null!==Ea&&Mb(Ea,a),Ib.forEach(b),Jb.forEach(b),c=0;c<Kb.length;c++)d=Kb[c],d.blockedOn===a&&(d.blockedOn=null);for(;0<Kb.length&&(c=Kb[0],null===c.blockedOn);)Ui(c),null===c.blockedOn&&Kb.shift()}function Zd(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),3===a.nodeType?a.parentNode:a}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function ig(a,b,c){(b=zf(a,c.dispatchConfig.phasedRegistrationNames[b]))&&(c._dispatchListeners=fb(c._dispatchListeners,b),c._dispatchInstances=fb(c._dispatchInstances,a))}function Wi(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)ig(c[b],"captured",a);for(b=0;b<c.length;b++)ig(c[b],"bubbled",a)}}function _d(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=zf(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=fb(c._dispatchListeners,b),c._dispatchInstances=fb(c._dispatchInstances,a))}function Xi(a){a&&a.dispatchConfig.registrationName&&_d(a._targetInst,null,a)}function lb(a){zd(a,Wi)}function Cc(){return!0}function Dc(){return!1}function U(a,b,c,d){this.dispatchConfig=a,this._targetInst=b,this.nativeEvent=c,a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);return this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?Cc:Dc,this.isPropagationStopped=Dc,this}O(U.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=Cc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=Cc)},persist:function(){this.isPersistent=Cc},isPersistent:Dc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Dc,this._dispatchInstances=this._dispatchListeners=null}}),U.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},U.extend=function(a){function b(){}function c(){return d.apply(this,arguments)}var d=this;b.prototype=d.prototype;var e=new b();return O(e,c.prototype),c.prototype=e,c.prototype.constructor=c,c.Interface=O({},d.Interface,a),c.extend=d.extend,jg(c),c},jg(U);function Yi(a,b,c,d){if(this.eventPool.length){var e=this.eventPool.pop();return this.call(e,a,b,c,d),e}return new this(a,b,c,d)}function Zi(a){if(!(a instanceof this))throw Error(p(279));a.destructor(),10>this.eventPool.length&&this.eventPool.push(a)}function jg(a){a.eventPool=[],a.getPooled=Yi,a.release=Zi}var _i=U.extend({animationName:null,elapsedTime:null,pseudoElement:null}),$i=U.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Nb=U.extend({view:null,detail:null}),aj=Nb.extend({relatedTarget:null});function Ec(a){var b=a.keyCode;return"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b,10===a&&(a=13),32<=a||13===a?a:0}var bj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ej(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=dj[a])?!!b[a]:!1}function $d(){return ej}for(var fj=Nb.extend({key:function(a){if(a.key){var b=bj[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ec(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?cj[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:$d,charCode:function(a){return"keypress"===a.type?Ec(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===a.type?Ec(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),kg=0,lg=0,mg=!1,ng=!1,Ob=Nb.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:$d,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=kg;return kg=a.screenX,mg?"mousemove"===a.type?a.screenX-b:0:(mg=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=lg;return lg=a.screenY,ng?"mousemove"===a.type?a.screenY-b:0:(ng=!0,0)}}),og=Ob.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),gj=Ob.extend({dataTransfer:null}),hj=Nb.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:$d}),ij=U.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),jj=Ob.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:null,deltaMode:null}),pg=[["blur","blur",0],["cancel","cancel",0],["click","click",0],["close","close",0],["contextmenu","contextMenu",0],["copy","copy",0],["cut","cut",0],["auxclick","auxClick",0],["dblclick","doubleClick",0],["dragend","dragEnd",0],["dragstart","dragStart",0],["drop","drop",0],["focus","focus",0],["input","input",0],["invalid","invalid",0],["keydown","keyDown",0],["keypress","keyPress",0],["keyup","keyUp",0],["mousedown","mouseDown",0],["mouseup","mouseUp",0],["paste","paste",0],["pause","pause",0],["play","play",0],["pointercancel","pointerCancel",0],["pointerdown","pointerDown",0],["pointerup","pointerUp",0],["ratechange","rateChange",0],["reset","reset",0],["seeked","seeked",0],["submit","submit",0],["touchcancel","touchCancel",0],["touchend","touchEnd",0],["touchstart","touchStart",0],["volumechange","volumeChange",0],["drag","drag",1],["dragenter","dragEnter",1],["dragexit","dragExit",1],["dragleave","dragLeave",1],["dragover","dragOver",1],["mousemove","mouseMove",1],["mouseout","mouseOut",1],["mouseover","mouseOver",1],["pointermove","pointerMove",1],["pointerout","pointerOut",1],["pointerover","pointerOver",1],["scroll","scroll",1],["toggle","toggle",1],["touchmove","touchMove",1],["wheel","wheel",1],["abort","abort",2],[Yf,"animationEnd",2],[Zf,"animationIteration",2],[_f,"animationStart",2],["canplay","canPlay",2],["canplaythrough","canPlayThrough",2],["durationchange","durationChange",2],["emptied","emptied",2],["encrypted","encrypted",2],["ended","ended",2],["error","error",2],["gotpointercapture","gotPointerCapture",2],["load","load",2],["loadeddata","loadedData",2],["loadedmetadata","loadedMetadata",2],["loadstart","loadStart",2],["lostpointercapture","lostPointerCapture",2],["playing","playing",2],["progress","progress",2],["seeking","seeking",2],["stalled","stalled",2],["suspend","suspend",2],["timeupdate","timeUpdate",2],[$f,"transitionEnd",2],["waiting","waiting",2]],qg={},ae={},be=0;be<pg.length;be++){var ce=pg[be],rg=ce[0],de=ce[1],kj=ce[2],sg="on"+(de[0].toUpperCase()+de.slice(1)),tg={phasedRegistrationNames:{bubbled:sg,captured:sg+"Capture"},dependencies:[rg],eventPriority:kj};qg[de]=tg,ae[rg]=tg}var ug={eventTypes:qg,getEventPriority:function(a){return a=ae[a],void 0!==a?a.eventPriority:2},extractEvents:function(a,b,c,d){var e=ae[a];if(!e)return null;switch(a){case"keypress":if(0===Ec(c))return null;case"keydown":case"keyup":a=fj;break;case"blur":case"focus":a=aj;break;case"click":if(2===c.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":a=Ob;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":a=gj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":a=hj;break;case Yf:case Zf:case _f:a=_i;break;case $f:a=ij;break;case"scroll":a=Nb;break;case"wheel":a=jj;break;case"copy":case"cut":case"paste":a=$i;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":a=og;break;default:a=U}return b=a.getPooled(e,b,c,d),lb(b),b}},lj=E.unstable_UserBlockingPriority,mj=E.unstable_runWithPriority,nj=ug.getEventPriority,oj=10,Fc=[];function pj(a){var b=a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag,5!==b&&6!==b||a.ancestors.push(c),c=Rb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Zd(a.nativeEvent);d=a.topLevelType;for(var f=a.nativeEvent,g=a.eventSystemFlags,h=null,i=0;i<qc.length;i++){var k=qc[i];k&&(k=k.extractEvents(d,b,f,e,g))&&(h=fb(h,k))}tc(h)}}var Gc=!0;function A(a,b){Pb(b,a,!1)}function Pb(a,b,c){switch(nj(b)){case 0:var d=qj.bind(null,b,1);break;case 1:d=rj.bind(null,b,1);break;default:d=Hc.bind(null,b,1)}c?a.addEventListener(b,d,!0):a.addEventListener(b,d,!1)}function qj(a,b,c){Ra||Hd();var d=Hc,e=Ra;Ra=!0;try{If(d,a,b,c)}finally{(Ra=e)||Jd()}}function rj(a,b,c){mj(lj,Hc.bind(null,a,b,c))}function vg(a,b,c,d){if(Fc.length){var e=Fc.pop();e.topLevelType=a,e.eventSystemFlags=b,e.nativeEvent=c,e.targetInst=d,a=e}else a={topLevelType:a,eventSystemFlags:b,nativeEvent:c,targetInst:d,ancestors:[]};try{if(b=pj,c=a,Id)b(c,void 0);else{Id=!0;try{Jf(b,c,void 0)}finally{Id=!1,Jd()}}}finally{a.topLevelType=null,a.nativeEvent=null,a.targetInst=null,a.ancestors.length=0,Fc.length<oj&&Fc.push(a)}}function Hc(a,b,c){if(Gc)if(0<ga.length&&-1<Xd.indexOf(a))a=Yd(null,a,b,c),ga.push(a);else{var d=ee(a,b,c);null===d?fg(a,c):-1<Xd.indexOf(a)?(a=Yd(d,a,b,c),ga.push(a)):Ti(d,a,b,c)||(fg(a,c),vg(a,b,c,null))}}function ee(a,b,c){var d=Zd(c);d=Rb(d);if(null!==d){var e=Sa(d);if(null===e)d=null;else{var f=e.tag;if(13===f){d=ag(e);if(null!==d)return d;d=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;d=null}else e!==d&&(d=null)}}return vg(a,b,c,d),null}function wg(a){if(!Aa)return!1;a="on"+a;var b=a in document;return b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]),b}var xg=new("function"===typeof WeakMap?WeakMap:Map)();function fe(a){var b=xg.get(a);return void 0===b&&(b=new Set(),xg.set(a,b)),b}function ge(a,b,c){if(!c.has(a)){switch(a){case"scroll":Pb(b,"scroll",!0);break;case"focus":case"blur":Pb(b,"focus",!0),Pb(b,"blur",!0),c.add("blur"),c.add("focus");break;case"cancel":case"close":wg(a)&&Pb(b,a,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Hb.indexOf(a)&&A(a,b)}c.add(a)}}var Qb={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sj=["Webkit","ms","Moz","O"];Object.keys(Qb).forEach(function(a){sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1),Qb[b]=Qb[a]})});function yg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Qb.hasOwnProperty(a)&&Qb[a]?(""+b).trim():b+"px"}function zg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=yg(c,b[c],d);"float"===c&&(c="cssFloat"),d?a.setProperty(c,e):a[c]=e}}var tj=O({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function he(a,b){if(b){if(tj[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(p(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(p(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(p(61))}if(null!=b.style&&"object"!==typeof b.style)throw Error(p(62,""))}}function ie(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function qa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=fe(a);b=wd[b];for(var d=0;d<b.length;d++)ge(b[d],a,c)}function Ic(){}function je(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function Ag(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Bg(a,b){var c=Ag(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,offset:b-a};a=d}s:{for(;c;){if(c.nextSibling){c=c.nextSibling;break s}c=c.parentNode}c=void 0}c=Ag(c)}}function Cg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?Cg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function Dg(){for(var a=window,b=je();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=je(a.document)}return b}function ke(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}var Eg="$",Fg="/$",le="$?",me="$!",ne=null,oe=null;function Gg(a,b){switch(a){case"button":case"input":case"select":case"textarea":return!!b.autoFocus}return!1}function pe(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}var qe="function"===typeof setTimeout?setTimeout:void 0,uj="function"===typeof clearTimeout?clearTimeout:void 0;function mb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function Hg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===Eg||c===me||c===le){if(0===b)return a;b--}else c===Fg&&b++}a=a.previousSibling}return null}var re=Math.random().toString(36).slice(2),Fa="__reactInternalInstance$"+re,Jc="__reactEventHandlers$"+re,se="__reactContainere$"+re;function Rb(a){var b=a[Fa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[se]||c[Fa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=Hg(a);null!==a;){if(c=a[Fa])return c;a=Hg(a)}return b}a=c,c=a.parentNode}return null}function Sb(a){return a=a[Fa]||a[se],!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Ta(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(p(33))}function te(a){return a[Jc]||null}var Ga=null,ue=null,Kc=null;function Ig(){if(Kc)return Kc;var a,b=ue,c=b.length,d,e="value"in Ga?Ga.value:Ga.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return Kc=e.slice(a,1<d?1-d:void 0)}var vj=U.extend({data:null}),wj=U.extend({data:null}),xj=[9,13,27,32],ve=Aa&&"CompositionEvent"in window,Tb=null;Aa&&"documentMode"in document&&(Tb=document.documentMode);var yj=Aa&&"TextEvent"in window&&!Tb,Jg=Aa&&(!ve||Tb&&8<Tb&&11>=Tb),Kg=String.fromCharCode(32),ra={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},Lg=!1;function Mg(a,b){switch(a){case"keyup":return-1!==xj.indexOf(b.keyCode);case"keydown":return 229!==b.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function Ng(a){return a=a.detail,"object"===typeof a&&"data"in a?a.data:null}var nb=!1;function zj(a,b){switch(a){case"compositionend":return Ng(b);case"keypress":return 32!==b.which?null:(Lg=!0,Kg);case"textInput":return a=b.data,a===Kg&&Lg?null:a;default:return null}}function Aj(a,b){if(nb)return"compositionend"===a||!ve&&Mg(a,b)?(a=Ig(),Kc=ue=Ga=null,nb=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return Jg&&"ko"!==b.locale?null:b.data;default:return null}}var Bj={eventTypes:ra,extractEvents:function(a,b,c,d){var e;if(ve)s:{switch(a){case"compositionstart":var f=ra.compositionStart;break s;case"compositionend":f=ra.compositionEnd;break s;case"compositionupdate":f=ra.compositionUpdate;break s}f=void 0}else nb?Mg(a,c)&&(f=ra.compositionEnd):"keydown"===a&&229===c.keyCode&&(f=ra.compositionStart);return f?(Jg&&"ko"!==c.locale&&(nb||f!==ra.compositionStart?f===ra.compositionEnd&&nb&&(e=Ig()):(Ga=d,ue="value"in Ga?Ga.value:Ga.textContent,nb=!0)),f=vj.getPooled(f,b,c,d),e?f.data=e:(e=Ng(c),null!==e&&(f.data=e)),lb(f),e=f):e=null,(a=yj?zj(a,c):Aj(a,c))?(b=wj.getPooled(ra.beforeInput,b,c,d),b.data=a,lb(b)):b=null,null===e?b:null===b?e:[e,b]}},Cj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Og(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Cj[a.type]:"textarea"===b?!0:!1}var Pg={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function Qg(a,b,c){return a=U.getPooled(Pg.change,a,b,c),a.type="change",Gf(c),lb(a),a}var Ub=null,Vb=null;function Dj(a){tc(a)}function Lc(a){var b=Ta(a);if(Of(b))return a}function Ej(a,b){if("change"===a)return b}var we=!1;Aa&&(we=wg("input")&&(!document.documentMode||9<document.documentMode));function Rg(){Ub&&(Ub.detachEvent("onpropertychange",Sg),Vb=Ub=null)}function Sg(a){if("value"===a.propertyName&&Lc(Vb))if(a=Qg(Vb,a,Zd(a)),Ra)tc(a);else{Ra=!0;try{Gd(Dj,a)}finally{Ra=!1,Jd()}}}function Fj(a,b,c){"focus"===a?(Rg(),Ub=b,Vb=c,Ub.attachEvent("onpropertychange",Sg)):"blur"===a&&Rg()}function Gj(a){if("selectionchange"===a||"keyup"===a||"keydown"===a)return Lc(Vb)}function Hj(a,b){if("click"===a)return Lc(b)}function Ij(a,b){if("input"===a||"change"===a)return Lc(b)}var Jj={eventTypes:Pg,_isInputEventSupported:we,extractEvents:function(a,b,c,d){var e=b?Ta(b):window,f=e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Ej;else if(Og(e))if(we)g=Ij;else{g=Gj;var h=Fj}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Hj);if(g&&(g=g(a,b)))return Qg(g,c,d);h&&h(a,e,b),"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Pd(e,"number",e.value)}},Wb={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},xe,Kj={eventTypes:Wb,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;e=d.window===d?d:(e=d.ownerDocument)?e.defaultView||e.parentWindow:window,g?(g=b,b=(b=c.relatedTarget||c.toElement)?Rb(b):null,null!==b&&(f=Sa(b),b!==f||5!==b.tag&&6!==b.tag))&&(b=null):g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a)var h=Ob,i=Wb.mouseLeave,k=Wb.mouseEnter,q="mouse";else("pointerout"===a||"pointerover"===a)&&(h=og,i=Wb.pointerLeave,k=Wb.pointerEnter,q="pointer");a=null==g?e:Ta(g),e=null==b?e:Ta(b),i=h.getPooled(i,g,c,d),i.type=q+"leave",i.target=a,i.relatedTarget=e,d=h.getPooled(k,b,c,d),d.type=q+"enter",d.target=e,d.relatedTarget=a,h=g,q=b;if(h&&q)s:{for(k=h,a=q,g=0,b=k;b;b=pa(b))g++;for(b=0,e=a;e;e=pa(e))b++;for(;0<g-b;)k=pa(k),g--;for(;0<b-g;)a=pa(a),b--;for(;g--;){if(k===a||k===a.alternate)break s;k=pa(k),a=pa(a)}k=null}else k=null;for(a=k,k=[];h&&h!==a;){g=h.alternate;if(null!==g&&g===a)break;k.push(h),h=pa(h)}for(h=[];q&&q!==a;){g=q.alternate;if(null!==g&&g===a)break;h.push(q),q=pa(q)}for(q=0;q<k.length;q++)_d(k[q],"bubbled",i);for(q=h.length;0<q--;)_d(h[q],"captured",d);return c===xe?(xe=null,[i]):(xe=c,[i,d])}};function Lj(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}var Ua="function"===typeof Object.is?Object.is:Lj,Mj=Object.prototype.hasOwnProperty;function Xb(a,b){if(Ua(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!Mj.call(b,c[d])||!Ua(a[c[d]],b[c[d]]))return!1;return!0}var Nj=Aa&&"documentMode"in document&&11>=document.documentMode,Tg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},ob=null,ye=null,Yb=null,ze=!1;function Ug(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;return ze||null==ob||ob!==je(c)?null:(c=ob,"selectionStart"in c&&ke(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Yb&&Xb(Yb,c)?null:(Yb=c,a=U.getPooled(Tg.select,ye,a,b),a.type="select",a.target=ob,lb(a),a))}var Oj={eventTypes:Tg,extractEvents:function(a,b,c,d){var e=d.window===d?d.document:9===d.nodeType?d:d.ownerDocument,f;if(!(f=!e)){s:{e=fe(e),f=wd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break s}e=!0}f=!e}if(f)return null;e=b?Ta(b):window;switch(a){case"focus":(Og(e)||"true"===e.contentEditable)&&(ob=e,ye=b,Yb=null);break;case"blur":Yb=ye=ob=null;break;case"mousedown":ze=!0;break;case"contextmenu":case"mouseup":case"dragend":return ze=!1,Ug(c,d);case"selectionchange":if(Nj)break;case"keydown":case"keyup":return Ug(c,d)}return null}};Ad.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));var Pj=Sb;yd=te,wf=Pj,xf=Ta,Ad.injectEventPluginsByName({SimpleEventPlugin:ug,EnterLeaveEventPlugin:Kj,ChangeEventPlugin:Jj,SelectEventPlugin:Oj,BeforeInputEventPlugin:Bj}),new Set();var Ae=[],pb=-1;function G(a){0>pb||(a.current=Ae[pb],Ae[pb]=null,pb--)}function H(a,b){pb++,Ae[pb]=a.current,a.current=b}var Ha={},R={current:Ha},Z={current:!1},Va=Ha;function qb(a,b){var c=a.type.contextTypes;if(!c)return Ha;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];return d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e),e}function S(a){return a=a.childContextTypes,null!==a&&void 0!==a}function Mc(a){G(Z,a),G(R,a)}function Be(a){G(Z,a),G(R,a)}function Vg(a,b,c){if(R.current!==Ha)throw Error(p(168));H(R,b,a),H(Z,c,a)}function Wg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(p(108,za(b)||"Unknown",e));return O({},c,{},d)}function Nc(a){var b=a.stateNode;return b=b&&b.__reactInternalMemoizedMergedChildContext||Ha,Va=R.current,H(R,b,a),H(Z,Z.current,a),!0}function Xg(a,b,c){var d=a.stateNode;if(!d)throw Error(p(169));c?(b=Wg(a,b,Va),d.__reactInternalMemoizedMergedChildContext=b,G(Z,a),G(R,a),H(R,b,a)):G(Z,a),H(Z,c,a)}var Qj=E.unstable_runWithPriority,Ce=E.unstable_scheduleCallback,Yg=E.unstable_cancelCallback,Rj=E.unstable_shouldYield,Zg=E.unstable_requestPaint,De=E.unstable_now,Sj=E.unstable_getCurrentPriorityLevel,Oc=E.unstable_ImmediatePriority,_g=E.unstable_UserBlockingPriority,$g=E.unstable_NormalPriority,ah=E.unstable_LowPriority,bh=E.unstable_IdlePriority,ch={},Tj=void 0!==Zg?Zg:function(){},sa=null,Pc=null,Ee=!1,dh=De(),ba=10000>dh?De:function(){return De()-dh};function Fe(){switch(Sj()){case Oc:return 99;case _g:return 98;case $g:return 97;case ah:return 96;case bh:return 95;default:throw Error(p(332))}}function eh(a){switch(a){case 99:return Oc;case 98:return _g;case 97:return $g;case 96:return ah;case 95:return bh;default:throw Error(p(332))}}function rb(a,b){return a=eh(a),Qj(a,b)}function fh(a,b,c){return a=eh(a),Ce(a,b,c)}function gh(a){return null===sa?(sa=[a],Pc=Ce(Oc,hh)):sa.push(a),ch}function ha(){if(null!==Pc){var a=Pc;Pc=null,Yg(a)}hh()}function hh(){if(!Ee&&null!==sa){Ee=!0;var a=0;try{var b=sa;rb(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}}),sa=null}catch(c){throw null!==sa&&(sa=sa.slice(a+1)),Ce(Oc,ha),c}finally{Ee=!1}}}var Uj=3;function Qc(a,b,c){return c/=10,1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function ca(a,b){if(a&&a.defaultProps){b=O({},b),a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}var Ge={current:null},Rc=null,sb=null,Sc=null;function He(){Sc=sb=Rc=null}function ih(a,b){var c=a.type._context;H(Ge,c._currentValue,a),c._currentValue=b}function Ie(a){var b=Ge.current;G(Ge,a),a.type._context._currentValue=b}function jh(a,b){for(;null!==a;){var c=a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function tb(a,b){Rc=a,Sc=sb=null,a=a.dependencies,null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ma=!0),a.firstContext=null)}function ia(a,b){if(Sc!==a&&!1!==b&&0!==b){("number"!==typeof b||1073741823===b)&&(Sc=a,b=1073741823),b={context:a,observedBits:b,next:null};if(null===sb){if(null===Rc)throw Error(p(308));sb=b,Rc.dependencies={expirationTime:0,firstContext:b,responders:null}}else sb=sb.next=b}return a._currentValue}var Ia=!1;function Tc(a){return{baseState:a,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Je(a){return{baseState:a.baseState,firstUpdate:a.firstUpdate,lastUpdate:a.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Ja(a,b){return{expirationTime:a,suspenseConfig:b,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function Uc(a,b){null===a.lastUpdate?a.firstUpdate=a.lastUpdate=b:(a.lastUpdate.next=b,a.lastUpdate=b)}function Ka(a,b){var c=a.alternate;if(null===c){var d=a.updateQueue,e=null;null===d&&(d=a.updateQueue=Tc(a.memoizedState))}else d=a.updateQueue,e=c.updateQueue,null===d?null===e?(d=a.updateQueue=Tc(a.memoizedState),e=c.updateQueue=Tc(c.memoizedState)):d=a.updateQueue=Je(e):null===e&&(e=c.updateQueue=Je(d));null===e||d===e?Uc(d,b):null===d.lastUpdate||null===e.lastUpdate?(Uc(d,b),Uc(e,b)):(Uc(d,b),e.lastUpdate=b)}function kh(a,b){var c=a.updateQueue;c=null===c?a.updateQueue=Tc(a.memoizedState):lh(a,c),null===c.lastCapturedUpdate?c.firstCapturedUpdate=c.lastCapturedUpdate=b:(c.lastCapturedUpdate.next=b,c.lastCapturedUpdate=b)}function lh(a,b){var c=a.alternate;return null!==c&&b===c.updateQueue&&(b=a.updateQueue=Je(b)),b}function mh(a,b,c,d,e,f){switch(c.tag){case 1:return a=c.payload,"function"===typeof a?a.call(f,d,e):a;case 3:a.effectTag=a.effectTag&-4097|64;case 0:a=c.payload,e="function"===typeof a?a.call(f,d,e):a;if(null===e||void 0===e)break;return O({},d,e);case 2:Ia=!0}return d}function Zb(a,b,c,d,e){Ia=!1,b=lh(a,b);for(var f=b.baseState,g=null,h=0,i=b.firstUpdate,k=f;null!==i;){var q=i.expirationTime;q<e?(null===g&&(g=i,f=k),h<q&&(h=q)):(li(q,i.suspenseConfig),k=mh(a,b,i,k,c,d),null!==i.callback&&(a.effectTag|=32,i.nextEffect=null,null===b.lastEffect?b.firstEffect=b.lastEffect=i:(b.lastEffect.nextEffect=i,b.lastEffect=i))),i=i.next}for(q=null,i=b.firstCapturedUpdate;null!==i;){var D=i.expirationTime;D<e?(null===q&&(q=i,null===g&&(f=k)),h<D&&(h=D)):(k=mh(a,b,i,k,c,d),null!==i.callback&&(a.effectTag|=32,i.nextEffect=null,null===b.lastCapturedEffect?b.firstCapturedEffect=b.lastCapturedEffect=i:(b.lastCapturedEffect.nextEffect=i,b.lastCapturedEffect=i))),i=i.next}null===g&&(b.lastUpdate=null),null===q?b.lastCapturedUpdate=null:a.effectTag|=32,null===g&&null===q&&(f=k),b.baseState=f,b.firstUpdate=g,b.firstCapturedUpdate=q,pd(h),a.expirationTime=h,a.memoizedState=k}function nh(a,b,c){null!==b.firstCapturedUpdate&&(null!==b.lastUpdate&&(b.lastUpdate.next=b.firstCapturedUpdate,b.lastUpdate=b.lastCapturedUpdate),b.firstCapturedUpdate=b.lastCapturedUpdate=null),oh(b.firstEffect,c),b.firstEffect=b.lastEffect=null,oh(b.firstCapturedEffect,c),b.firstCapturedEffect=b.lastCapturedEffect=null}function oh(a,b){for(;null!==a;){var c=a.callback;if(null!==c){a.callback=null;var d=b;if("function"!==typeof c)throw Error(p(191,c));c.call(d)}a=a.nextEffect}}var _b=aa.ReactCurrentBatchConfig,ph=new oc.Component().refs;function Vc(a,b,c,d){b=a.memoizedState,c=c(d,b),c=null===c||void 0===c?b:O({},b,c),a.memoizedState=c,d=a.updateQueue,null!==d&&0===a.expirationTime&&(d.baseState=c)}var Wc={isMounted:function(a){return(a=a._reactInternalFiber)?Sa(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ea(),e=_b.suspense;d=_a(d,a,e),e=Ja(d,e),e.payload=b,void 0!==c&&null!==c&&(e.callback=c),Ka(a,e),Oa(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ea(),e=_b.suspense;d=_a(d,a,e),e=Ja(d,e),e.tag=1,e.payload=b,void 0!==c&&null!==c&&(e.callback=c),Ka(a,e),Oa(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ea(),d=_b.suspense;c=_a(c,a,d),d=Ja(c,d),d.tag=2,void 0!==b&&null!==b&&(d.callback=b),Ka(a,d),Oa(a,c)}};function qh(a,b,c,d,e,f,g){return a=a.stateNode,"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,f,g):b.prototype&&b.prototype.isPureReactComponent?!Xb(c,d)||!Xb(e,f):!0}function rh(a,b,c){var d=!1,e=Ha,f=b.contextType;return"object"===typeof f&&null!==f?f=ia(f):(e=S(b)?Va:R.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?qb(a,e):Ha),b=new b(c,f),a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null,b.updater=Wc,a.stateNode=b,b._reactInternalFiber=a,d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f),b}function sh(a,b,c,d){a=b.state,"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d),"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d),b.state!==a&&Wc.enqueueReplaceState(b,b.state,null)}function Ke(a,b,c,d){var e=a.stateNode;e.props=c,e.state=a.memoizedState,e.refs=ph;var f=b.contextType;"object"===typeof f&&null!==f?e.context=ia(f):(f=S(b)?Va:R.current,e.context=qb(a,f)),f=a.updateQueue,null!==f&&(Zb(a,f,c,e,d),e.state=a.memoizedState),f=b.getDerivedStateFromProps,"function"===typeof f&&(Vc(a,b,f,c),e.state=a.memoizedState),"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Wc.enqueueReplaceState(e,e.state,null),f=a.updateQueue,null!==f&&(Zb(a,f,c,e,d),e.state=a.memoizedState)),"function"===typeof e.componentDidMount&&(a.effectTag|=4)}var Xc=Array.isArray;function $b(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(p(309));var d=c.stateNode}if(!d)throw Error(p(147,a));var e=""+a;return null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e?b.ref:(b=function(f){var g=d.refs;g===ph&&(g=d.refs={}),null===f?delete g[e]:g[e]=f},b._stringRef=e,b)}if("string"!==typeof a)throw Error(p(284));if(!c._owner)throw Error(p(290,a))}return a}function Yc(a,b){if("textarea"!==a.type)throw Error(p(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""))}function th(a){function b(l,j){if(a){var m=l.lastEffect;null!==m?(m.nextEffect=j,l.lastEffect=j):l.firstEffect=l.lastEffect=j,j.nextEffect=null,j.effectTag=8}}function c(l,j){if(!a)return null;for(;null!==j;)b(l,j),j=j.sibling;return null}function d(l,j){for(l=new Map();null!==j;)null!==j.key?l.set(j.key,j):l.set(j.index,j),j=j.sibling;return l}function e(l,j,m){return l=bb(l,j,m),l.index=0,l.sibling=null,l}function f(l,j,m){return l.index=m,a?(m=l.alternate,null!==m?(m=m.index,m<j?(l.effectTag=2,j):m):(l.effectTag=2,j)):j}function g(l){return a&&null===l.alternate&&(l.effectTag=2),l}function h(l,j,m,n){return null===j||6!==j.tag?(j=of(m,l.mode,n),j.return=l,j):(j=e(j,m,n),j.return=l,j)}function i(l,j,m,n){return null!==j&&j.elementType===m.type?(n=e(j,m.props,n),n.ref=$b(l,j,m),n.return=l,n):(n=qd(m.type,m.key,m.props,null,l.mode,n),n.ref=$b(l,j,m),n.return=l,n)}function k(l,j,m,n){return null===j||4!==j.tag||j.stateNode.containerInfo!==m.containerInfo||j.stateNode.implementation!==m.implementation?(j=pf(m,l.mode,n),j.return=l,j):(j=e(j,m.children||[],n),j.return=l,j)}function q(l,j,m,n,o){return null===j||7!==j.tag?(j=Qa(m,l.mode,n,o),j.return=l,j):(j=e(j,m,n),j.return=l,j)}function D(l,j,m){if("string"===typeof j||"number"===typeof j)return j=of(""+j,l.mode,m),j.return=l,j;if("object"===typeof j&&null!==j){switch(j.$$typeof){case uc:return m=qd(j.type,j.key,j.props,null,l.mode,m),m.ref=$b(l,null,j),m.return=l,m;case gb:return j=pf(j,l.mode,m),j.return=l,j}if(Xc(j)||Fb(j))return j=Qa(j,l.mode,m,null),j.return=l,j;Yc(l,j)}return null}function z(l,j,m,n){var o=null!==j?j.key:null;if("string"===typeof m||"number"===typeof m)return null!==o?null:h(l,j,""+m,n);if("object"===typeof m&&null!==m){switch(m.$$typeof){case uc:return m.key===o?m.type===ya?q(l,j,m.props.children,n,o):i(l,j,m,n):null;case gb:return m.key===o?k(l,j,m,n):null}if(Xc(m)||Fb(m))return null!==o?null:q(l,j,m,n,null);Yc(l,m)}return null}function I(l,j,m,n,o){if("string"===typeof n||"number"===typeof n)return l=l.get(m)||null,h(j,l,""+n,o);if("object"===typeof n&&null!==n){switch(n.$$typeof){case uc:return l=l.get(null===n.key?m:n.key)||null,n.type===ya?q(j,l,n.props.children,o,n.key):i(j,l,n,o);case gb:return l=l.get(null===n.key?m:n.key)||null,k(j,l,n,o)}if(Xc(n)||Fb(n))return l=l.get(m)||null,q(j,l,n,o,null);Yc(j,n)}return null}function F(l,j,m,n){for(var o=null,r=null,u=j,y=j=0,B=null;null!==u&&y<m.length;y++){u.index>y?(B=u,u=null):B=u.sibling;var x=z(l,u,m[y],n);if(null===x){null===u&&(u=B);break}a&&u&&null===x.alternate&&b(l,u),j=f(x,j,y),null===r?o=x:r.sibling=x,r=x,u=B}if(y===m.length)return c(l,u),o;if(null===u){for(;y<m.length;y++)u=D(l,m[y],n),null!==u&&(j=f(u,j,y),null===r?o=u:r.sibling=u,r=u);return o}for(u=d(l,u);y<m.length;y++)B=I(u,l,y,m[y],n),null!==B&&(a&&null!==B.alternate&&u.delete(null===B.key?y:B.key),j=f(B,j,y),null===r?o=B:r.sibling=B,r=B);return a&&u.forEach(function(fa){return b(l,fa)}),o}function xa(l,j,m,n){var o=Fb(m);if("function"!==typeof o)throw Error(p(150));m=o.call(m);if(null==m)throw Error(p(151));for(var r=o=null,u=j,y=j=0,B=null,x=m.next();null!==u&&!x.done;y++,x=m.next()){u.index>y?(B=u,u=null):B=u.sibling;var fa=z(l,u,x.value,n);if(null===fa){null===u&&(u=B);break}a&&u&&null===fa.alternate&&b(l,u),j=f(fa,j,y),null===r?o=fa:r.sibling=fa,r=fa,u=B}if(x.done)return c(l,u),o;if(null===u){for(;!x.done;y++,x=m.next())x=D(l,x.value,n),null!==x&&(j=f(x,j,y),null===r?o=x:r.sibling=x,r=x);return o}for(u=d(l,u);!x.done;y++,x=m.next())x=I(u,l,y,x.value,n),null!==x&&(a&&null!==x.alternate&&u.delete(null===x.key?y:x.key),j=f(x,j,y),null===r?o=x:r.sibling=x,r=x);return a&&u.forEach(function(td){return b(l,td)}),o}return function(l,j,m,n){var o="object"===typeof m&&null!==m&&m.type===ya&&null===m.key;o&&(m=m.props.children);var r="object"===typeof m&&null!==m;if(r)switch(m.$$typeof){case uc:s:{for(r=m.key,o=j;null!==o;){if(o.key===r)if(7===o.tag?m.type===ya:o.elementType===m.type){c(l,o.sibling),j=e(o,m.type===ya?m.props.children:m.props,n),j.ref=$b(l,o,m),j.return=l,l=j;break s}else{c(l,o);break}else b(l,o);o=o.sibling}m.type===ya?(j=Qa(m.props.children,l.mode,n,m.key),j.return=l,l=j):(n=qd(m.type,m.key,m.props,null,l.mode,n),n.ref=$b(l,j,m),n.return=l,l=n)}return g(l);case gb:s:{for(o=m.key;null!==j;){if(j.key===o)if(4===j.tag&&j.stateNode.containerInfo===m.containerInfo&&j.stateNode.implementation===m.implementation){c(l,j.sibling),j=e(j,m.children||[],n),j.return=l,l=j;break s}else{c(l,j);break}else b(l,j);j=j.sibling}j=pf(m,l.mode,n),j.return=l,l=j}return g(l)}if("string"===typeof m||"number"===typeof m)return m=""+m,null!==j&&6===j.tag?(c(l,j.sibling),j=e(j,m,n),j.return=l,l=j):(c(l,j),j=of(m,l.mode,n),j.return=l,l=j),g(l);if(Xc(m))return F(l,j,m,n);if(Fb(m))return xa(l,j,m,n);r&&Yc(l,m);if("undefined"===typeof m&&!o)switch(l.tag){case 1:case 0:throw l=l.type,Error(p(152,l.displayName||l.name||"Component"))}return c(l,j)}}var ub=th(!0),Le=th(!1),ac={},ja={current:ac},bc={current:ac},cc={current:ac};function Wa(a){if(a===ac)throw Error(p(174));return a}function Me(a,b){H(cc,b,a),H(bc,a,a),H(ja,ac,a);var c=b.nodeType;switch(c){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Td(null,"");break;default:c=8===c?b.parentNode:b,b=c.namespaceURI||null,c=c.tagName,b=Td(b,c)}G(ja,a),H(ja,b,a)}function vb(a){G(ja,a),G(bc,a),G(cc,a)}function uh(a){Wa(cc.current);var b=Wa(ja.current),c=Td(b,a.type);b!==c&&(H(bc,a,a),H(ja,c,a))}function Ne(a){bc.current===a&&(G(ja,a),G(bc,a))}var C={current:0};function Zc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===le||c.data===me))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b,b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}function vh(a,b){return{responder:a,props:b}}var _c=aa.ReactCurrentDispatcher,_=aa.ReactCurrentBatchConfig,dc=0,La=null,N=null,ka=null,wb=null,T=null,xb=null,yb=0,la=null,ec=0,fc=!1,ta=null,gc=0;function V(){throw Error(p(321))}function Oe(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Ua(a[c],b[c]))return!1;return!0}function Pe(a,b,c,d,e,f){dc=f,La=b,ka=null!==a?a.memoizedState:null,_c.current=null===ka?Vj:Gh,b=c(d,e);if(fc){do fc=!1,gc+=1,ka=null!==a?a.memoizedState:null,xb=wb,la=T=N=null,_c.current=Gh,b=c(d,e);while(fc);ta=null,gc=0}_c.current=$c,a=La,a.memoizedState=wb,a.expirationTime=yb,a.updateQueue=la,a.effectTag|=ec,a=null!==N&&null!==N.next,dc=0,xb=T=wb=ka=N=La=null,yb=0,la=null,ec=0;if(a)throw Error(p(300));return b}function wh(){_c.current=$c,dc=0,xb=T=wb=ka=N=La=null,yb=0,la=null,ec=0,fc=!1,ta=null,gc=0}function zb(){var a={memoizedState:null,baseState:null,queue:null,baseUpdate:null,next:null};return null===T?wb=T=a:T=T.next=a,T}function hc(){if(null!==xb)T=xb,xb=T.next,N=ka,ka=null!==N?N.next:null;else{if(null===ka)throw Error(p(310));N=ka;var a={memoizedState:N.memoizedState,baseState:N.baseState,queue:N.queue,baseUpdate:N.baseUpdate,next:null};T=null===T?wb=a:T.next=a,ka=N.next}return T}function xh(a,b){return"function"===typeof b?b(a):b}function yh(a){var b=hc(),c=b.queue;if(null===c)throw Error(p(311));c.lastRenderedReducer=a;if(0<gc){var d=c.dispatch;if(null!==ta){var e=ta.get(c);if(void 0!==e){ta.delete(c);var f=b.memoizedState;do f=a(f,e.action),e=e.next;while(null!==e);return Ua(f,b.memoizedState)||(ma=!0),b.memoizedState=f,b.baseUpdate===c.last&&(b.baseState=f),c.lastRenderedState=f,[f,d]}}return[b.memoizedState,d]}d=c.last;var g=b.baseUpdate;f=b.baseState,null!==g?(null!==d&&(d.next=null),d=g.next):d=null!==d?d.next:null;if(null!==d){var h=e=null,i=d,k=!1;do{var q=i.expirationTime;q<dc?(k||(k=!0,h=g,e=f),q>yb&&(yb=q,pd(yb))):(li(q,i.suspenseConfig),f=i.eagerReducer===a?i.eagerState:a(f,i.action)),g=i,i=i.next}while(null!==i&&i!==d);k||(h=g,e=f),Ua(f,b.memoizedState)||(ma=!0),b.memoizedState=f,b.baseUpdate=h,b.baseState=e,c.lastRenderedState=f}return[b.memoizedState,c.dispatch]}function Qe(a){var b=zb();return"function"===typeof a&&(a=a()),b.memoizedState=b.baseState=a,a=b.queue={last:null,dispatch:null,lastRenderedReducer:xh,lastRenderedState:a},a=a.dispatch=Fh.bind(null,La,a),[b.memoizedState,a]}function Re(a){return yh(xh,a)}function Se(a,b,c,d){return a={tag:a,create:b,destroy:c,deps:d,next:null},null===la?(la={lastEffect:null},la.lastEffect=a.next=a):(b=la.lastEffect,null===b?la.lastEffect=a.next=a:(c=b.next,b.next=a,a.next=c,la.lastEffect=a)),a}function Te(a,b,c,d){var e=zb();ec|=a,e.memoizedState=Se(b,c,void 0,void 0===d?null:d)}function Ue(a,b,c,d){var e=hc();d=void 0===d?null:d;var f;if(null!==N){var g=N.memoizedState;f=g.destroy;if(null!==d&&Oe(d,g.deps)){Se(0,c,f,d);return}}ec|=a,e.memoizedState=Se(b,c,f,d)}function zh(a,b){return Te(516,192,a,b)}function Ah(a,b){return Ue(516,192,a,b)}function Bh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function Ch(){}function Dh(a,b){return zb().memoizedState=[a,void 0===b?null:b],a}function Eh(a,b){var c=hc();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&Oe(b,d[1])?d[0]:(c.memoizedState=[a,b],a)}function Fh(a,b,c){if(!(25>gc))throw Error(p(301));var d=a.alternate;if(a===La||null!==d&&d===La)if(fc=!0,a={expirationTime:dc,suspenseConfig:null,action:c,eagerReducer:null,eagerState:null,next:null},null===ta&&(ta=new Map()),c=ta.get(b),void 0===c)ta.set(b,a);else{for(b=c;null!==b.next;)b=b.next;b.next=a}else{var e=ea(),f=_b.suspense;e=_a(e,a,f),f={expirationTime:e,suspenseConfig:f,action:c,eagerReducer:null,eagerState:null,next:null};var g=b.last;if(null===g)f.next=f;else{var h=g.next;null!==h&&(f.next=h),g.next=f}b.last=f;if(0===a.expirationTime&&(null===d||0===d.expirationTime)&&(d=b.lastRenderedReducer,null!==d))try{var i=b.lastRenderedState,k=d(i,c);f.eagerReducer=d,f.eagerState=k;if(Ua(k,i))return}catch(q){}finally{}Oa(a,e)}}var $c={readContext:ia,useCallback:V,useContext:V,useEffect:V,useImperativeHandle:V,useLayoutEffect:V,useMemo:V,useReducer:V,useRef:V,useState:V,useDebugValue:V,useResponder:V,useDeferredValue:V,useTransition:V},Vj={readContext:ia,useCallback:Dh,useContext:ia,useEffect:zh,useImperativeHandle:function(a,b,c){return c=null!==c&&void 0!==c?c.concat([a]):null,Te(4,36,Bh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return Te(4,36,a,b)},useMemo:function(a,b){var c=zb();return b=void 0===b?null:b,a=a(),c.memoizedState=[a,b],a},useReducer:function(a,b,c){var d=zb();return b=void 0!==c?c(b):b,d.memoizedState=d.baseState=b,a=d.queue={last:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b},a=a.dispatch=Fh.bind(null,La,a),[d.memoizedState,a]},useRef:function(a){var b=zb();return a={current:a},b.memoizedState=a},useState:Qe,useDebugValue:Ch,useResponder:vh,useDeferredValue:function(a,b){var c=Qe(a),d=c[0],e=c[1];return zh(function(){E.unstable_next(function(){var f=_.suspense;_.suspense=void 0===b?null:b;try{e(a)}finally{_.suspense=f}})},[a,b]),d},useTransition:function(a){var b=Qe(!1),c=b[0],d=b[1];return[Dh(function(e){d(!0),E.unstable_next(function(){var f=_.suspense;_.suspense=void 0===a?null:a;try{d(!1),e()}finally{_.suspense=f}})},[a,c]),c]}},Gh={readContext:ia,useCallback:Eh,useContext:ia,useEffect:Ah,useImperativeHandle:function(a,b,c){return c=null!==c&&void 0!==c?c.concat([a]):null,Ue(4,36,Bh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return Ue(4,36,a,b)},useMemo:function(a,b){var c=hc();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&Oe(b,d[1])?d[0]:(a=a(),c.memoizedState=[a,b],a)},useReducer:yh,useRef:function(){return hc().memoizedState},useState:Re,useDebugValue:Ch,useResponder:vh,useDeferredValue:function(a,b){var c=Re(a),d=c[0],e=c[1];return Ah(function(){E.unstable_next(function(){var f=_.suspense;_.suspense=void 0===b?null:b;try{e(a)}finally{_.suspense=f}})},[a,b]),d},useTransition:function(a){var b=Re(!1),c=b[0],d=b[1];return[Eh(function(e){d(!0),E.unstable_next(function(){var f=_.suspense;_.suspense=void 0===a?null:a;try{d(!1),e()}finally{_.suspense=f}})},[a,c]),c]}},ua=null,Ma=null,Xa=!1;function Hh(a,b){var c=oa(5,null,null,0);c.elementType="DELETED",c.type="DELETED",c.stateNode=b,c.return=a,c.effectTag=8,null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function Ih(a,b){switch(a.tag){case 5:var c=a.type;return b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b,null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function Ve(a){if(Xa){var b=Ma;if(b){var c=b;if(!Ih(a,b)){b=mb(c.nextSibling);if(!b||!Ih(a,b)){a.effectTag=a.effectTag&-1025|2,Xa=!1,ua=a;return}Hh(ua,c)}ua=a,Ma=mb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Xa=!1,ua=a}}function Jh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ua=a}function ad(a){if(a!==ua)return!1;if(!Xa)return Jh(a),Xa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==b&&!pe(b,a.memoizedProps))for(b=Ma;b;)Hh(a,b),b=mb(b.nextSibling);Jh(a);if(13===a.tag){a=a.memoizedState,a=null!==a?a.dehydrated:null;if(!a)throw Error(p(317));s:{for(a=a.nextSibling,b=0;a;){if(8===a.nodeType){var c=a.data;if(c===Fg){if(0===b){Ma=mb(a.nextSibling);break s}b--}else c!==Eg&&c!==me&&c!==le||b++}a=a.nextSibling}Ma=null}}else Ma=ua?mb(a.stateNode.nextSibling):null;return!0}function We(){Ma=ua=null,Xa=!1}var Wj=aa.ReactCurrentOwner,ma=!1;function W(a,b,c,d){b.child=null===a?Le(b,null,c,d):ub(b,a.child,c,d)}function Kh(a,b,c,d,e){c=c.render;var f=b.ref;return tb(b,e),d=Pe(a,b,c,d,f,e),null!==a&&!ma?(b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),va(a,b,e)):(b.effectTag|=1,W(a,b,d,e),b.child)}function Lh(a,b,c,d,e,f){if(null===a){var g=c.type;return"function"===typeof g&&!nf(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps?(b.tag=15,b.type=g,Mh(a,b,g,d,e,f)):(a=qd(c.type,null,d,null,b.mode,f),a.ref=b.ref,a.return=b,b.child=a)}return g=a.child,e<f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Xb,c(e,d)&&a.ref===b.ref)?va(a,b,f):(b.effectTag|=1,a=bb(g,d,f),a.ref=b.ref,a.return=b,b.child=a)}function Mh(a,b,c,d,e,f){return null!==a&&Xb(a.memoizedProps,d)&&a.ref===b.ref&&(ma=!1,e<f)?va(a,b,f):Xe(a,b,c,d,f)}function Nh(a,b){var c=b.ref;(null===a&&null!==c||null!==a&&a.ref!==c)&&(b.effectTag|=128)}function Xe(a,b,c,d,e){var f=S(c)?Va:R.current;return f=qb(b,f),tb(b,e),c=Pe(a,b,c,d,f,e),null!==a&&!ma?(b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),va(a,b,e)):(b.effectTag|=1,W(a,b,c,e),b.child)}function Oh(a,b,c,d,e){if(S(c)){var f=!0;Nc(b)}else f=!1;tb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),rh(b,c,d,e),Ke(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var i=g.context,k=c.contextType;"object"===typeof k&&null!==k?k=ia(k):(k=S(c)?Va:R.current,k=qb(b,k));var q=c.getDerivedStateFromProps,D="function"===typeof q||"function"===typeof g.getSnapshotBeforeUpdate;D||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||i!==k)&&sh(b,g,d,k),Ia=!1;var z=b.memoizedState;i=g.state=z;var I=b.updateQueue;null!==I&&(Zb(b,I,d,g,e),i=b.memoizedState),h!==d||z!==i||Z.current||Ia?("function"===typeof q&&(Vc(b,c,q,d),i=b.memoizedState),(h=Ia||qh(b,c,h,d,z,i,k))?(D||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=i),g.props=d,g.state=i,g.context=k,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,h=b.memoizedProps,g.props=b.type===b.elementType?h:ca(b.type,h),i=g.context,k=c.contextType,"object"===typeof k&&null!==k?k=ia(k):(k=S(c)?Va:R.current,k=qb(b,k)),q=c.getDerivedStateFromProps,(D="function"===typeof q||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||i!==k)&&sh(b,g,d,k),Ia=!1,i=b.memoizedState,z=g.state=i,I=b.updateQueue,null!==I&&(Zb(b,I,d,g,e),z=b.memoizedState),h!==d||i!==z||Z.current||Ia?("function"===typeof q&&(Vc(b,c,q,d),z=b.memoizedState),(q=Ia||qh(b,c,h,d,i,z,k))?(D||"function"!==typeof g.UNSAFE_componentWillUpdate&&"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,z,k),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,z,k)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&i===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&i===a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=z),g.props=d,g.state=z,g.context=k,d=q):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&i===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&i===a.memoizedState||(b.effectTag|=256),d=!1);return Ye(a,b,c,d,f,e)}function Ye(a,b,c,d,e,f){Nh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Xg(b,c,!1),va(a,b,f);d=b.stateNode,Wj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?null:d.render();return b.effectTag|=1,null!==a&&g?(b.child=ub(b,a.child,null,f),b.child=ub(b,null,h,f)):W(a,b,h,f),b.memoizedState=d.state,e&&Xg(b,c,!0),b.child}function Ph(a){var b=a.stateNode;b.pendingContext?Vg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Vg(a,b.context,!1),Me(a,b.containerInfo)}var Ze={dehydrated:null,retryTime:0};function Qh(a,b,c){var d=b.mode,e=b.pendingProps,f=C.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState)),h?(g=!0,b.effectTag&=-65):null!==a&&null===a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1),H(C,f&1,b);if(null===a){void 0!==e.fallback&&Ve(b);if(g){g=e.fallback,e=Qa(null,d,0,null),e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;return c=Qa(g,d,c,null),c.return=b,e.sibling=c,b.memoizedState=Ze,b.child=e,c}return d=e.children,b.memoizedState=null,b.child=Le(b,null,d,c)}if(null!==a.memoizedState){a=a.child,d=a.sibling;if(g){e=e.fallback,c=bb(a,a.pendingProps,0),c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;return d=bb(d,e,d.expirationTime),d.return=b,c.sibling=d,c.childExpirationTime=0,b.memoizedState=Ze,b.child=c,d}return c=ub(b,a.child,e.children,c),b.memoizedState=null,b.child=c}a=a.child;if(g){g=e.fallback,e=Qa(null,d,0,null),e.return=b,e.child=a,null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;return c=Qa(g,d,c,null),c.return=b,e.sibling=c,c.effectTag|=2,e.childExpirationTime=0,b.memoizedState=Ze,b.child=e,c}return b.memoizedState=null,b.child=ub(b,a,e.children,c)}function Rh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b),jh(a.return,b)}function _e(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,last:d,tail:c,tailExpiration:0,tailMode:e,lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function Sh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;W(a,b,d.children,c),d=C.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))s:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&Rh(a,c);else if(19===a.tag)Rh(a,c);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===b)break s;for(;null===a.sibling;){if(null===a.return||a.return===b)break s;a=a.return}a.sibling.return=a.return,a=a.sibling}d&=1}H(C,d,b);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case"forwards":for(c=b.child,e=null;null!==c;)a=c.alternate,null!==a&&null===Zc(a)&&(e=c),c=c.sibling;c=e,null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null),_e(b,!1,e,c,f,b.lastEffect);break;case"backwards":for(c=null,e=b.child,b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Zc(a)){b.child=e;break}a=e.sibling,e.sibling=c,c=e,e=a}_e(b,!0,c,null,f,b.lastEffect);break;case"together":_e(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function va(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&pd(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(p(153));if(null!==b.child){for(a=b.child,c=bb(a,a.pendingProps,a.expirationTime),b.child=c,c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=bb(a,a.pendingProps,a.expirationTime),c.return=b;c.sibling=null}return b.child}function Ab(a){a.effectTag|=4}var Th,$e,Uh,Vh;Th=function(a,b){for(var c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c,c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},$e=function(){},Uh=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Wa(ja.current),a=null;switch(c){case"input":f=Nd(g,f),d=Nd(g,d),a=[];break;case"option":f=Qd(g,f),d=Qd(g,d),a=[];break;case"select":f=O({},f,{value:void 0}),d=O({},d,{value:void 0}),a=[];break;case"textarea":f=Rd(g,f),d=Rd(g,d),a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=Ic)}he(c,d);var h,i;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(i in g=f[h],g)g.hasOwnProperty(i)&&(c||(c={}),c[i]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(eb.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(i in g)!g.hasOwnProperty(i)||k&&k.hasOwnProperty(i)||(c||(c={}),c[i]="");for(i in k)k.hasOwnProperty(i)&&g[i]!==k[i]&&(c||(c={}),c[i]=k[i])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||[]).push(h,""+k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(eb.hasOwnProperty(h)?(null!=k&&qa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c),e=a,(b.updateQueue=e)&&Ab(b)}},Vh=function(a,b,c,d){c!==d&&Ab(b)};function bd(a,b){switch(a.tailMode){case"hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function Xj(a){switch(a.tag){case 1:S(a.type)&&Mc(a);var b=a.effectTag;return b&4096?(a.effectTag=b&-4097|64,a):null;case 3:vb(a),Be(a),b=a.effectTag;if(0!==(b&64))throw Error(p(285));return a.effectTag=b&-4097|64,a;case 5:return Ne(a),null;case 13:return G(C,a),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return G(C,a),null;case 4:return vb(a),null;case 10:return Ie(a),null;default:return null}}function af(a,b){return{value:a,source:b,stack:Ed(b)}}var Yj="function"===typeof WeakSet?WeakSet:Set;function bf(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Ed(c)),null!==c&&za(c.type),b=b.value,null!==a&&1===a.tag&&za(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e})}}function Zj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){ab(a,c)}}function Wh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){ab(a,c)}else b.current=null}function _j(a,b){switch(b.tag){case 0:case 11:case 15:ic(2,0,b);break;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode,b=a.getSnapshotBeforeUpdate(b.elementType===b.type?c:ca(b.type,c),d),a.__reactInternalSnapshotBeforeUpdate=b}break;case 3:case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}function ic(a,b,c){c=c.updateQueue,c=null!==c?c.lastEffect:null;if(null!==c){var d=c=c.next;do{if(0!==(d.tag&a)){var e=d.destroy;d.destroy=void 0,void 0!==e&&e()}0!==(d.tag&b)&&(e=d.create,d.destroy=e()),d=d.next}while(d!==c)}}function Xh(a,b,c){"function"===typeof mf&&mf(b);switch(b.tag){case 0:case 11:case 14:case 15:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;rb(97<c?97:c,function(){var e=d;do{var f=e.destroy;if(void 0!==f){var g=b;try{f()}catch(h){ab(g,h)}}e=e.next}while(e!==d)})}break;case 1:Wh(b),c=b.stateNode,"function"===typeof c.componentWillUnmount&&Zj(b,c);break;case 5:Wh(b);break;case 4:$h(a,b,c)}}function Yh(a){var b=a.alternate;a.return=null,a.child=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.alternate=null,a.firstEffect=null,a.lastEffect=null,a.pendingProps=null,a.memoizedProps=null,null!==b&&Yh(b)}function Zh(a){return 5===a.tag||3===a.tag||4===a.tag}function _h(a){s:{for(var b=a.return;null!==b;){if(Zh(b)){var c=b;break s}b=b.return}throw Error(p(160))}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo,d=!0;break;case 4:b=b.containerInfo,d=!0;break;default:throw Error(p(161))}c.effectTag&16&&(Gb(b,""),c.effectTag&=-17);s:$:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Zh(c.return)){c=null;break s}c=c.return}for(c.sibling.return=c.return,c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue $;if(null===c.child||4===c.tag)continue $;c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break s}}for(var e=a;;){var f=5===e.tag||6===e.tag;if(f){var g=f?e.stateNode:e.stateNode.instance;if(c)if(d){f=b;var h=g;g=c,8===f.nodeType?f.parentNode.insertBefore(h,g):f.insertBefore(h,g)}else b.insertBefore(g,c);else d?(h=b,8===h.nodeType?(f=h.parentNode,f.insertBefore(g,h)):(f=h,f.appendChild(g)),h=h._reactRootContainer,null!==h&&void 0!==h||null!==f.onclick||(f.onclick=Ic)):b.appendChild(g)}else if(4!==e.tag&&null!==e.child){e.child.return=e,e=e.child;continue}if(e===a)break;for(;null===e.sibling;){if(null===e.return||e.return===a)return;e=e.return}e.sibling.return=e.return,e=e.sibling}}function $h(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;s:for(;;){if(null===e)throw Error(p(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break s;case 3:f=f.containerInfo,g=!0;break s;case 4:f=f.containerInfo,g=!0;break s}e=e.return}e=!0}if(5===d.tag||6===d.tag){s:for(var h=a,i=d,k=c,q=i;;)if(Xh(h,q,k),null!==q.child&&4!==q.tag)q.child.return=q,q=q.child;else{if(q===i)break;for(;null===q.sibling;){if(null===q.return||q.return===i)break s;q=q.return}q.sibling.return=q.return,q=q.sibling}g?(h=f,i=d.stateNode,8===h.nodeType?h.parentNode.removeChild(i):h.removeChild(i)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo,g=!0,d.child.return=d,d=d.child;continue}}else if(Xh(a,d,c),null!==d.child){d.child.return=d,d=d.child;continue}if(d===b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return,4===d.tag&&(e=!1)}d.sibling.return=d.return,d=d.sibling}}function cf(a,b){switch(b.tag){case 0:case 11:case 14:case 15:ic(4,8,b);break;case 1:break;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){for(c[Jc]=d,"input"===a&&"radio"===d.type&&null!=d.name&&Qf(c,d),ie(a,e),b=ie(a,d),e=0;e<f.length;e+=2){var g=f[e],h=f[e+1];"style"===g?zg(c,h):"dangerouslySetInnerHTML"===g?Wf(c,h):"children"===g?Gb(c,h):Md(c,g,h,b)}switch(a){case"input":Od(c,d);break;case"textarea":Tf(c,d);break;case"select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?jb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?jb(c,!!d.multiple,d.defaultValue,!0):jb(c,!!d.multiple,d.multiple?[]:"",!1))}}}break;case 6:if(null===b.stateNode)throw Error(p(162));b.stateNode.nodeValue=b.memoizedProps;break;case 3:b=b.stateNode,b.hydrate&&(b.hydrate=!1,hg(b.containerInfo));break;case 12:break;case 13:c=b,null===b.memoizedState?d=!1:(d=!0,c=b.child,ff=ba());if(null!==c)s:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=yg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling,f.return=a,a=f;continue}else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===c)break s;for(;null===a.sibling;){if(null===a.return||a.return===c)break s;a=a.return}a.sibling.return=a.return,a=a.sibling}ai(b);break;case 19:ai(b);break;case 17:break;case 20:break;case 21:break;default:throw Error(p(163))}}function ai(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=new Yj()),b.forEach(function(d){var e=ik.bind(null,a,d);c.has(d)||(c.add(d),d.then(e,e))})}}var $j="function"===typeof WeakMap?WeakMap:Map;function bi(a,b,c){c=Ja(c,null),c.tag=3,c.payload={element:null};var d=b.value;return c.callback=function(){jd||(jd=!0,gf=d),bf(a,b)},c}function ci(a,b,c){c=Ja(c,null),c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){return bf(a,b),d(e)}}var f=a.stateNode;return null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&(null===Na?Na=new Set([this]):Na.add(this),bf(a,b));var g=b.stack;this.componentDidCatch(b.value,{componentStack:null!==g?g:""})}),c}var ak=Math.ceil,cd=aa.ReactCurrentDispatcher,di=aa.ReactCurrentOwner,J=0,df=8,da=16,na=32,Ya=0,dd=1,ei=2,ed=3,fd=4,ef=5,v=J,X=null,w=null,Q=0,K=Ya,gd=null,wa=1073741823,jc=1073741823,hd=null,kc=0,id=!1,ff=0,fi=500,t=null,jd=!1,gf=null,Na=null,kd=!1,ld=null,lc=90,Za=null,mc=0,hf=null,md=0;function ea(){return(v&(da|na))!==J?1073741821-(ba()/10|0):0!==md?md:md=1073741821-(ba()/10|0)}function _a(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Fe();if(0===(b&4))return 99===d?1073741823:1073741822;if((v&da)!==J)return Q;if(null!==c)a=Qc(a,c.timeoutMs|0||5000,250);else switch(d){case 99:a=1073741823;break;case 98:a=Qc(a,150,100);break;case 97:case 96:a=Qc(a,5000,250);break;case 95:a=2;break;default:throw Error(p(326))}return null!==X&&a===Q&&--a,a}function Oa(a,b){if(50<mc)throw mc=0,hf=null,Error(p(185));a=nd(a,b);if(null!==a){var c=Fe();1073741823===b?(v&df)!==J&&(v&(da|na))===J?jf(a):(Y(a),v===J&&ha()):Y(a),(v&4)===J||98!==c&&99!==c||(null===Za?Za=new Map([[a,b]]):(c=Za.get(a),(void 0===c||c>b)&&Za.set(a,b)))}}function nd(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate,d.childExpirationTime<b&&(d.childExpirationTime=b),null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}return null!==e&&(X===e&&(pd(b),K===fd&&cb(e,Q)),ri(e,b)),e}function od(a){var b=a.lastExpiredTime;return 0!==b?b:(b=a.firstPendingTime,qi(a,b)?(b=a.lastPingedTime,a=a.nextKnownPendingLevel,b>a?b:a):b)}function Y(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=gh(jf.bind(null,a));else{var b=od(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ea();1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==ch&&Yg(c)}a.callbackExpirationTime=b,a.callbackPriority=d,b=1073741823===b?gh(jf.bind(null,a)):fh(d,gi.bind(null,a),{timeout:10*(1073741821-b)-ba()}),a.callbackNode=b}}}function gi(a,b){md=0;if(b)return b=ea(),qf(a,b),Y(a),null;var c=od(a);if(0!==c){b=a.callbackNode;if((v&(da|na))!==J)throw Error(p(327));Bb(),a===X&&c===Q||$a(a,c);if(null!==w){var d=v;v|=da;var e=ki(a);do try{dk();break}catch(h){ji(a,h)}while(1);He(),v=d,cd.current=e;if(K===dd)throw b=gd,$a(a,c),cb(a,c),Y(a),b;if(null===w)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=K,X=null,d){case Ya:case dd:throw Error(p(345));case ei:qf(a,2<c?2:c);break;case ed:cb(a,c),d=a.lastSuspendedTime,c===d&&(a.nextKnownPendingLevel=kf(e));if(1073741823===wa&&(e=ff+fi-ba(),10<e)){if(id){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=c,$a(a,c);break}}f=od(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=qe(Pa.bind(null,a),e);break}Pa(a);break;case fd:cb(a,c),d=a.lastSuspendedTime,c===d&&(a.nextKnownPendingLevel=kf(e));if(id&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c,$a(a,c);break}e=od(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==jc?d=10*(1073741821-jc)-ba():1073741823===wa?d=0:(d=10*(1073741821-wa)-5000,e=ba(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3000>d?3000:4320>d?4320:1960*ak(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=qe(Pa.bind(null,a),d);break}Pa(a);break;case ef:if(1073741823!==wa&&null!==hd){f=wa;var g=hd;d=g.busyMinDurationMs|0,0>=d?d=0:(e=g.busyDelayMs|0,f=ba()-(10*(1073741821-f)-(g.timeoutMs|0||5000)),d=f<=e?0:e+d-f);if(10<d){cb(a,c),a.timeoutHandle=qe(Pa.bind(null,a),d);break}}Pa(a);break;default:throw Error(p(329))}Y(a);if(a.callbackNode===b)return gi.bind(null,a)}}return null}function jf(a){var b=a.lastExpiredTime;b=0!==b?b:1073741823;if(a.finishedExpirationTime===b)Pa(a);else{if((v&(da|na))!==J)throw Error(p(327));Bb(),a===X&&b===Q||$a(a,b);if(null!==w){var c=v;v|=da;var d=ki(a);do try{ck();break}catch(e){ji(a,e)}while(1);He(),v=c,cd.current=d;if(K===dd)throw c=gd,$a(a,b),cb(a,b),Y(a),c;if(null!==w)throw Error(p(261));a.finishedWork=a.current.alternate,a.finishedExpirationTime=b,X=null,Pa(a),Y(a)}}return null}function bk(){if(null!==Za){var a=Za;Za=null,a.forEach(function(b,c){qf(c,b),Y(c)}),ha()}}function hi(a,b){var c=v;v|=1;try{return a(b)}finally{v=c,v===J&&ha()}}function ii(a,b){var c=v;v&=-2,v|=df;try{return a(b)}finally{v=c,v===J&&ha()}}function $a(a,b){a.finishedWork=null,a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,uj(c));if(null!==w)for(c=w.return;null!==c;){var d=c;switch(d.tag){case 1:var e=d.type.childContextTypes;null!==e&&void 0!==e&&Mc(d);break;case 3:vb(d),Be(d);break;case 5:Ne(d);break;case 4:vb(d);break;case 13:G(C,d);break;case 19:G(C,d);break;case 10:Ie(d)}c=c.return}X=a,w=bb(a.current,null,b),Q=b,K=Ya,gd=null,jc=wa=1073741823,hd=null,kc=0,id=!1}function ji(a,b){do{try{He(),wh();if(null===w||null===w.return)return K=dd,gd=b,null;s:{var c=a,d=w.return,e=w,f=b;b=Q,e.effectTag|=2048,e.firstEffect=e.lastEffect=null;if(null!==f&&"object"===typeof f&&"function"===typeof f.then){var g=f,h=0!==(C.current&1),i=d;do{var k;if(k=13===i.tag){var q=i.memoizedState;if(null!==q)k=null!==q.dehydrated?!0:!1;else{var D=i.memoizedProps;k=void 0===D.fallback?!1:!0!==D.unstable_avoidThisFallback?!0:h?!1:!0}}if(k){var z=i.updateQueue;if(null===z){var I=new Set();I.add(g),i.updateQueue=I}else z.add(g);if(0===(i.mode&2)){i.effectTag|=64,e.effectTag&=-2981;if(1===e.tag)if(null===e.alternate)e.tag=17;else{var F=Ja(1073741823,null);F.tag=2,Ka(e,F)}e.expirationTime=1073741823;break s}f=void 0,e=b;var xa=c.pingCache;null===xa?(xa=c.pingCache=new $j(),f=new Set(),xa.set(g,f)):(f=xa.get(g),void 0===f&&(f=new Set(),xa.set(g,f)));if(!f.has(e)){f.add(e);var l=hk.bind(null,c,g,e);g.then(l,l)}i.effectTag|=4096,i.expirationTime=b;break s}i=i.return}while(null!==i);f=Error((za(e.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`+Ed(e))}K!==ef&&(K=ei),f=af(f,e),i=d;do{switch(i.tag){case 3:g=f,i.effectTag|=4096,i.expirationTime=b;var j=bi(i,g,b);kh(i,j);break s;case 1:g=f;var m=i.type,n=i.stateNode;if(0===(i.effectTag&64)&&("function"===typeof m.getDerivedStateFromError||null!==n&&"function"===typeof n.componentDidCatch&&(null===Na||!Na.has(n)))){i.effectTag|=4096,i.expirationTime=b;var o=ci(i,g,b);kh(i,o);break s}}i=i.return}while(null!==i)}w=ni(w)}catch(r){b=r;continue}break}while(1)}function ki(){var a=cd.current;return cd.current=$c,null===a?$c:a}function li(a,b){a<wa&&2<a&&(wa=a),null!==b&&a<jc&&2<a&&(jc=a,hd=b)}function pd(a){a>kc&&(kc=a)}function ck(){for(;null!==w;)w=mi(w)}function dk(){for(;null!==w&&!Rj();)w=mi(w)}function mi(a){var b=pi(a.alternate,a,Q);return a.memoizedProps=a.pendingProps,null===b&&(b=ni(a)),di.current=null,b}function ni(a){w=a;do{var b=w.alternate;a=w.return;if(0===(w.effectTag&2048)){s:{var c=b;b=w;var d=Q,e=b.pendingProps;switch(b.tag){case 2:break;case 16:break;case 15:case 0:break;case 1:S(b.type)&&Mc(b);break;case 3:vb(b),Be(b),e=b.stateNode,e.pendingContext&&(e.context=e.pendingContext,e.pendingContext=null),(null===c||null===c.child)&&ad(b)&&Ab(b),$e(b);break;case 5:Ne(b),d=Wa(cc.current);var f=b.type;if(null!==c&&null!=b.stateNode)Uh(c,b,f,e,d),c.ref!==b.ref&&(b.effectTag|=128);else if(e){var g=Wa(ja.current);if(ad(b)){e=b;var h=e.stateNode;c=e.type;var i=e.memoizedProps,k=d;h[Fa]=e,h[Jc]=i,f=void 0,d=h;switch(c){case"iframe":case"object":case"embed":A("load",d);break;case"video":case"audio":for(h=0;h<Hb.length;h++)A(Hb[h],d);break;case"source":A("error",d);break;case"img":case"image":case"link":A("error",d),A("load",d);break;case"form":A("reset",d),A("submit",d);break;case"details":A("toggle",d);break;case"input":Pf(d,i),A("invalid",d),qa(k,"onChange");break;case"select":d._wrapperState={wasMultiple:!!i.multiple},A("invalid",d),qa(k,"onChange");break;case"textarea":Sf(d,i),A("invalid",d),qa(k,"onChange")}he(c,i),h=null;for(f in i)i.hasOwnProperty(f)&&(g=i[f],"children"===f?"string"===typeof g?d.textContent!==g&&(h=["children",g]):"number"===typeof g&&d.textContent!==""+g&&(h=["children",""+g]):eb.hasOwnProperty(f)&&null!=g&&qa(k,f));switch(c){case"input":xc(d),Rf(d,i,!0);break;case"textarea":xc(d),Uf(d,i);break;case"select":case"option":break;default:"function"===typeof i.onClick&&(d.onclick=Ic)}f=h,e.updateQueue=f,e=null!==f?!0:!1,e&&Ab(b)}else{c=b,k=f,i=e,h=9===d.nodeType?d:d.ownerDocument,g===Sd.html&&(g=Vf(k)),g===Sd.html?"script"===k?(i=h.createElement("div"),i.innerHTML="<script></script>",h=i.removeChild(i.firstChild)):"string"===typeof i.is?h=h.createElement(k,{is:i.is}):(h=h.createElement(k),"select"===k&&(k=h,i.multiple?k.multiple=!0:i.size&&(k.size=i.size))):h=h.createElementNS(g,k),i=h,i[Fa]=c,i[Jc]=e,Th(i,b,!1,!1),b.stateNode=i,k=f,c=e;var q=d,D=ie(k,c);switch(k){case"iframe":case"object":case"embed":A("load",i),d=c;break;case"video":case"audio":for(d=0;d<Hb.length;d++)A(Hb[d],i);d=c;break;case"source":A("error",i),d=c;break;case"img":case"image":case"link":A("error",i),A("load",i),d=c;break;case"form":A("reset",i),A("submit",i),d=c;break;case"details":A("toggle",i),d=c;break;case"input":Pf(i,c),d=Nd(i,c),A("invalid",i),qa(q,"onChange");break;case"option":d=Qd(i,c);break;case"select":i._wrapperState={wasMultiple:!!c.multiple},d=O({},c,{value:void 0}),A("invalid",i),qa(q,"onChange");break;case"textarea":Sf(i,c),d=Rd(i,c),A("invalid",i),qa(q,"onChange");break;default:d=c}he(k,d),h=void 0,g=k;var z=i,I=d;for(h in I)if(I.hasOwnProperty(h)){var F=I[h];"style"===h?zg(z,F):"dangerouslySetInnerHTML"===h?(F=F?F.__html:void 0,null!=F&&Wf(z,F)):"children"===h?"string"===typeof F?("textarea"!==g||""!==F)&&Gb(z,F):"number"===typeof F&&Gb(z,""+F):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(eb.hasOwnProperty(h)?null!=F&&qa(q,h):null!=F&&Md(z,h,F,D))}switch(k){case"input":xc(i),Rf(i,c,!1);break;case"textarea":xc(i),Uf(i,c);break;case"option":null!=c.value&&i.setAttribute("value",""+Ba(c.value));break;case"select":d=i,d.multiple=!!c.multiple,i=c.value,null!=i?jb(d,!!c.multiple,i,!1):null!=c.defaultValue&&jb(d,!!c.multiple,c.defaultValue,!0);break;default:"function"===typeof d.onClick&&(i.onclick=Ic)}(e=Gg(f,e))&&Ab(b)}null!==b.ref&&(b.effectTag|=128)}else if(null===b.stateNode)throw Error(p(166));break;case 6:if(c&&null!=b.stateNode)Vh(c,b,c.memoizedProps,e);else{if("string"!==typeof e&&null===b.stateNode)throw Error(p(166));d=Wa(cc.current),Wa(ja.current),ad(b)?(e=b,f=e.stateNode,d=e.memoizedProps,f[Fa]=e,(e=f.nodeValue!==d)&&Ab(b)):(f=b,e=(9===d.nodeType?d:d.ownerDocument).createTextNode(e),e[Fa]=f,b.stateNode=e)}break;case 11:break;case 13:G(C,b),e=b.memoizedState;if(0!==(b.effectTag&64)){b.expirationTime=d;break s}e=null!==e,f=!1,null===c?void 0!==b.memoizedProps.fallback&&ad(b):(d=c.memoizedState,f=null!==d,e||null===d||(d=c.child.sibling,null!==d&&(i=b.firstEffect,null!==i?(b.firstEffect=d,d.nextEffect=i):(b.firstEffect=b.lastEffect=d,d.nextEffect=null),d.effectTag=8))),e&&!f&&0!==(b.mode&2)&&(null===c&&!0!==b.memoizedProps.unstable_avoidThisFallback||0!==(C.current&1)?K===Ya&&(K=ed):((K===Ya||K===ed)&&(K=fd),0!==kc&&null!==X&&(cb(X,Q),ri(X,kc)))),(e||f)&&(b.effectTag|=4);break;case 7:break;case 8:break;case 12:break;case 4:vb(b),$e(b);break;case 10:Ie(b);break;case 9:break;case 14:break;case 17:S(b.type)&&Mc(b);break;case 19:G(C,b),e=b.memoizedState;if(null===e)break;f=0!==(b.effectTag&64),i=e.rendering;if(null===i){if(f)bd(e,!1);else if(K!==Ya||null!==c&&0!==(c.effectTag&64))for(c=b.child;null!==c;){i=Zc(c);if(null!==i){for(b.effectTag|=64,bd(e,!1),f=i.updateQueue,null!==f&&(b.updateQueue=f,b.effectTag|=4),null===e.lastEffect&&(b.firstEffect=null),b.lastEffect=e.lastEffect,e=d,f=b.child;null!==f;)d=f,c=e,d.effectTag&=2,d.nextEffect=null,d.firstEffect=null,d.lastEffect=null,i=d.alternate,null===i?(d.childExpirationTime=0,d.expirationTime=c,d.child=null,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null):(d.childExpirationTime=i.childExpirationTime,d.expirationTime=i.expirationTime,d.child=i.child,d.memoizedProps=i.memoizedProps,d.memoizedState=i.memoizedState,d.updateQueue=i.updateQueue,c=i.dependencies,d.dependencies=null===c?null:{expirationTime:c.expirationTime,firstContext:c.firstContext,responders:c.responders}),f=f.sibling;H(C,C.current&1|2,b),b=b.child;break s}c=c.sibling}}else{if(!f)if(c=Zc(i),null!==c){if(b.effectTag|=64,f=!0,d=c.updateQueue,null!==d&&(b.updateQueue=d,b.effectTag|=4),bd(e,!0),null===e.tail&&"hidden"===e.tailMode){b=b.lastEffect=e.lastEffect,null!==b&&(b.nextEffect=null);break}}else ba()>e.tailExpiration&&1<d&&(b.effectTag|=64,f=!0,bd(e,!1),b.expirationTime=b.childExpirationTime=d-1);e.isBackwards?(i.sibling=b.child,b.child=i):(d=e.last,null!==d?d.sibling=i:b.child=i,e.last=i)}if(null!==e.tail){0===e.tailExpiration&&(e.tailExpiration=ba()+500),d=e.tail,e.rendering=d,e.tail=d.sibling,e.lastEffect=b.lastEffect,d.sibling=null,e=C.current,e=f?e&1|2:e&1,H(C,e,b),b=d;break s}break;case 20:break;case 21:break;default:throw Error(p(156,b.tag))}b=null}e=w;if(1===Q||1!==e.childExpirationTime){for(f=0,d=e.child;null!==d;)c=d.expirationTime,i=d.childExpirationTime,c>f&&(f=c),i>f&&(f=i),d=d.sibling;e.childExpirationTime=f}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=w.firstEffect),null!==w.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=w.firstEffect),a.lastEffect=w.lastEffect),1<w.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=w:a.firstEffect=w,a.lastEffect=w))}else{b=Xj(w,Q);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=2048)}b=w.sibling;if(null!==b)return b;w=a}while(null!==w);return K===Ya&&(K=ef),null}function kf(a){var b=a.expirationTime;return a=a.childExpirationTime,b>a?b:a}function Pa(a){var b=Fe();return rb(99,ek.bind(null,a,b)),null}function ek(a,b){Bb();if((v&(da|na))!==J)throw Error(p(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null,a.finishedExpirationTime=0;if(c===a.current)throw Error(p(177));a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90,a.nextKnownPendingLevel=0;var e=kf(c);a.firstPendingTime=e,d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1),d<=a.lastPingedTime&&(a.lastPingedTime=0),d<=a.lastExpiredTime&&(a.lastExpiredTime=0),a===X&&(w=X=null,Q=0),1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=v;v|=na,di.current=null,ne=Gc;var g=Dg();if(ke(g)){if("selectionStart"in g)var h={start:g.selectionStart,end:g.selectionEnd};else s:{h=(h=g.ownerDocument)&&h.defaultView||window;var i=h.getSelection&&h.getSelection();if(i&&0!==i.rangeCount){h=i.anchorNode;var k=i.anchorOffset,q=i.focusNode;i=i.focusOffset;try{h.nodeType,q.nodeType}catch(Cb){h=null;break s}var D=0,z=-1,I=-1,F=0,xa=0,l=g,j=null;$:for(;;){for(var m;;){l!==h||0!==k&&3!==l.nodeType||(z=D+k),l!==q||0!==i&&3!==l.nodeType||(I=D+i),3===l.nodeType&&(D+=l.nodeValue.length);if(null===(m=l.firstChild))break;j=l,l=m}for(;;){if(l===g)break $;j===h&&++F===k&&(z=D),j===q&&++xa===i&&(I=D);if(null!==(m=l.nextSibling))break;l=j,j=l.parentNode}l=m}h=-1===z||-1===I?null:{start:z,end:I}}else h=null}h=h||{start:0,end:0}}else h=null;oe={focusedElem:g,selectionRange:h},Gc=!1,t=e;do try{fk()}catch(Cb){if(null===t)throw Error(p(330));ab(t,Cb),t=t.nextEffect}while(null!==t);t=e;do try{for(g=a,h=b;null!==t;){var n=t.effectTag;n&16&&Gb(t.stateNode,"");if(n&128){var o=t.alternate;if(null!==o){var r=o.ref;null!==r&&("function"===typeof r?r(null):r.current=null)}}switch(n&1038){case 2:_h(t),t.effectTag&=-3;break;case 6:_h(t),t.effectTag&=-3,cf(t.alternate,t);break;case 1024:t.effectTag&=-1025;break;case 1028:t.effectTag&=-1025,cf(t.alternate,t);break;case 4:cf(t.alternate,t);break;case 8:k=t,$h(g,k,h),Yh(k)}t=t.nextEffect}}catch(Cb){if(null===t)throw Error(p(330));ab(t,Cb),t=t.nextEffect}while(null!==t);r=oe,o=Dg(),n=r.focusedElem,h=r.selectionRange;if(o!==n&&n&&n.ownerDocument&&Cg(n.ownerDocument.documentElement,n)){for(null!==h&&ke(n)&&(o=h.start,r=h.end,void 0===r&&(r=o),"selectionStart"in n?(n.selectionStart=o,n.selectionEnd=Math.min(r,n.value.length)):(r=(o=n.ownerDocument||document)&&o.defaultView||window,r.getSelection&&(r=r.getSelection(),k=n.textContent.length,g=Math.min(h.start,k),h=void 0===h.end?g:Math.min(h.end,k),!r.extend&&g>h&&(k=h,h=g,g=k),k=Bg(n,g),q=Bg(n,h),k&&q&&(1!==r.rangeCount||r.anchorNode!==k.node||r.anchorOffset!==k.offset||r.focusNode!==q.node||r.focusOffset!==q.offset)&&(o=o.createRange(),o.setStart(k.node,k.offset),r.removeAllRanges(),g>h?(r.addRange(o),r.extend(q.node,q.offset)):(o.setEnd(q.node,q.offset),r.addRange(o)))))),o=[],r=n;r=r.parentNode;)1===r.nodeType&&o.push({element:r,left:r.scrollLeft,top:r.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<o.length;n++)r=o[n],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}oe=null,Gc=!!ne,ne=null,a.current=c,t=e;do try{for(n=d;null!==t;){var u=t.effectTag;if(u&36){var y=t.alternate;o=t,r=n;switch(o.tag){case 0:case 11:case 15:ic(16,32,o);break;case 1:var B=o.stateNode;if(o.effectTag&4)if(null===y)B.componentDidMount();else{var x=o.elementType===o.type?y.memoizedProps:ca(o.type,y.memoizedProps);B.componentDidUpdate(x,y.memoizedState,B.__reactInternalSnapshotBeforeUpdate)}var fa=o.updateQueue;null!==fa&&nh(o,fa,B,r);break;case 3:var td=o.updateQueue;if(null!==td){g=null;if(null!==o.child)switch(o.child.tag){case 5:g=o.child.stateNode;break;case 1:g=o.child.stateNode}nh(o,td,g,r)}break;case 5:var pk=o.stateNode;null===y&&o.effectTag&4&&Gg(o.type,o.memoizedProps)&&pk.focus();break;case 6:break;case 4:break;case 12:break;case 13:if(null===o.memoizedState){var xi=o.alternate;if(null!==xi){var yi=xi.memoizedState;if(null!==yi){var zi=yi.dehydrated;null!==zi&&hg(zi)}}}break;case 19:case 17:case 20:case 21:break;default:throw Error(p(163))}}if(u&128){o=void 0;var ud=t.ref;if(null!==ud){var Ai=t.stateNode;switch(t.tag){case 5:o=Ai;break;default:o=Ai}"function"===typeof ud?ud(o):ud.current=o}}t=t.nextEffect}}catch(Cb){if(null===t)throw Error(p(330));ab(t,Cb),t=t.nextEffect}while(null!==t);t=null,Tj(),v=f}else a.current=c;if(kd)kd=!1,ld=a,lc=b;else for(t=e;null!==t;)b=t.nextEffect,t.nextEffect=null,t=b;b=a.firstPendingTime,0===b&&(Na=null),1073741823===b?a===hf?mc++:(mc=0,hf=a):mc=0,"function"===typeof lf&&lf(c.stateNode,d),Y(a);if(jd)throw jd=!1,a=gf,gf=null,a;return(v&df)!==J?null:(ha(),null)}function fk(){for(;null!==t;){var a=t.effectTag;0!==(a&256)&&_j(t.alternate,t),0===(a&512)||kd||(kd=!0,fh(97,function(){return Bb(),null})),t=t.nextEffect}}function Bb(){if(90!==lc){var a=97<lc?97:lc;return lc=90,rb(a,gk)}}function gk(){if(null===ld)return!1;var a=ld;ld=null;if((v&(da|na))!==J)throw Error(p(331));var b=v;for(v|=na,a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:ic(128,0,c),ic(0,64,c)}}catch(d){if(null===a)throw Error(p(330));ab(a,d)}c=a.nextEffect,a.nextEffect=null,a=c}return v=b,ha(),!0}function oi(a,b,c){b=af(c,b),b=bi(a,b,1073741823),Ka(a,b),a=nd(a,1073741823),null!==a&&Y(a)}function ab(a,b){if(3===a.tag)oi(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){oi(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===Na||!Na.has(d))){a=af(b,a),a=ci(c,a,1073741823),Ka(c,a),c=nd(c,1073741823),null!==c&&Y(c);break}}c=c.return}}function hk(a,b,c){var d=a.pingCache;null!==d&&d.delete(b),X===a&&Q===c?K===fd||K===ed&&1073741823===wa&&ba()-ff<fi?$a(a,Q):id=!0:qi(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,a.finishedExpirationTime===c&&(a.finishedExpirationTime=0,a.finishedWork=null),Y(a)))}function ik(a,b){var c=a.stateNode;null!==c&&c.delete(b),b=0,0===b&&(b=ea(),b=_a(b,a,null)),a=nd(a,b),null!==a&&Y(a)}var pi;pi=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||Z.current)ma=!0;else{if(d<c){ma=!1;switch(b.tag){case 3:Ph(b),We();break;case 5:uh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:S(b.type)&&Nc(b);break;case 4:Me(b,b.stateNode.containerInfo);break;case 10:ih(b,b.memoizedProps.value);break;case 13:if(null!==b.memoizedState)return d=b.child.childExpirationTime,0!==d&&d>=c?Qh(a,b,c):(H(C,C.current&1,b),b=va(a,b,c),null!==b?b.sibling:null);H(C,C.current&1,b);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return Sh(a,b,c);b.effectTag|=64}e=b.memoizedState,null!==e&&(e.rendering=null,e.tail=null),H(C,C.current,b);if(!d)return null}return va(a,b,c)}ma=!1}}else ma=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type,null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),a=b.pendingProps,e=qb(b,R.current),tb(b,c),e=Pe(null,b,d,a,e,c),b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1,wh();if(S(d)){var f=!0;Nc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;var g=d.getDerivedStateFromProps;"function"===typeof g&&Vc(b,d,g,a),e.updater=Wc,b.stateNode=e,e._reactInternalFiber=b,Ke(b,d,a,c),b=Ye(null,b,d,!0,f,c)}else b.tag=0,W(null,b,e,c),b=b.child;return b;case 16:e=b.elementType,null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),a=b.pendingProps,Ji(e);if(1!==e._status)throw e._result;e=e._result,b.type=e,f=b.tag=lk(e),a=ca(e,a);switch(f){case 0:b=Xe(null,b,e,a,c);break;case 1:b=Oh(null,b,e,a,c);break;case 11:b=Kh(null,b,e,a,c);break;case 14:b=Lh(null,b,e,ca(e.type,a),d,c);break;default:throw Error(p(306,e,""))}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ca(d,e),Xe(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ca(d,e),Oh(a,b,d,e,c);case 3:Ph(b),d=b.updateQueue;if(null===d)throw Error(p(282));e=b.memoizedState,e=null!==e?e.element:null,Zb(b,d,b.pendingProps,null,c),d=b.memoizedState.element;if(d===e)We(),b=va(a,b,c);else{(e=b.stateNode.hydrate)&&(Ma=mb(b.stateNode.containerInfo.firstChild),ua=b,e=Xa=!0);if(e)for(c=Le(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else W(a,b,d,c),We();b=b.child}return b;case 5:return uh(b),null===a&&Ve(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:null,g=e.children,pe(d,e)?g=null:null!==f&&pe(d,f)&&(b.effectTag|=16),Nh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(W(a,b,g,c),b=b.child),b;case 6:return null===a&&Ve(b),null;case 13:return Qh(a,b,c);case 4:return Me(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=ub(b,null,d,c):W(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ca(d,e),Kh(a,b,d,e,c);case 7:return W(a,b,b.pendingProps,c),b.child;case 8:return W(a,b,b.pendingProps.children,c),b.child;case 12:return W(a,b,b.pendingProps.children,c),b.child;case 10:s:{d=b.type._context,e=b.pendingProps,g=b.memoizedProps,f=e.value,ih(b,f);if(null!==g){var h=g.value;f=Ua(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0;if(0===f){if(g.children===e.children&&!Z.current){b=va(a,b,c);break s}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var i=h.dependencies;if(null!==i){g=h.child;for(var k=i.firstContext;null!==k;){if(k.context===d&&0!==(k.observedBits&f)){1===h.tag&&(k=Ja(c,null),k.tag=2,Ka(h,k)),h.expirationTime<c&&(h.expirationTime=c),k=h.alternate,null!==k&&k.expirationTime<c&&(k.expirationTime=c),jh(h.return,c),i.expirationTime<c&&(i.expirationTime=c);break}k=k.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return,g=h;break}g=g.return}h=g}}W(a,b,e.children,c),b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,tb(b,c),e=ia(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,W(a,b,d,c),b.child;case 14:return e=b.type,f=ca(e,b.pendingProps),f=ca(e.type,f),Lh(a,b,e,f,d,c);case 15:return Mh(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ca(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,S(d)?(a=!0,Nc(b)):a=!1,tb(b,c),rh(b,d,e,c),Ke(b,d,e,c),Ye(null,b,d,!0,a,c);case 19:return Sh(a,b,c)}throw Error(p(156,b.tag))};var lf=null,mf=null;function jk(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=b.inject(a);lf=function(d){try{b.onCommitFiberRoot(c,d,void 0,64===(d.current.effectTag&64))}catch(e){}},mf=function(d){try{b.onCommitFiberUnmount(c,d)}catch(e){}}}catch(d){}return!0}function kk(a,b,c,d){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function oa(a,b,c,d){return new kk(a,b,c,d)}function nf(a){return a=a.prototype,!(!a||!a.isReactComponent)}function lk(a){if("function"===typeof a)return nf(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===Bd)return 11;if(a===Dd)return 14}return 2}function bb(a,b){var c=a.alternate;return null===c?(c=oa(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=null,c.lastEffect=null),c.childExpirationTime=a.childExpirationTime,c.expirationTime=a.expirationTime,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,b=a.dependencies,c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c}function qd(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)nf(a)&&(g=1);else if("string"===typeof a)g=5;else s:switch(a){case ya:return Qa(c.children,e,f,b);case Ii:g=8,e|=7;break;case Af:g=8,e|=1;break;case vc:return a=oa(12,c,b,e|8),a.elementType=vc,a.type=vc,a.expirationTime=f,a;case wc:return a=oa(13,c,b,e),a.type=wc,a.elementType=wc,a.expirationTime=f,a;case Cd:return a=oa(19,c,b,e),a.elementType=Cd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Bf:g=10;break s;case Cf:g=9;break s;case Bd:g=11;break s;case Dd:g=14;break s;case Df:g=16,d=null;break s}throw Error(p(130,null==a?a:typeof a,""))}return b=oa(g,c,b,e),b.elementType=a,b.type=d,b.expirationTime=f,b}function Qa(a,b,c,d){return a=oa(7,a,d,b),a.expirationTime=c,a}function of(a,b,c){return a=oa(6,a,null,b),a.expirationTime=c,a}function pf(a,b,c){return b=oa(4,null!==a.children?a.children:[],a.key,b),b.expirationTime=c,b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},b}function mk(a,b,c){this.tag=b,this.current=null,this.containerInfo=a,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=c,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function qi(a,b){var c=a.firstSuspendedTime;return a=a.lastSuspendedTime,0!==c&&c>=b&&a<=b}function cb(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;c<b&&(a.firstSuspendedTime=b),(d>b||0===c)&&(a.lastSuspendedTime=b),b<=a.lastPingedTime&&(a.lastPingedTime=0),b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function ri(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function qf(a,b){var c=a.lastExpiredTime;(0===c||c>b)&&(a.lastExpiredTime=b)}function rd(a,b,c,d){var e=b.current,f=ea(),g=_b.suspense;f=_a(f,e,g);s:if(c){c=c._reactInternalFiber;$:{if(Sa(c)!==c||1!==c.tag)throw Error(p(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break $;case 1:if(S(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break $}}h=h.return}while(null!==h);throw Error(p(171))}if(1===c.tag){var i=c.type;if(S(i)){c=Wg(c,i,h);break s}}c=h}else c=Ha;return null===b.context?b.context=c:b.pendingContext=c,b=Ja(f,g),b.payload={element:a},d=void 0===d?null:d,null!==d&&(b.callback=d),Ka(e,b),Oa(e,f),f}function rf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function si(a,b){a=a.memoizedState,null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function sf(a,b){si(a,b),(a=a.alternate)&&si(a,b)}function nk(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}dg=function(a){if(13===a.tag){var b=Qc(ea(),150,100);Oa(a,b),sf(a,b)}},Vd=function(a){if(13===a.tag){ea();var b=Uj++;Oa(a,b),sf(a,b)}},eg=function(a){if(13===a.tag){var b=ea();b=_a(b,a,null),Oa(a,b),sf(a,b)}},Fd=function(a,b,c){switch(b){case"input":Od(a,c),b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]'),b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=te(d);if(!e)throw Error(p(90));Of(d),Od(d,e)}}}break;case"textarea":Tf(a,c);break;case"select":b=c.value,null!=b&&jb(a,!!c.multiple,b,!1)}};function tf(a,b,c){c=null!=c&&!0===c.hydrate;var d=new mk(a,b,c),e=oa(3,null,null,2===b?7:1===b?3:0);d.current=e,e.stateNode=d,a[se]=d.current,c&&0!==b&&Si(9===a.nodeType?a:a.ownerDocument),this._internalRoot=d}tf.prototype.render=function(a,b){var c=this._internalRoot;rd(a,c,null,void 0===b?null:b)},tf.prototype.unmount=function(a){var b=this._internalRoot;rd(null,b,null,void 0===a?null:a)};function nc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}Gd=hi,If=function(a,b,c,d){var e=v;v|=4;try{return rb(98,a.bind(null,b,c,d))}finally{v=e,v===J&&ha()}},Hd=function(){(v&(1|da|na))===J&&(bk(),Bb())},Jf=function(a,b){var c=v;v|=2;try{return a(b)}finally{v=c,v===J&&ha()}};function ok(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new tf(a,0,b?{hydrate:!0}:void 0)}function sd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;if("function"===typeof e){var h=e;e=function(){var k=rf(g);h.call(k)}}rd(b,g,a,e)}else{f=c._reactRootContainer=ok(c,d),g=f._internalRoot;if("function"===typeof e){var i=e;e=function(){var k=rf(g);i.call(k)}}ii(function(){rd(b,g,a,e)})}return rf(g)}function ti(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nc(b))throw Error(p(200));return nk(a,b,null,c)}var ui={createPortal:ti,findDOMNode:function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===b)throw"function"===typeof a.render?Error(p(188)):Error(p(268,Object.keys(a)));return a=cg(b),a=null===a?null:a.stateNode,a},hydrate:function(a,b,c){if(!nc(b))throw Error(p(200));return sd(null,a,b,!0,c)},render:function(a,b,c){if(!nc(b))throw Error(p(200));return sd(null,a,b,!1,c)},unstable_renderSubtreeIntoContainer:function(a,b,c,d){if(!nc(c))throw Error(p(200));if(null==a||void 0===a._reactInternalFiber)throw Error(p(38));return sd(a,b,c,!1,d)},unmountComponentAtNode:function(a){if(!nc(a))throw Error(p(40));return a._reactRootContainer?(ii(function(){sd(null,null,a,!1,function(){a._reactRootContainer=null})}),!0):!1},unstable_createPortal:function(){return ti.apply(void 0,arguments)},unstable_batchedUpdates:hi,flushSync:function(a,b){if((v&(da|na))!==J)throw Error(p(187));var c=v;v|=1;try{return rb(99,a.bind(null,b))}finally{v=c,ha()}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[Sb,Ta,te,Ad.injectEventPluginsByName,vd,lb,function(a){zd(a,Xi)},Gf,Hf,Hc,tc,Bb,{current:!1}]}};(function(a){var b=a.findFiberByHostInstance;return jk(O({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:aa.ReactCurrentDispatcher,findHostInstanceByFiber:function(c){return c=cg(c),null===c?null:c.stateNode},findFiberByHostInstance:function(c){return b?b(c):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Rb,bundleType:0,version:"16.11.0",rendererPackageName:"react-dom"});var vi={default:ui},wi=vi&&ui||vi;Bi.exports=wi.default||wi},375(e,c){"use strict";function a(){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__==="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!=="function")return;try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(d){console.error(d)}}a(),c.exports=k$(374)},21(f,c){"use strict";c.exports=function h(d,e){return function i(){for(var b=new Array(arguments.length),a=0;a<b.length;a++)b[a]=arguments[a];return d.apply(e,b)}}},31(c,b){b.exports=function e(a){return a!=null&&a.constructor!=null&&typeof a.constructor.isBuffer==="function"&&a.constructor.isBuffer(a)}},30(F,o){"use strict";var p=k$(21),q=k$(31),f=Object.prototype.toString;function k(a){return f.call(a)==="[object Array]"}function r(a){return f.call(a)==="[object ArrayBuffer]"}function s(a){return typeof FormData!=="undefined"&&a instanceof FormData}function t(a){var e;return typeof ArrayBuffer!=="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(a):e=a&&a.buffer&&a.buffer instanceof ArrayBuffer,e}function u(a){return typeof a==="string"}function v(a){return typeof a==="number"}function w(a){return typeof a==="undefined"}function l(a){return a!==null&&typeof a==="object"}function x(a){return f.call(a)==="[object Date]"}function y(a){return f.call(a)==="[object File]"}function z(a){return f.call(a)==="[object Blob]"}function m(a){return f.call(a)==="[object Function]"}function A(a){return l(a)&&m(a.pipe)}function B(a){return typeof URLSearchParams!=="undefined"&&a instanceof URLSearchParams}function C(a){return a.replace(/^\s*/,"").replace(/\s*$/,"")}function D(){return typeof navigator!=="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!=="undefined"&&typeof document!=="undefined"}function h(a,e){if(a===null||typeof a==="undefined")return;typeof a!=="object"&&(a=[a]);if(k(a))for(var c=0,g=a.length;c<g;c++)e.call(null,a[c],c,a);else for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&e.call(null,a[b],b,a)}function n(){var a={};function e(b,d){typeof a[d]==="object"&&typeof b==="object"?a[d]=n(a[d],b):a[d]=b}for(var c=0,g=arguments.length;c<g;c++)h(arguments[c],e);return a}function i(){var a={};function e(b,d){typeof a[d]==="object"&&typeof b==="object"?a[d]=i(a[d],b):typeof b==="object"?a[d]=i({},b):a[d]=b}for(var c=0,g=arguments.length;c<g;c++)h(arguments[c],e);return a}function E(a,e,c){return h(e,function g(b,d){c&&typeof b==="function"?a[d]=p(b,c):a[d]=b}),a}o.exports={isArray:k,isArrayBuffer:r,isBuffer:q,isFormData:s,isArrayBufferView:t,isString:u,isNumber:v,isObject:l,isUndefined:w,isDate:x,isFile:y,isBlob:z,isFunction:m,isStream:A,isURLSearchParams:B,isStandardBrowserEnv:D,forEach:h,merge:n,deepMerge:i,extend:E,trim:C}},22(o,n){"use strict";var c=k$(30);function h(i){return encodeURIComponent(i).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}n.exports=function i(a,e,j){if(!e)return a;var f;if(j)f=j(e);else if(c.isURLSearchParams(e))f=e.toString();else{var k=[];c.forEach(e,function p(d,g){if(d===null||typeof d==="undefined")return;c.isArray(d)?g=g+"[]":d=[d],c.forEach(d,function q(b){c.isDate(b)?b=b.toISOString():c.isObject(b)&&(b=JSON.stringify(b)),k.push(h(g)+"="+h(b))})}),f=k.join("&")}if(f){var l=a.indexOf("#");l!==-1&&(a=a.slice(0,l)),a+=(a.indexOf("?")===-1?"?":"&")+f}return a}},13(i,g){"use strict";var h=k$(30);function b(){this.handlers=[]}b.prototype.use=function c(a,d){return this.handlers.push({fulfilled:a,rejected:d}),this.handlers.length-1},b.prototype.eject=function c(a){this.handlers[a]&&(this.handlers[a]=null)},b.prototype.forEach=function c(a){h.forEach(this.handlers,function d(e){e!==null&&a(e)})},g.exports=b},19(h,c){"use strict";var d=k$(30);c.exports=function i(a,e,f){return d.forEach(f,function j(g){a=g(a,e)}),a}},11(c,b){"use strict";b.exports=function e(a){return!!(a&&a.__CANCEL__)}},27(h,e){"use strict";var f=k$(30);e.exports=function i(a,b){f.forEach(a,function j(g,c){c!==b&&c.toUpperCase()===b.toUpperCase()&&(a[b]=g,delete a[c])})}},16(g,c){"use strict";c.exports=function i(a,d,b,e,f){return a.config=d,b&&(a.code=b),a.request=e,a.response=f,a.isAxiosError=!0,a.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},a}},14(j,b){"use strict";var c=k$(16);b.exports=function k(d,e,f,g,h){var i=new Error(d);return c(i,e,f,g,h)}},18(h,d){"use strict";var e=k$(14);d.exports=function i(f,g,a){var b=a.config.validateStatus;!b||b(a.status)?f(a):g(e("Request failed with status code "+a.status,a.config,null,a.request,a))}},28(k,i){"use strict";var d=k$(30),j=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];i.exports=function l(g){var b={},a,c,e;return g?(d.forEach(g.split(`
`),function m(f){e=f.indexOf(":"),a=d.trim(f.substr(0,e)).toLowerCase(),c=d.trim(f.substr(e+1));if(a){if(b[a]&&j.indexOf(a)>=0)return;a==="set-cookie"?b[a]=(b[a]?b[a]:[]).concat([c]):b[a]=b[a]?b[a]+", "+c:c}}),b):b}},26(l,j){"use strict";var d=k$(30);j.exports=d.isStandardBrowserEnv()?function k(){var e=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a"),c;function f(g){var b=g;return e&&(a.setAttribute("href",b),b=a.href),a.setAttribute("href",b),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return c=f(window.location.href),function g(b){var h=d.isString(b)?f(b):b;return h.protocol===c.protocol&&h.host===c.host}}():function k(){return function e(){return!0}}()},24(m,j){"use strict";var d=k$(30);j.exports=d.isStandardBrowserEnv()?function k(){return{write:function b(c,e,f,g,h,l){var a=[];a.push(c+"="+encodeURIComponent(e)),d.isNumber(f)&&a.push("expires="+new Date(f).toGMTString()),d.isString(g)&&a.push("path="+g),d.isString(h)&&a.push("domain="+h),l===!0&&a.push("secure"),document.cookie=a.join("; ")},read:function b(c){var e=document.cookie.match(new RegExp("(^|;\\s*)("+c+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function b(c){this.write(c,"",Date.now()-8.64e07)}}}():function k(){return{write:function b(){},read:function b(){return null},remove:function b(){}}}()},7(w,m){"use strict";var j=k$(30),n=k$(18),o=k$(22),p=k$(28),q=k$(26),k=k$(14);m.exports=function x(b){return new Promise(function y(r,e){var f=b.data,g=b.headers;j.isFormData(f)&&delete g["Content-Type"];var a=new XMLHttpRequest();if(b.auth){var s=b.auth.username||"",t=b.auth.password||"";g.Authorization="Basic "+btoa(s+":"+t)}a.open(b.method.toUpperCase(),o(b.url,b.params,b.paramsSerializer),!0),a.timeout=b.timeout,a.onreadystatechange=function d(){if(!a||a.readyState!==4)return;if(a.status===0&&!(a.responseURL&&a.responseURL.indexOf("file:")===0))return;var h="getAllResponseHeaders"in a?p(a.getAllResponseHeaders()):null,i=!b.responseType||b.responseType==="text"?a.responseText:a.response,v={data:i,status:a.status,statusText:a.statusText,headers:h,config:b,request:a};n(r,e,v),a=null},a.onabort=function d(){if(!a)return;e(k("Request aborted",b,"ECONNABORTED",a)),a=null},a.onerror=function d(){e(k("Network Error",b,null,a)),a=null},a.ontimeout=function d(){e(k("timeout of "+b.timeout+"ms exceeded",b,"ECONNABORTED",a)),a=null};if(j.isStandardBrowserEnv()){var u=k$(24),l=(b.withCredentials||q(b.url))&&b.xsrfCookieName?u.read(b.xsrfCookieName):void 0;l&&(g[b.xsrfHeaderName]=l)}"setRequestHeader"in a&&j.forEach(g,function d(h,i){typeof f==="undefined"&&i.toLowerCase()==="content-type"?delete g[i]:a.setRequestHeader(i,h)}),b.withCredentials&&(a.withCredentials=!0);if(b.responseType)try{a.responseType=b.responseType}catch(d){if(b.responseType!=="json")throw d}typeof b.onDownloadProgress==="function"&&a.addEventListener("progress",b.onDownloadProgress),typeof b.onUploadProgress==="function"&&a.upload&&a.upload.addEventListener("progress",b.onUploadProgress),b.cancelToken&&b.cancelToken.promise.then(function d(h){if(!a)return;a.abort(),e(h),a=null}),f===void 0&&(f=null),a.send(f)})}},20(l,i){"use strict";var b=k$(30),g=k$(27),j={"Content-Type":"application/x-www-form-urlencoded"};function h(c,a){!b.isUndefined(c)&&b.isUndefined(c["Content-Type"])&&(c["Content-Type"]=a)}function k(){var c;return typeof process!=="undefined"&&Object.prototype.toString.call(process)==="[object process]"?c=k$(7):typeof XMLHttpRequest!=="undefined"&&(c=k$(7)),c}var f={adapter:k(),transformRequest:[function c(a,d){return g(d,"Accept"),g(d,"Content-Type"),b.isFormData(a)||b.isArrayBuffer(a)||b.isBuffer(a)||b.isStream(a)||b.isFile(a)||b.isBlob(a)?a:b.isArrayBufferView(a)?a.buffer:b.isURLSearchParams(a)?(h(d,"application/x-www-form-urlencoded;charset=utf-8"),a.toString()):b.isObject(a)?(h(d,"application/json;charset=utf-8"),JSON.stringify(a)):a}],transformResponse:[function c(a){if(typeof a==="string")try{a=JSON.parse(a)}catch(d){}return a}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function c(a){return a>=200&&a<300}};f.headers={common:{Accept:"application/json, text/plain, */*"}},b.forEach(["delete","get","head"],function c(a){f.headers[a]={}}),b.forEach(["post","put","patch"],function c(a){f.headers[a]=b.merge(j)}),i.exports=f},25(c,a){"use strict";a.exports=function e(b){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(b)}},23(d,c){"use strict";c.exports=function f(a,b){return b?a.replace(/\/+$/,"")+"/"+b.replace(/^\/+/,""):a}},15(o,i){"use strict";var g=k$(30),d=k$(19),j=k$(11),k=k$(20),l=k$(25),m=k$(23);function e(f){f.cancelToken&&f.cancelToken.throwIfRequested()}i.exports=function f(a){e(a),a.baseURL&&!l(a.url)&&(a.url=m(a.baseURL,a.url)),a.headers=a.headers||{},a.data=d(a.data,a.headers,a.transformRequest),a.headers=g.merge(a.headers.common||{},a.headers[a.method]||{},a.headers||{}),g.forEach(["delete","get","head","post","put","patch","common"],function h(b){delete a.headers[b]});var n=a.adapter||k.adapter;return n(a).then(function h(b){return e(a),b.data=d(b.data,b.headers,a.transformResponse),b},function h(b){return j(b)||(e(a),b&&b.response&&(b.response.data=d(b.response.data,b.response.headers,a.transformResponse))),Promise.reject(b)})}},17(i,h){"use strict";var d=k$(30);h.exports=function j(e,b){b=b||{};var c={};return d.forEach(["url","method","params","data"],function f(a){typeof b[a]!=="undefined"&&(c[a]=b[a])}),d.forEach(["headers","auth","proxy"],function f(a){d.isObject(b[a])?c[a]=d.deepMerge(e[a],b[a]):typeof b[a]!=="undefined"?c[a]=b[a]:d.isObject(e[a])?c[a]=d.deepMerge(e[a]):typeof e[a]!=="undefined"&&(c[a]=e[a])}),d.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],function f(a){typeof b[a]!=="undefined"?c[a]=b[a]:typeof e[a]!=="undefined"&&(c[a]=e[a])}),c}},12(o,l){"use strict";var h=k$(30),m=k$(22),j=k$(13),n=k$(15),k=k$(17);function e(f){this.defaults=f,this.interceptors={request:new j(),response:new j()}}e.prototype.request=function f(a){typeof a==="string"?(a=arguments[1]||{},a.url=arguments[0]):a=a||{},a=k(this.defaults,a),a.method=a.method?a.method.toLowerCase():"get";var b=[n,void 0],c=Promise.resolve(a);for(this.interceptors.request.forEach(function i(g){b.unshift(g.fulfilled,g.rejected)}),this.interceptors.response.forEach(function i(g){b.push(g.fulfilled,g.rejected)});b.length;)c=c.then(b.shift(),b.shift());return c},e.prototype.getUri=function f(a){return a=k(this.defaults,a),m(a.url,a.params,a.paramsSerializer).replace(/^\?/,"")},h.forEach(["delete","get","head","options"],function f(a){e.prototype[a]=function(b,c){return this.request(h.merge(c||{},{method:a,url:b}))}}),h.forEach(["post","put","patch"],function f(a){e.prototype[a]=function(b,c,i){return this.request(h.merge(i||{},{method:a,url:b,data:c}))}}),l.exports=e},9(d,c){"use strict";function a(b){this.message=b}a.prototype.toString=function b(){return"Cancel"+(this.message?": "+this.message:"")},a.prototype.__CANCEL__=!0,c.exports=a},10(j,h){"use strict";var i=k$(9);function d(e){if(typeof e!=="function")throw new TypeError("executor must be a function.");var a;this.promise=new Promise(function f(c){a=c});var b=this;e(function f(c){if(b.reason)return;b.reason=new i(c),a(b.reason)})}d.prototype.throwIfRequested=function e(){if(this.reason)throw this.reason},d.source=function e(){var a,b=new d(function f(c){a=c});return{token:b,cancel:a}},h.exports=d},29(d,a){"use strict";a.exports=function f(b){return function g(c){return b.apply(null,c)}}},8(m,g){"use strict";var h=k$(30),j=k$(21),d=k$(12),k=k$(17),l=k$(20);function i(e){var c=new d(e),f=j(d.prototype.request,c);return h.extend(f,d.prototype,c),h.extend(f,c),f}var a=i(l);a.Axios=d,a.create=function e(c){return i(k(a.defaults,c))},a.Cancel=k$(9),a.CancelToken=k$(10),a.isCancel=k$(11),a.all=function e(c){return Promise.all(c)},a.spread=k$(29),g.exports=a,g.exports.default=a},6(c,b){b.exports=k$(8)},373(c,a){"use strict";var b="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";a.exports=b},371(k,h){"use strict";var i=k$(373);function d(){}function e(){}e.resetWarningCache=d,h.exports=function(){function a(l,m,n,o,p,j){if(j===i)return;var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}a.isRequired=a;function b(){return a}var c={array:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:b,element:a,elementType:a,instanceOf:b,node:a,objectOf:b,oneOf:b,oneOfType:b,shape:b,exact:b,checkPropTypes:e,resetWarningCache:d};return c.PropTypes=c,c}},372(c,b){if(!1)var d,e;else b.exports=k$(371)()},387(r,n){"use strict";function h(b){return"/"===b.charAt(0)}function i(b,c){for(var d=c,e=d+1,a=b.length;e<a;d+=1,e+=1)b[d]=b[e];b.pop()}function o(b,c){void 0===c&&(c="");var d,e=b&&b.split("/")||[],a=c&&c.split("/")||[],p=b&&h(b),q=c&&h(c),l=p||q;if(b&&h(b)?a=e:e.length&&(a.pop(),a=a.concat(e)),!a.length)return"/";if(a.length){var j=a[a.length-1];d="."===j||".."===j||""===j}else d=!1;for(var g=0,f=a.length;0<=f;f--){var m=a[f];"."===m?i(a,f):".."===m?(i(a,f),g++):g&&(i(a,f),g--)}if(!l)for(;g--;g)a.unshift("..");!l||""===a[0]||a[0]&&h(a[0])||a.unshift("");var k=a.join("/");return d&&"/"!==k.substr(-1)&&(k+="/"),k}n.exports=o},388(c,b){"use strict";b.exports=k$(387)},393(j,h){"use strict";function e(a){return a.valueOf?a.valueOf():Object.prototype.valueOf.call(a)}function c(a,b){if(a===b)return!0;if(null==a||null==b)return!1;if(Array.isArray(a))return Array.isArray(b)&&a.length===b.length&&a.every(function(d,i){return c(d,b[i])});if("object"!=typeof a&&"object"!=typeof b)return!1;var f=e(a),g=e(b);return f!==a||g!==b?c(f,g):Object.keys(Object.assign({},a,b)).every(function(d){return c(a[d],b[d])})}h.exports=c},394(c,b){"use strict";b.exports=k$(393)},392(g,b){"use strict";var c=!0;function d(e,f){if(!c){if(e)return;var a="Warning: "+f;typeof console!=="undefined"&&console.warn(a);try{throw Error(a)}catch(i){}}}b.exports=d},391(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=!0,b="Invariant failed";function d(e,f){if(e)return;throw c?new Error(b):new Error(b+": "+(f||""))}a.default=d},365(I){"use strict";function S(a){return a&&"object"==typeof a&&"default"in a?a.default:a}Object.defineProperty(I,"__esModule",{value:!0});var ga=S(k$(388)),ha=S(k$(394));k$(392);var V=S(k$(391));function O(){return(O=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var e=arguments[b];for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(a[f]=e[f])}return a}).apply(this,arguments)}function P(a){return"/"===a.charAt(0)?a:"/"+a}function W(a){return"/"===a.charAt(0)?a.substr(1):a}function ia(a,b){return 0===a.toLowerCase().indexOf(b.toLowerCase())&&-1!=="/?#".indexOf(a.charAt(b.length))}function X(a,b){return ia(a,b)?a.substr(b.length):a}function Y(a){return"/"===a.charAt(a.length-1)?a.slice(0,-1):a}function Z(a){var b=a||"/",e="",f="",c=b.indexOf("#");-1!==c&&(f=b.substr(c),b=b.substr(0,c));var k=b.indexOf("?");return-1!==k&&(e=b.substr(k),b=b.substr(0,k)),{pathname:b,search:"?"===e?"":e,hash:"#"===f?"":f}}function z(a){var b=a.pathname,e=a.search,f=a.hash,c=b||"/";return e&&"?"!==e&&(c+="?"===e.charAt(0)?e:"?"+e),f&&"#"!==f&&(c+="#"===f.charAt(0)?f:"#"+f),c}function E(a,b,e,f){var c;"string"==typeof a?(c=Z(a)).state=b:(void 0===(c=O({},a)).pathname&&(c.pathname=""),c.search?"?"!==c.search.charAt(0)&&(c.search="?"+c.search):c.search="",c.hash?"#"!==c.hash.charAt(0)&&(c.hash="#"+c.hash):c.hash="",void 0!==b&&void 0===c.state&&(c.state=b));try{c.pathname=decodeURI(c.pathname)}catch(k){throw k instanceof URIError?new URIError('Pathname "'+c.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):k}return e&&(c.key=e),f?c.pathname?"/"!==c.pathname.charAt(0)&&(c.pathname=ga(c.pathname,f.pathname)):c.pathname=f.pathname:c.pathname||(c.pathname="/"),c}function ja(a,b){return a.pathname===b.pathname&&a.search===b.search&&a.hash===b.hash&&a.key===b.key&&ha(a.state,b.state)}function T(){var a=null,b=[];return{setPrompt:function(e){return a=e,function(){a===e&&(a=null)}},confirmTransitionTo:function(e,f,c,k){if(null!=a){var F="function"==typeof a?a(e,f):a;"string"==typeof F?"function"==typeof c?c(F,k):k(!0):k(!1!==F)}else k(!0)},appendListener:function(e){var f=!0;function c(){f&&e.apply(void 0,arguments)}return b.push(c),function(){f=!1,b=b.filter(function(k){return k!==c})}},notifyListeners:function(){for(var e=arguments.length,f=new Array(e),c=0;c<e;c++)f[c]=arguments[c];b.forEach(function(k){return k.apply(void 0,f)})}}}var _=!("undefined"==typeof window||!window.document||!window.document.createElement);function $(a,b){b(window.confirm(a))}function ka(){var a=window.navigator.userAgent;return(-1===a.indexOf("Android 2.")&&-1===a.indexOf("Android 4.0")||-1===a.indexOf("Mobile Safari")||-1!==a.indexOf("Chrome")||-1!==a.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}function la(){return-1===window.navigator.userAgent.indexOf("Trident")}function ma(){return-1===window.navigator.userAgent.indexOf("Firefox")}function na(a){return void 0===a.state&&-1===navigator.userAgent.indexOf("CriOS")}var aa="popstate",ba="hashchange";function ca(){try{return window.history.state||{}}catch(a){return{}}}function oa(a){void 0===a&&(a={}),_||V(!1);var b=window.history,e=ka(),f=!la(),c=a,k=c.forceRefresh,F=void 0!==k&&k,C=c.getUserConfirmation,J=void 0===C?$:C,v=c.keyLength,K=void 0===v?6:v,D=a.basename?Y(P(a.basename)):"";function w(d){var o=d||{},h=o.key,j=o.state,p=window.location,n=p.pathname+p.search+p.hash;return D&&(n=X(n,D)),E(n,j,h)}function A(){return Math.random().toString(36).substr(2,K)}var x=T();function y(d){O(m,d),m.length=b.length,x.notifyListeners(m.location,m.action)}function l(d){na(d)||t(w(d.state))}function i(){t(w(ca()))}var s=!1;function t(d){s?(s=!1,y()):x.confirmTransitionTo(d,"POP",J,function(o){o?y({action:"POP",location:d}):function(h){var j=m.location,p=q.indexOf(j.key);-1===p&&(p=0);var n=q.indexOf(h.key);-1===n&&(n=0);var G=p-n;G&&(s=!0,H(G))}(d)})}var r=w(ca()),q=[r.key];function B(d){return D+z(d)}function H(d){b.go(d)}var M=0;function u(d){1===(M+=d)&&1===d?(window.addEventListener(aa,l),f&&window.addEventListener(ba,i)):0===M&&(window.removeEventListener(aa,l),f&&window.removeEventListener(ba,i))}var g=!1,m={length:b.length,action:"POP",location:r,createHref:B,push:function(d,o){var h=E(d,o,A(),m.location);x.confirmTransitionTo(h,"PUSH",J,function(j){if(j){var p=B(h),n=h.key,G=h.state;if(e)if(b.pushState({key:n,state:G},null,p),F)window.location.href=p;else{var N=q.indexOf(m.location.key),L=q.slice(0,N+1);L.push(h.key),q=L,y({action:"PUSH",location:h})}else window.location.href=p}})},replace:function(d,o){var h="REPLACE",j=E(d,o,A(),m.location);x.confirmTransitionTo(j,h,J,function(p){if(p){var n=B(j),G=j.key,N=j.state;if(e)if(b.replaceState({key:G,state:N},null,n),F)window.location.replace(n);else{var L=q.indexOf(m.location.key);-1!==L&&(q[L]=j.key),y({action:h,location:j})}else window.location.replace(n)}})},go:H,goBack:function(){H(-1)},goForward:function(){H(1)},block:function(d){void 0===d&&(d=!1);var o=x.setPrompt(d);return g||(u(1),g=!0),function(){return g&&(g=!1,u(-1)),o()}},listen:function(d){var o=x.appendListener(d);return u(1),function(){u(-1),o()}}};return m}var da="hashchange",pa={hashbang:{encodePath:function(a){return"!"===a.charAt(0)?a:"!/"+W(a)},decodePath:function(a){return"!"===a.charAt(0)?a.substr(1):a}},noslash:{encodePath:W,decodePath:P},slash:{encodePath:P,decodePath:P}};function ea(a){var b=a.indexOf("#");return-1===b?a:a.slice(0,b)}function Q(){var a=window.location.href,b=a.indexOf("#");return-1===b?"":a.substring(b+1)}function qa(a){window.location.hash=a}function U(a){window.location.replace(ea(window.location.href)+"#"+a)}function ra(a){void 0===a&&(a={}),_||V(!1);var b=window.history,e=(ma(),a),f=e.getUserConfirmation,c=void 0===f?$:f,k=e.hashType,F=void 0===k?"slash":k,C=a.basename?Y(P(a.basename)):"",J=pa[F],v=J.encodePath,K=J.decodePath;function D(){var g=K(Q());return C&&(g=X(g,C)),E(g)}var w=T();function A(g){O(u,g),u.length=b.length,w.notifyListeners(u.location,u.action)}var x=!1,y=null;function l(){var g=Q(),m=v(g);if(g!==m)U(m);else{var d=D(),o=u.location;if(!x&&function(h,j){return h.pathname===j.pathname&&h.search===j.search&&h.hash===j.hash}(o,d))return;if(y===z(d))return;y=null,function(h){x?(x=!1,A()):w.confirmTransitionTo(h,"POP",c,function(j){j?A({action:"POP",location:h}):function(p){var n=u.location,G=r.lastIndexOf(z(n));-1===G&&(G=0);var N=r.lastIndexOf(z(p));-1===N&&(N=0);var L=G-N;L&&(x=!0,q(L))}(h)})}(d)}}var i=Q(),s=v(i);i!==s&&U(s);var t=D(),r=[z(t)];function q(g){b.go(g)}var B=0;function H(g){1===(B+=g)&&1===g?window.addEventListener(da,l):0===B&&window.removeEventListener(da,l)}var M=!1,u={length:b.length,action:"POP",location:t,createHref:function(g){var m=document.querySelector("base"),d="";return m&&m.getAttribute("href")&&(d=ea(window.location.href)),d+"#"+v(C+z(g))},push:function(g,m){var d=E(g,void 0,void 0,u.location);w.confirmTransitionTo(d,"PUSH",c,function(o){if(o){var h=z(d),j=v(C+h);if(Q()!==j){y=h,qa(j);var p=r.lastIndexOf(z(u.location)),n=r.slice(0,p+1);n.push(h),r=n,A({action:"PUSH",location:d})}else A()}})},replace:function(g,m){var d="REPLACE",o=E(g,void 0,void 0,u.location);w.confirmTransitionTo(o,d,c,function(h){if(h){var j=z(o),p=v(C+j);Q()!==p&&(y=j,U(p));var n=r.indexOf(z(u.location));-1!==n&&(r[n]=j),A({action:d,location:o})}})},go:q,goBack:function(){q(-1)},goForward:function(){q(1)},block:function(g){void 0===g&&(g=!1);var m=w.setPrompt(g);return M||(H(1),M=!0),function(){return M&&(M=!1,H(-1)),m()}},listen:function(g){var m=w.appendListener(g);return H(1),function(){H(-1),m()}}};return u}function fa(a,b,e){return Math.min(Math.max(a,b),e)}function sa(a){void 0===a&&(a={});var b=a,e=b.getUserConfirmation,f=b.initialEntries,c=void 0===f?["/"]:f,k=b.initialIndex,F=void 0===k?0:k,C=b.keyLength,J=void 0===C?6:C,v=T();function K(i){O(l,i),l.length=l.entries.length,v.notifyListeners(l.location,l.action)}function D(){return Math.random().toString(36).substr(2,J)}var w=fa(F,0,c.length-1),A=c.map(function(i){return E(i,void 0,"string"==typeof i?D():i.key||D())}),x=z;function y(i){var s=fa(l.index+i,0,l.entries.length-1),t=l.entries[s];v.confirmTransitionTo(t,"POP",e,function(r){r?K({action:"POP",location:t,index:s}):K()})}var l={length:A.length,action:"POP",location:A[w],index:w,entries:A,createHref:x,push:function(i,s){var t=E(i,s,D(),l.location);v.confirmTransitionTo(t,"PUSH",e,function(r){if(r){var q=l.index+1,B=l.entries.slice(0);B.length>q?B.splice(q,B.length-q,t):B.push(t),K({action:"PUSH",location:t,index:q,entries:B})}})},replace:function(i,s){var t="REPLACE",r=E(i,s,D(),l.location);v.confirmTransitionTo(r,t,e,function(q){q&&(l.entries[l.index]=r,K({action:t,location:r}))})},go:y,goBack:function(){y(-1)},goForward:function(){y(1)},canGo:function(i){var s=l.index+i;return 0<=s&&s<l.entries.length},block:function(i){return void 0===i&&(i=!1),v.setPrompt(i)},listen:function(i){return v.appendListener(i)}};return l}I.createBrowserHistory=oa,I.createHashHistory=ra,I.createMemoryHistory=sa,I.createLocation=E,I.locationsAreEqual=ja,I.parsePath=Z,I.createPath=z},366(c,b){"use strict";b.exports=k$(365)},369(e,c){function d(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}c.exports=d},368(E,w){"use strict";function n(a){return a&&typeof a==="object"&&"default"in a?a.default:a}var q=k$(385),x=n(q),s=n(k$(369)),t=n(k$(372)),F=n(k$(392)),r=1073741823,u=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:{};function y(){var a="__global_unique_id__";return u[a]=(u[a]||0)+1}function z(a,e){return a===e?a!==0||1/a===1/e:a!==a&&e!==e}function A(a){var e=[];return{on:function i(f){e.push(f)},off:function i(f){e=e.filter(function(d){return d!==f})},get:function i(){return a},set:function i(f,d){a=f,e.forEach(function(o){return o(a,d)})}}}function B(a){return Array.isArray(a)?a[0]:a}function C(a,e){var i,f,d="__create-react-context-"+y()+"__",o=function(k){s(j,k);function j(){var b;return b=k.apply(this,arguments)||this,b.emitter=A(b.props.value),b}var g=j.prototype;return g.getChildContext=function b(){var c;return c={},c[d]=this.emitter,c},g.componentWillReceiveProps=function b(c){if(this.props.value!==c.value){var h=this.props.value,p=c.value,l;z(h,p)?l=0:(l=typeof e==="function"?e(h,p):r,l|=0,l!==0&&this.emitter.set(c.value,l))}},g.render=function b(){return this.props.children},j}(q.Component);o.childContextTypes=(i={},i[d]=t.object.isRequired,i);var v=function(k){s(j,k);function j(){var b;return b=k.apply(this,arguments)||this,b.state={value:b.getValue()},b.onUpdate=function(c,h){var p=b.observedBits|0;(p&h)!==0&&b.setState({value:b.getValue()})},b}var g=j.prototype;return g.componentWillReceiveProps=function b(c){var h=c.observedBits;this.observedBits=h===void 0||h===null?r:h},g.componentDidMount=function b(){this.context[d]&&this.context[d].on(this.onUpdate);var c=this.props.observedBits;this.observedBits=c===void 0||c===null?r:c},g.componentWillUnmount=function b(){this.context[d]&&this.context[d].off(this.onUpdate)},g.getValue=function b(){return this.context[d]?this.context[d].get():a},g.render=function b(){return B(this.props.children)(this.state.value)},j}(q.Component);return v.contextTypes=(f={},f[d]=t.object,f),{Provider:o,Consumer:v}}var D=x.createContext||C;w.exports=D},382(c,a){a.exports=Array.isArray||function(b){return Object.prototype.toString.call(b)=="[object Array]"}},383(P,p){var q=k$(382);p.exports=y,p.exports.parse=t,p.exports.compile=E,p.exports.tokensToFunction=w,p.exports.tokensToRegExp=x;var D=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function t(a,b){for(var c=[],g=0,j=0,e="",l=b&&b.delimiter||"/",f;(f=D.exec(a))!=null;){var n=f[0],h=f[1],i=f.index;e+=a.slice(j,i),j=i+n.length;if(h){e+=h[1];continue}var d=a[j],k=f[2],m=f[3],o=f[4],L=f[5],s=f[6],z=f[7];e&&(c.push(e),e="");var M=k!=null&&d!=null&&d!==k,N=s==="+"||s==="*",O=s==="?"||s==="*",A=f[2]||l,B=o||L;c.push({name:m||g++,prefix:k||"",delimiter:A,optional:O,repeat:N,partial:M,asterisk:!!z,pattern:B?H(B):z?".*":"[^"+r(A)+"]+?"})}return j<a.length&&(e+=a.substr(j)),e&&c.push(e),c}function E(a,b){return w(t(a,b),b)}function F(a){return encodeURI(a).replace(/[\/?#]/g,function(b){return"%"+b.charCodeAt(0).toString(16).toUpperCase()})}function G(a){return encodeURI(a).replace(/[?#]/g,function(b){return"%"+b.charCodeAt(0).toString(16).toUpperCase()})}function w(a,b){for(var c=new Array(a.length),g=0;g<a.length;g++)typeof a[g]==="object"&&(c[g]=new RegExp("^(?:"+a[g].pattern+")$",v(b)));return function(j,e){for(var l="",f=j||{},n=e||{},h=n.pretty?F:encodeURIComponent,i=0;i<a.length;i++){var d=a[i];if(typeof d==="string"){l+=d;continue}var k=f[d.name],m;if(k==null)if(d.optional){d.partial&&(l+=d.prefix);continue}else throw new TypeError('Expected "'+d.name+'" to be defined');if(q(k)){if(!d.repeat)throw new TypeError('Expected "'+d.name+'" to not repeat, but received `'+JSON.stringify(k)+"`");if(k.length===0){if(d.optional)continue;throw new TypeError('Expected "'+d.name+'" to not be empty')}for(var o=0;o<k.length;o++){m=h(k[o]);if(!c[i].test(m))throw new TypeError('Expected all "'+d.name+'" to match "'+d.pattern+'", but received `'+JSON.stringify(m)+"`");l+=(o===0?d.prefix:d.delimiter)+m}continue}m=d.asterisk?G(k):h(k);if(!c[i].test(m))throw new TypeError('Expected "'+d.name+'" to match "'+d.pattern+'", but received "'+m+'"');l+=d.prefix+m}return l}}function r(a){return a.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function H(a){return a.replace(/([=!:$\/()])/g,"\\$1")}function u(a,b){return a.keys=b,a}function v(a){return a&&a.sensitive?"":"i"}function I(a,b){var c=a.source.match(/\((?!\?)/g);if(c)for(var g=0;g<c.length;g++)b.push({name:g,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return u(a,b)}function J(a,b,c){for(var g=[],j=0;j<a.length;j++)g.push(y(a[j],b,c).source);var e=new RegExp("(?:"+g.join("|")+")",v(c));return u(e,b)}function K(a,b,c){return x(t(a,c),b,c)}function x(a,b,c){q(b)||(c=b||c,b=[]),c=c||{};for(var g=c.strict,j=c.end!==!1,e="",l=0;l<a.length;l++){var f=a[l];if(typeof f==="string")e+=r(f);else{var n=r(f.prefix),h="(?:"+f.pattern+")";b.push(f),f.repeat&&(h+="(?:"+n+h+")*"),f.optional?f.partial?h=n+"("+h+")?":h="(?:"+n+"("+h+"))?":h=n+"("+h+")",e+=h}}var i=r(c.delimiter||"/"),d=e.slice(-i.length)===i;return g||(e=(d?e.slice(0,-i.length):e)+"(?:"+i+"(?=$))?"),j?e+="$":e+=g&&d?"":"(?="+i+"|$)",u(new RegExp("^"+e,v(c)),b)}function y(a,b,c){return q(b)||(c=b||c,b=[]),c=c||{},a instanceof RegExp?I(a,b):q(a)?J(a,b,c):K(a,b,c)}},376(b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c="function"===typeof Symbol&&Symbol.for,o=c?Symbol.for("react.element"):60103,p=c?Symbol.for("react.portal"):60106,e=c?Symbol.for("react.fragment"):60107,f=c?Symbol.for("react.strict_mode"):60108,g=c?Symbol.for("react.profiler"):60114,h=c?Symbol.for("react.provider"):60109,i=c?Symbol.for("react.context"):60110,q=c?Symbol.for("react.async_mode"):60111,j=c?Symbol.for("react.concurrent_mode"):60111,k=c?Symbol.for("react.forward_ref"):60112,l=c?Symbol.for("react.suspense"):60113,t=c?Symbol.for("react.suspense_list"):60120,m=c?Symbol.for("react.memo"):60115,n=c?Symbol.for("react.lazy"):60116,u=c?Symbol.for("react.fundamental"):60117,v=c?Symbol.for("react.responder"):60118,w=c?Symbol.for("react.scope"):60119;function d(a){if("object"===typeof a&&null!==a){var r=a.$$typeof;switch(r){case o:switch(a=a.type,a){case q:case j:case e:case g:case f:case l:return a;default:switch(a=a&&a.$$typeof,a){case i:case k:case h:return a;default:return r}}case n:case m:case p:return r}}}function s(a){return d(a)===j}b.typeOf=d,b.AsyncMode=q,b.ConcurrentMode=j,b.ContextConsumer=i,b.ContextProvider=h,b.Element=o,b.ForwardRef=k,b.Fragment=e,b.Lazy=n,b.Memo=m,b.Portal=p,b.Profiler=g,b.StrictMode=f,b.Suspense=l,b.isValidElementType=function(a){return"string"===typeof a||"function"===typeof a||a===e||a===j||a===g||a===f||a===l||a===t||"object"===typeof a&&null!==a&&(a.$$typeof===n||a.$$typeof===m||a.$$typeof===h||a.$$typeof===i||a.$$typeof===k||a.$$typeof===u||a.$$typeof===v||a.$$typeof===w)},b.isAsyncMode=function(a){return s(a)||d(a)===q},b.isConcurrentMode=s,b.isContextConsumer=function(a){return d(a)===i},b.isContextProvider=function(a){return d(a)===h},b.isElement=function(a){return"object"===typeof a&&null!==a&&a.$$typeof===o},b.isForwardRef=function(a){return d(a)===k},b.isFragment=function(a){return d(a)===e},b.isLazy=function(a){return d(a)===n},b.isMemo=function(a){return d(a)===m},b.isPortal=function(a){return d(a)===p},b.isProfiler=function(a){return d(a)===g},b.isStrictMode=function(a){return d(a)===f},b.isSuspense=function(a){return d(a)===l}},377(c,b){"use strict";b.exports=k$(376)},367(A,r){"use strict";var e=k$(377),s={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},t={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},u={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},j={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},f={};f[e.ForwardRef]=u,f[e.Memo]=j;function k(a){return e.isMemo(a)?j:f[a.$$typeof]||s}var v=Object.defineProperty,w=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,x=Object.getOwnPropertyDescriptor,y=Object.getPrototypeOf,m=Object.prototype;function n(a,b,g){if(typeof b!=="string"){if(m){var h=y(b);h&&h!==m&&n(a,h,g)}var d=w(b);l&&(d=d.concat(l(b)));for(var o=k(a),p=k(b),i=0;i<d.length;++i){var c=d[i];if(!t[c]&&!(g&&g[c])&&!(p&&p[c])&&!(o&&o[c])){var z=x(b,c);try{v(a,c,z)}catch(B){}}}}return a}r.exports=n},380(k){"use strict";function u(a){return a&&"object"==typeof a&&"default"in a?a.default:a}Object.defineProperty(k,"__esModule",{value:!0});var i=u(k$(385));k$(372);var q=k$(366);k$(392);var G=u(k$(368)),s=u(k$(391)),H=u(k$(383));k$(377);var S=u(k$(367));function o(){return(o=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}).apply(this,arguments)}function t(a,b){a.prototype=Object.create(b.prototype),(a.prototype.constructor=a).__proto__=b}function I(a,b){if(null==a)return{};var c,d,f={},e=Object.keys(a);for(d=0;d<e.length;d++)c=e[d],0<=b.indexOf(c)||(f[c]=a[c]);return f}var T=function(a){var b=G();return b.displayName=a,b},y=T("Router-History"),U=function(a){var b=G();return b.displayName=a,b},m=U("Router"),z=function(a){function b(d){var f;return(f=a.call(this,d)||this).state={location:d.history.location},f._isMounted=!1,f._pendingLocation=null,d.staticContext||(f.unlisten=d.history.listen(function(e){f._isMounted?f.setState({location:e}):f._pendingLocation=e})),f}t(b,a),b.computeRootMatch=function(d){return{path:"/",url:"/",params:{},isExact:"/"===d}};var c=b.prototype;return c.componentDidMount=function(){this._isMounted=!0,this._pendingLocation&&this.setState({location:this._pendingLocation})},c.componentWillUnmount=function(){this.unlisten&&this.unlisten()},c.render=function(){return i.createElement(m.Provider,{value:{history:this.props.history,location:this.state.location,match:b.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}},i.createElement(y.Provider,{children:this.props.children||null,value:this.props.history}))},b}(i.Component),V=function(a){function b(){for(var c,d=arguments.length,f=new Array(d),e=0;e<d;e++)f[e]=arguments[e];return(c=a.call.apply(a,[this].concat(f))||this).history=q.createMemoryHistory(c.props),c}return t(b,a),b.prototype.render=function(){return i.createElement(z,{history:this.history,children:this.props.children})},b}(i.Component),J=function(a){function b(){return a.apply(this,arguments)||this}t(b,a);var c=b.prototype;return c.componentDidMount=function(){this.props.onMount&&this.props.onMount.call(this,this)},c.componentDidUpdate=function(d){this.props.onUpdate&&this.props.onUpdate.call(this,this,d)},c.componentWillUnmount=function(){this.props.onUnmount&&this.props.onUnmount.call(this,this)},c.render=function(){return null},b}(i.Component);function W(a){var b=a.message,c=a.when,d=void 0===c||c;return i.createElement(m.Consumer,null,function(f){if(f||s(!1),!d||f.staticContext)return null;var e=f.history.block;return i.createElement(J,{onMount:function(g){g.release=e(b)},onUpdate:function(g,h){h.message!==b&&(g.release(),g.release=e(b))},onUnmount:function(g){g.release()},message:b})})}var A={},X=10000,K=0;function Y(a){if(A[a])return A[a];var b=H.compile(a);return K<X&&(A[a]=b,K++),b}function B(a,b){return void 0===a&&(a="/"),void 0===b&&(b={}),"/"===a?a:Y(a)(b,{pretty:!0})}function Z(a){var b=a.computedMatch,c=a.to,d=a.push,f=void 0!==d&&d;return i.createElement(m.Consumer,null,function(e){e||s(!1);var g=e.history,h=e.staticContext,j=f?g.push:g.replace,l=q.createLocation(b?"string"==typeof c?B(c,b.params):o({},c,{pathname:B(c.pathname,b.params)}):c);return h?(j(l),null):i.createElement(J,{onMount:function(){j(l)},onUpdate:function(v,p){var r=q.createLocation(p.to);q.locationsAreEqual(r,o({},l,{key:r.key}))||j(l)},to:c})})}var L={},_=10000,M=0;function $(a,b){var c=""+b.end+b.strict+b.sensitive,d=L[c]||(L[c]={});if(d[a])return d[a];var f=[],e={regexp:H(a,f,b),keys:f};return M<_&&(d[a]=e,M++),e}function w(a,b){void 0===b&&(b={}),"string"!=typeof b&&!Array.isArray(b)||(b={path:b});var c=b,d=c.path,f=c.exact,e=void 0!==f&&f,g=c.strict,h=void 0!==g&&g,j=c.sensitive,l=void 0!==j&&j;return[].concat(d).reduce(function(v,p){if(!p&&""!==p)return null;if(v)return v;var r=$(p,{end:e,strict:h,sensitive:l}),ja=r.regexp,ka=r.keys,E=ja.exec(a);if(!E)return null;var F=E[0],la=E.slice(1),Q=a===F;return e&&!Q?null:{path:p,url:"/"===p&&""===F?"/":F,isExact:Q,params:ka.reduce(function(R,ma,na){return R[ma.name]=la[na],R},{})}},null)}var aa=function(a){function b(){return a.apply(this,arguments)||this}return t(b,a),b.prototype.render=function(){var c=this;return i.createElement(m.Consumer,null,function(d){d||s(!1);var f=c.props.location||d.location,e=o({},d,{location:f,match:c.props.computedMatch?c.props.computedMatch:c.props.path?w(f.pathname,c.props):d.match}),g=c.props,h=g.children,j=g.component,l=g.render;return Array.isArray(h)&&0===h.length&&(h=null),i.createElement(m.Provider,{value:e},e.match?h?"function"==typeof h?h(e):h:j?i.createElement(j,e):l?l(e):null:"function"==typeof h?h(e):null)})},b}(i.Component);function C(a){return"/"===a.charAt(0)?a:"/"+a}function ba(a,b){return a?o({},b,{pathname:C(a)+b.pathname}):b}function ca(a,b){if(!a)return b;var c=C(a);return 0!==b.pathname.indexOf(c)?b:o({},b,{pathname:b.pathname.substr(c.length)})}function N(a){return"string"==typeof a?a:q.createPath(a)}function D(a){return function(){s(!1)}}function O(){}var da=function(a){function b(){for(var d,f=arguments.length,e=new Array(f),g=0;g<f;g++)e[g]=arguments[g];return(d=a.call.apply(a,[this].concat(e))||this).handlePush=function(h){return d.navigateTo(h,"PUSH")},d.handleReplace=function(h){return d.navigateTo(h,"REPLACE")},d.handleListen=function(){return O},d.handleBlock=function(){return O},d}t(b,a);var c=b.prototype;return c.navigateTo=function(d,f){var e=this.props,g=e.basename,h=void 0===g?"":g,j=e.context,l=void 0===j?{}:j;l.action=f,l.location=ba(h,q.createLocation(d)),l.url=N(l.location)},c.render=function(){var d=this.props,f=d.basename,e=void 0===f?"":f,g=d.context,h=void 0===g?{}:g,j=d.location,l=void 0===j?"/":j,v=I(d,["basename","context","location"]),p={createHref:function(r){return C(e+N(r))},action:"POP",location:ca(e,q.createLocation(l)),push:this.handlePush,replace:this.handleReplace,go:D(),goBack:D(),goForward:D(),listen:this.handleListen,block:this.handleBlock};return i.createElement(z,o({},v,{history:p,staticContext:h}))},b}(i.Component),ea=function(a){function b(){return a.apply(this,arguments)||this}return t(b,a),b.prototype.render=function(){var c=this;return i.createElement(m.Consumer,null,function(d){d||s(!1);var f,e,g=c.props.location||d.location;return i.Children.forEach(c.props.children,function(h){if(null==e&&i.isValidElement(h)){var j=(f=h).props.path||h.props.from;e=j?w(g.pathname,o({},h.props,{path:j})):d.match}}),e?i.cloneElement(f,{location:g,computedMatch:e}):null})},b}(i.Component);function fa(a){function b(d){var f=d.wrappedComponentRef,e=I(d,["wrappedComponentRef"]);return i.createElement(m.Consumer,null,function(g){return g||s(!1),i.createElement(a,o({},e,g,{ref:f}))})}var c="withRouter("+(a.displayName||a.name)+")";return b.displayName=c,b.WrappedComponent=a,S(b,a)}var x=i.useContext;function ga(){return x(y)}function P(){return x(m).location}function ha(){var a=x(m).match;return a?a.params:{}}function ia(a){var b=P(),c=x(m).match;return a?w(b.pathname,a):c}k.MemoryRouter=V,k.Prompt=W,k.Redirect=Z,k.Route=aa,k.Router=z,k.StaticRouter=da,k.Switch=ea,k.__HistoryContext=y,k.__RouterContext=m,k.generatePath=B,k.matchPath=w,k.useHistory=ga,k.useLocation=P,k.useParams=ha,k.useRouteMatch=ia,k.withRouter=fa},381(c,b){"use strict";b.exports=k$(380)},378(f){"use strict";function C(a){return a&&"object"==typeof a&&"default"in a?a.default:a}Object.defineProperty(f,"__esModule",{value:!0});var g=k$(381),j=C(k$(385)),v=k$(366);k$(372),k$(392);var D=C(k$(391));function p(){return(p=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}).apply(this,arguments)}function E(a,b){a.prototype=Object.create(b.prototype),(a.prototype.constructor=a).__proto__=b}function w(a,b){if(null==a)return{};var c,d,h={},e=Object.keys(a);for(d=0;d<e.length;d++)c=e[d],0<=b.indexOf(c)||(h[c]=a[c]);return h}var O=function(a){function b(){for(var c,d=arguments.length,h=new Array(d),e=0;e<d;e++)h[e]=arguments[e];return(c=a.call.apply(a,[this].concat(h))||this).history=v.createBrowserHistory(c.props),c}return E(b,a),b.prototype.render=function(){return j.createElement(g.Router,{history:this.history,children:this.props.children})},b}(j.Component),P=function(a){function b(){for(var c,d=arguments.length,h=new Array(d),e=0;e<d;e++)h[e]=arguments[e];return(c=a.call.apply(a,[this].concat(h))||this).history=v.createHashHistory(c.props),c}return E(b,a),b.prototype.render=function(){return j.createElement(g.Router,{history:this.history,children:this.props.children})},b}(j.Component),x=function(a,b){return"function"==typeof a?a(b):a},F=function(a,b){return"string"==typeof a?v.createLocation(a,null,null,b):a},y=function(a){return a},o=j.forwardRef;function Q(a){return!!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)}void 0===o&&(o=y);var R=o(function(a,b){var c=a.innerRef,d=a.navigate,h=a.onClick,e=w(a,["innerRef","navigate","onClick"]),l=e.target,m=p({},e,{onClick:function(i){try{h&&h(i)}catch(k){throw i.preventDefault(),k}i.defaultPrevented||0!==i.button||l&&"_self"!==l||Q(i)||(i.preventDefault(),d())}});return m.ref=y!==o&&b||c,j.createElement("a",m)}),G=o(function(a,b){var c=a.component,d=void 0===c?R:c,h=a.replace,e=a.to,l=a.innerRef,m=w(a,["component","replace","to","innerRef"]);return j.createElement(g.__RouterContext.Consumer,null,function(i){i||D(!1);var k=i.history,s=F(x(e,i.location),i.location),z=s?k.createHref(s):"",q=p({},m,{href:z,navigate:function(){var t=x(e,i.location);(h?k.replace:k.push)(t)}});return y!==o?q.ref=b||l:q.innerRef=l,j.createElement(d,q)})}),H=function(a){return a},r=j.forwardRef;function S(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return b.filter(function(d){return d}).join(" ")}void 0===r&&(r=H);var T=r(function(a,b){var c=a["aria-current"],d=void 0===c?"page":c,h=a.activeClassName,e=void 0===h?"active":h,l=a.activeStyle,m=a.className,i=a.exact,k=a.isActive,s=a.location,z=a.sensitive,q=a.strict,t=a.style,U=a.to,I=a.innerRef,V=w(a,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return j.createElement(g.__RouterContext.Consumer,null,function(J){J||D(!1);var u=s||J.location,K=F(x(U,u),u),L=K.pathname,M=L&&L.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),N=M?g.matchPath(u.pathname,{path:M,exact:i,sensitive:z,strict:q}):null,A=!!(k?k(N,u):N),W=A?S(m,e):m,X=A?p({},t,{},l):t,B=p({"aria-current":A&&d||null,className:W,style:X,to:K},V);return H!==r?B.ref=b||I:B.innerRef=I,j.createElement(G,B)})});Object.defineProperty(f,"MemoryRouter",{enumerable:!0,get:function(){return g.MemoryRouter}}),Object.defineProperty(f,"Prompt",{enumerable:!0,get:function(){return g.Prompt}}),Object.defineProperty(f,"Redirect",{enumerable:!0,get:function(){return g.Redirect}}),Object.defineProperty(f,"Route",{enumerable:!0,get:function(){return g.Route}}),Object.defineProperty(f,"Router",{enumerable:!0,get:function(){return g.Router}}),Object.defineProperty(f,"StaticRouter",{enumerable:!0,get:function(){return g.StaticRouter}}),Object.defineProperty(f,"Switch",{enumerable:!0,get:function(){return g.Switch}}),Object.defineProperty(f,"generatePath",{enumerable:!0,get:function(){return g.generatePath}}),Object.defineProperty(f,"matchPath",{enumerable:!0,get:function(){return g.matchPath}}),Object.defineProperty(f,"useHistory",{enumerable:!0,get:function(){return g.useHistory}}),Object.defineProperty(f,"useLocation",{enumerable:!0,get:function(){return g.useLocation}}),Object.defineProperty(f,"useParams",{enumerable:!0,get:function(){return g.useParams}}),Object.defineProperty(f,"useRouteMatch",{enumerable:!0,get:function(){return g.useRouteMatch}}),Object.defineProperty(f,"withRouter",{enumerable:!0,get:function(){return g.withRouter}}),f.BrowserRouter=O,f.HashRouter=P,f.Link=G,f.NavLink=T},379(c,b){"use strict";b.exports=k$(378)},35(Ve,Ah){!function(Ja,t){"object"==typeof Ve&&"object"==typeof Ah?Ah.exports=t():"function"==typeof define&&define.amd?define("babylonjs",[],t):"object"==typeof Ve?Ve.babylonjs=t():Ja.BABYLON=t()}("undefined"!=typeof self?self:"undefined"!=typeof global?global:Ve,function(){return function(Ja){var t={};function o(R){if(t[R])return t[R].exports;var r=t[R]={i:R,l:!1,exports:{}};return Ja[R].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=Ja,o.c=t,o.d=function(R,r,I){o.o(R,r)||Object.defineProperty(R,r,{enumerable:!0,get:I})},o.r=function(R){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(R,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(R,"__esModule",{value:!0})},o.t=function(R,r){if(1&r&&(R=o(R)),8&r)return R;if(4&r&&"object"==typeof R&&R&&R.__esModule)return R;var I=Object.create(null);if(o.r(I),Object.defineProperty(I,"default",{enumerable:!0,value:R}),2&r&&"string"!=typeof R)for(var i in R)o.d(I,i,function(G){return R[G]}.bind(null,i));return I},o.n=function(R){var r=R&&R.__esModule?function(){return R.default}:function(){return R};return o.d(r,"a",r),r},o.o=function(R,r){return Object.prototype.hasOwnProperty.call(R,r)},o.p="",o(o.s=151)}([function(Ja,t,o){"use strict";o.d(t,"d",function(){return G}),o.d(t,"e",function(){return D}),o.d(t,"f",function(){return E}),o.d(t,"b",function(){return x}),o.d(t,"a",function(){return l}),o.d(t,"c",function(){return y});var R=o(14),r=o(28),I=o(42),i=o(12),G=function(){function q(n,k){void 0===n&&(n=0),void 0===k&&(k=0),this.x=n,this.y=k}return q.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},q.prototype.getClassName=function(){return"Vector2"},q.prototype.getHashCode=function(){var n=0|this.x;return n=397*n^(0|this.y)},q.prototype.toArray=function(n,k){return void 0===k&&(k=0),n[k]=this.x,n[k+1]=this.y,this},q.prototype.asArray=function(){var n=new Array();return this.toArray(n,0),n},q.prototype.copyFrom=function(n){return this.x=n.x,this.y=n.y,this},q.prototype.copyFromFloats=function(n,k){return this.x=n,this.y=k,this},q.prototype.set=function(n,k){return this.copyFromFloats(n,k)},q.prototype.add=function(n){return new q(this.x+n.x,this.y+n.y)},q.prototype.addToRef=function(n,k){return k.x=this.x+n.x,k.y=this.y+n.y,this},q.prototype.addInPlace=function(n){return this.x+=n.x,this.y+=n.y,this},q.prototype.addVector3=function(n){return new q(this.x+n.x,this.y+n.y)},q.prototype.subtract=function(n){return new q(this.x-n.x,this.y-n.y)},q.prototype.subtractToRef=function(n,k){return k.x=this.x-n.x,k.y=this.y-n.y,this},q.prototype.subtractInPlace=function(n){return this.x-=n.x,this.y-=n.y,this},q.prototype.multiplyInPlace=function(n){return this.x*=n.x,this.y*=n.y,this},q.prototype.multiply=function(n){return new q(this.x*n.x,this.y*n.y)},q.prototype.multiplyToRef=function(n,k){return k.x=this.x*n.x,k.y=this.y*n.y,this},q.prototype.multiplyByFloats=function(n,k){return new q(this.x*n,this.y*k)},q.prototype.divide=function(n){return new q(this.x/n.x,this.y/n.y)},q.prototype.divideToRef=function(n,k){return k.x=this.x/n.x,k.y=this.y/n.y,this},q.prototype.divideInPlace=function(n){return this.divideToRef(n,this)},q.prototype.negate=function(){return new q(-this.x,-this.y)},q.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},q.prototype.negateToRef=function(n){return n.copyFromFloats(-1*this.x,-1*this.y)},q.prototype.scaleInPlace=function(n){return this.x*=n,this.y*=n,this},q.prototype.scale=function(n){var k=new q(0,0);return this.scaleToRef(n,k),k},q.prototype.scaleToRef=function(n,k){return k.x=this.x*n,k.y=this.y*n,this},q.prototype.scaleAndAddToRef=function(n,k){return k.x+=this.x*n,k.y+=this.y*n,this},q.prototype.equals=function(n){return n&&this.x===n.x&&this.y===n.y},q.prototype.equalsWithEpsilon=function(n,k){return void 0===k&&(k=r.a),n&&R.a.WithinEpsilon(this.x,n.x,k)&&R.a.WithinEpsilon(this.y,n.y,k)},q.prototype.floor=function(){return new q(Math.floor(this.x),Math.floor(this.y))},q.prototype.fract=function(){return new q(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},q.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},q.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},q.prototype.normalize=function(){var n=this.length();return 0===n?this:(this.x/=n,this.y/=n,this)},q.prototype.clone=function(){return new q(this.x,this.y)},q.Zero=function(){return new q(0,0)},q.One=function(){return new q(1,1)},q.FromArray=function(n,k){return void 0===k&&(k=0),new q(n[k],n[k+1])},q.FromArrayToRef=function(n,k,p){p.x=n[k],p.y=n[k+1]},q.CatmullRom=function(n,k,p,u,A){var B=A*A,v=A*B;return new q(.5*(2*k.x+(-n.x+p.x)*A+(2*n.x-5*k.x+4*p.x-u.x)*B+(-n.x+3*k.x-3*p.x+u.x)*v),.5*(2*k.y+(-n.y+p.y)*A+(2*n.y-5*k.y+4*p.y-u.y)*B+(-n.y+3*k.y-3*p.y+u.y)*v))},q.Clamp=function(n,k,p){var u=n.x;u=(u=u>p.x?p.x:u)<k.x?k.x:u;var A=n.y;return new q(u,A=(A=A>p.y?p.y:A)<k.y?k.y:A)},q.Hermite=function(n,k,p,u,A){var B=A*A,v=A*B,H=2*v-3*B+1,L=-2*v+3*B,Q=v-2*B+A,M=v-B;return new q(n.x*H+p.x*L+k.x*Q+u.x*M,n.y*H+p.y*L+k.y*Q+u.y*M)},q.Lerp=function(n,k,p){return new q(n.x+(k.x-n.x)*p,n.y+(k.y-n.y)*p)},q.Dot=function(n,k){return n.x*k.x+n.y*k.y},q.Normalize=function(n){var k=n.clone();return k.normalize(),k},q.Minimize=function(n,k){return new q(n.x<k.x?n.x:k.x,n.y<k.y?n.y:k.y)},q.Maximize=function(n,k){return new q(n.x>k.x?n.x:k.x,n.y>k.y?n.y:k.y)},q.Transform=function(n,k){var p=q.Zero();return q.TransformToRef(n,k,p),p},q.TransformToRef=function(n,k,p){var u=k.m,A=n.x*u[0]+n.y*u[4]+u[12],B=n.x*u[1]+n.y*u[5]+u[13];p.x=A,p.y=B},q.PointInTriangle=function(n,k,p,u){var A=.5*(-p.y*u.x+k.y*(-p.x+u.x)+k.x*(p.y-u.y)+p.x*u.y),B=A<0?-1:1,v=(k.y*u.x-k.x*u.y+(u.y-k.y)*n.x+(k.x-u.x)*n.y)*B,H=(k.x*p.y-k.y*p.x+(k.y-p.y)*n.x+(p.x-k.x)*n.y)*B;return v>0&&H>0&&v+H<2*A*B},q.Distance=function(n,k){return Math.sqrt(q.DistanceSquared(n,k))},q.DistanceSquared=function(n,k){var p=n.x-k.x,u=n.y-k.y;return p*p+u*u},q.Center=function(n,k){var p=n.add(k);return p.scaleInPlace(.5),p},q.DistanceOfPointFromSegment=function(n,k,p){var u=q.DistanceSquared(k,p);if(0===u)return q.Distance(n,k);var A=p.subtract(k),B=Math.max(0,Math.min(1,q.Dot(n.subtract(k),A)/u)),v=k.add(A.multiplyByFloats(B,B));return q.Distance(n,v)},q}(),D=function(){function q(n,k,p){void 0===n&&(n=0),void 0===k&&(k=0),void 0===p&&(p=0),this.x=n,this.y=k,this.z=p}return q.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},q.prototype.getClassName=function(){return"Vector3"},q.prototype.getHashCode=function(){var n=0|this.x;return n=397*(n=397*n^(0|this.y))^(0|this.z)},q.prototype.asArray=function(){var n=[];return this.toArray(n,0),n},q.prototype.toArray=function(n,k){return void 0===k&&(k=0),n[k]=this.x,n[k+1]=this.y,n[k+2]=this.z,this},q.prototype.toQuaternion=function(){return x.RotationYawPitchRoll(this.y,this.x,this.z)},q.prototype.addInPlace=function(n){return this.addInPlaceFromFloats(n.x,n.y,n.z)},q.prototype.addInPlaceFromFloats=function(n,k,p){return this.x+=n,this.y+=k,this.z+=p,this},q.prototype.add=function(n){return new q(this.x+n.x,this.y+n.y,this.z+n.z)},q.prototype.addToRef=function(n,k){return k.copyFromFloats(this.x+n.x,this.y+n.y,this.z+n.z)},q.prototype.subtractInPlace=function(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this},q.prototype.subtract=function(n){return new q(this.x-n.x,this.y-n.y,this.z-n.z)},q.prototype.subtractToRef=function(n,k){return this.subtractFromFloatsToRef(n.x,n.y,n.z,k)},q.prototype.subtractFromFloats=function(n,k,p){return new q(this.x-n,this.y-k,this.z-p)},q.prototype.subtractFromFloatsToRef=function(n,k,p,u){return u.copyFromFloats(this.x-n,this.y-k,this.z-p)},q.prototype.negate=function(){return new q(-this.x,-this.y,-this.z)},q.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},q.prototype.negateToRef=function(n){return n.copyFromFloats(-1*this.x,-1*this.y,-1*this.z)},q.prototype.scaleInPlace=function(n){return this.x*=n,this.y*=n,this.z*=n,this},q.prototype.scale=function(n){return new q(this.x*n,this.y*n,this.z*n)},q.prototype.scaleToRef=function(n,k){return k.copyFromFloats(this.x*n,this.y*n,this.z*n)},q.prototype.scaleAndAddToRef=function(n,k){return k.addInPlaceFromFloats(this.x*n,this.y*n,this.z*n)},q.prototype.equals=function(n){return n&&this.x===n.x&&this.y===n.y&&this.z===n.z},q.prototype.equalsWithEpsilon=function(n,k){return void 0===k&&(k=r.a),n&&R.a.WithinEpsilon(this.x,n.x,k)&&R.a.WithinEpsilon(this.y,n.y,k)&&R.a.WithinEpsilon(this.z,n.z,k)},q.prototype.equalsToFloats=function(n,k,p){return this.x===n&&this.y===k&&this.z===p},q.prototype.multiplyInPlace=function(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this},q.prototype.multiply=function(n){return this.multiplyByFloats(n.x,n.y,n.z)},q.prototype.multiplyToRef=function(n,k){return k.copyFromFloats(this.x*n.x,this.y*n.y,this.z*n.z)},q.prototype.multiplyByFloats=function(n,k,p){return new q(this.x*n,this.y*k,this.z*p)},q.prototype.divide=function(n){return new q(this.x/n.x,this.y/n.y,this.z/n.z)},q.prototype.divideToRef=function(n,k){return k.copyFromFloats(this.x/n.x,this.y/n.y,this.z/n.z)},q.prototype.divideInPlace=function(n){return this.divideToRef(n,this)},q.prototype.minimizeInPlace=function(n){return this.minimizeInPlaceFromFloats(n.x,n.y,n.z)},q.prototype.maximizeInPlace=function(n){return this.maximizeInPlaceFromFloats(n.x,n.y,n.z)},q.prototype.minimizeInPlaceFromFloats=function(n,k,p){return n<this.x&&(this.x=n),k<this.y&&(this.y=k),p<this.z&&(this.z=p),this},q.prototype.maximizeInPlaceFromFloats=function(n,k,p){return n>this.x&&(this.x=n),k>this.y&&(this.y=k),p>this.z&&(this.z=p),this},q.prototype.isNonUniformWithinEpsilon=function(n){var k=Math.abs(this.x),p=Math.abs(this.y);if(!R.a.WithinEpsilon(k,p,n))return!0;var u=Math.abs(this.z);return!R.a.WithinEpsilon(k,u,n)||!R.a.WithinEpsilon(p,u,n)},Object.defineProperty(q.prototype,"isNonUniform",{get:function(){var n=Math.abs(this.x),k=Math.abs(this.y);if(n!==k)return!0;var p=Math.abs(this.z);return n!==p||k!==p},enumerable:!0,configurable:!0}),q.prototype.floor=function(){return new q(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},q.prototype.fract=function(){return new q(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},q.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},q.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},q.prototype.normalize=function(){return this.normalizeFromLength(this.length())},q.prototype.reorderInPlace=function(n){var k=this;return"xyz"===(n=n.toLowerCase())?this:(s.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(p,u){k[p]=s.Vector3[0][n[u]]}),this)},q.prototype.rotateByQuaternionToRef=function(n,k){return n.toRotationMatrix(s.Matrix[0]),q.TransformCoordinatesToRef(this,s.Matrix[0],k),k},q.prototype.rotateByQuaternionAroundPointToRef=function(n,k,p){return this.subtractToRef(k,s.Vector3[0]),s.Vector3[0].rotateByQuaternionToRef(n,s.Vector3[0]),k.addToRef(s.Vector3[0],p),p},q.prototype.cross=function(n){return q.Cross(this,n)},q.prototype.normalizeFromLength=function(n){return 0===n||1===n?this:this.scaleInPlace(1/n)},q.prototype.normalizeToNew=function(){var n=new q(0,0,0);return this.normalizeToRef(n),n},q.prototype.normalizeToRef=function(n){var k=this.length();return 0===k||1===k?n.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/k,n)},q.prototype.clone=function(){return new q(this.x,this.y,this.z)},q.prototype.copyFrom=function(n){return this.copyFromFloats(n.x,n.y,n.z)},q.prototype.copyFromFloats=function(n,k,p){return this.x=n,this.y=k,this.z=p,this},q.prototype.set=function(n,k,p){return this.copyFromFloats(n,k,p)},q.prototype.setAll=function(n){return this.x=this.y=this.z=n,this},q.GetClipFactor=function(n,k,p,u){var A=q.Dot(n,p)-u;return A/(A-(q.Dot(k,p)-u))},q.GetAngleBetweenVectors=function(n,k,p){var u=n.normalizeToRef(s.Vector3[1]),A=k.normalizeToRef(s.Vector3[2]),B=q.Dot(u,A),v=s.Vector3[3];return q.CrossToRef(u,A,v),q.Dot(v,p)>0?Math.acos(B):-Math.acos(B)},q.FromArray=function(n,k){return void 0===k&&(k=0),new q(n[k],n[k+1],n[k+2])},q.FromFloatArray=function(n,k){return q.FromArray(n,k)},q.FromArrayToRef=function(n,k,p){p.x=n[k],p.y=n[k+1],p.z=n[k+2]},q.FromFloatArrayToRef=function(n,k,p){return q.FromArrayToRef(n,k,p)},q.FromFloatsToRef=function(n,k,p,u){u.copyFromFloats(n,k,p)},q.Zero=function(){return new q(0,0,0)},q.One=function(){return new q(1,1,1)},q.Up=function(){return new q(0,1,0)},Object.defineProperty(q,"UpReadOnly",{get:function(){return q._UpReadOnly},enumerable:!0,configurable:!0}),Object.defineProperty(q,"ZeroReadOnly",{get:function(){return q._ZeroReadOnly},enumerable:!0,configurable:!0}),q.Down=function(){return new q(0,-1,0)},q.Forward=function(){return new q(0,0,1)},q.Backward=function(){return new q(0,0,-1)},q.Right=function(){return new q(1,0,0)},q.Left=function(){return new q(-1,0,0)},q.TransformCoordinates=function(n,k){var p=q.Zero();return q.TransformCoordinatesToRef(n,k,p),p},q.TransformCoordinatesToRef=function(n,k,p){q.TransformCoordinatesFromFloatsToRef(n.x,n.y,n.z,k,p)},q.TransformCoordinatesFromFloatsToRef=function(n,k,p,u,A){var B=u.m,v=n*B[0]+k*B[4]+p*B[8]+B[12],H=n*B[1]+k*B[5]+p*B[9]+B[13],L=n*B[2]+k*B[6]+p*B[10]+B[14],Q=1/(n*B[3]+k*B[7]+p*B[11]+B[15]);A.x=v*Q,A.y=H*Q,A.z=L*Q},q.TransformNormal=function(n,k){var p=q.Zero();return q.TransformNormalToRef(n,k,p),p},q.TransformNormalToRef=function(n,k,p){this.TransformNormalFromFloatsToRef(n.x,n.y,n.z,k,p)},q.TransformNormalFromFloatsToRef=function(n,k,p,u,A){var B=u.m;A.x=n*B[0]+k*B[4]+p*B[8],A.y=n*B[1]+k*B[5]+p*B[9],A.z=n*B[2]+k*B[6]+p*B[10]},q.CatmullRom=function(n,k,p,u,A){var B=A*A,v=A*B;return new q(.5*(2*k.x+(-n.x+p.x)*A+(2*n.x-5*k.x+4*p.x-u.x)*B+(-n.x+3*k.x-3*p.x+u.x)*v),.5*(2*k.y+(-n.y+p.y)*A+(2*n.y-5*k.y+4*p.y-u.y)*B+(-n.y+3*k.y-3*p.y+u.y)*v),.5*(2*k.z+(-n.z+p.z)*A+(2*n.z-5*k.z+4*p.z-u.z)*B+(-n.z+3*k.z-3*p.z+u.z)*v))},q.Clamp=function(n,k,p){var u=new q();return q.ClampToRef(n,k,p,u),u},q.ClampToRef=function(n,k,p,u){var A=n.x;A=(A=A>p.x?p.x:A)<k.x?k.x:A;var B=n.y;B=(B=B>p.y?p.y:B)<k.y?k.y:B;var v=n.z;v=(v=v>p.z?p.z:v)<k.z?k.z:v,u.copyFromFloats(A,B,v)},q.CheckExtends=function(n,k,p){k.minimizeInPlace(n),p.maximizeInPlace(n)},q.Hermite=function(n,k,p,u,A){var B=A*A,v=A*B,H=2*v-3*B+1,L=-2*v+3*B,Q=v-2*B+A,M=v-B;return new q(n.x*H+p.x*L+k.x*Q+u.x*M,n.y*H+p.y*L+k.y*Q+u.y*M,n.z*H+p.z*L+k.z*Q+u.z*M)},q.Lerp=function(n,k,p){var u=new q(0,0,0);return q.LerpToRef(n,k,p,u),u},q.LerpToRef=function(n,k,p,u){u.x=n.x+(k.x-n.x)*p,u.y=n.y+(k.y-n.y)*p,u.z=n.z+(k.z-n.z)*p},q.Dot=function(n,k){return n.x*k.x+n.y*k.y+n.z*k.z},q.Cross=function(n,k){var p=q.Zero();return q.CrossToRef(n,k,p),p},q.CrossToRef=function(n,k,p){var u=n.y*k.z-n.z*k.y,A=n.z*k.x-n.x*k.z,B=n.x*k.y-n.y*k.x;p.copyFromFloats(u,A,B)},q.Normalize=function(n){var k=q.Zero();return q.NormalizeToRef(n,k),k},q.NormalizeToRef=function(n,k){n.normalizeToRef(k)},q.Project=function(n,k,p,u){var A=u.width,B=u.height,v=u.x,H=u.y,L=s.Matrix[1];l.FromValuesToRef(A/2,0,0,0,0,-B/2,0,0,0,0,.5,0,v+A/2,B/2+H,.5,1,L);var Q=s.Matrix[0];return k.multiplyToRef(p,Q),Q.multiplyToRef(L,Q),q.TransformCoordinates(n,Q)},q._UnprojectFromInvertedMatrixToRef=function(n,k,p){q.TransformCoordinatesToRef(n,k,p);var u=k.m,A=n.x*u[3]+n.y*u[7]+n.z*u[11]+u[15];R.a.WithinEpsilon(A,1)&&p.scaleInPlace(1/A)},q.UnprojectFromTransform=function(n,k,p,u,A){var B=s.Matrix[0];u.multiplyToRef(A,B),B.invert(),n.x=n.x/k*2-1,n.y=-(n.y/p*2-1);var v=new q();return q._UnprojectFromInvertedMatrixToRef(n,B,v),v},q.Unproject=function(n,k,p,u,A,B){var v=q.Zero();return q.UnprojectToRef(n,k,p,u,A,B,v),v},q.UnprojectToRef=function(n,k,p,u,A,B,v){q.UnprojectFloatsToRef(n.x,n.y,n.z,k,p,u,A,B,v)},q.UnprojectFloatsToRef=function(n,k,p,u,A,B,v,H,L){var Q=s.Matrix[0];B.multiplyToRef(v,Q),Q.multiplyToRef(H,Q),Q.invert();var M=s.Vector3[0];M.x=n/u*2-1,M.y=-(k/A*2-1),M.z=2*p-1,q._UnprojectFromInvertedMatrixToRef(M,Q,L)},q.Minimize=function(n,k){var p=n.clone();return p.minimizeInPlace(k),p},q.Maximize=function(n,k){var p=n.clone();return p.maximizeInPlace(k),p},q.Distance=function(n,k){return Math.sqrt(q.DistanceSquared(n,k))},q.DistanceSquared=function(n,k){var p=n.x-k.x,u=n.y-k.y,A=n.z-k.z;return p*p+u*u+A*A},q.Center=function(n,k){var p=n.add(k);return p.scaleInPlace(.5),p},q.RotationFromAxis=function(n,k,p){var u=q.Zero();return q.RotationFromAxisToRef(n,k,p,u),u},q.RotationFromAxisToRef=function(n,k,p,u){var A=s.Quaternion[0];x.RotationQuaternionFromAxisToRef(n,k,p,A),A.toEulerAnglesToRef(u)},q._UpReadOnly=q.Up(),q._ZeroReadOnly=q.Zero(),q}(),E=function(){function q(n,k,p,u){this.x=n,this.y=k,this.z=p,this.w=u}return q.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},q.prototype.getClassName=function(){return"Vector4"},q.prototype.getHashCode=function(){var n=0|this.x;return n=397*(n=397*(n=397*n^(0|this.y))^(0|this.z))^(0|this.w)},q.prototype.asArray=function(){var n=new Array();return this.toArray(n,0),n},q.prototype.toArray=function(n,k){return void 0===k&&(k=0),n[k]=this.x,n[k+1]=this.y,n[k+2]=this.z,n[k+3]=this.w,this},q.prototype.addInPlace=function(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this.w+=n.w,this},q.prototype.add=function(n){return new q(this.x+n.x,this.y+n.y,this.z+n.z,this.w+n.w)},q.prototype.addToRef=function(n,k){return k.x=this.x+n.x,k.y=this.y+n.y,k.z=this.z+n.z,k.w=this.w+n.w,this},q.prototype.subtractInPlace=function(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this.w-=n.w,this},q.prototype.subtract=function(n){return new q(this.x-n.x,this.y-n.y,this.z-n.z,this.w-n.w)},q.prototype.subtractToRef=function(n,k){return k.x=this.x-n.x,k.y=this.y-n.y,k.z=this.z-n.z,k.w=this.w-n.w,this},q.prototype.subtractFromFloats=function(n,k,p,u){return new q(this.x-n,this.y-k,this.z-p,this.w-u)},q.prototype.subtractFromFloatsToRef=function(n,k,p,u,A){return A.x=this.x-n,A.y=this.y-k,A.z=this.z-p,A.w=this.w-u,this},q.prototype.negate=function(){return new q(-this.x,-this.y,-this.z,-this.w)},q.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},q.prototype.negateToRef=function(n){return n.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},q.prototype.scaleInPlace=function(n){return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this},q.prototype.scale=function(n){return new q(this.x*n,this.y*n,this.z*n,this.w*n)},q.prototype.scaleToRef=function(n,k){return k.x=this.x*n,k.y=this.y*n,k.z=this.z*n,k.w=this.w*n,this},q.prototype.scaleAndAddToRef=function(n,k){return k.x+=this.x*n,k.y+=this.y*n,k.z+=this.z*n,k.w+=this.w*n,this},q.prototype.equals=function(n){return n&&this.x===n.x&&this.y===n.y&&this.z===n.z&&this.w===n.w},q.prototype.equalsWithEpsilon=function(n,k){return void 0===k&&(k=r.a),n&&R.a.WithinEpsilon(this.x,n.x,k)&&R.a.WithinEpsilon(this.y,n.y,k)&&R.a.WithinEpsilon(this.z,n.z,k)&&R.a.WithinEpsilon(this.w,n.w,k)},q.prototype.equalsToFloats=function(n,k,p,u){return this.x===n&&this.y===k&&this.z===p&&this.w===u},q.prototype.multiplyInPlace=function(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this.w*=n.w,this},q.prototype.multiply=function(n){return new q(this.x*n.x,this.y*n.y,this.z*n.z,this.w*n.w)},q.prototype.multiplyToRef=function(n,k){return k.x=this.x*n.x,k.y=this.y*n.y,k.z=this.z*n.z,k.w=this.w*n.w,this},q.prototype.multiplyByFloats=function(n,k,p,u){return new q(this.x*n,this.y*k,this.z*p,this.w*u)},q.prototype.divide=function(n){return new q(this.x/n.x,this.y/n.y,this.z/n.z,this.w/n.w)},q.prototype.divideToRef=function(n,k){return k.x=this.x/n.x,k.y=this.y/n.y,k.z=this.z/n.z,k.w=this.w/n.w,this},q.prototype.divideInPlace=function(n){return this.divideToRef(n,this)},q.prototype.minimizeInPlace=function(n){return n.x<this.x&&(this.x=n.x),n.y<this.y&&(this.y=n.y),n.z<this.z&&(this.z=n.z),n.w<this.w&&(this.w=n.w),this},q.prototype.maximizeInPlace=function(n){return n.x>this.x&&(this.x=n.x),n.y>this.y&&(this.y=n.y),n.z>this.z&&(this.z=n.z),n.w>this.w&&(this.w=n.w),this},q.prototype.floor=function(){return new q(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},q.prototype.fract=function(){return new q(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},q.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},q.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},q.prototype.normalize=function(){var n=this.length();return 0===n?this:this.scaleInPlace(1/n)},q.prototype.toVector3=function(){return new D(this.x,this.y,this.z)},q.prototype.clone=function(){return new q(this.x,this.y,this.z,this.w)},q.prototype.copyFrom=function(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w,this},q.prototype.copyFromFloats=function(n,k,p,u){return this.x=n,this.y=k,this.z=p,this.w=u,this},q.prototype.set=function(n,k,p,u){return this.copyFromFloats(n,k,p,u)},q.prototype.setAll=function(n){return this.x=this.y=this.z=this.w=n,this},q.FromArray=function(n,k){return k||(k=0),new q(n[k],n[k+1],n[k+2],n[k+3])},q.FromArrayToRef=function(n,k,p){p.x=n[k],p.y=n[k+1],p.z=n[k+2],p.w=n[k+3]},q.FromFloatArrayToRef=function(n,k,p){q.FromArrayToRef(n,k,p)},q.FromFloatsToRef=function(n,k,p,u,A){A.x=n,A.y=k,A.z=p,A.w=u},q.Zero=function(){return new q(0,0,0,0)},q.One=function(){return new q(1,1,1,1)},q.Normalize=function(n){var k=q.Zero();return q.NormalizeToRef(n,k),k},q.NormalizeToRef=function(n,k){k.copyFrom(n),k.normalize()},q.Minimize=function(n,k){var p=n.clone();return p.minimizeInPlace(k),p},q.Maximize=function(n,k){var p=n.clone();return p.maximizeInPlace(k),p},q.Distance=function(n,k){return Math.sqrt(q.DistanceSquared(n,k))},q.DistanceSquared=function(n,k){var p=n.x-k.x,u=n.y-k.y,A=n.z-k.z,B=n.w-k.w;return p*p+u*u+A*A+B*B},q.Center=function(n,k){var p=n.add(k);return p.scaleInPlace(.5),p},q.TransformNormal=function(n,k){var p=q.Zero();return q.TransformNormalToRef(n,k,p),p},q.TransformNormalToRef=function(n,k,p){var u=k.m,A=n.x*u[0]+n.y*u[4]+n.z*u[8],B=n.x*u[1]+n.y*u[5]+n.z*u[9],v=n.x*u[2]+n.y*u[6]+n.z*u[10];p.x=A,p.y=B,p.z=v,p.w=n.w},q.TransformNormalFromFloatsToRef=function(n,k,p,u,A,B){var v=A.m;B.x=n*v[0]+k*v[4]+p*v[8],B.y=n*v[1]+k*v[5]+p*v[9],B.z=n*v[2]+k*v[6]+p*v[10],B.w=u},q.FromVector3=function(n,k){return void 0===k&&(k=0),new q(n.x,n.y,n.z,k)},q}(),x=function(){function q(n,k,p,u){void 0===n&&(n=0),void 0===k&&(k=0),void 0===p&&(p=0),void 0===u&&(u=1),this.x=n,this.y=k,this.z=p,this.w=u}return q.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},q.prototype.getClassName=function(){return"Quaternion"},q.prototype.getHashCode=function(){var n=0|this.x;return n=397*(n=397*(n=397*n^(0|this.y))^(0|this.z))^(0|this.w)},q.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},q.prototype.equals=function(n){return n&&this.x===n.x&&this.y===n.y&&this.z===n.z&&this.w===n.w},q.prototype.equalsWithEpsilon=function(n,k){return void 0===k&&(k=r.a),n&&R.a.WithinEpsilon(this.x,n.x,k)&&R.a.WithinEpsilon(this.y,n.y,k)&&R.a.WithinEpsilon(this.z,n.z,k)&&R.a.WithinEpsilon(this.w,n.w,k)},q.prototype.clone=function(){return new q(this.x,this.y,this.z,this.w)},q.prototype.copyFrom=function(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w,this},q.prototype.copyFromFloats=function(n,k,p,u){return this.x=n,this.y=k,this.z=p,this.w=u,this},q.prototype.set=function(n,k,p,u){return this.copyFromFloats(n,k,p,u)},q.prototype.add=function(n){return new q(this.x+n.x,this.y+n.y,this.z+n.z,this.w+n.w)},q.prototype.addInPlace=function(n){return this.x+=n.x,this.y+=n.y,this.z+=n.z,this.w+=n.w,this},q.prototype.subtract=function(n){return new q(this.x-n.x,this.y-n.y,this.z-n.z,this.w-n.w)},q.prototype.scale=function(n){return new q(this.x*n,this.y*n,this.z*n,this.w*n)},q.prototype.scaleToRef=function(n,k){return k.x=this.x*n,k.y=this.y*n,k.z=this.z*n,k.w=this.w*n,this},q.prototype.scaleInPlace=function(n){return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this},q.prototype.scaleAndAddToRef=function(n,k){return k.x+=this.x*n,k.y+=this.y*n,k.z+=this.z*n,k.w+=this.w*n,this},q.prototype.multiply=function(n){var k=new q(0,0,0,1);return this.multiplyToRef(n,k),k},q.prototype.multiplyToRef=function(n,k){var p=this.x*n.w+this.y*n.z-this.z*n.y+this.w*n.x,u=-this.x*n.z+this.y*n.w+this.z*n.x+this.w*n.y,A=this.x*n.y-this.y*n.x+this.z*n.w+this.w*n.z,B=-this.x*n.x-this.y*n.y-this.z*n.z+this.w*n.w;return k.copyFromFloats(p,u,A,B),this},q.prototype.multiplyInPlace=function(n){return this.multiplyToRef(n,this),this},q.prototype.conjugateToRef=function(n){return n.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},q.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},q.prototype.conjugate=function(){return new q(-this.x,-this.y,-this.z,this.w)},q.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},q.prototype.normalize=function(){var n=this.length();if(0===n)return this;var k=1/n;return this.x*=k,this.y*=k,this.z*=k,this.w*=k,this},q.prototype.toEulerAngles=function(n){void 0===n&&(n="YZX");var k=D.Zero();return this.toEulerAnglesToRef(k),k},q.prototype.toEulerAnglesToRef=function(n){var k=this.z,p=this.x,u=this.y,A=this.w,B=A*A,v=k*k,H=p*p,L=u*u,Q=u*k-p*A;return Q<-.4999999?(n.y=2*Math.atan2(u,A),n.x=Math.PI/2,n.z=0):Q>.4999999?(n.y=2*Math.atan2(u,A),n.x=-Math.PI/2,n.z=0):(n.z=Math.atan2(2*(p*u+k*A),-v-H+L+B),n.x=Math.asin(-2*(k*u-p*A)),n.y=Math.atan2(2*(k*p+u*A),v-H-L+B)),this},q.prototype.toRotationMatrix=function(n){return l.FromQuaternionToRef(this,n),this},q.prototype.fromRotationMatrix=function(n){return q.FromRotationMatrixToRef(n,this),this},q.FromRotationMatrix=function(n){var k=new q();return q.FromRotationMatrixToRef(n,k),k},q.FromRotationMatrixToRef=function(n,k){var p,u=n.m,A=u[0],B=u[4],v=u[8],H=u[1],L=u[5],Q=u[9],M=u[2],Y=u[6],X=u[10],U=A+L+X;U>0?(p=.5/Math.sqrt(U+1),k.w=.25/p,k.x=(Y-Q)*p,k.y=(v-M)*p,k.z=(H-B)*p):A>L&&A>X?(p=2*Math.sqrt(1+A-L-X),k.w=(Y-Q)/p,k.x=.25*p,k.y=(B+H)/p,k.z=(v+M)/p):L>X?(p=2*Math.sqrt(1+L-A-X),k.w=(v-M)/p,k.x=(B+H)/p,k.y=.25*p,k.z=(Q+Y)/p):(p=2*Math.sqrt(1+X-A-L),k.w=(H-B)/p,k.x=(v+M)/p,k.y=(Q+Y)/p,k.z=.25*p)},q.Dot=function(n,k){return n.x*k.x+n.y*k.y+n.z*k.z+n.w*k.w},q.AreClose=function(n,k){return q.Dot(n,k)>=0},q.Zero=function(){return new q(0,0,0,0)},q.Inverse=function(n){return new q(-n.x,-n.y,-n.z,n.w)},q.InverseToRef=function(n,k){return k.set(-n.x,-n.y,-n.z,n.w),k},q.Identity=function(){return new q(0,0,0,1)},q.IsIdentity=function(n){return n&&0===n.x&&0===n.y&&0===n.z&&1===n.w},q.RotationAxis=function(n,k){return q.RotationAxisToRef(n,k,new q())},q.RotationAxisToRef=function(n,k,p){var u=Math.sin(k/2);return n.normalize(),p.w=Math.cos(k/2),p.x=n.x*u,p.y=n.y*u,p.z=n.z*u,p},q.FromArray=function(n,k){return k||(k=0),new q(n[k],n[k+1],n[k+2],n[k+3])},q.FromEulerAngles=function(n,k,p){var u=new q();return q.RotationYawPitchRollToRef(k,n,p,u),u},q.FromEulerAnglesToRef=function(n,k,p,u){return q.RotationYawPitchRollToRef(k,n,p,u),u},q.FromEulerVector=function(n){var k=new q();return q.RotationYawPitchRollToRef(n.y,n.x,n.z,k),k},q.FromEulerVectorToRef=function(n,k){return q.RotationYawPitchRollToRef(n.y,n.x,n.z,k),k},q.RotationYawPitchRoll=function(n,k,p){var u=new q();return q.RotationYawPitchRollToRef(n,k,p,u),u},q.RotationYawPitchRollToRef=function(n,k,p,u){var A=.5*p,B=.5*k,v=.5*n,H=Math.sin(A),L=Math.cos(A),Q=Math.sin(B),M=Math.cos(B),Y=Math.sin(v),X=Math.cos(v);u.x=X*Q*L+Y*M*H,u.y=Y*M*L-X*Q*H,u.z=X*M*H-Y*Q*L,u.w=X*M*L+Y*Q*H},q.RotationAlphaBetaGamma=function(n,k,p){var u=new q();return q.RotationAlphaBetaGammaToRef(n,k,p,u),u},q.RotationAlphaBetaGammaToRef=function(n,k,p,u){var A=.5*(p+n),B=.5*(p-n),v=.5*k;u.x=Math.cos(B)*Math.sin(v),u.y=Math.sin(B)*Math.sin(v),u.z=Math.sin(A)*Math.cos(v),u.w=Math.cos(A)*Math.cos(v)},q.RotationQuaternionFromAxis=function(n,k,p){var u=new q(0,0,0,0);return q.RotationQuaternionFromAxisToRef(n,k,p,u),u},q.RotationQuaternionFromAxisToRef=function(n,k,p,u){var A=s.Matrix[0];l.FromXYZAxesToRef(n.normalize(),k.normalize(),p.normalize(),A),q.FromRotationMatrixToRef(A,u)},q.Slerp=function(n,k,p){var u=q.Identity();return q.SlerpToRef(n,k,p,u),u},q.SlerpToRef=function(n,k,p,u){var A,B,v=n.x*k.x+n.y*k.y+n.z*k.z+n.w*k.w,H=!1;if(v<0&&(H=!0,v=-v),v>.999999)B=1-p,A=H?-p:p;else{var L=Math.acos(v),Q=1/Math.sin(L);B=Math.sin((1-p)*L)*Q,A=H?-Math.sin(p*L)*Q:Math.sin(p*L)*Q}u.x=B*n.x+A*k.x,u.y=B*n.y+A*k.y,u.z=B*n.z+A*k.z,u.w=B*n.w+A*k.w},q.Hermite=function(n,k,p,u,A){var B=A*A,v=A*B,H=2*v-3*B+1,L=-2*v+3*B,Q=v-2*B+A,M=v-B;return new q(n.x*H+p.x*L+k.x*Q+u.x*M,n.y*H+p.y*L+k.y*Q+u.y*M,n.z*H+p.z*L+k.z*Q+u.z*M,n.w*H+p.w*L+k.w*Q+u.w*M)},q}(),l=function(){function q(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,this._m=new Float32Array(16),this._updateIdentityStatus(!1)}return Object.defineProperty(q.prototype,"m",{get:function(){return this._m},enumerable:!0,configurable:!0}),q.prototype._markAsUpdated=function(){this.updateFlag=q._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},q.prototype._updateIdentityStatus=function(n,k,p,u){void 0===k&&(k=!1),void 0===p&&(p=!1),void 0===u&&(u=!0),this.updateFlag=q._updateFlagSeed++,this._isIdentity=n,this._isIdentity3x2=n||p,this._isIdentityDirty=!this._isIdentity&&k,this._isIdentity3x2Dirty=!this._isIdentity3x2&&u},q.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var n=this._m;this._isIdentity=1===n[0]&&0===n[1]&&0===n[2]&&0===n[3]&&0===n[4]&&1===n[5]&&0===n[6]&&0===n[7]&&0===n[8]&&0===n[9]&&1===n[10]&&0===n[11]&&0===n[12]&&0===n[13]&&0===n[14]&&1===n[15]}return this._isIdentity},q.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]?this._isIdentity3x2=!1:0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},q.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var n=this._m,k=n[0],p=n[1],u=n[2],A=n[3],B=n[4],v=n[5],H=n[6],L=n[7],Q=n[8],M=n[9],Y=n[10],X=n[11],U=n[12],P=n[13],ga=n[14],ma=n[15],oa=Y*ma-ga*X,ja=M*ma-P*X,aa=M*ga-P*Y,F=Q*ma-U*X,$=Q*ga-Y*U,ia=Q*P-U*M;return k*+(v*oa-H*ja+L*aa)+p*-(B*oa-H*F+L*$)+u*+(B*ja-v*F+L*ia)+A*-(B*aa-v*$+H*ia)},q.prototype.toArray=function(){return this._m},q.prototype.asArray=function(){return this._m},q.prototype.invert=function(){return this.invertToRef(this),this},q.prototype.reset=function(){return q.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},q.prototype.add=function(n){var k=new q();return this.addToRef(n,k),k},q.prototype.addToRef=function(n,k){for(var p=this._m,u=k._m,A=n.m,B=0;B<16;B++)u[B]=p[B]+A[B];return k._markAsUpdated(),this},q.prototype.addToSelf=function(n){for(var k=this._m,p=n.m,u=0;u<16;u++)k[u]+=p[u];return this._markAsUpdated(),this},q.prototype.invertToRef=function(n){if(!0===this._isIdentity)return q.IdentityToRef(n),this;var k=this._m,p=k[0],u=k[1],A=k[2],B=k[3],v=k[4],H=k[5],L=k[6],Q=k[7],M=k[8],Y=k[9],X=k[10],U=k[11],P=k[12],ga=k[13],ma=k[14],oa=k[15],ja=X*oa-ma*U,aa=Y*oa-ga*U,F=Y*ma-ga*X,$=M*oa-P*U,ia=M*ma-X*P,ba=M*ga-P*Y,qa=+(H*ja-L*aa+Q*F),V=-(v*ja-L*$+Q*ia),O=+(v*aa-H*$+Q*ba),S=-(v*F-H*ia+L*ba),W=p*qa+u*V+A*O+B*S;if(0===W)return n.copyFrom(this),this;var da=1/W,na=L*oa-ma*Q,Ea=H*oa-ga*Q,Ca=H*ma-ga*L,wa=v*oa-P*Q,Ka=v*ma-P*L,Ga=v*ga-P*H,Ba=L*U-X*Q,Na=H*U-Y*Q,db=H*X-Y*L,eb=v*U-M*Q,Ya=v*X-M*L,Sa=v*Y-M*H,sb=-(u*ja-A*aa+B*F),kb=+(p*ja-A*$+B*ia),wb=-(p*aa-u*$+B*ba),tb=+(p*F-u*ia+A*ba),Ob=+(u*na-A*Ea+B*Ca),dc=-(p*na-A*wa+B*Ka),tc=+(p*Ea-u*wa+B*Ga),Tc=-(p*Ca-u*Ka+A*Ga),Fb=-(u*Ba-A*Na+B*db),gd=+(p*Ba-A*eb+B*Ya),hd=-(p*Na-u*eb+B*Sa),Ed=+(p*db-u*Ya+A*Sa);return q.FromValuesToRef(qa*da,sb*da,Ob*da,Fb*da,V*da,kb*da,dc*da,gd*da,O*da,wb*da,tc*da,hd*da,S*da,tb*da,Tc*da,Ed*da,n),this},q.prototype.addAtIndex=function(n,k){return this._m[n]+=k,this._markAsUpdated(),this},q.prototype.multiplyAtIndex=function(n,k){return this._m[n]*=k,this._markAsUpdated(),this},q.prototype.setTranslationFromFloats=function(n,k,p){return this._m[12]=n,this._m[13]=k,this._m[14]=p,this._markAsUpdated(),this},q.prototype.addTranslationFromFloats=function(n,k,p){return this._m[12]+=n,this._m[13]+=k,this._m[14]+=p,this._markAsUpdated(),this},q.prototype.setTranslation=function(n){return this.setTranslationFromFloats(n.x,n.y,n.z)},q.prototype.getTranslation=function(){return new D(this._m[12],this._m[13],this._m[14])},q.prototype.getTranslationToRef=function(n){return n.x=this._m[12],n.y=this._m[13],n.z=this._m[14],this},q.prototype.removeRotationAndScaling=function(){var n=this.m;return q.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,n[12],n[13],n[14],n[15],this),this._updateIdentityStatus(0===n[12]&&0===n[13]&&0===n[14]&&1===n[15]),this},q.prototype.multiply=function(n){var k=new q();return this.multiplyToRef(n,k),k},q.prototype.copyFrom=function(n){n.copyToArray(this._m);var k=n;return this._updateIdentityStatus(k._isIdentity,k._isIdentityDirty,k._isIdentity3x2,k._isIdentity3x2Dirty),this},q.prototype.copyToArray=function(n,k){void 0===k&&(k=0);var p=this._m;return n[k]=p[0],n[k+1]=p[1],n[k+2]=p[2],n[k+3]=p[3],n[k+4]=p[4],n[k+5]=p[5],n[k+6]=p[6],n[k+7]=p[7],n[k+8]=p[8],n[k+9]=p[9],n[k+10]=p[10],n[k+11]=p[11],n[k+12]=p[12],n[k+13]=p[13],n[k+14]=p[14],n[k+15]=p[15],this},q.prototype.multiplyToRef=function(n,k){return this._isIdentity?(k.copyFrom(n),this):n._isIdentity?(k.copyFrom(this),this):(this.multiplyToArray(n,k._m,0),k._markAsUpdated(),this)},q.prototype.multiplyToArray=function(n,k,p){var u=this._m,A=n.m,B=u[0],v=u[1],H=u[2],L=u[3],Q=u[4],M=u[5],Y=u[6],X=u[7],U=u[8],P=u[9],ga=u[10],ma=u[11],oa=u[12],ja=u[13],aa=u[14],F=u[15],$=A[0],ia=A[1],ba=A[2],qa=A[3],V=A[4],O=A[5],S=A[6],W=A[7],da=A[8],na=A[9],Ea=A[10],Ca=A[11],wa=A[12],Ka=A[13],Ga=A[14],Ba=A[15];return k[p]=B*$+v*V+H*da+L*wa,k[p+1]=B*ia+v*O+H*na+L*Ka,k[p+2]=B*ba+v*S+H*Ea+L*Ga,k[p+3]=B*qa+v*W+H*Ca+L*Ba,k[p+4]=Q*$+M*V+Y*da+X*wa,k[p+5]=Q*ia+M*O+Y*na+X*Ka,k[p+6]=Q*ba+M*S+Y*Ea+X*Ga,k[p+7]=Q*qa+M*W+Y*Ca+X*Ba,k[p+8]=U*$+P*V+ga*da+ma*wa,k[p+9]=U*ia+P*O+ga*na+ma*Ka,k[p+10]=U*ba+P*S+ga*Ea+ma*Ga,k[p+11]=U*qa+P*W+ga*Ca+ma*Ba,k[p+12]=oa*$+ja*V+aa*da+F*wa,k[p+13]=oa*ia+ja*O+aa*na+F*Ka,k[p+14]=oa*ba+ja*S+aa*Ea+F*Ga,k[p+15]=oa*qa+ja*W+aa*Ca+F*Ba,this},q.prototype.equals=function(n){var k=n;if(!k)return!1;if((this._isIdentity||k._isIdentity)&&!this._isIdentityDirty&&!k._isIdentityDirty)return this._isIdentity&&k._isIdentity;var p=this.m,u=k.m;return p[0]===u[0]&&p[1]===u[1]&&p[2]===u[2]&&p[3]===u[3]&&p[4]===u[4]&&p[5]===u[5]&&p[6]===u[6]&&p[7]===u[7]&&p[8]===u[8]&&p[9]===u[9]&&p[10]===u[10]&&p[11]===u[11]&&p[12]===u[12]&&p[13]===u[13]&&p[14]===u[14]&&p[15]===u[15]},q.prototype.clone=function(){var n=new q();return n.copyFrom(this),n},q.prototype.getClassName=function(){return"Matrix"},q.prototype.getHashCode=function(){for(var n=0|this._m[0],k=1;k<16;k++)n=397*n^(0|this._m[k]);return n},q.prototype.decompose=function(n,k,p){if(this._isIdentity)return p&&p.setAll(0),n&&n.setAll(1),k&&k.copyFromFloats(0,0,0,1),!0;var u=this._m;if(p&&p.copyFromFloats(u[12],u[13],u[14]),(n=n||s.Vector3[0]).x=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2]),n.y=Math.sqrt(u[4]*u[4]+u[5]*u[5]+u[6]*u[6]),n.z=Math.sqrt(u[8]*u[8]+u[9]*u[9]+u[10]*u[10]),this.determinant()<=0&&(n.y*=-1),0===n.x||0===n.y||0===n.z)return k&&k.copyFromFloats(0,0,0,1),!1;if(k){var A=1/n.x,B=1/n.y,v=1/n.z;q.FromValuesToRef(u[0]*A,u[1]*A,u[2]*A,0,u[4]*B,u[5]*B,u[6]*B,0,u[8]*v,u[9]*v,u[10]*v,0,0,0,0,1,s.Matrix[0]),x.FromRotationMatrixToRef(s.Matrix[0],k)}return!0},q.prototype.getRow=function(n){if(n<0||n>3)return null;var k=4*n;return new E(this._m[k+0],this._m[k+1],this._m[k+2],this._m[k+3])},q.prototype.setRow=function(n,k){return this.setRowFromFloats(n,k.x,k.y,k.z,k.w)},q.prototype.transpose=function(){return q.Transpose(this)},q.prototype.transposeToRef=function(n){return q.TransposeToRef(this,n),this},q.prototype.setRowFromFloats=function(n,k,p,u,A){if(n<0||n>3)return this;var B=4*n;return this._m[B+0]=k,this._m[B+1]=p,this._m[B+2]=u,this._m[B+3]=A,this._markAsUpdated(),this},q.prototype.scale=function(n){var k=new q();return this.scaleToRef(n,k),k},q.prototype.scaleToRef=function(n,k){for(var p=0;p<16;p++)k._m[p]=this._m[p]*n;return k._markAsUpdated(),this},q.prototype.scaleAndAddToRef=function(n,k){for(var p=0;p<16;p++)k._m[p]+=this._m[p]*n;return k._markAsUpdated(),this},q.prototype.toNormalMatrix=function(n){var k=s.Matrix[0];this.invertToRef(k),k.transposeToRef(n);var p=n._m;q.FromValuesToRef(p[0],p[1],p[2],0,p[4],p[5],p[6],0,p[8],p[9],p[10],0,0,0,0,1,n)},q.prototype.getRotationMatrix=function(){var n=new q();return this.getRotationMatrixToRef(n),n},q.prototype.getRotationMatrixToRef=function(n){var k=s.Vector3[0];if(!this.decompose(k))return q.IdentityToRef(n),this;var p=this._m,u=1/k.x,A=1/k.y,B=1/k.z;return q.FromValuesToRef(p[0]*u,p[1]*u,p[2]*u,0,p[4]*A,p[5]*A,p[6]*A,0,p[8]*B,p[9]*B,p[10]*B,0,0,0,0,1,n),this},q.prototype.toggleModelMatrixHandInPlace=function(){var n=this._m;n[2]*=-1,n[6]*=-1,n[8]*=-1,n[9]*=-1,n[14]*=-1,this._markAsUpdated()},q.prototype.toggleProjectionMatrixHandInPlace=function(){var n=this._m;n[8]*=-1,n[9]*=-1,n[10]*=-1,n[11]*=-1,this._markAsUpdated()},q.FromArray=function(n,k){void 0===k&&(k=0);var p=new q();return q.FromArrayToRef(n,k,p),p},q.FromArrayToRef=function(n,k,p){for(var u=0;u<16;u++)p._m[u]=n[u+k];p._markAsUpdated()},q.FromFloat32ArrayToRefScaled=function(n,k,p,u){for(var A=0;A<16;A++)u._m[A]=n[A+k]*p;u._markAsUpdated()},Object.defineProperty(q,"IdentityReadOnly",{get:function(){return q._identityReadOnly},enumerable:!0,configurable:!0}),q.FromValuesToRef=function(n,k,p,u,A,B,v,H,L,Q,M,Y,X,U,P,ga,ma){var oa=ma._m;oa[0]=n,oa[1]=k,oa[2]=p,oa[3]=u,oa[4]=A,oa[5]=B,oa[6]=v,oa[7]=H,oa[8]=L,oa[9]=Q,oa[10]=M,oa[11]=Y,oa[12]=X,oa[13]=U,oa[14]=P,oa[15]=ga,ma._markAsUpdated()},q.FromValues=function(n,k,p,u,A,B,v,H,L,Q,M,Y,X,U,P,ga){var ma=new q(),oa=ma._m;return oa[0]=n,oa[1]=k,oa[2]=p,oa[3]=u,oa[4]=A,oa[5]=B,oa[6]=v,oa[7]=H,oa[8]=L,oa[9]=Q,oa[10]=M,oa[11]=Y,oa[12]=X,oa[13]=U,oa[14]=P,oa[15]=ga,ma._markAsUpdated(),ma},q.Compose=function(n,k,p){var u=new q();return q.ComposeToRef(n,k,p,u),u},q.ComposeToRef=function(n,k,p,u){var A=u._m,B=k.x,v=k.y,H=k.z,L=k.w,Q=B+B,M=v+v,Y=H+H,X=B*Q,U=B*M,P=B*Y,ga=v*M,ma=v*Y,oa=H*Y,ja=L*Q,aa=L*M,F=L*Y,$=n.x,ia=n.y,ba=n.z;A[0]=(1-(ga+oa))*$,A[1]=(U+F)*$,A[2]=(P-aa)*$,A[3]=0,A[4]=(U-F)*ia,A[5]=(1-(X+oa))*ia,A[6]=(ma+ja)*ia,A[7]=0,A[8]=(P+aa)*ba,A[9]=(ma-ja)*ba,A[10]=(1-(X+ga))*ba,A[11]=0,A[12]=p.x,A[13]=p.y,A[14]=p.z,A[15]=1,u._markAsUpdated()},q.Identity=function(){var n=q.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return n._updateIdentityStatus(!0),n},q.IdentityToRef=function(n){q.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,n),n._updateIdentityStatus(!0)},q.Zero=function(){var n=q.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return n._updateIdentityStatus(!1),n},q.RotationX=function(n){var k=new q();return q.RotationXToRef(n,k),k},q.Invert=function(n){var k=new q();return n.invertToRef(k),k},q.RotationXToRef=function(n,k){var p=Math.sin(n),u=Math.cos(n);q.FromValuesToRef(1,0,0,0,0,u,p,0,0,-p,u,0,0,0,0,1,k),k._updateIdentityStatus(1===u&&0===p)},q.RotationY=function(n){var k=new q();return q.RotationYToRef(n,k),k},q.RotationYToRef=function(n,k){var p=Math.sin(n),u=Math.cos(n);q.FromValuesToRef(u,0,-p,0,0,1,0,0,p,0,u,0,0,0,0,1,k),k._updateIdentityStatus(1===u&&0===p)},q.RotationZ=function(n){var k=new q();return q.RotationZToRef(n,k),k},q.RotationZToRef=function(n,k){var p=Math.sin(n),u=Math.cos(n);q.FromValuesToRef(u,p,0,0,-p,u,0,0,0,0,1,0,0,0,0,1,k),k._updateIdentityStatus(1===u&&0===p)},q.RotationAxis=function(n,k){var p=new q();return q.RotationAxisToRef(n,k,p),p},q.RotationAxisToRef=function(n,k,p){var u=Math.sin(-k),A=Math.cos(-k),B=1-A;n.normalize();var v=p._m;v[0]=n.x*n.x*B+A,v[1]=n.x*n.y*B-n.z*u,v[2]=n.x*n.z*B+n.y*u,v[3]=0,v[4]=n.y*n.x*B+n.z*u,v[5]=n.y*n.y*B+A,v[6]=n.y*n.z*B-n.x*u,v[7]=0,v[8]=n.z*n.x*B-n.y*u,v[9]=n.z*n.y*B+n.x*u,v[10]=n.z*n.z*B+A,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,p._markAsUpdated()},q.RotationAlignToRef=function(n,k,p){var u=D.Cross(k,n),A=D.Dot(k,n),B=1/(1+A),v=p._m;v[0]=u.x*u.x*B+A,v[1]=u.y*u.x*B-u.z,v[2]=u.z*u.x*B+u.y,v[3]=0,v[4]=u.x*u.y*B+u.z,v[5]=u.y*u.y*B+A,v[6]=u.z*u.y*B-u.x,v[7]=0,v[8]=u.x*u.z*B-u.y,v[9]=u.y*u.z*B+u.x,v[10]=u.z*u.z*B+A,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,p._markAsUpdated()},q.RotationYawPitchRoll=function(n,k,p){var u=new q();return q.RotationYawPitchRollToRef(n,k,p,u),u},q.RotationYawPitchRollToRef=function(n,k,p,u){x.RotationYawPitchRollToRef(n,k,p,s.Quaternion[0]),s.Quaternion[0].toRotationMatrix(u)},q.Scaling=function(n,k,p){var u=new q();return q.ScalingToRef(n,k,p,u),u},q.ScalingToRef=function(n,k,p,u){q.FromValuesToRef(n,0,0,0,0,k,0,0,0,0,p,0,0,0,0,1,u),u._updateIdentityStatus(1===n&&1===k&&1===p)},q.Translation=function(n,k,p){var u=new q();return q.TranslationToRef(n,k,p,u),u},q.TranslationToRef=function(n,k,p,u){q.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,n,k,p,1,u),u._updateIdentityStatus(0===n&&0===k&&0===p)},q.Lerp=function(n,k,p){var u=new q();return q.LerpToRef(n,k,p,u),u},q.LerpToRef=function(n,k,p,u){for(var A=u._m,B=n.m,v=k.m,H=0;H<16;H++)A[H]=B[H]*(1-p)+v[H]*p;u._markAsUpdated()},q.DecomposeLerp=function(n,k,p){var u=new q();return q.DecomposeLerpToRef(n,k,p,u),u},q.DecomposeLerpToRef=function(n,k,p,u){var A=s.Vector3[0],B=s.Quaternion[0],v=s.Vector3[1];n.decompose(A,B,v);var H=s.Vector3[2],L=s.Quaternion[1],Q=s.Vector3[3];k.decompose(H,L,Q);var M=s.Vector3[4];D.LerpToRef(A,H,p,M);var Y=s.Quaternion[2];x.SlerpToRef(B,L,p,Y);var X=s.Vector3[5];D.LerpToRef(v,Q,p,X),q.ComposeToRef(M,Y,X,u)},q.LookAtLH=function(n,k,p){var u=new q();return q.LookAtLHToRef(n,k,p,u),u},q.LookAtLHToRef=function(n,k,p,u){var A=s.Vector3[0],B=s.Vector3[1],v=s.Vector3[2];k.subtractToRef(n,v),v.normalize(),D.CrossToRef(p,v,A);var H=A.lengthSquared();0===H?A.x=1:A.normalizeFromLength(Math.sqrt(H)),D.CrossToRef(v,A,B),B.normalize();var L=-D.Dot(A,n),Q=-D.Dot(B,n),M=-D.Dot(v,n);q.FromValuesToRef(A.x,B.x,v.x,0,A.y,B.y,v.y,0,A.z,B.z,v.z,0,L,Q,M,1,u)},q.LookAtRH=function(n,k,p){var u=new q();return q.LookAtRHToRef(n,k,p,u),u},q.LookAtRHToRef=function(n,k,p,u){var A=s.Vector3[0],B=s.Vector3[1],v=s.Vector3[2];n.subtractToRef(k,v),v.normalize(),D.CrossToRef(p,v,A);var H=A.lengthSquared();0===H?A.x=1:A.normalizeFromLength(Math.sqrt(H)),D.CrossToRef(v,A,B),B.normalize();var L=-D.Dot(A,n),Q=-D.Dot(B,n),M=-D.Dot(v,n);q.FromValuesToRef(A.x,B.x,v.x,0,A.y,B.y,v.y,0,A.z,B.z,v.z,0,L,Q,M,1,u)},q.OrthoLH=function(n,k,p,u){var A=new q();return q.OrthoLHToRef(n,k,p,u,A),A},q.OrthoLHToRef=function(n,k,p,u,A){var B=2/n,v=2/k,H=2/(u-p),L=-(u+p)/(u-p);q.FromValuesToRef(B,0,0,0,0,v,0,0,0,0,H,0,0,0,L,1,A),A._updateIdentityStatus(1===B&&1===v&&1===H&&0===L)},q.OrthoOffCenterLH=function(n,k,p,u,A,B){var v=new q();return q.OrthoOffCenterLHToRef(n,k,p,u,A,B,v),v},q.OrthoOffCenterLHToRef=function(n,k,p,u,A,B,v){var H=2/(k-n),L=2/(u-p),Q=2/(B-A),M=-(B+A)/(B-A),Y=(n+k)/(n-k),X=(u+p)/(p-u);q.FromValuesToRef(H,0,0,0,0,L,0,0,0,0,Q,0,Y,X,M,1,v),v._markAsUpdated()},q.OrthoOffCenterRH=function(n,k,p,u,A,B){var v=new q();return q.OrthoOffCenterRHToRef(n,k,p,u,A,B,v),v},q.OrthoOffCenterRHToRef=function(n,k,p,u,A,B,v){q.OrthoOffCenterLHToRef(n,k,p,u,A,B,v),v._m[10]*=-1},q.PerspectiveLH=function(n,k,p,u){var A=new q(),B=2*p/n,v=2*p/k,H=(u+p)/(u-p),L=-2*u*p/(u-p);return q.FromValuesToRef(B,0,0,0,0,v,0,0,0,0,H,1,0,0,L,0,A),A._updateIdentityStatus(!1),A},q.PerspectiveFovLH=function(n,k,p,u){var A=new q();return q.PerspectiveFovLHToRef(n,k,p,u,A),A},q.PerspectiveFovLHToRef=function(n,k,p,u,A,B){void 0===B&&(B=!0);var v=p,H=u,L=1/Math.tan(.5*n),Q=B?L/k:L,M=B?L:L*k,Y=(H+v)/(H-v),X=-2*H*v/(H-v);q.FromValuesToRef(Q,0,0,0,0,M,0,0,0,0,Y,1,0,0,X,0,A),A._updateIdentityStatus(!1)},q.PerspectiveFovReverseLHToRef=function(n,k,p,u,A,B){void 0===B&&(B=!0);var v=1/Math.tan(.5*n),H=B?v/k:v,L=B?v:v*k;q.FromValuesToRef(H,0,0,0,0,L,0,0,0,0,-p,1,0,0,1,0,A),A._updateIdentityStatus(!1)},q.PerspectiveFovRH=function(n,k,p,u){var A=new q();return q.PerspectiveFovRHToRef(n,k,p,u,A),A},q.PerspectiveFovRHToRef=function(n,k,p,u,A,B){void 0===B&&(B=!0);var v=p,H=u,L=1/Math.tan(.5*n),Q=B?L/k:L,M=B?L:L*k,Y=-(H+v)/(H-v),X=-2*H*v/(H-v);q.FromValuesToRef(Q,0,0,0,0,M,0,0,0,0,Y,-1,0,0,X,0,A),A._updateIdentityStatus(!1)},q.PerspectiveFovReverseRHToRef=function(n,k,p,u,A,B){void 0===B&&(B=!0);var v=1/Math.tan(.5*n),H=B?v/k:v,L=B?v:v*k;q.FromValuesToRef(H,0,0,0,0,L,0,0,0,0,-p,-1,0,0,-1,0,A),A._updateIdentityStatus(!1)},q.PerspectiveFovWebVRToRef=function(n,k,p,u,A){void 0===A&&(A=!1);var B=A?-1:1,v=Math.tan(n.upDegrees*Math.PI/180),H=Math.tan(n.downDegrees*Math.PI/180),L=Math.tan(n.leftDegrees*Math.PI/180),Q=Math.tan(n.rightDegrees*Math.PI/180),M=2/(L+Q),Y=2/(v+H),X=u._m;X[0]=M,X[1]=X[2]=X[3]=X[4]=0,X[5]=Y,X[6]=X[7]=0,X[8]=(L-Q)*M*.5,X[9]=-(v-H)*Y*.5,X[10]=-p/(k-p),X[11]=1*B,X[12]=X[13]=X[15]=0,X[14]=-2*p*k/(p-k),u._markAsUpdated()},q.GetFinalMatrix=function(n,k,p,u,A,B){var v=n.width,H=n.height,L=n.x,Q=n.y,M=q.FromValues(v/2,0,0,0,0,-H/2,0,0,0,0,B-A,0,L+v/2,H/2+Q,A,1),Y=s.Matrix[0];return k.multiplyToRef(p,Y),Y.multiplyToRef(u,Y),Y.multiply(M)},q.GetAsMatrix2x2=function(n){var k=n.m;return new Float32Array([k[0],k[1],k[4],k[5]])},q.GetAsMatrix3x3=function(n){var k=n.m;return new Float32Array([k[0],k[1],k[2],k[4],k[5],k[6],k[8],k[9],k[10]])},q.Transpose=function(n){var k=new q();return q.TransposeToRef(n,k),k},q.TransposeToRef=function(n,k){var p=k._m,u=n.m;p[0]=u[0],p[1]=u[4],p[2]=u[8],p[3]=u[12],p[4]=u[1],p[5]=u[5],p[6]=u[9],p[7]=u[13],p[8]=u[2],p[9]=u[6],p[10]=u[10],p[11]=u[14],p[12]=u[3],p[13]=u[7],p[14]=u[11],p[15]=u[15],k._updateIdentityStatus(n._isIdentity,n._isIdentityDirty)},q.Reflection=function(n){var k=new q();return q.ReflectionToRef(n,k),k},q.ReflectionToRef=function(n,k){n.normalize();var p=n.normal.x,u=n.normal.y,A=n.normal.z,B=-2*p,v=-2*u,H=-2*A;q.FromValuesToRef(B*p+1,v*p,H*p,0,B*u,v*u+1,H*u,0,B*A,v*A,H*A+1,0,B*n.d,v*n.d,H*n.d,1,k)},q.FromXYZAxesToRef=function(n,k,p,u){q.FromValuesToRef(n.x,n.y,n.z,0,k.x,k.y,k.z,0,p.x,p.y,p.z,0,0,0,0,1,u)},q.FromQuaternionToRef=function(n,k){var p=n.x*n.x,u=n.y*n.y,A=n.z*n.z,B=n.x*n.y,v=n.z*n.w,H=n.z*n.x,L=n.y*n.w,Q=n.y*n.z,M=n.x*n.w;k._m[0]=1-2*(u+A),k._m[1]=2*(B+v),k._m[2]=2*(H-L),k._m[3]=0,k._m[4]=2*(B-v),k._m[5]=1-2*(A+p),k._m[6]=2*(Q+M),k._m[7]=0,k._m[8]=2*(H+L),k._m[9]=2*(Q-M),k._m[10]=1-2*(u+p),k._m[11]=0,k._m[12]=0,k._m[13]=0,k._m[14]=0,k._m[15]=1,k._markAsUpdated()},q._updateFlagSeed=0,q._identityReadOnly=q.Identity(),q}(),s=function(){function q(){}return q.Vector3=I.a.BuildArray(6,D.Zero),q.Matrix=I.a.BuildArray(2,l.Identity),q.Quaternion=I.a.BuildArray(3,x.Zero),q}(),y=function(){function q(){}return q.Vector2=I.a.BuildArray(3,G.Zero),q.Vector3=I.a.BuildArray(13,D.Zero),q.Vector4=I.a.BuildArray(3,E.Zero),q.Quaternion=I.a.BuildArray(2,x.Zero),q.Matrix=I.a.BuildArray(8,l.Identity),q}();i.a.RegisteredTypes["BABYLON.Vector2"]=G,i.a.RegisteredTypes["BABYLON.Vector3"]=D,i.a.RegisteredTypes["BABYLON.Vector4"]=E,i.a.RegisteredTypes["BABYLON.Matrix"]=l},function(Ja,t,o){"use strict";o.d(t,"d",function(){return r}),o.d(t,"a",function(){return I}),o.d(t,"c",function(){return i}),o.d(t,"b",function(){return G}),o.d(t,"e",function(){return D});var R=function(E,x){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,s){l.__proto__=s}||function(l,s){for(var y in s)s.hasOwnProperty(y)&&(l[y]=s[y])})(E,x)};function r(E,x){function l(){this.constructor=E}R(E,x),E.prototype=null===x?Object.create(x):(l.prototype=x.prototype,new l())}var I=function(){return(I=Object.assign||function(E){for(var x,l=1,s=arguments.length;l<s;l++)for(var y in x=arguments[l])Object.prototype.hasOwnProperty.call(x,y)&&(E[y]=x[y]);return E}).apply(this,arguments)};function i(E,x,l,s){var y,q=arguments.length,n=q<3?x:null===s?s=Object.getOwnPropertyDescriptor(x,l):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(E,x,l,s);else for(var k=E.length-1;k>=0;k--)(y=E[k])&&(n=(q<3?y(n):q>3?y(x,l,n):y(x,l))||n);return q>3&&n&&Object.defineProperty(x,l,n),n}function G(E,x,l,s){return new(l||(l=Promise))(function(y,q){function n(u){try{p(s.next(u))}catch(A){q(A)}}function k(u){try{p(s.throw(u))}catch(A){q(A)}}function p(u){u.done?y(u.value):new l(function(A){A(u.value)}).then(n,k)}p((s=s.apply(E,x||[])).next())})}function D(E,x){var l,s,y,q,n={label:0,sent:function(){if(1&y[0])throw y[1];return y[1]},trys:[],ops:[]};return q={next:k(0),throw:k(1),return:k(2)},"function"==typeof Symbol&&(q[Symbol.iterator]=function(){return this}),q;function k(p){return function(u){return function(A){if(l)throw new TypeError("Generator is already executing.");for(;n;)try{if(l=1,s&&(y=2&A[0]?s.return:A[0]?s.throw||((y=s.return)&&y.call(s),0):s.next)&&!(y=y.call(s,A[1])).done)return y;switch(s=0,y&&(A=[2&A[0],y.value]),A[0]){case 0:case 1:y=A;break;case 4:return n.label++,{value:A[1],done:!1};case 5:n.label++,s=A[1],A=[0];continue;case 7:A=n.ops.pop(),n.trys.pop();continue;default:if(!(y=(y=n.trys).length>0&&y[y.length-1])&&(6===A[0]||2===A[0])){n=0;continue}if(3===A[0]&&(!y||A[1]>y[0]&&A[1]<y[3])){n.label=A[1];break}if(6===A[0]&&n.label<y[1]){n.label=y[1],y=A;break}if(y&&n.label<y[2]){n.label=y[2],n.ops.push(A);break}y[2]&&n.ops.pop(),n.trys.pop();continue}A=x.call(E,n)}catch(B){A=[6,B],s=0}finally{l=y=0}if(5&A[0])throw A[1];return{value:A[0]?A[1]:void 0,done:!0}}([p,u])}}}},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.ALPHA_DISABLE=0,r.ALPHA_ADD=1,r.ALPHA_COMBINE=2,r.ALPHA_SUBTRACT=3,r.ALPHA_MULTIPLY=4,r.ALPHA_MAXIMIZED=5,r.ALPHA_ONEONE=6,r.ALPHA_PREMULTIPLIED=7,r.ALPHA_PREMULTIPLIED_PORTERDUFF=8,r.ALPHA_INTERPOLATE=9,r.ALPHA_SCREENMODE=10,r.ALPHA_ONEONE_ONEONE=11,r.ALPHA_ALPHATOCOLOR=12,r.ALPHA_REVERSEONEMINUS=13,r.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,r.ALPHA_ONEONE_ONEZERO=15,r.ALPHA_EXCLUSION=16,r.ALPHA_EQUATION_ADD=0,r.ALPHA_EQUATION_SUBSTRACT=1,r.ALPHA_EQUATION_REVERSE_SUBTRACT=2,r.ALPHA_EQUATION_MAX=3,r.ALPHA_EQUATION_MIN=4,r.ALPHA_EQUATION_DARKEN=5,r.DELAYLOADSTATE_NONE=0,r.DELAYLOADSTATE_LOADED=1,r.DELAYLOADSTATE_LOADING=2,r.DELAYLOADSTATE_NOTLOADED=4,r.NEVER=512,r.ALWAYS=519,r.LESS=513,r.EQUAL=514,r.LEQUAL=515,r.GREATER=516,r.GEQUAL=518,r.NOTEQUAL=517,r.KEEP=7680,r.REPLACE=7681,r.INCR=7682,r.DECR=7683,r.INVERT=5386,r.INCR_WRAP=34055,r.DECR_WRAP=34056,r.TEXTURE_CLAMP_ADDRESSMODE=0,r.TEXTURE_WRAP_ADDRESSMODE=1,r.TEXTURE_MIRROR_ADDRESSMODE=2,r.TEXTUREFORMAT_ALPHA=0,r.TEXTUREFORMAT_LUMINANCE=1,r.TEXTUREFORMAT_LUMINANCE_ALPHA=2,r.TEXTUREFORMAT_RGB=4,r.TEXTUREFORMAT_RGBA=5,r.TEXTUREFORMAT_RED=6,r.TEXTUREFORMAT_R=6,r.TEXTUREFORMAT_RG=7,r.TEXTUREFORMAT_RED_INTEGER=8,r.TEXTUREFORMAT_R_INTEGER=8,r.TEXTUREFORMAT_RG_INTEGER=9,r.TEXTUREFORMAT_RGB_INTEGER=10,r.TEXTUREFORMAT_RGBA_INTEGER=11,r.TEXTURETYPE_UNSIGNED_BYTE=0,r.TEXTURETYPE_UNSIGNED_INT=0,r.TEXTURETYPE_FLOAT=1,r.TEXTURETYPE_HALF_FLOAT=2,r.TEXTURETYPE_BYTE=3,r.TEXTURETYPE_SHORT=4,r.TEXTURETYPE_UNSIGNED_SHORT=5,r.TEXTURETYPE_INT=6,r.TEXTURETYPE_UNSIGNED_INTEGER=7,r.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,r.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,r.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,r.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,r.TEXTURETYPE_UNSIGNED_INT_24_8=12,r.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,r.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,r.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,r.TEXTURE_NEAREST_SAMPLINGMODE=1,r.TEXTURE_NEAREST_NEAREST=1,r.TEXTURE_BILINEAR_SAMPLINGMODE=2,r.TEXTURE_LINEAR_LINEAR=2,r.TEXTURE_TRILINEAR_SAMPLINGMODE=3,r.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,r.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,r.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,r.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,r.TEXTURE_NEAREST_LINEAR=7,r.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,r.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,r.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,r.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,r.TEXTURE_LINEAR_NEAREST=12,r.TEXTURE_EXPLICIT_MODE=0,r.TEXTURE_SPHERICAL_MODE=1,r.TEXTURE_PLANAR_MODE=2,r.TEXTURE_CUBIC_MODE=3,r.TEXTURE_PROJECTION_MODE=4,r.TEXTURE_SKYBOX_MODE=5,r.TEXTURE_INVCUBIC_MODE=6,r.TEXTURE_EQUIRECTANGULAR_MODE=7,r.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,r.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,r.SCALEMODE_FLOOR=1,r.SCALEMODE_NEAREST=2,r.SCALEMODE_CEILING=3,r.MATERIAL_TextureDirtyFlag=1,r.MATERIAL_LightDirtyFlag=2,r.MATERIAL_FresnelDirtyFlag=4,r.MATERIAL_AttributesDirtyFlag=8,r.MATERIAL_MiscDirtyFlag=16,r.MATERIAL_AllDirtyFlag=31,r.MATERIAL_TriangleFillMode=0,r.MATERIAL_WireFrameFillMode=1,r.MATERIAL_PointFillMode=2,r.MATERIAL_PointListDrawMode=3,r.MATERIAL_LineListDrawMode=4,r.MATERIAL_LineLoopDrawMode=5,r.MATERIAL_LineStripDrawMode=6,r.MATERIAL_TriangleStripDrawMode=7,r.MATERIAL_TriangleFanDrawMode=8,r.MATERIAL_ClockWiseSideOrientation=0,r.MATERIAL_CounterClockWiseSideOrientation=1,r.ACTION_NothingTrigger=0,r.ACTION_OnPickTrigger=1,r.ACTION_OnLeftPickTrigger=2,r.ACTION_OnRightPickTrigger=3,r.ACTION_OnCenterPickTrigger=4,r.ACTION_OnPickDownTrigger=5,r.ACTION_OnDoublePickTrigger=6,r.ACTION_OnPickUpTrigger=7,r.ACTION_OnPickOutTrigger=16,r.ACTION_OnLongPressTrigger=8,r.ACTION_OnPointerOverTrigger=9,r.ACTION_OnPointerOutTrigger=10,r.ACTION_OnEveryFrameTrigger=11,r.ACTION_OnIntersectionEnterTrigger=12,r.ACTION_OnIntersectionExitTrigger=13,r.ACTION_OnKeyDownTrigger=14,r.ACTION_OnKeyUpTrigger=15,r.PARTICLES_BILLBOARDMODE_Y=2,r.PARTICLES_BILLBOARDMODE_ALL=7,r.PARTICLES_BILLBOARDMODE_STRETCHED=8,r.MESHES_CULLINGSTRATEGY_STANDARD=0,r.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,r.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,r.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,r.SCENELOADER_NO_LOGGING=0,r.SCENELOADER_MINIMAL_LOGGING=1,r.SCENELOADER_SUMMARY_LOGGING=2,r.SCENELOADER_DETAILED_LOGGING=3,r}()},function(Ja,t,o){"use strict";o.d(t,"b",function(){return s}),o.d(t,"c",function(){return y}),o.d(t,"m",function(){return q}),o.d(t,"e",function(){return n}),o.d(t,"h",function(){return k}),o.d(t,"n",function(){return p}),o.d(t,"o",function(){return u}),o.d(t,"k",function(){return A}),o.d(t,"g",function(){return B}),o.d(t,"f",function(){return v}),o.d(t,"i",function(){return H}),o.d(t,"l",function(){return L}),o.d(t,"j",function(){return Q}),o.d(t,"d",function(){return M}),o.d(t,"a",function(){return Y});var R=o(35),r=o(0),I=o(19),i=o(10),G={},D={},E=function(X,U,P){var ga=X();R.a&&R.a.AddTagsTo(ga,U.tags);var ma=x(ga);for(var oa in ma){var ja=ma[oa],aa=U[oa],F=ja.type;if(null!=aa&&"uniqueId"!==oa)switch(F){case 0:case 6:case 11:ga[oa]=aa;break;case 1:ga[oa]=P||aa.isRenderTarget?aa:aa.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:ga[oa]=P?aa:aa.clone()}}return ga};function x(X){var U=X.getClassName();if(D[U])return D[U];D[U]={};for(var P=D[U],ga=X,ma=U;ma;){var oa=G[ma];for(var ja in oa)P[ja]=oa[ja];var aa,F=!1;do{if(!(aa=Object.getPrototypeOf(ga)).getClassName){F=!0;break}if(aa.getClassName()!==ma)break;ga=aa}while(aa);if(F)break;ma=aa.getClassName(),ga=aa}return P}function l(X,U){return function(P,ga){var ma=function(oa){var ja=oa.getClassName();return G[ja]||(G[ja]={}),G[ja]}(P);ma[ga]||(ma[ga]={type:X,sourceName:U})}}function s(X,U){return void 0===U&&(U=null),function(P,ga){return void 0===ga&&(ga=null),function(ma,oa){var ja=ga||"_"+oa;Object.defineProperty(ma,oa,{get:function(){return this[ja]},set:function(aa){this[ja]!==aa&&(this[ja]=aa,ma[P].apply(this))},enumerable:!0,configurable:!0})}}(X,U)}function y(X){return l(0,X)}function q(X){return l(1,X)}function n(X){return l(2,X)}function k(X){return l(3,X)}function p(X){return l(4,X)}function u(X){return l(5,X)}function A(X){return l(6,X)}function B(X){return l(7,X)}function v(X){return l(8,X)}function H(X){return l(9,X)}function L(X){return l(10,X)}function Q(X){return l(12,X)}function M(X){return l(11,X)}var Y=function(){function X(){}return X.AppendSerializedAnimations=function(U,P){if(U.animations){P.animations=[];for(var ga=0;ga<U.animations.length;ga++){var ma=U.animations[ga];P.animations.push(ma.serialize())}}},X.Serialize=function(U,P){P||(P={}),R.a&&(P.tags=R.a.GetTags(U));var ga=x(U);for(var ma in ga){var oa=ga[ma],ja=oa.sourceName||ma,aa=oa.type,F=U[ma];if(null!=F)switch(aa){case 0:P[ja]=F;break;case 1:P[ja]=F.serialize();break;case 2:P[ja]=F.asArray();break;case 3:P[ja]=F.serialize();break;case 4:case 5:P[ja]=F.asArray();break;case 6:P[ja]=F.id;break;case 7:P[ja]=F.serialize();break;case 8:P[ja]=F.asArray();break;case 9:P[ja]=F.serialize();break;case 10:P[ja]=F.asArray();break;case 11:P[ja]=F.id;case 12:P[ja]=F.asArray()}}return P},X.Parse=function(U,P,ga,ma){void 0===ma&&(ma=null);var oa=U();ma||(ma=""),R.a&&R.a.AddTagsTo(oa,P.tags);var ja=x(oa);for(var aa in ja){var F=ja[aa],$=P[F.sourceName||aa],ia=F.type;if(null!=$){var ba=oa;switch(ia){case 0:ba[aa]=$;break;case 1:ga&&(ba[aa]=X._TextureParser($,ga,ma));break;case 2:ba[aa]=i.a.FromArray($);break;case 3:ba[aa]=X._FresnelParametersParser($);break;case 4:ba[aa]=r.d.FromArray($);break;case 5:ba[aa]=r.e.FromArray($);break;case 6:ga&&(ba[aa]=ga.getLastMeshByID($));break;case 7:ba[aa]=X._ColorCurvesParser($);break;case 8:ba[aa]=i.b.FromArray($);break;case 9:ba[aa]=X._ImageProcessingConfigurationParser($);break;case 10:ba[aa]=r.b.FromArray($);break;case 11:ga&&(ba[aa]=ga.getCameraByID($));case 12:ba[aa]=r.a.FromArray($)}}}return oa},X.Clone=function(U,P){return E(U,P,!1)},X.Instanciate=function(U,P){return E(U,P,!0)},X._ImageProcessingConfigurationParser=function(U){throw I.a.WarnImport("ImageProcessingConfiguration")},X._FresnelParametersParser=function(U){throw I.a.WarnImport("FresnelParameters")},X._ColorCurvesParser=function(U){throw I.a.WarnImport("ColorCurves")},X._TextureParser=function(U,P,ga){throw I.a.WarnImport("Texture")},X}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R}),o.d(t,"b",function(){return r});var R=function(){function I(i,G,D,E,x,l,s,y){void 0===E&&(E=0),void 0===x&&(x=!1),void 0===l&&(l=!1),void 0===s&&(s=!1),i.getScene?this._engine=i.getScene().getEngine():this._engine=i,this._updatable=D,this._instanced=l,this._divisor=y||1,this._data=G,this.byteStride=s?E:E*Float32Array.BYTES_PER_ELEMENT,x||this.create()}return I.prototype.createVertexBuffer=function(i,G,D,E,x,l,s){void 0===l&&(l=!1);var y=l?G:G*Float32Array.BYTES_PER_ELEMENT,q=E?l?E:E*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new r(this._engine,this,i,this._updatable,!0,q,void 0===x?this._instanced:x,y,D,void 0,void 0,!0,this._divisor||s)},I.prototype.isUpdatable=function(){return this._updatable},I.prototype.getData=function(){return this._data},I.prototype.getBuffer=function(){return this._buffer},I.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},I.prototype.create=function(i){void 0===i&&(i=null),!i&&this._buffer||(i=i||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,i),this._data=i):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(i),this._data=i):this._buffer=this._engine.createVertexBuffer(i))},I.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},I.prototype.update=function(i){this.create(i)},I.prototype.updateDirectly=function(i,G,D,E){void 0===E&&(E=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,i,E?G:G*Float32Array.BYTES_PER_ELEMENT,D?D*this.byteStride:void 0),this._data=null)},I.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},I}(),r=function(){function I(i,G,D,E,x,l,s,y,q,n,k,p,u){if(void 0===k&&(k=!1),void 0===p&&(p=!1),void 0===u&&(u=1),G instanceof R?(this._buffer=G,this._ownsBuffer=!1):(this._buffer=new R(i,G,E,l,x,s,p),this._ownsBuffer=!0),this._kind=D,null==n){var A=this.getData();this.type=I.FLOAT,A instanceof Int8Array?this.type=I.BYTE:A instanceof Uint8Array?this.type=I.UNSIGNED_BYTE:A instanceof Int16Array?this.type=I.SHORT:A instanceof Uint16Array?this.type=I.UNSIGNED_SHORT:A instanceof Int32Array?this.type=I.INT:A instanceof Uint32Array&&(this.type=I.UNSIGNED_INT)}else this.type=n;var B=I.GetTypeByteLength(this.type);p?(this._size=q||(l?l/B:I.DeduceStride(D)),this.byteStride=l||this._buffer.byteStride||this._size*B,this.byteOffset=y||0):(this._size=q||l||I.DeduceStride(D),this.byteStride=l?l*B:this._buffer.byteStride||this._size*B,this.byteOffset=(y||0)*B),this.normalized=k,this._instanced=void 0!==s&&s,this._instanceDivisor=s?u:0}return Object.defineProperty(I.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(i){this._instanceDivisor=i,this._instanced=0!=i},enumerable:!0,configurable:!0}),I.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},I.prototype.getKind=function(){return this._kind},I.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},I.prototype.getData=function(){return this._buffer.getData()},I.prototype.getBuffer=function(){return this._buffer.getBuffer()},I.prototype.getStrideSize=function(){return this.byteStride/I.GetTypeByteLength(this.type)},I.prototype.getOffset=function(){return this.byteOffset/I.GetTypeByteLength(this.type)},I.prototype.getSize=function(){return this._size},I.prototype.getIsInstanced=function(){return this._instanced},I.prototype.getInstanceDivisor=function(){return this._instanceDivisor},I.prototype.create=function(i){this._buffer.create(i)},I.prototype.update=function(i){this._buffer.update(i)},I.prototype.updateDirectly=function(i,G,D){void 0===D&&(D=!1),this._buffer.updateDirectly(i,G,void 0,D)},I.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},I.prototype.forEach=function(i,G){I.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,i,this.normalized,G)},I.DeduceStride=function(i){switch(i){case I.UVKind:case I.UV2Kind:case I.UV3Kind:case I.UV4Kind:case I.UV5Kind:case I.UV6Kind:return 2;case I.NormalKind:case I.PositionKind:return 3;case I.ColorKind:case I.MatricesIndicesKind:case I.MatricesIndicesExtraKind:case I.MatricesWeightsKind:case I.MatricesWeightsExtraKind:case I.TangentKind:return 4;default:throw new Error("Invalid kind '"+i+"'")}},I.GetTypeByteLength=function(i){switch(i){case I.BYTE:case I.UNSIGNED_BYTE:return 1;case I.SHORT:case I.UNSIGNED_SHORT:return 2;case I.INT:case I.UNSIGNED_INT:case I.FLOAT:return 4;default:throw new Error("Invalid type '"+i+"'")}},I.ForEach=function(i,G,D,E,x,l,s,y){if(i instanceof Array)for(var q=G/4,n=D/4,k=0;k<l;k+=E){for(var p=0;p<E;p++)y(i[q+p],k+p);q+=n}else{var u=i instanceof ArrayBuffer?new DataView(i):new DataView(i.buffer,i.byteOffset,i.byteLength),A=I.GetTypeByteLength(x);for(k=0;k<l;k+=E){var B=G;for(p=0;p<E;p++)y(I._GetFloatValue(u,x,B,s),k+p),B+=A;G+=D}}},I._GetFloatValue=function(i,G,D,E){switch(G){case I.BYTE:var x=i.getInt8(D);return E&&(x=Math.max(x/127,-1)),x;case I.UNSIGNED_BYTE:return x=i.getUint8(D),E&&(x/=255),x;case I.SHORT:return x=i.getInt16(D,!0),E&&(x=Math.max(x/32767,-1)),x;case I.UNSIGNED_SHORT:return x=i.getUint16(D,!0),E&&(x/=65535),x;case I.INT:return i.getInt32(D,!0);case I.UNSIGNED_INT:return i.getUint32(D,!0);case I.FLOAT:return i.getFloat32(D,!0);default:throw new Error("Invalid component type "+G)}},I.BYTE=5120,I.UNSIGNED_BYTE=5121,I.SHORT=5122,I.UNSIGNED_SHORT=5123,I.INT=5124,I.UNSIGNED_INT=5125,I.FLOAT=5126,I.PositionKind="position",I.NormalKind="normal",I.TangentKind="tangent",I.UVKind="uv",I.UV2Kind="uv2",I.UV3Kind="uv3",I.UV4Kind="uv4",I.UV5Kind="uv5",I.UV6Kind="uv6",I.ColorKind="color",I.MatricesIndicesKind="matricesIndices",I.MatricesWeightsKind="matricesWeights",I.MatricesIndicesExtraKind="matricesIndicesExtra",I.MatricesWeightsExtraKind="matricesWeightsExtra",I}()},function(Ja,t,o){"use strict";o.d(t,"b",function(){return U}),o.d(t,"c",function(){return ga}),o.d(t,"a",function(){return oa});var R=o(1),r=o(6),I=o(13),i=o(33),G=o(35),D=o(0),E=o(10),x=o(26),l=o(4),s=o(15),y=o(69),q=o(27),n=o(57),k=o(44),p=o(29),u=o(71),A=o(67),B=o(2),v=o(3),H=o(7),L=o(12),Q=o(19),M=o(17),Y=o(135),X=o(70),U=function(){},P=function(){this.visibleInstances={},this.batchCache=new ga(),this.instancesBufferSize=2048},ga=function(){this.mustReturn=!1,this.visibleInstances=new Array(),this.renderSelf=new Array(),this.hardwareInstancedRendering=new Array()},ma=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array(),this._morphTargetManager=null},oa=function(ja){function aa(F,$,ia,ba,qa,V){void 0===$&&($=null),void 0===ia&&(ia=null),void 0===ba&&(ba=null),void 0===V&&(V=!0);var O=ja.call(this,F,$)||this;if(O._internalMeshDataInfo=new ma(),O.delayLoadState=B.a.DELAYLOADSTATE_NONE,O.instances=new Array(),O._creationDataStorage=null,O._geometry=null,O._instanceDataStorage=new P(),O._effectiveMaterial=null,O._shouldGenerateFlatShading=!1,O._originalBuilderSideOrientation=aa.DEFAULTSIDE,O.overrideMaterialSideOrientation=null,$=O.getScene(),ba){if(ba._geometry&&ba._geometry.applyToMesh(O),i.a.DeepCopy(ba,O,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable","lightSources","morphTargetManager"],["_poseMatrix"]),O._internalMeshDataInfo._source=ba,$.useClonedMeshMap&&(ba._internalMeshDataInfo.meshMap||(ba._internalMeshDataInfo.meshMap={}),ba._internalMeshDataInfo.meshMap[O.uniqueId]=O),O._originalBuilderSideOrientation=ba._originalBuilderSideOrientation,O._creationDataStorage=ba._creationDataStorage,ba._ranges){var S=ba._ranges;for(var F in S)S.hasOwnProperty(F)&&S[F]&&O.createAnimationRange(F,S[F].from,S[F].to)}var W;if(ba.metadata&&ba.metadata.clone?O.metadata=ba.metadata.clone():O.metadata=ba.metadata,G.a&&G.a.HasTags(ba)&&G.a.AddTagsTo(O,G.a.GetTags(ba,!0)),O.parent=ba.parent,O.setPivotMatrix(ba.getPivotMatrix()),O.id=F+"."+ba.id,O.material=ba.material,!qa)for(var da=ba.getDescendants(!0),na=0;na<da.length;na++){var Ea=da[na];Ea.clone&&Ea.clone(F+"."+Ea.name,O)}if(ba.morphTargetManager&&(O.morphTargetManager=ba.morphTargetManager),$.getPhysicsEngine){var Ca=$.getPhysicsEngine();if(V&&Ca){var wa=Ca.getImpostorForPhysicsObject(ba);wa&&(O.physicsImpostor=wa.clone(O))}}for(W=0;W<$.particleSystems.length;W++){var Ka=$.particleSystems[W];Ka.emitter===ba&&Ka.clone(Ka.name,O)}O.refreshBoundingInfo(),O.computeWorldMatrix(!0)}return null!==ia&&(O.parent=ia),O._instanceDataStorage.hardwareInstancedRendering=O.getEngine().getCaps().instancedArrays,O}return Object(R.d)(aa,ja),aa._GetDefaultSideOrientation=function(F){return F||aa.FRONTSIDE},Object.defineProperty(aa.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new r.c()),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new r.c()),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new r.c()),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new r.c()),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"onBeforeDraw",{set:function(F){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(F)},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(F){this._internalMeshDataInfo._morphTargetManager!==F&&(this._internalMeshDataInfo._morphTargetManager=F,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(F){this._unIndexed!==F&&(this._unIndexed=F,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(F){this._instanceDataStorage.manualUpdate=F},enumerable:!0,configurable:!0}),aa.prototype.instantiateHierarchy=function(F,$,ia){void 0===F&&(F=null);var ba=!(this.getTotalVertices()>0)||$&&$.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),F||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));ba&&(ba.parent=F||this.parent,ba.position=this.position.clone(),ba.scaling=this.scaling.clone(),this.rotationQuaternion?ba.rotationQuaternion=this.rotationQuaternion.clone():ba.rotation=this.rotation.clone(),ia&&ia(this,ba));for(var qa=0,V=this.getChildTransformNodes(!0);qa<V.length;qa++)V[qa].instantiateHierarchy(ba,$,ia);return ba},aa.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(aa.prototype,"_isMesh",{get:function(){return!0},enumerable:!0,configurable:!0}),aa.prototype.toString=function(F){var $=ja.prototype.toString.call(this,F);if($+=", n vertices: "+this.getTotalVertices(),$+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var ia=0;ia<this.animations.length;ia++)$+=", animation[0]: "+this.animations[ia].toString(F);if(F)if(this._geometry){var ba=this.getIndices(),qa=this.getVerticesData(l.b.PositionKind);qa&&ba&&($+=", flat shading: "+(qa.length/3===ba.length?"YES":"NO"))}else $+=", flat shading: UNKNOWN";return $},aa.prototype._unBindEffect=function(){ja.prototype._unBindEffect.call(this);for(var F=0,$=this.instances;F<$.length;F++)$[F]._unBindEffect()},Object.defineProperty(aa.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!0,configurable:!0}),aa.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},aa.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(F,$){return F.distance<$.distance?1:F.distance>$.distance?-1:0})},aa.prototype.addLODLevel=function(F,$){if($&&$._masterMesh)return H.a.Warn("You cannot use a mesh as LOD level twice"),this;var ia=new Y.a(F,$);return this._internalMeshDataInfo._LODLevels.push(ia),$&&($._masterMesh=this),this._sortLODLevels(),this},aa.prototype.getLODLevelAtDistance=function(F){for(var $=this._internalMeshDataInfo,ia=0;ia<$._LODLevels.length;ia++){var ba=$._LODLevels[ia];if(ba.distance===F)return ba.mesh}return null},aa.prototype.removeLODLevel=function(F){for(var $=this._internalMeshDataInfo,ia=0;ia<$._LODLevels.length;ia++)$._LODLevels[ia].mesh===F&&($._LODLevels.splice(ia,1),F&&(F._masterMesh=null));return this._sortLODLevels(),this},aa.prototype.getLOD=function(F,$){var ia,ba=this._internalMeshDataInfo;if(!ba._LODLevels||0===ba._LODLevels.length)return this;$?ia=$:ia=this.getBoundingInfo().boundingSphere;var qa=ia.centerWorld.subtract(F.globalPosition).length();if(ba._LODLevels[ba._LODLevels.length-1].distance>qa)return this.onLODLevelSelection&&this.onLODLevelSelection(qa,this,this),this;for(var V=0;V<ba._LODLevels.length;V++){var O=ba._LODLevels[V];if(O.distance<qa)return O.mesh&&(O.mesh._preActivate(),O.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(qa,this,O.mesh),O.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(qa,this,this),this},Object.defineProperty(aa.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),aa.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},aa.prototype.getVerticesData=function(F,$,ia){return this._geometry?this._geometry.getVerticesData(F,$,ia):null},aa.prototype.getVertexBuffer=function(F){return this._geometry?this._geometry.getVertexBuffer(F):null},aa.prototype.isVerticesDataPresent=function(F){return this._geometry?this._geometry.isVerticesDataPresent(F):!!this._delayInfo&&-1!==this._delayInfo.indexOf(F)},aa.prototype.isVertexBufferUpdatable=function(F){return this._geometry?this._geometry.isVertexBufferUpdatable(F):!!this._delayInfo&&-1!==this._delayInfo.indexOf(F)},aa.prototype.getVerticesDataKinds=function(){if(!this._geometry){var F=new Array();return this._delayInfo&&this._delayInfo.forEach(function($){F.push($)}),F}return this._geometry.getVerticesDataKinds()},aa.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},aa.prototype.getIndices=function(F,$){return this._geometry?this._geometry.getIndices(F,$):[]},Object.defineProperty(aa.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),aa.prototype.isReady=function(F,$){if(void 0===F&&(F=!1),void 0===$&&($=!1),this.delayLoadState===B.a.DELAYLOADSTATE_LOADING)return!1;if(!ja.prototype.isReady.call(this,F))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!F)return!0;var ia=this.getEngine(),ba=this.getScene(),qa=$||ia.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var V=this.material||ba.defaultMaterial;if(V){if(V._storeEffectOnSubMeshes)for(var O=0,S=this.subMeshes;O<S.length;O++){var W=(Ka=S[O]).getMaterial();if(W){if(W._storeEffectOnSubMeshes){if(!W.isReadyForSubMesh(this,Ka,qa))return!1}else if(!W.isReady(this,qa))return!1}}else if(!V.isReady(this,qa))return!1}for(var da=0,na=this.lightSources;da<na.length;da++){var Ea=na[da].getShadowGenerator();if(Ea)for(var Ca=0,wa=this.subMeshes;Ca<wa.length;Ca++){var Ka=wa[Ca];if(!Ea.isReady(Ka,qa))return!1}}for(var Ga=0,Ba=this._internalMeshDataInfo._LODLevels;Ga<Ba.length;Ga++){var Na=Ba[Ga];if(Na.mesh&&!Na.mesh.isReady(qa))return!1}return!0},Object.defineProperty(aa.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!0,configurable:!0}),aa.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},aa.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(aa.prototype,"overridenInstanceCount",{set:function(F){this._instanceDataStorage.overridenInstanceCount=F},enumerable:!0,configurable:!0}),aa.prototype._preActivate=function(){var F=this._internalMeshDataInfo,$=this.getScene().getRenderId();return F._preActivateId===$?this:(F._preActivateId=$,this._instanceDataStorage.visibleInstances=null,this)},aa.prototype._preActivateForIntermediateRendering=function(F){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=F),this},aa.prototype._registerInstanceForRenderId=function(F,$){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:$,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[$]||(this._instanceDataStorage.visibleInstances[$]=new Array()),this._instanceDataStorage.visibleInstances[$].push(F),this},aa.prototype.refreshBoundingInfo=function(F){if(void 0===F&&(F=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var $=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(F),$),this},aa.prototype._createGlobalSubMesh=function(F){var $=this.getTotalVertices();if(!$||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var ia=this.getIndices();if(!ia)return null;var ba=ia.length,qa=!1;if(F)qa=!0;else for(var V=0,O=this.subMeshes;V<O.length;V++){var S=O[V];if(S.indexStart+S.indexCount>=ba){qa=!0;break}if(S.verticesStart+S.verticesCount>=$){qa=!0;break}}if(!qa)return this.subMeshes[0]}return this.releaseSubMeshes(),new n.b(0,0,$,0,this.getTotalIndices(),this)},aa.prototype.subdivide=function(F){if(!(F<1)){for(var $=this.getTotalIndices(),ia=$/F|0,ba=0;ia%3!=0;)ia++;this.releaseSubMeshes();for(var qa=0;qa<F&&!(ba>=$);qa++)n.b.CreateFromIndices(0,ba,Math.min(ia,$-ba),this),ba+=ia;this.synchronizeInstances()}},aa.prototype.setVerticesData=function(F,$,ia,ba){if(void 0===ia&&(ia=!1),this._geometry)this._geometry.setVerticesData(F,$,ia,ba);else{var qa=new s.a();qa.set($,F);var V=this.getScene();new y.a(y.a.RandomId(),V,qa,ia,this)}return this},aa.prototype.removeVerticesData=function(F){this._geometry&&this._geometry.removeVerticesData(F)},aa.prototype.markVerticesDataAsUpdatable=function(F,$){void 0===$&&($=!0);var ia=this.getVertexBuffer(F);ia&&ia.isUpdatable()!==$&&this.setVerticesData(F,this.getVerticesData(F),$)},aa.prototype.setVerticesBuffer=function(F){return this._geometry||(this._geometry=y.a.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(F),this},aa.prototype.updateVerticesData=function(F,$,ia,ba){return this._geometry?(ba?(this.makeGeometryUnique(),this.updateVerticesData(F,$,ia,!1)):this._geometry.updateVerticesData(F,$,ia),this):this},aa.prototype.updateMeshPositions=function(F,$){void 0===$&&($=!0);var ia=this.getVerticesData(l.b.PositionKind);if(!ia)return this;if(F(ia),this.updateVerticesData(l.b.PositionKind,ia,!1,!1),$){var ba=this.getIndices(),qa=this.getVerticesData(l.b.NormalKind);if(!qa)return this;s.a.ComputeNormals(ia,ba,qa),this.updateVerticesData(l.b.NormalKind,qa,!1,!1)}return this},aa.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var F=this._geometry,$=this._geometry.copy(y.a.RandomId());return F.releaseForMesh(this,!0),$.applyToMesh(this),this},aa.prototype.setIndices=function(F,$,ia){if(void 0===$&&($=null),void 0===ia&&(ia=!1),this._geometry)this._geometry.setIndices(F,$,ia);else{var ba=new s.a();ba.indices=F;var qa=this.getScene();new y.a(y.a.RandomId(),qa,ba,ia,this)}return this},aa.prototype.updateIndices=function(F,$,ia){return void 0===ia&&(ia=!1),this._geometry?(this._geometry.updateIndices(F,$,ia),this):this},aa.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},aa.prototype._bind=function(F,$,ia){if(!this._geometry)return this;var ba,qa=this.getScene().getEngine();if(this._unIndexed)ba=null;else switch(ia){case p.a.PointFillMode:ba=null;break;case p.a.WireFrameFillMode:ba=F._getLinesIndexBuffer(this.getIndices(),qa);break;default:case p.a.TriangleFillMode:ba=this._geometry.getIndexBuffer()}return this._geometry._bind($,ba),this},aa.prototype._draw=function(F,$,ia){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var ba=this.getScene().getEngine();return this._unIndexed||$==p.a.PointFillMode?ba.drawArraysType($,F.verticesStart,F.verticesCount,ia):$==p.a.WireFrameFillMode?ba.drawElementsType($,0,F._linesIndexCount,ia):ba.drawElementsType($,F.indexStart,F.indexCount,ia),this},aa.prototype.registerBeforeRender=function(F){return this.onBeforeRenderObservable.add(F),this},aa.prototype.unregisterBeforeRender=function(F){return this.onBeforeRenderObservable.removeCallback(F),this},aa.prototype.registerAfterRender=function(F){return this.onAfterRenderObservable.add(F),this},aa.prototype.unregisterAfterRender=function(F){return this.onAfterRenderObservable.removeCallback(F),this},aa.prototype._getInstancesRenderList=function(F,$){if(void 0===$&&($=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var ia=this.getScene(),ba=ia._isInIntermediateRendering(),qa=ba?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,V=this._instanceDataStorage.batchCache;if(V.mustReturn=!1,V.renderSelf[F]=$||!qa&&this.isEnabled()&&this.isVisible,V.visibleInstances[F]=null,this._instanceDataStorage.visibleInstances&&!$){var O=this._instanceDataStorage.visibleInstances,S=ia.getRenderId(),W=ba?O.intermediateDefaultRenderId:O.defaultRenderId;V.visibleInstances[F]=O[S],!V.visibleInstances[F]&&W&&(V.visibleInstances[F]=O[W])}return V.hardwareInstancedRendering[F]=!$&&this._instanceDataStorage.hardwareInstancedRendering&&null!==V.visibleInstances[F]&&void 0!==V.visibleInstances[F],this._instanceDataStorage.previousBatch=V,V},aa.prototype._renderWithInstances=function(F,$,ia,ba,qa){var V=ia.visibleInstances[F._id];if(!V)return this;for(var O=this._instanceDataStorage,S=O.instancesBufferSize,W=O.instancesBuffer,da=16*(V.length+1)*4;O.instancesBufferSize<da;)O.instancesBufferSize*=2;O.instancesData&&S==O.instancesBufferSize||(O.instancesData=new Float32Array(O.instancesBufferSize/4));var na=0,Ea=0,Ca=ia.renderSelf[F._id];if(this._instanceDataStorage.manualUpdate)Ea=(Ca?1:0)+V.length;else{var wa=this._effectiveMesh.getWorldMatrix();if(Ca&&(wa.copyToArray(O.instancesData,na),na+=16,Ea++),V)for(var Ka=0;Ka<V.length;Ka++)V[Ka].getWorldMatrix().copyToArray(O.instancesData,na),na+=16,Ea++}return W&&S==O.instancesBufferSize?W.updateDirectly(O.instancesData,0,Ea):(W&&W.dispose(),W=new l.a(qa,O.instancesData,!0,16,!1,!0),O.instancesBuffer=W,this.setVerticesBuffer(W.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(W.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(W.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(W.createVertexBuffer("world3",12,4))),this._processInstancedBuffers(V,Ca),this.getScene()._activeIndices.addCount(F.indexCount*Ea,!1),this._bind(F,ba,$),this._draw(F,$,Ea),qa.unbindInstanceAttributes(),this},aa.prototype._processInstancedBuffers=function(F,$){},aa.prototype._processRendering=function(F,$,ia,ba,qa,V,O){var S=this.getScene(),W=S.getEngine();if(qa)this._renderWithInstances(F,ia,ba,$,W);else{var da=0;ba.renderSelf[F._id]&&(V&&V(!1,this._effectiveMesh.getWorldMatrix(),O),da++,this._draw(F,ia,this._instanceDataStorage.overridenInstanceCount));var na=ba.visibleInstances[F._id];if(na){var Ea=na.length;da+=Ea;for(var Ca=0;Ca<Ea;Ca++){var wa=na[Ca].getWorldMatrix();V&&V(!0,wa,O),this._draw(F,ia)}}S._activeIndices.addCount(F.indexCount*da,!1)}return this},aa.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),ja.prototype._rebuild.call(this)},aa.prototype._freeze=function(){if(this.subMeshes){for(var F=0;F<this.subMeshes.length;F++)this._getInstancesRenderList(F);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},aa.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},aa.prototype.render=function(F,$,ia){var ba=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var qa=this._getInstancesRenderList(F._id,!!ia);if(qa.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var V,O=ba.getEngine(),S=qa.hardwareInstancedRendering[F._id],W=this._instanceDataStorage,da=F.getMaterial();if(!da)return this;if(!W.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==da){if(da._storeEffectOnSubMeshes){if(!da.isReadyForSubMesh(this,F,S))return this}else if(!da.isReady(this,S))return this;this._effectiveMaterial=da}$&&O.setAlphaMode(this._effectiveMaterial.alphaMode);for(var na=0,Ea=ba._beforeRenderingMeshStage;na<Ea.length;na++)Ea[na].action(this,F,qa);if(!(V=this._effectiveMaterial._storeEffectOnSubMeshes?F.effect:this._effectiveMaterial.getEffect()))return this;var Ca,wa=ia||this._effectiveMesh;if(!W.isFrozen&&this._effectiveMaterial.backFaceCulling){var Ka=wa._getWorldMatrixDeterminant();null==(Ca=this.overrideMaterialSideOrientation)&&(Ca=this._effectiveMaterial.sideOrientation),Ka<0&&(Ca=Ca===p.a.ClockWiseSideOrientation?p.a.CounterClockWiseSideOrientation:p.a.ClockWiseSideOrientation),W.sideOrientation=Ca}else Ca=W.sideOrientation;var Ga=this._effectiveMaterial._preBind(V,Ca);this._effectiveMaterial.forceDepthWrite&&O.setDepthWrite(!0);var Ba=ba.forcePointsCloud?p.a.PointFillMode:ba.forceWireframe?p.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),S||this._bind(F,V,Ba);var Na=wa.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(Na,this,F):this._effectiveMaterial.bind(Na,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(O.setState(!0,this._effectiveMaterial.zOffset,!1,!Ga),this._processRendering(F,V,Ba,qa,S,this._onBeforeDraw,this._effectiveMaterial),O.setState(!0,this._effectiveMaterial.zOffset,!1,Ga)),this._processRendering(F,V,Ba,qa,S,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var db=0,eb=ba._afterRenderingMeshStage;db<eb.length;db++)eb[db].action(this,F,qa);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},aa.prototype._onBeforeDraw=function(F,$,ia){F&&ia&&ia.bindOnlyWorldMatrix($)},aa.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(l.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(l.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},aa.prototype.normalizeSkinFourWeights=function(){for(var F=this.getVerticesData(l.b.MatricesWeightsKind),$=F.length,ia=0;ia<$;ia+=4){var ba=F[ia]+F[ia+1]+F[ia+2]+F[ia+3];if(0===ba)F[ia]=1;else{var qa=1/ba;F[ia]*=qa,F[ia+1]*=qa,F[ia+2]*=qa,F[ia+3]*=qa}}this.setVerticesData(l.b.MatricesWeightsKind,F)},aa.prototype.normalizeSkinWeightsAndExtra=function(){for(var F=this.getVerticesData(l.b.MatricesWeightsExtraKind),$=this.getVerticesData(l.b.MatricesWeightsKind),ia=$.length,ba=0;ba<ia;ba+=4){var qa=$[ba]+$[ba+1]+$[ba+2]+$[ba+3];if(0===(qa+=F[ba]+F[ba+1]+F[ba+2]+F[ba+3]))$[ba]=1;else{var V=1/qa;$[ba]*=V,$[ba+1]*=V,$[ba+2]*=V,$[ba+3]*=V,F[ba]*=V,F[ba+1]*=V,F[ba+2]*=V,F[ba+3]*=V}}this.setVerticesData(l.b.MatricesWeightsKind,$),this.setVerticesData(l.b.MatricesWeightsKind,F)},aa.prototype.validateSkinning=function(){var F=this.getVerticesData(l.b.MatricesWeightsExtraKind),$=this.getVerticesData(l.b.MatricesWeightsKind);if(null===$||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var ia=$.length,ba=0,qa=0,V=0,O=0,S=null===F?4:8,W=new Array(),da=0;da<=S;da++)W[da]=0;for(da=0;da<ia;da+=4){for(var na=$[da],Ea=na,Ca=0===Ea?0:1,wa=1;wa<S;wa++){var Ka=wa<4?$[da+wa]:F[da+wa-4];Ka>na&&ba++,0!==Ka&&Ca++,Ea+=Ka,na=Ka}if(W[Ca]++,Ca>V&&(V=Ca),0===Ea)qa++;else{var Ga=1/Ea,Ba=0;for(wa=0;wa<S;wa++)Ba+=wa<4?Math.abs($[da+wa]-$[da+wa]*Ga):Math.abs(F[da+wa-4]-F[da+wa-4]*Ga);Ba>.001&&O++}}var Na=this.skeleton.bones.length,db=this.getVerticesData(l.b.MatricesIndicesKind),eb=this.getVerticesData(l.b.MatricesIndicesExtraKind),Ya=0;for(da=0;da<ia;da++)for(wa=0;wa<S;wa++){var Sa=wa<4?db[wa]:eb[wa-4];(Sa>=Na||Sa<0)&&Ya++}return{skinned:!0,valid:0===qa&&0===O&&0===Ya,report:"Number of Weights = "+ia/4+`
Maximum influences = `+V+`
Missing Weights = `+qa+`
Not Sorted = `+ba+`
Not Normalized = `+O+`
WeightCounts = [`+W+`]
Number of bones = `+Na+`
Bad Bone Indices = `+Ya}},aa.prototype._checkDelayState=function(){var F=this.getScene();return this._geometry?this._geometry.load(F):this.delayLoadState===B.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=B.a.DELAYLOADSTATE_LOADING,this._queueLoad(F)),this},aa.prototype._queueLoad=function(F){var $=this;F._addPendingData(this);var ia=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return I.b.LoadFile(this.delayLoadingFile,function(ba){ba instanceof ArrayBuffer?$._delayLoadingFunction(ba,$):$._delayLoadingFunction(JSON.parse(ba),$),$.instances.forEach(function(qa){qa.refreshBoundingInfo(),qa._syncSubMeshes()}),$.delayLoadState=B.a.DELAYLOADSTATE_LOADED,F._removePendingData($)},function(){},F.offlineProvider,ia),this},aa.prototype.isInFrustum=function(F){return this.delayLoadState!==B.a.DELAYLOADSTATE_LOADING&&(!!ja.prototype.isInFrustum.call(this,F)&&(this._checkDelayState(),!0))},aa.prototype.setMaterialByID=function(F){var $,ia=this.getScene().materials;for($=ia.length-1;$>-1;$--)if(ia[$].id===F)return this.material=ia[$],this;var ba=this.getScene().multiMaterials;for($=ba.length-1;$>-1;$--)if(ba[$].id===F)return this.material=ba[$],this;return this},aa.prototype.getAnimatables=function(){var F=new Array();return this.material&&F.push(this.material),this.skeleton&&F.push(this.skeleton),F},aa.prototype.bakeTransformIntoVertices=function(F){if(!this.isVerticesDataPresent(l.b.PositionKind))return this;var $=this.subMeshes.splice(0);this._resetPointsArrayCache();var ia,ba=this.getVerticesData(l.b.PositionKind),qa=new Array();for(ia=0;ia<ba.length;ia+=3)D.e.TransformCoordinates(D.e.FromArray(ba,ia),F).toArray(qa,ia);if(this.setVerticesData(l.b.PositionKind,qa,this.getVertexBuffer(l.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(l.b.NormalKind)){for(ba=this.getVerticesData(l.b.NormalKind),qa=[],ia=0;ia<ba.length;ia+=3)D.e.TransformNormal(D.e.FromArray(ba,ia),F).normalize().toArray(qa,ia);this.setVerticesData(l.b.NormalKind,qa,this.getVertexBuffer(l.b.NormalKind).isUpdatable())}return F.m[0]*F.m[5]*F.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=$,this},aa.prototype.bakeCurrentTransformIntoVertices=function(F){return void 0===F&&(F=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(F),this},Object.defineProperty(aa.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),aa.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},aa.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},aa.prototype.clone=function(F,$,ia,ba){return void 0===F&&(F=""),void 0===$&&($=null),void 0===ba&&(ba=!0),new aa(F,this.getScene(),$,this,ia,ba)},aa.prototype.dispose=function(F,$){void 0===$&&($=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var ia=this._internalMeshDataInfo;if(ia._onBeforeDrawObservable&&ia._onBeforeDrawObservable.clear(),ia._onBeforeBindObservable&&ia._onBeforeBindObservable.clear(),ia._onBeforeRenderObservable&&ia._onBeforeRenderObservable.clear(),ia._onAfterRenderObservable&&ia._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(ia.meshMap)for(var ba in ia.meshMap)(O=ia.meshMap[ba])&&(O._internalMeshDataInfo._source=null,ia.meshMap[ba]=void 0);ia._source&&ia._source._internalMeshDataInfo.meshMap&&(ia._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var qa=0,V=this.getScene().meshes;qa<V.length;qa++){var O;(O=V[qa])._internalMeshDataInfo&&O._internalMeshDataInfo._source&&O._internalMeshDataInfo._source===this&&(O._internalMeshDataInfo._source=null)}ia._source=null,this._disposeInstanceSpecificData(),ja.prototype.dispose.call(this,F,$)},aa.prototype._disposeInstanceSpecificData=function(){},aa.prototype.applyDisplacementMap=function(F,$,ia,ba,qa,V,O){var S=this;void 0===O&&(O=!1);var W=this.getScene();return I.b.LoadImage(F,function(da){var na=da.width,Ea=da.height,Ca=X.a.CreateCanvas(na,Ea).getContext("2d");Ca.drawImage(da,0,0);var wa=Ca.getImageData(0,0,na,Ea).data;S.applyDisplacementMapFromBuffer(wa,na,Ea,$,ia,qa,V,O),ba&&ba(S)},function(){},W.offlineProvider),this},aa.prototype.applyDisplacementMapFromBuffer=function(F,$,ia,ba,qa,V,O,S){if(void 0===S&&(S=!1),!this.isVerticesDataPresent(l.b.PositionKind)||!this.isVerticesDataPresent(l.b.NormalKind)||!this.isVerticesDataPresent(l.b.UVKind))return H.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var W=this.getVerticesData(l.b.PositionKind,!0,!0),da=this.getVerticesData(l.b.NormalKind),na=this.getVerticesData(l.b.UVKind),Ea=D.e.Zero(),Ca=D.e.Zero(),wa=D.d.Zero();V=V||D.d.Zero(),O=O||new D.d(1,1);for(var Ka=0;Ka<W.length;Ka+=3){D.e.FromArrayToRef(W,Ka,Ea),D.e.FromArrayToRef(da,Ka,Ca),D.d.FromArrayToRef(na,Ka/3*2,wa);var Ga=4*((Math.abs(wa.x*O.x+V.x)*$%$|0)+(Math.abs(wa.y*O.y+V.y)*ia%ia|0)*$),Ba=.3*(F[Ga]/255)+.59*(F[Ga+1]/255)+.11*(F[Ga+2]/255);Ca.normalize(),Ca.scaleInPlace(ba+(qa-ba)*Ba),(Ea=Ea.add(Ca)).toArray(W,Ka)}return s.a.ComputeNormals(W,this.getIndices(),da),S?(this.setVerticesData(l.b.PositionKind,W),this.setVerticesData(l.b.NormalKind,da)):(this.updateVerticesData(l.b.PositionKind,W),this.updateVerticesData(l.b.NormalKind,da)),this},aa.prototype.convertToFlatShadedMesh=function(){var F,$,ia=this.getVerticesDataKinds(),ba={},qa={},V={},O=!1;for(F=0;F<ia.length;F++){$=ia[F];var S=this.getVertexBuffer($);$!==l.b.NormalKind?(ba[$]=S,qa[$]=ba[$].getData(),V[$]=[]):(O=S.isUpdatable(),ia.splice(F,1),F--)}var W,da=this.subMeshes.slice(0),na=this.getIndices(),Ea=this.getTotalIndices();for(W=0;W<Ea;W++){var Ca=na[W];for(F=0;F<ia.length;F++)for(var wa=ba[$=ia[F]].getStrideSize(),Ka=0;Ka<wa;Ka++)V[$].push(qa[$][Ca*wa+Ka])}var Ga=[],Ba=V[l.b.PositionKind];for(W=0;W<Ea;W+=3){na[W]=W,na[W+1]=W+1,na[W+2]=W+2;for(var Na=D.e.FromArray(Ba,3*W),db=D.e.FromArray(Ba,3*(W+1)),eb=D.e.FromArray(Ba,3*(W+2)),Ya=Na.subtract(db),Sa=eb.subtract(db),sb=D.e.Normalize(D.e.Cross(Ya,Sa)),kb=0;kb<3;kb++)Ga.push(sb.x),Ga.push(sb.y),Ga.push(sb.z)}for(this.setIndices(na),this.setVerticesData(l.b.NormalKind,Ga,O),F=0;F<ia.length;F++)$=ia[F],this.setVerticesData($,V[$],ba[$].isUpdatable());this.releaseSubMeshes();for(var wb=0;wb<da.length;wb++){var tb=da[wb];n.b.AddToMesh(tb.materialIndex,tb.indexStart,tb.indexCount,tb.indexStart,tb.indexCount,this)}return this.synchronizeInstances(),this},aa.prototype.convertToUnIndexedMesh=function(){var F,$,ia=this.getVerticesDataKinds(),ba={},qa={},V={};for(F=0;F<ia.length;F++){$=ia[F];var O=this.getVertexBuffer($);ba[$]=O,qa[$]=ba[$].getData(),V[$]=[]}var S,W=this.subMeshes.slice(0),da=this.getIndices(),na=this.getTotalIndices();for(S=0;S<na;S++){var Ea=da[S];for(F=0;F<ia.length;F++)for(var Ca=ba[$=ia[F]].getStrideSize(),wa=0;wa<Ca;wa++)V[$].push(qa[$][Ea*Ca+wa])}for(S=0;S<na;S+=3)da[S]=S,da[S+1]=S+1,da[S+2]=S+2;for(this.setIndices(da),F=0;F<ia.length;F++)$=ia[F],this.setVerticesData($,V[$],ba[$].isUpdatable());this.releaseSubMeshes();for(var Ka=0;Ka<W.length;Ka++){var Ga=W[Ka];n.b.AddToMesh(Ga.materialIndex,Ga.indexStart,Ga.indexCount,Ga.indexStart,Ga.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},aa.prototype.flipFaces=function(F){void 0===F&&(F=!1);var $,ia,ba=s.a.ExtractFromMesh(this);if(F&&this.isVerticesDataPresent(l.b.NormalKind)&&ba.normals)for($=0;$<ba.normals.length;$++)ba.normals[$]*=-1;if(ba.indices)for($=0;$<ba.indices.length;$+=3)ia=ba.indices[$+1],ba.indices[$+1]=ba.indices[$+2],ba.indices[$+2]=ia;return ba.applyToMesh(this,this.isVertexBufferUpdatable(l.b.PositionKind)),this},aa.prototype.increaseVertices=function(F){var $=s.a.ExtractFromMesh(this),ia=$.uvs,ba=$.indices,qa=$.positions,V=$.normals;if(null===ba||null===qa||null===V||null===ia)H.a.Warn("VertexData contains null entries");else{for(var O,S,W=F+1,da=new Array(),na=0;na<W+1;na++)da[na]=new Array();var Ea,Ca=new D.e(0,0,0),wa=new D.e(0,0,0),Ka=new D.d(0,0),Ga=new Array(),Ba=new Array(),Na=new Array(),db=qa.length,eb=ia.length;for(na=0;na<ba.length;na+=3){Ba[0]=ba[na],Ba[1]=ba[na+1],Ba[2]=ba[na+2];for(var Ya=0;Ya<3;Ya++)if(O=Ba[Ya],S=Ba[(Ya+1)%3],void 0===Na[O]&&void 0===Na[S]?(Na[O]=new Array(),Na[S]=new Array()):(void 0===Na[O]&&(Na[O]=new Array()),void 0===Na[S]&&(Na[S]=new Array())),void 0===Na[O][S]&&void 0===Na[S][O]){Na[O][S]=[],Ca.x=(qa[3*S]-qa[3*O])/W,Ca.y=(qa[3*S+1]-qa[3*O+1])/W,Ca.z=(qa[3*S+2]-qa[3*O+2])/W,wa.x=(V[3*S]-V[3*O])/W,wa.y=(V[3*S+1]-V[3*O+1])/W,wa.z=(V[3*S+2]-V[3*O+2])/W,Ka.x=(ia[2*S]-ia[2*O])/W,Ka.y=(ia[2*S+1]-ia[2*O+1])/W,Na[O][S].push(O);for(var Sa=1;Sa<W;Sa++)Na[O][S].push(qa.length/3),qa[db]=qa[3*O]+Sa*Ca.x,V[db++]=V[3*O]+Sa*wa.x,qa[db]=qa[3*O+1]+Sa*Ca.y,V[db++]=V[3*O+1]+Sa*wa.y,qa[db]=qa[3*O+2]+Sa*Ca.z,V[db++]=V[3*O+2]+Sa*wa.z,ia[eb++]=ia[2*O]+Sa*Ka.x,ia[eb++]=ia[2*O+1]+Sa*Ka.y;Na[O][S].push(S),Na[S][O]=new Array(),Ea=Na[O][S].length;for(var sb=0;sb<Ea;sb++)Na[S][O][sb]=Na[O][S][Ea-1-sb]}for(da[0][0]=ba[na],da[1][0]=Na[ba[na]][ba[na+1]][1],da[1][1]=Na[ba[na]][ba[na+2]][1],Sa=2;Sa<W;Sa++)for(da[Sa][0]=Na[ba[na]][ba[na+1]][Sa],da[Sa][Sa]=Na[ba[na]][ba[na+2]][Sa],Ca.x=(qa[3*da[Sa][Sa]]-qa[3*da[Sa][0]])/Sa,Ca.y=(qa[3*da[Sa][Sa]+1]-qa[3*da[Sa][0]+1])/Sa,Ca.z=(qa[3*da[Sa][Sa]+2]-qa[3*da[Sa][0]+2])/Sa,wa.x=(V[3*da[Sa][Sa]]-V[3*da[Sa][0]])/Sa,wa.y=(V[3*da[Sa][Sa]+1]-V[3*da[Sa][0]+1])/Sa,wa.z=(V[3*da[Sa][Sa]+2]-V[3*da[Sa][0]+2])/Sa,Ka.x=(ia[2*da[Sa][Sa]]-ia[2*da[Sa][0]])/Sa,Ka.y=(ia[2*da[Sa][Sa]+1]-ia[2*da[Sa][0]+1])/Sa,Ya=1;Ya<Sa;Ya++)da[Sa][Ya]=qa.length/3,qa[db]=qa[3*da[Sa][0]]+Ya*Ca.x,V[db++]=V[3*da[Sa][0]]+Ya*wa.x,qa[db]=qa[3*da[Sa][0]+1]+Ya*Ca.y,V[db++]=V[3*da[Sa][0]+1]+Ya*wa.y,qa[db]=qa[3*da[Sa][0]+2]+Ya*Ca.z,V[db++]=V[3*da[Sa][0]+2]+Ya*wa.z,ia[eb++]=ia[2*da[Sa][0]]+Ya*Ka.x,ia[eb++]=ia[2*da[Sa][0]+1]+Ya*Ka.y;for(da[W]=Na[ba[na+1]][ba[na+2]],Ga.push(da[0][0],da[1][0],da[1][1]),Sa=1;Sa<W;Sa++){for(Ya=0;Ya<Sa;Ya++)Ga.push(da[Sa][Ya],da[Sa+1][Ya],da[Sa+1][Ya+1]),Ga.push(da[Sa][Ya],da[Sa+1][Ya+1],da[Sa][Ya+1]);Ga.push(da[Sa][Ya],da[Sa+1][Ya],da[Sa+1][Ya+1])}}$.indices=Ga,$.applyToMesh(this,this.isVertexBufferUpdatable(l.b.PositionKind))}},aa.prototype.forceSharedVertices=function(){var F=s.a.ExtractFromMesh(this),$=F.uvs,ia=F.indices,ba=F.positions,qa=F.colors;if(void 0===ia||void 0===ba||null===ia||null===ba)H.a.Warn("VertexData contains empty entries");else{for(var V,O,S=new Array(),W=new Array(),da=new Array(),na=new Array(),Ea=new Array(),Ca=0,wa=new Array(),Ka=0;Ka<ia.length;Ka+=3){O=[ia[Ka],ia[Ka+1],ia[Ka+2]],Ea=new Array();for(var Ga=0;Ga<3;Ga++){Ea[Ga]="";for(var Ba=0;Ba<3;Ba++)Math.abs(ba[3*O[Ga]+Ba])<1e-08&&(ba[3*O[Ga]+Ba]=0),Ea[Ga]+=ba[3*O[Ga]+Ba]+"|";Ea[Ga]=Ea[Ga].slice(0,-1)}if(Ea[0]!=Ea[1]&&Ea[0]!=Ea[2]&&Ea[1]!=Ea[2])for(Ga=0;Ga<3;Ga++){if((V=wa.indexOf(Ea[Ga]))<0){for(wa.push(Ea[Ga]),V=Ca++,Ba=0;Ba<3;Ba++)S.push(ba[3*O[Ga]+Ba]);if(null!=qa)for(Ba=0;Ba<4;Ba++)na.push(qa[4*O[Ga]+Ba]);if(null!=$)for(Ba=0;Ba<2;Ba++)da.push($[2*O[Ga]+Ba])}W.push(V)}}var Na=new Array();s.a.ComputeNormals(S,W,Na),F.positions=S,F.indices=W,F.normals=Na,null!=$&&(F.uvs=da),null!=qa&&(F.colors=na),F.applyToMesh(this,this.isVertexBufferUpdatable(l.b.PositionKind))}},aa._instancedMeshFactory=function(F,$){throw Q.a.WarnImport("InstancedMesh")},aa._PhysicsImpostorParser=function(F,$,ia){throw Q.a.WarnImport("PhysicsImpostor")},aa.prototype.createInstance=function(F){return aa._instancedMeshFactory(F,this)},aa.prototype.synchronizeInstances=function(){for(var F=0;F<this.instances.length;F++)this.instances[F]._syncSubMeshes();return this},aa.prototype.optimizeIndices=function(F){var $=this,ia=this.getIndices(),ba=this.getVerticesData(l.b.PositionKind);if(!ba||!ia)return this;for(var qa=new Array(),V=0;V<ba.length;V+=3)qa.push(D.e.FromArray(ba,V));var O=new Array();return I.a.SyncAsyncForLoop(qa.length,40,function(S){for(var W=qa.length-1-S,da=qa[W],na=0;na<W;++na){var Ea=qa[na];if(da.equals(Ea)){O[W]=na;break}}},function(){for(var S=0;S<ia.length;++S)ia[S]=O[ia[S]]||ia[S];var W=$.subMeshes.slice(0);$.setIndices(ia),$.subMeshes=W,F&&F($)}),this},aa.prototype.serialize=function(F){F.name=this.name,F.id=this.id,F.type=this.getClassName(),G.a&&G.a.HasTags(this)&&(F.tags=G.a.GetTags(this)),F.position=this.position.asArray(),this.rotationQuaternion?F.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(F.rotation=this.rotation.asArray()),F.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?F.pivotMatrix=this.getPivotMatrix().asArray():F.localMatrix=this.getPivotMatrix().asArray(),F.isEnabled=this.isEnabled(!1),F.isVisible=this.isVisible,F.infiniteDistance=this.infiniteDistance,F.pickable=this.isPickable,F.receiveShadows=this.receiveShadows,F.billboardMode=this.billboardMode,F.visibility=this.visibility,F.checkCollisions=this.checkCollisions,F.isBlocker=this.isBlocker,F.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(F.parentId=this.parent.id),F.isUnIndexed=this.isUnIndexed;var $=this._geometry;if($){var ia=$.id;F.geometryId=ia,F.subMeshes=[];for(var ba=0;ba<this.subMeshes.length;ba++){var qa=this.subMeshes[ba];F.subMeshes.push({materialIndex:qa.materialIndex,verticesStart:qa.verticesStart,verticesCount:qa.verticesCount,indexStart:qa.indexStart,indexCount:qa.indexCount})}}if(this.material?this.material.doNotSerialize||(F.materialId=this.material.id):this.material=null,this.morphTargetManager&&(F.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(F.skeletonId=this.skeleton.id),this.getScene()._getComponent(M.a.NAME_PHYSICSENGINE)){var V=this.getPhysicsImpostor();V&&(F.physicsMass=V.getParam("mass"),F.physicsFriction=V.getParam("friction"),F.physicsRestitution=V.getParam("mass"),F.physicsImpostor=V.type)}this.metadata&&(F.metadata=this.metadata),F.instances=[];for(var O=0;O<this.instances.length;O++){var S=this.instances[O];if(!S.doNotSerialize){var W={name:S.name,id:S.id,position:S.position.asArray(),scaling:S.scaling.asArray()};S.parent&&(W.parentId=S.parent.id),S.rotationQuaternion?W.rotationQuaternion=S.rotationQuaternion.asArray():S.rotation&&(W.rotation=S.rotation.asArray()),F.instances.push(W),v.a.AppendSerializedAnimations(S,W),W.ranges=S.serializeAnimationRanges()}}v.a.AppendSerializedAnimations(this,F),F.ranges=this.serializeAnimationRanges(),F.layerMask=this.layerMask,F.alphaIndex=this.alphaIndex,F.hasVertexAlpha=this.hasVertexAlpha,F.overlayAlpha=this.overlayAlpha,F.overlayColor=this.overlayColor.asArray(),F.renderOverlay=this.renderOverlay,F.applyFog=this.applyFog,this.actionManager&&(F.actions=this.actionManager.serialize(this.name))},aa.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var F=this._internalMeshDataInfo._morphTargetManager;if(F&&F.vertexCount){if(F.vertexCount!==this.getTotalVertices())return H.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var $=0;$<F.numInfluencers;$++){var ia=F.getActiveTarget($),ba=ia.getPositions();if(!ba)return void H.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(l.b.PositionKind+$,ba,!1,3);var qa=ia.getNormals();qa&&this.geometry.setVerticesData(l.b.NormalKind+$,qa,!1,3);var V=ia.getTangents();V&&this.geometry.setVerticesData(l.b.TangentKind+$,V,!1,3);var O=ia.getUVs();O&&this.geometry.setVerticesData(l.b.UVKind+"_"+$,O,!1,2)}}else for($=0;this.geometry.isVerticesDataPresent(l.b.PositionKind+$);)this.geometry.removeVerticesData(l.b.PositionKind+$),this.geometry.isVerticesDataPresent(l.b.NormalKind+$)&&this.geometry.removeVerticesData(l.b.NormalKind+$),this.geometry.isVerticesDataPresent(l.b.TangentKind+$)&&this.geometry.removeVerticesData(l.b.TangentKind+$),this.geometry.isVerticesDataPresent(l.b.UVKind+$)&&this.geometry.removeVerticesData(l.b.UVKind+"_"+$),$++}},aa.Parse=function(F,$,ia){var ba;if((ba=F.type&&"GroundMesh"===F.type?aa._GroundMeshParser(F,$):new aa(F.name,$)).id=F.id,G.a&&G.a.AddTagsTo(ba,F.tags),ba.position=D.e.FromArray(F.position),void 0!==F.metadata&&(ba.metadata=F.metadata),F.rotationQuaternion?ba.rotationQuaternion=D.b.FromArray(F.rotationQuaternion):F.rotation&&(ba.rotation=D.e.FromArray(F.rotation)),ba.scaling=D.e.FromArray(F.scaling),F.localMatrix?ba.setPreTransformMatrix(D.a.FromArray(F.localMatrix)):F.pivotMatrix&&ba.setPivotMatrix(D.a.FromArray(F.pivotMatrix)),ba.setEnabled(F.isEnabled),ba.isVisible=F.isVisible,ba.infiniteDistance=F.infiniteDistance,ba.showBoundingBox=F.showBoundingBox,ba.showSubMeshesBoundingBox=F.showSubMeshesBoundingBox,void 0!==F.applyFog&&(ba.applyFog=F.applyFog),void 0!==F.pickable&&(ba.isPickable=F.pickable),void 0!==F.alphaIndex&&(ba.alphaIndex=F.alphaIndex),ba.receiveShadows=F.receiveShadows,ba.billboardMode=F.billboardMode,void 0!==F.visibility&&(ba.visibility=F.visibility),ba.checkCollisions=F.checkCollisions,ba.overrideMaterialSideOrientation=F.overrideMaterialSideOrientation,void 0!==F.isBlocker&&(ba.isBlocker=F.isBlocker),ba._shouldGenerateFlatShading=F.useFlatShading,F.freezeWorldMatrix&&(ba._waitingData.freezeWorldMatrix=F.freezeWorldMatrix),F.parentId&&(ba._waitingParentId=F.parentId),void 0!==F.actions&&(ba._waitingData.actions=F.actions),void 0!==F.overlayAlpha&&(ba.overlayAlpha=F.overlayAlpha),void 0!==F.overlayColor&&(ba.overlayColor=E.a.FromArray(F.overlayColor)),void 0!==F.renderOverlay&&(ba.renderOverlay=F.renderOverlay),ba.isUnIndexed=!!F.isUnIndexed,ba.hasVertexAlpha=F.hasVertexAlpha,F.delayLoadingFile?(ba.delayLoadState=B.a.DELAYLOADSTATE_NOTLOADED,ba.delayLoadingFile=ia+F.delayLoadingFile,ba._boundingInfo=new k.a(D.e.FromArray(F.boundingBoxMinimum),D.e.FromArray(F.boundingBoxMaximum)),F._binaryInfo&&(ba._binaryInfo=F._binaryInfo),ba._delayInfo=[],F.hasUVs&&ba._delayInfo.push(l.b.UVKind),F.hasUVs2&&ba._delayInfo.push(l.b.UV2Kind),F.hasUVs3&&ba._delayInfo.push(l.b.UV3Kind),F.hasUVs4&&ba._delayInfo.push(l.b.UV4Kind),F.hasUVs5&&ba._delayInfo.push(l.b.UV5Kind),F.hasUVs6&&ba._delayInfo.push(l.b.UV6Kind),F.hasColors&&ba._delayInfo.push(l.b.ColorKind),F.hasMatricesIndices&&ba._delayInfo.push(l.b.MatricesIndicesKind),F.hasMatricesWeights&&ba._delayInfo.push(l.b.MatricesWeightsKind),ba._delayLoadingFunction=y.a._ImportGeometry,A.a.ForceFullSceneLoadingForIncremental&&ba._checkDelayState()):y.a._ImportGeometry(F,ba),F.materialId?ba.setMaterialByID(F.materialId):ba.material=null,F.morphTargetManagerId>-1&&(ba.morphTargetManager=$.getMorphTargetManagerById(F.morphTargetManagerId)),F.skeletonId>-1&&(ba.skeleton=$.getLastSkeletonByID(F.skeletonId),F.numBoneInfluencers&&(ba.numBoneInfluencers=F.numBoneInfluencers)),F.animations){for(var qa=0;qa<F.animations.length;qa++){var V=F.animations[qa];(da=L.a.GetClass("BABYLON.Animation"))&&ba.animations.push(da.Parse(V))}x.a.ParseAnimationRanges(ba,F,$)}if(F.autoAnimate&&$.beginAnimation(ba,F.autoAnimateFrom,F.autoAnimateTo,F.autoAnimateLoop,F.autoAnimateSpeed||1),F.layerMask&&!isNaN(F.layerMask)?ba.layerMask=Math.abs(parseInt(F.layerMask)):ba.layerMask=268435455,F.physicsImpostor&&aa._PhysicsImpostorParser($,ba,F),F.lodMeshIds&&(ba._waitingData.lods={ids:F.lodMeshIds,distances:F.lodDistances?F.lodDistances:null,coverages:F.lodCoverages?F.lodCoverages:null}),F.instances)for(var O=0;O<F.instances.length;O++){var S=F.instances[O],W=ba.createInstance(S.name);if(S.id&&(W.id=S.id),G.a&&(S.tags?G.a.AddTagsTo(W,S.tags):G.a.AddTagsTo(W,F.tags)),W.position=D.e.FromArray(S.position),void 0!==S.metadata&&(W.metadata=S.metadata),S.parentId&&(W._waitingParentId=S.parentId),S.rotationQuaternion?W.rotationQuaternion=D.b.FromArray(S.rotationQuaternion):S.rotation&&(W.rotation=D.e.FromArray(S.rotation)),W.scaling=D.e.FromArray(S.scaling),null!=S.checkCollisions&&null!=S.checkCollisions&&(W.checkCollisions=S.checkCollisions),null!=S.pickable&&null!=S.pickable&&(W.isPickable=S.pickable),null!=S.showBoundingBox&&null!=S.showBoundingBox&&(W.showBoundingBox=S.showBoundingBox),null!=S.showSubMeshesBoundingBox&&null!=S.showSubMeshesBoundingBox&&(W.showSubMeshesBoundingBox=S.showSubMeshesBoundingBox),null!=S.alphaIndex&&null!=S.showSubMeshesBoundingBox&&(W.alphaIndex=S.alphaIndex),S.physicsImpostor&&aa._PhysicsImpostorParser($,W,S),S.animations){for(qa=0;qa<S.animations.length;qa++){var da;V=S.animations[qa],(da=L.a.GetClass("BABYLON.Animation"))&&W.animations.push(da.Parse(V))}x.a.ParseAnimationRanges(W,S,$),S.autoAnimate&&$.beginAnimation(W,S.autoAnimateFrom,S.autoAnimateTo,S.autoAnimateLoop,S.autoAnimateSpeed||1)}}return ba},aa.CreateRibbon=function(F,$,ia,ba,qa,V,O,S,W){throw Q.a.WarnImport("MeshBuilder")},aa.CreateDisc=function(F,$,ia,ba,qa,V){throw void 0===ba&&(ba=null),Q.a.WarnImport("MeshBuilder")},aa.CreateBox=function(F,$,ia,ba,qa){throw void 0===ia&&(ia=null),Q.a.WarnImport("MeshBuilder")},aa.CreateSphere=function(F,$,ia,ba,qa,V){throw Q.a.WarnImport("MeshBuilder")},aa.CreateHemisphere=function(F,$,ia,ba){throw Q.a.WarnImport("MeshBuilder")},aa.CreateCylinder=function(F,$,ia,ba,qa,V,O,S,W){throw Q.a.WarnImport("MeshBuilder")},aa.CreateTorus=function(F,$,ia,ba,qa,V,O){throw Q.a.WarnImport("MeshBuilder")},aa.CreateTorusKnot=function(F,$,ia,ba,qa,V,O,S,W,da){throw Q.a.WarnImport("MeshBuilder")},aa.CreateLines=function(F,$,ia,ba,qa){throw void 0===ia&&(ia=null),void 0===ba&&(ba=!1),void 0===qa&&(qa=null),Q.a.WarnImport("MeshBuilder")},aa.CreateDashedLines=function(F,$,ia,ba,qa,V,O,S){throw void 0===V&&(V=null),Q.a.WarnImport("MeshBuilder")},aa.CreatePolygon=function(F,$,ia,ba,qa,V,O){throw void 0===O&&(O=earcut),Q.a.WarnImport("MeshBuilder")},aa.ExtrudePolygon=function(F,$,ia,ba,qa,V,O,S){throw void 0===S&&(S=earcut),Q.a.WarnImport("MeshBuilder")},aa.ExtrudeShape=function(F,$,ia,ba,qa,V,O,S,W,da){throw void 0===O&&(O=null),Q.a.WarnImport("MeshBuilder")},aa.ExtrudeShapeCustom=function(F,$,ia,ba,qa,V,O,S,W,da,na,Ea){throw Q.a.WarnImport("MeshBuilder")},aa.CreateLathe=function(F,$,ia,ba,qa,V,O){throw Q.a.WarnImport("MeshBuilder")},aa.CreatePlane=function(F,$,ia,ba,qa){throw Q.a.WarnImport("MeshBuilder")},aa.CreateGround=function(F,$,ia,ba,qa,V){throw Q.a.WarnImport("MeshBuilder")},aa.CreateTiledGround=function(F,$,ia,ba,qa,V,O,S,W){throw Q.a.WarnImport("MeshBuilder")},aa.CreateGroundFromHeightMap=function(F,$,ia,ba,qa,V,O,S,W,da,na){throw Q.a.WarnImport("MeshBuilder")},aa.CreateTube=function(F,$,ia,ba,qa,V,O,S,W,da){throw Q.a.WarnImport("MeshBuilder")},aa.CreatePolyhedron=function(F,$,ia){throw Q.a.WarnImport("MeshBuilder")},aa.CreateIcoSphere=function(F,$,ia){throw Q.a.WarnImport("MeshBuilder")},aa.CreateDecal=function(F,$,ia,ba,qa,V){throw Q.a.WarnImport("MeshBuilder")},aa.prototype.setPositionsForCPUSkinning=function(){var F=this._internalMeshDataInfo;if(!F._sourcePositions){var $=this.getVerticesData(l.b.PositionKind);if(!$)return F._sourcePositions;F._sourcePositions=new Float32Array($),this.isVertexBufferUpdatable(l.b.PositionKind)||this.setVerticesData(l.b.PositionKind,$,!0)}return F._sourcePositions},aa.prototype.setNormalsForCPUSkinning=function(){var F=this._internalMeshDataInfo;if(!F._sourceNormals){var $=this.getVerticesData(l.b.NormalKind);if(!$)return F._sourceNormals;F._sourceNormals=new Float32Array($),this.isVertexBufferUpdatable(l.b.NormalKind)||this.setVerticesData(l.b.NormalKind,$,!0)}return F._sourceNormals},aa.prototype.applySkeleton=function(F){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(l.b.PositionKind))return this;if(!this.isVerticesDataPresent(l.b.NormalKind))return this;if(!this.isVerticesDataPresent(l.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(l.b.MatricesWeightsKind))return this;var $=this._internalMeshDataInfo;if(!$._sourcePositions){var ia=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=ia}$._sourceNormals||this.setNormalsForCPUSkinning();var ba=this.getVerticesData(l.b.PositionKind);if(!ba)return this;ba instanceof Float32Array||(ba=new Float32Array(ba));var qa=this.getVerticesData(l.b.NormalKind);if(!qa)return this;qa instanceof Float32Array||(qa=new Float32Array(qa));var V=this.getVerticesData(l.b.MatricesIndicesKind),O=this.getVerticesData(l.b.MatricesWeightsKind);if(!O||!V)return this;for(var S,W=this.numBoneInfluencers>4,da=W?this.getVerticesData(l.b.MatricesIndicesExtraKind):null,na=W?this.getVerticesData(l.b.MatricesWeightsExtraKind):null,Ea=F.getTransformMatrices(this),Ca=D.e.Zero(),wa=new D.a(),Ka=new D.a(),Ga=0,Ba=0;Ba<ba.length;Ba+=3,Ga+=4){var Na;for(S=0;S<4;S++)(Na=O[Ga+S])>0&&(D.a.FromFloat32ArrayToRefScaled(Ea,Math.floor(16*V[Ga+S]),Na,Ka),wa.addToSelf(Ka));if(W)for(S=0;S<4;S++)(Na=na[Ga+S])>0&&(D.a.FromFloat32ArrayToRefScaled(Ea,Math.floor(16*da[Ga+S]),Na,Ka),wa.addToSelf(Ka));D.e.TransformCoordinatesFromFloatsToRef($._sourcePositions[Ba],$._sourcePositions[Ba+1],$._sourcePositions[Ba+2],wa,Ca),Ca.toArray(ba,Ba),D.e.TransformNormalFromFloatsToRef($._sourceNormals[Ba],$._sourceNormals[Ba+1],$._sourceNormals[Ba+2],wa,Ca),Ca.toArray(qa,Ba),wa.reset()}return this.updateVerticesData(l.b.PositionKind,ba),this.updateVerticesData(l.b.NormalKind,qa),this},aa.MinMax=function(F){var $=null,ia=null;return F.forEach(function(ba){var qa=ba.getBoundingInfo().boundingBox;$&&ia?($.minimizeInPlace(qa.minimumWorld),ia.maximizeInPlace(qa.maximumWorld)):($=qa.minimumWorld,ia=qa.maximumWorld)}),$&&ia?{min:$,max:ia}:{min:D.e.Zero(),max:D.e.Zero()}},aa.Center=function(F){var $=F instanceof Array?aa.MinMax(F):F;return D.e.Center($.min,$.max)},aa.MergeMeshes=function(F,$,ia,ba,qa,V){var O;if(void 0===$&&($=!0),!ia){var S=0;for(O=0;O<F.length;O++)if(F[O]&&(S+=F[O].getTotalVertices())>=65536)return H.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(V){var W,da,na=null;qa=!1}var Ea,Ca=new Array(),wa=new Array(),Ka=null,Ga=new Array(),Ba=null;for(O=0;O<F.length;O++)if(F[O]){var Na=F[O];if(Na.isAnInstance)return H.a.Warn("Cannot merge instance meshes."),null;var db=Na.computeWorldMatrix(!0);if((Ea=s.a.ExtractFromMesh(Na,!0,!0)).transform(db),Ka?Ka.merge(Ea,ia):(Ka=Ea,Ba=Na),qa&&Ga.push(Na.getTotalIndices()),V)if(Na.material){var eb=Na.material;if(eb instanceof u.a){for(da=0;da<eb.subMaterials.length;da++)Ca.indexOf(eb.subMaterials[da])<0&&Ca.push(eb.subMaterials[da]);for(W=0;W<Na.subMeshes.length;W++)wa.push(Ca.indexOf(eb.subMaterials[Na.subMeshes[W].materialIndex])),Ga.push(Na.subMeshes[W].indexCount)}else for(Ca.indexOf(eb)<0&&Ca.push(eb),W=0;W<Na.subMeshes.length;W++)wa.push(Ca.indexOf(eb)),Ga.push(Na.subMeshes[W].indexCount)}else for(W=0;W<Na.subMeshes.length;W++)wa.push(0),Ga.push(Na.subMeshes[W].indexCount)}if(Ba=Ba,ba||(ba=new aa(Ba.name+"_merged",Ba.getScene())),Ka.applyToMesh(ba),ba.checkCollisions=Ba.checkCollisions,$)for(O=0;O<F.length;O++)F[O]&&F[O].dispose();if(qa||V){ba.releaseSubMeshes(),O=0;for(var Ya=0;O<Ga.length;)n.b.CreateFromIndices(0,Ya,Ga[O],ba),Ya+=Ga[O],O++}if(V){for((na=new u.a(Ba.name+"_merged",Ba.getScene())).subMaterials=Ca,W=0;W<ba.subMeshes.length;W++)ba.subMeshes[W].materialIndex=wa[W];ba.material=na}else ba.material=Ba.material;return ba},aa.prototype.addInstance=function(F){F._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(F)},aa.prototype.removeInstance=function(F){var $=F._indexInSourceMeshInstanceArray;if(-1!=$){if($!==this.instances.length-1){var ia=this.instances[this.instances.length-1];this.instances[$]=ia,ia._indexInSourceMeshInstanceArray=$}F._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},aa.FRONTSIDE=s.a.FRONTSIDE,aa.BACKSIDE=s.a.BACKSIDE,aa.DOUBLESIDE=s.a.DOUBLESIDE,aa.DEFAULTSIDE=s.a.DEFAULTSIDE,aa.NO_CAP=0,aa.CAP_START=1,aa.CAP_END=2,aa.CAP_ALL=3,aa.NO_FLIP=0,aa.FLIP_TILE=1,aa.ROTATE_TILE=2,aa.FLIP_ROW=3,aa.ROTATE_ROW=4,aa.FLIP_N_ROTATE_TILE=5,aa.FLIP_N_ROTATE_ROW=6,aa.CENTER=0,aa.LEFT=1,aa.RIGHT=2,aa.TOP=3,aa.BOTTOM=4,aa._GroundMeshParser=function(F,$){throw Q.a.WarnImport("GroundMesh")},aa}(q.a)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R}),o.d(t,"d",function(){return r}),o.d(t,"b",function(){return I}),o.d(t,"c",function(){return i});var R=function(){function G(D,E,x,l){void 0===E&&(E=!1),this.initalize(D,E,x,l)}return G.prototype.initalize=function(D,E,x,l){return void 0===E&&(E=!1),this.mask=D,this.skipNextObservers=E,this.target=x,this.currentTarget=l,this},G}(),r=function(G,D,E){void 0===E&&(E=null),this.callback=G,this.mask=D,this.scope=E,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},I=function(){function G(){}return G.prototype.dispose=function(){if(this._observers&&this._observables)for(var D=0;D<this._observers.length;D++)this._observables[D].remove(this._observers[D]);this._observers=null,this._observables=null},G.Watch=function(D,E,x,l){void 0===x&&(x=-1),void 0===l&&(l=null);var s=new G();s._observers=new Array(),s._observables=D;for(var y=0,q=D;y<q.length;y++){var n=q[y].add(E,x,!1,l);n&&s._observers.push(n)}return s},G}(),i=function(){function G(D){this._observers=new Array(),this._eventState=new R(0),D&&(this._onObserverAdded=D)}return Object.defineProperty(G.prototype,"observers",{get:function(){return this._observers},enumerable:!0,configurable:!0}),G.prototype.add=function(D,E,x,l,s){if(void 0===E&&(E=-1),void 0===x&&(x=!1),void 0===l&&(l=null),void 0===s&&(s=!1),!D)return null;var y=new r(D,E,l);return y.unregisterOnNextCall=s,x?this._observers.unshift(y):this._observers.push(y),this._onObserverAdded&&this._onObserverAdded(y),y},G.prototype.addOnce=function(D){return this.add(D,void 0,void 0,void 0,!0)},G.prototype.remove=function(D){return!!D&&(-1!==this._observers.indexOf(D)&&(this._deferUnregister(D),!0))},G.prototype.removeCallback=function(D,E){for(var x=0;x<this._observers.length;x++){var l=this._observers[x];if(!l._willBeUnregistered&&(l.callback===D&&(!E||E===l.scope)))return this._deferUnregister(l),!0}return!1},G.prototype._deferUnregister=function(D){var E=this;D.unregisterOnNextCall=!1,D._willBeUnregistered=!0,setTimeout(function(){E._remove(D)},0)},G.prototype._remove=function(D){if(!D)return!1;var E=this._observers.indexOf(D);return-1!==E&&(this._observers.splice(E,1),!0)},G.prototype.makeObserverTopPriority=function(D){this._remove(D),this._observers.unshift(D)},G.prototype.makeObserverBottomPriority=function(D){this._remove(D),this._observers.push(D)},G.prototype.notifyObservers=function(D,E,x,l){if(void 0===E&&(E=-1),!this._observers.length)return!0;var s=this._eventState;s.mask=E,s.target=x,s.currentTarget=l,s.skipNextObservers=!1,s.lastReturnValue=D;for(var y=0,q=this._observers;y<q.length;y++){var n=q[y];if(!n._willBeUnregistered&&(n.mask&E&&(n.scope?s.lastReturnValue=n.callback.apply(n.scope,[D,s]):s.lastReturnValue=n.callback(D,s),n.unregisterOnNextCall&&this._deferUnregister(n)),s.skipNextObservers))return!1}return!0},G.prototype.notifyObserversWithPromise=function(D,E,x,l){var s=this;void 0===E&&(E=-1);var y=Promise.resolve(D);if(!this._observers.length)return y;var q=this._eventState;return q.mask=E,q.target=x,q.currentTarget=l,q.skipNextObservers=!1,this._observers.forEach(function(n){q.skipNextObservers||n._willBeUnregistered||n.mask&E&&(y=n.scope?y.then(function(k){return q.lastReturnValue=k,n.callback.apply(n.scope,[D,q])}):y.then(function(k){return q.lastReturnValue=k,n.callback(D,q)}),n.unregisterOnNextCall&&s._deferUnregister(n))}),y.then(function(){return D})},G.prototype.notifyObserver=function(D,E,x){void 0===x&&(x=-1);var l=this._eventState;l.mask=x,l.skipNextObservers=!1,D.callback(E,l)},G.prototype.hasObservers=function(){return this._observers.length>0},G.prototype.clear=function(){this._observers=new Array(),this._onObserverAdded=null},G.prototype.clone=function(){var D=new G();return D._observers=this._observers.slice(0),D},G.prototype.hasSpecificMask=function(D){void 0===D&&(D=-1);for(var E=0,x=this._observers;E<x.length;E++){var l=x[E];if(l.mask&D||l.mask===D)return!0}return!1},G}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r._AddLogEntry=function(I){r._LogCache=I+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(I)},r._FormatMessage=function(I){var i=function(D){return D<10?"0"+D:""+D},G=new Date();return"["+i(G.getHours())+":"+i(G.getMinutes())+":"+i(G.getSeconds())+"]: "+I},r._LogDisabled=function(I){},r._LogEnabled=function(I){var i=r._FormatMessage(I);console.log("BJS - "+i);var G="<div style='color:white'>"+i+"</div><br>";r._AddLogEntry(G)},r._WarnDisabled=function(I){},r._WarnEnabled=function(I){var i=r._FormatMessage(I);console.warn("BJS - "+i);var G="<div style='color:orange'>"+i+"</div><br>";r._AddLogEntry(G)},r._ErrorDisabled=function(I){},r._ErrorEnabled=function(I){r.errorsCount++;var i=r._FormatMessage(I);console.error("BJS - "+i);var G="<div style='color:red'>"+i+"</div><br>";r._AddLogEntry(G)},Object.defineProperty(r,"LogCache",{get:function(){return r._LogCache},enumerable:!0,configurable:!0}),r.ClearLogCache=function(){r._LogCache="",r.errorsCount=0},Object.defineProperty(r,"LogLevels",{set:function(I){(I&r.MessageLogLevel)===r.MessageLogLevel?r.Log=r._LogEnabled:r.Log=r._LogDisabled,(I&r.WarningLogLevel)===r.WarningLogLevel?r.Warn=r._WarnEnabled:r.Warn=r._WarnDisabled,(I&r.ErrorLogLevel)===r.ErrorLogLevel?r.Error=r._ErrorEnabled:r.Error=r._ErrorDisabled},enumerable:!0,configurable:!0}),r.NoneLogLevel=0,r.MessageLogLevel=1,r.WarningLogLevel=2,r.ErrorLogLevel=4,r.AllLogLevel=7,r._LogCache="",r.errorsCount=0,r.Log=r._LogEnabled,r.Warn=r._WarnEnabled,r.Error=r._ErrorEnabled,r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return D});var R=o(6),r=o(2),I=o(38),i=o(7),G=o(116),D=function(){function E(x,l,s,y,q,n,k,p,u,A){var B,v,H=this;if(void 0===y&&(y=null),void 0===n&&(n=null),void 0===k&&(k=null),void 0===p&&(p=null),void 0===u&&(u=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new R.c(),this.onErrorObservable=new R.c(),this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._valueCache={},this.name=x,l.attributes){var L=l;if(this._engine=s,this._attributesNames=L.attributes,this._uniformsNames=L.uniformsNames.concat(L.samplers),this._samplerList=L.samplers.slice(),this.defines=L.defines,this.onError=L.onError,this.onCompiled=L.onCompiled,this._fallbacks=L.fallbacks,this._indexParameters=L.indexParameters,this._transformFeedbackVaryings=L.transformFeedbackVaryings||null,L.uniformBuffersNames)for(var Q=0;Q<L.uniformBuffersNames.length;Q++)this._uniformBuffersNames[L.uniformBuffersNames[Q]]=Q}else this._engine=q,this.defines=null==n?"":n,this._uniformsNames=s.concat(y),this._samplerList=y?y.slice():[],this._attributesNames=l,this.onError=u,this.onCompiled=p,this._indexParameters=A,this._fallbacks=k;this._attributeLocationByName={},this.uniqueId=E._uniqueIdSeed++;var M=I.a.IsWindowObjectExist()?this._engine.getHostDocument():null;x.vertexSource?B="source:"+x.vertexSource:x.vertexElement?(B=M?M.getElementById(x.vertexElement):null)||(B=x.vertexElement):B=x.vertex||x,x.fragmentSource?v="source:"+x.fragmentSource:x.fragmentElement?(v=M?M.getElementById(x.fragmentElement):null)||(v=x.fragmentElement):v=x.fragment||x;var Y={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:E.ShadersRepository,includesShadersStore:E.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadShader(B,"Vertex","",function(X){H._loadShader(v,"Fragment","Pixel",function(U){G.a.Process(X,Y,function(P){Y.isFragment=!0,G.a.Process(U,Y,function(ga){H._useFinalCode(P,ga,x)})})})})}return Object.defineProperty(E.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new R.c()),this._onBindObservable},enumerable:!0,configurable:!0}),E.prototype._useFinalCode=function(x,l,s){if(s){var y=s.vertexElement||s.vertex||s.spectorName||s,q=s.fragmentElement||s.fragment||s.spectorName||s;this._vertexSourceCode="#define SHADER_NAME vertex:"+y+`
`+x,this._fragmentSourceCode="#define SHADER_NAME fragment:"+q+`
`+l}else this._vertexSourceCode=x,this._fragmentSourceCode=l;this._prepareEffect()},Object.defineProperty(E.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),E.prototype.isReady=function(){try{return this._isReadyInternal()}catch(x){return!1}},E.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},E.prototype.getEngine=function(){return this._engine},E.prototype.getPipelineContext=function(){return this._pipelineContext},E.prototype.getAttributesNames=function(){return this._attributesNames},E.prototype.getAttributeLocation=function(x){return this._attributes[x]},E.prototype.getAttributeLocationByName=function(x){return this._attributeLocationByName[x]},E.prototype.getAttributesCount=function(){return this._attributes.length},E.prototype.getUniformIndex=function(x){return this._uniformsNames.indexOf(x)},E.prototype.getUniform=function(x){return this._uniforms[x]},E.prototype.getSamplers=function(){return this._samplerList},E.prototype.getCompilationError=function(){return this._compilationError},E.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},E.prototype.executeWhenCompiled=function(x){var l=this;this.isReady()?x(this):(this.onCompileObservable.add(function(s){x(s)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){l._checkIsReady(null)},16))},E.prototype._checkIsReady=function(x){var l=this;try{if(this._isReadyInternal())return}catch(s){return void this._processCompilationErrors(s,x)}setTimeout(function(){l._checkIsReady(x)},16)},E.prototype._loadShader=function(x,l,s,y){var q;if("undefined"!=typeof HTMLElement&&x instanceof HTMLElement)return void y(I.a.GetDOMTextContent(x));"source:"!==x.substr(0,7)?"base64:"!==x.substr(0,7)?E.ShadersStore[x+l+"Shader"]?y(E.ShadersStore[x+l+"Shader"]):s&&E.ShadersStore[x+s+"Shader"]?y(E.ShadersStore[x+s+"Shader"]):(q="."===x[0]||"/"===x[0]||x.indexOf("http")>-1?x:E.ShadersRepository+x,this._engine._loadFile(q+"."+l.toLowerCase()+".fx",y)):y(window.atob(x.substr(7))):y(x.substr(7))},E.prototype._rebuildProgram=function(x,l,s,y){var q=this;this._isReady=!1,this._vertexSourceCodeOverride=x,this._fragmentSourceCodeOverride=l,this.onError=function(n,k){y&&y(k)},this.onCompiled=function(){var n=q.getEngine().scenes;if(n)for(var k=0;k<n.length;k++)n[k].markAllMaterialsAsDirty(r.a.MATERIAL_AllDirtyFlag);q._pipelineContext._handlesSpectorRebuildCallback(s)},this._fallbacks=null,this._prepareEffect()},E.prototype._prepareEffect=function(){var x=this,l=this._attributesNames,s=this.defines;this._valueCache={};var y=this._pipelineContext;try{var q=this._engine;this._pipelineContext=q.createPipelineContext();var n=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?q._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,n,null,this._transformFeedbackVaryings):q._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,n,s,this._transformFeedbackVaryings),q._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(q.supportsUniformBuffers)for(var k in x._uniformBuffersNames)x.bindUniformBlock(k,x._uniformBuffersNames[k]);var p;if(q.getUniforms(x._pipelineContext,x._uniformsNames).forEach(function(B,v){x._uniforms[x._uniformsNames[v]]=B}),x._attributes=q.getAttributes(x._pipelineContext,l),l)for(var u=0;u<l.length;u++){var A=l[u];x._attributeLocationByName[A]=x._attributes[u]}for(p=0;p<x._samplerList.length;p++)null==x.getUniform(x._samplerList[p])&&(x._samplerList.splice(p,1),p--);x._samplerList.forEach(function(B,v){x._samplers[B]=v}),q.bindSamplers(x),x._compilationError="",x._isReady=!0,x.onCompiled&&x.onCompiled(x),x.onCompileObservable.notifyObservers(x),x.onCompileObservable.clear(),x._fallbacks&&x._fallbacks.unBindMesh(),y&&x.getEngine()._deletePipelineContext(y)}),this._pipelineContext.isAsync&&this._checkIsReady(y)}catch(k){this._processCompilationErrors(k,y)}},E.prototype._processCompilationErrors=function(x,l){void 0===l&&(l=null),this._compilationError=x.message;var s=this._attributesNames,y=this._fallbacks;i.a.Error("Unable to compile effect:"),i.a.Error("Uniforms: "+this._uniformsNames.map(function(q){return" "+q})),i.a.Error("Attributes: "+s.map(function(q){return" "+q})),i.a.Error(`Defines:\r
`+this.defines),i.a.Error("Error: "+this._compilationError),l&&(this._pipelineContext=l,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),y?(this._pipelineContext=null,y.hasMoreFallbacks?(this._allFallbacksProcessed=!1,i.a.Error("Trying next fallback."),this.defines=y.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(E.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),E.prototype._bindTexture=function(x,l){this._engine._bindTexture(this._samplers[x],l)},E.prototype.setTexture=function(x,l){this._engine.setTexture(this._samplers[x],this._uniforms[x],l)},E.prototype.setDepthStencilTexture=function(x,l){this._engine.setDepthStencilTexture(this._samplers[x],this._uniforms[x],l)},E.prototype.setTextureArray=function(x,l){var s=x+"Ex";if(-1===this._samplerList.indexOf(s+"0")){for(var y=this._samplerList.indexOf(x),q=1;q<l.length;q++){var n=s+(q-1).toString();this._samplerList.splice(y+q,0,n)}for(var k=0,p=0,u=this._samplerList;p<u.length;p++){var A=u[p];this._samplers[A]=k,k+=1}}this._engine.setTextureArray(this._samplers[x],this._uniforms[x],l)},E.prototype.setTextureFromPostProcess=function(x,l){this._engine.setTextureFromPostProcess(this._samplers[x],l)},E.prototype.setTextureFromPostProcessOutput=function(x,l){this._engine.setTextureFromPostProcessOutput(this._samplers[x],l)},E.prototype._cacheMatrix=function(x,l){var s=this._valueCache[x],y=l.updateFlag;return(void 0===s||s!==y)&&(this._valueCache[x]=y,!0)},E.prototype._cacheFloat2=function(x,l,s){var y=this._valueCache[x];if(!y||2!==y.length)return y=[l,s],this._valueCache[x]=y,!0;var q=!1;return y[0]!==l&&(y[0]=l,q=!0),y[1]!==s&&(y[1]=s,q=!0),q},E.prototype._cacheFloat3=function(x,l,s,y){var q=this._valueCache[x];if(!q||3!==q.length)return q=[l,s,y],this._valueCache[x]=q,!0;var n=!1;return q[0]!==l&&(q[0]=l,n=!0),q[1]!==s&&(q[1]=s,n=!0),q[2]!==y&&(q[2]=y,n=!0),n},E.prototype._cacheFloat4=function(x,l,s,y,q){var n=this._valueCache[x];if(!n||4!==n.length)return n=[l,s,y,q],this._valueCache[x]=n,!0;var k=!1;return n[0]!==l&&(n[0]=l,k=!0),n[1]!==s&&(n[1]=s,k=!0),n[2]!==y&&(n[2]=y,k=!0),n[3]!==q&&(n[3]=q,k=!0),k},E.prototype.bindUniformBuffer=function(x,l){var s=this._uniformBuffersNames[l];void 0!==s&&E._baseCache[s]!==x&&(E._baseCache[s]=x,this._engine.bindUniformBufferBase(x,s))},E.prototype.bindUniformBlock=function(x,l){this._engine.bindUniformBlock(this._pipelineContext,x,l)},E.prototype.setInt=function(x,l){var s=this._valueCache[x];return void 0!==s&&s===l?this:(this._valueCache[x]=l,this._engine.setInt(this._uniforms[x],l),this)},E.prototype.setIntArray=function(x,l){return this._valueCache[x]=null,this._engine.setIntArray(this._uniforms[x],l),this},E.prototype.setIntArray2=function(x,l){return this._valueCache[x]=null,this._engine.setIntArray2(this._uniforms[x],l),this},E.prototype.setIntArray3=function(x,l){return this._valueCache[x]=null,this._engine.setIntArray3(this._uniforms[x],l),this},E.prototype.setIntArray4=function(x,l){return this._valueCache[x]=null,this._engine.setIntArray4(this._uniforms[x],l),this},E.prototype.setFloatArray=function(x,l){return this._valueCache[x]=null,this._engine.setArray(this._uniforms[x],l),this},E.prototype.setFloatArray2=function(x,l){return this._valueCache[x]=null,this._engine.setArray2(this._uniforms[x],l),this},E.prototype.setFloatArray3=function(x,l){return this._valueCache[x]=null,this._engine.setArray3(this._uniforms[x],l),this},E.prototype.setFloatArray4=function(x,l){return this._valueCache[x]=null,this._engine.setArray4(this._uniforms[x],l),this},E.prototype.setArray=function(x,l){return this._valueCache[x]=null,this._engine.setArray(this._uniforms[x],l),this},E.prototype.setArray2=function(x,l){return this._valueCache[x]=null,this._engine.setArray2(this._uniforms[x],l),this},E.prototype.setArray3=function(x,l){return this._valueCache[x]=null,this._engine.setArray3(this._uniforms[x],l),this},E.prototype.setArray4=function(x,l){return this._valueCache[x]=null,this._engine.setArray4(this._uniforms[x],l),this},E.prototype.setMatrices=function(x,l){return l?(this._valueCache[x]=null,this._engine.setMatrices(this._uniforms[x],l),this):this},E.prototype.setMatrix=function(x,l){return this._cacheMatrix(x,l)&&this._engine.setMatrices(this._uniforms[x],l.toArray()),this},E.prototype.setMatrix3x3=function(x,l){return this._valueCache[x]=null,this._engine.setMatrix3x3(this._uniforms[x],l),this},E.prototype.setMatrix2x2=function(x,l){return this._valueCache[x]=null,this._engine.setMatrix2x2(this._uniforms[x],l),this},E.prototype.setFloat=function(x,l){var s=this._valueCache[x];return void 0!==s&&s===l?this:(this._valueCache[x]=l,this._engine.setFloat(this._uniforms[x],l),this)},E.prototype.setBool=function(x,l){var s=this._valueCache[x];return void 0!==s&&s===l?this:(this._valueCache[x]=l,this._engine.setInt(this._uniforms[x],l?1:0),this)},E.prototype.setVector2=function(x,l){return this._cacheFloat2(x,l.x,l.y)&&this._engine.setFloat2(this._uniforms[x],l.x,l.y),this},E.prototype.setFloat2=function(x,l,s){return this._cacheFloat2(x,l,s)&&this._engine.setFloat2(this._uniforms[x],l,s),this},E.prototype.setVector3=function(x,l){return this._cacheFloat3(x,l.x,l.y,l.z)&&this._engine.setFloat3(this._uniforms[x],l.x,l.y,l.z),this},E.prototype.setFloat3=function(x,l,s,y){return this._cacheFloat3(x,l,s,y)&&this._engine.setFloat3(this._uniforms[x],l,s,y),this},E.prototype.setVector4=function(x,l){return this._cacheFloat4(x,l.x,l.y,l.z,l.w)&&this._engine.setFloat4(this._uniforms[x],l.x,l.y,l.z,l.w),this},E.prototype.setFloat4=function(x,l,s,y,q){return this._cacheFloat4(x,l,s,y,q)&&this._engine.setFloat4(this._uniforms[x],l,s,y,q),this},E.prototype.setColor3=function(x,l){return this._cacheFloat3(x,l.r,l.g,l.b)&&this._engine.setFloat3(this._uniforms[x],l.r,l.g,l.b),this},E.prototype.setColor4=function(x,l,s){return this._cacheFloat4(x,l.r,l.g,l.b,s)&&this._engine.setFloat4(this._uniforms[x],l.r,l.g,l.b,s),this},E.prototype.setDirectColor4=function(x,l){return this._cacheFloat4(x,l.r,l.g,l.b,l.a)&&this._engine.setFloat4(this._uniforms[x],l.r,l.g,l.b,l.a),this},E.prototype.dispose=function(){this._engine._releaseEffect(this)},E.RegisterShader=function(x,l,s){l&&(E.ShadersStore[x+"PixelShader"]=l),s&&(E.ShadersStore[x+"VertexShader"]=s)},E.ResetCache=function(){E._baseCache={}},E.ShadersRepository="src/Shaders/",E._uniqueIdSeed=0,E._baseCache={},E.ShadersStore={},E.IncludesShadersStore={},E}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return n});var R=o(1),r=o(3),I=o(6),i=o(0),G=o(49),D=o(2),E=o(12),x=o(19),l=o(115),s=o(112),y=o(60),q=o(36),n=function(k){function p(u,A,B,v,H,L,Q,M,Y,X,U){void 0===B&&(B=!1),void 0===v&&(v=!0),void 0===H&&(H=p.TRILINEAR_SAMPLINGMODE),void 0===L&&(L=null),void 0===Q&&(Q=null),void 0===M&&(M=null),void 0===Y&&(Y=!1);var P=k.call(this,A&&"Scene"===A.getClassName()?A:null)||this;P.url=null,P.uOffset=0,P.vOffset=0,P.uScale=1,P.vScale=1,P.uAng=0,P.vAng=0,P.wAng=0,P.uRotationCenter=.5,P.vRotationCenter=.5,P.wRotationCenter=.5,P.inspectableCustomProperties=null,P._noMipmap=!1,P._invertY=!1,P._rowGenerationMatrix=null,P._cachedTextureMatrix=null,P._projectionModeMatrix=null,P._t0=null,P._t1=null,P._t2=null,P._cachedUOffset=-1,P._cachedVOffset=-1,P._cachedUScale=0,P._cachedVScale=0,P._cachedUAng=-1,P._cachedVAng=-1,P._cachedWAng=-1,P._cachedProjectionMatrixId=-1,P._cachedCoordinatesMode=-1,P._initialSamplingMode=p.BILINEAR_SAMPLINGMODE,P._buffer=null,P._deleteBuffer=!1,P._format=null,P._delayedOnLoad=null,P._delayedOnError=null,P.onLoadObservable=new I.c(),P._isBlocking=!0,P.name=u||"",P.url=u,P._noMipmap=B,P._invertY=v,P._initialSamplingMode=H,P._buffer=M,P._deleteBuffer=Y,P._mimeType=U,X&&(P._format=X);var ga=P.getScene(),ma=A&&A.getCaps?A:ga?ga.getEngine():null;if(!ma)return P;ma.onBeforeTextureInitObservable.notifyObservers(P);var oa=function(){P._texture&&(P._texture._invertVScale&&(P.vScale*=-1,P.vOffset+=1),null!==P._texture._cachedWrapU&&(P.wrapU=P._texture._cachedWrapU,P._texture._cachedWrapU=null),null!==P._texture._cachedWrapV&&(P.wrapV=P._texture._cachedWrapV,P._texture._cachedWrapV=null),null!==P._texture._cachedWrapR&&(P.wrapR=P._texture._cachedWrapR,P._texture._cachedWrapR=null)),P.onLoadObservable.hasObservers()&&P.onLoadObservable.notifyObservers(P),L&&L(),!P.isBlocking&&ga&&ga.resetCachedMaterial()};return P.url?(P._texture=P._getFromCache(P.url,B,H,v),P._texture?P._texture.isReady?l.a.SetImmediate(function(){return oa()}):P._texture.onLoadedObservable.add(oa):ga&&ga.useDelayedTextureLoading?(P.delayLoadState=D.a.DELAYLOADSTATE_NOTLOADED,P._delayedOnLoad=oa,P._delayedOnError=Q):(P._texture=ma.createTexture(P.url,B,v,ga,H,oa,Q,P._buffer,void 0,P._format,null,U),Y&&delete P._buffer),P):(P._delayedOnLoad=oa,P._delayedOnError=Q,P)}return Object(R.d)(p,k),Object.defineProperty(p.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(u){this._isBlocking=u},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"invertY",{get:function(){return this._invertY},enumerable:!0,configurable:!0}),p.prototype.updateURL=function(u,A,B){void 0===A&&(A=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(D.a.MATERIAL_TextureDirtyFlag)),this.name&&!q.a.StartsWith(this.name,"data:")||(this.name=u),this.url=u,this._buffer=A,this.delayLoadState=D.a.DELAYLOADSTATE_NOTLOADED,B&&(this._delayedOnLoad=B),this.delayLoad()},p.prototype.delayLoad=function(){if(this.delayLoadState===D.a.DELAYLOADSTATE_NOTLOADED){var u=this.getScene();u&&(this.delayLoadState=D.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?l.a.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=u.getEngine().createTexture(this.url,this._noMipmap,this._invertY,u,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},p.prototype._prepareRowForTextureGeneration=function(u,A,B,v){u*=this._cachedUScale,A*=this._cachedVScale,u-=this.uRotationCenter*this._cachedUScale,A-=this.vRotationCenter*this._cachedVScale,B-=this.wRotationCenter,i.e.TransformCoordinatesFromFloatsToRef(u,A,B,this._rowGenerationMatrix,v),v.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,v.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,v.z+=this.wRotationCenter},p.prototype.getTextureMatrix=function(u){var A=this;if(void 0===u&&(u=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*u===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*u,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=i.a.Zero(),this._rowGenerationMatrix=new i.a(),this._t0=i.e.Zero(),this._t1=i.e.Zero(),this._t2=i.e.Zero()),i.a.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),i.a.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);var B=this.getScene();return B?(B.markAllMaterialsAsDirty(D.a.MATERIAL_TextureDirtyFlag,function(v){return v.hasTexture(A)}),this._cachedTextureMatrix):this._cachedTextureMatrix},p.prototype.getReflectionTextureMatrix=function(){var u=this,A=this.getScene();if(!A)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==p.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===A.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=i.a.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=i.a.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case p.PLANAR_MODE:i.a.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case p.PROJECTION_MODE:i.a.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var B=A.getProjectionMatrix();this._cachedProjectionMatrixId=B.updateFlag,B.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:i.a.IdentityToRef(this._cachedTextureMatrix)}return A.markAllMaterialsAsDirty(D.a.MATERIAL_TextureDirtyFlag,function(v){return-1!==v.getActiveTextures().indexOf(u)}),this._cachedTextureMatrix},p.prototype.clone=function(){var u=this;return r.a.Clone(function(){return new p(u._texture?u._texture.url:null,u.getScene(),u._noMipmap,u._invertY,u.samplingMode,void 0,void 0,u._texture?u._texture._buffer:void 0)},this)},p.prototype.serialize=function(){var u=this.name;p.SerializeBuffers||q.a.StartsWith(this.name,"data:")&&(this.name="");var A=k.prototype.serialize.call(this);return A?(p.SerializeBuffers&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(A.base64String=this._buffer,A.name=A.name.replace("data:","")):this.url&&q.a.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array&&(A.base64String="data:image/png;base64,"+q.a.EncodeArrayBufferToBase64(this._buffer))),A.invertY=this._invertY,A.samplingMode=this.samplingMode,this.name=u,A):null},p.prototype.getClassName=function(){return"Texture"},p.prototype.dispose=function(){k.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},p.Parse=function(u,A,B){if(u.customType){var v=s.a.Instantiate(u.customType).Parse(u,A,B);return u.samplingMode&&v.updateSamplingMode&&v._samplingMode&&v._samplingMode!==u.samplingMode&&v.updateSamplingMode(u.samplingMode),v}if(u.isCube&&!u.isRenderTarget)return p._CubeTextureParser(u,A,B);if(!u.name&&!u.isRenderTarget)return null;var H=r.a.Parse(function(){var X,U=!0;if(u.noMipmap&&(U=!1),u.mirrorPlane){var P=p._CreateMirror(u.name,u.renderTargetSize,A,U);return P._waitingRenderList=u.renderList,P.mirrorPlane=y.a.FromArray(u.mirrorPlane),P}if(u.isRenderTarget){var ga=null;if(u.isCube){if(A.reflectionProbes)for(var ma=0;ma<A.reflectionProbes.length;ma++){var oa=A.reflectionProbes[ma];if(oa.name===u.name)return oa.cubeTexture}}else(ga=p._CreateRenderTargetTexture(u.name,u.renderTargetSize,A,U))._waitingRenderList=u.renderList;return ga}if(u.base64String)X=p.CreateFromBase64String(u.base64String,u.name,A,!U,u.invertY);else{var ja=B+u.name;p.UseSerializedUrlIfAny&&u.url&&(ja=u.url),X=new p(ja,A,!U,u.invertY)}return X},u,A);if(H&&H._texture&&(H._texture._cachedWrapU=null,H._texture._cachedWrapV=null,H._texture._cachedWrapR=null),u.samplingMode){var L=u.samplingMode;H&&H.samplingMode!==L&&H.updateSamplingMode(L)}if(H&&u.animations)for(var Q=0;Q<u.animations.length;Q++){var M=u.animations[Q],Y=E.a.GetClass("BABYLON.Animation");Y&&H.animations.push(Y.Parse(M))}return H},p.CreateFromBase64String=function(u,A,B,v,H,L,Q,M,Y){return void 0===L&&(L=p.TRILINEAR_SAMPLINGMODE),void 0===Q&&(Q=null),void 0===M&&(M=null),void 0===Y&&(Y=D.a.TEXTUREFORMAT_RGBA),new p("data:"+A,B,v,H,L,Q,M,u,!1,Y)},p.LoadFromDataString=function(u,A,B,v,H,L,Q,M,Y,X){return void 0===v&&(v=!1),void 0===H&&(H=!1),void 0===L&&(L=!0),void 0===Q&&(Q=p.TRILINEAR_SAMPLINGMODE),void 0===M&&(M=null),void 0===Y&&(Y=null),void 0===X&&(X=D.a.TEXTUREFORMAT_RGBA),"data:"!==u.substr(0,5)&&(u="data:"+u),new p(u,B,H,L,Q,M,Y,A,v,X)},p.SerializeBuffers=!0,p._CubeTextureParser=function(u,A,B){throw x.a.WarnImport("CubeTexture")},p._CreateMirror=function(u,A,B,v){throw x.a.WarnImport("MirrorTexture")},p._CreateRenderTargetTexture=function(u,A,B,v){throw x.a.WarnImport("RenderTargetTexture")},p.NEAREST_SAMPLINGMODE=D.a.TEXTURE_NEAREST_SAMPLINGMODE,p.NEAREST_NEAREST_MIPLINEAR=D.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,p.BILINEAR_SAMPLINGMODE=D.a.TEXTURE_BILINEAR_SAMPLINGMODE,p.LINEAR_LINEAR_MIPNEAREST=D.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,p.TRILINEAR_SAMPLINGMODE=D.a.TEXTURE_TRILINEAR_SAMPLINGMODE,p.LINEAR_LINEAR_MIPLINEAR=D.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,p.NEAREST_NEAREST_MIPNEAREST=D.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,p.NEAREST_LINEAR_MIPNEAREST=D.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,p.NEAREST_LINEAR_MIPLINEAR=D.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,p.NEAREST_LINEAR=D.a.TEXTURE_NEAREST_LINEAR,p.NEAREST_NEAREST=D.a.TEXTURE_NEAREST_NEAREST,p.LINEAR_NEAREST_MIPNEAREST=D.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,p.LINEAR_NEAREST_MIPLINEAR=D.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,p.LINEAR_LINEAR=D.a.TEXTURE_LINEAR_LINEAR,p.LINEAR_NEAREST=D.a.TEXTURE_LINEAR_NEAREST,p.EXPLICIT_MODE=D.a.TEXTURE_EXPLICIT_MODE,p.SPHERICAL_MODE=D.a.TEXTURE_SPHERICAL_MODE,p.PLANAR_MODE=D.a.TEXTURE_PLANAR_MODE,p.CUBIC_MODE=D.a.TEXTURE_CUBIC_MODE,p.PROJECTION_MODE=D.a.TEXTURE_PROJECTION_MODE,p.SKYBOX_MODE=D.a.TEXTURE_SKYBOX_MODE,p.INVCUBIC_MODE=D.a.TEXTURE_INVCUBIC_MODE,p.EQUIRECTANGULAR_MODE=D.a.TEXTURE_EQUIRECTANGULAR_MODE,p.FIXED_EQUIRECTANGULAR_MODE=D.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,p.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=D.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,p.CLAMP_ADDRESSMODE=D.a.TEXTURE_CLAMP_ADDRESSMODE,p.WRAP_ADDRESSMODE=D.a.TEXTURE_WRAP_ADDRESSMODE,p.MIRROR_ADDRESSMODE=D.a.TEXTURE_MIRROR_ADDRESSMODE,p.UseSerializedUrlIfAny=!1,Object(R.c)([Object(r.c)()],p.prototype,"url",void 0),Object(R.c)([Object(r.c)()],p.prototype,"uOffset",void 0),Object(R.c)([Object(r.c)()],p.prototype,"vOffset",void 0),Object(R.c)([Object(r.c)()],p.prototype,"uScale",void 0),Object(R.c)([Object(r.c)()],p.prototype,"vScale",void 0),Object(R.c)([Object(r.c)()],p.prototype,"uAng",void 0),Object(R.c)([Object(r.c)()],p.prototype,"vAng",void 0),Object(R.c)([Object(r.c)()],p.prototype,"wAng",void 0),Object(R.c)([Object(r.c)()],p.prototype,"uRotationCenter",void 0),Object(R.c)([Object(r.c)()],p.prototype,"vRotationCenter",void 0),Object(R.c)([Object(r.c)()],p.prototype,"wRotationCenter",void 0),Object(R.c)([Object(r.c)()],p.prototype,"isBlocking",null),p}(G.a);r.a._TextureParser=n.Parse},function(Ja,t,o){"use strict";o.d(t,"a",function(){return G}),o.d(t,"b",function(){return D}),o.d(t,"c",function(){return E});var R=o(14),r=o(28),I=o(42),i=o(12),G=function(){function x(l,s,y){void 0===l&&(l=0),void 0===s&&(s=0),void 0===y&&(y=0),this.r=l,this.g=s,this.b=y}return x.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},x.prototype.getClassName=function(){return"Color3"},x.prototype.getHashCode=function(){var l=255*this.r|0;return l=397*(l=397*l^(255*this.g|0))^(255*this.b|0)},x.prototype.toArray=function(l,s){return void 0===s&&(s=0),l[s]=this.r,l[s+1]=this.g,l[s+2]=this.b,this},x.prototype.toColor4=function(l){return void 0===l&&(l=1),new D(this.r,this.g,this.b,l)},x.prototype.asArray=function(){var l=new Array();return this.toArray(l,0),l},x.prototype.toLuminance=function(){return .3*this.r+.59*this.g+.11*this.b},x.prototype.multiply=function(l){return new x(this.r*l.r,this.g*l.g,this.b*l.b)},x.prototype.multiplyToRef=function(l,s){return s.r=this.r*l.r,s.g=this.g*l.g,s.b=this.b*l.b,this},x.prototype.equals=function(l){return l&&this.r===l.r&&this.g===l.g&&this.b===l.b},x.prototype.equalsFloats=function(l,s,y){return this.r===l&&this.g===s&&this.b===y},x.prototype.scale=function(l){return new x(this.r*l,this.g*l,this.b*l)},x.prototype.scaleToRef=function(l,s){return s.r=this.r*l,s.g=this.g*l,s.b=this.b*l,this},x.prototype.scaleAndAddToRef=function(l,s){return s.r+=this.r*l,s.g+=this.g*l,s.b+=this.b*l,this},x.prototype.clampToRef=function(l,s,y){return void 0===l&&(l=0),void 0===s&&(s=1),y.r=R.a.Clamp(this.r,l,s),y.g=R.a.Clamp(this.g,l,s),y.b=R.a.Clamp(this.b,l,s),this},x.prototype.add=function(l){return new x(this.r+l.r,this.g+l.g,this.b+l.b)},x.prototype.addToRef=function(l,s){return s.r=this.r+l.r,s.g=this.g+l.g,s.b=this.b+l.b,this},x.prototype.subtract=function(l){return new x(this.r-l.r,this.g-l.g,this.b-l.b)},x.prototype.subtractToRef=function(l,s){return s.r=this.r-l.r,s.g=this.g-l.g,s.b=this.b-l.b,this},x.prototype.clone=function(){return new x(this.r,this.g,this.b)},x.prototype.copyFrom=function(l){return this.r=l.r,this.g=l.g,this.b=l.b,this},x.prototype.copyFromFloats=function(l,s,y){return this.r=l,this.g=s,this.b=y,this},x.prototype.set=function(l,s,y){return this.copyFromFloats(l,s,y)},x.prototype.toHexString=function(){var l=255*this.r|0,s=255*this.g|0,y=255*this.b|0;return"#"+R.a.ToHex(l)+R.a.ToHex(s)+R.a.ToHex(y)},x.prototype.toLinearSpace=function(){var l=new x();return this.toLinearSpaceToRef(l),l},x.prototype.toHSV=function(){var l=new x();return this.toHSVToRef(l),l},x.prototype.toHSVToRef=function(l){var s=this.r,y=this.g,q=this.b,n=Math.max(s,y,q),k=Math.min(s,y,q),p=0,u=0,A=n,B=n-k;0!==n&&(u=B/n),n!=k&&(n==s?(p=(y-q)/B,y<q&&(p+=6)):n==y?p=(q-s)/B+2:n==q&&(p=(s-y)/B+4),p*=60),l.r=p,l.g=u,l.b=A},x.prototype.toLinearSpaceToRef=function(l){return l.r=Math.pow(this.r,r.c),l.g=Math.pow(this.g,r.c),l.b=Math.pow(this.b,r.c),this},x.prototype.toGammaSpace=function(){var l=new x();return this.toGammaSpaceToRef(l),l},x.prototype.toGammaSpaceToRef=function(l){return l.r=Math.pow(this.r,r.b),l.g=Math.pow(this.g,r.b),l.b=Math.pow(this.b,r.b),this},x.HSVtoRGBToRef=function(l,s,y,q){var n=y*s,k=l/60,p=n*(1-Math.abs(k%2-1)),u=0,A=0,B=0;k>=0&&k<=1?(u=n,A=p):k>=1&&k<=2?(u=p,A=n):k>=2&&k<=3?(A=n,B=p):k>=3&&k<=4?(A=p,B=n):k>=4&&k<=5?(u=p,B=n):k>=5&&k<=6&&(u=n,B=p);var v=y-n;q.set(u+v,A+v,B+v)},x.FromHexString=function(l){if("#"!==l.substring(0,1)||7!==l.length)return new x(0,0,0);var s=parseInt(l.substring(1,3),16),y=parseInt(l.substring(3,5),16),q=parseInt(l.substring(5,7),16);return x.FromInts(s,y,q)},x.FromArray=function(l,s){return void 0===s&&(s=0),new x(l[s],l[s+1],l[s+2])},x.FromInts=function(l,s,y){return new x(l/255,s/255,y/255)},x.Lerp=function(l,s,y){var q=new x(0,0,0);return x.LerpToRef(l,s,y,q),q},x.LerpToRef=function(l,s,y,q){q.r=l.r+(s.r-l.r)*y,q.g=l.g+(s.g-l.g)*y,q.b=l.b+(s.b-l.b)*y},x.Red=function(){return new x(1,0,0)},x.Green=function(){return new x(0,1,0)},x.Blue=function(){return new x(0,0,1)},x.Black=function(){return new x(0,0,0)},Object.defineProperty(x,"BlackReadOnly",{get:function(){return x._BlackReadOnly},enumerable:!0,configurable:!0}),x.White=function(){return new x(1,1,1)},x.Purple=function(){return new x(.5,0,.5)},x.Magenta=function(){return new x(1,0,1)},x.Yellow=function(){return new x(1,1,0)},x.Gray=function(){return new x(.5,.5,.5)},x.Teal=function(){return new x(0,1,1)},x.Random=function(){return new x(Math.random(),Math.random(),Math.random())},x._BlackReadOnly=x.Black(),x}(),D=function(){function x(l,s,y,q){void 0===l&&(l=0),void 0===s&&(s=0),void 0===y&&(y=0),void 0===q&&(q=1),this.r=l,this.g=s,this.b=y,this.a=q}return x.prototype.addInPlace=function(l){return this.r+=l.r,this.g+=l.g,this.b+=l.b,this.a+=l.a,this},x.prototype.asArray=function(){var l=new Array();return this.toArray(l,0),l},x.prototype.toArray=function(l,s){return void 0===s&&(s=0),l[s]=this.r,l[s+1]=this.g,l[s+2]=this.b,l[s+3]=this.a,this},x.prototype.equals=function(l){return l&&this.r===l.r&&this.g===l.g&&this.b===l.b&&this.a===l.a},x.prototype.add=function(l){return new x(this.r+l.r,this.g+l.g,this.b+l.b,this.a+l.a)},x.prototype.subtract=function(l){return new x(this.r-l.r,this.g-l.g,this.b-l.b,this.a-l.a)},x.prototype.subtractToRef=function(l,s){return s.r=this.r-l.r,s.g=this.g-l.g,s.b=this.b-l.b,s.a=this.a-l.a,this},x.prototype.scale=function(l){return new x(this.r*l,this.g*l,this.b*l,this.a*l)},x.prototype.scaleToRef=function(l,s){return s.r=this.r*l,s.g=this.g*l,s.b=this.b*l,s.a=this.a*l,this},x.prototype.scaleAndAddToRef=function(l,s){return s.r+=this.r*l,s.g+=this.g*l,s.b+=this.b*l,s.a+=this.a*l,this},x.prototype.clampToRef=function(l,s,y){return void 0===l&&(l=0),void 0===s&&(s=1),y.r=R.a.Clamp(this.r,l,s),y.g=R.a.Clamp(this.g,l,s),y.b=R.a.Clamp(this.b,l,s),y.a=R.a.Clamp(this.a,l,s),this},x.prototype.multiply=function(l){return new x(this.r*l.r,this.g*l.g,this.b*l.b,this.a*l.a)},x.prototype.multiplyToRef=function(l,s){return s.r=this.r*l.r,s.g=this.g*l.g,s.b=this.b*l.b,s.a=this.a*l.a,s},x.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},x.prototype.getClassName=function(){return"Color4"},x.prototype.getHashCode=function(){var l=255*this.r|0;return l=397*(l=397*(l=397*l^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},x.prototype.clone=function(){return new x(this.r,this.g,this.b,this.a)},x.prototype.copyFrom=function(l){return this.r=l.r,this.g=l.g,this.b=l.b,this.a=l.a,this},x.prototype.copyFromFloats=function(l,s,y,q){return this.r=l,this.g=s,this.b=y,this.a=q,this},x.prototype.set=function(l,s,y,q){return this.copyFromFloats(l,s,y,q)},x.prototype.toHexString=function(){var l=255*this.r|0,s=255*this.g|0,y=255*this.b|0,q=255*this.a|0;return"#"+R.a.ToHex(l)+R.a.ToHex(s)+R.a.ToHex(y)+R.a.ToHex(q)},x.prototype.toLinearSpace=function(){var l=new x();return this.toLinearSpaceToRef(l),l},x.prototype.toLinearSpaceToRef=function(l){return l.r=Math.pow(this.r,r.c),l.g=Math.pow(this.g,r.c),l.b=Math.pow(this.b,r.c),l.a=this.a,this},x.prototype.toGammaSpace=function(){var l=new x();return this.toGammaSpaceToRef(l),l},x.prototype.toGammaSpaceToRef=function(l){return l.r=Math.pow(this.r,r.b),l.g=Math.pow(this.g,r.b),l.b=Math.pow(this.b,r.b),l.a=this.a,this},x.FromHexString=function(l){if("#"!==l.substring(0,1)||9!==l.length)return new x(0,0,0,0);var s=parseInt(l.substring(1,3),16),y=parseInt(l.substring(3,5),16),q=parseInt(l.substring(5,7),16),n=parseInt(l.substring(7,9),16);return x.FromInts(s,y,q,n)},x.Lerp=function(l,s,y){var q=new x(0,0,0,0);return x.LerpToRef(l,s,y,q),q},x.LerpToRef=function(l,s,y,q){q.r=l.r+(s.r-l.r)*y,q.g=l.g+(s.g-l.g)*y,q.b=l.b+(s.b-l.b)*y,q.a=l.a+(s.a-l.a)*y},x.FromColor3=function(l,s){return void 0===s&&(s=1),new x(l.r,l.g,l.b,s)},x.FromArray=function(l,s){return void 0===s&&(s=0),new x(l[s],l[s+1],l[s+2],l[s+3])},x.FromInts=function(l,s,y,q){return new x(l/255,s/255,y/255,q/255)},x.CheckColors4=function(l,s){if(l.length===3*s){for(var y=[],q=0;q<l.length;q+=3){var n=q/3*4;y[n]=l[q],y[n+1]=l[q+1],y[n+2]=l[q+2],y[n+3]=1}return y}return l},x}(),E=function(){function x(){}return x.Color3=I.a.BuildArray(3,G.Black),x.Color4=I.a.BuildArray(3,function(){return new D(0,0,0,0)}),x}();i.a.RegisteredTypes["BABYLON.Color3"]=G,i.a.RegisteredTypes["BABYLON.Color4"]=D},function(Ja,t,o){"use strict";var R=o(1),r=o(6),I=o(38),i=o(23),G=o(19),D=o(31),E=o(2),x=o(132),l=o(51),s=o(84),y=o(7);D.a.prototype.setAlphaConstants=function(n,k,p,u){this._alphaState.setAlphaBlendConstants(n,k,p,u)},D.a.prototype.setAlphaMode=function(n,k){if(void 0===k&&(k=!1),this._alphaMode!==n){switch(n){case E.a.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case E.a.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_ONEONE_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_ALPHATOCOLOR:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_REVERSEONEMINUS:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_SRC_DSTONEMINUSSRCALPHA:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_ONEONE_ONEZERO:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case E.a.ALPHA_EXCLUSION:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}k||(this.depthCullingState.depthMask=n===E.a.ALPHA_DISABLE),this._alphaMode=n}},D.a.prototype.getAlphaMode=function(){return this._alphaMode},D.a.prototype.setAlphaEquation=function(n){if(this._alphaEquation!==n){switch(n){case E.a.ALPHA_EQUATION_ADD:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case E.a.ALPHA_EQUATION_SUBSTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case E.a.ALPHA_EQUATION_REVERSE_SUBTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case E.a.ALPHA_EQUATION_MAX:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case E.a.ALPHA_EQUATION_MIN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case E.a.ALPHA_EQUATION_DARKEN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=n}},D.a.prototype.getAlphaEquation=function(){return this._alphaEquation},o.d(t,"a",function(){return q});var q=function(n){function k(p,u,A,B){void 0===B&&(B=!1);var v=n.call(this,p,u,A,B)||this;if(v.enableOfflineSupport=!1,v.disableManifestCheck=!1,v.scenes=new Array(),v.onNewSceneAddedObservable=new r.c(),v.postProcesses=new Array(),v.isPointerLock=!1,v.onResizeObservable=new r.c(),v.onCanvasBlurObservable=new r.c(),v.onCanvasFocusObservable=new r.c(),v.onCanvasPointerOutObservable=new r.c(),v.onBeginFrameObservable=new r.c(),v.customAnimationFrameRequester=null,v.onEndFrameObservable=new r.c(),v.onBeforeShaderCompilationObservable=new r.c(),v.onAfterShaderCompilationObservable=new r.c(),v._deterministicLockstep=!1,v._lockstepMaxSteps=4,v._timeStep=1/60,v._fps=60,v._deltaTime=0,v._drawCalls=new l.a(),v.canvasTabIndex=1,v.disablePerformanceMonitorInBackground=!1,v._performanceMonitor=new x.a(),!p)return v;if(A=v._creationOptions,k.Instances.push(v),p.getContext){var H=p;if(v._onCanvasFocus=function(){v.onCanvasFocusObservable.notifyObservers(v)},v._onCanvasBlur=function(){v.onCanvasBlurObservable.notifyObservers(v)},H.addEventListener("focus",v._onCanvasFocus),H.addEventListener("blur",v._onCanvasBlur),v._onBlur=function(){v.disablePerformanceMonitorInBackground&&v._performanceMonitor.disable(),v._windowIsBackground=!0},v._onFocus=function(){v.disablePerformanceMonitorInBackground&&v._performanceMonitor.enable(),v._windowIsBackground=!1},v._onCanvasPointerOut=function(M){v.onCanvasPointerOutObservable.notifyObservers(M)},H.addEventListener("pointerout",v._onCanvasPointerOut),I.a.IsWindowObjectExist()){var L=v.getHostWindow();L.addEventListener("blur",v._onBlur),L.addEventListener("focus",v._onFocus);var Q=document;v._onFullscreenChange=function(){void 0!==Q.fullscreen?v.isFullscreen=Q.fullscreen:void 0!==Q.mozFullScreen?v.isFullscreen=Q.mozFullScreen:void 0!==Q.webkitIsFullScreen?v.isFullscreen=Q.webkitIsFullScreen:void 0!==Q.msIsFullScreen&&(v.isFullscreen=Q.msIsFullScreen),v.isFullscreen&&v._pointerLockRequested&&H&&k._RequestPointerlock(H)},document.addEventListener("fullscreenchange",v._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",v._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",v._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",v._onFullscreenChange,!1),v._onPointerLockChange=function(){v.isPointerLock=Q.mozPointerLockElement===H||Q.webkitPointerLockElement===H||Q.msPointerLockElement===H||Q.pointerLockElement===H},document.addEventListener("pointerlockchange",v._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",v._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",v._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",v._onPointerLockChange,!1),!k.audioEngine&&A.audioEngine&&k.AudioEngineFactory&&(k.audioEngine=k.AudioEngineFactory(v.getRenderingCanvas()))}v._connectVREvents(),v.enableOfflineSupport=void 0!==k.OfflineProviderFactory,A.doNotHandleTouchAction||v._disableTouchAction(),v._deterministicLockstep=!!A.deterministicLockstep,v._lockstepMaxSteps=A.lockstepMaxSteps||0,v._timeStep=A.timeStep||1/60}return v._prepareVRComponent(),A.autoEnableWebVR&&v.initWebVR(),v}return Object(R.d)(k,n),Object.defineProperty(k,"NpmPackage",{get:function(){return D.a.NpmPackage},enumerable:!0,configurable:!0}),Object.defineProperty(k,"Version",{get:function(){return D.a.Version},enumerable:!0,configurable:!0}),Object.defineProperty(k,"Instances",{get:function(){return i.a.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(k,"LastCreatedEngine",{get:function(){return i.a.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(k,"LastCreatedScene",{get:function(){return i.a.LastCreatedScene},enumerable:!0,configurable:!0}),k.MarkAllMaterialsAsDirty=function(p,u){for(var A=0;A<k.Instances.length;A++)for(var B=k.Instances[A],v=0;v<B.scenes.length;v++)B.scenes[v].markAllMaterialsAsDirty(p,u)},k.DefaultLoadingScreenFactory=function(p){throw G.a.WarnImport("LoadingScreen")},Object.defineProperty(k.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!k._RescalePostProcessFactory},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),k.prototype.getInputElement=function(){return this._renderingCanvas},k.prototype.getAspectRatio=function(p,u){void 0===u&&(u=!1);var A=p.viewport;return this.getRenderWidth(u)*A.width/(this.getRenderHeight(u)*A.height)},k.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},k.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},k.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},k.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},k.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},k.prototype.getTimeStep=function(){return 1000*this._timeStep},k.prototype.generateMipMapsForCubemap=function(p,u){if(void 0===u&&(u=!0),p.generateMipMaps){var A=this._gl;this._bindTextureDirectly(A.TEXTURE_CUBE_MAP,p,!0),A.generateMipmap(A.TEXTURE_CUBE_MAP),u&&this._bindTextureDirectly(A.TEXTURE_CUBE_MAP,null)}},k.prototype.setState=function(p,u,A,B){void 0===u&&(u=0),void 0===B&&(B=!1),(this._depthCullingState.cull!==p||A)&&(this._depthCullingState.cull=p);var v=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==v||A)&&(this._depthCullingState.cullFace=v),this.setZOffset(u);var H=B?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==H||A)&&(this._depthCullingState.frontFace=H)},k.prototype.setZOffset=function(p){this._depthCullingState.zOffset=p},k.prototype.getZOffset=function(){return this._depthCullingState.zOffset},k.prototype.setDepthBuffer=function(p){this._depthCullingState.depthTest=p},k.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},k.prototype.setDepthWrite=function(p){this._depthCullingState.depthMask=p},k.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},k.prototype.setStencilBuffer=function(p){this._stencilState.stencilTest=p},k.prototype.getStencilMask=function(){return this._stencilState.stencilMask},k.prototype.setStencilMask=function(p){this._stencilState.stencilMask=p},k.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},k.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},k.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},k.prototype.setStencilFunction=function(p){this._stencilState.stencilFunc=p},k.prototype.setStencilFunctionReference=function(p){this._stencilState.stencilFuncRef=p},k.prototype.setStencilFunctionMask=function(p){this._stencilState.stencilFuncMask=p},k.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},k.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},k.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},k.prototype.setStencilOperationFail=function(p){this._stencilState.stencilOpStencilFail=p},k.prototype.setStencilOperationDepthFail=function(p){this._stencilState.stencilOpDepthFail=p},k.prototype.setStencilOperationPass=function(p){this._stencilState.stencilOpStencilDepthPass=p},k.prototype.setDitheringState=function(p){p?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},k.prototype.setRasterizerState=function(p){p?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},k.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},k.prototype.setDepthFunction=function(p){this._depthCullingState.depthFunc=p},k.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},k.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},k.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},k.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},k.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},k.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},k.prototype.setDirectViewport=function(p,u,A,B){var v=this._cachedViewport;return this._cachedViewport=null,this._viewport(p,u,A,B),v},k.prototype.scissorClear=function(p,u,A,B,v){this.enableScissor(p,u,A,B),this.clear(v,!0,!0,!0),this.disableScissor()},k.prototype.enableScissor=function(p,u,A,B){var v=this._gl;v.enable(v.SCISSOR_TEST),v.scissor(p,u,A,B)},k.prototype.disableScissor=function(){var p=this._gl;p.disable(p.SCISSOR_TEST)},k.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},k.prototype.initWebVR=function(){throw G.a.WarnImport("WebVRCamera")},k.prototype._prepareVRComponent=function(){},k.prototype._connectVREvents=function(p,u){},k.prototype._submitVRFrame=function(){},k.prototype.disableVR=function(){},k.prototype.isVRPresenting=function(){return!1},k.prototype._requestVRFrame=function(){},k.prototype._loadFileAsync=function(p,u,A){var B=this;return new Promise(function(v,H){B._loadFile(p,function(L){v(L)},void 0,u,A,function(L,Q){H(Q)})})},k.prototype.getVertexShaderSource=function(p){var u=this._gl.getAttachedShaders(p);return u?this._gl.getShaderSource(u[0]):null},k.prototype.getFragmentShaderSource=function(p){var u=this._gl.getAttachedShaders(p);return u?this._gl.getShaderSource(u[1]):null},k.prototype.setDepthStencilTexture=function(p,u,A){void 0!==p&&(u&&(this._boundUniforms[p]=u),A&&A.depthStencilTexture?this._setTexture(p,A,!1,!0):this._setTexture(p,null))},k.prototype.setTextureFromPostProcess=function(p,u){this._bindTexture(p,u?u._textures.data[u._currentRenderTextureInd]:null)},k.prototype.setTextureFromPostProcessOutput=function(p,u){this._bindTexture(p,u?u._outputTexture:null)},k.prototype._convertRGBtoRGBATextureData=function(p,u,A,B){var v;v=B===E.a.TEXTURETYPE_FLOAT?new Float32Array(u*A*4):new Uint32Array(u*A*4);for(var H=0;H<u;H++)for(var L=0;L<A;L++){var Q=3*(L*u+H),M=4*(L*u+H);v[M+0]=p[Q+0],v[M+1]=p[Q+1],v[M+2]=p[Q+2],v[M+3]=1}return v},k.prototype._rebuildBuffers=function(){for(var p=0,u=this.scenes;p<u.length;p++){var A=u[p];A.resetCachedMaterial(),A._rebuildGeometries(),A._rebuildTextures()}n.prototype._rebuildBuffers.call(this)},k.prototype._renderFrame=function(){for(var p=0;p<this._activeRenderLoops.length;p++)(0,this._activeRenderLoops[p])()},k.prototype._renderLoop=function(){if(!this._contextWasLost){var p=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(p=!1),p&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},k.prototype._renderViews=function(){return!1},k.prototype.switchFullscreen=function(p){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(p)},k.prototype.enterFullscreen=function(p){this.isFullscreen||(this._pointerLockRequested=p,this._renderingCanvas&&k._RequestFullscreen(this._renderingCanvas))},k.prototype.exitFullscreen=function(){this.isFullscreen&&k._ExitFullscreen()},k.prototype.enterPointerlock=function(){this._renderingCanvas&&k._RequestPointerlock(this._renderingCanvas)},k.prototype.exitPointerlock=function(){k._ExitPointerlock()},k.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),n.prototype.beginFrame.call(this)},k.prototype.endFrame=function(){n.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},k.prototype.resize=function(){this.isVRPresenting()||n.prototype.resize.call(this)},k.prototype.setSize=function(p,u){if(this._renderingCanvas&&(n.prototype.setSize.call(this,p,u),this.scenes)){for(var A=0;A<this.scenes.length;A++)for(var B=this.scenes[A],v=0;v<B.cameras.length;v++)B.cameras[v]._currentRenderId=0;this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},k.prototype.updateDynamicVertexBuffer=function(p,u,A,B){this.bindArrayBuffer(p),void 0===A&&(A=0);var v=u.length||u.byteLength;void 0===B||B>=v&&0===A?u instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,A,new Float32Array(u)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,A,u):u instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(u).subarray(A,A+B)):(u=u instanceof ArrayBuffer?new Uint8Array(u,A,B):new Uint8Array(u.buffer,u.byteOffset+A,B),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,u)),this._resetVertexBufferBinding()},k.prototype._deletePipelineContext=function(p){var u=p;u&&u.program&&u.transformFeedback&&(this.deleteTransformFeedback(u.transformFeedback),u.transformFeedback=null),n.prototype._deletePipelineContext.call(this,p)},k.prototype.createShaderProgram=function(p,u,A,B,v,H){void 0===H&&(H=null),v=v||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var L=n.prototype.createShaderProgram.call(this,p,u,A,B,v,H);return this.onAfterShaderCompilationObservable.notifyObservers(this),L},k.prototype._createShaderProgram=function(p,u,A,B,v){void 0===v&&(v=null);var H=B.createProgram();if(p.program=H,!H)throw new Error("Unable to create program");if(B.attachShader(H,u),B.attachShader(H,A),this.webGLVersion>1&&v){var L=this.createTransformFeedback();this.bindTransformFeedback(L),this.setTranformFeedbackVaryings(H,v),p.transformFeedback=L}return B.linkProgram(H),this.webGLVersion>1&&v&&this.bindTransformFeedback(null),p.context=B,p.vertexShader=u,p.fragmentShader=A,p.isParallelCompiled||this._finalizePipelineContext(p),H},k.prototype._releaseTexture=function(p){n.prototype._releaseTexture.call(this,p),this.scenes.forEach(function(u){u.postProcesses.forEach(function(A){A._outputTexture==p&&(A._outputTexture=null)}),u.cameras.forEach(function(A){A._postProcesses.forEach(function(B){B&&B._outputTexture==p&&(B._outputTexture=null)})})})},k.prototype._rescaleTexture=function(p,u,A,B,v){var H=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var L=this.createRenderTargetTexture({width:u.width,height:u.height},{generateMipMaps:!1,type:E.a.TEXTURETYPE_UNSIGNED_INT,samplingMode:E.a.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&k._RescalePostProcessFactory&&(this._rescalePostProcess=k._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){H._rescalePostProcess.onApply=function(M){M._bindTexture("textureSampler",p)};var Q=A;Q||(Q=H.scenes[H.scenes.length-1]),Q.postProcessManager.directRender([H._rescalePostProcess],L,!0),H._bindTextureDirectly(H._gl.TEXTURE_2D,u,!0),H._gl.copyTexImage2D(H._gl.TEXTURE_2D,0,B,0,0,u.width,u.height,0),H.unBindFramebuffer(L),H._releaseTexture(L),v&&v()})},k.prototype.getFps=function(){return this._fps},k.prototype.getDeltaTime=function(){return this._deltaTime},k.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},k.prototype._uploadImageToTexture=function(p,u,A,B){void 0===A&&(A=0),void 0===B&&(B=0);var v=this._gl,H=this._getWebGLTextureType(p.type),L=this._getInternalFormat(p.format),Q=this._getRGBABufferInternalSizedFormat(p.type,L),M=p.isCube?v.TEXTURE_CUBE_MAP:v.TEXTURE_2D;this._bindTextureDirectly(M,p,!0),this._unpackFlipY(p.invertY);var Y=v.TEXTURE_2D;p.isCube&&(Y=v.TEXTURE_CUBE_MAP_POSITIVE_X+A),v.texImage2D(Y,B,Q,L,H,u),this._bindTextureDirectly(M,null,!0)},k.prototype.updateDynamicIndexBuffer=function(p,u,A){var B;void 0===A&&(A=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(p),B=u instanceof Uint16Array||u instanceof Uint32Array?u:p.is32Bits?new Uint32Array(u):new Uint16Array(u),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,B,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},k.prototype.updateRenderTargetTextureSampleCount=function(p,u){if(this.webGLVersion<2||!p)return 1;if(p.samples===u)return u;var A=this._gl;if(u=Math.min(u,this.getCaps().maxMSAASamples),p._depthStencilBuffer&&(A.deleteRenderbuffer(p._depthStencilBuffer),p._depthStencilBuffer=null),p._MSAAFramebuffer&&(A.deleteFramebuffer(p._MSAAFramebuffer),p._MSAAFramebuffer=null),p._MSAARenderBuffer&&(A.deleteRenderbuffer(p._MSAARenderBuffer),p._MSAARenderBuffer=null),u>1&&A.renderbufferStorageMultisample){var B=A.createFramebuffer();if(!B)throw new Error("Unable to create multi sampled framebuffer");p._MSAAFramebuffer=B,this._bindUnboundFramebuffer(p._MSAAFramebuffer);var v=A.createRenderbuffer();if(!v)throw new Error("Unable to create multi sampled framebuffer");A.bindRenderbuffer(A.RENDERBUFFER,v),A.renderbufferStorageMultisample(A.RENDERBUFFER,u,this._getRGBAMultiSampleBufferFormat(p.type),p.width,p.height),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.RENDERBUFFER,v),p._MSAARenderBuffer=v}else this._bindUnboundFramebuffer(p._framebuffer);return p.samples=u,p._depthStencilBuffer=this._setupFramebufferDepthAttachments(p._generateStencilBuffer,p._generateDepthBuffer,p.width,p.height,u),this._bindUnboundFramebuffer(null),u},k.prototype.updateTextureComparisonFunction=function(p,u){if(1!==this.webGLVersion){var A=this._gl;p.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,p,!0),0===u?(A.texParameteri(A.TEXTURE_CUBE_MAP,A.TEXTURE_COMPARE_FUNC,E.a.LEQUAL),A.texParameteri(A.TEXTURE_CUBE_MAP,A.TEXTURE_COMPARE_MODE,A.NONE)):(A.texParameteri(A.TEXTURE_CUBE_MAP,A.TEXTURE_COMPARE_FUNC,u),A.texParameteri(A.TEXTURE_CUBE_MAP,A.TEXTURE_COMPARE_MODE,A.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,p,!0),0===u?(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_FUNC,E.a.LEQUAL),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_MODE,A.NONE)):(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_FUNC,u),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_MODE,A.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),p._comparisonFunction=u}else y.a.Error("WebGL 1 does not support texture comparison.")},k.prototype.createInstancesBuffer=function(p){var u=this._gl.createBuffer();if(!u)throw new Error("Unable to create instance buffer");var A=new s.a(u);return A.capacity=p,this.bindArrayBuffer(A),this._gl.bufferData(this._gl.ARRAY_BUFFER,p,this._gl.DYNAMIC_DRAW),A},k.prototype.deleteInstancesBuffer=function(p){this._gl.deleteBuffer(p)},k.prototype._clientWaitAsync=function(p,u,A){void 0===u&&(u=0),void 0===A&&(A=10);var B=this._gl;return new Promise(function(v,H){var L=function(){var Q=B.clientWaitSync(p,u,0);Q!=B.WAIT_FAILED?Q!=B.TIMEOUT_EXPIRED?v():setTimeout(L,A):H()};L()})},k.prototype._readPixelsAsync=function(p,u,A,B,v,H,L){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var Q=this._gl,M=Q.createBuffer();Q.bindBuffer(Q.PIXEL_PACK_BUFFER,M),Q.bufferData(Q.PIXEL_PACK_BUFFER,L.byteLength,Q.STREAM_READ),Q.readPixels(p,u,A,B,v,H,0),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,null);var Y=Q.fenceSync(Q.SYNC_GPU_COMMANDS_COMPLETE,0);return Y?(Q.flush(),this._clientWaitAsync(Y,0,10).then(function(){return Q.deleteSync(Y),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,M),Q.getBufferSubData(Q.PIXEL_PACK_BUFFER,0,L),Q.bindBuffer(Q.PIXEL_PACK_BUFFER,null),Q.deleteBuffer(M),L})):null},k.prototype._readTexturePixels=function(p,u,A,B,v,H){void 0===B&&(B=-1),void 0===v&&(v=0),void 0===H&&(H=null);var L=this._gl;if(!this._dummyFramebuffer){var Q=L.createFramebuffer();if(!Q)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=Q}L.bindFramebuffer(L.FRAMEBUFFER,this._dummyFramebuffer),B>-1?L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_CUBE_MAP_POSITIVE_X+B,p._webGLTexture,v):L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,p._webGLTexture,v);var M=void 0!==p.type?this._getWebGLTextureType(p.type):L.UNSIGNED_BYTE;switch(M){case L.UNSIGNED_BYTE:H||(H=new Uint8Array(4*u*A)),M=L.UNSIGNED_BYTE;break;default:H||(H=new Float32Array(4*u*A)),M=L.FLOAT}return L.readPixels(0,0,u,A,L.RGBA,M,H),L.bindFramebuffer(L.FRAMEBUFFER,this._currentFramebuffer),H},k.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===k.Instances.length&&k.audioEngine&&k.audioEngine.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),I.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)),n.prototype.dispose.call(this);var p=k.Instances.indexOf(this);p>=0&&k.Instances.splice(p,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},k.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},k.prototype.displayLoadingUI=function(){if(I.a.IsWindowObjectExist()){var p=this.loadingScreen;p&&p.displayLoadingUI()}},k.prototype.hideLoadingUI=function(){if(I.a.IsWindowObjectExist()){var p=this._loadingScreen;p&&p.hideLoadingUI()}},Object.defineProperty(k.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=k.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(p){this._loadingScreen=p},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"loadingUIText",{set:function(p){this.loadingScreen.loadingUIText=p},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"loadingUIBackgroundColor",{set:function(p){this.loadingScreen.loadingUIBackgroundColor=p},enumerable:!0,configurable:!0}),k._RequestPointerlock=function(p){p.requestPointerLock=p.requestPointerLock||p.msRequestPointerLock||p.mozRequestPointerLock||p.webkitRequestPointerLock,p.requestPointerLock&&p.requestPointerLock()},k._ExitPointerlock=function(){var p=document;document.exitPointerLock=document.exitPointerLock||p.msExitPointerLock||p.mozExitPointerLock||p.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},k._RequestFullscreen=function(p){var u=p.requestFullscreen||p.msRequestFullscreen||p.webkitRequestFullscreen||p.mozRequestFullScreen;u&&u.call(p)},k._ExitFullscreen=function(){var p=document;document.exitFullscreen?document.exitFullscreen():p.mozCancelFullScreen?p.mozCancelFullScreen():p.webkitCancelFullScreen?p.webkitCancelFullScreen():p.msCancelFullScreen&&p.msCancelFullScreen()},k.ALPHA_DISABLE=E.a.ALPHA_DISABLE,k.ALPHA_ADD=E.a.ALPHA_ADD,k.ALPHA_COMBINE=E.a.ALPHA_COMBINE,k.ALPHA_SUBTRACT=E.a.ALPHA_SUBTRACT,k.ALPHA_MULTIPLY=E.a.ALPHA_MULTIPLY,k.ALPHA_MAXIMIZED=E.a.ALPHA_MAXIMIZED,k.ALPHA_ONEONE=E.a.ALPHA_ONEONE,k.ALPHA_PREMULTIPLIED=E.a.ALPHA_PREMULTIPLIED,k.ALPHA_PREMULTIPLIED_PORTERDUFF=E.a.ALPHA_PREMULTIPLIED_PORTERDUFF,k.ALPHA_INTERPOLATE=E.a.ALPHA_INTERPOLATE,k.ALPHA_SCREENMODE=E.a.ALPHA_SCREENMODE,k.DELAYLOADSTATE_NONE=E.a.DELAYLOADSTATE_NONE,k.DELAYLOADSTATE_LOADED=E.a.DELAYLOADSTATE_LOADED,k.DELAYLOADSTATE_LOADING=E.a.DELAYLOADSTATE_LOADING,k.DELAYLOADSTATE_NOTLOADED=E.a.DELAYLOADSTATE_NOTLOADED,k.NEVER=E.a.NEVER,k.ALWAYS=E.a.ALWAYS,k.LESS=E.a.LESS,k.EQUAL=E.a.EQUAL,k.LEQUAL=E.a.LEQUAL,k.GREATER=E.a.GREATER,k.GEQUAL=E.a.GEQUAL,k.NOTEQUAL=E.a.NOTEQUAL,k.KEEP=E.a.KEEP,k.REPLACE=E.a.REPLACE,k.INCR=E.a.INCR,k.DECR=E.a.DECR,k.INVERT=E.a.INVERT,k.INCR_WRAP=E.a.INCR_WRAP,k.DECR_WRAP=E.a.DECR_WRAP,k.TEXTURE_CLAMP_ADDRESSMODE=E.a.TEXTURE_CLAMP_ADDRESSMODE,k.TEXTURE_WRAP_ADDRESSMODE=E.a.TEXTURE_WRAP_ADDRESSMODE,k.TEXTURE_MIRROR_ADDRESSMODE=E.a.TEXTURE_MIRROR_ADDRESSMODE,k.TEXTUREFORMAT_ALPHA=E.a.TEXTUREFORMAT_ALPHA,k.TEXTUREFORMAT_LUMINANCE=E.a.TEXTUREFORMAT_LUMINANCE,k.TEXTUREFORMAT_LUMINANCE_ALPHA=E.a.TEXTUREFORMAT_LUMINANCE_ALPHA,k.TEXTUREFORMAT_RGB=E.a.TEXTUREFORMAT_RGB,k.TEXTUREFORMAT_RGBA=E.a.TEXTUREFORMAT_RGBA,k.TEXTUREFORMAT_RED=E.a.TEXTUREFORMAT_RED,k.TEXTUREFORMAT_R=E.a.TEXTUREFORMAT_R,k.TEXTUREFORMAT_RG=E.a.TEXTUREFORMAT_RG,k.TEXTUREFORMAT_RED_INTEGER=E.a.TEXTUREFORMAT_RED_INTEGER,k.TEXTUREFORMAT_R_INTEGER=E.a.TEXTUREFORMAT_R_INTEGER,k.TEXTUREFORMAT_RG_INTEGER=E.a.TEXTUREFORMAT_RG_INTEGER,k.TEXTUREFORMAT_RGB_INTEGER=E.a.TEXTUREFORMAT_RGB_INTEGER,k.TEXTUREFORMAT_RGBA_INTEGER=E.a.TEXTUREFORMAT_RGBA_INTEGER,k.TEXTURETYPE_UNSIGNED_BYTE=E.a.TEXTURETYPE_UNSIGNED_BYTE,k.TEXTURETYPE_UNSIGNED_INT=E.a.TEXTURETYPE_UNSIGNED_INT,k.TEXTURETYPE_FLOAT=E.a.TEXTURETYPE_FLOAT,k.TEXTURETYPE_HALF_FLOAT=E.a.TEXTURETYPE_HALF_FLOAT,k.TEXTURETYPE_BYTE=E.a.TEXTURETYPE_BYTE,k.TEXTURETYPE_SHORT=E.a.TEXTURETYPE_SHORT,k.TEXTURETYPE_UNSIGNED_SHORT=E.a.TEXTURETYPE_UNSIGNED_SHORT,k.TEXTURETYPE_INT=E.a.TEXTURETYPE_INT,k.TEXTURETYPE_UNSIGNED_INTEGER=E.a.TEXTURETYPE_UNSIGNED_INTEGER,k.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=E.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,k.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=E.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,k.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=E.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,k.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=E.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,k.TEXTURETYPE_UNSIGNED_INT_24_8=E.a.TEXTURETYPE_UNSIGNED_INT_24_8,k.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=E.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,k.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=E.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,k.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=E.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,k.TEXTURE_NEAREST_SAMPLINGMODE=E.a.TEXTURE_NEAREST_SAMPLINGMODE,k.TEXTURE_BILINEAR_SAMPLINGMODE=E.a.TEXTURE_BILINEAR_SAMPLINGMODE,k.TEXTURE_TRILINEAR_SAMPLINGMODE=E.a.TEXTURE_TRILINEAR_SAMPLINGMODE,k.TEXTURE_NEAREST_NEAREST_MIPLINEAR=E.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,k.TEXTURE_LINEAR_LINEAR_MIPNEAREST=E.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,k.TEXTURE_LINEAR_LINEAR_MIPLINEAR=E.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,k.TEXTURE_NEAREST_NEAREST_MIPNEAREST=E.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,k.TEXTURE_NEAREST_LINEAR_MIPNEAREST=E.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,k.TEXTURE_NEAREST_LINEAR_MIPLINEAR=E.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,k.TEXTURE_NEAREST_LINEAR=E.a.TEXTURE_NEAREST_LINEAR,k.TEXTURE_NEAREST_NEAREST=E.a.TEXTURE_NEAREST_NEAREST,k.TEXTURE_LINEAR_NEAREST_MIPNEAREST=E.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,k.TEXTURE_LINEAR_NEAREST_MIPLINEAR=E.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,k.TEXTURE_LINEAR_LINEAR=E.a.TEXTURE_LINEAR_LINEAR,k.TEXTURE_LINEAR_NEAREST=E.a.TEXTURE_LINEAR_NEAREST,k.TEXTURE_EXPLICIT_MODE=E.a.TEXTURE_EXPLICIT_MODE,k.TEXTURE_SPHERICAL_MODE=E.a.TEXTURE_SPHERICAL_MODE,k.TEXTURE_PLANAR_MODE=E.a.TEXTURE_PLANAR_MODE,k.TEXTURE_CUBIC_MODE=E.a.TEXTURE_CUBIC_MODE,k.TEXTURE_PROJECTION_MODE=E.a.TEXTURE_PROJECTION_MODE,k.TEXTURE_SKYBOX_MODE=E.a.TEXTURE_SKYBOX_MODE,k.TEXTURE_INVCUBIC_MODE=E.a.TEXTURE_INVCUBIC_MODE,k.TEXTURE_EQUIRECTANGULAR_MODE=E.a.TEXTURE_EQUIRECTANGULAR_MODE,k.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=E.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,k.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=E.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,k.SCALEMODE_FLOOR=E.a.SCALEMODE_FLOOR,k.SCALEMODE_NEAREST=E.a.SCALEMODE_NEAREST,k.SCALEMODE_CEILING=E.a.SCALEMODE_CEILING,k._RescalePostProcessFactory=null,k}(D.a)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.GetClass=function(I){return this.RegisteredTypes&&this.RegisteredTypes[I]?this.RegisteredTypes[I]:null},r.RegisteredTypes={},r}()},function(Ja,t,o){"use strict";o.d(t,"b",function(){return k}),o.d(t,"c",function(){return p}),o.d(t,"a",function(){return u});var R=o(6),r=o(38),I=o(7),i=o(33),G=o(52),D=o(19),E=o(65),x=o(23),l=o(54),s=o(131),y=o(115),q=o(112),n=o(137),k=function(){function A(){}return Object.defineProperty(A,"BaseUrl",{get:function(){return l.a.BaseUrl},set:function(B){l.a.BaseUrl=B},enumerable:!0,configurable:!0}),Object.defineProperty(A,"DefaultRetryStrategy",{get:function(){return l.a.DefaultRetryStrategy},set:function(B){l.a.DefaultRetryStrategy=B},enumerable:!0,configurable:!0}),Object.defineProperty(A,"UseFallbackTexture",{get:function(){return x.a.UseFallbackTexture},set:function(B){x.a.UseFallbackTexture=B},enumerable:!0,configurable:!0}),Object.defineProperty(A,"RegisteredExternalClasses",{get:function(){return q.a.RegisteredExternalClasses},set:function(B){q.a.RegisteredExternalClasses=B},enumerable:!0,configurable:!0}),Object.defineProperty(A,"fallbackTexture",{get:function(){return x.a.FallbackTexture},set:function(B){x.a.FallbackTexture=B},enumerable:!0,configurable:!0}),A.FetchToRef=function(B,v,H,L,Q,M){var Y=4*((Math.abs(B)*H%H|0)+(Math.abs(v)*L%L|0)*H);M.r=Q[Y]/255,M.g=Q[Y+1]/255,M.b=Q[Y+2]/255,M.a=Q[Y+3]/255},A.Mix=function(B,v,H){return B*(1-H)+v*H},A.Instantiate=function(B){return q.a.Instantiate(B)},A.Slice=function(B,v,H){return B.slice?B.slice(v,H):Array.prototype.slice.call(B,v,H)},A.SetImmediate=function(B){y.a.SetImmediate(B)},A.IsExponentOfTwo=function(B){var v=1;do v*=2;while(v<B);return v===B},A.FloatRound=function(B){return Math.fround?Math.fround(B):A._tmpFloatArray[0]=B},A.GetFilename=function(B){var v=B.lastIndexOf("/");return v<0?B:B.substring(v+1)},A.GetFolderPath=function(B,v){void 0===v&&(v=!1);var H=B.lastIndexOf("/");return H<0?v?B:"":B.substring(0,H+1)},A.ToDegrees=function(B){return 180*B/Math.PI},A.ToRadians=function(B){return B*Math.PI/180},A.MakeArray=function(B,v){return!0===v||void 0!==B&&null!=B?Array.isArray(B)?B:[B]:null},A.GetPointerPrefix=function(){var B="pointer";return r.a.IsWindowObjectExist()&&!window.PointerEvent&&r.a.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(B="mouse"),B},A.SetCorsBehavior=function(B,v){l.a.SetCorsBehavior(B,v)},A.CleanUrl=function(B){return B=B.replace(/#/gm,"%23")},Object.defineProperty(A,"PreprocessUrl",{get:function(){return l.a.PreprocessUrl},set:function(B){l.a.PreprocessUrl=B},enumerable:!0,configurable:!0}),A.LoadImage=function(B,v,H,L,Q){return l.a.LoadImage(B,v,H,L,Q)},A.LoadFile=function(B,v,H,L,Q,M){return l.a.LoadFile(B,v,H,L,Q,M)},A.LoadFileAsync=function(B,v){return void 0===v&&(v=!0),new Promise(function(H,L){l.a.LoadFile(B,function(Q){H(Q)},void 0,void 0,v,function(Q,M){L(M)})})},A.LoadScript=function(B,v,H,L){if(r.a.IsWindowObjectExist()){var Q=document.getElementsByTagName("head")[0],M=document.createElement("script");M.setAttribute("type","text/javascript"),M.setAttribute("src",B),L&&(M.id=L),M.onload=function(){v&&v()},M.onerror=function(Y){H&&H("Unable to load script '"+B+"'",Y)},Q.appendChild(M)}},A.LoadScriptAsync=function(B,v){var H=this;return new Promise(function(L,Q){H.LoadScript(B,function(){L()},function(M,Y){Q(Y)})})},A.ReadFileAsDataURL=function(B,v,H){var L=new FileReader(),Q={onCompleteObservable:new R.c(),abort:function(){return L.abort()}};return L.onloadend=function(M){Q.onCompleteObservable.notifyObservers(Q)},L.onload=function(M){v(M.target.result)},L.onprogress=H,L.readAsDataURL(B),Q},A.ReadFile=function(B,v,H,L,Q){return l.a.ReadFile(B,v,H,L,Q)},A.FileAsURL=function(B){var v=new Blob([B]);return(window.URL||window.webkitURL).createObjectURL(v)},A.Format=function(B,v){return void 0===v&&(v=2),B.toFixed(v)},A.DeepCopy=function(B,v,H,L){i.a.DeepCopy(B,v,H,L)},A.IsEmpty=function(B){for(var v in B)if(B.hasOwnProperty(v))return!1;return!0},A.RegisterTopRootEvents=function(B,v){for(var H=0;H<v.length;H++){var L=v[H];B.addEventListener(L.name,L.handler,!1);try{window.parent&&window.parent.addEventListener(L.name,L.handler,!1)}catch(Q){}}},A.UnregisterTopRootEvents=function(B,v){for(var H=0;H<v.length;H++){var L=v[H];B.removeEventListener(L.name,L.handler);try{B.parent&&B.parent.removeEventListener(L.name,L.handler)}catch(Q){}}},A.DumpFramebuffer=function(B,v,H,L,Q,M){void 0===Q&&(Q="image/png");for(var Y=4*B,X=v/2,U=H.readPixels(0,0,B,v),P=0;P<X;P++)for(var ga=0;ga<Y;ga++){var ma=ga+P*Y,oa=ga+(v-P-1)*Y,ja=U[ma];U[ma]=U[oa],U[oa]=ja}A._ScreenshotCanvas||(A._ScreenshotCanvas=document.createElement("canvas")),A._ScreenshotCanvas.width=B,A._ScreenshotCanvas.height=v;var aa=A._ScreenshotCanvas.getContext("2d");if(aa){var F=aa.createImageData(B,v);F.data.set(U),aa.putImageData(F,0,0),A.EncodeScreenshotCanvasData(L,Q,M)}},A.ToBlob=function(B,v,H){void 0===H&&(H="image/png"),B.toBlob||(B.toBlob=function(L,Q,M){var Y=this;setTimeout(function(){for(var X=atob(Y.toDataURL(Q,M).split(",")[1]),U=X.length,P=new Uint8Array(U),ga=0;ga<U;ga++)P[ga]=X.charCodeAt(ga);L(new Blob([P]))})}),B.toBlob(function(L){v(L)},H)},A.EncodeScreenshotCanvasData=function(B,v,H){(void 0===v&&(v="image/png"),B)?B(A._ScreenshotCanvas.toDataURL(v)):this.ToBlob(A._ScreenshotCanvas,function(L){if("download"in document.createElement("a")){if(!H){var Q=new Date(),M=(Q.getFullYear()+"-"+(Q.getMonth()+1)).slice(2)+"-"+Q.getDate()+"_"+Q.getHours()+"-"+("0"+Q.getMinutes()).slice(-2);H="screenshot_"+M+".png"}A.Download(L,H)}else{var Y=URL.createObjectURL(L),X=window.open("");if(!X)return;var U=X.document.createElement("img");U.onload=function(){URL.revokeObjectURL(Y)},U.src=Y,X.document.body.appendChild(U)}},v)},A.Download=function(B,v){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(B,v);else{var H=window.URL.createObjectURL(B),L=document.createElement("a");document.body.appendChild(L),L.style.display="none",L.href=H,L.download=v,L.addEventListener("click",function(){L.parentElement&&L.parentElement.removeChild(L)}),L.click(),window.URL.revokeObjectURL(H)}},A.CreateScreenshot=function(B,v,H,L,Q){throw void 0===Q&&(Q="image/png"),D.a.WarnImport("ScreenshotTools")},A.CreateScreenshotAsync=function(B,v,H,L){throw void 0===L&&(L="image/png"),D.a.WarnImport("ScreenshotTools")},A.CreateScreenshotUsingRenderTarget=function(B,v,H,L,Q,M,Y,X){throw void 0===Q&&(Q="image/png"),void 0===M&&(M=1),void 0===Y&&(Y=!1),D.a.WarnImport("ScreenshotTools")},A.CreateScreenshotUsingRenderTargetAsync=function(B,v,H,L,Q,M,Y){throw void 0===L&&(L="image/png"),void 0===Q&&(Q=1),void 0===M&&(M=!1),D.a.WarnImport("ScreenshotTools")},A.RandomId=function(){return n.a.RandomId()},A.IsBase64=function(B){return!(B.length<5)&&"data:"===B.substr(0,5)},A.DecodeBase64=function(B){for(var v=atob(B.split(",")[1]),H=v.length,L=new Uint8Array(new ArrayBuffer(H)),Q=0;Q<H;Q++)L[Q]=v.charCodeAt(Q);return L.buffer},A.GetAbsoluteUrl=function(B){var v=document.createElement("a");return v.href=B,v.href},Object.defineProperty(A,"errorsCount",{get:function(){return I.a.errorsCount},enumerable:!0,configurable:!0}),A.Log=function(B){I.a.Log(B)},A.Warn=function(B){I.a.Warn(B)},A.Error=function(B){I.a.Error(B)},Object.defineProperty(A,"LogCache",{get:function(){return I.a.LogCache},enumerable:!0,configurable:!0}),A.ClearLogCache=function(){I.a.ClearLogCache()},Object.defineProperty(A,"LogLevels",{set:function(B){I.a.LogLevels=B},enumerable:!0,configurable:!0}),Object.defineProperty(A,"PerformanceLogLevel",{set:function(B){return(B&A.PerformanceUserMarkLogLevel)===A.PerformanceUserMarkLogLevel?(A.StartPerformanceCounter=A._StartUserMark,void(A.EndPerformanceCounter=A._EndUserMark)):(B&A.PerformanceConsoleLogLevel)===A.PerformanceConsoleLogLevel?(A.StartPerformanceCounter=A._StartPerformanceConsole,void(A.EndPerformanceCounter=A._EndPerformanceConsole)):(A.StartPerformanceCounter=A._StartPerformanceCounterDisabled,void(A.EndPerformanceCounter=A._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),A._StartPerformanceCounterDisabled=function(B,v){},A._EndPerformanceCounterDisabled=function(B,v){},A._StartUserMark=function(B,v){if(void 0===v&&(v=!0),!A._performance){if(!r.a.IsWindowObjectExist())return;A._performance=window.performance}v&&A._performance.mark&&A._performance.mark(B+"-Begin")},A._EndUserMark=function(B,v){void 0===v&&(v=!0),v&&A._performance.mark&&(A._performance.mark(B+"-End"),A._performance.measure(B,B+"-Begin",B+"-End"))},A._StartPerformanceConsole=function(B,v){void 0===v&&(v=!0),v&&(A._StartUserMark(B,v),console.time&&console.time(B))},A._EndPerformanceConsole=function(B,v){void 0===v&&(v=!0),v&&(A._EndUserMark(B,v),console.timeEnd(B))},Object.defineProperty(A,"Now",{get:function(){return G.a.Now},enumerable:!0,configurable:!0}),A.GetClassName=function(B,v){void 0===v&&(v=!1);var H=null;return!v&&B.getClassName?H=B.getClassName():(B instanceof Object&&(H=(v?B:Object.getPrototypeOf(B)).constructor.__bjsclassName__),H||(H=typeof B)),H},A.First=function(B,v){for(var H=0,L=B;H<L.length;H++){var Q=L[H];if(v(Q))return Q}return null},A.getFullClassName=function(B,v){void 0===v&&(v=!1);var H=null,L=null;if(!v&&B.getClassName)H=B.getClassName();else{if(B instanceof Object){var Q=v?B:Object.getPrototypeOf(B);H=Q.constructor.__bjsclassName__,L=Q.constructor.__bjsmoduleName__}H||(H=typeof B)}return H?(null!=L?L+".":"")+H:null},A.DelayAsync=function(B){return new Promise(function(v){setTimeout(function(){v()},B)})},A.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},A.UseCustomRequestHeaders=!1,A.CustomRequestHeaders=E.a.CustomRequestHeaders,A.CorsBehavior="anonymous",A._tmpFloatArray=new Float32Array(1),A.GetDOMTextContent=r.a.GetDOMTextContent,A.NoneLogLevel=I.a.NoneLogLevel,A.MessageLogLevel=I.a.MessageLogLevel,A.WarningLogLevel=I.a.WarningLogLevel,A.ErrorLogLevel=I.a.ErrorLogLevel,A.AllLogLevel=I.a.AllLogLevel,A.IsWindowObjectExist=r.a.IsWindowObjectExist,A.PerformanceNoneLogLevel=0,A.PerformanceUserMarkLogLevel=1,A.PerformanceConsoleLogLevel=2,A.StartPerformanceCounter=A._StartPerformanceCounterDisabled,A.EndPerformanceCounter=A._EndPerformanceCounterDisabled,A}();function p(A,B){return function(v){v.__bjsclassName__=A,v.__bjsmoduleName__=null!=B?B:null}}var u=function(){function A(B,v,H,L){void 0===L&&(L=0),this.iterations=B,this.index=L-1,this._done=!1,this._fn=v,this._successCallback=H}return A.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},A.prototype.breakLoop=function(){this._done=!0,this._successCallback()},A.Run=function(B,v,H,L){void 0===L&&(L=0);var Q=new A(B,v,H,L);return Q.executeNext(),Q},A.SyncAsyncForLoop=function(B,v,H,L,Q,M){return void 0===M&&(M=0),A.Run(Math.ceil(B/v),function(Y){Q&&Q()?Y.breakLoop():setTimeout(function(){for(var X=0;X<v;++X){var U=Y.index*v+X;if(U>=B)break;if(H(U),Q&&Q()){Y.breakLoop();break}}Y.executeNext()},M)},L)},A}();x.a.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",s.a.Apply()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.WithinEpsilon=function(I,i,G){void 0===G&&(G=1.401298e-45);var D=I-i;return-G<=D&&D<=G},r.ToHex=function(I){var i=I.toString(16);return I<=15?("0"+i).toUpperCase():i.toUpperCase()},r.Sign=function(I){return 0===(I=+I)||isNaN(I)?I:I>0?1:-1},r.Clamp=function(I,i,G){return void 0===i&&(i=0),void 0===G&&(G=1),Math.min(G,Math.max(i,I))},r.Log2=function(I){return Math.log(I)*Math.LOG2E},r.Repeat=function(I,i){return I-Math.floor(I/i)*i},r.Normalize=function(I,i,G){return(I-i)/(G-i)},r.Denormalize=function(I,i,G){return I*(G-i)+i},r.DeltaAngle=function(I,i){var G=r.Repeat(i-I,360);return G>180&&(G-=360),G},r.PingPong=function(I,i){var G=r.Repeat(I,2*i);return i-Math.abs(G-i)},r.SmoothStep=function(I,i,G){var D=r.Clamp(G);return i*(D=-2*D*D*D+3*D*D)+I*(1-D)},r.MoveTowards=function(I,i,G){return Math.abs(i-I)<=G?i:I+r.Sign(i-I)*G},r.MoveTowardsAngle=function(I,i,G){var D=r.DeltaAngle(I,i),E=0;return-G<D&&D<G?E=i:(i=I+D,E=r.MoveTowards(I,i,G)),E},r.Lerp=function(I,i,G){return I+(i-I)*G},r.LerpAngle=function(I,i,G){var D=r.Repeat(i-I,360);return D>180&&(D-=360),I+D*r.Clamp(G)},r.InverseLerp=function(I,i,G){return I!=i?r.Clamp((G-I)/(i-I)):0},r.Hermite=function(I,i,G,D,E){var x=E*E,l=E*x;return I*(2*l-3*x+1)+G*(-2*l+3*x)+i*(l-2*x+E)+D*(l-x)},r.RandomRange=function(I,i){return I===i?I:Math.random()*(i-I)+I},r.RangeToPercent=function(I,i,G){return(I-i)/(G-i)},r.PercentToRange=function(I,i,G){return(G-i)*I+i},r.NormalizeRadians=function(I){return I-=r.TwoPi*Math.floor((I+Math.PI)/r.TwoPi)},r.TwoPi=2*Math.PI,r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return G});var R=o(0),r=o(4),I=o(19),i=o(10),G=function(){function D(){}return D.prototype.set=function(E,x){switch(x){case r.b.PositionKind:this.positions=E;break;case r.b.NormalKind:this.normals=E;break;case r.b.TangentKind:this.tangents=E;break;case r.b.UVKind:this.uvs=E;break;case r.b.UV2Kind:this.uvs2=E;break;case r.b.UV3Kind:this.uvs3=E;break;case r.b.UV4Kind:this.uvs4=E;break;case r.b.UV5Kind:this.uvs5=E;break;case r.b.UV6Kind:this.uvs6=E;break;case r.b.ColorKind:this.colors=E;break;case r.b.MatricesIndicesKind:this.matricesIndices=E;break;case r.b.MatricesWeightsKind:this.matricesWeights=E;break;case r.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=E;break;case r.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=E}},D.prototype.applyToMesh=function(E,x){return this._applyTo(E,x),this},D.prototype.applyToGeometry=function(E,x){return this._applyTo(E,x),this},D.prototype.updateMesh=function(E){return this._update(E),this},D.prototype.updateGeometry=function(E){return this._update(E),this},D.prototype._applyTo=function(E,x){return void 0===x&&(x=!1),this.positions&&E.setVerticesData(r.b.PositionKind,this.positions,x),this.normals&&E.setVerticesData(r.b.NormalKind,this.normals,x),this.tangents&&E.setVerticesData(r.b.TangentKind,this.tangents,x),this.uvs&&E.setVerticesData(r.b.UVKind,this.uvs,x),this.uvs2&&E.setVerticesData(r.b.UV2Kind,this.uvs2,x),this.uvs3&&E.setVerticesData(r.b.UV3Kind,this.uvs3,x),this.uvs4&&E.setVerticesData(r.b.UV4Kind,this.uvs4,x),this.uvs5&&E.setVerticesData(r.b.UV5Kind,this.uvs5,x),this.uvs6&&E.setVerticesData(r.b.UV6Kind,this.uvs6,x),this.colors&&E.setVerticesData(r.b.ColorKind,this.colors,x),this.matricesIndices&&E.setVerticesData(r.b.MatricesIndicesKind,this.matricesIndices,x),this.matricesWeights&&E.setVerticesData(r.b.MatricesWeightsKind,this.matricesWeights,x),this.matricesIndicesExtra&&E.setVerticesData(r.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,x),this.matricesWeightsExtra&&E.setVerticesData(r.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,x),this.indices?E.setIndices(this.indices,null,x):E.setIndices([],null),this},D.prototype._update=function(E,x,l){return this.positions&&E.updateVerticesData(r.b.PositionKind,this.positions,x,l),this.normals&&E.updateVerticesData(r.b.NormalKind,this.normals,x,l),this.tangents&&E.updateVerticesData(r.b.TangentKind,this.tangents,x,l),this.uvs&&E.updateVerticesData(r.b.UVKind,this.uvs,x,l),this.uvs2&&E.updateVerticesData(r.b.UV2Kind,this.uvs2,x,l),this.uvs3&&E.updateVerticesData(r.b.UV3Kind,this.uvs3,x,l),this.uvs4&&E.updateVerticesData(r.b.UV4Kind,this.uvs4,x,l),this.uvs5&&E.updateVerticesData(r.b.UV5Kind,this.uvs5,x,l),this.uvs6&&E.updateVerticesData(r.b.UV6Kind,this.uvs6,x,l),this.colors&&E.updateVerticesData(r.b.ColorKind,this.colors,x,l),this.matricesIndices&&E.updateVerticesData(r.b.MatricesIndicesKind,this.matricesIndices,x,l),this.matricesWeights&&E.updateVerticesData(r.b.MatricesWeightsKind,this.matricesWeights,x,l),this.matricesIndicesExtra&&E.updateVerticesData(r.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,x,l),this.matricesWeightsExtra&&E.updateVerticesData(r.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,x,l),this.indices&&E.setIndices(this.indices,null),this},D.prototype.transform=function(E){var x,l=E.m[0]*E.m[5]*E.m[10]<0,s=R.e.Zero();if(this.positions){var y=R.e.Zero();for(x=0;x<this.positions.length;x+=3)R.e.FromArrayToRef(this.positions,x,y),R.e.TransformCoordinatesToRef(y,E,s),this.positions[x]=s.x,this.positions[x+1]=s.y,this.positions[x+2]=s.z}if(this.normals){var q=R.e.Zero();for(x=0;x<this.normals.length;x+=3)R.e.FromArrayToRef(this.normals,x,q),R.e.TransformNormalToRef(q,E,s),this.normals[x]=s.x,this.normals[x+1]=s.y,this.normals[x+2]=s.z}if(this.tangents){var n=R.f.Zero(),k=R.f.Zero();for(x=0;x<this.tangents.length;x+=4)R.f.FromArrayToRef(this.tangents,x,n),R.f.TransformNormalToRef(n,E,k),this.tangents[x]=k.x,this.tangents[x+1]=k.y,this.tangents[x+2]=k.z,this.tangents[x+3]=k.w}if(l&&this.indices)for(x=0;x<this.indices.length;x+=3){var p=this.indices[x+1];this.indices[x+1]=this.indices[x+2],this.indices[x+2]=p}return this},D.prototype.merge=function(E,x){if(void 0===x&&(x=!1),this._validate(),E._validate(),!this.normals!=!E.normals||!this.tangents!=!E.tangents||!this.uvs!=!E.uvs||!this.uvs2!=!E.uvs2||!this.uvs3!=!E.uvs3||!this.uvs4!=!E.uvs4||!this.uvs5!=!E.uvs5||!this.uvs6!=!E.uvs6||!this.colors!=!E.colors||!this.matricesIndices!=!E.matricesIndices||!this.matricesWeights!=!E.matricesWeights||!this.matricesIndicesExtra!=!E.matricesIndicesExtra||!this.matricesWeightsExtra!=!E.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(E.indices){this.indices||(this.indices=[]);var l=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var s=this.indices.length+E.indices.length,y=x||this.indices instanceof Uint32Array?new Uint32Array(s):new Uint16Array(s);y.set(this.indices);for(var q=this.indices.length,n=0;n<E.indices.length;n++)y[q+n]=E.indices[n]+l;this.indices=y}else for(n=0;n<E.indices.length;n++)this.indices.push(E.indices[n]+l)}return this.positions=this._mergeElement(this.positions,E.positions),this.normals=this._mergeElement(this.normals,E.normals),this.tangents=this._mergeElement(this.tangents,E.tangents),this.uvs=this._mergeElement(this.uvs,E.uvs),this.uvs2=this._mergeElement(this.uvs2,E.uvs2),this.uvs3=this._mergeElement(this.uvs3,E.uvs3),this.uvs4=this._mergeElement(this.uvs4,E.uvs4),this.uvs5=this._mergeElement(this.uvs5,E.uvs5),this.uvs6=this._mergeElement(this.uvs6,E.uvs6),this.colors=this._mergeElement(this.colors,E.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,E.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,E.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,E.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,E.matricesWeightsExtra),this},D.prototype._mergeElement=function(E,x){if(!E)return x;if(!x)return E;var l=x.length+E.length,s=E instanceof Float32Array,y=x instanceof Float32Array;if(s){var q=new Float32Array(l);return q.set(E),q.set(x,E.length),q}if(y){var n=E.slice(0),k=0;for(l=x.length;k<l;k++)n.push(x[k]);return n}return E.concat(x)},D.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var E=function(s,y){var q=r.b.DeduceStride(s);if(y.length%q!=0)throw new Error("The "+s+"s array count must be a multiple of "+q);return y.length/q},x=E(r.b.PositionKind,this.positions),l=function(s,y){var q=E(s,y);if(q!==x)throw new Error("The "+s+"s element count ("+q+") does not match the positions count ("+x+")")};this.normals&&l(r.b.NormalKind,this.normals),this.tangents&&l(r.b.TangentKind,this.tangents),this.uvs&&l(r.b.UVKind,this.uvs),this.uvs2&&l(r.b.UV2Kind,this.uvs2),this.uvs3&&l(r.b.UV3Kind,this.uvs3),this.uvs4&&l(r.b.UV4Kind,this.uvs4),this.uvs5&&l(r.b.UV5Kind,this.uvs5),this.uvs6&&l(r.b.UV6Kind,this.uvs6),this.colors&&l(r.b.ColorKind,this.colors),this.matricesIndices&&l(r.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&l(r.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&l(r.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&l(r.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},D.prototype.serialize=function(){var E=this.serialize();return this.positions&&(E.positions=this.positions),this.normals&&(E.normals=this.normals),this.tangents&&(E.tangents=this.tangents),this.uvs&&(E.uvs=this.uvs),this.uvs2&&(E.uvs2=this.uvs2),this.uvs3&&(E.uvs3=this.uvs3),this.uvs4&&(E.uvs4=this.uvs4),this.uvs5&&(E.uvs5=this.uvs5),this.uvs6&&(E.uvs6=this.uvs6),this.colors&&(E.colors=this.colors),this.matricesIndices&&(E.matricesIndices=this.matricesIndices,E.matricesIndices._isExpanded=!0),this.matricesWeights&&(E.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(E.matricesIndicesExtra=this.matricesIndicesExtra,E.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(E.matricesWeightsExtra=this.matricesWeightsExtra),E.indices=this.indices,E},D.ExtractFromMesh=function(E,x,l){return D._ExtractFrom(E,x,l)},D.ExtractFromGeometry=function(E,x,l){return D._ExtractFrom(E,x,l)},D._ExtractFrom=function(E,x,l){var s=new D();return E.isVerticesDataPresent(r.b.PositionKind)&&(s.positions=E.getVerticesData(r.b.PositionKind,x,l)),E.isVerticesDataPresent(r.b.NormalKind)&&(s.normals=E.getVerticesData(r.b.NormalKind,x,l)),E.isVerticesDataPresent(r.b.TangentKind)&&(s.tangents=E.getVerticesData(r.b.TangentKind,x,l)),E.isVerticesDataPresent(r.b.UVKind)&&(s.uvs=E.getVerticesData(r.b.UVKind,x,l)),E.isVerticesDataPresent(r.b.UV2Kind)&&(s.uvs2=E.getVerticesData(r.b.UV2Kind,x,l)),E.isVerticesDataPresent(r.b.UV3Kind)&&(s.uvs3=E.getVerticesData(r.b.UV3Kind,x,l)),E.isVerticesDataPresent(r.b.UV4Kind)&&(s.uvs4=E.getVerticesData(r.b.UV4Kind,x,l)),E.isVerticesDataPresent(r.b.UV5Kind)&&(s.uvs5=E.getVerticesData(r.b.UV5Kind,x,l)),E.isVerticesDataPresent(r.b.UV6Kind)&&(s.uvs6=E.getVerticesData(r.b.UV6Kind,x,l)),E.isVerticesDataPresent(r.b.ColorKind)&&(s.colors=E.getVerticesData(r.b.ColorKind,x,l)),E.isVerticesDataPresent(r.b.MatricesIndicesKind)&&(s.matricesIndices=E.getVerticesData(r.b.MatricesIndicesKind,x,l)),E.isVerticesDataPresent(r.b.MatricesWeightsKind)&&(s.matricesWeights=E.getVerticesData(r.b.MatricesWeightsKind,x,l)),E.isVerticesDataPresent(r.b.MatricesIndicesExtraKind)&&(s.matricesIndicesExtra=E.getVerticesData(r.b.MatricesIndicesExtraKind,x,l)),E.isVerticesDataPresent(r.b.MatricesWeightsExtraKind)&&(s.matricesWeightsExtra=E.getVerticesData(r.b.MatricesWeightsExtraKind,x,l)),s.indices=E.getIndices(x,l),s},D.CreateRibbon=function(E){throw I.a.WarnImport("ribbonBuilder")},D.CreateBox=function(E){throw I.a.WarnImport("boxBuilder")},D.CreateTiledBox=function(E){throw I.a.WarnImport("tiledBoxBuilder")},D.CreateTiledPlane=function(E){throw I.a.WarnImport("tiledPlaneBuilder")},D.CreateSphere=function(E){throw I.a.WarnImport("sphereBuilder")},D.CreateCylinder=function(E){throw I.a.WarnImport("cylinderBuilder")},D.CreateTorus=function(E){throw I.a.WarnImport("torusBuilder")},D.CreateLineSystem=function(E){throw I.a.WarnImport("linesBuilder")},D.CreateDashedLines=function(E){throw I.a.WarnImport("linesBuilder")},D.CreateGround=function(E){throw I.a.WarnImport("groundBuilder")},D.CreateTiledGround=function(E){throw I.a.WarnImport("groundBuilder")},D.CreateGroundFromHeightMap=function(E){throw I.a.WarnImport("groundBuilder")},D.CreatePlane=function(E){throw I.a.WarnImport("planeBuilder")},D.CreateDisc=function(E){throw I.a.WarnImport("discBuilder")},D.CreatePolygon=function(E,x,l,s,y,q){throw I.a.WarnImport("polygonBuilder")},D.CreateIcoSphere=function(E){throw I.a.WarnImport("icoSphereBuilder")},D.CreatePolyhedron=function(E){throw I.a.WarnImport("polyhedronBuilder")},D.CreateTorusKnot=function(E){throw I.a.WarnImport("torusKnotBuilder")},D.ComputeNormals=function(E,x,l,s){var y=0,q=0,n=0,k=0,p=0,u=0,A=0,B=0,v=0,H=0,L=0,Q=0,M=0,Y=0,X=0,U=0,P=0,ga=0,ma=0,oa=0,ja=!1,aa=!1,F=!1,$=!1,ia=1,ba=0,qa=null;if(s&&(ja=!!s.facetNormals,aa=!!s.facetPositions,F=!!s.facetPartitioning,ia=!0===s.useRightHandedSystem?-1:1,ba=s.ratio||0,$=!!s.depthSort,qa=s.distanceTo,$)){void 0===qa&&(qa=R.e.Zero());var V=s.depthSortedFacets}var O=0,S=0,W=0,da=0;if(F&&s&&s.bbSize){var na=0,Ea=0,Ca=0,wa=0,Ka=0,Ga=0,Ba=0,Na=0,db=0,eb=0,Ya=0,Sa=0,sb=0,kb=0,wb=0,tb=0,Ob=s.bbSize.x>s.bbSize.y?s.bbSize.x:s.bbSize.y;Ob=Ob>s.bbSize.z?Ob:s.bbSize.z,O=s.subDiv.X*ba/s.bbSize.x,S=s.subDiv.Y*ba/s.bbSize.y,W=s.subDiv.Z*ba/s.bbSize.z,da=s.subDiv.max*s.subDiv.max,s.facetPartitioning.length=0}for(y=0;y<E.length;y++)l[y]=0;var dc=x.length/3|0;for(y=0;y<dc;y++){if(M=(Q=3*x[3*y])+1,Y=Q+2,U=(X=3*x[3*y+1])+1,P=X+2,ma=(ga=3*x[3*y+2])+1,oa=ga+2,q=E[Q]-E[X],n=E[M]-E[U],k=E[Y]-E[P],p=E[ga]-E[X],u=E[ma]-E[U],B=ia*(n*(A=E[oa]-E[P])-k*u),v=ia*(k*p-q*A),H=ia*(q*u-n*p),B/=L=0===(L=Math.sqrt(B*B+v*v+H*H))?1:L,v/=L,H/=L,ja&&s&&(s.facetNormals[y].x=B,s.facetNormals[y].y=v,s.facetNormals[y].z=H),aa&&s&&(s.facetPositions[y].x=(E[Q]+E[X]+E[ga])/3,s.facetPositions[y].y=(E[M]+E[U]+E[ma])/3,s.facetPositions[y].z=(E[Y]+E[P]+E[oa])/3),F&&s&&(na=Math.floor((s.facetPositions[y].x-s.bInfo.minimum.x*ba)*O),Ea=Math.floor((s.facetPositions[y].y-s.bInfo.minimum.y*ba)*S),Ca=Math.floor((s.facetPositions[y].z-s.bInfo.minimum.z*ba)*W),wa=Math.floor((E[Q]-s.bInfo.minimum.x*ba)*O),Ka=Math.floor((E[M]-s.bInfo.minimum.y*ba)*S),Ga=Math.floor((E[Y]-s.bInfo.minimum.z*ba)*W),Ba=Math.floor((E[X]-s.bInfo.minimum.x*ba)*O),Na=Math.floor((E[U]-s.bInfo.minimum.y*ba)*S),db=Math.floor((E[P]-s.bInfo.minimum.z*ba)*W),eb=Math.floor((E[ga]-s.bInfo.minimum.x*ba)*O),Ya=Math.floor((E[ma]-s.bInfo.minimum.y*ba)*S),Sa=Math.floor((E[oa]-s.bInfo.minimum.z*ba)*W),kb=wa+s.subDiv.max*Ka+da*Ga,wb=Ba+s.subDiv.max*Na+da*db,tb=eb+s.subDiv.max*Ya+da*Sa,sb=na+s.subDiv.max*Ea+da*Ca,s.facetPartitioning[sb]=s.facetPartitioning[sb]?s.facetPartitioning[sb]:new Array(),s.facetPartitioning[kb]=s.facetPartitioning[kb]?s.facetPartitioning[kb]:new Array(),s.facetPartitioning[wb]=s.facetPartitioning[wb]?s.facetPartitioning[wb]:new Array(),s.facetPartitioning[tb]=s.facetPartitioning[tb]?s.facetPartitioning[tb]:new Array(),s.facetPartitioning[kb].push(y),wb!=kb&&s.facetPartitioning[wb].push(y),tb!=wb&&tb!=kb&&s.facetPartitioning[tb].push(y),sb!=kb&&sb!=wb&&sb!=tb&&s.facetPartitioning[sb].push(y)),$&&s&&s.facetPositions){var tc=V[y];tc.ind=3*y,tc.sqDistance=R.e.DistanceSquared(s.facetPositions[y],qa)}l[Q]+=B,l[M]+=v,l[Y]+=H,l[X]+=B,l[U]+=v,l[P]+=H,l[ga]+=B,l[ma]+=v,l[oa]+=H}for(y=0;y<l.length/3;y++)B=l[3*y],v=l[3*y+1],H=l[3*y+2],B/=L=0===(L=Math.sqrt(B*B+v*v+H*H))?1:L,v/=L,H/=L,l[3*y]=B,l[3*y+1]=v,l[3*y+2]=H},D._ComputeSides=function(E,x,l,s,y,q,n){var k,p,u=l.length,A=s.length;switch(E=E||D.DEFAULTSIDE){case D.FRONTSIDE:break;case D.BACKSIDE:var B;for(k=0;k<u;k+=3)B=l[k],l[k]=l[k+2],l[k+2]=B;for(p=0;p<A;p++)s[p]=-s[p];break;case D.DOUBLESIDE:for(var v=x.length,H=v/3,L=0;L<v;L++)x[v+L]=x[L];for(k=0;k<u;k+=3)l[k+u]=l[k+2]+H,l[k+1+u]=l[k+1]+H,l[k+2+u]=l[k]+H;for(p=0;p<A;p++)s[A+p]=-s[p];var Q=y.length,M=0;for(M=0;M<Q;M++)y[M+Q]=y[M];for(q=q||new R.f(0,0,1,1),n=n||new R.f(0,0,1,1),M=0,k=0;k<Q/2;k++)y[M]=q.x+(q.z-q.x)*y[M],y[M+1]=q.y+(q.w-q.y)*y[M+1],y[M+Q]=n.x+(n.z-n.x)*y[M+Q],y[M+Q+1]=n.y+(n.w-n.y)*y[M+Q+1],M+=2}},D.ImportVertexData=function(E,x){var l=new D(),s=E.positions;s&&l.set(s,r.b.PositionKind);var y=E.normals;y&&l.set(y,r.b.NormalKind);var q=E.tangents;q&&l.set(q,r.b.TangentKind);var n=E.uvs;n&&l.set(n,r.b.UVKind);var k=E.uv2s;k&&l.set(k,r.b.UV2Kind);var p=E.uv3s;p&&l.set(p,r.b.UV3Kind);var u=E.uv4s;u&&l.set(u,r.b.UV4Kind);var A=E.uv5s;A&&l.set(A,r.b.UV5Kind);var B=E.uv6s;B&&l.set(B,r.b.UV6Kind);var v=E.colors;v&&l.set(i.b.CheckColors4(v,s.length/3),r.b.ColorKind);var H=E.matricesIndices;H&&l.set(H,r.b.MatricesIndicesKind);var L=E.matricesWeights;L&&l.set(L,r.b.MatricesWeightsKind);var Q=E.indices;Q&&(l.indices=Q),x.setAllVerticesData(l,E.updatable)},D.FRONTSIDE=0,D.BACKSIDE=1,D.DOUBLESIDE=2,D.DEFAULTSIDE=0,D}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return E});var R=o(7),r=o(18),I=o(23),i=o(4),G=o(50),D=o(10),E=function(){function x(){}return x.BindEyePosition=function(l,s){if(s._forcedViewPosition)l.setVector3("vEyePosition",s._forcedViewPosition);else{var y=s.activeCamera.globalPosition;y||(y=s.activeCamera.devicePosition),l.setVector3("vEyePosition",s._mirroredCameraPosition?s._mirroredCameraPosition:y)}},x.PrepareDefinesForMergedUV=function(l,s,y){s._needUVs=!0,s[y]=!0,l.getTextureMatrix().isIdentityAs3x2()?(s[y+"DIRECTUV"]=l.coordinatesIndex+1,0===l.coordinatesIndex?s.MAINUV1=!0:s.MAINUV2=!0):s[y+"DIRECTUV"]=0},x.BindTextureMatrix=function(l,s,y){var q=l.getTextureMatrix();s.updateMatrix(y+"Matrix",q)},x.GetFogState=function(l,s){return s.fogEnabled&&l.applyFog&&s.fogMode!==r.a.FOGMODE_NONE},x.PrepareDefinesForMisc=function(l,s,y,q,n,k,p){p._areMiscDirty&&(p.LOGARITHMICDEPTH=y,p.POINTSIZE=q,p.FOG=n&&this.GetFogState(l,s),p.NONUNIFORMSCALING=l.nonUniformScaling,p.ALPHATEST=k)},x.PrepareDefinesForFrameBoundValues=function(l,s,y,q,n){void 0===n&&(n=null);var k,p,u,A,B,v,H=!1;k=null==n?void 0!==l.clipPlane&&null!==l.clipPlane:n,p=null==n?void 0!==l.clipPlane2&&null!==l.clipPlane2:n,u=null==n?void 0!==l.clipPlane3&&null!==l.clipPlane3:n,A=null==n?void 0!==l.clipPlane4&&null!==l.clipPlane4:n,B=null==n?void 0!==l.clipPlane5&&null!==l.clipPlane5:n,v=null==n?void 0!==l.clipPlane6&&null!==l.clipPlane6:n,y.CLIPPLANE!==k&&(y.CLIPPLANE=k,H=!0),y.CLIPPLANE2!==p&&(y.CLIPPLANE2=p,H=!0),y.CLIPPLANE3!==u&&(y.CLIPPLANE3=u,H=!0),y.CLIPPLANE4!==A&&(y.CLIPPLANE4=A,H=!0),y.CLIPPLANE5!==B&&(y.CLIPPLANE5=B,H=!0),y.CLIPPLANE6!==v&&(y.CLIPPLANE6=v,H=!0),y.DEPTHPREPASS!==!s.getColorWrite()&&(y.DEPTHPREPASS=!y.DEPTHPREPASS,H=!0),y.INSTANCES!==q&&(y.INSTANCES=q,H=!0),H&&y.markAsUnprocessed()},x.PrepareDefinesForBones=function(l,s){if(l.useBones&&l.computeBonesUsingShaders&&l.skeleton){s.NUM_BONE_INFLUENCERS=l.numBoneInfluencers;var y=void 0!==s.BONETEXTURE;l.skeleton.isUsingTextureForMatrices&&y?s.BONETEXTURE=!0:(s.BonesPerMesh=l.skeleton.bones.length+1,s.BONETEXTURE=!y&&void 0)}else s.NUM_BONE_INFLUENCERS=0,s.BonesPerMesh=0},x.PrepareDefinesForMorphTargets=function(l,s){var y=l.morphTargetManager;y?(s.MORPHTARGETS_UV=y.supportsUVs&&s.UV1,s.MORPHTARGETS_TANGENT=y.supportsTangents&&s.TANGENT,s.MORPHTARGETS_NORMAL=y.supportsNormals&&s.NORMAL,s.MORPHTARGETS=y.numInfluencers>0,s.NUM_MORPH_INFLUENCERS=y.numInfluencers):(s.MORPHTARGETS_UV=!1,s.MORPHTARGETS_TANGENT=!1,s.MORPHTARGETS_NORMAL=!1,s.MORPHTARGETS=!1,s.NUM_MORPH_INFLUENCERS=0)},x.PrepareDefinesForAttributes=function(l,s,y,q,n,k){if(void 0===n&&(n=!1),void 0===k&&(k=!0),!s._areAttributesDirty&&s._needNormals===s._normals&&s._needUVs===s._uvs)return!1;if(s._normals=s._needNormals,s._uvs=s._needUVs,s.NORMAL=s._needNormals&&l.isVerticesDataPresent(i.b.NormalKind),s._needNormals&&l.isVerticesDataPresent(i.b.TangentKind)&&(s.TANGENT=!0),s._needUVs?(s.UV1=l.isVerticesDataPresent(i.b.UVKind),s.UV2=l.isVerticesDataPresent(i.b.UV2Kind)):(s.UV1=!1,s.UV2=!1),y){var p=l.useVertexColors&&l.isVerticesDataPresent(i.b.ColorKind);s.VERTEXCOLOR=p,s.VERTEXALPHA=l.hasVertexAlpha&&p&&k}return q&&this.PrepareDefinesForBones(l,s),n&&this.PrepareDefinesForMorphTargets(l,s),!0},x.PrepareDefinesForMultiview=function(l,s){if(l.activeCamera){var y=s.MULTIVIEW;s.MULTIVIEW=null!==l.activeCamera.outputRenderTarget&&l.activeCamera.outputRenderTarget.getViewCount()>1,s.MULTIVIEW!=y&&s.markAsUnprocessed()}},x.PrepareDefinesForLight=function(l,s,y,q,n,k,p){switch(p.needNormals=!0,void 0===n["LIGHT"+q]&&(p.needRebuild=!0),n["LIGHT"+q]=!0,n["SPOTLIGHT"+q]=!1,n["HEMILIGHT"+q]=!1,n["POINTLIGHT"+q]=!1,n["DIRLIGHT"+q]=!1,y.prepareLightSpecificDefines(n,q),n["LIGHT_FALLOFF_PHYSICAL"+q]=!1,n["LIGHT_FALLOFF_GLTF"+q]=!1,n["LIGHT_FALLOFF_STANDARD"+q]=!1,y.falloffType){case G.a.FALLOFF_GLTF:n["LIGHT_FALLOFF_GLTF"+q]=!0;break;case G.a.FALLOFF_PHYSICAL:n["LIGHT_FALLOFF_PHYSICAL"+q]=!0;break;case G.a.FALLOFF_STANDARD:n["LIGHT_FALLOFF_STANDARD"+q]=!0}if(k&&!y.specular.equalsFloats(0,0,0)&&(p.specularEnabled=!0),n["SHADOW"+q]=!1,n["SHADOWCSM"+q]=!1,n["SHADOWCSMDEBUG"+q]=!1,n["SHADOWCSMNUM_CASCADES"+q]=!1,n["SHADOWCSMUSESHADOWMAXZ"+q]=!1,n["SHADOWCSMNOBLEND"+q]=!1,n["SHADOWCSM_RIGHTHANDED"+q]=!1,n["SHADOWPCF"+q]=!1,n["SHADOWPCSS"+q]=!1,n["SHADOWPOISSON"+q]=!1,n["SHADOWESM"+q]=!1,n["SHADOWCUBE"+q]=!1,n["SHADOWLOWQUALITY"+q]=!1,n["SHADOWMEDIUMQUALITY"+q]=!1,s&&s.receiveShadows&&l.shadowsEnabled&&y.shadowEnabled){var u=y.getShadowGenerator();if(u){var A=u.getShadowMap();A&&A.renderList&&A.renderList.length>0&&(p.shadowEnabled=!0,u.prepareDefines(n,q))}}y.lightmapMode!=G.a.LIGHTMAP_DEFAULT?(p.lightmapMode=!0,n["LIGHTMAPEXCLUDED"+q]=!0,n["LIGHTMAPNOSPECULAR"+q]=y.lightmapMode==G.a.LIGHTMAP_SHADOWSONLY):(n["LIGHTMAPEXCLUDED"+q]=!1,n["LIGHTMAPNOSPECULAR"+q]=!1)},x.PrepareDefinesForLights=function(l,s,y,q,n,k){if(void 0===n&&(n=4),void 0===k&&(k=!1),!y._areLightsDirty)return y._needNormals;var p=0,u={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(l.lightsEnabled&&!k)for(var A=0,B=s.lightSources;A<B.length;A++){var v=B[A];if(this.PrepareDefinesForLight(l,s,v,p,y,q,u),++p===n)break}y.SPECULARTERM=u.specularEnabled,y.SHADOWS=u.shadowEnabled;for(var H=p;H<n;H++)void 0!==y["LIGHT"+H]&&(y["LIGHT"+H]=!1,y["HEMILIGHT"+H]=!1,y["POINTLIGHT"+H]=!1,y["DIRLIGHT"+H]=!1,y["SPOTLIGHT"+H]=!1,y["SHADOW"+H]=!1,y["SHADOWCSM"+H]=!1,y["SHADOWCSMDEBUG"+H]=!1,y["SHADOWCSMNUM_CASCADES"+H]=!1,y["SHADOWCSMUSESHADOWMAXZ"+H]=!1,y["SHADOWCSMNOBLEND"+H]=!1,y["SHADOWCSM_RIGHTHANDED"+H]=!1,y["SHADOWPCF"+H]=!1,y["SHADOWPCSS"+H]=!1,y["SHADOWPOISSON"+H]=!1,y["SHADOWESM"+H]=!1,y["SHADOWCUBE"+H]=!1,y["SHADOWLOWQUALITY"+H]=!1,y["SHADOWMEDIUMQUALITY"+H]=!1);var L=l.getEngine().getCaps();return void 0===y.SHADOWFLOAT&&(u.needRebuild=!0),y.SHADOWFLOAT=u.shadowEnabled&&(L.textureFloatRender&&L.textureFloatLinearFiltering||L.textureHalfFloatRender&&L.textureHalfFloatLinearFiltering),y.LIGHTMAPEXCLUDED=u.lightmapMode,u.needRebuild&&y.rebuild(),u.needNormals},x.PrepareUniformsAndSamplersForLight=function(l,s,y,q,n){void 0===n&&(n=null),s.push("vLightData"+l,"vLightDiffuse"+l,"vLightSpecular"+l,"vLightDirection"+l,"vLightFalloff"+l,"vLightGround"+l,"lightMatrix"+l,"shadowsInfo"+l,"depthValues"+l),n&&n.push("Light"+l),y.push("shadowSampler"+l),y.push("depthSampler"+l),s.push("viewFrustumZ"+l,"cascadeBlendFactor"+l,"lightSizeUVCorrection"+l,"depthCorrection"+l,"penumbraDarkness"+l,"frustumLengths"+l),q&&(y.push("projectionLightSampler"+l),s.push("textureProjectionMatrix"+l))},x.PrepareUniformsAndSamplersList=function(l,s,y,q){var n;void 0===q&&(q=4);var k=null;if(l.uniformsNames){var p=l;n=p.uniformsNames,k=p.uniformBuffersNames,s=p.samplers,y=p.defines,q=p.maxSimultaneousLights||0}else n=l,s||(s=[]);for(var u=0;u<q&&y["LIGHT"+u];u++)this.PrepareUniformsAndSamplersForLight(u,n,s,y["PROJECTEDLIGHTTEXTURE"+u],k);y.NUM_MORPH_INFLUENCERS&&n.push("morphTargetInfluences")},x.HandleFallbacksForShadows=function(l,s,y,q){void 0===y&&(y=4),void 0===q&&(q=0);for(var n=0,k=0;k<y&&l["LIGHT"+k];k++)k>0&&(n=q+k,s.addFallback(n,"LIGHT"+k)),l.SHADOWS||(l["SHADOW"+k]&&s.addFallback(q,"SHADOW"+k),l["SHADOWPCF"+k]&&s.addFallback(q,"SHADOWPCF"+k),l["SHADOWPCSS"+k]&&s.addFallback(q,"SHADOWPCSS"+k),l["SHADOWPOISSON"+k]&&s.addFallback(q,"SHADOWPOISSON"+k),l["SHADOWESM"+k]&&s.addFallback(q,"SHADOWESM"+k));return n++},x.PrepareAttributesForMorphTargetsInfluencers=function(l,s,y){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=y,this.PrepareAttributesForMorphTargets(l,s,this._TmpMorphInfluencers)},x.PrepareAttributesForMorphTargets=function(l,s,y){var q=y.NUM_MORPH_INFLUENCERS;if(q>0&&I.a.LastCreatedEngine)for(var n=I.a.LastCreatedEngine.getCaps().maxVertexAttribs,k=s.morphTargetManager,p=k&&k.supportsNormals&&y.NORMAL,u=k&&k.supportsTangents&&y.TANGENT,A=k&&k.supportsUVs&&y.UV1,B=0;B<q;B++)l.push(i.b.PositionKind+B),p&&l.push(i.b.NormalKind+B),u&&l.push(i.b.TangentKind+B),A&&l.push(i.b.UVKind+"_"+B),l.length>n&&R.a.Error("Cannot add more vertex attributes for mesh "+s.name)},x.PrepareAttributesForBones=function(l,s,y,q){y.NUM_BONE_INFLUENCERS>0&&(q.addCPUSkinningFallback(0,s),l.push(i.b.MatricesIndicesKind),l.push(i.b.MatricesWeightsKind),y.NUM_BONE_INFLUENCERS>4&&(l.push(i.b.MatricesIndicesExtraKind),l.push(i.b.MatricesWeightsExtraKind)))},x.PrepareAttributesForInstances=function(l,s){s.INSTANCES&&this.PushAttributesForInstances(l)},x.PushAttributesForInstances=function(l){l.push("world0"),l.push("world1"),l.push("world2"),l.push("world3")},x.BindLightProperties=function(l,s,y){l.transferToEffect(s,y+"")},x.BindLight=function(l,s,y,q,n,k){void 0===k&&(k=!1),l._bindLight(s,y,q,n,k)},x.BindLights=function(l,s,y,q,n,k){void 0===n&&(n=4),void 0===k&&(k=!1);for(var p=Math.min(s.lightSources.length,n),u=0;u<p;u++){var A=s.lightSources[u];this.BindLight(A,u,l,y,"boolean"==typeof q?q:q.SPECULARTERM,k)}},x.BindFogParameters=function(l,s,y,q){void 0===q&&(q=!1),l.fogEnabled&&s.applyFog&&l.fogMode!==r.a.FOGMODE_NONE&&(y.setFloat4("vFogInfos",l.fogMode,l.fogStart,l.fogEnd,l.fogDensity),q?(l.fogColor.toLinearSpaceToRef(this._tempFogColor),y.setColor3("vFogColor",this._tempFogColor)):y.setColor3("vFogColor",l.fogColor))},x.BindBonesParameters=function(l,s){if(s&&l&&(l.computeBonesUsingShaders&&s._bonesComputationForcedToCPU&&(l.computeBonesUsingShaders=!1),l.useBones&&l.computeBonesUsingShaders&&l.skeleton)){var y=l.skeleton;if(y.isUsingTextureForMatrices&&s.getUniformIndex("boneTextureWidth")>-1){var q=y.getTransformMatrixTexture(l);s.setTexture("boneSampler",q),s.setFloat("boneTextureWidth",4*(y.bones.length+1))}else{var n=y.getTransformMatrices(l);n&&s.setMatrices("mBones",n)}}},x.BindMorphTargetParameters=function(l,s){var y=l.morphTargetManager;l&&y&&s.setFloatArray("morphTargetInfluences",y.influences)},x.BindLogDepth=function(l,s,y){l.LOGARITHMICDEPTH&&s.setFloat("logarithmicDepthConstant",2/(Math.log(y.activeCamera.maxZ+1)/Math.LN2))},x.BindClipPlane=function(l,s){if(s.clipPlane){var y=s.clipPlane;l.setFloat4("vClipPlane",y.normal.x,y.normal.y,y.normal.z,y.d)}s.clipPlane2&&(y=s.clipPlane2,l.setFloat4("vClipPlane2",y.normal.x,y.normal.y,y.normal.z,y.d)),s.clipPlane3&&(y=s.clipPlane3,l.setFloat4("vClipPlane3",y.normal.x,y.normal.y,y.normal.z,y.d)),s.clipPlane4&&(y=s.clipPlane4,l.setFloat4("vClipPlane4",y.normal.x,y.normal.y,y.normal.z,y.d)),s.clipPlane5&&(y=s.clipPlane5,l.setFloat4("vClipPlane5",y.normal.x,y.normal.y,y.normal.z,y.d)),s.clipPlane6&&(y=s.clipPlane6,l.setFloat4("vClipPlane6",y.normal.x,y.normal.y,y.normal.z,y.d))},x._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},x._tempFogColor=D.a.Black(),x}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r}),o.d(t,"b",function(){return I});var R=o(1),r=function(){function i(){}return i.NAME_EFFECTLAYER="EffectLayer",i.NAME_LAYER="Layer",i.NAME_LENSFLARESYSTEM="LensFlareSystem",i.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",i.NAME_PARTICLESYSTEM="ParticleSystem",i.NAME_GAMEPAD="Gamepad",i.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",i.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",i.NAME_DEPTHRENDERER="DepthRenderer",i.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",i.NAME_SPRITE="Sprite",i.NAME_OUTLINERENDERER="Outline",i.NAME_PROCEDURALTEXTURE="ProceduralTexture",i.NAME_SHADOWGENERATOR="ShadowGenerator",i.NAME_OCTREE="Octree",i.NAME_PHYSICSENGINE="PhysicsEngine",i.NAME_AUDIO="Audio",i.STEP_ISREADYFORMESH_EFFECTLAYER=0,i.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,i.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,i.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,i.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,i.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,i.STEP_BEFORECAMERADRAW_LAYER=1,i.STEP_BEFORERENDERTARGETDRAW_LAYER=0,i.STEP_BEFORERENDERINGMESH_OUTLINE=0,i.STEP_AFTERRENDERINGMESH_OUTLINE=0,i.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,i.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,i.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,i.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,i.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,i.STEP_AFTERRENDERTARGETDRAW_LAYER=0,i.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,i.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,i.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,i.STEP_AFTERCAMERADRAW_LAYER=3,i.STEP_AFTERRENDER_AUDIO=0,i.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,i.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,i.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,i.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,i.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,i.STEP_POINTERMOVE_SPRITE=0,i.STEP_POINTERDOWN_SPRITE=0,i.STEP_POINTERUP_SPRITE=0,i}(),I=function(i){function G(D){return i.apply(this,D)||this}return Object(R.d)(G,i),G.Create=function(){return Object.create(G.prototype)},G.prototype.registerStep=function(D,E,x){var l=0;for(Number.MAX_VALUE;l<this.length;l++)if(D<this[l].index)break;this.splice(l,0,{index:D,component:E,action:x.bind(E)})},G.prototype.clear=function(){this.length=0},G}(Array)},function(Ja,t,o){"use strict";var R=o(1),r=o(13),I=o(52),i=o(6),G=o(34),D=o(103),E=o(35),x=o(0),l=o(43),s=o(27),y=o(24),q=o(37),n=o(40),k=o(83),p=o(50),u=o(53),A=o(45),B=o(90),v=o(91),H=o(17),L=o(2),Q=o(38),M=o(7),Y=o(23),X=o(19),U=o(20),P=o(87),ga=o(63),ma=function(){function qa(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(qa.prototype,"singleClick",{get:function(){return this._singleClick},set:function(V){this._singleClick=V},enumerable:!0,configurable:!0}),Object.defineProperty(qa.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(V){this._doubleClick=V},enumerable:!0,configurable:!0}),Object.defineProperty(qa.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(V){this._hasSwiped=V},enumerable:!0,configurable:!0}),Object.defineProperty(qa.prototype,"ignore",{get:function(){return this._ignore},set:function(V){this._ignore=V},enumerable:!0,configurable:!0}),qa}(),oa=function(){function qa(V){this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new x.d(0,0),this._previousStartingPointerPosition=new x.d(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._scene=V}return Object.defineProperty(qa.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(qa.prototype,"unTranslatedPointer",{get:function(){return new x.d(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(qa.prototype,"pointerX",{get:function(){return this._pointerX},set:function(V){this._pointerX=V},enumerable:!0,configurable:!0}),Object.defineProperty(qa.prototype,"pointerY",{get:function(){return this._pointerY},set:function(V){this._pointerY=V},enumerable:!0,configurable:!0}),qa.prototype._updatePointerPosition=function(V){var O=this._scene.getEngine().getInputElementClientRect();O&&(this._pointerX=V.clientX-O.left,this._pointerY=V.clientY-O.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},qa.prototype._processPointerMove=function(V,O){var S=this._scene,W=S.getEngine(),da=W.getInputElement();if(da){da.tabIndex=W.canvasTabIndex,S.doNotHandleCursors||(da.style.cursor=S.defaultCursor);var na=!!(V&&V.hit&&V.pickedMesh);na?(S.setPointerOverMesh(V.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(S.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?da.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:da.style.cursor=S.hoverCursor))):S.setPointerOverMesh(null);for(var Ea=0,Ca=S._pointerMoveStage;Ea<Ca.length;Ea++)V=Ca[Ea].action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,na,da);if(V){var wa=O.type===this._wheelEventName?U.a.POINTERWHEEL:U.a.POINTERMOVE;if(S.onPointerMove&&S.onPointerMove(O,V,wa),S.onPointerObservable.hasObservers()){var Ka=new U.b(wa,O,V);this._setRayOnPointerInfo(Ka),S.onPointerObservable.notifyObservers(Ka,wa)}}}},qa.prototype._setRayOnPointerInfo=function(V){var O=this._scene;V.pickInfo&&!V.pickInfo._pickingUnavailable&&(V.pickInfo.ray||(V.pickInfo.ray=O.createPickingRay(V.event.offsetX,V.event.offsetY,x.a.Identity(),O.activeCamera)))},qa.prototype._checkPrePointerObservable=function(V,O,S){var W=this._scene,da=new U.d(S,O,this._unTranslatedPointerX,this._unTranslatedPointerY);return V&&(da.ray=V.ray),W.onPrePointerObservable.notifyObservers(da,S),!!da.skipOnPointerObservable},qa.prototype.simulatePointerMove=function(V,O){var S=new PointerEvent("pointermove",O);this._checkPrePointerObservable(V,S,U.a.POINTERMOVE)||this._processPointerMove(V,S)},qa.prototype.simulatePointerDown=function(V,O){var S=new PointerEvent("pointerdown",O);this._checkPrePointerObservable(V,S,U.a.POINTERDOWN)||this._processPointerDown(V,S)},qa.prototype._processPointerDown=function(V,O){var S=this,W=this._scene;if(V&&V.hit&&V.pickedMesh){this._pickedDownMesh=V.pickedMesh;var da=V.pickedMesh._getActionManagerForTrigger();if(da){if(da.hasPickTriggers)switch(da.processTrigger(L.a.ACTION_OnPickDownTrigger,A.a.CreateNew(V.pickedMesh,O)),O.button){case 0:da.processTrigger(L.a.ACTION_OnLeftPickTrigger,A.a.CreateNew(V.pickedMesh,O));break;case 1:da.processTrigger(L.a.ACTION_OnCenterPickTrigger,A.a.CreateNew(V.pickedMesh,O));break;case 2:da.processTrigger(L.a.ACTION_OnRightPickTrigger,A.a.CreateNew(V.pickedMesh,O))}da.hasSpecificTrigger(L.a.ACTION_OnLongPressTrigger)&&window.setTimeout(function(){var Ka=W.pick(S._unTranslatedPointerX,S._unTranslatedPointerY,function(Ga){return Ga.isPickable&&Ga.isVisible&&Ga.isReady()&&Ga.actionManager&&Ga.actionManager.hasSpecificTrigger(L.a.ACTION_OnLongPressTrigger)&&Ga==S._pickedDownMesh},!1,W.cameraToUseForPointers);Ka&&Ka.hit&&Ka.pickedMesh&&da&&0!==S._totalPointersPressed&&Date.now()-S._startingPointerTime>qa.LongPressDelay&&!S._isPointerSwiping()&&(S._startingPointerTime=0,da.processTrigger(L.a.ACTION_OnLongPressTrigger,A.a.CreateNew(Ka.pickedMesh,O)))},qa.LongPressDelay)}}else for(var na=0,Ea=W._pointerDownStage;na<Ea.length;na++)V=Ea[na].action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,O);if(V){var Ca=U.a.POINTERDOWN;if(W.onPointerDown&&W.onPointerDown(O,V,Ca),W.onPointerObservable.hasObservers()){var wa=new U.b(Ca,O,V);this._setRayOnPointerInfo(wa),W.onPointerObservable.notifyObservers(wa,Ca)}}},qa.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>qa.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>qa.DragMovementThreshold},qa.prototype.simulatePointerUp=function(V,O,S){var W=new PointerEvent("pointerup",O),da=new ma();S?da.doubleClick=!0:da.singleClick=!0,this._checkPrePointerObservable(V,W,U.a.POINTERUP)||this._processPointerUp(V,W,da)},qa.prototype._processPointerUp=function(V,O,S){var W=this._scene;if(V&&V&&V.pickedMesh){if(this._pickedUpMesh=V.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(W.onPointerPick&&W.onPointerPick(O,V),S.singleClick&&!S.ignore&&W.onPointerObservable.hasObservers())){var da=U.a.POINTERPICK,na=new U.b(da,O,V);this._setRayOnPointerInfo(na),W.onPointerObservable.notifyObservers(na,da)}var Ea=V.pickedMesh._getActionManagerForTrigger();if(Ea&&!S.ignore){Ea.processTrigger(L.a.ACTION_OnPickUpTrigger,A.a.CreateNew(V.pickedMesh,O)),!S.hasSwiped&&S.singleClick&&Ea.processTrigger(L.a.ACTION_OnPickTrigger,A.a.CreateNew(V.pickedMesh,O));var Ca=V.pickedMesh._getActionManagerForTrigger(L.a.ACTION_OnDoublePickTrigger);S.doubleClick&&Ca&&Ca.processTrigger(L.a.ACTION_OnDoublePickTrigger,A.a.CreateNew(V.pickedMesh,O))}}else if(!S.ignore)for(var wa=0,Ka=W._pointerUpStage;wa<Ka.length;wa++)V=Ka[wa].action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,O);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var Ga=this._pickedDownMesh._getActionManagerForTrigger(L.a.ACTION_OnPickOutTrigger);Ga&&Ga.processTrigger(L.a.ACTION_OnPickOutTrigger,A.a.CreateNew(this._pickedDownMesh,O))}var Ba=0;W.onPointerObservable.hasObservers()&&(!S.ignore&&!S.hasSwiped&&(S.singleClick&&W.onPointerObservable.hasSpecificMask(U.a.POINTERTAP)?Ba=U.a.POINTERTAP:S.doubleClick&&W.onPointerObservable.hasSpecificMask(U.a.POINTERDOUBLETAP)&&(Ba=U.a.POINTERDOUBLETAP),Ba)&&(na=new U.b(Ba,O,V),this._setRayOnPointerInfo(na),W.onPointerObservable.notifyObservers(na,Ba)),S.ignore||(Ba=U.a.POINTERUP,na=new U.b(Ba,O,V),this._setRayOnPointerInfo(na),W.onPointerObservable.notifyObservers(na,Ba))),W.onPointerUp&&!S.ignore&&W.onPointerUp(O,V,Ba)},qa.prototype.isPointerCaptured=function(V){return void 0===V&&(V=0),this._pointerCaptures[V]},qa.prototype.attachControl=function(V,O,S,W){var da=this;void 0===V&&(V=!0),void 0===O&&(O=!0),void 0===S&&(S=!0),void 0===W&&(W=null);var na=this._scene;if(W||(W=na.getEngine().getInputElement()),W){var Ea,Ca=na.getEngine();this._initActionManager=function(Ga,Ba){if(!da._meshPickProceed){var Na=na.pick(da._unTranslatedPointerX,da._unTranslatedPointerY,na.pointerDownPredicate,!1,na.cameraToUseForPointers);da._currentPickResult=Na,Na&&(Ga=Na.hit&&Na.pickedMesh?Na.pickedMesh._getActionManagerForTrigger():null),da._meshPickProceed=!0}return Ga},this._delayedSimpleClick=function(Ga,Ba,Na){(Date.now()-da._previousStartingPointerTime>qa.DoubleClickDelay&&!da._doubleClickOccured||Ga!==da._previousButtonPressed)&&(da._doubleClickOccured=!1,Ba.singleClick=!0,Ba.ignore=!1,Na(Ba,da._currentPickResult))},this._initClickEvent=function(Ga,Ba,Na,db){var eb=new ma();da._currentPickResult=null;var Ya=null,Sa=Ga.hasSpecificMask(U.a.POINTERPICK)||Ba.hasSpecificMask(U.a.POINTERPICK)||Ga.hasSpecificMask(U.a.POINTERTAP)||Ba.hasSpecificMask(U.a.POINTERTAP)||Ga.hasSpecificMask(U.a.POINTERDOUBLETAP)||Ba.hasSpecificMask(U.a.POINTERDOUBLETAP);!Sa&&P.a&&(Ya=da._initActionManager(Ya,eb))&&(Sa=Ya.hasPickTriggers);var sb=!1;if(Sa){var kb=Na.button;if(eb.hasSwiped=da._isPointerSwiping(),!eb.hasSwiped){var wb=!qa.ExclusiveDoubleClickMode;wb||(wb=!Ga.hasSpecificMask(U.a.POINTERDOUBLETAP)&&!Ba.hasSpecificMask(U.a.POINTERDOUBLETAP))&&!P.a.HasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)&&(Ya=da._initActionManager(Ya,eb))&&(wb=!Ya.hasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)),wb?(Date.now()-da._previousStartingPointerTime>qa.DoubleClickDelay||kb!==da._previousButtonPressed)&&(eb.singleClick=!0,db(eb,da._currentPickResult),sb=!0):(da._previousDelayedSimpleClickTimeout=da._delayedSimpleClickTimeout,da._delayedSimpleClickTimeout=window.setTimeout(da._delayedSimpleClick.bind(da,kb,eb,db),qa.DoubleClickDelay));var tb=Ga.hasSpecificMask(U.a.POINTERDOUBLETAP)||Ba.hasSpecificMask(U.a.POINTERDOUBLETAP);!tb&&P.a.HasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)&&(Ya=da._initActionManager(Ya,eb))&&(tb=Ya.hasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)),tb&&(kb===da._previousButtonPressed&&Date.now()-da._previousStartingPointerTime<qa.DoubleClickDelay&&!da._doubleClickOccured?(eb.hasSwiped||da._isPointerSwiping()?(da._doubleClickOccured=!1,da._previousStartingPointerTime=da._startingPointerTime,da._previousStartingPointerPosition.x=da._startingPointerPosition.x,da._previousStartingPointerPosition.y=da._startingPointerPosition.y,da._previousButtonPressed=kb,qa.ExclusiveDoubleClickMode?(da._previousDelayedSimpleClickTimeout&&clearTimeout(da._previousDelayedSimpleClickTimeout),da._previousDelayedSimpleClickTimeout=da._delayedSimpleClickTimeout,db(eb,da._previousPickResult)):db(eb,da._currentPickResult)):(da._previousStartingPointerTime=0,da._doubleClickOccured=!0,eb.doubleClick=!0,eb.ignore=!1,qa.ExclusiveDoubleClickMode&&da._previousDelayedSimpleClickTimeout&&clearTimeout(da._previousDelayedSimpleClickTimeout),da._previousDelayedSimpleClickTimeout=da._delayedSimpleClickTimeout,db(eb,da._currentPickResult)),sb=!0):(da._doubleClickOccured=!1,da._previousStartingPointerTime=da._startingPointerTime,da._previousStartingPointerPosition.x=da._startingPointerPosition.x,da._previousStartingPointerPosition.y=da._startingPointerPosition.y,da._previousButtonPressed=kb))}}sb||db(eb,da._currentPickResult)},this._onPointerMove=function(Ga){if(da._updatePointerPosition(Ga),!da._checkPrePointerObservable(null,Ga,Ga.type===da._wheelEventName?U.a.POINTERWHEEL:U.a.POINTERMOVE)&&(na.cameraToUseForPointers||na.activeCamera)){na.pointerMovePredicate||(na.pointerMovePredicate=function(Na){return Na.isPickable&&Na.isVisible&&Na.isReady()&&Na.isEnabled()&&(Na.enablePointerMoveEvents||na.constantlyUpdateMeshUnderPointer||null!=Na._getActionManagerForTrigger())&&(!na.cameraToUseForPointers||0!=(na.cameraToUseForPointers.layerMask&Na.layerMask))});var Ba=na.pick(da._unTranslatedPointerX,da._unTranslatedPointerY,na.pointerMovePredicate,!1,na.cameraToUseForPointers);da._processPointerMove(Ba,Ga)}},this._onPointerDown=function(Ga){if(da._totalPointersPressed++,da._pickedDownMesh=null,da._meshPickProceed=!1,da._updatePointerPosition(Ga),na.preventDefaultOnPointerDown&&W&&(Ga.preventDefault(),W.focus()),da._startingPointerPosition.x=da._pointerX,da._startingPointerPosition.y=da._pointerY,da._startingPointerTime=Date.now(),!da._checkPrePointerObservable(null,Ga,U.a.POINTERDOWN)&&(na.cameraToUseForPointers||na.activeCamera)){da._pointerCaptures[Ga.pointerId]=!0,na.pointerDownPredicate||(na.pointerDownPredicate=function(Na){return Na.isPickable&&Na.isVisible&&Na.isReady()&&Na.isEnabled()&&(!na.cameraToUseForPointers||0!=(na.cameraToUseForPointers.layerMask&Na.layerMask))}),da._pickedDownMesh=null;var Ba=na.pick(da._unTranslatedPointerX,da._unTranslatedPointerY,na.pointerDownPredicate,!1,na.cameraToUseForPointers);da._processPointerDown(Ba,Ga)}},this._onPointerUp=function(Ga){0!==da._totalPointersPressed&&(da._totalPointersPressed--,da._pickedUpMesh=null,da._meshPickProceed=!1,da._updatePointerPosition(Ga),na.preventDefaultOnPointerUp&&W&&(Ga.preventDefault(),W.focus()),da._initClickEvent(na.onPrePointerObservable,na.onPointerObservable,Ga,function(Ba,Na){if(na.onPrePointerObservable.hasObservers()&&!Ba.ignore){if(!Ba.hasSwiped){if(Ba.singleClick&&na.onPrePointerObservable.hasSpecificMask(U.a.POINTERTAP)&&da._checkPrePointerObservable(null,Ga,U.a.POINTERTAP))return;if(Ba.doubleClick&&na.onPrePointerObservable.hasSpecificMask(U.a.POINTERDOUBLETAP)&&da._checkPrePointerObservable(null,Ga,U.a.POINTERDOUBLETAP))return}if(da._checkPrePointerObservable(null,Ga,U.a.POINTERUP))return}da._pointerCaptures[Ga.pointerId]&&(da._pointerCaptures[Ga.pointerId]=!1,(na.cameraToUseForPointers||na.activeCamera)&&(na.pointerUpPredicate||(na.pointerUpPredicate=function(db){return db.isPickable&&db.isVisible&&db.isReady()&&db.isEnabled()&&(!na.cameraToUseForPointers||0!=(na.cameraToUseForPointers.layerMask&db.layerMask))}),!da._meshPickProceed&&(P.a&&P.a.HasTriggers||na.onPointerObservable.hasObservers())&&da._initActionManager(null,Ba),Na||(Na=da._currentPickResult),da._processPointerUp(Na,Ga,Ba),da._previousPickResult=da._currentPickResult))}))},this._onKeyDown=function(Ga){var Ba=ga.a.KEYDOWN;if(na.onPreKeyboardObservable.hasObservers()){var Na=new ga.c(Ba,Ga);if(na.onPreKeyboardObservable.notifyObservers(Na,Ba),Na.skipOnPointerObservable)return}na.onKeyboardObservable.hasObservers()&&(Na=new ga.b(Ba,Ga),na.onKeyboardObservable.notifyObservers(Na,Ba)),na.actionManager&&na.actionManager.processTrigger(L.a.ACTION_OnKeyDownTrigger,A.a.CreateNewFromScene(na,Ga))},this._onKeyUp=function(Ga){var Ba=ga.a.KEYUP;if(na.onPreKeyboardObservable.hasObservers()){var Na=new ga.c(Ba,Ga);if(na.onPreKeyboardObservable.notifyObservers(Na,Ba),Na.skipOnPointerObservable)return}na.onKeyboardObservable.hasObservers()&&(Na=new ga.b(Ba,Ga),na.onKeyboardObservable.notifyObservers(Na,Ba)),na.actionManager&&na.actionManager.processTrigger(L.a.ACTION_OnKeyUpTrigger,A.a.CreateNewFromScene(na,Ga))},this._onCanvasFocusObserver=Ca.onCanvasFocusObservable.add((Ea=function(){W&&(W.addEventListener("keydown",da._onKeyDown,!1),W.addEventListener("keyup",da._onKeyUp,!1))},document.activeElement===W&&Ea(),Ea)),this._onCanvasBlurObserver=Ca.onCanvasBlurObservable.add(function(){W&&(W.removeEventListener("keydown",da._onKeyDown),W.removeEventListener("keyup",da._onKeyUp))});var wa=r.b.GetPointerPrefix();if(S&&(W.addEventListener(wa+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",W.addEventListener(this._wheelEventName,this._onPointerMove,!1)),O&&W.addEventListener(wa+"down",this._onPointerDown,!1),V){var Ka=na.getEngine().getHostWindow();Ka&&Ka.addEventListener(wa+"up",this._onPointerUp,!1)}}},qa.prototype.detachControl=function(){var V=r.b.GetPointerPrefix(),O=this._scene.getEngine().getInputElement(),S=this._scene.getEngine();O&&(O.removeEventListener(V+"move",this._onPointerMove),O.removeEventListener(this._wheelEventName,this._onPointerMove),O.removeEventListener(V+"down",this._onPointerDown),window.removeEventListener(V+"up",this._onPointerUp),this._onCanvasBlurObserver&&S.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&S.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),O.removeEventListener("keydown",this._onKeyDown),O.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(O.style.cursor=this._scene.defaultCursor))},qa.prototype.setPointerOverMesh=function(V){var O;this._pointerOverMesh!==V&&(this._pointerOverMesh&&(O=this._pointerOverMesh._getActionManagerForTrigger(L.a.ACTION_OnPointerOutTrigger))&&O.processTrigger(L.a.ACTION_OnPointerOutTrigger,A.a.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=V,this._pointerOverMesh&&(O=this._pointerOverMesh._getActionManagerForTrigger(L.a.ACTION_OnPointerOverTrigger))&&O.processTrigger(L.a.ACTION_OnPointerOverTrigger,A.a.CreateNew(this._pointerOverMesh)))},qa.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},qa.DragMovementThreshold=10,qa.LongPressDelay=500,qa.DoubleClickDelay=300,qa.ExclusiveDoubleClickMode=!1,qa}(),ja=o(51),aa=o(10),F=o(86),$=o(138),ia=o(54);o.d(t,"a",function(){return ba});var ba=function(qa){function V(O,S){var W=qa.call(this)||this;W._inputManager=new oa(W),W.cameraToUseForPointers=null,W._isScene=!0,W._blockEntityCollection=!1,W.autoClear=!0,W.autoClearDepthAndStencil=!0,W.clearColor=new aa.b(.2,.2,.3,1),W.ambientColor=new aa.a(0,0,0),W._environmentIntensity=1,W._forceWireframe=!1,W._skipFrustumClipping=!1,W._forcePointsCloud=!1,W.animationsEnabled=!0,W._animationPropertiesOverride=null,W.useConstantAnimationDeltaTime=!1,W.constantlyUpdateMeshUnderPointer=!1,W.hoverCursor="pointer",W.defaultCursor="",W.doNotHandleCursors=!1,W.preventDefaultOnPointerDown=!0,W.preventDefaultOnPointerUp=!0,W.metadata=null,W.reservedDataStore=null,W.disableOfflineSupportExceptionRules=new Array(),W.onDisposeObservable=new i.c(),W._onDisposeObserver=null,W.onBeforeRenderObservable=new i.c(),W._onBeforeRenderObserver=null,W.onAfterRenderObservable=new i.c(),W.onAfterRenderCameraObservable=new i.c(),W._onAfterRenderObserver=null,W.onBeforeAnimationsObservable=new i.c(),W.onAfterAnimationsObservable=new i.c(),W.onBeforeDrawPhaseObservable=new i.c(),W.onAfterDrawPhaseObservable=new i.c(),W.onReadyObservable=new i.c(),W.onBeforeCameraRenderObservable=new i.c(),W._onBeforeCameraRenderObserver=null,W.onAfterCameraRenderObservable=new i.c(),W._onAfterCameraRenderObserver=null,W.onBeforeActiveMeshesEvaluationObservable=new i.c(),W.onAfterActiveMeshesEvaluationObservable=new i.c(),W.onBeforeParticlesRenderingObservable=new i.c(),W.onAfterParticlesRenderingObservable=new i.c(),W.onDataLoadedObservable=new i.c(),W.onNewCameraAddedObservable=new i.c(),W.onCameraRemovedObservable=new i.c(),W.onNewLightAddedObservable=new i.c(),W.onLightRemovedObservable=new i.c(),W.onNewGeometryAddedObservable=new i.c(),W.onGeometryRemovedObservable=new i.c(),W.onNewTransformNodeAddedObservable=new i.c(),W.onTransformNodeRemovedObservable=new i.c(),W.onNewMeshAddedObservable=new i.c(),W.onMeshRemovedObservable=new i.c(),W.onNewSkeletonAddedObservable=new i.c(),W.onSkeletonRemovedObservable=new i.c(),W.onNewMaterialAddedObservable=new i.c(),W.onMaterialRemovedObservable=new i.c(),W.onNewTextureAddedObservable=new i.c(),W.onTextureRemovedObservable=new i.c(),W.onBeforeRenderTargetsRenderObservable=new i.c(),W.onAfterRenderTargetsRenderObservable=new i.c(),W.onBeforeStepObservable=new i.c(),W.onAfterStepObservable=new i.c(),W.onActiveCameraChanged=new i.c(),W.onBeforeRenderingGroupObservable=new i.c(),W.onAfterRenderingGroupObservable=new i.c(),W.onMeshImportedObservable=new i.c(),W.onAnimationFileImportedObservable=new i.c(),W._registeredForLateAnimationBindings=new G.b(256),W.onPrePointerObservable=new i.c(),W.onPointerObservable=new i.c(),W.onPreKeyboardObservable=new i.c(),W.onKeyboardObservable=new i.c(),W._useRightHandedSystem=!1,W._timeAccumulator=0,W._currentStepId=0,W._currentInternalStep=0,W._fogEnabled=!0,W._fogMode=V.FOGMODE_NONE,W.fogColor=new aa.a(.2,.2,.3),W.fogDensity=.1,W.fogStart=0,W.fogEnd=1000,W._shadowsEnabled=!0,W._lightsEnabled=!0,W.activeCameras=new Array(),W._texturesEnabled=!0,W.particlesEnabled=!0,W.spritesEnabled=!0,W._skeletonsEnabled=!0,W.lensFlaresEnabled=!0,W.collisionsEnabled=!0,W.gravity=new x.e(0,-9.807,0),W.postProcessesEnabled=!0,W.postProcesses=new Array(),W.renderTargetsEnabled=!0,W.dumpNextRenderTargets=!1,W.customRenderTargets=new Array(),W.importedMeshesFiles=new Array(),W.probesEnabled=!0,W._meshesForIntersections=new G.b(256),W.proceduralTexturesEnabled=!0,W._totalVertices=new ja.a(),W._activeIndices=new ja.a(),W._activeParticles=new ja.a(),W._activeBones=new ja.a(),W._animationTime=0,W.animationTimeScale=1,W._renderId=0,W._frameId=0,W._executeWhenReadyTimeoutId=-1,W._intermediateRendering=!1,W._viewUpdateFlag=-1,W._projectionUpdateFlag=-1,W._toBeDisposed=new Array(256),W._activeRequests=new Array(),W._pendingData=new Array(),W._isDisposed=!1,W.dispatchAllSubMeshesOfActiveMeshes=!1,W._activeMeshes=new G.a(256),W._processedMaterials=new G.a(256),W._renderTargets=new G.b(256),W._activeParticleSystems=new G.a(256),W._activeSkeletons=new G.b(32),W._softwareSkinnedMeshes=new G.b(32),W._activeAnimatables=new Array(),W._transformMatrix=x.a.Zero(),W.requireLightSorting=!1,W._components=[],W._serializableComponents=[],W._transientComponents=[],W._beforeCameraUpdateStage=H.b.Create(),W._beforeClearStage=H.b.Create(),W._gatherRenderTargetsStage=H.b.Create(),W._gatherActiveCameraRenderTargetsStage=H.b.Create(),W._isReadyForMeshStage=H.b.Create(),W._beforeEvaluateActiveMeshStage=H.b.Create(),W._evaluateSubMeshStage=H.b.Create(),W._activeMeshStage=H.b.Create(),W._cameraDrawRenderTargetStage=H.b.Create(),W._beforeCameraDrawStage=H.b.Create(),W._beforeRenderTargetDrawStage=H.b.Create(),W._beforeRenderingGroupDrawStage=H.b.Create(),W._beforeRenderingMeshStage=H.b.Create(),W._afterRenderingMeshStage=H.b.Create(),W._afterRenderingGroupDrawStage=H.b.Create(),W._afterCameraDrawStage=H.b.Create(),W._afterRenderTargetDrawStage=H.b.Create(),W._afterRenderStage=H.b.Create(),W._pointerMoveStage=H.b.Create(),W._pointerDownStage=H.b.Create(),W._pointerUpStage=H.b.Create(),W.geometriesByUniqueId=null,W._defaultMeshCandidates={data:[],length:0},W._defaultSubMeshCandidates={data:[],length:0},W._preventFreeActiveMeshesAndRenderingGroups=!1,W._activeMeshesFrozen=!1,W._skipEvaluateActiveMeshesCompletely=!1,W._allowPostProcessClearColor=!0,W.getDeterministicFrameTime=function(){return W._engine.getTimeStep()},W._blockMaterialDirtyMechanism=!1;var da=Object(R.a)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},S);return W._engine=O||Y.a.LastCreatedEngine,da.virtual||(Y.a._LastCreatedScene=W,W._engine.scenes.push(W)),W._uid=null,W._renderingManager=new v.b(W),B.a&&(W.postProcessManager=new B.a(W)),Q.a.IsWindowObjectExist()&&W.attachControl(),W._createUbo(),n.a&&(W._imageProcessingConfiguration=new n.a()),W.setDefaultCandidateProviders(),da.useGeometryUniqueIdsMap&&(W.geometriesByUniqueId={}),W.useMaterialMeshMap=da.useMaterialMeshMap,W.useClonedMeshMap=da.useClonedMeshMap,S&&S.virtual||W._engine.onNewSceneAddedObservable.notifyObservers(W),W}return Object(R.d)(V,qa),V.DefaultMaterialFactory=function(O){throw X.a.WarnImport("StandardMaterial")},V.CollisionCoordinatorFactory=function(){throw X.a.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(V.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(O){this._environmentTexture!==O&&(this._environmentTexture=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(O){this._environmentIntensity!==O&&(this._environmentIntensity=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(O){this._forceWireframe!==O&&(this._forceWireframe=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(O){this._skipFrustumClipping!==O&&(this._skipFrustumClipping=O)},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(O){this._forcePointsCloud!==O&&(this._forcePointsCloud=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(O){this._animationPropertiesOverride=O},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"onDispose",{set:function(O){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(O)},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"beforeRender",{set:function(O){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),O&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(O))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"afterRender",{set:function(O){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),O&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(O))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"beforeCameraRender",{set:function(O){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(O)},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"afterCameraRender",{set:function(O){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(O)},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!0,configurable:!0}),Object.defineProperty(V,"DragMovementThreshold",{get:function(){return oa.DragMovementThreshold},set:function(O){oa.DragMovementThreshold=O},enumerable:!0,configurable:!0}),Object.defineProperty(V,"LongPressDelay",{get:function(){return oa.LongPressDelay},set:function(O){oa.LongPressDelay=O},enumerable:!0,configurable:!0}),Object.defineProperty(V,"DoubleClickDelay",{get:function(){return oa.DoubleClickDelay},set:function(O){oa.DoubleClickDelay=O},enumerable:!0,configurable:!0}),Object.defineProperty(V,"ExclusiveDoubleClickMode",{get:function(){return oa.ExclusiveDoubleClickMode},set:function(O){oa.ExclusiveDoubleClickMode=O},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(O){this._useRightHandedSystem!==O&&(this._useRightHandedSystem=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),V.prototype.setStepId=function(O){this._currentStepId=O},V.prototype.getStepId=function(){return this._currentStepId},V.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(V.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(O){this._fogEnabled!==O&&(this._fogEnabled=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"fogMode",{get:function(){return this._fogMode},set:function(O){this._fogMode!==O&&(this._fogMode=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(O){this._shadowsEnabled!==O&&(this._shadowsEnabled=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(O){this._lightsEnabled!==O&&(this._lightsEnabled=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(O){O!==this._activeCamera&&(this._activeCamera=O,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=V.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(O){this._defaultMaterial=O},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(O){this._texturesEnabled!==O&&(this._texturesEnabled=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(O){this._skeletonsEnabled!==O&&(this._skeletonsEnabled=O,this.markAllMaterialsAsDirty(L.a.MATERIAL_AttributesDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=V.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),V.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var O=0,S=this._transientComponents;O<S.length;O++)S[O].register();this._transientComponents=[]}},V.prototype._addComponent=function(O){this._components.push(O),this._transientComponents.push(O);var S=O;S.addFromContainer&&S.serialize&&this._serializableComponents.push(S)},V.prototype._getComponent=function(O){for(var S=0,W=this._components;S<W.length;S++){var da=W[S];if(da.name===O)return da}return null},V.prototype.getClassName=function(){return"Scene"},V.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},V.prototype._getDefaultSubMeshCandidates=function(O){return this._defaultSubMeshCandidates.data=O.subMeshes,this._defaultSubMeshCandidates.length=O.subMeshes.length,this._defaultSubMeshCandidates},V.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(V.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(O){this._inputManager.pointerX=O},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(O){this._inputManager.pointerY=O},enumerable:!0,configurable:!0}),V.prototype.getCachedMaterial=function(){return this._cachedMaterial},V.prototype.getCachedEffect=function(){return this._cachedEffect},V.prototype.getCachedVisibility=function(){return this._cachedVisibility},V.prototype.isCachedMaterialInvalid=function(O,S,W){return void 0===W&&(W=1),this._cachedEffect!==S||this._cachedMaterial!==O||this._cachedVisibility!==W},V.prototype.getEngine=function(){return this._engine},V.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(V.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),V.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(V.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),V.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(V.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),V.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(V.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),V.prototype.getActiveMeshes=function(){return this._activeMeshes},V.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},V.prototype.getRenderId=function(){return this._renderId},V.prototype.getFrameId=function(){return this._frameId},V.prototype.incrementRenderId=function(){this._renderId++},V.prototype._createUbo=function(){this._sceneUbo=new k.a(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},V.prototype.simulatePointerMove=function(O,S){return this._inputManager.simulatePointerMove(O,S),this},V.prototype.simulatePointerDown=function(O,S){return this._inputManager.simulatePointerDown(O,S),this},V.prototype.simulatePointerUp=function(O,S,W){return this._inputManager.simulatePointerUp(O,S,W),this},V.prototype.isPointerCaptured=function(O){return void 0===O&&(O=0),this._inputManager.isPointerCaptured(O)},V.prototype.attachControl=function(O,S,W){void 0===O&&(O=!0),void 0===S&&(S=!0),void 0===W&&(W=!0),this._inputManager.attachControl(O,S,W)},V.prototype.detachControl=function(){this._inputManager.detachControl()},V.prototype.isReady=function(){if(this._isDisposed)return!1;var O,S=this.getEngine();if(!S.areAllEffectsReady())return!1;if(this._pendingData.length>0)return!1;for(O=0;O<this.meshes.length;O++){var W=this.meshes[O];if(W.isEnabled()&&(W.subMeshes&&0!==W.subMeshes.length)){if(!W.isReady(!0))return!1;for(var da="InstancedMesh"===W.getClassName()||"InstancedLinesMesh"===W.getClassName()||S.getCaps().instancedArrays&&W.instances.length>0,na=0,Ea=this._isReadyForMeshStage;na<Ea.length;na++)if(!Ea[na].action(W,da))return!1}}for(O=0;O<this.geometries.length;O++)if(this.geometries[O].delayLoadState===L.a.DELAYLOADSTATE_LOADING)return!1;if(this.activeCameras&&this.activeCameras.length>0){for(var Ca=0,wa=this.activeCameras;Ca<wa.length;Ca++)if(!wa[Ca].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var Ka=0,Ga=this.particleSystems;Ka<Ga.length;Ka++)if(!Ga[Ka].isReady())return!1;return!0},V.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},V.prototype.registerBeforeRender=function(O){this.onBeforeRenderObservable.add(O)},V.prototype.unregisterBeforeRender=function(O){this.onBeforeRenderObservable.removeCallback(O)},V.prototype.registerAfterRender=function(O){this.onAfterRenderObservable.add(O)},V.prototype.unregisterAfterRender=function(O){this.onAfterRenderObservable.removeCallback(O)},V.prototype._executeOnceBeforeRender=function(O){var S=this,W=function(){O(),setTimeout(function(){S.unregisterBeforeRender(W)})};this.registerBeforeRender(W)},V.prototype.executeOnceBeforeRender=function(O,S){var W=this;void 0!==S?setTimeout(function(){W._executeOnceBeforeRender(O)},S):this._executeOnceBeforeRender(O)},V.prototype._addPendingData=function(O){this._pendingData.push(O)},V.prototype._removePendingData=function(O){var S=this.isLoading,W=this._pendingData.indexOf(O);-1!==W&&this._pendingData.splice(W,1),S&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},V.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(V.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),V.prototype.executeWhenReady=function(O){var S=this;this.onReadyObservable.add(O),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){S._checkIsReady()},150))},V.prototype.whenReadyAsync=function(){var O=this;return new Promise(function(S){O.executeWhenReady(function(){S()})})},V.prototype._checkIsReady=function(){var O=this;return this._registerTransientComponents(),this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){O._checkIsReady()},150))},Object.defineProperty(V.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),V.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=I.a.Now},V.prototype.getViewMatrix=function(){return this._viewMatrix},V.prototype.getProjectionMatrix=function(){return this._projectionMatrix},V.prototype.getTransformMatrix=function(){return this._transformMatrix},V.prototype.setTransformMatrix=function(O,S,W,da){this._viewUpdateFlag===O.updateFlag&&this._projectionUpdateFlag===S.updateFlag||(this._viewUpdateFlag=O.updateFlag,this._projectionUpdateFlag=S.updateFlag,this._viewMatrix=O,this._projectionMatrix=S,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?F.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=F.a.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(W,da):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},V.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},V.prototype.getUniqueId=function(){return $.a.UniqueId},V.prototype.addMesh=function(O,S){var W=this;void 0===S&&(S=!1),this._blockEntityCollection||(this.meshes.push(O),O._resyncLightSources(),O.parent||O._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(O),S&&O.getChildMeshes().forEach(function(da){W.addMesh(da)}))},V.prototype.removeMesh=function(O,S){var W=this;void 0===S&&(S=!1);var da=this.meshes.indexOf(O);return-1!==da&&(this.meshes[da]=this.meshes[this.meshes.length-1],this.meshes.pop(),O.parent||O._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(O),S&&O.getChildMeshes().forEach(function(na){W.removeMesh(na)}),da},V.prototype.addTransformNode=function(O){this._blockEntityCollection||(O._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(O),O.parent||O._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(O))},V.prototype.removeTransformNode=function(O){var S=O._indexInSceneTransformNodesArray;if(-1!==S){if(S!==this.transformNodes.length-1){var W=this.transformNodes[this.transformNodes.length-1];this.transformNodes[S]=W,W._indexInSceneTransformNodesArray=S}O._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),O.parent||O._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(O),S},V.prototype.removeSkeleton=function(O){var S=this.skeletons.indexOf(O);return-1!==S&&(this.skeletons.splice(S,1),this.onSkeletonRemovedObservable.notifyObservers(O)),S},V.prototype.removeMorphTargetManager=function(O){var S=this.morphTargetManagers.indexOf(O);return-1!==S&&this.morphTargetManagers.splice(S,1),S},V.prototype.removeLight=function(O){var S=this.lights.indexOf(O);if(-1!==S){for(var W=0,da=this.meshes;W<da.length;W++)da[W]._removeLightSource(O,!1);this.lights.splice(S,1),this.sortLightsByPriority(),O.parent||O._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(O),S},V.prototype.removeCamera=function(O){var S=this.cameras.indexOf(O);-1!==S&&(this.cameras.splice(S,1),O.parent||O._removeFromSceneRootNodes());var W=this.activeCameras.indexOf(O);return-1!==W&&this.activeCameras.splice(W,1),this.activeCamera===O&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(O),S},V.prototype.removeParticleSystem=function(O){var S=this.particleSystems.indexOf(O);return-1!==S&&this.particleSystems.splice(S,1),S},V.prototype.removeAnimation=function(O){var S=this.animations.indexOf(O);return-1!==S&&this.animations.splice(S,1),S},V.prototype.stopAnimation=function(O,S,W){},V.prototype.removeAnimationGroup=function(O){var S=this.animationGroups.indexOf(O);return-1!==S&&this.animationGroups.splice(S,1),S},V.prototype.removeMultiMaterial=function(O){var S=this.multiMaterials.indexOf(O);return-1!==S&&this.multiMaterials.splice(S,1),S},V.prototype.removeMaterial=function(O){var S=O._indexInSceneMaterialArray;if(-1!==S&&S<this.materials.length){if(S!==this.materials.length-1){var W=this.materials[this.materials.length-1];this.materials[S]=W,W._indexInSceneMaterialArray=S}O._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(O),S},V.prototype.removeActionManager=function(O){var S=this.actionManagers.indexOf(O);return-1!==S&&this.actionManagers.splice(S,1),S},V.prototype.removeTexture=function(O){var S=this.textures.indexOf(O);return-1!==S&&this.textures.splice(S,1),this.onTextureRemovedObservable.notifyObservers(O),S},V.prototype.addLight=function(O){if(!this._blockEntityCollection){this.lights.push(O),this.sortLightsByPriority(),O.parent||O._addToSceneRootNodes();for(var S=0,W=this.meshes;S<W.length;S++){var da=W[S];-1===da.lightSources.indexOf(O)&&(da.lightSources.push(O),da._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(O)}},V.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(p.a.CompareLightsPriority)},V.prototype.addCamera=function(O){this._blockEntityCollection||(this.cameras.push(O),this.onNewCameraAddedObservable.notifyObservers(O),O.parent||O._addToSceneRootNodes())},V.prototype.addSkeleton=function(O){this._blockEntityCollection||(this.skeletons.push(O),this.onNewSkeletonAddedObservable.notifyObservers(O))},V.prototype.addParticleSystem=function(O){this._blockEntityCollection||this.particleSystems.push(O)},V.prototype.addAnimation=function(O){this._blockEntityCollection||this.animations.push(O)},V.prototype.addAnimationGroup=function(O){this._blockEntityCollection||this.animationGroups.push(O)},V.prototype.addMultiMaterial=function(O){this._blockEntityCollection||this.multiMaterials.push(O)},V.prototype.addMaterial=function(O){this._blockEntityCollection||(O._indexInSceneMaterialArray=this.materials.length,this.materials.push(O),this.onNewMaterialAddedObservable.notifyObservers(O))},V.prototype.addMorphTargetManager=function(O){this._blockEntityCollection||this.morphTargetManagers.push(O)},V.prototype.addGeometry=function(O){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[O.uniqueId]=this.geometries.length),this.geometries.push(O))},V.prototype.addActionManager=function(O){this.actionManagers.push(O)},V.prototype.addTexture=function(O){this._blockEntityCollection||(this.textures.push(O),this.onNewTextureAddedObservable.notifyObservers(O))},V.prototype.switchActiveCamera=function(O,S){void 0===S&&(S=!0);var W=this._engine.getInputElement();W&&(this.activeCamera&&this.activeCamera.detachControl(W),this.activeCamera=O,S&&O.attachControl(W))},V.prototype.setActiveCameraByID=function(O){var S=this.getCameraByID(O);return S?(this.activeCamera=S,S):null},V.prototype.setActiveCameraByName=function(O){var S=this.getCameraByName(O);return S?(this.activeCamera=S,S):null},V.prototype.getAnimationGroupByName=function(O){for(var S=0;S<this.animationGroups.length;S++)if(this.animationGroups[S].name===O)return this.animationGroups[S];return null},V.prototype.getMaterialByUniqueID=function(O){for(var S=0;S<this.materials.length;S++)if(this.materials[S].uniqueId===O)return this.materials[S];return null},V.prototype.getMaterialByID=function(O){for(var S=0;S<this.materials.length;S++)if(this.materials[S].id===O)return this.materials[S];return null},V.prototype.getLastMaterialByID=function(O){for(var S=this.materials.length-1;S>=0;S--)if(this.materials[S].id===O)return this.materials[S];return null},V.prototype.getMaterialByName=function(O){for(var S=0;S<this.materials.length;S++)if(this.materials[S].name===O)return this.materials[S];return null},V.prototype.getTextureByUniqueID=function(O){for(var S=0;S<this.textures.length;S++)if(this.textures[S].uniqueId===O)return this.textures[S];return null},V.prototype.getCameraByID=function(O){for(var S=0;S<this.cameras.length;S++)if(this.cameras[S].id===O)return this.cameras[S];return null},V.prototype.getCameraByUniqueID=function(O){for(var S=0;S<this.cameras.length;S++)if(this.cameras[S].uniqueId===O)return this.cameras[S];return null},V.prototype.getCameraByName=function(O){for(var S=0;S<this.cameras.length;S++)if(this.cameras[S].name===O)return this.cameras[S];return null},V.prototype.getBoneByID=function(O){for(var S=0;S<this.skeletons.length;S++)for(var W=this.skeletons[S],da=0;da<W.bones.length;da++)if(W.bones[da].id===O)return W.bones[da];return null},V.prototype.getBoneByName=function(O){for(var S=0;S<this.skeletons.length;S++)for(var W=this.skeletons[S],da=0;da<W.bones.length;da++)if(W.bones[da].name===O)return W.bones[da];return null},V.prototype.getLightByName=function(O){for(var S=0;S<this.lights.length;S++)if(this.lights[S].name===O)return this.lights[S];return null},V.prototype.getLightByID=function(O){for(var S=0;S<this.lights.length;S++)if(this.lights[S].id===O)return this.lights[S];return null},V.prototype.getLightByUniqueID=function(O){for(var S=0;S<this.lights.length;S++)if(this.lights[S].uniqueId===O)return this.lights[S];return null},V.prototype.getParticleSystemByID=function(O){for(var S=0;S<this.particleSystems.length;S++)if(this.particleSystems[S].id===O)return this.particleSystems[S];return null},V.prototype.getGeometryByID=function(O){for(var S=0;S<this.geometries.length;S++)if(this.geometries[S].id===O)return this.geometries[S];return null},V.prototype._getGeometryByUniqueID=function(O){if(this.geometriesByUniqueId){var S=this.geometriesByUniqueId[O];if(void 0!==S)return this.geometries[S]}else for(var W=0;W<this.geometries.length;W++)if(this.geometries[W].uniqueId===O)return this.geometries[W];return null},V.prototype.pushGeometry=function(O,S){return!(!S&&this._getGeometryByUniqueID(O.uniqueId))&&(this.addGeometry(O),this.onNewGeometryAddedObservable.notifyObservers(O),!0)},V.prototype.removeGeometry=function(O){var S;if(this.geometriesByUniqueId){if(void 0===(S=this.geometriesByUniqueId[O.uniqueId]))return!1}else if((S=this.geometries.indexOf(O))<0)return!1;if(S!==this.geometries.length-1){var W=this.geometries[this.geometries.length-1];this.geometries[S]=W,this.geometriesByUniqueId&&(this.geometriesByUniqueId[W.uniqueId]=S,this.geometriesByUniqueId[O.uniqueId]=void 0)}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(O),!0},V.prototype.getGeometries=function(){return this.geometries},V.prototype.getMeshByID=function(O){for(var S=0;S<this.meshes.length;S++)if(this.meshes[S].id===O)return this.meshes[S];return null},V.prototype.getMeshesByID=function(O){return this.meshes.filter(function(S){return S.id===O})},V.prototype.getTransformNodeByID=function(O){for(var S=0;S<this.transformNodes.length;S++)if(this.transformNodes[S].id===O)return this.transformNodes[S];return null},V.prototype.getTransformNodeByUniqueID=function(O){for(var S=0;S<this.transformNodes.length;S++)if(this.transformNodes[S].uniqueId===O)return this.transformNodes[S];return null},V.prototype.getTransformNodesByID=function(O){return this.transformNodes.filter(function(S){return S.id===O})},V.prototype.getMeshByUniqueID=function(O){for(var S=0;S<this.meshes.length;S++)if(this.meshes[S].uniqueId===O)return this.meshes[S];return null},V.prototype.getLastMeshByID=function(O){for(var S=this.meshes.length-1;S>=0;S--)if(this.meshes[S].id===O)return this.meshes[S];return null},V.prototype.getLastEntryByID=function(O){var S;for(S=this.meshes.length-1;S>=0;S--)if(this.meshes[S].id===O)return this.meshes[S];for(S=this.transformNodes.length-1;S>=0;S--)if(this.transformNodes[S].id===O)return this.transformNodes[S];for(S=this.cameras.length-1;S>=0;S--)if(this.cameras[S].id===O)return this.cameras[S];for(S=this.lights.length-1;S>=0;S--)if(this.lights[S].id===O)return this.lights[S];return null},V.prototype.getNodeByID=function(O){var S=this.getMeshByID(O);if(S)return S;var W=this.getTransformNodeByID(O);if(W)return W;var da=this.getLightByID(O);if(da)return da;var na=this.getCameraByID(O);if(na)return na;var Ea=this.getBoneByID(O);return Ea||null},V.prototype.getNodeByName=function(O){var S=this.getMeshByName(O);if(S)return S;var W=this.getTransformNodeByName(O);if(W)return W;var da=this.getLightByName(O);if(da)return da;var na=this.getCameraByName(O);if(na)return na;var Ea=this.getBoneByName(O);return Ea||null},V.prototype.getMeshByName=function(O){for(var S=0;S<this.meshes.length;S++)if(this.meshes[S].name===O)return this.meshes[S];return null},V.prototype.getTransformNodeByName=function(O){for(var S=0;S<this.transformNodes.length;S++)if(this.transformNodes[S].name===O)return this.transformNodes[S];return null},V.prototype.getLastSkeletonByID=function(O){for(var S=this.skeletons.length-1;S>=0;S--)if(this.skeletons[S].id===O)return this.skeletons[S];return null},V.prototype.getSkeletonByUniqueId=function(O){for(var S=0;S<this.skeletons.length;S++)if(this.skeletons[S].uniqueId===O)return this.skeletons[S];return null},V.prototype.getSkeletonById=function(O){for(var S=0;S<this.skeletons.length;S++)if(this.skeletons[S].id===O)return this.skeletons[S];return null},V.prototype.getSkeletonByName=function(O){for(var S=0;S<this.skeletons.length;S++)if(this.skeletons[S].name===O)return this.skeletons[S];return null},V.prototype.getMorphTargetManagerById=function(O){for(var S=0;S<this.morphTargetManagers.length;S++)if(this.morphTargetManagers[S].uniqueId===O)return this.morphTargetManagers[S];return null},V.prototype.getMorphTargetById=function(O){for(var S=0;S<this.morphTargetManagers.length;++S)for(var W=this.morphTargetManagers[S],da=0;da<W.numTargets;++da){var na=W.getTarget(da);if(na.id===O)return na}return null},V.prototype.isActiveMesh=function(O){return-1!==this._activeMeshes.indexOf(O)},Object.defineProperty(V.prototype,"uid",{get:function(){return this._uid||(this._uid=r.b.RandomId()),this._uid},enumerable:!0,configurable:!0}),V.prototype.addExternalData=function(O,S){return this._externalData||(this._externalData=new D.a()),this._externalData.add(O,S)},V.prototype.getExternalData=function(O){return this._externalData?this._externalData.get(O):null},V.prototype.getOrAddExternalDataWithFactory=function(O,S){return this._externalData||(this._externalData=new D.a()),this._externalData.getOrAddWithFactory(O,S)},V.prototype.removeExternalData=function(O){return this._externalData.remove(O)},V.prototype._evaluateSubMesh=function(O,S,W){if(W.hasInstances||W.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||S.alwaysSelectAsActiveMesh||1===S.subMeshes.length||O.isInFrustum(this._frustumPlanes)){for(var da=0,na=this._evaluateSubMeshStage;da<na.length;da++)na[da].action(S,O);var Ea=O.getMaterial();null!=Ea&&(Ea.hasRenderTargetTextures&&null!=Ea.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(Ea)&&(this._processedMaterials.push(Ea),this._renderTargets.concatWithNoDuplicate(Ea.getRenderTargetTextures())),this._renderingManager.dispatch(O,S,Ea))}},V.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(V.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(O){this._preventFreeActiveMeshesAndRenderingGroups!==O&&(O&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=O)},enumerable:!0,configurable:!0}),V.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var O=0;O<this.activeCameras.length;O++){var S=this.activeCameras[O];S&&S._activeMeshes&&S._activeMeshes.dispose()}},V.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var O=0;O<this.textures.length;O++){var S=this.textures[O];S&&S.renderList&&S.freeRenderingGroups()}},V.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},V.prototype.freezeActiveMeshes=function(O){var S=this;return void 0===O&&(O=!1),this.executeWhenReady(function(){if(S.activeCamera){S._frustumPlanes||S.setTransformMatrix(S.activeCamera.getViewMatrix(),S.activeCamera.getProjectionMatrix()),S._evaluateActiveMeshes(),S._activeMeshesFrozen=!0,S._skipEvaluateActiveMeshesCompletely=O;for(var W=0;W<S._activeMeshes.length;W++)S._activeMeshes.data[W]._freeze()}}),this},V.prototype.unfreezeActiveMeshes=function(){for(var O=0;O<this.meshes.length;O++){var S=this.meshes[O];S._internalAbstractMeshDataInfo&&(S._internalAbstractMeshDataInfo._isActive=!1)}for(O=0;O<this._activeMeshes.length;O++)this._activeMeshes.data[O]._unFreeze();return this._activeMeshesFrozen=!1,this},V.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var O=this._activeMeshes.length,S=0;S<O;S++)(Ca=this._activeMeshes.data[S]).computeWorldMatrix()}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var W=0,da=this._beforeEvaluateActiveMeshStage;W<da.length;W++)da[W].action();var na=this.getActiveMeshCandidates(),Ea=na.length;for(S=0;S<Ea;S++){var Ca;if(!(Ca=na.data[S]).isBlocked&&(this._totalVertices.addCount(Ca.getTotalVertices(),!1),Ca.isReady()&&Ca.isEnabled()&&0!==Ca.scaling.lengthSquared())){Ca.computeWorldMatrix(),Ca.actionManager&&Ca.actionManager.hasSpecificTriggers2(L.a.ACTION_OnIntersectionEnterTrigger,L.a.ACTION_OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(Ca);var wa=this.customLODSelector?this.customLODSelector(Ca,this.activeCamera):Ca.getLOD(this.activeCamera);null!=wa&&(wa!==Ca&&wa.billboardMode!==l.a.BILLBOARDMODE_NONE&&wa.computeWorldMatrix(),Ca._preActivate(),Ca.isVisible&&Ca.visibility>0&&0!=(Ca.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||Ca.alwaysSelectAsActiveMesh||Ca.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(Ca),this.activeCamera._activeMeshes.push(Ca),wa!==Ca&&wa._activate(this._renderId,!1),Ca._activate(this._renderId,!1)&&(Ca.isAnInstance?Ca._internalAbstractMeshDataInfo._actAsRegularMesh&&(wa=Ca):wa._internalAbstractMeshDataInfo._onlyForInstances=!1,wa._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(Ca,wa)),Ca._postActivate()))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var Ka=0;Ka<this.particleSystems.length;Ka++){var Ga=this.particleSystems[Ka];if(Ga.isStarted()&&Ga.emitter){var Ba=Ga.emitter;Ba.position&&!Ba.isEnabled()||(this._activeParticleSystems.push(Ga),Ga.animate(),this._renderingManager.dispatchParticles(Ga))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},V.prototype._activeMesh=function(O,S){this._skeletonsEnabled&&null!==S.skeleton&&void 0!==S.skeleton&&(this._activeSkeletons.pushNoDuplicate(S.skeleton)&&S.skeleton.prepare(),S.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(S));for(var W=0,da=this._activeMeshStage;W<da.length;W++)da[W].action(O,S);if(null!=S&&void 0!==S.subMeshes&&null!==S.subMeshes&&S.subMeshes.length>0)for(var na=this.getActiveSubMeshCandidates(S),Ea=na.length,Ca=0;Ca<Ea;Ca++){var wa=na.data[Ca];this._evaluateSubMesh(wa,S,O)}},V.prototype.updateTransformMatrix=function(O){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(O))},V.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget)if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var O=this.activeCamera.outputRenderTarget.getInternalTexture();O?this.getEngine().bindFramebuffer(O):M.a.Error("Camera contains invalid customDefaultRenderTarget")}else this.getEngine().restoreDefaultFramebuffer()},V.prototype._renderForCamera=function(O,S){if(!O||!O._skipRendering){var W=this._engine;if(this._activeCamera=O,!this.activeCamera)throw new Error("Active camera not set");W.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&O.outputRenderTarget&&O.outputRenderTarget.getViewCount()>1?this.setTransformMatrix(O._rigCameras[0].getViewMatrix(),O._rigCameras[0].getProjectionMatrix(),O._rigCameras[1].getViewMatrix(),O._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var da=0;da<this._softwareSkinnedMeshes.length;da++){var na=this._softwareSkinnedMeshes.data[da];na.applySkeleton(na.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),O.customRenderTargets&&O.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(O.customRenderTargets),S&&S.customRenderTargets&&S.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(S.customRenderTargets);for(var Ea=0,Ca=this._gatherActiveCameraRenderTargetsStage;Ea<Ca.length;Ea++)Ca[Ea].action(this._renderTargets);if(this.renderTargetsEnabled){this._intermediateRendering=!0;var wa=!1;if(this._renderTargets.length>0){r.b.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var Ka=0;Ka<this._renderTargets.length;Ka++){var Ga=this._renderTargets.data[Ka];if(Ga._shouldRender()){this._renderId++;var Ba=Ga.activeCamera&&Ga.activeCamera!==this.activeCamera;Ga.render(Ba,this.dumpNextRenderTargets),wa=!0}}r.b.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var Na=0,db=this._cameraDrawRenderTargetStage;Na<db.length;Na++)wa=db[Na].action(this.activeCamera)||wa;this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(wa=!0),wa&&this._bindFrameBuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!O._multiviewTexture&&this.postProcessManager._prepareFrame();for(var eb=0,Ya=this._beforeCameraDrawStage;eb<Ya.length;eb++)Ya[eb].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var Sa=0,sb=this._afterCameraDrawStage;Sa<sb.length;Sa++)sb[Sa].action(this.activeCamera);this.postProcessManager&&!O._multiviewTexture&&this.postProcessManager._finalizeFrame(O.isIntermediate),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},V.prototype._processSubCameras=function(O){if(O.cameraRigMode===y.a.RIG_MODE_NONE||O.outputRenderTarget&&O.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview)return this._renderForCamera(O),void this.onAfterRenderCameraObservable.notifyObservers(O);if(O._useMultiviewToSingleView)this._renderMultiviewToSingleView(O);else for(var S=0;S<O._rigCameras.length;S++)this._renderForCamera(O._rigCameras[S],O);this._activeCamera=O,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(O)},V.prototype._checkIntersections=function(){for(var O=0;O<this._meshesForIntersections.length;O++){var S=this._meshesForIntersections.data[O];if(S.actionManager)for(var W=0;S.actionManager&&W<S.actionManager.actions.length;W++){var da=S.actionManager.actions[W];if(da.trigger===L.a.ACTION_OnIntersectionEnterTrigger||da.trigger===L.a.ACTION_OnIntersectionExitTrigger){var na=da.getTriggerParameter(),Ea=na instanceof s.a?na:na.mesh,Ca=Ea.intersectsMesh(S,na.usePreciseIntersection),wa=S._intersectionsInProgress.indexOf(Ea);Ca&&-1===wa?da.trigger===L.a.ACTION_OnIntersectionEnterTrigger?(da._executeCurrent(A.a.CreateNew(S,void 0,Ea)),S._intersectionsInProgress.push(Ea)):da.trigger===L.a.ACTION_OnIntersectionExitTrigger&&S._intersectionsInProgress.push(Ea):!Ca&&wa>-1&&(da.trigger===L.a.ACTION_OnIntersectionExitTrigger&&da._executeCurrent(A.a.CreateNew(S,void 0,Ea)),S.actionManager.hasSpecificTrigger(L.a.ACTION_OnIntersectionExitTrigger,function(Ka){var Ga=Ka instanceof s.a?Ka:Ka.mesh;return Ea===Ga})&&da.trigger!==L.a.ACTION_OnIntersectionExitTrigger||S._intersectionsInProgress.splice(wa,1))}}}},V.prototype._advancePhysicsEngineStep=function(O){},V.prototype._animate=function(){},V.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var O=Math.max(V.MinDeltaTime,Math.min(this._engine.getDeltaTime(),V.MaxDeltaTime))+this._timeAccumulator,S=this._engine.getTimeStep(),W=1000/S/1000,da=0,na=this._engine.getLockstepMaxSteps(),Ea=Math.floor(O/S);for(Ea=Math.min(Ea,na);O>0&&da<Ea;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=S*W,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(S),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,da++,O-=S;this._timeAccumulator=O<0?0:O}else O=this.useConstantAnimationDeltaTime?16:Math.max(V.MinDeltaTime,Math.min(this._engine.getDeltaTime(),V.MaxDeltaTime)),this._animationRatio=.06*O,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(O)},V.prototype.render=function(O,S){if(void 0===O&&(O=!0),void 0===S&&(S=!1),!this.isDisposed){this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(L.a.ACTION_OnEveryFrameTrigger),S||this.animate();for(var W=0,da=this._beforeCameraUpdateStage;W<da.length;W++)da[W].action();if(O){if(this.activeCameras.length>0)for(var na=0;na<this.activeCameras.length;na++){var Ea=this.activeCameras[na];if(Ea.update(),Ea.cameraRigMode!==y.a.RIG_MODE_NONE)for(var Ca=0;Ca<Ea._rigCameras.length;Ca++)Ea._rigCameras[Ca].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==y.a.RIG_MODE_NONE))for(Ca=0;Ca<this.activeCamera._rigCameras.length;Ca++)this.activeCamera._rigCameras[Ca].update()}this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var wa=this.getEngine(),Ka=this.activeCamera;if(this.renderTargetsEnabled){r.b.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var Ga=0;Ga<this.customRenderTargets.length;Ga++){var Ba=this.customRenderTargets[Ga];if(Ba._shouldRender()){if(this._renderId++,this.activeCamera=Ba.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");wa.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),Ba.render(Ka!==this.activeCamera,this.dumpNextRenderTargets)}}r.b.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=Ka,this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var Na=0,db=this._beforeClearStage;Na<db.length;Na++)db[Na].action();(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var eb=0,Ya=this._gatherRenderTargetsStage;eb<Ya.length;eb++)Ya[eb].action(this._renderTargets);if(this.activeCameras.length>0)for(na=0;na<this.activeCameras.length;na++)na>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[na]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var Sa=0,sb=this._afterRenderStage;Sa<sb.length;Sa++)sb[Sa].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(Ca=0;Ca<this._toBeDisposed.length;Ca++){var kb=this._toBeDisposed[Ca];kb&&kb.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},V.prototype.freezeMaterials=function(){for(var O=0;O<this.materials.length;O++)this.materials[O].freeze()},V.prototype.unfreezeMaterials=function(){for(var O=0;O<this.materials.length;O++)this.materials[O].unfreeze()},V.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,Y.a._LastCreatedScene===this&&(Y.a._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var O=0,S=this._components;O<S.length;O++)S[O].dispose();this.importedMeshesFiles=new Array(),this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var W=0,da=this._activeRequests;W<da.length;W++)da[W].abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var na,Ea=this._engine.getInputElement();if(Ea)for(na=0;na<this.cameras.length;na++)this.cameras[na].detachControl(Ea);for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),(na=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(na,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(V.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),V.prototype.clearCachedVertexData=function(){for(var O=0;O<this.meshes.length;O++){var S=this.meshes[O].geometry;if(S)for(var W in S._indices=[],S._vertexBuffers)S._vertexBuffers.hasOwnProperty(W)&&(S._vertexBuffers[W]._buffer._data=null)}},V.prototype.cleanCachedTextureBuffer=function(){for(var O=0,S=this.textures;O<S.length;O++){var W=S[O];W._buffer&&(W._buffer=null)}},V.prototype.getWorldExtends=function(O){var S=new x.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),W=new x.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return O=O||function(){return!0},this.meshes.filter(O).forEach(function(da){if(da.computeWorldMatrix(!0),da.subMeshes&&0!==da.subMeshes.length&&!da.infiniteDistance){var na=da.getBoundingInfo(),Ea=na.boundingBox.minimumWorld,Ca=na.boundingBox.maximumWorld;x.e.CheckExtends(Ea,S,W),x.e.CheckExtends(Ca,S,W)}}),{min:S,max:W}},V.prototype.createPickingRay=function(O,S,W,da,na){throw void 0===na&&(na=!1),X.a.WarnImport("Ray")},V.prototype.createPickingRayToRef=function(O,S,W,da,na,Ea){throw void 0===Ea&&(Ea=!1),X.a.WarnImport("Ray")},V.prototype.createPickingRayInCameraSpace=function(O,S,W){throw X.a.WarnImport("Ray")},V.prototype.createPickingRayInCameraSpaceToRef=function(O,S,W,da){throw X.a.WarnImport("Ray")},V.prototype.pick=function(O,S,W,da,na,Ea){var Ca=new u.a();return Ca._pickingUnavailable=!0,Ca},V.prototype.pickWithRay=function(O,S,W,da){throw X.a.WarnImport("Ray")},V.prototype.multiPick=function(O,S,W,da,na){throw X.a.WarnImport("Ray")},V.prototype.multiPickWithRay=function(O,S,W){throw X.a.WarnImport("Ray")},V.prototype.setPointerOverMesh=function(O){this._inputManager.setPointerOverMesh(O)},V.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},V.prototype._rebuildGeometries=function(){for(var O=0,S=this.geometries;O<S.length;O++)S[O]._rebuild();for(var W=0,da=this.meshes;W<da.length;W++)da[W]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var na=0,Ea=this._components;na<Ea.length;na++)Ea[na].rebuild();for(var Ca=0,wa=this.particleSystems;Ca<wa.length;Ca++)wa[Ca].rebuild()},V.prototype._rebuildTextures=function(){for(var O=0,S=this.textures;O<S.length;O++)S[O]._rebuild();this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag)},V.prototype._getByTags=function(O,S,W){if(void 0===S)return O;var da=[];for(var na in W=W||function(Ca){},O){var Ea=O[na];E.a&&E.a.MatchesQuery(Ea,S)&&(da.push(Ea),W(Ea))}return da},V.prototype.getMeshesByTags=function(O,S){return this._getByTags(this.meshes,O,S)},V.prototype.getCamerasByTags=function(O,S){return this._getByTags(this.cameras,O,S)},V.prototype.getLightsByTags=function(O,S){return this._getByTags(this.lights,O,S)},V.prototype.getMaterialByTags=function(O,S){return this._getByTags(this.materials,O,S).concat(this._getByTags(this.multiMaterials,O,S))},V.prototype.setRenderingOrder=function(O,S,W,da){void 0===S&&(S=null),void 0===W&&(W=null),void 0===da&&(da=null),this._renderingManager.setRenderingOrder(O,S,W,da)},V.prototype.setRenderingAutoClearDepthStencil=function(O,S,W,da){void 0===W&&(W=!0),void 0===da&&(da=!0),this._renderingManager.setRenderingAutoClearDepthStencil(O,S,W,da)},V.prototype.getAutoClearDepthStencilSetup=function(O){return this._renderingManager.getAutoClearDepthStencilSetup(O)},Object.defineProperty(V.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(O){this._blockMaterialDirtyMechanism!==O&&(this._blockMaterialDirtyMechanism=O,O||this.markAllMaterialsAsDirty(L.a.MATERIAL_AllDirtyFlag))},enumerable:!0,configurable:!0}),V.prototype.markAllMaterialsAsDirty=function(O,S){if(!this._blockMaterialDirtyMechanism)for(var W=0,da=this.materials;W<da.length;W++){var na=da[W];S&&!S(na)||na.markAsDirty(O)}},V.prototype._loadFile=function(O,S,W,da,na,Ea){var Ca=this,wa=ia.a.LoadFile(O,S,W,da?this.offlineProvider:void 0,na,Ea);return this._activeRequests.push(wa),wa.onCompleteObservable.add(function(Ka){Ca._activeRequests.splice(Ca._activeRequests.indexOf(Ka),1)}),wa},V.prototype._loadFileAsync=function(O,S,W,da){var na=this;return new Promise(function(Ea,Ca){na._loadFile(O,function(wa){Ea(wa)},S,W,da,function(wa,Ka){Ca(Ka)})})},V.prototype._requestFile=function(O,S,W,da,na,Ea,Ca){var wa=this,Ka=ia.a.RequestFile(O,S,W,da?this.offlineProvider:void 0,na,Ea,Ca);return this._activeRequests.push(Ka),Ka.onCompleteObservable.add(function(Ga){wa._activeRequests.splice(wa._activeRequests.indexOf(Ga),1)}),Ka},V.prototype._requestFileAsync=function(O,S,W,da,na){var Ea=this;return new Promise(function(Ca,wa){Ea._requestFile(O,function(Ka){Ca(Ka)},S,W,da,function(Ka){wa(Ka)},na)})},V.prototype._readFile=function(O,S,W,da,na){var Ea=this,Ca=ia.a.ReadFile(O,S,W,da,na);return this._activeRequests.push(Ca),Ca.onCompleteObservable.add(function(wa){Ea._activeRequests.splice(Ea._activeRequests.indexOf(wa),1)}),Ca},V.prototype._readFileAsync=function(O,S,W){var da=this;return new Promise(function(na,Ea){da._readFile(O,function(Ca){na(Ca)},S,W,function(Ca){Ea(Ca)})})},V.FOGMODE_NONE=0,V.FOGMODE_EXP=1,V.FOGMODE_EXP2=2,V.FOGMODE_LINEAR=3,V.MinDeltaTime=1,V.MaxDeltaTime=1000,V}(q.a)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.WarnImport=function(I){return I+" needs to be imported before as it contains a side-effect required by your code."},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return I}),o.d(t,"c",function(){return i}),o.d(t,"d",function(){return G}),o.d(t,"b",function(){return D});var R=o(1),r=o(0),I=function(){function E(){}return E.POINTERDOWN=1,E.POINTERUP=2,E.POINTERMOVE=4,E.POINTERWHEEL=8,E.POINTERPICK=16,E.POINTERTAP=32,E.POINTERDOUBLETAP=64,E}(),i=function(E,x){this.type=E,this.event=x},G=function(E){function x(l,s,y,q){var n=E.call(this,l,s)||this;return n.ray=null,n.skipOnPointerObservable=!1,n.localPosition=new r.d(y,q),n}return Object(R.d)(x,E),x}(i),D=function(E){function x(l,s,y){var q=E.call(this,l,s)||this;return q.pickInfo=y,q}return Object(R.d)(x,E),x}(i)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return I});var R=o(11),r=o(2),I=function(){function i(){}return Object.defineProperty(i,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(G){this._DiffuseTextureEnabled!==G&&(this._DiffuseTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(G){this._AmbientTextureEnabled!==G&&(this._AmbientTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(G){this._OpacityTextureEnabled!==G&&(this._OpacityTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(G){this._ReflectionTextureEnabled!==G&&(this._ReflectionTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(G){this._EmissiveTextureEnabled!==G&&(this._EmissiveTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(G){this._SpecularTextureEnabled!==G&&(this._SpecularTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(G){this._BumpTextureEnabled!==G&&(this._BumpTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(G){this._LightmapTextureEnabled!==G&&(this._LightmapTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(G){this._RefractionTextureEnabled!==G&&(this._RefractionTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(G){this._ColorGradingTextureEnabled!==G&&(this._ColorGradingTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(G){this._FresnelEnabled!==G&&(this._FresnelEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_FresnelDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(G){this._ClearCoatTextureEnabled!==G&&(this._ClearCoatTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(G){this._ClearCoatBumpTextureEnabled!==G&&(this._ClearCoatBumpTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(G){this._ClearCoatTintTextureEnabled!==G&&(this._ClearCoatTintTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(G){this._SheenTextureEnabled!==G&&(this._SheenTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(G){this._AnisotropicTextureEnabled!==G&&(this._AnisotropicTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(G){this._ThicknessTextureEnabled!==G&&(this._ThicknessTextureEnabled=G,R.a.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),i._DiffuseTextureEnabled=!0,i._AmbientTextureEnabled=!0,i._OpacityTextureEnabled=!0,i._ReflectionTextureEnabled=!0,i._EmissiveTextureEnabled=!0,i._SpecularTextureEnabled=!0,i._BumpTextureEnabled=!0,i._LightmapTextureEnabled=!0,i._RefractionTextureEnabled=!0,i._ColorGradingTextureEnabled=!0,i._FresnelEnabled=!0,i._ClearCoatTextureEnabled=!0,i._ClearCoatBumpTextureEnabled=!0,i._ClearCoatTintTextureEnabled=!0,i._SheenTextureEnabled=!0,i._AnisotropicTextureEnabled=!0,i._ThicknessTextureEnabled=!0,i}()},function(Ja,t,o){"use strict";o.d(t,"b",function(){return R}),o.d(t,"a",function(){return I});var R,r=o(0);!function(i){i[i.LOCAL=0]="LOCAL",i[i.WORLD=1]="WORLD",i[i.BONE=2]="BONE"}(R||(R={}));var I=function(){function i(){}return i.X=new r.e(1,0,0),i.Y=new r.e(0,1,0),i.Z=new r.e(0,0,1),i}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return Object.defineProperty(r,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!0,configurable:!0}),r.Instances=new Array(),r._LastCreatedScene=null,r.UseFallbackTexture=!0,r.FallbackTexture="",r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return n});var R=o(1),r=o(3),I=o(34),i=o(13),G=o(6),D=o(0),E=o(26),x=o(7),l=o(12),s=o(19),y=o(61),q=o(86),n=function(k){function p(u,A,B,v){void 0===v&&(v=!0);var H=k.call(this,u,B)||this;return H._position=D.e.Zero(),H.upVector=D.e.Up(),H.orthoLeft=null,H.orthoRight=null,H.orthoBottom=null,H.orthoTop=null,H.fov=.8,H.minZ=1,H.maxZ=10000,H.inertia=.9,H.mode=p.PERSPECTIVE_CAMERA,H.isIntermediate=!1,H.viewport=new y.a(0,0,1,1),H.layerMask=268435455,H.fovMode=p.FOVMODE_VERTICAL_FIXED,H.cameraRigMode=p.RIG_MODE_NONE,H.customRenderTargets=new Array(),H.outputRenderTarget=null,H.onViewMatrixChangedObservable=new G.c(),H.onProjectionMatrixChangedObservable=new G.c(),H.onAfterCheckInputsObservable=new G.c(),H.onRestoreStateObservable=new G.c(),H.isRigCamera=!1,H._rigCameras=new Array(),H._webvrViewMatrix=D.a.Identity(),H._skipRendering=!1,H._projectionMatrix=new D.a(),H._postProcesses=new Array(),H._activeMeshes=new I.a(256),H._globalPosition=D.e.Zero(),H._computedViewMatrix=D.a.Identity(),H._doNotComputeProjectionMatrix=!1,H._transformMatrix=D.a.Zero(),H._refreshFrustumPlanes=!0,H._isCamera=!0,H._isLeftCamera=!1,H._isRightCamera=!1,H.getScene().addCamera(H),v&&!H.getScene().activeCamera&&(H.getScene().activeCamera=H),H.position=A,H}return Object(R.d)(p,k),Object.defineProperty(p.prototype,"position",{get:function(){return this._position},set:function(u){this._position=u},enumerable:!0,configurable:!0}),p.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},p.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},p.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},p.prototype.getClassName=function(){return"Camera"},p.prototype.toString=function(u){var A="Name: "+this.name;if(A+=", type: "+this.getClassName(),this.animations)for(var B=0;B<this.animations.length;B++)A+=", animation[0]: "+this.animations[B].toString(u);return A},Object.defineProperty(p.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),p.prototype.getActiveMeshes=function(){return this._activeMeshes},p.prototype.isActiveMesh=function(u){return-1!==this._activeMeshes.indexOf(u)},p.prototype.isReady=function(u){if(void 0===u&&(u=!1),u)for(var A=0,B=this._postProcesses;A<B.length;A++){var v=B[A];if(v&&!v.isReady())return!1}return k.prototype.isReady.call(this,u)},p.prototype._initCache=function(){k.prototype._initCache.call(this),this._cache.position=new D.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new D.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},p.prototype._updateCache=function(u){u||k.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},p.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},p.prototype._isSynchronizedViewMatrix=function(){return!!k.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},p.prototype._isSynchronizedProjectionMatrix=function(){var u=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!u)return!1;var A=this.getEngine();return u=this.mode===p.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===A.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===A.getRenderWidth()&&this._cache.renderHeight===A.getRenderHeight()},p.prototype.attachControl=function(u,A){},p.prototype.detachControl=function(u){},p.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==p.RIG_MODE_NONE&&this._updateRigCameras()},p.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(p.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),p.prototype._getFirstPostProcess=function(){for(var u=0;u<this._postProcesses.length;u++)if(null!==this._postProcesses[u])return this._postProcesses[u];return null},p.prototype._cascadePostProcessesToRigCams=function(){var u=this._getFirstPostProcess();u&&u.markTextureDirty();for(var A=0,B=this._rigCameras.length;A<B;A++){var v=this._rigCameras[A],H=v._rigPostProcess;H?("pass"===H.getEffectName()&&(v.isIntermediate=0===this._postProcesses.length),v._postProcesses=this._postProcesses.slice(0).concat(H),H.markTextureDirty()):v._postProcesses=this._postProcesses.slice(0)}},p.prototype.attachPostProcess=function(u,A){return void 0===A&&(A=null),!u.isReusable()&&this._postProcesses.indexOf(u)>-1?(x.a.Error("You're trying to reuse a post process not defined as reusable."),0):(null==A||A<0?this._postProcesses.push(u):null===this._postProcesses[A]?this._postProcesses[A]=u:this._postProcesses.splice(A,0,u),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(u))},p.prototype.detachPostProcess=function(u){var A=this._postProcesses.indexOf(u);-1!==A&&(this._postProcesses[A]=null),this._cascadePostProcessesToRigCams()},p.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},p.prototype._getViewMatrix=function(){return D.a.Identity()},p.prototype.getViewMatrix=function(u){return!u&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},p.prototype.freezeProjectionMatrix=function(u){this._doNotComputeProjectionMatrix=!0,void 0!==u&&(this._projectionMatrix=u)},p.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},p.prototype.getProjectionMatrix=function(u){if(this._doNotComputeProjectionMatrix||!u&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var A=this.getEngine(),B=this.getScene();if(this.mode===p.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=A.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var v=A.useReverseDepthBuffer;(B.useRightHandedSystem?v?D.a.PerspectiveFovReverseRHToRef:D.a.PerspectiveFovRHToRef:v?D.a.PerspectiveFovReverseLHToRef:D.a.PerspectiveFovLHToRef)(this.fov,A.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===p.FOVMODE_VERTICAL_FIXED)}else{var H=A.getRenderWidth()/2,L=A.getRenderHeight()/2;B.useRightHandedSystem?D.a.OrthoOffCenterRHToRef(this.orthoLeft||-H,this.orthoRight||H,this.orthoBottom||-L,this.orthoTop||L,this.minZ,this.maxZ,this._projectionMatrix):D.a.OrthoOffCenterLHToRef(this.orthoLeft||-H,this.orthoRight||H,this.orthoBottom||-L,this.orthoTop||L,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=A.getRenderWidth(),this._cache.renderHeight=A.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},p.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},p.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?q.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=q.a.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},p.prototype.isInFrustum=function(u,A){if(void 0===A&&(A=!1),this._updateFrustumPlanes(),A&&this.rigCameras.length>0){var B=!1;return this.rigCameras.forEach(function(v){v._updateFrustumPlanes(),B=B||u.isInFrustum(v._frustumPlanes)}),B}return u.isInFrustum(this._frustumPlanes)},p.prototype.isCompletelyInFrustum=function(u){return this._updateFrustumPlanes(),u.isCompletelyInFrustum(this._frustumPlanes)},p.prototype.getForwardRay=function(u,A,B){throw void 0===u&&(u=100),s.a.WarnImport("Ray")},p.prototype.dispose=function(u,A){for(void 0===A&&(A=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var B=this._rigCameras.pop();B&&B.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==p.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var v=this._postProcesses.length;--v>=0;){var H=this._postProcesses[v];H&&H.dispose(this)}for(v=this.customRenderTargets.length;--v>=0;)this.customRenderTargets[v].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),k.prototype.dispose.call(this,u,A)},Object.defineProperty(p.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),p.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},p.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},p.prototype.setCameraRigMode=function(u,A){if(this.cameraRigMode!==u){for(;this._rigCameras.length>0;){var B=this._rigCameras.pop();B&&B.dispose()}if(this.cameraRigMode=u,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=A.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=i.b.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==p.RIG_MODE_NONE){var v=this.createRigCamera(this.name+"_L",0);v&&(v._isLeftCamera=!0);var H=this.createRigCamera(this.name+"_R",1);H&&(H._isRightCamera=!0),v&&H&&(this._rigCameras.push(v),this._rigCameras.push(H))}switch(this.cameraRigMode){case p.RIG_MODE_STEREOSCOPIC_ANAGLYPH:p._setStereoscopicAnaglyphRigMode(this);break;case p.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case p.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case p.RIG_MODE_STEREOSCOPIC_OVERUNDER:case p.RIG_MODE_STEREOSCOPIC_INTERLACED:p._setStereoscopicRigMode(this);break;case p.RIG_MODE_VR:p._setVRRigMode(this,A);break;case p.RIG_MODE_WEBVR:p._setWebVRRigMode(this,A)}this._cascadePostProcessesToRigCams(),this.update()}},p._setStereoscopicRigMode=function(u){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},p._setStereoscopicAnaglyphRigMode=function(u){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},p._setVRRigMode=function(u,A){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},p._setWebVRRigMode=function(u,A){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},p.prototype._getVRProjectionMatrix=function(){return D.a.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},p.prototype._updateCameraRotationMatrix=function(){},p.prototype._updateWebVRCameraRotationMatrix=function(){},p.prototype._getWebVRProjectionMatrix=function(){return D.a.Identity()},p.prototype._getWebVRViewMatrix=function(){return D.a.Identity()},p.prototype.setCameraRigParameter=function(u,A){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[u]=A,"interaxialDistance"===u&&(this._cameraRigParams.stereoHalfAngle=i.b.ToRadians(A/.0637))},p.prototype.createRigCamera=function(u,A){return null},p.prototype._updateRigCameras=function(){for(var u=0;u<this._rigCameras.length;u++)this._rigCameras[u].minZ=this.minZ,this._rigCameras[u].maxZ=this.maxZ,this._rigCameras[u].fov=this.fov,this._rigCameras[u].upVector.copyFrom(this.upVector);this.cameraRigMode===p.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},p.prototype._setupInputs=function(){},p.prototype.serialize=function(){var u=r.a.Serialize(this);return u.type=this.getClassName(),this.parent&&(u.parentId=this.parent.id),this.inputs&&this.inputs.serialize(u),r.a.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u},p.prototype.clone=function(u){return r.a.Clone(p.GetConstructorFromName(this.getClassName(),u,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},p.prototype.getDirection=function(u){var A=D.e.Zero();return this.getDirectionToRef(u,A),A},Object.defineProperty(p.prototype,"absoluteRotation",{get:function(){var u=D.b.Zero();return this.getWorldMatrix().decompose(void 0,u),u},enumerable:!0,configurable:!0}),p.prototype.getDirectionToRef=function(u,A){D.e.TransformNormalToRef(u,this.getWorldMatrix(),A)},p.GetConstructorFromName=function(u,A,B,v,H){void 0===v&&(v=0),void 0===H&&(H=!0);var L=E.a.Construct(u,A,B,{interaxial_distance:v,isStereoscopicSideBySide:H});return L||function(){return p._createDefaultParsedCamera(A,B)}},p.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},p.Parse=function(u,A){var B=u.type,v=p.GetConstructorFromName(B,u.name,A,u.interaxial_distance,u.isStereoscopicSideBySide),H=r.a.Parse(v,u,A);if(u.parentId&&(H._waitingParentId=u.parentId),H.inputs&&(H.inputs.parse(u),H._setupInputs()),H.setPosition&&(H.position.copyFromFloats(0,0,0),H.setPosition(D.e.FromArray(u.position))),u.target&&H.setTarget&&H.setTarget(D.e.FromArray(u.target)),u.cameraRigMode){var L=u.interaxial_distance?{interaxialDistance:u.interaxial_distance}:{};H.setCameraRigMode(u.cameraRigMode,L)}if(u.animations){for(var Q=0;Q<u.animations.length;Q++){var M=u.animations[Q],Y=l.a.GetClass("BABYLON.Animation");Y&&H.animations.push(Y.Parse(M))}E.a.ParseAnimationRanges(H,u,A)}return u.autoAnimate&&A.beginAnimation(H,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),H},p._createDefaultParsedCamera=function(u,A){throw s.a.WarnImport("UniversalCamera")},p.PERSPECTIVE_CAMERA=0,p.ORTHOGRAPHIC_CAMERA=1,p.FOVMODE_VERTICAL_FIXED=0,p.FOVMODE_HORIZONTAL_FIXED=1,p.RIG_MODE_NONE=0,p.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,p.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,p.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,p.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,p.RIG_MODE_STEREOSCOPIC_INTERLACED=14,p.RIG_MODE_VR=20,p.RIG_MODE_WEBVR=21,p.RIG_MODE_CUSTOM=22,p.ForceAttachControlToAlwaysPreventDefault=!1,Object(R.c)([Object(r.o)("position")],p.prototype,"_position",void 0),Object(R.c)([Object(r.o)()],p.prototype,"upVector",void 0),Object(R.c)([Object(r.c)()],p.prototype,"orthoLeft",void 0),Object(R.c)([Object(r.c)()],p.prototype,"orthoRight",void 0),Object(R.c)([Object(r.c)()],p.prototype,"orthoBottom",void 0),Object(R.c)([Object(r.c)()],p.prototype,"orthoTop",void 0),Object(R.c)([Object(r.c)()],p.prototype,"fov",void 0),Object(R.c)([Object(r.c)()],p.prototype,"minZ",void 0),Object(R.c)([Object(r.c)()],p.prototype,"maxZ",void 0),Object(R.c)([Object(r.c)()],p.prototype,"inertia",void 0),Object(R.c)([Object(r.c)()],p.prototype,"mode",void 0),Object(R.c)([Object(r.c)()],p.prototype,"layerMask",void 0),Object(R.c)([Object(r.c)()],p.prototype,"fovMode",void 0),Object(R.c)([Object(r.c)()],p.prototype,"cameraRigMode",void 0),Object(R.c)([Object(r.c)()],p.prototype,"interaxialDistance",void 0),Object(R.c)([Object(r.c)()],p.prototype,"isStereoscopicSideBySide",void 0),p}(E.a)},function(Ja,t,o){"use strict";o.d(t,"b",function(){return R}),o.d(t,"a",function(){return D});var R,r=o(6),I=o(95),i=o(2),G=o(19);!function(E){E[E.Unknown=0]="Unknown",E[E.Url=1]="Url",E[E.Temp=2]="Temp",E[E.Raw=3]="Raw",E[E.Dynamic=4]="Dynamic",E[E.RenderTarget=5]="RenderTarget",E[E.MultiRenderTarget=6]="MultiRenderTarget",E[E.Cube=7]="Cube",E[E.CubeRaw=8]="CubeRaw",E[E.CubePrefiltered=9]="CubePrefiltered",E[E.Raw3D=10]="Raw3D",E[E.Raw2DArray=11]="Raw2DArray",E[E.Depth=12]="Depth",E[E.CubeRawRGBD=13]="CubeRawRGBD"}(R||(R={}));var D=function(){function E(x,l,s){void 0===s&&(s=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new r.c(),this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=R.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._engine=x,this._source=l,s||(this._webGLTexture=x._createTexture())}return E.prototype.getEngine=function(){return this._engine},Object.defineProperty(E.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),E.prototype.incrementReferences=function(){this._references++},E.prototype.updateSize=function(x,l,s){void 0===s&&(s=1),this.width=x,this.height=l,this.depth=s,this.baseWidth=x,this.baseHeight=l,this.baseDepth=s,this._size=x*l*s},E.prototype._rebuild=function(){var x,l=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case R.Temp:return;case R.Url:return void(x=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){x._swapAndDie(l),l.isReady=!0},null,this._buffer,void 0,this.format));case R.Raw:return(x=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case R.Raw3D:return(x=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case R.Raw2DArray:return(x=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case R.Dynamic:return(x=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case R.RenderTarget:var s=new I.a();if(s.generateDepthBuffer=this._generateDepthBuffer,s.generateMipMaps=this.generateMipMaps,s.generateStencilBuffer=this._generateStencilBuffer,s.samplingMode=this.samplingMode,s.type=this.type,this.isCube)x=this._engine.createRenderTargetCubeTexture(this.width,s);else{var y={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};x=this._engine.createRenderTargetTexture(y,s)}return x._swapAndDie(this),void(this.isReady=!0);case R.Depth:var q={bilinearFiltering:this.samplingMode!==i.a.TEXTURE_BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},n={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(x=this._engine.createDepthStencilTexture(n,q))._swapAndDie(this),void(this.isReady=!0);case R.Cube:return void(x=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){x._swapAndDie(l),l.isReady=!0},null,this.format,this._extension));case R.CubeRaw:return(x=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case R.CubeRawRGBD:return x=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void E._UpdateRGBDAsync(x,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){x._swapAndDie(l),l.isReady=!0});case R.CubePrefiltered:return void((x=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(k){k&&k._swapAndDie(l),l.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},E.prototype._swapAndDie=function(x){x._webGLTexture=this._webGLTexture,x._isRGBD=this._isRGBD,this._framebuffer&&(x._framebuffer=this._framebuffer),this._depthStencilBuffer&&(x._depthStencilBuffer=this._depthStencilBuffer),x._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(x._lodTextureHigh&&x._lodTextureHigh.dispose(),x._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(x._lodTextureMid&&x._lodTextureMid.dispose(),x._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(x._lodTextureLow&&x._lodTextureLow.dispose(),x._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(x._irradianceTexture&&x._irradianceTexture.dispose(),x._irradianceTexture=this._irradianceTexture);var l,s=this._engine.getLoadedTexturesCache();-1!==(l=s.indexOf(this))&&s.splice(l,1),-1===(l=s.indexOf(x))&&s.push(x)},E.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},E._UpdateRGBDAsync=function(x,l,s,y,q){throw G.a.WarnImport("environmentTextureTools")},E}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return E});var R=o(1),r=o(0),I=o(3),i=o(6),G=o(23),D=o(19),E=function(){function x(l,s){void 0===s&&(s=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array(),this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=r.a.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new i.c(),this._onDisposeObserver=null,this._behaviors=new Array(),this.name=l,this.id=l,this._scene=s||G.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return x.AddNodeConstructor=function(l,s){this._NodeConstructors[l]=s},x.Construct=function(l,s,y,q){var n=this._NodeConstructors[l];return n?n(s,y,q):null},Object.defineProperty(x.prototype,"doNotSerialize",{get:function(){return!!this._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(l){this._doNotSerialize=l},enumerable:!0,configurable:!0}),x.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(x.prototype,"parent",{get:function(){return this._parentNode},set:function(l){if(this._parentNode!==l){var s=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var y=this._parentNode._children.indexOf(this);-1!==y&&this._parentNode._children.splice(y,1),l||this._isDisposed||this._addToSceneRootNodes()}this._parentNode=l,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array()),this._parentNode._children.push(this),s||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!0,configurable:!0}),x.prototype._addToSceneRootNodes=function(){-1===this._sceneRootNodesIndex&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},x.prototype._removeFromSceneRootNodes=function(){if(-1!==this._sceneRootNodesIndex){var l=this._scene.rootNodes,s=l.length-1;l[this._sceneRootNodesIndex]=l[s],l[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(x.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(l){this._animationPropertiesOverride=l},enumerable:!0,configurable:!0}),x.prototype.getClassName=function(){return"Node"},Object.defineProperty(x.prototype,"onDispose",{set:function(l){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(l)},enumerable:!0,configurable:!0}),x.prototype.getScene=function(){return this._scene},x.prototype.getEngine=function(){return this._scene.getEngine()},x.prototype.addBehavior=function(l,s){var y=this;return void 0===s&&(s=!1),-1!==this._behaviors.indexOf(l)?this:(l.init(),this._scene.isLoading&&!s?this._scene.onDataLoadedObservable.addOnce(function(){l.attach(y)}):l.attach(this),this._behaviors.push(l),this)},x.prototype.removeBehavior=function(l){var s=this._behaviors.indexOf(l);return-1===s?this:(this._behaviors[s].detach(),this._behaviors.splice(s,1),this)},Object.defineProperty(x.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),x.prototype.getBehaviorByName=function(l){for(var s=0,y=this._behaviors;s<y.length;s++){var q=y[s];if(q.name===l)return q}return null},x.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},x.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(x.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),x.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},x.prototype.updateCache=function(l){!l&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},x.prototype._getActionManagerForTrigger=function(l,s){return void 0===s&&(s=!0),this.parent?this.parent._getActionManagerForTrigger(l,!1):null},x.prototype._updateCache=function(l){},x.prototype._isSynchronized=function(){return!0},x.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},x.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},x.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},x.prototype.isReady=function(l){return void 0===l&&(l=!1),this._isReady},x.prototype.isEnabled=function(l){return void 0===l&&(l=!0),!1===l?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},x.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(l){l._syncParentEnabledState()})},x.prototype.setEnabled=function(l){this._isEnabled=l,this._syncParentEnabledState()},x.prototype.isDescendantOf=function(l){return!!this.parent&&(this.parent===l||this.parent.isDescendantOf(l))},x.prototype._getDescendants=function(l,s,y){if(void 0===s&&(s=!1),this._children)for(var q=0;q<this._children.length;q++){var n=this._children[q];y&&!y(n)||l.push(n),s||n._getDescendants(l,!1,y)}},x.prototype.getDescendants=function(l,s){var y=new Array();return this._getDescendants(y,l,s),y},x.prototype.getChildMeshes=function(l,s){var y=[];return this._getDescendants(y,l,function(q){return(!s||s(q))&&void 0!==q.cullingStrategy}),y},x.prototype.getChildren=function(l,s){return void 0===s&&(s=!0),this.getDescendants(s,l)},x.prototype._setReady=function(l){l!==this._isReady&&(l?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},x.prototype.getAnimationByName=function(l){for(var s=0;s<this.animations.length;s++){var y=this.animations[s];if(y.name===l)return y}return null},x.prototype.createAnimationRange=function(l,s,y){if(!this._ranges[l]){this._ranges[l]=x._AnimationRangeFactory(l,s,y);for(var q=0,n=this.animations.length;q<n;q++)this.animations[q]&&this.animations[q].createRange(l,s,y)}},x.prototype.deleteAnimationRange=function(l,s){void 0===s&&(s=!0);for(var y=0,q=this.animations.length;y<q;y++)this.animations[y]&&this.animations[y].deleteRange(l,s);this._ranges[l]=null},x.prototype.getAnimationRange=function(l){return this._ranges[l]},x.prototype.getAnimationRanges=function(){var l,s=[];for(l in this._ranges)s.push(this._ranges[l]);return s},x.prototype.beginAnimation=function(l,s,y,q){var n=this.getAnimationRange(l);return n?this._scene.beginAnimation(this,n.from,n.to,s,y,q):null},x.prototype.serializeAnimationRanges=function(){var l=[];for(var s in this._ranges){var y=this._ranges[s];if(y){var q={};q.name=s,q.from=y.from,q.to=y.to,l.push(q)}}return l},x.prototype.computeWorldMatrix=function(l){return this._worldMatrix||(this._worldMatrix=r.a.Identity()),this._worldMatrix},x.prototype.dispose=function(l,s){if(void 0===s&&(s=!1),this._isDisposed=!0,!l)for(var y=0,q=this.getDescendants(!0);y<q.length;y++)q[y].dispose(l,s);this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var n=0,k=this._behaviors;n<k.length;n++)k[n].detach();this._behaviors=[]},x.ParseAnimationRanges=function(l,s,y){if(s.ranges)for(var q=0;q<s.ranges.length;q++){var n=s.ranges[q];l.createAnimationRange(n.name,n.from,n.to)}},x.prototype.getHierarchyBoundingVectors=function(l,s){var y,q;void 0===l&&(l=!0),void 0===s&&(s=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);if(this.getBoundingInfo&&this.subMeshes){var n=this.getBoundingInfo();y=n.boundingBox.minimumWorld.clone(),q=n.boundingBox.maximumWorld.clone()}else y=new r.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),q=new r.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(l)for(var k=0,p=this.getDescendants(!1);k<p.length;k++){var u=p[k];if(u.computeWorldMatrix(!0),(!s||s(u))&&u.getBoundingInfo&&0!==u.getTotalVertices()){var A=u.getBoundingInfo().boundingBox,B=A.minimumWorld,v=A.maximumWorld;r.e.CheckExtends(B,y,q),r.e.CheckExtends(v,y,q)}}return{min:y,max:q}},x._AnimationRangeFactory=function(l,s,y){throw D.a.WarnImport("AnimationRange")},x._NodeConstructors={},Object(R.c)([Object(I.c)()],x.prototype,"name",void 0),Object(R.c)([Object(I.c)()],x.prototype,"id",void 0),Object(R.c)([Object(I.c)()],x.prototype,"uniqueId",void 0),Object(R.c)([Object(I.c)()],x.prototype,"state",void 0),Object(R.c)([Object(I.c)()],x.prototype,"metadata",void 0),x}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return H});var R=o(1),r=o(13),I=o(6),i=o(0),G=o(11),D=o(4),E=o(15),x=o(43),l=o(53),s=o(44),y=o(2),q=o(133),n=o(19),k=o(110),p=o(10),u=o(28),A=o(22),B=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=i.e.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},v=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new B(),this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1},H=function(L){function Q(M,Y){void 0===Y&&(Y=null);var X=L.call(this,M,Y,!1)||this;return X._internalAbstractMeshDataInfo=new v(),X.cullingStrategy=Q.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,X.onCollideObservable=new I.c(),X.onCollisionPositionChangeObservable=new I.c(),X.onMaterialChangedObservable=new I.c(),X.definedFacingForward=!0,X._occlusionQuery=null,X._renderingGroup=null,X.alphaIndex=Number.MAX_VALUE,X.isVisible=!0,X.isPickable=!0,X.showSubMeshesBoundingBox=!1,X.isBlocker=!1,X.enablePointerMoveEvents=!1,X.renderingGroupId=0,X._material=null,X.outlineColor=p.a.Red(),X.outlineWidth=.02,X.overlayColor=p.a.Red(),X.overlayAlpha=.5,X.useOctreeForRenderingSelection=!0,X.useOctreeForPicking=!0,X.useOctreeForCollisions=!0,X.alwaysSelectAsActiveMesh=!1,X.doNotSyncBoundingInfo=!1,X.actionManager=null,X._meshCollisionData=new q.a(),X.ellipsoid=new i.e(.5,1,.5),X.ellipsoidOffset=new i.e(0,0,0),X.edgesWidth=1,X.edgesColor=new p.b(1,0,0,1),X._edgesRenderer=null,X._masterMesh=null,X._boundingInfo=null,X._renderId=0,X._intersectionsInProgress=new Array(),X._unIndexed=!1,X._lightSources=new Array(),X._waitingData={lods:null,actions:null,freezeWorldMatrix:null},X._bonesTransformMatrices=null,X._transformMatrixTexture=null,X.onRebuildObservable=new I.c(),X._onCollisionPositionChange=function(U,P,ga){void 0===ga&&(ga=null),P.subtractToRef(X._meshCollisionData._oldPositionForCollisions,X._meshCollisionData._diffPositionForCollisions),X._meshCollisionData._diffPositionForCollisions.length()>G.a.CollisionsEpsilon&&X.position.addInPlace(X._meshCollisionData._diffPositionForCollisions),ga&&X.onCollideObservable.notifyObservers(ga),X.onCollisionPositionChangeObservable.notifyObservers(X.position)},X.getScene().addMesh(X),X._resyncLightSources(),X}return Object(R.d)(Q,L),Object.defineProperty(Q,"BILLBOARDMODE_NONE",{get:function(){return x.a.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(Q,"BILLBOARDMODE_X",{get:function(){return x.a.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(Q,"BILLBOARDMODE_Y",{get:function(){return x.a.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(Q,"BILLBOARDMODE_Z",{get:function(){return x.a.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(Q,"BILLBOARDMODE_ALL",{get:function(){return x.a.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(Q,"BILLBOARDMODE_USE_POSITION",{get:function(){return x.a.BILLBOARDMODE_USE_POSITION},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(M){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=M},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(M){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=M},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(M){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=M},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(M){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=M},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),Q.prototype._updateNonUniformScalingState=function(M){return!!L.prototype._updateNonUniformScalingState.call(this,M)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(Q.prototype,"onCollide",{set:function(M){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(M)},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"onCollisionPositionChange",{set:function(M){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(M)},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(M){this._internalAbstractMeshDataInfo._visibility!==M&&(this._internalAbstractMeshDataInfo._visibility=M,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"material",{get:function(){return this._material},set:function(M){this._material!==M&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=M,M&&M.meshMap&&(M.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(M){this._internalAbstractMeshDataInfo._receiveShadows!==M&&(this._internalAbstractMeshDataInfo._receiveShadows=M,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(M){this._internalAbstractMeshDataInfo._hasVertexAlpha!==M&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=M,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(M){this._internalAbstractMeshDataInfo._useVertexColors!==M&&(this._internalAbstractMeshDataInfo._useVertexColors=M,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(M){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==M&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=M,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(M){this._internalAbstractMeshDataInfo._numBoneInfluencers!==M&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=M,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(M){this._internalAbstractMeshDataInfo._applyFog!==M&&(this._internalAbstractMeshDataInfo._applyFog=M,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(M){M!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=M,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(M){this._meshCollisionData._collisionMask=isNaN(M)?-1:M},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(M){this._meshCollisionData._collisionGroup=isNaN(M)?-1:M},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(M){var Y=this._internalAbstractMeshDataInfo._skeleton;Y&&Y.needInitialSkinMatrix&&Y._unregisterMeshWithPoseMatrix(this),M&&M.needInitialSkinMatrix&&M._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=M,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),Q.prototype.getClassName=function(){return"AbstractMesh"},Q.prototype.toString=function(M){var Y="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");Y+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var X=this._internalAbstractMeshDataInfo._skeleton;return X&&(Y+=", skeleton: "+X.name),M&&(Y+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],Y+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),Y},Q.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==x.a.BILLBOARDMODE_NONE?this._masterMesh:L.prototype._getEffectiveParent.call(this)},Q.prototype._getActionManagerForTrigger=function(M,Y){if(void 0===Y&&(Y=!0),this.actionManager&&(Y||this.actionManager.isRecursive)){if(!M)return this.actionManager;if(this.actionManager.hasSpecificTrigger(M))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(M,!1):null},Q.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var M=0,Y=this.subMeshes;M<Y.length;M++)Y[M]._rebuild()},Q.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var M=0,Y=this.getScene().lights;M<Y.length;M++){var X=Y[M];X.isEnabled()&&(X.canAffectMesh(this)&&this._lightSources.push(X))}this._markSubMeshesAsLightDirty()},Q.prototype._resyncLightSource=function(M){var Y=M.isEnabled()&&M.canAffectMesh(this),X=this._lightSources.indexOf(M);if(-1===X){if(!Y)return;this._lightSources.push(M)}else{if(Y)return;this._lightSources.splice(X,1)}this._markSubMeshesAsLightDirty()},Q.prototype._unBindEffect=function(){for(var M=0,Y=this.subMeshes;M<Y.length;M++)Y[M].setEffect(null)},Q.prototype._removeLightSource=function(M,Y){var X=this._lightSources.indexOf(M);-1!==X&&(this._lightSources.splice(X,1),this._markSubMeshesAsLightDirty(Y))},Q.prototype._markSubMeshesAsDirty=function(M){if(this.subMeshes)for(var Y=0,X=this.subMeshes;Y<X.length;Y++){var U=X[Y];U._materialDefines&&M(U._materialDefines)}},Q.prototype._markSubMeshesAsLightDirty=function(M){void 0===M&&(M=!1),this._markSubMeshesAsDirty(function(Y){return Y.markAsLightDirty(M)})},Q.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(M){return M.markAsAttributesDirty()})},Q.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var M=0,Y=this.subMeshes;M<Y.length;M++){var X=Y[M].getMaterial();X&&X.markAsDirty(y.a.MATERIAL_MiscDirtyFlag)}},Object.defineProperty(Q.prototype,"scaling",{get:function(){return this._scaling},set:function(M){this._scaling=M},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),Q.prototype.getLOD=function(M){return this},Q.prototype.getTotalVertices=function(){return 0},Q.prototype.getTotalIndices=function(){return 0},Q.prototype.getIndices=function(){return null},Q.prototype.getVerticesData=function(M){return null},Q.prototype.setVerticesData=function(M,Y,X,U){return this},Q.prototype.updateVerticesData=function(M,Y,X,U){return this},Q.prototype.setIndices=function(M,Y){return this},Q.prototype.isVerticesDataPresent=function(M){return!1},Q.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Q.prototype.normalizeToUnitCube=function(M,Y,X){return void 0===M&&(M=!0),void 0===Y&&(Y=!1),L.prototype.normalizeToUnitCube.call(this,M,Y,X)},Q.prototype.setBoundingInfo=function(M){return this._boundingInfo=M,this},Object.defineProperty(Q.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(D.b.MatricesIndicesKind)&&this.isVerticesDataPresent(D.b.MatricesWeightsKind)},enumerable:!0,configurable:!0}),Q.prototype._preActivate=function(){},Q.prototype._preActivateForIntermediateRendering=function(M){},Q.prototype._activate=function(M,Y){return this._renderId=M,!0},Q.prototype._postActivate=function(){},Q.prototype._freeze=function(){},Q.prototype._unFreeze=function(){},Q.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===x.a.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():L.prototype.getWorldMatrix.call(this)},Q.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():L.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(Q.prototype,"isAnInstance",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"hasInstances",{get:function(){return!1},enumerable:!0,configurable:!0}),Q.prototype.movePOV=function(M,Y,X){return this.position.addInPlace(this.calcMovePOV(M,Y,X)),this},Q.prototype.calcMovePOV=function(M,Y,X){var U=new i.a();(this.rotationQuaternion?this.rotationQuaternion:i.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(U);var P=i.e.Zero(),ga=this.definedFacingForward?-1:1;return i.e.TransformCoordinatesFromFloatsToRef(M*ga,Y,X*ga,U,P),P},Q.prototype.rotatePOV=function(M,Y,X){return this.rotation.addInPlace(this.calcRotatePOV(M,Y,X)),this},Q.prototype.calcRotatePOV=function(M,Y,X){var U=this.definedFacingForward?1:-1;return new i.e(M*U,Y,X*U)},Q.prototype.refreshBoundingInfo=function(M){return void 0===M&&(M=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(M),null),this)},Q.prototype._refreshBoundingInfo=function(M,Y){if(M){var X=Object(k.a)(M,0,this.getTotalVertices(),Y);this._boundingInfo?this._boundingInfo.reConstruct(X.minimum,X.maximum):this._boundingInfo=new s.a(X.minimum,X.maximum)}if(this.subMeshes)for(var U=0;U<this.subMeshes.length;U++)this.subMeshes[U].refreshBoundingInfo(M);this._updateBoundingInfo()},Q.prototype._getPositionData=function(M){var Y=this.getVerticesData(D.b.PositionKind);if(Y&&M&&this.skeleton){Y=r.b.Slice(Y),this._generatePointsArray();var X=this.getVerticesData(D.b.MatricesIndicesKind),U=this.getVerticesData(D.b.MatricesWeightsKind);if(U&&X){var P=this.numBoneInfluencers>4,ga=P?this.getVerticesData(D.b.MatricesIndicesExtraKind):null,ma=P?this.getVerticesData(D.b.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var oa=this.skeleton.getTransformMatrices(this),ja=i.c.Vector3[0],aa=i.c.Matrix[0],F=i.c.Matrix[1],$=0,ia=0;ia<Y.length;ia+=3,$+=4){var ba,qa;for(aa.reset(),ba=0;ba<4;ba++)(qa=U[$+ba])>0&&(i.a.FromFloat32ArrayToRefScaled(oa,Math.floor(16*X[$+ba]),qa,F),aa.addToSelf(F));if(P)for(ba=0;ba<4;ba++)(qa=ma[$+ba])>0&&(i.a.FromFloat32ArrayToRefScaled(oa,Math.floor(16*ga[$+ba]),qa,F),aa.addToSelf(F));i.e.TransformCoordinatesFromFloatsToRef(Y[ia],Y[ia+1],Y[ia+2],aa,ja),ja.toArray(Y,ia),this._positions&&this._positions[ia/3].copyFrom(ja)}}}return Y},Q.prototype._updateBoundingInfo=function(){var M=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(M.worldMatrixFromCache):this._boundingInfo=new s.a(this.absolutePosition,this.absolutePosition,M.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(M.worldMatrixFromCache),this},Q.prototype._updateSubMeshesBoundingInfo=function(M){if(!this.subMeshes)return this;for(var Y=this.subMeshes.length,X=0;X<Y;X++){var U=this.subMeshes[X];(Y>1||!U.IsGlobal)&&U.updateBoundingInfo(M)}return this},Q.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(Q.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!0,configurable:!0}),Q.prototype.isInFrustum=function(M){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(M,this.cullingStrategy)},Q.prototype.isCompletelyInFrustum=function(M){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(M)},Q.prototype.intersectsMesh=function(M,Y,X){if(void 0===Y&&(Y=!1),!this._boundingInfo||!M._boundingInfo)return!1;if(this._boundingInfo.intersects(M._boundingInfo,Y))return!0;if(X){for(var U=0,P=this.getChildMeshes();U<P.length;U++)if(P[U].intersectsMesh(M,Y,!0))return!0}return!1},Q.prototype.intersectsPoint=function(M){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(M)},Object.defineProperty(Q.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(M){this._meshCollisionData._checkCollisions=M},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!0,configurable:!0}),Q.prototype.moveWithCollisions=function(M){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var Y=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=Y.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,Y.getNewPosition(this._meshCollisionData._oldPositionForCollisions,M,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},Q.prototype._collideForSubMesh=function(M,Y,X){if(this._generatePointsArray(),!this._positions)return this;if(!M._lastColliderWorldVertices||!M._lastColliderTransformMatrix.equals(Y)){M._lastColliderTransformMatrix=Y.clone(),M._lastColliderWorldVertices=[],M._trianglePlanes=[];for(var U=M.verticesStart,P=M.verticesStart+M.verticesCount,ga=U;ga<P;ga++)M._lastColliderWorldVertices.push(i.e.TransformCoordinates(this._positions[ga],Y))}return X._collide(M._trianglePlanes,M._lastColliderWorldVertices,this.getIndices(),M.indexStart,M.indexStart+M.indexCount,M.verticesStart,!!M.getMaterial(),this),this},Q.prototype._processCollisionsForSubMeshes=function(M,Y){for(var X=this._scene.getCollidingSubMeshCandidates(this,M),U=X.length,P=0;P<U;P++){var ga=X.data[P];U>1&&!ga._checkCollision(M)||this._collideForSubMesh(ga,Y,M)}return this},Q.prototype._checkCollision=function(M){if(!this._boundingInfo||!this._boundingInfo._checkCollision(M))return this;var Y=i.c.Matrix[0],X=i.c.Matrix[1];return i.a.ScalingToRef(1/M._radius.x,1/M._radius.y,1/M._radius.z,Y),this.worldMatrixFromCache.multiplyToRef(Y,X),this._processCollisionsForSubMeshes(M,X),this},Q.prototype._generatePointsArray=function(){return!1},Q.prototype.intersects=function(M,Y,X){var U=new l.a(),P="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,ga=this._boundingInfo;if(!(this.subMeshes&&ga&&M.intersectsSphere(ga.boundingSphere,P)&&M.intersectsBox(ga.boundingBox,P)))return U;if(!this._generatePointsArray())return U;for(var ma=null,oa=this._scene.getIntersectingSubMeshCandidates(this,M),ja=oa.length,aa=0;aa<ja;aa++){var F=oa.data[aa];if(!(ja>1)||F.canIntersects(M)){var $=F.intersects(M,this._positions,this.getIndices(),Y,X);if($&&(Y||!ma||$.distance<ma.distance)&&((ma=$).subMeshId=aa,Y))break}}if(ma){var ia=this.getWorldMatrix(),ba=i.c.Vector3[0],qa=i.c.Vector3[1];i.e.TransformCoordinatesToRef(M.origin,ia,ba),M.direction.scaleToRef(ma.distance,qa);var V=i.e.TransformNormal(qa,ia).addInPlace(ba);return U.hit=!0,U.distance=i.e.Distance(ba,V),U.pickedPoint=V,U.pickedMesh=this,U.bu=ma.bu||0,U.bv=ma.bv||0,U.faceId=ma.faceId,U.subMeshId=ma.subMeshId,U}return U},Q.prototype.clone=function(M,Y,X){return null},Q.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array();return this},Q.prototype.dispose=function(M,Y){var X,U=this;for(void 0===Y&&(Y=!1),this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),X=0;X<this._intersectionsInProgress.length;X++){var P=this._intersectionsInProgress[X],ga=P._intersectionsInProgress.indexOf(this);P._intersectionsInProgress.splice(ga,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(oa){var ja=oa.includedOnlyMeshes.indexOf(U);-1!==ja&&oa.includedOnlyMeshes.splice(ja,1),-1!==(ja=oa.excludedMeshes.indexOf(U))&&oa.excludedMeshes.splice(ja,1);var aa=oa.getShadowGenerator();if(aa){var F=aa.getShadowMap();F&&F.renderList&&-1!==(ja=F.renderList.indexOf(U))&&F.renderList.splice(ja,1)}}),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var ma=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,ma.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),ma.wipeCaches(),this.getScene().removeMesh(this),Y&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!M)for(X=0;X<this.getScene().particleSystems.length;X++)this.getScene().particleSystems[X].emitter===this&&(this.getScene().particleSystems[X].dispose(),X--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),L.prototype.dispose.call(this,M,Y)},Q.prototype.addChild=function(M){return M.setParent(this),this},Q.prototype.removeChild=function(M){return M.setParent(null),this},Q.prototype._initFacetData=function(){var M=this._internalAbstractMeshDataInfo._facetData;M.facetNormals||(M.facetNormals=new Array()),M.facetPositions||(M.facetPositions=new Array()),M.facetPartitioning||(M.facetPartitioning=new Array()),M.facetNb=this.getIndices().length/3|0,M.partitioningSubdivisions=M.partitioningSubdivisions?M.partitioningSubdivisions:10,M.partitioningBBoxRatio=M.partitioningBBoxRatio?M.partitioningBBoxRatio:1.01;for(var Y=0;Y<M.facetNb;Y++)M.facetNormals[Y]=i.e.Zero(),M.facetPositions[Y]=i.e.Zero();return M.facetDataEnabled=!0,this},Q.prototype.updateFacetData=function(){var M=this._internalAbstractMeshDataInfo._facetData;M.facetDataEnabled||this._initFacetData();var Y=this.getVerticesData(D.b.PositionKind),X=this.getIndices(),U=this.getVerticesData(D.b.NormalKind),P=this.getBoundingInfo();if(M.facetDepthSort&&!M.facetDepthSortEnabled){if(M.facetDepthSortEnabled=!0,X instanceof Uint16Array)M.depthSortedIndices=new Uint16Array(X);else if(X instanceof Uint32Array)M.depthSortedIndices=new Uint32Array(X);else{for(var ga=!1,ma=0;ma<X.length;ma++)if(X[ma]>65535){ga=!0;break}M.depthSortedIndices=ga?new Uint32Array(X):new Uint16Array(X)}if(M.facetDepthSortFunction=function(ba,qa){return qa.sqDistance-ba.sqDistance},!M.facetDepthSortFrom){var oa=this.getScene().activeCamera;M.facetDepthSortFrom=oa?oa.position:i.e.Zero()}M.depthSortedFacets=[];for(var ja=0;ja<M.facetNb;ja++){var aa={ind:3*ja,sqDistance:0};M.depthSortedFacets.push(aa)}M.invertedMatrix=i.a.Identity(),M.facetDepthSortOrigin=i.e.Zero()}M.bbSize.x=P.maximum.x-P.minimum.x>u.a?P.maximum.x-P.minimum.x:u.a,M.bbSize.y=P.maximum.y-P.minimum.y>u.a?P.maximum.y-P.minimum.y:u.a,M.bbSize.z=P.maximum.z-P.minimum.z>u.a?P.maximum.z-P.minimum.z:u.a;var F=M.bbSize.x>M.bbSize.y?M.bbSize.x:M.bbSize.y;if(F=F>M.bbSize.z?F:M.bbSize.z,M.subDiv.max=M.partitioningSubdivisions,M.subDiv.X=Math.floor(M.subDiv.max*M.bbSize.x/F),M.subDiv.Y=Math.floor(M.subDiv.max*M.bbSize.y/F),M.subDiv.Z=Math.floor(M.subDiv.max*M.bbSize.z/F),M.subDiv.X=M.subDiv.X<1?1:M.subDiv.X,M.subDiv.Y=M.subDiv.Y<1?1:M.subDiv.Y,M.subDiv.Z=M.subDiv.Z<1?1:M.subDiv.Z,M.facetParameters.facetNormals=this.getFacetLocalNormals(),M.facetParameters.facetPositions=this.getFacetLocalPositions(),M.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),M.facetParameters.bInfo=P,M.facetParameters.bbSize=M.bbSize,M.facetParameters.subDiv=M.subDiv,M.facetParameters.ratio=this.partitioningBBoxRatio,M.facetParameters.depthSort=M.facetDepthSort,M.facetDepthSort&&M.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(M.invertedMatrix),i.e.TransformCoordinatesToRef(M.facetDepthSortFrom,M.invertedMatrix,M.facetDepthSortOrigin),M.facetParameters.distanceTo=M.facetDepthSortOrigin),M.facetParameters.depthSortedFacets=M.depthSortedFacets,E.a.ComputeNormals(Y,X,U,M.facetParameters),M.facetDepthSort&&M.facetDepthSortEnabled){M.depthSortedFacets.sort(M.facetDepthSortFunction);var $=M.depthSortedIndices.length/3|0;for(ja=0;ja<$;ja++){var ia=M.depthSortedFacets[ja].ind;M.depthSortedIndices[3*ja]=X[ia],M.depthSortedIndices[3*ja+1]=X[ia+1],M.depthSortedIndices[3*ja+2]=X[ia+2]}this.updateIndices(M.depthSortedIndices,void 0,!0)}return this},Q.prototype.getFacetLocalNormals=function(){var M=this._internalAbstractMeshDataInfo._facetData;return M.facetNormals||this.updateFacetData(),M.facetNormals},Q.prototype.getFacetLocalPositions=function(){var M=this._internalAbstractMeshDataInfo._facetData;return M.facetPositions||this.updateFacetData(),M.facetPositions},Q.prototype.getFacetLocalPartitioning=function(){var M=this._internalAbstractMeshDataInfo._facetData;return M.facetPartitioning||this.updateFacetData(),M.facetPartitioning},Q.prototype.getFacetPosition=function(M){var Y=i.e.Zero();return this.getFacetPositionToRef(M,Y),Y},Q.prototype.getFacetPositionToRef=function(M,Y){var X=this.getFacetLocalPositions()[M],U=this.getWorldMatrix();return i.e.TransformCoordinatesToRef(X,U,Y),this},Q.prototype.getFacetNormal=function(M){var Y=i.e.Zero();return this.getFacetNormalToRef(M,Y),Y},Q.prototype.getFacetNormalToRef=function(M,Y){var X=this.getFacetLocalNormals()[M];return i.e.TransformNormalToRef(X,this.getWorldMatrix(),Y),this},Q.prototype.getFacetsAtLocalCoordinates=function(M,Y,X){var U=this.getBoundingInfo(),P=this._internalAbstractMeshDataInfo._facetData,ga=Math.floor((M-U.minimum.x*P.partitioningBBoxRatio)*P.subDiv.X*P.partitioningBBoxRatio/P.bbSize.x),ma=Math.floor((Y-U.minimum.y*P.partitioningBBoxRatio)*P.subDiv.Y*P.partitioningBBoxRatio/P.bbSize.y),oa=Math.floor((X-U.minimum.z*P.partitioningBBoxRatio)*P.subDiv.Z*P.partitioningBBoxRatio/P.bbSize.z);return ga<0||ga>P.subDiv.max||ma<0||ma>P.subDiv.max||oa<0||oa>P.subDiv.max?null:P.facetPartitioning[ga+P.subDiv.max*ma+P.subDiv.max*P.subDiv.max*oa]},Q.prototype.getClosestFacetAtCoordinates=function(M,Y,X,U,P,ga){void 0===P&&(P=!1),void 0===ga&&(ga=!0);var ma=this.getWorldMatrix(),oa=i.c.Matrix[5];ma.invertToRef(oa);var ja=i.c.Vector3[8];i.e.TransformCoordinatesFromFloatsToRef(M,Y,X,oa,ja);var aa=this.getClosestFacetAtLocalCoordinates(ja.x,ja.y,ja.z,U,P,ga);return U&&i.e.TransformCoordinatesFromFloatsToRef(U.x,U.y,U.z,ma,U),aa},Q.prototype.getClosestFacetAtLocalCoordinates=function(M,Y,X,U,P,ga){void 0===P&&(P=!1),void 0===ga&&(ga=!0);var ma=null,oa=0,ja=0,aa=0,F=0,$=0,ia=0,ba=0,qa=0,V=this.getFacetLocalPositions(),O=this.getFacetLocalNormals(),S=this.getFacetsAtLocalCoordinates(M,Y,X);if(!S)return null;for(var W,da,na,Ea=Number.MAX_VALUE,Ca=Ea,wa=0;wa<S.length;wa++)da=O[W=S[wa]],F=(M-(na=V[W]).x)*da.x+(Y-na.y)*da.y+(X-na.z)*da.z,(!P||P&&ga&&F>=0||P&&!ga&&F<=0)&&(F=da.x*na.x+da.y*na.y+da.z*na.z,$=-(da.x*M+da.y*Y+da.z*X-F)/(da.x*da.x+da.y*da.y+da.z*da.z),(Ca=(oa=(ia=M+da.x*$)-M)*oa+(ja=(ba=Y+da.y*$)-Y)*ja+(aa=(qa=X+da.z*$)-X)*aa)<Ea&&(Ea=Ca,ma=W,U&&(U.x=ia,U.y=ba,U.z=qa)));return ma},Q.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},Q.prototype.disableFacetData=function(){var M=this._internalAbstractMeshDataInfo._facetData;return M.facetDataEnabled&&(M.facetDataEnabled=!1,M.facetPositions=new Array(),M.facetNormals=new Array(),M.facetPartitioning=new Array(),M.facetParameters=null,M.depthSortedIndices=new Uint32Array(0)),this},Q.prototype.updateIndices=function(M,Y,X){return void 0===X&&(X=!1),this},Q.prototype.createNormals=function(M){var Y,X=this.getVerticesData(D.b.PositionKind),U=this.getIndices();return Y=this.isVerticesDataPresent(D.b.NormalKind)?this.getVerticesData(D.b.NormalKind):[],E.a.ComputeNormals(X,U,Y,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(D.b.NormalKind,Y,M),this},Q.prototype.alignWithNormal=function(M,Y){Y||(Y=A.a.Y);var X=i.c.Vector3[0],U=i.c.Vector3[1];return i.e.CrossToRef(Y,M,U),i.e.CrossToRef(M,U,X),this.rotationQuaternion?i.b.RotationQuaternionFromAxisToRef(X,M,U,this.rotationQuaternion):i.e.RotationFromAxisToRef(X,M,U,this.rotation),this},Q.prototype._checkOcclusionQuery=function(){return!1},Q.prototype.disableEdgesRendering=function(){throw n.a.WarnImport("EdgesRenderer")},Q.prototype.enableEdgesRendering=function(M,Y){throw n.a.WarnImport("EdgesRenderer")},Q.OCCLUSION_TYPE_NONE=0,Q.OCCLUSION_TYPE_OPTIMISTIC=1,Q.OCCLUSION_TYPE_STRICT=2,Q.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,Q.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,Q.CULLINGSTRATEGY_STANDARD=y.a.MESHES_CULLINGSTRATEGY_STANDARD,Q.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=y.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,Q.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=y.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,Q.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=y.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY,Q}(x.a)},function(Ja,t,o){"use strict";o.d(t,"b",function(){return R}),o.d(t,"c",function(){return r}),o.d(t,"a",function(){return I});var R=1/2.2,r=2.2,I=.001},function(Ja,t,o){"use strict";o.d(t,"a",function(){return y});var R=o(1),r=o(3),I=o(13),i=o(6),G=o(23),D=o(57),E=o(83),x=o(2),l=o(7),s=o(60),y=function(){function q(n,k,p){this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new i.c(),this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=x.a.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=q.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this.name=n,this.id=n||I.b.RandomId(),this._scene=k||G.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=q.ClockWiseSideOrientation:this.sideOrientation=q.CounterClockWiseSideOrientation,this._uniformBuffer=new E.a(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,p||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(q.prototype,"alpha",{get:function(){return this._alpha},set:function(n){this._alpha!==n&&(this._alpha=n,this.markAsDirty(q.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(n){this._backFaceCulling!==n&&(this._backFaceCulling=n,this.markAsDirty(q.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"onDispose",{set:function(n){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new i.c()),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"onBind",{set:function(n){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new i.c()),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(n){this._alphaMode!==n&&(this._alphaMode=n,this.markAsDirty(q.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(n){this._needDepthPrePass!==n&&(this._needDepthPrePass=n,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(n){this._fogEnabled!==n&&(this._fogEnabled=n,this.markAsDirty(q.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"wireframe",{get:function(){switch(this._fillMode){case q.WireFrameFillMode:case q.LineListDrawMode:case q.LineLoopDrawMode:case q.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(n){this.fillMode=n?q.WireFrameFillMode:q.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case q.PointFillMode:case q.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(n){this.fillMode=n?q.PointFillMode:q.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"fillMode",{get:function(){return this._fillMode},set:function(n){this._fillMode!==n&&(this._fillMode=n,this.markAsDirty(q.MiscDirtyFlag))},enumerable:!0,configurable:!0}),q.prototype.toString=function(n){return"Name: "+this.name},q.prototype.getClassName=function(){return"Material"},Object.defineProperty(q.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),q.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},q.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},q.prototype.isReady=function(n,k){return!0},q.prototype.isReadyForSubMesh=function(n,k,p){return!1},q.prototype.getEffect=function(){return this._effect},q.prototype.getScene=function(){return this._scene},q.prototype.needAlphaBlending=function(){return this.alpha<1},q.prototype.needAlphaBlendingForMesh=function(n){return this.needAlphaBlending()||n.visibility<1||n.hasVertexAlpha},q.prototype.needAlphaTesting=function(){return!1},q.prototype.getAlphaTestTexture=function(){return null},q.prototype.markDirty=function(){for(var n=0,k=this.getScene().meshes;n<k.length;n++){var p=k[n];if(p.subMeshes)for(var u=0,A=p.subMeshes;u<A.length;u++){var B=A[u];B.getMaterial()===this&&(B.effect&&(B.effect._wasPreviouslyReady=!1))}}},q.prototype._preBind=function(n,k){void 0===k&&(k=null);var p=this._scene.getEngine(),u=(null==k?this.sideOrientation:k)===q.ClockWiseSideOrientation;return p.enableEffect(n||this._effect),p.setState(this.backFaceCulling,this.zOffset,!1,u),u},q.prototype.bind=function(n,k){},q.prototype.bindForSubMesh=function(n,k,p){},q.prototype.bindOnlyWorldMatrix=function(n){},q.prototype.bindSceneUniformBuffer=function(n,k){k.bindToEffect(n,"Scene")},q.prototype.bindView=function(n){this._useUBO?this.bindSceneUniformBuffer(n,this.getScene().getSceneUniformBuffer()):n.setMatrix("view",this.getScene().getViewMatrix())},q.prototype.bindViewProjection=function(n){this._useUBO?this.bindSceneUniformBuffer(n,this.getScene().getSceneUniformBuffer()):n.setMatrix("viewProjection",this.getScene().getTransformMatrix())},q.prototype._shouldTurnAlphaTestOn=function(n){return!this.needAlphaBlendingForMesh(n)&&this.needAlphaTesting()},q.prototype._afterBind=function(n){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=n?n.visibility:1,this._onBindObservable&&n&&this._onBindObservable.notifyObservers(n),this.disableDepthWrite){var k=this._scene.getEngine();this._cachedDepthWriteState=k.getDepthWrite(),k.setDepthWrite(!1)}0!==this.depthFunction&&(k=this._scene.getEngine(),this._cachedDepthFunctionState=k.getDepthFunction()||0,k.setDepthFunction(this.depthFunction))},q.prototype.unbind=function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction)&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},q.prototype.getActiveTextures=function(){return[]},q.prototype.hasTexture=function(n){return!1},q.prototype.clone=function(n){return null},q.prototype.getBindedMeshes=function(){var n=this;if(this.meshMap){var k=new Array();for(var p in this.meshMap){var u=this.meshMap[p];u&&k.push(u)}return k}return this._scene.meshes.filter(function(A){return A.material===n})},q.prototype.forceCompilation=function(n,k,p,u){var A=this,B=Object(R.a)({clipPlane:!1,useInstances:!1},p),v=new D.a(),H=this.getScene(),L=function(){if(A._scene&&A._scene.getEngine()){v._materialDefines&&(v._materialDefines._renderId=-1);var Q=H.clipPlane;B.clipPlane&&(H.clipPlane=new s.a(0,0,0,1)),A._storeEffectOnSubMeshes?A.isReadyForSubMesh(n,v,B.useInstances)?k&&k(A):v.effect&&v.effect.getCompilationError()&&v.effect.allFallbacksProcessed()?u&&u(v.effect.getCompilationError()):setTimeout(L,16):A.isReady()?k&&k(A):setTimeout(L,16),B.clipPlane&&(H.clipPlane=Q)}};L()},q.prototype.forceCompilationAsync=function(n,k){var p=this;return new Promise(function(u,A){p.forceCompilation(n,function(){u()},k,function(B){A(B)})})},q.prototype.markAsDirty=function(n){this.getScene().blockMaterialDirtyMechanism||(q._DirtyCallbackArray.length=0,n&q.TextureDirtyFlag&&q._DirtyCallbackArray.push(q._TextureDirtyCallBack),n&q.LightDirtyFlag&&q._DirtyCallbackArray.push(q._LightsDirtyCallBack),n&q.FresnelDirtyFlag&&q._DirtyCallbackArray.push(q._FresnelDirtyCallBack),n&q.AttributesDirtyFlag&&q._DirtyCallbackArray.push(q._AttributeDirtyCallBack),n&q.MiscDirtyFlag&&q._DirtyCallbackArray.push(q._MiscDirtyCallBack),q._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(q._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},q.prototype._markAllSubMeshesAsDirty=function(n){if(!this.getScene().blockMaterialDirtyMechanism)for(var k=0,p=this.getScene().meshes;k<p.length;k++){var u=p[k];if(u.subMeshes)for(var A=0,B=u.subMeshes;A<B.length;A++){var v=B[A];v.getMaterial()===this&&(v._materialDefines&&n(v._materialDefines))}}},q.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(q._AllDirtyCallBack)},q.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(q._ImageProcessingDirtyCallBack)},q.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(q._TextureDirtyCallBack)},q.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(q._FresnelDirtyCallBack)},q.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(q._FresnelAndMiscDirtyCallBack)},q.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(q._LightsDirtyCallBack)},q.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(q._AttributeDirtyCallBack)},q.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(q._MiscDirtyCallBack)},q.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(q._TextureAndMiscDirtyCallBack)},q.prototype.dispose=function(n,k,p){var u=this.getScene();if(u.stopAnimation(this),u.freeProcessedMaterials(),u.removeMaterial(this),!0!==p)if(this.meshMap)for(var A in this.meshMap)(H=this.meshMap[A])&&(H.material=null,this.releaseVertexArrayObject(H,n));else for(var B=0,v=u.meshes;B<v.length;B++){var H;(H=v[B]).material!==this||H.sourceMesh||(H.material=null,this.releaseVertexArrayObject(H,n))}this._uniformBuffer.dispose(),n&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},q.prototype.releaseVertexArrayObject=function(n,k){if(n.geometry){var p=n.geometry;if(this._storeEffectOnSubMeshes)for(var u=0,A=n.subMeshes;u<A.length;u++){var B=A[u];p._releaseVertexArrayObject(B._materialEffect),k&&B._materialEffect&&B._materialEffect.dispose()}else p._releaseVertexArrayObject(this._effect)}},q.prototype.serialize=function(){return r.a.Serialize(this)},q.Parse=function(n,k,p){if(n.customType){if("BABYLON.PBRMaterial"===n.customType&&n.overloadedAlbedo&&(n.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return l.a.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else n.customType="BABYLON.StandardMaterial";return I.b.Instantiate(n.customType).Parse(n,k,p)},q.TriangleFillMode=x.a.MATERIAL_TriangleFillMode,q.WireFrameFillMode=x.a.MATERIAL_WireFrameFillMode,q.PointFillMode=x.a.MATERIAL_PointFillMode,q.PointListDrawMode=x.a.MATERIAL_PointListDrawMode,q.LineListDrawMode=x.a.MATERIAL_LineListDrawMode,q.LineLoopDrawMode=x.a.MATERIAL_LineLoopDrawMode,q.LineStripDrawMode=x.a.MATERIAL_LineStripDrawMode,q.TriangleStripDrawMode=x.a.MATERIAL_TriangleStripDrawMode,q.TriangleFanDrawMode=x.a.MATERIAL_TriangleFanDrawMode,q.ClockWiseSideOrientation=x.a.MATERIAL_ClockWiseSideOrientation,q.CounterClockWiseSideOrientation=x.a.MATERIAL_CounterClockWiseSideOrientation,q.TextureDirtyFlag=x.a.MATERIAL_TextureDirtyFlag,q.LightDirtyFlag=x.a.MATERIAL_LightDirtyFlag,q.FresnelDirtyFlag=x.a.MATERIAL_FresnelDirtyFlag,q.AttributesDirtyFlag=x.a.MATERIAL_AttributesDirtyFlag,q.MiscDirtyFlag=x.a.MATERIAL_MiscDirtyFlag,q.AllDirtyFlag=x.a.MATERIAL_AllDirtyFlag,q._AllDirtyCallBack=function(n){return n.markAllAsDirty()},q._ImageProcessingDirtyCallBack=function(n){return n.markAsImageProcessingDirty()},q._TextureDirtyCallBack=function(n){return n.markAsTexturesDirty()},q._FresnelDirtyCallBack=function(n){return n.markAsFresnelDirty()},q._MiscDirtyCallBack=function(n){return n.markAsMiscDirty()},q._LightsDirtyCallBack=function(n){return n.markAsLightDirty()},q._AttributeDirtyCallBack=function(n){return n.markAsAttributesDirty()},q._FresnelAndMiscDirtyCallBack=function(n){q._FresnelDirtyCallBack(n),q._MiscDirtyCallBack(n)},q._TextureAndMiscDirtyCallBack=function(n){q._TextureDirtyCallBack(n),q._MiscDirtyCallBack(n)},q._DirtyCallbackArray=[],q._RunDirtyCallBacks=function(n){for(var k=0,p=q._DirtyCallbackArray;k<p.length;k++)(0,p[k])(n)},Object(R.c)([Object(r.c)()],q.prototype,"id",void 0),Object(R.c)([Object(r.c)()],q.prototype,"uniqueId",void 0),Object(R.c)([Object(r.c)()],q.prototype,"name",void 0),Object(R.c)([Object(r.c)()],q.prototype,"checkReadyOnEveryCall",void 0),Object(R.c)([Object(r.c)()],q.prototype,"checkReadyOnlyOnce",void 0),Object(R.c)([Object(r.c)()],q.prototype,"state",void 0),Object(R.c)([Object(r.c)("alpha")],q.prototype,"_alpha",void 0),Object(R.c)([Object(r.c)("backFaceCulling")],q.prototype,"_backFaceCulling",void 0),Object(R.c)([Object(r.c)()],q.prototype,"sideOrientation",void 0),Object(R.c)([Object(r.c)("alphaMode")],q.prototype,"_alphaMode",void 0),Object(R.c)([Object(r.c)()],q.prototype,"_needDepthPrePass",void 0),Object(R.c)([Object(r.c)()],q.prototype,"disableDepthWrite",void 0),Object(R.c)([Object(r.c)()],q.prototype,"forceDepthWrite",void 0),Object(R.c)([Object(r.c)()],q.prototype,"depthFunction",void 0),Object(R.c)([Object(r.c)()],q.prototype,"separateCullingPass",void 0),Object(R.c)([Object(r.c)("fogEnabled")],q.prototype,"_fogEnabled",void 0),Object(R.c)([Object(r.c)()],q.prototype,"pointSize",void 0),Object(R.c)([Object(r.c)()],q.prototype,"zOffset",void 0),Object(R.c)([Object(r.c)()],q.prototype,"wireframe",null),Object(R.c)([Object(r.c)()],q.prototype,"pointsCloud",null),Object(R.c)([Object(r.c)()],q.prototype,"fillMode",null),q}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return x});var R=o(7),r=o(42),I=o(0),i=o(27),G=o(5),D=o(47),E=o(22);G.a._PhysicsImpostorParser=function(l,s,y){return new x(s,y.physicsImpostor,{mass:y.physicsMass,friction:y.physicsFriction,restitution:y.physicsRestitution},l)};var x=function(){function l(s,y,q,n){var k=this;void 0===q&&(q={mass:0}),this.object=s,this.type=y,this._options=q,this._scene=n,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array(),this._onAfterPhysicsStepCallbacks=new Array(),this._onPhysicsCollideCallbacks=[],this._deltaPosition=I.e.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new I.b(),this._tmpQuat2=new I.b(),this.beforeStep=function(){k._physicsEngine&&(k.object.translate(k._deltaPosition,-1),k._deltaRotationConjugated&&k.object.rotationQuaternion&&k.object.rotationQuaternion.multiplyToRef(k._deltaRotationConjugated,k.object.rotationQuaternion),k.object.computeWorldMatrix(!1),k.object.parent&&k.object.rotationQuaternion?(k.getParentsRotation(),k._tmpQuat.multiplyToRef(k.object.rotationQuaternion,k._tmpQuat)):k._tmpQuat.copyFrom(k.object.rotationQuaternion||new I.b()),k._options.disableBidirectionalTransformation||k.object.rotationQuaternion&&k._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(k,k.object.getAbsolutePosition(),k._tmpQuat),k._onBeforePhysicsStepCallbacks.forEach(function(p){p(k)}))},this.afterStep=function(){k._physicsEngine&&(k._onAfterPhysicsStepCallbacks.forEach(function(p){p(k)}),k._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(k),k.object.parent&&k.object.rotationQuaternion&&(k.getParentsRotation(),k._tmpQuat.conjugateInPlace(),k._tmpQuat.multiplyToRef(k.object.rotationQuaternion,k.object.rotationQuaternion)),k.object.setAbsolutePosition(k.object.position),k._deltaRotation&&k.object.rotationQuaternion&&k.object.rotationQuaternion.multiplyToRef(k._deltaRotation,k.object.rotationQuaternion),k.object.translate(k._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(p){if((k._onPhysicsCollideCallbacks.length||k.onCollideEvent)&&k._physicsEngine){var u=k._physicsEngine.getImpostorWithPhysicsBody(p.body);u&&(k.onCollideEvent&&k.onCollideEvent(k,u),k._onPhysicsCollideCallbacks.filter(function(A){return-1!==A.otherImpostors.indexOf(u)}).forEach(function(A){A.callback(k,u)}))}},this.object?(this.object.parent&&0!==q.mass&&R.a.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&s.getScene&&(this._scene=s.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=I.b.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new I.b()),this._options.mass=void 0===q.mass?0:q.mass,this._options.friction=void 0===q.friction?.2:q.friction,this._options.restitution=void 0===q.restitution?.2:q.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===q.pressure?200:q.pressure,this._options.stiffness=void 0===q.stiffness?1:q.stiffness,this._options.velocityIterations=void 0===q.velocityIterations?20:q.velocityIterations,this._options.positionIterations=void 0===q.positionIterations?20:q.positionIterations,this._options.fixedPoints=void 0===q.fixedPoints?0:q.fixedPoints,this._options.margin=void 0===q.margin?0:q.margin,this._options.damping=void 0===q.damping?0:q.damping,this._options.path=void 0===q.path?null:q.path,this._options.shape=void 0===q.shape?null:q.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&R.a.Warn("You must affect impostors to children before affecting impostor to parent.")):R.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):R.a.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(l.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(s){this.setMass(s)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(s){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,s)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(s){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,s)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var s=this._physicsEngine.getPhysicsPlugin();return s.setBodyPressure?s.getBodyPressure(this):0},set:function(s){if(this._physicsEngine){var y=this._physicsEngine.getPhysicsPlugin();y.setBodyPressure&&y.setBodyPressure(this,s)}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var s=this._physicsEngine.getPhysicsPlugin();return s.getBodyStiffness?s.getBodyStiffness(this):0},set:function(s){if(this._physicsEngine){var y=this._physicsEngine.getPhysicsPlugin();y.setBodyStiffness&&y.setBodyStiffness(this,s)}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var s=this._physicsEngine.getPhysicsPlugin();return s.getBodyVelocityIterations?s.getBodyVelocityIterations(this):0},set:function(s){if(this._physicsEngine){var y=this._physicsEngine.getPhysicsPlugin();y.setBodyVelocityIterations&&y.setBodyVelocityIterations(this,s)}},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var s=this._physicsEngine.getPhysicsPlugin();return s.getBodyPositionIterations?s.getBodyPositionIterations(this):0},set:function(s){if(this._physicsEngine){var y=this._physicsEngine.getPhysicsPlugin();y.setBodyPositionIterations&&y.setBodyPositionIterations(this,s)}},enumerable:!0,configurable:!0}),l.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},l.prototype._getPhysicsParent=function(){return this.object.parent instanceof i.a?this.object.parent.physicsImpostor:null},l.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},l.prototype.setScalingUpdated=function(){this.forceUpdate()},l.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(l.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(s){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=s,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(s){this._parent=s},enumerable:!0,configurable:!0}),l.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},l.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var s=this.object.rotationQuaternion;this.object.rotationQuaternion=l.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var y=this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=s,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),y}return l.DEFAULT_OBJECT_SIZE},l.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},l.prototype.getParam=function(s){return this._options[s]},l.prototype.setParam=function(s,y){this._options[s]=y,this._bodyUpdateRequired=!0},l.prototype.setMass=function(s){this.getParam("mass")!==s&&this.setParam("mass",s),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,s)},l.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):I.e.Zero()},l.prototype.setLinearVelocity=function(s){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,s)},l.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):I.e.Zero()},l.prototype.setAngularVelocity=function(s){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,s)},l.prototype.executeNativeFunction=function(s){this._physicsEngine&&s(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},l.prototype.registerBeforePhysicsStep=function(s){this._onBeforePhysicsStepCallbacks.push(s)},l.prototype.unregisterBeforePhysicsStep=function(s){var y=this._onBeforePhysicsStepCallbacks.indexOf(s);y>-1?this._onBeforePhysicsStepCallbacks.splice(y,1):R.a.Warn("Function to remove was not found")},l.prototype.registerAfterPhysicsStep=function(s){this._onAfterPhysicsStepCallbacks.push(s)},l.prototype.unregisterAfterPhysicsStep=function(s){var y=this._onAfterPhysicsStepCallbacks.indexOf(s);y>-1?this._onAfterPhysicsStepCallbacks.splice(y,1):R.a.Warn("Function to remove was not found")},l.prototype.registerOnPhysicsCollide=function(s,y){var q=s instanceof Array?s:[s];this._onPhysicsCollideCallbacks.push({callback:y,otherImpostors:q})},l.prototype.unregisterOnPhysicsCollide=function(s,y){var q=s instanceof Array?s:[s],n=-1;this._onPhysicsCollideCallbacks.some(function(k,p){if(k.callback===y&&k.otherImpostors.length===q.length){var u=k.otherImpostors.every(function(A){return q.indexOf(A)>-1});return u&&(n=p),u}return!1})?this._onPhysicsCollideCallbacks.splice(n,1):R.a.Warn("Function to remove was not found")},l.prototype.getParentsRotation=function(){var s=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);s;)s.rotationQuaternion?this._tmpQuat2.copyFrom(s.rotationQuaternion):I.b.RotationYawPitchRollToRef(s.rotation.y,s.rotation.x,s.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),s=s.parent;return this._tmpQuat},l.prototype.applyForce=function(s,y){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,s,y),this},l.prototype.applyImpulse=function(s,y){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,s,y),this},l.prototype.createJoint=function(s,y,q){var n=new D.e(y,q);return this.addJoint(s,n),this},l.prototype.addJoint=function(s,y){return this._joints.push({otherImpostor:s,joint:y}),this._physicsEngine&&this._physicsEngine.addJoint(this,s,y),this},l.prototype.addAnchor=function(s,y,q,n,k){if(!this._physicsEngine)return this;var p=this._physicsEngine.getPhysicsPlugin();return p.appendAnchor?(this._physicsEngine&&p.appendAnchor(this,s,y,q,n,k),this):this},l.prototype.addHook=function(s,y,q,n){if(!this._physicsEngine)return this;var k=this._physicsEngine.getPhysicsPlugin();return k.appendAnchor?(this._physicsEngine&&k.appendHook(this,s,y,q,n),this):this},l.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},l.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},l.prototype.clone=function(s){return s?new l(s,this.type,this._options,this._scene):null},l.prototype.dispose=function(){var s=this;this._physicsEngine&&(this._joints.forEach(function(y){s._physicsEngine&&s._physicsEngine.removeJoint(s,y.otherImpostor,y.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},l.prototype.setDeltaPosition=function(s){this._deltaPosition.copyFrom(s)},l.prototype.setDeltaRotation=function(s){this._deltaRotation||(this._deltaRotation=new I.b()),this._deltaRotation.copyFrom(s),this._deltaRotationConjugated=this._deltaRotation.conjugate()},l.prototype.getBoxSizeToRef=function(s){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,s),this},l.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},l.prototype.syncBoneWithImpostor=function(s,y,q,n,k){var p=l._tmpVecs[0],u=this.object;if(u.rotationQuaternion)if(k){var A=l._tmpQuat;u.rotationQuaternion.multiplyToRef(k,A),s.setRotationQuaternion(A,E.b.WORLD,y)}else s.setRotationQuaternion(u.rotationQuaternion,E.b.WORLD,y);p.x=0,p.y=0,p.z=0,q&&(p.x=q.x,p.y=q.y,p.z=q.z,s.getDirectionToRef(p,y,p),null==n&&(n=q.length()),p.x*=n,p.y*=n,p.z*=n),s.getParent()?(p.addInPlace(u.getAbsolutePosition()),s.setAbsolutePosition(p,y)):(y.setAbsolutePosition(u.getAbsolutePosition()),y.position.x-=p.x,y.position.y-=p.y,y.position.z-=p.z)},l.prototype.syncImpostorWithBone=function(s,y,q,n,k,p){var u=this.object;if(u.rotationQuaternion)if(k){var A=l._tmpQuat;s.getRotationQuaternionToRef(E.b.WORLD,y,A),A.multiplyToRef(k,u.rotationQuaternion)}else s.getRotationQuaternionToRef(E.b.WORLD,y,u.rotationQuaternion);var B=l._tmpVecs[0],v=l._tmpVecs[1];p||((p=l._tmpVecs[2]).x=0,p.y=1,p.z=0),s.getDirectionToRef(p,y,v),s.getAbsolutePositionToRef(y,B),null==n&&q&&(n=q.length()),null!=n&&(B.x+=v.x*n,B.y+=v.y*n,B.z+=v.z*n),u.setAbsolutePosition(B)},l.DEFAULT_OBJECT_SIZE=new I.e(1,1,1),l.IDENTITY_QUATERNION=I.b.Identity(),l._tmpVecs=r.a.BuildArray(3,I.e.Zero),l._tmpQuat=I.b.Identity(),l.NoImpostor=0,l.SphereImpostor=1,l.BoxImpostor=2,l.PlaneImpostor=3,l.MeshImpostor=4,l.CapsuleImpostor=6,l.CylinderImpostor=7,l.ParticleImpostor=8,l.HeightmapImpostor=9,l.ConvexHullImpostor=10,l.CustomImpostor=100,l.RopeImpostor=101,l.ClothImpostor=102,l.SoftbodyImpostor=103,l}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return A});var R=o(23),r=o(8),I=o(19),i=o(6),G=o(127),D=o(128),E=o(129),x=o(2),l=o(25),s=o(7),y=o(38),q=o(109),n=o(84),k=o(130),p=o(70),u=function(){},A=function(){function B(v,H,L,Q){var M=this;void 0===Q&&(Q=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array(),this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array(),this.onContextLostObservable=new i.c(),this.onContextRestoredObservable=new i.c(),this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new G.a(),this._stencilState=new D.a(),this._alphaState=new E.a(),this._alphaMode=x.a.ALPHA_ADD,this._alphaEquation=x.a.ALPHA_DISABLE,this._internalTexturesCache=new Array(),this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array(),this._currentFramebuffer=null,this._currentBufferPointers=new Array(),this._currentInstanceLocations=new Array(),this._currentInstanceBuffers=new Array(),this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array(),this._maxSimultaneousTextures=0,this._activeRequests=new Array(),this._texturesSupported=new Array(),this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new i.c(),this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(S,W,da,na,Ea,Ca){var wa=M._gl,Ka=wa.createRenderbuffer();return wa.bindRenderbuffer(wa.RENDERBUFFER,Ka),da>1&&wa.renderbufferStorageMultisample?wa.renderbufferStorageMultisample(wa.RENDERBUFFER,da,Ea,S,W):wa.renderbufferStorage(wa.RENDERBUFFER,na,S,W),wa.framebufferRenderbuffer(wa.FRAMEBUFFER,Ca,wa.RENDERBUFFER,Ka),wa.bindRenderbuffer(wa.RENDERBUFFER,null),Ka},this._boundUniforms={};var Y=null;if(v){if(L=L||{},v.getContext){if(Y=v,this._renderingCanvas=Y,null!=H&&(L.antialias=H),void 0===L.deterministicLockstep&&(L.deterministicLockstep=!1),void 0===L.lockstepMaxSteps&&(L.lockstepMaxSteps=4),void 0===L.timeStep&&(L.timeStep=1/60),void 0===L.preserveDrawingBuffer&&(L.preserveDrawingBuffer=!1),void 0===L.audioEngine&&(L.audioEngine=!0),void 0===L.stencil&&(L.stencil=!0),!1===L.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._doNotHandleContextLost=!!L.doNotHandleContextLost,navigator&&navigator.userAgent)for(var X=navigator.userAgent,U=0,P=B.ExceptionList;U<P.length;U++){var ga=P[U],ma=ga.key,oa=ga.targets;if(new RegExp(ma).test(X)){if(ga.capture&&ga.captureConstraint){var ja=ga.capture,aa=ga.captureConstraint,F=new RegExp(ja).exec(X);if(F&&F.length>0){if(parseInt(F[F.length-1])>=aa)continue}}for(var $=0,ia=oa;$<ia.length;$++)switch(ia[$]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}if(this._doNotHandleContextLost||(this._onContextLost=function(S){S.preventDefault(),M._contextWasLost=!0,s.a.Warn("WebGL context lost."),M.onContextLostObservable.notifyObservers(M)},this._onContextRestored=function(){setTimeout(function(){M._initGLContext(),M._rebuildEffects(),M._rebuildInternalTextures(),M._rebuildBuffers(),M.wipeCaches(!0),s.a.Warn("WebGL context successfully restored."),M.onContextRestoredObservable.notifyObservers(M),M._contextWasLost=!1},0)},Y.addEventListener("webglcontextlost",this._onContextLost,!1),Y.addEventListener("webglcontextrestored",this._onContextRestored,!1),L.powerPreference="high-performance"),!L.disableWebGL2Support)try{this._gl=Y.getContext("webgl2",L)||Y.getContext("experimental-webgl2",L),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(S){}if(!this._gl){if(!Y)throw new Error("The provided canvas is null or undefined.");try{this._gl=Y.getContext("webgl",L)||Y.getContext("experimental-webgl",L)}catch(S){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=v,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var ba=this._gl.getContextAttributes();ba&&(L.stencil=ba.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==L.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=L.useHighPrecisionFloats);var qa=y.a.IsWindowObjectExist()&&window.devicePixelRatio||1,V=L.limitDeviceRatio||qa;this._hardwareScalingLevel=Q?1/Math.min(V,qa):1,this.resize(),this._isStencilEnable=!!L.stencil,this._initGLContext();for(var O=0;O<this._caps.maxVertexAttribs;O++)this._currentBufferPointers[O]=new u();this.webGLVersion>1&&(this._shaderProcessor=new q.a()),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=L,console.log("Babylon.js v"+B.Version+" - "+this.description)}}return Object.defineProperty(B,"NpmPackage",{get:function(){return"babylonjs@4.1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(B,"Version",{get:function(){return"4.1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"description",{get:function(){var v="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(v+=" - Parallel shader compilation"),v},enumerable:!0,configurable:!0}),Object.defineProperty(B,"ShadersRepository",{get:function(){return r.a.ShadersRepository},set:function(v){r.a.ShadersRepository=v},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(v){this._doNotHandleContextLost=v},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"framebufferDimensionsObject",{set:function(v){this._framebufferDimensionsObject=v},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,x.a.TEXTUREFORMAT_RGBA,!1,!1,x.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,x.a.TEXTUREFORMAT_RGBA,!1,!1,x.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,x.a.TEXTUREFORMAT_RGBA,!1,!1,x.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture2DArray},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var v=new Uint8Array(4),H=[v,v,v,v,v,v];this._emptyCubeTexture=this.createRawCubeTexture(H,1,x.a.TEXTUREFORMAT_RGBA,x.a.TEXTURETYPE_UNSIGNED_INT,!1,!1,x.a.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),B.prototype._rebuildInternalTextures=function(){for(var v=0,H=this._internalTexturesCache.slice();v<H.length;v++)H[v]._rebuild()},B.prototype._rebuildEffects=function(){for(var v in this._compiledEffects)this._compiledEffects[v]._prepareEffect();r.a.ResetCache()},B.prototype.areAllEffectsReady=function(){for(var v in this._compiledEffects)if(!this._compiledEffects[v].isReady())return!1;return!0},B.prototype._rebuildBuffers=function(){for(var v=0,H=this._uniformBuffers;v<H.length;v++)H[v]._rebuild()},B.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var v=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=v&&(this._glRenderer=this._gl.getParameter(v.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(v.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var H=this._gl.getExtension("WEBGL_draw_buffers");if(null!==H){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=H.drawBuffersWEBGL.bind(H),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var L=0;L<16;L++)this._gl["COLOR_ATTACHMENT"+L+"_WEBGL"]=H["COLOR_ATTACHMENT"+L+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var Q=this._gl.getExtension("WEBGL_depth_texture");null!=Q&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=Q.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var M=this._gl.getExtension("OES_vertex_array_object");null!=M&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=M.createVertexArrayOES.bind(M),this._gl.bindVertexArray=M.bindVertexArrayOES.bind(M),this._gl.deleteVertexArray=M.deleteVertexArrayOES.bind(M))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var Y=this._gl.getExtension("ANGLE_instanced_arrays");null!=Y?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=Y.drawArraysInstancedANGLE.bind(Y),this._gl.drawElementsInstanced=Y.drawElementsInstancedANGLE.bind(Y),this._gl.vertexAttribDivisor=Y.vertexAttribDivisorANGLE.bind(Y)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var X=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),U=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);X&&U&&(this._caps.highPrecisionShaderSupported=0!==X.precision&&0!==U.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var P=this._gl.getExtension("EXT_blend_minmax");null!=P&&(this._caps.blendMinMax=!0,this._gl.MAX=P.MAX_EXT,this._gl.MIN=P.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var ga=0;ga<this._maxSimultaneousTextures;ga++)this._nextFreeTextureSlots.push(ga)},Object.defineProperty(B.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),B.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(B.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),B.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=p.a.CreateCanvas(1,1);var v=this._workingCanvas.getContext("2d");v&&(this._workingContext=v)}},B.prototype.resetTextureCache=function(){for(var v in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(v)&&(this._boundTexturesCache[v]=null);this._currentTextureChannel=-1},B.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},B.prototype.setHardwareScalingLevel=function(v){this._hardwareScalingLevel=v,this.resize()},B.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},B.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},B.prototype.getCaps=function(){return this._caps},B.prototype.stopRenderLoop=function(v){if(v){var H=this._activeRenderLoops.indexOf(v);H>=0&&this._activeRenderLoops.splice(H,1)}else this._activeRenderLoops=[]},B.prototype._renderLoop=function(){if(!this._contextWasLost){var v=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(v=!1),v){this.beginFrame();for(var H=0;H<this._activeRenderLoops.length;H++)(0,this._activeRenderLoops[H])();this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},B.prototype.getRenderingCanvas=function(){return this._renderingCanvas},B.prototype.getHostWindow=function(){return y.a.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},B.prototype.getRenderWidth=function(v){return void 0===v&&(v=!1),!v&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},B.prototype.getRenderHeight=function(v){return void 0===v&&(v=!1),!v&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},B.prototype._queueNewFrame=function(v,H){return B.QueueNewFrame(v,H)},B.prototype.runRenderLoop=function(v){-1===this._activeRenderLoops.indexOf(v)&&(this._activeRenderLoops.push(v),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},B.prototype.clear=function(v,H,L,Q){void 0===Q&&(Q=!1),this.applyStates();var M=0;H&&v&&(this._gl.clearColor(v.r,v.g,v.b,void 0!==v.a?v.a:1),M|=this._gl.COLOR_BUFFER_BIT),L&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),M|=this._gl.DEPTH_BUFFER_BIT),Q&&(this._gl.clearStencil(0),M|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(M)},B.prototype._viewport=function(v,H,L,Q){v===this._viewportCached.x&&H===this._viewportCached.y&&L===this._viewportCached.z&&Q===this._viewportCached.w||(this._viewportCached.x=v,this._viewportCached.y=H,this._viewportCached.z=L,this._viewportCached.w=Q,this._gl.viewport(v,H,L,Q))},B.prototype.setViewport=function(v,H,L){var Q=H||this.getRenderWidth(),M=L||this.getRenderHeight(),Y=v.x||0,X=v.y||0;this._cachedViewport=v,this._viewport(Y*Q,X*M,Q*v.width,M*v.height)},B.prototype.beginFrame=function(){},B.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},B.prototype.resize=function(){var v,H;y.a.IsWindowObjectExist()?(v=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,H=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight):(v=this._renderingCanvas?this._renderingCanvas.width:100,H=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(v/this._hardwareScalingLevel,H/this._hardwareScalingLevel)},B.prototype.setSize=function(v,H){this._renderingCanvas&&(v|=0,H|=0,this._renderingCanvas.width===v&&this._renderingCanvas.height===H||(this._renderingCanvas.width=v,this._renderingCanvas.height=H))},B.prototype.bindFramebuffer=function(v,H,L,Q,M,Y,X){void 0===H&&(H=0),void 0===Y&&(Y=0),void 0===X&&(X=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=v,this._bindUnboundFramebuffer(v._MSAAFramebuffer?v._MSAAFramebuffer:v._framebuffer);var U=this._gl;v.is2DArray?U.framebufferTextureLayer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,v._webGLTexture,Y,X):v.isCube&&U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_CUBE_MAP_POSITIVE_X+H,v._webGLTexture,Y);var P=v._depthStencilTexture;if(P){var ga=P._generateStencilBuffer?U.DEPTH_STENCIL_ATTACHMENT:U.DEPTH_ATTACHMENT;v.is2DArray?U.framebufferTextureLayer(U.FRAMEBUFFER,ga,P._webGLTexture,Y,X):v.isCube?U.framebufferTexture2D(U.FRAMEBUFFER,ga,U.TEXTURE_CUBE_MAP_POSITIVE_X+H,P._webGLTexture,Y):U.framebufferTexture2D(U.FRAMEBUFFER,ga,U.TEXTURE_2D,P._webGLTexture,Y)}this._cachedViewport&&!M?this.setViewport(this._cachedViewport,L,Q):(L||(L=v.width,Y&&(L/=Math.pow(2,Y))),Q||(Q=v.height,Y&&(Q/=Math.pow(2,Y))),this._viewport(0,0,L,Q)),this.wipeCaches()},B.prototype._bindUnboundFramebuffer=function(v){this._currentFramebuffer!==v&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,v),this._currentFramebuffer=v)},B.prototype.unBindFramebuffer=function(v,H,L){void 0===H&&(H=!1),this._currentRenderTarget=null;var Q=this._gl;v._MSAAFramebuffer&&(Q.bindFramebuffer(Q.READ_FRAMEBUFFER,v._MSAAFramebuffer),Q.bindFramebuffer(Q.DRAW_FRAMEBUFFER,v._framebuffer),Q.blitFramebuffer(0,0,v.width,v.height,0,0,v.width,v.height,Q.COLOR_BUFFER_BIT,Q.NEAREST)),!v.generateMipMaps||H||v.isCube||(this._bindTextureDirectly(Q.TEXTURE_2D,v,!0),Q.generateMipmap(Q.TEXTURE_2D),this._bindTextureDirectly(Q.TEXTURE_2D,null)),L&&(v._MSAAFramebuffer&&this._bindUnboundFramebuffer(v._framebuffer),L()),this._bindUnboundFramebuffer(null)},B.prototype.flushFramebuffer=function(){this._gl.flush()},B.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},B.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},B.prototype.createVertexBuffer=function(v){return this._createVertexBuffer(v,this._gl.STATIC_DRAW)},B.prototype._createVertexBuffer=function(v,H){var L=this._gl.createBuffer();if(!L)throw new Error("Unable to create vertex buffer");var Q=new n.a(L);return this.bindArrayBuffer(Q),v instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(v),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,v,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),Q.references=1,Q},B.prototype.createDynamicVertexBuffer=function(v){return this._createVertexBuffer(v,this._gl.DYNAMIC_DRAW)},B.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},B.prototype.createIndexBuffer=function(v,H){var L=this._gl.createBuffer(),Q=new n.a(L);if(!L)throw new Error("Unable to create index buffer");this.bindIndexBuffer(Q);var M=this._normalizeIndexData(v);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,M,H?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),Q.references=1,Q.is32Bits=4===M.BYTES_PER_ELEMENT,Q},B.prototype._normalizeIndexData=function(v){if(v instanceof Uint16Array)return v;if(this._caps.uintIndices){if(v instanceof Uint32Array)return v;for(var H=0;H<v.length;H++)if(v[H]>=65535)return new Uint32Array(v);return new Uint16Array(v)}return new Uint16Array(v)},B.prototype.bindArrayBuffer=function(v){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(v,this._gl.ARRAY_BUFFER)},B.prototype.bindUniformBlock=function(v,H,L){var Q=v.program,M=this._gl.getUniformBlockIndex(Q,H);this._gl.uniformBlockBinding(Q,M,L)},B.prototype.bindIndexBuffer=function(v){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(v,this._gl.ELEMENT_ARRAY_BUFFER)},B.prototype.bindBuffer=function(v,H){(this._vaoRecordInProgress||this._currentBoundBuffer[H]!==v)&&(this._gl.bindBuffer(H,v?v.underlyingResource:null),this._currentBoundBuffer[H]=v)},B.prototype.updateArrayBuffer=function(v){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,v)},B.prototype._vertexAttribPointer=function(v,H,L,Q,M,Y,X){var U=this._currentBufferPointers[H],P=!1;U.active?(U.buffer!==v&&(U.buffer=v,P=!0),U.size!==L&&(U.size=L,P=!0),U.type!==Q&&(U.type=Q,P=!0),U.normalized!==M&&(U.normalized=M,P=!0),U.stride!==Y&&(U.stride=Y,P=!0),U.offset!==X&&(U.offset=X,P=!0)):(P=!0,U.active=!0,U.index=H,U.size=L,U.type=Q,U.normalized=M,U.stride=Y,U.offset=X,U.buffer=v),(P||this._vaoRecordInProgress)&&(this.bindArrayBuffer(v),this._gl.vertexAttribPointer(H,L,Q,M,Y,X))},B.prototype._bindIndexBufferWithCache=function(v){null!=v&&this._cachedIndexBuffer!==v&&(this._cachedIndexBuffer=v,this.bindIndexBuffer(v),this._uintIndicesCurrentlySet=v.is32Bits)},B.prototype._bindVertexBuffersAttributes=function(v,H){var L=H.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var Q=0;Q<L.length;Q++){var M=H.getAttributeLocation(Q);if(M>=0){var Y=v[L[Q]];if(!Y)continue;this._gl.enableVertexAttribArray(M),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[M]=!0);var X=Y.getBuffer();X&&(this._vertexAttribPointer(X,M,Y.getSize(),Y.type,Y.normalized,Y.byteStride,Y.byteOffset),Y.getIsInstanced()&&(this._gl.vertexAttribDivisor(M,Y.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(M),this._currentInstanceBuffers.push(X))))}}},B.prototype.recordVertexArrayObject=function(v,H,L){var Q=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(Q),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(v,L),this.bindIndexBuffer(H),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),Q},B.prototype.bindVertexArrayObject=function(v,H){this._cachedVertexArrayObject!==v&&(this._cachedVertexArrayObject=v,this._gl.bindVertexArray(v),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=H&&H.is32Bits,this._mustWipeVertexAttributes=!0)},B.prototype.bindBuffersDirectly=function(v,H,L,Q,M){if(this._cachedVertexBuffers!==v||this._cachedEffectForVertexBuffers!==M){this._cachedVertexBuffers=v,this._cachedEffectForVertexBuffers=M;var Y=M.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var X=0,U=0;U<Y;U++)if(U<L.length){var P=M.getAttributeLocation(U);P>=0&&(this._gl.enableVertexAttribArray(P),this._vertexAttribArraysEnabled[P]=!0,this._vertexAttribPointer(v,P,L[U],this._gl.FLOAT,!1,Q,X)),X+=4*L[U]}}this._bindIndexBufferWithCache(H)},B.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},B.prototype.bindBuffers=function(v,H,L){this._cachedVertexBuffers===v&&this._cachedEffectForVertexBuffers===L||(this._cachedVertexBuffers=v,this._cachedEffectForVertexBuffers=L,this._bindVertexBuffersAttributes(v,L)),this._bindIndexBufferWithCache(H)},B.prototype.unbindInstanceAttributes=function(){for(var v,H=0,L=this._currentInstanceLocations.length;H<L;H++){var Q=this._currentInstanceBuffers[H];v!=Q&&Q.references&&(v=Q,this.bindArrayBuffer(Q));var M=this._currentInstanceLocations[H];this._gl.vertexAttribDivisor(M,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},B.prototype.releaseVertexArrayObject=function(v){this._gl.deleteVertexArray(v)},B.prototype._releaseBuffer=function(v){return v.references--,0===v.references&&(this._deleteBuffer(v),!0)},B.prototype._deleteBuffer=function(v){this._gl.deleteBuffer(v.underlyingResource)},B.prototype.updateAndBindInstancesBuffer=function(v,H,L){if(this.bindArrayBuffer(v),H&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,H),void 0!==L[0].index)this.bindInstancesBuffer(v,L,!0);else for(var Q=0;Q<4;Q++){var M=L[Q];this._vertexAttribArraysEnabled[M]||(this._gl.enableVertexAttribArray(M),this._vertexAttribArraysEnabled[M]=!0),this._vertexAttribPointer(v,M,4,this._gl.FLOAT,!1,64,16*Q),this._gl.vertexAttribDivisor(M,1),this._currentInstanceLocations.push(M),this._currentInstanceBuffers.push(v)}},B.prototype.bindInstancesBuffer=function(v,H,L){void 0===L&&(L=!0),this.bindArrayBuffer(v);var Q=0;if(L)for(var M=0;M<H.length;M++)Q+=4*(Y=H[M]).attributeSize;for(M=0;M<H.length;M++){var Y;void 0===(Y=H[M]).index&&(Y.index=this._currentEffect.getAttributeLocationByName(Y.attributeName)),this._vertexAttribArraysEnabled[Y.index]||(this._gl.enableVertexAttribArray(Y.index),this._vertexAttribArraysEnabled[Y.index]=!0),this._vertexAttribPointer(v,Y.index,Y.attributeSize,Y.attributeType||this._gl.FLOAT,Y.normalized||!1,Q,Y.offset),this._gl.vertexAttribDivisor(Y.index,void 0===Y.divisor?1:Y.divisor),this._currentInstanceLocations.push(Y.index),this._currentInstanceBuffers.push(v)}},B.prototype.disableInstanceAttributeByName=function(v){if(this._currentEffect){var H=this._currentEffect.getAttributeLocationByName(v);this.disableInstanceAttribute(H)}},B.prototype.disableInstanceAttribute=function(v){for(var H,L=!1;-1!==(H=this._currentInstanceLocations.indexOf(v));)this._currentInstanceLocations.splice(H,1),this._currentInstanceBuffers.splice(H,1),L=!0,H=this._currentInstanceLocations.indexOf(v);L&&(this._gl.vertexAttribDivisor(v,0),this.disableAttributeByIndex(v))},B.prototype.disableAttributeByIndex=function(v){this._gl.disableVertexAttribArray(v),this._vertexAttribArraysEnabled[v]=!1,this._currentBufferPointers[v].active=!1},B.prototype.draw=function(v,H,L,Q){this.drawElementsType(v?x.a.MATERIAL_TriangleFillMode:x.a.MATERIAL_WireFrameFillMode,H,L,Q)},B.prototype.drawPointClouds=function(v,H,L){this.drawArraysType(x.a.MATERIAL_PointFillMode,v,H,L)},B.prototype.drawUnIndexed=function(v,H,L,Q){this.drawArraysType(v?x.a.MATERIAL_TriangleFillMode:x.a.MATERIAL_WireFrameFillMode,H,L,Q)},B.prototype.drawElementsType=function(v,H,L,Q){this.applyStates(),this._reportDrawCall();var M=this._drawMode(v),Y=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,X=this._uintIndicesCurrentlySet?4:2;Q?this._gl.drawElementsInstanced(M,L,Y,H*X,Q):this._gl.drawElements(M,L,Y,H*X)},B.prototype.drawArraysType=function(v,H,L,Q){this.applyStates(),this._reportDrawCall();var M=this._drawMode(v);Q?this._gl.drawArraysInstanced(M,H,L,Q):this._gl.drawArrays(M,H,L)},B.prototype._drawMode=function(v){switch(v){case x.a.MATERIAL_TriangleFillMode:return this._gl.TRIANGLES;case x.a.MATERIAL_PointFillMode:return this._gl.POINTS;case x.a.MATERIAL_WireFrameFillMode:return this._gl.LINES;case x.a.MATERIAL_PointListDrawMode:return this._gl.POINTS;case x.a.MATERIAL_LineListDrawMode:return this._gl.LINES;case x.a.MATERIAL_LineLoopDrawMode:return this._gl.LINE_LOOP;case x.a.MATERIAL_LineStripDrawMode:return this._gl.LINE_STRIP;case x.a.MATERIAL_TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case x.a.MATERIAL_TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},B.prototype._reportDrawCall=function(){},B.prototype._releaseEffect=function(v){this._compiledEffects[v._key]&&(delete this._compiledEffects[v._key],this._deletePipelineContext(v.getPipelineContext()))},B.prototype._deletePipelineContext=function(v){var H=v;H&&H.program&&(H.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(H.program))},B.prototype.createEffect=function(v,H,L,Q,M,Y,X,U,P){var ga=(v.vertexElement||v.vertex||v)+"+"+(v.fragmentElement||v.fragment||v)+"@"+(M||H.defines);if(this._compiledEffects[ga]){var ma=this._compiledEffects[ga];return X&&ma.isReady()&&X(ma),ma}var oa=new r.a(v,H,L,Q,this,M,Y,X,U,P);return oa._key=ga,this._compiledEffects[ga]=oa,oa},B._ConcatenateShader=function(v,H,L){return void 0===L&&(L=""),L+(H?H+`
`:"")+v},B.prototype._compileShader=function(v,H,L,Q){return this._compileRawShader(B._ConcatenateShader(v,L,Q),H)},B.prototype._compileRawShader=function(v,H){var L=this._gl,Q=L.createShader("vertex"===H?L.VERTEX_SHADER:L.FRAGMENT_SHADER);if(!Q)throw new Error("Something went wrong while compile the shader.");return L.shaderSource(Q,v),L.compileShader(Q),Q},B.prototype.createRawShaderProgram=function(v,H,L,Q,M){void 0===M&&(M=null),Q=Q||this._gl;var Y=this._compileRawShader(H,"vertex"),X=this._compileRawShader(L,"fragment");return this._createShaderProgram(v,Y,X,Q,M)},B.prototype.createShaderProgram=function(v,H,L,Q,M,Y){void 0===Y&&(Y=null),M=M||this._gl;var X=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",U=this._compileShader(H,"vertex",Q,X),P=this._compileShader(L,"fragment",Q,X);return this._createShaderProgram(v,U,P,M,Y)},B.prototype.createPipelineContext=function(){var v=new k.a();return v.engine=this,this._caps.parallelShaderCompile&&(v.isParallelCompiled=!0),v},B.prototype._createShaderProgram=function(v,H,L,Q,M){void 0===M&&(M=null);var Y=Q.createProgram();if(v.program=Y,!Y)throw new Error("Unable to create program");return Q.attachShader(Y,H),Q.attachShader(Y,L),Q.linkProgram(Y),v.context=Q,v.vertexShader=H,v.fragmentShader=L,v.isParallelCompiled||this._finalizePipelineContext(v),Y},B.prototype._finalizePipelineContext=function(v){var H=v.context,L=v.vertexShader,Q=v.fragmentShader,M=v.program;if(!H.getProgramParameter(M,H.LINK_STATUS)){var Y,X;if(!this._gl.getShaderParameter(L,this._gl.COMPILE_STATUS)){if(Y=this._gl.getShaderInfoLog(L))throw v.vertexCompilationError=Y,new Error("VERTEX SHADER "+Y)}if(!this._gl.getShaderParameter(Q,this._gl.COMPILE_STATUS)){if(Y=this._gl.getShaderInfoLog(Q))throw v.fragmentCompilationError=Y,new Error("FRAGMENT SHADER "+Y)}if(X=H.getProgramInfoLog(M))throw v.programLinkError=X,new Error(X)}if(this.validateShaderPrograms&&(H.validateProgram(M),!H.getProgramParameter(M,H.VALIDATE_STATUS)&&(X=H.getProgramInfoLog(M))))throw v.programValidationError=X,new Error(X);H.deleteShader(L),H.deleteShader(Q),v.vertexShader=void 0,v.fragmentShader=void 0,v.onCompiled&&(v.onCompiled(),v.onCompiled=void 0)},B.prototype._preparePipelineContext=function(v,H,L,Q,M,Y,X){var U=v;U.program=Q?this.createRawShaderProgram(U,H,L,void 0,X):this.createShaderProgram(U,H,L,Y,void 0,X),U.program.__SPECTOR_rebuildProgram=M},B.prototype._isRenderingStateCompiled=function(v){var H=v;return!!this._gl.getProgramParameter(H.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(H),!0)},B.prototype._executeWhenRenderingStateIsCompiled=function(v,H){var L=v;if(L.isParallelCompiled){var Q=L.onCompiled;L.onCompiled=Q?function(){Q(),H()}:H}else H()},B.prototype.getUniforms=function(v,H){for(var L=new Array(),Q=v,M=0;M<H.length;M++)L.push(this._gl.getUniformLocation(Q.program,H[M]));return L},B.prototype.getAttributes=function(v,H){for(var L=[],Q=v,M=0;M<H.length;M++)try{L.push(this._gl.getAttribLocation(Q.program,H[M]))}catch(Y){L.push(-1)}return L},B.prototype.enableEffect=function(v){v&&v!==this._currentEffect&&(this.bindSamplers(v),this._currentEffect=v,v.onBind&&v.onBind(v),v._onBindObservable&&v._onBindObservable.notifyObservers(v))},B.prototype.setInt=function(v,H){v&&this._gl.uniform1i(v,H)},B.prototype.setIntArray=function(v,H){v&&this._gl.uniform1iv(v,H)},B.prototype.setIntArray2=function(v,H){v&&H.length%2==0&&this._gl.uniform2iv(v,H)},B.prototype.setIntArray3=function(v,H){v&&H.length%3==0&&this._gl.uniform3iv(v,H)},B.prototype.setIntArray4=function(v,H){v&&H.length%4==0&&this._gl.uniform4iv(v,H)},B.prototype.setArray=function(v,H){v&&this._gl.uniform1fv(v,H)},B.prototype.setArray2=function(v,H){v&&H.length%2==0&&this._gl.uniform2fv(v,H)},B.prototype.setArray3=function(v,H){v&&H.length%3==0&&this._gl.uniform3fv(v,H)},B.prototype.setArray4=function(v,H){v&&H.length%4==0&&this._gl.uniform4fv(v,H)},B.prototype.setMatrices=function(v,H){v&&this._gl.uniformMatrix4fv(v,!1,H)},B.prototype.setMatrix3x3=function(v,H){v&&this._gl.uniformMatrix3fv(v,!1,H)},B.prototype.setMatrix2x2=function(v,H){v&&this._gl.uniformMatrix2fv(v,!1,H)},B.prototype.setFloat=function(v,H){v&&this._gl.uniform1f(v,H)},B.prototype.setFloat2=function(v,H,L){v&&this._gl.uniform2f(v,H,L)},B.prototype.setFloat3=function(v,H,L,Q){v&&this._gl.uniform3f(v,H,L,Q)},B.prototype.setFloat4=function(v,H,L,Q,M){v&&this._gl.uniform4f(v,H,L,Q,M)},B.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var v=this._colorWrite;this._gl.colorMask(v,v,v,v)}},B.prototype.setColorWrite=function(v){v!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=v)},B.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(B.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!0,configurable:!0}),B.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},B.prototype.wipeCaches=function(v){this.preventCacheWipeBetweenFrames&&!v||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),v&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=x.a.ALPHA_ADD,this._alphaEquation=x.a.ALPHA_DISABLE,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},B.prototype._getSamplingParameters=function(v,H){var L=this._gl,Q=L.NEAREST,M=L.NEAREST;switch(v){case x.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST:Q=L.LINEAR,M=H?L.LINEAR_MIPMAP_NEAREST:L.LINEAR;break;case x.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR:Q=L.LINEAR,M=H?L.LINEAR_MIPMAP_LINEAR:L.LINEAR;break;case x.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR:Q=L.NEAREST,M=H?L.NEAREST_MIPMAP_LINEAR:L.NEAREST;break;case x.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST:Q=L.NEAREST,M=H?L.NEAREST_MIPMAP_NEAREST:L.NEAREST;break;case x.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST:Q=L.NEAREST,M=H?L.LINEAR_MIPMAP_NEAREST:L.LINEAR;break;case x.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR:Q=L.NEAREST,M=H?L.LINEAR_MIPMAP_LINEAR:L.LINEAR;break;case x.a.TEXTURE_NEAREST_LINEAR:Q=L.NEAREST,M=L.LINEAR;break;case x.a.TEXTURE_NEAREST_NEAREST:Q=L.NEAREST,M=L.NEAREST;break;case x.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST:Q=L.LINEAR,M=H?L.NEAREST_MIPMAP_NEAREST:L.NEAREST;break;case x.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR:Q=L.LINEAR,M=H?L.NEAREST_MIPMAP_LINEAR:L.NEAREST;break;case x.a.TEXTURE_LINEAR_LINEAR:Q=L.LINEAR,M=L.LINEAR;break;case x.a.TEXTURE_LINEAR_NEAREST:Q=L.LINEAR,M=L.NEAREST}return{min:M,mag:Q}},B.prototype._createTexture=function(){var v=this._gl.createTexture();if(!v)throw new Error("Unable to create texture");return v},B.prototype.createTexture=function(v,H,L,Q,M,Y,X,U,P,ga,ma,oa){var ja=this;void 0===M&&(M=x.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===Y&&(Y=null),void 0===X&&(X=null),void 0===U&&(U=null),void 0===P&&(P=null),void 0===ga&&(ga=null),void 0===ma&&(ma=null);for(var aa=String(v),F="data:"===aa.substr(0,5),$="blob:"===aa.substr(0,5),ia=F&&-1!==aa.indexOf(";base64,"),ba=P||new l.a(this,l.b.Url),qa=aa.lastIndexOf("."),V=ma||(qa>-1?aa.substring(qa).toLowerCase():""),O=null,S=0,W=B._TextureLoaders;S<W.length;S++){var da=W[S];if(da.canLoad(V)){O=da;break}}Q&&Q._addPendingData(ba),ba.url=aa,ba.generateMipMaps=!H,ba.samplingMode=M,ba.invertY=L,this._doNotHandleContextLost||(ba._buffer=U);var na=null;Y&&!P&&(na=ba.onLoadedObservable.add(Y)),P||this._internalTexturesCache.push(ba);var Ea=function(Ka,Ga){Q&&Q._removePendingData(ba),na&&ba.onLoadedObservable.remove(na),R.a.UseFallbackTexture?ja.createTexture(R.a.FallbackTexture,H,ba.invertY,Q,M,null,X,U,ba):X&&X(Ka||"Unknown error",Ga)};if(O){var Ca=function(Ka){O.loadData(Ka,ba,function(Ga,Ba,Na,db,eb,Ya){Ya?Ea("TextureLoader failed to load data"):ja._prepareWebGLTexture(ba,Q,Ga,Ba,ba.invertY,!Na,db,function(){return eb(),!1},M)})};U?U instanceof ArrayBuffer?Ca(new Uint8Array(U)):ArrayBuffer.isView(U)?Ca(U):X&&X("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(aa,function(Ka){return Ca(new Uint8Array(Ka))},void 0,Q?Q.offlineProvider:void 0,!0,function(Ka,Ga){Ea("Unable to load "+(Ka&&Ka.responseURL,Ga))})}else{var wa=function(Ka){$&&!ja._doNotHandleContextLost&&(ba._buffer=Ka),ja._prepareWebGLTexture(ba,Q,Ka.width,Ka.height,ba.invertY,H,!1,function(Ga,Ba,Na){var db=ja._gl,eb=Ka.width===Ga&&Ka.height===Ba,Ya=ga?ja._getInternalFormat(ga):".jpg"===V?db.RGB:db.RGBA;if(eb)return db.texImage2D(db.TEXTURE_2D,0,Ya,Ya,db.UNSIGNED_BYTE,Ka),!1;var Sa=ja._caps.maxTextureSize;if(Ka.width>Sa||Ka.height>Sa||!ja._supportsHardwareTextureRescaling)return ja._prepareWorkingCanvas(),!(!ja._workingCanvas||!ja._workingContext)&&(ja._workingCanvas.width=Ga,ja._workingCanvas.height=Ba,ja._workingContext.drawImage(Ka,0,0,Ka.width,Ka.height,0,0,Ga,Ba),db.texImage2D(db.TEXTURE_2D,0,Ya,Ya,db.UNSIGNED_BYTE,ja._workingCanvas),ba.width=Ga,ba.height=Ba,!1);var sb=new l.a(ja,l.b.Temp);return ja._bindTextureDirectly(db.TEXTURE_2D,sb,!0),db.texImage2D(db.TEXTURE_2D,0,Ya,Ya,db.UNSIGNED_BYTE,Ka),ja._rescaleTexture(sb,ba,Q,Ya,function(){ja._releaseTexture(sb),ja._bindTextureDirectly(db.TEXTURE_2D,ba,!0),Na()}),!0},M)};!F||ia?U&&(U.decoding||U.close)?wa(U):B._FileToolsLoadImage(aa,wa,Ea,Q?Q.offlineProvider:null,oa):"string"==typeof U||U instanceof ArrayBuffer||ArrayBuffer.isView(U)||U instanceof Blob?B._FileToolsLoadImage(U,wa,Ea,Q?Q.offlineProvider:null,oa):U&&wa(U)}return ba},B._FileToolsLoadImage=function(v,H,L,Q,M){throw I.a.WarnImport("FileTools")},B.prototype._rescaleTexture=function(v,H,L,Q,M){},B.prototype.createRawTexture=function(v,H,L,Q,M,Y,X,U,P){throw void 0===U&&(U=null),void 0===P&&(P=x.a.TEXTURETYPE_UNSIGNED_INT),I.a.WarnImport("Engine.RawTexture")},B.prototype.createRawCubeTexture=function(v,H,L,Q,M,Y,X,U){throw void 0===U&&(U=null),I.a.WarnImport("Engine.RawTexture")},B.prototype.createRawTexture3D=function(v,H,L,Q,M,Y,X,U,P,ga){throw void 0===P&&(P=null),void 0===ga&&(ga=x.a.TEXTURETYPE_UNSIGNED_INT),I.a.WarnImport("Engine.RawTexture")},B.prototype.createRawTexture2DArray=function(v,H,L,Q,M,Y,X,U,P,ga){throw void 0===P&&(P=null),void 0===ga&&(ga=x.a.TEXTURETYPE_UNSIGNED_INT),I.a.WarnImport("Engine.RawTexture")},B.prototype._unpackFlipY=function(v){this._unpackFlipYCached!==v&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,v?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=v))},B.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},B.prototype._getTextureTarget=function(v){return v.isCube?this._gl.TEXTURE_CUBE_MAP:v.is3D?this._gl.TEXTURE_3D:v.is2DArray||v.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},B.prototype.updateTextureSamplingMode=function(v,H,L){void 0===L&&(L=!1);var Q=this._getTextureTarget(H),M=this._getSamplingParameters(v,H.generateMipMaps||L);this._setTextureParameterInteger(Q,this._gl.TEXTURE_MAG_FILTER,M.mag,H),this._setTextureParameterInteger(Q,this._gl.TEXTURE_MIN_FILTER,M.min),L&&(H.generateMipMaps=!0,this._gl.generateMipmap(Q)),this._bindTextureDirectly(Q,null),H.samplingMode=v},B.prototype.updateTextureWrappingMode=function(v,H,L,Q){void 0===L&&(L=null),void 0===Q&&(Q=null);var M=this._getTextureTarget(v);null!==H&&(this._setTextureParameterInteger(M,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(H),v),v._cachedWrapU=H),null!==L&&(this._setTextureParameterInteger(M,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(L),v),v._cachedWrapV=L),(v.is2DArray||v.is3D)&&null!==Q&&(this._setTextureParameterInteger(M,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(Q),v),v._cachedWrapR=Q),this._bindTextureDirectly(M,null)},B.prototype._setupDepthStencilTexture=function(v,H,L,Q,M){var Y=H.width||H,X=H.height||H,U=H.layers||0;v.baseWidth=Y,v.baseHeight=X,v.width=Y,v.height=X,v.is2DArray=U>0,v.depth=U,v.isReady=!0,v.samples=1,v.generateMipMaps=!1,v._generateDepthBuffer=!0,v._generateStencilBuffer=L,v.samplingMode=Q?x.a.TEXTURE_BILINEAR_SAMPLINGMODE:x.a.TEXTURE_NEAREST_SAMPLINGMODE,v.type=x.a.TEXTURETYPE_UNSIGNED_INT,v._comparisonFunction=M;var P=this._gl,ga=this._getTextureTarget(v),ma=this._getSamplingParameters(v.samplingMode,!1);P.texParameteri(ga,P.TEXTURE_MAG_FILTER,ma.mag),P.texParameteri(ga,P.TEXTURE_MIN_FILTER,ma.min),P.texParameteri(ga,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(ga,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),0===M?(P.texParameteri(ga,P.TEXTURE_COMPARE_FUNC,x.a.LEQUAL),P.texParameteri(ga,P.TEXTURE_COMPARE_MODE,P.NONE)):(P.texParameteri(ga,P.TEXTURE_COMPARE_FUNC,M),P.texParameteri(ga,P.TEXTURE_COMPARE_MODE,P.COMPARE_REF_TO_TEXTURE))},B.prototype._uploadCompressedDataToTextureDirectly=function(v,H,L,Q,M,Y,X){void 0===Y&&(Y=0),void 0===X&&(X=0);var U=this._gl,P=U.TEXTURE_2D;v.isCube&&(P=U.TEXTURE_CUBE_MAP_POSITIVE_X+Y),this._gl.compressedTexImage2D(P,X,H,L,Q,0,M)},B.prototype._uploadDataToTextureDirectly=function(v,H,L,Q,M,Y){void 0===L&&(L=0),void 0===Q&&(Q=0),void 0===Y&&(Y=!1);var X=this._gl,U=this._getWebGLTextureType(v.type),P=this._getInternalFormat(v.format),ga=void 0===M?this._getRGBABufferInternalSizedFormat(v.type,v.format):this._getInternalFormat(M);this._unpackFlipY(v.invertY);var ma=X.TEXTURE_2D;v.isCube&&(ma=X.TEXTURE_CUBE_MAP_POSITIVE_X+L);var oa=Math.round(Math.log(v.width)*Math.LOG2E),ja=Math.round(Math.log(v.height)*Math.LOG2E),aa=Y?v.width:Math.pow(2,Math.max(oa-Q,0)),F=Y?v.height:Math.pow(2,Math.max(ja-Q,0));X.texImage2D(ma,Q,ga,aa,F,0,P,U,H)},B.prototype.updateTextureData=function(v,H,L,Q,M,Y,X,U){void 0===X&&(X=0),void 0===U&&(U=0);var P=this._gl,ga=this._getWebGLTextureType(v.type),ma=this._getInternalFormat(v.format);this._unpackFlipY(v.invertY);var oa=P.TEXTURE_2D;v.isCube&&(oa=P.TEXTURE_CUBE_MAP_POSITIVE_X+X),P.texSubImage2D(oa,U,L,Q,M,Y,ma,ga,H)},B.prototype._uploadArrayBufferViewToTexture=function(v,H,L,Q){void 0===L&&(L=0),void 0===Q&&(Q=0);var M=this._gl,Y=v.isCube?M.TEXTURE_CUBE_MAP:M.TEXTURE_2D;this._bindTextureDirectly(Y,v,!0),this._uploadDataToTextureDirectly(v,H,L,Q),this._bindTextureDirectly(Y,null,!0)},B.prototype._prepareWebGLTextureContinuation=function(v,H,L,Q,M){var Y=this._gl;if(Y){var X=this._getSamplingParameters(M,!L);Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,X.mag),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,X.min),L||Q||Y.generateMipmap(Y.TEXTURE_2D),this._bindTextureDirectly(Y.TEXTURE_2D,null),H&&H._removePendingData(v),v.onLoadedObservable.notifyObservers(v),v.onLoadedObservable.clear()}},B.prototype._prepareWebGLTexture=function(v,H,L,Q,M,Y,X,U,P){var ga=this;void 0===P&&(P=x.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var ma=this.getCaps().maxTextureSize,oa=Math.min(ma,this.needPOTTextures?B.GetExponentOfTwo(L,ma):L),ja=Math.min(ma,this.needPOTTextures?B.GetExponentOfTwo(Q,ma):Q),aa=this._gl;aa&&(v._webGLTexture?(this._bindTextureDirectly(aa.TEXTURE_2D,v,!0),this._unpackFlipY(void 0===M||!!M),v.baseWidth=L,v.baseHeight=Q,v.width=oa,v.height=ja,v.isReady=!0,U(oa,ja,function(){ga._prepareWebGLTextureContinuation(v,H,Y,X,P)})||this._prepareWebGLTextureContinuation(v,H,Y,X,P)):H&&H._removePendingData(v))},B.prototype._setupFramebufferDepthAttachments=function(v,H,L,Q,M){void 0===M&&(M=1);var Y=this._gl;if(v&&H)return this._getDepthStencilBuffer(L,Q,M,Y.DEPTH_STENCIL,Y.DEPTH24_STENCIL8,Y.DEPTH_STENCIL_ATTACHMENT);if(H){var X=Y.DEPTH_COMPONENT16;return this._webGLVersion>1&&(X=Y.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(L,Q,M,X,X,Y.DEPTH_ATTACHMENT)}return v?this._getDepthStencilBuffer(L,Q,M,Y.STENCIL_INDEX8,Y.STENCIL_INDEX8,Y.STENCIL_ATTACHMENT):null},B.prototype._releaseFramebufferObjects=function(v){var H=this._gl;v._framebuffer&&(H.deleteFramebuffer(v._framebuffer),v._framebuffer=null),v._depthStencilBuffer&&(H.deleteRenderbuffer(v._depthStencilBuffer),v._depthStencilBuffer=null),v._MSAAFramebuffer&&(H.deleteFramebuffer(v._MSAAFramebuffer),v._MSAAFramebuffer=null),v._MSAARenderBuffer&&(H.deleteRenderbuffer(v._MSAARenderBuffer),v._MSAARenderBuffer=null)},B.prototype._releaseTexture=function(v){this._releaseFramebufferObjects(v),this._deleteTexture(v._webGLTexture),this.unbindAllTextures();var H=this._internalTexturesCache.indexOf(v);-1!==H&&this._internalTexturesCache.splice(H,1),v._lodTextureHigh&&v._lodTextureHigh.dispose(),v._lodTextureMid&&v._lodTextureMid.dispose(),v._lodTextureLow&&v._lodTextureLow.dispose(),v._irradianceTexture&&v._irradianceTexture.dispose()},B.prototype._deleteTexture=function(v){this._gl.deleteTexture(v)},B.prototype._setProgram=function(v){this._currentProgram!==v&&(this._gl.useProgram(v),this._currentProgram=v)},B.prototype.bindSamplers=function(v){var H=v.getPipelineContext();this._setProgram(H.program);for(var L=v.getSamplers(),Q=0;Q<L.length;Q++){var M=v.getUniform(L[Q]);M&&(this._boundUniforms[Q]=M)}this._currentEffect=null},B.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},B.prototype._bindTextureDirectly=function(v,H,L,Q){void 0===L&&(L=!1),void 0===Q&&(Q=!1);var M=!1,Y=H&&H._associatedChannel>-1;return L&&Y&&(this._activeChannel=H._associatedChannel),this._boundTexturesCache[this._activeChannel]!==H||Q?(this._activateCurrentTexture(),H&&H.isMultiview?this._gl.bindTexture(v,H?H._colorTextureArray:null):this._gl.bindTexture(v,H?H._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=H,H&&(H._associatedChannel=this._activeChannel)):L&&(M=!0,this._activateCurrentTexture()),Y&&!L&&this._bindSamplerUniformToChannel(H._associatedChannel,this._activeChannel),M},B.prototype._bindTexture=function(v,H){void 0!==v&&(H&&(H._associatedChannel=v),this._activeChannel=v,this._bindTextureDirectly(this._gl.TEXTURE_2D,H))},B.prototype.unbindAllTextures=function(){for(var v=0;v<this._maxSimultaneousTextures;v++)this._activeChannel=v,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},B.prototype.setTexture=function(v,H,L){void 0!==v&&(H&&(this._boundUniforms[v]=H),this._setTexture(v,L))},B.prototype._bindSamplerUniformToChannel=function(v,H){var L=this._boundUniforms[v];L&&L._currentState!==H&&(this._gl.uniform1i(L,H),L._currentState=H)},B.prototype._getTextureWrapMode=function(v){switch(v){case x.a.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case x.a.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case x.a.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},B.prototype._setTexture=function(v,H,L,Q){if(void 0===L&&(L=!1),void 0===Q&&(Q=!1),!H)return null!=this._boundTexturesCache[v]&&(this._activeChannel=v,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(H.video)this._activeChannel=v,H.update();else if(H.delayLoadState===x.a.DELAYLOADSTATE_NOTLOADED)return H.delayLoad(),!1;var M;M=Q?H.depthStencilTexture:H.isReady()?H.getInternalTexture():H.isCube?this.emptyCubeTexture:H.is3D?this.emptyTexture3D:H.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!L&&M&&(M._associatedChannel=v);var Y=!0;this._boundTexturesCache[v]===M&&(L||this._bindSamplerUniformToChannel(M._associatedChannel,v),Y=!1),this._activeChannel=v;var X=this._getTextureTarget(M);if(Y&&this._bindTextureDirectly(X,M,L),M&&!M.isMultiview){if(M.isCube&&M._cachedCoordinatesMode!==H.coordinatesMode){M._cachedCoordinatesMode=H.coordinatesMode;var U=H.coordinatesMode!==x.a.TEXTURE_CUBIC_MODE&&H.coordinatesMode!==x.a.TEXTURE_SKYBOX_MODE?x.a.TEXTURE_WRAP_ADDRESSMODE:x.a.TEXTURE_CLAMP_ADDRESSMODE;H.wrapU=U,H.wrapV=U}M._cachedWrapU!==H.wrapU&&(M._cachedWrapU=H.wrapU,this._setTextureParameterInteger(X,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(H.wrapU),M)),M._cachedWrapV!==H.wrapV&&(M._cachedWrapV=H.wrapV,this._setTextureParameterInteger(X,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(H.wrapV),M)),M.is3D&&M._cachedWrapR!==H.wrapR&&(M._cachedWrapR=H.wrapR,this._setTextureParameterInteger(X,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(H.wrapR),M)),this._setAnisotropicLevel(X,M,H.anisotropicFilteringLevel)}return!0},B.prototype.setTextureArray=function(v,H,L){if(void 0!==v&&H){this._textureUnits&&this._textureUnits.length===L.length||(this._textureUnits=new Int32Array(L.length));for(var Q=0;Q<L.length;Q++){var M=L[Q].getInternalTexture();M?(this._textureUnits[Q]=v+Q,M._associatedChannel=v+Q):this._textureUnits[Q]=-1}this._gl.uniform1iv(H,this._textureUnits);for(var Y=0;Y<L.length;Y++)this._setTexture(this._textureUnits[Y],L[Y],!0)}},B.prototype._setAnisotropicLevel=function(v,H,L){var Q=this._caps.textureAnisotropicFilterExtension;H.samplingMode!==x.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&H.samplingMode!==x.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&H.samplingMode!==x.a.TEXTURE_LINEAR_LINEAR&&(L=1),Q&&H._cachedAnisotropicFilteringLevel!==L&&(this._setTextureParameterFloat(v,Q.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(L,this._caps.maxAnisotropy),H),H._cachedAnisotropicFilteringLevel=L)},B.prototype._setTextureParameterFloat=function(v,H,L,Q){this._bindTextureDirectly(v,Q,!0,!0),this._gl.texParameterf(v,H,L)},B.prototype._setTextureParameterInteger=function(v,H,L,Q){Q&&this._bindTextureDirectly(v,Q,!0,!0),this._gl.texParameteri(v,H,L)},B.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var v=0;v<this._caps.maxVertexAttribs;v++)this.disableAttributeByIndex(v)}else{v=0;for(var H=this._vertexAttribArraysEnabled.length;v<H;v++)v>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[v]||this.disableAttributeByIndex(v)}},B.prototype.releaseEffects=function(){for(var v in this._compiledEffects){var H=this._compiledEffects[v].getPipelineContext();this._deletePipelineContext(H)}this._compiledEffects={}},B.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],y.a.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,r.a.ResetCache();for(var v=0,H=this._activeRequests;v<H.length;v++)H[v].abort()},B.prototype.attachContextLostEvent=function(v){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",v,!1)},B.prototype.attachContextRestoredEvent=function(v){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",v,!1)},B.prototype.getError=function(){return this._gl.getError()},B.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(x.a.TEXTURETYPE_FLOAT)},B.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(x.a.TEXTURETYPE_HALF_FLOAT)},B.prototype._canRenderToFramebuffer=function(v){for(var H=this._gl;H.getError()!==H.NO_ERROR;);var L=!0,Q=H.createTexture();H.bindTexture(H.TEXTURE_2D,Q),H.texImage2D(H.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(v),1,1,0,H.RGBA,this._getWebGLTextureType(v),null),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.NEAREST),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.NEAREST);var M=H.createFramebuffer();H.bindFramebuffer(H.FRAMEBUFFER,M),H.framebufferTexture2D(H.FRAMEBUFFER,H.COLOR_ATTACHMENT0,H.TEXTURE_2D,Q,0);var Y=H.checkFramebufferStatus(H.FRAMEBUFFER);if((L=(L=L&&Y===H.FRAMEBUFFER_COMPLETE)&&H.getError()===H.NO_ERROR)&&(H.clear(H.COLOR_BUFFER_BIT),L=L&&H.getError()===H.NO_ERROR),L){H.bindFramebuffer(H.FRAMEBUFFER,null);var X=H.RGBA,U=H.UNSIGNED_BYTE,P=new Uint8Array(4);H.readPixels(0,0,1,1,X,U,P),L=L&&H.getError()===H.NO_ERROR}for(H.deleteTexture(Q),H.deleteFramebuffer(M),H.bindFramebuffer(H.FRAMEBUFFER,null);!L&&H.getError()!==H.NO_ERROR;);return L},B.prototype._getWebGLTextureType=function(v){if(1===this._webGLVersion){switch(v){case x.a.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case x.a.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case x.a.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case x.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case x.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case x.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(v){case x.a.TEXTURETYPE_BYTE:return this._gl.BYTE;case x.a.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case x.a.TEXTURETYPE_SHORT:return this._gl.SHORT;case x.a.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case x.a.TEXTURETYPE_INT:return this._gl.INT;case x.a.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case x.a.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case x.a.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case x.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case x.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case x.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case x.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case x.a.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case x.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case x.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case x.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},B.prototype._getInternalFormat=function(v){var H=this._gl.RGBA;switch(v){case x.a.TEXTUREFORMAT_ALPHA:H=this._gl.ALPHA;break;case x.a.TEXTUREFORMAT_LUMINANCE:H=this._gl.LUMINANCE;break;case x.a.TEXTUREFORMAT_LUMINANCE_ALPHA:H=this._gl.LUMINANCE_ALPHA;break;case x.a.TEXTUREFORMAT_RED:H=this._gl.RED;break;case x.a.TEXTUREFORMAT_RG:H=this._gl.RG;break;case x.a.TEXTUREFORMAT_RGB:H=this._gl.RGB;break;case x.a.TEXTUREFORMAT_RGBA:H=this._gl.RGBA}if(this._webGLVersion>1)switch(v){case x.a.TEXTUREFORMAT_RED_INTEGER:H=this._gl.RED_INTEGER;break;case x.a.TEXTUREFORMAT_RG_INTEGER:H=this._gl.RG_INTEGER;break;case x.a.TEXTUREFORMAT_RGB_INTEGER:H=this._gl.RGB_INTEGER;break;case x.a.TEXTUREFORMAT_RGBA_INTEGER:H=this._gl.RGBA_INTEGER}return H},B.prototype._getRGBABufferInternalSizedFormat=function(v,H){if(1===this._webGLVersion){if(void 0!==H)switch(H){case x.a.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case x.a.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case x.a.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;case x.a.TEXTUREFORMAT_RGB:return this._gl.RGB}return this._gl.RGBA}switch(v){case x.a.TEXTURETYPE_BYTE:switch(H){case x.a.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case x.a.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case x.a.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case x.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case x.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case x.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case x.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case x.a.TEXTURETYPE_UNSIGNED_BYTE:switch(H){case x.a.TEXTUREFORMAT_RED:return this._gl.R8;case x.a.TEXTUREFORMAT_RG:return this._gl.RG8;case x.a.TEXTUREFORMAT_RGB:return this._gl.RGB8;case x.a.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case x.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case x.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case x.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case x.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case x.a.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case x.a.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case x.a.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case x.a.TEXTURETYPE_SHORT:switch(H){case x.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case x.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case x.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case x.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case x.a.TEXTURETYPE_UNSIGNED_SHORT:switch(H){case x.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case x.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case x.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case x.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case x.a.TEXTURETYPE_INT:switch(H){case x.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case x.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case x.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case x.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case x.a.TEXTURETYPE_UNSIGNED_INTEGER:switch(H){case x.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case x.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case x.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case x.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case x.a.TEXTURETYPE_FLOAT:switch(H){case x.a.TEXTUREFORMAT_RED:return this._gl.R32F;case x.a.TEXTUREFORMAT_RG:return this._gl.RG32F;case x.a.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case x.a.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case x.a.TEXTURETYPE_HALF_FLOAT:switch(H){case x.a.TEXTUREFORMAT_RED:return this._gl.R16F;case x.a.TEXTUREFORMAT_RG:return this._gl.RG16F;case x.a.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case x.a.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case x.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case x.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case x.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case x.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case x.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case x.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(H){case x.a.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case x.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},B.prototype._getRGBAMultiSampleBufferFormat=function(v){return v===x.a.TEXTURETYPE_FLOAT?this._gl.RGBA32F:v===x.a.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},B.prototype._loadFile=function(v,H,L,Q,M,Y){var X=this,U=B._FileToolsLoadFile(v,H,L,Q,M,Y);return this._activeRequests.push(U),U.onCompleteObservable.add(function(P){X._activeRequests.splice(X._activeRequests.indexOf(P),1)}),U},B._FileToolsLoadFile=function(v,H,L,Q,M,Y){throw I.a.WarnImport("FileTools")},B.prototype.readPixels=function(v,H,L,Q,M){void 0===M&&(M=!0);var Y=M?4:3,X=M?this._gl.RGBA:this._gl.RGB,U=new Uint8Array(Q*L*Y);return this._gl.readPixels(v,H,L,Q,X,this._gl.UNSIGNED_BYTE,U),U},B.isSupported=function(){if(null===this._isSupported)try{var v=p.a.CreateCanvas(1,1),H=v.getContext("webgl")||v.getContext("experimental-webgl");this._isSupported=null!=H&&!!window.WebGLRenderingContext}catch(L){this._isSupported=!1}return this._isSupported},B.CeilingPOT=function(v){return v--,v|=v>>1,v|=v>>2,v|=v>>4,v|=v>>8,v|=v>>16,++v},B.FloorPOT=function(v){return v|=v>>1,v|=v>>2,v|=v>>4,v|=v>>8,(v|=v>>16)-(v>>1)},B.NearestPOT=function(v){var H=B.CeilingPOT(v),L=B.FloorPOT(v);return H-v>v-L?L:H},B.GetExponentOfTwo=function(v,H,L){var Q;switch(void 0===L&&(L=x.a.SCALEMODE_NEAREST),L){case x.a.SCALEMODE_FLOOR:Q=B.FloorPOT(v);break;case x.a.SCALEMODE_NEAREST:Q=B.NearestPOT(v);break;case x.a.SCALEMODE_CEILING:default:Q=B.CeilingPOT(v)}return Math.min(Q,H)},B.QueueNewFrame=function(v,H){return y.a.IsWindowObjectExist()?(H||(H=window),H.requestAnimationFrame?H.requestAnimationFrame(v):H.msRequestAnimationFrame?H.msRequestAnimationFrame(v):H.webkitRequestAnimationFrame?H.webkitRequestAnimationFrame(v):H.mozRequestAnimationFrame?H.mozRequestAnimationFrame(v):H.oRequestAnimationFrame?H.oRequestAnimationFrame(v):window.setTimeout(v,16)):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(v):setTimeout(v,16)},B.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},B.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],B._TextureLoaders=[],B.CollisionsEpsilon=.001,B._isSupported=null,B}()},function(Ja,t,o){"use strict";var R=o(1),r=o(3),I=o(34),i=o(18),G=o(0),D=o(10),E=o(4),x=o(40),l=o(73),s=o(81),y=o(16),q=o(9),n=o(12),k=o(21),p=o(8),u=`uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif
#ifdef REFRACTION
uniform vec4 vRefractionInfos;
#ifndef REFRACTIONMAP_3D
uniform mat4 refractionMatrix;
#endif
#ifdef REFRACTIONFRESNEL
uniform vec4 refractionLeftColor;
uniform vec4 refractionRightColor;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
#endif
#ifdef DIFFUSEFRESNEL
uniform vec4 diffuseLeftColor;
uniform vec4 diffuseRightColor;
#endif
#ifdef OPACITYFRESNEL
uniform vec4 opacityParts;
#endif
#ifdef EMISSIVEFRESNEL
uniform vec4 emissiveLeftColor;
uniform vec4 emissiveRightColor;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)
uniform mat4 reflectionMatrix;
#endif
#ifndef REFLECTIONMAP_SKYBOX
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 reflectionLeftColor;
uniform vec4 reflectionRightColor;
#endif
#endif`;p.a.IncludesShadersStore.defaultFragmentDeclaration=u;var A=`layout(std140,column_major) uniform;
uniform Material
{
vec4 diffuseLeftColor;
vec4 diffuseRightColor;
vec4 opacityParts;
vec4 reflectionLeftColor;
vec4 reflectionRightColor;
vec4 refractionLeftColor;
vec4 refractionRightColor;
vec4 emissiveLeftColor;
vec4 emissiveRightColor;
vec2 vDiffuseInfos;
vec2 vAmbientInfos;
vec2 vOpacityInfos;
vec2 vReflectionInfos;
vec3 vReflectionPosition;
vec3 vReflectionSize;
vec2 vEmissiveInfos;
vec2 vLightmapInfos;
vec2 vSpecularInfos;
vec3 vBumpInfos;
mat4 diffuseMatrix;
mat4 ambientMatrix;
mat4 opacityMatrix;
mat4 reflectionMatrix;
mat4 emissiveMatrix;
mat4 lightmapMatrix;
mat4 specularMatrix;
mat4 bumpMatrix;
vec2 vTangentSpaceParams;
float pointSize;
mat4 refractionMatrix;
vec4 vRefractionInfos;
vec4 vSpecularColor;
vec3 vEmissiveColor;
float visibility;
vec4 vDiffuseColor;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};
`;p.a.IncludesShadersStore.defaultUboDeclaration=A,o(58),o(97),o(98),o(139),o(117),o(145),o(118),o(99),o(100),o(119),o(106),o(107),o(113),o(101),o(120),o(146),o(121),o(140),o(122);var B=`#include<__decl__defaultFragment>
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif

#define RECIPROCAL_PI2 0.15915494
uniform vec3 vEyePosition;
uniform vec3 vAmbientColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFRACTION
#ifdef REFRACTIONMAP_3D
uniform samplerCube refractionCubeSampler;
#else
uniform sampler2D refraction2DSampler;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
#if SPECULARDIRECTUV == 1
#define vSpecularUV vMainUV1
#elif SPECULARDIRECTUV == 2
#define vSpecularUV vMainUV2
#else
varying vec2 vSpecularUV;
#endif
uniform sampler2D specularSampler;
#endif
#ifdef ALPHATEST
uniform float alphaCutOff;
#endif

#include<fresnelFunction>

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
uniform samplerCube reflectionCubeSampler;
#else
uniform sampler2D reflection2DSampler;
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>
#include<bumpFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));
#endif
#include<bumpFragment>
#ifdef TWOSIDEDLIGHTING
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);
#ifdef ALPHATEST
if (baseColor.a<alphaCutOff)
discard;
#endif
#ifdef ALPHAFROMDIFFUSE
alpha*=baseColor.a;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
baseColor.rgb*=vDiffuseInfos.y;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE

vec3 baseAmbientColor=vec3(1.,1.,1.);
#ifdef AMBIENT
baseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#endif
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#ifdef SPECULAR
vec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);
specularColor=specularMapColor.rgb;
#ifdef GLOSSINESS
glossiness=glossiness*specularMapColor.a;
#endif
#endif
#else
float glossiness=0.;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
float shadow=1.;
#ifdef LIGHTMAP
vec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;
#endif
#include<lightFragment>[0..maxSimultaneousLights]

vec3 refractionColor=vec3(0.,0.,0.);
#ifdef REFRACTION
vec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));
#ifdef REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
if (dot(refractionVector,viewDirectionW)<1.0) {
refractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;
}
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
refractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;
#endif
#ifdef IS_REFRACTION_LINEAR
refractionColor=toGammaSpace(refractionColor);
#endif
refractionColor*=vRefractionInfos.x;
#endif

vec3 reflectionColor=vec3(0.,0.,0.);
#ifdef REFLECTION
vec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_3D
#ifdef ROUGHNESS
float bias=vReflectionInfos.y;
#ifdef SPECULARTERM
#ifdef SPECULAR
#ifdef GLOSSINESS
bias*=(1.0-specularMapColor.a);
#endif
#endif
#endif
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;
#else
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;
#endif
#else
vec2 coords=vReflectionUVW.xy;
#ifdef REFLECTIONMAP_PROJECTION
coords/=vReflectionUVW.z;
#endif
coords.y=1.0-coords.y;
reflectionColor=texture2D(reflection2DSampler,coords).rgb;
#endif
#ifdef IS_REFLECTION_LINEAR
reflectionColor=toGammaSpace(reflectionColor);
#endif
reflectionColor*=vReflectionInfos.x;
#ifdef REFLECTIONFRESNEL
float reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);
#ifdef REFLECTIONFRESNELFROMSPECULAR
#ifdef SPECULARTERM
reflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#else
reflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#else
reflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#endif
#endif
#ifdef REFRACTIONFRESNEL
float refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);
refractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);
alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;
#else
alpha*=opacityMap.a*vOpacityInfos.y;
#endif
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef OPACITYFRESNEL
float opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);
alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;
#endif

vec3 emissiveColor=vEmissiveColor;
#ifdef EMISSIVE
emissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;
#endif
#ifdef EMISSIVEFRESNEL
float emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);
emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;
#endif

#ifdef DIFFUSEFRESNEL
float diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);
diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;
#endif

#ifdef EMISSIVEASILLUMINATION
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
#ifdef LINKEMISSIVEWITHDIFFUSE
vec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#endif
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#ifdef SPECULAROVERALPHA
alpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);
#endif
#else
vec3 finalSpecular=vec3(0.0);
#endif
#ifdef REFLECTIONOVERALPHA
alpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);
#endif

#ifdef EMISSIVEASILLUMINATION
vec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);
#else
vec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);
#endif

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
color.rgb*=lightmapColor;
#else
color.rgb+=lightmapColor;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG
color.rgb=max(color.rgb,0.);
#include<logDepthFragment>
#include<fogFragment>


#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#else
#ifdef IMAGEPROCESSING
color.rgb=toLinearSpace(color.rgb);
color=applyImageProcessing(color);
#endif
#endif
color.a*=visibility;
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
gl_FragColor=color;
}
`;p.a.ShadersStore.defaultPixelShader=B;var v=`
uniform mat4 viewProjection;
uniform mat4 view;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
uniform mat4 specularMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef REFLECTION
uniform mat4 reflectionMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
`;p.a.IncludesShadersStore.defaultVertexDeclaration=v,o(74),o(77),o(147),o(108),o(123),o(88),o(89),o(94),o(78),o(75),o(141),o(102),o(142),o(124),p.a.IncludesShadersStore.pointCloudVertex=`#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif`,o(143);var H=`#include<__decl__defaultVertex>

#define CUSTOM_VERTEX_BEGIN
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
varying vec2 vSpecularUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
if (vSpecularInfos.x == 0.)
{
vSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#include<bumpVertex>
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#ifdef VERTEXCOLOR

vColor=color;
#endif
#include<pointCloudVertex>
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;p.a.ShadersStore.defaultVertexShader=H;var L=o(2),Q=o(64);o.d(t,"b",function(){return M}),o.d(t,"a",function(){return Y});var M=function(X){function U(){var P=X.call(this)||this;return P.MAINUV1=!1,P.MAINUV2=!1,P.DIFFUSE=!1,P.DIFFUSEDIRECTUV=0,P.AMBIENT=!1,P.AMBIENTDIRECTUV=0,P.OPACITY=!1,P.OPACITYDIRECTUV=0,P.OPACITYRGB=!1,P.REFLECTION=!1,P.EMISSIVE=!1,P.EMISSIVEDIRECTUV=0,P.SPECULAR=!1,P.SPECULARDIRECTUV=0,P.BUMP=!1,P.BUMPDIRECTUV=0,P.PARALLAX=!1,P.PARALLAXOCCLUSION=!1,P.SPECULAROVERALPHA=!1,P.CLIPPLANE=!1,P.CLIPPLANE2=!1,P.CLIPPLANE3=!1,P.CLIPPLANE4=!1,P.CLIPPLANE5=!1,P.CLIPPLANE6=!1,P.ALPHATEST=!1,P.DEPTHPREPASS=!1,P.ALPHAFROMDIFFUSE=!1,P.POINTSIZE=!1,P.FOG=!1,P.SPECULARTERM=!1,P.DIFFUSEFRESNEL=!1,P.OPACITYFRESNEL=!1,P.REFLECTIONFRESNEL=!1,P.REFRACTIONFRESNEL=!1,P.EMISSIVEFRESNEL=!1,P.FRESNEL=!1,P.NORMAL=!1,P.UV1=!1,P.UV2=!1,P.VERTEXCOLOR=!1,P.VERTEXALPHA=!1,P.NUM_BONE_INFLUENCERS=0,P.BonesPerMesh=0,P.BONETEXTURE=!1,P.INSTANCES=!1,P.GLOSSINESS=!1,P.ROUGHNESS=!1,P.EMISSIVEASILLUMINATION=!1,P.LINKEMISSIVEWITHDIFFUSE=!1,P.REFLECTIONFRESNELFROMSPECULAR=!1,P.LIGHTMAP=!1,P.LIGHTMAPDIRECTUV=0,P.OBJECTSPACE_NORMALMAP=!1,P.USELIGHTMAPASSHADOWMAP=!1,P.REFLECTIONMAP_3D=!1,P.REFLECTIONMAP_SPHERICAL=!1,P.REFLECTIONMAP_PLANAR=!1,P.REFLECTIONMAP_CUBIC=!1,P.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,P.REFLECTIONMAP_PROJECTION=!1,P.REFLECTIONMAP_SKYBOX=!1,P.REFLECTIONMAP_EXPLICIT=!1,P.REFLECTIONMAP_EQUIRECTANGULAR=!1,P.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,P.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,P.INVERTCUBICMAP=!1,P.LOGARITHMICDEPTH=!1,P.REFRACTION=!1,P.REFRACTIONMAP_3D=!1,P.REFLECTIONOVERALPHA=!1,P.TWOSIDEDLIGHTING=!1,P.SHADOWFLOAT=!1,P.MORPHTARGETS=!1,P.MORPHTARGETS_NORMAL=!1,P.MORPHTARGETS_TANGENT=!1,P.MORPHTARGETS_UV=!1,P.NUM_MORPH_INFLUENCERS=0,P.NONUNIFORMSCALING=!1,P.PREMULTIPLYALPHA=!1,P.IMAGEPROCESSING=!1,P.VIGNETTE=!1,P.VIGNETTEBLENDMODEMULTIPLY=!1,P.VIGNETTEBLENDMODEOPAQUE=!1,P.TONEMAPPING=!1,P.TONEMAPPING_ACES=!1,P.CONTRAST=!1,P.COLORCURVES=!1,P.COLORGRADING=!1,P.COLORGRADING3D=!1,P.SAMPLER3DGREENDEPTH=!1,P.SAMPLER3DBGRMAP=!1,P.IMAGEPROCESSINGPOSTPROCESS=!1,P.MULTIVIEW=!1,P.IS_REFLECTION_LINEAR=!1,P.IS_REFRACTION_LINEAR=!1,P.EXPOSURE=!1,P.rebuild(),P}return Object(R.d)(U,X),U.prototype.setReflectionMode=function(P){for(var ga=0,ma=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];ga<ma.length;ga++){var oa=ma[ga];this[oa]=oa===P}},U}(l.a),Y=function(X){function U(P,ga){var ma=X.call(this,P,ga)||this;return ma._diffuseTexture=null,ma._ambientTexture=null,ma._opacityTexture=null,ma._reflectionTexture=null,ma._emissiveTexture=null,ma._specularTexture=null,ma._bumpTexture=null,ma._lightmapTexture=null,ma._refractionTexture=null,ma.ambientColor=new D.a(0,0,0),ma.diffuseColor=new D.a(1,1,1),ma.specularColor=new D.a(1,1,1),ma.emissiveColor=new D.a(0,0,0),ma.specularPower=64,ma._useAlphaFromDiffuseTexture=!1,ma._useEmissiveAsIllumination=!1,ma._linkEmissiveWithDiffuse=!1,ma._useSpecularOverAlpha=!1,ma._useReflectionOverAlpha=!1,ma._disableLighting=!1,ma._useObjectSpaceNormalMap=!1,ma._useParallax=!1,ma._useParallaxOcclusion=!1,ma.parallaxScaleBias=.05,ma._roughness=0,ma.indexOfRefraction=.98,ma.invertRefractionY=!0,ma.alphaCutOff=.4,ma._useLightmapAsShadowmap=!1,ma._useReflectionFresnelFromSpecular=!1,ma._useGlossinessFromSpecularMapAlpha=!1,ma._maxSimultaneousLights=4,ma._invertNormalMapX=!1,ma._invertNormalMapY=!1,ma._twoSidedLighting=!1,ma._renderTargets=new I.a(16),ma._worldViewProjectionMatrix=G.a.Zero(),ma._globalAmbientColor=new D.a(0,0,0),ma._rebuildInParallel=!1,ma._attachImageProcessingConfiguration(null),ma.getRenderTargetTextures=function(){return ma._renderTargets.reset(),U.ReflectionTextureEnabled&&ma._reflectionTexture&&ma._reflectionTexture.isRenderTarget&&ma._renderTargets.push(ma._reflectionTexture),U.RefractionTextureEnabled&&ma._refractionTexture&&ma._refractionTexture.isRenderTarget&&ma._renderTargets.push(ma._refractionTexture),ma._renderTargets},ma}return Object(R.d)(U,X),Object.defineProperty(U.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(P){this._attachImageProcessingConfiguration(P),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),U.prototype._attachImageProcessingConfiguration=function(P){var ga=this;P!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=P||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){ga._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(U.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(P){this.imageProcessingConfiguration.colorCurvesEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(P){this.imageProcessingConfiguration.colorGradingEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(P){this._imageProcessingConfiguration.toneMappingEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(P){this._imageProcessingConfiguration.exposure=P},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(P){this._imageProcessingConfiguration.contrast=P},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(P){this._imageProcessingConfiguration.colorGradingTexture=P},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(P){this._imageProcessingConfiguration.colorCurves=P},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"hasRenderTargetTextures",{get:function(){return!!(U.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(U.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),U.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(U.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(P){this._useLogarithmicDepth=P&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),U.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},U.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},U.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},U.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},U.prototype.isReadyForSubMesh=function(P,ga,ma){if(void 0===ma&&(ma=!1),ga.effect&&this.isFrozen&&ga.effect._wasPreviouslyReady)return!0;ga._materialDefines||(ga._materialDefines=new M());var oa=this.getScene(),ja=ga._materialDefines;if(!this.checkReadyOnEveryCall&&ga.effect&&ja._renderId===oa.getRenderId())return!0;var aa=oa.getEngine();if(ja._needNormals=y.a.PrepareDefinesForLights(oa,P,ja,!0,this._maxSimultaneousLights,this._disableLighting),y.a.PrepareDefinesForMultiview(oa,ja),ja._areTexturesDirty){if(ja._needUVs=!1,ja.MAINUV1=!1,ja.MAINUV2=!1,oa.texturesEnabled){if(this._diffuseTexture&&U.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._diffuseTexture,ja,"DIFFUSE")}else ja.DIFFUSE=!1;if(this._ambientTexture&&U.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._ambientTexture,ja,"AMBIENT")}else ja.AMBIENT=!1;if(this._opacityTexture&&U.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._opacityTexture,ja,"OPACITY"),ja.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else ja.OPACITY=!1;if(this._reflectionTexture&&U.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(ja._needNormals=!0,ja.REFLECTION=!0,ja.ROUGHNESS=this._roughness>0,ja.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,ja.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===q.a.INVCUBIC_MODE,ja.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case q.a.EXPLICIT_MODE:ja.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case q.a.PLANAR_MODE:ja.setReflectionMode("REFLECTIONMAP_PLANAR");break;case q.a.PROJECTION_MODE:ja.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case q.a.SKYBOX_MODE:ja.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case q.a.SPHERICAL_MODE:ja.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case q.a.EQUIRECTANGULAR_MODE:ja.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case q.a.FIXED_EQUIRECTANGULAR_MODE:ja.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case q.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:ja.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case q.a.CUBIC_MODE:case q.a.INVCUBIC_MODE:default:ja.setReflectionMode("REFLECTIONMAP_CUBIC")}ja.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else ja.REFLECTION=!1;if(this._emissiveTexture&&U.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._emissiveTexture,ja,"EMISSIVE")}else ja.EMISSIVE=!1;if(this._lightmapTexture&&U.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._lightmapTexture,ja,"LIGHTMAP"),ja.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else ja.LIGHTMAP=!1;if(this._specularTexture&&U.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._specularTexture,ja,"SPECULAR"),ja.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else ja.SPECULAR=!1;if(oa.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&U.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;y.a.PrepareDefinesForMergedUV(this._bumpTexture,ja,"BUMP"),ja.PARALLAX=this._useParallax,ja.PARALLAXOCCLUSION=this._useParallaxOcclusion,ja.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else ja.BUMP=!1;if(this._refractionTexture&&U.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;ja._needUVs=!0,ja.REFRACTION=!0,ja.REFRACTIONMAP_3D=this._refractionTexture.isCube}else ja.REFRACTION=!1;ja.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else ja.DIFFUSE=!1,ja.AMBIENT=!1,ja.OPACITY=!1,ja.REFLECTION=!1,ja.EMISSIVE=!1,ja.LIGHTMAP=!1,ja.BUMP=!1,ja.REFRACTION=!1;ja.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),ja.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,ja.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,ja.SPECULAROVERALPHA=this._useSpecularOverAlpha,ja.PREMULTIPLYALPHA=this.alphaMode===L.a.ALPHA_PREMULTIPLIED||this.alphaMode===L.a.ALPHA_PREMULTIPLIED_PORTERDUFF}if(ja._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(ja),ja.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,ja.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(ja._areFresnelDirty&&(U.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(ja.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,ja.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,ja.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,ja.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,ja.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,ja.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,ja._needNormals=!0,ja.FRESNEL=!0):ja.FRESNEL=!1),y.a.PrepareDefinesForMisc(P,oa,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(P),ja),y.a.PrepareDefinesForAttributes(P,ja,!0,!0,!0),y.a.PrepareDefinesForFrameBoundValues(oa,aa,ja,ma),ja.isDirty){var F=ja._areLightsDisposed;ja.markAsProcessed();var $=new Q.a();ja.REFLECTION&&$.addFallback(0,"REFLECTION"),ja.SPECULAR&&$.addFallback(0,"SPECULAR"),ja.BUMP&&$.addFallback(0,"BUMP"),ja.PARALLAX&&$.addFallback(1,"PARALLAX"),ja.PARALLAXOCCLUSION&&$.addFallback(0,"PARALLAXOCCLUSION"),ja.SPECULAROVERALPHA&&$.addFallback(0,"SPECULAROVERALPHA"),ja.FOG&&$.addFallback(1,"FOG"),ja.POINTSIZE&&$.addFallback(0,"POINTSIZE"),ja.LOGARITHMICDEPTH&&$.addFallback(0,"LOGARITHMICDEPTH"),y.a.HandleFallbacksForShadows(ja,$,this._maxSimultaneousLights),ja.SPECULARTERM&&$.addFallback(0,"SPECULARTERM"),ja.DIFFUSEFRESNEL&&$.addFallback(1,"DIFFUSEFRESNEL"),ja.OPACITYFRESNEL&&$.addFallback(2,"OPACITYFRESNEL"),ja.REFLECTIONFRESNEL&&$.addFallback(3,"REFLECTIONFRESNEL"),ja.EMISSIVEFRESNEL&&$.addFallback(4,"EMISSIVEFRESNEL"),ja.FRESNEL&&$.addFallback(4,"FRESNEL"),ja.MULTIVIEW&&$.addFallback(0,"MULTIVIEW");var ia=[E.b.PositionKind];ja.NORMAL&&ia.push(E.b.NormalKind),ja.UV1&&ia.push(E.b.UVKind),ja.UV2&&ia.push(E.b.UV2Kind),ja.VERTEXCOLOR&&ia.push(E.b.ColorKind),y.a.PrepareAttributesForBones(ia,P,ja,$),y.a.PrepareAttributesForInstances(ia,ja),y.a.PrepareAttributesForMorphTargets(ia,P,ja);var ba="default",qa=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],V=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],O=["Material","Scene"];x.a&&(x.a.PrepareUniforms(qa,ja),x.a.PrepareSamplers(V,ja)),y.a.PrepareUniformsAndSamplersList({uniformsNames:qa,uniformBuffersNames:O,samplers:V,defines:ja,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(ba=this.customShaderNameResolve(ba,qa,O,V,ja));var S=ja.toString(),W=ga.effect,da=oa.getEngine().createEffect(ba,{attributes:ia,uniformsNames:qa,uniformBuffersNames:O,samplers:V,defines:S,fallbacks:$,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:ja.NUM_MORPH_INFLUENCERS}},aa);if(da)if(this.allowShaderHotSwapping&&W&&!da.isReady()){if(da=W,this._rebuildInParallel=!0,ja.markAsUnprocessed(),F)return ja._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,oa.resetCachedMaterial(),ga.setEffect(da,ja),this.buildUniformLayout()}return!(!ga.effect||!ga.effect.isReady())&&(ja._renderId=oa.getRenderId(),ga.effect._wasPreviouslyReady=!0,!0)},U.prototype.buildUniformLayout=function(){var P=this._uniformBuffer;P.addUniform("diffuseLeftColor",4),P.addUniform("diffuseRightColor",4),P.addUniform("opacityParts",4),P.addUniform("reflectionLeftColor",4),P.addUniform("reflectionRightColor",4),P.addUniform("refractionLeftColor",4),P.addUniform("refractionRightColor",4),P.addUniform("emissiveLeftColor",4),P.addUniform("emissiveRightColor",4),P.addUniform("vDiffuseInfos",2),P.addUniform("vAmbientInfos",2),P.addUniform("vOpacityInfos",2),P.addUniform("vReflectionInfos",2),P.addUniform("vReflectionPosition",3),P.addUniform("vReflectionSize",3),P.addUniform("vEmissiveInfos",2),P.addUniform("vLightmapInfos",2),P.addUniform("vSpecularInfos",2),P.addUniform("vBumpInfos",3),P.addUniform("diffuseMatrix",16),P.addUniform("ambientMatrix",16),P.addUniform("opacityMatrix",16),P.addUniform("reflectionMatrix",16),P.addUniform("emissiveMatrix",16),P.addUniform("lightmapMatrix",16),P.addUniform("specularMatrix",16),P.addUniform("bumpMatrix",16),P.addUniform("vTangentSpaceParams",2),P.addUniform("pointSize",1),P.addUniform("refractionMatrix",16),P.addUniform("vRefractionInfos",4),P.addUniform("vSpecularColor",4),P.addUniform("vEmissiveColor",3),P.addUniform("visibility",1),P.addUniform("vDiffuseColor",4),P.create()},U.prototype.unbind=function(){if(this._activeEffect){var P=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),P=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),P=!0),P&&this._markAllSubMeshesAsTexturesDirty()}X.prototype.unbind.call(this)},U.prototype.bindForSubMesh=function(P,ga,ma){var oa=this.getScene(),ja=ma._materialDefines;if(ja){var aa=ma.effect;if(aa){this._activeEffect=aa,ja.INSTANCES||this.bindOnlyWorldMatrix(P),ja.OBJECTSPACE_NORMALMAP&&(P.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var F=this._mustRebind(oa,aa,ga.visibility);y.a.BindBonesParameters(ga,aa);var $=this._uniformBuffer;if(F){if($.bindToEffect(aa,"Material"),this.bindViewProjection(aa),!$.useUbo||!this.isFrozen||!$.isSync){if(U.FresnelEnabled&&ja.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&($.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),$.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&$.updateColor4("opacityParts",new D.a(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&($.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),$.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&($.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),$.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&($.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),$.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),oa.texturesEnabled){if(this._diffuseTexture&&U.DiffuseTextureEnabled&&($.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),y.a.BindTextureMatrix(this._diffuseTexture,$,"diffuse"),this._diffuseTexture.hasAlpha&&aa.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&U.AmbientTextureEnabled&&($.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),y.a.BindTextureMatrix(this._ambientTexture,$,"ambient")),this._opacityTexture&&U.OpacityTextureEnabled&&($.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),y.a.BindTextureMatrix(this._opacityTexture,$,"opacity")),this._reflectionTexture&&U.ReflectionTextureEnabled&&($.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),$.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var ia=this._reflectionTexture;$.updateVector3("vReflectionPosition",ia.boundingBoxPosition),$.updateVector3("vReflectionSize",ia.boundingBoxSize)}if(this._emissiveTexture&&U.EmissiveTextureEnabled&&($.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),y.a.BindTextureMatrix(this._emissiveTexture,$,"emissive")),this._lightmapTexture&&U.LightmapTextureEnabled&&($.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),y.a.BindTextureMatrix(this._lightmapTexture,$,"lightmap")),this._specularTexture&&U.SpecularTextureEnabled&&($.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),y.a.BindTextureMatrix(this._specularTexture,$,"specular")),this._bumpTexture&&oa.getEngine().getCaps().standardDerivatives&&U.BumpTextureEnabled&&($.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),y.a.BindTextureMatrix(this._bumpTexture,$,"bump"),oa._mirroredCameraPosition?$.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):$.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&U.RefractionTextureEnabled){var ba=1;this._refractionTexture.isCube||($.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(ba=this._refractionTexture.depth)),$.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,ba,this.invertRefractionY?-1:1)}}this.pointsCloud&&$.updateFloat("pointSize",this.pointSize),ja.SPECULARTERM&&$.updateColor4("vSpecularColor",this.specularColor,this.specularPower),$.updateColor3("vEmissiveColor",U.EmissiveTextureEnabled?this.emissiveColor:D.a.BlackReadOnly),$.updateFloat("visibility",ga.visibility),$.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}oa.texturesEnabled&&(this._diffuseTexture&&U.DiffuseTextureEnabled&&aa.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&U.AmbientTextureEnabled&&aa.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&U.OpacityTextureEnabled&&aa.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&U.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?aa.setTexture("reflectionCubeSampler",this._reflectionTexture):aa.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&U.EmissiveTextureEnabled&&aa.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&U.LightmapTextureEnabled&&aa.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&U.SpecularTextureEnabled&&aa.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&oa.getEngine().getCaps().standardDerivatives&&U.BumpTextureEnabled&&aa.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&U.RefractionTextureEnabled)&&(ba=1,this._refractionTexture.isCube?aa.setTexture("refractionCubeSampler",this._refractionTexture):aa.setTexture("refraction2DSampler",this._refractionTexture)),y.a.BindClipPlane(aa,oa),oa.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),y.a.BindEyePosition(aa,oa),aa.setColor3("vAmbientColor",this._globalAmbientColor)}!F&&this.isFrozen||(oa.lightsEnabled&&!this._disableLighting&&y.a.BindLights(oa,ga,aa,ja,this._maxSimultaneousLights,this._rebuildInParallel),(oa.fogEnabled&&ga.applyFog&&oa.fogMode!==i.a.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(aa),y.a.BindFogParameters(oa,ga,aa),ja.NUM_MORPH_INFLUENCERS&&y.a.BindMorphTargetParameters(ga,aa),this.useLogarithmicDepth&&y.a.BindLogDepth(ja,aa,oa),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),$.update(),this._afterBind(ga,this._activeEffect)}}},U.prototype.getAnimatables=function(){var P=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&P.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&P.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&P.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&P.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&P.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&P.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&P.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&P.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&P.push(this._refractionTexture),P},U.prototype.getActiveTextures=function(){var P=X.prototype.getActiveTextures.call(this);return this._diffuseTexture&&P.push(this._diffuseTexture),this._ambientTexture&&P.push(this._ambientTexture),this._opacityTexture&&P.push(this._opacityTexture),this._reflectionTexture&&P.push(this._reflectionTexture),this._emissiveTexture&&P.push(this._emissiveTexture),this._specularTexture&&P.push(this._specularTexture),this._bumpTexture&&P.push(this._bumpTexture),this._lightmapTexture&&P.push(this._lightmapTexture),this._refractionTexture&&P.push(this._refractionTexture),P},U.prototype.hasTexture=function(P){return!!X.prototype.hasTexture.call(this,P)||(this._diffuseTexture===P||(this._ambientTexture===P||(this._opacityTexture===P||(this._reflectionTexture===P||(this._emissiveTexture===P||(this._specularTexture===P||(this._bumpTexture===P||(this._lightmapTexture===P||this._refractionTexture===P))))))))},U.prototype.dispose=function(P,ga){ga&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),X.prototype.dispose.call(this,P,ga)},U.prototype.clone=function(P){var ga=this,ma=r.a.Clone(function(){return new U(P,ga.getScene())},this);return ma.name=P,ma.id=P,ma},U.prototype.serialize=function(){return r.a.Serialize(this)},U.Parse=function(P,ga,ma){return r.a.Parse(function(){return new U(P.name,ga)},P,ga,ma)},Object.defineProperty(U,"DiffuseTextureEnabled",{get:function(){return k.a.DiffuseTextureEnabled},set:function(P){k.a.DiffuseTextureEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U,"AmbientTextureEnabled",{get:function(){return k.a.AmbientTextureEnabled},set:function(P){k.a.AmbientTextureEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U,"OpacityTextureEnabled",{get:function(){return k.a.OpacityTextureEnabled},set:function(P){k.a.OpacityTextureEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U,"ReflectionTextureEnabled",{get:function(){return k.a.ReflectionTextureEnabled},set:function(P){k.a.ReflectionTextureEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U,"EmissiveTextureEnabled",{get:function(){return k.a.EmissiveTextureEnabled},set:function(P){k.a.EmissiveTextureEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U,"SpecularTextureEnabled",{get:function(){return k.a.SpecularTextureEnabled},set:function(P){k.a.SpecularTextureEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U,"BumpTextureEnabled",{get:function(){return k.a.BumpTextureEnabled},set:function(P){k.a.BumpTextureEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U,"LightmapTextureEnabled",{get:function(){return k.a.LightmapTextureEnabled},set:function(P){k.a.LightmapTextureEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U,"RefractionTextureEnabled",{get:function(){return k.a.RefractionTextureEnabled},set:function(P){k.a.RefractionTextureEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U,"ColorGradingTextureEnabled",{get:function(){return k.a.ColorGradingTextureEnabled},set:function(P){k.a.ColorGradingTextureEnabled=P},enumerable:!0,configurable:!0}),Object.defineProperty(U,"FresnelEnabled",{get:function(){return k.a.FresnelEnabled},set:function(P){k.a.FresnelEnabled=P},enumerable:!0,configurable:!0}),Object(R.c)([Object(r.m)("diffuseTexture")],U.prototype,"_diffuseTexture",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],U.prototype,"diffuseTexture",void 0),Object(R.c)([Object(r.m)("ambientTexture")],U.prototype,"_ambientTexture",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"ambientTexture",void 0),Object(R.c)([Object(r.m)("opacityTexture")],U.prototype,"_opacityTexture",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],U.prototype,"opacityTexture",void 0),Object(R.c)([Object(r.m)("reflectionTexture")],U.prototype,"_reflectionTexture",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"reflectionTexture",void 0),Object(R.c)([Object(r.m)("emissiveTexture")],U.prototype,"_emissiveTexture",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"emissiveTexture",void 0),Object(R.c)([Object(r.m)("specularTexture")],U.prototype,"_specularTexture",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"specularTexture",void 0),Object(R.c)([Object(r.m)("bumpTexture")],U.prototype,"_bumpTexture",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"bumpTexture",void 0),Object(R.c)([Object(r.m)("lightmapTexture")],U.prototype,"_lightmapTexture",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"lightmapTexture",void 0),Object(R.c)([Object(r.m)("refractionTexture")],U.prototype,"_refractionTexture",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"refractionTexture",void 0),Object(R.c)([Object(r.e)("ambient")],U.prototype,"ambientColor",void 0),Object(R.c)([Object(r.e)("diffuse")],U.prototype,"diffuseColor",void 0),Object(R.c)([Object(r.e)("specular")],U.prototype,"specularColor",void 0),Object(R.c)([Object(r.e)("emissive")],U.prototype,"emissiveColor",void 0),Object(R.c)([Object(r.c)()],U.prototype,"specularPower",void 0),Object(R.c)([Object(r.c)("useAlphaFromDiffuseTexture")],U.prototype,"_useAlphaFromDiffuseTexture",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"useAlphaFromDiffuseTexture",void 0),Object(R.c)([Object(r.c)("useEmissiveAsIllumination")],U.prototype,"_useEmissiveAsIllumination",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"useEmissiveAsIllumination",void 0),Object(R.c)([Object(r.c)("linkEmissiveWithDiffuse")],U.prototype,"_linkEmissiveWithDiffuse",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"linkEmissiveWithDiffuse",void 0),Object(R.c)([Object(r.c)("useSpecularOverAlpha")],U.prototype,"_useSpecularOverAlpha",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"useSpecularOverAlpha",void 0),Object(R.c)([Object(r.c)("useReflectionOverAlpha")],U.prototype,"_useReflectionOverAlpha",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"useReflectionOverAlpha",void 0),Object(R.c)([Object(r.c)("disableLighting")],U.prototype,"_disableLighting",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsLightsDirty")],U.prototype,"disableLighting",void 0),Object(R.c)([Object(r.c)("useObjectSpaceNormalMap")],U.prototype,"_useObjectSpaceNormalMap",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"useObjectSpaceNormalMap",void 0),Object(R.c)([Object(r.c)("useParallax")],U.prototype,"_useParallax",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"useParallax",void 0),Object(R.c)([Object(r.c)("useParallaxOcclusion")],U.prototype,"_useParallaxOcclusion",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"useParallaxOcclusion",void 0),Object(R.c)([Object(r.c)()],U.prototype,"parallaxScaleBias",void 0),Object(R.c)([Object(r.c)("roughness")],U.prototype,"_roughness",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"roughness",void 0),Object(R.c)([Object(r.c)()],U.prototype,"indexOfRefraction",void 0),Object(R.c)([Object(r.c)()],U.prototype,"invertRefractionY",void 0),Object(R.c)([Object(r.c)()],U.prototype,"alphaCutOff",void 0),Object(R.c)([Object(r.c)("useLightmapAsShadowmap")],U.prototype,"_useLightmapAsShadowmap",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"useLightmapAsShadowmap",void 0),Object(R.c)([Object(r.h)("diffuseFresnelParameters")],U.prototype,"_diffuseFresnelParameters",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsFresnelDirty")],U.prototype,"diffuseFresnelParameters",void 0),Object(R.c)([Object(r.h)("opacityFresnelParameters")],U.prototype,"_opacityFresnelParameters",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],U.prototype,"opacityFresnelParameters",void 0),Object(R.c)([Object(r.h)("reflectionFresnelParameters")],U.prototype,"_reflectionFresnelParameters",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsFresnelDirty")],U.prototype,"reflectionFresnelParameters",void 0),Object(R.c)([Object(r.h)("refractionFresnelParameters")],U.prototype,"_refractionFresnelParameters",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsFresnelDirty")],U.prototype,"refractionFresnelParameters",void 0),Object(R.c)([Object(r.h)("emissiveFresnelParameters")],U.prototype,"_emissiveFresnelParameters",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsFresnelDirty")],U.prototype,"emissiveFresnelParameters",void 0),Object(R.c)([Object(r.c)("useReflectionFresnelFromSpecular")],U.prototype,"_useReflectionFresnelFromSpecular",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsFresnelDirty")],U.prototype,"useReflectionFresnelFromSpecular",void 0),Object(R.c)([Object(r.c)("useGlossinessFromSpecularMapAlpha")],U.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"useGlossinessFromSpecularMapAlpha",void 0),Object(R.c)([Object(r.c)("maxSimultaneousLights")],U.prototype,"_maxSimultaneousLights",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsLightsDirty")],U.prototype,"maxSimultaneousLights",void 0),Object(R.c)([Object(r.c)("invertNormalMapX")],U.prototype,"_invertNormalMapX",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"invertNormalMapX",void 0),Object(R.c)([Object(r.c)("invertNormalMapY")],U.prototype,"_invertNormalMapY",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"invertNormalMapY",void 0),Object(R.c)([Object(r.c)("twoSidedLighting")],U.prototype,"_twoSidedLighting",void 0),Object(R.c)([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"twoSidedLighting",void 0),Object(R.c)([Object(r.c)()],U.prototype,"useLogarithmicDepth",null),U}(s.a);n.a.RegisteredTypes["BABYLON.StandardMaterial"]=Y,i.a.DefaultMaterialFactory=function(X){return new Y("default material",X)}},function(Ja,t,o){"use strict";o.d(t,"a",function(){return I});var R=o(36),r=function(i,G){return i?i.getClassName&&"Mesh"===i.getClassName()?null:i.getClassName&&"SubMesh"===i.getClassName()?i.clone(G):i.clone?i.clone():null:null},I=function(){function i(){}return i.DeepCopy=function(G,D,E,x){for(var l in G)if(("_"!==l[0]||x&&-1!==x.indexOf(l))&&!(R.a.EndsWith(l,"Observable")||E&&-1!==E.indexOf(l))){var s=G[l],y=typeof s;if("function"!==y)try{if("object"===y)if(s instanceof Array){if(D[l]=[],s.length>0)if("object"==typeof s[0])for(var q=0;q<s.length;q++){var n=r(s[q],D);-1===D[l].indexOf(n)&&D[l].push(n)}else D[l]=s.slice(0)}else D[l]=r(s,D);else D[l]=s}catch(k){}}},i}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r}),o.d(t,"b",function(){return I});var R=o(1),r=function(){function i(G){this.length=0,this.data=new Array(G),this._id=i._GlobalId++}return i.prototype.push=function(G){this.data[this.length++]=G,this.length>this.data.length&&(this.data.length*=2)},i.prototype.forEach=function(G){for(var D=0;D<this.length;D++)G(this.data[D])},i.prototype.sort=function(G){this.data.sort(G)},i.prototype.reset=function(){this.length=0},i.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},i.prototype.concat=function(G){if(0!==G.length){this.length+G.length>this.data.length&&(this.data.length=2*(this.length+G.length));for(var D=0;D<G.length;D++)this.data[this.length++]=(G.data||G)[D]}},i.prototype.indexOf=function(G){var D=this.data.indexOf(G);return D>=this.length?-1:D},i.prototype.contains=function(G){return-1!==this.indexOf(G)},i._GlobalId=0,i}(),I=function(i){function G(){var D=null!==i&&i.apply(this,arguments)||this;return D._duplicateId=0,D}return Object(R.d)(G,i),G.prototype.push=function(D){i.prototype.push.call(this,D),D.__smartArrayFlags||(D.__smartArrayFlags={}),D.__smartArrayFlags[this._id]=this._duplicateId},G.prototype.pushNoDuplicate=function(D){return(!D.__smartArrayFlags||D.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(D),!0)},G.prototype.reset=function(){i.prototype.reset.call(this),this._duplicateId++},G.prototype.concatWithNoDuplicate=function(D){if(0!==D.length){this.length+D.length>this.data.length&&(this.data.length=2*(this.length+D.length));for(var E=0;E<D.length;E++){var x=(D.data||D)[E];this.pushNoDuplicate(x)}}},G}(r)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(125),r=function(){function I(){}return I.EnableFor=function(i){i._tags=i._tags||{},i.hasTags=function(){return I.HasTags(i)},i.addTags=function(G){return I.AddTagsTo(i,G)},i.removeTags=function(G){return I.RemoveTagsFrom(i,G)},i.matchesTagsQuery=function(G){return I.MatchesQuery(i,G)}},I.DisableFor=function(i){delete i._tags,delete i.hasTags,delete i.addTags,delete i.removeTags,delete i.matchesTagsQuery},I.HasTags=function(i){if(!i._tags)return!1;var G=i._tags;for(var D in G)if(G.hasOwnProperty(D))return!0;return!1},I.GetTags=function(i,G){if(void 0===G&&(G=!0),!i._tags)return null;if(G){var D=[];for(var E in i._tags)i._tags.hasOwnProperty(E)&&!0===i._tags[E]&&D.push(E);return D.join(" ")}return i._tags},I.AddTagsTo=function(i,G){G&&("string"==typeof G&&G.split(" ").forEach(function(D,E,x){I._AddTagTo(i,D)}))},I._AddTagTo=function(i,G){""!==(G=G.trim())&&"true"!==G&&"false"!==G&&(G.match(/[\s]/)||G.match(/^([!]|([|]|[&]){2})/)||(I.EnableFor(i),i._tags[G]=!0))},I.RemoveTagsFrom=function(i,G){if(I.HasTags(i)){var D=G.split(" ");for(var E in D)I._RemoveTagFrom(i,D[E])}},I._RemoveTagFrom=function(i,G){delete i._tags[G]},I.MatchesQuery=function(i,G){return void 0===G||(""===G?I.HasTags(i):R.a.Eval(G,function(D){return I.HasTags(i)&&i._tags[D]}))},I}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.EndsWith=function(I,i){return-1!==I.indexOf(i,I.length-i.length)},r.StartsWith=function(I,i){return 0===I.indexOf(i)},r.Decode=function(I){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(I);for(var i="",G=0;G<I.byteLength;G++)i+=String.fromCharCode(I[G]);return i},r.EncodeArrayBufferToBase64=function(I){for(var i,G,D,E,x,l,s,y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",q="",n=0,k=ArrayBuffer.isView(I)?new Uint8Array(I.buffer,I.byteOffset,I.byteLength):new Uint8Array(I);n<k.length;)E=(i=k[n++])>>2,x=(3&i)<<4|(G=n<k.length?k[n++]:Number.NaN)>>4,l=(15&G)<<2|(D=n<k.length?k[n++]:Number.NaN)>>6,s=63&D,isNaN(G)?l=s=64:isNaN(D)&&(s=64),q+=y.charAt(E)+y.charAt(x)+y.charAt(l)+y.charAt(s);return q},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){this.rootNodes=new Array(),this.cameras=new Array(),this.lights=new Array(),this.meshes=new Array(),this.skeletons=new Array(),this.particleSystems=new Array(),this.animations=[],this.animationGroups=new Array(),this.multiMaterials=new Array(),this.materials=new Array(),this.morphTargetManagers=new Array(),this.geometries=new Array(),this.transformNodes=new Array(),this.actionManagers=new Array(),this.textures=new Array(),this.environmentTexture=null}return r.AddParser=function(I,i){this._BabylonFileParsers[I]=i},r.GetParser=function(I){return this._BabylonFileParsers[I]?this._BabylonFileParsers[I]:null},r.AddIndividualParser=function(I,i){this._IndividualBabylonFileParsers[I]=i},r.GetIndividualParser=function(I){return this._IndividualBabylonFileParsers[I]?this._IndividualBabylonFileParsers[I]:null},r.Parse=function(I,i,G,D){for(var E in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(E)&&this._BabylonFileParsers[E](I,i,G,D)},r.prototype.getNodes=function(){var I=new Array();return I=(I=(I=(I=I.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach(function(i){return I=I.concat(i.bones)}),I},r._BabylonFileParsers={},r._IndividualBabylonFileParsers={},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.IsWindowObjectExist=function(){return"undefined"!=typeof window},r.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},r.GetDOMTextContent=function(I){for(var i="",G=I.firstChild;G;)3===G.nodeType&&(i+=G.textContent),G=G.nextSibling;return i},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return E});var R=o(42),r=o(0),I=o(53),i=o(105),G=o(18),D=o(24),E=function(){function x(l,s,y){void 0===y&&(y=Number.MAX_VALUE),this.origin=l,this.direction=s,this.length=y}return x.prototype.intersectsBoxMinMax=function(l,s,y){void 0===y&&(y=0);var q,n,k,p,u=x.TmpVector3[0].copyFromFloats(l.x-y,l.y-y,l.z-y),A=x.TmpVector3[1].copyFromFloats(s.x+y,s.y+y,s.z+y),B=0,v=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-07){if(this.origin.x<u.x||this.origin.x>A.x)return!1}else if(q=1/this.direction.x,n=(u.x-this.origin.x)*q,(k=(A.x-this.origin.x)*q)===-1/0&&(k=1/0),n>k&&(p=n,n=k,k=p),(B=Math.max(n,B))>(v=Math.min(k,v)))return!1;if(Math.abs(this.direction.y)<1e-07){if(this.origin.y<u.y||this.origin.y>A.y)return!1}else if(q=1/this.direction.y,n=(u.y-this.origin.y)*q,(k=(A.y-this.origin.y)*q)===-1/0&&(k=1/0),n>k&&(p=n,n=k,k=p),(B=Math.max(n,B))>(v=Math.min(k,v)))return!1;if(Math.abs(this.direction.z)<1e-07){if(this.origin.z<u.z||this.origin.z>A.z)return!1}else if(q=1/this.direction.z,n=(u.z-this.origin.z)*q,(k=(A.z-this.origin.z)*q)===-1/0&&(k=1/0),n>k&&(p=n,n=k,k=p),(B=Math.max(n,B))>(v=Math.min(k,v)))return!1;return!0},x.prototype.intersectsBox=function(l,s){return void 0===s&&(s=0),this.intersectsBoxMinMax(l.minimum,l.maximum,s)},x.prototype.intersectsSphere=function(l,s){void 0===s&&(s=0);var y=l.center.x-this.origin.x,q=l.center.y-this.origin.y,n=l.center.z-this.origin.z,k=y*y+q*q+n*n,p=l.radius+s,u=p*p;if(k<=u)return!0;var A=y*this.direction.x+q*this.direction.y+n*this.direction.z;return!(A<0)&&k-A*A<=u},x.prototype.intersectsTriangle=function(l,s,y){var q=x.TmpVector3[0],n=x.TmpVector3[1],k=x.TmpVector3[2],p=x.TmpVector3[3],u=x.TmpVector3[4];s.subtractToRef(l,q),y.subtractToRef(l,n),r.e.CrossToRef(this.direction,n,k);var A=r.e.Dot(q,k);if(0===A)return null;var B=1/A;this.origin.subtractToRef(l,p);var v=r.e.Dot(p,k)*B;if(v<0||v>1)return null;r.e.CrossToRef(p,q,u);var H=r.e.Dot(this.direction,u)*B;if(H<0||v+H>1)return null;var L=r.e.Dot(n,u)*B;return L>this.length?null:new i.a(1-v-H,v,L)},x.prototype.intersectsPlane=function(l){var s,y=r.e.Dot(l.normal,this.direction);if(Math.abs(y)<9.99999997475243e-07)return null;var q=r.e.Dot(l.normal,this.origin);return(s=(-l.d-q)/y)<0?s<-9.99999997475243e-07?null:0:s},x.prototype.intersectsAxis=function(l,s){switch(void 0===s&&(s=0),l){case"y":return(y=(this.origin.y-s)/this.direction.y)>0?null:new r.e(this.origin.x+this.direction.x*-y,s,this.origin.z+this.direction.z*-y);case"x":return(y=(this.origin.x-s)/this.direction.x)>0?null:new r.e(s,this.origin.y+this.direction.y*-y,this.origin.z+this.direction.z*-y);case"z":var y;return(y=(this.origin.z-s)/this.direction.z)>0?null:new r.e(this.origin.x+this.direction.x*-y,this.origin.y+this.direction.y*-y,s);default:return null}},x.prototype.intersectsMesh=function(l,s){var y=r.c.Matrix[0];return l.getWorldMatrix().invertToRef(y),this._tmpRay?x.TransformToRef(this,y,this._tmpRay):this._tmpRay=x.Transform(this,y),l.intersects(this._tmpRay,s)},x.prototype.intersectsMeshes=function(l,s,y){y?y.length=0:y=[];for(var q=0;q<l.length;q++){var n=this.intersectsMesh(l[q],s);n.hit&&y.push(n)}return y.sort(this._comparePickingInfo),y},x.prototype._comparePickingInfo=function(l,s){return l.distance<s.distance?-1:l.distance>s.distance?1:0},x.prototype.intersectionSegment=function(l,s,y){var q=this.origin,n=r.c.Vector3[0],k=r.c.Vector3[1],p=r.c.Vector3[2],u=r.c.Vector3[3];s.subtractToRef(l,n),this.direction.scaleToRef(x.rayl,p),q.addToRef(p,k),l.subtractToRef(q,u);var A,B,v,H,L=r.e.Dot(n,n),Q=r.e.Dot(n,p),M=r.e.Dot(p,p),Y=r.e.Dot(n,u),X=r.e.Dot(p,u),U=L*M-Q*Q,P=U,ga=U;U<x.smallnum?(B=0,P=1,H=X,ga=M):(H=L*X-Q*Y,(B=Q*X-M*Y)<0?(B=0,H=X,ga=M):B>P&&(B=P,H=X+Q,ga=M)),H<0?(H=0,-Y<0?B=0:-Y>L?B=P:(B=-Y,P=L)):H>ga&&(H=ga,-Y+Q<0?B=0:-Y+Q>L?B=P:(B=-Y+Q,P=L)),A=Math.abs(B)<x.smallnum?0:B/P,v=Math.abs(H)<x.smallnum?0:H/ga;var ma=r.c.Vector3[4];p.scaleToRef(v,ma);var oa=r.c.Vector3[5];n.scaleToRef(A,oa),oa.addInPlace(u);var ja=r.c.Vector3[6];return oa.subtractToRef(ma,ja),v>0&&v<=this.length&&ja.lengthSquared()<y*y?oa.length():-1},x.prototype.update=function(l,s,y,q,n,k,p){return this.unprojectRayToRef(l,s,y,q,n,k,p),this},x.Zero=function(){return new x(r.e.Zero(),r.e.Zero())},x.CreateNew=function(l,s,y,q,n,k,p){return x.Zero().update(l,s,y,q,n,k,p)},x.CreateNewFromTo=function(l,s,y){void 0===y&&(y=r.a.IdentityReadOnly);var q=s.subtract(l),n=Math.sqrt(q.x*q.x+q.y*q.y+q.z*q.z);return q.normalize(),x.Transform(new x(l,q,n),y)},x.Transform=function(l,s){var y=new x(new r.e(0,0,0),new r.e(0,0,0));return x.TransformToRef(l,s,y),y},x.TransformToRef=function(l,s,y){r.e.TransformCoordinatesToRef(l.origin,s,y.origin),r.e.TransformNormalToRef(l.direction,s,y.direction),y.length=l.length;var q=y.direction,n=q.length();if(0!==n&&1!==n){var k=1/n;q.x*=k,q.y*=k,q.z*=k,y.length*=n}},x.prototype.unprojectRayToRef=function(l,s,y,q,n,k,p){var u=r.c.Matrix[0];n.multiplyToRef(k,u),u.multiplyToRef(p,u),u.invert();var A=r.c.Vector3[0];A.x=l/y*2-1,A.y=-(s/q*2-1),A.z=-1;var B=r.c.Vector3[1].copyFromFloats(A.x,A.y,1),v=r.c.Vector3[2],H=r.c.Vector3[3];r.e._UnprojectFromInvertedMatrixToRef(A,u,v),r.e._UnprojectFromInvertedMatrixToRef(B,u,H),this.origin.copyFrom(v),H.subtractToRef(v,this.direction),this.direction.normalize()},x.TmpVector3=R.a.BuildArray(6,r.e.Zero),x.smallnum=1e-08,x.rayl=1e09,x}();G.a.prototype.createPickingRay=function(x,l,s,y,q){void 0===q&&(q=!1);var n=E.Zero();return this.createPickingRayToRef(x,l,s,n,y,q),n},G.a.prototype.createPickingRayToRef=function(x,l,s,y,q,n){void 0===n&&(n=!1);var k=this.getEngine();if(!q){if(!this.activeCamera)return this;q=this.activeCamera}var p=q.viewport.toGlobal(k.getRenderWidth(),k.getRenderHeight());return x=x/k.getHardwareScalingLevel()-p.x,l=l/k.getHardwareScalingLevel()-(k.getRenderHeight()-p.y-p.height),y.update(x,l,p.width,p.height,s||r.a.IdentityReadOnly,n?r.a.IdentityReadOnly:q.getViewMatrix(),q.getProjectionMatrix()),this},G.a.prototype.createPickingRayInCameraSpace=function(x,l,s){var y=E.Zero();return this.createPickingRayInCameraSpaceToRef(x,l,y,s),y},G.a.prototype.createPickingRayInCameraSpaceToRef=function(x,l,s,y){if(!I.a)return this;var q=this.getEngine();if(!y){if(!this.activeCamera)throw new Error("Active camera not set");y=this.activeCamera}var n=y.viewport.toGlobal(q.getRenderWidth(),q.getRenderHeight()),k=r.a.Identity();return x=x/q.getHardwareScalingLevel()-n.x,l=l/q.getHardwareScalingLevel()-(q.getRenderHeight()-n.y-n.height),s.update(x,l,n.width,n.height,k,k,y.getProjectionMatrix()),this},G.a.prototype._internalPick=function(x,l,s,y){if(!I.a)return null;for(var q=null,n=0;n<this.meshes.length;n++){var k=this.meshes[n];if(l){if(!l(k))continue}else if(!k.isEnabled()||!k.isVisible||!k.isPickable)continue;var p=x(k.getWorldMatrix()),u=k.intersects(p,s,y);if(u&&u.hit&&((s||null==q||!(u.distance>=q.distance))&&(q=u,s)))break}return q||new I.a()},G.a.prototype._internalMultiPick=function(x,l,s){if(!I.a)return null;for(var y=new Array(),q=0;q<this.meshes.length;q++){var n=this.meshes[q];if(l){if(!l(n))continue}else if(!n.isEnabled()||!n.isVisible||!n.isPickable)continue;var k=x(n.getWorldMatrix()),p=n.intersects(k,!1,s);p&&p.hit&&y.push(p)}return y},G.a.prototype.pick=function(x,l,s,y,q,n){var k=this;if(!I.a)return null;var p=this._internalPick(function(u){return k._tempPickingRay||(k._tempPickingRay=E.Zero()),k.createPickingRayToRef(x,l,u,k._tempPickingRay,q||null),k._tempPickingRay},s,y,n);return p&&(p.ray=this.createPickingRay(x,l,r.a.Identity(),q||null)),p},G.a.prototype.pickWithRay=function(x,l,s,y){var q=this,n=this._internalPick(function(k){return q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=r.a.Identity()),k.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=E.Zero()),E.TransformToRef(x,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform},l,s,y);return n&&(n.ray=x),n},G.a.prototype.multiPick=function(x,l,s,y,q){var n=this;return this._internalMultiPick(function(k){return n.createPickingRay(x,l,k,y||null)},s,q)},G.a.prototype.multiPickWithRay=function(x,l,s){var y=this;return this._internalMultiPick(function(q){return y._pickWithRayInverseMatrix||(y._pickWithRayInverseMatrix=r.a.Identity()),q.invertToRef(y._pickWithRayInverseMatrix),y._cachedRayForTransform||(y._cachedRayForTransform=E.Zero()),E.TransformToRef(x,y._pickWithRayInverseMatrix,y._cachedRayForTransform),y._cachedRayForTransform},l,s)},D.a.prototype.getForwardRay=function(x,l,s){void 0===x&&(x=100),l||(l=this.getWorldMatrix()),s||(s=this.position);var y=this._scene.useRightHandedSystem?new r.e(0,0,-1):new r.e(0,0,1),q=r.e.TransformNormal(y,l),n=r.e.Normalize(q);return new E(s,n,x)}},function(Ja,t,o){"use strict";o.d(t,"b",function(){return x}),o.d(t,"a",function(){return l});var R=o(1),r=o(3),I=o(6),i=o(13),G=o(10),D=o(73),E=o(111),x=function(s){function y(){var q=s.call(this)||this;return q.IMAGEPROCESSING=!1,q.VIGNETTE=!1,q.VIGNETTEBLENDMODEMULTIPLY=!1,q.VIGNETTEBLENDMODEOPAQUE=!1,q.TONEMAPPING=!1,q.TONEMAPPING_ACES=!1,q.CONTRAST=!1,q.COLORCURVES=!1,q.COLORGRADING=!1,q.COLORGRADING3D=!1,q.SAMPLER3DGREENDEPTH=!1,q.SAMPLER3DBGRMAP=!1,q.IMAGEPROCESSINGPOSTPROCESS=!1,q.EXPOSURE=!1,q.rebuild(),q}return Object(R.d)(y,s),y}(D.a),l=function(){function s(){this.colorCurves=new E.a(),this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=s.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new G.b(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=s.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new I.c()}return Object.defineProperty(s.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(y){this._colorCurvesEnabled!==y&&(this._colorCurvesEnabled=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(y){this._colorGradingTexture!==y&&(this._colorGradingTexture=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(y){this._colorGradingEnabled!==y&&(this._colorGradingEnabled=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(y){this._colorGradingWithGreenDepth!==y&&(this._colorGradingWithGreenDepth=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(y){this._colorGradingBGR!==y&&(this._colorGradingBGR=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"exposure",{get:function(){return this._exposure},set:function(y){this._exposure!==y&&(this._exposure=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(y){this._toneMappingEnabled!==y&&(this._toneMappingEnabled=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(y){this._toneMappingType!==y&&(this._toneMappingType=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"contrast",{get:function(){return this._contrast},set:function(y){this._contrast!==y&&(this._contrast=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(y){this._vignetteBlendMode!==y&&(this._vignetteBlendMode=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(y){this._vignetteEnabled!==y&&(this._vignetteEnabled=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(y){this._applyByPostProcess!==y&&(this._applyByPostProcess=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(y){this._isEnabled!==y&&(this._isEnabled=y,this._updateParameters())},enumerable:!0,configurable:!0}),s.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},s.prototype.getClassName=function(){return"ImageProcessingConfiguration"},s.PrepareUniforms=function(y,q){q.EXPOSURE&&y.push("exposureLinear"),q.CONTRAST&&y.push("contrast"),q.COLORGRADING&&y.push("colorTransformSettings"),q.VIGNETTE&&(y.push("vInverseScreenSize"),y.push("vignetteSettings1"),y.push("vignetteSettings2")),q.COLORCURVES&&E.a.PrepareUniforms(y)},s.PrepareSamplers=function(y,q){q.COLORGRADING&&y.push("txColorTransform")},s.prototype.prepareDefines=function(y,q){if(void 0===q&&(q=!1),q!==this.applyByPostProcess||!this._isEnabled)return y.VIGNETTE=!1,y.TONEMAPPING=!1,y.TONEMAPPING_ACES=!1,y.CONTRAST=!1,y.EXPOSURE=!1,y.COLORCURVES=!1,y.COLORGRADING=!1,y.COLORGRADING3D=!1,y.IMAGEPROCESSING=!1,void(y.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(y.VIGNETTE=this.vignetteEnabled,y.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===s._VIGNETTEMODE_MULTIPLY,y.VIGNETTEBLENDMODEOPAQUE=!y.VIGNETTEBLENDMODEMULTIPLY,y.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case s.TONEMAPPING_ACES:y.TONEMAPPING_ACES=!0;break;default:y.TONEMAPPING_ACES=!1}y.CONTRAST=1!==this.contrast,y.EXPOSURE=1!==this.exposure,y.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,y.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,y.COLORGRADING?y.COLORGRADING3D=this.colorGradingTexture.is3D:y.COLORGRADING3D=!1,y.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,y.SAMPLER3DBGRMAP=this.colorGradingBGR,y.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,y.IMAGEPROCESSING=y.VIGNETTE||y.TONEMAPPING||y.CONTRAST||y.EXPOSURE||y.COLORCURVES||y.COLORGRADING},s.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},s.prototype.bind=function(y,q){if(this._colorCurvesEnabled&&this.colorCurves&&E.a.Bind(this.colorCurves,y),this._vignetteEnabled){var n=1/y.getEngine().getRenderWidth(),k=1/y.getEngine().getRenderHeight();y.setFloat2("vInverseScreenSize",n,k);var p=null!=q?q:k/n,u=Math.tan(.5*this.vignetteCameraFov),A=u*p,B=Math.sqrt(A*u);A=i.b.Mix(A,B,this.vignetteStretch),u=i.b.Mix(u,B,this.vignetteStretch),y.setFloat4("vignetteSettings1",A,u,-A*this.vignetteCentreX,-u*this.vignetteCentreY);var v=-2*this.vignetteWeight;y.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,v)}if(y.setFloat("exposureLinear",this.exposure),y.setFloat("contrast",this.contrast),this.colorGradingTexture){y.setTexture("txColorTransform",this.colorGradingTexture);var H=this.colorGradingTexture.getSize().height;y.setFloat4("colorTransformSettings",(H-1)/H,.5/H,H,this.colorGradingTexture.level)}},s.prototype.clone=function(){return r.a.Clone(function(){return new s()},this)},s.prototype.serialize=function(){return r.a.Serialize(this)},s.Parse=function(y){return r.a.Parse(function(){return new s()},y,null,null)},Object.defineProperty(s,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(s,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),s.TONEMAPPING_STANDARD=0,s.TONEMAPPING_ACES=1,s._VIGNETTEMODE_MULTIPLY=0,s._VIGNETTEMODE_OPAQUE=1,Object(R.c)([Object(r.g)()],s.prototype,"colorCurves",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_colorCurvesEnabled",void 0),Object(R.c)([Object(r.m)("colorGradingTexture")],s.prototype,"_colorGradingTexture",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_colorGradingEnabled",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_colorGradingWithGreenDepth",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_colorGradingBGR",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_exposure",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_toneMappingEnabled",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_toneMappingType",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_contrast",void 0),Object(R.c)([Object(r.c)()],s.prototype,"vignetteStretch",void 0),Object(R.c)([Object(r.c)()],s.prototype,"vignetteCentreX",void 0),Object(R.c)([Object(r.c)()],s.prototype,"vignetteCentreY",void 0),Object(R.c)([Object(r.c)()],s.prototype,"vignetteWeight",void 0),Object(R.c)([Object(r.f)()],s.prototype,"vignetteColor",void 0),Object(R.c)([Object(r.c)()],s.prototype,"vignetteCameraFov",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_vignetteBlendMode",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_vignetteEnabled",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_applyByPostProcess",void 0),Object(R.c)([Object(r.c)()],s.prototype,"_isEnabled",void 0),s}();r.a._ImageProcessingConfigurationParser=l.Parse},function(Ja,t,o){"use strict";o.d(t,"a",function(){return x});var R=o(18),r=o(6),I=o(20),i=o(23),G=o(80),D=o(0),E=o(10),x=function(){function l(s,y){var q=this;void 0===y&&(y=!0),this.originalScene=s,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this._renderCamera=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new r.c(),this.utilityLayerScene=new R.a(s.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=s.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.detachControl(),y&&(this._originalPointerObserver=s.onPrePointerObservable.add(function(n,k){if(q.utilityLayerScene.activeCamera&&(q.processAllEvents||n.type===I.a.POINTERMOVE||n.type===I.a.POINTERUP||n.type===I.a.POINTERDOWN)){q.utilityLayerScene.pointerX=s.pointerX,q.utilityLayerScene.pointerY=s.pointerY;var p=n.event;if(s.isPointerCaptured(p.pointerId))q._pointerCaptures[p.pointerId]=!1;else{var u=n.ray?q.utilityLayerScene.pickWithRay(n.ray):q.utilityLayerScene.pick(s.pointerX,s.pointerY);if(!n.ray&&u&&(n.ray=u.ray),q.utilityLayerScene.onPrePointerObservable.notifyObservers(n),q.onlyCheckPointerDownEvents&&n.type!=I.a.POINTERDOWN)return n.skipOnPointerObservable||q.utilityLayerScene.onPointerObservable.notifyObservers(new I.b(n.type,n.event,u)),void(n.type===I.a.POINTERUP&&q._pointerCaptures[p.pointerId]&&(q._pointerCaptures[p.pointerId]=!1));if(q.utilityLayerScene.autoClearDepthAndStencil||q.pickUtilitySceneFirst)u&&u.hit&&(n.skipOnPointerObservable||q.utilityLayerScene.onPointerObservable.notifyObservers(new I.b(n.type,n.event,u)),n.skipOnPointerObservable=!0);else{var A=n.ray?s.pickWithRay(n.ray):s.pick(s.pointerX,s.pointerY),B=n.event;A&&u&&(0===u.distance&&A.pickedMesh?q.mainSceneTrackerPredicate&&q.mainSceneTrackerPredicate(A.pickedMesh)?(q._notifyObservers(n,A,B),n.skipOnPointerObservable=!0):n.type===I.a.POINTERDOWN?q._pointerCaptures[B.pointerId]=!0:q._lastPointerEvents[B.pointerId]&&(q.onPointerOutObservable.notifyObservers(B.pointerId),delete q._lastPointerEvents[B.pointerId]):!q._pointerCaptures[B.pointerId]&&(u.distance<A.distance||0===A.distance)?(q._notifyObservers(n,u,B),n.skipOnPointerObservable||(n.skipOnPointerObservable=u.distance>0)):!q._pointerCaptures[B.pointerId]&&u.distance>A.distance&&(q.mainSceneTrackerPredicate&&q.mainSceneTrackerPredicate(A.pickedMesh)?(q._notifyObservers(n,A,B),n.skipOnPointerObservable=!0):q._lastPointerEvents[B.pointerId]&&(q.onPointerOutObservable.notifyObservers(B.pointerId),delete q._lastPointerEvents[B.pointerId])),n.type===I.a.POINTERUP&&q._pointerCaptures[B.pointerId]&&(q._pointerCaptures[B.pointerId]=!1))}}}}),this._originalPointerObserver&&s.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterCameraRenderObservable.add(function(n){q.shouldRender&&n==q.getRenderCamera()&&q.render()}),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add(function(){q.dispose()}),this._updateCamera()}return l.prototype.getRenderCamera=function(s){if(this._renderCamera)return this._renderCamera;var y;return y=this.originalScene.activeCameras.length>1?this.originalScene.activeCameras[this.originalScene.activeCameras.length-1]:this.originalScene.activeCamera,s&&y&&y.isRigCamera?y.rigParent:y},l.prototype.setRenderCamera=function(s){this._renderCamera=s},l.prototype._getSharedGizmoLight=function(){return this._sharedGizmoLight||(this._sharedGizmoLight=new G.a("shared gizmo light",new D.e(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=E.a.Gray()),this._sharedGizmoLight},Object.defineProperty(l,"DefaultUtilityLayer",{get:function(){return null==l._DefaultUtilityLayer&&(l._DefaultUtilityLayer=new l(i.a.LastCreatedScene),l._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){l._DefaultUtilityLayer=null})),l._DefaultUtilityLayer},enumerable:!0,configurable:!0}),Object.defineProperty(l,"DefaultKeepDepthUtilityLayer",{get:function(){return null==l._DefaultKeepDepthUtilityLayer&&(l._DefaultKeepDepthUtilityLayer=new l(i.a.LastCreatedScene),l._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,l._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){l._DefaultKeepDepthUtilityLayer=null})),l._DefaultKeepDepthUtilityLayer},enumerable:!0,configurable:!0}),l.prototype._notifyObservers=function(s,y,q){s.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new I.b(s.type,s.event,y)),this._lastPointerEvents[q.pointerId]=!0)},l.prototype.render=function(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){var s=this.utilityLayerScene.activeCamera.getScene(),y=this.utilityLayerScene.activeCamera;y._scene=this.utilityLayerScene,y.leftCamera&&(y.leftCamera._scene=this.utilityLayerScene),y.rightCamera&&(y.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),y._scene=s,y.leftCamera&&(y.leftCamera._scene=s),y.rightCamera&&(y.rightCamera._scene=s)}},l.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},l.prototype._updateCamera=function(){this.utilityLayerScene.cameraToUseForPointers=this.getRenderCamera(),this.utilityLayerScene.activeCamera=this.getRenderCamera()},l._DefaultUtilityLayer=null,l._DefaultKeepDepthUtilityLayer=null,l}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.BuildArray=function(I,i){for(var G=[],D=0;D<I;++D)G.push(i());return G},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return E});var R=o(1),r=o(3),I=o(6),i=o(0),G=o(26),D=o(22),E=function(x){function l(s,y,q){void 0===y&&(y=null),void 0===q&&(q=!0);var n=x.call(this,s,y)||this;return n._forward=new i.e(0,0,1),n._forwardInverted=new i.e(0,0,-1),n._up=new i.e(0,1,0),n._right=new i.e(1,0,0),n._rightInverted=new i.e(-1,0,0),n._position=i.e.Zero(),n._rotation=i.e.Zero(),n._rotationQuaternion=null,n._scaling=i.e.One(),n._isDirty=!1,n._transformToBoneReferal=null,n._isAbsoluteSynced=!1,n._billboardMode=l.BILLBOARDMODE_NONE,n._preserveParentRotationForBillboard=!1,n.scalingDeterminant=1,n._infiniteDistance=!1,n.ignoreNonUniformScaling=!1,n.reIntegrateRotationIntoRotationQuaternion=!1,n._poseMatrix=null,n._localMatrix=i.a.Zero(),n._usePivotMatrix=!1,n._absolutePosition=i.e.Zero(),n._absoluteScaling=i.e.Zero(),n._absoluteRotationQuaternion=i.b.Identity(),n._pivotMatrix=i.a.Identity(),n._postMultiplyPivotMatrix=!1,n._isWorldMatrixFrozen=!1,n._indexInSceneTransformNodesArray=-1,n.onAfterWorldMatrixUpdateObservable=new I.c(),n._nonUniformScaling=!1,q&&n.getScene().addTransformNode(n),n}return Object(R.d)(l,x),Object.defineProperty(l.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(s){this._billboardMode!==s&&(this._billboardMode=s)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(s){s!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=s)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(s){this._infiniteDistance!==s&&(this._infiniteDistance=s)},enumerable:!0,configurable:!0}),l.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(l.prototype,"position",{get:function(){return this._position},set:function(s){this._position=s,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rotation",{get:function(){return this._rotation},set:function(s){this._rotation=s,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"scaling",{get:function(){return this._scaling},set:function(s){this._scaling=s,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(s){this._rotationQuaternion=s,s&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"forward",{get:function(){return i.e.Normalize(i.e.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"up",{get:function(){return i.e.Normalize(i.e.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"right",{get:function(){return i.e.Normalize(i.e.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),l.prototype.updatePoseMatrix=function(s){return this._poseMatrix?(this._poseMatrix.copyFrom(s),this):(this._poseMatrix=s.clone(),this)},l.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=i.a.Identity()),this._poseMatrix},l.prototype._isSynchronized=function(){var s=this._cache;if(this.billboardMode!==s.billboardMode||this.billboardMode!==l.BILLBOARDMODE_NONE)return!1;if(s.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!s.position.equals(this._position))return!1;if(this._rotationQuaternion){if(!s.rotationQuaternion.equals(this._rotationQuaternion))return!1}else if(!s.rotation.equals(this._rotation))return!1;return!!s.scaling.equals(this._scaling)},l.prototype._initCache=function(){x.prototype._initCache.call(this);var s=this._cache;s.localMatrixUpdated=!1,s.position=i.e.Zero(),s.scaling=i.e.Zero(),s.rotation=i.e.Zero(),s.rotationQuaternion=new i.b(0,0,0,0),s.billboardMode=-1,s.infiniteDistance=!1},l.prototype.markAsDirty=function(s){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(l.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!0,configurable:!0}),l.prototype.setPreTransformMatrix=function(s){return this.setPivotMatrix(s,!1)},l.prototype.setPivotMatrix=function(s,y){return void 0===y&&(y=!0),this._pivotMatrix.copyFrom(s),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=y,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=i.a.Invert(this._pivotMatrix)),this},l.prototype.getPivotMatrix=function(){return this._pivotMatrix},l.prototype.instantiateHierarchy=function(s,y,q){void 0===s&&(s=null);var n=this.clone("Clone of "+(this.name||this.id),s||this.parent,!0);n&&q&&q(this,n);for(var k=0,p=this.getChildTransformNodes(!0);k<p.length;k++)p[k].instantiateHierarchy(n,y,q);return n},l.prototype.freezeWorldMatrix=function(s){return void 0===s&&(s=null),s?this._worldMatrix=s:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},l.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(l.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),l.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},l.prototype.setAbsolutePosition=function(s){if(!s)return this;var y,q,n;if(void 0===s.x){if(arguments.length<3)return this;y=arguments[0],q=arguments[1],n=arguments[2]}else y=s.x,q=s.y,n=s.z;if(this.parent){var k=i.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(k),i.e.TransformCoordinatesFromFloatsToRef(y,q,n,k,this.position)}else this.position.x=y,this.position.y=q,this.position.z=n;return this},l.prototype.setPositionWithLocalVector=function(s){return this.computeWorldMatrix(),this.position=i.e.TransformNormal(s,this._localMatrix),this},l.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var s=i.c.Matrix[0];return this._localMatrix.invertToRef(s),i.e.TransformNormal(this.position,s)},l.prototype.locallyTranslate=function(s){return this.computeWorldMatrix(!0),this.position=i.e.TransformCoordinates(s,this._localMatrix),this},l.prototype.lookAt=function(s,y,q,n,k){void 0===y&&(y=0),void 0===q&&(q=0),void 0===n&&(n=0),void 0===k&&(k=D.b.LOCAL);var p=l._lookAtVectorCache,u=k===D.b.LOCAL?this.position:this.getAbsolutePosition();if(s.subtractToRef(u,p),this.setDirection(p,y,q,n),k===D.b.WORLD&&this.parent)if(this.rotationQuaternion){var A=i.c.Matrix[0];this.rotationQuaternion.toRotationMatrix(A);var B=i.c.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(B),B.invert(),A.multiplyToRef(B,A),this.rotationQuaternion.fromRotationMatrix(A)}else{var v=i.c.Quaternion[0];i.b.FromEulerVectorToRef(this.rotation,v),A=i.c.Matrix[0],v.toRotationMatrix(A),B=i.c.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(B),B.invert(),A.multiplyToRef(B,A),v.fromRotationMatrix(A),v.toEulerAnglesToRef(this.rotation)}return this},l.prototype.getDirection=function(s){var y=i.e.Zero();return this.getDirectionToRef(s,y),y},l.prototype.getDirectionToRef=function(s,y){return i.e.TransformNormalToRef(s,this.getWorldMatrix(),y),this},l.prototype.setDirection=function(s,y,q,n){void 0===y&&(y=0),void 0===q&&(q=0),void 0===n&&(n=0);var k=-Math.atan2(s.z,s.x)+Math.PI/2,p=Math.sqrt(s.x*s.x+s.z*s.z),u=-Math.atan2(s.y,p);return this.rotationQuaternion?i.b.RotationYawPitchRollToRef(k+y,u+q,n,this.rotationQuaternion):(this.rotation.x=u+q,this.rotation.y=k+y,this.rotation.z=n),this},l.prototype.setPivotPoint=function(s,y){void 0===y&&(y=D.b.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var q=this.getWorldMatrix();if(y==D.b.WORLD){var n=i.c.Matrix[0];q.invertToRef(n),s=i.e.TransformCoordinates(s,n)}return this.setPivotMatrix(i.a.Translation(-s.x,-s.y,-s.z),!0)},l.prototype.getPivotPoint=function(){var s=i.e.Zero();return this.getPivotPointToRef(s),s},l.prototype.getPivotPointToRef=function(s){return s.x=-this._pivotMatrix.m[12],s.y=-this._pivotMatrix.m[13],s.z=-this._pivotMatrix.m[14],this},l.prototype.getAbsolutePivotPoint=function(){var s=i.e.Zero();return this.getAbsolutePivotPointToRef(s),s},l.prototype.getAbsolutePivotPointToRef=function(s){return s.x=this._pivotMatrix.m[12],s.y=this._pivotMatrix.m[13],s.z=this._pivotMatrix.m[14],this.getPivotPointToRef(s),i.e.TransformCoordinatesToRef(s,this.getWorldMatrix(),s),this},l.prototype.setParent=function(s){if(!s&&!this.parent)return this;var y=i.c.Quaternion[0],q=i.c.Vector3[0],n=i.c.Vector3[1];if(s){var k=i.c.Matrix[0],p=i.c.Matrix[1];this.computeWorldMatrix(!0),s.computeWorldMatrix(!0),s.getWorldMatrix().invertToRef(p),this.getWorldMatrix().multiplyToRef(p,k),k.decompose(n,y,q)}else this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(n,y,q);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(y):y.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(n),this.position.copyFrom(q),this.parent=s,this},Object.defineProperty(l.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),l.prototype._updateNonUniformScalingState=function(s){return this._nonUniformScaling!==s&&(this._nonUniformScaling=s,!0)},l.prototype.attachToBone=function(s,y){return this._transformToBoneReferal=y,this.parent=s,s.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},l.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},l.prototype.rotate=function(s,y,q){var n;if(s.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),q&&q!==D.b.LOCAL){if(this.parent){var k=i.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(k),s=i.e.TransformNormal(s,k)}(n=i.b.RotationAxisToRef(s,y,l._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else n=i.b.RotationAxisToRef(s,y,l._rotationAxisCache),this.rotationQuaternion.multiplyToRef(n,this.rotationQuaternion);return this},l.prototype.rotateAround=function(s,y,q){y.normalize(),this.rotationQuaternion||(this.rotationQuaternion=i.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var n=i.c.Vector3[0],k=i.c.Vector3[1],p=i.c.Vector3[2],u=i.c.Quaternion[0],A=i.c.Matrix[0],B=i.c.Matrix[1],v=i.c.Matrix[2],H=i.c.Matrix[3];return s.subtractToRef(this.position,n),i.a.TranslationToRef(n.x,n.y,n.z,A),i.a.TranslationToRef(-n.x,-n.y,-n.z,B),i.a.RotationAxisToRef(y,q,v),B.multiplyToRef(v,H),H.multiplyToRef(A,H),H.decompose(k,u,p),this.position.addInPlace(p),u.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},l.prototype.translate=function(s,y,q){var n=s.scale(y);if(q&&q!==D.b.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{var k=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(k)}return this},l.prototype.addRotation=function(s,y,q){var n;this.rotationQuaternion?n=this.rotationQuaternion:(n=i.c.Quaternion[1],i.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,n));var k=i.c.Quaternion[0];return i.b.RotationYawPitchRollToRef(y,s,q,k),n.multiplyInPlace(k),this.rotationQuaternion||n.toEulerAnglesToRef(this.rotation),this},l.prototype._getEffectiveParent=function(){return this.parent},l.prototype.computeWorldMatrix=function(s){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var y=this.getScene().getRenderId();if(!this._isDirty&&!s&&this.isSynchronized())return this._currentRenderId=y,this._worldMatrix;var q=this.getScene().activeCamera,n=0!=(this._billboardMode&l.BILLBOARDMODE_USE_POSITION),k=this._billboardMode!==l.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;k&&q&&n&&(this.lookAt(q.position),(this.billboardMode&l.BILLBOARDMODE_X)!==l.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&l.BILLBOARDMODE_Y)!==l.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&l.BILLBOARDMODE_Z)!==l.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var p=this._cache;p.pivotMatrixUpdated=!1,p.billboardMode=this.billboardMode,p.infiniteDistance=this.infiniteDistance,this._currentRenderId=y,this._childUpdateId++,this._isDirty=!1;var u=this._getEffectiveParent(),A=p.scaling,B=p.position;if(this._infiniteDistance)if(!this.parent&&q){var v=q.getWorldMatrix(),H=new i.e(v.m[12],v.m[13],v.m[14]);B.copyFromFloats(this._position.x+H.x,this._position.y+H.y,this._position.z+H.z)}else B.copyFrom(this._position);else B.copyFrom(this._position);A.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var L=p.rotationQuaternion;this._rotationQuaternion?(this.reIntegrateRotationIntoRotationQuaternion&&(this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(i.b.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))),L.copyFrom(this._rotationQuaternion)):(i.b.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,L),p.rotation.copyFrom(this._rotation));if(this._usePivotMatrix){var Q=i.c.Matrix[1];i.a.ScalingToRef(A.x,A.y,A.z,Q);var M=i.c.Matrix[0];L.toRotationMatrix(M),this._pivotMatrix.multiplyToRef(Q,i.c.Matrix[4]),i.c.Matrix[4].multiplyToRef(M,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(B.x,B.y,B.z)}else i.a.ComposeToRef(A,L,B,this._localMatrix);if(u&&u.getWorldMatrix){if(s&&u.computeWorldMatrix(),k){this._transformToBoneReferal?u.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),i.c.Matrix[7]):i.c.Matrix[7].copyFrom(u.getWorldMatrix());var Y=i.c.Vector3[5],X=i.c.Vector3[6];i.c.Matrix[7].decompose(X,void 0,Y),i.a.ScalingToRef(X.x,X.y,X.z,i.c.Matrix[7]),i.c.Matrix[7].setTranslation(Y),this._localMatrix.multiplyToRef(i.c.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(u.getWorldMatrix(),i.c.Matrix[6]),i.c.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(u.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(k&&q&&this.billboardMode&&!n){var U=i.c.Vector3[0];if(this._worldMatrix.getTranslationToRef(U),i.c.Matrix[1].copyFrom(q.getViewMatrix()),i.c.Matrix[1].setTranslationFromFloats(0,0,0),i.c.Matrix[1].invertToRef(i.c.Matrix[0]),(this.billboardMode&l.BILLBOARDMODE_ALL)!==l.BILLBOARDMODE_ALL){i.c.Matrix[0].decompose(void 0,i.c.Quaternion[0],void 0);var P=i.c.Vector3[1];i.c.Quaternion[0].toEulerAnglesToRef(P),(this.billboardMode&l.BILLBOARDMODE_X)!==l.BILLBOARDMODE_X&&(P.x=0),(this.billboardMode&l.BILLBOARDMODE_Y)!==l.BILLBOARDMODE_Y&&(P.y=0),(this.billboardMode&l.BILLBOARDMODE_Z)!==l.BILLBOARDMODE_Z&&(P.z=0),i.a.RotationYawPitchRollToRef(P.y,P.x,P.z,i.c.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(i.c.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(i.c.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniform?this._updateNonUniformScalingState(!0):u&&u._nonUniformScaling?this._updateNonUniformScalingState(u._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=i.a.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},l.prototype.resetLocalMatrix=function(s){if(void 0===s&&(s=!0),this.computeWorldMatrix(),s)for(var y=this.getChildren(),q=0;q<y.length;++q){var n=y[q];if(n){n.computeWorldMatrix();var k=i.c.Matrix[0];n._localMatrix.multiplyToRef(this._localMatrix,k);var p=i.c.Quaternion[0];k.decompose(n.scaling,p,n.position),n.rotationQuaternion?n.rotationQuaternion=p:p.toEulerAnglesToRef(n.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=i.b.Identity()),this._worldMatrix=i.a.Identity()},l.prototype._afterComputeWorldMatrix=function(){},l.prototype.registerAfterWorldMatrixUpdate=function(s){return this.onAfterWorldMatrixUpdateObservable.add(s),this},l.prototype.unregisterAfterWorldMatrixUpdate=function(s){return this.onAfterWorldMatrixUpdateObservable.removeCallback(s),this},l.prototype.getPositionInCameraSpace=function(s){return void 0===s&&(s=null),s||(s=this.getScene().activeCamera),i.e.TransformCoordinates(this.absolutePosition,s.getViewMatrix())},l.prototype.getDistanceToCamera=function(s){return void 0===s&&(s=null),s||(s=this.getScene().activeCamera),this.absolutePosition.subtract(s.globalPosition).length()},l.prototype.clone=function(s,y,q){var n=this,k=r.a.Clone(function(){return new l(s,n.getScene())},this);if(k.name=s,k.id=s,y&&(k.parent=y),!q)for(var p=this.getDescendants(!0),u=0;u<p.length;u++){var A=p[u];A.clone&&A.clone(s+"."+A.name,k)}return k},l.prototype.serialize=function(s){var y=r.a.Serialize(this,s);return y.type=this.getClassName(),this.parent&&(y.parentId=this.parent.id),y.localMatrix=this.getPivotMatrix().asArray(),y.isEnabled=this.isEnabled(),this.parent&&(y.parentId=this.parent.id),y},l.Parse=function(s,y,q){var n=r.a.Parse(function(){return new l(s.name,y)},s,y,q);return s.localMatrix?n.setPreTransformMatrix(i.a.FromArray(s.localMatrix)):s.pivotMatrix&&n.setPivotMatrix(i.a.FromArray(s.pivotMatrix)),n.setEnabled(s.isEnabled),s.parentId&&(n._waitingParentId=s.parentId),n},l.prototype.getChildTransformNodes=function(s,y){var q=[];return this._getDescendants(q,s,function(n){return(!y||y(n))&&n instanceof l}),q},l.prototype.dispose=function(s,y){if(void 0===y&&(y=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),s)for(var q=0,n=this.getChildTransformNodes(!0);q<n.length;q++){var k=n[q];k.parent=null,k.computeWorldMatrix(!0)}x.prototype.dispose.call(this,s,y)},l.prototype.normalizeToUnitCube=function(s,y,q){void 0===s&&(s=!0),void 0===y&&(y=!1);var n=null,k=null;y&&(this.rotationQuaternion?(k=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(n=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var p=this.getHierarchyBoundingVectors(s,q),u=p.max.subtract(p.min),A=Math.max(u.x,u.y,u.z);if(0===A)return this;var B=1/A;return this.scaling.scaleInPlace(B),y&&(this.rotationQuaternion&&k?this.rotationQuaternion.copyFrom(k):this.rotation&&n&&this.rotation.copyFrom(n)),this},l.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},l.BILLBOARDMODE_NONE=0,l.BILLBOARDMODE_X=1,l.BILLBOARDMODE_Y=2,l.BILLBOARDMODE_Z=4,l.BILLBOARDMODE_ALL=7,l.BILLBOARDMODE_USE_POSITION=128,l._lookAtVectorCache=new i.e(0,0,0),l._rotationAxisCache=new i.b(),Object(R.c)([Object(r.o)("position")],l.prototype,"_position",void 0),Object(R.c)([Object(r.o)("rotation")],l.prototype,"_rotation",void 0),Object(R.c)([Object(r.l)("rotationQuaternion")],l.prototype,"_rotationQuaternion",void 0),Object(R.c)([Object(r.o)("scaling")],l.prototype,"_scaling",void 0),Object(R.c)([Object(r.c)("billboardMode")],l.prototype,"_billboardMode",void 0),Object(R.c)([Object(r.c)()],l.prototype,"scalingDeterminant",void 0),Object(R.c)([Object(r.c)("infiniteDistance")],l.prototype,"_infiniteDistance",void 0),Object(R.c)([Object(r.c)()],l.prototype,"ignoreNonUniformScaling",void 0),Object(R.c)([Object(r.c)()],l.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),l}(G.a)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return s});var R=o(42),r=o(0),I=o(2),i=o(96),G=o(104),D={min:0,max:0},E={min:0,max:0},x=function(y,q,n){var k=r.e.Dot(q.centerWorld,y),p=Math.abs(r.e.Dot(q.directions[0],y))*q.extendSize.x+Math.abs(r.e.Dot(q.directions[1],y))*q.extendSize.y+Math.abs(r.e.Dot(q.directions[2],y))*q.extendSize.z;n.min=k-p,n.max=k+p},l=function(y,q,n){return x(y,q,D),x(y,n,E),!(D.min>E.max||E.min>D.max)},s=function(){function y(q,n,k){this._isLocked=!1,this.boundingBox=new i.a(q,n,k),this.boundingSphere=new G.a(q,n,k)}return y.prototype.reConstruct=function(q,n,k){this.boundingBox.reConstruct(q,n,k),this.boundingSphere.reConstruct(q,n,k)},Object.defineProperty(y.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"isLocked",{get:function(){return this._isLocked},set:function(q){this._isLocked=q},enumerable:!0,configurable:!0}),y.prototype.update=function(q){this._isLocked||(this.boundingBox._update(q),this.boundingSphere._update(q))},y.prototype.centerOn=function(q,n){var k=y.TmpVector3[0].copyFrom(q).subtractInPlace(n),p=y.TmpVector3[1].copyFrom(q).addInPlace(n);return this.boundingBox.reConstruct(k,p,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(k,p,this.boundingBox.getWorldMatrix()),this},y.prototype.scale=function(q){return this.boundingBox.scale(q),this.boundingSphere.scale(q),this},y.prototype.isInFrustum=function(q,n){return void 0===n&&(n=I.a.MESHES_CULLINGSTRATEGY_STANDARD),!(n!==I.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION&&n!==I.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY||!this.boundingSphere.isCenterInFrustum(q))||!!this.boundingSphere.isInFrustum(q)&&(!(n!==I.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY&&n!==I.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY)||this.boundingBox.isInFrustum(q))},Object.defineProperty(y.prototype,"diagonalLength",{get:function(){var q=this.boundingBox;return q.maximumWorld.subtractToRef(q.minimumWorld,y.TmpVector3[0]).length()},enumerable:!0,configurable:!0}),y.prototype.isCompletelyInFrustum=function(q){return this.boundingBox.isCompletelyInFrustum(q)},y.prototype._checkCollision=function(q){return q._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},y.prototype.intersectsPoint=function(q){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(q)&&!!this.boundingBox.intersectsPoint(q))},y.prototype.intersects=function(q,n){if(!G.a.Intersects(this.boundingSphere,q.boundingSphere))return!1;if(!i.a.Intersects(this.boundingBox,q.boundingBox))return!1;if(!n)return!0;var k=this.boundingBox,p=q.boundingBox;return!!l(k.directions[0],k,p)&&(!!l(k.directions[1],k,p)&&(!!l(k.directions[2],k,p)&&(!!l(p.directions[0],k,p)&&(!!l(p.directions[1],k,p)&&(!!l(p.directions[2],k,p)&&(!!l(r.e.Cross(k.directions[0],p.directions[0]),k,p)&&(!!l(r.e.Cross(k.directions[0],p.directions[1]),k,p)&&(!!l(r.e.Cross(k.directions[0],p.directions[2]),k,p)&&(!!l(r.e.Cross(k.directions[1],p.directions[0]),k,p)&&(!!l(r.e.Cross(k.directions[1],p.directions[1]),k,p)&&(!!l(r.e.Cross(k.directions[1],p.directions[2]),k,p)&&(!!l(r.e.Cross(k.directions[2],p.directions[0]),k,p)&&(!!l(r.e.Cross(k.directions[2],p.directions[1]),k,p)&&!!l(r.e.Cross(k.directions[2],p.directions[2]),k,p))))))))))))))},y.TmpVector3=R.a.BuildArray(2,r.e.Zero),y}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(I,i,G,D,E,x){this.source=I,this.pointerX=i,this.pointerY=G,this.meshUnderPointer=D,this.sourceEvent=E,this.additionalData=x}return r.CreateNew=function(I,i,G){var D=I.getScene();return new r(I,D.pointerX,D.pointerY,D.meshUnderPointer||I,i,G)},r.CreateNewFromSprite=function(I,i,G,D){return new r(I,i.pointerX,i.pointerY,i.meshUnderPointer,G,D)},r.CreateNewFromScene=function(I,i){return new r(null,I.pointerX,I.pointerY,I.meshUnderPointer,i)},r.CreateNewFromPrimitive=function(I,i,G,D){return new r(I,i.x,i.y,null,G,D)},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return D});var R=o(0),r=o(5),I=o(15),i=o(92),G=o(4);I.a.CreateLineSystem=function(E){for(var x=[],l=[],s=E.lines,y=E.colors,q=[],n=0,k=0;k<s.length;k++)for(var p=s[k],u=0;u<p.length;u++){if(l.push(p[u].x,p[u].y,p[u].z),y){var A=y[k];q.push(A[u].r,A[u].g,A[u].b,A[u].a)}u>0&&(x.push(n-1),x.push(n)),n++}var B=new I.a();return B.indices=x,B.positions=l,y&&(B.colors=q),B},I.a.CreateDashedLines=function(E){var x,l,s=E.dashSize||3,y=E.gapSize||1,q=E.dashNb||200,n=E.points,k=new Array(),p=new Array(),u=R.e.Zero(),A=0,B=0,v=0,H=0,L=0;for(L=0;L<n.length-1;L++)n[L+1].subtractToRef(n[L],u),A+=u.length();for(l=s*(x=A/q)/(s+y),L=0;L<n.length-1;L++){n[L+1].subtractToRef(n[L],u),B=Math.floor(u.length()/x),u.normalize();for(var Q=0;Q<B;Q++)v=x*Q,k.push(n[L].x+v*u.x,n[L].y+v*u.y,n[L].z+v*u.z),k.push(n[L].x+(v+l)*u.x,n[L].y+(v+l)*u.y,n[L].z+(v+l)*u.z),p.push(H,H+1),H+=2}var M=new I.a();return M.positions=k,M.indices=p,M},r.a.CreateLines=function(E,x,l,s,y){void 0===l&&(l=null),void 0===s&&(s=!1),void 0===y&&(y=null);var q={points:x,updatable:s,instance:y};return D.CreateLines(E,q,l)},r.a.CreateDashedLines=function(E,x,l,s,y,q,n,k){void 0===q&&(q=null);var p={points:x,dashSize:l,gapSize:s,dashNb:y,updatable:n,instance:k};return D.CreateDashedLines(E,p,q)};var D=function(){function E(){}return E.CreateLineSystem=function(x,l,s){var y=l.instance,q=l.lines,n=l.colors;if(y){var k,p,u=y.getVerticesData(G.b.PositionKind);n&&(k=y.getVerticesData(G.b.ColorKind));for(var A=0,B=0,v=0;v<q.length;v++)for(var H=q[v],L=0;L<H.length;L++)u[A]=H[L].x,u[A+1]=H[L].y,u[A+2]=H[L].z,n&&k&&(p=n[v],k[B]=p[L].r,k[B+1]=p[L].g,k[B+2]=p[L].b,k[B+3]=p[L].a,B+=4),A+=3;return y.updateVerticesData(G.b.PositionKind,u,!1,!1),n&&k&&y.updateVerticesData(G.b.ColorKind,k,!1,!1),y}var Q=!!n,M=new i.b(x,s,null,void 0,void 0,Q,l.useVertexAlpha);return I.a.CreateLineSystem(l).applyToMesh(M,l.updatable),M},E.CreateLines=function(x,l,s){void 0===s&&(s=null);var y=l.colors?[l.colors]:null;return E.CreateLineSystem(x,{lines:[l.points],updatable:l.updatable,instance:l.instance,colors:y,useVertexAlpha:l.useVertexAlpha},s)},E.CreateDashedLines=function(x,l,s){void 0===s&&(s=null);var y=l.points,q=l.instance,n=l.gapSize||1,k=l.dashSize||3;if(q)return q.updateMeshPositions(function(u){var A,B,v=R.e.Zero(),H=u.length/6,L=0,Q=0,M=0,Y=0,X=0,U=0;for(X=0;X<y.length-1;X++)y[X+1].subtractToRef(y[X],v),L+=v.length();A=L/H;var P=q._creationDataStorage.dashSize;for(B=P*A/(P+q._creationDataStorage.gapSize),X=0;X<y.length-1;X++)for(y[X+1].subtractToRef(y[X],v),Q=Math.floor(v.length()/A),v.normalize(),U=0;U<Q&&Y<u.length;)M=A*U,u[Y]=y[X].x+M*v.x,u[Y+1]=y[X].y+M*v.y,u[Y+2]=y[X].z+M*v.z,u[Y+3]=y[X].x+(M+B)*v.x,u[Y+4]=y[X].y+(M+B)*v.y,u[Y+5]=y[X].z+(M+B)*v.z,Y+=6,U++;for(;Y<u.length;)u[Y]=y[X].x,u[Y+1]=y[X].y,u[Y+2]=y[X].z,Y+=3},!1),q;var p=new i.b(x,s,null,void 0,void 0,void 0,l.useVertexAlpha);return I.a.CreateDashedLines(l).applyToMesh(p,l.updatable),p._creationDataStorage=new r.b(),p._creationDataStorage.dashSize=k,p._creationDataStorage.gapSize=n,p},E}()},function(Ja,t,o){"use strict";o.d(t,"e",function(){return r}),o.d(t,"a",function(){return I}),o.d(t,"d",function(){return i}),o.d(t,"c",function(){return G}),o.d(t,"b",function(){return D});var R=o(1),r=function(){function E(x,l){this.type=x,this.jointData=l,l.nativeParams=l.nativeParams||{}}return Object.defineProperty(E.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(x){this._physicsJoint,this._physicsJoint=x},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"physicsPlugin",{set:function(x){this._physicsPlugin=x},enumerable:!0,configurable:!0}),E.prototype.executeNativeFunction=function(x){x(this._physicsPlugin.world,this._physicsJoint)},E.DistanceJoint=0,E.HingeJoint=1,E.BallAndSocketJoint=2,E.WheelJoint=3,E.SliderJoint=4,E.PrismaticJoint=5,E.UniversalJoint=6,E.Hinge2Joint=E.WheelJoint,E.PointToPointJoint=8,E.SpringJoint=9,E.LockJoint=10,E}(),I=function(E){function x(l){return E.call(this,r.DistanceJoint,l)||this}return Object(R.d)(x,E),x.prototype.updateDistance=function(l,s){this._physicsPlugin.updateDistanceJoint(this,l,s)},x}(r),i=function(E){function x(l,s){return E.call(this,l,s)||this}return Object(R.d)(x,E),x.prototype.setMotor=function(l,s){this._physicsPlugin.setMotor(this,l||0,s)},x.prototype.setLimit=function(l,s){this._physicsPlugin.setLimit(this,l,s)},x}(r),G=function(E){function x(l){return E.call(this,r.HingeJoint,l)||this}return Object(R.d)(x,E),x.prototype.setMotor=function(l,s){this._physicsPlugin.setMotor(this,l||0,s)},x.prototype.setLimit=function(l,s){this._physicsPlugin.setLimit(this,l,s)},x}(i),D=function(E){function x(l){return E.call(this,r.Hinge2Joint,l)||this}return Object(R.d)(x,E),x.prototype.setMotor=function(l,s,y){void 0===y&&(y=0),this._physicsPlugin.setMotor(this,l||0,s,y)},x.prototype.setLimit=function(l,s,y){void 0===y&&(y=0),this._physicsPlugin.setLimit(this,l,s,y)},x}(i)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return i});var R=o(0),r=o(5),I=o(15);I.a.CreateSphere=function(G){for(var D=G.segments||32,E=G.diameterX||G.diameter||1,x=G.diameterY||G.diameter||1,l=G.diameterZ||G.diameter||1,s=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1,y=G.slice&&G.slice<=0?1:G.slice||1,q=0===G.sideOrientation?0:G.sideOrientation||I.a.DEFAULTSIDE,n=new R.e(E/2,x/2,l/2),k=2+D,p=2*k,u=[],A=[],B=[],v=[],H=0;H<=k;H++){for(var L=H/k,Q=L*Math.PI*y,M=0;M<=p;M++){var Y=M/p,X=Y*Math.PI*2*s,U=R.a.RotationZ(-Q),P=R.a.RotationY(X),ga=R.e.TransformCoordinates(R.e.Up(),U),ma=R.e.TransformCoordinates(ga,P),oa=ma.multiply(n),ja=ma.divide(n).normalize();A.push(oa.x,oa.y,oa.z),B.push(ja.x,ja.y,ja.z),v.push(Y,L)}if(H>0)for(var aa=A.length/3,F=aa-2*(p+1);F+p+2<aa;F++)u.push(F),u.push(F+1),u.push(F+p+1),u.push(F+p+1),u.push(F+1),u.push(F+p+2)}I.a._ComputeSides(q,A,u,B,v,G.frontUVs,G.backUVs);var $=new I.a();return $.indices=u,$.positions=A,$.normals=B,$.uvs=v,$},r.a.CreateSphere=function(G,D,E,x,l,s){var y={segments:D,diameterX:E,diameterY:E,diameterZ:E,sideOrientation:s,updatable:l};return i.CreateSphere(G,y,x)};var i=function(){function G(){}return G.CreateSphere=function(D,E,x){void 0===x&&(x=null);var l=new r.a(D,x);return E.sideOrientation=r.a._GetDefaultSideOrientation(E.sideOrientation),l._originalBuilderSideOrientation=E.sideOrientation,I.a.CreateSphere(E).applyToMesh(l,E.updatable),l},G}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return l});var R=o(1),r=o(3),I=o(6),i=o(0),G=o(23),D=o(2),E=o(137),x=o(68),l=(o(54),function(){function s(y){this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=D.a.TEXTURE_EXPLICIT_MODE,this.wrapU=D.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapV=D.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=D.a.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=s.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array(),this.onDisposeObservable=new I.c(),this._onDisposeObserver=null,this.delayLoadState=D.a.DELAYLOADSTATE_NONE,this._scene=null,this._texture=null,this._uid=null,this._cachedSize=x.a.Zero(),this._scene=y||G.a.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this)),this._uid=null}return Object.defineProperty(s.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(y){this._hasAlpha!==y&&(this._hasAlpha=y,this._scene&&this._scene.markAllMaterialsAsDirty(D.a.MATERIAL_TextureDirtyFlag|D.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(y){this._coordinatesMode!==y&&(this._coordinatesMode=y,this._scene&&this._scene.markAllMaterialsAsDirty(D.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(y){this._texture&&(this._texture.isCube=y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(y){this._texture&&(this._texture.is3D=y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(y){this._texture&&(this._texture.is2DArray=y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(y){this._texture&&(this._texture._isRGBD=y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"noMipmap",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(y){this._texture&&(this._texture._lodGenerationOffset=y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(y){this._texture&&(this._texture._lodGenerationScale=y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(y){this._texture&&(this._texture._linearSpecularLOD=y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(y){this._texture&&(this._texture._irradianceTexture=y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"uid",{get:function(){return this._uid||(this._uid=E.a.RandomId()),this._uid},enumerable:!0,configurable:!0}),s.prototype.toString=function(){return this.name},s.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(s.prototype,"onDispose",{set:function(y){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),s.prototype.getScene=function(){return this._scene},s.prototype.getTextureMatrix=function(){return i.a.IdentityReadOnly},s.prototype.getReflectionTextureMatrix=function(){return i.a.IdentityReadOnly},s.prototype.getInternalTexture=function(){return this._texture},s.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},s.prototype.isReady=function(){return this.delayLoadState===D.a.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},s.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},s.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new x.a(this._texture._size,this._texture._size):new x.a(this._texture.baseWidth,this._texture.baseHeight):x.a.Zero()},s.prototype.updateSamplingMode=function(y){if(this._texture){var q=this.getScene();q&&q.getEngine().updateTextureSamplingMode(y,this._texture)}},s.prototype.scale=function(y){},Object.defineProperty(s.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),s.prototype._getFromCache=function(y,q,n,k){if(!this._scene)return null;for(var p=this._scene.getEngine().getLoadedTexturesCache(),u=0;u<p.length;u++){var A=p[u];if(!(void 0!==k&&k!==A.invertY||A.url!==y||A.generateMipMaps!==!q||n&&n!==A.samplingMode))return A.incrementReferences(),A}return null},s.prototype._rebuild=function(){},s.prototype.delayLoad=function(){},s.prototype.clone=function(){return null},Object.defineProperty(s.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:D.a.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:D.a.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),s.prototype._markAllSubMeshesAsTexturesDirty=function(){var y=this.getScene();y&&y.markAllMaterialsAsDirty(D.a.MATERIAL_TextureDirtyFlag)},s.prototype.readPixels=function(y,q,n){if(void 0===y&&(y=0),void 0===q&&(q=0),void 0===n&&(n=null),!this._texture)return null;var k=this.getSize(),p=k.width,u=k.height,A=this.getScene();if(!A)return null;var B=A.getEngine();return 0!=q&&(p/=Math.pow(2,q),u/=Math.pow(2,q),p=Math.round(p),u=Math.round(u)),this._texture.isCube?B._readTexturePixels(this._texture,p,u,y,q,n):B._readTexturePixels(this._texture,p,u,-1,q,n)},s.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(s.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),s.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var y=this._scene.textures.indexOf(this);y>=0&&this._scene.textures.splice(y,1),this._scene.onTextureRemovedObservable.notifyObservers(this)}void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())},s.prototype.serialize=function(){if(!this.name)return null;var y=r.a.Serialize(this);return r.a.AppendSerializedAnimations(this,y),y},s.WhenAllReady=function(y,q){var n=y.length;if(0!==n)for(var k,p,u=function(){if((k=y[A]).isReady())0==--n&&q();else if(p=k.onLoadObservable){var B=function(){p.removeCallback(B),0==--n&&q()};p.add(B)}},A=0;A<y.length;A++)u();else q()},s.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,Object(R.c)([Object(r.c)()],s.prototype,"uniqueId",void 0),Object(R.c)([Object(r.c)()],s.prototype,"name",void 0),Object(R.c)([Object(r.c)()],s.prototype,"metadata",void 0),Object(R.c)([Object(r.c)("hasAlpha")],s.prototype,"_hasAlpha",void 0),Object(R.c)([Object(r.c)()],s.prototype,"getAlphaFromRGB",void 0),Object(R.c)([Object(r.c)()],s.prototype,"level",void 0),Object(R.c)([Object(r.c)()],s.prototype,"coordinatesIndex",void 0),Object(R.c)([Object(r.c)("coordinatesMode")],s.prototype,"_coordinatesMode",void 0),Object(R.c)([Object(r.c)()],s.prototype,"wrapU",void 0),Object(R.c)([Object(r.c)()],s.prototype,"wrapV",void 0),Object(R.c)([Object(r.c)()],s.prototype,"wrapR",void 0),Object(R.c)([Object(r.c)()],s.prototype,"anisotropicFilteringLevel",void 0),Object(R.c)([Object(r.c)()],s.prototype,"isCube",null),Object(R.c)([Object(r.c)()],s.prototype,"is3D",null),Object(R.c)([Object(r.c)()],s.prototype,"is2DArray",null),Object(R.c)([Object(r.c)(),Object(r.b)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"gammaSpace",void 0),Object(R.c)([Object(r.c)()],s.prototype,"invertZ",void 0),Object(R.c)([Object(r.c)()],s.prototype,"lodLevelInAlpha",void 0),Object(R.c)([Object(r.c)()],s.prototype,"lodGenerationOffset",null),Object(R.c)([Object(r.c)()],s.prototype,"lodGenerationScale",null),Object(R.c)([Object(r.c)()],s.prototype,"linearSpecularLOD",null),Object(R.c)([Object(r.m)()],s.prototype,"irradianceTexture",null),Object(R.c)([Object(r.c)()],s.prototype,"isRenderTarget",void 0),s}())},function(Ja,t,o){"use strict";o.d(t,"a",function(){return x});var R=o(1),r=o(3),I=o(0),i=o(10),G=o(26),D=o(83),E=o(12),x=function(l){function s(y,q){var n=l.call(this,y,q)||this;return n.diffuse=new i.a(1,1,1),n.specular=new i.a(1,1,1),n.falloffType=s.FALLOFF_DEFAULT,n.intensity=1,n._range=Number.MAX_VALUE,n._inverseSquaredRange=0,n._photometricScale=1,n._intensityMode=s.INTENSITYMODE_AUTOMATIC,n._radius=1e-05,n.renderPriority=0,n._shadowEnabled=!0,n._excludeWithLayerMask=0,n._includeOnlyWithLayerMask=0,n._lightmapMode=0,n._excludedMeshesIds=new Array(),n._includedOnlyMeshesIds=new Array(),n._isLight=!0,n.getScene().addLight(n),n._uniformBuffer=new D.a(n.getScene().getEngine()),n._buildUniformLayout(),n.includedOnlyMeshes=new Array(),n.excludedMeshes=new Array(),n._resyncMeshes(),n}return Object(R.d)(s,l),Object.defineProperty(s.prototype,"range",{get:function(){return this._range},set:function(y){this._range=y,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(y){this._intensityMode=y,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"radius",{get:function(){return this._radius},set:function(y){this._radius=y,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(y){this._shadowEnabled!==y&&(this._shadowEnabled=y,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(y){this._includedOnlyMeshes=y,this._hookArrayForIncludedOnly(y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(y){this._excludedMeshes=y,this._hookArrayForExcluded(y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(y){this._excludeWithLayerMask=y,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(y){this._includeOnlyWithLayerMask=y,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(y){this._lightmapMode!==y&&(this._lightmapMode=y,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),s.prototype.transferTexturesToEffect=function(y,q){return this},s.prototype._bindLight=function(y,q,n,k,p){void 0===p&&(p=!1);var u=y.toString(),A=!1;if(!p||!this._uniformBuffer._alreadyBound){if(this._uniformBuffer.bindToEffect(n,"Light"+u),this._renderId!==q.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=q.getRenderId();var B=this.getScaledIntensity();this.transferToEffect(n,u),this.diffuse.scaleToRef(B,i.c.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",i.c.Color3[0],this.range,u),k&&(this.specular.scaleToRef(B,i.c.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",i.c.Color3[1],this.radius,u)),A=!0}if(this.transferTexturesToEffect(n,u),q.shadowsEnabled&&this.shadowEnabled){var v=this.getShadowGenerator();v&&(v.bindShadowLight(u,n),A=!0)}A&&this._uniformBuffer.update()}},s.prototype.getClassName=function(){return"Light"},s.prototype.toString=function(y){var q="Name: "+this.name;if(q+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var n=0;n<this.animations.length;n++)q+=", animation[0]: "+this.animations[n].toString(y);return q},s.prototype._syncParentEnabledState=function(){l.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},s.prototype.setEnabled=function(y){l.prototype.setEnabled.call(this,y),this._resyncMeshes()},s.prototype.getShadowGenerator=function(){return this._shadowGenerator},s.prototype.getAbsolutePosition=function(){return I.e.Zero()},s.prototype.canAffectMesh=function(y){return!y||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(y))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(y))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&y.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&y.layerMask)))},s.CompareLightsPriority=function(y,q){return y.shadowEnabled!==q.shadowEnabled?(q.shadowEnabled?1:0)-(y.shadowEnabled?1:0):q.renderPriority-y.renderPriority},s.prototype.dispose=function(y,q){void 0===q&&(q=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var n=0,k=this.getScene().meshes;n<k.length;n++)k[n]._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),l.prototype.dispose.call(this,y,q)},s.prototype.getTypeID=function(){return 0},s.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},s.prototype.clone=function(y){var q=s.GetConstructorFromName(this.getTypeID(),y,this.getScene());return q?r.a.Clone(q,this):null},s.prototype.serialize=function(){var y=r.a.Serialize(this);return y.type=this.getTypeID(),this.parent&&(y.parentId=this.parent.id),this.excludedMeshes.length>0&&(y.excludedMeshesIds=[],this.excludedMeshes.forEach(function(q){y.excludedMeshesIds.push(q.id)})),this.includedOnlyMeshes.length>0&&(y.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(q){y.includedOnlyMeshesIds.push(q.id)})),r.a.AppendSerializedAnimations(this,y),y.ranges=this.serializeAnimationRanges(),y},s.GetConstructorFromName=function(y,q,n){var k=G.a.Construct("Light_Type_"+y,q,n);return k||null},s.Parse=function(y,q){var n=s.GetConstructorFromName(y.type,y.name,q);if(!n)return null;var k=r.a.Parse(n,y,q);if(y.excludedMeshesIds&&(k._excludedMeshesIds=y.excludedMeshesIds),y.includedOnlyMeshesIds&&(k._includedOnlyMeshesIds=y.includedOnlyMeshesIds),y.parentId&&(k._waitingParentId=y.parentId),void 0!==y.falloffType&&(k.falloffType=y.falloffType),void 0!==y.lightmapMode&&(k.lightmapMode=y.lightmapMode),y.animations){for(var p=0;p<y.animations.length;p++){var u=y.animations[p],A=E.a.GetClass("BABYLON.Animation");A&&k.animations.push(A.Parse(u))}G.a.ParseAnimationRanges(k,y,q)}return y.autoAnimate&&q.beginAnimation(k,y.autoAnimateFrom,y.autoAnimateTo,y.autoAnimateLoop,y.autoAnimateSpeed||1),k},s.prototype._hookArrayForExcluded=function(y){var q=this,n=y.push;y.push=function(){for(var A=[],B=0;B<arguments.length;B++)A[B]=arguments[B];for(var v=n.apply(y,A),H=0,L=A;H<L.length;H++){var Q=L[H];Q._resyncLightSource(q)}return v};var k=y.splice;y.splice=function(A,B){for(var v=k.apply(y,[A,B]),H=0,L=v;H<L.length;H++)L[H]._resyncLightSource(q);return v};for(var p=0,u=y;p<u.length;p++)u[p]._resyncLightSource(this)},s.prototype._hookArrayForIncludedOnly=function(y){var q=this,n=y.push;y.push=function(){for(var p=[],u=0;u<arguments.length;u++)p[u]=arguments[u];var A=n.apply(y,p);return q._resyncMeshes(),A};var k=y.splice;y.splice=function(p,u){var A=k.apply(y,[p,u]);return q._resyncMeshes(),A},this._resyncMeshes()},s.prototype._resyncMeshes=function(){for(var y=0,q=this.getScene().meshes;y<q.length;y++)q[y]._resyncLightSource(this)},s.prototype._markMeshesAsLightDirty=function(){for(var y=0,q=this.getScene().meshes;y<q.length;y++){var n=q[y];-1!==n.lightSources.indexOf(this)&&n._markSubMeshesAsLightDirty()}},s.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},s.prototype._getPhotometricScale=function(){var y=0,q=this.getTypeID(),n=this.intensityMode;switch(n===s.INTENSITYMODE_AUTOMATIC&&(n=q===s.LIGHTTYPEID_DIRECTIONALLIGHT?s.INTENSITYMODE_ILLUMINANCE:s.INTENSITYMODE_LUMINOUSINTENSITY),q){case s.LIGHTTYPEID_POINTLIGHT:case s.LIGHTTYPEID_SPOTLIGHT:switch(n){case s.INTENSITYMODE_LUMINOUSPOWER:y=1/(4*Math.PI);break;case s.INTENSITYMODE_LUMINOUSINTENSITY:y=1;break;case s.INTENSITYMODE_LUMINANCE:y=this.radius*this.radius}break;case s.LIGHTTYPEID_DIRECTIONALLIGHT:switch(n){case s.INTENSITYMODE_ILLUMINANCE:y=1;break;case s.INTENSITYMODE_LUMINANCE:var k=this.radius;k=Math.max(k,.001),y=2*Math.PI*(1-Math.cos(k))}break;case s.LIGHTTYPEID_HEMISPHERICLIGHT:y=1}return y},s.prototype._reorderLightsInScene=function(){var y=this.getScene();0!=this._renderPriority&&(y.requireLightSorting=!0),this.getScene().sortLightsByPriority()},s.FALLOFF_DEFAULT=0,s.FALLOFF_PHYSICAL=1,s.FALLOFF_GLTF=2,s.FALLOFF_STANDARD=3,s.LIGHTMAP_DEFAULT=0,s.LIGHTMAP_SPECULAR=1,s.LIGHTMAP_SHADOWSONLY=2,s.INTENSITYMODE_AUTOMATIC=0,s.INTENSITYMODE_LUMINOUSPOWER=1,s.INTENSITYMODE_LUMINOUSINTENSITY=2,s.INTENSITYMODE_ILLUMINANCE=3,s.INTENSITYMODE_LUMINANCE=4,s.LIGHTTYPEID_POINTLIGHT=0,s.LIGHTTYPEID_DIRECTIONALLIGHT=1,s.LIGHTTYPEID_SPOTLIGHT=2,s.LIGHTTYPEID_HEMISPHERICLIGHT=3,Object(R.c)([Object(r.e)()],s.prototype,"diffuse",void 0),Object(R.c)([Object(r.e)()],s.prototype,"specular",void 0),Object(R.c)([Object(r.c)()],s.prototype,"falloffType",void 0),Object(R.c)([Object(r.c)()],s.prototype,"intensity",void 0),Object(R.c)([Object(r.c)()],s.prototype,"range",null),Object(R.c)([Object(r.c)()],s.prototype,"intensityMode",null),Object(R.c)([Object(r.c)()],s.prototype,"radius",null),Object(R.c)([Object(r.c)()],s.prototype,"_renderPriority",void 0),Object(R.c)([Object(r.b)("_reorderLightsInScene")],s.prototype,"renderPriority",void 0),Object(R.c)([Object(r.c)("shadowEnabled")],s.prototype,"_shadowEnabled",void 0),Object(R.c)([Object(r.c)("excludeWithLayerMask")],s.prototype,"_excludeWithLayerMask",void 0),Object(R.c)([Object(r.c)("includeOnlyWithLayerMask")],s.prototype,"_includeOnlyWithLayerMask",void 0),Object(R.c)([Object(r.c)("lightmapMode")],s.prototype,"_lightmapMode",void 0),s}(G.a)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(52),r=function(){function I(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(I.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),I.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},I.prototype.addCount=function(i,G){I.Enabled&&(this._current+=i,G&&this._fetchResult())},I.prototype.beginMonitoring=function(){I.Enabled&&(this._startMonitoringTime=R.a.Now)},I.prototype.endMonitoring=function(i){if(void 0===i&&(i=!0),I.Enabled){i&&this.fetchNewFrame();var G=R.a.Now;this._current=G-this._startMonitoringTime,i&&this._fetchResult()}},I.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var i=R.a.Now;i-this._lastSecTime>1000&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=i,this._lastSecAccumulated=0,this._lastSecValueCount=0)},I.Enabled=!0,I}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(38),r=function(){function I(){}return Object.defineProperty(I,"Now",{get:function(){return R.a.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),I}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return I});var R=o(0),r=o(4),I=function(){function i(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return i.prototype.getNormal=function(G,D){if(void 0===G&&(G=!1),void 0===D&&(D=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(r.b.NormalKind))return null;var E,x=this.pickedMesh.getIndices();if(!x)return null;if(D){var l=this.pickedMesh.getVerticesData(r.b.NormalKind),s=R.e.FromArray(l,3*x[3*this.faceId]),y=R.e.FromArray(l,3*x[3*this.faceId+1]),q=R.e.FromArray(l,3*x[3*this.faceId+2]);s=s.scale(this.bu),y=y.scale(this.bv),q=q.scale(1-this.bu-this.bv),E=new R.e(s.x+y.x+q.x,s.y+y.y+q.y,s.z+y.z+q.z)}else{var n=this.pickedMesh.getVerticesData(r.b.PositionKind),k=R.e.FromArray(n,3*x[3*this.faceId]),p=R.e.FromArray(n,3*x[3*this.faceId+1]),u=R.e.FromArray(n,3*x[3*this.faceId+2]),A=k.subtract(p),B=u.subtract(p);E=R.e.Cross(A,B)}if(G){var v=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(R.c.Matrix[0].copyFrom(v),(v=R.c.Matrix[0]).setTranslationFromFloats(0,0,0),v.invert(),v.transposeToRef(R.c.Matrix[1]),v=R.c.Matrix[1]),E=R.e.TransformNormal(E,v)}return E.normalize(),E},i.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(r.b.UVKind))return null;var G=this.pickedMesh.getIndices();if(!G)return null;var D=this.pickedMesh.getVerticesData(r.b.UVKind);if(!D)return null;var E=R.d.FromArray(D,2*G[3*this.faceId]),x=R.d.FromArray(D,2*G[3*this.faceId+1]),l=R.d.FromArray(D,2*G[3*this.faceId+2]);return E=E.scale(this.bu),x=x.scale(this.bv),l=l.scale(1-this.bu-this.bv),new R.d(E.x+x.x+l.x,E.y+x.y+l.y)},i}()},function(Ja,t,o){"use strict";var R=o(1),r=o(65),I=o(38),i=o(6),G=o(76),D=o(126),E=function(p){function u(){return null!==p&&p.apply(this,arguments)||this}return Object(R.d)(u,p),u._setPrototypeOf=Object.setPrototypeOf||function(A,B){return A.__proto__=B,A},u}(Error),x=o(36),l=o(31),s=o(116);o.d(t,"b",function(){return y}),o.d(t,"d",function(){return q}),o.d(t,"c",function(){return n}),o.d(t,"a",function(){return k});var y=function(p){function u(A,B){var v=p.call(this,A)||this;return v.name="LoadFileError",E._setPrototypeOf(v,u.prototype),B instanceof r.a?v.request=B:v.file=B,v}return Object(R.d)(u,p),u}(E),q=function(p){function u(A,B){var v=p.call(this,A)||this;return v.request=B,v.name="RequestFileError",E._setPrototypeOf(v,u.prototype),v}return Object(R.d)(u,p),u}(E),n=function(p){function u(A,B){var v=p.call(this,A)||this;return v.file=B,v.name="ReadFileError",E._setPrototypeOf(v,u.prototype),v}return Object(R.d)(u,p),u}(E),k=function(){function p(){}return p._CleanUrl=function(u){return u=u.replace(/#/gm,"%23")},p.SetCorsBehavior=function(u,A){if((!u||0!==u.indexOf("data:"))&&p.CorsBehavior)if("string"==typeof p.CorsBehavior||this.CorsBehavior instanceof String)A.crossOrigin=p.CorsBehavior;else{var B=p.CorsBehavior(u);B&&(A.crossOrigin=B)}},p.LoadImage=function(u,A,B,v,H){var L;void 0===H&&(H="");var Q=!1;if(u instanceof ArrayBuffer||ArrayBuffer.isView(u)?"undefined"!=typeof Blob?(L=URL.createObjectURL(new Blob([u],{type:H})),Q=!0):L="data:"+H+";base64,"+x.a.EncodeArrayBufferToBase64(u):u instanceof Blob?(L=URL.createObjectURL(u),Q=!0):(L=p._CleanUrl(u),L=p.PreprocessUrl(u)),"undefined"==typeof Image)return p.LoadFile(L,function(ma){createImageBitmap(new Blob([ma],{type:H})).then(function(oa){A(oa),Q&&URL.revokeObjectURL(L)}).catch(function(oa){B&&B("Error while trying to load image: "+u,oa)})},void 0,v||void 0,!0,function(ma,oa){B&&B("Error while trying to load image: "+u,oa)}),null;var M=new Image();p.SetCorsBehavior(L,M);var Y=function(){M.removeEventListener("load",Y),M.removeEventListener("error",X),A(M),Q&&M.src&&URL.revokeObjectURL(M.src)},X=function(ma){M.removeEventListener("load",Y),M.removeEventListener("error",X),B&&B("Error while trying to load image: "+u,ma),Q&&M.src&&URL.revokeObjectURL(M.src)};M.addEventListener("load",Y),M.addEventListener("error",X);var U=function(){M.src=L};if("data:"!==L.substr(0,5)&&v&&v.enableTexturesOffline)v.open(function(){v&&v.loadImage(L,M)},U);else{if(-1!==L.indexOf("file:")){var P=decodeURIComponent(L.substring(5).toLowerCase());if(G.a.FilesToLoad[P]){try{var ga;try{ga=URL.createObjectURL(G.a.FilesToLoad[P])}catch(ma){ga=URL.createObjectURL(G.a.FilesToLoad[P])}M.src=ga,Q=!0}catch(ma){M.src=""}return M}}U()}return M},p.ReadFile=function(u,A,B,v,H){var L=new FileReader(),Q={onCompleteObservable:new i.c(),abort:function(){return L.abort()}};return L.onloadend=function(M){return Q.onCompleteObservable.notifyObservers(Q)},H&&(L.onerror=function(M){H(new n("Unable to read "+u.name,u))}),L.onload=function(M){A(M.target.result)},B&&(L.onprogress=B),v?L.readAsArrayBuffer(u):L.readAsText(u),Q},p.LoadFile=function(u,A,B,v,H,L){if(-1!==u.indexOf("file:")){var Q=decodeURIComponent(u.substring(5).toLowerCase());0===Q.indexOf("./")&&(Q=Q.substring(2));var M=G.a.FilesToLoad[Q];if(M)return p.ReadFile(M,A,B,H,L?function(Y){return L(void 0,new y(Y.message,Y.file))}:void 0)}return p.RequestFile(u,function(Y,X){A(Y,X?X.responseURL:void 0)},B,v,H,L?function(Y){L(Y.request,new y(Y.message,Y.request))}:void 0)},p.RequestFile=function(u,A,B,v,H,L,Q){u=p._CleanUrl(u),u=p.PreprocessUrl(u);var M=p.BaseUrl+u,Y=!1,X={onCompleteObservable:new i.c(),abort:function(){return Y=!0}},U=function(){var ga=new r.a(),ma=null;X.abort=function(){Y=!0,ga.readyState!==(XMLHttpRequest.DONE||4)&&ga.abort(),null!==ma&&(clearTimeout(ma),ma=null)};var oa=function(ja){ga.open("GET",M),Q&&Q(ga),H&&(ga.responseType="arraybuffer"),B&&ga.addEventListener("progress",B);var aa=function(){ga.removeEventListener("loadend",aa),X.onCompleteObservable.notifyObservers(X),X.onCompleteObservable.clear()};ga.addEventListener("loadend",aa);var F=function(){if(!Y&&ga.readyState===(XMLHttpRequest.DONE||4)){if(ga.removeEventListener("readystatechange",F),ga.status>=200&&ga.status<300||0===ga.status&&(!I.a.IsWindowObjectExist()||p.IsFileURL()))return void A(H?ga.response:ga.responseText,ga);var $=p.DefaultRetryStrategy;if($){var ia=$(M,ga,ja);if(-1!==ia)return ga.removeEventListener("loadend",aa),ga=new r.a(),void(ma=setTimeout(function(){return oa(ja+1)},ia))}var ba=new q("Error status: "+ga.status+" "+ga.statusText+" - Unable to load "+M,ga);L&&L(ba)}};ga.addEventListener("readystatechange",F),ga.send()};oa(0)};if(v&&v.enableSceneOffline){var P=function(ga){ga&&ga.status>400?L&&L(ga):U()};v.open(function(){v&&v.loadFile(p.BaseUrl+u,function(ga){Y||A(ga),X.onCompleteObservable.notifyObservers(X)},B?function(ga){Y||B(ga)}:void 0,P,H)},P)}else U();return X},p.IsFileURL=function(){return"file:"===location.protocol},p.DefaultRetryStrategy=D.a.ExponentialBackoff(),p.BaseUrl="",p.CorsBehavior="anonymous",p.PreprocessUrl=function(u){return u},p}();l.a._FileToolsLoadImage=k.LoadImage.bind(k),l.a._FileToolsLoadFile=k.LoadFile.bind(k),s.a._FileToolsLoadFile=k.LoadFile.bind(k)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(0),r=function(){function I(){}return I._RemoveAndStorePivotPoint=function(i){i&&0===I._PivotCached&&(i.getPivotPointToRef(I._OldPivotPoint),I._OldPivotPoint.equalsToFloats(0,0,0)||(i.setPivotMatrix(R.a.IdentityReadOnly),I._OldPivotPoint.subtractToRef(i.getPivotPoint(),I._PivotTranslation),I._PivotTmpVector.copyFromFloats(1,1,1),I._PivotTmpVector.subtractInPlace(i.scaling),I._PivotTmpVector.multiplyInPlace(I._PivotTranslation),i.position.addInPlace(I._PivotTmpVector))),I._PivotCached++},I._RestorePivotPoint=function(i){i&&!I._OldPivotPoint.equalsToFloats(0,0,0)&&1===I._PivotCached&&(i.setPivotPoint(I._OldPivotPoint),I._PivotTmpVector.copyFromFloats(1,1,1),I._PivotTmpVector.subtractInPlace(i.scaling),I._PivotTmpVector.multiplyInPlace(I._PivotTranslation),i.position.subtractInPlace(I._PivotTmpVector)),this._PivotCached--},I._PivotCached=0,I._OldPivotPoint=new R.e(),I._PivotTranslation=new R.e(),I._PivotTmpVector=new R.e(),I}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return i});var R=o(0),r=o(5),I=o(41),i=function(){function G(D){var E=this;void 0===D&&(D=I.a.DefaultUtilityLayer),this.gizmoLayer=D,this._attachedMesh=null,this.scaleRatio=1,this._customMeshSet=!1,this.updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this.updateScale=!0,this._interactionsEnabled=!0,this._tempVector=new R.e(),this._rootMesh=new r.a("gizmoRootNode",D.utilityLayerScene),this._rootMesh.rotationQuaternion=R.b.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){E._update()})}return Object.defineProperty(G.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(D){this._attachedMesh=D,this._rootMesh.setEnabled(!!D),this._attachedMeshChanged(D)},enumerable:!0,configurable:!0}),G.prototype.setCustomMesh=function(D){if(D.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(E){E.dispose()}),D.parent=this._rootMesh,this._customMeshSet=!0},G.prototype._attachedMeshChanged=function(D){},G.prototype._update=function(){if(this.attachedMesh){var D=this.attachedMesh._effectiveMesh||this.attachedMesh;if(this.updateGizmoPositionToMatchAttachedMesh&&this._rootMesh.position.copyFrom(D.absolutePosition),this.updateGizmoRotationToMatchAttachedMesh?D.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion):this._rootMesh.rotationQuaternion.set(0,0,0,1),this.updateScale){var E=this.gizmoLayer.utilityLayerScene.activeCamera,x=E.globalPosition;E.devicePosition&&(x=E.devicePosition),this._rootMesh.position.subtractToRef(x,this._tempVector);var l=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(l,l,l),D._getWorldMatrixDeterminant()<0&&(this._rootMesh.scaling.y*=-1)}else this._rootMesh.scaling.setAll(this.scaleRatio)}},G.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},G}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return E}),o.d(t,"b",function(){return x});var R=o(1),r=o(4),I=o(105),i=o(44),G=o(2),D=o(110),E=function(){function l(){this._materialDefines=null,this._materialEffect=null}return Object.defineProperty(l.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(s){this._materialDefines=s},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),l.prototype.setEffect=function(s,y){void 0===y&&(y=null),this._materialEffect!==s?(this._materialDefines=y,this._materialEffect=s):s||(this._materialDefines=null)},l}(),x=function(l){function s(y,q,n,k,p,u,A,B){void 0===B&&(B=!0);var v=l.call(this)||this;return v.materialIndex=y,v.verticesStart=q,v.verticesCount=n,v.indexStart=k,v.indexCount=p,v._linesIndexCount=0,v._linesIndexBuffer=null,v._lastColliderWorldVertices=null,v._lastColliderTransformMatrix=null,v._renderId=0,v._alphaIndex=0,v._distanceToCamera=0,v._currentMaterial=null,v._mesh=u,v._renderingMesh=A||u,u.subMeshes.push(v),v._trianglePlanes=[],v._id=u.subMeshes.length-1,B&&(v.refreshBoundingInfo(),u.computeWorldMatrix(!0)),v}return Object(R.d)(s,l),s.AddToMesh=function(y,q,n,k,p,u,A,B){return void 0===B&&(B=!0),new s(y,q,n,k,p,u,A,B)},Object.defineProperty(s.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),s.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},s.prototype.setBoundingInfo=function(y){return this._boundingInfo=y,this},s.prototype.getMesh=function(){return this._mesh},s.prototype.getRenderingMesh=function(){return this._renderingMesh},s.prototype.getMaterial=function(){var y=this._renderingMesh.material;if(null==y)return this._mesh.getScene().defaultMaterial;if(y.getSubMaterial){var q=y.getSubMaterial(this.materialIndex);return this._currentMaterial!==q&&(this._currentMaterial=q,this._materialDefines=null),q}return y},s.prototype.refreshBoundingInfo=function(y){if(void 0===y&&(y=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(y||(y=this._renderingMesh.getVerticesData(r.b.PositionKind)),!y)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var q,n=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===n.length){var k=this._renderingMesh.getBoundingInfo();q={minimum:k.minimum.clone(),maximum:k.maximum.clone()}}else q=Object(D.b)(y,n,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(q.minimum,q.maximum):this._boundingInfo=new i.a(q.minimum,q.maximum),this},s.prototype._checkCollision=function(y){return this.getBoundingInfo()._checkCollision(y)},s.prototype.updateBoundingInfo=function(y){var q=this.getBoundingInfo();return q||(this.refreshBoundingInfo(),q=this.getBoundingInfo()),q&&q.update(y),this},s.prototype.isInFrustum=function(y){var q=this.getBoundingInfo();return!!q&&q.isInFrustum(y,this._mesh.cullingStrategy)},s.prototype.isCompletelyInFrustum=function(y){var q=this.getBoundingInfo();return!!q&&q.isCompletelyInFrustum(y)},s.prototype.render=function(y){return this._renderingMesh.render(this,y,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},s.prototype._getLinesIndexBuffer=function(y,q){if(!this._linesIndexBuffer){for(var n=[],k=this.indexStart;k<this.indexStart+this.indexCount;k+=3)n.push(y[k],y[k+1],y[k+1],y[k+2],y[k+2],y[k]);this._linesIndexBuffer=q.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer},s.prototype.canIntersects=function(y){var q=this.getBoundingInfo();return!!q&&y.intersectsBox(q.boundingBox)},s.prototype.intersects=function(y,q,n,k,p){var u=this.getMaterial();if(!u)return null;var A=3,B=!1;switch(u.fillMode){case G.a.MATERIAL_PointListDrawMode:case G.a.MATERIAL_LineListDrawMode:case G.a.MATERIAL_LineLoopDrawMode:case G.a.MATERIAL_LineStripDrawMode:case G.a.MATERIAL_TriangleFanDrawMode:return null;case G.a.MATERIAL_TriangleStripDrawMode:A=1,B=!0}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?n.length?this._intersectLines(y,q,n,this._mesh.intersectionThreshold,k):this._intersectUnIndexedLines(y,q,n,this._mesh.intersectionThreshold,k):!n.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(y,q,n,k,p):this._intersectTriangles(y,q,n,A,B,k,p)},s.prototype._intersectLines=function(y,q,n,k,p){for(var u=null,A=this.indexStart;A<this.indexStart+this.indexCount;A+=2){var B=q[n[A]],v=q[n[A+1]],H=y.intersectionSegment(B,v,k);if(!(H<0)&&((p||!u||H<u.distance)&&((u=new I.a(null,null,H)).faceId=A/2,p)))break}return u},s.prototype._intersectUnIndexedLines=function(y,q,n,k,p){for(var u=null,A=this.verticesStart;A<this.verticesStart+this.verticesCount;A+=2){var B=q[A],v=q[A+1],H=y.intersectionSegment(B,v,k);if(!(H<0)&&((p||!u||H<u.distance)&&((u=new I.a(null,null,H)).faceId=A/2,p)))break}return u},s.prototype._intersectTriangles=function(y,q,n,k,p,u,A){for(var B=null,v=-1,H=this.indexStart;H<this.indexStart+this.indexCount;H+=k){v++;var L=n[H],Q=n[H+1],M=n[H+2];if(p&&4294967295===M)H+=2;else{var Y=q[L],X=q[Q],U=q[M];if(!A||A(Y,X,U,y)){var P=y.intersectsTriangle(Y,X,U);if(P){if(P.distance<0)continue;if((u||!B||P.distance<B.distance)&&((B=P).faceId=v,u))break}}}}return B},s.prototype._intersectUnIndexedTriangles=function(y,q,n,k,p){for(var u=null,A=this.verticesStart;A<this.verticesStart+this.verticesCount;A+=3){var B=q[A],v=q[A+1],H=q[A+2];if(!p||p(B,v,H,y)){var L=y.intersectsTriangle(B,v,H);if(L){if(L.distance<0)continue;if((k||!u||L.distance<u.distance)&&((u=L).faceId=A/3,k))break}}}return u},s.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},s.prototype.clone=function(y,q){var n=new s(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,y,q,!1);if(!this.IsGlobal){var k=this.getBoundingInfo();if(!k)return n;n._boundingInfo=new i.a(k.minimum,k.maximum)}return n},s.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var y=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(y,1)},s.prototype.getClassName=function(){return"SubMesh"},s.CreateFromIndices=function(y,q,n,k,p){for(var u=Number.MAX_VALUE,A=-Number.MAX_VALUE,B=(p||k).getIndices(),v=q;v<q+n;v++){var H=B[v];H<u&&(u=H),H>A&&(A=H)}return new s(y,u,A-u+1,q,n,k,p)},s}(E)},function(Ja,t,o){"use strict";var R="helperFunctions",r=`const float PI=3.1415926535897932384626433832795;
const float LinearEncodePowerApprox=2.2;
const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;
const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);
const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {
vec3 i0=inMatrix[0];
vec3 i1=inMatrix[1];
vec3 i2=inMatrix[2];
mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);
return outMatrix;
}

mat3 inverseMat3(mat3 inMatrix) {
float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];
float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];
float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];
float b01=a22*a11-a12*a21;
float b11=-a22*a10+a12*a20;
float b21=a21*a10-a11*a20;
float det=a00*b01+a01*b11+a02*b21;
return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;
}
vec3 toLinearSpace(vec3 color)
{
return pow(color,vec3(LinearEncodePowerApprox));
}
vec3 toGammaSpace(vec3 color)
{
return pow(color,vec3(GammaEncodePowerApprox));
}
float toGammaSpace(float color)
{
return pow(color,GammaEncodePowerApprox);
}
float square(float value)
{
return value*value;
}
float pow5(float value) {
float sq=value*value;
return sq*sq*value;
}
float getLuminance(vec3 color)
{
return clamp(dot(color,LuminanceEncodeApprox),0.,1.);
}

float getRand(vec2 seed) {
return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);
}
float dither(vec2 seed,float varianceAmount) {
float rand=getRand(seed);
float dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);
return dither;
}

const float rgbdMaxRange=255.0;
vec4 toRGBD(vec3 color) {
float maxRGB=maxEps(max(color.r,max(color.g,color.b)));
float D=max(rgbdMaxRange/maxRGB,1.);
D=clamp(floor(D)/255.0,0.,1.);

vec3 rgb=color.rgb*D;

rgb=toGammaSpace(rgb);
return vec4(rgb,D);
}
vec3 fromRGBD(vec4 rgbd) {

rgbd.rgb=toLinearSpace(rgbd.rgb);

return rgbd.rgb/rgbd.a;
}
`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";o.d(t,"a",function(){return E});var R=o(0),r=o(10),I=o(5),i=o(15),G=o(18),D=o(22);i.a.CreateCylinder=function(x){var l=x.height||2,s=0===x.diameterTop?0:x.diameterTop||x.diameter||1,y=0===x.diameterBottom?0:x.diameterBottom||x.diameter||1;s=s||1e-05,y=y||1e-05;var q,n=x.tessellation||24,k=x.subdivisions||1,p=!!x.hasRings,u=!!x.enclose,A=0===x.cap?0:x.cap||I.a.CAP_ALL,B=x.arc&&(x.arc<=0||x.arc>1)?1:x.arc||1,v=0===x.sideOrientation?0:x.sideOrientation||i.a.DEFAULTSIDE,H=x.faceUV||new Array(3),L=x.faceColors,Q=2+(1+(1!==B&&u?2:0))*(p?k:1);for(q=0;q<Q;q++)L&&void 0===L[q]&&(L[q]=new r.b(1,1,1,1));for(q=0;q<Q;q++)H&&void 0===H[q]&&(H[q]=new R.f(0,0,1,1));var M,Y,X,U,P,ga,ma=new Array(),oa=new Array(),ja=new Array(),aa=new Array(),F=new Array(),$=2*Math.PI*B/n,ia=(y-s)/2/l,ba=R.e.Zero(),qa=R.e.Zero(),V=R.e.Zero(),O=R.e.Zero(),S=R.e.Zero(),W=D.a.Y,da=1,na=1,Ea=0,Ca=0;for(U=0;U<=k;U++)for(X=((Y=U/k)*(s-y)+y)/2,da=p&&0!==U&&U!==k?2:1,ga=0;ga<da;ga++){for(p&&(na+=ga),u&&(na+=2*ga),P=0;P<=n;P++)M=P*$,ba.x=Math.cos(-M)*X,ba.y=-l/2+Y*l,ba.z=Math.sin(-M)*X,0===s&&U===k?(qa.x=ja[ja.length-3*(n+1)],qa.y=ja[ja.length-3*(n+1)+1],qa.z=ja[ja.length-3*(n+1)+2]):(qa.x=ba.x,qa.z=ba.z,qa.y=Math.sqrt(qa.x*qa.x+qa.z*qa.z)*ia,qa.normalize()),0===P&&(V.copyFrom(ba),O.copyFrom(qa)),oa.push(ba.x,ba.y,ba.z),ja.push(qa.x,qa.y,qa.z),Ca=p?Ea!==na?H[na].y:H[na].w:H[na].y+(H[na].w-H[na].y)*Y,aa.push(H[na].x+(H[na].z-H[na].x)*P/n,Ca),L&&F.push(L[na].r,L[na].g,L[na].b,L[na].a);1!==B&&u&&(oa.push(ba.x,ba.y,ba.z),oa.push(0,ba.y,0),oa.push(0,ba.y,0),oa.push(V.x,V.y,V.z),R.e.CrossToRef(W,qa,S),S.normalize(),ja.push(S.x,S.y,S.z,S.x,S.y,S.z),R.e.CrossToRef(O,W,S),S.normalize(),ja.push(S.x,S.y,S.z,S.x,S.y,S.z),Ca=p?Ea!==na?H[na+1].y:H[na+1].w:H[na+1].y+(H[na+1].w-H[na+1].y)*Y,aa.push(H[na+1].x,Ca),aa.push(H[na+1].z,Ca),Ca=p?Ea!==na?H[na+2].y:H[na+2].w:H[na+2].y+(H[na+2].w-H[na+2].y)*Y,aa.push(H[na+2].x,Ca),aa.push(H[na+2].z,Ca),L&&(F.push(L[na+1].r,L[na+1].g,L[na+1].b,L[na+1].a),F.push(L[na+1].r,L[na+1].g,L[na+1].b,L[na+1].a),F.push(L[na+2].r,L[na+2].g,L[na+2].b,L[na+2].a),F.push(L[na+2].r,L[na+2].g,L[na+2].b,L[na+2].a))),Ea!==na&&(Ea=na)}var wa=1!==B&&u?n+4:n;for(U=0,na=0;na<k;na++){var Ka=0,Ga=0,Ba=0,Na=0;for(P=0;P<n;P++)Ka=U*(wa+1)+P,Ga=(U+1)*(wa+1)+P,Ba=U*(wa+1)+(P+1),Na=(U+1)*(wa+1)+(P+1),ma.push(Ka,Ga,Ba),ma.push(Na,Ba,Ga);1!==B&&u&&(ma.push(Ka+2,Ga+2,Ba+2),ma.push(Na+2,Ba+2,Ga+2),ma.push(Ka+4,Ga+4,Ba+4),ma.push(Na+4,Ba+4,Ga+4)),U=p?U+2:U+1}var db=function(Ya){var Sa=Ya?s/2:y/2;if(0!==Sa){var sb,kb,wb,tb=Ya?H[Q-1]:H[0],Ob=null;L&&(Ob=Ya?L[Q-1]:L[0]);var dc=oa.length/3,tc=Ya?l/2:-l/2,Tc=new R.e(0,tc,0);oa.push(Tc.x,Tc.y,Tc.z),ja.push(0,Ya?1:-1,0),aa.push(tb.x+.5*(tb.z-tb.x),tb.y+.5*(tb.w-tb.y)),Ob&&F.push(Ob.r,Ob.g,Ob.b,Ob.a);var Fb=new R.d(.5,.5);for(wb=0;wb<=n;wb++){sb=2*Math.PI*wb*B/n;var gd=Math.cos(-sb),hd=Math.sin(-sb);kb=new R.e(gd*Sa,tc,hd*Sa);var Ed=new R.d(gd*Fb.x+.5,hd*Fb.y+.5);oa.push(kb.x,kb.y,kb.z),ja.push(0,Ya?1:-1,0),aa.push(tb.x+(tb.z-tb.x)*Ed.x,tb.y+(tb.w-tb.y)*Ed.y),Ob&&F.push(Ob.r,Ob.g,Ob.b,Ob.a)}for(wb=0;wb<n;wb++)Ya?(ma.push(dc),ma.push(dc+(wb+2)),ma.push(dc+(wb+1))):(ma.push(dc),ma.push(dc+(wb+1)),ma.push(dc+(wb+2)))}};A!==I.a.CAP_START&&A!==I.a.CAP_ALL||db(!1),A!==I.a.CAP_END&&A!==I.a.CAP_ALL||db(!0),i.a._ComputeSides(v,oa,ma,ja,aa,x.frontUVs,x.backUVs);var eb=new i.a();return eb.indices=ma,eb.positions=oa,eb.normals=ja,eb.uvs=aa,L&&(eb.colors=F),eb},I.a.CreateCylinder=function(x,l,s,y,q,n,k,p,u){void 0!==k&&k instanceof G.a||(void 0!==k&&(u=p||I.a.DEFAULTSIDE,p=k),k=n,n=1);var A={height:l,diameterTop:s,diameterBottom:y,tessellation:q,subdivisions:n,sideOrientation:u,updatable:p};return E.CreateCylinder(x,A,k)};var E=function(){function x(){}return x.CreateCylinder=function(l,s,y){var q=new I.a(l,y);return s.sideOrientation=I.a._GetDefaultSideOrientation(s.sideOrientation),q._originalBuilderSideOrientation=s.sideOrientation,i.a.CreateCylinder(s).applyToMesh(q,s.updatable),q},x}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(0),r=function(){function I(i,G,D,E){this.normal=new R.e(i,G,D),this.d=E}return I.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},I.prototype.clone=function(){return new I(this.normal.x,this.normal.y,this.normal.z,this.d)},I.prototype.getClassName=function(){return"Plane"},I.prototype.getHashCode=function(){var i=this.normal.getHashCode();return i=397*i^(0|this.d)},I.prototype.normalize=function(){var i=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),G=0;return 0!==i&&(G=1/i),this.normal.x*=G,this.normal.y*=G,this.normal.z*=G,this.d*=G,this},I.prototype.transform=function(i){var G=I._TmpMatrix;R.a.TransposeToRef(i,G);var D=G.m,E=this.normal.x,x=this.normal.y,l=this.normal.z,s=this.d;return new I(E*D[0]+x*D[1]+l*D[2]+s*D[3],E*D[4]+x*D[5]+l*D[6]+s*D[7],E*D[8]+x*D[9]+l*D[10]+s*D[11],E*D[12]+x*D[13]+l*D[14]+s*D[15])},I.prototype.dotCoordinate=function(i){return this.normal.x*i.x+this.normal.y*i.y+this.normal.z*i.z+this.d},I.prototype.copyFromPoints=function(i,G,D){var E,x=G.x-i.x,l=G.y-i.y,s=G.z-i.z,y=D.x-i.x,q=D.y-i.y,n=D.z-i.z,k=l*n-s*q,p=s*y-x*n,u=x*q-l*y,A=Math.sqrt(k*k+p*p+u*u);return E=0!==A?1/A:0,this.normal.x=k*E,this.normal.y=p*E,this.normal.z=u*E,this.d=-(this.normal.x*i.x+this.normal.y*i.y+this.normal.z*i.z),this},I.prototype.isFrontFacingTo=function(i,G){return R.e.Dot(this.normal,i)<=G},I.prototype.signedDistanceTo=function(i){return R.e.Dot(i,this.normal)+this.d},I.FromArray=function(i){return new I(i[0],i[1],i[2],i[3])},I.FromPoints=function(i,G,D){var E=new I(0,0,0,0);return E.copyFromPoints(i,G,D),E},I.FromPositionAndNormal=function(i,G){var D=new I(0,0,0,0);return G.normalize(),D.normal=G,D.d=-(G.x*i.x+G.y*i.y+G.z*i.z),D},I.SignedDistanceToPlaneFromPositionAndNormal=function(i,G,D){var E=-(G.x*i.x+G.y*i.y+G.z*i.z);return R.e.Dot(D,G)+E},I._TmpMatrix=R.a.Identity(),I}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(I,i,G,D){this.x=I,this.y=i,this.width=G,this.height=D}return r.prototype.toGlobal=function(I,i){return new r(this.x*I,this.y*i,this.width*I,this.height*i)},r.prototype.toGlobalToRef=function(I,i,G){return G.x=this.x*I,G.y=this.y*i,G.width=this.width*I,G.height=this.height*i,this},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return x});var R=o(5),r=o(18),I=o(6),i=o(0),G=o(20),D=o(39),E=o(55),x=(o(79),function(){function l(s){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new I.c(),this.onDragStartObservable=new I.c(),this.onDragEndObservable=new I.c(),this.moveAttached=!0,this.enabled=!0,this.startAndReleaseDragOnPointerEvents=!0,this.detachCameraControls=!0,this.useObjectOrientationForDragging=!0,this.validateDrag=function(q){return!0},this._tmpVector=new i.e(0,0,0),this._alternatePickedPoint=new i.e(0,0,0),this._worldDragAxis=new i.e(0,0,0),this._targetPosition=new i.e(0,0,0),this._attachedElement=null,this._startDragRay=new D.a(new i.e(),new i.e()),this._lastPointerRay={},this._dragDelta=new i.e(),this._pointA=new i.e(0,0,0),this._pointB=new i.e(0,0,0),this._pointC=new i.e(0,0,0),this._lineA=new i.e(0,0,0),this._lineB=new i.e(0,0,0),this._localAxis=new i.e(0,0,0),this._lookAt=new i.e(0,0,0),this._options=s||{};var y=0;if(this._options.dragAxis&&y++,this._options.dragPlaneNormal&&y++,y>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(l.prototype,"options",{get:function(){return this._options},set:function(s){this._options=s},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!0,configurable:!0}),l.prototype.init=function(){},l.prototype.attach=function(s,y){var q=this;this._scene=s.getScene(),this.attachedNode=s,l._planeScene||(this._debugMode?l._planeScene=this._scene:(l._planeScene=new r.a(this._scene.getEngine(),{virtual:!0}),l._planeScene.detachControl(),this._scene.onDisposeObservable.addOnce(function(){l._planeScene.dispose(),l._planeScene=null}))),this._dragPlane=R.a.CreatePlane("pointerDragPlane",this._debugMode?1:10000,l._planeScene,!1,R.a.DOUBLESIDE),this.lastDragPosition=new i.e(0,0,0);var n=y||function(k){return q.attachedNode==k||k.isDescendantOf(q.attachedNode)};this._pointerObserver=this._scene.onPointerObservable.add(function(k,p){if(q.enabled){if(k.type==G.a.POINTERDOWN)q.startAndReleaseDragOnPointerEvents&&!q.dragging&&k.pickInfo&&k.pickInfo.hit&&k.pickInfo.pickedMesh&&k.pickInfo.pickedPoint&&k.pickInfo.ray&&n(k.pickInfo.pickedMesh)&&q._startDrag(k.event.pointerId,k.pickInfo.ray,k.pickInfo.pickedPoint);else if(k.type==G.a.POINTERUP)q.startAndReleaseDragOnPointerEvents&&q.currentDraggingPointerID==k.event.pointerId&&q.releaseDrag();else if(k.type==G.a.POINTERMOVE){var u=k.event.pointerId;q.currentDraggingPointerID===l._AnyMouseID&&u!==l._AnyMouseID&&"mouse"==k.event.pointerType&&(q._lastPointerRay[q.currentDraggingPointerID]&&(q._lastPointerRay[u]=q._lastPointerRay[q.currentDraggingPointerID],delete q._lastPointerRay[q.currentDraggingPointerID]),q.currentDraggingPointerID=u),q._lastPointerRay[u]||(q._lastPointerRay[u]=new D.a(new i.e(),new i.e())),k.pickInfo&&k.pickInfo.ray&&(q._lastPointerRay[u].origin.copyFrom(k.pickInfo.ray.origin),q._lastPointerRay[u].direction.copyFrom(k.pickInfo.ray.direction),q.currentDraggingPointerID==u&&q.dragging&&q._moveDrag(k.pickInfo.ray))}}}),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){q._moving&&q.moveAttached&&(E.a._RemoveAndStorePivotPoint(q.attachedNode),q._targetPosition.subtractToRef(q.attachedNode.absolutePosition,q._tmpVector),q._tmpVector.scaleInPlace(q.dragDeltaRatio),q.attachedNode.getAbsolutePosition().addToRef(q._tmpVector,q._tmpVector),q.validateDrag(q._tmpVector)&&q.attachedNode.setAbsolutePosition(q._tmpVector),E.a._RestorePivotPoint(q.attachedNode))})},l.prototype.releaseDrag=function(){this.dragging&&(this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID}),this.dragging=!1),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&this._scene.activeCamera.attachControl(this._attachedElement,!this._scene.activeCamera.inputs||this._scene.activeCamera.inputs.noPreventDefault)},l.prototype.startDrag=function(s,y,q){void 0===s&&(s=l._AnyMouseID),this._startDrag(s,y,q);var n=this._lastPointerRay[s];s===l._AnyMouseID&&(n=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),n&&this._moveDrag(n)},l.prototype._startDrag=function(s,y,q){if(this._scene.activeCamera&&!this.dragging&&this.attachedNode){E.a._RemoveAndStorePivotPoint(this.attachedNode),y?(this._startDragRay.direction.copyFrom(y.direction),this._startDragRay.origin.copyFrom(y.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this.attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,q||this._tmpVector);var n=this._pickWithRayOnDragPlane(this._startDragRay);n&&(this.dragging=!0,this.currentDraggingPointerID=s,this.lastDragPosition.copyFrom(n),this.onDragStartObservable.notifyObservers({dragPlanePoint:n,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this.attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&this._scene.activeCamera.inputs&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedElement?(this._attachedElement=this._scene.activeCamera.inputs.attachedElement,this._scene.activeCamera.detachControl(this._scene.activeCamera.inputs.attachedElement)):this._attachedElement=null)),E.a._RestorePivotPoint(this.attachedNode)}},l.prototype._moveDrag=function(s){this._moving=!0;var y=this._pickWithRayOnDragPlane(s);if(y){this.updateDragPlane&&this._updateDragPlanePosition(s,y);var q=0;this._options.dragAxis?(this.useObjectOrientationForDragging?i.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis):this._worldDragAxis.copyFrom(this._options.dragAxis),y.subtractToRef(this.lastDragPosition,this._tmpVector),q=i.e.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(q,this._dragDelta)):(q=this._dragDelta.length(),y.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:q,delta:this._dragDelta,dragPlanePoint:y,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(y)}},l.prototype._pickWithRayOnDragPlane=function(s){var y=this;if(!s)return null;var q=Math.acos(i.e.Dot(this._dragPlane.forward,s.direction));if(q>Math.PI/2&&(q=Math.PI-q),this.maxDragAngle>0&&q>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(s.direction),this.attachedNode.absolutePosition.subtractToRef(s.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*i.e.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var n=i.e.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-n,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this.attachedNode.absolutePosition),this._alternatePickedPoint}return null}var k=l._planeScene.pickWithRay(s,function(p){return p==y._dragPlane});return k&&k.hit&&k.pickedMesh&&k.pickedPoint?k.pickedPoint:null},l.prototype._updateDragPlanePosition=function(s,y){this._pointA.copyFrom(y),this._options.dragAxis?(this.useObjectOrientationForDragging?i.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),this._pointA.addToRef(this._localAxis,this._pointB),s.origin.subtractToRef(this._pointA,this._pointC),this._pointA.addToRef(this._pointC.normalize(),this._pointC),this._pointB.subtractToRef(this._pointA,this._lineA),this._pointC.subtractToRef(this._pointA,this._lineB),i.e.CrossToRef(this._lineA,this._lineB,this._lookAt),i.e.CrossToRef(this._lineA,this._lookAt,this._lookAt),this._lookAt.normalize(),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrientationForDragging?i.e.TransformCoordinatesToRef(this._options.dragPlaneNormal,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(s.origin)),this._dragPlane.position.copyFrom(this.attachedNode.absolutePosition),this._dragPlane.computeWorldMatrix(!0)},l.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this.releaseDrag()},l._AnyMouseID=-2,l}())},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r}),o.d(t,"b",function(){return I}),o.d(t,"c",function(){return i});var R=o(1),r=function(){function G(){}return G.KEYDOWN=1,G.KEYUP=2,G}(),I=function(G,D){this.type=G,this.event=D},i=function(G){function D(E,x){var l=G.call(this,E,x)||this;return l.type=E,l.event=x,l.skipOnPointerObservable=!1,l}return Object(R.d)(D,G),D}(I)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return r.prototype.unBindMesh=function(){this._mesh=null},r.prototype.addFallback=function(I,i){this._defines[I]||(I<this._currentRank&&(this._currentRank=I),I>this._maxRank&&(this._maxRank=I),this._defines[I]=new Array()),this._defines[I].push(i)},r.prototype.addCPUSkinningFallback=function(I,i){this._mesh=i,I<this._currentRank&&(this._currentRank=I),I>this._maxRank&&(this._maxRank=I)},Object.defineProperty(r.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),r.prototype.reduce=function(I,i){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,I=I.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),i._bonesComputationForcedToCPU=!0;for(var G=this._mesh.getScene(),D=0;D<G.meshes.length;D++){var E=G.meshes[D];if(E.material){if(E.computeBonesUsingShaders&&0!==E.numBoneInfluencers){if(E.material.getEffect()===i)E.computeBonesUsingShaders=!1;else if(E.subMeshes){for(var x=0,l=E.subMeshes;x<l.length;x++)if(l[x].effect===i){E.computeBonesUsingShaders=!1;break}}}}else!this._mesh.material&&E.computeBonesUsingShaders&&E.numBoneInfluencers>0&&(E.computeBonesUsingShaders=!1)}}else{var s=this._defines[this._currentRank];if(s)for(D=0;D<s.length;D++)I=I.replace("#define "+s[D],"");this._currentRank++}return I},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){this._xhr=new XMLHttpRequest()}return r.prototype._injectCustomRequestHeaders=function(){for(var I in r.CustomRequestHeaders){var i=r.CustomRequestHeaders[I];i&&this._xhr.setRequestHeader(I,i)}},Object.defineProperty(r.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(I){this._xhr.onprogress=I},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"status",{get:function(){return this._xhr.status},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"response",{get:function(){return this._xhr.response},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(I){this._xhr.responseType=I},enumerable:!0,configurable:!0}),r.prototype.addEventListener=function(I,i,G){this._xhr.addEventListener(I,i,G)},r.prototype.removeEventListener=function(I,i,G){this._xhr.removeEventListener(I,i,G)},r.prototype.abort=function(){this._xhr.abort()},r.prototype.send=function(I){r.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(I)},r.prototype.open=function(I,i){for(var G=0,D=r.CustomRequestModifiers;G<D.length;G++)(0,D[G])(this._xhr,i);return i=(i=i.replace("file:http:","http:")).replace("file:https:","https:"),this._xhr.open(I,i,!0)},r.prototype.setRequestHeader=function(I,i){this._xhr.setRequestHeader(I,i)},r.prototype.getResponseHeader=function(I){return this._xhr.getResponseHeader(I)},r.CustomRequestHeaders={},r.CustomRequestModifiers=new Array(),r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return G});var R=o(0),r=o(10),I=o(5),i=o(15);i.a.CreateBox=function(D){var E,x=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],l=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],s=[],y=D.width||D.size||1,q=D.height||D.size||1,n=D.depth||D.size||1,k=D.wrap||!1,p=void 0===D.topBaseAt?1:D.topBaseAt,u=void 0===D.bottomBaseAt?0:D.bottomBaseAt,A=[2,0,3,1][p=(p+4)%4],B=[2,0,1,3][u=(u+4)%4],v=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(k){x=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],v=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var H=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],L=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],Q=[17,18,19,16],M=[22,23,20,21];A>0;)H.unshift(H.pop()),Q.unshift(Q.pop()),A--;for(;B>0;)L.unshift(L.pop()),M.unshift(M.pop()),B--;H=H.flat(),L=L.flat(),v=v.concat(H).concat(L),x.push(Q[0],Q[2],Q[3],Q[0],Q[1],Q[2]),x.push(M[0],M[2],M[3],M[0],M[1],M[2])}var Y=[y/2,q/2,n/2];E=v.reduce(function($,ia,ba){return $.concat(ia*Y[ba%3])},[]);for(var X=0===D.sideOrientation?0:D.sideOrientation||i.a.DEFAULTSIDE,U=D.faceUV||new Array(6),P=D.faceColors,ga=[],ma=0;ma<6;ma++)void 0===U[ma]&&(U[ma]=new R.f(0,0,1,1)),P&&void 0===P[ma]&&(P[ma]=new r.b(1,1,1,1));for(var oa=0;oa<6;oa++)if(s.push(U[oa].z,U[oa].w),s.push(U[oa].x,U[oa].w),s.push(U[oa].x,U[oa].y),s.push(U[oa].z,U[oa].y),P)for(var ja=0;ja<4;ja++)ga.push(P[oa].r,P[oa].g,P[oa].b,P[oa].a);i.a._ComputeSides(X,E,x,l,s,D.frontUVs,D.backUVs);var aa=new i.a();if(aa.indices=x,aa.positions=E,aa.normals=l,aa.uvs=s,P){var F=X===i.a.DOUBLESIDE?ga.concat(ga):ga;aa.colors=F}return aa},I.a.CreateBox=function(D,E,x,l,s){void 0===x&&(x=null);var y={size:E,sideOrientation:s,updatable:l};return G.CreateBox(D,y,x)};var G=function(){function D(){}return D.CreateBox=function(E,x,l){void 0===l&&(l=null);var s=new I.a(E,l);return x.sideOrientation=I.a._GetDefaultSideOrientation(x.sideOrientation),s._originalBuilderSideOrientation=x.sideOrientation,i.a.CreateBox(x).applyToMesh(s,x.updatable),s},D}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(2),r=function(){function I(){}return Object.defineProperty(I,"ForceFullSceneLoadingForIncremental",{get:function(){return I._ForceFullSceneLoadingForIncremental},set:function(i){I._ForceFullSceneLoadingForIncremental=i},enumerable:!0,configurable:!0}),Object.defineProperty(I,"ShowLoadingScreen",{get:function(){return I._ShowLoadingScreen},set:function(i){I._ShowLoadingScreen=i},enumerable:!0,configurable:!0}),Object.defineProperty(I,"loggingLevel",{get:function(){return I._loggingLevel},set:function(i){I._loggingLevel=i},enumerable:!0,configurable:!0}),Object.defineProperty(I,"CleanBoneMatrixWeights",{get:function(){return I._CleanBoneMatrixWeights},set:function(i){I._CleanBoneMatrixWeights=i},enumerable:!0,configurable:!0}),I._ForceFullSceneLoadingForIncremental=!1,I._ShowLoadingScreen=!0,I._CleanBoneMatrixWeights=!1,I._loggingLevel=R.a.SCENELOADER_NO_LOGGING,I}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(I,i){this.width=I,this.height=i}return r.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},r.prototype.getClassName=function(){return"Size"},r.prototype.getHashCode=function(){var I=0|this.width;return I=397*I^(0|this.height)},r.prototype.copyFrom=function(I){this.width=I.width,this.height=I.height},r.prototype.copyFromFloats=function(I,i){return this.width=I,this.height=i,this},r.prototype.set=function(I,i){return this.copyFromFloats(I,i)},r.prototype.multiplyByFloats=function(I,i){return new r(this.width*I,this.height*i)},r.prototype.clone=function(){return new r(this.width,this.height)},r.prototype.equals=function(I){return!!I&&(this.width===I.width&&this.height===I.height)},Object.defineProperty(r.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),r.Zero=function(){return new r(0,0)},r.prototype.add=function(I){return new r(this.width+I.width,this.height+I.height)},r.prototype.subtract=function(I){return new r(this.width-I.width,this.height-I.height)},r.Lerp=function(I,i,G){return new r(I.width+(i.width-I.width)*G,I.height+(i.height-I.height)*G)},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return q});var R=o(0),r=o(10),I=o(15),i=o(4),G=o(57),D=o(67),E=o(44),x=o(2),l=o(13),s=o(35),y=o(110),q=function(){function n(k,p,u,A,B){void 0===A&&(A=!1),void 0===B&&(B=null),this.delayLoadState=x.a.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=k,this.uniqueId=p.getUniqueId(),this._engine=p.getEngine(),this._meshes=[],this._scene=p,this._vertexBuffers={},this._indices=[],this._updatable=A,u?this.setAllVerticesData(u,A):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),B&&(this.applyToMesh(B),B.computeWorldMatrix(!0))}return Object.defineProperty(n.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(k){this._boundingBias?this._boundingBias.copyFrom(k):this._boundingBias=k.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),n.CreateGeometryForMesh=function(k){var p=new n(n.RandomId(),k.getScene());return p.applyToMesh(k),p},Object.defineProperty(n.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),n.prototype.getScene=function(){return this._scene},n.prototype.getEngine=function(){return this._engine},n.prototype.isReady=function(){return this.delayLoadState===x.a.DELAYLOADSTATE_LOADED||this.delayLoadState===x.a.DELAYLOADSTATE_NONE},Object.defineProperty(n.prototype,"doNotSerialize",{get:function(){for(var k=0;k<this._meshes.length;k++)if(!this._meshes[k].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),n.prototype._rebuild=function(){for(var k in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers)this._vertexBuffers[k]._rebuild()},n.prototype.setAllVerticesData=function(k,p){k.applyToGeometry(this,p),this.notifyUpdate()},n.prototype.setVerticesData=function(k,p,u,A){void 0===u&&(u=!1);var B=new i.b(this._engine,p,k,u,0===this._meshes.length,A);this.setVerticesBuffer(B)},n.prototype.removeVerticesData=function(k){this._vertexBuffers[k]&&(this._vertexBuffers[k].dispose(),delete this._vertexBuffers[k])},n.prototype.setVerticesBuffer=function(k,p){void 0===p&&(p=null);var u=k.getKind();if(this._vertexBuffers[u]&&this._vertexBuffers[u].dispose(),this._vertexBuffers[u]=k,u===i.b.PositionKind){var A=k.getData();null!=p?this._totalVertices=p:null!=A&&(this._totalVertices=A.length/(k.byteStride/4)),this._updateExtend(A),this._resetPointsArrayCache();for(var B=this._meshes,v=B.length,H=0;H<v;H++){var L=B[H];L._boundingInfo=new E.a(this._extend.minimum,this._extend.maximum),L._createGlobalSubMesh(!1),L.computeWorldMatrix(!0)}}this.notifyUpdate(u),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},n.prototype.updateVerticesDataDirectly=function(k,p,u,A){void 0===A&&(A=!1);var B=this.getVertexBuffer(k);B&&(B.updateDirectly(p,u,A),this.notifyUpdate(k))},n.prototype.updateVerticesData=function(k,p,u){void 0===u&&(u=!1);var A=this.getVertexBuffer(k);A&&(A.update(p),k===i.b.PositionKind&&this._updateBoundingInfo(u,p),this.notifyUpdate(k))},n.prototype._updateBoundingInfo=function(k,p){if(k&&this._updateExtend(p),this._resetPointsArrayCache(),k)for(var u=0,A=this._meshes;u<A.length;u++){var B=A[u];B._boundingInfo?B._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):B._boundingInfo=new E.a(this._extend.minimum,this._extend.maximum);for(var v=0,H=B.subMeshes;v<H.length;v++)H[v].refreshBoundingInfo()}},n.prototype._bind=function(k,p){if(k){void 0===p&&(p=this._indexBuffer);var u=this.getVertexBuffers();u&&(p==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[k.key]||(this._vertexArrayObjects[k.key]=this._engine.recordVertexArrayObject(u,p,k)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[k.key],p)):this._engine.bindBuffers(u,p,k))}},n.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},n.prototype.getVerticesData=function(k,p,u){var A=this.getVertexBuffer(k);if(!A)return null;var B=A.getData();if(!B)return null;var v=A.getSize()*i.b.GetTypeByteLength(A.type),H=this._totalVertices*A.getSize();if(A.type!==i.b.FLOAT||A.byteStride!==v){var L=[];return A.forEach(H,function(X){return L.push(X)}),L}if(!(B instanceof Array||B instanceof Float32Array)||0!==A.byteOffset||B.length!==H){if(B instanceof Array){var Q=A.byteOffset/4;return l.b.Slice(B,Q,Q+H)}if(B instanceof ArrayBuffer)return new Float32Array(B,A.byteOffset,H);Q=B.byteOffset+A.byteOffset;if(u||p&&1!==this._meshes.length){var M=new Float32Array(H),Y=new Float32Array(B.buffer,Q,H);return M.set(Y),M}return new Float32Array(B.buffer,Q,H)}return u||p&&1!==this._meshes.length?l.b.Slice(B):B},n.prototype.isVertexBufferUpdatable=function(k){var p=this._vertexBuffers[k];return!!p&&p.isUpdatable()},n.prototype.getVertexBuffer=function(k){return this.isReady()?this._vertexBuffers[k]:null},n.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},n.prototype.isVerticesDataPresent=function(k){return this._vertexBuffers?void 0!==this._vertexBuffers[k]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(k)},n.prototype.getVerticesDataKinds=function(){var k,p=[];if(!this._vertexBuffers&&this._delayInfo)for(k in this._delayInfo)p.push(k);else for(k in this._vertexBuffers)p.push(k);return p},n.prototype.updateIndices=function(k,p,u){if(void 0===u&&(u=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var A=k.length!==this._indices.length;if(u||(this._indices=k.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,k,p),A)for(var B=0,v=this._meshes;B<v.length;B++)v[B]._createGlobalSubMesh(!0)}else this.setIndices(k,null,!0)},n.prototype.setIndices=function(k,p,u){void 0===p&&(p=null),void 0===u&&(u=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=k,this._indexBufferIsUpdatable=u,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,u)),null!=p&&(this._totalVertices=p);for(var A=0,B=this._meshes;A<B.length;A++)B[A]._createGlobalSubMesh(!0);this.notifyUpdate()},n.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},n.prototype.getIndices=function(k,p){if(!this.isReady())return null;var u=this._indices;if(p||k&&1!==this._meshes.length){for(var A=u.length,B=[],v=0;v<A;v++)B.push(u[v]);return B}return u},n.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},n.prototype._releaseVertexArrayObject=function(k){void 0===k&&(k=null),k&&this._vertexArrayObjects&&this._vertexArrayObjects[k.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[k.key]),delete this._vertexArrayObjects[k.key])},n.prototype.releaseForMesh=function(k,p){var u=this._meshes,A=u.indexOf(k);-1!==A&&(u.splice(A,1),k._geometry=null,0===u.length&&p&&this.dispose())},n.prototype.applyToMesh=function(k){if(k._geometry!==this){var p=k._geometry;p&&p.releaseForMesh(k);var u=this._meshes;k._geometry=this,this._scene.pushGeometry(this),u.push(k),this.isReady()?this._applyToMesh(k):k._boundingInfo=this._boundingInfo}},n.prototype._updateExtend=function(k){void 0===k&&(k=null),k||(k=this.getVerticesData(i.b.PositionKind)),this._extend=Object(y.a)(k,0,this._totalVertices,this.boundingBias,3)},n.prototype._applyToMesh=function(k){var p=this._meshes.length;for(var u in this._vertexBuffers){1===p&&this._vertexBuffers[u].create();var A=this._vertexBuffers[u].getBuffer();A&&(A.references=p),u===i.b.PositionKind&&(this._extend||this._updateExtend(),k._boundingInfo=new E.a(this._extend.minimum,this._extend.maximum),k._createGlobalSubMesh(!1),k._updateBoundingInfo())}1===p&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=p),k._syncGeometryWithMorphTargetManager(),k.synchronizeInstances()},n.prototype.notifyUpdate=function(k){this.onGeometryUpdated&&this.onGeometryUpdated(this,k);for(var p=0,u=this._meshes;p<u.length;p++)u[p]._markSubMeshesAsAttributesDirty()},n.prototype.load=function(k,p){this.delayLoadState!==x.a.DELAYLOADSTATE_LOADING&&(this.isReady()?p&&p():(this.delayLoadState=x.a.DELAYLOADSTATE_LOADING,this._queueLoad(k,p)))},n.prototype._queueLoad=function(k,p){var u=this;this.delayLoadingFile&&(k._addPendingData(this),k._loadFile(this.delayLoadingFile,function(A){if(u._delayLoadingFunction){u._delayLoadingFunction(JSON.parse(A),u),u.delayLoadState=x.a.DELAYLOADSTATE_LOADED,u._delayInfo=[],k._removePendingData(u);for(var B=u._meshes,v=B.length,H=0;H<v;H++)u._applyToMesh(B[H]);p&&p()}},void 0,!0))},n.prototype.toLeftHanded=function(){var k=this.getIndices(!1);if(null!=k&&k.length>0){for(var p=0;p<k.length;p+=3){var u=k[p+0];k[p+0]=k[p+2],k[p+2]=u}this.setIndices(k)}var A=this.getVerticesData(i.b.PositionKind,!1);if(null!=A&&A.length>0){for(p=0;p<A.length;p+=3)A[p+2]=-A[p+2];this.setVerticesData(i.b.PositionKind,A,!1)}var B=this.getVerticesData(i.b.NormalKind,!1);if(null!=B&&B.length>0){for(p=0;p<B.length;p+=3)B[p+2]=-B[p+2];this.setVerticesData(i.b.NormalKind,B,!1)}},n.prototype._resetPointsArrayCache=function(){this._positions=null},n.prototype._generatePointsArray=function(){if(this._positions)return!0;var k=this.getVerticesData(i.b.PositionKind);if(!k||0===k.length)return!1;this._positions=[];for(var p=0;p<k.length;p+=3)this._positions.push(R.e.FromArray(k,p));return!0},n.prototype.isDisposed=function(){return this._isDisposed},n.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var k in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[k]);this._vertexArrayObjects={}}},n.prototype.dispose=function(){var k,p=this._meshes,u=p.length;for(k=0;k<u;k++)this.releaseForMesh(p[k]);for(var A in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[A].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=x.a.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},n.prototype.copy=function(k){var p=new I.a();p.indices=[];var u=this.getIndices();if(u)for(var A=0;A<u.length;A++)p.indices.push(u[A]);var B,v=!1,H=!1;for(B in this._vertexBuffers){var L=this.getVerticesData(B);if(L&&(L instanceof Float32Array?p.set(new Float32Array(L),B):p.set(L.slice(0),B),!H)){var Q=this.getVertexBuffer(B);Q&&(H=!(v=Q.isUpdatable()))}}var M=new n(k,this._scene,p,v);for(B in M.delayLoadState=this.delayLoadState,M.delayLoadingFile=this.delayLoadingFile,M._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)M._delayInfo=M._delayInfo||[],M._delayInfo.push(B);return M._boundingInfo=new E.a(this._extend.minimum,this._extend.maximum),M},n.prototype.serialize=function(){var k={};return k.id=this.id,k.updatable=this._updatable,s.a&&s.a.HasTags(this)&&(k.tags=s.a.GetTags(this)),k},n.prototype.toNumberArray=function(k){return Array.isArray(k)?k:Array.prototype.slice.call(k)},n.prototype.serializeVerticeData=function(){var k=this.serialize();return this.isVerticesDataPresent(i.b.PositionKind)&&(k.positions=this.toNumberArray(this.getVerticesData(i.b.PositionKind)),this.isVertexBufferUpdatable(i.b.PositionKind)&&(k.positions._updatable=!0)),this.isVerticesDataPresent(i.b.NormalKind)&&(k.normals=this.toNumberArray(this.getVerticesData(i.b.NormalKind)),this.isVertexBufferUpdatable(i.b.NormalKind)&&(k.normals._updatable=!0)),this.isVerticesDataPresent(i.b.TangentKind)&&(k.tangets=this.toNumberArray(this.getVerticesData(i.b.TangentKind)),this.isVertexBufferUpdatable(i.b.TangentKind)&&(k.tangets._updatable=!0)),this.isVerticesDataPresent(i.b.UVKind)&&(k.uvs=this.toNumberArray(this.getVerticesData(i.b.UVKind)),this.isVertexBufferUpdatable(i.b.UVKind)&&(k.uvs._updatable=!0)),this.isVerticesDataPresent(i.b.UV2Kind)&&(k.uv2s=this.toNumberArray(this.getVerticesData(i.b.UV2Kind)),this.isVertexBufferUpdatable(i.b.UV2Kind)&&(k.uv2s._updatable=!0)),this.isVerticesDataPresent(i.b.UV3Kind)&&(k.uv3s=this.toNumberArray(this.getVerticesData(i.b.UV3Kind)),this.isVertexBufferUpdatable(i.b.UV3Kind)&&(k.uv3s._updatable=!0)),this.isVerticesDataPresent(i.b.UV4Kind)&&(k.uv4s=this.toNumberArray(this.getVerticesData(i.b.UV4Kind)),this.isVertexBufferUpdatable(i.b.UV4Kind)&&(k.uv4s._updatable=!0)),this.isVerticesDataPresent(i.b.UV5Kind)&&(k.uv5s=this.toNumberArray(this.getVerticesData(i.b.UV5Kind)),this.isVertexBufferUpdatable(i.b.UV5Kind)&&(k.uv5s._updatable=!0)),this.isVerticesDataPresent(i.b.UV6Kind)&&(k.uv6s=this.toNumberArray(this.getVerticesData(i.b.UV6Kind)),this.isVertexBufferUpdatable(i.b.UV6Kind)&&(k.uv6s._updatable=!0)),this.isVerticesDataPresent(i.b.ColorKind)&&(k.colors=this.toNumberArray(this.getVerticesData(i.b.ColorKind)),this.isVertexBufferUpdatable(i.b.ColorKind)&&(k.colors._updatable=!0)),this.isVerticesDataPresent(i.b.MatricesIndicesKind)&&(k.matricesIndices=this.toNumberArray(this.getVerticesData(i.b.MatricesIndicesKind)),k.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(i.b.MatricesIndicesKind)&&(k.matricesIndices._updatable=!0)),this.isVerticesDataPresent(i.b.MatricesWeightsKind)&&(k.matricesWeights=this.toNumberArray(this.getVerticesData(i.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(i.b.MatricesWeightsKind)&&(k.matricesWeights._updatable=!0)),k.indices=this.toNumberArray(this.getIndices()),k},n.ExtractFromMesh=function(k,p){var u=k._geometry;return u?u.copy(p):null},n.RandomId=function(){return l.b.RandomId()},n._ImportGeometry=function(k,p){var u=p.getScene(),A=k.geometryId;if(A){var B=u.getGeometryByID(A);B&&B.applyToMesh(p)}else if(k instanceof ArrayBuffer){var v=p._binaryInfo;if(v.positionsAttrDesc&&v.positionsAttrDesc.count>0){var H=new Float32Array(k,v.positionsAttrDesc.offset,v.positionsAttrDesc.count);p.setVerticesData(i.b.PositionKind,H,!1)}if(v.normalsAttrDesc&&v.normalsAttrDesc.count>0){var L=new Float32Array(k,v.normalsAttrDesc.offset,v.normalsAttrDesc.count);p.setVerticesData(i.b.NormalKind,L,!1)}if(v.tangetsAttrDesc&&v.tangetsAttrDesc.count>0){var Q=new Float32Array(k,v.tangetsAttrDesc.offset,v.tangetsAttrDesc.count);p.setVerticesData(i.b.TangentKind,Q,!1)}if(v.uvsAttrDesc&&v.uvsAttrDesc.count>0){var M=new Float32Array(k,v.uvsAttrDesc.offset,v.uvsAttrDesc.count);p.setVerticesData(i.b.UVKind,M,!1)}if(v.uvs2AttrDesc&&v.uvs2AttrDesc.count>0){var Y=new Float32Array(k,v.uvs2AttrDesc.offset,v.uvs2AttrDesc.count);p.setVerticesData(i.b.UV2Kind,Y,!1)}if(v.uvs3AttrDesc&&v.uvs3AttrDesc.count>0){var X=new Float32Array(k,v.uvs3AttrDesc.offset,v.uvs3AttrDesc.count);p.setVerticesData(i.b.UV3Kind,X,!1)}if(v.uvs4AttrDesc&&v.uvs4AttrDesc.count>0){var U=new Float32Array(k,v.uvs4AttrDesc.offset,v.uvs4AttrDesc.count);p.setVerticesData(i.b.UV4Kind,U,!1)}if(v.uvs5AttrDesc&&v.uvs5AttrDesc.count>0){var P=new Float32Array(k,v.uvs5AttrDesc.offset,v.uvs5AttrDesc.count);p.setVerticesData(i.b.UV5Kind,P,!1)}if(v.uvs6AttrDesc&&v.uvs6AttrDesc.count>0){var ga=new Float32Array(k,v.uvs6AttrDesc.offset,v.uvs6AttrDesc.count);p.setVerticesData(i.b.UV6Kind,ga,!1)}if(v.colorsAttrDesc&&v.colorsAttrDesc.count>0){var ma=new Float32Array(k,v.colorsAttrDesc.offset,v.colorsAttrDesc.count);p.setVerticesData(i.b.ColorKind,ma,!1,v.colorsAttrDesc.stride)}if(v.matricesIndicesAttrDesc&&v.matricesIndicesAttrDesc.count>0){for(var oa=new Int32Array(k,v.matricesIndicesAttrDesc.offset,v.matricesIndicesAttrDesc.count),ja=[],aa=0;aa<oa.length;aa++){var F=oa[aa];ja.push(255&F),ja.push((65280&F)>>8),ja.push((16711680&F)>>16),ja.push(F>>24)}p.setVerticesData(i.b.MatricesIndicesKind,ja,!1)}if(v.matricesWeightsAttrDesc&&v.matricesWeightsAttrDesc.count>0){var $=new Float32Array(k,v.matricesWeightsAttrDesc.offset,v.matricesWeightsAttrDesc.count);p.setVerticesData(i.b.MatricesWeightsKind,$,!1)}if(v.indicesAttrDesc&&v.indicesAttrDesc.count>0){var ia=new Int32Array(k,v.indicesAttrDesc.offset,v.indicesAttrDesc.count);p.setIndices(ia,null)}if(v.subMeshesAttrDesc&&v.subMeshesAttrDesc.count>0){var ba=new Int32Array(k,v.subMeshesAttrDesc.offset,5*v.subMeshesAttrDesc.count);for(p.subMeshes=[],aa=0;aa<v.subMeshesAttrDesc.count;aa++){var qa=ba[5*aa+0],V=ba[5*aa+1],O=ba[5*aa+2],S=ba[5*aa+3],W=ba[5*aa+4];G.b.AddToMesh(qa,V,O,S,W,p)}}}else if(k.positions&&k.normals&&k.indices){if(p.setVerticesData(i.b.PositionKind,k.positions,k.positions._updatable),p.setVerticesData(i.b.NormalKind,k.normals,k.normals._updatable),k.tangents&&p.setVerticesData(i.b.TangentKind,k.tangents,k.tangents._updatable),k.uvs&&p.setVerticesData(i.b.UVKind,k.uvs,k.uvs._updatable),k.uvs2&&p.setVerticesData(i.b.UV2Kind,k.uvs2,k.uvs2._updatable),k.uvs3&&p.setVerticesData(i.b.UV3Kind,k.uvs3,k.uvs3._updatable),k.uvs4&&p.setVerticesData(i.b.UV4Kind,k.uvs4,k.uvs4._updatable),k.uvs5&&p.setVerticesData(i.b.UV5Kind,k.uvs5,k.uvs5._updatable),k.uvs6&&p.setVerticesData(i.b.UV6Kind,k.uvs6,k.uvs6._updatable),k.colors&&p.setVerticesData(i.b.ColorKind,r.b.CheckColors4(k.colors,k.positions.length/3),k.colors._updatable),k.matricesIndices)if(k.matricesIndices._isExpanded)delete k.matricesIndices._isExpanded,p.setVerticesData(i.b.MatricesIndicesKind,k.matricesIndices,k.matricesIndices._updatable);else{for(ja=[],aa=0;aa<k.matricesIndices.length;aa++){var da=k.matricesIndices[aa];ja.push(255&da),ja.push((65280&da)>>8),ja.push((16711680&da)>>16),ja.push(da>>24)}p.setVerticesData(i.b.MatricesIndicesKind,ja,k.matricesIndices._updatable)}if(k.matricesIndicesExtra)if(k.matricesIndicesExtra._isExpanded)delete k.matricesIndices._isExpanded,p.setVerticesData(i.b.MatricesIndicesExtraKind,k.matricesIndicesExtra,k.matricesIndicesExtra._updatable);else{for(ja=[],aa=0;aa<k.matricesIndicesExtra.length;aa++)da=k.matricesIndicesExtra[aa],ja.push(255&da),ja.push((65280&da)>>8),ja.push((16711680&da)>>16),ja.push(da>>24);p.setVerticesData(i.b.MatricesIndicesExtraKind,ja,k.matricesIndicesExtra._updatable)}k.matricesWeights&&(n._CleanMatricesWeights(k,p),p.setVerticesData(i.b.MatricesWeightsKind,k.matricesWeights,k.matricesWeights._updatable)),k.matricesWeightsExtra&&p.setVerticesData(i.b.MatricesWeightsExtraKind,k.matricesWeightsExtra,k.matricesWeights._updatable),p.setIndices(k.indices,null)}if(k.subMeshes){p.subMeshes=[];for(var na=0;na<k.subMeshes.length;na++){var Ea=k.subMeshes[na];G.b.AddToMesh(Ea.materialIndex,Ea.verticesStart,Ea.verticesCount,Ea.indexStart,Ea.indexCount,p)}}p._shouldGenerateFlatShading&&(p.convertToFlatShadedMesh(),delete p._shouldGenerateFlatShading),p.computeWorldMatrix(!0),u.onMeshImportedObservable.notifyObservers(p)},n._CleanMatricesWeights=function(k,p){if(D.a.CleanBoneMatrixWeights){var u=0;if(k.skeletonId>-1){var A=p.getScene().getLastSkeletonByID(k.skeletonId);if(A){u=A.bones.length;for(var B=p.getVerticesData(i.b.MatricesIndicesKind),v=p.getVerticesData(i.b.MatricesIndicesExtraKind),H=k.matricesWeights,L=k.matricesWeightsExtra,Q=k.numBoneInfluencer,M=H.length,Y=0;Y<M;Y+=4){for(var X=0,U=-1,P=0;P<4;P++)X+=ga=H[Y+P],ga<.001&&U<0&&(U=P);if(L)for(P=0;P<4;P++){var ga;X+=ga=L[Y+P],ga<.001&&U<0&&(U=P+4)}if((U<0||U>Q-1)&&(U=Q-1),X>.001){var ma=1/X;for(P=0;P<4;P++)H[Y+P]*=ma;if(L)for(P=0;P<4;P++)L[Y+P]*=ma}else U>=4?(L[Y+U-4]=1-X,v[Y+U-4]=u):(H[Y+U]=1-X,B[Y+U]=u)}p.setVerticesData(i.b.MatricesIndicesKind,B),k.matricesWeightsExtra&&p.setVerticesData(i.b.MatricesIndicesExtraKind,v)}}}},n.Parse=function(k,p,u){if(p.getGeometryByID(k.id))return null;var A=new n(k.id,p,void 0,k.updatable);return s.a&&s.a.AddTagsTo(A,k.tags),k.delayLoadingFile?(A.delayLoadState=x.a.DELAYLOADSTATE_NOTLOADED,A.delayLoadingFile=u+k.delayLoadingFile,A._boundingInfo=new E.a(R.e.FromArray(k.boundingBoxMinimum),R.e.FromArray(k.boundingBoxMaximum)),A._delayInfo=[],k.hasUVs&&A._delayInfo.push(i.b.UVKind),k.hasUVs2&&A._delayInfo.push(i.b.UV2Kind),k.hasUVs3&&A._delayInfo.push(i.b.UV3Kind),k.hasUVs4&&A._delayInfo.push(i.b.UV4Kind),k.hasUVs5&&A._delayInfo.push(i.b.UV5Kind),k.hasUVs6&&A._delayInfo.push(i.b.UV6Kind),k.hasColors&&A._delayInfo.push(i.b.ColorKind),k.hasMatricesIndices&&A._delayInfo.push(i.b.MatricesIndicesKind),k.hasMatricesWeights&&A._delayInfo.push(i.b.MatricesWeightsKind),A._delayLoadingFunction=I.a.ImportVertexData):I.a.ImportVertexData(k,A),p.pushGeometry(A,!0),A},n}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.CreateCanvas=function(I,i){if("undefined"==typeof document)return new OffscreenCanvas(I,i);var G=document.createElement("canvas");return G.width=I,G.height=i,G},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return G});var R=o(1),r=o(29),I=o(35),i=o(12),G=function(D){function E(x,l){var s=D.call(this,x,l,!0)||this;return l.multiMaterials.push(s),s.subMaterials=new Array(),s._storeEffectOnSubMeshes=!0,s}return Object(R.d)(E,D),Object.defineProperty(E.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(x){this._subMaterials=x,this._hookArray(x)},enumerable:!0,configurable:!0}),E.prototype.getChildren=function(){return this.subMaterials},E.prototype._hookArray=function(x){var l=this,s=x.push;x.push=function(){for(var q=[],n=0;n<arguments.length;n++)q[n]=arguments[n];var k=s.apply(x,q);return l._markAllSubMeshesAsTexturesDirty(),k};var y=x.splice;x.splice=function(q,n){var k=y.apply(x,[q,n]);return l._markAllSubMeshesAsTexturesDirty(),k}},E.prototype.getSubMaterial=function(x){return x<0||x>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[x]},E.prototype.getActiveTextures=function(){var x;return(x=D.prototype.getActiveTextures.call(this)).concat.apply(x,this.subMaterials.map(function(l){return l?l.getActiveTextures():[]}))},E.prototype.getClassName=function(){return"MultiMaterial"},E.prototype.isReadyForSubMesh=function(x,l,s){for(var y=0;y<this.subMaterials.length;y++){var q=this.subMaterials[y];if(q){if(q._storeEffectOnSubMeshes){if(!q.isReadyForSubMesh(x,l,s))return!1;continue}if(!q.isReady(x))return!1}}return!0},E.prototype.clone=function(x,l){for(var s=new E(x,this.getScene()),y=0;y<this.subMaterials.length;y++){var q=null,n=this.subMaterials[y];q=l&&n?n.clone(x+"-"+n.name):this.subMaterials[y],s.subMaterials.push(q)}return s},E.prototype.serialize=function(){var x={};x.name=this.name,x.id=this.id,I.a&&(x.tags=I.a.GetTags(this)),x.materials=[];for(var l=0;l<this.subMaterials.length;l++){var s=this.subMaterials[l];s?x.materials.push(s.id):x.materials.push(null)}return x},E.prototype.dispose=function(x,l,s){var y=this.getScene();if(y){if(s)for(var q=0;q<this.subMaterials.length;q++){var n=this.subMaterials[q];n&&n.dispose(x,l)}(q=y.multiMaterials.indexOf(this))>=0&&y.multiMaterials.splice(q,1),D.prototype.dispose.call(this,x,l)}},E.ParseMultiMaterial=function(x,l){var s=new E(x.name,l);s.id=x.id,I.a&&I.a.AddTagsTo(s,x.tags);for(var y=0;y<x.materials.length;y++){var q=x.materials[y];q?s.subMaterials.push(l.getLastMaterialByID(q)):s.subMaterials.push(null)}return s},E}(r.a);i.a.RegisteredTypes["BABYLON.MultiMaterial"]=G},function(Ja,t,o){"use strict";o.d(t,"a",function(){return y});var R=o(1),r=o(6),I=o(0),i=o(43),G=o(59),D=o(62),E=o(56),x=o(41),l=o(32),s=o(10),y=function(q){function n(k,p,u,A){void 0===p&&(p=s.a.Gray()),void 0===u&&(u=x.a.DefaultUtilityLayer),void 0===A&&(A=null);var B=q.call(this,u)||this;B._pointerObserver=null,B.snapDistance=0,B.onSnapObservable=new r.c(),B._isEnabled=!0,B._parent=null,B._parent=A,B._coloredMaterial=new l.a("",u.utilityLayerScene),B._coloredMaterial.diffuseColor=p,B._coloredMaterial.specularColor=p.subtract(new s.a(.1,.1,.1)),B._hoverMaterial=new l.a("",u.utilityLayerScene),B._hoverMaterial.diffuseColor=p.add(new s.a(.3,.3,.3)),B._arrow=n._CreateArrow(u.utilityLayerScene,B._coloredMaterial),B._arrow.lookAt(B._rootMesh.position.add(k)),B._arrow.scaling.scaleInPlace(1/3),B._arrow.parent=B._rootMesh;var v=0,H=new I.e(),L={snapDistance:0};B.dragBehavior=new D.a({dragAxis:k}),B.dragBehavior.moveAttached=!1,B._rootMesh.addBehavior(B.dragBehavior);var Q=new I.e(),M=new I.a();B.dragBehavior.onDragObservable.add(function(X){if(B.attachedMesh){if(B.attachedMesh.parent?(B.attachedMesh.parent.computeWorldMatrix().invertToRef(M),M.setTranslationFromFloats(0,0,0),I.e.TransformCoordinatesToRef(X.delta,M,Q)):Q.copyFrom(X.delta),0==B.snapDistance)B.attachedMesh.position.addInPlace(Q);else if(v+=X.dragDistance,Math.abs(v)>B.snapDistance){var U=Math.floor(Math.abs(v)/B.snapDistance);v%=B.snapDistance,Q.normalizeToRef(H),H.scaleInPlace(B.snapDistance*U),B.attachedMesh.position.addInPlace(H),L.snapDistance=B.snapDistance*U,B.onSnapObservable.notifyObservers(L)}}}),B._pointerObserver=u.utilityLayerScene.onPointerObservable.add(function(X){if(!B._customMeshSet){var U=X.pickInfo&&-1!=B._rootMesh.getChildMeshes().indexOf(X.pickInfo.pickedMesh)?B._hoverMaterial:B._coloredMaterial;B._rootMesh.getChildMeshes().forEach(function(P){P.material=U,P.color&&(P.color=U.diffuseColor)})}});var Y=u._getSharedGizmoLight();return Y.includedOnlyMeshes=Y.includedOnlyMeshes.concat(B._rootMesh.getChildMeshes(!1)),B}return Object(R.d)(n,q),n._CreateArrow=function(k,p){var u=new i.a("arrow",k),A=G.a.CreateCylinder("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375,tessellation:96},k),B=G.a.CreateCylinder("cylinder",{diameterTop:.005,height:.275,diameterBottom:.005,tessellation:96},k);return B.material=p,A.parent=u,B.parent=u,A.material=p,A.rotation.x=Math.PI/2,A.position.z+=.3,B.position.z+=.1375,B.rotation.x=Math.PI/2,u},n._CreateArrowInstance=function(k,p){for(var u=new i.a("arrow",k),A=0,B=p.getChildMeshes();A<B.length;A++){var v=B[A];v.createInstance(v.name).parent=u}return u},n.prototype._attachedMeshChanged=function(k){this.dragBehavior&&(this.dragBehavior.enabled=!!k)},Object.defineProperty(n.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(k){this._isEnabled=k,k?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._arrow&&this._arrow.dispose(),[this._coloredMaterial,this._hoverMaterial].forEach(function(k){k&&k.dispose()}),q.prototype.dispose.call(this)},n}(E.a)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),r.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},r.prototype.markAsUnprocessed=function(){this._isDirty=!0},r.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},r.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},r.prototype.markAsLightDirty=function(I){void 0===I&&(I=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||I,this._isDirty=!0},r.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},r.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},r.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},r.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},r.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var I=0,i=Object.keys(this);I<i.length;I++){var G=i[I];"_"!==G[0]&&this._keys.push(G)}},r.prototype.isEqual=function(I){if(this._keys.length!==I._keys.length)return!1;for(var i=0;i<this._keys.length;i++){var G=this._keys[i];if(this[G]!==I[G])return!1}return!0},r.prototype.cloneTo=function(I){this._keys.length!==I._keys.length&&(I._keys=this._keys.slice(0));for(var i=0;i<this._keys.length;i++){var G=this._keys[i];I[G]=this[G]}},r.prototype.reset=function(){for(var I=0;I<this._keys.length;I++){var i=this._keys[I];switch(typeof this[i]){case"number":this[i]=0;break;case"string":this[i]="";break;default:this[i]=!1}}},r.prototype.toString=function(){for(var I="",i=0;i<this._keys.length;i++){var G=this._keys[i],D=this[G];switch(typeof D){case"number":case"string":I+="#define "+G+" "+D+`
`;break;default:D&&(I+="#define "+G+`
`)}}return I},r}()},function(Ja,t,o){"use strict";var R="bonesDeclaration",r=`#if NUM_BONE_INFLUENCERS>0
#ifdef BONETEXTURE
uniform sampler2D boneSampler;
uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#endif
attribute vec4 matricesIndices;
attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;
attribute vec4 matricesWeightsExtra;
#endif
#ifdef BONETEXTURE
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{
float offset=index*4.0;
float dx=1.0/boneTextureWidth;
vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));
vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));
vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));
vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));
return mat4(m0,m1,m2,m3);
}
#endif
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R=`#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif`;o(8).a.IncludesShadersStore.bonesVertex=R},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.FilesToLoad={},r}()},function(Ja,t,o){"use strict";var R="instancesDeclaration",r=`#ifdef INSTANCES
attribute vec4 world0;
attribute vec4 world1;
attribute vec4 world2;
attribute vec4 world3;
#else
uniform mat4 world;
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="instancesVertex",r=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#else
mat4 finalWorld=world;
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";o.d(t,"a",function(){return I});var R=o(5),r=o(15);r.a.CreatePlane=function(i){var G=[],D=[],E=[],x=[],l=i.width||i.size||1,s=i.height||i.size||1,y=0===i.sideOrientation?0:i.sideOrientation||r.a.DEFAULTSIDE,q=l/2,n=s/2;D.push(-q,-n,0),E.push(0,0,-1),x.push(0,0),D.push(q,-n,0),E.push(0,0,-1),x.push(1,0),D.push(q,n,0),E.push(0,0,-1),x.push(1,1),D.push(-q,n,0),E.push(0,0,-1),x.push(0,1),G.push(0),G.push(1),G.push(2),G.push(0),G.push(2),G.push(3),r.a._ComputeSides(y,D,G,E,x,i.frontUVs,i.backUVs);var k=new r.a();return k.indices=G,k.positions=D,k.normals=E,k.uvs=x,k},R.a.CreatePlane=function(i,G,D,E,x){var l={size:G,width:G,height:G,sideOrientation:x,updatable:E};return I.CreatePlane(i,l,D)};var I=function(){function i(){}return i.CreatePlane=function(G,D,E){void 0===E&&(E=null);var x=new R.a(G,E);return D.sideOrientation=R.a._GetDefaultSideOrientation(D.sideOrientation),x._originalBuilderSideOrientation=D.sideOrientation,r.a.CreatePlane(D).applyToMesh(x,D.updatable),D.sourcePlane&&(x.translate(D.sourcePlane.normal,-D.sourcePlane.d),x.setDirection(D.sourcePlane.normal.scale(-1))),x},i}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return E});var R=o(1),r=o(3),I=o(0),i=o(10),G=o(26),D=o(50);G.a.AddNodeConstructor("Light_Type_3",function(x,l){return function(){return new E(x,I.e.Zero(),l)}});var E=function(x){function l(s,y,q){var n=x.call(this,s,q)||this;return n.groundColor=new i.a(0,0,0),n.direction=y||I.e.Up(),n}return Object(R.d)(l,x),l.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},l.prototype.getClassName=function(){return"HemisphericLight"},l.prototype.setDirectionToTarget=function(s){return this.direction=I.e.Normalize(s.subtract(I.e.Zero())),this.direction},l.prototype.getShadowGenerator=function(){return null},l.prototype.transferToEffect=function(s,y){var q=I.e.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",q.x,q.y,q.z,0,y),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),y),this},l.prototype.transferToNodeMaterialEffect=function(s,y){var q=I.e.Normalize(this.direction);return s.setFloat3(y,q.x,q.y,q.z),this},l.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=I.a.Identity()),this._worldMatrix},l.prototype.getTypeID=function(){return D.a.LIGHTTYPEID_HEMISPHERICLIGHT},l.prototype.prepareLightSpecificDefines=function(s,y){s["HEMILIGHT"+y]=!0},Object(R.c)([Object(r.e)()],l.prototype,"groundColor",void 0),Object(R.c)([Object(r.o)()],l.prototype,"direction",void 0),l}(D.a)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return I});var R=o(1),r=o(0),I=function(i){function G(D,E){var x=i.call(this,D,E)||this;return x._normalMatrix=new r.a(),x.allowShaderHotSwapping=!0,x._storeEffectOnSubMeshes=!0,x}return Object(R.d)(G,i),G.prototype.getEffect=function(){return this._activeEffect},G.prototype.isReady=function(D,E){return!!D&&(!D.subMeshes||0===D.subMeshes.length||this.isReadyForSubMesh(D,D.subMeshes[0],E))},G.prototype.bindOnlyWorldMatrix=function(D){this._activeEffect.setMatrix("world",D)},G.prototype.bindOnlyNormalMatrix=function(D){this._activeEffect.setMatrix("normalMatrix",D)},G.prototype.bind=function(D,E){E&&this.bindForSubMesh(D,E,E.subMeshes[0])},G.prototype._afterBind=function(D,E){void 0===E&&(E=null),i.prototype._afterBind.call(this,D),this.getScene()._cachedEffect=E},G.prototype._mustRebind=function(D,E,x){return void 0===x&&(x=1),D.isCachedMaterialInvalid(this,E,x)},G}(o(29).a)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return y});var R=o(1),r=o(3),I=o(0),i=o(4),G=o(9),D=o(16),E=o(29),x=o(12),l=o(10),s=o(64),y=function(q){function n(k,p,u,A){void 0===A&&(A={});var B=q.call(this,k,p)||this;return B._textures={},B._textureArrays={},B._floats={},B._ints={},B._floatsArrays={},B._colors3={},B._colors3Arrays={},B._colors4={},B._colors4Arrays={},B._vectors2={},B._vectors3={},B._vectors4={},B._matrices={},B._matrixArrays={},B._matrices3x3={},B._matrices2x2={},B._vectors2Arrays={},B._vectors3Arrays={},B._vectors4Arrays={},B._cachedWorldViewMatrix=new I.a(),B._cachedWorldViewProjectionMatrix=new I.a(),B._multiview=!1,B._shaderPath=u,B._options=Object(R.a)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},A),B}return Object(R.d)(n,q),Object.defineProperty(n.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(k){this._shaderPath=k},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),n.prototype.getClassName=function(){return"ShaderMaterial"},n.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},n.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},n.prototype._checkUniform=function(k){-1===this._options.uniforms.indexOf(k)&&this._options.uniforms.push(k)},n.prototype.setTexture=function(k,p){return-1===this._options.samplers.indexOf(k)&&this._options.samplers.push(k),this._textures[k]=p,this},n.prototype.setTextureArray=function(k,p){return-1===this._options.samplers.indexOf(k)&&this._options.samplers.push(k),this._checkUniform(k),this._textureArrays[k]=p,this},n.prototype.setFloat=function(k,p){return this._checkUniform(k),this._floats[k]=p,this},n.prototype.setInt=function(k,p){return this._checkUniform(k),this._ints[k]=p,this},n.prototype.setFloats=function(k,p){return this._checkUniform(k),this._floatsArrays[k]=p,this},n.prototype.setColor3=function(k,p){return this._checkUniform(k),this._colors3[k]=p,this},n.prototype.setColor3Array=function(k,p){return this._checkUniform(k),this._colors3Arrays[k]=p.reduce(function(u,A){return A.toArray(u,u.length),u},[]),this},n.prototype.setColor4=function(k,p){return this._checkUniform(k),this._colors4[k]=p,this},n.prototype.setColor4Array=function(k,p){return this._checkUniform(k),this._colors4Arrays[k]=p.reduce(function(u,A){return A.toArray(u,u.length),u},[]),this},n.prototype.setVector2=function(k,p){return this._checkUniform(k),this._vectors2[k]=p,this},n.prototype.setVector3=function(k,p){return this._checkUniform(k),this._vectors3[k]=p,this},n.prototype.setVector4=function(k,p){return this._checkUniform(k),this._vectors4[k]=p,this},n.prototype.setMatrix=function(k,p){return this._checkUniform(k),this._matrices[k]=p,this},n.prototype.setMatrices=function(k,p){this._checkUniform(k);for(var u=new Float32Array(16*p.length),A=0;A<p.length;A++)p[A].copyToArray(u,16*A);return this._matrixArrays[k]=u,this},n.prototype.setMatrix3x3=function(k,p){return this._checkUniform(k),this._matrices3x3[k]=p,this},n.prototype.setMatrix2x2=function(k,p){return this._checkUniform(k),this._matrices2x2[k]=p,this},n.prototype.setArray2=function(k,p){return this._checkUniform(k),this._vectors2Arrays[k]=p,this},n.prototype.setArray3=function(k,p){return this._checkUniform(k),this._vectors3Arrays[k]=p,this},n.prototype.setArray4=function(k,p){return this._checkUniform(k),this._vectors4Arrays[k]=p,this},n.prototype._checkCache=function(k,p){return!k||(!this._effect||-1!==this._effect.defines.indexOf("#define INSTANCES")===p)},n.prototype.isReadyForSubMesh=function(k,p,u){return this.isReady(k,u)},n.prototype.isReady=function(k,p){if(this._effect&&this.isFrozen&&this._effect._wasPreviouslyReady)return!0;var u=this.getScene(),A=u.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===u.getRenderId()&&this._checkCache(k,p))return!0;var B=[],v=[],H=new s.a();A.getCaps().multiview&&u.activeCamera&&u.activeCamera.outputRenderTarget&&u.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,B.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.push("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(var L=0;L<this._options.defines.length;L++)B.push(this._options.defines[L]);for(L=0;L<this._options.attributes.length;L++)v.push(this._options.attributes[L]);if(k&&k.isVerticesDataPresent(i.b.ColorKind)&&(v.push(i.b.ColorKind),B.push("#define VERTEXCOLOR")),p&&(B.push("#define INSTANCES"),D.a.PushAttributesForInstances(v)),k&&k.useBones&&k.computeBonesUsingShaders&&k.skeleton){v.push(i.b.MatricesIndicesKind),v.push(i.b.MatricesWeightsKind),k.numBoneInfluencers>4&&(v.push(i.b.MatricesIndicesExtraKind),v.push(i.b.MatricesWeightsExtraKind));var Q=k.skeleton;B.push("#define NUM_BONE_INFLUENCERS "+k.numBoneInfluencers),H.addCPUSkinningFallback(0,k),Q.isUsingTextureForMatrices?(B.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(B.push("#define BonesPerMesh "+(Q.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else B.push("#define NUM_BONE_INFLUENCERS 0");for(var M in this._textures)if(!this._textures[M].isReady())return!1;k&&this._shouldTurnAlphaTestOn(k)&&B.push("#define ALPHATEST");var Y=this._effect,X=B.join(`
`);return this._effect=A.createEffect(this._shaderPath,{attributes:v,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:X,fallbacks:H,onCompiled:this.onCompiled,onError:this.onError},A),!!this._effect.isReady()&&(Y!==this._effect&&u.resetCachedMaterial(),this._renderId=u.getRenderId(),this._effect._wasPreviouslyReady=!0,!0)},n.prototype.bindOnlyWorldMatrix=function(k){var p=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",k),-1!==this._options.uniforms.indexOf("worldView")&&(k.multiplyToRef(p.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(k.multiplyToRef(p.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),this._effect.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},n.prototype.bind=function(k,p){if(this.bindOnlyWorldMatrix(k),this._effect&&this.getScene().getCachedMaterial()!==this){var u;for(u in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&(this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&this._effect.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&this._effect.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),D.a.BindBonesParameters(p,this._effect),this._textures)this._effect.setTexture(u,this._textures[u]);for(u in this._textureArrays)this._effect.setTextureArray(u,this._textureArrays[u]);for(u in this._ints)this._effect.setInt(u,this._ints[u]);for(u in this._floats)this._effect.setFloat(u,this._floats[u]);for(u in this._floatsArrays)this._effect.setArray(u,this._floatsArrays[u]);for(u in this._colors3)this._effect.setColor3(u,this._colors3[u]);for(u in this._colors3Arrays)this._effect.setArray3(u,this._colors3Arrays[u]);for(u in this._colors4){var A=this._colors4[u];this._effect.setFloat4(u,A.r,A.g,A.b,A.a)}for(u in this._colors4Arrays)this._effect.setArray4(u,this._colors4Arrays[u]);for(u in this._vectors2)this._effect.setVector2(u,this._vectors2[u]);for(u in this._vectors3)this._effect.setVector3(u,this._vectors3[u]);for(u in this._vectors4)this._effect.setVector4(u,this._vectors4[u]);for(u in this._matrices)this._effect.setMatrix(u,this._matrices[u]);for(u in this._matrixArrays)this._effect.setMatrices(u,this._matrixArrays[u]);for(u in this._matrices3x3)this._effect.setMatrix3x3(u,this._matrices3x3[u]);for(u in this._matrices2x2)this._effect.setMatrix2x2(u,this._matrices2x2[u]);for(u in this._vectors2Arrays)this._effect.setArray2(u,this._vectors2Arrays[u]);for(u in this._vectors3Arrays)this._effect.setArray3(u,this._vectors3Arrays[u]);for(u in this._vectors4Arrays)this._effect.setArray4(u,this._vectors4Arrays[u])}this._afterBind(p)},n.prototype.getActiveTextures=function(){var k=q.prototype.getActiveTextures.call(this);for(var p in this._textures)k.push(this._textures[p]);for(var p in this._textureArrays)for(var u=this._textureArrays[p],A=0;A<u.length;A++)k.push(u[A]);return k},n.prototype.hasTexture=function(k){if(q.prototype.hasTexture.call(this,k))return!0;for(var p in this._textures)if(this._textures[p]===k)return!0;for(var p in this._textureArrays)for(var u=this._textureArrays[p],A=0;A<u.length;A++)if(u[A]===k)return!0;return!1},n.prototype.clone=function(k){var p=this,u=r.a.Clone(function(){return new n(k,p.getScene(),p._shaderPath,p._options)},this);for(var A in u.name=k,u.id=k,"object"==typeof u._shaderPath&&(u._shaderPath=Object(R.a)({},u._shaderPath)),this._options=Object(R.a)({},this._options),Object.keys(this._options).forEach(function(B){var v=p._options[B];Array.isArray(v)&&(p._options[B]=v.slice(0))}),this._textures)u.setTexture(A,this._textures[A]);for(var A in this._floats)u.setFloat(A,this._floats[A]);for(var A in this._floatsArrays)u.setFloats(A,this._floatsArrays[A]);for(var A in this._colors3)u.setColor3(A,this._colors3[A]);for(var A in this._colors4)u.setColor4(A,this._colors4[A]);for(var A in this._vectors2)u.setVector2(A,this._vectors2[A]);for(var A in this._vectors3)u.setVector3(A,this._vectors3[A]);for(var A in this._vectors4)u.setVector4(A,this._vectors4[A]);for(var A in this._matrices)u.setMatrix(A,this._matrices[A]);for(var A in this._matrices3x3)u.setMatrix3x3(A,this._matrices3x3[A]);for(var A in this._matrices2x2)u.setMatrix2x2(A,this._matrices2x2[A]);return u},n.prototype.dispose=function(k,p,u){if(p){var A;for(A in this._textures)this._textures[A].dispose();for(A in this._textureArrays)for(var B=this._textureArrays[A],v=0;v<B.length;v++)B[v].dispose()}this._textures={},q.prototype.dispose.call(this,k,p,u)},n.prototype.serialize=function(){var k,p=r.a.Serialize(this);for(k in p.customType="BABYLON.ShaderMaterial",p.options=this._options,p.shaderPath=this._shaderPath,p.textures={},this._textures)p.textures[k]=this._textures[k].serialize();for(k in p.textureArrays={},this._textureArrays){p.textureArrays[k]=[];for(var u=this._textureArrays[k],A=0;A<u.length;A++)p.textureArrays[k].push(u[A].serialize())}for(k in p.floats={},this._floats)p.floats[k]=this._floats[k];for(k in p.FloatArrays={},this._floatsArrays)p.FloatArrays[k]=this._floatsArrays[k];for(k in p.colors3={},this._colors3)p.colors3[k]=this._colors3[k].asArray();for(k in p.colors3Arrays={},this._colors3Arrays)p.colors3Arrays[k]=this._colors3Arrays[k];for(k in p.colors4={},this._colors4)p.colors4[k]=this._colors4[k].asArray();for(k in p.colors4Arrays={},this._colors4Arrays)p.colors4Arrays[k]=this._colors4Arrays[k];for(k in p.vectors2={},this._vectors2)p.vectors2[k]=this._vectors2[k].asArray();for(k in p.vectors3={},this._vectors3)p.vectors3[k]=this._vectors3[k].asArray();for(k in p.vectors4={},this._vectors4)p.vectors4[k]=this._vectors4[k].asArray();for(k in p.matrices={},this._matrices)p.matrices[k]=this._matrices[k].asArray();for(k in p.matrixArray={},this._matrixArrays)p.matrixArray[k]=this._matrixArrays[k];for(k in p.matrices3x3={},this._matrices3x3)p.matrices3x3[k]=this._matrices3x3[k];for(k in p.matrices2x2={},this._matrices2x2)p.matrices2x2[k]=this._matrices2x2[k];for(k in p.vectors2Arrays={},this._vectors2Arrays)p.vectors2Arrays[k]=this._vectors2Arrays[k];for(k in p.vectors3Arrays={},this._vectors3Arrays)p.vectors3Arrays[k]=this._vectors3Arrays[k];for(k in p.vectors4Arrays={},this._vectors4Arrays)p.vectors4Arrays[k]=this._vectors4Arrays[k];return p},n.Parse=function(k,p,u){var A,B=r.a.Parse(function(){return new n(k.name,p,k.shaderPath,k.options)},k,p,u);for(A in k.textures)B.setTexture(A,G.a.Parse(k.textures[A],p,u));for(A in k.textureArrays){for(var v=k.textureArrays[A],H=new Array(),L=0;L<v.length;L++)H.push(G.a.Parse(v[L],p,u));B.setTextureArray(A,H)}for(A in k.floats)B.setFloat(A,k.floats[A]);for(A in k.floatsArrays)B.setFloats(A,k.floatsArrays[A]);for(A in k.colors3)B.setColor3(A,l.a.FromArray(k.colors3[A]));for(A in k.colors3Arrays){var Q=k.colors3Arrays[A].reduce(function(M,Y,X){return X%3==0?M.push([Y]):M[M.length-1].push(Y),M},[]).map(function(M){return l.a.FromArray(M)});B.setColor3Array(A,Q)}for(A in k.colors4)B.setColor4(A,l.b.FromArray(k.colors4[A]));for(A in k.colors4Arrays)Q=k.colors4Arrays[A].reduce(function(M,Y,X){return X%4==0?M.push([Y]):M[M.length-1].push(Y),M},[]).map(function(M){return l.b.FromArray(M)}),B.setColor4Array(A,Q);for(A in k.vectors2)B.setVector2(A,I.d.FromArray(k.vectors2[A]));for(A in k.vectors3)B.setVector3(A,I.e.FromArray(k.vectors3[A]));for(A in k.vectors4)B.setVector4(A,I.f.FromArray(k.vectors4[A]));for(A in k.matrices)B.setMatrix(A,I.a.FromArray(k.matrices[A]));for(A in k.matrixArray)B._matrixArrays[A]=new Float32Array(k.matrixArray[A]);for(A in k.matrices3x3)B.setMatrix3x3(A,k.matrices3x3[A]);for(A in k.matrices2x2)B.setMatrix2x2(A,k.matrices2x2[A]);for(A in k.vectors2Arrays)B.setArray2(A,k.vectors2Arrays[A]);for(A in k.vectors3Arrays)B.setArray3(A,k.vectors3Arrays[A]);for(A in k.vectors4Arrays)B.setArray4(A,k.vectors4Arrays[A]);return B},n}(E.a);x.a.RegisteredTypes["BABYLON.ShaderMaterial"]=y},function(Ja,t,o){"use strict";var R=o(7),r=o(31),I=o(84);r.a.prototype.createUniformBuffer=function(G){var D=this._gl.createBuffer();if(!D)throw new Error("Unable to create uniform buffer");var E=new I.a(D);return this.bindUniformBuffer(E),G instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,G,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(G),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),E.references=1,E},r.a.prototype.createDynamicUniformBuffer=function(G){var D=this._gl.createBuffer();if(!D)throw new Error("Unable to create dynamic uniform buffer");var E=new I.a(D);return this.bindUniformBuffer(E),G instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,G,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(G),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),E.references=1,E},r.a.prototype.updateUniformBuffer=function(G,D,E,x){this.bindUniformBuffer(G),void 0===E&&(E=0),void 0===x?D instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,E,D):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,E,new Float32Array(D)):D instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,D.subarray(E,E+x)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(D).subarray(E,E+x)),this.bindUniformBuffer(null)},r.a.prototype.bindUniformBuffer=function(G){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,G?G.underlyingResource:null)},r.a.prototype.bindUniformBufferBase=function(G,D){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,D,G?G.underlyingResource:null)},r.a.prototype.bindUniformBlock=function(G,D,E){var x=G.program,l=this._gl.getUniformBlockIndex(x,D);this._gl.uniformBlockBinding(x,l,E)},o.d(t,"a",function(){return i});var i=function(){function G(D,E,x){this._alreadyBound=!1,this._valueCache={},this._engine=D,this._noUBO=!D.supportsUniformBuffers,this._dynamic=x,this._data=E||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(G.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),G.prototype.isDynamic=function(){return void 0!==this._dynamic},G.prototype.getData=function(){return this._bufferData},G.prototype.getBuffer=function(){return this._buffer},G.prototype._fillAlignment=function(D){var E;if(E=D<=2?D:4,this._uniformLocationPointer%E!=0){var x=this._uniformLocationPointer;this._uniformLocationPointer+=E-this._uniformLocationPointer%E;for(var l=this._uniformLocationPointer-x,s=0;s<l;s++)this._data.push(0)}},G.prototype.addUniform=function(D,E){if(!this._noUBO&&void 0===this._uniformLocations[D]){var x;if(E instanceof Array)E=(x=E).length;else{E=E,x=[];for(var l=0;l<E;l++)x.push(0)}for(this._fillAlignment(E),this._uniformSizes[D]=E,this._uniformLocations[D]=this._uniformLocationPointer,this._uniformLocationPointer+=E,l=0;l<E;l++)this._data.push(x[l]);this._needSync=!0}},G.prototype.addMatrix=function(D,E){this.addUniform(D,Array.prototype.slice.call(E.toArray()))},G.prototype.addFloat2=function(D,E,x){var l=[E,x];this.addUniform(D,l)},G.prototype.addFloat3=function(D,E,x,l){var s=[E,x,l];this.addUniform(D,s)},G.prototype.addColor3=function(D,E){var x=new Array();E.toArray(x),this.addUniform(D,x)},G.prototype.addColor4=function(D,E,x){var l=new Array();E.toArray(l),l.push(x),this.addUniform(D,l)},G.prototype.addVector3=function(D,E){var x=new Array();E.toArray(x),this.addUniform(D,x)},G.prototype.addMatrix3x3=function(D){this.addUniform(D,12)},G.prototype.addMatrix2x2=function(D){this.addUniform(D,8)},G.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},G.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},G.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},G.prototype.updateUniform=function(D,E,x){var l=this._uniformLocations[D];if(void 0===l){if(this._buffer)return void R.a.Error("Cannot add an uniform after UBO has been created.");this.addUniform(D,x),l=this._uniformLocations[D]}if(this._buffer||this.create(),this._dynamic)for(y=0;y<x;y++)this._bufferData[l+y]=E[y];else{for(var s=!1,y=0;y<x;y++)16!==x&&this._bufferData[l+y]===E[y]||(s=!0,this._bufferData[l+y]=E[y]);this._needSync=this._needSync||s}},G.prototype._cacheMatrix=function(D,E){var x=this._valueCache[D],l=E.updateFlag;return(void 0===x||x!==l)&&(this._valueCache[D]=l,!0)},G.prototype._updateMatrix3x3ForUniform=function(D,E){for(var x=0;x<3;x++)G._tempBuffer[4*x]=E[3*x],G._tempBuffer[4*x+1]=E[3*x+1],G._tempBuffer[4*x+2]=E[3*x+2],G._tempBuffer[4*x+3]=0;this.updateUniform(D,G._tempBuffer,12)},G.prototype._updateMatrix3x3ForEffect=function(D,E){this._currentEffect.setMatrix3x3(D,E)},G.prototype._updateMatrix2x2ForEffect=function(D,E){this._currentEffect.setMatrix2x2(D,E)},G.prototype._updateMatrix2x2ForUniform=function(D,E){for(var x=0;x<2;x++)G._tempBuffer[4*x]=E[2*x],G._tempBuffer[4*x+1]=E[2*x+1],G._tempBuffer[4*x+2]=0,G._tempBuffer[4*x+3]=0;this.updateUniform(D,G._tempBuffer,8)},G.prototype._updateFloatForEffect=function(D,E){this._currentEffect.setFloat(D,E)},G.prototype._updateFloatForUniform=function(D,E){G._tempBuffer[0]=E,this.updateUniform(D,G._tempBuffer,1)},G.prototype._updateFloat2ForEffect=function(D,E,x,l){void 0===l&&(l=""),this._currentEffect.setFloat2(D+l,E,x)},G.prototype._updateFloat2ForUniform=function(D,E,x){G._tempBuffer[0]=E,G._tempBuffer[1]=x,this.updateUniform(D,G._tempBuffer,2)},G.prototype._updateFloat3ForEffect=function(D,E,x,l,s){void 0===s&&(s=""),this._currentEffect.setFloat3(D+s,E,x,l)},G.prototype._updateFloat3ForUniform=function(D,E,x,l){G._tempBuffer[0]=E,G._tempBuffer[1]=x,G._tempBuffer[2]=l,this.updateUniform(D,G._tempBuffer,3)},G.prototype._updateFloat4ForEffect=function(D,E,x,l,s,y){void 0===y&&(y=""),this._currentEffect.setFloat4(D+y,E,x,l,s)},G.prototype._updateFloat4ForUniform=function(D,E,x,l,s){G._tempBuffer[0]=E,G._tempBuffer[1]=x,G._tempBuffer[2]=l,G._tempBuffer[3]=s,this.updateUniform(D,G._tempBuffer,4)},G.prototype._updateMatrixForEffect=function(D,E){this._currentEffect.setMatrix(D,E)},G.prototype._updateMatrixForUniform=function(D,E){this._cacheMatrix(D,E)&&this.updateUniform(D,E.toArray(),16)},G.prototype._updateVector3ForEffect=function(D,E){this._currentEffect.setVector3(D,E)},G.prototype._updateVector3ForUniform=function(D,E){E.toArray(G._tempBuffer),this.updateUniform(D,G._tempBuffer,3)},G.prototype._updateVector4ForEffect=function(D,E){this._currentEffect.setVector4(D,E)},G.prototype._updateVector4ForUniform=function(D,E){E.toArray(G._tempBuffer),this.updateUniform(D,G._tempBuffer,4)},G.prototype._updateColor3ForEffect=function(D,E,x){void 0===x&&(x=""),this._currentEffect.setColor3(D+x,E)},G.prototype._updateColor3ForUniform=function(D,E){E.toArray(G._tempBuffer),this.updateUniform(D,G._tempBuffer,3)},G.prototype._updateColor4ForEffect=function(D,E,x,l){void 0===l&&(l=""),this._currentEffect.setColor4(D+l,E,x)},G.prototype._updateColor4ForUniform=function(D,E,x){E.toArray(G._tempBuffer),G._tempBuffer[3]=x,this.updateUniform(D,G._tempBuffer,4)},G.prototype.setTexture=function(D,E){this._currentEffect.setTexture(D,E)},G.prototype.updateUniformDirectly=function(D,E){this.updateUniform(D,E,E.length),this.update()},G.prototype.bindToEffect=function(D,E){this._currentEffect=D,!this._noUBO&&this._buffer&&(this._alreadyBound=!0,D.bindUniformBuffer(this._buffer,E))},G.prototype.dispose=function(){if(!this._noUBO){var D=this._engine._uniformBuffers,E=D.indexOf(this);-1!==E&&(D[E]=D[D.length-1],D.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},G._MAX_UNIFORM_SIZE=256,G._tempBuffer=new Float32Array(G._MAX_UNIFORM_SIZE),G}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(1),r=function(I){function i(G){var D=I.call(this)||this;return D._buffer=G,D}return Object(R.d)(i,I),Object.defineProperty(i.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),i}(o(85).a)},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(r.prototype,"underlyingResource",{get:function(){return null},enumerable:!0,configurable:!0}),r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(60),r=function(){function I(){}return I.GetPlanes=function(i){for(var G=[],D=0;D<6;D++)G.push(new R.a(0,0,0,0));return I.GetPlanesToRef(i,G),G},I.GetNearPlaneToRef=function(i,G){var D=i.m;G.normal.x=D[3]+D[2],G.normal.y=D[7]+D[6],G.normal.z=D[11]+D[10],G.d=D[15]+D[14],G.normalize()},I.GetFarPlaneToRef=function(i,G){var D=i.m;G.normal.x=D[3]-D[2],G.normal.y=D[7]-D[6],G.normal.z=D[11]-D[10],G.d=D[15]-D[14],G.normalize()},I.GetLeftPlaneToRef=function(i,G){var D=i.m;G.normal.x=D[3]+D[0],G.normal.y=D[7]+D[4],G.normal.z=D[11]+D[8],G.d=D[15]+D[12],G.normalize()},I.GetRightPlaneToRef=function(i,G){var D=i.m;G.normal.x=D[3]-D[0],G.normal.y=D[7]-D[4],G.normal.z=D[11]-D[8],G.d=D[15]-D[12],G.normalize()},I.GetTopPlaneToRef=function(i,G){var D=i.m;G.normal.x=D[3]-D[1],G.normal.y=D[7]-D[5],G.normal.z=D[11]-D[9],G.d=D[15]-D[13],G.normalize()},I.GetBottomPlaneToRef=function(i,G){var D=i.m;G.normal.x=D[3]+D[1],G.normal.y=D[7]+D[5],G.normal.z=D[11]+D[9],G.d=D[15]+D[13],G.normalize()},I.GetPlanesToRef=function(i,G){I.GetNearPlaneToRef(i,G[0]),I.GetFarPlaneToRef(i,G[1]),I.GetLeftPlaneToRef(i,G[2]),I.GetRightPlaneToRef(i,G[3]),I.GetTopPlaneToRef(i,G[4]),I.GetBottomPlaneToRef(i,G[5])},I}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(2),r=function(){function I(){this.hoverCursor="",this.actions=new Array(),this.isRecursive=!1}return Object.defineProperty(I,"HasTriggers",{get:function(){for(var i in I.Triggers)if(I.Triggers.hasOwnProperty(i))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(I,"HasPickTriggers",{get:function(){for(var i in I.Triggers)if(I.Triggers.hasOwnProperty(i)){var G=parseInt(i);if(G>=R.a.ACTION_OnPickTrigger&&G<=R.a.ACTION_OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),I.HasSpecificTrigger=function(i){for(var G in I.Triggers)if(I.Triggers.hasOwnProperty(G)){if(parseInt(G)===i)return!0}return!1},I.Triggers={},I}()},function(Ja,t,o){"use strict";var R="morphTargetsVertexGlobalDeclaration",r=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="morphTargetsVertexDeclaration",r=`#ifdef MORPHTARGETS
attribute vec3 position{X};
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#ifdef MORPHTARGETS_UV
attribute vec2 uv_{X};
#endif
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";o.d(t,"a",function(){return i});var R=o(29),r=o(4),I=o(2),i=function(){function G(D){this._vertexBuffers={},this._scene=D}return G.prototype._prepareBuffers=function(){if(!this._vertexBuffers[r.b.PositionKind]){var D=[];D.push(1,1),D.push(-1,1),D.push(-1,-1),D.push(1,-1),this._vertexBuffers[r.b.PositionKind]=new r.b(this._scene.getEngine(),D,r.b.PositionKind,!1,!1,2),this._buildIndexBuffer()}},G.prototype._buildIndexBuffer=function(){var D=[];D.push(0),D.push(1),D.push(2),D.push(0),D.push(2),D.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(D)},G.prototype._rebuild=function(){var D=this._vertexBuffers[r.b.PositionKind];D&&(D._rebuild(),this._buildIndexBuffer())},G.prototype._prepareFrame=function(D,E){void 0===D&&(D=null),void 0===E&&(E=null);var x=this._scene.activeCamera;return!!x&&(!(!(E=E||x._postProcesses.filter(function(l){return null!=l}))||0===E.length||!this._scene.postProcessesEnabled)&&(E[0].activate(x,D,null!=E),!0))},G.prototype.directRender=function(D,E,x,l,s){void 0===E&&(E=null),void 0===x&&(x=!1),void 0===l&&(l=0),void 0===s&&(s=0);for(var y=this._scene.getEngine(),q=0;q<D.length;q++){q<D.length-1?D[q+1].activate(this._scene.activeCamera,E):E?y.bindFramebuffer(E,l,void 0,void 0,x,s):y.restoreDefaultFramebuffer();var n=D[q],k=n.apply();k&&(n.onBeforeRenderObservable.notifyObservers(k),this._prepareBuffers(),y.bindBuffers(this._vertexBuffers,this._indexBuffer,k),y.drawElementsType(R.a.TriangleFillMode,0,6),n.onAfterRenderObservable.notifyObservers(k))}y.setDepthBuffer(!0),y.setDepthWrite(!0)},G.prototype._finalizeFrame=function(D,E,x,l,s){void 0===s&&(s=!1);var y=this._scene.activeCamera;if(y&&0!==(l=l||y._postProcesses.filter(function(A){return null!=A})).length&&this._scene.postProcessesEnabled){for(var q=this._scene.getEngine(),n=0,k=l.length;n<k;n++){var p=l[n];if(n<k-1?p._outputTexture=l[n+1].activate(y,E):E?(q.bindFramebuffer(E,x,void 0,void 0,s),p._outputTexture=E):(q.restoreDefaultFramebuffer(),p._outputTexture=null),D)break;var u=p.apply();u&&(p.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),q.bindBuffers(this._vertexBuffers,this._indexBuffer,u),q.drawElementsType(R.a.TriangleFillMode,0,6),p.onAfterRenderObservable.notifyObservers(u))}q.setDepthBuffer(!0),q.setDepthWrite(!0),q.setAlphaMode(I.a.ALPHA_DISABLE)}},G.prototype.dispose=function(){var D=this._vertexBuffers[r.b.PositionKind];D&&(D.dispose(),this._vertexBuffers[r.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},G}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r}),o.d(t,"b",function(){return I});var R=o(134),r=function(){},I=function(){function i(G){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array(),this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new r(),this._scene=G;for(var D=i.MIN_RENDERINGGROUPS;D<i.MAX_RENDERINGGROUPS;D++)this._autoClearDepthStencil[D]={autoClear:!0,depth:!0,stencil:!0}}return i.prototype._clearDepthStencilBuffer=function(G,D){void 0===G&&(G=!0),void 0===D&&(D=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,G,D),this._depthStencilBufferAlreadyCleaned=!0)},i.prototype.render=function(G,D,E,x){var l=this._renderingGroupInfo;if(l.scene=this._scene,l.camera=this._scene.activeCamera,this._scene.spriteManagers&&x)for(var s=0;s<this._scene.spriteManagers.length;s++){var y=this._scene.spriteManagers[s];this.dispatchSprites(y)}for(s=i.MIN_RENDERINGGROUPS;s<i.MAX_RENDERINGGROUPS;s++){this._depthStencilBufferAlreadyCleaned=s===i.MIN_RENDERINGGROUPS;var q=this._renderingGroups[s];if(q){var n=Math.pow(2,s);if(l.renderingGroupId=s,this._scene.onBeforeRenderingGroupObservable.notifyObservers(l,n),i.AUTOCLEAR){var k=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(s):this._autoClearDepthStencil[s];k&&k.autoClear&&this._clearDepthStencilBuffer(k.depth,k.stencil)}for(var p=0,u=this._scene._beforeRenderingGroupDrawStage;p<u.length;p++)u[p].action(s);q.render(G,x,E,D);for(var A=0,B=this._scene._afterRenderingGroupDrawStage;A<B.length;A++)B[A].action(s);this._scene.onAfterRenderingGroupObservable.notifyObservers(l,n)}}},i.prototype.reset=function(){for(var G=i.MIN_RENDERINGGROUPS;G<i.MAX_RENDERINGGROUPS;G++){var D=this._renderingGroups[G];D&&D.prepare()}},i.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},i.prototype.freeRenderingGroups=function(){for(var G=i.MIN_RENDERINGGROUPS;G<i.MAX_RENDERINGGROUPS;G++){var D=this._renderingGroups[G];D&&D.dispose()}},i.prototype._prepareRenderingGroup=function(G){void 0===this._renderingGroups[G]&&(this._renderingGroups[G]=new R.a(G,this._scene,this._customOpaqueSortCompareFn[G],this._customAlphaTestSortCompareFn[G],this._customTransparentSortCompareFn[G]))},i.prototype.dispatchSprites=function(G){var D=G.renderingGroupId||0;this._prepareRenderingGroup(D),this._renderingGroups[D].dispatchSprites(G)},i.prototype.dispatchParticles=function(G){var D=G.renderingGroupId||0;this._prepareRenderingGroup(D),this._renderingGroups[D].dispatchParticles(G)},i.prototype.dispatch=function(G,D,E){void 0===D&&(D=G.getMesh());var x=D.renderingGroupId||0;this._prepareRenderingGroup(x),this._renderingGroups[x].dispatch(G,D,E)},i.prototype.setRenderingOrder=function(G,D,E,x){if(void 0===D&&(D=null),void 0===E&&(E=null),void 0===x&&(x=null),this._customOpaqueSortCompareFn[G]=D,this._customAlphaTestSortCompareFn[G]=E,this._customTransparentSortCompareFn[G]=x,this._renderingGroups[G]){var l=this._renderingGroups[G];l.opaqueSortCompareFn=this._customOpaqueSortCompareFn[G],l.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[G],l.transparentSortCompareFn=this._customTransparentSortCompareFn[G]}},i.prototype.setRenderingAutoClearDepthStencil=function(G,D,E,x){void 0===E&&(E=!0),void 0===x&&(x=!0),this._autoClearDepthStencil[G]={autoClear:D,depth:E,stencil:x}},i.prototype.getAutoClearDepthStencilSetup=function(G){return this._autoClearDepthStencil[G]},i.MAX_RENDERINGGROUPS=4,i.MIN_RENDERINGGROUPS=0,i.AUTOCLEAR=!0,i}()},function(Ja,t,o){"use strict";o.d(t,"b",function(){return l}),o.d(t,"a",function(){return s});var R=o(1),r=o(10),I=o(4),i=o(5),G=o(136),D=o(29),E=o(82),x=o(16),l=(o(148),o(149),function(y){function q(n,k,p,u,A,B,v){void 0===k&&(k=null),void 0===p&&(p=null),void 0===u&&(u=null);var H=y.call(this,n,k,p,u,A)||this;H.useVertexColor=B,H.useVertexAlpha=v,H.color=new r.a(1,1,1),H.alpha=1,u&&(H.color=u.color.clone(),H.alpha=u.alpha,H.useVertexColor=u.useVertexColor,H.useVertexAlpha=u.useVertexAlpha),H.intersectionThreshold=.1;var L={attributes:[I.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===v&&(L.needAlphaBlending=!1),B?(L.defines.push("#define VERTEXCOLOR"),L.attributes.push(I.b.ColorKind)):(L.uniforms.push("color"),H.color4=new r.b()),H._colorShader=new E.a("colorShader",H.getScene(),"color",L),H}return Object(R.d)(q,y),q.prototype._addClipPlaneDefine=function(n){var k="#define "+n;-1===this._colorShader.options.defines.indexOf(k)&&this._colorShader.options.defines.push(k)},q.prototype._removeClipPlaneDefine=function(n){var k="#define "+n,p=this._colorShader.options.defines.indexOf(k);-1!==p&&this._colorShader.options.defines.splice(p,1)},q.prototype.isReady=function(){var n=this.getScene();return n.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),n.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),n.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),n.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),n.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5"),n.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6"),!!this._colorShader.isReady()&&y.prototype.isReady.call(this)},q.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(q.prototype,"material",{get:function(){return this._colorShader},set:function(n){},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),q.prototype._bind=function(n,k,p){if(!this._geometry)return this;var u=this._colorShader.getEffect(),A=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._geometry._bind(u,A),!this.useVertexColor){var B=this.color,v=B.r,H=B.g,L=B.b;this.color4.set(v,H,L,this.alpha),this._colorShader.setColor4("color",this.color4)}return x.a.BindClipPlane(u,this.getScene()),this},q.prototype._draw=function(n,k,p){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var u=this.getScene().getEngine();return this._unIndexed?u.drawArraysType(D.a.LineListDrawMode,n.verticesStart,n.verticesCount,p):u.drawElementsType(D.a.LineListDrawMode,n.indexStart,n.indexCount,p),this},q.prototype.dispose=function(n){this._colorShader.dispose(!1,!1,!0),y.prototype.dispose.call(this,n)},q.prototype.clone=function(n,k,p){return void 0===k&&(k=null),new q(n,this.getScene(),k,this,p)},q.prototype.createInstance=function(n){return new s(n,this)},q}(i.a)),s=function(y){function q(n,k){var p=y.call(this,n,k)||this;return p.intersectionThreshold=k.intersectionThreshold,p}return Object(R.d)(q,y),q.prototype.getClassName=function(){return"InstancedLinesMesh"},q}(G.a)},function(Ja,t,o){"use strict";o.r(t);var R,r=o(0),I=o(32),i=o(72),G=o(10),D=function(){function U(P,ga,ma,oa,ja,aa){if(void 0===ga&&(ga=1),void 0===ma&&(ma=2),this._scaleLinesFactor=4,this._instanced=!1,this.scaleLines=1,this.scaleLines=ga,!oa){var F=new I.a("",P);F.disableLighting=!0,F.emissiveColor=G.a.Red().scale(.5),oa=i.a._CreateArrow(P,F)}if(!ja){var $=new I.a("",P);$.disableLighting=!0,$.emissiveColor=G.a.Green().scale(.5),ja=i.a._CreateArrow(P,$)}if(!aa){var ia=new I.a("",P);ia.disableLighting=!0,ia.emissiveColor=G.a.Blue().scale(.5),aa=i.a._CreateArrow(P,ia)}this._xAxis=oa,this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis=ja,this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis=aa,this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),null!=ma&&(U._SetRenderingGroupId(this._xAxis,ma),U._SetRenderingGroupId(this._yAxis,ma),U._SetRenderingGroupId(this._zAxis,ma)),this.scene=P,this.update(new r.e(),r.e.Right(),r.e.Up(),r.e.Forward())}return Object.defineProperty(U.prototype,"xAxis",{get:function(){return this._xAxis},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"yAxis",{get:function(){return this._yAxis},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"zAxis",{get:function(){return this._zAxis},enumerable:!0,configurable:!0}),U.prototype.update=function(P,ga,ma,oa){this._xAxis.position.copyFrom(P),this._xAxis.setDirection(ga),this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis.position.copyFrom(P),this._yAxis.setDirection(ma),this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis.position.copyFrom(P),this._zAxis.setDirection(oa),this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor)},U.prototype.createInstance=function(){var P=i.a._CreateArrowInstance(this.scene,this._xAxis),ga=i.a._CreateArrowInstance(this.scene,this._yAxis),ma=i.a._CreateArrowInstance(this.scene,this._zAxis),oa=new U(this.scene,this.scaleLines,null,P,ga,ma);return oa._instanced=!0,oa},U.prototype.dispose=function(){this._xAxis&&(this._xAxis.dispose(!1,!this._instanced),delete this._xAxis),this._yAxis&&(this._yAxis.dispose(!1,!this._instanced),delete this._yAxis),this._zAxis&&(this._zAxis.dispose(!1,!this._instanced),delete this._zAxis),delete this.scene},U._SetRenderingGroupId=function(P,ga){P.getChildMeshes().forEach(function(ma){ma.renderingGroupId=ga})},U}(),E=o(1),x=o(22),l=function(U){function P(ga,ma,oa,ja){void 0===ja&&(ja=1);var aa=U.call(this,ga,ja)||this;return aa.pos=r.e.Zero(),aa.xaxis=r.e.Zero(),aa.yaxis=r.e.Zero(),aa.zaxis=r.e.Zero(),aa.mesh=oa,aa.bone=ma,aa}return Object(E.d)(P,U),P.prototype.update=function(){if(this.mesh&&this.bone){var ga=this.bone;ga._markAsDirtyAndCompose(),ga.getAbsolutePositionToRef(this.mesh,this.pos),ga.getDirectionToRef(x.a.X,this.mesh,this.xaxis),ga.getDirectionToRef(x.a.Y,this.mesh,this.yaxis),ga.getDirectionToRef(x.a.Z,this.mesh,this.zaxis),U.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},P.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,U.prototype.dispose.call(this))},P}(D),s=o(13),y=o(6),q=o(18),n=o(11);Object.defineProperty(q.a.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new k(this)),this._debugLayer},enumerable:!0,configurable:!0}),function(U){U[U.Properties=0]="Properties",U[U.Debug=1]="Debug",U[U.Statistics=2]="Statistics",U[U.Tools=3]="Tools",U[U.Settings=4]="Settings"}(R||(R={}));var k=function(){function U(P){var ga=this;this.BJSINSPECTOR=this._getGlobalInspector(),this._scene=P,this._scene.onDisposeObservable.add(function(){ga._scene._debugLayer&&ga._scene._debugLayer.hide()})}return Object.defineProperty(U.prototype,"onPropertyChangedObservable",{get:function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector?this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable:(this._onPropertyChangedObservable||(this._onPropertyChangedObservable=new y.c()),this._onPropertyChangedObservable)},enumerable:!0,configurable:!0}),U.prototype._createInspector=function(P){if(!this.isVisible()){if(this._onPropertyChangedObservable){for(var ga=0,ma=this._onPropertyChangedObservable.observers;ga<ma.length;ga++){var oa=ma[ga];this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable.add(oa)}this._onPropertyChangedObservable.clear(),this._onPropertyChangedObservable=void 0}var ja=Object(E.a)({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},P);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,ja)}},U.prototype.select=function(P,ga){this.BJSINSPECTOR&&(this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(ga),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(P))},U.prototype._getGlobalInspector=function(){return"undefined"!=typeof INSPECTOR?INSPECTOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.Inspector?BABYLON:void 0},U.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},U.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},U.prototype.show=function(P){var ga=this;return new Promise(function(ma,oa){if(void 0===ga.BJSINSPECTOR){var ja=P&&P.inspectorURL?P.inspectorURL:U.InspectorURL;s.b.LoadScript(ja,function(){ga._createInspector(P),ma(ga)})}else ga._createInspector(P),ma(ga)})},U.InspectorURL="https://unpkg.com/babylonjs-inspector@"+n.a.Version+"/babylon.inspector.bundle.js",U}(),p=o(5),u=o(66),A=o(48),B=o(23),v=o(30),H=o(41),L=o(59),Q=function(){function U(P){this._impostors=[],this._meshes=[],this._numMeshes=0,this._debugMeshMeshes=new Array(),this._scene=P||B.a.LastCreatedScene;var ga=this._scene.getPhysicsEngine();ga&&(this._physicsEnginePlugin=ga.getPhysicsPlugin()),this._utilityLayer=new H.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0}return U.prototype._updateDebugMeshes=function(){for(var P=this._physicsEnginePlugin,ga=0;ga<this._numMeshes;ga++){var ma=this._impostors[ga];if(ma)if(ma.isDisposed)this.hideImpostor(this._impostors[ga--]);else{if(ma.type===v.a.MeshImpostor)continue;var oa=this._meshes[ga];oa&&P&&P.syncMeshWithImpostor(oa,ma)}}},U.prototype.showImpostor=function(P,ga){if(!this._scene)return null;for(var ma=0;ma<this._numMeshes;ma++)if(this._impostors[ma]==P)return null;var oa=this._getDebugMesh(P,ga);return oa&&(this._impostors[this._numMeshes]=P,this._meshes[this._numMeshes]=oa,0===this._numMeshes&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),oa},U.prototype.hideImpostor=function(P){if(P&&this._scene&&this._utilityLayer){for(var ga=!1,ma=this._utilityLayer.utilityLayerScene,oa=0;oa<this._numMeshes;oa++)if(this._impostors[oa]==P){var ja=this._meshes[oa];if(!ja)continue;ma.removeMesh(ja),ja.dispose();var aa=this._debugMeshMeshes.indexOf(ja);aa>-1&&this._debugMeshMeshes.splice(aa,1),this._numMeshes--,this._numMeshes>0?(this._meshes[oa]=this._meshes[this._numMeshes],this._impostors[oa]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),ga=!0;break}ga&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}},U.prototype._getDebugMaterial=function(P){return this._debugMaterial||(this._debugMaterial=new I.a("",P),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=G.a.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial},U.prototype._getDebugBoxMesh=function(P){return this._debugBoxMesh||(this._debugBoxMesh=u.a.CreateBox("physicsBodyBoxViewMesh",{size:1},P),this._debugBoxMesh.rotationQuaternion=r.b.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(P),this._debugBoxMesh.setEnabled(!1)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},U.prototype._getDebugSphereMesh=function(P){return this._debugSphereMesh||(this._debugSphereMesh=A.a.CreateSphere("physicsBodySphereViewMesh",{diameter:1},P),this._debugSphereMesh.rotationQuaternion=r.b.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(P),this._debugSphereMesh.setEnabled(!1)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},U.prototype._getDebugCylinderMesh=function(P){return this._debugCylinderMesh||(this._debugCylinderMesh=L.a.CreateCylinder("physicsBodyCylinderViewMesh",{diameterTop:1,diameterBottom:1,height:1},P),this._debugCylinderMesh.rotationQuaternion=r.b.Identity(),this._debugCylinderMesh.material=this._getDebugMaterial(P),this._debugCylinderMesh.setEnabled(!1)),this._debugCylinderMesh.createInstance("physicsBodyBoxViewInstance")},U.prototype._getDebugMeshMesh=function(P,ga){var ma=new p.a(P.name,ga,null,P);return ma.position=r.e.Zero(),ma.setParent(P),ma.material=this._getDebugMaterial(ga),this._debugMeshMeshes.push(ma),ma},U.prototype._getDebugMesh=function(P,ga){var ma=this;if(!this._utilityLayer)return null;if(ga&&ga.parent&&ga.parent.physicsImpostor)return null;var oa=null,ja=this._utilityLayer.utilityLayerScene;switch(P.type){case v.a.BoxImpostor:oa=this._getDebugBoxMesh(ja),P.getBoxSizeToRef(oa.scaling);break;case v.a.SphereImpostor:oa=this._getDebugSphereMesh(ja);var aa=P.getRadius();oa.scaling.x=2*aa,oa.scaling.y=2*aa,oa.scaling.z=2*aa;break;case v.a.MeshImpostor:ga&&(oa=this._getDebugMeshMesh(ga,ja));break;case v.a.NoImpostor:ga&&ga.getChildMeshes().filter(function($){return $.physicsImpostor?1:0}).forEach(function($){ma._getDebugBoxMesh(ja).parent=$});break;case v.a.CylinderImpostor:oa=this._getDebugCylinderMesh(ja);var F=P.object.getBoundingInfo();oa.scaling.x=F.boundingBox.maximum.x-F.boundingBox.minimum.x,oa.scaling.y=F.boundingBox.maximum.y-F.boundingBox.minimum.y,oa.scaling.z=F.boundingBox.maximum.z-F.boundingBox.minimum.z}return oa},U.prototype.dispose=function(){for(var P=this._numMeshes,ga=0;ga<P;ga++)this.hideImpostor(this._impostors[0]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugCylinderMesh&&this._debugCylinderMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},U}(),M=o(46),Y=function(){function U(P){this.ray=P}return U.CreateAndShow=function(P,ga,ma){var oa=new U(P);return oa.show(ga,ma),oa},U.prototype.show=function(P,ga){if(!this._renderFunction&&this.ray){var ma=this.ray;this._renderFunction=this._render.bind(this),this._scene=P,this._renderPoints=[ma.origin,ma.origin.add(ma.direction.scale(ma.length))],this._renderLine=p.a.CreateLines("ray",this._renderPoints,P,!0),this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}ga&&this._renderLine&&this._renderLine.color.copyFrom(ga)},U.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},U.prototype._render=function(){var P=this.ray;if(P){var ga=this._renderPoints[1],ma=Math.min(P.length,1e06);ga.copyFrom(P.direction),ga.scaleInPlace(ma),ga.addInPlace(P.origin),p.a.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},U.prototype.attachToMesh=function(P,ga,ma,oa){this._attachedToMesh=P;var ja=this.ray;ja&&(ja.direction||(ja.direction=r.e.Zero()),ja.origin||(ja.origin=r.e.Zero()),oa&&(ja.length=oa),ma||(ma=r.e.Zero()),ga||(ga=new r.e(0,0,-1)),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(ga),this._meshSpaceOrigin.copyFrom(ma)):(this._meshSpaceDirection=ga.clone(),this._meshSpaceOrigin=ma.clone()),this._updateToMeshFunction||(this._updateToMeshFunction=this._updateToMesh.bind(this),this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),this._updateToMesh())},U.prototype.detachFromMesh=function(){this._attachedToMesh&&(this._updateToMeshFunction&&this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),this._attachedToMesh=null,this._updateToMeshFunction=null)},U.prototype._updateToMesh=function(){var P=this.ray;this._attachedToMesh&&P&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,P.direction),r.e.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),P.origin)))},U.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},U}(),X=function(){function U(P,ga,ma,oa,ja){void 0===oa&&(oa=!0),void 0===ja&&(ja=1),this.skeleton=P,this.mesh=ga,this.autoUpdateBonesMatrices=oa,this.renderingGroupId=ja,this.color=G.a.White(),this._debugLines=new Array(),this._isEnabled=!1,this._scene=ma,this._utilityLayer=new H.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(U.prototype,"debugMesh",{get:function(){return this._debugMesh},enumerable:!0,configurable:!0}),Object.defineProperty(U.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(P){this._isEnabled!==P&&(this._isEnabled=P,P?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),U.prototype._getBonePosition=function(P,ga,ma,oa,ja,aa){void 0===oa&&(oa=0),void 0===ja&&(ja=0),void 0===aa&&(aa=0);var F=r.c.Matrix[0],$=ga.getParent();if(F.copyFrom(ga.getLocalMatrix()),0!==oa||0!==ja||0!==aa){var ia=r.c.Matrix[1];r.a.IdentityToRef(ia),ia.setTranslationFromFloats(oa,ja,aa),ia.multiplyToRef(F,F)}$&&F.multiplyToRef($.getAbsoluteTransform(),F),F.multiplyToRef(ma,F),P.x=F.m[12],P.y=F.m[13],P.z=F.m[14]},U.prototype._getLinesForBonesWithLength=function(P,ga){for(var ma=P.length,oa=this.mesh._effectiveMesh.position,ja=0;ja<ma;ja++){var aa=P[ja],F=this._debugLines[ja];F||(F=[r.e.Zero(),r.e.Zero()],this._debugLines[ja]=F),this._getBonePosition(F[0],aa,ga),this._getBonePosition(F[1],aa,ga,0,aa.length,0),F[0].subtractInPlace(oa),F[1].subtractInPlace(oa)}},U.prototype._getLinesForBonesNoLength=function(P,ga){for(var ma=P.length,oa=0,ja=this.mesh._effectiveMesh,aa=ja.position,F=ma-1;F>=0;F--){var $=P[F],ia=$.getParent();if(ia){var ba=this._debugLines[oa];ba||(ba=[r.e.Zero(),r.e.Zero()],this._debugLines[oa]=ba),$.getAbsolutePositionToRef(ja,ba[0]),ia.getAbsolutePositionToRef(ja,ba[1]),ba[0].subtractInPlace(aa),ba[1].subtractInPlace(aa),oa++}}},U.prototype.update=function(){if(this._utilityLayer){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();var P=this.mesh._effectiveMesh;void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,P.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,P.getWorldMatrix());var ga=this._utilityLayer.utilityLayerScene;this._debugMesh?M.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},ga):(this._debugMesh=M.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},ga),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color}},U.prototype.dispose=function(){this.isEnabled=!1,this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null),this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},U}();o.d(t,"AxesViewer",function(){return D}),o.d(t,"BoneAxesViewer",function(){return l}),o.d(t,"DebugLayerTab",function(){return R}),o.d(t,"DebugLayer",function(){return k}),o.d(t,"PhysicsViewer",function(){return Q}),o.d(t,"RayHelper",function(){return Y}),o.d(t,"SkeletonViewer",function(){return X})},function(Ja,t,o){"use strict";var R="morphTargetsVertex",r=`#ifdef MORPHTARGETS
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];
#endif
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){}},function(Ja,t,o){"use strict";o.d(t,"a",function(){return i});var R=o(42),r=o(0),I=o(28),i=function(){function G(D,E,x){this.vectors=R.a.BuildArray(8,r.e.Zero),this.center=r.e.Zero(),this.centerWorld=r.e.Zero(),this.extendSize=r.e.Zero(),this.extendSizeWorld=r.e.Zero(),this.directions=R.a.BuildArray(3,r.e.Zero),this.vectorsWorld=R.a.BuildArray(8,r.e.Zero),this.minimumWorld=r.e.Zero(),this.maximumWorld=r.e.Zero(),this.minimum=r.e.Zero(),this.maximum=r.e.Zero(),this.reConstruct(D,E,x)}return G.prototype.reConstruct=function(D,E,x){var l=D.x,s=D.y,y=D.z,q=E.x,n=E.y,k=E.z,p=this.vectors;this.minimum.copyFromFloats(l,s,y),this.maximum.copyFromFloats(q,n,k),p[0].copyFromFloats(l,s,y),p[1].copyFromFloats(q,n,k),p[2].copyFromFloats(q,s,y),p[3].copyFromFloats(l,n,y),p[4].copyFromFloats(l,s,k),p[5].copyFromFloats(q,n,y),p[6].copyFromFloats(l,n,k),p[7].copyFromFloats(q,s,k),E.addToRef(D,this.center).scaleInPlace(.5),E.subtractToRef(D,this.extendSize).scaleInPlace(.5),this._worldMatrix=x||r.a.IdentityReadOnly,this._update(this._worldMatrix)},G.prototype.scale=function(D){var E=G.TmpVector3,x=this.maximum.subtractToRef(this.minimum,E[0]),l=x.length();x.normalizeFromLength(l);var s=l*D,y=x.scaleInPlace(.5*s),q=this.center.subtractToRef(y,E[1]),n=this.center.addToRef(y,E[2]);return this.reConstruct(q,n,this._worldMatrix),this},G.prototype.getWorldMatrix=function(){return this._worldMatrix},G.prototype._update=function(D){var E=this.minimumWorld,x=this.maximumWorld,l=this.directions,s=this.vectorsWorld,y=this.vectors;if(D.isIdentity()){for(E.copyFrom(this.minimum),x.copyFrom(this.maximum),q=0;q<8;++q)s[q].copyFrom(y[q]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{E.setAll(Number.MAX_VALUE),x.setAll(-Number.MAX_VALUE);for(var q=0;q<8;++q){var n=s[q];r.e.TransformCoordinatesToRef(y[q],D,n),E.minimizeInPlace(n),x.maximizeInPlace(n)}x.subtractToRef(E,this.extendSizeWorld).scaleInPlace(.5),x.addToRef(E,this.centerWorld).scaleInPlace(.5)}r.e.FromArrayToRef(D.m,0,l[0]),r.e.FromArrayToRef(D.m,4,l[1]),r.e.FromArrayToRef(D.m,8,l[2]),this._worldMatrix=D},G.prototype.isInFrustum=function(D){return G.IsInFrustum(this.vectorsWorld,D)},G.prototype.isCompletelyInFrustum=function(D){return G.IsCompletelyInFrustum(this.vectorsWorld,D)},G.prototype.intersectsPoint=function(D){var E=this.minimumWorld,x=this.maximumWorld,l=E.x,s=E.y,y=E.z,q=x.x,n=x.y,k=x.z,p=D.x,u=D.y,A=D.z,B=-I.a;return!(q-p<B||B>p-l)&&(!(n-u<B||B>u-s)&&!(k-A<B||B>A-y))},G.prototype.intersectsSphere=function(D){return G.IntersectsSphere(this.minimumWorld,this.maximumWorld,D.centerWorld,D.radiusWorld)},G.prototype.intersectsMinMax=function(D,E){var x=this.minimumWorld,l=this.maximumWorld,s=x.x,y=x.y,q=x.z,n=l.x,k=l.y,p=l.z,u=D.x,A=D.y,B=D.z,v=E.x,H=E.y,L=E.z;return!(n<u||s>v)&&(!(k<A||y>H)&&!(p<B||q>L))},G.Intersects=function(D,E){return D.intersectsMinMax(E.minimumWorld,E.maximumWorld)},G.IntersectsSphere=function(D,E,x,l){var s=G.TmpVector3[0];return r.e.ClampToRef(x,D,E,s),r.e.DistanceSquared(x,s)<=l*l},G.IsCompletelyInFrustum=function(D,E){for(var x=0;x<6;++x)for(var l=E[x],s=0;s<8;++s)if(l.dotCoordinate(D[s])<0)return!1;return!0},G.IsInFrustum=function(D,E){for(var x=0;x<6;++x){for(var l=!0,s=E[x],y=0;y<8;++y)if(s.dotCoordinate(D[y])>=0){l=!1;break}if(l)return!1}return!0},G.TmpVector3=R.a.BuildArray(3,r.e.Zero),G}()},function(Ja,t,o){"use strict";var R="lightFragmentDeclaration",r=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};
uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};
uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};
uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="lightUboDeclaration",r=`#ifdef LIGHT{X}
uniform Light{X}
{
vec4 vLightData;
vec4 vLightDiffuse;
vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;
vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;
vec2 depthValues;
} light{X};
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
#endif
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="imageProcessingDeclaration",r=`#ifdef EXPOSURE
uniform float exposureLinear;
#endif
#ifdef CONTRAST
uniform float contrast;
#endif
#ifdef VIGNETTE
uniform vec2 vInverseScreenSize;
uniform vec4 vignetteSettings1;
uniform vec4 vignetteSettings2;
#endif
#ifdef COLORCURVES
uniform vec4 vCameraColorCurveNegative;
uniform vec4 vCameraColorCurveNeutral;
uniform vec4 vCameraColorCurvePositive;
#endif
#ifdef COLORGRADING
#ifdef COLORGRADING3D
uniform highp sampler3D txColorTransform;
#else
uniform sampler2D txColorTransform;
#endif
uniform vec4 colorTransformSettings;
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="imageProcessingFunctions",r=`#if defined(COLORGRADING) && !defined(COLORGRADING3D)

vec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)
{
float sliceSize=2.0*sampler3dSetting.x;
#ifdef SAMPLER3DGREENDEPTH
float sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;
#else
float sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;
#endif
float sliceInteger=floor(sliceContinuous);


float sliceFraction=sliceContinuous-sliceInteger;
#ifdef SAMPLER3DGREENDEPTH
vec2 sliceUV=color.rb;
#else
vec2 sliceUV=color.rg;
#endif
sliceUV.x*=sliceSize;
sliceUV.x+=sliceInteger*sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice0Color=texture2D(colorTransform,sliceUV);
sliceUV.x+=sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice1Color=texture2D(colorTransform,sliceUV);
vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);
#ifdef SAMPLER3DBGRMAP
color.rgb=result.rgb;
#else
color.rgb=result.bgr;
#endif
return color;
}
#endif
#ifdef TONEMAPPING_ACES





const mat3 ACESInputMat=mat3(
vec3(0.59719,0.07600,0.02840),
vec3(0.35458,0.90834,0.13383),
vec3(0.04823,0.01566,0.83777)
);

const mat3 ACESOutputMat=mat3(
vec3( 1.60475,-0.10208,-0.00327),
vec3(-0.53108,1.10813,-0.07276),
vec3(-0.07367,-0.00605,1.07602)
);
vec3 RRTAndODTFit(vec3 v)
{
vec3 a=v*(v+0.0245786)-0.000090537;
vec3 b=v*(0.983729*v+0.4329510)+0.238081;
return a/b;
}
vec3 ACESFitted(vec3 color)
{
color=ACESInputMat*color;

color=RRTAndODTFit(color);
color=ACESOutputMat*color;

color=saturate(color);
return color;
}
#endif
vec4 applyImageProcessing(vec4 result) {
#ifdef EXPOSURE
result.rgb*=exposureLinear;
#endif
#ifdef VIGNETTE

vec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;
viewportXY=viewportXY*2.0-1.0;
vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);
float vignetteTerm=dot(vignetteXY1,vignetteXY1);
float vignette=pow(vignetteTerm,vignetteSettings2.w);

vec3 vignetteColor=vignetteSettings2.rgb;
#ifdef VIGNETTEBLENDMODEMULTIPLY
vec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);
result.rgb*=vignetteColorMultiplier;
#endif
#ifdef VIGNETTEBLENDMODEOPAQUE
result.rgb=mix(vignetteColor,result.rgb,vignette);
#endif
#endif
#ifdef TONEMAPPING
#ifdef TONEMAPPING_ACES
result.rgb=ACESFitted(result.rgb);
#else
const float tonemappingCalibration=1.590579;
result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);
#endif
#endif

result.rgb=toGammaSpace(result.rgb);
result.rgb=saturate(result.rgb);
#ifdef CONTRAST

vec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);
if (contrast<1.0) {

result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);
} else {

result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);
}
#endif

#ifdef COLORGRADING
vec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;
#ifdef COLORGRADING3D
vec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;
#else
vec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;
#endif
result.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);
#endif
#ifdef COLORCURVES

float luma=getLuminance(result.rgb);
vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));
vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;
result.rgb*=colorCurve.rgb;
result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);
#endif
return result;
}`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="clipPlaneFragment",r=`#ifdef CLIPPLANE
if (fClipDistance>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE2
if (fClipDistance2>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE3
if (fClipDistance3>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE4
if (fClipDistance4>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE5
if (fClipDistance5>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE6
if (fClipDistance6>0.0)
{
discard;
}
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="clipPlaneVertex",r=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){this._count=0,this._data={}}return r.prototype.copyFrom=function(I){var i=this;this.clear(),I.forEach(function(G,D){return i.add(G,D)})},r.prototype.get=function(I){var i=this._data[I];if(void 0!==i)return i},r.prototype.getOrAddWithFactory=function(I,i){var G=this.get(I);return void 0!==G?G:((G=i(I))&&this.add(I,G),G)},r.prototype.getOrAdd=function(I,i){var G=this.get(I);return void 0!==G?G:(this.add(I,i),i)},r.prototype.contains=function(I){return void 0!==this._data[I]},r.prototype.add=function(I,i){return void 0===this._data[I]&&(this._data[I]=i,++this._count,!0)},r.prototype.set=function(I,i){return void 0!==this._data[I]&&(this._data[I]=i,!0)},r.prototype.getAndRemove=function(I){var i=this.get(I);return void 0!==i?(delete this._data[I],--this._count,i):null},r.prototype.remove=function(I){return!!this.contains(I)&&(delete this._data[I],--this._count,!0)},r.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(r.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),r.prototype.forEach=function(I){for(var i in this._data)I(i,this._data[i])},r.prototype.first=function(I){for(var i in this._data){var G=I(i,this._data[i]);if(G)return G}return null},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return I});var R=o(42),r=o(0),I=function(){function i(G,D,E){this.center=r.e.Zero(),this.centerWorld=r.e.Zero(),this.minimum=r.e.Zero(),this.maximum=r.e.Zero(),this.reConstruct(G,D,E)}return i.prototype.reConstruct=function(G,D,E){this.minimum.copyFrom(G),this.maximum.copyFrom(D);var x=r.e.Distance(G,D);D.addToRef(G,this.center).scaleInPlace(.5),this.radius=.5*x,this._update(E||r.a.IdentityReadOnly)},i.prototype.scale=function(G){var D=this.radius*G,E=i.TmpVector3,x=E[0].setAll(D),l=this.center.subtractToRef(x,E[1]),s=this.center.addToRef(x,E[2]);return this.reConstruct(l,s,this._worldMatrix),this},i.prototype.getWorldMatrix=function(){return this._worldMatrix},i.prototype._update=function(G){if(G.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{r.e.TransformCoordinatesToRef(this.center,G,this.centerWorld);var D=i.TmpVector3[0];r.e.TransformNormalFromFloatsToRef(1,1,1,G,D),this.radiusWorld=Math.max(Math.abs(D.x),Math.abs(D.y),Math.abs(D.z))*this.radius}},i.prototype.isInFrustum=function(G){for(var D=this.centerWorld,E=this.radiusWorld,x=0;x<6;x++)if(G[x].dotCoordinate(D)<=-E)return!1;return!0},i.prototype.isCenterInFrustum=function(G){for(var D=this.centerWorld,E=0;E<6;E++)if(G[E].dotCoordinate(D)<0)return!1;return!0},i.prototype.intersectsPoint=function(G){var D=r.e.DistanceSquared(this.centerWorld,G);return!(this.radiusWorld*this.radiusWorld<D)},i.Intersects=function(G,D){var E=r.e.DistanceSquared(G.centerWorld,D.centerWorld),x=G.radiusWorld+D.radiusWorld;return!(x*x<E)},i.TmpVector3=R.a.BuildArray(3,r.e.Zero),i}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(r,I,i){this.bu=r,this.bv=I,this.distance=i,this.faceId=0,this.subMeshId=0}},function(Ja,t,o){"use strict";var R="clipPlaneFragmentDeclaration",r=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="logDepthDeclaration",r=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;
varying float vFragmentDepth;
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="clipPlaneVertexDeclaration",r=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;
varying float fClipDistance6;
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.prototype.attributeProcessor=function(I){return I.replace("attribute","in")},r.prototype.varyingProcessor=function(I,i){return I.replace("varying",i?"in":"out")},r.prototype.postProcessor=function(I,i,G){var D=-1!==I.search(/#extension.+GL_EXT_draw_buffers.+require/);if(I=(I=I.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),G)I=(I=(I=(I=(I=(I=(I=I.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(D?"":`out vec4 glFragColor;
`)+"void main(");else if(-1!==i.indexOf("#define MULTIVIEW"))return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+I;return I},r}()},function(Ja,t,o){"use strict";o.d(t,"b",function(){return r}),o.d(t,"a",function(){return I});var R=o(0);function r(i,G,D,E,x){void 0===x&&(x=null);for(var l=new R.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new R.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),y=D;y<D+E;y++){var q=3*G[y],n=i[q],k=i[q+1],p=i[q+2];l.minimizeInPlaceFromFloats(n,k,p),s.maximizeInPlaceFromFloats(n,k,p)}return x&&(l.x-=l.x*x.x+x.y,l.y-=l.y*x.x+x.y,l.z-=l.z*x.x+x.y,s.x+=s.x*x.x+x.y,s.y+=s.y*x.x+x.y,s.z+=s.z*x.x+x.y),{minimum:l,maximum:s}}function I(i,G,D,E,x){void 0===E&&(E=null);var l=new R.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new R.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);x||(x=3);for(var y=G,q=G*x;y<G+D;y++,q+=x){var n=i[q],k=i[q+1],p=i[q+2];l.minimizeInPlaceFromFloats(n,k,p),s.maximizeInPlaceFromFloats(n,k,p)}return E&&(l.x-=l.x*E.x+E.y,l.y-=l.y*E.x+E.y,l.z-=l.z*E.x+E.y,s.x+=s.x*E.x+E.y,s.y+=s.y*E.x+E.y,s.z+=s.z*E.x+E.y),{minimum:l,maximum:s}}},function(Ja,t,o){"use strict";o.d(t,"a",function(){return i});var R=o(1),r=o(3),I=o(10),i=function(){function G(){this._dirty=!0,this._tempColor=new I.b(0,0,0,0),this._globalCurve=new I.b(0,0,0,0),this._highlightsCurve=new I.b(0,0,0,0),this._midtonesCurve=new I.b(0,0,0,0),this._shadowsCurve=new I.b(0,0,0,0),this._positiveCurve=new I.b(0,0,0,0),this._negativeCurve=new I.b(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(G.prototype,"globalHue",{get:function(){return this._globalHue},set:function(D){this._globalHue=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(D){this._globalDensity=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(D){this._globalSaturation=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(D){this._globalExposure=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(D){this._highlightsHue=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(D){this._highlightsDensity=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(D){this._highlightsSaturation=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(D){this._highlightsExposure=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(D){this._midtonesHue=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(D){this._midtonesDensity=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(D){this._midtonesSaturation=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(D){this._midtonesExposure=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(D){this._shadowsHue=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(D){this._shadowsDensity=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(D){this._shadowsSaturation=D,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(D){this._shadowsExposure=D,this._dirty=!0},enumerable:!0,configurable:!0}),G.prototype.getClassName=function(){return"ColorCurves"},G.Bind=function(D,E,x,l,s){void 0===x&&(x="vCameraColorCurvePositive"),void 0===l&&(l="vCameraColorCurveNeutral"),void 0===s&&(s="vCameraColorCurveNegative"),D._dirty&&(D._dirty=!1,D.getColorGradingDataToRef(D._globalHue,D._globalDensity,D._globalSaturation,D._globalExposure,D._globalCurve),D.getColorGradingDataToRef(D._highlightsHue,D._highlightsDensity,D._highlightsSaturation,D._highlightsExposure,D._tempColor),D._tempColor.multiplyToRef(D._globalCurve,D._highlightsCurve),D.getColorGradingDataToRef(D._midtonesHue,D._midtonesDensity,D._midtonesSaturation,D._midtonesExposure,D._tempColor),D._tempColor.multiplyToRef(D._globalCurve,D._midtonesCurve),D.getColorGradingDataToRef(D._shadowsHue,D._shadowsDensity,D._shadowsSaturation,D._shadowsExposure,D._tempColor),D._tempColor.multiplyToRef(D._globalCurve,D._shadowsCurve),D._highlightsCurve.subtractToRef(D._midtonesCurve,D._positiveCurve),D._midtonesCurve.subtractToRef(D._shadowsCurve,D._negativeCurve)),E&&(E.setFloat4(x,D._positiveCurve.r,D._positiveCurve.g,D._positiveCurve.b,D._positiveCurve.a),E.setFloat4(l,D._midtonesCurve.r,D._midtonesCurve.g,D._midtonesCurve.b,D._midtonesCurve.a),E.setFloat4(s,D._negativeCurve.r,D._negativeCurve.g,D._negativeCurve.b,D._negativeCurve.a))},G.PrepareUniforms=function(D){D.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},G.prototype.getColorGradingDataToRef=function(D,E,x,l,s){null!=D&&(D=G.clamp(D,0,360),E=G.clamp(E,-100,100),x=G.clamp(x,-100,100),l=G.clamp(l,-100,100),E=G.applyColorGradingSliderNonlinear(E),E*=.5,l=G.applyColorGradingSliderNonlinear(l),E<0&&(E*=-1,D=(D+180)%360),G.fromHSBToRef(D,E,50+.25*l,s),s.scaleToRef(2,s),s.a=1+.01*x)},G.applyColorGradingSliderNonlinear=function(D){D/=100;var E=Math.abs(D);return E=Math.pow(E,2),D<0&&(E*=-1),E*=100},G.fromHSBToRef=function(D,E,x,l){var s=G.clamp(D,0,360),y=G.clamp(E/100,0,1),q=G.clamp(x/100,0,1);if(0===y)l.r=q,l.g=q,l.b=q;else{s/=60;var n=Math.floor(s),k=s-n,p=q*(1-y),u=q*(1-y*k),A=q*(1-y*(1-k));switch(n){case 0:l.r=q,l.g=A,l.b=p;break;case 1:l.r=u,l.g=q,l.b=p;break;case 2:l.r=p,l.g=q,l.b=A;break;case 3:l.r=p,l.g=u,l.b=q;break;case 4:l.r=A,l.g=p,l.b=q;break;default:l.r=q,l.g=p,l.b=u}}l.a=1},G.clamp=function(D,E,x){return Math.min(Math.max(D,E),x)},G.prototype.clone=function(){return r.a.Clone(function(){return new G()},this)},G.prototype.serialize=function(){return r.a.Serialize(this)},G.Parse=function(D){return r.a.Parse(function(){return new G()},D,null,null)},Object(R.c)([Object(r.c)()],G.prototype,"_globalHue",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_globalDensity",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_globalSaturation",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_globalExposure",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_highlightsHue",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_highlightsDensity",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_highlightsSaturation",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_highlightsExposure",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_midtonesHue",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_midtonesDensity",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_midtonesSaturation",void 0),Object(R.c)([Object(r.c)()],G.prototype,"_midtonesExposure",void 0),G}();r.a._ColorCurvesParser=i.Parse},function(Ja,t,o){"use strict";o.d(t,"a",function(){return I});var R=o(7),r=o(12),I=function(){function i(){}return i.Instantiate=function(G){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[G])return this.RegisteredExternalClasses[G];var D=r.a.GetClass(G);if(D)return D;R.a.Warn(G+" not found, you may have missed an import.");for(var E=G.split("."),x=window||this,l=0,s=E.length;l<s;l++)x=x[E[l]];return"function"!=typeof x?null:x},i.RegisteredExternalClasses={},i}()},function(Ja,t,o){"use strict";var R="fogFragmentDeclaration",r=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;
uniform vec3 vFogColor;
varying vec3 vFogDistance;
float CalcFogFactor()
{
float fogCoeff=1.0;
float fogStart=vFogInfos.y;
float fogEnd=vFogInfos.z;
float fogDensity=vFogInfos.w;
float fogDistance=length(vFogDistance);
if (FOGMODE_LINEAR == vFogInfos.x)
{
fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);
}
else if (FOGMODE_EXP == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDensity);
}
else if (FOGMODE_EXP2 == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);
}
return clamp(fogCoeff,0.0,1.0);
}
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";o.r(t);var R=o(37),r=o(87),I=o(6),i=o(0),G=o(10),D=o(12),E=function(){function e(b,a){this.triggerOptions=b,this.onBeforeExecuteObservable=new I.c(),b.parameter?(this.trigger=b.trigger,this._triggerParameter=b.parameter):b.trigger?this.trigger=b.trigger:this.trigger=b,this._nextActiveAction=this,this._condition=a}return e.prototype._prepare=function(){},e.prototype.getTriggerParameter=function(){return this._triggerParameter},e.prototype._executeCurrent=function(b){if(this._nextActiveAction._condition){var a=this._nextActiveAction._condition,c=this._actionManager.getScene().getRenderId();if(a._evaluationId===c){if(!a._currentResult)return}else{if(a._evaluationId=c,!a.isValid())return void(a._currentResult=!1);a._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(b),this.skipToNextActiveAction()},e.prototype.execute=function(b){},e.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},e.prototype.then=function(b){return this._child=b,b._actionManager=this._actionManager,b._prepare(),b},e.prototype._getProperty=function(b){return this._actionManager._getProperty(b)},e.prototype._getEffectiveTarget=function(b,a){return this._actionManager._getEffectiveTarget(b,a)},e.prototype.serialize=function(b){},e.prototype._serialize=function(b,a){var c={type:1,children:[],name:b.name,properties:b.properties||[]};if(this._child&&this._child.serialize(c),this._condition){var d=this._condition.serialize();return d.children.push(c),a&&a.children.push(d),d}return a&&a.children.push(c),c},e._SerializeValueAsString=function(b){return"number"==typeof b?b.toString():"boolean"==typeof b?b?"true":"false":b instanceof i.d?b.x+", "+b.y:b instanceof i.e?b.x+", "+b.y+", "+b.z:b instanceof G.a?b.r+", "+b.g+", "+b.b:b instanceof G.b?b.r+", "+b.g+", "+b.b+", "+b.a:b},e._GetTargetProperty=function(b){return{name:"target",targetType:b._isMesh?"MeshProperties":b._isLight?"LightProperties":b._isCamera?"CameraProperties":"SceneProperties",value:b._isScene?"Scene":b.name}},e}();D.a.RegisteredTypes["BABYLON.Action"]=E;var x=o(45),l=o(1),s=function(){function e(b){this._actionManager=b}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(b){return this._actionManager._getProperty(b)},e.prototype._getEffectiveTarget=function(b,a){return this._actionManager._getEffectiveTarget(b,a)},e.prototype.serialize=function(){},e.prototype._serialize=function(b){return{type:2,children:[],name:b.name,properties:b.properties}},e}(),y=function(e){function b(a,c,d,f,g){void 0===g&&(g=b.IsEqual);var h=e.call(this,a)||this;return h.propertyPath=d,h.value=f,h.operator=g,h._target=c,h._effectiveTarget=h._getEffectiveTarget(c,h.propertyPath),h._property=h._getProperty(h.propertyPath),h}return Object(l.d)(b,e),Object.defineProperty(b,"IsEqual",{get:function(){return b._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsDifferent",{get:function(){return b._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsGreater",{get:function(){return b._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsLesser",{get:function(){return b._IsLesser},enumerable:!0,configurable:!0}),b.prototype.isValid=function(){switch(this.operator){case b.IsGreater:return this._effectiveTarget[this._property]>this.value;case b.IsLesser:return this._effectiveTarget[this._property]<this.value;case b.IsEqual:case b.IsDifferent:var a;return a=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===b.IsEqual?a:!a}return!1},b.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[E._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:E._SerializeValueAsString(this.value)},{name:"operator",value:b.GetOperatorName(this.operator)}]})},b.GetOperatorName=function(a){switch(a){case b._IsEqual:return"IsEqual";case b._IsDifferent:return"IsDifferent";case b._IsGreater:return"IsGreater";case b._IsLesser:return"IsLesser";default:return""}},b._IsEqual=0,b._IsDifferent=1,b._IsGreater=2,b._IsLesser=3,b}(s),q=function(e){function b(a,c){var d=e.call(this,a)||this;return d.predicate=c,d}return Object(l.d)(b,e),b.prototype.isValid=function(){return this.predicate()},b}(s),n=function(e){function b(a,c,d){var f=e.call(this,a)||this;return f.value=d,f._target=c,f}return Object(l.d)(b,e),b.prototype.isValid=function(){return this._target.state===this.value},b.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[E._GetTargetProperty(this._target),{name:"value",value:this.value}]})},b}(s);D.a.RegisteredTypes["BABYLON.ValueCondition"]=y,D.a.RegisteredTypes["BABYLON.PredicateCondition"]=q,D.a.RegisteredTypes["BABYLON.StateCondition"]=n;var k=o(7),p=o(2),u=function(e){function b(a,c,d,f){var g=e.call(this,a,f)||this;return g.propertyPath=d,g._target=g._effectiveTarget=c,g}return Object(l.d)(b,e),b.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},b.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[E._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},a)},b}(E),A=function(e){function b(a,c,d,f){var g=e.call(this,a,f)||this;return g.value=d,g._target=c,g}return Object(l.d)(b,e),b.prototype.execute=function(){this._target.state=this.value},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"SetStateAction",properties:[E._GetTargetProperty(this._target),{name:"value",value:this.value}]},a)},b}(E),B=function(e){function b(a,c,d,f,g){var h=e.call(this,a,g)||this;return h.propertyPath=d,h.value=f,h._target=h._effectiveTarget=c,h}return Object(l.d)(b,e),b.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},b.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"SetValueAction",properties:[E._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:E._SerializeValueAsString(this.value)}]},a)},b}(E),v=function(e){function b(a,c,d,f,g){var h=e.call(this,a,g)||this;return h.propertyPath=d,h.value=f,h._target=h._effectiveTarget=c,h}return Object(l.d)(b,e),b.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&k.a.Warn("Warning: IncrementValueAction can only be used with number values")},b.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[E._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:E._SerializeValueAsString(this.value)}]},a)},b}(E),H=function(e){function b(a,c,d,f,g,h){var j=e.call(this,a,h)||this;return j.from=d,j.to=f,j.loop=g,j._target=c,j}return Object(l.d)(b,e),b.prototype._prepare=function(){},b.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[E._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:E._SerializeValueAsString(this.loop)||!1}]},a)},b}(E),L=function(e){function b(a,c,d){var f=e.call(this,a,d)||this;return f._target=c,f}return Object(l.d)(b,e),b.prototype._prepare=function(){},b.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[E._GetTargetProperty(this._target)]},a)},b}(E),Q=function(e){function b(a,c){return void 0===a&&(a=p.a.ACTION_NothingTrigger),e.call(this,a,c)||this}return Object(l.d)(b,e),b.prototype.execute=function(){},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},a)},b}(E),M=function(e){function b(a,c,d){var f=e.call(this,a,d)||this;return f.children=c,f}return Object(l.d)(b,e),b.prototype._prepare=function(){for(var a=0;a<this.children.length;a++)this.children[a]._actionManager=this._actionManager,this.children[a]._prepare()},b.prototype.execute=function(a){for(var c=0;c<this.children.length;c++)this.children[c].execute(a)},b.prototype.serialize=function(a){for(var c=e.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},a),d=0;d<this.children.length;d++)c.combine.push(this.children[d].serialize(null));return c},b}(E),Y=function(e){function b(a,c,d){var f=e.call(this,a,d)||this;return f.func=c,f}return Object(l.d)(b,e),b.prototype.execute=function(a){this.func(a)},b}(E),X=function(e){function b(a,c,d,f){var g=e.call(this,a,f)||this;return g._target=c,g._parent=d,g}return Object(l.d)(b,e),b.prototype._prepare=function(){},b.prototype.execute=function(){if(this._target.parent!==this._parent){var a=this._parent.getWorldMatrix().clone();a.invert(),this._target.position=i.e.TransformCoordinates(this._target.position,a),this._target.parent=this._parent}},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"SetParentAction",properties:[E._GetTargetProperty(this._target),E._GetTargetProperty(this._parent)]},a)},b}(E);D.a.RegisteredTypes["BABYLON.SetParentAction"]=X,D.a.RegisteredTypes["BABYLON.ExecuteCodeAction"]=Y,D.a.RegisteredTypes["BABYLON.DoNothingAction"]=Q,D.a.RegisteredTypes["BABYLON.StopAnimationAction"]=L,D.a.RegisteredTypes["BABYLON.PlayAnimationAction"]=H,D.a.RegisteredTypes["BABYLON.IncrementValueAction"]=v,D.a.RegisteredTypes["BABYLON.SetValueAction"]=B,D.a.RegisteredTypes["BABYLON.SetStateAction"]=A,D.a.RegisteredTypes["BABYLON.SetParentAction"]=X;var U=o(23),P=o(33),ga=function(e){function b(a){var c=e.call(this)||this;return c._scene=a||U.a.LastCreatedScene,a.actionManagers.push(c),c}return Object(l.d)(b,e),b.prototype.dispose=function(){for(var a=this._scene.actionManagers.indexOf(this),c=0;c<this.actions.length;c++){var d=this.actions[c];b.Triggers[d.trigger]--,0===b.Triggers[d.trigger]&&delete b.Triggers[d.trigger]}a>-1&&this._scene.actionManagers.splice(a,1)},b.prototype.getScene=function(){return this._scene},b.prototype.hasSpecificTriggers=function(a){for(var c=0;c<this.actions.length;c++){var d=this.actions[c];if(a.indexOf(d.trigger)>-1)return!0}return!1},b.prototype.hasSpecificTriggers2=function(a,c){for(var d=0;d<this.actions.length;d++){var f=this.actions[d];if(a==f.trigger||c==f.trigger)return!0}return!1},b.prototype.hasSpecificTrigger=function(a,c){for(var d=0;d<this.actions.length;d++){var f=this.actions[d];if(f.trigger===a){if(!c)return!0;if(c(f.getTriggerParameter()))return!0}}return!1},Object.defineProperty(b.prototype,"hasPointerTriggers",{get:function(){for(var a=0;a<this.actions.length;a++){var c=this.actions[a];if(c.trigger>=b.OnPickTrigger&&c.trigger<=b.OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hasPickTriggers",{get:function(){for(var a=0;a<this.actions.length;a++){var c=this.actions[a];if(c.trigger>=b.OnPickTrigger&&c.trigger<=b.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),b.prototype.registerAction=function(a){return a.trigger===b.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(k.a.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(a),b.Triggers[a.trigger]?b.Triggers[a.trigger]++:b.Triggers[a.trigger]=1,a._actionManager=this,a._prepare(),a)},b.prototype.unregisterAction=function(a){var c=this.actions.indexOf(a);return-1!==c&&(this.actions.splice(c,1),b.Triggers[a.trigger]-=1,0===b.Triggers[a.trigger]&&delete b.Triggers[a.trigger],delete a._actionManager,!0)},b.prototype.processTrigger=function(a,c){for(var d=0;d<this.actions.length;d++){var f=this.actions[d];if(f.trigger===a){if(c&&(a===b.OnKeyUpTrigger||a===b.OnKeyDownTrigger)){var g=f.getTriggerParameter();if(g&&g!==c.sourceEvent.keyCode){if(!g.toLowerCase)continue;var h=g.toLowerCase();if(h!==c.sourceEvent.key){var j=c.sourceEvent.charCode?c.sourceEvent.charCode:c.sourceEvent.keyCode;if(String.fromCharCode(j).toLowerCase()!==h)continue}}}f._executeCurrent(c)}}},b.prototype._getEffectiveTarget=function(a,c){for(var d=c.split("."),f=0;f<d.length-1;f++)a=a[d[f]];return a},b.prototype._getProperty=function(a){var c=a.split(".");return c[c.length-1]},b.prototype.serialize=function(a){for(var c={children:new Array(),name:a,type:3,properties:new Array()},d=0;d<this.actions.length;d++){var f={type:0,children:new Array(),name:b.GetTriggerName(this.actions[d].trigger),properties:new Array()},g=this.actions[d].triggerOptions;if(g&&"number"!=typeof g)if(g.parameter instanceof Node)f.properties.push(E._GetTargetProperty(g.parameter));else{var h={};P.a.DeepCopy(g.parameter,h,["mesh"]),g.parameter&&g.parameter.mesh&&(h._meshId=g.parameter.mesh.id),f.properties.push({name:"parameter",targetType:null,value:h})}this.actions[d].serialize(f),c.children.push(f)}return c},b.Parse=function(a,c,d){var f=new b(d);null===c?d.actionManager=f:c.actionManager=f;for(var g=function(K,N,T,Z){if(null===Z){var _=parseFloat(N);return"true"===N||"false"===N?"true"===N:isNaN(_)?N:_}for(var ca=Z.split("."),ea=N.split(","),fa=0;fa<ca.length;fa++)T=T[ca[fa]];if("boolean"==typeof T)return"true"===ea[0];if("string"==typeof T)return ea[0];var ka=new Array();for(fa=0;fa<ea.length;fa++)ka.push(parseFloat(ea[fa]));return T instanceof i.e?i.e.FromArray(ka):T instanceof i.f?i.f.FromArray(ka):T instanceof G.a?G.a.FromArray(ka):T instanceof G.b?G.b.FromArray(ka):parseFloat(ea[0])},h=function(K,N,T,Z,_){if(void 0===_&&(_=null),!K.detached){var ca=new Array(),ea=null,fa=null,ka=K.combine&&K.combine.length>0;if(2===K.type?ca.push(f):ca.push(N),ka){for(var pa=new Array(),va=0;va<K.combine.length;va++)h(K.combine[va],b.NothingTrigger,T,Z,pa);ca.push(pa)}else for(var sa=0;sa<K.properties.length;sa++){var la=K.properties[sa].value,ta=K.properties[sa].name,Da=K.properties[sa].targetType;"target"===ta?la=ea=null!==Da&&"SceneProperties"===Da?d:d.getNodeByName(la):"parent"===ta?la=d.getNodeByName(la):"sound"===ta?d.getSoundByName&&(la=d.getSoundByName(la)):"propertyPath"!==ta?la=2===K.type&&"operator"===ta?y[la]:g(0,la,ea,"value"===ta?fa:null):fa=la,ca.push(la)}if(null===_?ca.push(T):ca.push(null),"InterpolateValueAction"===K.name){var ua=ca[ca.length-2];ca[ca.length-1]=ua,ca[ca.length-2]=T}var Aa=function(Fa,La){var Ta=D.a.GetClass("BABYLON."+Fa);if(Ta){var bb=Object.create(Ta.prototype);return bb.constructor.apply(bb,La),bb}}(K.name,ca);if(Aa instanceof s&&null!==T){var za=new Q(N,T);Z?Z.then(za):f.registerAction(za),Z=za}for(null===_?Aa instanceof s?(T=Aa,Aa=Z):(T=null,Z?Z.then(Aa):f.registerAction(Aa)):_.push(Aa),sa=0;sa<K.children.length;sa++)h(K.children[sa],N,T,Aa,null)}},j=0;j<a.children.length;j++){var m,w=a.children[j];if(w.properties.length>0){var z=w.properties[0].value,C=null===w.properties[0].targetType?z:d.getMeshByName(z);C._meshId&&(C.mesh=d.getMeshByID(C._meshId)),m={trigger:b[w.name],parameter:C}}else m=b[w.name];for(var J=0;J<w.children.length;J++)w.detached||h(w.children[J],m,null,null)}},b.GetTriggerName=function(a){switch(a){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},b.NothingTrigger=p.a.ACTION_NothingTrigger,b.OnPickTrigger=p.a.ACTION_OnPickTrigger,b.OnLeftPickTrigger=p.a.ACTION_OnLeftPickTrigger,b.OnRightPickTrigger=p.a.ACTION_OnRightPickTrigger,b.OnCenterPickTrigger=p.a.ACTION_OnCenterPickTrigger,b.OnPickDownTrigger=p.a.ACTION_OnPickDownTrigger,b.OnDoublePickTrigger=p.a.ACTION_OnDoublePickTrigger,b.OnPickUpTrigger=p.a.ACTION_OnPickUpTrigger,b.OnPickOutTrigger=p.a.ACTION_OnPickOutTrigger,b.OnLongPressTrigger=p.a.ACTION_OnLongPressTrigger,b.OnPointerOverTrigger=p.a.ACTION_OnPointerOverTrigger,b.OnPointerOutTrigger=p.a.ACTION_OnPointerOutTrigger,b.OnEveryFrameTrigger=p.a.ACTION_OnEveryFrameTrigger,b.OnIntersectionEnterTrigger=p.a.ACTION_OnIntersectionEnterTrigger,b.OnIntersectionExitTrigger=p.a.ACTION_OnIntersectionExitTrigger,b.OnKeyDownTrigger=p.a.ACTION_OnKeyDownTrigger,b.OnKeyUpTrigger=15,b}(r.a),ma=function(e){function b(a,c,d){var f=e.call(this,a,d)||this;return f._sound=c,f}return Object(l.d)(b,e),b.prototype._prepare=function(){},b.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},a)},b}(E),oa=function(e){function b(a,c,d){var f=e.call(this,a,d)||this;return f._sound=c,f}return Object(l.d)(b,e),b.prototype._prepare=function(){},b.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},a)},b}(E);D.a.RegisteredTypes["BABYLON.PlaySoundAction"]=oa,D.a.RegisteredTypes["BABYLON.StopSoundAction"]=oa;var ja,aa=o(14),F=o(3);!function(e){e[e.STEP=1]="STEP"}(ja||(ja={}));var $=function(){function e(b,a,c){this.name=b,this.from=a,this.to=c}return e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e}(),ia=o(26),ba=o(68),qa=function(){},V=function(){function e(b,a,c,d,f,g){this.name=b,this.targetProperty=a,this.framePerSecond=c,this.dataType=d,this.loopMode=f,this.enableBlending=g,this._runtimeAnimations=new Array(),this._events=new Array(),this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=a.split("."),this.dataType=d,this.loopMode=void 0===f?e.ANIMATIONLOOPMODE_CYCLE:f}return e._PrepareAnimation=function(b,a,c,d,f,g,h,j){var m;if(!isNaN(parseFloat(f))&&isFinite(f)?m=e.ANIMATIONTYPE_FLOAT:f instanceof i.b?m=e.ANIMATIONTYPE_QUATERNION:f instanceof i.e?m=e.ANIMATIONTYPE_VECTOR3:f instanceof i.d?m=e.ANIMATIONTYPE_VECTOR2:f instanceof G.a?m=e.ANIMATIONTYPE_COLOR3:f instanceof G.b?m=e.ANIMATIONTYPE_COLOR4:f instanceof ba.a&&(m=e.ANIMATIONTYPE_SIZE),null==m)return null;var w=new e(b,a,c,m,h),z=[{frame:0,value:f},{frame:d,value:g}];return w.setKeys(z),void 0!==j&&w.setEasingFunction(j),w},e.CreateAnimation=function(b,a,c,d){var f=new e(b+"Animation",b,c,a,e.ANIMATIONLOOPMODE_CONSTANT);return f.setEasingFunction(d),f},e.CreateAndStartAnimation=function(b,a,c,d,f,g,h,j,m,w){var z=e._PrepareAnimation(b,c,d,f,g,h,j,m);return z?a.getScene().beginDirectAnimation(a,[z],0,f,1===z.loopMode,1,w):null},e.CreateAndStartHierarchyAnimation=function(b,a,c,d,f,g,h,j,m,w,z){var C=e._PrepareAnimation(b,d,f,g,h,j,m,w);return C?a.getScene().beginDirectHierarchyAnimation(a,c,[C],0,g,1===C.loopMode,1,z):null},e.CreateMergeAndStartAnimation=function(b,a,c,d,f,g,h,j,m,w){var z=e._PrepareAnimation(b,c,d,f,g,h,j,m);return z?(a.animations.push(z),a.getScene().beginAnimation(a,0,f,1===z.loopMode,1,w)):null},e.TransitionTo=function(b,a,c,d,f,g,h,j){if(void 0===j&&(j=null),h<=0)return c[b]=a,j&&j(),null;var m=f*(h/1000);g.setKeys([{frame:0,value:c[b].clone?c[b].clone():c[b]},{frame:m,value:a}]),c.animations||(c.animations=[]),c.animations.push(g);var w=d.beginAnimation(c,0,m,!1);return w.onAnimationEnd=j,w},Object.defineProperty(e.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var b=0,a=this._runtimeAnimations;b<a.length;b++)if(!a[b].isStopped)return!0;return!1},enumerable:!0,configurable:!0}),e.prototype.toString=function(b){var a="Name: "+this.name+", property: "+this.targetProperty;if(a+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],a+=", nKeys: "+(this._keys?this._keys.length:"none"),a+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),b){a+=", Ranges: {";var c=!0;for(var d in this._ranges)c&&(a+=", ",c=!1),a+=d;a+="}"}return a},e.prototype.addEvent=function(b){this._events.push(b)},e.prototype.removeEvents=function(b){for(var a=0;a<this._events.length;a++)this._events[a].frame===b&&(this._events.splice(a,1),a--)},e.prototype.getEvents=function(){return this._events},e.prototype.createRange=function(b,a,c){this._ranges[b]||(this._ranges[b]=new $(b,a,c))},e.prototype.deleteRange=function(b,a){void 0===a&&(a=!0);var c=this._ranges[b];if(c){if(a)for(var d=c.from,f=c.to,g=this._keys.length-1;g>=0;g--)this._keys[g].frame>=d&&this._keys[g].frame<=f&&this._keys.splice(g,1);this._ranges[b]=null}},e.prototype.getRange=function(b){return this._ranges[b]},e.prototype.getKeys=function(){return this._keys},e.prototype.getHighestFrame=function(){for(var b=0,a=0,c=this._keys.length;a<c;a++)b<this._keys[a].frame&&(b=this._keys[a].frame);return b},e.prototype.getEasingFunction=function(){return this._easingFunction},e.prototype.setEasingFunction=function(b){this._easingFunction=b},e.prototype.floatInterpolateFunction=function(b,a,c){return aa.a.Lerp(b,a,c)},e.prototype.floatInterpolateFunctionWithTangents=function(b,a,c,d,f){return aa.a.Hermite(b,a,c,d,f)},e.prototype.quaternionInterpolateFunction=function(b,a,c){return i.b.Slerp(b,a,c)},e.prototype.quaternionInterpolateFunctionWithTangents=function(b,a,c,d,f){return i.b.Hermite(b,a,c,d,f).normalize()},e.prototype.vector3InterpolateFunction=function(b,a,c){return i.e.Lerp(b,a,c)},e.prototype.vector3InterpolateFunctionWithTangents=function(b,a,c,d,f){return i.e.Hermite(b,a,c,d,f)},e.prototype.vector2InterpolateFunction=function(b,a,c){return i.d.Lerp(b,a,c)},e.prototype.vector2InterpolateFunctionWithTangents=function(b,a,c,d,f){return i.d.Hermite(b,a,c,d,f)},e.prototype.sizeInterpolateFunction=function(b,a,c){return ba.a.Lerp(b,a,c)},e.prototype.color3InterpolateFunction=function(b,a,c){return G.a.Lerp(b,a,c)},e.prototype.color4InterpolateFunction=function(b,a,c){return G.b.Lerp(b,a,c)},e.prototype._getKeyValue=function(b){return"function"==typeof b?b():b},e.prototype._interpolate=function(b,a){if(a.loopMode===e.ANIMATIONLOOPMODE_CONSTANT&&a.repeatCount>0)return a.highLimitValue.clone?a.highLimitValue.clone():a.highLimitValue;var c=this._keys;if(1===c.length)return this._getKeyValue(c[0].value);var d=a.key;if(c[d].frame>=b)for(;d-1>=0&&c[d].frame>=b;)d--;for(var f=d;f<c.length;f++){var g=c[f+1];if(g.frame>=b){a.key=f;var h=c[f],j=this._getKeyValue(h.value);if(h.interpolation===ja.STEP)return j;var m=this._getKeyValue(g.value),w=void 0!==h.outTangent&&void 0!==g.inTangent,z=g.frame-h.frame,C=(b-h.frame)/z,J=this.getEasingFunction();switch(null!=J&&(C=J.ease(C)),this.dataType){case e.ANIMATIONTYPE_FLOAT:var K=w?this.floatInterpolateFunctionWithTangents(j,h.outTangent*z,m,g.inTangent*z,C):this.floatInterpolateFunction(j,m,C);switch(a.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return K;case e.ANIMATIONLOOPMODE_RELATIVE:return a.offsetValue*a.repeatCount+K}break;case e.ANIMATIONTYPE_QUATERNION:var N=w?this.quaternionInterpolateFunctionWithTangents(j,h.outTangent.scale(z),m,g.inTangent.scale(z),C):this.quaternionInterpolateFunction(j,m,C);switch(a.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return N;case e.ANIMATIONLOOPMODE_RELATIVE:return N.addInPlace(a.offsetValue.scale(a.repeatCount))}return N;case e.ANIMATIONTYPE_VECTOR3:var T=w?this.vector3InterpolateFunctionWithTangents(j,h.outTangent.scale(z),m,g.inTangent.scale(z),C):this.vector3InterpolateFunction(j,m,C);switch(a.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return T;case e.ANIMATIONLOOPMODE_RELATIVE:return T.add(a.offsetValue.scale(a.repeatCount))}case e.ANIMATIONTYPE_VECTOR2:var Z=w?this.vector2InterpolateFunctionWithTangents(j,h.outTangent.scale(z),m,g.inTangent.scale(z),C):this.vector2InterpolateFunction(j,m,C);switch(a.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return Z;case e.ANIMATIONLOOPMODE_RELATIVE:return Z.add(a.offsetValue.scale(a.repeatCount))}case e.ANIMATIONTYPE_SIZE:switch(a.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(j,m,C);case e.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(j,m,C).add(a.offsetValue.scale(a.repeatCount))}case e.ANIMATIONTYPE_COLOR3:switch(a.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(j,m,C);case e.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(j,m,C).add(a.offsetValue.scale(a.repeatCount))}case e.ANIMATIONTYPE_COLOR4:switch(a.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(j,m,C);case e.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(j,m,C).add(a.offsetValue.scale(a.repeatCount))}case e.ANIMATIONTYPE_MATRIX:switch(a.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:if(e.AllowMatricesInterpolation)return this.matrixInterpolateFunction(j,m,C,a.workValue);case e.ANIMATIONLOOPMODE_RELATIVE:return j}}break}}return this._getKeyValue(c[c.length-1].value)},e.prototype.matrixInterpolateFunction=function(b,a,c,d){return e.AllowMatrixDecomposeForInterpolation?d?(i.a.DecomposeLerpToRef(b,a,c,d),d):i.a.DecomposeLerp(b,a,c):d?(i.a.LerpToRef(b,a,c,d),d):i.a.Lerp(b,a,c)},e.prototype.clone=function(){var b=new e(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(b.enableBlending=this.enableBlending,b.blendingSpeed=this.blendingSpeed,this._keys&&b.setKeys(this._keys),this._ranges)for(var a in b._ranges={},this._ranges){var c=this._ranges[a];c&&(b._ranges[a]=c.clone())}return b},e.prototype.setKeys=function(b){this._keys=b.slice(0)},e.prototype.serialize=function(){var b={};b.name=this.name,b.property=this.targetProperty,b.framePerSecond=this.framePerSecond,b.dataType=this.dataType,b.loopBehavior=this.loopMode,b.enableBlending=this.enableBlending,b.blendingSpeed=this.blendingSpeed;var a=this.dataType;b.keys=[];for(var c=this.getKeys(),d=0;d<c.length;d++){var f=c[d],g={};switch(g.frame=f.frame,a){case e.ANIMATIONTYPE_FLOAT:g.values=[f.value];break;case e.ANIMATIONTYPE_QUATERNION:case e.ANIMATIONTYPE_MATRIX:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:case e.ANIMATIONTYPE_COLOR4:g.values=f.value.asArray()}b.keys.push(g)}for(var h in b.ranges=[],this._ranges){var j=this._ranges[h];if(j){var m={};m.name=h,m.from=j.from,m.to=j.to,b.ranges.push(m)}}return b},e._UniversalLerp=function(b,a,c){var d=b.constructor;return d.Lerp?d.Lerp(b,a,c):d.Slerp?d.Slerp(b,a,c):b.toFixed?b*(1-c)+c*a:a},e.Parse=function(b){var a,c,d=new e(b.name,b.property,b.framePerSecond,b.dataType,b.loopBehavior),f=b.dataType,g=[];for(b.enableBlending&&(d.enableBlending=b.enableBlending),b.blendingSpeed&&(d.blendingSpeed=b.blendingSpeed),c=0;c<b.keys.length;c++){var h,j,m=b.keys[c];switch(f){case e.ANIMATIONTYPE_FLOAT:a=m.values[0],m.values.length>=1&&(h=m.values[1]),m.values.length>=2&&(j=m.values[2]);break;case e.ANIMATIONTYPE_QUATERNION:if(a=i.b.FromArray(m.values),m.values.length>=8){var w=i.b.FromArray(m.values.slice(4,8));w.equals(i.b.Zero())||(h=w)}if(m.values.length>=12){var z=i.b.FromArray(m.values.slice(8,12));z.equals(i.b.Zero())||(j=z)}break;case e.ANIMATIONTYPE_MATRIX:a=i.a.FromArray(m.values);break;case e.ANIMATIONTYPE_COLOR3:a=G.a.FromArray(m.values);break;case e.ANIMATIONTYPE_COLOR4:a=G.b.FromArray(m.values);break;case e.ANIMATIONTYPE_VECTOR3:default:a=i.e.FromArray(m.values)}var C={};C.frame=m.frame,C.value=a,null!=h&&(C.inTangent=h),null!=j&&(C.outTangent=j),g.push(C)}if(d.setKeys(g),b.ranges)for(c=0;c<b.ranges.length;c++)a=b.ranges[c],d.createRange(a.name,a.from,a.to);return d},e.AppendSerializedAnimations=function(b,a){F.a.AppendSerializedAnimations(b,a)},e.AllowMatricesInterpolation=!1,e.AllowMatrixDecomposeForInterpolation=!0,e.ANIMATIONTYPE_FLOAT=0,e.ANIMATIONTYPE_VECTOR3=1,e.ANIMATIONTYPE_QUATERNION=2,e.ANIMATIONTYPE_MATRIX=3,e.ANIMATIONTYPE_COLOR3=4,e.ANIMATIONTYPE_COLOR4=7,e.ANIMATIONTYPE_VECTOR2=5,e.ANIMATIONTYPE_SIZE=6,e.ANIMATIONLOOPMODE_RELATIVE=0,e.ANIMATIONLOOPMODE_CYCLE=1,e.ANIMATIONLOOPMODE_CONSTANT=2,e}();D.a.RegisteredTypes["BABYLON.Animation"]=V,ia.a._AnimationRangeFactory=function(e,b,a){return new $(e,b,a)};var O=function(e){function b(a,c,d,f,g,h,j,m){void 0===g&&(g=1000);var w=e.call(this,a,h)||this;return w.duration=1000,w.onInterpolationDoneObservable=new I.c(),w.propertyPath=d,w.value=f,w.duration=g,w.stopOtherAnimations=j,w.onInterpolationDone=m,w._target=w._effectiveTarget=c,w}return Object(l.d)(b,e),b.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},b.prototype.execute=function(){var a,c=this,d=this._actionManager.getScene(),f=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)a=V.ANIMATIONTYPE_FLOAT;else if(this.value instanceof G.a)a=V.ANIMATIONTYPE_COLOR3;else if(this.value instanceof i.e)a=V.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof i.a)a=V.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof i.b))return void k.a.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");a=V.ANIMATIONTYPE_QUATERNION}var g=new V("InterpolateValueAction",this._property,1000/this.duration*100,a,V.ANIMATIONLOOPMODE_CONSTANT);g.setKeys(f),this.stopOtherAnimations&&d.stopAnimation(this._effectiveTarget),d.beginDirectAnimation(this._effectiveTarget,[g],0,100,!1,1,function(){c.onInterpolationDoneObservable.notifyObservers(c),c.onInterpolationDone&&c.onInterpolationDone()})},b.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[E._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:E._SerializeValueAsString(this.value)},{name:"duration",value:E._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:E._SerializeValueAsString(this.stopOtherAnimations)||!1}]},a)},b}(E);D.a.RegisteredTypes["BABYLON.InterpolateValueAction"]=O;var S=Object.freeze(new i.b(0,0,0,0)),W=Object.freeze(i.e.Zero()),da=Object.freeze(i.d.Zero()),na=Object.freeze(ba.a.Zero()),Ea=Object.freeze(G.a.Black()),Ca=function(){function e(b,a,c,d){var f=this;if(this._events=new Array(),this._currentFrame=0,this._originalValue=new Array(),this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=a,this._target=b,this._scene=c,this._host=d,this._activeTargets=[],a._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===V.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=i.a.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){var g={frame:0,value:this._minValue};this._keys.splice(0,0,g)}if(this._target instanceof Array){for(var h=0,j=0,m=this._target;j<m.length;j++){var w=m[j];this._preparePath(w,h),this._getOriginalValues(h),h++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var z=a.getEvents();z&&z.length>0&&z.forEach(function(C){f._events.push(C._clone())}),this._enableBlending=b&&b.animationPropertiesOverride?b.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(e.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!0,configurable:!0}),e.prototype._preparePath=function(b,a){void 0===a&&(a=0);var c=this._animation.targetPropertyPath;if(c.length>1){for(var d=b[c[0]],f=1;f<c.length-1;f++)d=d[c[f]];this._targetPath=c[c.length-1],this._activeTargets[a]=d}else this._targetPath=c[0],this._activeTargets[a]=b},Object.defineProperty(e.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),e.prototype.reset=function(b){if(void 0===b&&(b=!1),b)if(this._target instanceof Array)for(var a=0,c=0,d=this._target;c<d.length;c++){var f=d[c];void 0!==this._originalValue[a]&&this._setValue(f,this._activeTargets[a],this._originalValue[a],-1,a),a++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);for(this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,a=0;a<this._events.length;a++)this._events[a].isDone=!1},e.prototype.isStopped=function(){return this._stopped},e.prototype.dispose=function(){var b=this._animation.runtimeAnimations.indexOf(this);b>-1&&this._animation.runtimeAnimations.splice(b,1)},e.prototype.setValue=function(b,a){if(this._targetIsArray)for(var c=0;c<this._target.length;c++){var d=this._target[c];this._setValue(d,this._activeTargets[c],b,a,c)}else this._setValue(this._target,this._directTarget,b,a,0)},e.prototype._getOriginalValues=function(b){var a;void 0===b&&(b=0);var c=this._activeTargets[b];(a=c.getRestPose&&"_matrix"===this._targetPath?c.getRestPose():c[this._targetPath])&&a.clone?this._originalValue[b]=a.clone():this._originalValue[b]=a},e.prototype._setValue=function(b,a,c,d,f){if(this._currentActiveTarget=a,this._weight=d,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var g=a[this._targetPath];g.clone?this._originalBlendValue=g.clone():this._originalBlendValue=g}this._originalBlendValue.m?V.AllowMatrixDecomposeForInterpolation?this._currentValue?i.a.DecomposeLerpToRef(this._originalBlendValue,c,this._blendingFactor,this._currentValue):this._currentValue=i.a.DecomposeLerp(this._originalBlendValue,c,this._blendingFactor):this._currentValue?i.a.LerpToRef(this._originalBlendValue,c,this._blendingFactor,this._currentValue):this._currentValue=i.a.Lerp(this._originalBlendValue,c,this._blendingFactor):this._currentValue=V._UniversalLerp(this._originalBlendValue,c,this._blendingFactor);var h=b&&b.animationPropertiesOverride?b.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=h}else this._currentValue=c;-1!==d?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[f]):a[this._targetPath]=this._currentValue,b.markAsDirty&&b.markAsDirty(this._animation.targetProperty)},e.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},e.prototype.goToFrame=function(b){var a=this._animation.getKeys();b<a[0].frame?b=a[0].frame:b>a[a.length-1].frame&&(b=a[a.length-1].frame);var c=this._events;if(c.length)for(var d=0;d<c.length;d++)c[d].onlyOnce||(c[d].isDone=c[d].frame<b);this._currentFrame=b;var f=this._animation._interpolate(b,this._animationState);this.setValue(f,-1)},e.prototype._prepareForSpeedRatioChange=function(b){var a=this._previousDelay*(this._animation.framePerSecond*b)/1000;this._ratioOffset=this._previousRatio-a},e.prototype.animate=function(b,a,c,d,f,g){void 0===g&&(g=-1);var h=this._animation,j=h.targetPropertyPath;if(!j||j.length<1)return this._stopped=!0,!1;var m=!0;(a<this._minFrame||a>this._maxFrame)&&(a=this._minFrame),(c<this._minFrame||c>this._maxFrame)&&(c=this._maxFrame);var w,z,C=c-a,J=b*(h.framePerSecond*f)/1000+this._ratioOffset,K=0;if(this._previousDelay=b,this._previousRatio=J,!d&&c>=a&&J>=C)m=!1,K=h._getKeyValue(this._maxValue);else if(!d&&a>=c&&J<=C)m=!1,K=h._getKeyValue(this._minValue);else if(this._animationState.loopMode!==V.ANIMATIONLOOPMODE_CYCLE){var N=c.toString()+a.toString();if(!this._offsetsCache[N]){this._animationState.repeatCount=0,this._animationState.loopMode=V.ANIMATIONLOOPMODE_CYCLE;var T=h._interpolate(a,this._animationState),Z=h._interpolate(c,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),h.dataType){case V.ANIMATIONTYPE_FLOAT:this._offsetsCache[N]=Z-T;break;case V.ANIMATIONTYPE_QUATERNION:this._offsetsCache[N]=Z.subtract(T);break;case V.ANIMATIONTYPE_VECTOR3:this._offsetsCache[N]=Z.subtract(T);case V.ANIMATIONTYPE_VECTOR2:this._offsetsCache[N]=Z.subtract(T);case V.ANIMATIONTYPE_SIZE:this._offsetsCache[N]=Z.subtract(T);case V.ANIMATIONTYPE_COLOR3:this._offsetsCache[N]=Z.subtract(T)}this._highLimitsCache[N]=Z}K=this._highLimitsCache[N],w=this._offsetsCache[N]}if(void 0===w)switch(h.dataType){case V.ANIMATIONTYPE_FLOAT:w=0;break;case V.ANIMATIONTYPE_QUATERNION:w=S;break;case V.ANIMATIONTYPE_VECTOR3:w=W;break;case V.ANIMATIONTYPE_VECTOR2:w=da;break;case V.ANIMATIONTYPE_SIZE:w=na;break;case V.ANIMATIONTYPE_COLOR3:w=Ea}if(this._host&&this._host.syncRoot){var _=this._host.syncRoot;z=a+(c-a)*((_.masterFrame-_.fromFrame)/(_.toFrame-_.fromFrame))}else z=m&&0!==C?a+J%C:c;var ca=this._events;if((C>0&&this.currentFrame>z||C<0&&this.currentFrame<z)&&(this._onLoop(),ca.length))for(var ea=0;ea<ca.length;ea++)ca[ea].onlyOnce||(ca[ea].isDone=!1);this._currentFrame=z,this._animationState.repeatCount=0===C?0:J/C>>0,this._animationState.highLimitValue=K,this._animationState.offsetValue=w;var fa=h._interpolate(z,this._animationState);if(this.setValue(fa,g),ca.length){for(ea=0;ea<ca.length;ea++)if(C>0&&z>=ca[ea].frame&&ca[ea].frame>=a||C<0&&z<=ca[ea].frame&&ca[ea].frame<=a){var ka=ca[ea];ka.isDone||(ka.onlyOnce&&(ca.splice(ea,1),ea--),ka.isDone=!0,ka.action(z))}}return m||(this._stopped=!0),m},e}(),wa=o(18),Ka=o(52),Ga=o(42),Ba=o(22),Na=function(e){function b(a,c,d,f,g,h,j){void 0===d&&(d=null),void 0===f&&(f=null),void 0===g&&(g=null),void 0===h&&(h=null),void 0===j&&(j=null);var m=e.call(this,a,c.getScene())||this;return m.name=a,m.children=new Array(),m.animations=new Array(),m._index=null,m._absoluteTransform=new i.a(),m._invertedAbsoluteTransform=new i.a(),m._scalingDeterminant=1,m._worldTransform=new i.a(),m._needToDecompose=!0,m._needToCompose=!1,m._linkedTransformNode=null,m._waitingTransformNodeId=null,m._skeleton=c,m._localMatrix=f?f.clone():i.a.Identity(),m._restPose=g||m._localMatrix.clone(),m._baseMatrix=h||m._localMatrix.clone(),m._index=j,c.bones.push(m),m.setParent(d,!1),(h||f)&&m._updateDifferenceMatrix(),m}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(a){this._localMatrix.copyFrom(a),this._needToDecompose=!0},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"Bone"},b.prototype.getSkeleton=function(){return this._skeleton},b.prototype.getParent=function(){return this._parent},b.prototype.getChildren=function(){return this.children},b.prototype.getIndex=function(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index},b.prototype.setParent=function(a,c){if(void 0===c&&(c=!0),this._parent!==a){if(this._parent){var d=this._parent.children.indexOf(this);-1!==d&&this._parent.children.splice(d,1)}this._parent=a,this._parent&&this._parent.children.push(this),c&&this._updateDifferenceMatrix(),this.markAsDirty()}},b.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},b.prototype.getBaseMatrix=function(){return this._baseMatrix},b.prototype.getRestPose=function(){return this._restPose},b.prototype.getWorldMatrix=function(){return this._worldTransform},b.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},b.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},b.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},b.prototype.linkTransformNode=function(a){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=a,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},b.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(b.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(a){this._decompose(),this._localPosition.copyFrom(a),this._markAsDirtyAndCompose()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotation",{get:function(){return this.getRotation()},set:function(a){this.setRotation(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(a){this.setRotationQuaternion(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaling",{get:function(){return this.getScale()},set:function(a){this.setScale(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!0,configurable:!0}),b.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=i.e.Zero(),this._localRotation=i.b.Zero(),this._localPosition=i.e.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},b.prototype._compose=function(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,i.a.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)},b.prototype.updateMatrix=function(a,c,d){void 0===c&&(c=!0),void 0===d&&(d=!0),this._baseMatrix.copyFrom(a),c&&this._updateDifferenceMatrix(),d?(this._localMatrix.copyFrom(a),this._markAsDirtyAndDecompose()):this.markAsDirty()},b.prototype._updateDifferenceMatrix=function(a,c){if(void 0===c&&(c=!0),a||(a=this._baseMatrix),this._parent?a.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(a),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),c)for(var d=0;d<this.children.length;d++)this.children[d]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},b.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},b.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},b.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},b.prototype.translate=function(a,c,d){void 0===c&&(c=Ba.b.LOCAL);var f=this.getLocalMatrix();if(c==Ba.b.LOCAL)f.addAtIndex(12,a.x),f.addAtIndex(13,a.y),f.addAtIndex(14,a.z);else{var g=null;d&&(g=d.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=b._tmpMats[0],j=b._tmpVecs[0];this._parent&&(d&&g?(h.copyFrom(this._parent.getAbsoluteTransform()),h.multiplyToRef(g,h)):h.copyFrom(this._parent.getAbsoluteTransform())),h.setTranslationFromFloats(0,0,0),h.invert(),i.e.TransformCoordinatesToRef(a,h,j),f.addAtIndex(12,j.x),f.addAtIndex(13,j.y),f.addAtIndex(14,j.z)}this._markAsDirtyAndDecompose()},b.prototype.setPosition=function(a,c,d){void 0===c&&(c=Ba.b.LOCAL);var f=this.getLocalMatrix();if(c==Ba.b.LOCAL)f.setTranslationFromFloats(a.x,a.y,a.z);else{var g=null;d&&(g=d.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=b._tmpMats[0],j=b._tmpVecs[0];this._parent&&(d&&g?(h.copyFrom(this._parent.getAbsoluteTransform()),h.multiplyToRef(g,h)):h.copyFrom(this._parent.getAbsoluteTransform())),h.invert(),i.e.TransformCoordinatesToRef(a,h,j),f.setTranslationFromFloats(j.x,j.y,j.z)}this._markAsDirtyAndDecompose()},b.prototype.setAbsolutePosition=function(a,c){this.setPosition(a,Ba.b.WORLD,c)},b.prototype.scale=function(a,c,d,f){void 0===f&&(f=!1);var g=this.getLocalMatrix(),h=b._tmpMats[0];i.a.ScalingToRef(a,c,d,h),h.multiplyToRef(g,g),h.invert();for(var j=0,m=this.children;j<m.length;j++){var w=(J=m[j]).getLocalMatrix();w.multiplyToRef(h,w),w.multiplyAtIndex(12,a),w.multiplyAtIndex(13,c),w.multiplyAtIndex(14,d),J._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),f)for(var z=0,C=this.children;z<C.length;z++){var J;(J=C[z]).scale(a,c,d,f)}},b.prototype.setScale=function(a){this._decompose(),this._localScaling.copyFrom(a),this._markAsDirtyAndCompose()},b.prototype.getScale=function(){return this._decompose(),this._localScaling},b.prototype.getScaleToRef=function(a){this._decompose(),a.copyFrom(this._localScaling)},b.prototype.setYawPitchRoll=function(a,c,d,f,g){if(void 0===f&&(f=Ba.b.LOCAL),f===Ba.b.LOCAL){var h=b._tmpQuat;return i.b.RotationYawPitchRollToRef(a,c,d,h),void this.setRotationQuaternion(h,f,g)}var j=b._tmpMats[0];if(this._getNegativeRotationToRef(j,g)){var m=b._tmpMats[1];i.a.RotationYawPitchRollToRef(a,c,d,m),j.multiplyToRef(m,m),this._rotateWithMatrix(m,f,g)}},b.prototype.rotate=function(a,c,d,f){void 0===d&&(d=Ba.b.LOCAL);var g=b._tmpMats[0];g.setTranslationFromFloats(0,0,0),i.a.RotationAxisToRef(a,c,g),this._rotateWithMatrix(g,d,f)},b.prototype.setAxisAngle=function(a,c,d,f){if(void 0===d&&(d=Ba.b.LOCAL),d===Ba.b.LOCAL){var g=b._tmpQuat;return i.b.RotationAxisToRef(a,c,g),void this.setRotationQuaternion(g,d,f)}var h=b._tmpMats[0];if(this._getNegativeRotationToRef(h,f)){var j=b._tmpMats[1];i.a.RotationAxisToRef(a,c,j),h.multiplyToRef(j,j),this._rotateWithMatrix(j,d,f)}},b.prototype.setRotation=function(a,c,d){void 0===c&&(c=Ba.b.LOCAL),this.setYawPitchRoll(a.y,a.x,a.z,c,d)},b.prototype.setRotationQuaternion=function(a,c,d){if(void 0===c&&(c=Ba.b.LOCAL),c===Ba.b.LOCAL)return this._decompose(),this._localRotation.copyFrom(a),void this._markAsDirtyAndCompose();var f=b._tmpMats[0];if(this._getNegativeRotationToRef(f,d)){var g=b._tmpMats[1];i.a.FromQuaternionToRef(a,g),f.multiplyToRef(g,g),this._rotateWithMatrix(g,c,d)}},b.prototype.setRotationMatrix=function(a,c,d){if(void 0===c&&(c=Ba.b.LOCAL),c===Ba.b.LOCAL){var f=b._tmpQuat;return i.b.FromRotationMatrixToRef(a,f),void this.setRotationQuaternion(f,c,d)}var g=b._tmpMats[0];if(this._getNegativeRotationToRef(g,d)){var h=b._tmpMats[1];h.copyFrom(a),g.multiplyToRef(a,h),this._rotateWithMatrix(h,c,d)}},b.prototype._rotateWithMatrix=function(a,c,d){void 0===c&&(c=Ba.b.LOCAL);var f=this.getLocalMatrix(),g=f.m[12],h=f.m[13],j=f.m[14],m=this.getParent(),w=b._tmpMats[3],z=b._tmpMats[4];m&&c==Ba.b.WORLD?(d?(w.copyFrom(d.getWorldMatrix()),m.getAbsoluteTransform().multiplyToRef(w,w)):w.copyFrom(m.getAbsoluteTransform()),z.copyFrom(w),z.invert(),f.multiplyToRef(w,f),f.multiplyToRef(a,f),f.multiplyToRef(z,f)):c==Ba.b.WORLD&&d?(w.copyFrom(d.getWorldMatrix()),z.copyFrom(w),z.invert(),f.multiplyToRef(w,f),f.multiplyToRef(a,f),f.multiplyToRef(z,f)):f.multiplyToRef(a,f),f.setTranslationFromFloats(g,h,j),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},b.prototype._getNegativeRotationToRef=function(a,c){var d=b._tmpMats[2];return a.copyFrom(this.getAbsoluteTransform()),c&&(a.multiplyToRef(c.getWorldMatrix(),a),i.a.ScalingToRef(c.scaling.x,c.scaling.y,c.scaling.z,d)),a.invert(),!isNaN(a.m[0])&&(d.multiplyAtIndex(0,this._scalingDeterminant),a.multiplyToRef(d,a),!0)},b.prototype.getPosition=function(a,c){void 0===a&&(a=Ba.b.LOCAL),void 0===c&&(c=null);var d=i.e.Zero();return this.getPositionToRef(a,c,d),d},b.prototype.getPositionToRef=function(a,c,d){if(void 0===a&&(a=Ba.b.LOCAL),a==Ba.b.LOCAL){var f=this.getLocalMatrix();d.x=f.m[12],d.y=f.m[13],d.z=f.m[14]}else{var g=null;c&&(g=c.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=b._tmpMats[0];c&&g?(h.copyFrom(this.getAbsoluteTransform()),h.multiplyToRef(g,h)):h=this.getAbsoluteTransform(),d.x=h.m[12],d.y=h.m[13],d.z=h.m[14]}},b.prototype.getAbsolutePosition=function(a){void 0===a&&(a=null);var c=i.e.Zero();return this.getPositionToRef(Ba.b.WORLD,a,c),c},b.prototype.getAbsolutePositionToRef=function(a,c){this.getPositionToRef(Ba.b.WORLD,a,c)},b.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var a=this._skeleton.getPoseMatrix();a&&this._absoluteTransform.multiplyToRef(a,this._absoluteTransform)}for(var c=this.children,d=c.length,f=0;f<d;f++)c[f].computeAbsoluteTransforms()},b.prototype.getDirection=function(a,c){void 0===c&&(c=null);var d=i.e.Zero();return this.getDirectionToRef(a,c,d),d},b.prototype.getDirectionToRef=function(a,c,d){void 0===c&&(c=null);var f=null;c&&(f=c.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var g=b._tmpMats[0];g.copyFrom(this.getAbsoluteTransform()),c&&f&&g.multiplyToRef(f,g),i.e.TransformNormalToRef(a,g,d),d.normalize()},b.prototype.getRotation=function(a,c){void 0===a&&(a=Ba.b.LOCAL),void 0===c&&(c=null);var d=i.e.Zero();return this.getRotationToRef(a,c,d),d},b.prototype.getRotationToRef=function(a,c,d){void 0===a&&(a=Ba.b.LOCAL),void 0===c&&(c=null);var f=b._tmpQuat;this.getRotationQuaternionToRef(a,c,f),f.toEulerAnglesToRef(d)},b.prototype.getRotationQuaternion=function(a,c){void 0===a&&(a=Ba.b.LOCAL),void 0===c&&(c=null);var d=i.b.Identity();return this.getRotationQuaternionToRef(a,c,d),d},b.prototype.getRotationQuaternionToRef=function(a,c,d){if(void 0===a&&(a=Ba.b.LOCAL),void 0===c&&(c=null),a==Ba.b.LOCAL)this._decompose(),d.copyFrom(this._localRotation);else{var f=b._tmpMats[0],g=this.getAbsoluteTransform();c?g.multiplyToRef(c.getWorldMatrix(),f):f.copyFrom(g),f.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyAtIndex(1,this._scalingDeterminant),f.multiplyAtIndex(2,this._scalingDeterminant),f.decompose(void 0,d,void 0)}},b.prototype.getRotationMatrix=function(a,c){void 0===a&&(a=Ba.b.LOCAL);var d=i.a.Identity();return this.getRotationMatrixToRef(a,c,d),d},b.prototype.getRotationMatrixToRef=function(a,c,d){if(void 0===a&&(a=Ba.b.LOCAL),a==Ba.b.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(d);else{var f=b._tmpMats[0],g=this.getAbsoluteTransform();c?g.multiplyToRef(c.getWorldMatrix(),f):f.copyFrom(g),f.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyAtIndex(1,this._scalingDeterminant),f.multiplyAtIndex(2,this._scalingDeterminant),f.getRotationMatrixToRef(d)}},b.prototype.getAbsolutePositionFromLocal=function(a,c){void 0===c&&(c=null);var d=i.e.Zero();return this.getAbsolutePositionFromLocalToRef(a,c,d),d},b.prototype.getAbsolutePositionFromLocalToRef=function(a,c,d){void 0===c&&(c=null);var f=null;c&&(f=c.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var g=b._tmpMats[0];c&&f?(g.copyFrom(this.getAbsoluteTransform()),g.multiplyToRef(f,g)):g=this.getAbsoluteTransform(),i.e.TransformCoordinatesToRef(a,g,d)},b.prototype.getLocalPositionFromAbsolute=function(a,c){void 0===c&&(c=null);var d=i.e.Zero();return this.getLocalPositionFromAbsoluteToRef(a,c,d),d},b.prototype.getLocalPositionFromAbsoluteToRef=function(a,c,d){void 0===c&&(c=null);var f=null;c&&(f=c.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var g=b._tmpMats[0];g.copyFrom(this.getAbsoluteTransform()),c&&f&&g.multiplyToRef(f,g),g.invert(),i.e.TransformCoordinatesToRef(a,g,d)},b._tmpVecs=Ga.a.BuildArray(2,i.e.Zero),b._tmpQuat=i.b.Identity(),b._tmpMats=Ga.a.BuildArray(5,i.a.Identity),b}(ia.a),db=function(){function e(b,a,c,d,f,g,h,j,m){void 0===c&&(c=0),void 0===d&&(d=100),void 0===f&&(f=!1),void 0===g&&(g=1),this.target=a,this.fromFrame=c,this.toFrame=d,this.loopAnimation=f,this.onAnimationEnd=h,this.onAnimationLoop=m,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array(),this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new I.c(),this.onAnimationLoopObservable=new I.c(),this._scene=b,j&&this.appendAnimations(a,j),this._speedRatio=g,b._activeAnimatables.push(this)}return Object.defineProperty(e.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"masterFrame",{get:function(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},set:function(b){this._weight=-1!==b?Math.min(Math.max(b,0),1):-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(b){for(var a=0;a<this._runtimeAnimations.length;a++)this._runtimeAnimations[a]._prepareForSpeedRatioChange(b);this._speedRatio=b},enumerable:!0,configurable:!0}),e.prototype.syncWith=function(b){if(this._syncRoot=b,b){var a=this._scene._activeAnimatables.indexOf(this);a>-1&&(this._scene._activeAnimatables.splice(a,1),this._scene._activeAnimatables.push(this))}return this},e.prototype.getAnimations=function(){return this._runtimeAnimations},e.prototype.appendAnimations=function(b,a){for(var c=this,d=0;d<a.length;d++){var f=a[d],g=new Ca(b,f,this._scene,this);g._onLoop=function(){c.onAnimationLoopObservable.notifyObservers(c),c.onAnimationLoop&&c.onAnimationLoop()},this._runtimeAnimations.push(g)}},e.prototype.getAnimationByTargetProperty=function(b){for(var a=this._runtimeAnimations,c=0;c<a.length;c++)if(a[c].animation.targetProperty===b)return a[c].animation;return null},e.prototype.getRuntimeAnimationByTargetProperty=function(b){for(var a=this._runtimeAnimations,c=0;c<a.length;c++)if(a[c].animation.targetProperty===b)return a[c];return null},e.prototype.reset=function(){for(var b=this._runtimeAnimations,a=0;a<b.length;a++)b[a].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},e.prototype.enableBlending=function(b){for(var a=this._runtimeAnimations,c=0;c<a.length;c++)a[c].animation.enableBlending=!0,a[c].animation.blendingSpeed=b},e.prototype.disableBlending=function(){for(var b=this._runtimeAnimations,a=0;a<b.length;a++)b[a].animation.enableBlending=!1},e.prototype.goToFrame=function(b){var a=this._runtimeAnimations;if(a[0]){var c=a[0].animation.framePerSecond,d=b-a[0].currentFrame,f=0!==this.speedRatio?1000*d/(c*this.speedRatio):0;null===this._localDelayOffset&&(this._localDelayOffset=0),this._localDelayOffset-=f}for(var g=0;g<a.length;g++)a[g].goToFrame(b)},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.restart=function(){this._paused=!1},e.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},e.prototype.stop=function(b,a){if(b||a){var c=this._scene._activeAnimatables.indexOf(this);if(c>-1){for(var d=(g=this._runtimeAnimations).length-1;d>=0;d--){var f=g[d];b&&f.animation.name!=b||(a&&!a(f.target)||(f.dispose(),g.splice(d,1)))}0==g.length&&(this._scene._activeAnimatables.splice(c,1),this._raiseOnAnimationEnd())}}else if((d=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(d,1);var g=this._runtimeAnimations;for(d=0;d<g.length;d++)g[d].dispose();this._raiseOnAnimationEnd()}},e.prototype.waitAsync=function(){var b=this;return new Promise(function(a,c){b.onAnimationEndObservable.add(function(){a(b)},void 0,void 0,b,!0)})},e.prototype._animate=function(b){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=b),!0;if(null===this._localDelayOffset?(this._localDelayOffset=b,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=b-this._pausedDelay,this._pausedDelay=null),0===this._weight)return!0;var a,c=!1,d=this._runtimeAnimations;for(a=0;a<d.length;a++){var f=d[a].animate(b-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);c=c||f}if(this.animationStarted=c,!c){if(this.disposeOnEnd)for(a=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(a,1),a=0;a<d.length;a++)d[a].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return c},e}();wa.a.prototype._animate=function(){if(this.animationsEnabled){var e=Ka.a.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=e}this.deltaTime=this.useConstantAnimationDeltaTime?16:(e-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=e;var b=this._activeAnimatables;if(0!==b.length){this._animationTime+=this.deltaTime;for(var a=this._animationTime,c=0;c<b.length;c++){var d=b[c];!d._animate(a)&&d.disposeOnEnd&&c--}this._processLateAnimationBindings()}}},wa.a.prototype.beginWeightedAnimation=function(e,b,a,c,d,f,g,h,j,m){void 0===c&&(c=1),void 0===f&&(f=1);var w=this.beginAnimation(e,b,a,d,f,g,h,!1,j,m);return w.weight=c,w},wa.a.prototype.beginAnimation=function(e,b,a,c,d,f,g,h,j,m){void 0===d&&(d=1),void 0===h&&(h=!0),b>a&&d>0&&(d*=-1),h&&this.stopAnimation(e,void 0,j),g||(g=new db(this,e,b,a,c,d,f,void 0,m));var w=!j||j(e);if(e.animations&&w&&g.appendAnimations(e,e.animations),e.getAnimatables)for(var z=e.getAnimatables(),C=0;C<z.length;C++)this.beginAnimation(z[C],b,a,c,d,f,g,h,j,m);return g.reset(),g},wa.a.prototype.beginHierarchyAnimation=function(e,b,a,c,d,f,g,h,j,m,w){void 0===f&&(f=1),void 0===j&&(j=!0);var z=e.getDescendants(b),C=[];C.push(this.beginAnimation(e,a,c,d,f,g,h,j,m));for(var J=0,K=z;J<K.length;J++){var N=K[J];C.push(this.beginAnimation(N,a,c,d,f,g,h,j,m))}return C},wa.a.prototype.beginDirectAnimation=function(e,b,a,c,d,f,g,h){return void 0===f&&(f=1),a>c&&f>0&&(f*=-1),new db(this,e,a,c,d,f,g,b,h)},wa.a.prototype.beginDirectHierarchyAnimation=function(e,b,a,c,d,f,g,h,j){var m=e.getDescendants(b),w=[];w.push(this.beginDirectAnimation(e,a,c,d,f,g,h,j));for(var z=0,C=m;z<C.length;z++){var J=C[z];w.push(this.beginDirectAnimation(J,a,c,d,f,g,h,j))}return w},wa.a.prototype.getAnimatableByTarget=function(e){for(var b=0;b<this._activeAnimatables.length;b++)if(this._activeAnimatables[b].target===e)return this._activeAnimatables[b];return null},wa.a.prototype.getAllAnimatablesByTarget=function(e){for(var b=[],a=0;a<this._activeAnimatables.length;a++)this._activeAnimatables[a].target===e&&b.push(this._activeAnimatables[a]);return b},wa.a.prototype.stopAnimation=function(e,b,a){for(var c=0,d=this.getAllAnimatablesByTarget(e);c<d.length;c++)d[c].stop(b,a)},wa.a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop();this._activeAnimatables=[]}for(var b=0,a=this.animationGroups;b<a.length;b++)a[b].stop()},wa.a.prototype._registerTargetForLateAnimationBinding=function(e,b){var a=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(a),a._lateAnimationHolders||(a._lateAnimationHolders={}),a._lateAnimationHolders[e.targetPath]||(a._lateAnimationHolders[e.targetPath]={totalWeight:0,animations:[],originalValue:b}),a._lateAnimationHolders[e.targetPath].animations.push(e),a._lateAnimationHolders[e.targetPath].totalWeight+=e.weight},wa.a.prototype._processLateAnimationBindingsForMatrices=function(e){var b=1,a=i.c.Vector3[0],c=i.c.Vector3[1],d=i.c.Quaternion[0],f=0,g=e.animations[0],h=e.originalValue,j=1;if(e.totalWeight<1)h.decompose(c,d,a),j=1-e.totalWeight;else if(f=1,b=e.totalWeight,g.currentValue.decompose(c,d,a),1==(j=g.weight/b))return g.currentValue;c.scaleInPlace(j),a.scaleInPlace(j),d.scaleInPlace(j);for(var m=f;m<e.animations.length;m++){var w=e.animations[m],z=(j=w.weight/b,i.c.Vector3[2]),C=i.c.Vector3[3],J=i.c.Quaternion[1];w.currentValue.decompose(C,J,z),C.scaleAndAddToRef(j,c),J.scaleAndAddToRef(j,d),z.scaleAndAddToRef(j,a)}var K=g._animationState.workValue;return i.a.ComposeToRef(c,d,a,K),K},wa.a.prototype._processLateAnimationBindingsForQuaternions=function(e,b){var a=e.animations[0],c=e.originalValue;if(1===e.animations.length)return i.b.SlerpToRef(c,a.currentValue,Math.min(1,e.totalWeight),b),b;var d,f,g=1;if(e.totalWeight<1){var h=1-e.totalWeight;f=[],(d=[]).push(c),f.push(h)}else{if(2===e.animations.length)return i.b.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,b),b;d=[],f=[],g=e.totalWeight}for(var j=0;j<e.animations.length;j++){var m=e.animations[j];d.push(m.currentValue),f.push(m.weight/g)}for(var w=0,z=null,C=0;C<d.length;)z?(w+=f[C],i.b.SlerpToRef(z,d[C],f[C]/w,z),C++):(i.b.SlerpToRef(d[C],d[C+1],f[C+1]/(f[C]+f[C+1]),b),z=b,w=f[C]+f[C+1],C+=2);return z},wa.a.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var e=0;e<this._registeredForLateAnimationBindings.length;e++){var b=this._registeredForLateAnimationBindings.data[e];for(var a in b._lateAnimationHolders){var c=b._lateAnimationHolders[a],d=c.animations[0],f=c.originalValue,g=V.AllowMatrixDecomposeForInterpolation&&f.m,h=b[a];if(g)h=this._processLateAnimationBindingsForMatrices(c);else if(void 0!==f.w)h=this._processLateAnimationBindingsForQuaternions(c,h||i.b.Identity());else{var j=0,m=1;if(c.totalWeight<1)h=f.scale?f.scale(1-c.totalWeight):f*(1-c.totalWeight);else{m=c.totalWeight;var w=d.weight/m;h=1!==w?d.currentValue.scale?d.currentValue.scale(w):d.currentValue*w:d.currentValue,j=1}for(var z=j;z<c.animations.length;z++){var C=c.animations[z],J=C.weight/m;C.currentValue.scaleAndAddToRef?C.currentValue.scaleAndAddToRef(J,h):h+=C.currentValue*J}}b[a]=h}b._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},Na.prototype.copyAnimationRange=function(e,b,a,c,d){void 0===c&&(c=!1),void 0===d&&(d=null),0===this.animations.length&&(this.animations.push(new V(this.name,"_matrix",e.animations[0].framePerSecond,V.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var f=e.animations[0].getRange(b);if(!f)return!1;for(var g,h,j,m=f.from,w=f.to,z=e.animations[0].getKeys(),C=e.length,J=e.getParent(),K=this.getParent(),N=c&&J&&C&&this.length&&C!==this.length,T=N&&K&&J?K.length/J.length:1,Z=c&&!K&&d&&(1!==d.x||1!==d.y||1!==d.z),_=this.animations[0].getKeys(),ca=0,ea=z.length;ca<ea;ca++)(g=z[ca]).frame>=m&&g.frame<=w&&(c?(j=g.value.clone(),N?(h=j.getTranslation(),j.setTranslation(h.scaleInPlace(T))):Z&&d?(h=j.getTranslation(),j.setTranslation(h.multiplyInPlace(d))):j=g.value):j=g.value,_.push({frame:g.frame+a,value:j}));return this.animations[0].createRange(b,m+a,w+a),!0};var eb,Ya=function(){function e(){}return e.prototype.serialize=function(){var b={};return b.animation=this.animation.serialize(),b.targetId=this.target.id,b},e}(),Sa=function(){function e(b,a){void 0===a&&(a=null),this.name=b,this._targetedAnimations=new Array(),this._animatables=new Array(),this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this.onAnimationEndObservable=new I.c(),this.onAnimationLoopObservable=new I.c(),this.onAnimationGroupLoopObservable=new I.c(),this.onAnimationGroupEndObservable=new I.c(),this.onAnimationGroupPauseObservable=new I.c(),this.onAnimationGroupPlayObservable=new I.c(),this._scene=a||U.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.animationGroups.push(this)}return Object.defineProperty(e.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this._to},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(b){if(this._speedRatio!==b){this._speedRatio=b;for(var a=0;a<this._animatables.length;a++)this._animatables[a].speedRatio=this._speedRatio}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(b){if(this._loopAnimation!==b){this._loopAnimation=b;for(var a=0;a<this._animatables.length;a++)this._animatables[a].loopAnimation=this._loopAnimation}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animatables",{get:function(){return this._animatables},enumerable:!0,configurable:!0}),e.prototype.addTargetedAnimation=function(b,a){var c=new Ya();c.animation=b,c.target=a;var d=b.getKeys();return this._from>d[0].frame&&(this._from=d[0].frame),this._to<d[d.length-1].frame&&(this._to=d[d.length-1].frame),this._targetedAnimations.push(c),c},e.prototype.normalize=function(b,a){void 0===b&&(b=null),void 0===a&&(a=null),null==b&&(b=this._from),null==a&&(a=this._to);for(var c=0;c<this._targetedAnimations.length;c++){var d=this._targetedAnimations[c].animation.getKeys(),f=d[0],g=d[d.length-1];if(f.frame>b){var h={frame:b,value:f.value,inTangent:f.inTangent,outTangent:f.outTangent,interpolation:f.interpolation};d.splice(0,0,h)}g.frame<a&&(h={frame:a,value:g.value,inTangent:g.outTangent,outTangent:g.outTangent,interpolation:g.interpolation},d.push(h))}return this._from=b,this._to=a,this},e.prototype._processLoop=function(b,a,c){var d=this;b.onAnimationLoop=function(){d.onAnimationLoopObservable.notifyObservers(a),d._animationLoopFlags[c]||(d._animationLoopFlags[c]=!0,d._animationLoopCount++,d._animationLoopCount===d._targetedAnimations.length&&(d.onAnimationGroupLoopObservable.notifyObservers(d),d._animationLoopCount=0,d._animationLoopFlags=[]))}},e.prototype.start=function(b,a,c,d){var f=this;if(void 0===b&&(b=!1),void 0===a&&(a=1),this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=b,this._animationLoopCount=0,this._animationLoopFlags=[];for(var g=function(){var w=h._targetedAnimations[j],z=h._scene.beginDirectAnimation(w.target,[w.animation],void 0!==c?c:h._from,void 0!==d?d:h._to,b,a);z.onAnimationEnd=function(){f.onAnimationEndObservable.notifyObservers(w),f._checkAnimationGroupEnded(z)},h._processLoop(z,w,j),h._animatables.push(z)},h=this,j=0;j<this._targetedAnimations.length;j++)g();if(this._speedRatio=a,void 0!==c&&void 0!==d)if(c<d&&this._speedRatio<0){var m=d;d=c,c=m}else c>d&&this._speedRatio>0&&(this._speedRatio=-a);return this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var b=0;b<this._animatables.length;b++)this._animatables[b].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this},e.prototype.play=function(b){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(void 0!==b&&(this.loopAnimation=b),this.restart()):(this.stop(),this.start(b,this._speedRatio)),this._isPaused=!1,this},e.prototype.reset=function(){if(!this._isStarted)return this;for(var b=0;b<this._animatables.length;b++)this._animatables[b].reset();return this},e.prototype.restart=function(){if(!this._isStarted)return this;for(var b=0;b<this._animatables.length;b++)this._animatables[b].restart();return this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.stop=function(){if(!this._isStarted)return this;for(var b=this._animatables.slice(),a=0;a<b.length;a++)b[a].stop();return this._isStarted=!1,this},e.prototype.setWeightForAllAnimatables=function(b){for(var a=0;a<this._animatables.length;a++)this._animatables[a].weight=b;return this},e.prototype.syncAllAnimationsWith=function(b){for(var a=0;a<this._animatables.length;a++)this._animatables[a].syncWith(b);return this},e.prototype.goToFrame=function(b){if(!this._isStarted)return this;for(var a=0;a<this._animatables.length;a++)this._animatables[a].goToFrame(b);return this},e.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var b=this._scene.animationGroups.indexOf(this);b>-1&&this._scene.animationGroups.splice(b,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},e.prototype._checkAnimationGroupEnded=function(b){var a=this._animatables.indexOf(b);a>-1&&this._animatables.splice(a,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},e.prototype.clone=function(b,a){for(var c=new e(b||this.name,this._scene),d=0,f=this._targetedAnimations;d<f.length;d++){var g=f[d];c.addTargetedAnimation(g.animation.clone(),a?a(g.target):g.target)}return c},e.prototype.serialize=function(){var b={};b.name=this.name,b.from=this.from,b.to=this.to,b.targetedAnimations=[];for(var a=0;a<this.targetedAnimations.length;a++){var c=this.targetedAnimations[a];b.targetedAnimations[a]=c.serialize()}return b},e.Parse=function(b,a){for(var c=new e(b.name,a),d=0;d<b.targetedAnimations.length;d++){var f=b.targetedAnimations[d],g=V.Parse(f.animation),h=f.targetId;if("influence"===f.animation.property){var j=a.getMorphTargetById(h);j&&c.addTargetedAnimation(g,j)}else{var m=a.getNodeByID(h);null!=m&&c.addTargetedAnimation(g,m)}}return null!==b.from&&null!==b.to&&c.normalize(b.from,b.to),c},e.prototype.getClassName=function(){return"AnimationGroup"},e.prototype.toString=function(b){var a="Name: "+this.name;return a+=", type: "+this.getClassName(),b&&(a+=", from: "+this._from,a+=", to: "+this._to,a+=", isStarted: "+this._isStarted,a+=", speedRatio: "+this._speedRatio,a+=", targetedAnimations length: "+this._targetedAnimations.length,a+=", animatables length: "+this._animatables),a},e}(),sb=function(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=V.ANIMATIONLOOPMODE_CYCLE},kb=o(28);!function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(eb||(eb={}));var wb=function(){function e(){}return e.Interpolate=function(b,a,c,d,f){for(var g=1-3*d+3*a,h=3*d-6*a,j=3*a,m=b,w=0;w<5;w++){var z=m*m;m-=(g*(z*m)+h*z+j*m-b)*(1/(3*g*z+2*h*m+j)),m=Math.min(1,Math.max(0,m))}return 3*Math.pow(1-m,2)*m*c+3*(1-m)*Math.pow(m,2)*f+Math.pow(m,3)},e}(),tb=function(){function e(b){this._radians=b,this._radians<0&&(this._radians+=2*Math.PI)}return e.prototype.degrees=function(){return 180*this._radians/Math.PI},e.prototype.radians=function(){return this._radians},e.BetweenTwoPoints=function(b,a){var c=a.subtract(b);return new e(Math.atan2(c.y,c.x))},e.FromRadians=function(b){return new e(b)},e.FromDegrees=function(b){return new e(b*Math.PI/180)},e}(),Ob=function(e,b,a){this.startPoint=e,this.midPoint=b,this.endPoint=a;var c=Math.pow(b.x,2)+Math.pow(b.y,2),d=(Math.pow(e.x,2)+Math.pow(e.y,2)-c)/2,f=(c-Math.pow(a.x,2)-Math.pow(a.y,2))/2,g=(e.x-b.x)*(b.y-a.y)-(b.x-a.x)*(e.y-b.y);this.centerPoint=new i.d((d*(b.y-a.y)-f*(e.y-b.y))/g,((e.x-b.x)*f-(b.x-a.x)*d)/g),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=tb.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),j=tb.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),m=tb.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();j-h>180&&(j-=360),j-h<-180&&(j+=360),m-j>180&&(m-=360),m-j<-180&&(m+=360),this.orientation=j-h<0?eb.CW:eb.CCW,this.angle=tb.FromDegrees(this.orientation===eb.CW?h-m:m-h)},dc=function(){function e(b,a){this._points=new Array(),this._length=0,this.closed=!1,this._points.push(new i.d(b,a))}return e.prototype.addLineTo=function(b,a){if(this.closed)return this;var c=new i.d(b,a),d=this._points[this._points.length-1];return this._points.push(c),this._length+=c.subtract(d).length(),this},e.prototype.addArcTo=function(b,a,c,d,f){if(void 0===f&&(f=36),this.closed)return this;var g=this._points[this._points.length-1],h=new i.d(b,a),j=new i.d(c,d),m=new Ob(g,h,j),w=m.angle.radians()/f;m.orientation===eb.CW&&(w*=-1);for(var z=m.startAngle.radians()+w,C=0;C<f;C++){var J=Math.cos(z)*m.radius+m.centerPoint.x,K=Math.sin(z)*m.radius+m.centerPoint.y;this.addLineTo(J,K),z+=w}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var b=this._length;if(this.closed){var a=this._points[this._points.length-1];b+=this._points[0].subtract(a).length()}return b},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(b){if(b<0||b>1)return i.d.Zero();for(var a=b*this.length(),c=0,d=0;d<this._points.length;d++){var f=(d+1)%this._points.length,g=this._points[d],h=this._points[f].subtract(g),j=h.length()+c;if(a>=c&&a<=j){var m=h.normalize(),w=a-c;return new i.d(g.x+m.x*w,g.y+m.y*w)}c=j}return i.d.Zero()},e.StartingAt=function(b,a){return new e(b,a)},e}(),tc=function(){function e(b,a,c,d){void 0===a&&(a=null),void 0===d&&(d=!1),this.path=b,this._curve=new Array(),this._distances=new Array(),this._tangents=new Array(),this._normals=new Array(),this._binormals=new Array(),this._pointAtData={id:0,point:i.e.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:i.a.Identity()};for(var f=0;f<b.length;f++)this._curve[f]=b[f].clone();this._raw=c||!1,this._alignTangentsWithPath=d,this._compute(a,d)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getPoints=function(){return this._curve},e.prototype.length=function(){return this._distances[this._distances.length-1]},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.getPointAt=function(b){return this._updatePointAtData(b).point},e.prototype.getTangentAt=function(b,a){return void 0===a&&(a=!1),this._updatePointAtData(b,a),a?i.e.TransformCoordinates(i.e.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},e.prototype.getNormalAt=function(b,a){return void 0===a&&(a=!1),this._updatePointAtData(b,a),a?i.e.TransformCoordinates(i.e.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},e.prototype.getBinormalAt=function(b,a){return void 0===a&&(a=!1),this._updatePointAtData(b,a),a?i.e.TransformCoordinates(i.e.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},e.prototype.getDistanceAt=function(b){return this.length()*b},e.prototype.getPreviousPointIndexAt=function(b){return this._updatePointAtData(b),this._pointAtData.previousPointArrayIndex},e.prototype.getSubPositionAt=function(b){return this._updatePointAtData(b),this._pointAtData.subPosition},e.prototype.getClosestPositionTo=function(b){for(var a=Number.MAX_VALUE,c=0,d=0;d<this._curve.length-1;d++){var f=this._curve[d+0],g=this._curve[d+1].subtract(f).normalize(),h=this._distances[d+1]-this._distances[d+0],j=Math.min(Math.max(i.e.Dot(g,b.subtract(f).normalize()),0)*i.e.Distance(f,b)/h,1),m=i.e.Distance(f.add(g.scale(j*h)),b);m<a&&(a=m,c=(this._distances[d+0]+h*j)/this.length())}return c},e.prototype.slice=function(b,a){if(void 0===b&&(b=0),void 0===a&&(a=1),b<0&&(b=1- -1*b%1),a<0&&(a=1- -1*a%1),b>a){var c=b;b=a,a=c}var d=this.getCurve(),f=this.getPointAt(b),g=this.getPreviousPointIndexAt(b),h=this.getPointAt(a),j=this.getPreviousPointIndexAt(a)+1,m=[];return 0!==b&&(g++,m.push(f)),m.push.apply(m,d.slice(g,j)),1===a&&1!==b||m.push(h),new e(m,this.getNormalAt(b),this._raw,this._alignTangentsWithPath)},e.prototype.update=function(b,a,c){void 0===a&&(a=null),void 0===c&&(c=!1);for(var d=0;d<b.length;d++)this._curve[d].x=b[d].x,this._curve[d].y=b[d].y,this._curve[d].z=b[d].z;return this._compute(a,c),this},e.prototype._compute=function(b,a){void 0===a&&(a=!1);var c=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[c-1]=this._curve[c-1].subtract(this._curve[c-2]),this._raw||this._tangents[c-1].normalize();var d,f,g,h,j,m=this._tangents[0],w=this._normalVector(m,b);this._normals[0]=w,this._raw||this._normals[0].normalize(),this._binormals[0]=i.e.Cross(m,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var z=1;z<c;z++)d=this._getLastNonNullVector(z),z<c-1&&(f=this._getFirstNonNullVector(z),this._tangents[z]=a?f:d.add(f),this._tangents[z].normalize()),this._distances[z]=this._distances[z-1]+d.length(),g=this._tangents[z],j=this._binormals[z-1],this._normals[z]=i.e.Cross(j,g),this._raw||(0===this._normals[z].length()?(h=this._normals[z-1],this._normals[z]=h.clone()):this._normals[z].normalize()),this._binormals[z]=i.e.Cross(g,this._normals[z]),this._raw||this._binormals[z].normalize();this._pointAtData.id=NaN},e.prototype._getFirstNonNullVector=function(b){for(var a=1,c=this._curve[b+a].subtract(this._curve[b]);0===c.length()&&b+a+1<this._curve.length;)a++,c=this._curve[b+a].subtract(this._curve[b]);return c},e.prototype._getLastNonNullVector=function(b){for(var a=1,c=this._curve[b].subtract(this._curve[b-a]);0===c.length()&&b>a+1;)a++,c=this._curve[b].subtract(this._curve[b-a]);return c},e.prototype._normalVector=function(b,a){var c,d,f=b.length();return(0===f&&(f=1),null==a)?(d=aa.a.WithinEpsilon(Math.abs(b.y)/f,1,kb.a)?aa.a.WithinEpsilon(Math.abs(b.x)/f,1,kb.a)?aa.a.WithinEpsilon(Math.abs(b.z)/f,1,kb.a)?i.e.Zero():new i.e(0,0,1):new i.e(1,0,0):new i.e(0,-1,0),c=i.e.Cross(b,d)):(c=i.e.Cross(b,a),i.e.CrossToRef(c,b,c)),c.normalize(),c},e.prototype._updatePointAtData=function(b,a){if(void 0===a&&(a=!1),this._pointAtData.id===b)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=b;var c=this.getPoints();if(b<=0)return this._setPointAtData(0,0,c[0],0,a);if(b>=1)return this._setPointAtData(1,1,c[c.length-1],c.length-1,a);for(var d,f=c[0],g=0,h=b*this.length(),j=1;j<c.length;j++){d=c[j];var m=i.e.Distance(f,d);if((g+=m)===h)return this._setPointAtData(b,1,d,j,a);if(g>h){var w=(g-h)/m,z=f.subtract(d),C=d.add(z.scaleInPlace(w));return this._setPointAtData(b,1-w,C,j-1,a)}f=d}return this._pointAtData},e.prototype._setPointAtData=function(b,a,c,d,f){return this._pointAtData.point=c,this._pointAtData.position=b,this._pointAtData.subPosition=a,this._pointAtData.previousPointArrayIndex=d,this._pointAtData.interpolateReady=f,f&&this._updateInterpolationMatrix(),this._pointAtData},e.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=i.a.Identity();var b=this._pointAtData.previousPointArrayIndex;if(b!==this._tangents.length-1){var a=b+1,c=this._tangents[b].clone(),d=this._normals[b].clone(),f=this._binormals[b].clone(),g=this._tangents[a].clone(),h=this._normals[a].clone(),j=this._binormals[a].clone(),m=i.b.RotationQuaternionFromAxis(d,f,c),w=i.b.RotationQuaternionFromAxis(h,j,g);i.b.Slerp(m,w,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},e}(),Tc=function(){function e(b){this._length=0,this._points=b,this._length=this._computeLength(b)}return e.CreateQuadraticBezier=function(b,a,c,d){d=d>2?d:3;for(var f=new Array(),g=function(j,m,w,z){return(1-j)*(1-j)*m+2*j*(1-j)*w+j*j*z},h=0;h<=d;h++)f.push(new i.e(g(h/d,b.x,a.x,c.x),g(h/d,b.y,a.y,c.y),g(h/d,b.z,a.z,c.z)));return new e(f)},e.CreateCubicBezier=function(b,a,c,d,f){f=f>3?f:4;for(var g=new Array(),h=function(m,w,z,C,J){return(1-m)*(1-m)*(1-m)*w+3*m*(1-m)*(1-m)*z+3*m*m*(1-m)*C+m*m*m*J},j=0;j<=f;j++)g.push(new i.e(h(j/f,b.x,a.x,c.x,d.x),h(j/f,b.y,a.y,c.y,d.y),h(j/f,b.z,a.z,c.z,d.z)));return new e(g)},e.CreateHermiteSpline=function(b,a,c,d,f){for(var g=new Array(),h=1/f,j=0;j<=f;j++)g.push(i.e.Hermite(b,a,c,d,j*h));return new e(g)},e.CreateCatmullRomSpline=function(b,a,c){var d=new Array(),f=1/a,g=0;if(c){for(var h=b.length,j=0;j<h;j++){g=0;for(var m=0;m<a;m++)d.push(i.e.CatmullRom(b[j%h],b[(j+1)%h],b[(j+2)%h],b[(j+3)%h],g)),g+=f}d.push(d[0])}else{var w=new Array();for(w.push(b[0].clone()),Array.prototype.push.apply(w,b),w.push(b[b.length-1].clone()),j=0;j<w.length-3;j++)for(g=0,m=0;m<a;m++)d.push(i.e.CatmullRom(w[j],w[j+1],w[j+2],w[j+3],g)),g+=f;j--,d.push(i.e.CatmullRom(w[j],w[j+1],w[j+2],w[j+3],g))}return new e(d)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype.continue=function(b){for(var a=this._points[this._points.length-1],c=this._points.slice(),d=b.getPoints(),f=1;f<d.length;f++)c.push(d[f].subtract(d[0]).add(a));return new e(c)},e.prototype._computeLength=function(b){for(var a=0,c=1;c<b.length;c++)a+=b[c].subtract(b[c-1]).length();return a},e}(),Fb=function(){function e(){this._easingMode=e.EASINGMODE_EASEIN}return e.prototype.setEasingMode=function(b){var a=Math.min(Math.max(b,0),2);this._easingMode=a},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(b){throw new Error("You must implement this method")},e.prototype.ease=function(b){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(b);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-b)}return b>=.5?.5*(1-this.easeInCore(2*(1-b)))+.5:.5*this.easeInCore(2*b)},e.EASINGMODE_EASEIN=0,e.EASINGMODE_EASEOUT=1,e.EASINGMODE_EASEINOUT=2,e}(),gd=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){return a=Math.max(0,Math.min(1,a)),1-Math.sqrt(1-a*a)},b}(Fb),hd=function(e){function b(a){void 0===a&&(a=1);var c=e.call(this)||this;return c.amplitude=a,c}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){var c=Math.max(0,this.amplitude);return Math.pow(a,3)-a*c*Math.sin(3.141592653589793*a)},b}(Fb),Ed=function(e){function b(a,c){void 0===a&&(a=3),void 0===c&&(c=2);var d=e.call(this)||this;return d.bounces=a,d.bounciness=c,d}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){var c=Math.max(0,this.bounces),d=this.bounciness;d<=1&&(d=1.001);var f=Math.pow(d,c),g=1-d,h=(1-f)/g+.5*f,j=a*h,m=Math.log(-j*(1-d)+1)/Math.log(d),w=Math.floor(m),z=w+1,C=(1-Math.pow(d,w))/(g*h),J=.5*(C+(1-Math.pow(d,z))/(g*h)),K=a-J,N=J-C;return-Math.pow(1/d,c-w)/(N*N)*(K-N)*(K+N)},b}(Fb),Cl=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){return a*a*a},b}(Fb),Dl=function(e){function b(a,c){void 0===a&&(a=3),void 0===c&&(c=3);var d=e.call(this)||this;return d.oscillations=a,d.springiness=c,d}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){var c=Math.max(0,this.oscillations),d=Math.max(0,this.springiness);return(0==d?a:(Math.exp(d*a)-1)/(Math.exp(d)-1))*Math.sin((6.283185307179586*c+1.5707963267948966)*a)},b}(Fb),Bh=function(e){function b(a){void 0===a&&(a=2);var c=e.call(this)||this;return c.exponent=a,c}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){return this.exponent<=0?a:(Math.exp(this.exponent*a)-1)/(Math.exp(this.exponent)-1)},b}(Fb),El=function(e){function b(a){void 0===a&&(a=2);var c=e.call(this)||this;return c.power=a,c}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){var c=Math.max(0,this.power);return Math.pow(a,c)},b}(Fb),Fl=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){return a*a},b}(Fb),Gl=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){return a*a*a*a},b}(Fb),Hl=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){return a*a*a*a*a},b}(Fb),Sf=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){return 1-Math.sin(1.5707963267948966*(1-a))},b}(Fb),Il=function(e){function b(a,c,d,f){void 0===a&&(a=0),void 0===c&&(c=0),void 0===d&&(d=1),void 0===f&&(f=1);var g=e.call(this)||this;return g.x1=a,g.y1=c,g.x2=d,g.y2=f,g}return Object(l.d)(b,e),b.prototype.easeInCore=function(a){return wb.Interpolate(a,this.x1,this.y1,this.x2,this.y2)},b}(Fb),Jl=function(){function e(b,a,c){this.frame=b,this.action=a,this.onlyOnce=c,this.isDone=!1}return e.prototype._clone=function(){return new e(this.frame,this.action,this.onlyOnce)},e}(),xa=o(5),Ch=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b}(R.a),Dh=function(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]},Eh=function(e){function b(a){var c=e.call(this)||this;return c._wasAddedToScene=!1,c.scene=a,c.sounds=[],c.effectLayers=[],c.layers=[],c.lensFlareSystems=[],c.proceduralTextures=[],c.reflectionProbes=[],a.onDisposeObservable.add(function(){c._wasAddedToScene||c.dispose()}),c}return Object(l.d)(b,e),b.prototype.instantiateModelsToScene=function(a,c){var d=this;void 0===c&&(c=!1);var f={},g={},h=new Dh(),j=[],m=[],w={doNotInstantiate:!0},z=function(C,J){if(f[C.uniqueId]=J.uniqueId,g[J.uniqueId]=J,a&&(J.name=a(C.name)),J instanceof xa.a){var K=J;if(K.morphTargetManager){var N=C.morphTargetManager;K.morphTargetManager=N.clone();for(var T=0;T<N.numTargets;T++){var Z=N.getTarget(T),_=K.morphTargetManager.getTarget(T);f[Z.uniqueId]=_.uniqueId,g[_.uniqueId]=_}}}};return this.transformNodes.forEach(function(C){if(!C.parent){var J=C.instantiateHierarchy(null,w,function(K,N){z(K,N)});J&&h.rootNodes.push(J)}}),this.meshes.forEach(function(C){if(!C.parent){var J=C.instantiateHierarchy(null,w,function(K,N){if(z(K,N),N.material){var T=N;if(T.material)if(c){var Z=K.material;if(-1===m.indexOf(Z)){var _=Z.clone(a?a(Z.name):"Clone of "+Z.name);if(m.push(Z),f[Z.uniqueId]=_.uniqueId,g[_.uniqueId]=_,"MultiMaterial"===Z.getClassName())for(var ca=0,ea=Z.subMaterials;ca<ea.length;ca++){var fa=ea[ca];fa&&(_=fa.clone(a?a(fa.name):"Clone of "+fa.name),m.push(fa),f[fa.uniqueId]=_.uniqueId,g[_.uniqueId]=_)}}T.material=g[f[Z.uniqueId]]}else"MultiMaterial"===T.material.getClassName()?-1===d.scene.multiMaterials.indexOf(T.material)&&d.scene.addMultiMaterial(T.material):-1===d.scene.materials.indexOf(T.material)&&d.scene.addMaterial(T.material)}});J&&h.rootNodes.push(J)}}),this.skeletons.forEach(function(C){var J=C.clone(a?a(C.name):"Clone of "+C.name);C.overrideMesh&&(J.overrideMesh=g[f[C.overrideMesh.uniqueId]]);for(var K=0,N=d.meshes;K<N.length;K++){var T=N[K];if(T.skeleton===C&&!T.isAnInstance){if(g[f[T.uniqueId]].skeleton=J,-1!==j.indexOf(J))continue;j.push(J);for(var Z=0,_=J.bones;Z<_.length;Z++){var ca=_[Z];ca._linkedTransformNode&&(ca._linkedTransformNode=g[f[ca._linkedTransformNode.uniqueId]])}}}h.skeletons.push(J)}),this.animationGroups.forEach(function(C){var J=C.clone(C.name,function(K){return g[f[K.uniqueId]]||K});h.animationGroups.push(J)}),h},b.prototype.addAllToScene=function(){var a=this;this._wasAddedToScene=!0,this.cameras.forEach(function(f){a.scene.addCamera(f)}),this.lights.forEach(function(f){a.scene.addLight(f)}),this.meshes.forEach(function(f){a.scene.addMesh(f)}),this.skeletons.forEach(function(f){a.scene.addSkeleton(f)}),this.animations.forEach(function(f){a.scene.addAnimation(f)}),this.animationGroups.forEach(function(f){a.scene.addAnimationGroup(f)}),this.multiMaterials.forEach(function(f){a.scene.addMultiMaterial(f)}),this.materials.forEach(function(f){a.scene.addMaterial(f)}),this.morphTargetManagers.forEach(function(f){a.scene.addMorphTargetManager(f)}),this.geometries.forEach(function(f){a.scene.addGeometry(f)}),this.transformNodes.forEach(function(f){a.scene.addTransformNode(f)}),this.actionManagers.forEach(function(f){a.scene.addActionManager(f)}),this.textures.forEach(function(f){a.scene.addTexture(f)}),this.reflectionProbes.forEach(function(f){a.scene.addReflectionProbe(f)}),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var c=0,d=this.scene._serializableComponents;c<d.length;c++)d[c].addFromContainer(this)},b.prototype.removeAllFromScene=function(){var a=this;this._wasAddedToScene=!1,this.cameras.forEach(function(f){a.scene.removeCamera(f)}),this.lights.forEach(function(f){a.scene.removeLight(f)}),this.meshes.forEach(function(f){a.scene.removeMesh(f)}),this.skeletons.forEach(function(f){a.scene.removeSkeleton(f)}),this.animations.forEach(function(f){a.scene.removeAnimation(f)}),this.animationGroups.forEach(function(f){a.scene.removeAnimationGroup(f)}),this.multiMaterials.forEach(function(f){a.scene.removeMultiMaterial(f)}),this.materials.forEach(function(f){a.scene.removeMaterial(f)}),this.morphTargetManagers.forEach(function(f){a.scene.removeMorphTargetManager(f)}),this.geometries.forEach(function(f){a.scene.removeGeometry(f)}),this.transformNodes.forEach(function(f){a.scene.removeTransformNode(f)}),this.actionManagers.forEach(function(f){a.scene.removeActionManager(f)}),this.textures.forEach(function(f){a.scene.removeTexture(f)}),this.reflectionProbes.forEach(function(f){a.scene.removeReflectionProbe(f)}),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var c=0,d=this.scene._serializableComponents;c<d.length;c++)d[c].removeFromContainer(this)},b.prototype.dispose=function(){this.cameras.forEach(function(d){d.dispose()}),this.cameras=[],this.lights.forEach(function(d){d.dispose()}),this.lights=[],this.meshes.forEach(function(d){d.dispose()}),this.meshes=[],this.skeletons.forEach(function(d){d.dispose()}),this.skeletons=[],this.animationGroups.forEach(function(d){d.dispose()}),this.animationGroups=[],this.multiMaterials.forEach(function(d){d.dispose()}),this.multiMaterials=[],this.materials.forEach(function(d){d.dispose()}),this.materials=[],this.geometries.forEach(function(d){d.dispose()}),this.geometries=[],this.transformNodes.forEach(function(d){d.dispose()}),this.transformNodes=[],this.actionManagers.forEach(function(d){d.dispose()}),this.actionManagers=[],this.textures.forEach(function(d){d.dispose()}),this.textures=[],this.reflectionProbes.forEach(function(d){d.dispose()}),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var a=0,c=this.scene._serializableComponents;a<c.length;a++)c[a].removeFromContainer(this,!0)},b.prototype._moveAssets=function(a,c,d){if(a)for(var f=0,g=a;f<g.length;f++){var h=g[f],j=!0;if(d){for(var m=0,w=d;m<w.length;m++)if(h===w[m]){j=!1;break}}j&&c.push(h)}},b.prototype.moveAllFromScene=function(a){for(var c in this._wasAddedToScene=!1,void 0===a&&(a=new Ch()),this)this.hasOwnProperty(c)&&(this[c]=this[c]||("environmentTexture"===c?null:[]),this._moveAssets(this.scene[c],this[c],a[c]));this.removeAllFromScene()},b.prototype.createRootMesh=function(){var a=new xa.a("assetContainerRootMesh",this.scene);return this.meshes.forEach(function(c){c.parent||a.addChild(c)}),this.meshes.unshift(a),a},b.prototype.mergeAnimationsTo=function(a,c,d){if(void 0===a&&(a=U.a.LastCreatedScene),void 0===d&&(d=null),a){var f=d||function(g){return a.getBoneByName(g.name)||a.getNodeByName(g.name)};this.getNodes().forEach(function(g){var h=f(g);if(null!==h){for(var j=function(z){for(var C=0,J=h.animations.filter(function(T){return T.targetProperty===z.targetProperty});C<J.length;C++){var K=J[C],N=h.animations.indexOf(K,0);N>-1&&h.animations.splice(N,1)}},m=0,w=g.animations;m<w.length;m++)j(w[m]);h.animations=h.animations.concat(g.animations)}}),this.animationGroups.slice().forEach(function(g){g.clone(g.name,f),g.animatables.forEach(function(h){h.stop()})}),c.forEach(function(g){var h=f(g.target);h&&(a.beginAnimation(h,g.fromFrame,g.toFrame,g.loopAnimation,g.speedRatio,g.onAnimationEnd?g.onAnimationEnd:void 0,void 0,!0,void 0,g.onAnimationLoop?g.onAnimationLoop:void 0),a.stopAnimation(g.target))})}else k.a.Error("No scene available to merge animations to")},b}(R.a),Ha=o(11),Kl=function(){function e(b){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=b,this._audioEngine=Ha.a.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return e.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},e.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},e.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},e.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},e.prototype.drawDebugCanvas=function(){var b=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){b.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var a=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var c=0;c<this.getFrequencyBinCount();c++){var d=a[c]/this.BARGRAPHAMPLITUDE,f=this.DEBUGCANVASSIZE.height*d,g=this.DEBUGCANVASSIZE.height-f-1,h=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),j=c/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+j+", 100%, 50%)",this._debugCanvasContext.fillRect(c*h,g,h,f)}}},e.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},e.prototype.connectAudioNodes=function(b,a){this._audioEngine.canUseWebAudio&&(b.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(a))},e.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},e}();Ha.a.AudioEngineFactory=function(e){return new Fh(e)};var Fh=function(){function e(b){var a=this;void 0===b&&(b=null),this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new I.c(),this.onAudioLockedObservable=new I.c(),this._tryToRun=!1,this._onResize=function(){a._moveButtonToTopLeft()},void 0===window.AudioContext&&void 0===window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var c=document.createElement("audio");this._hostElement=b;try{c&&c.canPlayType&&c.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")&&(this.isMP3supported=!0)}catch(d){}try{c&&c.canPlayType&&c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(d){}}return Object.defineProperty(e.prototype,"audioContext",{get:function(){return this._audioContextInitialized?this.unlocked||this._muteButton||this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),e.prototype.lock=function(){this._triggerSuspendedState()},e.prototype.unlock=function(){this._triggerRunningState()},e.prototype._resumeAudioContext=function(){var b;return this._audioContext.resume&&(b=this._audioContext.resume()),b||Promise.resolve()},e.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext(),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(b){this.canUseWebAudio=!1,k.a.Error("Web Audio: "+b.message)}},e.prototype._triggerRunningState=function(){var b=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(function(){b._tryToRun=!1,b._muteButton&&b._hideMuteButton()}).catch(function(){b._tryToRun=!1,b.unlocked=!1}),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))},e.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},e.prototype._displayMuteButton=function(){var b=this;if(!this.useCustomUnlockedButton&&!this._muteButton){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var a=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",c=document.createElement("style");c.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(c),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",function(){b._triggerRunningState()},!0),this._muteButton.addEventListener("click",function(){b._triggerRunningState()},!0),window.addEventListener("resize",this._onResize)}},e.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},e.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},e.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},e.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},e.prototype.setGlobalVolume=function(b){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=b)},e.prototype.connectToAnalyser=function(b){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=b,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},e}(),Qa=o(13),Gc=o(19),oe=function(){function e(b,a,c,d,f){var g=this;if(void 0===d&&(d=null),this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.onEndedObservable=new I.c(),this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=i.e.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new i.e(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=b,this._scene=c,e._SceneComponentInitialization(c),this._readyToPlayCallback=d,this._customAttenuationFunction=function(C,J,K,N,T){return J<K?C*(1-J/K):0},f&&(this.autoplay=f.autoplay||!1,this.loop=f.loop||!1,void 0!==f.volume&&(this._volume=f.volume),this.spatialSound=f.spatialSound||!1,this.maxDistance=f.maxDistance||100,this.useCustomAttenuation=f.useCustomAttenuation||!1,this.rolloffFactor=f.rolloffFactor||1,this.refDistance=f.refDistance||1,this.distanceModel=f.distanceModel||"linear",this._playbackRate=f.playbackRate||1,this._streaming=f.streaming||!1,this._length=f.length,this._offset=f.offset),Ha.a.audioEngine.canUseWebAudio&&Ha.a.audioEngine.audioContext){this._soundGain=Ha.a.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this);var h=!0;if(a)try{"string"==typeof a?this._urlType="String":a instanceof ArrayBuffer?this._urlType="ArrayBuffer":a instanceof MediaStream?this._urlType="MediaStream":Array.isArray(a)&&(this._urlType="Array");var j=[],m=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ha.a.audioEngine.audioContext.createMediaStreamSource(a),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":a.byteLength>0&&(m=!0,this._soundLoaded(a));break;case"String":j.push(a);case"Array":0===j.length&&(j=a);for(var w=0;w<j.length;w++){var z=j[w];if(m=f&&f.skipCodecCheck||-1!==z.indexOf(".mp3",z.length-4)&&Ha.a.audioEngine.isMP3supported||-1!==z.indexOf(".ogg",z.length-4)&&Ha.a.audioEngine.isOGGsupported||-1!==z.indexOf(".wav",z.length-4)||-1!==z.indexOf("blob:")){this._streaming?(this._htmlAudioElement=new Audio(z),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Qa.b.SetCorsBehavior(z,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){g._isReadyToPlay=!0,g.autoplay&&g.play(0,g._offset,g._length),g._readyToPlayCallback&&g._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(z,function(C){g._soundLoaded(C)},void 0,!0,!0,function(C){C&&k.a.Error("XHR "+C.status+" error on: "+z+"."),k.a.Error("Sound creation aborted."),g._scene.mainSoundTrack.RemoveSound(g)});break}}break;default:h=!1}h?m||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){g._readyToPlayCallback&&g._readyToPlayCallback()},1000)):k.a.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(C){k.a.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.RemoveSound(this)}}else this._scene.mainSoundTrack.AddSound(this),Ha.a.audioEngine.WarnedWebAudioUnsupported||(k.a.Error("Web Audio is not supported by your browser."),Ha.a.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){g._readyToPlayCallback&&g._readyToPlayCallback()},1000)}return e.prototype.dispose=function(){Ha.a.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},e.prototype.isReady=function(){return this._isReadyToPlay},e.prototype._soundLoaded=function(b){var a=this;Ha.a.audioEngine.audioContext&&Ha.a.audioEngine.audioContext.decodeAudioData(b,function(c){a._audioBuffer=c,a._isReadyToPlay=!0,a.autoplay&&a.play(0,a._offset,a._length),a._readyToPlayCallback&&a._readyToPlayCallback()},function(c){k.a.Error("Error while decoding audio data for: "+a.name+" / Error: "+c)})},e.prototype.setAudioBuffer=function(b){Ha.a.audioEngine.canUseWebAudio&&(this._audioBuffer=b,this._isReadyToPlay=!0)},e.prototype.updateOptions=function(b){b&&(this.loop=b.loop||this.loop,this.maxDistance=b.maxDistance||this.maxDistance,this.useCustomAttenuation=b.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=b.rolloffFactor||this.rolloffFactor,this.refDistance=b.refDistance||this.refDistance,this.distanceModel=b.distanceModel||this.distanceModel,this._playbackRate=b.playbackRate||this._playbackRate,this._length=b.length?b.length/1000:void 0,this._offset=b.offset?b.offset/1000:void 0,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate)))},e.prototype._createSpatialParameters=function(){Ha.a.audioEngine.canUseWebAudio&&Ha.a.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=Ha.a.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner)},e.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},e.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},e.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},e.prototype._switchPanningModel=function(){Ha.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},e.prototype.connectToSoundTrackAudioNode=function(b){Ha.a.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(b),this._isOutputConnected=!0)},e.prototype.setDirectionalCone=function(b,a,c){a<b?k.a.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=b,this._coneOuterAngle=a,this._coneOuterGain=c,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))},Object.defineProperty(e.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(b){if(b!=this._coneInnerAngle){if(this._coneOuterAngle<b)return void k.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=b,Ha.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(b){if(b!=this._coneOuterAngle){if(b<this._coneInnerAngle)return void k.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=b,Ha.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!0,configurable:!0}),e.prototype.setPosition=function(b){this._position=b,Ha.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},e.prototype.setLocalDirectionToMesh=function(b){this._localDirection=b,Ha.a.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},e.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var b=this._connectedTransformNode.getWorldMatrix(),a=i.e.TransformNormal(this._localDirection,b);a.normalize(),this._soundPanner.setOrientation(a.x,a.y,a.z)}},e.prototype.updateDistanceFromListener=function(){if(Ha.a.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var b=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,b,this.maxDistance,this.refDistance,this.rolloffFactor)}},e.prototype.setAttenuationFunction=function(b){this._customAttenuationFunction=b},e.prototype.play=function(b,a,c){var d=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&Ha.a.audioEngine.audioContext)try{this._startOffset<0&&(b=-this._startOffset,this._startOffset=0);var f=b?Ha.a.audioEngine.audioContext.currentTime+b:Ha.a.audioEngine.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming)(this._streamingSource||(this._streamingSource=Ha.a.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){d._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement)&&(g=function(){if(Ha.a.audioEngine.unlocked){var h=d._htmlAudioElement.play();void 0!==h&&h.catch(function(j){Ha.a.audioEngine.lock(),(d.loop||d.autoplay)&&Ha.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){g()})})}else(d.loop||d.autoplay)&&Ha.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){g()})})();else{var g=function(){if(Ha.a.audioEngine.audioContext){c=c||d._length,a=a||d._offset,d._soundSource=Ha.a.audioEngine.audioContext.createBufferSource(),d._soundSource.buffer=d._audioBuffer,d._soundSource.connect(d._inputAudioNode),d._soundSource.loop=d.loop,void 0!==a&&(d._soundSource.loopStart=a),void 0!==c&&(d._soundSource.loopEnd=(0|a)+c),d._soundSource.playbackRate.value=d._playbackRate,d._soundSource.onended=function(){d._onended()},f=b?Ha.a.audioEngine.audioContext.currentTime+b:Ha.a.audioEngine.audioContext.currentTime;var h=d.isPaused?d._startOffset%d._soundSource.buffer.duration:a||0;d._soundSource.start(f,h,d.loop?void 0:c)}};"suspended"===Ha.a.audioEngine.audioContext.state?setTimeout(function(){"suspended"===Ha.a.audioEngine.audioContext.state?(Ha.a.audioEngine.lock(),(d.loop||d.autoplay)&&Ha.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){g()})):g()},500):g()}this._startTime=f,this.isPlaying=!0,this.isPaused=!1}catch(h){k.a.Error("Error while trying to play audio: "+this.name+", "+h.message)}},e.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},e.prototype.stop=function(b){var a=this;if(this.isPlaying){if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if(Ha.a.audioEngine.audioContext&&this._soundSource){var c=b?Ha.a.audioEngine.audioContext.currentTime+b:Ha.a.audioEngine.audioContext.currentTime;this._soundSource.stop(c),this._soundSource.onended=function(){a.isPlaying=!1},this.isPaused||(this._startOffset=0)}}},e.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():Ha.a.audioEngine.audioContext&&(this.stop(0),this._startOffset+=Ha.a.audioEngine.audioContext.currentTime-this._startTime))},e.prototype.setVolume=function(b,a){Ha.a.audioEngine.canUseWebAudio&&this._soundGain&&(a&&Ha.a.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Ha.a.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Ha.a.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(b,Ha.a.audioEngine.audioContext.currentTime+a)):this._soundGain.gain.value=b),this._volume=b},e.prototype.setPlaybackRate=function(b){this._playbackRate=b,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},e.prototype.getVolume=function(){return this._volume},e.prototype.attachToMesh=function(b){var a=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=b,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(c){return a._onRegisterAfterWorldMatrixUpdate(c)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},e.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},e.prototype._onRegisterAfterWorldMatrixUpdate=function(b){if(b.getBoundingInfo){var a=b;if(this._positionInEmitterSpace)a.worldMatrixFromCache.invertToRef(i.c.Matrix[0]),this.setPosition(i.c.Matrix[0].getTranslation());else{var c=a.getBoundingInfo();this.setPosition(c.boundingSphere.centerWorld)}Ha.a.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}},e.prototype.clone=function(){var b=this;if(this._streaming)return null;var a=function(){b._isReadyToPlay?(d._audioBuffer=b.getAudioBuffer(),d._isReadyToPlay=!0,d.autoplay&&d.play(0,b._offset,b._length)):window.setTimeout(a,300)},c={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},d=new e(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,c);return this.useCustomAttenuation&&d.setAttenuationFunction(this._customAttenuationFunction),d.setPosition(this._position),d.setPlaybackRate(this._playbackRate),a(),d},e.prototype.getAudioBuffer=function(){return this._audioBuffer},e.prototype.serialize=function(){var b={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId};return this.spatialSound&&(this._connectedTransformNode&&(b.connectedMeshId=this._connectedTransformNode.id),b.position=this._position.asArray(),b.refDistance=this.refDistance,b.distanceModel=this.distanceModel,b.isDirectional=this._isDirectional,b.localDirectionToMesh=this._localDirection.asArray(),b.coneInnerAngle=this._coneInnerAngle,b.coneOuterAngle=this._coneOuterAngle,b.coneOuterGain=this._coneOuterGain),b},e.Parse=function(b,a,c,d){var f,g=b.name;f=b.url?c+b.url:c+g;var h,j={autoplay:b.autoplay,loop:b.loop,volume:b.volume,spatialSound:b.spatialSound,maxDistance:b.maxDistance,rolloffFactor:b.rolloffFactor,refDistance:b.refDistance,distanceModel:b.distanceModel,playbackRate:b.playbackRate};if(d){var m=function(){d._isReadyToPlay?(h._audioBuffer=d.getAudioBuffer(),h._isReadyToPlay=!0,h.autoplay&&h.play(0,h._offset,h._length)):window.setTimeout(m,300)};h=new e(g,new ArrayBuffer(0),a,null,j),m()}else h=new e(g,f,a,function(){a._removePendingData(h)},j),a._addPendingData(h);if(b.position){var w=i.e.FromArray(b.position);h.setPosition(w)}if(b.isDirectional&&(h.setDirectionalCone(b.coneInnerAngle||360,b.coneOuterAngle||360,b.coneOuterGain||0),b.localDirectionToMesh)){var z=i.e.FromArray(b.localDirectionToMesh);h.setLocalDirectionToMesh(z)}if(b.connectedMeshId){var C=a.getMeshByID(b.connectedMeshId);C&&h.attachToMesh(C)}return h},e._SceneComponentInitialization=function(b){throw Gc.a.WarnImport("AudioSceneComponent")},e}(),Gh=function(){function e(b,a){void 0===a&&(a={}),this.id=-1,this._isInitialized=!1,this._scene=b,this.soundCollection=new Array(),this._options=a,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return e.prototype._initializeSoundTrackAudioGraph=function(){Ha.a.audioEngine.canUseWebAudio&&Ha.a.audioEngine.audioContext&&(this._outputAudioNode=Ha.a.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Ha.a.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)},e.prototype.dispose=function(){if(Ha.a.audioEngine&&Ha.a.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},e.prototype.AddSound=function(b){this._isInitialized||this._initializeSoundTrackAudioGraph(),Ha.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&b.connectToSoundTrackAudioNode(this._outputAudioNode),b.soundTrackId&&(-1===b.soundTrackId?this._scene.mainSoundTrack.RemoveSound(b):this._scene.soundTracks&&this._scene.soundTracks[b.soundTrackId].RemoveSound(b)),this.soundCollection.push(b),b.soundTrackId=this.id},e.prototype.RemoveSound=function(b){var a=this.soundCollection.indexOf(b);-1!==a&&this.soundCollection.splice(a,1)},e.prototype.setVolume=function(b){Ha.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=b)},e.prototype.switchPanningModelToHRTF=function(){if(Ha.a.audioEngine.canUseWebAudio)for(var b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToHRTF()},e.prototype.switchPanningModelToEqualPower=function(){if(Ha.a.audioEngine.canUseWebAudio)for(var b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToEqualPower()},e.prototype.connectToAnalyser=function(b){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=b,Ha.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Ha.a.audioEngine.masterGain))},e}(),_a=o(17);R.a.AddParser(_a.a.NAME_AUDIO,function(e,b,a,c){var d,f=[];if(a.sounds=a.sounds||[],void 0!==e.sounds&&null!==e.sounds)for(var g=0,h=e.sounds.length;g<h;g++){var j=e.sounds[g];Ha.a.audioEngine.canUseWebAudio?(j.url||(j.url=j.name),f[j.url]?a.sounds.push(oe.Parse(j,b,c,f[j.url])):(d=oe.Parse(j,b,c),f[j.url]=d,a.sounds.push(d))):a.sounds.push(new oe(j.name,null,b))}f=[]}),Object.defineProperty(wa.a.prototype,"mainSoundTrack",{get:function(){var e=this._getComponent(_a.a.NAME_AUDIO);return e||(e=new uc(this),this._addComponent(e)),this._mainSoundTrack||(this._mainSoundTrack=new Gh(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),wa.a.prototype.getSoundByName=function(e){var b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)if(this.mainSoundTrack.soundCollection[b].name===e)return this.mainSoundTrack.soundCollection[b];if(this.soundTracks){for(var a=0;a<this.soundTracks.length;a++)for(b=0;b<this.soundTracks[a].soundCollection.length;b++)if(this.soundTracks[a].soundCollection[b].name===e)return this.soundTracks[a].soundCollection[b]}return null},Object.defineProperty(wa.a.prototype,"audioEnabled",{get:function(){var e=this._getComponent(_a.a.NAME_AUDIO);return e||(e=new uc(this),this._addComponent(e)),e.audioEnabled},set:function(e){var b=this._getComponent(_a.a.NAME_AUDIO);b||(b=new uc(this),this._addComponent(b)),e?b.enableAudio():b.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(wa.a.prototype,"headphone",{get:function(){var e=this._getComponent(_a.a.NAME_AUDIO);return e||(e=new uc(this),this._addComponent(e)),e.headphone},set:function(e){var b=this._getComponent(_a.a.NAME_AUDIO);b||(b=new uc(this),this._addComponent(b)),e?b.switchAudioModeForHeadphones():b.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(wa.a.prototype,"audioListenerPositionProvider",{get:function(){var e=this._getComponent(_a.a.NAME_AUDIO);return e||(e=new uc(this),this._addComponent(e)),e.audioListenerPositionProvider},set:function(e){var b=this._getComponent(_a.a.NAME_AUDIO);if(b||(b=new uc(this),this._addComponent(b)),"function"!=typeof e)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");b.audioListenerPositionProvider=e},enumerable:!0,configurable:!0}),Object.defineProperty(wa.a.prototype,"audioPositioningRefreshRate",{get:function(){var e=this._getComponent(_a.a.NAME_AUDIO);return e||(e=new uc(this),this._addComponent(e)),e.audioPositioningRefreshRate},set:function(e){var b=this._getComponent(_a.a.NAME_AUDIO);b||(b=new uc(this),this._addComponent(b)),b.audioPositioningRefreshRate=e},enumerable:!0,configurable:!0});var uc=function(){function e(b){this.name=_a.a.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this._audioListenerPositionProvider=null,this._cachedCameraDirection=new i.e(),this._cachedCameraPosition=new i.e(),this._lastCheck=0,this.scene=b,b.soundTracks=new Array(),b.sounds=new Array()}return Object.defineProperty(e.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headphone",{get:function(){return this._headphone},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioListenerPositionProvider",{get:function(){return this._audioListenerPositionProvider},set:function(b){this._audioListenerPositionProvider=b},enumerable:!0,configurable:!0}),e.prototype.register=function(){this.scene._afterRenderStage.registerStep(_a.a.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},e.prototype.rebuild=function(){},e.prototype.serialize=function(b){if(b.sounds=[],this.scene.soundTracks)for(var a=0;a<this.scene.soundTracks.length;a++)for(var c=this.scene.soundTracks[a],d=0;d<c.soundCollection.length;d++)b.sounds.push(c.soundCollection[d].serialize())},e.prototype.addFromContainer=function(b){var a=this;b.sounds&&b.sounds.forEach(function(c){c.play(),c.autoplay=!0,a.scene.mainSoundTrack.AddSound(c)})},e.prototype.removeFromContainer=function(b,a){var c=this;void 0===a&&(a=!1),b.sounds&&b.sounds.forEach(function(d){d.stop(),d.autoplay=!1,c.scene.mainSoundTrack.RemoveSound(d),a&&d.dispose()})},e.prototype.dispose=function(){var b=this.scene;if(b._mainSoundTrack&&b.mainSoundTrack.dispose(),b.soundTracks)for(var a=0;a<b.soundTracks.length;a++)b.soundTracks[a].dispose()},e.prototype.disableAudio=function(){var b,a=this.scene;for(this._audioEnabled=!1,Ha.a.audioEngine&&Ha.a.audioEngine.audioContext&&Ha.a.audioEngine.audioContext.suspend(),b=0;b<a.mainSoundTrack.soundCollection.length;b++)a.mainSoundTrack.soundCollection[b].pause();if(a.soundTracks)for(b=0;b<a.soundTracks.length;b++)for(var c=0;c<a.soundTracks[b].soundCollection.length;c++)a.soundTracks[b].soundCollection[c].pause()},e.prototype.enableAudio=function(){var b,a=this.scene;for(this._audioEnabled=!0,Ha.a.audioEngine&&Ha.a.audioEngine.audioContext&&Ha.a.audioEngine.audioContext.resume(),b=0;b<a.mainSoundTrack.soundCollection.length;b++)a.mainSoundTrack.soundCollection[b].isPaused&&a.mainSoundTrack.soundCollection[b].play();if(a.soundTracks)for(b=0;b<a.soundTracks.length;b++)for(var c=0;c<a.soundTracks[b].soundCollection.length;c++)a.soundTracks[b].soundCollection[c].isPaused&&a.soundTracks[b].soundCollection[c].play()},e.prototype.switchAudioModeForHeadphones=function(){var b=this.scene;if(this._headphone=!0,b.mainSoundTrack.switchPanningModelToHRTF(),b.soundTracks)for(var a=0;a<b.soundTracks.length;a++)b.soundTracks[a].switchPanningModelToHRTF()},e.prototype.switchAudioModeForNormalSpeakers=function(){var b=this.scene;if(this._headphone=!1,b.mainSoundTrack.switchPanningModelToEqualPower(),b.soundTracks)for(var a=0;a<b.soundTracks.length;a++)b.soundTracks[a].switchPanningModelToEqualPower()},e.prototype._afterRender=function(){var b=Ka.a.Now;if(!(this._lastCheck&&b-this._lastCheck<this.audioPositioningRefreshRate)){this._lastCheck=b;var a=this.scene;if(this._audioEnabled&&a._mainSoundTrack&&a.soundTracks&&(0!==a._mainSoundTrack.soundCollection.length||1!==a.soundTracks.length)){var c=Ha.a.audioEngine;if(c.audioContext){if(this._audioListenerPositionProvider){var d=this._audioListenerPositionProvider();d.x=d.x||0,d.y=d.y||0,d.z=d.z||0,c.audioContext.listener.setPosition(d.x,d.y,d.z)}else{var f;if(f=a.activeCameras.length>0?a.activeCameras[0]:a.activeCamera){this._cachedCameraPosition.equals(f.globalPosition)||(this._cachedCameraPosition.copyFrom(f.globalPosition),c.audioContext.listener.setPosition(f.globalPosition.x,f.globalPosition.y,f.globalPosition.z)),f.rigCameras&&f.rigCameras.length>0&&(f=f.rigCameras[0]);var g=i.a.Invert(f.getViewMatrix()),h=i.e.TransformNormal(new i.e(0,0,-1),g);h.normalize(),isNaN(h.x)||isNaN(h.y)||isNaN(h.z)||this._cachedCameraDirection.equals(h)||(this._cachedCameraDirection.copyFrom(h),c.audioContext.listener.setOrientation(h.x,h.y,h.z,0,1,0))}else c.audioContext.listener.setPosition(0,0,0)}var j;for(j=0;j<a.mainSoundTrack.soundCollection.length;j++){var m=a.mainSoundTrack.soundCollection[j];m.useCustomAttenuation&&m.updateDistanceFromListener()}if(a.soundTracks)for(j=0;j<a.soundTracks.length;j++)for(var w=0;w<a.soundTracks[j].soundCollection.length;w++)(m=a.soundTracks[j].soundCollection[w]).useCustomAttenuation&&m.updateDistanceFromListener()}}}},e}();oe._SceneComponentInitialization=function(e){var b=e._getComponent(_a.a.NAME_AUDIO);b||(b=new uc(e),e._addComponent(b))};var Ll=function(){function e(b,a,c){var d=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],a.length!==c.length)throw new Error("Sounds length does not equal weights length");this.loop=b,this._weights=c;for(var f=0,g=0,h=c;g<h.length;g++)f+=h[g];for(var j=f>0?1/f:0,m=0;m<this._weights.length;m++)this._weights[m]*=j;this._sounds=a;for(var w=0,z=this._sounds;w<z.length;w++)z[w].onEndedObservable.add(function(){d._onended()})}return Object.defineProperty(e.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(b){if(b!==this._coneInnerAngle){if(this._coneOuterAngle<b)return void k.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=b;for(var a=0,c=this._sounds;a<c.length;a++)c[a].directionalConeInnerAngle=b}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(b){if(b!==this._coneOuterAngle){if(b<this._coneInnerAngle)return void k.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=b;for(var a=0,c=this._sounds;a<c.length;a++)c[a].directionalConeOuterAngle=b}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(b){if(b!==this._volume)for(var a=0,c=this._sounds;a<c.length;a++)c[a].setVolume(b)},enumerable:!0,configurable:!0}),e.prototype._onended=function(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},e.prototype.pause=function(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()},e.prototype.stop=function(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()},e.prototype.play=function(b){if(!this.isPaused){this.stop();for(var a=Math.random(),c=0,d=0;d<this._weights.length;d++)if(a<=(c+=this._weights[d])){this._currentIndex=d;break}}var f=this._sounds[this._currentIndex];f.isReady()?f.play(0,this.isPaused?void 0:b):f.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},e}(),lb=o(20),Hh=function(){function e(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2000,this._idleRotationSpinupTime=2000,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(e.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(b){this._zoomStopsAnimation=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(b){this._idleRotationSpeed=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(b){this._idleRotationWaitTime=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(b){this._idleRotationSpinupTime=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(b){var a=this;this._attachedCamera=b;var c=this._attachedCamera.getScene();this._onPrePointerObservableObserver=c.onPrePointerObservable.add(function(d){d.type!==lb.a.POINTERDOWN?d.type===lb.a.POINTERUP&&(a._isPointerDown=!1):a._isPointerDown=!0}),this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add(function(){var d=Ka.a.Now,f=0;null!=a._lastFrameTime&&(f=d-a._lastFrameTime),a._lastFrameTime=d,a._applyUserInteraction();var g=d-a._lastInteractionTime-a._idleRotationWaitTime,h=Math.max(Math.min(g/a._idleRotationSpinupTime,1),0);a._cameraRotationSpeed=a._idleRotationSpeed*h,a._attachedCamera&&(a._attachedCamera.alpha-=a._cameraRotationSpeed*(f/1000))})},e.prototype.detach=function(){if(this._attachedCamera){var b=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&b.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},e.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},e.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var b=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(b=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?b:this._userIsZooming()},e.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Ka.a.Now)},e.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},e}(),Ih=function(){function e(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array()}return Object.defineProperty(e.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(b){var a=this;if(this._autoTransitionRange!==b){this._autoTransitionRange=b;var c=this._attachedCamera;c&&(b?this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add(function(d){if(d){d.computeWorldMatrix(!0);var f=d.getBoundingInfo().diagonalLength;a.lowerRadiusTransitionRange=.05*f,a.upperRadiusTransitionRange=.05*f}}):this._onMeshTargetChangedObserver&&c.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(b){var a=this;this._attachedCamera=b,this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add(function(){a._attachedCamera&&(a._isRadiusAtLimit(a._attachedCamera.lowerRadiusLimit)&&a._applyBoundRadiusAnimation(a.lowerRadiusTransitionRange),a._isRadiusAtLimit(a._attachedCamera.upperRadiusLimit)&&a._applyBoundRadiusAnimation(a.upperRadiusTransitionRange))})},e.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},e.prototype._isRadiusAtLimit=function(b){return!!this._attachedCamera&&(this._attachedCamera.radius===b&&!this._radiusIsAnimating)},e.prototype._applyBoundRadiusAnimation=function(b){var a=this;if(this._attachedCamera){this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=V.CreateAnimation("radius",V.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var c=V.TransitionTo("radius",this._attachedCamera.radius+b,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return a._clearAnimationLocks()});c&&this._animatables.push(c)}},e.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},e.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},e.EasingFunction=new hd(.3),e.EasingMode=Fb.EASINGMODE_EASEOUT,e}(),Jh=function(){function e(){this._mode=e.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1000,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array(),this._betaIsAnimating=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(b){this._mode=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(b){this._radiusScale=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positionScale",{get:function(){return this._positionScale},set:function(b){this._positionScale=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(b){this._defaultElevation=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(b){this._elevationReturnTime=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(b){this._elevationReturnWaitTime=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(b){this._zoomStopsAnimation=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framingTime",{get:function(){return this._framingTime},set:function(b){this._framingTime=b},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(b){var a=this;this._attachedCamera=b;var c=this._attachedCamera.getScene();e.EasingFunction.setEasingMode(e.EasingMode),this._onPrePointerObservableObserver=c.onPrePointerObservable.add(function(d){d.type!==lb.a.POINTERDOWN?d.type===lb.a.POINTERUP&&(a._isPointerDown=!1):a._isPointerDown=!0}),this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add(function(d){d&&a.zoomOnMesh(d)}),this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add(function(){a._applyUserInteraction(),a._maintainCameraAboveGround()})},e.prototype.detach=function(){if(this._attachedCamera){var b=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&b.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},e.prototype.zoomOnMesh=function(b,a,c){void 0===a&&(a=!1),void 0===c&&(c=null),b.computeWorldMatrix(!0);var d=b.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(d.minimumWorld,d.maximumWorld,a,c)},e.prototype.zoomOnMeshHierarchy=function(b,a,c){void 0===a&&(a=!1),void 0===c&&(c=null),b.computeWorldMatrix(!0);var d=b.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(d.min,d.max,a,c)},e.prototype.zoomOnMeshesHierarchy=function(b,a,c){void 0===a&&(a=!1),void 0===c&&(c=null);for(var d=new i.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),f=new i.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),g=0;g<b.length;g++){var h=b[g].getHierarchyBoundingVectors(!0);i.e.CheckExtends(h.min,d,f),i.e.CheckExtends(h.max,d,f)}this.zoomOnBoundingInfo(d,f,a,c)},e.prototype.zoomOnBoundingInfo=function(b,a,c,d){var f,g=this;if(void 0===c&&(c=!1),void 0===d&&(d=null),this._attachedCamera){var h=b.y,j=h+(a.y-h)*this._positionScale,m=a.subtract(b).scale(.5);if(c)f=new i.e(0,j,0);else{var w=b.add(m);f=new i.e(w.x,j,w.z)}this._vectorTransition||(this._vectorTransition=V.CreateAnimation("target",V.ANIMATIONTYPE_VECTOR3,60,e.EasingFunction)),this._betaIsAnimating=!0;var z=V.TransitionTo("target",f,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);z&&this._animatables.push(z);var C=0;if(this._mode===e.FitFrustumSidesMode){var J=this._calculateLowerRadiusFromModelBoundingSphere(b,a);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=m.length()+this._attachedCamera.minZ),C=J}else this._mode===e.IgnoreBoundsSizeMode&&(C=this._calculateLowerRadiusFromModelBoundingSphere(b,a),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var K=a.subtract(b).length();this._attachedCamera.panningSensibility=5000/K,this._attachedCamera.wheelPrecision=100/C}this._radiusTransition||(this._radiusTransition=V.CreateAnimation("radius",V.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),(z=V.TransitionTo("radius",C,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){g.stopAllAnimations(),d&&d(),g._attachedCamera&&g._attachedCamera.useInputToRestoreState&&g._attachedCamera.storeState()}))&&this._animatables.push(z)}},e.prototype._calculateLowerRadiusFromModelBoundingSphere=function(b,a){var c=a.subtract(b).length(),d=this._getFrustumSlope(),f=.5*c*this._radiusScale,g=f*Math.sqrt(1+1/(d.x*d.x)),h=f*Math.sqrt(1+1/(d.y*d.y)),j=Math.max(g,h),m=this._attachedCamera;return m?(m.lowerRadiusLimit&&this._mode===e.IgnoreBoundsSizeMode&&(j=j<m.lowerRadiusLimit?m.lowerRadiusLimit:j),m.upperRadiusLimit&&(j=j>m.upperRadiusLimit?m.upperRadiusLimit:j),j):0},e.prototype._maintainCameraAboveGround=function(){var b=this;if(!(this._elevationReturnTime<0)){var a=Ka.a.Now-this._lastInteractionTime,c=.5*Math.PI-this._defaultElevation,d=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>d&&a>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=V.CreateAnimation("beta",V.ANIMATIONTYPE_FLOAT,60,e.EasingFunction));var f=V.TransitionTo("beta",c,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){b._clearAnimationLocks(),b.stopAllAnimations()});f&&this._animatables.push(f)}}},e.prototype._getFrustumSlope=function(){var b=this._attachedCamera;if(!b)return i.d.Zero();var a=b.getScene().getEngine().getAspectRatio(b),c=Math.tan(b.fov/2),d=c*a;return new i.d(d,c)},e.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},e.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=Ka.a.Now,this.stopAllAnimations(),this._clearAnimationLocks())},e.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(e.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),e.EasingFunction=new Bh(),e.EasingMode=Fb.EASINGMODE_EASEINOUT,e.IgnoreBoundsSizeMode=0,e.FitFrustumSidesMode=1,e}(),Fd=function(e,b,a,c){void 0===b&&(b=new i.e()),void 0===a&&(a=0),void 0===c&&(c=!1),this.direction=e,this.rotatedDirection=b,this.diff=a,this.ignore=c},Ml=function(){function e(b){this.ui=b,this.name="AttachToBoxBehavior",this.distanceAwayFromFace=.15,this.distanceAwayFromBottomOfFace=.15,this._faceVectors=[new Fd(i.e.Up()),new Fd(i.e.Down()),new Fd(i.e.Left()),new Fd(i.e.Right()),new Fd(i.e.Forward()),new Fd(i.e.Forward().scaleInPlace(-1))],this._tmpMatrix=new i.a(),this._tmpVector=new i.e(),this._zeroVector=i.e.Zero(),this._lookAtTmpMatrix=new i.a()}return e.prototype.init=function(){},e.prototype._closestFace=function(b){var a=this;return this._faceVectors.forEach(function(c){a._target.rotationQuaternion||(a._target.rotationQuaternion=i.b.RotationYawPitchRoll(a._target.rotation.y,a._target.rotation.x,a._target.rotation.z)),a._target.rotationQuaternion.toRotationMatrix(a._tmpMatrix),i.e.TransformCoordinatesToRef(c.direction,a._tmpMatrix,c.rotatedDirection),c.diff=i.e.GetAngleBetweenVectors(c.rotatedDirection,b,i.e.Cross(c.rotatedDirection,b))}),this._faceVectors.reduce(function(c,d){return c.ignore?d:d.ignore?c:c.diff<d.diff?c:d},this._faceVectors[0])},e.prototype._lookAtToRef=function(b,a,c){void 0===a&&(a=new i.e(0,1,0)),i.a.LookAtLHToRef(this._zeroVector,b,a,this._lookAtTmpMatrix),this._lookAtTmpMatrix.invert(),i.b.FromRotationMatrixToRef(this._lookAtTmpMatrix,c)},e.prototype.attach=function(b){var a=this;this._target=b,this._scene=this._target.getScene(),this._onRenderObserver=this._scene.onBeforeRenderObservable.add(function(){if(a._scene.activeCamera){var c=a._scene.activeCamera.position;a._scene.activeCamera.devicePosition&&(c=a._scene.activeCamera.devicePosition);var d=a._closestFace(c.subtract(b.position));a._scene.activeCamera.leftCamera?a._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(a._tmpMatrix):a._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(a._tmpMatrix),i.e.TransformCoordinatesToRef(i.e.Up(),a._tmpMatrix,a._tmpVector),a._faceVectors.forEach(function(g){d.direction.x&&g.direction.x&&(g.ignore=!0),d.direction.y&&g.direction.y&&(g.ignore=!0),d.direction.z&&g.direction.z&&(g.ignore=!0)});var f=a._closestFace(a._tmpVector);a._faceVectors.forEach(function(g){g.ignore=!1}),a.ui.position.copyFrom(b.position),d.direction.x&&(d.rotatedDirection.scaleToRef(b.scaling.x/2+a.distanceAwayFromFace,a._tmpVector),a.ui.position.addInPlace(a._tmpVector)),d.direction.y&&(d.rotatedDirection.scaleToRef(b.scaling.y/2+a.distanceAwayFromFace,a._tmpVector),a.ui.position.addInPlace(a._tmpVector)),d.direction.z&&(d.rotatedDirection.scaleToRef(b.scaling.z/2+a.distanceAwayFromFace,a._tmpVector),a.ui.position.addInPlace(a._tmpVector)),a.ui.rotationQuaternion||(a.ui.rotationQuaternion=i.b.RotationYawPitchRoll(a.ui.rotation.y,a.ui.rotation.x,a.ui.rotation.z)),d.rotatedDirection.scaleToRef(-1,a._tmpVector),a._lookAtToRef(a._tmpVector,f.rotatedDirection,a.ui.rotationQuaternion),f.direction.x&&a.ui.up.scaleToRef(a.distanceAwayFromBottomOfFace-b.scaling.x/2,a._tmpVector),f.direction.y&&a.ui.up.scaleToRef(a.distanceAwayFromBottomOfFace-b.scaling.y/2,a._tmpVector),f.direction.z&&a.ui.up.scaleToRef(a.distanceAwayFromBottomOfFace-b.scaling.z/2,a._tmpVector),a.ui.position.addInPlace(a._tmpVector)}})},e.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)},e}(),Nl=function(){function e(){var b=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=1000/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(b._ownerNode){if(b._hoverValue+=b._hovered?b._millisecondsPerFrame:-b._millisecondsPerFrame,b._setAllVisibility(b._ownerNode,(b._hoverValue-b.delay)/b.fadeInTime),b._ownerNode.visibility>1)return b._setAllVisibility(b._ownerNode,1),void(b._hoverValue=b.fadeInTime+b.delay);if(b._ownerNode.visibility<0&&(b._setAllVisibility(b._ownerNode,0),b._hoverValue<0))return void(b._hoverValue=0);setTimeout(b._update,b._millisecondsPerFrame)}}}return Object.defineProperty(e.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(b){this._ownerNode=b,this._setAllVisibility(this._ownerNode,0)},e.prototype.detach=function(){this._ownerNode=null},e.prototype.fadeIn=function(b){this._hovered=b,this._update()},e.prototype._setAllVisibility=function(b,a){var c=this;b.visibility=a,b.getChildMeshes().forEach(function(d){c._setAllVisibility(d,a)})},e}(),Hc=o(62),Ol=function(){function e(){this._startDistance=0,this._initialScale=new i.e(0,0,0),this._targetScale=new i.e(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new Hc.a({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new Hc.a({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},e.prototype.attach=function(b){var a=this;this._ownerNode=b,this._dragBehaviorA.onDragStartObservable.add(function(c){a._dragBehaviorA.dragging&&a._dragBehaviorB.dragging&&(a._dragBehaviorA.currentDraggingPointerID==a._dragBehaviorB.currentDraggingPointerID?a._dragBehaviorA.releaseDrag():(a._initialScale.copyFrom(b.scaling),a._startDistance=a._getCurrentDistance()))}),this._dragBehaviorB.onDragStartObservable.add(function(c){a._dragBehaviorA.dragging&&a._dragBehaviorB.dragging&&(a._dragBehaviorA.currentDraggingPointerID==a._dragBehaviorB.currentDraggingPointerID?a._dragBehaviorB.releaseDrag():(a._initialScale.copyFrom(b.scaling),a._startDistance=a._getCurrentDistance()))}),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(c){c.onDragObservable.add(function(){if(a._dragBehaviorA.dragging&&a._dragBehaviorB.dragging){var d=a._getCurrentDistance()/a._startDistance;a._initialScale.scaleToRef(d,a._targetScale)}})}),b.addBehavior(this._dragBehaviorA),b.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=b.getScene().onBeforeRenderObservable.add(function(){if(a._dragBehaviorA.dragging&&a._dragBehaviorB.dragging){var c=a._targetScale.subtract(b.scaling).scaleInPlace(.1);c.length()>.01&&b.scaling.addInPlace(c)}})},e.prototype.detach=function(){var b=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(a){a.onDragStartObservable.clear(),a.onDragObservable.clear(),b._ownerNode.removeBehavior(a)})},e}(),qb=o(27),hb=o(24),fc=o(55),Kh=function(){function e(){this._sceneRenderObserver=null,this._targetPosition=new i.e(0,0,0),this._moving=!1,this._startingOrientation=new i.b(),this.zDragFactor=3,this.rotateDraggedObject=!0,this.dragging=!1,this.dragDeltaRatio=.2,this.currentDraggingPointerID=-1,this.detachCameraControls=!0,this.onDragStartObservable=new I.c(),this.onDragEndObservable=new I.c()}return Object.defineProperty(e.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},Object.defineProperty(e.prototype,"_pointerCamera",{get:function(){return this._scene.cameraToUseForPointers?this._scene.cameraToUseForPointers:this._scene.activeCamera},enumerable:!0,configurable:!0}),e.prototype.attach=function(b){var a=this;this._ownerNode=b,this._scene=this._ownerNode.getScene(),e._virtualScene||(e._virtualScene=new wa.a(this._scene.getEngine()),e._virtualScene.detachControl(),this._scene.getEngine().scenes.pop());var c=null,d=new i.e(0,0,0);this._virtualOriginMesh=new qb.a("",e._virtualScene),this._virtualOriginMesh.rotationQuaternion=new i.b(),this._virtualDragMesh=new qb.a("",e._virtualScene),this._virtualDragMesh.rotationQuaternion=new i.b();var f=null;this._pointerObserver=this._scene.onPointerObservable.add(function(h,j){if(h.type==lb.a.POINTERDOWN){if(!a.dragging&&h.pickInfo&&h.pickInfo.hit&&h.pickInfo.pickedMesh&&h.pickInfo.ray&&(J=h.pickInfo.pickedMesh,a._ownerNode==J||J.isDescendantOf(a._ownerNode))){a._pointerCamera&&a._pointerCamera.cameraRigMode==hb.a.RIG_MODE_NONE&&h.pickInfo.ray.origin.copyFrom(a._pointerCamera.globalPosition),c=a._ownerNode,fc.a._RemoveAndStorePivotPoint(c),d.copyFrom(h.pickInfo.ray.origin),a._virtualOriginMesh.position.copyFrom(h.pickInfo.ray.origin),a._virtualOriginMesh.lookAt(h.pickInfo.ray.origin.add(h.pickInfo.ray.direction)),a._virtualOriginMesh.removeChild(a._virtualDragMesh),c.computeWorldMatrix(),a._virtualDragMesh.position.copyFrom(c.absolutePosition),c.rotationQuaternion||(c.rotationQuaternion=i.b.RotationYawPitchRoll(c.rotation.y,c.rotation.x,c.rotation.z));var m=c.parent;c.setParent(null),a._virtualDragMesh.rotationQuaternion.copyFrom(c.rotationQuaternion),c.setParent(m),a._virtualOriginMesh.addChild(a._virtualDragMesh),a._targetPosition.copyFrom(a._virtualDragMesh.absolutePosition),a.dragging=!0,a.currentDraggingPointerID=h.event.pointerId,a.detachCameraControls&&a._pointerCamera&&!a._pointerCamera.leftCamera&&(a._pointerCamera.inputs.attachedElement?(f=a._pointerCamera.inputs.attachedElement,a._pointerCamera.detachControl(a._pointerCamera.inputs.attachedElement)):f=null),fc.a._RestorePivotPoint(c),a.onDragStartObservable.notifyObservers({})}}else if(h.type==lb.a.POINTERUP)a.currentDraggingPointerID==h.event.pointerId&&(a.dragging=!1,a._moving=!1,a.currentDraggingPointerID=-1,c=null,a._virtualOriginMesh.removeChild(a._virtualDragMesh),a.detachCameraControls&&f&&a._pointerCamera&&!a._pointerCamera.leftCamera&&a._pointerCamera.attachControl(f,!0),a.onDragEndObservable.notifyObservers({}));else if(h.type==lb.a.POINTERMOVE&&a.currentDraggingPointerID==h.event.pointerId&&a.dragging&&h.pickInfo&&h.pickInfo.ray&&c){var w=a.zDragFactor;a._pointerCamera&&a._pointerCamera.cameraRigMode==hb.a.RIG_MODE_NONE&&(h.pickInfo.ray.origin.copyFrom(a._pointerCamera.globalPosition),w=0);var z=h.pickInfo.ray.origin.subtract(d);d.copyFrom(h.pickInfo.ray.origin);var C=-i.e.Dot(z,h.pickInfo.ray.direction);a._virtualOriginMesh.addChild(a._virtualDragMesh),a._virtualDragMesh.position.z-=a._virtualDragMesh.position.z<1?C*a.zDragFactor:C*w*a._virtualDragMesh.position.z,a._virtualDragMesh.position.z<0&&(a._virtualDragMesh.position.z=0),a._virtualOriginMesh.position.copyFrom(h.pickInfo.ray.origin),a._virtualOriginMesh.lookAt(h.pickInfo.ray.origin.add(h.pickInfo.ray.direction)),a._virtualOriginMesh.removeChild(a._virtualDragMesh),a._targetPosition.copyFrom(a._virtualDragMesh.absolutePosition),c.parent&&i.e.TransformCoordinatesToRef(a._targetPosition,i.a.Invert(c.parent.getWorldMatrix()),a._targetPosition),a._moving||a._startingOrientation.copyFrom(a._virtualDragMesh.rotationQuaternion),a._moving=!0}var J});var g=new i.b();this._sceneRenderObserver=b.getScene().onBeforeRenderObservable.add(function(){if(a.dragging&&a._moving&&c){if(fc.a._RemoveAndStorePivotPoint(c),c.position.addInPlace(a._targetPosition.subtract(c.position).scale(a.dragDeltaRatio)),a.rotateDraggedObject){g.copyFrom(a._startingOrientation),g.x=-g.x,g.y=-g.y,g.z=-g.z,a._virtualDragMesh.rotationQuaternion.multiplyToRef(g,g),i.b.RotationYawPitchRollToRef(g.toEulerAngles("xyz").y,0,0,g),g.multiplyToRef(a._startingOrientation,g);var h=c.parent;(!h||h.scaling&&!h.scaling.isNonUniformWithinEpsilon(.001))&&(c.setParent(null),i.b.SlerpToRef(c.rotationQuaternion,g,a.dragDeltaRatio,c.rotationQuaternion),c.setParent(h))}fc.a._RestorePivotPoint(c)}})},e.prototype.detach=function(){this._scene&&this._scene.onPointerObservable.remove(this._pointerObserver),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualOriginMesh&&this._virtualOriginMesh.dispose(),this._virtualDragMesh&&this._virtualDragMesh.dispose(),this.onDragEndObservable.clear(),this.onDragStartObservable.clear()},e}(),Pl=function(){function e(b,a,c){if(this.targetPosition=i.e.Zero(),this.poleTargetPosition=i.e.Zero(),this.poleTargetLocalOffset=i.e.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=i.b.Identity(),this._bone1Mat=i.a.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=i.e.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=a,this._bone1=a.getParent(),this._bone1){this.mesh=b;var d=a.getPosition();if(a.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,d.x>d.y&&d.x>d.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var f=this._bone1.getScale(),g=this._bone2.getScale();this._bone1Length=this._bone1.length*f.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*g.y*this.mesh.scaling.y}else if(this._bone1.children[0]){b.computeWorldMatrix(!0);var h=this._bone2.children[0].getAbsolutePosition(b),j=this._bone2.getAbsolutePosition(b),m=this._bone1.getAbsolutePosition(b);this._bone1Length=i.e.Distance(h,j),this._bone2Length=i.e.Distance(j,m)}this._bone1.getRotationMatrixToRef(Ba.b.WORLD,b,this._bone1Mat),this.maxAngle=Math.PI,c&&(c.targetMesh&&(this.targetMesh=c.targetMesh,this.targetMesh.computeWorldMatrix(!0)),c.poleTargetMesh?(this.poleTargetMesh=c.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):c.poleTargetBone?this.poleTargetBone=c.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),c.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(c.poleTargetLocalOffset),c.poleAngle&&(this.poleAngle=c.poleAngle),c.bendAxis&&this._bendAxis.copyFrom(c.bendAxis),c.maxAngle&&(this.maxAngle=c.maxAngle),c.slerpAmount&&(this.slerpAmount=c.slerpAmount))}}return Object.defineProperty(e.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(b){this._setMaxAngle(b)},enumerable:!0,configurable:!0}),e.prototype._setMaxAngle=function(b){b<0&&(b=0),(b>Math.PI||null==b)&&(b=Math.PI),this._maxAngle=b;var a=this._bone1Length,c=this._bone2Length;this._maxReach=Math.sqrt(a*a+c*c-2*a*c*Math.cos(b))},e.prototype.update=function(){var b=this._bone1;if(b){var a=this.targetPosition,c=this.poleTargetPosition,d=e._tmpMats[0],f=e._tmpMats[1];this.targetMesh&&a.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,c):this.poleTargetMesh&&i.e.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),c);var g=e._tmpVecs[0],h=e._tmpVecs[1],j=e._tmpVecs[2],m=e._tmpVecs[3],w=e._tmpVecs[4],z=e._tmpQuat;b.getAbsolutePositionToRef(this.mesh,g),c.subtractToRef(g,w),0==w.x&&0==w.y&&0==w.z?w.y=1:w.normalize(),a.subtractToRef(g,m),m.normalize(),i.e.CrossToRef(m,w,h),h.normalize(),i.e.CrossToRef(m,h,j),j.normalize(),i.a.FromXYZAxesToRef(j,m,h,d);var C=this._bone1Length,J=this._bone2Length,K=i.e.Distance(g,a);this._maxReach>0&&(K=Math.min(this._maxReach,K));var N=(J*J+K*K-C*C)/(2*J*K),T=(K*K+C*C-J*J)/(2*K*C);N>1&&(N=1),T>1&&(T=1),N<-1&&(N=-1),T<-1&&(T=-1);var Z=Math.acos(N),_=Math.acos(T),ca=-Z-_;if(this._rightHandedSystem)i.a.RotationYawPitchRollToRef(0,0,this._adjustRoll,f),f.multiplyToRef(d,d),i.a.RotationAxisToRef(this._bendAxis,_,f),f.multiplyToRef(d,d);else{var ea=e._tmpVecs[5];ea.copyFrom(this._bendAxis),ea.x*=-1,i.a.RotationAxisToRef(ea,-_,f),f.multiplyToRef(d,d)}this.poleAngle&&(i.a.RotationAxisToRef(m,this.poleAngle,f),d.multiplyToRef(f,d)),this._bone1&&(this.slerpAmount<1?(this._slerping||i.b.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),i.b.FromRotationMatrixToRef(d,z),i.b.SlerpToRef(this._bone1Quat,z,this.slerpAmount,this._bone1Quat),ca=this._bone2Ang*(1-this.slerpAmount)+ca*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,Ba.b.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(d,Ba.b.WORLD,this.mesh),this._bone1Mat.copyFrom(d),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,ca,Ba.b.LOCAL),this._bone2Ang=ca}},e._tmpVecs=[i.e.Zero(),i.e.Zero(),i.e.Zero(),i.e.Zero(),i.e.Zero(),i.e.Zero()],e._tmpQuat=i.b.Identity(),e._tmpMats=[i.a.Identity(),i.a.Identity()],e}(),Ql=function(){function e(b,a,c,d){if(this.upAxis=i.e.Up(),this.upAxisSpace=Ba.b.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=i.b.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=i.e.Forward(),this.mesh=b,this.bone=a,this.target=c,d&&(d.adjustYaw&&(this.adjustYaw=d.adjustYaw),d.adjustPitch&&(this.adjustPitch=d.adjustPitch),d.adjustRoll&&(this.adjustRoll=d.adjustRoll),null!=d.maxYaw?this.maxYaw=d.maxYaw:this.maxYaw=Math.PI,null!=d.minYaw?this.minYaw=d.minYaw:this.minYaw=-Math.PI,null!=d.maxPitch?this.maxPitch=d.maxPitch:this.maxPitch=Math.PI,null!=d.minPitch?this.minPitch=d.minPitch:this.minPitch=-Math.PI,null!=d.slerpAmount&&(this.slerpAmount=d.slerpAmount),null!=d.upAxis&&(this.upAxis=d.upAxis),null!=d.upAxisSpace&&(this.upAxisSpace=d.upAxisSpace),null!=d.yawAxis||null!=d.pitchAxis)){var f=Ba.a.Y,g=Ba.a.X;null!=d.yawAxis&&(f=d.yawAxis.clone()).normalize(),null!=d.pitchAxis&&(g=d.pitchAxis.clone()).normalize();var h=i.e.Cross(g,f);this._transformYawPitch=i.a.Identity(),i.a.FromXYZAxesToRef(g,f,h,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}a.getParent()||this.upAxisSpace!=Ba.b.BONE||(this.upAxisSpace=Ba.b.LOCAL)}return Object.defineProperty(e.prototype,"minYaw",{get:function(){return this._minYaw},set:function(b){this._minYaw=b,this._minYawSin=Math.sin(b),this._minYawCos=Math.cos(b),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(b){this._maxYaw=b,this._maxYawSin=Math.sin(b),this._maxYawCos=Math.cos(b),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPitch",{get:function(){return this._minPitch},set:function(b){this._minPitch=b,this._minPitchTan=Math.tan(b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(b){this._maxPitch=b,this._maxPitchTan=Math.tan(b)},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var b=this.bone,a=e._tmpVecs[0];b.getAbsolutePositionToRef(this.mesh,a);var c=this.target,d=e._tmpMats[0],f=e._tmpMats[1],g=this.mesh,h=b.getParent(),j=e._tmpVecs[1];j.copyFrom(this.upAxis),this.upAxisSpace==Ba.b.BONE&&h?(this._transformYawPitch&&i.e.TransformCoordinatesToRef(j,this._transformYawPitchInv,j),h.getDirectionToRef(j,this.mesh,j)):this.upAxisSpace==Ba.b.LOCAL&&(g.getDirectionToRef(j,j),1==g.scaling.x&&1==g.scaling.y&&1==g.scaling.z||j.normalize());var m=!1,w=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(m=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(w=!0),m||w){var z=e._tmpMats[2],C=e._tmpMats[3];if(this.upAxisSpace==Ba.b.BONE&&1==j.y&&h)h.getRotationMatrixToRef(Ba.b.WORLD,this.mesh,z);else if(this.upAxisSpace!=Ba.b.LOCAL||1!=j.y||h){(K=e._tmpVecs[2]).copyFrom(this._fowardAxis),this._transformYawPitch&&i.e.TransformCoordinatesToRef(K,this._transformYawPitchInv,K),h?h.getDirectionToRef(K,this.mesh,K):g.getDirectionToRef(K,K);var J=i.e.Cross(j,K);J.normalize();var K=i.e.Cross(J,j);i.a.FromXYZAxesToRef(J,j,K,z)}else z.copyFrom(g.getWorldMatrix());z.invertToRef(C);var N=null;if(w){var T=e._tmpVecs[3];c.subtractToRef(a,T),i.e.TransformCoordinatesToRef(T,C,T),N=Math.sqrt(T.x*T.x+T.z*T.z);var Z=Math.atan2(T.y,N),_=Z;Z>this._maxPitch?(T.y=this._maxPitchTan*N,_=this._maxPitch):Z<this._minPitch&&(T.y=this._minPitchTan*N,_=this._minPitch),Z!=_&&(i.e.TransformCoordinatesToRef(T,z,T),T.addInPlace(a),c=T)}if(m){T=e._tmpVecs[4],c.subtractToRef(a,T),i.e.TransformCoordinatesToRef(T,C,T);var ca=Math.atan2(T.x,T.z),ea=ca;if((ca>this._maxYaw||ca<this._minYaw)&&(null==N&&(N=Math.sqrt(T.x*T.x+T.z*T.z)),this._yawRange>Math.PI?this._isAngleBetween(ca,this._maxYaw,this._midYawConstraint)?(T.z=this._maxYawCos*N,T.x=this._maxYawSin*N,ea=this._maxYaw):this._isAngleBetween(ca,this._midYawConstraint,this._minYaw)&&(T.z=this._minYawCos*N,T.x=this._minYawSin*N,ea=this._minYaw):ca>this._maxYaw?(T.z=this._maxYawCos*N,T.x=this._maxYawSin*N,ea=this._maxYaw):ca<this._minYaw&&(T.z=this._minYawCos*N,T.x=this._minYawSin*N,ea=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var fa=e._tmpVecs[8];fa.copyFrom(Ba.a.Z),this._transformYawPitch&&i.e.TransformCoordinatesToRef(fa,this._transformYawPitchInv,fa);var ka=e._tmpMats[4];this._boneQuat.toRotationMatrix(ka),this.mesh.getWorldMatrix().multiplyToRef(ka,ka),i.e.TransformCoordinatesToRef(fa,ka,fa),i.e.TransformCoordinatesToRef(fa,C,fa);var pa=Math.atan2(fa.x,fa.z);if(this._getAngleBetween(pa,ca)>this._getAngleBetween(pa,this._midYawConstraint)){null==N&&(N=Math.sqrt(T.x*T.x+T.z*T.z));var va=this._getAngleBetween(pa,this._maxYaw);this._getAngleBetween(pa,this._minYaw)<va?(ea=pa+.75*Math.PI,T.z=Math.cos(ea)*N,T.x=Math.sin(ea)*N):(ea=pa-.75*Math.PI,T.z=Math.cos(ea)*N,T.x=Math.sin(ea)*N)}}ca!=ea&&(i.e.TransformCoordinatesToRef(T,z,T),T.addInPlace(a),c=T)}}var sa=e._tmpVecs[5],la=e._tmpVecs[6],ta=e._tmpVecs[7],Da=e._tmpQuat;c.subtractToRef(a,sa),sa.normalize(),i.e.CrossToRef(j,sa,la),la.normalize(),i.e.CrossToRef(sa,la,ta),ta.normalize(),i.a.FromXYZAxesToRef(la,ta,sa,d),0===la.x&&0===la.y&&0===la.z||0===ta.x&&0===ta.y&&0===ta.z||0===sa.x&&0===sa.y&&0===sa.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(i.a.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,f),f.multiplyToRef(d,d)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(Ba.b.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(d,d),i.b.FromRotationMatrixToRef(d,Da),i.b.SlerpToRef(this._boneQuat,Da,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,Ba.b.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(d,d),this.bone.setRotationMatrix(d,Ba.b.WORLD,this.mesh),this._slerping=!1))}},e.prototype._getAngleDiff=function(b,a){var c=a-b;return(c%=2*Math.PI)>Math.PI?c-=2*Math.PI:c<-Math.PI&&(c+=2*Math.PI),c},e.prototype._getAngleBetween=function(b,a){var c=0;return(c=(b=(b%=2*Math.PI)<0?b+2*Math.PI:b)<(a=(a%=2*Math.PI)<0?a+2*Math.PI:a)?a-b:b-a)>Math.PI&&(c=2*Math.PI-c),c},e.prototype._isAngleBetween=function(b,a,c){if(b=(b%=2*Math.PI)<0?b+2*Math.PI:b,(a=(a%=2*Math.PI)<0?a+2*Math.PI:a)<(c=(c%=2*Math.PI)<0?c+2*Math.PI:c)){if(b>a&&b<c)return!0}else if(b>c&&b<a)return!0;return!1},e._tmpVecs=Ga.a.BuildArray(10,i.e.Zero),e._tmpQuat=i.b.Identity(),e._tmpMats=Ga.a.BuildArray(5,i.a.Identity),e}(),ya=o(9),mb=o(25);function Lh(e){return function(b,a,c,d,f,g,h,j,m,w){void 0===m&&(m=null),void 0===w&&(w=p.a.TEXTURETYPE_UNSIGNED_INT);var z=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,C=e?mb.b.Raw3D:mb.b.Raw2DArray,J=new mb.a(this,C);J.baseWidth=a,J.baseHeight=c,J.baseDepth=d,J.width=a,J.height=c,J.depth=d,J.format=f,J.type=w,J.generateMipMaps=g,J.samplingMode=j,e?J.is3D=!0:J.is2DArray=!0,this._doNotHandleContextLost||(J._bufferView=b),e?this.updateRawTexture3D(J,b,f,h,m,w):this.updateRawTexture2DArray(J,b,f,h,m,w),this._bindTextureDirectly(z,J,!0);var K=this._getSamplingParameters(j,g);return this._gl.texParameteri(z,this._gl.TEXTURE_MAG_FILTER,K.mag),this._gl.texParameteri(z,this._gl.TEXTURE_MIN_FILTER,K.min),g&&this._gl.generateMipmap(z),this._bindTextureDirectly(z,null),this._internalTexturesCache.push(J),J}}function Mh(e){return function(b,a,c,d,f,g){void 0===f&&(f=null),void 0===g&&(g=p.a.TEXTURETYPE_UNSIGNED_INT);var h=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,j=this._getWebGLTextureType(g),m=this._getInternalFormat(c),w=this._getRGBABufferInternalSizedFormat(g,c);this._bindTextureDirectly(h,b,!0),this._unpackFlipY(void 0===d||!!d),this._doNotHandleContextLost||(b._bufferView=a,b.format=c,b.invertY=d,b._compression=f),b.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),f&&a?this._gl.compressedTexImage3D(h,0,this.getCaps().s3tc[f],b.width,b.height,b.depth,0,a):this._gl.texImage3D(h,0,w,b.width,b.height,b.depth,0,m,j,a),b.generateMipMaps&&this._gl.generateMipmap(h),this._bindTextureDirectly(h,null),b.isReady=!0}}Ha.a.prototype.updateRawTexture=function(e,b,a,c,d,f){if(void 0===d&&(d=null),void 0===f&&(f=p.a.TEXTURETYPE_UNSIGNED_INT),e){var g=this._getRGBABufferInternalSizedFormat(f,a),h=this._getInternalFormat(a),j=this._getWebGLTextureType(f);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===c||!!c),this._doNotHandleContextLost||(e._bufferView=b,e.format=a,e.type=f,e.invertY=c,e._compression=d),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),d&&b?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[d],e.width,e.height,0,b):this._gl.texImage2D(this._gl.TEXTURE_2D,0,g,e.width,e.height,0,h,j,b),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}},Ha.a.prototype.createRawTexture=function(e,b,a,c,d,f,g,h,j){void 0===h&&(h=null),void 0===j&&(j=p.a.TEXTURETYPE_UNSIGNED_INT);var m=new mb.a(this,mb.b.Raw);m.baseWidth=b,m.baseHeight=a,m.width=b,m.height=a,m.format=c,m.generateMipMaps=d,m.samplingMode=g,m.invertY=f,m._compression=h,m.type=j,this._doNotHandleContextLost||(m._bufferView=e),this.updateRawTexture(m,e,c,f,h,j),this._bindTextureDirectly(this._gl.TEXTURE_2D,m,!0);var w=this._getSamplingParameters(g,d);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,w.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,w.min),d&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(m),m},Ha.a.prototype.createRawCubeTexture=function(e,b,a,c,d,f,g,h){void 0===h&&(h=null);var j=this._gl,m=new mb.a(this,mb.b.CubeRaw);m.isCube=!0,m.format=a,m.type=c,this._doNotHandleContextLost||(m._bufferViewArray=e);var w=this._getWebGLTextureType(c),z=this._getInternalFormat(a);z===j.RGB&&(z=j.RGBA),w!==j.FLOAT||this._caps.textureFloatLinearFiltering?w!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?w!==j.FLOAT||this._caps.textureFloatRender?w!==j.HALF_FLOAT||this._caps.colorBufferFloat||(d=!1,k.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(d=!1,k.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(d=!1,g=p.a.TEXTURE_NEAREST_SAMPLINGMODE,k.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(d=!1,g=p.a.TEXTURE_NEAREST_SAMPLINGMODE,k.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var C=b,J=C;m.width=C,m.height=J,!this.needPOTTextures||Qa.b.IsExponentOfTwo(m.width)&&Qa.b.IsExponentOfTwo(m.height)||(d=!1),e&&this.updateRawCubeTexture(m,e,a,c,f,h),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,m,!0),e&&d&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var K=this._getSamplingParameters(g,d);return j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,K.mag),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,K.min),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null),m.generateMipMaps=d,m},Ha.a.prototype.updateRawCubeTexture=function(e,b,a,c,d,f,g){void 0===f&&(f=null),void 0===g&&(g=0),e._bufferViewArray=b,e.format=a,e.type=c,e.invertY=d,e._compression=f;var h=this._gl,j=this._getWebGLTextureType(c),m=this._getInternalFormat(a),w=this._getRGBABufferInternalSizedFormat(c),z=!1;m===h.RGB&&(m=h.RGBA,z=!0),this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===d||!!d),e.width%4!=0&&h.pixelStorei(h.UNPACK_ALIGNMENT,1);for(var C=0;C<6;C++){var J=b[C];f?h.compressedTexImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+C,g,this.getCaps().s3tc[f],e.width,e.height,0,J):(z&&(J=this._convertRGBtoRGBATextureData(J,e.width,e.height,c)),h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+C,g,w,e.width,e.height,0,m,j,J))}(!this.needPOTTextures||Qa.b.IsExponentOfTwo(e.width)&&Qa.b.IsExponentOfTwo(e.height))&&e.generateMipMaps&&0===g&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},Ha.a.prototype.createRawCubeTextureFromUrl=function(e,b,a,c,d,f,g,h,j,m,w,z){var C=this;void 0===j&&(j=null),void 0===m&&(m=null),void 0===w&&(w=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===z&&(z=!1);var J=this._gl,K=this.createRawCubeTexture(null,a,c,d,!f,z,w,null);return b._addPendingData(K),K.url=e,this._internalTexturesCache.push(K),this._loadFile(e,function(N){!function(T){var Z=K.width,_=g(T);if(_){if(h){var ca=C._getWebGLTextureType(d),ea=C._getInternalFormat(c),fa=C._getRGBABufferInternalSizedFormat(d),ka=!1;ea===J.RGB&&(ea=J.RGBA,ka=!0),C._bindTextureDirectly(J.TEXTURE_CUBE_MAP,K,!0),C._unpackFlipY(!1);for(var pa=h(_),va=0;va<pa.length;va++)for(var sa=Z>>va,la=0;la<6;la++){var ta=pa[va][la];ka&&(ta=C._convertRGBtoRGBATextureData(ta,sa,sa,d)),J.texImage2D(la,va,fa,sa,sa,0,ea,ca,ta)}C._bindTextureDirectly(J.TEXTURE_CUBE_MAP,null)}else C.updateRawCubeTexture(K,_,c,d,z);K.isReady=!0,b._removePendingData(K),j&&j()}}(N)},void 0,b.offlineProvider,!0,function(N,T){b._removePendingData(K),m&&N&&m(N.status+" "+N.statusText,T)}),K},Ha.a.prototype.createRawTexture2DArray=Lh(!1),Ha.a.prototype.createRawTexture3D=Lh(!0),Ha.a.prototype.updateRawTexture2DArray=Mh(!1),Ha.a.prototype.updateRawTexture3D=Mh(!0);var vc=function(e){function b(a,c,d,f,g,h,j,m,w){void 0===h&&(h=!0),void 0===j&&(j=!1),void 0===m&&(m=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===w&&(w=p.a.TEXTURETYPE_UNSIGNED_INT);var z=e.call(this,null,g,!h,j)||this;return z.format=f,z._engine=g.getEngine(),z._texture=g.getEngine().createRawTexture(a,c,d,f,h,j,m,null,w),z.wrapU=ya.a.CLAMP_ADDRESSMODE,z.wrapV=ya.a.CLAMP_ADDRESSMODE,z}return Object(l.d)(b,e),b.prototype.update=function(a){this._engine.updateRawTexture(this._texture,a,this._texture.format,this._texture.invertY,null,this._texture.type)},b.CreateLuminanceTexture=function(a,c,d,f,g,h,j){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===j&&(j=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new b(a,c,d,p.a.TEXTUREFORMAT_LUMINANCE,f,g,h,j)},b.CreateLuminanceAlphaTexture=function(a,c,d,f,g,h,j){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===j&&(j=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new b(a,c,d,p.a.TEXTUREFORMAT_LUMINANCE_ALPHA,f,g,h,j)},b.CreateAlphaTexture=function(a,c,d,f,g,h,j){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===j&&(j=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new b(a,c,d,p.a.TEXTUREFORMAT_ALPHA,f,g,h,j)},b.CreateRGBTexture=function(a,c,d,f,g,h,j,m){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===j&&(j=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===m&&(m=p.a.TEXTURETYPE_UNSIGNED_INT),new b(a,c,d,p.a.TEXTUREFORMAT_RGB,f,g,h,j,m)},b.CreateRGBATexture=function(a,c,d,f,g,h,j,m){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===j&&(j=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===m&&(m=p.a.TEXTURETYPE_UNSIGNED_INT),new b(a,c,d,p.a.TEXTUREFORMAT_RGBA,f,g,h,j,m)},b.CreateRTexture=function(a,c,d,f,g,h,j,m){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===j&&(j=ya.a.TRILINEAR_SAMPLINGMODE),void 0===m&&(m=p.a.TEXTURETYPE_FLOAT),new b(a,c,d,p.a.TEXTUREFORMAT_R,f,g,h,j,m)},b}(ya.a),Tf=function(){function e(b,a,c){this.name=b,this.id=a,this.bones=new Array(),this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array(),this._identity=i.a.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new I.c(),this.bones=[],this._scene=c||U.a.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var d=this._scene.getEngine().getCaps();this._canUseTextureForBones=d.textureFloat&&d.maxVertexTextureImageUnits>0}return Object.defineProperty(e.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(b){this._useTextureToStoreBoneMatrices=b,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(b){this._animationPropertiesOverride=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"Skeleton"},e.prototype.getChildren=function(){return this.bones.filter(function(b){return!b.getParent()})},e.prototype.getTransformMatrices=function(b){return this.needInitialSkinMatrix&&b._bonesTransformMatrices?b._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},e.prototype.getTransformMatrixTexture=function(b){return this.needInitialSkinMatrix&&b._transformMatrixTexture?b._transformMatrixTexture:this._transformMatrixTexture},e.prototype.getScene=function(){return this._scene},e.prototype.toString=function(b){var a="Name: "+this.name+", nBones: "+this.bones.length;if(a+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),b){a+=", Ranges: {";var c=!0;for(var d in this._ranges)c&&(a+=", ",c=!1),a+=d;a+="}"}return a},e.prototype.getBoneIndexByName=function(b){for(var a=0,c=this.bones.length;a<c;a++)if(this.bones[a].name===b)return a;return-1},e.prototype.createAnimationRange=function(b,a,c){if(!this._ranges[b]){this._ranges[b]=new $(b,a,c);for(var d=0,f=this.bones.length;d<f;d++)this.bones[d].animations[0]&&this.bones[d].animations[0].createRange(b,a,c)}},e.prototype.deleteAnimationRange=function(b,a){void 0===a&&(a=!0);for(var c=0,d=this.bones.length;c<d;c++)this.bones[c].animations[0]&&this.bones[c].animations[0].deleteRange(b,a);this._ranges[b]=null},e.prototype.getAnimationRange=function(b){return this._ranges[b]},e.prototype.getAnimationRanges=function(){var b,a=[];for(b in this._ranges)a.push(this._ranges[b]);return a},e.prototype.copyAnimationRange=function(b,a,c){if(void 0===c&&(c=!1),this._ranges[a]||!b.getAnimationRange(a))return!1;var d,f,g=!0,h=this._getHighestAnimationFrame()+1,j={},m=b.bones;for(f=0,d=m.length;f<d;f++)j[m[f].name]=m[f];this.bones.length!==m.length&&(k.a.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+m.length),g=!1);var w=c&&this.dimensionsAtRest&&b.dimensionsAtRest?this.dimensionsAtRest.divide(b.dimensionsAtRest):null;for(f=0,d=this.bones.length;f<d;f++){var z=this.bones[f].name,C=j[z];C?g=g&&this.bones[f].copyAnimationRange(C,a,h,c,w):(k.a.Warn("copyAnimationRange: not same rig, missing source bone "+z),g=!1)}var J=b.getAnimationRange(a);return J&&(this._ranges[a]=new $(a,J.from+h,J.to+h)),g},e.prototype.returnToRest=function(){for(var b=0;b<this.bones.length;b++)this.bones[b].returnToRest()},e.prototype._getHighestAnimationFrame=function(){for(var b=0,a=0,c=this.bones.length;a<c;a++)if(this.bones[a].animations[0]){var d=this.bones[a].animations[0].getHighestFrame();b<d&&(b=d)}return b},e.prototype.beginAnimation=function(b,a,c,d){var f=this.getAnimationRange(b);return f?this._scene.beginAnimation(this,f.from,f.to,a,c,d):null},e.prototype._markAsDirty=function(){this._isDirty=!0},e.prototype._registerMeshWithPoseMatrix=function(b){this._meshesWithPoseMatrix.push(b)},e.prototype._unregisterMeshWithPoseMatrix=function(b){var a=this._meshesWithPoseMatrix.indexOf(b);a>-1&&this._meshesWithPoseMatrix.splice(a,1)},e.prototype._computeTransformMatrices=function(b,a){this.onBeforeComputeObservable.notifyObservers(this);for(var c=0;c<this.bones.length;c++){var d=this.bones[c];d._childUpdateId++;var f=d.getParent();if(f?d.getLocalMatrix().multiplyToRef(f.getWorldMatrix(),d.getWorldMatrix()):a?d.getLocalMatrix().multiplyToRef(a,d.getWorldMatrix()):d.getWorldMatrix().copyFrom(d.getLocalMatrix()),-1!==d._index){var g=null===d._index?c:d._index;d.getInvertedAbsoluteTransform().multiplyToArray(d.getWorldMatrix(),b,16*g)}}this._identity.copyToArray(b,16*this.bones.length)},e.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var b=0,a=this.bones;b<a.length;b++){var c=a[b];c._linkedTransformNode&&(c._linkedTransformNode.computeWorldMatrix(),c._matrix=c._linkedTransformNode._localMatrix,c.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var d=0;d<this._meshesWithPoseMatrix.length;d++){var f=this._meshesWithPoseMatrix[d],g=f.getPoseMatrix();if(f._bonesTransformMatrices&&f._bonesTransformMatrices.length===16*(this.bones.length+1)||(f._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==f){this._synchronizedWithMesh=f;for(var h=0;h<this.bones.length;h++){var j=this.bones[h];j.getParent()||(j.getBaseMatrix().multiplyToRef(g,i.c.Matrix[1]),j._updateDifferenceMatrix(i.c.Matrix[1]))}if(this.isUsingTextureForMatrices){var m=4*(this.bones.length+1);f._transformMatrixTexture&&f._transformMatrixTexture.getSize().width===m||(f._transformMatrixTexture&&f._transformMatrixTexture.dispose(),f._transformMatrixTexture=vc.CreateRGBATexture(f._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,p.a.TEXTURE_NEAREST_SAMPLINGMODE,p.a.TEXTURETYPE_FLOAT))}}this._computeTransformMatrices(f._bonesTransformMatrices,g),this.isUsingTextureForMatrices&&f._transformMatrixTexture&&f._transformMatrixTexture.update(f._bonesTransformMatrices)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=vc.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,p.a.TEXTURE_NEAREST_SAMPLINGMODE,p.a.TEXTURETYPE_FLOAT))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},e.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var b=0;b<this.bones.length;b++)this._animatables.push(this.bones[b])}return this._animatables},e.prototype.clone=function(b,a){var c=new e(b,a||b,this._scene);c.needInitialSkinMatrix=this.needInitialSkinMatrix,c.overrideMesh=this.overrideMesh;for(var d=0;d<this.bones.length;d++){var f=this.bones[d],g=null,h=f.getParent();if(h){var j=this.bones.indexOf(h);g=c.bones[j]}var m=new Na(f.name,c,g,f.getBaseMatrix().clone(),f.getRestPose().clone());m._index=f._index,f._linkedTransformNode&&m.linkTransformNode(f._linkedTransformNode),P.a.DeepCopy(f.animations,m.animations)}if(this._ranges)for(var w in c._ranges={},this._ranges){var z=this._ranges[w];z&&(c._ranges[w]=z.clone())}return this._isDirty=!0,c},e.prototype.enableBlending=function(b){void 0===b&&(b=.01),this.bones.forEach(function(a){a.animations.forEach(function(c){c.enableBlending=!0,c.blendingSpeed=b})})},e.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},e.prototype.serialize=function(){var b={};b.name=this.name,b.id=this.id,this.dimensionsAtRest&&(b.dimensionsAtRest=this.dimensionsAtRest.asArray()),b.bones=[],b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var a=0;a<this.bones.length;a++){var c=this.bones[a],d=c.getParent(),f={parentBoneIndex:d?this.bones.indexOf(d):-1,name:c.name,matrix:c.getBaseMatrix().toArray(),rest:c.getRestPose().toArray()};for(var g in b.bones.push(f),c.length&&(f.length=c.length),c.metadata&&(f.metadata=c.metadata),c.animations&&c.animations.length>0&&(f.animation=c.animations[0].serialize()),b.ranges=[],this._ranges){var h=this._ranges[g];if(h){var j={};j.name=g,j.from=h.from,j.to=h.to,b.ranges.push(j)}}}return b},e.Parse=function(b,a){var c,d=new e(b.name,b.id,a);for(b.dimensionsAtRest&&(d.dimensionsAtRest=i.e.FromArray(b.dimensionsAtRest)),d.needInitialSkinMatrix=b.needInitialSkinMatrix,c=0;c<b.bones.length;c++){var f=b.bones[c],g=null;f.parentBoneIndex>-1&&(g=d.bones[f.parentBoneIndex]);var h=f.rest?i.a.FromArray(f.rest):null,j=new Na(f.name,d,g,i.a.FromArray(f.matrix),h);void 0!==f.id&&null!==f.id&&(j.id=f.id),f.length&&(j.length=f.length),f.metadata&&(j.metadata=f.metadata),f.animation&&j.animations.push(V.Parse(f.animation)),void 0!==f.linkedTransformNodeId&&null!==f.linkedTransformNodeId&&(d._hasWaitingData=!0,j._waitingTransformNodeId=f.linkedTransformNodeId)}if(b.ranges)for(c=0;c<b.ranges.length;c++){var m=b.ranges[c];d.createAnimationRange(m.name,m.from,m.to)}return d},e.prototype.computeAbsoluteTransforms=function(b){void 0===b&&(b=!1);var a=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=a||b)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=a)},e.prototype.getPoseMatrix=function(){var b=null;return this._meshesWithPoseMatrix.length>0&&(b=this._meshesWithPoseMatrix[0].getPoseMatrix()),b},e.prototype.sortBones=function(){for(var b=new Array(),a=new Array(this.bones.length),c=0;c<this.bones.length;c++)this._sortBones(c,b,a);this.bones=b},e.prototype._sortBones=function(b,a,c){if(!c[b]){c[b]=!0;var d=this.bones[b];void 0===d._index&&(d._index=b);var f=d.getParent();f&&this._sortBones(this.bones.indexOf(f),a,c),a.push(d)}},e}(),Qb={},pe=function(){function e(b){this.attached={},this.camera=b,this.checkInputs=function(){}}return e.prototype.add=function(b){var a=b.getSimpleName();this.attached[a]?k.a.Warn("camera input of type "+a+" already exists on camera"):(this.attached[a]=b,b.camera=this.camera,b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b))),this.attachedElement&&b.attachControl(this.attachedElement))},e.prototype.remove=function(b){for(var a in this.attached){var c=this.attached[a];c===b&&(c.detachControl(this.attachedElement),c.camera=null,delete this.attached[a],this.rebuildInputCheck())}},e.prototype.removeByType=function(b){for(var a in this.attached){var c=this.attached[a];c.getClassName()===b&&(c.detachControl(this.attachedElement),c.camera=null,delete this.attached[a],this.rebuildInputCheck())}},e.prototype._addCheckInputs=function(b){var a=this.checkInputs;return function(){a(),b()}},e.prototype.attachInput=function(b){this.attachedElement&&b.attachControl(this.attachedElement,this.noPreventDefault)},e.prototype.attachElement=function(b,a){if(void 0===a&&(a=!1),!this.attachedElement)for(var c in a=!hb.a.ForceAttachControlToAlwaysPreventDefault&&a,this.attachedElement=b,this.noPreventDefault=a,this.attached)this.attached[c].attachControl(b,a)},e.prototype.detachElement=function(b,a){if(void 0===a&&(a=!1),this.attachedElement===b){for(var c in this.attached)this.attached[c].detachControl(b),a&&(this.attached[c].camera=null);this.attachedElement=null}},e.prototype.rebuildInputCheck=function(){for(var b in this.checkInputs=function(){},this.attached){var a=this.attached[b];a.checkInputs&&(this.checkInputs=this._addCheckInputs(a.checkInputs.bind(a)))}},e.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},e.prototype.serialize=function(b){var a={};for(var c in this.attached){var d=this.attached[c],f=F.a.Serialize(d);a[d.getClassName()]=f}b.inputsmgr=a},e.prototype.parse=function(b){var a=b.inputsmgr;if(a){for(var c in this.clear(),a)if(g=Qb[c]){var d=a[c],f=F.a.Parse(function(){return new g()},d,null);this.add(f)}}else for(var c in this.attached){var g;(g=Qb[this.attached[c].getClassName()])&&(f=F.a.Parse(function(){return new g()},b,null),this.remove(this.attached[c]),this.add(f))}},e}(),Rl=function(e,b){this.x=e,this.y=b},Pb=function(){function e(b,a,c,d,f,g,h){void 0===d&&(d=0),void 0===f&&(f=1),void 0===g&&(g=2),void 0===h&&(h=3),this.id=b,this.index=a,this.browserGamepad=c,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=e.GAMEPAD,this._leftStickAxisX=d,this._leftStickAxisY=f,this._rightStickAxisX=g,this._rightStickAxisY=h,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),e.prototype.onleftstickchanged=function(b){this._onleftstickchanged=b},e.prototype.onrightstickchanged=function(b){this._onrightstickchanged=b},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(b){!this._onleftstickchanged||this._leftStick.x===b.x&&this._leftStick.y===b.y||this._onleftstickchanged(b),this._leftStick=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(b){!this._onrightstickchanged||this._rightStick.x===b.x&&this._rightStick.y===b.y||this._onrightstickchanged(b),this._rightStick=b},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},e.prototype.dispose=function(){},e.GAMEPAD=0,e.GENERIC=1,e.XBOX=2,e.POSE_ENABLED=3,e.DUALSHOCK=4,e}(),Nh=function(e){function b(a,c,d){var f=e.call(this,a,c,d)||this;return f.onButtonDownObservable=new I.c(),f.onButtonUpObservable=new I.c(),f.type=Pb.GENERIC,f._buttons=new Array(d.buttons.length),f}return Object(l.d)(b,e),b.prototype.onbuttondown=function(a){this._onbuttondown=a},b.prototype.onbuttonup=function(a){this._onbuttonup=a},b.prototype._setButtonValue=function(a,c,d){return a!==c&&(1===a&&(this._onbuttondown&&this._onbuttondown(d),this.onButtonDownObservable.notifyObservers(d)),0===a&&(this._onbuttonup&&this._onbuttonup(d),this.onButtonUpObservable.notifyObservers(d))),a},b.prototype.update=function(){e.prototype.update.call(this);for(var a=0;a<this._buttons.length;a++)this._buttons[a]=this._setButtonValue(this.browserGamepad.buttons[a].value,this._buttons[a],a)},b.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},b}(Pb),Uf=function(){function e(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}return Object.defineProperty(e.prototype,"invertYAxis",{get:function(){return 1!==this._yAxisScale},set:function(b){this._yAxisScale=b?-1:1},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(b,a){var c=this,d=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=d.onGamepadConnectedObservable.add(function(f){f.type!==Pb.POSE_ENABLED&&(c.gamepad&&f.type!==Pb.XBOX||(c.gamepad=f))}),this._onGamepadDisconnectedObserver=d.onGamepadDisconnectedObservable.add(function(f){c.gamepad===f&&(c.gamepad=null)}),this.gamepad=d.getGamepadByType(Pb.XBOX)},e.prototype.detachControl=function(b){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},e.prototype.checkInputs=function(){if(this.gamepad){var b=this.camera,a=this.gamepad.rightStick;if(a){if(0!=a.x){var c=a.x/this.gamepadRotationSensibility;0!=c&&Math.abs(c)>.005&&(b.inertialAlphaOffset+=c)}if(0!=a.y){var d=a.y/this.gamepadRotationSensibility*this._yAxisScale;0!=d&&Math.abs(d)>.005&&(b.inertialBetaOffset+=d)}}var f=this.gamepad.leftStick;if(f&&0!=f.y){var g=f.y/this.gamepadMoveSensibility;0!=g&&Math.abs(g)>.005&&(this.camera.inertialRadiusOffset-=g)}}},e.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},e.prototype.getSimpleName=function(){return"gamepad"},Object(l.c)([Object(F.c)()],e.prototype,"gamepadRotationSensibility",void 0),Object(l.c)([Object(F.c)()],e.prototype,"gamepadMoveSensibility",void 0),e}();Qb.ArcRotateCameraGamepadInput=Uf;var id=o(63),Vf=function(){function e(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array()}return e.prototype.attachControl=function(b,a){var c=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){c._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(d){var f,g=d.event;g.metaKey||(d.type===id.a.KEYDOWN?(c._ctrlPressed=g.ctrlKey,c._altPressed=g.altKey,(-1!==c.keysUp.indexOf(g.keyCode)||-1!==c.keysDown.indexOf(g.keyCode)||-1!==c.keysLeft.indexOf(g.keyCode)||-1!==c.keysRight.indexOf(g.keyCode)||-1!==c.keysReset.indexOf(g.keyCode))&&(-1===(f=c._keys.indexOf(g.keyCode))&&c._keys.push(g.keyCode),g.preventDefault&&(a||g.preventDefault()))):-1===c.keysUp.indexOf(g.keyCode)&&-1===c.keysDown.indexOf(g.keyCode)&&-1===c.keysLeft.indexOf(g.keyCode)&&-1===c.keysRight.indexOf(g.keyCode)&&-1===c.keysReset.indexOf(g.keyCode)||((f=c._keys.indexOf(g.keyCode))>=0&&c._keys.splice(f,1),g.preventDefault&&(a||g.preventDefault())))}))},e.prototype.detachControl=function(b){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var b=this.camera,a=0;a<this._keys.length;a++){var c=this._keys[a];-1!==this.keysLeft.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningX-=1/this.panningSensibility:b.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?b.inertialRadiusOffset+=1/this.zoomingSensibility:b.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningX+=1/this.panningSensibility:b.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?b.inertialRadiusOffset-=1/this.zoomingSensibility:b.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(c)&&b.useInputToRestoreState&&b.restoreState()}},e.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},e.prototype.getSimpleName=function(){return"keyboard"},Object(l.c)([Object(F.c)()],e.prototype,"keysUp",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysDown",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysLeft",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRight",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysReset",void 0),Object(l.c)([Object(F.c)()],e.prototype,"panningSensibility",void 0),Object(l.c)([Object(F.c)()],e.prototype,"zoomingSensibility",void 0),Object(l.c)([Object(F.c)()],e.prototype,"useAltToZoom",void 0),Object(l.c)([Object(F.c)()],e.prototype,"angularSpeed",void 0),e}();Qb.ArcRotateCameraKeyboardMoveInput=Vf;var Wf=function(){function e(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return e.prototype.computeDeltaFromMouseWheelLegacyEvent=function(b,a){var c=.01*b*this.wheelDeltaPercentage*a;return b>0?c/(1+this.wheelDeltaPercentage):c*(1+this.wheelDeltaPercentage)},e.prototype.attachControl=function(b,a){var c=this;this._wheel=function(d,f){if(d.type===lb.a.POINTERWHEEL){var g=d.event,h=0,j=g,m=0;if(m=j.wheelDelta?j.wheelDelta:60*-(g.deltaY||g.detail),c.wheelDeltaPercentage){if((h=c.computeDeltaFromMouseWheelLegacyEvent(m,c.camera.radius))>0){for(var w=c.camera.radius,z=c.camera.inertialRadiusOffset+h,C=0;C<20&&Math.abs(z)>.001;C++)w-=z,z*=c.camera.inertia;w=aa.a.Clamp(w,0,Number.MAX_VALUE),h=c.computeDeltaFromMouseWheelLegacyEvent(m,w)}}else h=m/(40*c.wheelPrecision);h&&(c.camera.inertialRadiusOffset+=h),g.preventDefault&&(a||g.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,lb.a.POINTERWHEEL)},e.prototype.detachControl=function(b){this._observer&&b&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},e.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},e.prototype.getSimpleName=function(){return"mousewheel"},Object(l.c)([Object(F.c)()],e.prototype,"wheelPrecision",void 0),Object(l.c)([Object(F.c)()],e.prototype,"wheelDeltaPercentage",void 0),e}();Qb.ArcRotateCameraMouseWheelInput=Wf;var Oh=function(){function e(){this.buttons=[0,1,2]}return e.prototype.attachControl=function(b,a){var c=this,d=this.camera.getEngine(),f=0,g=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(j,m){var w=j.event,z="touch"===w.pointerType;if(!d.isInVRExclusivePointerMode&&(j.type===lb.a.POINTERMOVE||-1!==c.buttons.indexOf(w.button))){var C=w.srcElement||w.target;if(c._altKey=w.altKey,c._ctrlKey=w.ctrlKey,c._metaKey=w.metaKey,c._shiftKey=w.shiftKey,c._buttonsPressed=w.buttons,d.isPointerLock){var J=w.movementX||w.mozMovementX||w.webkitMovementX||w.msMovementX||0,K=w.movementY||w.mozMovementY||w.webkitMovementY||w.msMovementY||0;c.onTouch(null,J,K),c.pointA=null,c.pointB=null}else if(j.type===lb.a.POINTERDOWN&&C){try{C.setPointerCapture(w.pointerId)}catch(ea){}null===c.pointA?c.pointA={x:w.clientX,y:w.clientY,pointerId:w.pointerId,type:w.pointerType}:null===c.pointB&&(c.pointB={x:w.clientX,y:w.clientY,pointerId:w.pointerId,type:w.pointerType}),c.onButtonDown(w),a||(w.preventDefault(),b.focus())}else if(j.type===lb.a.POINTERDOUBLETAP)c.onDoubleTap(w.pointerType);else if(j.type===lb.a.POINTERUP&&C){try{C.releasePointerCapture(w.pointerId)}catch(ea){}z||(c.pointB=null),d._badOS?c.pointA=c.pointB=null:c.pointB&&c.pointA&&c.pointA.pointerId==w.pointerId?(c.pointA=c.pointB,c.pointB=null):c.pointA&&c.pointB&&c.pointB.pointerId==w.pointerId?c.pointB=null:c.pointA=c.pointB=null,(0!==f||g)&&(c.onMultiTouch(c.pointA,c.pointB,f,0,g,null),f=0,g=null),c.onButtonUp(w),a||w.preventDefault()}else if(j.type===lb.a.POINTERMOVE){if(a||w.preventDefault(),c.pointA&&null===c.pointB)J=w.clientX-c.pointA.x,K=w.clientY-c.pointA.y,c.onTouch(c.pointA,J,K),c.pointA.x=w.clientX,c.pointA.y=w.clientY;else if(c.pointA&&c.pointB){var N=c.pointA.pointerId===w.pointerId?c.pointA:c.pointB;N.x=w.clientX,N.y=w.clientY;var T=c.pointA.x-c.pointB.x,Z=c.pointA.y-c.pointB.y,_=T*T+Z*Z,ca={x:(c.pointA.x+c.pointB.x)/2,y:(c.pointA.y+c.pointB.y)/2,pointerId:w.pointerId,type:j.type};c.onMultiTouch(c.pointA,c.pointB,f,_,g,ca),g=ca,f=_}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,lb.a.POINTERDOWN|lb.a.POINTERUP|lb.a.POINTERMOVE),this._onLostFocus=function(){c.pointA=c.pointB=null,f=0,g=null,c.onLostFocus()},b.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var h=this.camera.getScene().getEngine().getHostWindow();h&&Qa.b.RegisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])},e.prototype.detachControl=function(b){if(this._onLostFocus){var a=this.camera.getScene().getEngine().getHostWindow();a&&Qa.b.UnregisterTopRootEvents(a,[{name:"blur",handler:this._onLostFocus}])}b&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu&&b.removeEventListener("contextmenu",this.onContextMenu),this._onLostFocus=null),this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},e.prototype.getClassName=function(){return"BaseCameraPointersInput"},e.prototype.getSimpleName=function(){return"pointers"},e.prototype.onDoubleTap=function(b){},e.prototype.onTouch=function(b,a,c){},e.prototype.onMultiTouch=function(b,a,c,d,f,g){},e.prototype.onContextMenu=function(b){b.preventDefault()},e.prototype.onButtonDown=function(b){},e.prototype.onButtonUp=function(b){},e.prototype.onLostFocus=function(){},Object(l.c)([Object(F.c)()],e.prototype,"buttons",void 0),e}(),Xf=function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;return a.buttons=[0,1,2],a.angularSensibilityX=1000,a.angularSensibilityY=1000,a.pinchPrecision=12,a.pinchDeltaPercentage=0,a.useNaturalPinchZoom=!1,a.panningSensibility=1000,a.multiTouchPanning=!0,a.multiTouchPanAndZoom=!0,a.pinchInwards=!0,a._isPanClick=!1,a._twoFingerActivityCount=0,a._isPinching=!1,a}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},b.prototype.onTouch=function(a,c,d){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-c/this.panningSensibility,this.camera.inertialPanningY+=d/this.panningSensibility):(this.camera.inertialAlphaOffset-=c/this.angularSensibilityX,this.camera.inertialBetaOffset-=d/this.angularSensibilityY)},b.prototype.onDoubleTap=function(a){this.camera.useInputToRestoreState&&this.camera.restoreState()},b.prototype.onMultiTouch=function(a,c,d,f,g,h){if(!(0===d&&null===g||0===f&&null===h)){var j=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(d)/Math.sqrt(f):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(f-d)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(f-d)/(this.pinchPrecision*j*(this.angularSensibilityX+this.angularSensibilityY)/2),0!==this.panningSensibility&&g&&h){var m=h.x-g.x,w=h.y-g.y;this.camera.inertialPanningX+=-m/this.panningSensibility,this.camera.inertialPanningY+=w/this.panningSensibility}}else{this._twoFingerActivityCount++;var z=Math.sqrt(d),C=Math.sqrt(f);this._isPinching||this._twoFingerActivityCount<20&&Math.abs(C-z)>this.camera.pinchToPanMaxDistance?(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(f-d)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(f-d)/(this.pinchPrecision*j*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0):0!==this.panningSensibility&&this.multiTouchPanning&&h&&g&&(m=h.x-g.x,w=h.y-g.y,this.camera.inertialPanningX+=-m/this.panningSensibility,this.camera.inertialPanningY+=w/this.panningSensibility)}}},b.prototype.onButtonDown=function(a){this._isPanClick=a.button===this.camera._panningMouseButton},b.prototype.onButtonUp=function(a){this._twoFingerActivityCount=0,this._isPinching=!1},b.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},Object(l.c)([Object(F.c)()],b.prototype,"buttons",void 0),Object(l.c)([Object(F.c)()],b.prototype,"angularSensibilityX",void 0),Object(l.c)([Object(F.c)()],b.prototype,"angularSensibilityY",void 0),Object(l.c)([Object(F.c)()],b.prototype,"pinchPrecision",void 0),Object(l.c)([Object(F.c)()],b.prototype,"pinchDeltaPercentage",void 0),Object(l.c)([Object(F.c)()],b.prototype,"useNaturalPinchZoom",void 0),Object(l.c)([Object(F.c)()],b.prototype,"panningSensibility",void 0),Object(l.c)([Object(F.c)()],b.prototype,"multiTouchPanning",void 0),Object(l.c)([Object(F.c)()],b.prototype,"multiTouchPanAndZoom",void 0),b}(Oh);Qb.ArcRotateCameraPointersInput=Xf;var We=function(e){function b(a){return e.call(this,a)||this}return Object(l.d)(b,e),b.prototype.addMouseWheel=function(){return this.add(new Wf()),this},b.prototype.addPointers=function(){return this.add(new Xf()),this},b.prototype.addKeyboard=function(){return this.add(new Vf()),this},b}(pe);We.prototype.addVRDeviceOrientation=function(){return this.add(new Yf()),this};var Yf=function(){function e(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return e.prototype.attachControl=function(b,a){var c=this;this.camera.attachControl(b,a);var d=this.camera.getScene().getEngine().getHostWindow();d&&("undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(f){"granted"===f?d.addEventListener("deviceorientation",c._deviceOrientationHandler):Qa.b.Warn("Permission not granted.")}).catch(function(f){Qa.b.Error(f)}):d.addEventListener("deviceorientation",this._deviceOrientationHandler))},e.prototype._onOrientationEvent=function(b){null!==b.alpha&&(this._alpha=(0|+b.alpha)*this.alphaCorrection),null!==b.gamma&&(this._gamma=(0|+b.gamma)*this.gammaCorrection),this._dirty=!0},e.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},e.prototype.detachControl=function(b){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"VRDeviceOrientation"},e}();Qb.ArcRotateCameraVRDeviceOrientationInput=Yf;var Zf=function(){function e(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array()}return e.prototype.attachControl=function(b,a){var c=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){c._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(d){var f,g=d.event;d.type===id.a.KEYDOWN?-1===c.keysForward.indexOf(g.keyCode)&&-1===c.keysBackward.indexOf(g.keyCode)&&-1===c.keysUp.indexOf(g.keyCode)&&-1===c.keysDown.indexOf(g.keyCode)&&-1===c.keysLeft.indexOf(g.keyCode)&&-1===c.keysRight.indexOf(g.keyCode)||(-1===(f=c._keys.indexOf(g.keyCode))&&c._keys.push(g.keyCode),a||g.preventDefault()):-1===c.keysForward.indexOf(g.keyCode)&&-1===c.keysBackward.indexOf(g.keyCode)&&-1===c.keysUp.indexOf(g.keyCode)&&-1===c.keysDown.indexOf(g.keyCode)&&-1===c.keysLeft.indexOf(g.keyCode)&&-1===c.keysRight.indexOf(g.keyCode)||((f=c._keys.indexOf(g.keyCode))>=0&&c._keys.splice(f,1),a||g.preventDefault())}))},e.prototype.detachControl=function(b){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},e.prototype._onLostFocus=function(b){this._keys=[]},e.prototype.getSimpleName=function(){return"keyboard"},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var b=this.camera,a=0;a<this._keys.length;a++){var c=this._keys[a],d=b._computeLocalCameraSpeed();-1!==this.keysForward.indexOf(c)?b._localDirection.copyFromFloats(0,0,d):-1!==this.keysBackward.indexOf(c)?b._localDirection.copyFromFloats(0,0,-d):-1!==this.keysUp.indexOf(c)?b._localDirection.copyFromFloats(0,d,0):-1!==this.keysDown.indexOf(c)?b._localDirection.copyFromFloats(0,-d,0):-1!==this.keysRight.indexOf(c)?b._localDirection.copyFromFloats(d,0,0):-1!==this.keysLeft.indexOf(c)&&b._localDirection.copyFromFloats(-d,0,0),b.getScene().useRightHandedSystem&&(b._localDirection.z*=-1),b.getViewMatrix().invertToRef(b._cameraTransformMatrix),i.e.TransformNormalToRef(b._localDirection,b._cameraTransformMatrix,b._transformedDirection),b.cameraDirection.addInPlace(b._transformedDirection)}},Object(l.c)([Object(F.c)()],e.prototype,"keysForward",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysBackward",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysUp",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysDown",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRight",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysLeft",void 0),e}();Qb.FlyCameraKeyboardInput=Zf;var _f=function(){function e(b){void 0===b&&(b=!0),this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1000,this.previousPosition=null}return e.prototype.attachControl=function(b,a){var c=this;this.element=b,this.noPreventDefault=a,this._observer=this.camera.getScene().onPointerObservable.add(function(d,f){c._pointerInput(d,f)},lb.a.POINTERDOWN|lb.a.POINTERUP|lb.a.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add(function(){c.camera.rollCorrect&&c.camera.restoreRoll(c.camera.rollCorrect)}),this._mousemoveCallback=function(d){c._onMouseMove(d)},b.addEventListener("mousemove",this._mousemoveCallback,!1)},e.prototype.detachControl=function(b){this._observer&&b&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._mousemoveCallback&&b.removeEventListener("mousemove",this._mousemoveCallback),this._observer=null,this._rollObserver=null,this.previousPosition=null,this.noPreventDefault=void 0)},e.prototype.getClassName=function(){return"FlyCameraMouseInput"},e.prototype.getSimpleName=function(){return"mouse"},e.prototype._pointerInput=function(b,a){var c=b.event,d=this.camera.getEngine();if(!d.isInVRExclusivePointerMode&&(this.touchEnabled||"touch"!==c.pointerType)&&(b.type===lb.a.POINTERMOVE||-1!==this.buttons.indexOf(c.button))){var f=c.srcElement||c.target;if(b.type===lb.a.POINTERDOWN&&f){try{f.setPointerCapture(c.pointerId)}catch(j){}this.previousPosition={x:c.clientX,y:c.clientY},this.activeButton=c.button,this.noPreventDefault||(c.preventDefault(),this.element.focus())}else if(b.type===lb.a.POINTERUP&&f){try{f.releasePointerCapture(c.pointerId)}catch(j){}this.activeButton=-1,this.previousPosition=null,this.noPreventDefault||c.preventDefault()}else if(b.type===lb.a.POINTERMOVE){if(!this.previousPosition||d.isPointerLock)return;var g=c.clientX-this.previousPosition.x,h=c.clientY-this.previousPosition.y;this.rotateCamera(g,h),this.previousPosition={x:c.clientX,y:c.clientY},this.noPreventDefault||c.preventDefault()}}},e.prototype._onMouseMove=function(b){var a=this.camera.getEngine();if(a.isPointerLock&&!a.isInVRExclusivePointerMode){var c=b.movementX||b.mozMovementX||b.webkitMovementX||b.msMovementX||0,d=b.movementY||b.mozMovementY||b.webkitMovementY||b.msMovementY||0;this.rotateCamera(c,d),this.previousPosition=null,this.noPreventDefault||b.preventDefault()}},e.prototype.rotateCamera=function(b,a){var c=this,d=this.camera;this.camera.getScene().useRightHandedSystem&&(b*=-1),d.parent&&d.parent._getWorldMatrixDeterminant()<0&&(b*=-1);var f,g=b/this.angularSensibility,h=a/this.angularSensibility,j=i.b.RotationYawPitchRoll(d.rotation.y,d.rotation.x,d.rotation.z);if(this.buttonsPitch.some(function(z){return z===c.activeButton})&&(f=i.b.RotationAxis(Ba.a.X,h),j.multiplyInPlace(f)),this.buttonsYaw.some(function(z){return z===c.activeButton})){f=i.b.RotationAxis(Ba.a.Y,g),j.multiplyInPlace(f);var m=d.bankedTurnLimit+d._trackRoll;if(d.bankedTurn&&-m<d.rotation.z&&d.rotation.z<m){var w=d.bankedTurnMultiplier*-g;f=i.b.RotationAxis(Ba.a.Z,w),j.multiplyInPlace(f)}}this.buttonsRoll.some(function(z){return z===c.activeButton})&&(f=i.b.RotationAxis(Ba.a.Z,-g),d._trackRoll-=g,j.multiplyInPlace(f)),j.toEulerAnglesToRef(d.rotation)},Object(l.c)([Object(F.c)()],e.prototype,"buttons",void 0),Object(l.c)([Object(F.c)()],e.prototype,"angularSensibility",void 0),e}();Qb.FlyCameraMouseInput=_f;var $f=function(){function e(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array()}return e.prototype.attachControl=function(b,a){var c=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){c._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(d){var f,g=d.event;g.metaKey||(d.type===id.a.KEYDOWN?(c._ctrlPressed=g.ctrlKey,c._altPressed=g.altKey,c._shiftPressed=g.shiftKey,(-1!==c.keysHeightOffsetIncr.indexOf(g.keyCode)||-1!==c.keysHeightOffsetDecr.indexOf(g.keyCode)||-1!==c.keysRotationOffsetIncr.indexOf(g.keyCode)||-1!==c.keysRotationOffsetDecr.indexOf(g.keyCode)||-1!==c.keysRadiusIncr.indexOf(g.keyCode)||-1!==c.keysRadiusDecr.indexOf(g.keyCode))&&(-1===(f=c._keys.indexOf(g.keyCode))&&c._keys.push(g.keyCode),g.preventDefault&&(a||g.preventDefault()))):-1===c.keysHeightOffsetIncr.indexOf(g.keyCode)&&-1===c.keysHeightOffsetDecr.indexOf(g.keyCode)&&-1===c.keysRotationOffsetIncr.indexOf(g.keyCode)&&-1===c.keysRotationOffsetDecr.indexOf(g.keyCode)&&-1===c.keysRadiusIncr.indexOf(g.keyCode)&&-1===c.keysRadiusDecr.indexOf(g.keyCode)||((f=c._keys.indexOf(g.keyCode))>=0&&c._keys.splice(f,1),g.preventDefault&&(a||g.preventDefault())))}))},e.prototype.detachControl=function(b){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){var b=this;this._onKeyboardObserver&&this._keys.forEach(function(a){-1!==b.keysHeightOffsetIncr.indexOf(a)&&b._modifierHeightOffset()?b.camera.heightOffset+=b.heightSensibility:-1!==b.keysHeightOffsetDecr.indexOf(a)&&b._modifierHeightOffset()?b.camera.heightOffset-=b.heightSensibility:-1!==b.keysRotationOffsetIncr.indexOf(a)&&b._modifierRotationOffset()?(b.camera.rotationOffset+=b.rotationSensibility,b.camera.rotationOffset%=360):-1!==b.keysRotationOffsetDecr.indexOf(a)&&b._modifierRotationOffset()?(b.camera.rotationOffset-=b.rotationSensibility,b.camera.rotationOffset%=360):-1!==b.keysRadiusIncr.indexOf(a)&&b._modifierRadius()?b.camera.radius+=b.radiusSensibility:-1!==b.keysRadiusDecr.indexOf(a)&&b._modifierRadius()&&(b.camera.radius-=b.radiusSensibility)})},e.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},e.prototype.getSimpleName=function(){return"keyboard"},e.prototype._modifierHeightOffset=function(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed},e.prototype._modifierRotationOffset=function(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed},e.prototype._modifierRadius=function(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed},Object(l.c)([Object(F.c)()],e.prototype,"keysHeightOffsetIncr",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysHeightOffsetDecr",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysHeightOffsetModifierAlt",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysHeightOffsetModifierCtrl",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysHeightOffsetModifierShift",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRotationOffsetIncr",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRotationOffsetDecr",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRotationOffsetModifierAlt",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRotationOffsetModifierCtrl",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRotationOffsetModifierShift",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRadiusIncr",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRadiusDecr",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRadiusModifierAlt",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRadiusModifierCtrl",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRadiusModifierShift",void 0),Object(l.c)([Object(F.c)()],e.prototype,"heightSensibility",void 0),Object(l.c)([Object(F.c)()],e.prototype,"rotationSensibility",void 0),Object(l.c)([Object(F.c)()],e.prototype,"radiusSensibility",void 0),e}();Qb.FollowCameraKeyboardMoveInput=$f;var ag=function(){function e(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}return e.prototype.attachControl=function(b,a){var c=this;this._wheel=function(d,f){if(d.type===lb.a.POINTERWHEEL){var g=d.event,h=0,j=Math.max(-1,Math.min(1,g.deltaY||g.wheelDelta||-g.detail));c.wheelDeltaPercentage?(console.assert(c.axisControlRadius+c.axisControlHeight+c.axisControlRotation<=1,"wheelDeltaPercentage only usable when mouse wheel controlls ONE axis. Currently enabled: axisControlRadius: "+c.axisControlRadius+", axisControlHeightOffset: "+c.axisControlHeight+", axisControlRotationOffset: "+c.axisControlRotation),c.axisControlRadius?h=.01*j*c.wheelDeltaPercentage*c.camera.radius:c.axisControlHeight?h=.01*j*c.wheelDeltaPercentage*c.camera.heightOffset:c.axisControlRotation&&(h=.01*j*c.wheelDeltaPercentage*c.camera.rotationOffset)):h=j*c.wheelPrecision,h&&(c.axisControlRadius?c.camera.radius+=h:c.axisControlHeight?c.camera.heightOffset-=h:c.axisControlRotation&&(c.camera.rotationOffset-=h)),g.preventDefault&&(a||g.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,lb.a.POINTERWHEEL)},e.prototype.detachControl=function(b){this._observer&&b&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},e.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},e.prototype.getSimpleName=function(){return"mousewheel"},Object(l.c)([Object(F.c)()],e.prototype,"axisControlRadius",void 0),Object(l.c)([Object(F.c)()],e.prototype,"axisControlHeight",void 0),Object(l.c)([Object(F.c)()],e.prototype,"axisControlRotation",void 0),Object(l.c)([Object(F.c)()],e.prototype,"wheelPrecision",void 0),Object(l.c)([Object(F.c)()],e.prototype,"wheelDeltaPercentage",void 0),e}();Qb.FollowCameraMouseWheelInput=ag;var bg=function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;return a.angularSensibilityX=1,a.angularSensibilityY=1,a.pinchPrecision=10000,a.pinchDeltaPercentage=0,a.axisXControlRadius=!1,a.axisXControlHeight=!1,a.axisXControlRotation=!0,a.axisYControlRadius=!1,a.axisYControlHeight=!0,a.axisYControlRotation=!1,a.axisPinchControlRadius=!0,a.axisPinchControlHeight=!1,a.axisPinchControlRotation=!1,a.warningEnable=!0,a._warningCounter=0,a}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"FollowCameraPointersInput"},b.prototype.onTouch=function(a,c,d){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=c/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=d/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=c/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=d/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=c/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=d/this.angularSensibilityY)},b.prototype.onMultiTouch=function(a,c,d,f,g,h){if(!(0===d&&null===g||0===f&&null===h)){var j=(f-d)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(j*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=j*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=j*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=j*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=j),this.axisPinchControlHeight&&(this.camera.heightOffset+=j),this.axisPinchControlRadius&&(this.camera.radius-=j))}},b.prototype._warning=function(){if(this.warningEnable&&this._warningCounter++%100==0){var a="It probably only makes sense to control ONE camera property with each pointer axis. Set 'warningEnable = false' if you are sure. Currently enabled: ";console.assert(this.axisXControlRotation+this.axisXControlHeight+this.axisXControlRadius<=1,a+"axisXControlRotation: "+this.axisXControlRotation+", axisXControlHeight: "+this.axisXControlHeight+", axisXControlRadius: "+this.axisXControlRadius),console.assert(this.axisYControlRotation+this.axisYControlHeight+this.axisYControlRadius<=1,a+"axisYControlRotation: "+this.axisYControlRotation+", axisYControlHeight: "+this.axisYControlHeight+", axisYControlRadius: "+this.axisYControlRadius),console.assert(this.axisPinchControlRotation+this.axisPinchControlHeight+this.axisPinchControlRadius<=1,a+"axisPinchControlRotation: "+this.axisPinchControlRotation+", axisPinchControlHeight: "+this.axisPinchControlHeight+", axisPinchControlRadius: "+this.axisPinchControlRadius)}},Object(l.c)([Object(F.c)()],b.prototype,"angularSensibilityX",void 0),Object(l.c)([Object(F.c)()],b.prototype,"angularSensibilityY",void 0),Object(l.c)([Object(F.c)()],b.prototype,"pinchPrecision",void 0),Object(l.c)([Object(F.c)()],b.prototype,"pinchDeltaPercentage",void 0),Object(l.c)([Object(F.c)()],b.prototype,"axisXControlRadius",void 0),Object(l.c)([Object(F.c)()],b.prototype,"axisXControlHeight",void 0),Object(l.c)([Object(F.c)()],b.prototype,"axisXControlRotation",void 0),Object(l.c)([Object(F.c)()],b.prototype,"axisYControlRadius",void 0),Object(l.c)([Object(F.c)()],b.prototype,"axisYControlHeight",void 0),Object(l.c)([Object(F.c)()],b.prototype,"axisYControlRotation",void 0),Object(l.c)([Object(F.c)()],b.prototype,"axisPinchControlRadius",void 0),Object(l.c)([Object(F.c)()],b.prototype,"axisPinchControlHeight",void 0),Object(l.c)([Object(F.c)()],b.prototype,"axisPinchControlRotation",void 0),b}(Oh);Qb.FollowCameraPointersInput=bg;var cg=function(){function e(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array()}return e.prototype.attachControl=function(b,a){var c=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){c._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(d){var f,g=d.event;g.metaKey||(d.type===id.a.KEYDOWN?-1===c.keysUp.indexOf(g.keyCode)&&-1===c.keysDown.indexOf(g.keyCode)&&-1===c.keysLeft.indexOf(g.keyCode)&&-1===c.keysRight.indexOf(g.keyCode)||(-1===(f=c._keys.indexOf(g.keyCode))&&c._keys.push(g.keyCode),a||g.preventDefault()):-1===c.keysUp.indexOf(g.keyCode)&&-1===c.keysDown.indexOf(g.keyCode)&&-1===c.keysLeft.indexOf(g.keyCode)&&-1===c.keysRight.indexOf(g.keyCode)||((f=c._keys.indexOf(g.keyCode))>=0&&c._keys.splice(f,1),a||g.preventDefault()))}))},e.prototype.detachControl=function(b){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var b=this.camera,a=0;a<this._keys.length;a++){var c=this._keys[a],d=b._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(c)?b._localDirection.copyFromFloats(-d,0,0):-1!==this.keysUp.indexOf(c)?b._localDirection.copyFromFloats(0,0,d):-1!==this.keysRight.indexOf(c)?b._localDirection.copyFromFloats(d,0,0):-1!==this.keysDown.indexOf(c)&&b._localDirection.copyFromFloats(0,0,-d),b.getScene().useRightHandedSystem&&(b._localDirection.z*=-1),b.getViewMatrix().invertToRef(b._cameraTransformMatrix),i.e.TransformNormalToRef(b._localDirection,b._cameraTransformMatrix,b._transformedDirection),b.cameraDirection.addInPlace(b._transformedDirection)}},e.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},e.prototype._onLostFocus=function(){this._keys=[]},e.prototype.getSimpleName=function(){return"keyboard"},Object(l.c)([Object(F.c)()],e.prototype,"keysUp",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysDown",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysLeft",void 0),Object(l.c)([Object(F.c)()],e.prototype,"keysRight",void 0),e}();Qb.FreeCameraKeyboardMoveInput=cg;var dg=function(){function e(b){void 0===b&&(b=!0),this.touchEnabled=b,this.buttons=[0,1,2],this.angularSensibility=2000,this.previousPosition=null,this.onPointerMovedObservable=new I.c(),this._allowCameraRotation=!0}return e.prototype.attachControl=function(b,a){var c=this,d=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(f){var g=f.event;if(!d.isInVRExclusivePointerMode&&(c.touchEnabled||"touch"!==g.pointerType)&&(f.type===lb.a.POINTERMOVE||-1!==c.buttons.indexOf(g.button))){var h=g.srcElement||g.target;if(f.type===lb.a.POINTERDOWN&&h){try{h.setPointerCapture(g.pointerId)}catch(w){}c.previousPosition={x:g.clientX,y:g.clientY},a||(g.preventDefault(),b.focus())}else if(f.type===lb.a.POINTERUP&&h){try{h.releasePointerCapture(g.pointerId)}catch(w){}c.previousPosition=null,a||g.preventDefault()}else if(f.type===lb.a.POINTERMOVE){if(!c.previousPosition||d.isPointerLock)return;var j=g.clientX-c.previousPosition.x,m=g.clientY-c.previousPosition.y;c.camera.getScene().useRightHandedSystem&&(j*=-1),c.camera.parent&&c.camera.parent._getWorldMatrixDeterminant()<0&&(j*=-1),c._allowCameraRotation&&(c.camera.cameraRotation.y+=j/c.angularSensibility,c.camera.cameraRotation.x+=m/c.angularSensibility),c.onPointerMovedObservable.notifyObservers({offsetX:j,offsetY:m}),c.previousPosition={x:g.clientX,y:g.clientY},a||g.preventDefault()}}}),this._onMouseMove=function(f){if(d.isPointerLock&&!d.isInVRExclusivePointerMode){var g=f.movementX||f.mozMovementX||f.webkitMovementX||f.msMovementX||0;c.camera.getScene().useRightHandedSystem&&(g*=-1),c.camera.parent&&c.camera.parent._getWorldMatrixDeterminant()<0&&(g*=-1),c.camera.cameraRotation.y+=g/c.angularSensibility;var h=f.movementY||f.mozMovementY||f.webkitMovementY||f.msMovementY||0;c.camera.cameraRotation.x+=h/c.angularSensibility,c.previousPosition=null,a||f.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,lb.a.POINTERDOWN|lb.a.POINTERUP|lb.a.POINTERMOVE),b.addEventListener("mousemove",this._onMouseMove,!1),b.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)},e.prototype.onContextMenu=function(b){b.preventDefault()},e.prototype.detachControl=function(b){this._observer&&b&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&b.removeEventListener("mousemove",this._onMouseMove),this.onContextMenu&&b.removeEventListener("contextmenu",this.onContextMenu),this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},e.prototype.getClassName=function(){return"FreeCameraMouseInput"},e.prototype.getSimpleName=function(){return"mouse"},Object(l.c)([Object(F.c)()],e.prototype,"buttons",void 0),Object(l.c)([Object(F.c)()],e.prototype,"angularSensibility",void 0),e}();Qb.FreeCameraMouseInput=dg;var eg=function(){function e(){this.touchAngularSensibility=200000,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array()}return e.prototype.attachControl=function(b,a){var c=this,d=null;void 0===this._pointerInput&&(this._onLostFocus=function(){c._offsetX=null,c._offsetY=null},this._pointerInput=function(f){var g=f.event;if("mouse"!==g.pointerType){if(f.type===lb.a.POINTERDOWN){if(a||g.preventDefault(),c._pointerPressed.push(g.pointerId),1!==c._pointerPressed.length)return;d={x:g.clientX,y:g.clientY}}else if(f.type===lb.a.POINTERUP){if(a||g.preventDefault(),-1===(h=c._pointerPressed.indexOf(g.pointerId)))return;if(c._pointerPressed.splice(h,1),0!=h)return;d=null,c._offsetX=null,c._offsetY=null}else if(f.type===lb.a.POINTERMOVE){if(a||g.preventDefault(),!d)return;var h;if(0!=(h=c._pointerPressed.indexOf(g.pointerId)))return;c._offsetX=g.clientX-d.x,c._offsetY=-(g.clientY-d.y)}}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,lb.a.POINTERDOWN|lb.a.POINTERUP|lb.a.POINTERMOVE),this._onLostFocus&&b.addEventListener("blur",this._onLostFocus)},e.prototype.detachControl=function(b){this._pointerInput&&b&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(b.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},e.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var b=this.camera;if(b.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)b.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var a=b._computeLocalCameraSpeed(),c=new i.e(0,0,a*this._offsetY/this.touchMoveSensibility);i.a.RotationYawPitchRollToRef(b.rotation.y,b.rotation.x,0,b._cameraRotationMatrix),b.cameraDirection.addInPlace(i.e.TransformCoordinates(c,b._cameraRotationMatrix))}}},e.prototype.getClassName=function(){return"FreeCameraTouchInput"},e.prototype.getSimpleName=function(){return"touch"},Object(l.c)([Object(F.c)()],e.prototype,"touchAngularSensibility",void 0),Object(l.c)([Object(F.c)()],e.prototype,"touchMoveSensibility",void 0),e}();Qb.FreeCameraTouchInput=eg;var qe=function(e){function b(a){var c=e.call(this,a)||this;return c._mouseInput=null,c}return Object(l.d)(b,e),b.prototype.addKeyboard=function(){return this.add(new cg()),this},b.prototype.addMouse=function(a){return void 0===a&&(a=!0),this._mouseInput||(this._mouseInput=new dg(a),this.add(this._mouseInput)),this},b.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},b.prototype.addTouch=function(){return this.add(new eg()),this},b.prototype.clear=function(){e.prototype.clear.call(this),this._mouseInput=null},b}(pe);qe.prototype.addDeviceOrientation=function(){return this._deviceOrientationInput||(this._deviceOrientationInput=new fg(),this.add(this._deviceOrientationInput)),this};var fg=function(){function e(){var b=this;this._screenOrientationAngle=0,this._screenQuaternion=new i.b(),this._alpha=0,this._beta=0,this._gamma=0,this._onDeviceOrientationChangedObservable=new I.c(),this._orientationChanged=function(){b._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,b._screenOrientationAngle=-Qa.b.ToRadians(b._screenOrientationAngle/2),b._screenQuaternion.copyFromFloats(0,Math.sin(b._screenOrientationAngle),0,Math.cos(b._screenOrientationAngle))},this._deviceOrientation=function(a){b._alpha=null!==a.alpha?a.alpha:0,b._beta=null!==a.beta?a.beta:0,b._gamma=null!==a.gamma?a.gamma:0,null!==a.alpha&&b._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new i.b(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return e.WaitForOrientationChangeAsync=function(b){return new Promise(function(a,c){var d=!1,f=function(){window.removeEventListener("deviceorientation",f),d=!0,a()};b&&setTimeout(function(){d||(window.removeEventListener("deviceorientation",f),c("WaitForOrientationChangeAsync timed out"))},b),"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(g){"granted"==g?window.addEventListener("deviceorientation",f):Qa.b.Warn("Permission not granted.")}).catch(function(g){Qa.b.Error(g)}):window.addEventListener("deviceorientation",f)})},Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},set:function(b){var a=this;this._camera=b,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new i.b()),this._camera&&this._camera.onDisposeObservable.add(function(){a._onDeviceOrientationChangedObservable.clear()})},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(b,a){var c=this,d=this.camera.getScene().getEngine().getHostWindow();if(d){var f=function(){d.addEventListener("orientationchange",c._orientationChanged),d.addEventListener("deviceorientation",c._deviceOrientation),c._orientationChanged()};"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(g){"granted"===g?f():Qa.b.Warn("Permission not granted.")}).catch(function(g){Qa.b.Error(g)}):f()}},e.prototype.detachControl=function(b){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0},e.prototype.checkInputs=function(){this._alpha&&(i.b.RotationYawPitchRollToRef(Qa.b.ToRadians(this._alpha),Qa.b.ToRadians(this._beta),-Qa.b.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},e.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"deviceOrientation"},e}();Qb.FreeCameraDeviceOrientationInput=fg;var gg=function(){function e(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._yAxisScale=1,this._cameraTransform=i.a.Identity(),this._deltaTransform=i.e.Zero(),this._vector3=i.e.Zero(),this._vector2=i.d.Zero()}return Object.defineProperty(e.prototype,"invertYAxis",{get:function(){return 1!==this._yAxisScale},set:function(b){this._yAxisScale=b?-1:1},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(b,a){var c=this,d=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=d.onGamepadConnectedObservable.add(function(f){f.type!==Pb.POSE_ENABLED&&(c.gamepad&&f.type!==Pb.XBOX||(c.gamepad=f))}),this._onGamepadDisconnectedObserver=d.onGamepadDisconnectedObservable.add(function(f){c.gamepad===f&&(c.gamepad=null)}),this.gamepad=d.getGamepadByType(Pb.XBOX)},e.prototype.detachControl=function(b){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},e.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var b=this.camera,a=this.gamepad.leftStick,c=a.x/this.gamepadMoveSensibility,d=a.y/this.gamepadMoveSensibility;a.x=Math.abs(c)>.005?0+c:0,a.y=Math.abs(d)>.005?0+d:0;var f=this.gamepad.rightStick;if(f){var g=f.x/this.gamepadAngularSensibility,h=f.y/this.gamepadAngularSensibility*this._yAxisScale;f.x=Math.abs(g)>.001?0+g:0,f.y=Math.abs(h)>.001?0+h:0}else f={x:0,y:0};b.rotationQuaternion?b.rotationQuaternion.toRotationMatrix(this._cameraTransform):i.a.RotationYawPitchRollToRef(b.rotation.y,b.rotation.x,0,this._cameraTransform);var j=50*b._computeLocalCameraSpeed();this._vector3.copyFromFloats(a.x*j,0,-a.y*j),i.e.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),b.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(f.y,f.x),b.cameraRotation.addInPlace(this._vector2)}},e.prototype.getClassName=function(){return"FreeCameraGamepadInput"},e.prototype.getSimpleName=function(){return"gamepad"},Object(l.c)([Object(F.c)()],e.prototype,"gamepadAngularSensibility",void 0),Object(l.c)([Object(F.c)()],e.prototype,"gamepadMoveSensibility",void 0),e}();Qb.FreeCameraGamepadInput=gg;var Gb,Ph=o(103);!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(Gb||(Gb={}));var hg=function(){function e(b){var a=this;if(this._leftJoystick=!!b,e._globalJoystickIndex++,this._axisTargetedByLeftAndRight=Gb.X,this._axisTargetedByUpAndDown=Gb.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new Ph.a(),this.deltaPosition=i.e.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1000),this._onResize=function(d){e.vjCanvasWidth=window.innerWidth,e.vjCanvasHeight=window.innerHeight,e.Canvas&&(e.Canvas.width=e.vjCanvasWidth,e.Canvas.height=e.vjCanvasHeight),e.halfWidth=e.vjCanvasWidth/2},!e.Canvas){window.addEventListener("resize",this._onResize,!1),e.Canvas=document.createElement("canvas"),e.vjCanvasWidth=window.innerWidth,e.vjCanvasHeight=window.innerHeight,e.Canvas.width=window.innerWidth,e.Canvas.height=window.innerHeight,e.Canvas.style.width="100%",e.Canvas.style.height="100%",e.Canvas.style.position="absolute",e.Canvas.style.backgroundColor="transparent",e.Canvas.style.top="0px",e.Canvas.style.left="0px",e.Canvas.style.zIndex="5",e.Canvas.style.msTouchAction="none",e.Canvas.setAttribute("touch-action","none");var c=e.Canvas.getContext("2d");if(!c)throw new Error("Unable to create canvas for virtual joystick");e.vjCanvasContext=c,e.vjCanvasContext.strokeStyle="#ffffff",e.vjCanvasContext.lineWidth=2,document.body.appendChild(e.Canvas)}e.halfWidth=e.Canvas.width/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new i.d(0,0),this._joystickPreviousPointerPos=new i.d(0,0),this._joystickPointerStartPos=new i.d(0,0),this._deltaJoystickVector=new i.d(0,0),this._onPointerDownHandlerRef=function(d){a._onPointerDown(d)},this._onPointerMoveHandlerRef=function(d){a._onPointerMove(d)},this._onPointerUpHandlerRef=function(d){a._onPointerUp(d)},e.Canvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),e.Canvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),e.Canvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),e.Canvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),e.Canvas.addEventListener("contextmenu",function(d){d.preventDefault()},!1),requestAnimationFrame(function(){a._drawVirtualJoystick()})}return e.prototype.setJoystickSensibility=function(b){this._joystickSensibility=b,this._inversedSensibility=1/(this._joystickSensibility/1000)},e.prototype._onPointerDown=function(b){b.preventDefault(),(!0===this._leftJoystick?b.clientX<e.halfWidth:b.clientX>e.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=b.pointerId,this._joystickPointerStartPos.x=b.clientX,this._joystickPointerStartPos.y=b.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(b.pointerId.toString(),b)):e._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(b.pointerId.toString(),{x:b.clientX,y:b.clientY,prevX:b.clientX,prevY:b.clientY}))},e.prototype._onPointerMove=function(b){if(this._joystickPointerID==b.pointerId){this._joystickPointerPos.x=b.clientX,this._joystickPointerPos.y=b.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var a=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case Gb.X:this.deltaPosition.x=Math.min(1,Math.max(-1,a));break;case Gb.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,a));break;case Gb.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,a))}var c=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case Gb.X:this.deltaPosition.x=Math.min(1,Math.max(-1,c));break;case Gb.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,c));break;case Gb.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,c))}}else{var d=this._touches.get(b.pointerId.toString());d&&(d.x=b.clientX,d.y=b.clientY)}},e.prototype._onPointerUp=function(b){if(this._joystickPointerID==b.pointerId)e.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-64,this._joystickPointerStartPos.y-64,128,128),e.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-42,this._joystickPreviousPointerPos.y-42,84,84),this._joystickPointerID=-1,this.pressed=!1;else{var a=this._touches.get(b.pointerId.toString());a&&e.vjCanvasContext.clearRect(a.prevX-44,a.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(b.pointerId.toString())},e.prototype.setJoystickColor=function(b){this._joystickColor=b},e.prototype.setActionOnTouch=function(b){this._action=b},e.prototype.setAxisForLeftRight=function(b){switch(b){case Gb.X:case Gb.Y:case Gb.Z:this._axisTargetedByLeftAndRight=b;break;default:this._axisTargetedByLeftAndRight=Gb.X}},e.prototype.setAxisForUpDown=function(b){switch(b){case Gb.X:case Gb.Y:case Gb.Z:this._axisTargetedByUpAndDown=b;break;default:this._axisTargetedByUpAndDown=Gb.Y}},e.prototype._drawVirtualJoystick=function(){var b=this;this.pressed&&this._touches.forEach(function(a,c){c.pointerId===b._joystickPointerID?(e.vjCanvasContext.clearRect(b._joystickPointerStartPos.x-64,b._joystickPointerStartPos.y-64,128,128),e.vjCanvasContext.clearRect(b._joystickPreviousPointerPos.x-42,b._joystickPreviousPointerPos.y-42,84,84),e.vjCanvasContext.beginPath(),e.vjCanvasContext.lineWidth=6,e.vjCanvasContext.strokeStyle=b._joystickColor,e.vjCanvasContext.arc(b._joystickPointerStartPos.x,b._joystickPointerStartPos.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle=b._joystickColor,e.vjCanvasContext.lineWidth=2,e.vjCanvasContext.arc(b._joystickPointerStartPos.x,b._joystickPointerStartPos.y,60,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle=b._joystickColor,e.vjCanvasContext.arc(b._joystickPointerPos.x,b._joystickPointerPos.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),b._joystickPreviousPointerPos=b._joystickPointerPos.clone()):(e.vjCanvasContext.clearRect(c.prevX-44,c.prevY-44,88,88),e.vjCanvasContext.beginPath(),e.vjCanvasContext.fillStyle="white",e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle="red",e.vjCanvasContext.lineWidth=6,e.vjCanvasContext.arc(c.x,c.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),c.prevX=c.x,c.prevY=c.y)}),requestAnimationFrame(function(){b._drawVirtualJoystick()})},e.prototype.releaseCanvas=function(){e.Canvas&&(e.Canvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),e.Canvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),e.Canvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),e.Canvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(e.Canvas),e.Canvas=null)},e._globalJoystickIndex=0,e}();qe.prototype.addVirtualJoystick=function(){return this.add(new ig()),this};var ig=function(){function e(){}return e.prototype.getLeftJoystick=function(){return this._leftjoystick},e.prototype.getRightJoystick=function(){return this._rightjoystick},e.prototype.checkInputs=function(){if(this._leftjoystick){var b=this.camera,a=50*b._computeLocalCameraSpeed(),c=i.a.RotationYawPitchRoll(b.rotation.y,b.rotation.x,0),d=i.e.TransformCoordinates(new i.e(this._leftjoystick.deltaPosition.x*a,this._leftjoystick.deltaPosition.y*a,this._leftjoystick.deltaPosition.z*a),c);b.cameraDirection=b.cameraDirection.add(d),b.cameraRotation=b.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},e.prototype.attachControl=function(b,a){this._leftjoystick=new hg(!0),this._leftjoystick.setAxisForUpDown(Gb.Z),this._leftjoystick.setAxisForLeftRight(Gb.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new hg(!1),this._rightjoystick.setAxisForUpDown(Gb.X),this._rightjoystick.setAxisForLeftRight(Gb.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},e.prototype.detachControl=function(b){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},e.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},e.prototype.getSimpleName=function(){return"virtualJoystick"},e}();Qb.FreeCameraVirtualJoystickInput=ig;var Uc=function(e){function b(a,c,d,f){void 0===f&&(f=!0);var g=e.call(this,a,c,d,f)||this;return g.cameraDirection=new i.e(0,0,0),g.cameraRotation=new i.d(0,0),g.updateUpVectorFromRotation=!1,g._tmpQuaternion=new i.b(),g.rotation=new i.e(0,0,0),g.speed=2,g.noRotationConstraint=!1,g.lockedTarget=null,g._currentTarget=i.e.Zero(),g._initialFocalDistance=1,g._viewMatrix=i.a.Zero(),g._camMatrix=i.a.Zero(),g._cameraTransformMatrix=i.a.Zero(),g._cameraRotationMatrix=i.a.Zero(),g._referencePoint=new i.e(0,0,1),g._transformedReferencePoint=i.e.Zero(),g._globalCurrentTarget=i.e.Zero(),g._globalCurrentUpVector=i.e.Zero(),g._defaultUp=i.e.Up(),g._cachedRotationZ=0,g._cachedQuaternionRotationZ=0,g}return Object(l.d)(b,e),b.prototype.getFrontPosition=function(a){this.getWorldMatrix();var c=this.getTarget().subtract(this.position);return c.normalize(),c.scaleInPlace(a),this.globalPosition.add(c)},b.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},b.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),e.prototype.storeState.call(this)},b.prototype._restoreStateValues=function(){return!!e.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},b.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.lockedTarget=new i.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new i.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new i.b(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},b.prototype._updateCache=function(a){a||e.prototype._updateCache.call(this);var c=this._getLockedTargetPosition();c?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(c):this._cache.lockedTarget=c.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},b.prototype._isSynchronizedViewMatrix=function(){if(!e.prototype._isSynchronizedViewMatrix.call(this))return!1;var a=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(a):!a)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},b.prototype._computeLocalCameraSpeed=function(){var a=this.getEngine();return this.speed*Math.sqrt(a.getDeltaTime()/(100*a.getFps()))},b.prototype.setTarget=function(a){this.upVector.normalize(),this._initialFocalDistance=a.subtract(this.position).length(),this.position.z===a.z&&(this.position.z+=kb.a),i.a.LookAtLHToRef(this.position,a,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var c=a.subtract(this.position);c.x>=0?this.rotation.y=-Math.atan(c.z/c.x)+Math.PI/2:this.rotation.y=-Math.atan(c.z/c.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&i.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},b.prototype.getTarget=function(){return this._currentTarget},b.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},b.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(i.c.Matrix[0]),i.e.TransformNormalToRef(this.cameraDirection,i.c.Matrix[0],i.c.Vector3[0]),void this.position.addInPlace(i.c.Vector3[0]);this.position.addInPlace(this.cameraDirection)},b.prototype._checkInputs=function(){var a=this._decideIfNeedsToMove(),c=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;(a&&this._updatePosition(),c)&&((this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion)&&(this.rotation.lengthSquared()&&i.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)),this.noRotationConstraint||(this.rotation.x>1.570796&&(this.rotation.x=1.570796),this.rotation.x<-1.570796&&(this.rotation.x=-1.570796))),a&&(Math.abs(this.cameraDirection.x)<this.speed*kb.a&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*kb.a&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*kb.a&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),c&&(Math.abs(this.cameraRotation.x)<this.speed*kb.a&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*kb.a&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),e.prototype._checkInputs.call(this)},b.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):i.a.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},b.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return i.e.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},b.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),i.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Ba.a.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(i.b.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Ba.a.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},b.prototype._computeViewMatrix=function(a,c,d){if(this.parent){var f=this.parent.getWorldMatrix();i.e.TransformCoordinatesToRef(a,f,this._globalPosition),i.e.TransformCoordinatesToRef(c,f,this._globalCurrentTarget),i.e.TransformNormalToRef(d,f,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(a),this._globalCurrentTarget.copyFrom(c),this._globalCurrentUpVector.copyFrom(d);this.getScene().useRightHandedSystem?i.a.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):i.a.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},b.prototype.createRigCamera=function(a,c){if(this.cameraRigMode!==hb.a.RIG_MODE_NONE){var d=new b(a,this.position.clone(),this.getScene());return d.isRigCamera=!0,d.rigParent=this,this.cameraRigMode!==hb.a.RIG_MODE_VR&&this.cameraRigMode!==hb.a.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new i.b()),d._cameraRigParams={},d.rotationQuaternion=new i.b()),d}return null},b.prototype._updateRigCameras=function(){var a=this._rigCameras[0],c=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case hb.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case hb.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case hb.a.RIG_MODE_STEREOSCOPIC_INTERLACED:var d=this.cameraRigMode===hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,f=this.cameraRigMode===hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*d,a),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*f,c);break;case hb.a.RIG_MODE_VR:a.rotationQuaternion?(a.rotationQuaternion.copyFrom(this.rotationQuaternion),c.rotationQuaternion.copyFrom(this.rotationQuaternion)):(a.rotation.copyFrom(this.rotation),c.rotation.copyFrom(this.rotation)),a.position.copyFrom(this.position),c.position.copyFrom(this.position)}e.prototype._updateRigCameras.call(this)},b.prototype._getRigCamPositionAndTarget=function(a,c){this.getTarget().subtractToRef(this.position,b._TargetFocalPoint),b._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var d=b._TargetFocalPoint.addInPlace(this.position);i.a.TranslationToRef(-d.x,-d.y,-d.z,b._TargetTransformMatrix),b._TargetTransformMatrix.multiplyToRef(i.a.RotationY(a),b._RigCamTransformMatrix),i.a.TranslationToRef(d.x,d.y,d.z,b._TargetTransformMatrix),b._RigCamTransformMatrix.multiplyToRef(b._TargetTransformMatrix,b._RigCamTransformMatrix),i.e.TransformCoordinatesToRef(this.position,b._RigCamTransformMatrix,c.position),c.setTarget(d)},b.prototype.getClassName=function(){return"TargetCamera"},b._RigCamTransformMatrix=new i.a(),b._TargetTransformMatrix=new i.a(),b._TargetFocalPoint=new i.e(),Object(l.c)([Object(F.o)()],b.prototype,"rotation",void 0),Object(l.c)([Object(F.c)()],b.prototype,"speed",void 0),Object(l.c)([Object(F.k)("lockedTargetId")],b.prototype,"lockedTarget",void 0),b}(hb.a),nc=function(e){function b(a,c,d,f){void 0===f&&(f=!0);var g=e.call(this,a,c,d,f)||this;return g.ellipsoid=new i.e(.5,1,.5),g.ellipsoidOffset=new i.e(0,0,0),g.checkCollisions=!1,g.applyGravity=!1,g._needMoveForGravity=!1,g._oldPosition=i.e.Zero(),g._diffPosition=i.e.Zero(),g._newPosition=i.e.Zero(),g._collisionMask=-1,g._onCollisionPositionChange=function(h,j,m){void 0===m&&(m=null);var w;w=j,g._newPosition.copyFrom(w),g._newPosition.subtractToRef(g._oldPosition,g._diffPosition),g._diffPosition.length()>Ha.a.CollisionsEpsilon&&(g.position.addInPlace(g._diffPosition),g.onCollide&&m&&g.onCollide(m))},g.inputs=new qe(g),g.inputs.addKeyboard().addMouse(),g}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"angularSensibility",{get:function(){var a=this.inputs.attached.mouse;return a?a.angularSensibility:0},set:function(a){var c=this.inputs.attached.mouse;c&&(c.angularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysUp",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysUp:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysUp=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysDown",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysDown:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysDown=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysLeft",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysLeft:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysLeft=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysRight",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysRight:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysRight=a)},enumerable:!0,configurable:!0}),b.prototype.attachControl=function(a,c){this.inputs.attachElement(a,c)},b.prototype.detachControl=function(a){this.inputs.detachElement(a),this.cameraDirection=new i.e(0,0,0),this.cameraRotation=new i.d(0,0)},Object.defineProperty(b.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(a){this._collisionMask=isNaN(a)?-1:a},enumerable:!0,configurable:!0}),b.prototype._collideWithWorld=function(a){(this.parent?i.e.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var c=this.getScene().collisionCoordinator;this._collider||(this._collider=c.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var d=a;this.applyGravity&&(d=a.add(this.getScene().gravity)),c.getNewPosition(this._oldPosition,d,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},b.prototype._checkInputs=function(){this._localDirection||(this._localDirection=i.e.Zero(),this._transformedDirection=i.e.Zero()),this.inputs.checkInputs(),e.prototype._checkInputs.call(this)},b.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},b.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):e.prototype._updatePosition.call(this)},b.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},b.prototype.getClassName=function(){return"FreeCamera"},Object(l.c)([Object(F.o)()],b.prototype,"ellipsoid",void 0),Object(l.c)([Object(F.o)()],b.prototype,"ellipsoidOffset",void 0),Object(l.c)([Object(F.c)()],b.prototype,"checkCollisions",void 0),Object(l.c)([Object(F.c)()],b.prototype,"applyGravity",void 0),b}(Uc);ia.a.AddNodeConstructor("TouchCamera",function(e,b){return function(){return new jg(e,i.e.Zero(),b)}});var jg=function(e){function b(a,c,d){var f=e.call(this,a,c,d)||this;return f.inputs.addTouch(),f._setupInputs(),f}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"touchAngularSensibility",{get:function(){var a=this.inputs.attached.touch;return a?a.touchAngularSensibility:0},set:function(a){var c=this.inputs.attached.touch;c&&(c.touchAngularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"touchMoveSensibility",{get:function(){var a=this.inputs.attached.touch;return a?a.touchMoveSensibility:0},set:function(a){var c=this.inputs.attached.touch;c&&(c.touchMoveSensibility=a)},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"TouchCamera"},b.prototype._setupInputs=function(){var a=this.inputs.attached.mouse;a&&(a.touchEnabled=!1)},b}(nc);ia.a.AddNodeConstructor("ArcRotateCamera",function(e,b){return function(){return new jd(e,0,0,1,i.e.Zero(),b)}});var jd=function(e){function b(a,c,d,f,g,h,j){void 0===j&&(j=!0);var m=e.call(this,a,i.e.Zero(),h,j)||this;return m._upVector=i.e.Up(),m.inertialAlphaOffset=0,m.inertialBetaOffset=0,m.inertialRadiusOffset=0,m.lowerAlphaLimit=null,m.upperAlphaLimit=null,m.lowerBetaLimit=.01,m.upperBetaLimit=Math.PI-.01,m.lowerRadiusLimit=null,m.upperRadiusLimit=null,m.inertialPanningX=0,m.inertialPanningY=0,m.pinchToPanMaxDistance=20,m.panningDistanceLimit=null,m.panningOriginTarget=i.e.Zero(),m.panningInertia=.9,m.zoomOnFactor=1,m.targetScreenOffset=i.d.Zero(),m.allowUpsideDown=!0,m.useInputToRestoreState=!0,m._viewMatrix=new i.a(),m.panningAxis=new i.e(1,1,0),m.onMeshTargetChangedObservable=new I.c(),m.checkCollisions=!1,m.collisionRadius=new i.e(.5,.5,.5),m._previousPosition=i.e.Zero(),m._collisionVelocity=i.e.Zero(),m._newPosition=i.e.Zero(),m._computationVector=i.e.Zero(),m._onCollisionPositionChange=function(w,z,C){void 0===C&&(C=null),C?(m.setPosition(z),m.onCollide&&m.onCollide(C)):m._previousPosition.copyFrom(m._position);var J=Math.cos(m.alpha),K=Math.sin(m.alpha),N=Math.cos(m.beta),T=Math.sin(m.beta);0===T&&(T=.0001);var Z=m._getTargetPosition();m._computationVector.copyFromFloats(m.radius*J*T,m.radius*N,m.radius*K*T),Z.addToRef(m._computationVector,m._newPosition),m._position.copyFrom(m._newPosition);var _=m.upVector;m.allowUpsideDown&&m.beta<0&&(_=(_=_.clone()).negate()),m._computeViewMatrix(m._position,Z,_),m._viewMatrix.addAtIndex(12,m.targetScreenOffset.x),m._viewMatrix.addAtIndex(13,m.targetScreenOffset.y),m._collisionTriggered=!1},m._target=i.e.Zero(),g&&m.setTarget(g),m.alpha=c,m.beta=d,m.radius=f,m.getViewMatrix(),m.inputs=new We(m),m.inputs.addKeyboard().addMouseWheel().addPointers(),m}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"target",{get:function(){return this._target},set:function(a){this.setTarget(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"position",{get:function(){return this._position},set:function(a){this.setPosition(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"upVector",{get:function(){return this._upVector},set:function(a){this._upToYMatrix||(this._YToUpMatrix=new i.a(),this._upToYMatrix=new i.a(),this._upVector=i.e.Zero()),a.normalize(),this._upVector.copyFrom(a),this.setMatUp()},enumerable:!0,configurable:!0}),b.prototype.setMatUp=function(){i.a.RotationAlignToRef(i.e.UpReadOnly,this._upVector,this._YToUpMatrix),i.a.RotationAlignToRef(this._upVector,i.e.UpReadOnly,this._upToYMatrix)},Object.defineProperty(b.prototype,"angularSensibilityX",{get:function(){var a=this.inputs.attached.pointers;return a?a.angularSensibilityX:0},set:function(a){var c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"angularSensibilityY",{get:function(){var a=this.inputs.attached.pointers;return a?a.angularSensibilityY:0},set:function(a){var c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"pinchPrecision",{get:function(){var a=this.inputs.attached.pointers;return a?a.pinchPrecision:0},set:function(a){var c=this.inputs.attached.pointers;c&&(c.pinchPrecision=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"pinchDeltaPercentage",{get:function(){var a=this.inputs.attached.pointers;return a?a.pinchDeltaPercentage:0},set:function(a){var c=this.inputs.attached.pointers;c&&(c.pinchDeltaPercentage=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"useNaturalPinchZoom",{get:function(){var a=this.inputs.attached.pointers;return!!a&&a.useNaturalPinchZoom},set:function(a){var c=this.inputs.attached.pointers;c&&(c.useNaturalPinchZoom=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"panningSensibility",{get:function(){var a=this.inputs.attached.pointers;return a?a.panningSensibility:0},set:function(a){var c=this.inputs.attached.pointers;c&&(c.panningSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysUp",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysUp:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysUp=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysDown",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysDown:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysDown=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysLeft",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysLeft:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysLeft=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysRight",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysRight:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysRight=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"wheelPrecision",{get:function(){var a=this.inputs.attached.mousewheel;return a?a.wheelPrecision:0},set:function(a){var c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"wheelDeltaPercentage",{get:function(){var a=this.inputs.attached.mousewheel;return a?a.wheelDeltaPercentage:0},set:function(a){var c=this.inputs.attached.mousewheel;c&&(c.wheelDeltaPercentage=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(a){a!==this.useBouncingBehavior&&(a?(this._bouncingBehavior=new Ih(),this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(a){a!==this.useFramingBehavior&&(a?(this._framingBehavior=new Jh(),this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(a){a!==this.useAutoRotationBehavior&&(a?(this._autoRotationBehavior=new Hh(),this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),b.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache._target=new i.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=i.d.Zero()},b.prototype._updateCache=function(a){a||e.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},b.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var a=this._targetHost.absolutePosition;this._targetBoundingCenter?a.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(a)}var c=this._getLockedTargetPosition();return c||this._target},b.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),e.prototype.storeState.call(this)},b.prototype._restoreStateValues=function(){return!!e.prototype._restoreStateValues.call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},b.prototype._isSynchronizedViewMatrix=function(){return!!e.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},b.prototype.attachControl=function(a,c,d,f){var g=this;void 0===d&&(d=!0),void 0===f&&(f=2),this._useCtrlForPanning=d,this._panningMouseButton=f,this.inputs.attachElement(a,c),this._reset=function(){g.inertialAlphaOffset=0,g.inertialBetaOffset=0,g.inertialRadiusOffset=0,g.inertialPanningX=0,g.inertialPanningY=0}},b.prototype.detachControl=function(a){this.inputs.detachElement(a),this._reset&&this._reset()},b.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var a=this.inertialAlphaOffset;this.beta<=0&&(a*=-1),this.getScene().useRightHandedSystem&&(a*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(a*=-1),this.alpha+=a,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<kb.a&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<kb.a&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*kb.a&&(this.inertialRadiusOffset=0)}(0!==this.inertialPanningX||0!==this.inertialPanningY)&&((this._localDirection||(this._localDirection=i.e.Zero(),this._transformedDirection=i.e.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),i.e.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)&&(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),i.e.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*kb.a&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*kb.a&&(this.inertialPanningY=0)),this._checkLimits(),e.prototype._checkInputs.call(this)}},b.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},b.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||i.e.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=.0001),0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},b.prototype.setPosition=function(a){this._position.equals(a)||(this._position.copyFrom(a),this.rebuildAnglesAndRadius())},b.prototype.setTarget=function(a,c,d){if(void 0===c&&(c=!1),void 0===d&&(d=!1),a.getBoundingInfo)this._targetBoundingCenter=c?a.getBoundingInfo().boundingBox.centerWorld.clone():null,a.computeWorldMatrix(),this._targetHost=a,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var f=a,g=this._getTargetPosition();if(g&&!d&&g.equals(f))return;this._targetHost=null,this._target=f,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},b.prototype._getViewMatrix=function(){var a=Math.cos(this.alpha),c=Math.sin(this.alpha),d=Math.cos(this.beta),f=Math.sin(this.beta);0===f&&(f=.0001);var g=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*a*f,this.radius*d,this.radius*c*f),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||i.e.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),g.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var h=this.getScene().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,h.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var j=this.upVector;this.allowUpsideDown&&f<0&&(j=j.negate()),this._computeViewMatrix(this._position,g,j),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=g,this._viewMatrix},b.prototype.zoomOn=function(a,c){void 0===c&&(c=!1),a=a||this.getScene().meshes;var d=xa.a.MinMax(a),f=i.e.Distance(d.min,d.max);this.radius=f*this.zoomOnFactor,this.focusOn({min:d.min,max:d.max,distance:f},c)},b.prototype.focusOn=function(a,c){var d,f;if(void 0===c&&(c=!1),void 0===a.min){var g=a||this.getScene().meshes;d=xa.a.MinMax(g),f=i.e.Distance(d.min,d.max)}else d=a,f=a.distance;this._target=xa.a.Center(d),c||(this.maxZ=2*f)},b.prototype.createRigCamera=function(a,c){var d=0;switch(this.cameraRigMode){case hb.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case hb.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case hb.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case hb.a.RIG_MODE_VR:d=this._cameraRigParams.stereoHalfAngle*(0===c?1:-1);break;case hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:d=this._cameraRigParams.stereoHalfAngle*(0===c?-1:1)}var f=new b(a,this.alpha+d,this.beta,this.radius,this._target,this.getScene());return f._cameraRigParams={},f.isRigCamera=!0,f.rigParent=this,f},b.prototype._updateRigCameras=function(){var a=this._rigCameras[0],c=this._rigCameras[1];switch(a.beta=c.beta=this.beta,this.cameraRigMode){case hb.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case hb.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case hb.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case hb.a.RIG_MODE_VR:a.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:a.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}e.prototype._updateRigCameras.call(this)},b.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},b.prototype.getClassName=function(){return"ArcRotateCamera"},Object(l.c)([Object(F.c)()],b.prototype,"alpha",void 0),Object(l.c)([Object(F.c)()],b.prototype,"beta",void 0),Object(l.c)([Object(F.c)()],b.prototype,"radius",void 0),Object(l.c)([Object(F.o)("target")],b.prototype,"_target",void 0),Object(l.c)([Object(F.o)("upVector")],b.prototype,"_upVector",void 0),Object(l.c)([Object(F.c)()],b.prototype,"inertialAlphaOffset",void 0),Object(l.c)([Object(F.c)()],b.prototype,"inertialBetaOffset",void 0),Object(l.c)([Object(F.c)()],b.prototype,"inertialRadiusOffset",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lowerAlphaLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"upperAlphaLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lowerBetaLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"upperBetaLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lowerRadiusLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"upperRadiusLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"inertialPanningX",void 0),Object(l.c)([Object(F.c)()],b.prototype,"inertialPanningY",void 0),Object(l.c)([Object(F.c)()],b.prototype,"pinchToPanMaxDistance",void 0),Object(l.c)([Object(F.c)()],b.prototype,"panningDistanceLimit",void 0),Object(l.c)([Object(F.o)()],b.prototype,"panningOriginTarget",void 0),Object(l.c)([Object(F.c)()],b.prototype,"panningInertia",void 0),Object(l.c)([Object(F.c)()],b.prototype,"zoomOnFactor",void 0),Object(l.c)([Object(F.c)()],b.prototype,"targetScreenOffset",void 0),Object(l.c)([Object(F.c)()],b.prototype,"allowUpsideDown",void 0),Object(l.c)([Object(F.c)()],b.prototype,"useInputToRestoreState",void 0),b}(Uc);ia.a.AddNodeConstructor("DeviceOrientationCamera",function(e,b){return function(){return new Xe(e,i.e.Zero(),b)}});var Xe=function(e){function b(a,c,d){var f=e.call(this,a,c,d)||this;return f._tmpDragQuaternion=new i.b(),f._disablePointerInputWhenUsingDeviceOrientation=!0,f._dragFactor=0,f._quaternionCache=new i.b(),f.inputs.addDeviceOrientation(),f.inputs._deviceOrientationInput&&f.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce(function(){f._disablePointerInputWhenUsingDeviceOrientation&&f.inputs._mouseInput&&(f.inputs._mouseInput._allowCameraRotation=!1,f.inputs._mouseInput.onPointerMovedObservable.add(function(g){0!=f._dragFactor&&(f._initialQuaternion||(f._initialQuaternion=new i.b()),i.b.FromEulerAnglesToRef(0,g.offsetX*f._dragFactor,0,f._tmpDragQuaternion),f._initialQuaternion.multiplyToRef(f._tmpDragQuaternion,f._initialQuaternion))}))}),f}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"disablePointerInputWhenUsingDeviceOrientation",{get:function(){return this._disablePointerInputWhenUsingDeviceOrientation},set:function(a){this._disablePointerInputWhenUsingDeviceOrientation=a},enumerable:!0,configurable:!0}),b.prototype.enableHorizontalDragging=function(a){void 0===a&&(a=1/300),this._dragFactor=a},b.prototype.getClassName=function(){return"DeviceOrientationCamera"},b.prototype._checkInputs=function(){e.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},b.prototype.resetToCurrentRotation=function(a){var c=this;void 0===a&&(a=Ba.a.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new i.b()),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(d){a[d]?c._initialQuaternion[d]*=-1:c._initialQuaternion[d]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},b}(nc),Qh=function(e){function b(a){return e.call(this,a)||this}return Object(l.d)(b,e),b.prototype.addKeyboard=function(){return this.add(new Zf()),this},b.prototype.addMouse=function(a){return void 0===a&&(a=!0),this.add(new _f(a)),this},b}(pe),Sl=function(e){function b(a,c,d,f){void 0===f&&(f=!0);var g=e.call(this,a,c,d,f)||this;return g.ellipsoid=new i.e(1,1,1),g.ellipsoidOffset=new i.e(0,0,0),g.checkCollisions=!1,g.applyGravity=!1,g.cameraDirection=i.e.Zero(),g._trackRoll=0,g.rollCorrect=100,g.bankedTurn=!1,g.bankedTurnLimit=Math.PI/2,g.bankedTurnMultiplier=1,g._needMoveForGravity=!1,g._oldPosition=i.e.Zero(),g._diffPosition=i.e.Zero(),g._newPosition=i.e.Zero(),g._collisionMask=-1,g._onCollisionPositionChange=function(h,j,m){void 0===m&&(m=null);var w;w=j,g._newPosition.copyFrom(w),g._newPosition.subtractToRef(g._oldPosition,g._diffPosition),g._diffPosition.length()>Ha.a.CollisionsEpsilon&&(g.position.addInPlace(g._diffPosition),g.onCollide&&m&&g.onCollide(m))},g.inputs=new Qh(g),g.inputs.addKeyboard().addMouse(),g}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"angularSensibility",{get:function(){var a=this.inputs.attached.mouse;return a?a.angularSensibility:0},set:function(a){var c=this.inputs.attached.mouse;c&&(c.angularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysForward",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysForward:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysForward=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysBackward",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysBackward:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysBackward=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysUp",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysUp:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysUp=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysDown",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysDown:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysDown=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysLeft",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysLeft:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysLeft=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"keysRight",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysRight:[]},set:function(a){var c=this.inputs.attached.keyboard;c&&(c.keysRight=a)},enumerable:!0,configurable:!0}),b.prototype.attachControl=function(a,c){this.inputs.attachElement(a,c)},b.prototype.detachControl=function(a){this.inputs.detachElement(a),this.cameraDirection=new i.e(0,0,0)},Object.defineProperty(b.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(a){this._collisionMask=isNaN(a)?-1:a},enumerable:!0,configurable:!0}),b.prototype._collideWithWorld=function(a){(this.parent?i.e.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var c=this.getScene().collisionCoordinator;this._collider||(this._collider=c.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var d=a;this.applyGravity&&(d=a.add(this.getScene().gravity)),c.getNewPosition(this._oldPosition,d,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},b.prototype._checkInputs=function(){this._localDirection||(this._localDirection=i.e.Zero(),this._transformedDirection=i.e.Zero()),this.inputs.checkInputs(),e.prototype._checkInputs.call(this)},b.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},b.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):e.prototype._updatePosition.call(this)},b.prototype.restoreRoll=function(a){var c=this._trackRoll,d=c-this.rotation.z;Math.abs(d)>=.001&&(this.rotation.z+=d/a,Math.abs(c-this.rotation.z)<=.001&&(this.rotation.z=c))},b.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},b.prototype.getClassName=function(){return"FlyCamera"},Object(l.c)([Object(F.o)()],b.prototype,"ellipsoid",void 0),Object(l.c)([Object(F.o)()],b.prototype,"ellipsoidOffset",void 0),Object(l.c)([Object(F.c)()],b.prototype,"checkCollisions",void 0),Object(l.c)([Object(F.c)()],b.prototype,"applyGravity",void 0),b}(Uc),Rh=function(e){function b(a){return e.call(this,a)||this}return Object(l.d)(b,e),b.prototype.addKeyboard=function(){return this.add(new $f()),this},b.prototype.addMouseWheel=function(){return this.add(new ag()),this},b.prototype.addPointers=function(){return this.add(new bg()),this},b.prototype.addVRDeviceOrientation=function(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this},b}(pe);ia.a.AddNodeConstructor("FollowCamera",function(e,b){return function(){return new Sh(e,i.e.Zero(),b)}}),ia.a.AddNodeConstructor("ArcFollowCamera",function(e,b){return function(){return new Th(e,0,0,1,null,b)}});var wc,Sh=function(e){function b(a,c,d,f){void 0===f&&(f=null);var g=e.call(this,a,c,d)||this;return g.radius=12,g.lowerRadiusLimit=null,g.upperRadiusLimit=null,g.rotationOffset=0,g.lowerRotationOffsetLimit=null,g.upperRotationOffsetLimit=null,g.heightOffset=4,g.lowerHeightOffsetLimit=null,g.upperHeightOffsetLimit=null,g.cameraAcceleration=.05,g.maxCameraSpeed=20,g.lockedTarget=f,g.inputs=new Rh(g),g.inputs.addKeyboard().addMouseWheel().addPointers(),g}return Object(l.d)(b,e),b.prototype._follow=function(a){if(a){var c;if(a.rotationQuaternion){var d=new i.a();a.rotationQuaternion.toRotationMatrix(d),c=Math.atan2(d.m[8],d.m[10])}else c=a.rotation.y;var f=Qa.b.ToRadians(this.rotationOffset)+c,g=a.getAbsolutePosition(),h=g.x+Math.sin(f)*this.radius,j=g.z+Math.cos(f)*this.radius,m=h-this.position.x,w=g.y+this.heightOffset-this.position.y,z=j-this.position.z,C=m*this.cameraAcceleration*2,J=w*this.cameraAcceleration,K=z*this.cameraAcceleration*2;(C>this.maxCameraSpeed||C<-this.maxCameraSpeed)&&(C=C<1?-this.maxCameraSpeed:this.maxCameraSpeed),(J>this.maxCameraSpeed||J<-this.maxCameraSpeed)&&(J=J<1?-this.maxCameraSpeed:this.maxCameraSpeed),(K>this.maxCameraSpeed||K<-this.maxCameraSpeed)&&(K=K<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new i.e(this.position.x+C,this.position.y+J,this.position.z+K),this.setTarget(g)}},b.prototype.attachControl=function(a,c){this.inputs.attachElement(a,c),this._reset=function(){}},b.prototype.detachControl=function(a){this.inputs.detachElement(a),this._reset&&this._reset()},b.prototype._checkInputs=function(){this.inputs.checkInputs(),this._checkLimits(),e.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},b.prototype._checkLimits=function(){null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),null!==this.lowerHeightOffsetLimit&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),null!==this.upperHeightOffsetLimit&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),null!==this.lowerRotationOffsetLimit&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),null!==this.upperRotationOffsetLimit&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)},b.prototype.getClassName=function(){return"FollowCamera"},Object(l.c)([Object(F.c)()],b.prototype,"radius",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lowerRadiusLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"upperRadiusLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"rotationOffset",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lowerRotationOffsetLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"upperRotationOffsetLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"heightOffset",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lowerHeightOffsetLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"upperHeightOffsetLimit",void 0),Object(l.c)([Object(F.c)()],b.prototype,"cameraAcceleration",void 0),Object(l.c)([Object(F.c)()],b.prototype,"maxCameraSpeed",void 0),Object(l.c)([Object(F.k)("lockedTargetId")],b.prototype,"lockedTarget",void 0),b}(Uc),Th=function(e){function b(a,c,d,f,g,h){var j=e.call(this,a,i.e.Zero(),h)||this;return j.alpha=c,j.beta=d,j.radius=f,j.target=g,j._cartesianCoordinates=i.e.Zero(),j._follow(),j}return Object(l.d)(b,e),b.prototype._follow=function(){if(this.target){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var a=this.target.getAbsolutePosition();this.position=a.add(this._cartesianCoordinates),this.setTarget(a)}},b.prototype._checkInputs=function(){e.prototype._checkInputs.call(this),this._follow()},b.prototype.getClassName=function(){return"ArcFollowCamera"},b}(Uc),kg=o(38),Rb=o(39);!function(e){e[e.VIVE=0]="VIVE",e[e.OCULUS=1]="OCULUS",e[e.WINDOWS=2]="WINDOWS",e[e.GEAR_VR=3]="GEAR_VR",e[e.DAYDREAM=4]="DAYDREAM",e[e.GENERIC=5]="GENERIC"}(wc||(wc={}));var ac,kd,Vc=function(){function e(){}return e.InitiateController=function(b){for(var a=0,c=this._ControllerFactories;a<c.length;a++){var d=c[a];if(d.canCreate(b))return d.create(b)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(b);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},e._ControllerFactories=[],e._DefaultControllerFactory=null,e}(),Gd=function(e){function b(a){var c=e.call(this,a.id,a.index,a)||this;return c.isXR=!1,c._deviceRoomPosition=i.e.Zero(),c._deviceRoomRotationQuaternion=new i.b(),c.devicePosition=i.e.Zero(),c.deviceRotationQuaternion=new i.b(),c.deviceScaleFactor=1,c._trackPosition=!0,c._maxRotationDistFromHeadset=Math.PI/5,c._draggedRoomRotation=0,c._leftHandSystemQuaternion=new i.b(),c._deviceToWorld=i.a.Identity(),c._pointingPoseNode=null,c._workingMatrix=i.a.Identity(),c._meshAttachedObservable=new I.c(),c.type=Pb.POSE_ENABLED,c.controllerType=wc.GENERIC,c.position=i.e.Zero(),c.rotationQuaternion=new i.b(),c._calculatedPosition=i.e.Zero(),c._calculatedRotation=new i.b(),i.b.RotationYawPitchRollToRef(Math.PI,0,0,c._leftHandSystemQuaternion),c}return Object(l.d)(b,e),b.prototype._disableTrackPosition=function(a){this._trackPosition&&(this._calculatedPosition.copyFrom(a),this._trackPosition=!1)},b.prototype.update=function(){e.prototype.update.call(this),this._updatePoseAndMesh()},b.prototype._updatePoseAndMesh=function(){if(!this.isXR){var a=this.browserGamepad.pose;if(this.updateFromDevice(a),!this._trackPosition&&U.a.LastCreatedScene&&U.a.LastCreatedScene.activeCamera&&U.a.LastCreatedScene.activeCamera.devicePosition){if((c=U.a.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(c.devicePosition),c.deviceRotationQuaternion){var c;(c=c)._deviceRoomRotationQuaternion.toEulerAnglesToRef(i.c.Vector3[0]);var d=Math.atan2(Math.sin(i.c.Vector3[0].y-this._draggedRoomRotation),Math.cos(i.c.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(d)>this._maxRotationDistFromHeadset){var f=d-(d<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=f;var g=Math.sin(-f),h=Math.cos(-f);this._calculatedPosition.x=this._calculatedPosition.x*h-this._calculatedPosition.z*g,this._calculatedPosition.z=this._calculatedPosition.x*g+this._calculatedPosition.z*h}}}i.e.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),i.b.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))}},b.prototype.updateFromDevice=function(a){if(!this.isXR&&a){this.rawPose=a,a.position&&(this._deviceRoomPosition.copyFromFloats(a.position[0],a.position[1],-a.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var c=this.rawPose;a.orientation&&c.orientation&&4===c.orientation.length&&(this._deviceRoomRotationQuaternion.copyFromFloats(c.orientation[0],c.orientation[1],-c.orientation[2],-c.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},b.prototype.attachToMesh=function(a){if(this._mesh&&(this._mesh.parent=null),this._mesh=a,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new i.b()),!this.isXR&&(this._updatePoseAndMesh(),this._pointingPoseNode)){for(var c=[],d=this._pointingPoseNode;d.parent;)c.push(d.parent),d=d.parent;c.reverse().forEach(function(f){f.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(a)},b.prototype.attachToPoseControlledCamera=function(a){this._poseControlledCamera=a,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},b.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,e.prototype.dispose.call(this)},Object.defineProperty(b.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),b.prototype.getForwardRay=function(a){if(void 0===a&&(a=100),!this.mesh)return new Rb.a(i.e.Zero(),new i.e(0,0,1),a);var c=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),d=c.getTranslation(),f=new i.e(0,0,-1),g=i.e.TransformNormal(f,c),h=i.e.Normalize(g);return new Rb.a(d,h,a)},b.POINTING_POSE="POINTING_POSE",b}(Pb);!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LeftStick=10]="LeftStick",e[e.RightStick=11]="RightStick"}(ac||(ac={})),function(e){e[e.Up=12]="Up",e[e.Down=13]="Down",e[e.Left=14]="Left",e[e.Right=15]="Right"}(kd||(kd={}));var gc,ld,Uh=function(e){function b(a,c,d,f){void 0===f&&(f=!1);var g=e.call(this,a,c,d,0,1,2,3)||this;return g._leftTrigger=0,g._rightTrigger=0,g.onButtonDownObservable=new I.c(),g.onButtonUpObservable=new I.c(),g.onPadDownObservable=new I.c(),g.onPadUpObservable=new I.c(),g._buttonA=0,g._buttonB=0,g._buttonX=0,g._buttonY=0,g._buttonBack=0,g._buttonStart=0,g._buttonLB=0,g._buttonRB=0,g._buttonLeftStick=0,g._buttonRightStick=0,g._dPadUp=0,g._dPadDown=0,g._dPadLeft=0,g._dPadRight=0,g._isXboxOnePad=!1,g.type=Pb.XBOX,g._isXboxOnePad=f,g}return Object(l.d)(b,e),b.prototype.onlefttriggerchanged=function(a){this._onlefttriggerchanged=a},b.prototype.onrighttriggerchanged=function(a){this._onrighttriggerchanged=a},Object.defineProperty(b.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(a){this._onlefttriggerchanged&&this._leftTrigger!==a&&this._onlefttriggerchanged(a),this._leftTrigger=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(a){this._onrighttriggerchanged&&this._rightTrigger!==a&&this._onrighttriggerchanged(a),this._rightTrigger=a},enumerable:!0,configurable:!0}),b.prototype.onbuttondown=function(a){this._onbuttondown=a},b.prototype.onbuttonup=function(a){this._onbuttonup=a},b.prototype.ondpaddown=function(a){this._ondpaddown=a},b.prototype.ondpadup=function(a){this._ondpadup=a},b.prototype._setButtonValue=function(a,c,d){return a!==c&&(1===a&&(this._onbuttondown&&this._onbuttondown(d),this.onButtonDownObservable.notifyObservers(d)),0===a&&(this._onbuttonup&&this._onbuttonup(d),this.onButtonUpObservable.notifyObservers(d))),a},b.prototype._setDPadValue=function(a,c,d){return a!==c&&(1===a&&(this._ondpaddown&&this._ondpaddown(d),this.onPadDownObservable.notifyObservers(d)),0===a&&(this._ondpadup&&this._ondpadup(d),this.onPadUpObservable.notifyObservers(d))),a},Object.defineProperty(b.prototype,"buttonA",{get:function(){return this._buttonA},set:function(a){this._buttonA=this._setButtonValue(a,this._buttonA,ac.A)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonB",{get:function(){return this._buttonB},set:function(a){this._buttonB=this._setButtonValue(a,this._buttonB,ac.B)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonX",{get:function(){return this._buttonX},set:function(a){this._buttonX=this._setButtonValue(a,this._buttonX,ac.X)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonY",{get:function(){return this._buttonY},set:function(a){this._buttonY=this._setButtonValue(a,this._buttonY,ac.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(a){this._buttonStart=this._setButtonValue(a,this._buttonStart,ac.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(a){this._buttonBack=this._setButtonValue(a,this._buttonBack,ac.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(a){this._buttonLB=this._setButtonValue(a,this._buttonLB,ac.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(a){this._buttonRB=this._setButtonValue(a,this._buttonRB,ac.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(a){this._buttonLeftStick=this._setButtonValue(a,this._buttonLeftStick,ac.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(a){this._buttonRightStick=this._setButtonValue(a,this._buttonRightStick,ac.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(a){this._dPadUp=this._setDPadValue(a,this._dPadUp,kd.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(a){this._dPadDown=this._setDPadValue(a,this._dPadDown,kd.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(a){this._dPadLeft=this._setDPadValue(a,this._dPadLeft,kd.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(a){this._dPadRight=this._setDPadValue(a,this._dPadRight,kd.Right)},enumerable:!0,configurable:!0}),b.prototype.update=function(){e.prototype.update.call(this),this._isXboxOnePad,this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},b.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},b}(Pb);!function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.LeftStick=10]="LeftStick",e[e.RightStick=11]="RightStick"}(gc||(gc={})),function(e){e[e.Up=12]="Up",e[e.Down=13]="Down",e[e.Left=14]="Left",e[e.Right=15]="Right"}(ld||(ld={}));var Vh=function(e){function b(a,c,d){var f=e.call(this,a.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),c,d,0,1,2,3)||this;return f._leftTrigger=0,f._rightTrigger=0,f.onButtonDownObservable=new I.c(),f.onButtonUpObservable=new I.c(),f.onPadDownObservable=new I.c(),f.onPadUpObservable=new I.c(),f._buttonCross=0,f._buttonCircle=0,f._buttonSquare=0,f._buttonTriangle=0,f._buttonShare=0,f._buttonOptions=0,f._buttonL1=0,f._buttonR1=0,f._buttonLeftStick=0,f._buttonRightStick=0,f._dPadUp=0,f._dPadDown=0,f._dPadLeft=0,f._dPadRight=0,f.type=Pb.DUALSHOCK,f}return Object(l.d)(b,e),b.prototype.onlefttriggerchanged=function(a){this._onlefttriggerchanged=a},b.prototype.onrighttriggerchanged=function(a){this._onrighttriggerchanged=a},Object.defineProperty(b.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(a){this._onlefttriggerchanged&&this._leftTrigger!==a&&this._onlefttriggerchanged(a),this._leftTrigger=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(a){this._onrighttriggerchanged&&this._rightTrigger!==a&&this._onrighttriggerchanged(a),this._rightTrigger=a},enumerable:!0,configurable:!0}),b.prototype.onbuttondown=function(a){this._onbuttondown=a},b.prototype.onbuttonup=function(a){this._onbuttonup=a},b.prototype.ondpaddown=function(a){this._ondpaddown=a},b.prototype.ondpadup=function(a){this._ondpadup=a},b.prototype._setButtonValue=function(a,c,d){return a!==c&&(1===a&&(this._onbuttondown&&this._onbuttondown(d),this.onButtonDownObservable.notifyObservers(d)),0===a&&(this._onbuttonup&&this._onbuttonup(d),this.onButtonUpObservable.notifyObservers(d))),a},b.prototype._setDPadValue=function(a,c,d){return a!==c&&(1===a&&(this._ondpaddown&&this._ondpaddown(d),this.onPadDownObservable.notifyObservers(d)),0===a&&(this._ondpadup&&this._ondpadup(d),this.onPadUpObservable.notifyObservers(d))),a},Object.defineProperty(b.prototype,"buttonCross",{get:function(){return this._buttonCross},set:function(a){this._buttonCross=this._setButtonValue(a,this._buttonCross,gc.Cross)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonCircle",{get:function(){return this._buttonCircle},set:function(a){this._buttonCircle=this._setButtonValue(a,this._buttonCircle,gc.Circle)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonSquare",{get:function(){return this._buttonSquare},set:function(a){this._buttonSquare=this._setButtonValue(a,this._buttonSquare,gc.Square)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonTriangle",{get:function(){return this._buttonTriangle},set:function(a){this._buttonTriangle=this._setButtonValue(a,this._buttonTriangle,gc.Triangle)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonOptions",{get:function(){return this._buttonOptions},set:function(a){this._buttonOptions=this._setButtonValue(a,this._buttonOptions,gc.Options)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonShare",{get:function(){return this._buttonShare},set:function(a){this._buttonShare=this._setButtonValue(a,this._buttonShare,gc.Share)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonL1",{get:function(){return this._buttonL1},set:function(a){this._buttonL1=this._setButtonValue(a,this._buttonL1,gc.L1)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonR1",{get:function(){return this._buttonR1},set:function(a){this._buttonR1=this._setButtonValue(a,this._buttonR1,gc.R1)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(a){this._buttonLeftStick=this._setButtonValue(a,this._buttonLeftStick,gc.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(a){this._buttonRightStick=this._setButtonValue(a,this._buttonRightStick,gc.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(a){this._dPadUp=this._setDPadValue(a,this._dPadUp,ld.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(a){this._dPadDown=this._setDPadValue(a,this._dPadDown,ld.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(a){this._dPadLeft=this._setDPadValue(a,this._dPadLeft,ld.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(a){this._dPadRight=this._setDPadValue(a,this._dPadRight,ld.Right)},enumerable:!0,configurable:!0}),b.prototype.update=function(){e.prototype.update.call(this),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},b.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},b}(Pb),Wh=function(){function e(b){var a=this;if(this._scene=b,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new I.c(),kg.a.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new I.c(function(d){for(var f in a._babylonGamepads){var g=a._babylonGamepads[f];g&&g._isConnected&&a.onGamepadConnectedObservable.notifyObserver(d,g)}}),this._onGamepadConnectedEvent=function(d){var f,g=d.gamepad;g.index in a._babylonGamepads&&a._babylonGamepads[g.index].isConnected||(a._babylonGamepads[g.index]?((f=a._babylonGamepads[g.index]).browserGamepad=g,f._isConnected=!0):f=a._addNewGamepad(g),a.onGamepadConnectedObservable.notifyObservers(f),a._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(d){var f=d.gamepad;for(var g in a._babylonGamepads)if(a._babylonGamepads[g].index===f.index){var h=a._babylonGamepads[g];h._isConnected=!1,a.onGamepadDisconnectedObservable.notifyObservers(h),h.dispose&&h.dispose();break}},this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){var c=this._scene?this._scene.getEngine().getHostWindow():window;c&&(c.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),c.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}return Object.defineProperty(e.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),e.prototype.getGamepadByType=function(b){void 0===b&&(b=Pb.XBOX);for(var a=0,c=this._babylonGamepads;a<c.length;a++){var d=c[a];if(d&&d.type===b)return d}return null},e.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(b){b.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},e.prototype._addNewGamepad=function(b){var a;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var c=-1!==b.id.search("054c"),d=-1!==b.id.search("Xbox One");return a=d||-1!==b.id.search("Xbox 360")||-1!==b.id.search("xinput")?new Uh(b.id,b.index,b,d):c?new Vh(b.id,b.index,b):b.pose?Vc.InitiateController(b):new Nh(b.id,b.index,b),this._babylonGamepads[a.index]=a,a},e.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var b=this;for(var a in this._updateGamepadObjects(),this._babylonGamepads){var c=this._babylonGamepads[a];c&&c.isConnected&&c.update()}this._isMonitoring&&!this._scene&&Ha.a.QueueNewFrame(function(){b._checkGamepadsStatus()})},e.prototype._updateGamepadObjects=function(){for(var b=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],a=0;a<b.length;a++){var c=b[a];if(c)if(this._babylonGamepads[c.index])this._babylonGamepads[a].browserGamepad=c,this._babylonGamepads[a].isConnected||(this._babylonGamepads[a]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[a]));else{var d=this._addNewGamepad(c);this.onGamepadConnectedObservable.notifyObservers(d)}}},e}();Object.defineProperty(wa.a.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new Wh(this);var e=this._getComponent(_a.a.NAME_GAMEPAD);e||(e=new Xh(this),this._addComponent(e))}return this._gamepadManager},enumerable:!0,configurable:!0}),qe.prototype.addGamepad=function(){return this.add(new gg()),this},We.prototype.addGamepad=function(){return this.add(new Uf()),this};var Xh=function(){function e(b){this.name=_a.a.NAME_GAMEPAD,this.scene=b}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(_a.a.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){var b=this.scene._gamepadManager;b&&(b.dispose(),this.scene._gamepadManager=null)},e.prototype._beforeCameraUpdate=function(){var b=this.scene._gamepadManager;b&&b._isMonitoring&&b._checkGamepadsStatus()},e}();ia.a.AddNodeConstructor("FreeCamera",function(e,b){return function(){return new Hd(e,i.e.Zero(),b)}});var Hd=function(e){function b(a,c,d){var f=e.call(this,a,c,d)||this;return f.inputs.addGamepad(),f}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"gamepadAngularSensibility",{get:function(){var a=this.inputs.attached.gamepad;return a?a.gamepadAngularSensibility:0},set:function(a){var c=this.inputs.attached.gamepad;c&&(c.gamepadAngularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"gamepadMoveSensibility",{get:function(){var a=this.inputs.attached.gamepad;return a?a.gamepadMoveSensibility:0},set:function(a){var c=this.inputs.attached.gamepad;c&&(c.gamepadMoveSensibility=a)},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"UniversalCamera"},b}(jg);hb.a._createDefaultParsedCamera=function(e,b){return new Hd(e,i.e.Zero(),b)},ia.a.AddNodeConstructor("GamepadCamera",function(e,b){return function(){return new Ye(e,i.e.Zero(),b)}});var Ye=function(e){function b(a,c,d){return e.call(this,a,c,d)||this}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"GamepadCamera"},b}(Hd),Ic=o(34),Pa=o(8),Tl=`
attribute vec2 position;
uniform vec2 scale;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd)*scale;
gl_Position=vec4(position,0.0,1.0);
}`;Pa.a.ShadersStore.postprocessVertexShader=Tl;var Yh=o(95),Cb=o(31);Cb.a.prototype.createRenderTargetTexture=function(e,b){var a=new Yh.a();void 0!==b&&"object"==typeof b?(a.generateMipMaps=b.generateMipMaps,a.generateDepthBuffer=!!b.generateDepthBuffer,a.generateStencilBuffer=!!b.generateStencilBuffer,a.type=void 0===b.type?p.a.TEXTURETYPE_UNSIGNED_INT:b.type,a.samplingMode=void 0===b.samplingMode?p.a.TEXTURE_TRILINEAR_SAMPLINGMODE:b.samplingMode,a.format=void 0===b.format?p.a.TEXTUREFORMAT_RGBA:b.format):(a.generateMipMaps=b,a.generateDepthBuffer=!0,a.generateStencilBuffer=!1,a.type=p.a.TEXTURETYPE_UNSIGNED_INT,a.samplingMode=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE,a.format=p.a.TEXTUREFORMAT_RGBA),(a.type!==p.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(a.type!==p.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(a.samplingMode=p.a.TEXTURE_NEAREST_SAMPLINGMODE),a.type!==p.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(a.type=p.a.TEXTURETYPE_UNSIGNED_INT,k.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var c=this._gl,d=new mb.a(this,mb.b.RenderTarget),f=e.width||e,g=e.height||e,h=e.layers||0,j=this._getSamplingParameters(a.samplingMode,!!a.generateMipMaps),m=0!==h?c.TEXTURE_2D_ARRAY:c.TEXTURE_2D,w=this._getRGBABufferInternalSizedFormat(a.type,a.format),z=this._getInternalFormat(a.format),C=this._getWebGLTextureType(a.type);this._bindTextureDirectly(m,d),0!==h?(d.is2DArray=!0,c.texImage3D(m,0,w,f,g,h,0,z,C,null)):c.texImage2D(m,0,w,f,g,0,z,C,null),c.texParameteri(m,c.TEXTURE_MAG_FILTER,j.mag),c.texParameteri(m,c.TEXTURE_MIN_FILTER,j.min),c.texParameteri(m,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(m,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),a.generateMipMaps&&this._gl.generateMipmap(m),this._bindTextureDirectly(m,null);var J=c.createFramebuffer();return this._bindUnboundFramebuffer(J),d._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!a.generateStencilBuffer,a.generateDepthBuffer,f,g),d.is2DArray||c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,d._webGLTexture,0),this._bindUnboundFramebuffer(null),d._framebuffer=J,d.baseWidth=f,d.baseHeight=g,d.width=f,d.height=g,d.depth=h,d.isReady=!0,d.samples=1,d.generateMipMaps=!!a.generateMipMaps,d.samplingMode=a.samplingMode,d.type=a.type,d.format=a.format,d._generateDepthBuffer=a.generateDepthBuffer,d._generateStencilBuffer=!!a.generateStencilBuffer,this._internalTexturesCache.push(d),d},Cb.a.prototype.createDepthStencilTexture=function(e,b){if(b.isCube){var a=e.width||e;return this._createDepthStencilCubeTexture(a,b)}return this._createDepthStencilTexture(e,b)},Cb.a.prototype._createDepthStencilTexture=function(e,b){var a=this._gl,c=e.layers||0,d=0!==c?a.TEXTURE_2D_ARRAY:a.TEXTURE_2D,f=new mb.a(this,mb.b.Depth);if(!this._caps.depthTextureExtension)return k.a.Error("Depth texture is not supported by your browser or hardware."),f;var g=Object(l.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},b);this._bindTextureDirectly(d,f,!0),this._setupDepthStencilTexture(f,e,g.generateStencil,g.bilinearFiltering,g.comparisonFunction);var h=g.generateStencil?a.UNSIGNED_INT_24_8:a.UNSIGNED_INT,j=g.generateStencil?a.DEPTH_STENCIL:a.DEPTH_COMPONENT,m=j;return this.webGLVersion>1&&(m=g.generateStencil?a.DEPTH24_STENCIL8:a.DEPTH_COMPONENT24),f.is2DArray?a.texImage3D(d,0,m,f.width,f.height,c,0,j,h,null):a.texImage2D(d,0,m,f.width,f.height,0,j,h,null),this._bindTextureDirectly(d,null),f};var gb=function(){function e(b,a,c,d,f,g,h,j,m,w,z,C,J,K,N){void 0===h&&(h=p.a.TEXTURE_NEAREST_SAMPLINGMODE),void 0===w&&(w=null),void 0===z&&(z=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===C&&(C="postprocess"),void 0===K&&(K=!1),void 0===N&&(N=p.a.TEXTUREFORMAT_RGBA),this.name=b,this.width=-1,this.height=-1,this._outputTexture=null,this.autoClear=!0,this.alphaMode=p.a.ALPHA_DISABLE,this.animations=new Array(),this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=p.a.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new Ic.a(2),this._currentRenderTextureInd=0,this._scaleRatio=new i.d(1,1),this._texelSize=i.d.Zero(),this.onActivateObservable=new I.c(),this.onSizeChangedObservable=new I.c(),this.onApplyObservable=new I.c(),this.onBeforeRenderObservable=new I.c(),this.onAfterRenderObservable=new I.c(),null!=g?(this._camera=g,this._scene=g.getScene(),g.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):j&&(this._engine=j,this._engine.postProcesses.push(this)),this._options=f,this.renderTargetSamplingMode=h||p.a.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=m||!1,this._textureType=z,this._textureFormat=N,this._samplers=d||[],this._samplers.push("textureSampler"),this._fragmentUrl=a,this._vertexUrl=C,this._parameters=c||[],this._parameters.push("scale"),this._indexParameters=J,K||this.updateEffect(w)}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(b){var a=this;this._samples=Math.min(b,this._engine.getCaps().maxMSAASamples),this._textures.forEach(function(c){c.samples!==a._samples&&a._engine.updateRenderTargetTextureSampleCount(c,a._samples)})},enumerable:!0,configurable:!0}),e.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(e.prototype,"onActivate",{set:function(b){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),b&&(this._onActivateObserver=this.onActivateObservable.add(b))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSizeChanged",{set:function(b){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onApply",{set:function(b){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(b){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(b){this._forcedOutputTexture=b},enumerable:!0,configurable:!0}),e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcess"},e.prototype.getEngine=function(){return this._engine},e.prototype.getEffect=function(){return this._effect},e.prototype.shareOutputWith=function(b){return this._disposeTextures(),this._shareOutputWithPostProcess=b,this},e.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new Ic.a(2)),this._shareOutputWithPostProcess=null},e.prototype.updateEffect=function(b,a,c,d,f,g){void 0===b&&(b=null),void 0===a&&(a=null),void 0===c&&(c=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],a||this._parameters,c||this._samplers,null!==b?b:"",void 0,f,g,d||this._indexParameters)},e.prototype.isReusable=function(){return this._reusable},e.prototype.markTextureDirty=function(){this.width=-1},e.prototype.activate=function(b,a,c){var d=this;void 0===a&&(a=null);var f=(b=b||this._camera).getScene(),g=f.getEngine(),h=g.getCaps().maxTextureSize,j=(a?a.width:this._engine.getRenderWidth(!0))*this._options|0,m=(a?a.height:this._engine.getRenderHeight(!0))*this._options|0,w=b.parent;!w||w.leftCamera!=b&&w.rightCamera!=b||(j/=2);var z,C=this._options.width||j,J=this._options.height||m,K=this.renderTargetSamplingMode!==p.a.TEXTURE_NEAREST_LINEAR&&this.renderTargetSamplingMode!==p.a.TEXTURE_NEAREST_NEAREST&&this.renderTargetSamplingMode!==p.a.TEXTURE_LINEAR_LINEAR;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var N=g.currentViewport;N&&(C*=N.width,J*=N.height)}if((K||this.alwaysForcePOT)&&(this._options.width||(C=g.needPOTTextures?Ha.a.GetExponentOfTwo(C,h,this.scaleMode):C),this._options.height||(J=g.needPOTTextures?Ha.a.GetExponentOfTwo(J,h,this.scaleMode):J)),this.width!==C||this.height!==J){if(this._textures.length>0){for(var T=0;T<this._textures.length;T++)this._engine._releaseTexture(this._textures.data[T]);this._textures.reset()}this.width=C,this.height=J;var Z={width:this.width,height:this.height},_={generateMipMaps:K,generateDepthBuffer:c||0===b._postProcesses.indexOf(this),generateStencilBuffer:(c||0===b._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._engine.createRenderTargetTexture(Z,_)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(Z,_)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(ca){ca.samples!==d.samples&&d._engine.updateRenderTargetTextureSampleCount(ca,d.samples)})}return this._shareOutputWithPostProcess?z=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(z=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):z=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(j/C,m/J),this._engine.bindFramebuffer(z,0,j,m,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(z,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(b),this.autoClear&&this.alphaMode===p.a.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:f.clearColor,f._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),z},Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){return this._effect&&this._effect.isReady()},e.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),b=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",b),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var b},e.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var b=0;b<this._textures.length;b++)this._engine._releaseTexture(this._textures.data[b]);this._textures.dispose()}},e.prototype.dispose=function(b){if(b=b||this._camera,this._disposeTextures(),this._scene){var a=this._scene.postProcesses.indexOf(this);-1!==a&&this._scene.postProcesses.splice(a,1)}else{var c=this._engine.postProcesses.indexOf(this);-1!==c&&this._engine.postProcesses.splice(c,1)}if(b){if(b.detachPostProcess(this),0===b._postProcesses.indexOf(this)&&b._postProcesses.length>0){var d=this._camera._getFirstPostProcess();d&&d.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},e}(),Ul=`
varying vec2 vUV;
uniform sampler2D textureSampler;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
}`;Pa.a.ShadersStore.passPixelShader=Ul;var Vl=`
varying vec2 vUV;
uniform samplerCube textureSampler;
void main(void)
{
vec2 uv=vUV*2.0-1.0;
#ifdef POSITIVEX
gl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));
#endif
#ifdef NEGATIVEX
gl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));
#endif
#ifdef POSITIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));
#endif
#ifdef NEGATIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));
#endif
#ifdef POSITIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,1.001));
#endif
#ifdef NEGATIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));
#endif
}`;Pa.a.ShadersStore.passCubePixelShader=Vl;var Wc=function(e){function b(a,c,d,f,g,h,j,m){return void 0===d&&(d=null),void 0===j&&(j=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1),e.call(this,a,"pass",null,null,c,d,f,g,h,void 0,j,void 0,null,m)||this}return Object(l.d)(b,e),b}(gb),Wl=function(e){function b(a,c,d,f,g,h,j,m){void 0===d&&(d=null),void 0===j&&(j=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1);var w=e.call(this,a,"passCube",null,null,c,d,f,g,h,"#define POSITIVEX",j,void 0,null,m)||this;return w._face=0,w}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"face",{get:function(){return this._face},set:function(a){if(!(a<0||a>5))switch(this._face=a,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!0,configurable:!0}),b}(gb);Ha.a._RescalePostProcessFactory=function(e){return new Wc("rescale",1,null,p.a.TEXTURE_BILINEAR_SAMPLINGMODE,e,!1,p.a.TEXTURETYPE_UNSIGNED_INT)};var Xl=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D leftSampler;
void main(void)
{
vec4 leftFrag=texture2D(leftSampler,vUV);
leftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);
vec4 rightFrag=texture2D(textureSampler,vUV);
rightFrag=vec4(rightFrag.r,1.0,1.0,1.0);
gl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);
}`;Pa.a.ShadersStore.anaglyphPixelShader=Xl;var Zh=function(e){function b(a,c,d,f,g,h){var j=e.call(this,a,"anaglyph",null,["leftSampler"],c,d[1],f,g,h)||this;return j._passedProcess=d[0]._rigPostProcess,j.onApplyObservable.add(function(m){m.setTextureFromPostProcess("leftSampler",j._passedProcess)}),j}return Object(l.d)(b,e),b}(gb);hb.a._setStereoscopicAnaglyphRigMode=function(e){e._rigCameras[0]._rigPostProcess=new Wc(e.name+"_passthru",1,e._rigCameras[0]),e._rigCameras[1]._rigPostProcess=new Zh(e.name+"_anaglyph",1,e._rigCameras)},ia.a.AddNodeConstructor("AnaglyphArcRotateCamera",function(e,b,a){return function(){return new _h(e,0,0,1,i.e.Zero(),a.interaxial_distance,b)}});var _h=function(e){function b(a,c,d,f,g,h,j){var m=e.call(this,a,c,d,f,g,j)||this;return m.interaxialDistance=h,m.setCameraRigMode(hb.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:h}),m}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},b}(jd);ia.a.AddNodeConstructor("AnaglyphFreeCamera",function(e,b,a){return function(){return new $h(e,i.e.Zero(),a.interaxial_distance,b)}});var $h=function(e){function b(a,c,d,f){var g=e.call(this,a,c,f)||this;return g.interaxialDistance=d,g.setCameraRigMode(hb.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:d}),g}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"AnaglyphFreeCamera"},b}(nc);ia.a.AddNodeConstructor("AnaglyphGamepadCamera",function(e,b,a){return function(){return new ai(e,i.e.Zero(),a.interaxial_distance,b)}});var ai=function(e){function b(a,c,d,f){var g=e.call(this,a,c,f)||this;return g.interaxialDistance=d,g.setCameraRigMode(hb.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:d}),g}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},b}(Ye);ia.a.AddNodeConstructor("AnaglyphUniversalCamera",function(e,b,a){return function(){return new bi(e,i.e.Zero(),a.interaxial_distance,b)}});var bi=function(e){function b(a,c,d,f){var g=e.call(this,a,c,f)||this;return g.interaxialDistance=d,g.setCameraRigMode(hb.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:d}),g}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},b}(Hd),Yl=`const vec3 TWO=vec3(2.0,2.0,2.0);
varying vec2 vUV;
uniform sampler2D camASampler;
uniform sampler2D textureSampler;
uniform vec2 stepSize;
void main(void)
{
bool useCamA;
bool useCamB;
vec2 texCoord1;
vec2 texCoord2;
vec3 frag1;
vec3 frag2;
#ifdef IS_STEREOSCOPIC_HORIZ
useCamB=vUV.x>0.5;
useCamA=!useCamB;
texCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);
texCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);
#else
#ifdef IS_STEREOSCOPIC_INTERLACED
float rowNum=floor(vUV.y/stepSize.y);
useCamA=mod(rowNum,2.0) == 1.0;
useCamB=mod(rowNum,2.0) == 0.0;
texCoord1=vec2(vUV.x,vUV.y);
texCoord2=vec2(vUV.x,vUV.y);
#else
useCamB=vUV.y>0.5;
useCamA=!useCamB;
texCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);
texCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);
#endif
#endif

if (useCamB){
frag1=texture2D(textureSampler,texCoord1).rgb;
frag2=texture2D(textureSampler,texCoord2).rgb;
}else if (useCamA){
frag1=texture2D(camASampler ,texCoord1).rgb;
frag2=texture2D(camASampler ,texCoord2).rgb;
}else {
discard;
}
gl_FragColor=vec4((frag1+frag2)/TWO,1.0);
}
`;Pa.a.ShadersStore.stereoscopicInterlacePixelShader=Yl;var ci=function(e){function b(a,c,d,f,g,h,j){var m=e.call(this,a,"stereoscopicInterlace",["stepSize"],["camASampler"],1,c[1],g,h,j,f?"#define IS_STEREOSCOPIC_INTERLACED 1":d?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return m._passedProcess=c[0]._rigPostProcess,m._stepSize=new i.d(1/m.width,1/m.height),m.onSizeChangedObservable.add(function(){m._stepSize=new i.d(1/m.width,1/m.height)}),m.onApplyObservable.add(function(w){w.setTextureFromPostProcess("camASampler",m._passedProcess),w.setFloat2("stepSize",m._stepSize.x,m._stepSize.y)}),m}return Object(l.d)(b,e),b}(gb),Zl=function(e){function b(a,c,d,f,g,h){var j=e.call(this,a,"stereoscopicInterlace",["stepSize"],["camASampler"],1,c[1],f,g,h,d?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return j._passedProcess=c[0]._rigPostProcess,j._stepSize=new i.d(1/j.width,1/j.height),j.onSizeChangedObservable.add(function(){j._stepSize=new i.d(1/j.width,1/j.height)}),j.onApplyObservable.add(function(m){m.setTextureFromPostProcess("camASampler",j._passedProcess),m.setFloat2("stepSize",j._stepSize.x,j._stepSize.y)}),j}return Object(l.d)(b,e),b}(gb);hb.a._setStereoscopicRigMode=function(e){var b=e.cameraRigMode===hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||e.cameraRigMode===hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,a=e.cameraRigMode===hb.a.RIG_MODE_STEREOSCOPIC_INTERLACED;e._rigCameras[0]._rigPostProcess=new Wc(e.name+"_passthru",1,e._rigCameras[0]),e._rigCameras[1]._rigPostProcess=new ci(e.name+"_stereoInterlace",e._rigCameras,b,a)},ia.a.AddNodeConstructor("StereoscopicArcRotateCamera",function(e,b,a){return function(){return new di(e,0,0,1,i.e.Zero(),a.interaxial_distance,a.isStereoscopicSideBySide,b)}});var di=function(e){function b(a,c,d,f,g,h,j,m){var w=e.call(this,a,c,d,f,g,m)||this;return w.interaxialDistance=h,w.isStereoscopicSideBySide=j,w.setCameraRigMode(j?hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:hb.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:h}),w}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},b}(jd);ia.a.AddNodeConstructor("StereoscopicFreeCamera",function(e,b,a){return function(){return new ei(e,i.e.Zero(),a.interaxial_distance,a.isStereoscopicSideBySide,b)}});var ei=function(e){function b(a,c,d,f,g){var h=e.call(this,a,c,g)||this;return h.interaxialDistance=d,h.isStereoscopicSideBySide=f,h.setCameraRigMode(f?hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:hb.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:d}),h}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"StereoscopicFreeCamera"},b}(nc);ia.a.AddNodeConstructor("StereoscopicGamepadCamera",function(e,b,a){return function(){return new fi(e,i.e.Zero(),a.interaxial_distance,a.isStereoscopicSideBySide,b)}});var fi=function(e){function b(a,c,d,f,g){var h=e.call(this,a,c,g)||this;return h.interaxialDistance=d,h.isStereoscopicSideBySide=f,h.setCameraRigMode(f?hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:hb.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:d}),h}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},b}(Ye);ia.a.AddNodeConstructor("StereoscopicFreeCamera",function(e,b,a){return function(){return new gi(e,i.e.Zero(),a.interaxial_distance,a.isStereoscopicSideBySide,b)}});var gi=function(e){function b(a,c,d,f,g){var h=e.call(this,a,c,g)||this;return h.interaxialDistance=d,h.isStereoscopicSideBySide=f,h.setCameraRigMode(f?hb.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:hb.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:d}),h}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},b}(Hd);ia.a.AddNodeConstructor("VirtualJoysticksCamera",function(e,b){return function(){return new hi(e,i.e.Zero(),b)}});var hi=function(e){function b(a,c,d){var f=e.call(this,a,c,d)||this;return f.inputs.addVirtualJoystick(),f}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"VirtualJoysticksCamera"},b}(nc),Id=function(){function e(){this.compensateDistortion=!0,this.multiviewEnabled=!1}return Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftHMatrix",{get:function(){var b=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return i.a.Translation(b,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightHMatrix",{get:function(){var b=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return i.a.Translation(-b,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPreViewMatrix",{get:function(){return i.a.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPreViewMatrix",{get:function(){return i.a.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),e.GetDefault=function(){var b=new e();return b.hResolution=1280,b.vResolution=800,b.hScreenSize=.149759993,b.vScreenSize=.0935999975,b.vScreenCenter=.0467999987,b.eyeToScreenDistance=.0410000011,b.lensSeparationDistance=.063500002,b.interpupillaryDistance=.064000003,b.distortionK=[1,.219999999,.239999995,0],b.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],b.postProcessScaleFactor=1.714605507808412,b.lensCenterOffset=.151976421,b},e}(),_l=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 LensCenter;
uniform vec2 Scale;
uniform vec2 ScaleIn;
uniform vec4 HmdWarpParam;
vec2 HmdWarp(vec2 in01) {
vec2 theta=(in01-LensCenter)*ScaleIn;
float rSq=theta.x*theta.x+theta.y*theta.y;
vec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);
return LensCenter+Scale*rvector;
}
void main(void)
{
vec2 tc=HmdWarp(vUV);
if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)
gl_FragColor=vec4(0.0,0.0,0.0,0.0);
else{
gl_FragColor=texture2D(textureSampler,tc);
}
}`;Pa.a.ShadersStore.vrDistortionCorrectionPixelShader=_l;var lg=function(e){function b(a,c,d,f){var g=e.call(this,a,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,f.postProcessScaleFactor,c,ya.a.BILINEAR_SAMPLINGMODE)||this;return g._isRightEye=d,g._distortionFactors=f.distortionK,g._postProcessScaleFactor=f.postProcessScaleFactor,g._lensCenterOffset=f.lensCenterOffset,g.adaptScaleToCurrentViewport=!0,g.onSizeChangedObservable.add(function(){g._scaleIn=new i.d(2,2/g.aspectRatio),g._scaleFactor=new i.d(1/g._postProcessScaleFactor*.5,1/g._postProcessScaleFactor*.5*g.aspectRatio),g._lensCenter=new i.d(g._isRightEye?.5-.5*g._lensCenterOffset:.5+.5*g._lensCenterOffset,.5)}),g.onApplyObservable.add(function(h){h.setFloat2("LensCenter",g._lensCenter.x,g._lensCenter.y),h.setFloat2("Scale",g._scaleFactor.x,g._scaleFactor.y),h.setFloat2("ScaleIn",g._scaleIn.x,g._scaleIn.y),h.setFloat4("HmdWarpParam",g._distortionFactors[0],g._distortionFactors[1],g._distortionFactors[2],g._distortionFactors[3])}),g}return Object(l.d)(b,e),b}(gb),$l=`precision mediump sampler2DArray;
varying vec2 vUV;
uniform sampler2DArray multiviewSampler;
uniform int imageIndex;
void main(void)
{
gl_FragColor=texture(multiviewSampler,vec3(vUV,imageIndex));
}`;Pa.a.ShadersStore.vrMultiviewToSingleviewPixelShader=$l;var ii=o(83),mg=o(90),re=o(91);Cb.a.prototype.createRenderTargetCubeTexture=function(e,b){var a=Object(l.a)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:p.a.TEXTURETYPE_UNSIGNED_INT,samplingMode:p.a.TEXTURE_TRILINEAR_SAMPLINGMODE,format:p.a.TEXTUREFORMAT_RGBA},b);a.generateStencilBuffer=a.generateDepthBuffer&&a.generateStencilBuffer,(a.type!==p.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(a.type!==p.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(a.samplingMode=p.a.TEXTURE_NEAREST_SAMPLINGMODE);var c=this._gl,d=new mb.a(this,mb.b.RenderTarget);this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,d,!0);var f=this._getSamplingParameters(a.samplingMode,a.generateMipMaps);a.type!==p.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(a.type=p.a.TEXTURETYPE_UNSIGNED_INT,k.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,f.mag),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,f.min),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);for(var g=0;g<6;g++)c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,this._getRGBABufferInternalSizedFormat(a.type,a.format),e,e,0,this._getInternalFormat(a.format),this._getWebGLTextureType(a.type),null);var h=c.createFramebuffer();return this._bindUnboundFramebuffer(h),d._depthStencilBuffer=this._setupFramebufferDepthAttachments(a.generateStencilBuffer,a.generateDepthBuffer,e,e),a.generateMipMaps&&c.generateMipmap(c.TEXTURE_CUBE_MAP),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),d._framebuffer=h,d.width=e,d.height=e,d.isReady=!0,d.isCube=!0,d.samples=1,d.generateMipMaps=a.generateMipMaps,d.samplingMode=a.samplingMode,d.type=a.type,d.format=a.format,d._generateDepthBuffer=a.generateDepthBuffer,d._generateStencilBuffer=a.generateStencilBuffer,this._internalTexturesCache.push(d),d};var Jb=function(e){function b(a,c,d,f,g,h,j,m,w,z,C,J,K){void 0===g&&(g=!0),void 0===h&&(h=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===j&&(j=!1),void 0===m&&(m=ya.a.TRILINEAR_SAMPLINGMODE),void 0===w&&(w=!0),void 0===z&&(z=!1),void 0===C&&(C=!1),void 0===J&&(J=p.a.TEXTUREFORMAT_RGBA),void 0===K&&(K=!1);var N=e.call(this,null,d,!f)||this;return N.isCube=j,N.renderParticles=!0,N.renderSprites=!1,N.coordinatesMode=ya.a.PROJECTION_MODE,N.ignoreCameraViewport=!1,N.onBeforeBindObservable=new I.c(),N.onAfterUnbindObservable=new I.c(),N.onBeforeRenderObservable=new I.c(),N.onAfterRenderObservable=new I.c(),N.onClearObservable=new I.c(),N.onResizeObservable=new I.c(),N._currentRefreshId=-1,N._refreshRate=1,N._samples=1,N.boundingBoxPosition=i.e.Zero(),(d=N.getScene())?(N.renderList=new Array(),N._engine=d.getEngine(),N.name=a,N.isRenderTarget=!0,N._initialSizeParameter=c,N._processSizeParameter(c),N._resizeObserver=N.getScene().getEngine().onResizeObservable.add(function(){}),N._generateMipMaps=!!f,N._doNotChangeAspectRatio=g,N._renderingManager=new re.b(d),N._renderingManager._useSceneAutoClearSetup=!0,C?N:(N._renderTargetOptions={generateMipMaps:f,type:h,format:J,samplingMode:m,generateDepthBuffer:w,generateStencilBuffer:z},m===ya.a.NEAREST_SAMPLINGMODE&&(N.wrapU=ya.a.CLAMP_ADDRESSMODE,N.wrapV=ya.a.CLAMP_ADDRESSMODE),K||(j?(N._texture=d.getEngine().createRenderTargetCubeTexture(N.getRenderSize(),N._renderTargetOptions),N.coordinatesMode=ya.a.INVCUBIC_MODE,N._textureMatrix=i.a.Identity()):N._texture=d.getEngine().createRenderTargetTexture(N._size,N._renderTargetOptions)),N)):N}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"renderList",{get:function(){return this._renderList},set:function(a){this._renderList=a,this._renderList&&this._hookArray(this._renderList)},enumerable:!0,configurable:!0}),b.prototype._hookArray=function(a){var c=this,d=a.push;a.push=function(){for(var g=[],h=0;h<arguments.length;h++)g[h]=arguments[h];var j=0===a.length,m=d.apply(a,g);return j&&c.getScene().meshes.forEach(function(w){w._markSubMeshesAsLightDirty()}),m};var f=a.splice;a.splice=function(g,h){var j=f.apply(a,[g,h]);return 0===a.length&&c.getScene().meshes.forEach(function(m){m._markSubMeshesAsLightDirty()}),j}},Object.defineProperty(b.prototype,"onAfterUnbind",{set:function(a){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onBeforeRender",{set:function(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onAfterRender",{set:function(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onClear",{set:function(a){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),b.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(b.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(a){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(a)){this._boundingBoxSize=a;var c=this.getScene();c&&c.markAllMaterialsAsDirty(p.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"depthStencilTexture",{get:function(){var a;return(null===(a=this.getInternalTexture())||void 0===a?void 0:a._depthStencilTexture)||null},enumerable:!0,configurable:!0}),b.prototype.createDepthStencilTexture=function(a,c,d){void 0===a&&(a=0),void 0===c&&(c=!0),void 0===d&&(d=!1);var f=this.getInternalTexture();if(this.getScene()&&f){var g=this.getScene().getEngine();f._depthStencilTexture=g.createDepthStencilTexture(this._size,{bilinearFiltering:c,comparisonFunction:a,generateStencil:d,isCube:this.isCube})}},b.prototype._processSizeParameter=function(a){a.ratio?(this._sizeRatio=a.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=a},Object.defineProperty(b.prototype,"samples",{get:function(){return this._samples},set:function(a){if(this._samples!==a){var c=this.getScene();c&&(this._samples=c.getEngine().updateRenderTargetTextureSampleCount(this._texture,a))}},enumerable:!0,configurable:!0}),b.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(b.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(a){this._refreshRate=a,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),b.prototype.addPostProcess=function(a){if(!this._postProcessManager){var c=this.getScene();if(!c)return;this._postProcessManager=new mg.a(c),this._postProcesses=new Array()}this._postProcesses.push(a),this._postProcesses[0].autoClear=!1},b.prototype.clearPostProcesses=function(a){if(void 0===a&&(a=!1),this._postProcesses){if(a)for(var c=0,d=this._postProcesses;c<d.length;c++)d[c].dispose();this._postProcesses=[]}},b.prototype.removePostProcess=function(a){if(this._postProcesses){var c=this._postProcesses.indexOf(a);-1!==c&&(this._postProcesses.splice(c,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},b.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},b.prototype.getRenderSize=function(){return this.getRenderWidth()},b.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},b.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},b.prototype.getRenderLayers=function(){var a=this._size.layers;return a||0},Object.defineProperty(b.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),b.prototype.scale=function(a){var c=Math.max(1,this.getRenderSize()*a);this.resize(c)},b.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:e.prototype.getReflectionTextureMatrix.call(this)},b.prototype.resize=function(a){var c=this.isCube;this.releaseInternalTexture();var d=this.getScene();d&&(this._processSizeParameter(a),this._texture=c?d.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):d.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},b.prototype.render=function(a,c){if(void 0===a&&(a=!1),void 0===c&&(c=!1),m=this.getScene()){var d,f=m.getEngine();if(void 0!==this.useCameraPostProcesses&&(a=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var g=0;g<this._waitingRenderList.length;g++){var h=this._waitingRenderList[g],j=m.getMeshByID(h);j&&this.renderList.push(j)}delete this._waitingRenderList}if(this.renderListPredicate){var m;if(this.renderList?this.renderList.length=0:this.renderList=[],!(m=this.getScene()))return;var w=m.meshes;for(g=0;g<w.length;g++){var z=w[g];this.renderListPredicate(z)&&this.renderList.push(z)}}if(this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(d=this.activeCamera,f.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==m.activeCamera&&m.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(d=m.activeCamera)&&f.setViewport(d.viewport,this.getRenderWidth(),this.getRenderHeight()),this._defaultRenderListPrepared=!1,this.is2DArray)for(var C=0;C<this.getRenderLayers();C++)this.renderToTarget(0,a,c,C,d),m.incrementRenderId(),m.resetCachedMaterial();else if(this.isCube)for(var J=0;J<6;J++)this.renderToTarget(J,a,c,void 0,d),m.incrementRenderId(),m.resetCachedMaterial();else this.renderToTarget(0,a,c,void 0,d);this.onAfterUnbindObservable.notifyObservers(this),m.activeCamera&&((m.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==m.activeCamera)&&m.setTransformMatrix(m.activeCamera.getViewMatrix(),m.activeCamera.getProjectionMatrix(!0)),f.setViewport(m.activeCamera.viewport)),m.resetCachedMaterial()}},b.prototype._bestReflectionRenderTargetDimension=function(a,c){var d=a*c,f=Ha.a.NearestPOT(d+16384/(128+d));return Math.min(Ha.a.FloorPOT(a),f)},b.prototype._prepareRenderingManager=function(a,c,d,f){var g=this.getScene();if(g){this._renderingManager.reset();for(var h=g.getRenderId(),j=0;j<c;j++){var m=a[j];if(m){if(!m.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}m._preActivateForIntermediateRendering(h);var w;if(w=!(!f||!d)&&0==(m.layerMask&d.layerMask),m.isEnabled()&&m.isVisible&&m.subMeshes&&!w&&m._activate(h,!0)&&m.subMeshes.length){m.isAnInstance?m=m.sourceMesh:m._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,m._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var z=0;z<m.subMeshes.length;z++){var C=m.subMeshes[z];this._renderingManager.dispatch(C,m)}}}}for(var J=0;J<g.particleSystems.length;J++){var K=g.particleSystems[J],N=K.emitter;K.isStarted()&&N&&N.position&&N.isEnabled()&&(a.indexOf(N)>=0&&this._renderingManager.dispatchParticles(K))}}},b.prototype._bindFrameBuffer=function(a,c){void 0===a&&(a=0),void 0===c&&(c=0);var d=this.getScene();if(d){var f=d.getEngine();this._texture&&f.bindFramebuffer(this._texture,this.isCube?a:void 0,void 0,void 0,this.ignoreCameraViewport,0,c)}},b.prototype.unbindFrameBuffer=function(a,c){var d=this;this._texture&&a.unBindFramebuffer(this._texture,this.isCube,function(){d.onAfterRenderObservable.notifyObservers(c)})},b.prototype.renderToTarget=function(a,c,d,f,g){void 0===f&&(f=0),void 0===g&&(g=null);var h=this.getScene();if(h){var j=h.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):c&&h.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(a,f),this.is2DArray?this.onBeforeRenderObservable.notifyObservers(f):this.onBeforeRenderObservable.notifyObservers(a);var m=null,w=this.renderList?this.renderList:h.getActiveMeshes().data,z=this.renderList?this.renderList.length:h.getActiveMeshes().length;this.getCustomRenderList&&(m=this.getCustomRenderList(this.is2DArray?f:a,w,z)),m?this._prepareRenderingManager(m,m.length,g,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(w,z,g,!this.renderList),this._defaultRenderListPrepared=!0),m=w),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(j):j.clear(this.clearColor||h.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||h.updateTransformMatrix(!0);for(var C=0,J=h._beforeRenderTargetDrawStage;C<J.length;C++)J[C].action(this);this._renderingManager.render(this.customRenderFunction,m,this.renderParticles,this.renderSprites);for(var K=0,N=h._afterRenderTargetDrawStage;K<N.length;K++)N[K].action(this);this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,a,this._postProcesses,this.ignoreCameraViewport):c&&h.postProcessManager._finalizeFrame(!1,this._texture,a),this._doNotChangeAspectRatio||h.updateTransformMatrix(!0),d&&Qa.b.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),j),this.isCube&&5!==a?this.onAfterRenderObservable.notifyObservers(a):(this.isCube&&5===a&&j.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(j,a))}}},b.prototype.setRenderingOrder=function(a,c,d,f){void 0===c&&(c=null),void 0===d&&(d=null),void 0===f&&(f=null),this._renderingManager.setRenderingOrder(a,c,d,f)},b.prototype.setRenderingAutoClearDepthStencil=function(a,c){this._renderingManager.setRenderingAutoClearDepthStencil(a,c),this._renderingManager._useSceneAutoClearSetup=!1},b.prototype.clone=function(){var a=this.getSize(),c=new b(this.name,a,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return c.hasAlpha=this.hasAlpha,c.level=this.level,c.coordinatesMode=this.coordinatesMode,this.renderList&&(c.renderList=this.renderList.slice(0)),c},b.prototype.serialize=function(){if(!this.name)return null;var a=e.prototype.serialize.call(this);if(a.renderTargetSize=this.getRenderSize(),a.renderList=[],this.renderList)for(var c=0;c<this.renderList.length;c++)a.renderList.push(this.renderList[c].id);return a},b.prototype.disposeFramebufferObjects=function(){var a=this.getInternalTexture(),c=this.getScene();a&&c&&c.getEngine()._releaseFramebufferObjects(a)},b.prototype.dispose=function(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var a=this.getScene();if(a){var c=a.customRenderTargets.indexOf(this);c>=0&&a.customRenderTargets.splice(c,1);for(var d=0,f=a.cameras;d<f.length;d++){var g=f[d];(c=g.customRenderTargets.indexOf(this))>=0&&g.customRenderTargets.splice(c,1)}this.depthStencilTexture&&this.getScene().getEngine()._releaseTexture(this.depthStencilTexture),e.prototype.dispose.call(this)}},b.prototype._rebuild=function(){this.refreshRate===b.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=b.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},b.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},b.prototype.getViewCount=function(){return 1},b.REFRESHRATE_RENDER_ONCE=0,b.REFRESHRATE_RENDER_ONEVERYFRAME=1,b.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,b}(ya.a);ya.a._CreateRenderTargetTexture=function(e,b,a,c){return new Jb(e,b,a,c)};var ji=function(e){function b(a,c){void 0===c&&(c=512);var d=e.call(this,"multiview rtt",c,a,!1,!0,mb.b.Unknown,!1,void 0,!1,!1,!0,void 0,!0)||this,f=a.getEngine().createMultiviewRenderTargetTexture(d.getRenderWidth(),d.getRenderHeight());return f.isMultiview=!0,f.format=p.a.TEXTUREFORMAT_RGBA,d._texture=f,d.samples=d._engine.getCaps().maxSamples||d.samples,d}return Object(l.d)(b,e),b.prototype._bindFrameBuffer=function(a){void 0===a&&(a=0),this._texture&&this.getScene().getEngine().bindMultiviewFramebuffer(this._texture)},b.prototype.getViewCount=function(){return 2},b}(Jb),ki=o(86);Ha.a.prototype.createMultiviewRenderTargetTexture=function(e,b){var a=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";var c=new mb.a(this,mb.b.Unknown,!0);return c.width=e,c.height=b,c._framebuffer=a.createFramebuffer(),c._colorTextureArray=a.createTexture(),a.bindTexture(a.TEXTURE_2D_ARRAY,c._colorTextureArray),a.texStorage3D(a.TEXTURE_2D_ARRAY,1,a.RGBA8,e,b,2),c._depthStencilTextureArray=a.createTexture(),a.bindTexture(a.TEXTURE_2D_ARRAY,c._depthStencilTextureArray),a.texStorage3D(a.TEXTURE_2D_ARRAY,1,a.DEPTH32F_STENCIL8,e,b,2),c.isReady=!0,c},Ha.a.prototype.bindMultiviewFramebuffer=function(e){var b=this._gl,a=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(e,void 0,void 0,void 0,!0),b.bindFramebuffer(b.DRAW_FRAMEBUFFER,e._framebuffer),!e._colorTextureArray||!e._depthStencilTextureArray)throw"Invalid multiview frame buffer";this.getCaps().oculusMultiview?(a.framebufferTextureMultisampleMultiviewOVR(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0,e._colorTextureArray,0,e.samples,0,2),a.framebufferTextureMultisampleMultiviewOVR(b.DRAW_FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,e._depthStencilTextureArray,0,e.samples,0,2)):(a.framebufferTextureMultiviewOVR(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0,e._colorTextureArray,0,0,2),a.framebufferTextureMultiviewOVR(b.DRAW_FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,e._depthStencilTextureArray,0,0,2))},hb.a.prototype._useMultiviewToSingleView=!1,hb.a.prototype._multiviewTexture=null,hb.a.prototype._resizeOrCreateMultiviewTexture=function(e,b){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==e&&this._multiviewTexture.getRenderHeight()==b||(this._multiviewTexture.dispose(),this._multiviewTexture=new ji(this.getScene(),{width:e,height:b})):this._multiviewTexture=new ji(this.getScene(),{width:e,height:b})},wa.a.prototype._transformMatrixR=i.a.Zero(),wa.a.prototype._multiviewSceneUbo=null,wa.a.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=new ii.a(this.getEngine(),void 0,!0),this._multiviewSceneUbo.addUniform("viewProjection",16),this._multiviewSceneUbo.addUniform("viewProjectionR",16),this._multiviewSceneUbo.addUniform("view",16)},wa.a.prototype._updateMultiviewUbo=function(e,b){e&&b&&e.multiplyToRef(b,this._transformMatrixR),e&&b&&(e.multiplyToRef(b,i.c.Matrix[0]),ki.a.GetRightPlaneToRef(i.c.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.update())},wa.a.prototype._renderMultiviewToSingleView=function(e){e._resizeOrCreateMultiviewTexture(e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.width>0?e._rigPostProcess.width:this.getEngine().getRenderWidth(!0),e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.height>0?e._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),e.outputRenderTarget=e._multiviewTexture,this._renderForCamera(e),e.outputRenderTarget=null;for(var b=0;b<e._rigCameras.length;b++){var a=this.getEngine();this._activeCamera=e._rigCameras[b],a.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}};var ng=function(e){function b(a,c,d){var f=e.call(this,a,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],d,c,ya.a.BILINEAR_SAMPLINGMODE)||this;return f.onSizeChangedObservable.add(function(){}),f.onApplyObservable.add(function(g){c._scene.activeCamera&&c._scene.activeCamera.isLeftCamera?g.setInt("imageIndex",0):g.setInt("imageIndex",1),g.setTexture("multiviewSampler",c._multiviewTexture)}),f}return Object(l.d)(b,e),b}(gb),Jc=o(61);hb.a._setVRRigMode=function(e,b){var a=b.vrCameraMetrics||Id.GetDefault();e._rigCameras[0]._cameraRigParams.vrMetrics=a,e._rigCameras[0].viewport=new Jc.a(0,0,.5,1),e._rigCameras[0]._cameraRigParams.vrWorkMatrix=new i.a(),e._rigCameras[0]._cameraRigParams.vrHMatrix=a.leftHMatrix,e._rigCameras[0]._cameraRigParams.vrPreViewMatrix=a.leftPreViewMatrix,e._rigCameras[0].getProjectionMatrix=e._rigCameras[0]._getVRProjectionMatrix,e._rigCameras[1]._cameraRigParams.vrMetrics=a,e._rigCameras[1].viewport=new Jc.a(.5,0,.5,1),e._rigCameras[1]._cameraRigParams.vrWorkMatrix=new i.a(),e._rigCameras[1]._cameraRigParams.vrHMatrix=a.rightHMatrix,e._rigCameras[1]._cameraRigParams.vrPreViewMatrix=a.rightPreViewMatrix,e._rigCameras[1].getProjectionMatrix=e._rigCameras[1]._getVRProjectionMatrix,a.multiviewEnabled&&(e.getScene().getEngine().getCaps().multiview?(e._useMultiviewToSingleView=!0,e._rigPostProcess=new ng("VRMultiviewToSingleview",e,a.postProcessScaleFactor)):(k.a.Warn("Multiview is not supported, falling back to standard rendering"),a.multiviewEnabled=!1)),a.compensateDistortion&&(e._rigCameras[0]._rigPostProcess=new lg("VR_Distort_Compensation_Left",e._rigCameras[0],!1,a),e._rigCameras[1]._rigPostProcess=new lg("VR_Distort_Compensation_Right",e._rigCameras[1],!0,a))},ia.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(e,b){return function(){return new li(e,0,0,1,i.e.Zero(),b)}});var li=function(e){function b(a,c,d,f,g,h,j,m){void 0===j&&(j=!0),void 0===m&&(m=Id.GetDefault());var w=e.call(this,a,c,d,f,g,h)||this;return m.compensateDistortion=j,w.setCameraRigMode(hb.a.RIG_MODE_VR,{vrCameraMetrics:m}),w.inputs.addVRDeviceOrientation(),w}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},b}(jd);ia.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(e,b){return function(){return new Ze(e,i.e.Zero(),b)}});var Ze=function(e){function b(a,c,d,f,g){void 0===f&&(f=!0),void 0===g&&(g=Id.GetDefault());var h=e.call(this,a,c,d)||this;return g.compensateDistortion=f,h.setCameraRigMode(hb.a.RIG_MODE_VR,{vrCameraMetrics:g}),h}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},b}(Xe);ia.a.AddNodeConstructor("VRDeviceOrientationGamepadCamera",function(e,b){return function(){return new mi(e,i.e.Zero(),b)}});var mi=function(e){function b(a,c,d,f,g){void 0===f&&(f=!0),void 0===g&&(g=Id.GetDefault());var h=e.call(this,a,c,d,f,g)||this;return h.inputs.addGamepad(),h}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},b}(Ze),_e=o(80);hb.a._setWebVRRigMode=function(e,b){if(b.vrDisplay){var a=b.vrDisplay.getEyeParameters("left"),c=b.vrDisplay.getEyeParameters("right");e._rigCameras[0].viewport=new Jc.a(0,0,.5,1),e._rigCameras[0].setCameraRigParameter("left",!0),e._rigCameras[0].setCameraRigParameter("specs",b.specs),e._rigCameras[0].setCameraRigParameter("eyeParameters",a),e._rigCameras[0].setCameraRigParameter("frameData",b.frameData),e._rigCameras[0].setCameraRigParameter("parentCamera",b.parentCamera),e._rigCameras[0]._cameraRigParams.vrWorkMatrix=new i.a(),e._rigCameras[0].getProjectionMatrix=e._getWebVRProjectionMatrix,e._rigCameras[0].parent=e,e._rigCameras[0]._getViewMatrix=e._getWebVRViewMatrix,e._rigCameras[1].viewport=new Jc.a(.5,0,.5,1),e._rigCameras[1].setCameraRigParameter("eyeParameters",c),e._rigCameras[1].setCameraRigParameter("specs",b.specs),e._rigCameras[1].setCameraRigParameter("frameData",b.frameData),e._rigCameras[1].setCameraRigParameter("parentCamera",b.parentCamera),e._rigCameras[1]._cameraRigParams.vrWorkMatrix=new i.a(),e._rigCameras[1].getProjectionMatrix=e._getWebVRProjectionMatrix,e._rigCameras[1].parent=e,e._rigCameras[1]._getViewMatrix=e._getWebVRViewMatrix}},Object.defineProperty(Ha.a.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),Ha.a.prototype._prepareVRComponent=function(){this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.onVRDisplayChangedObservable=new I.c(),this.onVRRequestPresentComplete=new I.c(),this.onVRRequestPresentStart=new I.c()},Ha.a.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},Ha.a.prototype.getVRDevice=function(){return this._vrDisplay},Ha.a.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},Ha.a.prototype.initWebVRAsync=function(){var e=this,b=function(){var c={vrDisplay:e._vrDisplay,vrSupported:e._vrSupported};e.onVRDisplayChangedObservable.notifyObservers(c),e._webVRInitPromise=new Promise(function(d){d(c)})};if(!this._onVrDisplayConnect){this._onVrDisplayConnect=function(c){e._vrDisplay=c.display,b()},this._onVrDisplayDisconnect=function(){e._vrDisplay.cancelAnimationFrame(e._frameHandler),e._vrDisplay=void 0,e._frameHandler=Ha.a.QueueNewFrame(e._boundRenderFunction),b()},this._onVrDisplayPresentChange=function(){e._vrExclusivePointerMode=e._vrDisplay&&e._vrDisplay.isPresenting};var a=this.getHostWindow();a&&(a.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),a.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),a.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange))}return this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(b),this._webVRInitPromise},Ha.a.prototype._getVRDisplaysAsync=function(){var e=this;return new Promise(function(b){navigator.getVRDisplays?navigator.getVRDisplays().then(function(a){e._vrSupported=!0,e._vrDisplay=a[0],b({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported})}):(e._vrDisplay=void 0,e._vrSupported=!1,b({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported}))})},Ha.a.prototype.enableVR=function(e){var b=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){this.onVRRequestPresentStart.notifyObservers(this);var a={highRefreshRate:!!this.vrPresentationAttributes&&this.vrPresentationAttributes.highRefreshRate,foveationLevel:this.vrPresentationAttributes?this.vrPresentationAttributes.foveationLevel:1,multiview:(this.getCaps().multiview||this.getCaps().oculusMultiview)&&e.useMultiview};this._vrDisplay.requestPresent([Object(l.a)({source:this.getRenderingCanvas(),attributes:a},a)]).then(function(){b.onVRRequestPresentComplete.notifyObservers(!0),b._onVRFullScreenTriggered()}).catch(function(){b.onVRRequestPresentComplete.notifyObservers(!1)})}},Ha.a.prototype._onVRFullScreenTriggered=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting){this._oldSize=new ba.a(this.getRenderWidth(),this.getRenderHeight()),this._oldHardwareScaleFactor=this.getHardwareScalingLevel();var e=this._vrDisplay.getEyeParameters("left");this.setHardwareScalingLevel(1),this.setSize(2*e.renderWidth,e.renderHeight)}else this.setHardwareScalingLevel(this._oldHardwareScaleFactor),this.setSize(this._oldSize.width,this._oldSize.height)},Ha.a.prototype.disableVR=function(){var e=this;this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(function(){return e._onVRFullScreenTriggered()}).catch(function(){return e._onVRFullScreenTriggered()}),kg.a.IsWindowObjectExist()&&(window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null))},Ha.a.prototype._connectVREvents=function(e,b){var a=this;if(this._onVRDisplayPointerRestricted=function(){e&&e.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){if(b)b.exitPointerLock&&b.exitPointerLock();else{var d=a.getHostWindow();d.document&&d.document.exitPointerLock&&d.document.exitPointerLock()}},kg.a.IsWindowObjectExist()){var c=this.getHostWindow();c.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),c.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)}},Ha.a.prototype._submitVRFrame=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting)try{this._vrDisplay.submitFrame()}catch(e){Qa.b.Warn("webVR submitFrame has had an unexpected failure: "+e)}},Ha.a.prototype.isVRPresenting=function(){return this._vrDisplay&&this._vrDisplay.isPresenting},Ha.a.prototype._requestVRFrame=function(){this._frameHandler=Ha.a.QueueNewFrame(this._boundRenderFunction,this._vrDisplay)},ia.a.AddNodeConstructor("WebVRFreeCamera",function(e,b){return function(){return new $e(e,i.e.Zero(),b)}}),ia.a.AddNodeConstructor("WebVRGamepadCamera",function(e,b){return function(){return new $e(e,i.e.Zero(),b)}});var $e=function(e){function b(a,c,d,f){void 0===f&&(f={});var g=e.call(this,a,c,d)||this;g.webVROptions=f,g._vrDevice=null,g.rawPose=null,g._specsVersion="1.1",g._attached=!1,g._descendants=[],g._deviceRoomPosition=i.e.Zero(),g._deviceRoomRotationQuaternion=i.b.Identity(),g._standingMatrix=null,g.devicePosition=i.e.Zero(),g.deviceRotationQuaternion=i.b.Identity(),g.deviceScaleFactor=1,g._deviceToWorld=i.a.Identity(),g._worldToDevice=i.a.Identity(),g.controllers=[],g.onControllersAttachedObservable=new I.c(),g.onControllerMeshLoadedObservable=new I.c(),g.onPoseUpdatedFromDeviceObservable=new I.c(),g._poseSet=!1,g.rigParenting=!0,g._defaultHeight=void 0,g._htmlElementAttached=null,g._detachIfAttached=function(){var j=g.getEngine().getVRDevice();j&&!j.isPresenting&&g._htmlElementAttached&&g.detachControl(g._htmlElementAttached)},g._workingVector=i.e.Zero(),g._oneVector=i.e.One(),g._workingMatrix=i.a.Identity(),g._tmpMatrix=new i.a(),g._cache.position=i.e.Zero(),f.defaultHeight&&(g._defaultHeight=f.defaultHeight,g.position.y=g._defaultHeight),g.minZ=.1,5===arguments.length&&(g.webVROptions=arguments[4]),null==g.webVROptions.trackPosition&&(g.webVROptions.trackPosition=!0),null==g.webVROptions.controllerMeshes&&(g.webVROptions.controllerMeshes=!0),null==g.webVROptions.defaultLightingOnControllers&&(g.webVROptions.defaultLightingOnControllers=!0),g.rotationQuaternion=new i.b(),g.webVROptions&&g.webVROptions.positionScale&&(g.deviceScaleFactor=g.webVROptions.positionScale);var h=g.getEngine();return g._onVREnabled=function(j){j&&g.initControllers()},h.onVRRequestPresentComplete.add(g._onVREnabled),h.initWebVR().add(function(j){j.vrDisplay&&g._vrDevice!==j.vrDisplay&&(g._vrDevice=j.vrDisplay,g.setCameraRigMode(hb.a.RIG_MODE_WEBVR,{parentCamera:g,vrDisplay:g._vrDevice,frameData:g._frameData,specs:g._specsVersion}),g._attached&&g.getEngine().enableVR(g.webVROptions))}),"undefined"!=typeof VRFrameData&&(g._frameData=new VRFrameData()),f.useMultiview&&(g.getScene().getEngine().getCaps().multiview?(g._useMultiviewToSingleView=!0,g._rigPostProcess=new ng("VRMultiviewToSingleview",g,1)):(k.a.Warn("Multiview is not supported, falling back to standard rendering"),g._useMultiviewToSingleView=!1)),d.onBeforeCameraRenderObservable.add(function(j){j.parent===g&&g.rigParenting&&(g._descendants=g.getDescendants(!0,function(m){var w=g.controllers.some(function(C){return C._mesh===m}),z=-1!==g._rigCameras.indexOf(m);return!w&&!z}),g._descendants.forEach(function(m){m.parent=j}))}),d.onAfterCameraRenderObservable.add(function(j){j.parent===g&&g.rigParenting&&g._descendants.forEach(function(m){m.parent=g})}),g}return Object(l.d)(b,e),b.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},b.prototype.useStandingMatrix=function(a){var c=this;void 0===a&&(a=function(d){}),this.getEngine().initWebVRAsync().then(function(d){d.vrDisplay&&d.vrDisplay.stageParameters&&d.vrDisplay.stageParameters.sittingToStandingTransform&&c.webVROptions.trackPosition?(c._standingMatrix=new i.a(),i.a.FromFloat32ArrayToRefScaled(d.vrDisplay.stageParameters.sittingToStandingTransform,0,1,c._standingMatrix),c.getScene().useRightHandedSystem||c._standingMatrix&&c._standingMatrix.toggleModelMatrixHandInPlace(),a(!0)):a(!1)})},b.prototype.useStandingMatrixAsync=function(){var a=this;return new Promise(function(c){a.useStandingMatrix(function(d){c(d)})})},b.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),e.prototype.dispose.call(this)},b.prototype.getControllerByName=function(a){for(var c=0,d=this.controllers;c<d.length;c++){var f=d[c];if(f.hand===a)return f}return null},Object.defineProperty(b.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!0,configurable:!0}),b.prototype.getForwardRay=function(a){return void 0===a&&(a=100),this.leftCamera?e.prototype.getForwardRay.call(this,a,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):e.prototype.getForwardRay.call(this,a)},b.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),e.prototype._checkInputs.call(this)},b.prototype.updateFromDevice=function(a){a&&a.orientation&&4===a.orientation.length&&(this.rawPose=a,this._deviceRoomRotationQuaternion.copyFromFloats(a.orientation[0],a.orientation[1],-a.orientation[2],-a.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},b.prototype.attachControl=function(a,c){e.prototype.attachControl.call(this,a,c),this._attached=!0,this._htmlElementAttached=a,c=!hb.a.ForceAttachControlToAlwaysPreventDefault&&c,this._vrDevice&&this.getEngine().enableVR(this.webVROptions);var d=this._scene.getEngine().getHostWindow();d&&d.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},b.prototype.detachControl=function(a){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),e.prototype.detachControl.call(this,a),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},b.prototype.getClassName=function(){return"WebVRFreeCamera"},b.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},b.prototype._updateRigCameras=function(){var a=this._rigCameras[0],c=this._rigCameras[1];a.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),c.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),a.position.copyFrom(this._deviceRoomPosition),c.position.copyFrom(this._deviceRoomPosition)},b.prototype._correctPositionIfNotTrackPosition=function(a,c){void 0===c&&(c=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(i.a.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),c||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(a,a))},b.prototype._updateCache=function(a){var c=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),i.e.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),i.a.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(d){d._deviceToWorld.copyFrom(c._deviceToWorld),c._correctPositionIfNotTrackPosition(d._deviceToWorld),d.update()})),a||e.prototype._updateCache.call(this),this.updateCacheCalled=!1},b.prototype._computeDevicePosition=function(){i.e.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},b.prototype.update=function(){this._computeDevicePosition(),i.a.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),i.b.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),e.prototype.update.call(this)},b.prototype._getViewMatrix=function(){return i.a.Identity()},b.prototype._getWebVRViewMatrix=function(){var a=this._cameraRigParams.parentCamera;a._updateCache();var c=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return i.a.FromArrayToRef(c,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),i.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),1!==a.deviceScaleFactor&&(this._webvrViewMatrix.invert(),a.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,a.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,a.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,a.deviceScaleFactor)),this._webvrViewMatrix.invert()),a._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),a._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||i.a.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(a.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},b.prototype._getWebVRProjectionMatrix=function(){var a=this.parent;a._vrDevice.depthNear=a.minZ,a._vrDevice.depthFar=a.maxZ;var c=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return i.a.FromArrayToRef(c,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},b.prototype.initControllers=function(){var a=this;this.controllers=[];var c=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=c.onGamepadDisconnectedObservable.add(function(d){if(d.type===Pb.POSE_ENABLED){var f=d;f.defaultModel&&f.defaultModel.setEnabled(!1),"right"===f.hand&&(a._rightController=null),"left"===f.hand&&(a._leftController=null);var g=a.controllers.indexOf(f);-1!==g&&a.controllers.splice(g,1)}}),this._onGamepadConnectedObserver=c.onGamepadConnectedObservable.add(function(d){if(d.type===Pb.POSE_ENABLED){var f=d;if(a.webVROptions.trackPosition||(f._disableTrackPosition(new i.e("left"==f.hand?-.15:.15,-.5,.25)),a._updateCacheWhenTrackingDisabledObserver||(a._updateCacheWhenTrackingDisabledObserver=a._scene.onBeforeRenderObservable.add(function(){a._updateCache()}))),f.deviceScaleFactor=a.deviceScaleFactor,f._deviceToWorld.copyFrom(a._deviceToWorld),a._correctPositionIfNotTrackPosition(f._deviceToWorld),a.webVROptions.controllerMeshes&&(f.defaultModel?f.defaultModel.setEnabled(!0):f.initControllerMesh(a.getScene(),function(j){if(j.scaling.scaleInPlace(a.deviceScaleFactor),a.onControllerMeshLoadedObservable.notifyObservers(f),a.webVROptions.defaultLightingOnControllers){a._lightOnControllers||(a._lightOnControllers=new _e.a("vrControllersLight",new i.e(0,1,0),a.getScene()));var m=function(w,z){var C=w.getChildren();C&&0!==C.length&&C.forEach(function(J){z.includedOnlyMeshes.push(J),m(J,z)})};a._lightOnControllers.includedOnlyMeshes.push(j),m(j,a._lightOnControllers)}})),f.attachToPoseControlledCamera(a),-1===a.controllers.indexOf(f)){a.controllers.push(f);for(var g=!1,h=0;h<a.controllers.length;h++)a.controllers[h].controllerType===wc.VIVE&&(g?a.controllers[h].hand="right":(g=!0,a.controllers[h].hand="left"));a.controllers.length>=2&&a.onControllersAttachedObservable.notifyObservers(a.controllers)}}})},b}(nc),Xc=function(e){function b(a){var c=e.call(this,a)||this;return c.onTriggerStateChangedObservable=new I.c(),c.onMainButtonStateChangedObservable=new I.c(),c.onSecondaryButtonStateChangedObservable=new I.c(),c.onPadStateChangedObservable=new I.c(),c.onPadValuesChangedObservable=new I.c(),c.pad={x:0,y:0},c._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},c._buttons=new Array(a.buttons.length),c.hand=a.hand,c}return Object(l.d)(b,e),b.prototype.onButtonStateChange=function(a){this._onButtonStateChange=a},Object.defineProperty(b.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),b.prototype.update=function(){e.prototype.update.call(this);for(var a=0;a<this._buttons.length;a++)this._setButtonValue(this.browserGamepad.buttons[a],this._buttons[a],a);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},b.prototype._setButtonValue=function(a,c,d){a||(a={pressed:!1,touched:!1,value:0}),c?(this._checkChanges(a,c),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,d,a),this._handleButtonChange(d,a,this._changes)),this._buttons[d].pressed=a.pressed,this._buttons[d].touched=a.touched,this._buttons[d].value=a.value<1e-08?0:a.value):this._buttons[d]={pressed:a.pressed,touched:a.touched,value:a.value}},b.prototype._checkChanges=function(a,c){return this._changes.pressChanged=a.pressed!==c.pressed,this._changes.touchChanged=a.touched!==c.touched,this._changes.valueChanged=a.value!==c.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},b.prototype.dispose=function(){e.prototype.dispose.call(this),this._defaultModel=null,this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},b}(Gd),Sb=o(40),Ab=o(32);Cb.a.prototype.createDynamicTexture=function(e,b,a,c){var d=new mb.a(this,mb.b.Dynamic);return d.baseWidth=e,d.baseHeight=b,a&&(e=this.needPOTTextures?Cb.a.GetExponentOfTwo(e,this._caps.maxTextureSize):e,b=this.needPOTTextures?Cb.a.GetExponentOfTwo(b,this._caps.maxTextureSize):b),d.width=e,d.height=b,d.isReady=!1,d.generateMipMaps=a,d.samplingMode=c,this.updateTextureSamplingMode(c,d),this._internalTexturesCache.push(d),d},Cb.a.prototype.updateDynamicTexture=function(e,b,a,c,d,f){if(void 0===c&&(c=!1),void 0===f&&(f=!1),e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0,f),this._unpackFlipY(a),c&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var g=d?this._getInternalFormat(d):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,g,g,this._gl.UNSIGNED_BYTE,b),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),c&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0}};var af=o(70),Bc=function(e){function b(a,c,d,f,g,h){void 0===d&&(d=null),void 0===g&&(g=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===h&&(h=p.a.TEXTUREFORMAT_RGBA);var j=e.call(this,null,d,!f,void 0,g,void 0,void 0,void 0,void 0,h)||this;j.name=a,j._engine=j.getScene().getEngine(),j.wrapU=ya.a.CLAMP_ADDRESSMODE,j.wrapV=ya.a.CLAMP_ADDRESSMODE,j._generateMipMaps=f,c.getContext?(j._canvas=c,j._texture=j._engine.createDynamicTexture(c.width,c.height,f,g)):(j._canvas=af.a.CreateCanvas(1,1),c.width||0===c.width?j._texture=j._engine.createDynamicTexture(c.width,c.height,f,g):j._texture=j._engine.createDynamicTexture(c,c,f,g));var m=j.getSize();return j._canvas.width=m.width,j._canvas.height=m.height,j._context=j._canvas.getContext("2d"),j}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(b.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),b.prototype._recreate=function(a){this._canvas.width=a.width,this._canvas.height=a.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(a.width,a.height,this._generateMipMaps,this.samplingMode)},b.prototype.scale=function(a){var c=this.getSize();c.width*=a,c.height*=a,this._recreate(c)},b.prototype.scaleTo=function(a,c){var d=this.getSize();d.width=a,d.height=c,this._recreate(d)},b.prototype.getContext=function(){return this._context},b.prototype.clear=function(){var a=this.getSize();this._context.fillRect(0,0,a.width,a.height)},b.prototype.update=function(a,c){void 0===c&&(c=!1),this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===a||a,c,this._format||void 0)},b.prototype.drawText=function(a,c,d,f,g,h,j,m){void 0===m&&(m=!0);var w=this.getSize();if(h&&(this._context.fillStyle=h,this._context.fillRect(0,0,w.width,w.height)),this._context.font=f,null==c){var z=this._context.measureText(a);c=(w.width-z.width)/2}if(null==d){var C=parseInt(f.replace(/\D/g,""));d=w.height/2+C/3.65}this._context.fillStyle=g,this._context.fillText(a,c,d),m&&this.update(j)},b.prototype.clone=function(){var a=this.getScene();if(!a)return this;var c=this.getSize(),d=new b(this.name,c,a,this._generateMipMaps);return d.hasAlpha=this.hasAlpha,d.level=this.level,d.wrapU=this.wrapU,d.wrapV=this.wrapV,d},b.prototype.serialize=function(){var a=this.getScene();a&&!a.isReady()&&k.a.Warn("The scene must be ready before serializing the dynamic texture");var c=e.prototype.serialize.call(this);return this._canvas.toDataURL&&(c.base64String=this._canvas.toDataURL()),c.invertY=this._invertY,c.samplingMode=this.samplingMode,c},b.prototype._rebuild=function(){this.update()},b}(ya.a),am=(o(99),o(58),o(100),`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main(void)
{
vec4 result=texture2D(textureSampler,vUV);
#ifdef IMAGEPROCESSING
#ifndef FROMLINEARSPACE

result.rgb=toLinearSpace(result.rgb);
#endif
result=applyImageProcessing(result);
#else

#ifdef FROMLINEARSPACE
result=applyImageProcessing(result);
#endif
#endif
gl_FragColor=result;
}`);Pa.a.ShadersStore.imageProcessingPixelShader=am;var og=function(e){function b(a,c,d,f,g,h,j,m){void 0===d&&(d=null),void 0===j&&(j=p.a.TEXTURETYPE_UNSIGNED_INT);var w=e.call(this,a,"imageProcessing",[],[],c,d,f,g,h,null,j,"postprocess",null,!0)||this;return w._fromLinearSpace=!0,w._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},m?(m.applyByPostProcess=!0,w._attachImageProcessingConfiguration(m,!0),w.fromLinearSpace=!1):(w._attachImageProcessingConfiguration(null,!0),w.imageProcessingConfiguration.applyByPostProcess=!0),w.onApply=function(z){w.imageProcessingConfiguration.bind(z,w.aspectRatio)},w}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(a){a.applyByPostProcess=!0,this._attachImageProcessingConfiguration(a)},enumerable:!0,configurable:!0}),b.prototype._attachImageProcessingConfiguration=function(a,c){var d=this;if(void 0===c&&(c=!1),a!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),a)this._imageProcessingConfiguration=a;else{var f=null,g=this.getEngine(),h=this.getCamera();if(h)f=h.getScene();else if(g&&g.scenes){var j=g.scenes;f=j[j.length-1]}else f=U.a.LastCreatedScene;this._imageProcessingConfiguration=f.imageProcessingConfiguration}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){d._updateParameters()})),c||this._updateParameters()}},Object.defineProperty(b.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(a){this.imageProcessingConfiguration.colorCurves=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(a){this.imageProcessingConfiguration.colorCurvesEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(a){this.imageProcessingConfiguration.colorGradingTexture=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(a){this.imageProcessingConfiguration.colorGradingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(a){this.imageProcessingConfiguration.exposure=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(a){this._imageProcessingConfiguration.toneMappingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"toneMappingType",{get:function(){return this._imageProcessingConfiguration.toneMappingType},set:function(a){this._imageProcessingConfiguration.toneMappingType=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(a){this.imageProcessingConfiguration.contrast=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(a){this.imageProcessingConfiguration.vignetteStretch=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(a){this.imageProcessingConfiguration.vignetteCentreX=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(a){this.imageProcessingConfiguration.vignetteCentreY=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(a){this.imageProcessingConfiguration.vignetteWeight=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(a){this.imageProcessingConfiguration.vignetteColor=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(a){this.imageProcessingConfiguration.vignetteCameraFov=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(a){this.imageProcessingConfiguration.vignetteBlendMode=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(a){this.imageProcessingConfiguration.vignetteEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(a){this._fromLinearSpace!==a&&(this._fromLinearSpace=a,this._updateParameters())},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"ImageProcessingPostProcess"},b.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var a="";for(var c in this._defines)this._defines[c]&&(a+="#define "+c+`;\r
`);var d=["textureSampler"],f=["scale"];Sb.a&&(Sb.a.PrepareSamplers(d,this._defines),Sb.a.PrepareUniforms(f,this._defines)),this.updateEffect(a,f,d)},b.prototype.dispose=function(a){e.prototype.dispose.call(this,a),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},Object(l.c)([Object(F.c)()],b.prototype,"_fromLinearSpace",void 0),b}(gb),Xa=o(15),ra=o(4);xa.a._GroundMeshParser=function(e,b){return bf.Parse(e,b)};var bf=function(e){function b(a,c){var d=e.call(this,a,c)||this;return d.generateOctree=!1,d}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(b.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),b.prototype.optimize=function(a,c){void 0===c&&(c=32),this._subdivisionsX=a,this._subdivisionsY=a,this.subdivide(a),this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(c)},b.prototype.getHeightAtCoordinates=function(a,c){var d=this.getWorldMatrix(),f=i.c.Matrix[5];d.invertToRef(f);var g=i.c.Vector3[8];if(i.e.TransformCoordinatesFromFloatsToRef(a,0,c,f,g),a=g.x,c=g.z,a<this._minX||a>this._maxX||c<this._minZ||c>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var h=this._getFacetAt(a,c),j=-(h.x*a+h.z*c+h.w)/h.y;return i.e.TransformCoordinatesFromFloatsToRef(0,j,0,d,g),g.y},b.prototype.getNormalAtCoordinates=function(a,c){var d=new i.e(0,1,0);return this.getNormalAtCoordinatesToRef(a,c,d),d},b.prototype.getNormalAtCoordinatesToRef=function(a,c,d){var f=this.getWorldMatrix(),g=i.c.Matrix[5];f.invertToRef(g);var h=i.c.Vector3[8];if(i.e.TransformCoordinatesFromFloatsToRef(a,0,c,g,h),a=h.x,c=h.z,a<this._minX||a>this._maxX||c<this._minZ||c>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var j=this._getFacetAt(a,c);return i.e.TransformNormalFromFloatsToRef(j.x,j.y,j.z,f,d),this},b.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},b.prototype._getFacetAt=function(a,c){var d=Math.floor((a+this._maxX)*this._subdivisionsX/this._width),f=Math.floor(-(c+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),g=this._heightQuads[f*this._subdivisionsX+d];return c<g.slope.x*a+g.slope.y?g.facet1:g.facet2},b.prototype._initHeightQuads=function(){var a=this._subdivisionsX,c=this._subdivisionsY;this._heightQuads=new Array();for(var d=0;d<c;d++)for(var f=0;f<a;f++){var g={slope:i.d.Zero(),facet1:new i.f(0,0,0,0),facet2:new i.f(0,0,0,0)};this._heightQuads[d*a+f]=g}return this},b.prototype._computeHeightQuads=function(){var a=this.getVerticesData(ra.b.PositionKind);if(!a)return this;for(var c=i.c.Vector3[3],d=i.c.Vector3[2],f=i.c.Vector3[1],g=i.c.Vector3[0],h=i.c.Vector3[4],j=i.c.Vector3[5],m=i.c.Vector3[6],w=i.c.Vector3[7],z=i.c.Vector3[8],C=0,J=0,K=0,N=0,T=0,Z=0,_=0,ca=this._subdivisionsX,ea=this._subdivisionsY,fa=0;fa<ea;fa++)for(var ka=0;ka<ca;ka++){C=3*ka,J=fa*(ca+1)*3,K=(fa+1)*(ca+1)*3,c.x=a[J+C],c.y=a[J+C+1],c.z=a[J+C+2],d.x=a[J+C+3],d.y=a[J+C+4],d.z=a[J+C+5],f.x=a[K+C],f.y=a[K+C+1],f.z=a[K+C+2],g.x=a[K+C+3],g.y=a[K+C+4],g.z=a[K+C+5],N=(g.z-c.z)/(g.x-c.x),T=c.z-N*c.x,d.subtractToRef(c,h),f.subtractToRef(c,j),g.subtractToRef(c,m),i.e.CrossToRef(m,j,w),i.e.CrossToRef(h,m,z),w.normalize(),z.normalize(),Z=-(w.x*c.x+w.y*c.y+w.z*c.z),_=-(z.x*d.x+z.y*d.y+z.z*d.z);var pa=this._heightQuads[fa*ca+ka];pa.slope.copyFromFloats(N,T),pa.facet1.copyFromFloats(w.x,w.y,w.z,Z),pa.facet2.copyFromFloats(z.x,z.y,z.z,_)}return this},b.prototype.serialize=function(a){e.prototype.serialize.call(this,a),a.subdivisionsX=this._subdivisionsX,a.subdivisionsY=this._subdivisionsY,a.minX=this._minX,a.maxX=this._maxX,a.minZ=this._minZ,a.maxZ=this._maxZ,a.width=this._width,a.height=this._height},b.Parse=function(a,c){var d=new b(a.name,c);return d._subdivisionsX=a.subdivisionsX||1,d._subdivisionsY=a.subdivisionsY||1,d._minX=a.minX,d._maxX=a.maxX,d._minZ=a.minZ,d._maxZ=a.maxZ,d._width=a.width,d._height=a.height,d},b}(xa.a);Xa.a.CreateGround=function(e){var b,a,c=[],d=[],f=[],g=[],h=e.width||1,j=e.height||1,m=e.subdivisionsX||e.subdivisions||1,w=e.subdivisionsY||e.subdivisions||1;for(b=0;b<=w;b++)for(a=0;a<=m;a++){var z=new i.e(a*h/m-h/2,0,(w-b)*j/w-j/2),C=new i.e(0,1,0);d.push(z.x,z.y,z.z),f.push(C.x,C.y,C.z),g.push(a/m,1-b/w)}for(b=0;b<w;b++)for(a=0;a<m;a++)c.push(a+1+(b+1)*(m+1)),c.push(a+1+b*(m+1)),c.push(a+b*(m+1)),c.push(a+(b+1)*(m+1)),c.push(a+1+(b+1)*(m+1)),c.push(a+b*(m+1));var J=new Xa.a();return J.indices=c,J.positions=d,J.normals=f,J.uvs=g,J},Xa.a.CreateTiledGround=function(e){var b,a,c,d,f=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,g=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,h=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,j=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,m=e.subdivisions||{w:1,h:1},w=e.precision||{w:1,h:1},z=new Array(),C=new Array(),J=new Array(),K=new Array();m.h=m.h<1?1:m.h,m.w=m.w<1?1:m.w,w.w=w.w<1?1:w.w,w.h=w.h<1?1:w.h;var N=(h-f)/m.w,T=(j-g)/m.h;function Z(ca,ea,fa,ka){var pa=C.length/3,va=w.w+1;for(b=0;b<w.h;b++)for(a=0;a<w.w;a++){var sa=[pa+a+b*va,pa+(a+1)+b*va,pa+(a+1)+(b+1)*va,pa+a+(b+1)*va];z.push(sa[1]),z.push(sa[2]),z.push(sa[3]),z.push(sa[0]),z.push(sa[1]),z.push(sa[3])}var la=i.e.Zero(),ta=new i.e(0,1,0);for(b=0;b<=w.h;b++)for(la.z=b*(ka-ea)/w.h+ea,a=0;a<=w.w;a++)la.x=a*(fa-ca)/w.w+ca,la.y=0,C.push(la.x,la.y,la.z),J.push(ta.x,ta.y,ta.z),K.push(a/w.w,b/w.h)}for(c=0;c<m.h;c++)for(d=0;d<m.w;d++)Z(f+d*N,g+c*T,f+(d+1)*N,g+(c+1)*T);var _=new Xa.a();return _.indices=z,_.positions=C,_.normals=J,_.uvs=K,_},Xa.a.CreateGroundFromHeightMap=function(e){var b,a,c=[],d=[],f=[],g=[],h=e.colorFilter||new G.a(.3,.59,.11),j=e.alphaFilter||0,m=!1;if(e.minHeight>e.maxHeight){m=!0;var w=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=w}for(b=0;b<=e.subdivisions;b++)for(a=0;a<=e.subdivisions;a++){var z=new i.e(a*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-b)*e.height/e.subdivisions-e.height/2),C=4*(((z.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(z.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth),J=e.buffer[C]/255,K=e.buffer[C+1]/255,N=e.buffer[C+2]/255,T=e.buffer[C+3]/255;m&&(J=1-J,K=1-K,N=1-N);var Z=J*h.r+K*h.g+N*h.b;z.y=T>=j?e.minHeight+(e.maxHeight-e.minHeight)*Z:e.minHeight-kb.a,d.push(z.x,z.y,z.z),f.push(0,0,0),g.push(a/e.subdivisions,1-b/e.subdivisions)}for(b=0;b<e.subdivisions;b++)for(a=0;a<e.subdivisions;a++){var _=a+1+(b+1)*(e.subdivisions+1),ca=a+1+b*(e.subdivisions+1),ea=a+b*(e.subdivisions+1),fa=a+(b+1)*(e.subdivisions+1),ka=d[3*_+1]>=e.minHeight,pa=d[3*ca+1]>=e.minHeight,va=d[3*ea+1]>=e.minHeight;ka&&pa&&va&&(c.push(_),c.push(ca),c.push(ea)),d[3*fa+1]>=e.minHeight&&ka&&va&&(c.push(fa),c.push(_),c.push(ea))}Xa.a.ComputeNormals(d,c,f);var sa=new Xa.a();return sa.indices=c,sa.positions=d,sa.normals=f,sa.uvs=g,sa},xa.a.CreateGround=function(e,b,a,c,d,f){var g={width:b,height:a,subdivisions:c,updatable:f};return Yc.CreateGround(e,g,d)},xa.a.CreateTiledGround=function(e,b,a,c,d,f,g,h,j){var m={xmin:b,zmin:a,xmax:c,zmax:d,subdivisions:f,precision:g,updatable:j};return Yc.CreateTiledGround(e,m,h)},xa.a.CreateGroundFromHeightMap=function(e,b,a,c,d,f,g,h,j,m,w){var z={width:a,height:c,subdivisions:d,minHeight:f,maxHeight:g,updatable:j,onReady:m,alphaFilter:w};return Yc.CreateGroundFromHeightMap(e,b,z,h)};var Yc=function(){function e(){}return e.CreateGround=function(b,a,c){var d=new bf(b,c);return d._setReady(!1),d._subdivisionsX=a.subdivisionsX||a.subdivisions||1,d._subdivisionsY=a.subdivisionsY||a.subdivisions||1,d._width=a.width||1,d._height=a.height||1,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,Xa.a.CreateGround(a).applyToMesh(d,a.updatable),d._setReady(!0),d},e.CreateTiledGround=function(b,a,c){void 0===c&&(c=null);var d=new xa.a(b,c);return Xa.a.CreateTiledGround(a).applyToMesh(d,a.updatable),d},e.CreateGroundFromHeightMap=function(b,a,c,d){void 0===d&&(d=null);var f=c.width||10,g=c.height||10,h=c.subdivisions||1,j=c.minHeight||0,m=c.maxHeight||1,w=c.colorFilter||new G.a(.3,.59,.11),z=c.alphaFilter||0,C=c.updatable,J=c.onReady;d=d||U.a.LastCreatedScene;var K=new bf(b,d);return K._subdivisionsX=h,K._subdivisionsY=h,K._width=f,K._height=g,K._maxX=K._width/2,K._maxZ=K._height/2,K._minX=-K._maxX,K._minZ=-K._maxZ,K._setReady(!1),Qa.b.LoadImage(a,function(N){var T=N.width,Z=N.height,_=af.a.CreateCanvas(T,Z).getContext("2d");if(!_)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!d.isDisposed){_.drawImage(N,0,0);var ca=_.getImageData(0,0,T,Z).data;Xa.a.CreateGroundFromHeightMap({width:f,height:g,subdivisions:h,minHeight:j,maxHeight:m,colorFilter:w,buffer:ca,bufferWidth:T,bufferHeight:Z,alphaFilter:z}).applyToMesh(K,C),J&&J(K),K._setReady(!0)}},function(){},d.offlineProvider),K},e}();Xa.a.CreateTorus=function(e){for(var b=[],a=[],c=[],d=[],f=e.diameter||1,g=e.thickness||.5,h=e.tessellation||16,j=0===e.sideOrientation?0:e.sideOrientation||Xa.a.DEFAULTSIDE,m=h+1,w=0;w<=h;w++)for(var z=w/h,C=w*Math.PI*2/h-Math.PI/2,J=i.a.Translation(f/2,0,0).multiply(i.a.RotationY(C)),K=0;K<=h;K++){var N=1-K/h,T=K*Math.PI*2/h+Math.PI,Z=Math.cos(T),_=Math.sin(T),ca=new i.e(Z,_,0),ea=ca.scale(g/2),fa=new i.d(z,N);ea=i.e.TransformCoordinates(ea,J),ca=i.e.TransformNormal(ca,J),a.push(ea.x,ea.y,ea.z),c.push(ca.x,ca.y,ca.z),d.push(fa.x,fa.y);var ka=(w+1)%m,pa=(K+1)%m;b.push(w*m+K),b.push(w*m+pa),b.push(ka*m+K),b.push(w*m+pa),b.push(ka*m+pa),b.push(ka*m+K)}Xa.a._ComputeSides(j,a,b,c,d,e.frontUVs,e.backUVs);var va=new Xa.a();return va.indices=b,va.positions=a,va.normals=c,va.uvs=d,va},xa.a.CreateTorus=function(e,b,a,c,d,f,g){var h={diameter:b,thickness:a,tessellation:c,sideOrientation:g,updatable:f};return Jd.CreateTorus(e,h,d)};var Tb,Jd=function(){function e(){}return e.CreateTorus=function(b,a,c){var d=new xa.a(b,c);return a.sideOrientation=xa.a._GetDefaultSideOrientation(a.sideOrientation),d._originalBuilderSideOrientation=a.sideOrientation,Xa.a.CreateTorus(a).applyToMesh(d,a.updatable),d},e}(),md=o(59),ni=function(){function e(){}return e.GetDefaults=function(){var b=new e();return b.canvasOptions={antialias:!0,depth:!0,stencil:!1,alpha:!0,multiview:!1,framebufferScaleFactor:1},b.newCanvasCssStyle="position:absolute; bottom:0px;right:0px;z-index:10;width:90%;height:100%;background-color: #000000;",b},e}(),oi=function(){function e(b,a){var c=this;if(void 0===a&&(a=ni.GetDefaults()),this._options=a,this._canvas=null,this.xrLayer=null,this._engine=b.scene.getEngine(),a.canvasElement)this._setManagedOutputCanvas(a.canvasElement);else{var d=document.createElement("canvas");d.style.cssText=this._options.newCanvasCssStyle||"position:absolute; bottom:0px;right:0px;",this._setManagedOutputCanvas(d)}b.onXRSessionInit.add(function(){c._addCanvas()}),b.onXRSessionEnded.add(function(){c._removeCanvas()})}return e.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},e.prototype.initializeXRLayerAsync=function(b){var a=this,c=function(){return new XRWebGLLayer(b,a.canvasContext,a._options.canvasOptions)};return this.canvasContext.makeXRCompatible?this.canvasContext.makeXRCompatible().then(function(){return a.xrLayer=c(),a.xrLayer}):(this.xrLayer=c(),Promise.resolve(this.xrLayer))},e.prototype._addCanvas=function(){this._canvas&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.appendChild(this._canvas)},e.prototype._removeCanvas=function(){this._canvas&&document.body.contains(this._canvas)&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.removeChild(this._canvas)},e.prototype._setManagedOutputCanvas=function(b){this._removeCanvas(),b?(this._canvas=b,this.canvasContext=this._canvas.getContext("webgl2"),this.canvasContext||(this.canvasContext=this._canvas.getContext("webgl"))):(this._canvas=null,this.canvasContext=null)},e}(),pg=function(){function e(b){this.scene=b,this._sessionEnded=!1,this.baseLayer=null,this.currentTimestamp=-1,this.defaultHeightCompensation=1.7,this.onXRFrameObservable=new I.c(),this.onXRReferenceSpaceChanged=new I.c(),this.onXRSessionEnded=new I.c(),this.onXRSessionInit=new I.c()}return Object.defineProperty(e.prototype,"referenceSpace",{get:function(){return this._referenceSpace},set:function(b){this._referenceSpace=b,this.onXRReferenceSpaceChanged.notifyObservers(this._referenceSpace)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._sessionEnded||this.exitXRAsync(),this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear(),this.onXRReferenceSpaceChanged.clear(),this.onXRSessionInit.clear()},e.prototype.exitXRAsync=function(){return this.session&&!this._sessionEnded?this.session.end().catch(function(b){k.a.Warn("could not end XR session. It has ended already.")}):Promise.resolve()},e.prototype.getRenderTargetTextureForEye=function(b){return this._rttProvider.getRenderTargetForEye(b)},e.prototype.getWebXRRenderTarget=function(b){var a=this.scene.getEngine();return this._xrNavigator.xr.native?this._xrNavigator.xr.getWebXRRenderTarget(a):((b=b||{}).canvasElement=a.getRenderingCanvas()||void 0,new oi(this,b))},e.prototype.initializeAsync=function(){return this._xrNavigator=navigator,this._xrNavigator.xr?Promise.resolve():Promise.reject("WebXR not available")},e.prototype.initializeSessionAsync=function(b,a){var c=this;return void 0===b&&(b="immersive-vr"),void 0===a&&(a={}),this._xrNavigator.xr.requestSession(b,a).then(function(d){return c.session=d,c.onXRSessionInit.notifyObservers(d),c._sessionEnded=!1,c.session.addEventListener("end",function(){var f=c.scene.getEngine();c._sessionEnded=!0,c._rttProvider=null,f.framebufferDimensionsObject=null,f.restoreDefaultFramebuffer(),f.customAnimationFrameRequester=null,c.onXRSessionEnded.notifyObservers(null),f._renderLoop()},{once:!0}),c.session})},e.prototype.isSessionSupportedAsync=function(b){return e.IsSessionSupportedAsync(b)},e.prototype.resetReferenceSpace=function(){this.referenceSpace=this.baseReferenceSpace},e.prototype.runXRRenderLoop=function(){var b=this,a=this.scene.getEngine();if(a.customAnimationFrameRequester={requestAnimationFrame:this.session.requestAnimationFrame.bind(this.session),renderFunction:function(d,f){b._sessionEnded||(b.currentFrame=f,b.currentTimestamp=d,f&&(b.onXRFrameObservable.notifyObservers(f),a.framebufferDimensionsObject=b.baseLayer,a._renderLoop(),a.framebufferDimensionsObject=null))}},this._xrNavigator.xr.native)this._rttProvider=this._xrNavigator.xr.getNativeRenderTargetProvider(this.session,this._createRenderTargetTexture.bind(this));else{var c=this._createRenderTargetTexture(this.baseLayer.framebufferWidth,this.baseLayer.framebufferHeight,this.baseLayer.framebuffer);this._rttProvider={getRenderTargetForEye:function(){return c}},a.framebufferDimensionsObject=this.baseLayer}window.cancelAnimationFrame&&window.cancelAnimationFrame(a._frameHandler),a._renderLoop()},e.prototype.setReferenceSpaceTypeAsync=function(b){var a=this;return void 0===b&&(b="local-floor"),this.session.requestReferenceSpace(b).then(function(c){return c},function(c){return k.a.Error("XR.requestReferenceSpace failed for the following reason: "),k.a.Error(c),k.a.Log('Defaulting to universally-supported "viewer" reference space type.'),a.session.requestReferenceSpace("viewer").then(function(d){var f=new XRRigidTransform({x:0,y:-a.defaultHeightCompensation,z:0});return d.getOffsetReferenceSpace(f)},function(d){throw k.a.Error(d),'XR initialization failed: required "viewer" reference space type not supported.'})}).then(function(c){return a.referenceSpace=a.baseReferenceSpace=c,a.session.requestReferenceSpace("viewer").then(function(d){a.viewerReferenceSpace=d}),a.referenceSpace})},e.prototype.updateRenderStateAsync=function(b){return b.baseLayer&&(this.baseLayer=b.baseLayer),this.session.updateRenderState(b)},e.IsSessionSupportedAsync=function(b){if(!navigator.xr)return Promise.resolve(!1);var a=navigator.xr.isSessionSupported||navigator.xr.supportsSession;return a?a.call(navigator.xr,b).then(function(c){var d=void 0===c||c;return Promise.resolve(d)}).catch(function(c){return k.a.Warn(c),Promise.resolve(!1)}):Promise.resolve(!1)},e.prototype._createRenderTargetTexture=function(b,a,c){void 0===c&&(c=null);var d=new mb.a(this.scene.getEngine(),mb.b.Unknown,!0);d.width=b,d.height=a,d._framebuffer=c;var f=new Jb("XR renderTargetTexture",{width:b,height:a},this.scene,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return f._texture=d,f},e}();!function(e){e[e.ENTERING_XR=0]="ENTERING_XR",e[e.EXITING_XR=1]="EXITING_XR",e[e.IN_XR=2]="IN_XR",e[e.NOT_IN_XR=3]="NOT_IN_XR"}(Tb||(Tb={}));var xc,pi=function(){function e(b,a){if(void 0===a&&(a=null),this.scene=b,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=e._idCounter++,a)this._gazeTracker=a.clone("gazeTracker");else{this._gazeTracker=xa.a.CreateTorus("gazeTracker",.0035,.0025,20,b,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var c=new Ab.a("targetMat",b);c.specularColor=G.a.Black(),c.emissiveColor=new G.a(.7,.7,.7),c.backFaceCulling=!1,this._gazeTracker.material=c}}return e.prototype._getForwardRay=function(b){return new Rb.a(i.e.Zero(),new i.e(0,0,b))},e.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},e.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},e.prototype._activatePointer=function(){this._activePointer=!0},e.prototype._deactivatePointer=function(){this._activePointer=!1},e.prototype._updatePointerDistance=function(b){void 0===b&&(b=100)},e.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},e._idCounter=0,e}(),bm=function(e){function b(a,c,d){var f=e.call(this,c,d)||this;f.webVRController=a,f._laserPointer=xa.a.CreateCylinder("laserPointer",1,.004,.0002,20,1,c,!1);var g=new Ab.a("laserPointerMat",c);if(g.emissiveColor=new G.a(.7,.7,.7),g.alpha=.6,f._laserPointer.material=g,f._laserPointer.rotation.x=Math.PI/2,f._laserPointer.position.z=-.5,f._laserPointer.isVisible=!1,f._laserPointer.isPickable=!1,!a.mesh){var h=new xa.a("preloadControllerMesh",c),j=new xa.a(Gd.POINTING_POSE,c);j.rotation.x=-.7,h.addChild(j),a.attachToMesh(h)}return f._setLaserPointerParent(a.mesh),f._meshAttachedObserver=a._meshAttachedObservable.add(function(m){f._setLaserPointerParent(m)}),f}return Object(l.d)(b,e),b.prototype._getForwardRay=function(a){return this.webVRController.getForwardRay(a)},b.prototype._activatePointer=function(){e.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},b.prototype._deactivatePointer=function(){e.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},b.prototype._setLaserPointerColor=function(a){this._laserPointer.material.emissiveColor=a},b.prototype._setLaserPointerLightingDisabled=function(a){this._laserPointer.material.disableLighting=a},b.prototype._setLaserPointerParent=function(a){var c=function(h){h.isPickable=!1,h.getChildMeshes().forEach(function(j){c(j)})};c(a);var d=a.getChildren(void 0,!1),f=a;this.webVRController._pointingPoseNode=null;for(var g=0;g<d.length;g++)if(d[g].name&&d[g].name.indexOf(Gd.POINTING_POSE)>=0){f=d[g],this.webVRController._pointingPoseNode=f;break}this._laserPointer.parent=f},b.prototype._updatePointerDistance=function(a){void 0===a&&(a=100),this._laserPointer.scaling.y=a,this._laserPointer.position.z=-a/2},b.prototype.dispose=function(){e.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},b}(pi),qi=function(e){function b(a,c){var d=e.call(this,c)||this;return d.getCamera=a,d}return Object(l.d)(b,e),b.prototype._getForwardRay=function(a){var c=this.getCamera();return c?c.getForwardRay(a):new Rb.a(i.e.Zero(),i.e.Forward())},b}(pi),cm=function(){},ri=function(){function e(b,a){var c=this;if(void 0===a&&(a={}),this.webVROptions=a,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.enableGazeEvenWhenNoPointerLock=!1,this.exitVROnDoubleTap=!0,this.onEnteringVRObservable=new I.c(),this.onAfterEnteringVRObservable=new I.c(),this.onExitingVRObservable=new I.c(),this.onControllerMeshLoadedObservable=new I.c(),this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._teleportationMode=e.TELEPORTATIONMODE_CONSTANTTIME,this._teleportationTime=122,this._teleportationSpeed=20,this._rotationAllowed=!0,this._teleportBackwardsVector=new i.e(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new i.e(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this._gazeColor=new G.a(.7,.7,.7),this._laserColor=new G.a(.7,.7,.7),this._pickedLaserColor=new G.a(.2,.2,1),this._pickedGazeColor=new G.a(0,0,1),this.onNewMeshSelected=new I.c(),this.onMeshSelectedWithController=new I.c(),this.onNewMeshPicked=new I.c(),this.onBeforeCameraTeleport=new I.c(),this.onAfterCameraTeleport=new I.c(),this.onSelectedMeshUnselected=new I.c(),this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.updateControllerLaserColor=!0,this.requestPointerLockOnFullScreen=!0,this.xrTestDone=!1,this._onResize=function(){c.moveButtonToBottomRight(),c._fullscreenVRpresenting&&c._webVRready&&c.exitVR()},this._onFullscreenChange=function(){var f=document;void 0!==f.fullscreen?c._fullscreenVRpresenting=document.fullscreen:void 0!==f.mozFullScreen?c._fullscreenVRpresenting=f.mozFullScreen:void 0!==f.webkitIsFullScreen?c._fullscreenVRpresenting=f.webkitIsFullScreen:void 0!==f.msIsFullScreen?c._fullscreenVRpresenting=f.msIsFullScreen:void 0!==document.msFullscreenElement&&(c._fullscreenVRpresenting=document.msFullscreenElement),!c._fullscreenVRpresenting&&c._inputElement&&(c.exitVR(),!c._useCustomVRButton&&c._btnVR&&(c._btnVR.style.top=c._inputElement.offsetTop+c._inputElement.offsetHeight-70+"px",c._btnVR.style.left=c._inputElement.offsetLeft+c._inputElement.offsetWidth-100+"px",c.updateButtonVisibility()))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this.beforeRender=function(){c._leftController&&c._leftController._activePointer&&c._castRayAndSelectObject(c._leftController),c._rightController&&c._rightController._activePointer&&c._castRayAndSelectObject(c._rightController),c._noControllerIsActive&&(c._scene.getEngine().isPointerLock||c.enableGazeEvenWhenNoPointerLock)?c._castRayAndSelectObject(c._cameraGazer):c._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(f){if(f.type!==Pb.POSE_ENABLED)f.leftStick&&f.onleftstickchanged(function(j){c._teleportationInitialized&&c.teleportationEnabled&&(!c._leftController&&!c._rightController||c._leftController&&!c._leftController._activePointer&&c._rightController&&!c._rightController._activePointer)&&(c._checkTeleportWithRay(j,c._cameraGazer),c._checkTeleportBackwards(j,c._cameraGazer))}),f.rightStick&&f.onrightstickchanged(function(j){c._teleportationInitialized&&c._checkRotate(j,c._cameraGazer)}),f.type===Pb.XBOX&&(f.onbuttondown(function(j){c._interactionsEnabled&&j===ac.A&&c._cameraGazer._selectionPointerDown()}),f.onbuttonup(function(j){c._interactionsEnabled&&j===ac.A&&c._cameraGazer._selectionPointerUp()}));else{var g=f,h=new bm(g,c._scene,c._cameraGazer._gazeTracker);"right"===g.hand||c._leftController&&c._leftController.webVRController!=g?c._rightController=h:c._leftController=h,c._tryEnableInteractionOnController(h)}},this._tryEnableInteractionOnController=function(f){c._interactionsRequested&&!f._interactionsEnabled&&c._enableInteractionOnController(f),c._teleportationRequested&&!f._teleportationEnabled&&c._enableTeleportationOnController(f)},this._onNewGamepadDisconnected=function(f){f instanceof Xc&&("left"===f.hand&&null!=c._leftController&&(c._leftController.dispose(),c._leftController=null),"right"===f.hand&&null!=c._rightController&&(c._rightController.dispose(),c._rightController=null))},this._workingVector=i.e.Zero(),this._workingQuaternion=i.b.Identity(),this._workingMatrix=i.a.Identity(),this._scene=b,this._inputElement=b.getEngine().getInputElement(),"getVRDisplays"in navigator||(a.useXR=!0),void 0===a.createFallbackVRDeviceOrientationFreeCamera&&(a.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===a.createDeviceOrientationCamera&&(a.createDeviceOrientationCamera=!0),void 0===a.laserToggle&&(a.laserToggle=!0),void 0===a.defaultHeight&&(a.defaultHeight=1.7),a.useCustomVRButton&&(this._useCustomVRButton=!0,a.customVRButton&&(this._btnVR=a.customVRButton)),a.rayLength&&(this._rayLength=a.rayLength),this._defaultHeight=a.defaultHeight,a.positionScale&&(this._rayLength*=a.positionScale,this._defaultHeight*=a.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new i.e(0,this._defaultHeight,0),a.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new Xe("deviceOrientationVRHelper",this._position.clone(),b),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof Uc&&this._scene.activeCamera.rotation)){var d=this._scene.activeCamera;d.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(d.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(i.b.RotationYawPitchRoll(d.rotation.y,d.rotation.x,d.rotation.z)),this._deviceOrientationCamera.rotation=d.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._inputElement&&this._scene.activeCamera.attachControl(this._inputElement)}else this._existingCamera=this._scene.activeCamera;this.webVROptions.useXR&&navigator.xr?pg.IsSessionSupportedAsync("immersive-vr").then(function(f){f?(k.a.Log("Using WebXR. It is recommended to use the WebXRDefaultExperience directly"),b.createDefaultXRExperienceAsync({floorMeshes:a.floorMeshes||[]}).then(function(g){c.xr=g,c.xrTestDone=!0,c._cameraGazer=new qi(function(){return c.xr.baseExperience.camera},b),c.xr.baseExperience.onStateChangedObservable.add(function(h){switch(h){case Tb.ENTERING_XR:c.onEnteringVRObservable.notifyObservers(c),c._interactionsEnabled||c.xr.pointerSelection.detach(),c.xr.pointerSelection.displayLaserPointer=c._displayLaserPointer;break;case Tb.EXITING_XR:c.onExitingVRObservable.notifyObservers(c),c._scene.getEngine().resize();break;case Tb.IN_XR:c._hasEnteredVR=!0;break;case Tb.NOT_IN_XR:c._hasEnteredVR=!1}})})):c.completeVRInit(b,a)}):this.completeVRInit(b,a)}return Object.defineProperty(e.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(b){b&&(b.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(b){b&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=b,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(b){this._displayGaze=b,b||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(b){this._displayLaserPointer=b,b?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vrButton",{get:function(){return this._btnVR},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||null!==this._leftController&&this._leftController._teleportationRequestInitiated||null!==this._rightController&&this._rightController._teleportationRequestInitiated},enumerable:!0,configurable:!0}),e.prototype.completeVRInit=function(b,a){var c=this;if(this.xrTestDone=!0,a.createFallbackVRDeviceOrientationFreeCamera&&(a.useMultiview&&(a.vrDeviceOrientationCameraMetrics||(a.vrDeviceOrientationCameraMetrics=Id.GetDefault()),a.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new Ze("VRDeviceOrientationVRHelper",this._position,this._scene,!0,a.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new $e("WebVRHelper",this._position,this._scene,a),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new qi(function(){return c.currentVRCamera},b),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var d=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";d+=".babylonVRicon.vrdisplaypresenting { display: none; }";var f=document.createElement("style");f.appendChild(document.createTextNode(d)),document.getElementsByTagName("head")[0].appendChild(f),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){c.isInVRMode?c._scene.getEngine().disableVR():c.enterVR()});var g=this._scene.getEngine().getHostWindow();g&&(g.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,a.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(h){h.vrDisplay&&c.displayVRButton()}),this._onKeyDown=function(h){27===h.keyCode&&c.isInVRMode&&c.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(){c._hasEnteredVR&&c.exitVROnDoubleTap&&(c.exitVR(),c._fullscreenVRpresenting&&c._scene.getEngine().exitFullscreen())},lb.a.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(h){return c.onVRDisplayChanged(h)},this._onVrDisplayPresentChange=function(){return c.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){c._webVRrequesting=!0,c.updateButtonVisibility()},this._onVRRequestPresentComplete=function(){c._webVRrequesting=!1,c.updateButtonVisibility()},b.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),b.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),b.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),g.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),b.onDisposeObservable.add(function(){c.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(h){return c._onDefaultMeshLoaded(h)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new gd(),this._circleEase.setEasingMode(Fb.EASINGMODE_EASEINOUT),this._teleportationEasing=this._circleEase,b.onPointerObservable.add(function(h){c._interactionsEnabled&&b.activeCamera===c.vrDeviceOrientationCamera&&"mouse"===h.event.pointerType&&(h.type===lb.a.POINTERDOWN?c._cameraGazer._selectionPointerDown():h.type===lb.a.POINTERUP&&c._cameraGazer._selectionPointerUp())}),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes}))},e.prototype._onDefaultMeshLoaded=function(b){this._leftController&&this._leftController.webVRController==b&&b.mesh&&this._leftController._setLaserPointerParent(b.mesh),this._rightController&&this._rightController.webVRController==b&&b.mesh&&this._rightController._setLaserPointerParent(b.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(b)}catch(a){k.a.Warn("Error in your custom logic onControllerMeshLoaded: "+a)}},Object.defineProperty(e.prototype,"isInVRMode",{get:function(){return this.xr&&this.webVROptions.useXR&&this.xr.baseExperience.state===Tb.IN_XR||this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!0,configurable:!0}),e.prototype.onVrDisplayPresentChange=function(){var b=this._scene.getEngine().getVRDevice();if(b){var a=this._webVRpresenting;this._webVRpresenting=b.isPresenting,a&&!this._webVRpresenting&&this.exitVR()}else k.a.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},e.prototype.onVRDisplayChanged=function(b){this._webVRsupported=b.vrSupported,this._webVRready=!!b.vrDisplay,this._webVRpresenting=b.vrDisplay&&b.vrDisplay.isPresenting,this.updateButtonVisibility()},e.prototype.moveButtonToBottomRight=function(){if(this._inputElement&&!this._useCustomVRButton&&this._btnVR){var b=this._inputElement.getBoundingClientRect();this._btnVR.style.top=b.top+b.height-70+"px",this._btnVR.style.left=b.left+b.width-100+"px"}},e.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||!this._btnVR||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},e.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},e.prototype.enterVR=function(){var b=this;if(this.xr)this.xr.baseExperience.enterXRAsync("immersive-vr","local-floor",this.xr.renderTarget);else{if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(f){k.a.Warn("Error in your custom logic onEnteringVR: "+f)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=i.b.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2000),this.webVRCamera){var a=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,c=i.b.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-a,d=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=i.b.FromEulerAngles(0,d+c,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce(function(f){b.onAfterEnteringVRObservable.notifyObservers({success:f})}),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this.updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce(function(){b.onAfterEnteringVRObservable.notifyObservers({success:!0})})),this._scene.activeCamera&&this._inputElement&&this._scene.activeCamera.attachControl(this._inputElement),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach(function(f){f&&f._activatePointer()}),this._hasEnteredVR=!0)}},e.prototype.exitVR=function(){if(this.xr)this.xr.baseExperience.exitXRAsync();else if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(a){k.a.Warn("Error in your custom logic onExitingVR: "+a)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._inputElement&&this._scene.activeCamera.attachControl(this._inputElement),this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach(function(a){a&&a._deactivatePointer()}),this._hasEnteredVR=!1;var b=this._scene.getEngine();b._onVrDisplayPresentChange&&b._onVrDisplayPresentChange()}},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(b){this._position=b,this._scene.activeCamera&&(this._scene.activeCamera.position=b)},enumerable:!0,configurable:!0}),e.prototype.enableInteractions=function(){var b=this;if(!this._interactionsEnabled){if(this._interactionsRequested=!0,this.xr)return void(this.xr.baseExperience.state===Tb.IN_XR&&this.xr.pointerSelection.attach());this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(a){return a.isVisible&&(a.isPickable||a.name===b._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(a){return!!(b._isTeleportationFloor(a)||-1===a.name.indexOf("gazeTracker")&&-1===a.name.indexOf("teleportationTarget")&&-1===a.name.indexOf("torusTeleportation"))&&b.raySelectionPredicate(a)},this._interactionsEnabled=!0}},Object.defineProperty(e.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!0,configurable:!0}),e.prototype._isTeleportationFloor=function(b){for(var a=0;a<this._floorMeshesCollection.length;a++)if(this._floorMeshesCollection[a].id===b.id)return!0;return!(!this._floorMeshName||b.name!==this._floorMeshName)},e.prototype.addFloorMesh=function(b){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(b)>-1||this._floorMeshesCollection.push(b))},e.prototype.removeFloorMesh=function(b){if(this._floorMeshesCollection){var a=this._floorMeshesCollection.indexOf(b);-1!==a&&this._floorMeshesCollection.splice(a,1)}},e.prototype.enableTeleportation=function(b){var a=this;if(void 0===b&&(b={}),!this._teleportationInitialized){if(this._teleportationRequested=!0,this.enableInteractions(),this.webVROptions.useXR&&(b.floorMeshes||b.floorMeshName)){var c=b.floorMeshes||[];if(!c.length){var d=this._scene.getMeshByName(b.floorMeshName);d&&c.push(d)}if(this.xr)return c.forEach(function(h){a.xr.teleportation.addFloorMesh(h)}),void(this.xr.teleportation.attached||this.xr.teleportation.attach());if(!this.xrTestDone){var f=function(){a.xrTestDone&&(a._scene.unregisterBeforeRender(f),a.xr?a.xr.teleportation.attached||a.xr.teleportation.attach():a.enableTeleportation(b))};return void this._scene.registerBeforeRender(f)}}b.floorMeshName&&(this._floorMeshName=b.floorMeshName),b.floorMeshes&&(this._floorMeshesCollection=b.floorMeshes),b.teleportationMode&&(this._teleportationMode=b.teleportationMode),b.teleportationTime&&b.teleportationTime>0&&(this._teleportationTime=b.teleportationTime),b.teleportationSpeed&&b.teleportationSpeed>0&&(this._teleportationSpeed=b.teleportationSpeed),void 0!==b.easingFunction&&(this._teleportationEasing=b.easingFunction),null!=this._leftController&&this._enableTeleportationOnController(this._leftController),null!=this._rightController&&this._enableTeleportationOnController(this._rightController);var g=new Sb.a();g.vignetteColor=new G.b(0,0,0,0),g.vignetteEnabled=!0,this._postProcessMove=new og("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,g),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},e.prototype._enableInteractionOnController=function(b){var a=this;b.webVRController.mesh&&(b._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&b._activatePointer(),this.webVROptions.laserToggle&&b.webVRController.onMainButtonStateChangedObservable.add(function(c){a._displayLaserPointer&&1===c.value&&(b._activePointer?b._deactivatePointer():b._activatePointer(),a.displayGaze&&(b._gazeTracker.isVisible=b._activePointer))}),b.webVRController.onTriggerStateChangedObservable.add(function(c){var d=b;a._noControllerIsActive&&(d=a._cameraGazer),d._pointerDownOnMeshAsked?c.value<a._padSensibilityDown&&d._selectionPointerUp():c.value>a._padSensibilityUp&&d._selectionPointerDown()}))},e.prototype._checkTeleportWithRay=function(b,a){this._teleportationRequestInitiated&&!a._teleportationRequestInitiated||(a._teleportationRequestInitiated?Math.sqrt(b.y*b.y+b.x*b.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),a._teleportationRequestInitiated=!1):b.y<-this._padSensibilityUp&&a._dpadPressed&&(a._activatePointer(),a._teleportationRequestInitiated=!0))},e.prototype._checkRotate=function(b,a){a._teleportationRequestInitiated||(a._rotationLeftAsked?b.x>-this._padSensibilityDown&&(a._rotationLeftAsked=!1):b.x<-this._padSensibilityUp&&a._dpadPressed&&(a._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),a._rotationRightAsked?b.x<this._padSensibilityDown&&(a._rotationRightAsked=!1):b.x>this._padSensibilityUp&&a._dpadPressed&&(a._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},e.prototype._checkTeleportBackwards=function(b,a){if(!a._teleportationRequestInitiated)if(b.y>this._padSensibilityUp&&a._dpadPressed){if(!a._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var c=i.b.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),d=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(c=this.currentVRCamera.deviceRotationQuaternion,d=this.currentVRCamera.devicePosition),c.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,i.b.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),i.e.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var f=new Rb.a(d,this._workingVector),g=this._scene.pickWithRay(f,this._raySelectionPredicate);g&&g.pickedPoint&&g.pickedMesh&&this._isTeleportationFloor(g.pickedMesh)&&g.distance<5&&this.teleportCamera(g.pickedPoint),a._teleportationBackRequestInitiated=!0}}else a._teleportationBackRequestInitiated=!1},e.prototype._enableTeleportationOnController=function(b){var a=this;b.webVRController.mesh&&(b._interactionsEnabled||this._enableInteractionOnController(b),b._interactionsEnabled=!0,b._teleportationEnabled=!0,b.webVRController.controllerType===wc.VIVE&&(b._dpadPressed=!1,b.webVRController.onPadStateChangedObservable.add(function(c){b._dpadPressed=c.pressed,b._dpadPressed||(b._rotationLeftAsked=!1,b._rotationRightAsked=!1,b._teleportationBackRequestInitiated=!1)})),b.webVRController.onPadValuesChangedObservable.add(function(c){a.teleportationEnabled&&(a._checkTeleportBackwards(c,b),a._checkTeleportWithRay(c,b)),a._checkRotate(c,b)}))},e.prototype._createTeleportationCircles=function(){this._teleportationTarget=xa.a.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var b=new Bc("DynamicTexture",512,this._scene,!0);b.hasAlpha=!0;var a=b.getContext();a.beginPath(),a.arc(256,256,200,0,2*Math.PI,!1),a.fillStyle=this._teleportationFillColor,a.fill(),a.lineWidth=10,a.strokeStyle=this._teleportationBorderColor,a.stroke(),a.closePath(),b.update();var c=new Ab.a("TextPlaneMaterial",this._scene);c.diffuseTexture=b,this._teleportationTarget.material=c;var d=xa.a.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);d.isPickable=!1,d.parent=this._teleportationTarget;var f=new V("animationInnerCircle","position.y",30,V.ANIMATIONTYPE_FLOAT,V.ANIMATIONLOOPMODE_CYCLE),g=[];g.push({frame:0,value:0}),g.push({frame:30,value:.4}),g.push({frame:60,value:0}),f.setKeys(g);var h=new Sf();h.setEasingMode(Fb.EASINGMODE_EASEINOUT),f.setEasingFunction(h),d.animations=[],d.animations.push(f),this._scene.beginAnimation(d,0,60,!0),this._hideTeleportationTarget()},e.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},e.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},e.prototype._rotateCamera=function(b){var a=this;if(this.currentVRCamera instanceof nc){b?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var c=i.b.FromRotationMatrix(i.a.RotationY(Math.PI/4*this._rotationAngle)),d=new V("animationRotation","rotationQuaternion",90,V.ANIMATIONTYPE_QUATERNION,V.ANIMATIONLOOPMODE_CONSTANT),f=[];f.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),f.push({frame:6,value:c}),d.setKeys(f),d.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(d),this._postProcessMove.animations=[];var g=new V("animationPP","vignetteWeight",90,V.ANIMATIONTYPE_FLOAT,V.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:0}),h.push({frame:3,value:4}),h.push({frame:6,value:0}),g.setKeys(h),g.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(g);var j=new V("animationPP2","vignetteStretch",90,V.ANIMATIONTYPE_FLOAT,V.ANIMATIONLOOPMODE_CONSTANT),m=[];m.push({frame:0,value:0}),m.push({frame:3,value:10}),m.push({frame:6,value:0}),j.setKeys(m),j.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(j),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){a._webVRCamera.detachPostProcess(a._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},e.prototype._moveTeleportationSelectorTo=function(b,a,c){if(b.pickedPoint){a._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(b.pickedPoint),this._teleportationTarget.position.copyFrom(b.pickedPoint));var d=this._convertNormalToDirectionOfRay(b.getNormal(!0,!1),c);if(d){var f=i.e.Cross(Ba.a.Y,d),g=i.e.Cross(d,f);i.e.RotationFromAxisToRef(g,d,f,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},e.prototype.teleportCamera=function(b){var a=this;if(this.currentVRCamera instanceof nc){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),b.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(b),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector);var c,d;if(this._teleportationMode==e.TELEPORTATIONMODE_CONSTANTSPEED){d=90;var f=i.e.Distance(this.currentVRCamera.position,this._workingVector);c=this._teleportationSpeed/f}else d=Math.round(90*this._teleportationTime/1000),c=1;this.currentVRCamera.animations=[];var g=new V("animationCameraTeleportation","position",90,V.ANIMATIONTYPE_VECTOR3,V.ANIMATIONLOOPMODE_CONSTANT),h=[{frame:0,value:this.currentVRCamera.position},{frame:d,value:this._workingVector}];g.setKeys(h),g.setEasingFunction(this._teleportationEasing),this.currentVRCamera.animations.push(g),this._postProcessMove.animations=[];var j=Math.round(d/2),m=new V("animationPP","vignetteWeight",90,V.ANIMATIONTYPE_FLOAT,V.ANIMATIONLOOPMODE_CONSTANT),w=[];w.push({frame:0,value:0}),w.push({frame:j,value:8}),w.push({frame:d,value:0}),m.setKeys(w),this._postProcessMove.animations.push(m);var z=new V("animationPP2","vignetteStretch",90,V.ANIMATIONTYPE_FLOAT,V.ANIMATIONLOOPMODE_CONSTANT),C=[];C.push({frame:0,value:0}),C.push({frame:j,value:10}),C.push({frame:d,value:0}),z.setKeys(C),this._postProcessMove.animations.push(z),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,d,!1,c,function(){a._webVRCamera.detachPostProcess(a._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,d,!1,c,function(){a.onAfterCameraTeleport.notifyObservers(a._workingVector)}),this._hideTeleportationTarget()}},e.prototype._convertNormalToDirectionOfRay=function(b,a){return b&&(Math.acos(i.e.Dot(b,a.direction))<Math.PI/2&&b.scaleInPlace(-1)),b},e.prototype._castRayAndSelectObject=function(b){if(this.currentVRCamera instanceof nc){var a=b._getForwardRay(this._rayLength),c=this._scene.pickWithRay(a,this._raySelectionPredicate);if(c&&(b._laserPointer&&(c.originMesh=b._laserPointer.parent),this._scene.simulatePointerMove(c,{pointerId:b._id})),b._currentHit=c,c&&c.pickedPoint){if(this._displayGaze){var d=1;b._gazeTracker.isVisible=!0,b._isActionableMesh&&(d=3),this.updateGazeTrackerScale&&(b._gazeTracker.scaling.x=c.distance*d,b._gazeTracker.scaling.y=c.distance*d,b._gazeTracker.scaling.z=c.distance*d);var f=this._convertNormalToDirectionOfRay(c.getNormal(),a);if(f){var g=i.e.Cross(Ba.a.Y,f),h=i.e.Cross(f,g);i.e.RotationFromAxisToRef(h,f,g,b._gazeTracker.rotation)}b._gazeTracker.position.copyFrom(c.pickedPoint),b._gazeTracker.position.x<0?b._gazeTracker.position.x+=.002:b._gazeTracker.position.x-=.002,b._gazeTracker.position.y<0?b._gazeTracker.position.y+=.002:b._gazeTracker.position.y-=.002,b._gazeTracker.position.z<0?b._gazeTracker.position.z+=.002:b._gazeTracker.position.z-=.002}b._updatePointerDistance(c.distance)}else b._updatePointerDistance(),b._gazeTracker.isVisible=!1;if(c&&c.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(c.pickedMesh)&&c.pickedPoint)return b._currentMeshSelected&&!this._isTeleportationFloor(b._currentMeshSelected)&&this._notifySelectedMeshUnselected(b._currentMeshSelected),b._currentMeshSelected=null,void(b._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(c,b,a));if(c.pickedMesh!==b._currentMeshSelected)if(this.meshSelectionPredicate(c.pickedMesh)){this.onNewMeshPicked.notifyObservers(c),b._currentMeshSelected=c.pickedMesh,c.pickedMesh.isPickable&&c.pickedMesh.actionManager?(this.changeGazeColor(this._pickedGazeColor),this.changeLaserColor(this._pickedLaserColor),b._isActionableMesh=!0):(this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor),b._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(c.pickedMesh);var j=b;j.webVRController&&this.onMeshSelectedWithController.notifyObservers({mesh:c.pickedMesh,controller:j.webVRController})}catch(m){k.a.Warn("Error while raising onNewMeshSelected or onMeshSelectedWithController: "+m)}}else this._notifySelectedMeshUnselected(b._currentMeshSelected),b._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}else this._notifySelectedMeshUnselected(b._currentMeshSelected),b._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}},e.prototype._notifySelectedMeshUnselected=function(b){b&&this.onSelectedMeshUnselected.notifyObservers(b)},e.prototype.setLaserColor=function(b,a){void 0===a&&(a=this._pickedLaserColor),this._laserColor=b,this._pickedLaserColor=a},e.prototype.setLaserLightingState=function(b){void 0===b&&(b=!0),this._leftController&&this._leftController._setLaserPointerLightingDisabled(!b),this._rightController&&this._rightController._setLaserPointerLightingDisabled(!b)},e.prototype.setGazeColor=function(b,a){void 0===a&&(a=this._pickedGazeColor),this._gazeColor=b,this._pickedGazeColor=a},e.prototype.changeLaserColor=function(b){this.updateControllerLaserColor&&(this._leftController&&this._leftController._setLaserPointerColor(b),this._rightController&&this._rightController._setLaserPointerColor(b))},e.prototype.changeGazeColor=function(b){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=b,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=b),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=b))},e.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this.xr&&this.xr.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},e.prototype.getClassName=function(){return"VRExperienceHelper"},e.TELEPORTATIONMODE_CONSTANTTIME=0,e.TELEPORTATIONMODE_CONSTANTSPEED=1,e}(),Kd=o(60),Ld=(xc={root:0,found:!1},function(e,b,a,c){xc.root=0,xc.found=!1;var d=b*b-4*e*a;if(d<0)return xc;var f=Math.sqrt(d),g=(-b-f)/(2*e),h=(-b+f)/(2*e);if(g>h){var j=h;h=g,g=j}return g>0&&g<c?(xc.root=g,xc.found=!0,xc):h>0&&h<c?(xc.root=h,xc.found=!0,xc):xc}),si=function(){function e(){this._collisionPoint=i.e.Zero(),this._planeIntersectionPoint=i.e.Zero(),this._tempVector=i.e.Zero(),this._tempVector2=i.e.Zero(),this._tempVector3=i.e.Zero(),this._tempVector4=i.e.Zero(),this._edge=i.e.Zero(),this._baseToVertex=i.e.Zero(),this._destinationPoint=i.e.Zero(),this._slidePlaneNormal=i.e.Zero(),this._displacementVector=i.e.Zero(),this._radius=i.e.One(),this._retry=0,this._basePointWorld=i.e.Zero(),this._velocityWorld=i.e.Zero(),this._normalizedVelocity=i.e.Zero(),this._collisionMask=-1}return Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(b){this._collisionMask=isNaN(b)?-1:b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),e.prototype._initialize=function(b,a,c){this._velocity=a,i.e.NormalizeToRef(a,this._normalizedVelocity),this._basePoint=b,b.multiplyToRef(this._radius,this._basePointWorld),a.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=c,this.collisionFound=!1},e.prototype._checkPointInTriangle=function(b,a,c,d,f){a.subtractToRef(b,this._tempVector),c.subtractToRef(b,this._tempVector2),i.e.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var g=i.e.Dot(this._tempVector4,f);return!(g<0)&&(d.subtractToRef(b,this._tempVector3),i.e.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((g=i.e.Dot(this._tempVector4,f))<0)&&(i.e.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(g=i.e.Dot(this._tempVector4,f))>=0))},e.prototype._canDoCollision=function(b,a,c,d){var f=i.e.Distance(this._basePointWorld,b),g=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(f>this._velocityWorldLength+g+a)&&!!function(h,j,m,w){return!(h.x>m.x+w||m.x-w>j.x||h.y>m.y+w||m.y-w>j.y||h.z>m.z+w||m.z-w>j.z)}(c,d,this._basePointWorld,this._velocityWorldLength+g)},e.prototype._testTriangle=function(b,a,c,d,f,g,h){var j,m=!1;a||(a=[]),a[b]||(a[b]=new Kd.a(0,0,0,0),a[b].copyFromPoints(c,d,f));var w=a[b];if(g||w.isFrontFacingTo(this._normalizedVelocity,0)){var z=w.signedDistanceTo(this._basePoint),C=i.e.Dot(w.normal,this._velocity);if(0==C){if(Math.abs(z)>=1)return;m=!0,j=0}else{var J=(1-z)/C;if((j=(-1-z)/C)>J){var K=J;J=j,j=K}if(j>1||J<0)return;j<0&&(j=0),j>1&&(j=1)}this._collisionPoint.copyFromFloats(0,0,0);var N=!1,T=1;if(m||(this._basePoint.subtractToRef(w.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(j,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,c,d,f,w.normal)&&(N=!0,T=j,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!N){var Z=this._velocity.lengthSquared(),_=Z;this._basePoint.subtractToRef(c,this._tempVector);var ca=2*i.e.Dot(this._velocity,this._tempVector),ea=this._tempVector.lengthSquared()-1,fa=Ld(_,ca,ea,T);fa.found&&(T=fa.root,N=!0,this._collisionPoint.copyFrom(c)),this._basePoint.subtractToRef(d,this._tempVector),ca=2*i.e.Dot(this._velocity,this._tempVector),ea=this._tempVector.lengthSquared()-1,(fa=Ld(_,ca,ea,T)).found&&(T=fa.root,N=!0,this._collisionPoint.copyFrom(d)),this._basePoint.subtractToRef(f,this._tempVector),ca=2*i.e.Dot(this._velocity,this._tempVector),ea=this._tempVector.lengthSquared()-1,(fa=Ld(_,ca,ea,T)).found&&(T=fa.root,N=!0,this._collisionPoint.copyFrom(f)),d.subtractToRef(c,this._edge),c.subtractToRef(this._basePoint,this._baseToVertex);var ka=this._edge.lengthSquared(),pa=i.e.Dot(this._edge,this._velocity),va=i.e.Dot(this._edge,this._baseToVertex);if(_=ka*-Z+pa*pa,ca=ka*(2*i.e.Dot(this._velocity,this._baseToVertex))-2*pa*va,ea=ka*(1-this._baseToVertex.lengthSquared())+va*va,(fa=Ld(_,ca,ea,T)).found){var sa=(pa*fa.root-va)/ka;sa>=0&&sa<=1&&(T=fa.root,N=!0,this._edge.scaleInPlace(sa),c.addToRef(this._edge,this._collisionPoint))}f.subtractToRef(d,this._edge),d.subtractToRef(this._basePoint,this._baseToVertex),ka=this._edge.lengthSquared(),pa=i.e.Dot(this._edge,this._velocity),va=i.e.Dot(this._edge,this._baseToVertex),_=ka*-Z+pa*pa,ca=ka*(2*i.e.Dot(this._velocity,this._baseToVertex))-2*pa*va,ea=ka*(1-this._baseToVertex.lengthSquared())+va*va,(fa=Ld(_,ca,ea,T)).found&&(sa=(pa*fa.root-va)/ka)>=0&&sa<=1&&(T=fa.root,N=!0,this._edge.scaleInPlace(sa),d.addToRef(this._edge,this._collisionPoint)),c.subtractToRef(f,this._edge),f.subtractToRef(this._basePoint,this._baseToVertex),ka=this._edge.lengthSquared(),pa=i.e.Dot(this._edge,this._velocity),va=i.e.Dot(this._edge,this._baseToVertex),_=ka*-Z+pa*pa,ca=ka*(2*i.e.Dot(this._velocity,this._baseToVertex))-2*pa*va,ea=ka*(1-this._baseToVertex.lengthSquared())+va*va,(fa=Ld(_,ca,ea,T)).found&&(sa=(pa*fa.root-va)/ka)>=0&&sa<=1&&(T=fa.root,N=!0,this._edge.scaleInPlace(sa),f.addToRef(this._edge,this._collisionPoint))}if(N){var la=T*this._velocity.length();(!this.collisionFound||la<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=la,this.collisionFound=!0,this.collidedMesh=h)}}},e.prototype._collide=function(b,a,c,d,f,g,h,j){for(var m=d;m<f;m+=3){var w=a[c[m]-g],z=a[c[m+1]-g],C=a[c[m+2]-g];this._testTriangle(m,b,C,z,w,h,j)}},e.prototype._getResponse=function(b,a){b.addToRef(a,this._destinationPoint),a.scaleInPlace(this._nearestDistance/a.length()),this._basePoint.addToRef(a,b),b.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),b.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(Kd.a.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,a)},e}(),ti=function(){function e(){this._scaledPosition=i.e.Zero(),this._scaledVelocity=i.e.Zero(),this._finalPosition=i.e.Zero()}return e.prototype.getNewPosition=function(b,a,c,d,f,g,h){b.divideToRef(c._radius,this._scaledPosition),a.divideToRef(c._radius,this._scaledVelocity),c.collidedMesh=null,c._retry=0,c._initialVelocity=this._scaledVelocity,c._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,c,d,this._finalPosition,f),this._finalPosition.multiplyInPlace(c._radius),g(h,this._finalPosition,c.collidedMesh)},e.prototype.createCollider=function(){return new si()},e.prototype.init=function(b){this._scene=b},e.prototype._collideWithWorld=function(b,a,c,d,f,g){void 0===g&&(g=null);var h=10*Ha.a.CollisionsEpsilon;if(c._retry>=d)f.copyFrom(b);else{var j=g?g.collisionMask:c.collisionMask;c._initialize(b,a,h);for(var m=0;m<this._scene.meshes.length;m++){var w=this._scene.meshes[m];w.isEnabled()&&w.checkCollisions&&w.subMeshes&&w!==g&&0!=(j&w.collisionGroup)&&w._checkCollision(c)}c.collisionFound?(0===a.x&&0===a.y&&0===a.z||c._getResponse(b,a),a.length()<=h?f.copyFrom(b):(c._retry++,this._collideWithWorld(b,a,c,d,f,g))):b.addToRef(a,f)}},e}();wa.a.CollisionCoordinatorFactory=function(){return new ti()};var nd=o(53),dm=o(105),em=o(133),qg=o(96),Kc=o(44),ui=o(104),vi=function(){function e(b,a,c,d,f,g){this.entries=new Array(),this._boundingVectors=new Array(),this._capacity=c,this._depth=d,this._maxDepth=f,this._creationFunc=g,this._minPoint=b,this._maxPoint=a,this._boundingVectors.push(b.clone()),this._boundingVectors.push(a.clone()),this._boundingVectors.push(b.clone()),this._boundingVectors[2].x=a.x,this._boundingVectors.push(b.clone()),this._boundingVectors[3].y=a.y,this._boundingVectors.push(b.clone()),this._boundingVectors[4].z=a.z,this._boundingVectors.push(a.clone()),this._boundingVectors[5].z=b.z,this._boundingVectors.push(a.clone()),this._boundingVectors[6].x=b.x,this._boundingVectors.push(a.clone()),this._boundingVectors[7].y=b.y}return Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),e.prototype.addEntry=function(b){if(this.blocks)for(var a=0;a<this.blocks.length;a++)this.blocks[a].addEntry(b);else this._creationFunc(b,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},e.prototype.removeEntry=function(b){if(this.blocks)for(var a=0;a<this.blocks.length;a++)this.blocks[a].removeEntry(b);else{var c=this.entries.indexOf(b);c>-1&&this.entries.splice(c,1)}},e.prototype.addEntries=function(b){for(var a=0;a<b.length;a++){var c=b[a];this.addEntry(c)}},e.prototype.select=function(b,a,c){if(qg.a.IsInFrustum(this._boundingVectors,b)){if(this.blocks){for(var d=0;d<this.blocks.length;d++)this.blocks[d].select(b,a,c);return}c?a.concat(this.entries):a.concatWithNoDuplicate(this.entries)}},e.prototype.intersects=function(b,a,c,d){if(qg.a.IntersectsSphere(this._minPoint,this._maxPoint,b,a)){if(this.blocks){for(var f=0;f<this.blocks.length;f++)this.blocks[f].intersects(b,a,c,d);return}d?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}},e.prototype.intersectsRay=function(b,a){if(b.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var c=0;c<this.blocks.length;c++)this.blocks[c].intersectsRay(b,a);return}a.concatWithNoDuplicate(this.entries)}},e.prototype.createInnerBlocks=function(){e._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},e._CreateBlocks=function(b,a,c,d,f,g,h,j){h.blocks=new Array();for(var m=new i.e((a.x-b.x)/2,(a.y-b.y)/2,(a.z-b.z)/2),w=0;w<2;w++)for(var z=0;z<2;z++)for(var C=0;C<2;C++){var J=new e(b.add(m.multiplyByFloats(w,z,C)),b.add(m.multiplyByFloats(w+1,z+1,C+1)),d,f+1,g,j);J.addEntries(c),h.blocks.push(J)}},e}(),se=function(){function e(b,a,c){void 0===c&&(c=2),this.maxDepth=c,this.dynamicContent=new Array(),this._maxBlockCapacity=a||64,this._selectionContent=new Ic.b(1024),this._creationFunc=b}return e.prototype.update=function(b,a,c){vi._CreateBlocks(b,a,c,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},e.prototype.addMesh=function(b){for(var a=0;a<this.blocks.length;a++)this.blocks[a].addEntry(b)},e.prototype.removeMesh=function(b){for(var a=0;a<this.blocks.length;a++)this.blocks[a].removeEntry(b)},e.prototype.select=function(b,a){this._selectionContent.reset();for(var c=0;c<this.blocks.length;c++)this.blocks[c].select(b,this._selectionContent,a);return a?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersects=function(b,a,c){this._selectionContent.reset();for(var d=0;d<this.blocks.length;d++)this.blocks[d].intersects(b,a,this._selectionContent,c);return c?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersectsRay=function(b){this._selectionContent.reset();for(var a=0;a<this.blocks.length;a++)this.blocks[a].intersectsRay(b,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.CreationFuncForMeshes=function(b,a){var c=b.getBoundingInfo();!b.isBlocked&&c.boundingBox.intersectsMinMax(a.minPoint,a.maxPoint)&&a.entries.push(b)},e.CreationFuncForSubMeshes=function(b,a){b.getBoundingInfo().boundingBox.intersectsMinMax(a.minPoint,a.maxPoint)&&a.entries.push(b)},e}();wa.a.prototype.createOrUpdateSelectionOctree=function(e,b){void 0===e&&(e=64),void 0===b&&(b=2);var a=this._getComponent(_a.a.NAME_OCTREE);a||(a=new rg(this),this._addComponent(a)),this._selectionOctree||(this._selectionOctree=new se(se.CreationFuncForMeshes,e,b));var c=this.getWorldExtends();return this._selectionOctree.update(c.min,c.max,this.meshes),this._selectionOctree},Object.defineProperty(wa.a.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),qb.a.prototype.createOrUpdateSubmeshesOctree=function(e,b){void 0===e&&(e=64),void 0===b&&(b=2);var a=this.getScene(),c=a._getComponent(_a.a.NAME_OCTREE);c||(c=new rg(a),a._addComponent(c)),this._submeshesOctree||(this._submeshesOctree=new se(se.CreationFuncForSubMeshes,e,b)),this.computeWorldMatrix(!0);var d=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(d.minimumWorld,d.maximumWorld,this.subMeshes),this._submeshesOctree};var rg=function(){function e(b){this.name=_a.a.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Rb.a(i.e.Zero(),new i.e(1,1,1)),this.scene=b,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return e.prototype.register=function(){var b=this;this.scene.onMeshRemovedObservable.add(function(a){var c=b.scene.selectionOctree;if(null!=c){var d=c.dynamicContent.indexOf(a);-1!==d&&c.dynamicContent.splice(d,1)}}),this.scene.onMeshImportedObservable.add(function(a){var c=b.scene.selectionOctree;null!=c&&c.addMesh(a)})},e.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},e.prototype.getActiveSubMeshCandidates=function(b){return b._submeshesOctree&&b.useOctreeForRenderingSelection?b._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(b)},e.prototype.getIntersectingSubMeshCandidates=function(b,a){return b._submeshesOctree&&b.useOctreeForPicking?(Rb.a.TransformToRef(a,b.getWorldMatrix(),this._tempRay),b._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(b)},e.prototype.getCollidingSubMeshCandidates=function(b,a){if(b._submeshesOctree&&b.useOctreeForCollisions){var c=a._velocityWorldLength+Math.max(a._radius.x,a._radius.y,a._radius.z);return b._submeshesOctree.intersects(a._basePointWorld,c)}return this.scene._getDefaultSubMeshCandidates(b)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e}(),od=o(93),wi=o(150),xi=function(){this._timeElapsedQueryEnded=!1},yi=function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=qb.a.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=qb.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE};Ha.a.prototype.createQuery=function(){return this._gl.createQuery()},Ha.a.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this},Ha.a.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)},Ha.a.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)},Ha.a.prototype.beginOcclusionQuery=function(e,b){var a=this._getGlAlgorithmType(e);return this._gl.beginQuery(a,b),this},Ha.a.prototype.endOcclusionQuery=function(e){var b=this._getGlAlgorithmType(e);return this._gl.endQuery(b),this},Ha.a.prototype._createTimeQuery=function(){var e=this.getCaps().timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()},Ha.a.prototype._deleteTimeQuery=function(e){var b=this.getCaps().timerQuery;b.deleteQueryEXT?b.deleteQueryEXT(e):this.deleteQuery(e)},Ha.a.prototype._getTimeQueryResult=function(e){var b=this.getCaps().timerQuery;return b.getQueryObjectEXT?b.getQueryObjectEXT(e,b.QUERY_RESULT_EXT):this.getQueryResult(e)},Ha.a.prototype._getTimeQueryAvailability=function(e){var b=this.getCaps().timerQuery;return b.getQueryObjectEXT?b.getQueryObjectEXT(e,b.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)},Ha.a.prototype.startTimeQuery=function(){var e=this.getCaps(),b=e.timerQuery;if(!b)return null;var a=new xi();if(this._gl.getParameter(b.GPU_DISJOINT_EXT),e.canUseTimestampForTimerQuery)a._startTimeQuery=this._createTimeQuery(),b.queryCounterEXT(a._startTimeQuery,b.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;a._timeElapsedQuery=this._createTimeQuery(),b.beginQueryEXT?b.beginQueryEXT(b.TIME_ELAPSED_EXT,a._timeElapsedQuery):this._gl.beginQuery(b.TIME_ELAPSED_EXT,a._timeElapsedQuery),this._currentNonTimestampToken=a}return a},Ha.a.prototype.endTimeQuery=function(e){var b=this.getCaps(),a=b.timerQuery;if(!a||!e)return-1;if(b.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return-1;e._endTimeQuery||(e._endTimeQuery=this._createTimeQuery(),a.queryCounterEXT(e._endTimeQuery,a.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return-1;a.endQueryEXT?a.endQueryEXT(a.TIME_ELAPSED_EXT):this._gl.endQuery(a.TIME_ELAPSED_EXT),e._timeElapsedQueryEnded=!0}var c=this._gl.getParameter(a.GPU_DISJOINT_EXT),d=!1;if(e._endTimeQuery?d=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(d=this._getTimeQueryAvailability(e._timeElapsedQuery)),d&&!c){var f=0;if(b.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return-1;var g=this._getTimeQueryResult(e._startTimeQuery);f=this._getTimeQueryResult(e._endTimeQuery)-g,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return-1;f=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return f}return-1},Ha.a.prototype._getGlAlgorithmType=function(e){return e===qb.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(qb.a.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(e){this._occlusionDataStorage.isOcclusionQueryInProgress=e},enumerable:!1,configurable:!0}),Object.defineProperty(qb.a.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new yi()),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(qb.a.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(e){this._occlusionDataStorage.isOccluded=e},enumerable:!0,configurable:!0}),Object.defineProperty(qb.a.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(e){this._occlusionDataStorage.occlusionQueryAlgorithmType=e},enumerable:!0,configurable:!0}),Object.defineProperty(qb.a.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(e){this._occlusionDataStorage.occlusionType=e},enumerable:!0,configurable:!0}),Object.defineProperty(qb.a.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(e){this._occlusionDataStorage.occlusionRetryCount=e},enumerable:!0,configurable:!0}),qb.a.prototype._checkOcclusionQuery=function(){var e=this._occlusionDataStorage;if(e.occlusionType===qb.a.OCCLUSION_TYPE_NONE)return e.isOccluded=!1,!1;var b=this.getEngine();if(b.webGLVersion<2)return e.isOccluded=!1,!1;if(!b.isQueryResultAvailable)return e.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(b.isQueryResultAvailable(this._occlusionQuery)){var a=b.getQueryResult(this._occlusionQuery);e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=1!==a}else{if(e.occlusionInternalRetryCounter++,!(-1!==e.occlusionRetryCount&&e.occlusionInternalRetryCounter>e.occlusionRetryCount))return!1;e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=e.occlusionType!==qb.a.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded}var c=this.getScene();if(c.getBoundingBoxRenderer){var d=c.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=b.createQuery()),b.beginOcclusionQuery(e.occlusionQueryAlgorithmType,this._occlusionQuery),d.renderOcclusionBoundingBox(this),b.endOcclusionQuery(e.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return e.isOccluded},Ha.a.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},Ha.a.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},Ha.a.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},Ha.a.prototype.beginTransformFeedback=function(e){void 0===e&&(e=!0),this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},Ha.a.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Ha.a.prototype.setTranformFeedbackVaryings=function(e,b){this._gl.transformFeedbackVaryings(e,b,this._gl.INTERLEAVED_ATTRIBS)},Ha.a.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e?e.underlyingResource:null)};var fm=function(){};Ha.a.prototype.getInputElement=function(){return this.inputElement||this.getRenderingCanvas()},Ha.a.prototype.registerView=function(e,b){var a=this;this.views||(this.views=[]);for(var c=0,d=this.views;c<d.length;c++){var f=d[c];if(f.target===e)return f}var g=this.getRenderingCanvas();g&&(e.width=g.width,e.height=g.height);var h={target:e,camera:b};return this.views.push(h),b&&b.onDisposeObservable.add(function(){a.unRegisterView(e)}),h},Ha.a.prototype.unRegisterView=function(e){if(!this.views)return this;for(var b=0,a=this.views;b<a.length;b++){var c=a[b];if(c.target===e){var d=this.views.indexOf(c);-1!==d&&this.views.splice(d,1);break}}return this},Ha.a.prototype._renderViews=function(){if(!this.views)return!1;var e=this.getRenderingCanvas();if(!e)return!1;for(var b=0,a=this.views;b<a.length;b++){var c=a[b],d=c.target,f=d.getContext("2d");if(f){var g=c.camera,h=null,j=null;if(g){if((j=g.getScene()).activeCameras.length)continue;this.activeView=c,h=j.activeCamera,j.activeCamera=g}d.width=d.clientWidth,d.height=d.clientHeight,e.width=d.clientWidth,e.height=d.clientHeight,this._renderFrame(),f.drawImage(e,0,0),h&&j&&(j.activeCamera=h)}}return this.activeView=null,!0};var gm=o(130),zi=o(109),Ai=o(85),Cc=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],hm=[function(e){return 1},function(e){return e.y},function(e){return e.z},function(e){return e.x},function(e){return e.x*e.y},function(e){return e.y*e.z},function(e){return 3*e.z*e.z-1},function(e){return e.x*e.z},function(e){return e.x*e.x-e.y*e.y}],Lc=function(e,b){return Cc[e]*hm[e](b)},Mc=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],sg=function(){function e(){this.preScaled=!1,this.l00=i.e.Zero(),this.l1_1=i.e.Zero(),this.l10=i.e.Zero(),this.l11=i.e.Zero(),this.l2_2=i.e.Zero(),this.l2_1=i.e.Zero(),this.l20=i.e.Zero(),this.l21=i.e.Zero(),this.l22=i.e.Zero()}return e.prototype.addLight=function(b,a,c){var d=new i.e(a.r,a.g,a.b).scale(c);this.l00=this.l00.add(d.scale(Lc(0,b))),this.l1_1=this.l1_1.add(d.scale(Lc(1,b))),this.l10=this.l10.add(d.scale(Lc(2,b))),this.l11=this.l11.add(d.scale(Lc(3,b))),this.l2_2=this.l2_2.add(d.scale(Lc(4,b))),this.l2_1=this.l2_1.add(d.scale(Lc(5,b))),this.l20=this.l20.add(d.scale(Lc(6,b))),this.l21=this.l21.add(d.scale(Lc(7,b))),this.l22=this.l22.add(d.scale(Lc(8,b)))},e.prototype.scaleInPlace=function(b){this.l00.scaleInPlace(b),this.l1_1.scaleInPlace(b),this.l10.scaleInPlace(b),this.l11.scaleInPlace(b),this.l2_2.scaleInPlace(b),this.l2_1.scaleInPlace(b),this.l20.scaleInPlace(b),this.l21.scaleInPlace(b),this.l22.scaleInPlace(b)},e.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(Mc[0]),this.l1_1.scaleInPlace(Mc[1]),this.l10.scaleInPlace(Mc[2]),this.l11.scaleInPlace(Mc[3]),this.l2_2.scaleInPlace(Mc[4]),this.l2_1.scaleInPlace(Mc[5]),this.l20.scaleInPlace(Mc[6]),this.l21.scaleInPlace(Mc[7]),this.l22.scaleInPlace(Mc[8])},e.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},e.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(Cc[0]),this.l1_1.scaleInPlace(Cc[1]),this.l10.scaleInPlace(Cc[2]),this.l11.scaleInPlace(Cc[3]),this.l2_2.scaleInPlace(Cc[4]),this.l2_1.scaleInPlace(Cc[5]),this.l20.scaleInPlace(Cc[6]),this.l21.scaleInPlace(Cc[7]),this.l22.scaleInPlace(Cc[8])},e.FromArray=function(b){var a=new e();return i.e.FromArrayToRef(b[0],0,a.l00),i.e.FromArrayToRef(b[1],0,a.l1_1),i.e.FromArrayToRef(b[2],0,a.l10),i.e.FromArrayToRef(b[3],0,a.l11),i.e.FromArrayToRef(b[4],0,a.l2_2),i.e.FromArrayToRef(b[5],0,a.l2_1),i.e.FromArrayToRef(b[6],0,a.l20),i.e.FromArrayToRef(b[7],0,a.l21),i.e.FromArrayToRef(b[8],0,a.l22),a},e.FromPolynomial=function(b){var a=new e();return a.l00=b.xx.scale(.376127).add(b.yy.scale(.376127)).add(b.zz.scale(.376126)),a.l1_1=b.y.scale(.977204),a.l10=b.z.scale(.977204),a.l11=b.x.scale(.977204),a.l2_2=b.xy.scale(1.16538),a.l2_1=b.yz.scale(1.16538),a.l20=b.zz.scale(1.34567).subtract(b.xx.scale(.672834)).subtract(b.yy.scale(.672834)),a.l21=b.zx.scale(1.16538),a.l22=b.xx.scale(1.16538).subtract(b.yy.scale(1.16538)),a.l1_1.scaleInPlace(-1),a.l11.scaleInPlace(-1),a.l2_1.scaleInPlace(-1),a.l21.scaleInPlace(-1),a.scaleInPlace(Math.PI),a},e}(),te=function(){function e(){this.x=i.e.Zero(),this.y=i.e.Zero(),this.z=i.e.Zero(),this.xx=i.e.Zero(),this.yy=i.e.Zero(),this.zz=i.e.Zero(),this.xy=i.e.Zero(),this.yz=i.e.Zero(),this.zx=i.e.Zero()}return Object.defineProperty(e.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=sg.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!0,configurable:!0}),e.prototype.addAmbient=function(b){var a=new i.e(b.r,b.g,b.b);this.xx=this.xx.add(a),this.yy=this.yy.add(a),this.zz=this.zz.add(a)},e.prototype.scaleInPlace=function(b){this.x.scaleInPlace(b),this.y.scaleInPlace(b),this.z.scaleInPlace(b),this.xx.scaleInPlace(b),this.yy.scaleInPlace(b),this.zz.scaleInPlace(b),this.yz.scaleInPlace(b),this.zx.scaleInPlace(b),this.xy.scaleInPlace(b)},e.FromHarmonics=function(b){var a=new e();return a._harmonics=b,a.x=b.l11.scale(1.02333).scale(-1),a.y=b.l1_1.scale(1.02333).scale(-1),a.z=b.l10.scale(1.02333),a.xx=b.l00.scale(.886277).subtract(b.l20.scale(.247708)).add(b.l22.scale(.429043)),a.yy=b.l00.scale(.886277).subtract(b.l20.scale(.247708)).subtract(b.l22.scale(.429043)),a.zz=b.l00.scale(.886277).add(b.l20.scale(.495417)),a.yz=b.l2_1.scale(.858086).scale(-1),a.zx=b.l21.scale(.858086).scale(-1),a.xy=b.l2_2.scale(.858086),a.scaleInPlace(1/Math.PI),a},e.FromArray=function(b){var a=new e();return i.e.FromArrayToRef(b[0],0,a.x),i.e.FromArrayToRef(b[1],0,a.y),i.e.FromArrayToRef(b[2],0,a.z),i.e.FromArrayToRef(b[3],0,a.xx),i.e.FromArrayToRef(b[4],0,a.yy),i.e.FromArrayToRef(b[5],0,a.zz),i.e.FromArrayToRef(b[6],0,a.yz),i.e.FromArrayToRef(b[7],0,a.zx),i.e.FromArrayToRef(b[8],0,a.xy),a},e}(),hc=o(49),Md=function(e,b,a,c){this.name=e,this.worldAxisForNormal=b,this.worldAxisForFileX=a,this.worldAxisForFileY=c},cf=function(){function e(){}return e.ConvertCubeMapTextureToSphericalPolynomial=function(b){if(!b.isCube)return null;var a,c,d=b.getSize().width,f=b.readPixels(0),g=b.readPixels(1);b.isRenderTarget?(a=b.readPixels(3),c=b.readPixels(2)):(a=b.readPixels(2),c=b.readPixels(3));var h=b.readPixels(4),j=b.readPixels(5),m=b.gammaSpace,w=p.a.TEXTUREFORMAT_RGBA,z=p.a.TEXTURETYPE_UNSIGNED_INT;b.textureType!=p.a.TEXTURETYPE_FLOAT&&b.textureType!=p.a.TEXTURETYPE_HALF_FLOAT||(z=p.a.TEXTURETYPE_FLOAT);var C={size:d,right:f,left:g,up:a,down:c,front:h,back:j,format:w,type:z,gammaSpace:m};return this.ConvertCubeMapToSphericalPolynomial(C)},e.ConvertCubeMapToSphericalPolynomial=function(b){for(var a=new sg(),c=0,d=2/b.size,f=d,g=.5*d-1,h=0;h<6;h++)for(var j=this.FileFaces[h],m=b[j.name],w=g,z=b.format===p.a.TEXTUREFORMAT_RGBA?4:3,C=0;C<b.size;C++){for(var J=g,K=0;K<b.size;K++){var N=j.worldAxisForFileX.scale(J).add(j.worldAxisForFileY.scale(w)).add(j.worldAxisForNormal);N.normalize();var T=Math.pow(1+J*J+w*w,-1.5),Z=m[C*b.size*z+K*z+0],_=m[C*b.size*z+K*z+1],ca=m[C*b.size*z+K*z+2];isNaN(Z)&&(Z=0),isNaN(_)&&(_=0),isNaN(ca)&&(ca=0),b.type===p.a.TEXTURETYPE_UNSIGNED_INT&&(Z/=255,_/=255,ca/=255),b.gammaSpace&&(Z=Math.pow(aa.a.Clamp(Z),kb.c),_=Math.pow(aa.a.Clamp(_),kb.c),ca=Math.pow(aa.a.Clamp(ca),kb.c)),Z=aa.a.Clamp(Z,0,4096),_=aa.a.Clamp(_,0,4096),ca=aa.a.Clamp(ca,0,4096);var ea=new G.a(Z,_,ca);a.addLight(N,ea,T),c+=T,J+=d}w+=f}var fa=6*(4*Math.PI)/6/c;return a.scaleInPlace(fa),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),te.FromHarmonics(a)},e.FileFaces=[new Md("right",new i.e(1,0,0),new i.e(0,0,-1),new i.e(0,-1,0)),new Md("left",new i.e(-1,0,0),new i.e(0,0,1),new i.e(0,-1,0)),new Md("up",new i.e(0,1,0),new i.e(1,0,0),new i.e(0,0,1)),new Md("down",new i.e(0,-1,0),new i.e(1,0,0),new i.e(0,0,-1)),new Md("front",new i.e(0,0,1),new i.e(1,0,0),new i.e(0,-1,0)),new Md("back",new i.e(0,0,-1),new i.e(-1,0,0),new i.e(0,-1,0))],e}();Object.defineProperty(hc.a.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial)return this._texture._sphericalPolynomial;this._texture.isReady&&(this._texture._sphericalPolynomial=cf.ConvertCubeMapTextureToSphericalPolynomial(this))}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0});var im=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void)
{
gl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);
}`;Pa.a.ShadersStore.rgbdEncodePixelShader=im;var jm=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void)
{
gl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);
}`;Pa.a.ShadersStore.rgbdDecodePixelShader=jm;var yc,zc,Nc=function(){function e(){}return e.GetEnvInfo=function(b){for(var a=new DataView(b.buffer,b.byteOffset,b.byteLength),c=0,d=0;d<e._MagicBytes.length;d++)if(a.getUint8(c++)!==e._MagicBytes[d])return k.a.Error("Not a babylon environment map"),null;for(var f="",g=0;g=a.getUint8(c++);)f+=String.fromCharCode(g);var h=JSON.parse(f);return h.specular&&(h.specular.specularDataPosition=c,h.specular.lodGenerationScale=h.specular.lodGenerationScale||.8),h},e.CreateEnvTextureAsync=function(b){var a=this,c=b.getInternalTexture();if(!c)return Promise.reject("The cube texture is invalid.");if(!b._prefiltered)return Promise.reject("The cube texture is invalid (not prefiltered).");var d=c.getEngine();if(d&&d.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(b.textureType===p.a.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var f=d.getRenderingCanvas();if(!f)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var g=p.a.TEXTURETYPE_FLOAT;if(!d.getCaps().textureFloatRender&&(g=p.a.TEXTURETYPE_HALF_FLOAT,!d.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var h=c.width,j=new wa.a(d),m={},w=[],z=aa.a.Log2(c.width);z=Math.round(z);for(var C=function(K){for(var N=Math.pow(2,z-K),T=function(_){var ca=b.readPixels(_,K),ea=d.createRawTexture(ca,N,N,p.a.TEXTUREFORMAT_RGBA,!1,!1,p.a.TEXTURE_NEAREST_SAMPLINGMODE,null,g),fa=new Promise(function(ka,pa){var va=new gb("rgbdEncode","rgbdEncode",null,null,1,null,p.a.TEXTURE_NEAREST_SAMPLINGMODE,d,!1,void 0,p.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);va.getEffect().executeWhenCompiled(function(){va.onApply=function(ta){ta._bindTexture("textureSampler",ea)};var sa=d.getRenderWidth(),la=d.getRenderHeight();d.setSize(N,N),j.postProcessManager.directRender([va],null),Qa.b.ToBlob(f,function(ta){var Da=new FileReader();Da.onload=function(ua){var Aa=ua.target.result;m[6*K+_]=Aa,ka()},Da.readAsArrayBuffer(ta)}),d.setSize(sa,la)})});w.push(fa)},Z=0;Z<6;Z++)T(Z)},J=0;J<=z;J++)C(J);return Promise.all(w).then(function(){j.dispose();for(var K={version:1,width:h,irradiance:a._CreateEnvTextureIrradiance(b),specular:{mipmaps:[],lodGenerationScale:b.lodGenerationScale}},N=0,T=0;T<=z;T++)for(var Z=0;Z<6;Z++){var _=m[6*T+Z].byteLength;K.specular.mipmaps.push({length:_,position:N}),N+=_}for(var ca=JSON.stringify(K),ea=new ArrayBuffer(ca.length+1),fa=new Uint8Array(ea),ka=(T=0,ca.length);T<ka;T++)fa[T]=ca.charCodeAt(T);fa[ca.length]=0;var pa=e._MagicBytes.length+N+ea.byteLength,va=new ArrayBuffer(pa),sa=new Uint8Array(va),la=new DataView(va),ta=0;for(T=0;T<e._MagicBytes.length;T++)la.setUint8(ta++,e._MagicBytes[T]);for(sa.set(new Uint8Array(ea),ta),ta+=ea.byteLength,T=0;T<=z;T++)for(Z=0;Z<6;Z++){var Da=m[6*T+Z];sa.set(new Uint8Array(Da),ta),ta+=Da.byteLength}return va})},e._CreateEnvTextureIrradiance=function(b){var a=b.sphericalPolynomial;return null==a?null:{x:[a.x.x,a.x.y,a.x.z],y:[a.y.x,a.y.y,a.y.z],z:[a.z.x,a.z.y,a.z.z],xx:[a.xx.x,a.xx.y,a.xx.z],yy:[a.yy.x,a.yy.y,a.yy.z],zz:[a.zz.x,a.zz.y,a.zz.z],yz:[a.yz.x,a.yz.y,a.yz.z],zx:[a.zx.x,a.zx.y,a.zx.z],xy:[a.xy.x,a.xy.y,a.xy.z]}},e.CreateImageDataArrayBufferViews=function(b,a){if(1!==a.version)throw new Error('Unsupported babylon environment map version "'+a.version+'"');var c=a.specular,d=aa.a.Log2(a.width);if(d=Math.round(d)+1,c.mipmaps.length!==6*d)throw new Error('Unsupported specular mipmaps number "'+c.mipmaps.length+'"');for(var f=new Array(d),g=0;g<d;g++){f[g]=new Array(6);for(var h=0;h<6;h++){var j=c.mipmaps[6*g+h];f[g][h]=new Uint8Array(b.buffer,b.byteOffset+c.specularDataPosition+j.position,j.length)}}return f},e.UploadEnvLevelsAsync=function(b,a,c){if(1!==c.version)throw new Error('Unsupported babylon environment map version "'+c.version+'"');var d=c.specular;if(!d)return Promise.resolve();b._lodGenerationScale=d.lodGenerationScale;var f=e.CreateImageDataArrayBufferViews(a,c);return e.UploadLevelsAsync(b,f)},e._OnImageReadyAsync=function(b,a,c,d,f,g,h,j,m,w,z){return new Promise(function(C,J){if(c){var K=a.createTexture(null,!0,!0,null,p.a.TEXTURE_NEAREST_SAMPLINGMODE,null,function(T){J(T)},b);d.getEffect().executeWhenCompiled(function(){d.onApply=function(T){T._bindTexture("textureSampler",K),T.setFloat2("scale",1,1)},a.scenes[0].postProcessManager.directRender([d],w,!0,g,h),a.restoreDefaultFramebuffer(),K.dispose(),URL.revokeObjectURL(f),C()})}else{if(a._uploadImageToTexture(z,b,g,h),j){var N=m[h];N&&a._uploadImageToTexture(N._texture,b,g,0)}C()}})},e.UploadLevelsAsync=function(b,a){var c=this;if(!Qa.b.IsExponentOfTwo(b.width))throw new Error("Texture size must be a power of two");var d=Math.round(aa.a.Log2(b.width))+1,f=b.getEngine(),g=!1,h=!1,j=null,m=null,w=null,z=f.getCaps();if(b.format=p.a.TEXTUREFORMAT_RGBA,b.type=p.a.TEXTURETYPE_UNSIGNED_INT,b.generateMipMaps=!0,b._cachedAnisotropicFilteringLevel=null,f.updateTextureSamplingMode(p.a.TEXTURE_TRILINEAR_SAMPLINGMODE,b),z.textureLOD?f.webGLVersion<2?g=!1:z.textureHalfFloatRender&&z.textureHalfFloatLinearFiltering?(g=!0,b.type=p.a.TEXTURETYPE_HALF_FLOAT):z.textureFloatRender&&z.textureFloatLinearFiltering&&(g=!0,b.type=p.a.TEXTURETYPE_FLOAT):(g=!1,h=!0,w={}),g)j=new gb("rgbdDecode","rgbdDecode",null,null,1,null,p.a.TEXTURE_TRILINEAR_SAMPLINGMODE,f,!1,void 0,b.type,void 0,null,!1),b._isRGBD=!1,b.invertY=!1,m=f.createRenderTargetCubeTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:p.a.TEXTURE_TRILINEAR_SAMPLINGMODE,type:b.type,format:p.a.TEXTUREFORMAT_RGBA});else if(b._isRGBD=!0,b.invertY=!0,h)for(var C=b._lodGenerationScale,J=b._lodGenerationOffset,K=0;K<3;K++){var N=(d-1)*C+J,T=J+(N-J)*(1-K/2),Z=Math.round(Math.min(Math.max(T,0),N)),_=new mb.a(f,mb.b.Temp);_.isCube=!0,_.invertY=!0,_.generateMipMaps=!1,f.updateTextureSamplingMode(p.a.TEXTURE_LINEAR_LINEAR,_);var ca=new hc.a(null);switch(ca.isCube=!0,ca._texture=_,w[Z]=ca,K){case 0:b._lodTextureLow=ca;break;case 1:b._lodTextureMid=ca;break;case 2:b._lodTextureHigh=ca}}var ea=[],fa=function(la){for(var ta=function(ua){var Aa=a[la][ua],za=new Blob([Aa],{type:"image/png"}),Fa=URL.createObjectURL(za),La;if("undefined"==typeof Image)La=createImageBitmap(za).then(function(bb){return c._OnImageReadyAsync(bb,f,g,j,Fa,ua,la,h,w,m,b)});else{var Ta=new Image();Ta.src=Fa,La=new Promise(function(bb,Ra){Ta.onload=function(){c._OnImageReadyAsync(Ta,f,g,j,Fa,ua,la,h,w,m,b).then(function(){return bb()}).catch(function(Oa){Ra(Oa)})},Ta.onerror=function(Oa){Ra(Oa)}})}ea.push(La)},Da=0;Da<6;Da++)ta(Da)};for(K=0;K<a.length;K++)fa(K);if(a.length<d){var ka,pa=Math.pow(2,d-1-a.length),va=pa*pa*4;switch(b.type){case p.a.TEXTURETYPE_UNSIGNED_INT:ka=new Uint8Array(va);break;case p.a.TEXTURETYPE_HALF_FLOAT:ka=new Uint16Array(va);break;case p.a.TEXTURETYPE_FLOAT:ka=new Float32Array(va)}for(K=a.length;K<d;K++)for(var sa=0;sa<6;sa++)f._uploadArrayBufferViewToTexture(b,ka,sa,K)}return Promise.all(ea).then(function(){m&&(f._releaseFramebufferObjects(m),f._releaseTexture(b),m._swapAndDie(b)),j&&j.dispose(),h&&(b._lodTextureHigh&&b._lodTextureHigh._texture&&(b._lodTextureHigh._texture.isReady=!0),b._lodTextureMid&&b._lodTextureMid._texture&&(b._lodTextureMid._texture.isReady=!0),b._lodTextureLow&&b._lodTextureLow._texture&&(b._lodTextureLow._texture.isReady=!0))})},e.UploadEnvSpherical=function(b,a){1!==a.version&&k.a.Warn('Unsupported babylon environment map version "'+a.version+'"');var c=a.irradiance;if(c){var d=new te();i.e.FromArrayToRef(c.x,0,d.x),i.e.FromArrayToRef(c.y,0,d.y),i.e.FromArrayToRef(c.z,0,d.z),i.e.FromArrayToRef(c.xx,0,d.xx),i.e.FromArrayToRef(c.yy,0,d.yy),i.e.FromArrayToRef(c.zz,0,d.zz),i.e.FromArrayToRef(c.yz,0,d.yz),i.e.FromArrayToRef(c.zx,0,d.zx),i.e.FromArrayToRef(c.xy,0,d.xy),b._sphericalPolynomial=d}},e._UpdateRGBDAsync=function(b,a,c,d,f){return b._source=mb.b.CubeRawRGBD,b._bufferViewArrayArray=a,b._lodGenerationScale=d,b._lodGenerationOffset=f,b._sphericalPolynomial=c,e.UploadLevelsAsync(b,a).then(function(){b.isReady=!0})},e._MagicBytes=[134,22,135,150,246,214,150,54],e}();mb.a._UpdateRGBDAsync=Nc._UpdateRGBDAsync;var Oc,km=((yc={})[ra.b.PositionKind]=0,yc[ra.b.NormalKind]=1,yc[ra.b.TangentKind]=2,yc[ra.b.UVKind]=10,yc[ra.b.UV2Kind]=11,yc[ra.b.UV3Kind]=12,yc[ra.b.UV4Kind]=13,yc[ra.b.ColorKind]=4,yc[ra.b.MatricesIndicesKind]=8,yc[ra.b.MatricesWeightsKind]=9,yc),lm=((zc={})[ra.b.PositionKind]="a_position",zc[ra.b.NormalKind]="a_normal",zc[ra.b.TangentKind]="a_tangent",zc[ra.b.UVKind]="a_texcoord0",zc[ra.b.UV2Kind]="a_texcoord1",zc[ra.b.UV3Kind]="a_texcoord2",zc[ra.b.UV4Kind]="a_texcoord3",zc[ra.b.ColorKind]="a_color0",zc[ra.b.MatricesIndicesKind]="a_indices",zc[ra.b.MatricesWeightsKind]="a_weight",zc),mm=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.lineProcessor=function(a){for(var c=0,d=this._replacements;c<d.length;c++){var f=d[c];a=a.replace(f.searchValue,f.replaceValue)}return a},b.prototype.attributeProcessor=function(a){var c=a.match(/attribute\s+[^\s]+\s+([^\s]+)\s*(?:\[.+\])?\s*;/)[1],d=km[c];if(void 0===d&&(d=this._genericAttributeLocation++)>17)throw new Error("Exceeded maximum custom attributes");var f=lm[c];if(void 0===f)throw new Error("Can't find bgfx name mapping");return a=a.replace(c,f),this._replacements.push({searchValue:new RegExp("\\b"+c+"\\b","g"),replaceValue:""+f}),"layout(location="+d+") "+e.prototype.attributeProcessor.call(this,a)},b.prototype.varyingProcessor=function(a,c){var d;return c?d=this._varyingLocationMap[a]:(d=this._varyingLocationCount++,this._varyingLocationMap[a]=d),"layout(location="+d+") "+e.prototype.varyingProcessor.call(this,a,c)},b.prototype.uniformProcessor=function(a){var c=a.match(/uniform\s+([^\s]+)\s+([^\s]+)\s*(?:\[.+\])?\s*;/),d=c[1],f=c[2];switch(d){case"sampler2D":case"samplerCube":var g=d.substr(7),h=this._textureCount++;return this._replacements.push({searchValue:new RegExp("\\b"+f+"\\b"),replaceValue:"sampler"+g+"("+f+"Texture, "+f+")"}),"layout(binding="+h+") uniform texture"+g+" "+f+`Texture;
layout(binding=`+h+") uniform sampler "+f+";";case"float":this._replacements.push({searchValue:new RegExp("\\b"+f+"\\b"),replaceValue:f+".x"}),a="uniform vec4 "+f+";";break;case"vec2":this._replacements.push({searchValue:new RegExp("\\b"+f+"\\b"),replaceValue:f+".xy"}),a="uniform vec4 "+f+";";break;case"vec3":this._replacements.push({searchValue:new RegExp("\\b"+f+"\\b"),replaceValue:f+".xyz"}),a="uniform vec4 "+f+";"}return this._uniforms.push(a),1===this._uniforms.length?"<UNIFORM>":""},b.prototype.preProcessor=function(a,c,d){return this._genericAttributeLocation=10,d||(this._varyingLocationCount=0,this._varyingLocationMap={}),this._replacements=[],this._textureCount=0,this._uniforms=[],a},b.prototype.postProcessor=function(a,c,d){return a=(a=(a=e.prototype.postProcessor.call(this,a,c,d)).replace("<UNIFORM>",`layout(binding=0) uniform Frame {
`+this._uniforms.join(`
`)+`
};`)).replace("out vec4 glFragColor","layout(location=0) out vec4 glFragColor")},b}(zi.a),nm=function(){function e(){this.isAsync=!1,this.isReady=!1}return e.prototype._handlesSpectorRebuildCallback=function(b){throw new Error("Not implemented")},e}(),Bi=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b}(Ai.a),Ac=function(){function e(){}return e.POINT=0,e.MINPOINT_MAGPOINT_MIPPOINT=e.POINT,e.BILINEAR=1,e.MINLINEAR_MAGLINEAR_MIPPOINT=e.BILINEAR,e.TRILINEAR=2,e.MINLINEAR_MAGLINEAR_MIPLINEAR=e.TRILINEAR,e.ANISOTROPIC=3,e.POINT_COMPARE=4,e.TRILINEAR_COMPARE=5,e.MINBILINEAR_MAGPOINT=6,e.MINLINEAR_MAGPOINT_MIPLINEAR=e.MINBILINEAR_MAGPOINT,e.MINPOINT_MAGPOINT_MIPLINEAR=7,e.MINPOINT_MAGLINEAR_MIPPOINT=8,e.MINPOINT_MAGLINEAR_MIPLINEAR=9,e.MINLINEAR_MAGPOINT_MIPPOINT=10,e}(),tg=function(){function e(){}return e.CLEAR_COLOR=1,e.CLEAR_DEPTH=2,e.CLEAR_STENCIL=4,e}(),ug=function(){function e(){}return e.WRAP=0,e.MIRROR=1,e.CLAMP=2,e.BORDER=3,e.MIRROR_ONCE=4,e}(),Ci=function(){function e(){}return e.RGBA8=0,e.RGBA32F=1,e}(),om=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.getInternalTexture=function(){return this},b.prototype.getViewCount=function(){return 1},b}(mb.a),pm=function(e){function b(){var a=e.call(this,null)||this;return a._native=new _native.Engine(),a.INVALID_HANDLE=65535,a._webGLVersion=2,a.disableUniformBuffers=!0,a._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!0,astc:null,pvrtc:null,etc1:null,etc2:null,maxAnisotropy:16,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!0,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!0,instancedArrays:!1,canUseTimestampForTimerQuery:!1,blendMinMax:!1,maxMSAASamples:1},Qa.b.Log("Babylon Native (v"+Ha.a.Version+") launched"),"undefined"==typeof URL&&(window.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(window.Blob=function(){}),a._shaderProcessor=new mm(),a}return Object(l.d)(b,e),b.prototype.getHardwareScalingLevel=function(){return 1},b.prototype._queueNewFrame=function(a,c){return c.requestAnimationFrame?c.requestAnimationFrame(a):this._native.requestAnimationFrame(a),0},b.prototype._bindUnboundFramebuffer=function(a){this._currentFramebuffer!==a&&(this._currentFramebuffer&&this._native.unbindFramebuffer(this._currentFramebuffer),a&&this._native.bindFramebuffer(a),this._currentFramebuffer=a)},b.prototype.getHostDocument=function(){return null},b.prototype.clear=function(a,c,d,f){void 0===f&&(f=!1);var g=0;c&&a&&(this._native.clearColor(a.r,a.g,a.b,void 0!==a.a?a.a:1),g|=tg.CLEAR_COLOR),d&&(this._native.clearDepth(1),g|=tg.CLEAR_DEPTH),f&&(this._native.clearStencil(0),g|=tg.CLEAR_STENCIL),this._native.clear(g)},b.prototype.createIndexBuffer=function(a){var c=this._normalizeIndexData(a),d=new Bi();if(d.references=1,d.is32Bits=4===c.BYTES_PER_ELEMENT,d.nativeIndexBuffer=this._native.createIndexBuffer(c),d.nativeVertexBuffer===this.INVALID_HANDLE)throw new Error("Could not create a native index buffer.");return d},b.prototype.createVertexBuffer=function(a){var c=new Bi();if(c.references=1,c.nativeVertexBuffer=this._native.createVertexBuffer(ArrayBuffer.isView(a)?a:new Float32Array(a)),c.nativeVertexBuffer===this.INVALID_HANDLE)throw new Error("Could not create a native vertex buffer.");return c},b.prototype.recordVertexArrayObject=function(a,c,d){var f=this._native.createVertexArray();c&&this._native.recordIndexBuffer(f,c.nativeIndexBuffer);for(var g=d.getAttributesNames(),h=0;h<g.length;h++){var j=d.getAttributeLocation(h);if(j>=0){var m=a[g[h]];if(m){var w=m.getBuffer();w&&this._native.recordVertexBuffer(f,w.nativeVertexBuffer,j,m.byteOffset,m.byteStride,m.getSize(),m.type,m.normalized)}}}return f},b.prototype.bindVertexArrayObject=function(a){this._native.bindVertexArray(a)},b.prototype.releaseVertexArrayObject=function(a){this._native.deleteVertexArray(a)},b.prototype.getAttributes=function(a,c){var d=a;return this._native.getAttributes(d.nativeProgram,c)},b.prototype.drawElementsType=function(a,c,d,f){this._drawCalls.addCount(1,!1),this._native.drawIndexed(a,c,d)},b.prototype.drawArraysType=function(a,c,d,f){this._drawCalls.addCount(1,!1),this._native.draw(a,c,d)},b.prototype.createPipelineContext=function(){return new nm()},b.prototype._preparePipelineContext=function(a,c,d,f,g,h,j){var m=a;m.nativeProgram=f?this.createRawShaderProgram(a,c,d,void 0,j):this.createShaderProgram(a,c,d,h,void 0,j)},b.prototype._isRenderingStateCompiled=function(a){return!0},b.prototype._executeWhenRenderingStateIsCompiled=function(a,c){c()},b.prototype.createRawShaderProgram=function(a,c,d,f,g){throw void 0===g&&(g=null),new Error("Not Supported")},b.prototype.createShaderProgram=function(a,c,d,f,g,h){void 0===h&&(h=null),this.onBeforeShaderCompilationObservable.notifyObservers(this);var j=this._native.createProgram(Cb.a._ConcatenateShader(c,f),Cb.a._ConcatenateShader(d,f));return this.onAfterShaderCompilationObservable.notifyObservers(this),j},b.prototype._setProgram=function(a){this._currentProgram!==a&&(this._native.setProgram(a),this._currentProgram=a)},b.prototype._releaseEffect=function(a){},b.prototype._deletePipelineContext=function(a){},b.prototype.getUniforms=function(a,c){var d=a;return this._native.getUniforms(d.nativeProgram,c)},b.prototype.bindUniformBlock=function(a,c,d){throw new Error("Not Implemented")},b.prototype.bindSamplers=function(a){var c=a.getPipelineContext();this._setProgram(c.nativeProgram);for(var d=a.getSamplers(),f=0;f<d.length;f++){var g=a.getUniform(d[f]);g&&(this._boundUniforms[f]=g)}this._currentEffect=null},b.prototype.setMatrix=function(a,c){a&&this._native.setMatrix(a,c.toArray())},b.prototype.getRenderWidth=function(a){return void 0===a&&(a=!1),!a&&this._currentRenderTarget?this._currentRenderTarget.width:this._native.getRenderWidth()},b.prototype.getRenderHeight=function(a){return void 0===a&&(a=!1),!a&&this._currentRenderTarget?this._currentRenderTarget.height:this._native.getRenderHeight()},b.prototype.setViewport=function(a,c,d){this._cachedViewport=a,this._native.setViewPort(a.x,a.y,a.width,a.height)},b.prototype.setState=function(a,c,d,f){void 0===c&&(c=0),void 0===f&&(f=!1),this._native.setState(a,c,f)},b.prototype.setZOffset=function(a){this._native.setZOffset(a)},b.prototype.getZOffset=function(){return this._native.getZOffset()},b.prototype.setDepthBuffer=function(a){this._native.setDepthTest(a)},b.prototype.getDepthWrite=function(){return this._native.getDepthWrite()},b.prototype.setDepthWrite=function(a){this._native.setDepthWrite(a)},b.prototype.setColorWrite=function(a){this._native.setColorWrite(a),this._colorWrite=a},b.prototype.getColorWrite=function(){return this._colorWrite},b.prototype.setAlphaConstants=function(a,c,d,f){throw new Error("Setting alpha blend constant color not yet implemented.")},b.prototype.setAlphaMode=function(a,c){void 0===c&&(c=!1),this._alphaMode!==a&&(this._native.setBlendMode(a),c||this.setDepthWrite(a===p.a.ALPHA_DISABLE),this._alphaMode=a)},b.prototype.getAlphaMode=function(){return this._alphaMode},b.prototype.setInt=function(a,c){a&&this._native.setInt(a,c)},b.prototype.setIntArray=function(a,c){a&&this._native.setIntArray(a,c)},b.prototype.setIntArray2=function(a,c){a&&this._native.setIntArray2(a,c)},b.prototype.setIntArray3=function(a,c){a&&this._native.setIntArray3(a,c)},b.prototype.setIntArray4=function(a,c){a&&this._native.setIntArray4(a,c)},b.prototype.setFloatArray=function(a,c){a&&this._native.setFloatArray(a,c)},b.prototype.setFloatArray2=function(a,c){a&&this._native.setFloatArray2(a,c)},b.prototype.setFloatArray3=function(a,c){a&&this._native.setFloatArray3(a,c)},b.prototype.setFloatArray4=function(a,c){a&&this._native.setFloatArray4(a,c)},b.prototype.setArray=function(a,c){a&&this._native.setFloatArray(a,c)},b.prototype.setArray2=function(a,c){a&&this._native.setFloatArray2(a,c)},b.prototype.setArray3=function(a,c){a&&this._native.setFloatArray3(a,c)},b.prototype.setArray4=function(a,c){a&&this._native.setFloatArray4(a,c)},b.prototype.setMatrices=function(a,c){a&&this._native.setMatrices(a,c)},b.prototype.setMatrix3x3=function(a,c){a&&this._native.setMatrix3x3(a,c)},b.prototype.setMatrix2x2=function(a,c){a&&this._native.setMatrix2x2(a,c)},b.prototype.setFloat=function(a,c){a&&this._native.setFloat(a,c)},b.prototype.setFloat2=function(a,c,d){a&&this._native.setFloat2(a,c,d)},b.prototype.setFloat3=function(a,c,d,f){a&&this._native.setFloat3(a,c,d,f)},b.prototype.setFloat4=function(a,c,d,f,g){a&&this._native.setFloat4(a,c,d,f,g)},b.prototype.setColor3=function(a,c){a&&this._native.setFloat3(a,c.r,c.g,c.b)},b.prototype.setColor4=function(a,c,d){a&&this._native.setFloat4(a,c.r,c.g,c.b,d)},b.prototype.wipeCaches=function(a){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,a&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},b.prototype._createTexture=function(){return this._native.createTexture()},b.prototype._deleteTexture=function(a){this._native.deleteTexture(a)},b.prototype.createTexture=function(a,c,d,f,g,h,j,m,w,z,C,J){var K=this;void 0===g&&(g=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===h&&(h=null),void 0===j&&(j=null),void 0===m&&(m=null),void 0===w&&(w=null),void 0===z&&(z=null),void 0===C&&(C=null);for(var N=String(a),T="data:"===N.substr(0,5),Z="blob:"===N.substr(0,5),_=w||new mb.a(this,mb.b.Url),ca=N.lastIndexOf("."),ea=C||(ca>-1?N.substring(ca).toLowerCase():""),fa=null,ka=0,pa=Ha.a._TextureLoaders;ka<pa.length;ka++){var va=pa[ka];if(va.canLoad(ea)){fa=va;break}}f&&f._addPendingData(_),_.url=N,_.generateMipMaps=!c,_.samplingMode=g,_.invertY=d,this.doNotHandleContextLost||(_._buffer=m);var sa=null;h&&!w&&(sa=_.onLoadedObservable.add(h)),w||this._internalTexturesCache.push(_);if(fa)throw new Error("Loading textures from IInternalTextureLoader not yet implemented.");var la=function(ta,Da){if("string"==typeof ta)throw new Error("Loading textures from string data not yet implemented.");Z&&!K.doNotHandleContextLost&&(_._buffer=ta);var ua=_._webGLTexture;if(ua){if(!K._native.loadTexture(ua,ta,!c,d))throw new Error("Could not load a native texture.");_.baseWidth=K._native.getTextureWidth(ua),_.baseHeight=K._native.getTextureHeight(ua),_.width=_.baseWidth,_.height=_.baseHeight,_.isReady=!0;var Aa=K._getSamplingFilter(g);K._native.setTextureSampling(ua,Aa),f&&f._removePendingData(_),_.onLoadedObservable.notifyObservers(_),_.onLoadedObservable.clear()}else f&&f._removePendingData(_)};if(m instanceof ArrayBuffer)la(m);else if(ArrayBuffer.isView(m))la(m.buffer);else{if(m instanceof Blob)throw new Error("Loading texture from Blob not yet implemented.");T?la(Qa.b.DecodeBase64(m)):Qa.b.LoadFile(N,la,void 0,void 0,!0,function(ta,Da){!function(ua,Aa){f&&f._removePendingData(_),sa&&_.onLoadedObservable.remove(sa),Qa.b.UseFallbackTexture&&K.createTexture(Qa.b.fallbackTexture,c,d,f,g,null,j,m,_),j&&j(ua||"Unknown error",Aa)}("Failed to retrieve "+N+".",Da)})}return _},b.prototype.createCubeTexture=function(a,c,d,f,g,h,j,m,w,z,C,J){var K=this;void 0===g&&(g=null),void 0===h&&(h=null),void 0===m&&(m=null),void 0===w&&(w=!1),void 0===z&&(z=0),void 0===C&&(C=0),void 0===J&&(J=null);var N=J||new mb.a(this,mb.b.Cube);N.isCube=!0,N.url=a,N.generateMipMaps=!f,N._lodGenerationScale=z,N._lodGenerationOffset=C,this._doNotHandleContextLost||(N._extension=m,N._files=d);var T=a.lastIndexOf(".");if(".env"===(m||(T>-1?a.substring(T).toLowerCase():""))){if(d&&6===d.length)throw new Error("Multi-file loading not allowed on env files.");this._loadFile(a,function(_){return function(ca){var ea=Nc.GetEnvInfo(ca);if(N.width=ea.width,N.height=ea.width,Nc.UploadEnvSpherical(N,ea),1!==ea.version)throw new Error('Unsupported babylon environment map version "'+ea.version+'"');var fa=ea.specular;if(!fa)throw new Error("Nothing else parsed so far");N._lodGenerationScale=fa.lodGenerationScale;var ka=Nc.CreateImageDataArrayBufferViews(ca,ea);if(N.format=p.a.TEXTUREFORMAT_RGBA,N.type=p.a.TEXTURETYPE_UNSIGNED_INT,N.generateMipMaps=!0,N.getEngine().updateTextureSamplingMode(ya.a.TRILINEAR_SAMPLINGMODE,N),N._isRGBD=!0,N.invertY=!0,!K._native.loadEnvTexture(N._webGLTexture,ka))throw new Error("Could not load a native cube texture.");N.isReady=!0,g&&g()}(new Uint8Array(_))},void 0,void 0,!0,function(_,ca){h&&_&&h(_.status+" "+_.statusText,ca)})}else{if(!d||6!==d.length)throw new Error("Cannot load cubemap because 6 files were not defined");var Z=[d[0],d[3],d[1],d[4],d[2],d[5]];Promise.all(Z.map(function(_){return Qa.b.LoadFileAsync(_).then(function(ca){return new Uint8Array(ca)})})).then(function(_){K._native.loadCubeTexture(N._webGLTexture,_,!f)}).then(function(){N.isReady=!0,g&&g()},function(_){h&&h("Failed to load cubemap: "+_.message,_)})}return this._internalTexturesCache.push(N),N},b.prototype._getSamplingFilter=function(a){switch(a){case p.a.TEXTURE_BILINEAR_SAMPLINGMODE:return Ac.MINLINEAR_MAGLINEAR_MIPPOINT;case p.a.TEXTURE_TRILINEAR_SAMPLINGMODE:return Ac.MINLINEAR_MAGLINEAR_MIPLINEAR;case p.a.TEXTURE_NEAREST_SAMPLINGMODE:return Ac.MINPOINT_MAGPOINT_MIPLINEAR;case p.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST:return Ac.MINPOINT_MAGPOINT_MIPPOINT;case p.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST:return Ac.MINLINEAR_MAGPOINT_MIPPOINT;case p.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR:case p.a.TEXTURE_NEAREST_LINEAR:return Ac.MINLINEAR_MAGPOINT_MIPLINEAR;case p.a.TEXTURE_NEAREST_NEAREST:return Ac.MINPOINT_MAGPOINT_MIPPOINT;case p.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST:return Ac.MINPOINT_MAGLINEAR_MIPPOINT;case p.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR:return Ac.MINPOINT_MAGLINEAR_MIPLINEAR;case p.a.TEXTURE_LINEAR_LINEAR:return Ac.MINLINEAR_MAGLINEAR_MIPLINEAR;case p.a.TEXTURE_LINEAR_NEAREST:return Ac.MINPOINT_MAGLINEAR_MIPLINEAR;default:throw new Error("Unexpected sampling mode: "+a+".")}},b._GetNativeTextureFormat=function(a,c){if(a==p.a.TEXTUREFORMAT_RGBA&&c==p.a.TEXTURETYPE_UNSIGNED_INT)return Ci.RGBA8;if(a==p.a.TEXTUREFORMAT_RGBA&&c==p.a.TEXTURETYPE_FLOAT)return Ci.RGBA32F;throw new Error("Unexpected texture format or type: format "+a+", type "+c+".")},b.prototype.createRenderTargetTexture=function(a,c){var d=new Yh.a();void 0!==c&&"object"==typeof c?(d.generateMipMaps=c.generateMipMaps,d.generateDepthBuffer=void 0===c.generateDepthBuffer||c.generateDepthBuffer,d.generateStencilBuffer=d.generateDepthBuffer&&c.generateStencilBuffer,d.type=void 0===c.type?p.a.TEXTURETYPE_UNSIGNED_INT:c.type,d.samplingMode=void 0===c.samplingMode?p.a.TEXTURE_TRILINEAR_SAMPLINGMODE:c.samplingMode,d.format=void 0===c.format?p.a.TEXTUREFORMAT_RGBA:c.format):(d.generateMipMaps=c,d.generateDepthBuffer=!0,d.generateStencilBuffer=!1,d.type=p.a.TEXTURETYPE_UNSIGNED_INT,d.samplingMode=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE,d.format=p.a.TEXTUREFORMAT_RGBA),(d.type!==p.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(d.type!==p.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(d.samplingMode=p.a.TEXTURE_NEAREST_SAMPLINGMODE);var f=new om(this,mb.b.RenderTarget),g=a.width||a,h=a.height||a;d.type!==p.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(d.type=p.a.TEXTURETYPE_UNSIGNED_INT,k.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var j=this._native.createFramebuffer(f._webGLTexture,g,h,b._GetNativeTextureFormat(d.format,d.type),d.samplingMode,!!d.generateStencilBuffer,d.generateDepthBuffer,!!d.generateMipMaps);return f._framebuffer=j,f.baseWidth=g,f.baseHeight=h,f.width=g,f.height=h,f.isReady=!0,f.samples=1,f.generateMipMaps=!!d.generateMipMaps,f.samplingMode=d.samplingMode,f.type=d.type,f.format=d.format,f._generateDepthBuffer=d.generateDepthBuffer,f._generateStencilBuffer=!!d.generateStencilBuffer,this._internalTexturesCache.push(f),f},b.prototype.updateTextureSamplingMode=function(a,c){if(c._webGLTexture){var d=this._getSamplingFilter(a);this._native.setTextureSampling(c._webGLTexture,d)}c.samplingMode=a},b.prototype.bindFramebuffer=function(a,c,d,f,g){if(c)throw new Error("Cuboid frame buffers are not yet supported in NativeEngine.");if(d||f)throw new Error("Required width/height for frame buffers not yet supported in NativeEngine.");if(g)throw new Error("forceFullscreenViewport for frame buffers not yet supported in NativeEngine.");this._bindUnboundFramebuffer(a._framebuffer)},b.prototype.unBindFramebuffer=function(a,c,d){void 0===c&&(c=!1),c&&k.a.Warn("Disabling mipmap generation not yet supported in NativeEngine. Ignoring."),d&&d(),this._bindUnboundFramebuffer(null)},b.prototype.createDynamicVertexBuffer=function(a){throw new Error("createDynamicVertexBuffer not yet implemented.")},b.prototype.updateDynamicIndexBuffer=function(a,c,d){throw void 0===d&&(d=0),new Error("updateDynamicIndexBuffer not yet implemented.")},b.prototype.updateDynamicVertexBuffer=function(a,c,d,f){throw new Error("updateDynamicVertexBuffer not yet implemented.")},b.prototype._setTexture=function(a,c,d,f){void 0===d&&(d=!1),void 0===f&&(f=!1);var g,h=this._boundUniforms[a];if(!h)return!1;if(!c)return null!=this._boundTexturesCache[a]&&(this._activeChannel=a,this._native.setTexture(h,null)),!1;if(c.video)this._activeChannel=a,c.update();else if(c.delayLoadState===p.a.DELAYLOADSTATE_NOTLOADED)return c.delayLoad(),!1;return g=f?c.depthStencilTexture:c.isReady()?c.getInternalTexture():c.isCube?this.emptyCubeTexture:c.is3D?this.emptyTexture3D:c.is2DArray?this.emptyTexture2DArray:this.emptyTexture,this._activeChannel=a,!(!g||!g._webGLTexture)&&(this._native.setTextureWrapMode(g._webGLTexture,this._getAddressMode(c.wrapU),this._getAddressMode(c.wrapV),this._getAddressMode(c.wrapR)),this._updateAnisotropicLevel(c),this._native.setTexture(h,g._webGLTexture),!0)},b.prototype._updateAnisotropicLevel=function(a){var c=a.getInternalTexture(),d=a.anisotropicFilteringLevel;c&&c._webGLTexture&&c._cachedAnisotropicFilteringLevel!==d&&(this._native.setTextureAnisotropicLevel(c._webGLTexture,d),c._cachedAnisotropicFilteringLevel=d)},b.prototype._getAddressMode=function(a){switch(a){case p.a.TEXTURE_WRAP_ADDRESSMODE:return ug.WRAP;case p.a.TEXTURE_CLAMP_ADDRESSMODE:return ug.CLAMP;case p.a.TEXTURE_MIRROR_ADDRESSMODE:return ug.MIRROR;default:throw new Error("Unexpected wrap mode: "+a+".")}},b.prototype._bindTexture=function(a,c){throw new Error("_bindTexture not implemented.")},b.prototype._deleteBuffer=function(a){a.nativeIndexBuffer&&(this._native.deleteIndexBuffer(a.nativeIndexBuffer),delete a.nativeIndexBuffer),a.nativeVertexBuffer&&(this._native.deleteVertexBuffer(a.nativeVertexBuffer),delete a.nativeVertexBuffer)},b.prototype.releaseEffects=function(){},b.prototype._uploadCompressedDataToTextureDirectly=function(a,c,d,f,g,h,j){throw void 0===h&&(h=0),void 0===j&&(j=0),new Error("_uploadCompressedDataToTextureDirectly not implemented.")},b.prototype._uploadDataToTextureDirectly=function(a,c,d,f){throw void 0===d&&(d=0),void 0===f&&(f=0),new Error("_uploadDataToTextureDirectly not implemented.")},b.prototype._uploadArrayBufferViewToTexture=function(a,c,d,f){throw void 0===d&&(d=0),void 0===f&&(f=0),new Error("_uploadArrayBufferViewToTexture not implemented.")},b.prototype._uploadImageToTexture=function(a,c,d,f){throw void 0===d&&(d=0),void 0===f&&(f=0),new Error("_uploadArrayBufferViewToTexture not implemented.")},b}(Ha.a),df=function(){function e(){}return e.COPY=1,e.CUT=2,e.PASTE=3,e}(),qm=function(){function e(b,a){this.type=b,this.event=a}return e.GetTypeFromCharacter=function(b){switch(b){case 67:return df.COPY;case 86:return df.PASTE;case 88:return df.CUT;default:return-1}},e}(),vg=o(76),Pc=o(67),Di=function(){function e(b,a,c){this.lengthComputable=b,this.loaded=a,this.total=c}return e.FromProgressEvent=function(b){return new e(b.lengthComputable,b.loaded,b.total)},e}();!function(e){e[e.Clean=0]="Clean",e[e.Stop=1]="Stop",e[e.Sync=2]="Sync",e[e.NoSync=3]="NoSync"}(Oc||(Oc={}));var yb=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return Pc.a.ForceFullSceneLoadingForIncremental},set:function(b){Pc.a.ForceFullSceneLoadingForIncremental=b},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return Pc.a.ShowLoadingScreen},set:function(b){Pc.a.ShowLoadingScreen=b},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return Pc.a.loggingLevel},set:function(b){Pc.a.loggingLevel=b},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return Pc.a.CleanBoneMatrixWeights},set:function(b){Pc.a.CleanBoneMatrixWeights=b},enumerable:!0,configurable:!0}),e._getDefaultPlugin=function(){return e._registeredPlugins[".babylon"]},e._getPluginForExtension=function(b){var a=e._registeredPlugins[b];return a||(k.a.Warn("Unable to find a plugin to load "+b+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"),e._getDefaultPlugin())},e._getPluginForDirectLoad=function(b){for(var a in e._registeredPlugins){var c=e._registeredPlugins[a].plugin;if(c.canDirectLoad&&c.canDirectLoad(b))return e._registeredPlugins[a]}return e._getDefaultPlugin()},e._getPluginForFilename=function(b){var a=b.indexOf("?");-1!==a&&(b=b.substring(0,a));var c=b.lastIndexOf("."),d=b.substring(c,b.length).toLowerCase();return e._getPluginForExtension(d)},e._getDirectLoad=function(b){return"data:"===b.substr(0,5)?b.substr(5):null},e._loadData=function(b,a,c,d,f,g,h){var j,m=e._getDirectLoad(b.name),w=h?e._getPluginForExtension(h):m?e._getPluginForDirectLoad(b.name):e._getPluginForFilename(b.name);if(!(j=w.plugin.createPlugin?w.plugin.createPlugin():w.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(e.OnPluginActivatedObservable.notifyObservers(j),m)return c(j,j.directLoad?j.directLoad(a,m):m),j;var z=w.isBinary,C=function(sa,la){a.isDisposed?f("Scene has been disposed"):c(j,sa,la)},J=null,K=!1,N=j.onDisposeObservable;N&&N.add(function(){K=!0,J&&(J.abort(),J=null),g()});var T=d?function(sa){d(Di.FromProgressEvent(sa))}:void 0,Z=function(){if(!K){var sa=function(ta,Da){C(ta,Da?Da.responseURL:void 0)},la=function(ta){f(ta.message,ta)};J=j.requestFile?j.requestFile(a,b.url,sa,T,z,la):a._requestFile(b.url,sa,T,!0,z,la)}},_=b.file||vg.a.FilesToLoad[b.name.toLowerCase()];if(-1===b.rootUrl.indexOf("file:")||-1!==b.rootUrl.indexOf("file:")&&!_){var ca=a.getEngine(),ea=ca.enableOfflineSupport;if(ea){for(var fa=!1,ka=0,pa=a.disableOfflineSupportExceptionRules;ka<pa.length;ka++)if(pa[ka].test(b.url)){fa=!0;break}ea=!fa}ea&&Ha.a.OfflineProviderFactory?a.offlineProvider=Ha.a.OfflineProviderFactory(b.url,Z,ca.disableManifestCheck):Z()}else if(_){var va=function(sa){f(sa.message,sa)};J=j.readFile?j.readFile(a,_,C,T,z,va):a._readFile(_,C,T,z,va)}else f("Unable to find file named "+b.name);return j},e._getFileInfo=function(b,a){var c,d,f=null;if(a)if(a.name){var g=a;c=b+g.name,d=g.name,f=g}else{var h=a;if("/"===h.substr(0,1))return Qa.b.Error("Wrong sceneFilename parameter"),null;c=b+h,d=h}else c=b,d=Qa.b.GetFilename(b),b=Qa.b.GetFolderPath(b);return{url:c,rootUrl:b,name:d,file:f}},e.GetPluginForExtension=function(b){return e._getPluginForExtension(b).plugin},e.IsPluginForExtensionAvailable=function(b){return!!e._registeredPlugins[b]},e.RegisterPlugin=function(b){if("string"==typeof b.extensions){var a=b.extensions;e._registeredPlugins[a.toLowerCase()]={plugin:b,isBinary:!1}}else{var c=b.extensions;Object.keys(c).forEach(function(d){e._registeredPlugins[d.toLowerCase()]={plugin:b,isBinary:c[d].isBinary}})}},e.ImportMesh=function(b,a,c,d,f,g,h,j){if(void 0===c&&(c=""),void 0===d&&(d=U.a.LastCreatedScene),void 0===f&&(f=null),void 0===g&&(g=null),void 0===h&&(h=null),void 0===j&&(j=null),!d)return k.a.Error("No scene available to import mesh to"),null;var m=e._getFileInfo(a,c);if(!m)return null;var w={};d._addPendingData(w);var z=function(){d._removePendingData(w)},C=function(N,T){var Z="Unable to import meshes from "+m.url+": "+N;h?h(d,Z,T):k.a.Error(Z),z()},J=g?function(N){try{g(N)}catch(T){C("Error in onProgress callback: "+T,T)}}:void 0,K=function(N,T,Z,_){if(d.importedMeshesFiles.push(m.url),f)try{f(N,T,Z,_)}catch(ca){C("Error in onSuccess callback: "+ca,ca)}d._removePendingData(w)};return e._loadData(m,d,function(N,T,Z){if(N.rewriteRootURL&&(m.rootUrl=N.rewriteRootURL(m.rootUrl,Z)),N.importMesh){var _=N,ca=new Array(),ea=new Array(),fa=new Array();if(!_.importMesh(b,d,T,m.rootUrl,ca,ea,fa,C))return;d.loadingPluginName=N.name,K(ca,ea,fa,[])}else N.importMeshAsync(b,d,T,m.rootUrl,J,m.name).then(function(ka){d.loadingPluginName=N.name,K(ka.meshes,ka.particleSystems,ka.skeletons,ka.animationGroups)}).catch(function(ka){C(ka.message,ka)})},J,C,z,j)},e.ImportMeshAsync=function(b,a,c,d,f,g){return void 0===c&&(c=""),void 0===d&&(d=U.a.LastCreatedScene),void 0===f&&(f=null),void 0===g&&(g=null),new Promise(function(h,j){e.ImportMesh(b,a,c,d,function(m,w,z,C){h({meshes:m,particleSystems:w,skeletons:z,animationGroups:C})},f,function(m,w,z){j(z||new Error(w))},g)})},e.Load=function(b,a,c,d,f,g,h){return void 0===a&&(a=""),void 0===c&&(c=U.a.LastCreatedEngine),void 0===d&&(d=null),void 0===f&&(f=null),void 0===g&&(g=null),void 0===h&&(h=null),c?e.Append(b,a,new wa.a(c),d,f,g,h):(Qa.b.Error("No engine available"),null)},e.LoadAsync=function(b,a,c,d,f){return void 0===a&&(a=""),void 0===c&&(c=U.a.LastCreatedEngine),void 0===d&&(d=null),void 0===f&&(f=null),new Promise(function(g,h){e.Load(b,a,c,function(j){g(j)},d,function(j,m,w){h(w||new Error(m))},f)})},e.Append=function(b,a,c,d,f,g,h){if(void 0===a&&(a=""),void 0===c&&(c=U.a.LastCreatedScene),void 0===d&&(d=null),void 0===f&&(f=null),void 0===g&&(g=null),void 0===h&&(h=null),!c)return k.a.Error("No scene available to append to"),null;var j=e._getFileInfo(b,a);if(!j)return null;e.ShowLoadingScreen&&c.getEngine().displayLoadingUI();var m={};c._addPendingData(m);var w=function(){c._removePendingData(m),c.getEngine().hideLoadingUI()},z=function(K,N){var T="Unable to load from "+j.url+(K?": "+K:"");g?g(c,T,N):k.a.Error(T),w()},C=f?function(K){try{f(K)}catch(N){z("Error in onProgress callback",N)}}:void 0,J=function(){if(d)try{d(c)}catch(K){z("Error in onSuccess callback",K)}c._removePendingData(m)};return e._loadData(j,c,function(K,N){if(K.load){if(!K.load(c,N,j.rootUrl,z))return;c.loadingPluginName=K.name,J()}else K.loadAsync(c,N,j.rootUrl,C,j.name).then(function(){c.loadingPluginName=K.name,J()}).catch(function(T){z(T.message,T)});e.ShowLoadingScreen&&c.executeWhenReady(function(){c.getEngine().hideLoadingUI()})},C,z,w,h)},e.AppendAsync=function(b,a,c,d,f){return void 0===a&&(a=""),void 0===c&&(c=U.a.LastCreatedScene),void 0===d&&(d=null),void 0===f&&(f=null),new Promise(function(g,h){e.Append(b,a,c,function(j){g(j)},d,function(j,m,w){h(w||new Error(m))},f)})},e.LoadAssetContainer=function(b,a,c,d,f,g,h){if(void 0===a&&(a=""),void 0===c&&(c=U.a.LastCreatedScene),void 0===d&&(d=null),void 0===f&&(f=null),void 0===g&&(g=null),void 0===h&&(h=null),!c)return k.a.Error("No scene available to load asset container to"),null;var j=e._getFileInfo(b,a);if(!j)return null;var m={};c._addPendingData(m);var w=function(){c._removePendingData(m)},z=function(K,N){var T="Unable to load assets from "+j.url+(K?": "+K:"");N&&N.message&&(T+=" ("+N.message+")"),g?g(c,T,N):k.a.Error(T),w()},C=f?function(K){try{f(K)}catch(N){z("Error in onProgress callback",N)}}:void 0,J=function(K){if(d)try{d(K)}catch(N){z("Error in onSuccess callback",N)}c._removePendingData(m)};return e._loadData(j,c,function(K,N){if(K.loadAssetContainer){var T=K.loadAssetContainer(c,N,j.rootUrl,z);if(!T)return;c.loadingPluginName=K.name,J(T)}else K.loadAssetContainerAsync?K.loadAssetContainerAsync(c,N,j.rootUrl,C,j.name).then(function(Z){c.loadingPluginName=K.name,J(Z)}).catch(function(Z){z(Z.message,Z)}):z("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");e.ShowLoadingScreen&&c.executeWhenReady(function(){c.getEngine().hideLoadingUI()})},C,z,w,h)},e.LoadAssetContainerAsync=function(b,a,c,d,f){return void 0===a&&(a=""),void 0===c&&(c=U.a.LastCreatedScene),void 0===d&&(d=null),void 0===f&&(f=null),new Promise(function(g,h){e.LoadAssetContainer(b,a,c,function(j){g(j)},d,function(j,m,w){h(w||new Error(m))},f)})},e.ImportAnimations=function(b,a,c,d,f,g,h,j,m){if(void 0===a&&(a=""),void 0===c&&(c=U.a.LastCreatedScene),void 0===d&&(d=!0),void 0===f&&(f=Oc.Clean),void 0===g&&(g=null),void 0===h&&(h=null),void 0===j&&(j=null),void 0===m&&(m=null),c){if(d){for(var w=0,z=c.animatables;w<z.length;w++)z[w].reset();c.stopAllAnimations(),c.animationGroups.slice().forEach(function(J){J.dispose()}),c.getNodes().forEach(function(J){J.animations&&(J.animations=[])})}else switch(f){case Oc.Clean:c.animationGroups.slice().forEach(function(J){J.dispose()});break;case Oc.Stop:c.animationGroups.forEach(function(J){J.stop()});break;case Oc.Sync:c.animationGroups.forEach(function(J){J.reset(),J.restart()});break;case Oc.NoSync:break;default:return void k.a.Error("Unknown animation group loading mode value '"+f+"'")}var C=c.animatables.length;this.LoadAssetContainer(b,a,c,function(J){J.mergeAnimationsTo(c,c.animatables.slice(C),g),J.dispose(),c.onAnimationFileImportedObservable.notifyObservers(c),h&&h(c)},j,m)}else k.a.Error("No scene available to load animations to")},e.ImportAnimationsAsync=function(b,a,c,d,f,g,h,j,m){return void 0===a&&(a=""),void 0===c&&(c=U.a.LastCreatedScene),void 0===d&&(d=!0),void 0===f&&(f=Oc.Clean),void 0===g&&(g=null),void 0===h&&(h=null),void 0===j&&(j=null),void 0===m&&(m=null),new Promise(function(w,z){e.ImportAnimations(b,a,c,d,f,g,function(C){w(C)},j,function(C,J,K){z(K||new Error(J))})})},e.NO_LOGGING=p.a.SCENELOADER_NO_LOGGING,e.MINIMAL_LOGGING=p.a.SCENELOADER_MINIMAL_LOGGING,e.SUMMARY_LOGGING=p.a.SCENELOADER_SUMMARY_LOGGING,e.DETAILED_LOGGING=p.a.SCENELOADER_DETAILED_LOGGING,e.OnPluginActivatedObservable=new I.c(),e._registeredPlugins={},e}(),wg=function(e){function b(a){var c=e.call(this,a)||this;return c.controllerType=wc.DAYDREAM,c}return Object(l.d)(b,e),b.prototype.initControllerMesh=function(a,c){var d=this;yb.ImportMesh("",b.MODEL_BASE_URL,b.MODEL_FILENAME,a,function(f){d._defaultModel=f[1],d.attachToMesh(d._defaultModel),c&&c(d._defaultModel)})},b.prototype._handleButtonChange=function(a,c,d){if(0===a){var f=this.onTriggerStateChangedObservable;f&&f.notifyObservers(c)}else k.a.Warn("Unrecognized Daydream button index: "+a)},b.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",b.MODEL_FILENAME="generic.babylon",b.GAMEPAD_ID_PREFIX="Daydream",b}(Xc);Vc._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(wg.GAMEPAD_ID_PREFIX)},create:function(e){return new wg(e)}});var xg=function(e){function b(a){var c=e.call(this,a)||this;return c._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"],c.controllerType=wc.GEAR_VR,c._calculatedPosition=new i.e("left"==c.hand?-.15:.15,-.5,.25),c._disableTrackPosition(c._calculatedPosition),c}return Object(l.d)(b,e),b.prototype.initControllerMesh=function(a,c){var d=this;yb.ImportMesh("",b.MODEL_BASE_URL,b.MODEL_FILENAME,a,function(f){var g=new xa.a("",a);f[1].parent=g,f[1].position.z=-.15,d._defaultModel=g,d.attachToMesh(d._defaultModel),c&&c(d._defaultModel)})},b.prototype._handleButtonChange=function(a,c,d){if(a<this._buttonIndexToObservableNameMap.length){var f=this[this._buttonIndexToObservableNameMap[a]];f&&f.notifyObservers(c)}},b.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",b.MODEL_FILENAME="generic.babylon",b.GAMEPAD_ID_PREFIX="Gear VR",b}(Xc);Vc._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(xg.GAMEPAD_ID_PREFIX)||-1!==e.id.indexOf("Oculus Go")||-1!==e.id.indexOf("Vive Focus")},create:function(e){return new xg(e)}});var ef=function(e){function b(a){return e.call(this,a)||this}return Object(l.d)(b,e),b.prototype.initControllerMesh=function(a,c){var d=this;yb.ImportMesh("",b.MODEL_BASE_URL,b.MODEL_FILENAME,a,function(f){d._defaultModel=f[1],d.attachToMesh(d._defaultModel),c&&c(d._defaultModel)})},b.prototype._handleButtonChange=function(a,c,d){console.log("Button id: "+a+"state: "),console.dir(c)},b.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",b.MODEL_FILENAME="generic.babylon",b}(Xc);Vc._DefaultControllerFactory=function(e){return new ef(e)};var yg=function(e){function b(a){var c=e.call(this,a)||this;return c.onSecondaryTriggerStateChangedObservable=new I.c(),c.onThumbRestChangedObservable=new I.c(),c.controllerType=wc.OCULUS,c}return Object(l.d)(b,e),b.prototype.initControllerMesh=function(a,c){var d,f=this;d="left"===this.hand?b.MODEL_LEFT_FILENAME:b.MODEL_RIGHT_FILENAME,yb.ImportMesh("",b._IsQuest?b.QUEST_MODEL_BASE_URL:b.MODEL_BASE_URL,d,a,function(g){f._defaultModel=b._IsQuest?g[0]:g[1],f.attachToMesh(f._defaultModel),c&&c(f._defaultModel)})},Object.defineProperty(b.prototype,"onAButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!0,configurable:!0}),b.prototype._handleButtonChange=function(a,c,d){var f=c,g="right"===this.hand?-1:1;switch(a){case 0:return void this.onPadStateChangedObservable.notifyObservers(f);case 1:return!b._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-f.value,this._defaultModel.getChildren()[3].position.y=.005*-f.value,this._defaultModel.getChildren()[3].position.z=.005*-f.value),void this.onTriggerStateChangedObservable.notifyObservers(f);case 2:return!b._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=g*f.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(f);case 3:return!b._IsQuest&&this._defaultModel&&(f.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(f);case 4:return!b._IsQuest&&this._defaultModel&&(f.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(f);case 5:return void this.onThumbRestChangedObservable.notifyObservers(f)}},b.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",b.MODEL_LEFT_FILENAME="left.babylon",b.MODEL_RIGHT_FILENAME="right.babylon",b.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",b._IsQuest=!1,b}(Xc);Vc._ControllerFactories.push({canCreate:function(e){return Ha.a.LastCreatedEngine&&Ha.a.LastCreatedEngine._vrDisplay&&"Oculus Quest"===Ha.a.LastCreatedEngine._vrDisplay.displayName&&(yg._IsQuest=!0),-1!==e.id.indexOf("Oculus Touch")},create:function(e){return new yg(e)}});var Ei=function(e){function b(a){var c=e.call(this,a)||this;return c.controllerType=wc.VIVE,c._invertLeftStickY=!0,c}return Object(l.d)(b,e),b.prototype.initControllerMesh=function(a,c){var d=this;yb.ImportMesh("",b.MODEL_BASE_URL,b.MODEL_FILENAME,a,function(f){d._defaultModel=f[1],d.attachToMesh(d._defaultModel),c&&c(d._defaultModel)})},Object.defineProperty(b.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),b.prototype._handleButtonChange=function(a,c,d){var f=c;switch(a){case 0:return void this.onPadStateChangedObservable.notifyObservers(f);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-f.value),void this.onTriggerStateChangedObservable.notifyObservers(f);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(f);case 3:return this._defaultModel&&(f.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(f)}},b.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",b.MODEL_FILENAME="wand.babylon",b}(Xc);Vc._ControllerFactories.push({canCreate:function(e){return-1!==e.id.toLowerCase().indexOf("openvr")},create:function(e){return new Ei(e)}});var rm=function(){this.buttonMeshes={},this.axisMeshes={}},ff=function(e){function b(a){var c=e.call(this,a)||this;return c._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:Gd.POINTING_POSE},c.onTrackpadChangedObservable=new I.c(),c.onTrackpadValuesChangedObservable=new I.c(),c.trackpad={x:0,y:0},c.controllerType=wc.WINDOWS,c._loadedMeshInfo=null,c}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!0,configurable:!0}),b.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_X")],this.trackpad.y=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_Y")],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},b.prototype.update=function(){if(e.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var a=0;a<this._mapping.axisMeshNames.length;a++)this._lerpAxisTransform(a,this.browserGamepad.axes[a])},b.prototype._handleButtonChange=function(a,c,d){var f=this._mapping.buttons[a];if(f){this._updateTrackpad();var g=this[this._mapping.buttonObservableNames[f]];g&&g.notifyObservers(c),this._lerpButtonTransform(f,c.value)}},b.prototype._lerpButtonTransform=function(a,c){if(this._loadedMeshInfo){var d=this._loadedMeshInfo.buttonMeshes[a];d&&d.unpressed.rotationQuaternion&&d.pressed.rotationQuaternion&&d.value.rotationQuaternion&&(i.b.SlerpToRef(d.unpressed.rotationQuaternion,d.pressed.rotationQuaternion,c,d.value.rotationQuaternion),i.e.LerpToRef(d.unpressed.position,d.pressed.position,c,d.value.position))}},b.prototype._lerpAxisTransform=function(a,c){if(this._loadedMeshInfo){var d=this._loadedMeshInfo.axisMeshes[a];if(d&&d.min.rotationQuaternion&&d.max.rotationQuaternion&&d.value.rotationQuaternion){var f=.5*c+.5;i.b.SlerpToRef(d.min.rotationQuaternion,d.max.rotationQuaternion,f,d.value.rotationQuaternion),i.e.LerpToRef(d.min.position,d.max.position,f,d.value.position)}}},b.prototype.initControllerMesh=function(a,c,d){var f,g,h=this;if(void 0===d&&(d=!1),yb.IsPluginForExtensionAvailable(".glb")){var j="default";if(this.id&&!d){var m=this.id.match(b.GAMEPAD_ID_PATTERN);j=m&&m[0]||j}g="left"===this.hand?b.MODEL_LEFT_FILENAME:b.MODEL_RIGHT_FILENAME,f=b.MODEL_BASE_URL+j+"/"}else k.a.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),f=ef.MODEL_BASE_URL,g=ef.MODEL_FILENAME;yb.ImportMesh("",f,g,a,function(w){h._loadedMeshInfo=h.processModel(a,w),h._loadedMeshInfo&&(h._defaultModel=h._loadedMeshInfo.rootNode,h.attachToMesh(h._defaultModel),c&&c(h._defaultModel))},null,function(w,z){k.a.Log(z),k.a.Warn("Failed to retrieve controller model from the remote server: "+f+g),d||h.initControllerMesh(w,c,!0)})},b.prototype.processModel=function(a,c){for(var d=null,f=new xa.a(this.id+" "+this.hand,a),g=null,h=0;h<c.length;h++){var j=c[h];if(!j.parent){j.isPickable=!1,g=j;break}}return g?(g.setParent(f),d=this.createMeshInfo(f)):k.a.Warn("Could not find root node in model file."),d},b.prototype.createMeshInfo=function(a){var c,d=new rm();for(d.rootNode=a,d.buttonMeshes={},d.axisMeshes={},c=0;c<this._mapping.buttons.length;c++){var f=this._mapping.buttonMeshNames[this._mapping.buttons[c]];if(f){var g=z(a,f);if(g){var h={index:c,value:C(g,"VALUE"),pressed:C(g,"PRESSED"),unpressed:C(g,"UNPRESSED")};h.value&&h.pressed&&h.unpressed?d.buttonMeshes[this._mapping.buttons[c]]=h:k.a.Warn("Missing button submesh under mesh with name: "+f+"(VALUE: "+!!h.value+", PRESSED: "+!!h.pressed+", UNPRESSED:"+!!h.unpressed+")")}else k.a.Warn("Missing button mesh with name: "+f)}else k.a.Log("Skipping unknown button at index: "+c+" with mapped name: "+this._mapping.buttons[c])}for(c=0;c<this._mapping.axisMeshNames.length;c++){var j=this._mapping.axisMeshNames[c];if(j){var m=z(a,j);if(m){var w={index:c,value:C(m,"VALUE"),min:C(m,"MIN"),max:C(m,"MAX")};w.value&&w.min&&w.max?d.axisMeshes[c]=w:k.a.Warn("Missing axis submesh under mesh with name: "+j+"(VALUE: "+!!w.value+", MIN: "+!!w.min+", MAX:"+!!w.max+")")}else k.a.Warn("Missing axis mesh with name: "+j)}else k.a.Log("Skipping unknown axis at index: "+c)}return d.pointingPoseNode=z(a,this._mapping.pointingPoseMeshName),d.pointingPoseNode?this._pointingPoseNode=d.pointingPoseNode:k.a.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),d;function z(J,K){return J.getChildren(function(N){return N.name===K},!1)[0]}function C(J,K){return J.getChildren(function(N){return N.name==K},!0)[0]}},b.prototype.getForwardRay=function(a){if(void 0===a&&(a=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return e.prototype.getForwardRay.call(this,a);var c=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),d=c.getTranslation(),f=new i.e(0,0,-1),g=i.e.TransformNormal(f,c),h=i.e.Normalize(g);return new Rb.a(d,h,a)},b.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear(),this.onTrackpadValuesChangedObservable.clear()},b.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",b.MODEL_LEFT_FILENAME="left.glb",b.MODEL_RIGHT_FILENAME="right.glb",b.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",b.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,b}(Xc),sm=function(e){function b(a){var c=e.call(this,a)||this;return c._mapping={buttons:["trigger","grip","trackpad","thumbstick","menu"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onThumbstickStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y","THUMBSTICK_X","THUMBSTICK_Y"],pointingPoseMeshName:Gd.POINTING_POSE},c.thumbstickValues={x:0,y:0},c.onThumbstickStateChangedObservable=new I.c(),c.onThumbstickValuesChangedObservable=new I.c(),c.onTrackpadChangedObservable=c.onPadStateChangedObservable,c.onTrackpadValuesChangedObservable=c.onPadValuesChangedObservable,c}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onThumbstickStateChangedObservable},enumerable:!0,configurable:!0}),b.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.thumbstickValues.x&&this.browserGamepad.axes[3]==this.thumbstickValues.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onThumbstickValuesChangedObservable.notifyObservers(this.trackpad))},b.prototype.dispose=function(){e.prototype.dispose.call(this),this.onThumbstickStateChangedObservable.clear(),this.onThumbstickValuesChangedObservable.clear()},b}(ff);Vc._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(ff.GAMEPAD_ID_PREFIX)},create:function(e){return new ff(e)}});var gf=o(72),ue=o(66),Qc=o(56),ic=o(41),ve=function(e){function b(a,c,d,f){void 0===c&&(c=G.a.Gray()),void 0===d&&(d=ic.a.DefaultUtilityLayer),void 0===f&&(f=null);var g=e.call(this,d)||this;g._pointerObserver=null,g.snapDistance=0,g.onSnapObservable=new I.c(),g.uniformScaling=!1,g.sensitivity=1,g._isEnabled=!0,g._parent=null,g._parent=f,g._coloredMaterial=new Ab.a("",d.utilityLayerScene),g._coloredMaterial.diffuseColor=c,g._coloredMaterial.specularColor=c.subtract(new G.a(.1,.1,.1)),g._hoverMaterial=new Ab.a("",d.utilityLayerScene),g._hoverMaterial.diffuseColor=c.add(new G.a(.3,.3,.3)),g._arrow=new qb.a("",d.utilityLayerScene);var h=ue.a.CreateBox("yPosMesh",{size:.4},d.utilityLayerScene),j=md.a.CreateCylinder("cylinder",{diameterTop:.005,height:.275,diameterBottom:.005,tessellation:96},d.utilityLayerScene);j.material=g._coloredMaterial,g._arrow.addChild(h),g._arrow.addChild(j),h.scaling.scaleInPlace(.1),h.material=g._coloredMaterial,h.rotation.x=Math.PI/2,h.position.z+=.3,j.position.z+=.1375,j.rotation.x=Math.PI/2,g._arrow.lookAt(g._rootMesh.position.add(a)),g._rootMesh.addChild(g._arrow),g._arrow.scaling.scaleInPlace(1/3),g.dragBehavior=new Hc.a({dragAxis:a}),g.dragBehavior.moveAttached=!1,g._rootMesh.addBehavior(g.dragBehavior);var m=0,w=new i.e(),z={snapDistance:0};g.dragBehavior.onDragObservable.add(function(J){if(g.attachedMesh){var K=g.sensitivity*J.dragDistance*(3*g.scaleRatio/g._rootMesh.scaling.length()),N=!1,T=0;g.uniformScaling?(g.attachedMesh.scaling.normalizeToRef(w),w.y<0&&w.scaleInPlace(-1)):w.copyFrom(a),0==g.snapDistance?w.scaleToRef(K,w):(m+=K,Math.abs(m)>g.snapDistance?(T=Math.floor(Math.abs(m)/g.snapDistance),m<0&&(T*=-1),m%=g.snapDistance,w.scaleToRef(g.snapDistance*T,w),N=!0):w.scaleInPlace(0)),g.attachedMesh.scaling.addInPlace(w),N&&(z.snapDistance=g.snapDistance*T,g.onSnapObservable.notifyObservers(z))}}),g._pointerObserver=d.utilityLayerScene.onPointerObservable.add(function(J){if(!g._customMeshSet){var K=J.pickInfo&&-1!=g._rootMesh.getChildMeshes().indexOf(J.pickInfo.pickedMesh)?g._hoverMaterial:g._coloredMaterial;g._rootMesh.getChildMeshes().forEach(function(N){N.material=K,N.color&&(N.color=K.diffuseColor)})}});var C=d._getSharedGizmoLight();return C.includedOnlyMeshes=C.includedOnlyMeshes.concat(g._rootMesh.getChildMeshes()),g}return Object(l.d)(b,e),b.prototype._attachedMeshChanged=function(a){this.dragBehavior&&(this.dragBehavior.enabled=!!a)},Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled=a,a?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._arrow&&this._arrow.dispose(),[this._coloredMaterial,this._hoverMaterial].forEach(function(a){a&&a.dispose()}),e.prototype.dispose.call(this)},b.prototype.setCustomMesh=function(a,c){var d=this;void 0===c&&(c=!1),e.prototype.setCustomMesh.call(this,a),c&&(this._rootMesh.getChildMeshes().forEach(function(f){f.material=d._coloredMaterial,f.color&&(f.color=d._coloredMaterial.diffuseColor)}),this._customMeshSet=!1)},b}(Qc.a),jc=o(48),Wb=o(46),Fi=function(e){function b(a,c){void 0===a&&(a=G.a.Gray()),void 0===c&&(c=ic.a.DefaultKeepDepthUtilityLayer);var d=e.call(this,c)||this;d._boundingDimensions=new i.e(1,1,1),d._renderObserver=null,d._pointerObserver=null,d._scaleDragSpeed=.2,d._tmpQuaternion=new i.b(),d._tmpVector=new i.e(0,0,0),d._tmpRotationMatrix=new i.a(),d.ignoreChildren=!1,d.includeChildPredicate=null,d.rotationSphereSize=.1,d.scaleBoxSize=.1,d.fixedDragMeshScreenSize=!1,d.fixedDragMeshScreenSizeDistanceFactor=10,d.onDragStartObservable=new I.c(),d.onScaleBoxDragObservable=new I.c(),d.onScaleBoxDragEndObservable=new I.c(),d.onRotationSphereDragObservable=new I.c(),d.onRotationSphereDragEndObservable=new I.c(),d.scalePivot=null,d._existingMeshScale=new i.e(),d._dragMesh=null,d.pointerDragBehavior=new Hc.a(),d.updateScale=!1,d._anchorMesh=new qb.a("anchor",c.utilityLayerScene),d.coloredMaterial=new Ab.a("",c.utilityLayerScene),d.coloredMaterial.disableLighting=!0,d.hoverColoredMaterial=new Ab.a("",c.utilityLayerScene),d.hoverColoredMaterial.disableLighting=!0,d._lineBoundingBox=new qb.a("",c.utilityLayerScene),d._lineBoundingBox.rotationQuaternion=new i.b();var f=[];f.push(Wb.a.CreateLines("lines",{points:[new i.e(0,0,0),new i.e(d._boundingDimensions.x,0,0)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(0,0,0),new i.e(0,d._boundingDimensions.y,0)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(0,0,0),new i.e(0,0,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(d._boundingDimensions.x,0,0),new i.e(d._boundingDimensions.x,d._boundingDimensions.y,0)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(d._boundingDimensions.x,0,0),new i.e(d._boundingDimensions.x,0,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(0,d._boundingDimensions.y,0),new i.e(d._boundingDimensions.x,d._boundingDimensions.y,0)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(0,d._boundingDimensions.y,0),new i.e(0,d._boundingDimensions.y,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(0,0,d._boundingDimensions.z),new i.e(d._boundingDimensions.x,0,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(0,0,d._boundingDimensions.z),new i.e(0,d._boundingDimensions.y,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(d._boundingDimensions.x,d._boundingDimensions.y,d._boundingDimensions.z),new i.e(0,d._boundingDimensions.y,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(d._boundingDimensions.x,d._boundingDimensions.y,d._boundingDimensions.z),new i.e(d._boundingDimensions.x,0,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Wb.a.CreateLines("lines",{points:[new i.e(d._boundingDimensions.x,d._boundingDimensions.y,d._boundingDimensions.z),new i.e(d._boundingDimensions.x,d._boundingDimensions.y,0)]},c.utilityLayerScene)),f.forEach(function(T){T.color=a,T.position.addInPlace(new i.e(-d._boundingDimensions.x/2,-d._boundingDimensions.y/2,-d._boundingDimensions.z/2)),T.isPickable=!1,d._lineBoundingBox.addChild(T)}),d._rootMesh.addChild(d._lineBoundingBox),d.setColor(a),d._rotateSpheresParent=new qb.a("",c.utilityLayerScene),d._rotateSpheresParent.rotationQuaternion=new i.b();for(var g=function(T){var Z=jc.a.CreateSphere("",{diameter:1},c.utilityLayerScene);Z.rotationQuaternion=new i.b(),Z.material=h.coloredMaterial,(z=new Hc.a({})).moveAttached=!1,z.updateDragPlane=!1,Z.addBehavior(z);var _=new i.e(1,0,0),ca=0;z.onDragStartObservable.add(function(){_.copyFrom(Z.forward),ca=0}),z.onDragObservable.add(function(ea){if(d.onRotationSphereDragObservable.notifyObservers({}),d.attachedMesh){var fa=d.attachedMesh.parent;if(fa&&fa.scaling&&fa.scaling.isNonUniformWithinEpsilon(.001))return void k.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");fc.a._RemoveAndStorePivotPoint(d.attachedMesh);var ka=_,pa=ea.dragPlaneNormal.scale(i.e.Dot(ea.dragPlaneNormal,ka)),va=ka.subtract(pa).normalizeToNew(),sa=i.e.Dot(va,ea.delta)<0?Math.abs(ea.delta.length()):-Math.abs(ea.delta.length());sa=sa/d._boundingDimensions.length()*d._anchorMesh.scaling.length(),d.attachedMesh.rotationQuaternion||(d.attachedMesh.rotationQuaternion=i.b.RotationYawPitchRoll(d.attachedMesh.rotation.y,d.attachedMesh.rotation.x,d.attachedMesh.rotation.z)),d._anchorMesh.rotationQuaternion||(d._anchorMesh.rotationQuaternion=i.b.RotationYawPitchRoll(d._anchorMesh.rotation.y,d._anchorMesh.rotation.x,d._anchorMesh.rotation.z)),ca+=sa,Math.abs(ca)<=2*Math.PI&&(T>=8?i.b.RotationYawPitchRollToRef(0,0,sa,d._tmpQuaternion):T>=4?i.b.RotationYawPitchRollToRef(sa,0,0,d._tmpQuaternion):i.b.RotationYawPitchRollToRef(0,sa,0,d._tmpQuaternion),d._anchorMesh.addChild(d.attachedMesh),d._anchorMesh.rotationQuaternion.multiplyToRef(d._tmpQuaternion,d._anchorMesh.rotationQuaternion),d._anchorMesh.removeChild(d.attachedMesh),d.attachedMesh.setParent(fa)),d.updateBoundingBox(),fc.a._RestorePivotPoint(d.attachedMesh)}d._updateDummy()}),z.onDragStartObservable.add(function(){d.onDragStartObservable.notifyObservers({}),d._selectNode(Z)}),z.onDragEndObservable.add(function(){d.onRotationSphereDragEndObservable.notifyObservers({}),d._selectNode(null),d._updateDummy()}),h._rotateSpheresParent.addChild(Z)},h=this,j=0;j<12;j++)g(j);d._rootMesh.addChild(d._rotateSpheresParent),d._scaleBoxesParent=new qb.a("",c.utilityLayerScene),d._scaleBoxesParent.rotationQuaternion=new i.b();for(var m=0;m<2;m++)for(var w=0;w<2;w++)for(var z,C=function(){var T=ue.a.CreateBox("",{size:1},c.utilityLayerScene);T.material=J.coloredMaterial;var Z=new i.e(0==m?-1:1,0==w?-1:1,0==K?-1:1);(z=new Hc.a({dragAxis:Z})).moveAttached=!1,T.addBehavior(z),z.onDragObservable.add(function(_){if(d.onScaleBoxDragObservable.notifyObservers({}),d.attachedMesh){var ca=d.attachedMesh.parent;if(ca&&ca.scaling&&ca.scaling.isNonUniformWithinEpsilon(.001))return void k.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");fc.a._RemoveAndStorePivotPoint(d.attachedMesh);var ea=_.dragDistance/d._boundingDimensions.length()*d._anchorMesh.scaling.length(),fa=new i.e(ea,ea,ea);fa.scaleInPlace(d._scaleDragSpeed),d.updateBoundingBox(),d.scalePivot?(d.attachedMesh.getWorldMatrix().getRotationMatrixToRef(d._tmpRotationMatrix),d._boundingDimensions.scaleToRef(.5,d._tmpVector),i.e.TransformCoordinatesToRef(d._tmpVector,d._tmpRotationMatrix,d._tmpVector),d._anchorMesh.position.subtractInPlace(d._tmpVector),d._boundingDimensions.multiplyToRef(d.scalePivot,d._tmpVector),i.e.TransformCoordinatesToRef(d._tmpVector,d._tmpRotationMatrix,d._tmpVector),d._anchorMesh.position.addInPlace(d._tmpVector)):(T.absolutePosition.subtractToRef(d._anchorMesh.position,d._tmpVector),d._anchorMesh.position.subtractInPlace(d._tmpVector)),d._anchorMesh.addChild(d.attachedMesh),d._anchorMesh.scaling.addInPlace(fa),(d._anchorMesh.scaling.x<0||d._anchorMesh.scaling.y<0||d._anchorMesh.scaling.z<0)&&d._anchorMesh.scaling.subtractInPlace(fa),d._anchorMesh.removeChild(d.attachedMesh),d.attachedMesh.setParent(ca),fc.a._RestorePivotPoint(d.attachedMesh)}d._updateDummy()}),z.onDragStartObservable.add(function(){d.onDragStartObservable.notifyObservers({}),d._selectNode(T)}),z.onDragEndObservable.add(function(){d.onScaleBoxDragEndObservable.notifyObservers({}),d._selectNode(null),d._updateDummy()}),J._scaleBoxesParent.addChild(T)},J=this,K=0;K<2;K++)C();d._rootMesh.addChild(d._scaleBoxesParent);var N=new Array();return d._pointerObserver=c.utilityLayerScene.onPointerObservable.add(function(T){N[T.event.pointerId]?T.pickInfo&&T.pickInfo.pickedMesh!=N[T.event.pointerId]&&(N[T.event.pointerId].material=d.coloredMaterial,delete N[T.event.pointerId]):d._rotateSpheresParent.getChildMeshes().concat(d._scaleBoxesParent.getChildMeshes()).forEach(function(Z){T.pickInfo&&T.pickInfo.pickedMesh==Z&&(N[T.event.pointerId]=Z,Z.material=d.hoverColoredMaterial)})}),d._renderObserver=d.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){d.attachedMesh&&!d._existingMeshScale.equals(d.attachedMesh.scaling)?d.updateBoundingBox():d.fixedDragMeshScreenSize&&(d._updateRotationSpheres(),d._updateScaleBoxes()),d._dragMesh&&d.attachedMesh&&d.pointerDragBehavior.dragging&&(d._lineBoundingBox.position.rotateByQuaternionToRef(d._rootMesh.rotationQuaternion,d._tmpVector),d.attachedMesh.setAbsolutePosition(d._dragMesh.position.add(d._tmpVector.scale(-1))))}),d.updateBoundingBox(),d}return Object(l.d)(b,e),b.prototype.setColor=function(a){this.coloredMaterial.emissiveColor=a,this.hoverColoredMaterial.emissiveColor=a.clone().add(new G.a(.3,.3,.3)),this._lineBoundingBox.getChildren().forEach(function(c){c.color&&(c.color=a)})},b.prototype._attachedMeshChanged=function(a){var c=this;if(a){fc.a._RemoveAndStorePivotPoint(a);var d=a.parent;this._anchorMesh.addChild(a),this._anchorMesh.removeChild(a),a.setParent(d),fc.a._RestorePivotPoint(a),this.updateBoundingBox(),a.getChildMeshes(!1).forEach(function(f){f.markAsDirty("scaling")}),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(function(){c._updateDummy()})}},b.prototype._selectNode=function(a){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(c){c.isVisible=!a||c==a})},b.prototype.updateBoundingBox=function(){if(this.attachedMesh){fc.a._RemoveAndStorePivotPoint(this.attachedMesh);var a=this.attachedMesh.parent;this.attachedMesh.setParent(null);var c=null;this.attachedMesh.skeleton&&(c=this.attachedMesh.skeleton.overrideMesh,this.attachedMesh.skeleton.overrideMesh=null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=i.b.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=i.b.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var d=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);d.max.subtractToRef(d.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((d.max.x+d.min.x)/2,(d.max.y+d.min.y)/2,(d.max.z+d.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(a),this.attachedMesh.skeleton&&(this.attachedMesh.skeleton.overrideMesh=c)}this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),fc.a._RestorePivotPoint(this.attachedMesh))},b.prototype._updateRotationSpheres=function(){for(var a=this._rotateSpheresParent.getChildMeshes(),c=0;c<3;c++)for(var d=0;d<2;d++)for(var f=0;f<2;f++){var g=4*c+2*d+f;if(0==c&&(a[g].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*d,this._boundingDimensions.z*f),a[g].position.addInPlace(new i.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),a[g].lookAt(i.e.Cross(a[g].position.normalizeToNew(),i.e.Right()).normalizeToNew().add(a[g].position))),1==c&&(a[g].position.set(this._boundingDimensions.x*d,this._boundingDimensions.y/2,this._boundingDimensions.z*f),a[g].position.addInPlace(new i.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),a[g].lookAt(i.e.Cross(a[g].position.normalizeToNew(),i.e.Up()).normalizeToNew().add(a[g].position))),2==c&&(a[g].position.set(this._boundingDimensions.x*d,this._boundingDimensions.y*f,this._boundingDimensions.z/2),a[g].position.addInPlace(new i.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),a[g].lookAt(i.e.Cross(a[g].position.normalizeToNew(),i.e.Forward()).normalizeToNew().add(a[g].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){a[g].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var h=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;a[g].scaling.set(h,h,h)}else a[g].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},b.prototype._updateScaleBoxes=function(){for(var a=this._scaleBoxesParent.getChildMeshes(),c=0;c<2;c++)for(var d=0;d<2;d++)for(var f=0;f<2;f++){var g=4*c+2*d+f;if(a[g])if(a[g].position.set(this._boundingDimensions.x*c,this._boundingDimensions.y*d,this._boundingDimensions.z*f),a[g].position.addInPlace(new i.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){a[g].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var h=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;a[g].scaling.set(h,h,h)}else a[g].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize)}},b.prototype.setEnabledRotationAxis=function(a){this._rotateSpheresParent.getChildMeshes().forEach(function(c,d){d<4?c.setEnabled(-1!=a.indexOf("x")):d<8?c.setEnabled(-1!=a.indexOf("y")):c.setEnabled(-1!=a.indexOf("z"))})},b.prototype.setEnabledScaling=function(a){this._scaleBoxesParent.getChildMeshes().forEach(function(c,d){c.setEnabled(a)})},b.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},b.prototype.enableDragBehavior=function(){this._dragMesh=xa.a.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new i.b(),this.pointerDragBehavior.useObjectOrientationForDragging=!1,this._dragMesh.addBehavior(this.pointerDragBehavior)},b.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),e.prototype.dispose.call(this)},b.MakeNotPickableAndWrapInBoundingBox=function(a){var c=function(j){j.isPickable=!1,j.getChildMeshes().forEach(function(m){c(m)})};c(a),a.rotationQuaternion||(a.rotationQuaternion=i.b.RotationYawPitchRoll(a.rotation.y,a.rotation.x,a.rotation.z));var d=a.position.clone(),f=a.rotationQuaternion.clone();a.rotationQuaternion.set(0,0,0,1),a.position.set(0,0,0);var g=ue.a.CreateBox("box",{size:1},a.getScene()),h=a.getHierarchyBoundingVectors();return h.max.subtractToRef(h.min,g.scaling),0===g.scaling.y&&(g.scaling.y=kb.a),0===g.scaling.x&&(g.scaling.x=kb.a),0===g.scaling.z&&(g.scaling.z=kb.a),g.position.set((h.max.x+h.min.x)/2,(h.max.y+h.min.y)/2,(h.max.z+h.min.z)/2),a.addChild(g),a.rotationQuaternion.copyFrom(f),a.position.copyFrom(d),a.removeChild(g),g.addChild(a),g.visibility=0,g},b.prototype.setCustomMesh=function(a){k.a.Error("Custom meshes are not supported on this gizmo")},b}(Qc.a),hf=function(e){function b(a,c,d,f,g,h){void 0===c&&(c=G.a.Gray()),void 0===d&&(d=ic.a.DefaultUtilityLayer),void 0===f&&(f=32),void 0===g&&(g=null),void 0===h&&(h=!1);var j=e.call(this,d)||this;j._pointerObserver=null,j.snapDistance=0,j.onSnapObservable=new I.c(),j._isEnabled=!0,j._parent=null,j._parent=g;var m=new Ab.a("",d.utilityLayerScene);m.diffuseColor=c,m.specularColor=c.subtract(new G.a(.1,.1,.1));var w=new Ab.a("",d.utilityLayerScene);w.diffuseColor=c.add(new G.a(.3,.3,.3));var z=new qb.a("",d.utilityLayerScene),C=xa.a.CreateTorus("",.6,.03,f,d.utilityLayerScene);C.visibility=0;var J=xa.a.CreateTorus("",.6,.005,f,d.utilityLayerScene);J.material=m,J.rotation.x=Math.PI/2,C.rotation.x=Math.PI/2,z.addChild(J),z.addChild(C),z.lookAt(j._rootMesh.position.add(a)),j._rootMesh.addChild(z),z.scaling.scaleInPlace(1/3),j.dragBehavior=new Hc.a({dragPlaneNormal:a}),j.dragBehavior.moveAttached=!1,j.dragBehavior.maxDragAngle=9*Math.PI/20,j.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,j._rootMesh.addBehavior(j.dragBehavior);var K=new i.e();j.dragBehavior.onDragStartObservable.add(function(va){j.attachedMesh&&K.copyFrom(va.dragPlanePoint)});var N=new i.a(),T=new i.e(),Z=new i.e(),_={snapDistance:0},ca=0,ea=new i.a(),fa=new i.e(),ka=new i.b();j.dragBehavior.onDragObservable.add(function(va){if(j.attachedMesh){j.attachedMesh.rotationQuaternion&&!h||(j.attachedMesh.rotationQuaternion=i.b.RotationYawPitchRoll(j.attachedMesh.rotation.y,j.attachedMesh.rotation.x,j.attachedMesh.rotation.z));var sa=j.attachedMesh.parent;sa&&j.attachedMesh.setParent(null);var la=va.dragPlanePoint.subtract(j.attachedMesh.absolutePosition).normalize(),ta=K.subtract(j.attachedMesh.absolutePosition).normalize(),Da=i.e.Cross(la,ta),ua=i.e.Dot(la,ta),Aa=Math.atan2(Da.length(),ua);if(T.copyFrom(a),Z.copyFrom(a),j.updateGizmoRotationToMatchAttachedMesh&&(j.attachedMesh.rotationQuaternion.toRotationMatrix(N),Z=i.e.TransformCoordinates(T,N)),d.utilityLayerScene.activeCamera){var za=d.utilityLayerScene.activeCamera.position.subtract(j.attachedMesh.position);i.e.Dot(za,Z)>0&&(T.scaleInPlace(-1),Z.scaleInPlace(-1))}i.e.Dot(Z,Da)>0&&(Aa=-Aa);var Fa=!1;if(0!=j.snapDistance)if(ca+=Aa,Math.abs(ca)>j.snapDistance){var La=Math.floor(Math.abs(ca)/j.snapDistance);ca<0&&(La*=-1),ca%=j.snapDistance,Aa=j.snapDistance*La,Fa=!0}else Aa=0;ea.reset(),j.attachedMesh.parent&&(j.attachedMesh.parent.computeWorldMatrix().invertToRef(ea),ea.getRotationMatrixToRef(ea),i.e.TransformCoordinatesToRef(T,ea,T));var Ta=Math.sin(Aa/2);ka.set(T.x*Ta,T.y*Ta,T.z*Ta,Math.cos(Aa/2)),ea.determinant()>0&&(ka.toEulerAnglesToRef(fa),i.b.RotationYawPitchRollToRef(fa.y,-fa.x,-fa.z,ka)),j.updateGizmoRotationToMatchAttachedMesh?j.attachedMesh.rotationQuaternion.multiplyToRef(ka,j.attachedMesh.rotationQuaternion):ka.multiplyToRef(j.attachedMesh.rotationQuaternion,j.attachedMesh.rotationQuaternion),h&&(j.attachedMesh.rotationQuaternion.toEulerAnglesToRef(fa),j.attachedMesh.rotationQuaternion=null,j.attachedMesh.rotation.copyFrom(fa)),K.copyFrom(va.dragPlanePoint),Fa&&(_.snapDistance=Aa,j.onSnapObservable.notifyObservers(_)),sa&&j.attachedMesh.setParent(sa)}}),j._pointerObserver=d.utilityLayerScene.onPointerObservable.add(function(va){if(!j._customMeshSet){var sa=va.pickInfo&&-1!=j._rootMesh.getChildMeshes().indexOf(va.pickInfo.pickedMesh)?w:m;j._rootMesh.getChildMeshes().forEach(function(la){la.material=sa,la.color&&(la.color=sa.diffuseColor)})}});var pa=d._getSharedGizmoLight();return pa.includedOnlyMeshes=pa.includedOnlyMeshes.concat(j._rootMesh.getChildMeshes(!1)),j}return Object(l.d)(b,e),b.prototype._attachedMeshChanged=function(a){this.dragBehavior&&(this.dragBehavior.enabled=!!a)},Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled=a,a?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},b}(Qc.a),Gi=function(e){function b(a,c,d){void 0===a&&(a=ic.a.DefaultUtilityLayer),void 0===c&&(c=32),void 0===d&&(d=!1);var f=e.call(this,a)||this;return f.onDragStartObservable=new I.c(),f.onDragEndObservable=new I.c(),f.xGizmo=new hf(new i.e(1,0,0),G.a.Red().scale(.5),a,c,f,d),f.yGizmo=new hf(new i.e(0,1,0),G.a.Green().scale(.5),a,c,f,d),f.zGizmo=new hf(new i.e(0,0,1),G.a.Blue().scale(.5),a,c,f,d),[f.xGizmo,f.yGizmo,f.zGizmo].forEach(function(g){g.dragBehavior.onDragStartObservable.add(function(){f.onDragStartObservable.notifyObservers({})}),g.dragBehavior.onDragEndObservable.add(function(){f.onDragEndObservable.notifyObservers({})})}),f.attachedMesh=null,f}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(a){this._meshAttached=a,[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(c){c.isEnabled?c.attachedMesh=a:c.attachedMesh=null})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(a){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=a,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=a,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(a){this.xGizmo&&(this.xGizmo.snapDistance=a,this.yGizmo.snapDistance=a,this.zGizmo.snapDistance=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(a){this.xGizmo&&(this.xGizmo.scaleRatio=a,this.yGizmo.scaleRatio=a,this.zGizmo.scaleRatio=a)},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},b.prototype.setCustomMesh=function(a){k.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},b}(Qc.a),pd=o(43),zg=o(79),jf=function(e){function b(a,c,d,f){void 0===c&&(c=G.a.Gray()),void 0===d&&(d=ic.a.DefaultUtilityLayer),void 0===f&&(f=null);var g=e.call(this,d)||this;g._pointerObserver=null,g.snapDistance=0,g.onSnapObservable=new I.c(),g._isEnabled=!1,g._parent=null,g._parent=f,g._coloredMaterial=new Ab.a("",d.utilityLayerScene),g._coloredMaterial.diffuseColor=c,g._coloredMaterial.specularColor=c.subtract(new G.a(.1,.1,.1)),g._hoverMaterial=new Ab.a("",d.utilityLayerScene),g._hoverMaterial.diffuseColor=c.add(new G.a(.3,.3,.3)),g._plane=b._CreatePlane(d.utilityLayerScene,g._coloredMaterial),g._plane.lookAt(g._rootMesh.position.add(a)),g._plane.scaling.scaleInPlace(1/3),g._plane.parent=g._rootMesh;var h=0,j=new i.e(),m={snapDistance:0};g.dragBehavior=new Hc.a({dragPlaneNormal:a}),g.dragBehavior.moveAttached=!1,g._rootMesh.addBehavior(g.dragBehavior);var w=new i.e(),z=new i.a();g.dragBehavior.onDragObservable.add(function(J){if(g.attachedMesh){if(g.attachedMesh.parent?(g.attachedMesh.parent.computeWorldMatrix().invertToRef(z),z.setTranslationFromFloats(0,0,0),i.e.TransformCoordinatesToRef(J.delta,z,w)):w.copyFrom(J.delta),0==g.snapDistance)g.attachedMesh.position.addInPlace(w);else if(h+=J.dragDistance,Math.abs(h)>g.snapDistance){var K=Math.floor(Math.abs(h)/g.snapDistance);h%=g.snapDistance,w.normalizeToRef(j),j.scaleInPlace(g.snapDistance*K),g.attachedMesh.position.addInPlace(j),m.snapDistance=g.snapDistance*K,g.onSnapObservable.notifyObservers(m)}}}),g._pointerObserver=d.utilityLayerScene.onPointerObservable.add(function(J){if(!g._customMeshSet){var K=J.pickInfo&&-1!=g._rootMesh.getChildMeshes().indexOf(J.pickInfo.pickedMesh)?g._hoverMaterial:g._coloredMaterial;g._rootMesh.getChildMeshes().forEach(function(N){N.material=K})}});var C=d._getSharedGizmoLight();return C.includedOnlyMeshes=C.includedOnlyMeshes.concat(g._rootMesh.getChildMeshes(!1)),g}return Object(l.d)(b,e),b._CreatePlane=function(a,c){var d=new pd.a("plane",a),f=zg.a.CreatePlane("dragPlane",{width:.1375,height:.1375,sideOrientation:2},a);return f.material=c,f.parent=d,f.material=c,d},b._CreateArrowInstance=function(a,c){for(var d=new pd.a("arrow",a),f=0,g=c.getChildMeshes();f<g.length;f++){var h=g[f];h.createInstance(h.name).parent=d}return d},b.prototype._attachedMeshChanged=function(a){this.dragBehavior&&(this.dragBehavior.enabled=!!a)},Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled=a,a?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this),this._plane&&this._plane.dispose(),[this._coloredMaterial,this._hoverMaterial].forEach(function(a){a&&a.dispose()})},b}(Qc.a),Hi=function(e){function b(a){void 0===a&&(a=ic.a.DefaultUtilityLayer);var c=e.call(this,a)||this;return c._meshAttached=null,c.onDragStartObservable=new I.c(),c.onDragEndObservable=new I.c(),c._planarGizmoEnabled=!1,c.xGizmo=new gf.a(new i.e(1,0,0),G.a.Red().scale(.5),a,c),c.yGizmo=new gf.a(new i.e(0,1,0),G.a.Green().scale(.5),a,c),c.zGizmo=new gf.a(new i.e(0,0,1),G.a.Blue().scale(.5),a,c),c.xPlaneGizmo=new jf(new i.e(1,0,0),G.a.Red().scale(.5),c.gizmoLayer,c),c.yPlaneGizmo=new jf(new i.e(0,1,0),G.a.Green().scale(.5),c.gizmoLayer,c),c.zPlaneGizmo=new jf(new i.e(0,0,1),G.a.Blue().scale(.5),c.gizmoLayer,c),[c.xGizmo,c.yGizmo,c.zGizmo,c.xPlaneGizmo,c.yPlaneGizmo,c.zPlaneGizmo].forEach(function(d){d.dragBehavior.onDragStartObservable.add(function(){c.onDragStartObservable.notifyObservers({})}),d.dragBehavior.onDragEndObservable.add(function(){c.onDragEndObservable.notifyObservers({})})}),c.attachedMesh=null,c}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(a){this._meshAttached=a,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(c){c.isEnabled?c.attachedMesh=a:c.attachedMesh=null})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"planarGizmoEnabled",{get:function(){return this._planarGizmoEnabled},set:function(a){var c=this;this._planarGizmoEnabled=a,[this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(d){d&&(d.isEnabled=a,a&&(d.attachedMesh=c.attachedMesh))},this)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(a){this._updateGizmoRotationToMatchAttachedMesh=a,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(c){c&&(c.updateGizmoRotationToMatchAttachedMesh=a)})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(a){this._snapDistance=a,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(c){c&&(c.snapDistance=a)})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(a){this._scaleRatio=a,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(c){c&&(c.scaleRatio=a)})},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(a){a&&a.dispose()}),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},b.prototype.setCustomMesh=function(a){k.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)")},b}(Qc.a);Xa.a.CreatePolyhedron=function(e){var b=[];b[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},b[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},b[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},b[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},b[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},b[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},b[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},b[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},b[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},b[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},b[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},b[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},b[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},b[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},b[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var a,c,d,f,g,h,j=e.type&&(e.type<0||e.type>=b.length)?0:e.type||0,m=e.size,w=e.sizeX||m||1,z=e.sizeY||m||1,C=e.sizeZ||m||1,J=e.custom||b[j],K=J.face.length,N=e.faceUV||new Array(K),T=e.faceColors,Z=void 0===e.flat||e.flat,_=0===e.sideOrientation?0:e.sideOrientation||Xa.a.DEFAULTSIDE,ca=new Array(),ea=new Array(),fa=new Array(),ka=new Array(),pa=new Array(),va=0,sa=0,la=new Array(),ta=0,Da=0;if(Z)for(Da=0;Da<K;Da++)T&&void 0===T[Da]&&(T[Da]=new G.b(1,1,1,1)),N&&void 0===N[Da]&&(N[Da]=new i.f(0,0,1,1));if(Z)for(Da=0;Da<K;Da++){var ua=J.face[Da].length;for(d=2*Math.PI/ua,f=.5*Math.tan(d/2),g=.5,ta=0;ta<ua;ta++)ca.push(J.vertex[J.face[Da][ta]][0]*w,J.vertex[J.face[Da][ta]][1]*z,J.vertex[J.face[Da][ta]][2]*C),la.push(va),va++,a=N[Da].x+(N[Da].z-N[Da].x)*(.5+f),c=N[Da].y+(N[Da].w-N[Da].y)*(g-.5),ka.push(a,c),h=f*Math.cos(d)-g*Math.sin(d),g=f*Math.sin(d)+g*Math.cos(d),f=h,T&&pa.push(T[Da].r,T[Da].g,T[Da].b,T[Da].a);for(ta=0;ta<ua-2;ta++)ea.push(la[0+sa],la[ta+2+sa],la[ta+1+sa]);sa+=ua}else{for(ta=0;ta<J.vertex.length;ta++)ca.push(J.vertex[ta][0]*w,J.vertex[ta][1]*z,J.vertex[ta][2]*C),ka.push(0,0);for(Da=0;Da<K;Da++)for(ta=0;ta<J.face[Da].length-2;ta++)ea.push(J.face[Da][0],J.face[Da][ta+2],J.face[Da][ta+1])}Xa.a.ComputeNormals(ca,ea,fa),Xa.a._ComputeSides(_,ca,ea,fa,ka,e.frontUVs,e.backUVs);var Aa=new Xa.a();return Aa.positions=ca,Aa.indices=ea,Aa.normals=fa,Aa.uvs=ka,T&&Z&&(Aa.colors=pa),Aa},xa.a.CreatePolyhedron=function(e,b,a){return we.CreatePolyhedron(e,b,a)};var we=function(){function e(){}return e.CreatePolyhedron=function(b,a,c){void 0===c&&(c=null);var d=new xa.a(b,c);return a.sideOrientation=xa.a._GetDefaultSideOrientation(a.sideOrientation),d._originalBuilderSideOrientation=a.sideOrientation,Xa.a.CreatePolyhedron(a).applyToMesh(d,a.updatable),d},e}(),Ii=function(e){function b(a){void 0===a&&(a=ic.a.DefaultUtilityLayer);var c=e.call(this,a)||this;c._meshAttached=null,c._sensitivity=1,c.onDragStartObservable=new I.c(),c.onDragEndObservable=new I.c(),c.xGizmo=new ve(new i.e(1,0,0),G.a.Red().scale(.5),a,c),c.yGizmo=new ve(new i.e(0,1,0),G.a.Green().scale(.5),a,c),c.zGizmo=new ve(new i.e(0,0,1),G.a.Blue().scale(.5),a,c),c.uniformScaleGizmo=new ve(new i.e(0,1,0),G.a.Yellow().scale(.5),a,c),c.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh=!1,c.uniformScaleGizmo.uniformScaling=!0,c._uniformScalingMesh=we.CreatePolyhedron("",{type:1},c.uniformScaleGizmo.gizmoLayer.utilityLayerScene),c._uniformScalingMesh.scaling.scaleInPlace(.02),c._uniformScalingMesh.visibility=0,c._octahedron=we.CreatePolyhedron("",{type:1},c.uniformScaleGizmo.gizmoLayer.utilityLayerScene),c._octahedron.scaling.scaleInPlace(.007),c._uniformScalingMesh.addChild(c._octahedron),c.uniformScaleGizmo.setCustomMesh(c._uniformScalingMesh,!0);var d=a._getSharedGizmoLight();return d.includedOnlyMeshes=d.includedOnlyMeshes.concat(c._octahedron),[c.xGizmo,c.yGizmo,c.zGizmo,c.uniformScaleGizmo].forEach(function(f){f.dragBehavior.onDragStartObservable.add(function(){c.onDragStartObservable.notifyObservers({})}),f.dragBehavior.onDragEndObservable.add(function(){c.onDragEndObservable.notifyObservers({})})}),c.attachedMesh=null,c}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(a){this._meshAttached=a,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(c){c.isEnabled?c.attachedMesh=a:c.attachedMesh=null})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(a){a?(this._updateGizmoRotationToMatchAttachedMesh=a,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(c){c&&(c.updateGizmoRotationToMatchAttachedMesh=a)})):k.a.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported.")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(a){this._snapDistance=a,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(c){c&&(c.snapDistance=a)})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(a){this._scaleRatio=a,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(c){c&&(c.scaleRatio=a)})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(a){this._sensitivity=a,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(c){c&&(c.sensitivity=a)})},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(a){a&&a.dispose()}),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),[this._uniformScalingMesh,this._octahedron].forEach(function(a){a&&a.dispose()})},b}(Qc.a),tm=function(){function e(b){var a=this;this.scene=b,this.clearGizmoOnEmptyPointerEvent=!1,this.onAttachedToMeshObservable=new I.c(),this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObserver=null,this._attachedMesh=null,this._boundingBoxColor=G.a.FromHexString("#0984e3"),this.boundingBoxDragBehavior=new Kh(),this.attachableMeshes=null,this.usePointerToAttachGizmos=!0,this._defaultKeepDepthUtilityLayer=new ic.a(b),this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._defaultUtilityLayer=new ic.a(b),this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null},this._pointerObserver=b.onPointerObservable.add(function(c){if(a.usePointerToAttachGizmos&&c.type==lb.a.POINTERDOWN)if(c.pickInfo&&c.pickInfo.pickedMesh){var d=c.pickInfo.pickedMesh;if(null==a.attachableMeshes)for(;d&&null!=d.parent;)d=d.parent;else{var f=!1;a.attachableMeshes.forEach(function(g){d&&(d==g||d.isDescendantOf(g))&&(d=g,f=!0)}),f||(d=null)}d instanceof qb.a?a._attachedMesh!=d&&a.attachToMesh(d):a.clearGizmoOnEmptyPointerEvent&&a.attachToMesh(null)}else a.clearGizmoOnEmptyPointerEvent&&a.attachToMesh(null)})}return Object.defineProperty(e.prototype,"keepDepthUtilityLayer",{get:function(){return this._defaultKeepDepthUtilityLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"utilityLayer",{get:function(){return this._defaultUtilityLayer},enumerable:!0,configurable:!0}),e.prototype.attachToMesh=function(b){for(var a in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=b,this.gizmos){var c=this.gizmos[a];c&&this._gizmosEnabled[a]&&(c.attachedMesh=b)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(b)},Object.defineProperty(e.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(b){b?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new Hi(this._defaultUtilityLayer)),this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedMesh=null),this._gizmosEnabled.positionGizmo=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(b){b?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new Gi(this._defaultUtilityLayer)),this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedMesh=null),this._gizmosEnabled.rotationGizmo=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(b){b?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new Ii(this._defaultUtilityLayer),this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedMesh=null),this._gizmosEnabled.scaleGizmo=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(b){b?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new Fi(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh,this._attachedMesh&&(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedMesh=null),this._gizmosEnabled.boundingBoxGizmo=b},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var b in this.scene.onPointerObservable.remove(this._pointerObserver),this.gizmos){var a=this.gizmos[b];a&&a.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this._defaultUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},e}(),Zc=o(50),kf=function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;return a._needProjectionMatrixCompute=!0,a}return Object(l.d)(b,e),b.prototype._setPosition=function(a){this._position=a},Object.defineProperty(b.prototype,"position",{get:function(){return this._position},set:function(a){this._setPosition(a)},enumerable:!0,configurable:!0}),b.prototype._setDirection=function(a){this._direction=a},Object.defineProperty(b.prototype,"direction",{get:function(){return this._direction},set:function(a){this._setDirection(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(a){this._shadowMinZ=a,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(a){this._shadowMaxZ=a,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),b.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=i.e.Zero()),i.e.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=i.e.Zero()),i.e.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},b.prototype.getDepthScale=function(){return 50},b.prototype.getShadowDirection=function(a){return this.transformedDirection?this.transformedDirection:this.direction},b.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},b.prototype.setDirectionToTarget=function(a){return this.direction=i.e.Normalize(a.subtract(this.position)),this.direction},b.prototype.getRotation=function(){this.direction.normalize();var a=i.e.Cross(this.direction,Ba.a.Y),c=i.e.Cross(a,this.direction);return i.e.RotationFromAxis(a,c,this.direction)},b.prototype.needCube=function(){return!1},b.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},b.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},b.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=i.e.Zero()},b.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},b.prototype.computeWorldMatrix=function(a){return!a&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=i.a.Identity()),i.a.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},b.prototype.getDepthMinZ=function(a){return void 0!==this.shadowMinZ?this.shadowMinZ:a.minZ},b.prototype.getDepthMaxZ=function(a){return void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ},b.prototype.setShadowProjectionMatrix=function(a,c,d){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(c,d,a):this._setDefaultShadowProjectionMatrix(a,c,d),this},Object(l.c)([Object(F.o)()],b.prototype,"position",null),Object(l.c)([Object(F.o)()],b.prototype,"direction",null),Object(l.c)([Object(F.c)()],b.prototype,"shadowMinZ",null),Object(l.c)([Object(F.c)()],b.prototype,"shadowMaxZ",null),b}(Zc.a);ia.a.AddNodeConstructor("Light_Type_1",function(e,b){return function(){return new Ag(e,i.e.Zero(),b)}});var Ag=function(e){function b(a,c,d){var f=e.call(this,a,d)||this;return f._shadowFrustumSize=0,f._shadowOrthoScale=.1,f.autoUpdateExtends=!0,f.autoCalcShadowZBounds=!1,f._orthoLeft=Number.MAX_VALUE,f._orthoRight=Number.MIN_VALUE,f._orthoTop=Number.MIN_VALUE,f._orthoBottom=Number.MAX_VALUE,f.position=c.scale(-1),f.direction=c,f}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(a){this._shadowFrustumSize=a,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(a){this._shadowOrthoScale=a,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"DirectionalLight"},b.prototype.getTypeID=function(){return Zc.a.LIGHTTYPEID_DIRECTIONALLIGHT},b.prototype._setDefaultShadowProjectionMatrix=function(a,c,d){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(a):this._setDefaultAutoExtendShadowProjectionMatrix(a,c,d)},b.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(a){var c=this.getScene().activeCamera;c&&i.a.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:c.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,a)},b.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(a,c,d){var f=this.getScene().activeCamera;if(f){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var g=i.e.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var h=Number.MAX_VALUE,j=Number.MIN_VALUE,m=0;m<d.length;m++){var w=d[m];if(w)for(var z=w.getBoundingInfo().boundingBox,C=0;C<z.vectorsWorld.length;C++)i.e.TransformCoordinatesToRef(z.vectorsWorld[C],c,g),g.x<this._orthoLeft&&(this._orthoLeft=g.x),g.y<this._orthoBottom&&(this._orthoBottom=g.y),g.x>this._orthoRight&&(this._orthoRight=g.x),g.y>this._orthoTop&&(this._orthoTop=g.y),this.autoCalcShadowZBounds&&(g.z<h&&(h=g.z),g.z>j&&(j=g.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=h,this._shadowMaxZ=j)}var J=this._orthoRight-this._orthoLeft,K=this._orthoTop-this._orthoBottom;i.a.OrthoOffCenterLHToRef(this._orthoLeft-J*this.shadowOrthoScale,this._orthoRight+J*this.shadowOrthoScale,this._orthoBottom-K*this.shadowOrthoScale,this._orthoTop+K*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:f.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,a)}},b.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},b.prototype.transferToEffect=function(a,c){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,c),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,c),this)},b.prototype.transferToNodeMaterialEffect=function(a,c){return this.computeTransformedInformation()?(a.setFloat3(c,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(a.setFloat3(c,this.direction.x,this.direction.y,this.direction.z),this)},b.prototype.getDepthMinZ=function(a){return 1},b.prototype.getDepthMaxZ=function(a){return 1},b.prototype.prepareLightSpecificDefines=function(a,c){a["DIRLIGHT"+c]=!0},Object(l.c)([Object(F.c)()],b.prototype,"shadowFrustumSize",null),Object(l.c)([Object(F.c)()],b.prototype,"shadowOrthoScale",null),Object(l.c)([Object(F.c)()],b.prototype,"autoUpdateExtends",void 0),Object(l.c)([Object(F.c)()],b.prototype,"autoCalcShadowZBounds",void 0),b}(kf);xa.a.CreateHemisphere=function(e,b,a,c){var d={segments:b,diameter:a};return lf.CreateHemisphere(e,d,c)};var lf=function(){function e(){}return e.CreateHemisphere=function(b,a,c){a.diameter||(a.diameter=1),a.segments||(a.segments=16);var d=jc.a.CreateSphere("",{slice:.5,diameter:a.diameter,segments:a.segments},c),f=xa.a.CreateDisc("",a.diameter/2,3*a.segments+(4-a.segments),c);f.rotation.x=-Math.PI/2,f.parent=d;var g=xa.a.MergeMeshes([f,d],!0);return g.name=b,g},e}();ia.a.AddNodeConstructor("Light_Type_2",function(e,b){return function(){return new Bg(e,i.e.Zero(),i.e.Zero(),0,0,b)}});var Bg=function(e){function b(a,c,d,f,g,h){var j=e.call(this,a,h)||this;return j._innerAngle=0,j._projectionTextureMatrix=i.a.Zero(),j._projectionTextureLightNear=1e-06,j._projectionTextureLightFar=1000,j._projectionTextureUpDirection=i.e.Up(),j._projectionTextureViewLightDirty=!0,j._projectionTextureProjectionLightDirty=!0,j._projectionTextureDirty=!0,j._projectionTextureViewTargetVector=i.e.Zero(),j._projectionTextureViewLightMatrix=i.a.Zero(),j._projectionTextureProjectionLightMatrix=i.a.Zero(),j._projectionTextureScalingMatrix=i.a.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),j.position=c,j.direction=d,j.angle=f,j.exponent=g,j}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"angle",{get:function(){return this._angle},set:function(a){this._angle=a,this._cosHalfAngle=Math.cos(.5*a),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(a){this._innerAngle=a,this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(a){this._shadowAngleScale=a,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(a){this._projectionTextureLightNear=a,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(a){this._projectionTextureLightFar=a,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(a){this._projectionTextureUpDirection=a,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(a){var c=this;if(this._projectionTexture!==a&&(this._projectionTexture=a,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady())){var d=this._projectionTexture;d.onLoadObservable&&d.onLoadObservable.addOnce(function(){c._markMeshesAsLightDirty()})}},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"SpotLight"},b.prototype.getTypeID=function(){return Zc.a.LIGHTTYPEID_SPOTLIGHT},b.prototype._setDirection=function(a){e.prototype._setDirection.call(this,a),this._projectionTextureViewLightDirty=!0},b.prototype._setPosition=function(a){e.prototype._setPosition.call(this,a),this._projectionTextureViewLightDirty=!0},b.prototype._setDefaultShadowProjectionMatrix=function(a,c,d){var f=this.getScene().activeCamera;if(f){this._shadowAngleScale=this._shadowAngleScale||1;var g=this._shadowAngleScale*this._angle;i.a.PerspectiveFovLHToRef(g,1,this.getDepthMinZ(f),this.getDepthMaxZ(f),a)}},b.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),i.a.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},b.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var a=this.projectionTextureLightFar,c=this.projectionTextureLightNear,d=a/(a-c),f=-d*c,g=1/Math.tan(this._angle/2);i.a.FromValuesToRef(g/1,0,0,0,0,g,0,0,0,0,d,1,0,0,f,0,this._projectionTextureProjectionLightMatrix)},b.prototype._computeProjectionTextureMatrix=function(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof ya.a){var a=this._projectionTexture.uScale/2,c=this._projectionTexture.vScale/2;i.a.FromValuesToRef(a,0,0,0,0,c,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},b.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},b.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},b.prototype.transferTexturesToEffect=function(a,c){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),a.setMatrix("textureProjectionMatrix"+c,this._projectionTextureMatrix),a.setTexture("projectionLightSampler"+c,this.projectionTexture)),this},b.prototype.transferToEffect=function(a,c){var d;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,c),d=i.e.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,c),d=i.e.Normalize(this.direction)),this.getScene().useRightHandedSystem?this._uniformBuffer.updateFloat4("vLightDirection",-d.x,-d.y,-d.z,this._cosHalfAngle,c):this._uniformBuffer.updateFloat4("vLightDirection",d.x,d.y,d.z,this._cosHalfAngle,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,c),this},b.prototype.transferToNodeMaterialEffect=function(a,c){var d;return d=this.computeTransformedInformation()?i.e.Normalize(this.transformedDirection):i.e.Normalize(this.direction),this.getScene().useRightHandedSystem?a.setFloat3(c,-d.x,-d.y,-d.z):a.setFloat3(c,d.x,d.y,d.z),this},b.prototype.dispose=function(){e.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},b.prototype.prepareLightSpecificDefines=function(a,c){a["SPOTLIGHT"+c]=!0,a["PROJECTEDLIGHTTEXTURE"+c]=!(!this.projectionTexture||!this.projectionTexture.isReady())},Object(l.c)([Object(F.c)()],b.prototype,"angle",null),Object(l.c)([Object(F.c)()],b.prototype,"innerAngle",null),Object(l.c)([Object(F.c)()],b.prototype,"shadowAngleScale",null),Object(l.c)([Object(F.c)()],b.prototype,"exponent",void 0),Object(l.c)([Object(F.c)()],b.prototype,"projectionTextureLightNear",null),Object(l.c)([Object(F.c)()],b.prototype,"projectionTextureLightFar",null),Object(l.c)([Object(F.c)()],b.prototype,"projectionTextureUpDirection",null),Object(l.c)([Object(F.m)("projectedLightTexture")],b.prototype,"_projectionTexture",void 0),b}(kf),um=function(e){function b(a){var c=e.call(this,a)||this;return c._cachedPosition=new i.e(),c._cachedForward=new i.e(0,0,1),c._light=null,c.attachedMesh=new qb.a("",c.gizmoLayer.utilityLayerScene),c._attachedMeshParent=new pd.a("parent",c.gizmoLayer.originalScene),c.attachedMesh.parent=c._attachedMeshParent,c._material=new Ab.a("light",c.gizmoLayer.originalScene),c._material.diffuseColor=new G.a(.5,.5,.5),c._material.specularColor=new G.a(.1,.1,.1),c}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"light",{get:function(){return this._light},set:function(a){var c=this;if(this._light=a,a){this._lightMesh&&this._lightMesh.dispose(),a instanceof _e.a?this._lightMesh=b._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):this._lightMesh=a instanceof Ag?b._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):a instanceof Bg?b._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):b._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene),this._lightMesh.getChildMeshes(!1).forEach(function(f){f.material=c._material}),this._lightMesh.parent=this._rootMesh;var d=this.gizmoLayer._getSharedGizmoLight();d.includedOnlyMeshes=d.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1)),this._lightMesh.rotationQuaternion=new i.b(),this.attachedMesh.reservedDataStore||(this.attachedMesh.reservedDataStore={}),this.attachedMesh.reservedDataStore.lightGizmo=this,a.parent&&this._attachedMeshParent.freezeWorldMatrix(a.parent.getWorldMatrix()),a.position&&(this.attachedMesh.position.copyFrom(a.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)),a.direction&&(this.attachedMesh.setDirection(a.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward)),this._update()}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"material",{get:function(){return this._material},enumerable:!0,configurable:!0}),b.prototype._update=function(){e.prototype._update.call(this),this._light&&(this._light.parent&&this._attachedMeshParent.freezeWorldMatrix(this._light.parent.getWorldMatrix()),this._light.position&&(this.attachedMesh.position.equals(this._cachedPosition)?(this.attachedMesh.position.copyFrom(this._light.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)):(this._light.position.copyFrom(this.attachedMesh.position),this._cachedPosition.copyFrom(this.attachedMesh.position))),this._light.direction&&(i.e.DistanceSquared(this.attachedMesh.forward,this._cachedForward)>.0001?(this._light.direction.copyFrom(this.attachedMesh.forward),this._cachedForward.copyFrom(this.attachedMesh.forward)):i.e.DistanceSquared(this.attachedMesh.forward,this._light.direction)>.0001&&(this.attachedMesh.setDirection(this._light.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward))),this._light.isEnabled()?this._material.diffuseColor.set(this._light.diffuse.r/3,this._light.diffuse.g/3,this._light.diffuse.b/3):this._material.diffuseColor.set(0,0,0))},b.prototype.dispose=function(){this._material.dispose(),e.prototype.dispose.call(this),this._attachedMeshParent.dispose()},b._CreateHemisphericLightMesh=function(a){var c=new xa.a("hemisphereLight",a),d=lf.CreateHemisphere(c.name,{segments:10,diameter:1},a);d.position.z=-.15,d.rotation.x=Math.PI/2,d.parent=c;var f=this._CreateLightLines(3,a);return f.parent=c,f.position.z,c.scaling.scaleInPlace(b._Scale),c.rotation.x=Math.PI/2,c},b._CreatePointLightMesh=function(a){var c=new xa.a("pointLight",a),d=jc.a.CreateSphere(c.name,{segments:10,diameter:1},a);return d.rotation.x=Math.PI/2,d.parent=c,this._CreateLightLines(5,a).parent=c,c.scaling.scaleInPlace(b._Scale),c.rotation.x=Math.PI/2,c},b._CreateSpotLightMesh=function(a){var c=new xa.a("spotLight",a);jc.a.CreateSphere(c.name,{segments:10,diameter:1},a).parent=c;var d=lf.CreateHemisphere(c.name,{segments:10,diameter:2},a);return d.parent=c,d.rotation.x=-Math.PI/2,this._CreateLightLines(2,a).parent=c,c.scaling.scaleInPlace(b._Scale),c.rotation.x=Math.PI/2,c},b._CreateDirectionalLightMesh=function(a){var c=new xa.a("directionalLight",a),d=new xa.a(c.name,a);d.parent=c,jc.a.CreateSphere(c.name,{diameter:1.2,segments:10},a).parent=d;var f=xa.a.CreateCylinder(c.name,6,.3,.3,6,1,a);f.parent=d,(g=f.clone(c.name)).scaling.y=.5,g.position.x+=1.25,(h=f.clone(c.name)).scaling.y=.5,h.position.x+=-1.25;var g,h,j=xa.a.CreateCylinder(c.name,1,0,.6,6,1,a);return j.position.y+=3,j.parent=d,(g=j.clone(c.name)).position.y=1.5,g.position.x+=1.25,(h=j.clone(c.name)).position.y=1.5,h.position.x+=-1.25,d.scaling.scaleInPlace(b._Scale),d.rotation.z=Math.PI/2,d.rotation.y=Math.PI/2,c},b._Scale=.007,b._CreateLightLines=function(a,c){var d=new xa.a("root",c);d.rotation.x=Math.PI/2;var f=new xa.a("linePivot",c);f.parent=d;var g=xa.a.CreateCylinder("line",2,.2,.3,6,1,c);if(g.position.y=g.scaling.y/2+1.2,g.parent=f,a<2)return f;for(var h=0;h<4;h++)(j=f.clone("lineParentClone")).rotation.z=Math.PI/4,j.rotation.y=Math.PI/2+Math.PI/2*h,j.getChildMeshes()[0].scaling.y=.5,j.getChildMeshes()[0].scaling.x=j.getChildMeshes()[0].scaling.z=.8,j.getChildMeshes()[0].position.y=j.getChildMeshes()[0].scaling.y/2+1.2;if(a<3)return d;for(h=0;h<4;h++)(j=f.clone("linePivotClone")).rotation.z=Math.PI/2,j.rotation.y=Math.PI/2*h;if(a<4)return d;for(h=0;h<4;h++){var j;(j=f.clone("linePivotClone")).rotation.z=Math.PI+Math.PI/4,j.rotation.y=Math.PI/2+Math.PI/2*h,j.getChildMeshes()[0].scaling.y=.5,j.getChildMeshes()[0].scaling.x=j.getChildMeshes()[0].scaling.z=.8,j.getChildMeshes()[0].position.y=j.getChildMeshes()[0].scaling.y/2+1.2}return a<5?d:((j=f.clone("linePivotClone")).rotation.z=Math.PI,d)},b}(Qc.a);Pa.a.IncludesShadersStore.kernelBlurVaryingDeclaration="varying vec2 sampleCoord{X};";var vm=`vec4 pack(float depth)
{
const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);
const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);
vec4 res=fract(depth*bit_shift);
res-=res.xxyz*bit_mask;
return res;
}
float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}`;Pa.a.IncludesShadersStore.packingFunctions=vm;var wm=`#ifdef DOF
factor=sampleCoC(sampleCoord{X});
computedWeight=KERNEL_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;
#endif`;Pa.a.IncludesShadersStore.kernelBlurFragment=wm;var xm=`#ifdef DOF
factor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});
computedWeight=KERNEL_DEP_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_DEP_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;
#endif`;Pa.a.IncludesShadersStore.kernelBlurFragment2=xm;var ym=`
uniform sampler2D textureSampler;
uniform vec2 delta;

varying vec2 sampleCenter;
#ifdef DOF
uniform sampler2D circleOfConfusionSampler;
uniform vec2 cameraMinMaxZ;
float sampleDistance(const in vec2 offset) {
float depth=texture2D(circleOfConfusionSampler,offset).g;
return cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth;
}
float sampleCoC(const in vec2 offset) {
float coc=texture2D(circleOfConfusionSampler,offset).r;
return coc;
}
#endif
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
#ifdef PACKEDFLOAT
#include<packingFunctions>
#endif
void main(void)
{
float computedWeight=0.0;
#ifdef PACKEDFLOAT
float blend=0.;
#else
vec4 blend=vec4(0.);
#endif
#ifdef DOF
float sumOfWeights=CENTER_WEIGHT;
float factor=0.0;

#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;
#else
blend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;
#endif
#endif
#include<kernelBlurFragment>[0..varyingCount]
#include<kernelBlurFragment2>[0..depCount]
#ifdef PACKEDFLOAT
gl_FragColor=pack(blend);
#else
gl_FragColor=blend;
#endif
#ifdef DOF
gl_FragColor/=sumOfWeights;
#endif
}`;Pa.a.ShadersStore.kernelBlurPixelShader=ym,Pa.a.IncludesShadersStore.kernelBlurVertex="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};";var zm=`
attribute vec2 position;

uniform vec2 delta;

varying vec2 sampleCenter;
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
const vec2 madd=vec2(0.5,0.5);
void main(void) {
sampleCenter=(position*madd+madd);
#include<kernelBlurVertex>[0..varyingCount]
gl_Position=vec4(position,0.0,1.0);
}`;Pa.a.ShadersStore.kernelBlurVertexShader=zm;var Xb=function(e){function b(a,c,d,f,g,h,j,m,w,z,C){void 0===h&&(h=ya.a.BILINEAR_SAMPLINGMODE),void 0===w&&(w=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===z&&(z=""),void 0===C&&(C=!1);var J=e.call(this,a,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],f,g,h,j,m,null,w,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return J.direction=c,J.blockCompilation=C,J._packedFloat=!1,J._staticDefines="",J._staticDefines=z,J.onApplyObservable.add(function(K){J._outputTexture?K.setFloat2("delta",1/J._outputTexture.width*J.direction.x,1/J._outputTexture.height*J.direction.y):K.setFloat2("delta",1/J.width*J.direction.x,1/J.height*J.direction.y)}),J.kernel=d,J}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"kernel",{get:function(){return this._idealKernel},set:function(a){this._idealKernel!==a&&(a=Math.max(a,1),this._idealKernel=a,this._kernel=this._nearestBestKernel(a),this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(a){this._packedFloat!==a&&(this._packedFloat=a,this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),b.prototype.updateEffect=function(a,c,d,f,g,h){void 0===a&&(a=null),void 0===c&&(c=null),void 0===d&&(d=null),this._updateParameters(g,h)},b.prototype._updateParameters=function(a,c){for(var d=this._kernel,f=(d-1)/2,g=[],h=[],j=0,m=0;m<d;m++){var w=m/(d-1),z=this._gaussianWeight(2*w-1);g[m]=m-f,h[m]=z,j+=z}for(m=0;m<h.length;m++)h[m]/=j;var C=[],J=[],K=[];for(m=0;m<=f;m+=2){var N=Math.min(m+1,Math.floor(f));if(m===N)K.push({o:g[m],w:h[m]});else{var T=N===f,Z=h[m]+h[N]*(T?.5:1),_=g[m]+1/(1+h[m]/h[N]);0===_?(K.push({o:g[m],w:h[m]}),K.push({o:g[m+1],w:h[m+1]})):(K.push({o:_,w:Z}),K.push({o:-_,w:Z}))}}for(m=0;m<K.length;m++)J[m]=K[m].o,C[m]=K[m].w;g=J,h=C;var ca=this.getEngine().getCaps().maxVaryingVectors,ea=Math.max(ca,0)-1,fa=Math.min(g.length,ea),ka="";for(ka+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(ka+="#define CENTER_WEIGHT "+this._glslFloat(h[fa-1])+`\r
`,fa--),m=0;m<fa;m++)ka+="#define KERNEL_OFFSET"+m+" "+this._glslFloat(g[m])+`\r
`,ka+="#define KERNEL_WEIGHT"+m+" "+this._glslFloat(h[m])+`\r
`;var pa=0;for(m=ea;m<g.length;m++)ka+="#define KERNEL_DEP_OFFSET"+pa+" "+this._glslFloat(g[m])+`\r
`,ka+="#define KERNEL_DEP_WEIGHT"+pa+" "+this._glslFloat(h[m])+`\r
`,pa++;this.packedFloat&&(ka+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,e.prototype.updateEffect.call(this,ka,null,null,{varyingCount:fa,depCount:pa},a,c)},b.prototype._nearestBestKernel=function(a){for(var c=Math.round(a),d=0,f=[c,c-1,c+1,c-2,c+2];d<f.length;d++){var g=f[d];if(g%2!=0&&Math.floor(g/2)%2==0&&g>0)return Math.max(g,3)}return Math.max(c,3)},b.prototype._gaussianWeight=function(a){var c=-a*a/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(c)},b.prototype._glslFloat=function(a,c){return void 0===c&&(c=8),a.toFixed(c).replace(/0+$/,"")},b}(gb),Cg=function(e){function b(a,c,d,f,g,h,j){void 0===g&&(g=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=ya.a.BILINEAR_SAMPLINGMODE),void 0===j&&(j=!0);var m=e.call(this,a,c,d,f,!0,g,!1,h,j)||this;return m.scene=d,m.mirrorPlane=new Kd.a(0,1,0,1),m._transformMatrix=i.a.Zero(),m._mirrorMatrix=i.a.Zero(),m._adaptiveBlurKernel=0,m._blurKernelX=0,m._blurKernelY=0,m._blurRatio=1,m.ignoreCameraViewport=!0,m._updateGammaSpace(),m._imageProcessingConfigChangeObserver=d.imageProcessingConfiguration.onUpdateParameters.add(function(){m._updateGammaSpace}),m.onBeforeRenderObservable.add(function(){i.a.ReflectionToRef(m.mirrorPlane,m._mirrorMatrix),m._savedViewMatrix=d.getViewMatrix(),m._mirrorMatrix.multiplyToRef(m._savedViewMatrix,m._transformMatrix),d.setTransformMatrix(m._transformMatrix,d.getProjectionMatrix()),d.clipPlane=m.mirrorPlane,d.getEngine().cullBackFaces=!1,d._mirroredCameraPosition=i.e.TransformCoordinates(d.activeCamera.globalPosition,m._mirrorMatrix)}),m.onAfterRenderObservable.add(function(){d.setTransformMatrix(m._savedViewMatrix,d.getProjectionMatrix()),d.getEngine().cullBackFaces=!0,d._mirroredCameraPosition=null,d.clipPlane=null}),m}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(a){this._blurRatio!==a&&(this._blurRatio=a,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"adaptiveBlurKernel",{set:function(a){this._adaptiveBlurKernel=a,this._autoComputeBlurKernel()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"blurKernel",{set:function(a){this.blurKernelX=a,this.blurKernelY=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(a){this._blurKernelX!==a&&(this._blurKernelX=a,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(a){this._blurKernelY!==a&&(this._blurKernelY=a,this._preparePostProcesses())},enumerable:!0,configurable:!0}),b.prototype._autoComputeBlurKernel=function(){var a=this.getScene().getEngine(),c=this.getRenderWidth()/a.getRenderWidth(),d=this.getRenderHeight()/a.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*c,this.blurKernelY=this._adaptiveBlurKernel*d},b.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},b.prototype._updateGammaSpace=function(){this.gammaSpace=!this.scene.imageProcessingConfiguration.isEnabled||!this.scene.imageProcessingConfiguration.applyByPostProcess},b.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var a=this.getScene().getEngine(),c=a.getCaps().textureFloatRender?p.a.TEXTURETYPE_FLOAT:p.a.TEXTURETYPE_HALF_FLOAT;this._blurX=new Xb("horizontal blur",new i.d(1,0),this._blurKernelX,this._blurRatio,null,ya.a.BILINEAR_SAMPLINGMODE,a,!1,c),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.inputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new Xb("vertical blur",new i.d(0,1),this._blurKernelY,this._blurRatio,null,ya.a.BILINEAR_SAMPLINGMODE,a,!1,c),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},b.prototype.clone=function(){var a=this.getScene();if(!a)return this;var c=this.getSize(),d=new b(this.name,c.width,a,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return d.hasAlpha=this.hasAlpha,d.level=this.level,d.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(d.renderList=this.renderList.slice(0)),d},b.prototype.serialize=function(){if(!this.name)return null;var a=e.prototype.serialize.call(this);return a.mirrorPlane=this.mirrorPlane.asArray(),a},b.prototype.dispose=function(){e.prototype.dispose.call(this),this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)},b}(Jb);ya.a._CreateMirror=function(e,b,a,c){return new Cg(e,b,a,c)};var xe=o(54);Cb.a.prototype._createDepthStencilCubeTexture=function(e,b){var a=new mb.a(this,mb.b.Unknown);if(a.isCube=!0,1===this.webGLVersion)return k.a.Error("Depth cube texture is not supported by WebGL 1."),a;var c=Object(l.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},b),d=this._gl;this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,a,!0),this._setupDepthStencilTexture(a,e,c.generateStencil,c.bilinearFiltering,c.comparisonFunction);for(var f=0;f<6;f++)c.generateStencil?d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d.DEPTH24_STENCIL8,e,e,0,d.DEPTH_STENCIL,d.UNSIGNED_INT_24_8,null):d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d.DEPTH_COMPONENT24,e,e,0,d.DEPTH_COMPONENT,d.UNSIGNED_INT,null);return this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null),a},Cb.a.prototype._partialLoadFile=function(e,b,a,c,d){void 0===d&&(d=null),this._loadFile(e,function(f){a[b]=f,a._internalCount++,6===a._internalCount&&c(a)},void 0,void 0,!0,function(f,g){d&&f&&d(f.status+" "+f.statusText,g)})},Cb.a.prototype._cascadeLoadFiles=function(e,b,a,c){void 0===c&&(c=null);var d=[];d._internalCount=0;for(var f=0;f<6;f++)this._partialLoadFile(a[f],f,d,b,c)},Cb.a.prototype._cascadeLoadImgs=function(e,b,a,c,d){void 0===c&&(c=null);var f=[];f._internalCount=0;for(var g=0;g<6;g++)this._partialLoadImg(a[g],g,f,e,b,c,d)},Cb.a.prototype._partialLoadImg=function(e,b,a,c,d,f,g){var h;void 0===f&&(f=null),h=xe.a.LoadImage(e,function(){h&&(a[b]=h,a._internalCount++,c&&c._removePendingData(h)),6===a._internalCount&&d(a)},function(j,m){c&&c._removePendingData(h),f&&f(j,m)},c?c.offlineProvider:null,g),c&&h&&c._addPendingData(h)},Cb.a.prototype._setCubeMapTextureParams=function(e){var b=this._gl;b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,e?b.LINEAR_MIPMAP_LINEAR:b.LINEAR),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,null)},Cb.a.prototype.createCubeTexture=function(e,b,a,c,d,f,g,h,j,m,w,z){var C=this;void 0===d&&(d=null),void 0===f&&(f=null),void 0===h&&(h=null),void 0===j&&(j=!1),void 0===m&&(m=0),void 0===w&&(w=0),void 0===z&&(z=null);var J=this._gl,K=z||new mb.a(this,mb.b.Cube);K.isCube=!0,K.url=e,K.generateMipMaps=!c,K._lodGenerationScale=m,K._lodGenerationOffset=w,this._doNotHandleContextLost||(K._extension=h,K._files=a);for(var N=e.lastIndexOf("."),T=h||(N>-1?e.substring(N).toLowerCase():""),Z=null,_=0,ca=Cb.a._TextureLoaders;_<ca.length;_++){var ea=ca[_];if(ea.canLoad(T)){Z=ea;break}}if(Z){var fa=function(ka){C._bindTextureDirectly(J.TEXTURE_CUBE_MAP,K,!0),Z.loadCubeData(ka,K,j,d,f)};a&&6===a.length?Z.supportCascades?this._cascadeLoadFiles(b,function(ka){return fa(ka.map(function(pa){return new Uint8Array(pa)}))},a,f):f?f("Textures type does not support cascades."):k.a.Warn("Texture loader does not support cascades."):this._loadFile(e,function(ka){return fa(new Uint8Array(ka))},void 0,void 0,!0,function(ka,pa){f&&ka&&f(ka.status+" "+ka.statusText,pa)})}else{if(!a)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(b,function(ka){var pa=C.needPOTTextures?Cb.a.GetExponentOfTwo(ka[0].width,C._caps.maxCubemapTextureSize):ka[0].width,va=pa,sa=[J.TEXTURE_CUBE_MAP_POSITIVE_X,J.TEXTURE_CUBE_MAP_POSITIVE_Y,J.TEXTURE_CUBE_MAP_POSITIVE_Z,J.TEXTURE_CUBE_MAP_NEGATIVE_X,J.TEXTURE_CUBE_MAP_NEGATIVE_Y,J.TEXTURE_CUBE_MAP_NEGATIVE_Z];C._bindTextureDirectly(J.TEXTURE_CUBE_MAP,K,!0),C._unpackFlipY(!1);for(var la=g?C._getInternalFormat(g):C._gl.RGBA,ta=0;ta<sa.length;ta++)if(ka[ta].width!==pa||ka[ta].height!==va){if(C._prepareWorkingCanvas(),!C._workingCanvas||!C._workingContext)return void k.a.Warn("Cannot create canvas to resize texture.");C._workingCanvas.width=pa,C._workingCanvas.height=va,C._workingContext.drawImage(ka[ta],0,0,ka[ta].width,ka[ta].height,0,0,pa,va),J.texImage2D(sa[ta],0,la,la,J.UNSIGNED_BYTE,C._workingCanvas)}else J.texImage2D(sa[ta],0,la,la,J.UNSIGNED_BYTE,ka[ta]);c||J.generateMipmap(J.TEXTURE_CUBE_MAP),C._setCubeMapTextureParams(!c),K.width=pa,K.height=va,K.isReady=!0,g&&(K.format=g),K.onLoadedObservable.notifyObservers(K),K.onLoadedObservable.clear(),d&&d()},a,f)}return this._internalTexturesCache.push(K),K};var oc=o(36),pc=function(e){function b(a,c,d,f,g,h,j,m,w,z,C,J,K){var N;void 0===d&&(d=null),void 0===f&&(f=!1),void 0===g&&(g=null),void 0===h&&(h=null),void 0===j&&(j=null),void 0===m&&(m=p.a.TEXTUREFORMAT_RGBA),void 0===w&&(w=!1),void 0===z&&(z=null),void 0===C&&(C=!1),void 0===J&&(J=.8),void 0===K&&(K=0);var T=e.call(this,c)||this;if(T.onLoadObservable=new I.c(),T.boundingBoxPosition=i.e.Zero(),T._rotationY=0,T._files=null,T._forcedExtension=null,T._extensions=null,T._prefiltered=!1,T.name=a,T.url=a,T._noMipmap=f,T.hasAlpha=!1,T._format=m,T.isCube=!0,T._textureMatrix=i.a.Identity(),T._createPolynomials=C,T.coordinatesMode=ya.a.CUBIC_MODE,T._extensions=d,T._files=g,T._forcedExtension=z,!a&&!g)return T;var Z=a.lastIndexOf("."),_=z||(Z>-1?a.substring(Z).toLowerCase():""),ca=".dds"===_,ea=".env"===_;if(ea?(T.gammaSpace=!1,T._prefiltered=!1,T.anisotropicFilteringLevel=1):(T._prefiltered=w,w&&(T.gammaSpace=!1,T.anisotropicFilteringLevel=1)),T._texture=T._getFromCache(a,f),!g&&(ea||ca||d||(d=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),g=[],d))for(var fa=0;fa<d.length;fa++)g.push(a+d[fa]);T._files=g;var ka=function(){T.onLoadObservable.notifyObservers(T),h&&h()};return T._texture?T._texture.isReady?Qa.b.SetImmediate(function(){return ka()}):T._texture.onLoadedObservable.add(function(){return ka()}):c.useDelayedTextureLoading?T.delayLoadState=p.a.DELAYLOADSTATE_NOTLOADED:(T._texture=w?c.getEngine().createPrefilteredCubeTexture(a,c,J,K,h,j,m,z,T._createPolynomials):c.getEngine().createCubeTexture(a,c,g,f,h,j,T._format,z,!1,J,K),null===(N=T._texture)||void 0===N||N.onLoadedObservable.add(function(){return T.onLoadObservable.notifyObservers(T)})),T}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(a){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(a)){this._boundingBoxSize=a;var c=this.getScene();c&&c.markAllMaterialsAsDirty(p.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotationY",{get:function(){return this._rotationY},set:function(a){this._rotationY=a,this.setReflectionTextureMatrix(i.a.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),b.CreateFromImages=function(a,c,d){var f="";return a.forEach(function(g){return f+=g}),new b(f,c,null,d,a)},b.CreateFromPrefilteredData=function(a,c,d,f){void 0===d&&(d=null),void 0===f&&(f=!0);var g=c.useDelayedTextureLoading;c.useDelayedTextureLoading=!1;var h=new b(a,c,null,!1,null,null,null,void 0,!0,d,f);return c.useDelayedTextureLoading=g,h},Object.defineProperty(b.prototype,"isPrefiltered",{get:function(){return this._prefiltered},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"CubeTexture"},b.prototype.updateURL=function(a,c,d,f){void 0===f&&(f=!1),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(p.a.MATERIAL_TextureDirtyFlag)),this.name&&!oc.a.StartsWith(this.name,"data:")||(this.name=a),this.url=a,this.delayLoadState=p.a.DELAYLOADSTATE_NOTLOADED,this._prefiltered=f,this._prefiltered&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1),this._forcedExtension=c||null,d&&(this._delayedOnLoad=d),this.delayLoad(c)},b.prototype.delayLoad=function(a){var c,d=this;if(this.delayLoadState===p.a.DELAYLOADSTATE_NOTLOADED){var f=this.getScene();f&&(this.delayLoadState=p.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._prefiltered?this._texture=f.getEngine().createPrefilteredCubeTexture(this.url,f,.8,0,this._delayedOnLoad,void 0,this._format,void 0,this._createPolynomials):this._texture=f.getEngine().createCubeTexture(this.url,f,this._files,this._noMipmap,this._delayedOnLoad,null,this._format,a),null===(c=this._texture)||void 0===c||c.onLoadedObservable.add(function(){return d.onLoadObservable.notifyObservers(d)})))}},b.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},b.prototype.setReflectionTextureMatrix=function(a){var c=this;a.updateFlag!==this._textureMatrix.updateFlag&&(a.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(p.a.MATERIAL_TextureDirtyFlag,function(d){return-1!==d.getActiveTextures().indexOf(c)}),this._textureMatrix=a)},b.Parse=function(a,c,d){var f=F.a.Parse(function(){var m=!1;return a.prefiltered&&(m=a.prefiltered),new b(d+a.name,c,a.extensions,!1,a.files||null,null,null,void 0,m,a.forcedExtension)},a,c);if(a.boundingBoxPosition&&(f.boundingBoxPosition=i.e.FromArray(a.boundingBoxPosition)),a.boundingBoxSize&&(f.boundingBoxSize=i.e.FromArray(a.boundingBoxSize)),a.animations)for(var g=0;g<a.animations.length;g++){var h=a.animations[g],j=D.a.GetClass("BABYLON.Animation");j&&f.animations.push(j.Parse(h))}return f},b.prototype.clone=function(){var a=this,c=this.getScene(),d=0,f=F.a.Clone(function(){if(!c)return a;var g=new b(a.url,c,a._extensions,a._noMipmap,a._files);return d=g.uniqueId,g},this);return f.uniqueId=d,f},Object(l.c)([Object(F.c)("rotationY")],b.prototype,"rotationY",null),Object(l.c)([Object(F.c)("files")],b.prototype,"_files",void 0),Object(l.c)([Object(F.c)("forcedExtension")],b.prototype,"_forcedExtension",void 0),Object(l.c)([Object(F.c)("extensions")],b.prototype,"_extensions",void 0),Object(l.c)([Object(F.j)("textureMatrix")],b.prototype,"_textureMatrix",void 0),b}(hc.a);ya.a._CubeTextureParser=pc.Parse,D.a.RegisteredTypes["BABYLON.CubeTexture"]=pc;var Ua=o(16),mf=o(73),nf=o(81),cb=o(21),Am=` uniform vec4 vPrimaryColor;
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
uniform vec4 vPrimaryColorShadow;
#endif
uniform float shadowLevel;
uniform float alpha;
#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#endif
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif`;Pa.a.IncludesShadersStore.backgroundFragmentDeclaration=Am;var Bm=`layout(std140,column_major) uniform;
uniform Material
{
uniform vec4 vPrimaryColor;
uniform vec4 vPrimaryColorShadow;
uniform vec2 vDiffuseInfos;
uniform vec2 vReflectionInfos;
uniform mat4 diffuseMatrix;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
uniform float pointSize;
uniform float shadowLevel;
uniform float alpha;
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};`;Pa.a.IncludesShadersStore.backgroundUboDeclaration=Bm,o(118),o(97),o(98),o(139),o(117),o(106),o(113),o(101),o(121),o(122);var Cm=`#ifdef TEXTURELODSUPPORT
#extension GL_EXT_shader_texture_lod : enable
#endif
precision highp float;
#include<__decl__backgroundFragment>
#define RECIPROCAL_PI2 0.15915494

uniform vec3 vEyePosition;

varying vec3 vPositionW;
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE;
#endif

#ifndef SHADOWONLY
#define SHADOWONLY;
#endif
#include<imageProcessingDeclaration>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<helperFunctions>
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<imageProcessingFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
#ifdef REFLECTIONFRESNEL
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25
vec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(0.0,1.0,0.0);
#endif

float shadow=1.;
float globalShadow=0.;
float shadowLightCount=0.;
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef SHADOWINUSE
globalShadow/=shadowLightCount;
#else
globalShadow=1.0;
#endif

vec4 reflectionColor=vec4(1.,1.,1.,1.);
#ifdef REFLECTION
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=reflectionVector;
#else
vec2 reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
#ifdef REFLECTIONBLUR
float reflectionLOD=vReflectionInfos.y;
#ifdef TEXTURELODSUPPORT

reflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
reflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#else
float lodReflectionNormalized=saturate(reflectionLOD);
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodReflectionNormalizedDoubled<1.0){
reflectionColor=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
reflectionSpecularMid,
lodReflectionNormalizedDoubled
);
} else {
reflectionColor=mix(
reflectionSpecularMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#else
vec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);
reflectionColor=reflectionSample;
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef GAMMAREFLECTION
reflectionColor.rgb=toLinearSpace(reflectionColor.rgb);
#endif
#ifdef REFLECTIONBGR
reflectionColor.rgb=reflectionColor.bgr;
#endif

reflectionColor.rgb*=vReflectionInfos.x;
#endif

vec3 diffuseColor=vec3(1.,1.,1.);
float finalAlpha=alpha;
#ifdef DIFFUSE
vec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);
#ifdef GAMMADIFFUSE
diffuseMap.rgb=toLinearSpace(diffuseMap.rgb);
#endif

diffuseMap.rgb*=vDiffuseInfos.y;
#ifdef DIFFUSEHASALPHA
finalAlpha*=diffuseMap.a;
#endif
diffuseColor=diffuseMap.rgb;
#endif

#ifdef REFLECTIONFRESNEL
vec3 colorBase=diffuseColor;
#else
vec3 colorBase=reflectionColor.rgb*diffuseColor;
#endif
colorBase=max(colorBase,0.0);

#ifdef USERGBCOLOR
vec3 finalColor=colorBase;
#else
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
vec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);
#else
vec3 mainColor=vPrimaryColor.rgb;
#endif
vec3 finalColor=colorBase*mainColor;
#endif

#ifdef REFLECTIONFRESNEL
vec3 reflectionAmount=vReflectionControl.xxx;
vec3 reflectionReflectance0=vReflectionControl.yyy;
vec3 reflectionReflectance90=vReflectionControl.zzz;
float VdotN=dot(normalize(vEyePosition),normalW);
vec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(saturate(VdotN),reflectionReflectance0,reflectionReflectance90,1.0);
reflectionAmount*=planarReflectionFresnel;
#ifdef REFLECTIONFALLOFF
float reflectionDistanceFalloff=1.0-saturate(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w);
reflectionDistanceFalloff*=reflectionDistanceFalloff;
reflectionAmount*=reflectionDistanceFalloff;
#endif
finalColor=mix(finalColor,reflectionColor.rgb,saturate(reflectionAmount));
#endif
#ifdef OPACITYFRESNEL
float viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));

const float startAngle=0.1;
float fadeFactor=saturate(viewAngleToFloor/startAngle);
finalAlpha*=fadeFactor*fadeFactor;
#endif

#ifdef SHADOWINUSE
finalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);
#endif

vec4 color=vec4(finalColor,finalAlpha);
#include<fogFragment>
#ifdef IMAGEPROCESSINGPOSTPROCESS


color.rgb=clamp(color.rgb,0.,30.0);
#else

color=applyImageProcessing(color);
#endif
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#ifdef NOISE
color.rgb+=dither(vPositionW.xy,0.5);
color=max(color,0.0);
#endif
gl_FragColor=color;
}
`;Pa.a.ShadersStore.backgroundPixelShader=Cm;var Dm=`uniform mat4 view;
uniform mat4 viewProjection;
uniform float shadowLevel;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif`;Pa.a.IncludesShadersStore.backgroundVertexDeclaration=Dm,o(74),o(77),o(108),o(123),o(78),o(75),o(102),o(142),o(124);var Em=`precision highp float;
#include<__decl__backgroundVertex>
#include<helperFunctions>

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
void main(void) {
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=position;
#endif
#include<instancesVertex>
#include<bonesVertex>
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
} else {
gl_Position=viewProjectionR*finalWorld*vec4(position,1.0);
}
#else
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#endif
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normal);
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));
#ifdef EQUIRECTANGULAR_RELFECTION_FOV
mat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));
vec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));
if (fFovMultiplier<=1.0) {
vDirectionW=normalize(segment);
} else {
vDirectionW=normalize(vDirectionW+(vDirectionW-segment));
}
#endif
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uv;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;Pa.a.ShadersStore.backgroundVertexShader=Em;var Nd=o(64),Fm=function(e){function b(){var a=e.call(this)||this;return a.DIFFUSE=!1,a.DIFFUSEDIRECTUV=0,a.GAMMADIFFUSE=!1,a.DIFFUSEHASALPHA=!1,a.OPACITYFRESNEL=!1,a.REFLECTIONBLUR=!1,a.REFLECTIONFRESNEL=!1,a.REFLECTIONFALLOFF=!1,a.TEXTURELODSUPPORT=!1,a.PREMULTIPLYALPHA=!1,a.USERGBCOLOR=!1,a.USEHIGHLIGHTANDSHADOWCOLORS=!1,a.NOISE=!1,a.REFLECTIONBGR=!1,a.IMAGEPROCESSING=!1,a.VIGNETTE=!1,a.VIGNETTEBLENDMODEMULTIPLY=!1,a.VIGNETTEBLENDMODEOPAQUE=!1,a.TONEMAPPING=!1,a.TONEMAPPING_ACES=!1,a.CONTRAST=!1,a.COLORCURVES=!1,a.COLORGRADING=!1,a.COLORGRADING3D=!1,a.SAMPLER3DGREENDEPTH=!1,a.SAMPLER3DBGRMAP=!1,a.IMAGEPROCESSINGPOSTPROCESS=!1,a.EXPOSURE=!1,a.MULTIVIEW=!1,a.REFLECTION=!1,a.REFLECTIONMAP_3D=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.INVERTCUBICMAP=!1,a.REFLECTIONMAP_OPPOSITEZ=!1,a.LODINREFLECTIONALPHA=!1,a.GAMMAREFLECTION=!1,a.RGBDREFLECTION=!1,a.EQUIRECTANGULAR_RELFECTION_FOV=!1,a.MAINUV1=!1,a.MAINUV2=!1,a.UV1=!1,a.UV2=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.SHADOWFLOAT=!1,a.rebuild(),a}return Object(l.d)(b,e),b}(mf.a),Od=function(e){function b(a,c){var d=e.call(this,a,c)||this;return d.primaryColor=G.a.White(),d._primaryColorShadowLevel=0,d._primaryColorHighlightLevel=0,d.reflectionTexture=null,d.reflectionBlur=0,d.diffuseTexture=null,d._shadowLights=null,d.shadowLights=null,d.shadowLevel=0,d.sceneCenter=i.e.Zero(),d.opacityFresnel=!0,d.reflectionFresnel=!1,d.reflectionFalloffDistance=0,d.reflectionAmount=1,d.reflectionReflectance0=.05,d.reflectionReflectance90=.5,d.useRGBColor=!0,d.enableNoise=!1,d._fovMultiplier=1,d.useEquirectangularFOV=!1,d._maxSimultaneousLights=4,d.maxSimultaneousLights=4,d._imageProcessingObserver=null,d.switchToBGR=!1,d._renderTargets=new Ic.a(16),d._reflectionControls=i.f.Zero(),d._white=G.a.White(),d._primaryShadowColor=G.a.Black(),d._primaryHighlightColor=G.a.Black(),d._attachImageProcessingConfiguration(null),d.getRenderTargetTextures=function(){return d._renderTargets.reset(),d._diffuseTexture&&d._diffuseTexture.isRenderTarget&&d._renderTargets.push(d._diffuseTexture),d._reflectionTexture&&d._reflectionTexture.isRenderTarget&&d._renderTargets.push(d._reflectionTexture),d._renderTargets},d}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(a){this.__perceptualColor=a,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(a){this._primaryColorShadowLevel=a,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(a){this._primaryColorHighlightLevel=a,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"reflectionStandardFresnelWeight",{set:function(a){var c=a;c<.5?(c*=2,this.reflectionReflectance0=b.StandardReflectance0*c,this.reflectionReflectance90=b.StandardReflectance90*c):(c=2*c-1,this.reflectionReflectance0=b.StandardReflectance0+(1-b.StandardReflectance0)*c,this.reflectionReflectance90=b.StandardReflectance90+(1-b.StandardReflectance90)*c)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(a){isNaN(a)&&(a=1),this._fovMultiplier=Math.max(0,Math.min(2,a))},enumerable:!0,configurable:!0}),b.prototype._attachImageProcessingConfiguration=function(a){var c=this;a!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=a||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){c._computePrimaryColorFromPerceptualColor(),c._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(b.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(a){this._attachImageProcessingConfiguration(a),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(a){this.imageProcessingConfiguration.colorCurvesEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(a){this.imageProcessingConfiguration.colorGradingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(a){this._imageProcessingConfiguration.toneMappingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(a){this._imageProcessingConfiguration.exposure=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(a){this._imageProcessingConfiguration.contrast=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(a){this.imageProcessingConfiguration.colorGradingTexture=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(a){this.imageProcessingConfiguration.colorCurves=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hasRenderTargetTextures",{get:function(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),b.prototype.needAlphaTesting=function(){return!0},b.prototype.needAlphaBlending=function(){return this.alpha<0||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},b.prototype.isReadyForSubMesh=function(a,c,d){var f=this;if(void 0===d&&(d=!1),c.effect&&this.isFrozen&&c.effect._wasPreviouslyReady)return!0;c._materialDefines||(c._materialDefines=new Fm());var g=this.getScene(),h=c._materialDefines;if(!this.checkReadyOnEveryCall&&c.effect&&h._renderId===g.getRenderId())return!0;var j=g.getEngine();if(Ua.a.PrepareDefinesForLights(g,a,h,!1,this._maxSimultaneousLights),h._needNormals=!0,Ua.a.PrepareDefinesForMultiview(g,h),h._areTexturesDirty){if(h._needUVs=!1,g.texturesEnabled){if(g.getEngine().getCaps().textureLOD&&(h.TEXTURELODSUPPORT=!0),this._diffuseTexture&&cb.a.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;Ua.a.PrepareDefinesForMergedUV(this._diffuseTexture,h,"DIFFUSE"),h.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,h.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,h.OPACITYFRESNEL=this._opacityFresnel}else h.DIFFUSE=!1,h.DIFFUSEHASALPHA=!1,h.GAMMADIFFUSE=!1,h.OPACITYFRESNEL=!1;var m=this._reflectionTexture;if(m&&cb.a.ReflectionTextureEnabled){if(!m.isReadyOrNotBlocking())return!1;switch(h.REFLECTION=!0,h.GAMMAREFLECTION=m.gammaSpace,h.RGBDREFLECTION=m.isRGBD,h.REFLECTIONBLUR=this._reflectionBlur>0,h.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!m.invertZ:m.invertZ,h.LODINREFLECTIONALPHA=m.lodLevelInAlpha,h.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,h.REFLECTIONBGR=this.switchToBGR,m.coordinatesMode===ya.a.INVCUBIC_MODE&&(h.INVERTCUBICMAP=!0),h.REFLECTIONMAP_3D=m.isCube,m.coordinatesMode){case ya.a.EXPLICIT_MODE:h.REFLECTIONMAP_EXPLICIT=!0;break;case ya.a.PLANAR_MODE:h.REFLECTIONMAP_PLANAR=!0;break;case ya.a.PROJECTION_MODE:h.REFLECTIONMAP_PROJECTION=!0;break;case ya.a.SKYBOX_MODE:h.REFLECTIONMAP_SKYBOX=!0;break;case ya.a.SPHERICAL_MODE:h.REFLECTIONMAP_SPHERICAL=!0;break;case ya.a.EQUIRECTANGULAR_MODE:h.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case ya.a.FIXED_EQUIRECTANGULAR_MODE:h.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case ya.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:h.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case ya.a.CUBIC_MODE:case ya.a.INVCUBIC_MODE:default:h.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(h.REFLECTIONFRESNEL=!0,h.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(h.REFLECTIONFRESNEL=!1,h.REFLECTIONFALLOFF=!1)}else h.REFLECTION=!1,h.REFLECTIONFRESNEL=!1,h.REFLECTIONFALLOFF=!1,h.REFLECTIONBLUR=!1,h.REFLECTIONMAP_3D=!1,h.REFLECTIONMAP_SPHERICAL=!1,h.REFLECTIONMAP_PLANAR=!1,h.REFLECTIONMAP_CUBIC=!1,h.REFLECTIONMAP_PROJECTION=!1,h.REFLECTIONMAP_SKYBOX=!1,h.REFLECTIONMAP_EXPLICIT=!1,h.REFLECTIONMAP_EQUIRECTANGULAR=!1,h.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,h.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,h.INVERTCUBICMAP=!1,h.REFLECTIONMAP_OPPOSITEZ=!1,h.LODINREFLECTIONALPHA=!1,h.GAMMAREFLECTION=!1,h.RGBDREFLECTION=!1}h.PREMULTIPLYALPHA=this.alphaMode===p.a.ALPHA_PREMULTIPLIED||this.alphaMode===p.a.ALPHA_PREMULTIPLIED_PORTERDUFF,h.USERGBCOLOR=this._useRGBColor,h.NOISE=this._enableNoise}if(h._areLightsDirty&&(h.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(0!==this._primaryColorShadowLevel||0!==this._primaryColorHighlightLevel)),h._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(h)}if(Ua.a.PrepareDefinesForMisc(a,g,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),h),Ua.a.PrepareDefinesForFrameBoundValues(g,j,h,d),Ua.a.PrepareDefinesForAttributes(a,h,!1,!0,!1)&&a&&(g.getEngine().getCaps().standardDerivatives||a.isVerticesDataPresent(ra.b.NormalKind)||(a.createNormals(!0),k.a.Warn("BackgroundMaterial: Normals have been created for the mesh: "+a.name))),h.isDirty){h.markAsProcessed(),g.resetCachedMaterial();var w=new Nd.a();h.FOG&&w.addFallback(0,"FOG"),h.POINTSIZE&&w.addFallback(1,"POINTSIZE"),h.MULTIVIEW&&w.addFallback(0,"MULTIVIEW"),Ua.a.HandleFallbacksForShadows(h,w,this._maxSimultaneousLights);var z=[ra.b.PositionKind];h.NORMAL&&z.push(ra.b.NormalKind),h.UV1&&z.push(ra.b.UVKind),h.UV2&&z.push(ra.b.UV2Kind),Ua.a.PrepareAttributesForBones(z,a,h,w),Ua.a.PrepareAttributesForInstances(z,h);var C=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],J=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],K=["Material","Scene"];Sb.a&&(Sb.a.PrepareUniforms(C,h),Sb.a.PrepareSamplers(J,h)),Ua.a.PrepareUniformsAndSamplersList({uniformsNames:C,uniformBuffersNames:K,samplers:J,defines:h,maxSimultaneousLights:this._maxSimultaneousLights});var N=h.toString();c.setEffect(g.getEngine().createEffect("background",{attributes:z,uniformsNames:C,uniformBuffersNames:K,samplers:J,defines:N,fallbacks:w,onCompiled:function(T){f.onCompiled&&f.onCompiled(T),f.bindSceneUniformBuffer(T,g.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},j),h),this.buildUniformLayout()}return!(!c.effect||!c.effect.isReady())&&(h._renderId=g.getRenderId(),c.effect._wasPreviouslyReady=!0,!0)},b.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},b.prototype._computePrimaryColors=function(){0===this._primaryColorShadowLevel&&0===this._primaryColorHighlightLevel||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},b.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},b.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),e.prototype.unbind.call(this)},b.prototype.bindOnlyWorldMatrix=function(a){this._activeEffect.setMatrix("world",a)},b.prototype.bindForSubMesh=function(a,c,d){var f=this.getScene(),g=d._materialDefines;if(g){var h=d.effect;if(h){this._activeEffect=h,this.bindOnlyWorldMatrix(a),Ua.a.BindBonesParameters(c,this._activeEffect);var j=this._mustRebind(f,h,c.visibility);if(j){this._uniformBuffer.bindToEffect(h,"Material"),this.bindViewProjection(h);var m=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(f.texturesEnabled&&(this._diffuseTexture&&cb.a.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),Ua.a.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),m&&cb.a.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",m.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",m.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",m.getSize().width,m.lodGenerationScale,m.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),g.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),f.texturesEnabled&&(this._diffuseTexture&&cb.a.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),m&&cb.a.ReflectionTextureEnabled&&(g.REFLECTIONBLUR&&g.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",m):g.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",m._lodTextureMid||m),this._uniformBuffer.setTexture("reflectionSamplerLow",m._lodTextureLow||m),this._uniformBuffer.setTexture("reflectionSamplerHigh",m._lodTextureHigh||m)):this._uniformBuffer.setTexture("reflectionSampler",m),g.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),Ua.a.BindClipPlane(this._activeEffect,f),Ua.a.BindEyePosition(h,f)}!j&&this.isFrozen||(f.lightsEnabled&&Ua.a.BindLights(f,c,this._activeEffect,g,this._maxSimultaneousLights,!1),this.bindView(h),Ua.a.BindFogParameters(f,c,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(c,this._activeEffect)}}},b.prototype.hasTexture=function(a){return!!e.prototype.hasTexture.call(this,a)||(this._reflectionTexture===a||this._diffuseTexture===a)},b.prototype.dispose=function(a,c){void 0===a&&(a=!1),void 0===c&&(c=!1),c&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,a)},b.prototype.clone=function(a){var c=this;return F.a.Clone(function(){return new b(a,c.getScene())},this)},b.prototype.serialize=function(){var a=F.a.Serialize(this);return a.customType="BABYLON.BackgroundMaterial",a},b.prototype.getClassName=function(){return"BackgroundMaterial"},b.Parse=function(a,c,d){return F.a.Parse(function(){return new b(a.name,c)},a,c,d)},b.StandardReflectance0=.05,b.StandardReflectance90=.5,Object(l.c)([Object(F.e)()],b.prototype,"_primaryColor",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsLightsDirty")],b.prototype,"primaryColor",void 0),Object(l.c)([Object(F.e)()],b.prototype,"__perceptualColor",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_primaryColorShadowLevel",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_primaryColorHighlightLevel",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsLightsDirty")],b.prototype,"primaryColorHighlightLevel",null),Object(l.c)([Object(F.m)()],b.prototype,"_reflectionTexture",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionTexture",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_reflectionBlur",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionBlur",void 0),Object(l.c)([Object(F.m)()],b.prototype,"_diffuseTexture",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"diffuseTexture",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"shadowLights",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_shadowLevel",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"shadowLevel",void 0),Object(l.c)([Object(F.o)()],b.prototype,"_sceneCenter",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"sceneCenter",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_opacityFresnel",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"opacityFresnel",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_reflectionFresnel",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionFresnel",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_reflectionFalloffDistance",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionFalloffDistance",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_reflectionAmount",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionAmount",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_reflectionReflectance0",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionReflectance0",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_reflectionReflectance90",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionReflectance90",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_useRGBColor",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRGBColor",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_enableNoise",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"enableNoise",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_maxSimultaneousLights",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"maxSimultaneousLights",void 0),Object(l.c)([Object(F.i)()],b.prototype,"_imageProcessingConfiguration",void 0),b}(nf.a);D.a.RegisteredTypes["BABYLON.BackgroundMaterial"]=Od;var Dg=function(){function e(b,a){var c=this;this._errorHandler=function(d,f){c.onErrorObservable.notifyObservers({message:d,exception:f})},this._options=Object(l.a)(Object(l.a)({},e._getDefaultOptions()),b),this._scene=a,this.onErrorObservable=new I.c(),this._setupBackground(),this._setupImageProcessing()}return e._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new G.a(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:p.a.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-05,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new G.a(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:i.e.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(e.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skybox",{get:function(){return this._skybox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ground",{get:function(){return this._ground},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!0,configurable:!0}),e.prototype.updateOptions=function(b){var a=Object(l.a)(Object(l.a)({},this._options),b);this._ground&&!a.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!a.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=a.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!a.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!a.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=a.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!a.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=a.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=a,this._setupBackground(),this._setupImageProcessing()},e.prototype.setMainColor=function(b){this.groundMaterial&&(this.groundMaterial.primaryColor=b),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=b),this.groundMirror&&(this.groundMirror.clearColor=new G.b(b.r,b.g,b.b,1))},e.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},e.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof hc.a)this._scene.environmentTexture=this._options.environmentTexture;else{var b=pc.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=b}},e.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new xa.a("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var b=this._getSceneSize();this._options.createGround&&(this._setupGround(b),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(b),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(b),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=b.rootPosition.x,this._rootMesh.position.z=b.rootPosition.z,this._rootMesh.position.y=b.rootPosition.y},e.prototype._getSceneSize=function(){var b=this,a=this._options.groundSize,c=this._options.skyboxSize,d=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:a,skyboxSize:c,rootPosition:d};var f=this._scene.getWorldExtends(function(j){return j!==b._ground&&j!==b._rootMesh&&j!==b._skybox}),g=f.max.subtract(f.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof jd&&this._scene.activeCamera.upperRadiusLimit&&(c=a=2*this._scene.activeCamera.upperRadiusLimit);var h=g.length();h>a&&(c=a=2*h),a*=1.1,c*=1.5,(d=f.min.add(g.scale(.5))).y=f.min.y-this._options.groundYBias}return{groundSize:a,skyboxSize:c,rootPosition:d}},e.prototype._setupGround=function(b){var a=this;this._ground&&!this._ground.isDisposed()||(this._ground=xa.a.CreatePlane("BackgroundPlane",b.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){a._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},e.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new Od("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=p.a.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},e.prototype._setupGroundDiffuseTexture=function(){if(this._groundMaterial&&!this._groundTexture)if(this._options.groundTexture instanceof hc.a)this._groundMaterial.diffuseTexture=this._options.groundTexture;else{var b=new ya.a(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler);b.gammaSpace=!1,b.hasAlpha=!0,this._groundMaterial.diffuseTexture=b}},e.prototype._setupGroundMirrorTexture=function(b){var a=ya.a.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new Cg("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,ya.a.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new Kd.a(0,-1,0,b.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=a,this._groundMirror.wrapV=a,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var c=0;c<this._scene.meshes.length;c++){var d=this._scene.meshes[c];d!==this._ground&&d!==this._skybox&&d!==this._rootMesh&&this._groundMirror.renderList.push(d)}this._groundMirror.clearColor=new G.b(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},e.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},e.prototype._setupSkybox=function(b){var a=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=xa.a.CreateBox("BackgroundSkybox",b.skyboxSize,this._scene,void 0,xa.a.BACKSIDE),this._skybox.onDisposeObservable.add(function(){a._skybox=null})),this._skybox.parent=this._rootMesh},e.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new Od("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},e.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof hc.a?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new pc(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=ya.a.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},e.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},e._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",e._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",e._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",e}(),Gm=function(e){function b(a,c,d,f,g){void 0===g&&(g=null);var h=e.call(this,a,f)||this;h._useDirectMapping=!1,h.onLoadErrorObservable=new I.c(),h._imageMode=b.MODE_MONOSCOPIC,h._onBeforeCameraRenderObserver=null,a=a||"photoDome",d.resolution=0|Math.abs(d.resolution)||32,d.size=Math.abs(d.size)||(f.activeCamera?.48*f.activeCamera.maxZ:1000),void 0===d.useDirectMapping?h._useDirectMapping=!0:h._useDirectMapping=d.useDirectMapping,void 0===d.faceForward&&(d.faceForward=!0),h._setReady(!1);var j=h._material=new Od(a+"_material",f);if(h._mesh=xa.a.CreateSphere(a+"_mesh",d.resolution,d.size,f,!1,xa.a.BACKSIDE),j.opacityFresnel=!1,j.useEquirectangularFOV=!0,j.fovMultiplier=1,h.photoTexture=new ya.a(c,f,!0,!h._useDirectMapping,void 0,void 0,function(C,J){h.onLoadErrorObservable.notifyObservers(C||"Unknown error occured"),g&&g(C,J)}),h.photoTexture.anisotropicFilteringLevel=1,h.photoTexture.onLoadObservable.addOnce(function(){h._setReady(!0)}),h._mesh.material=j,h._mesh.parent=h,d.faceForward&&f.activeCamera){var m=f.activeCamera,w=i.e.Forward(),z=i.e.TransformNormal(w,m.getViewMatrix());z.normalize(),h.rotation.y=Math.acos(i.e.Dot(w,z))}return h}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"photoTexture",{get:function(){return this._photoTexture},set:function(a){this._photoTexture!==a&&(this._photoTexture=a,this._useDirectMapping?(this._photoTexture.wrapU=ya.a.CLAMP_ADDRESSMODE,this._photoTexture.wrapV=ya.a.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._photoTexture):(this._photoTexture.coordinatesMode=ya.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._photoTexture.wrapV=ya.a.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._photoTexture))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(a){this._material.fovMultiplier=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"imageMode",{get:function(){return this._imageMode},set:function(a){this._imageMode!==a&&this._changeImageMode(a)},enumerable:!0,configurable:!0}),b.prototype._changeImageMode=function(a){var c=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._imageMode=a,this._photoTexture.uScale=1,this._photoTexture.vScale=1,this._photoTexture.uOffset=0,this._photoTexture.vOffset=0,a){case b.MODE_SIDEBYSIDE:this._photoTexture.uScale=.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(d){c._photoTexture.uOffset=d.isRightCamera?.5:0});break;case b.MODE_TOPBOTTOM:this._photoTexture.vScale=.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(d){c._photoTexture.vOffset=d.isRightCamera?.5:0})}},b.prototype.dispose=function(a,c){void 0===c&&(c=!1),this._photoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this.onLoadErrorObservable.clear(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),e.prototype.dispose.call(this,a,c)},b.MODE_MONOSCOPIC=0,b.MODE_TOPBOTTOM=1,b.MODE_SIDEBYSIDE=2,b}(pd.a),Ji=function(){function e(){}return e.ExpandRGBDTexture=function(b){var a=b._texture;if(a&&b.isRGBD){var c=a.getEngine(),d=c.getCaps(),f=!1;d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?(f=!0,a.type=p.a.TEXTURETYPE_HALF_FLOAT):d.textureFloatRender&&d.textureFloatLinearFiltering&&(f=!0,a.type=p.a.TEXTURETYPE_FLOAT),f&&(a.isReady=!1,a._isRGBD=!1,a.invertY=!1),b.onLoadObservable.addOnce(function(){if(f){var g=new gb("rgbdDecode","rgbdDecode",null,null,1,null,p.a.TEXTURE_TRILINEAR_SAMPLINGMODE,c,!1,void 0,a.type,void 0,null,!1),h=c.createRenderTargetTexture(a.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:a.samplingMode,type:a.type,format:p.a.TEXTUREFORMAT_RGBA});g.getEffect().executeWhenCompiled(function(){g.onApply=function(j){j._bindTexture("textureSampler",a),j.setFloat2("scale",1,1)},b.getScene().postProcessManager.directRender([g],h,!0),c.restoreDefaultFramebuffer(),c._releaseTexture(a),c._releaseFramebufferObjects(h),g&&g.dispose(),h._swapAndDie(a),a.isReady=!0})}})}},e}(),Eg=function(){function e(){}return e.GetEnvironmentBRDFTexture=function(b){if(!b.environmentBRDFTexture){var a=b.useDelayedTextureLoading;b.useDelayedTextureLoading=!1;var c=b._blockEntityCollection;b._blockEntityCollection=!1;var d=ya.a.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture",b,!0,!1,ya.a.BILINEAR_SAMPLINGMODE);b._blockEntityCollection=c;var f=b.getEngine().getLoadedTexturesCache(),g=f.indexOf(d.getInternalTexture());-1!==g&&f.splice(g,1),d.isRGBD=!0,d.wrapU=ya.a.CLAMP_ADDRESSMODE,d.wrapV=ya.a.CLAMP_ADDRESSMODE,b.environmentBRDFTexture=d,b.useDelayedTextureLoading=a,Ji.ExpandRGBDTexture(d)}return b.environmentBRDFTexture},e._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==",e}(),of=function(){function e(b){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=e._DefaultIndexOfRefraction,this.indexOfRefraction=e._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=G.a.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=b}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(b,a,c,d){if(b._areTexturesDirty&&a.texturesEnabled){if(this._texture&&cb.a.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(c.getCaps().standardDerivatives&&this._bumpTexture&&cb.a.ClearCoatBumpTextureEnabled&&!d&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&cb.a.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0},e.prototype.prepareDefines=function(b,a){this._isEnabled?(b.CLEARCOAT=!0,b._areTexturesDirty&&a.texturesEnabled&&(this._texture&&cb.a.ClearCoatTextureEnabled?Ua.a.PrepareDefinesForMergedUV(this._texture,b,"CLEARCOAT_TEXTURE"):b.CLEARCOAT_TEXTURE=!1,this._bumpTexture&&cb.a.ClearCoatBumpTextureEnabled?Ua.a.PrepareDefinesForMergedUV(this._bumpTexture,b,"CLEARCOAT_BUMP"):b.CLEARCOAT_BUMP=!1,b.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===e._DefaultIndexOfRefraction,this._isTintEnabled?(b.CLEARCOAT_TINT=!0,this._tintTexture&&cb.a.ClearCoatTintTextureEnabled?Ua.a.PrepareDefinesForMergedUV(this._tintTexture,b,"CLEARCOAT_TINT_TEXTURE"):b.CLEARCOAT_TINT_TEXTURE=!1):(b.CLEARCOAT_TINT=!1,b.CLEARCOAT_TINT_TEXTURE=!1))):(b.CLEARCOAT=!1,b.CLEARCOAT_TEXTURE=!1,b.CLEARCOAT_BUMP=!1,b.CLEARCOAT_TINT=!1,b.CLEARCOAT_TINT_TEXTURE=!1)},e.prototype.bindForSubMesh=function(b,a,c,d,f,g,h){if(!b.useUbo||!f||!b.isSync){this._texture&&cb.a.ClearCoatTextureEnabled&&(b.updateFloat2("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level),Ua.a.BindTextureMatrix(this._texture,b,"clearCoat")),this._bumpTexture&&c.getCaps().standardDerivatives&&cb.a.ClearCoatTextureEnabled&&!d&&(b.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),Ua.a.BindTextureMatrix(this._bumpTexture,b,"clearCoatBump"),a._mirroredCameraPosition?b.updateFloat2("vClearCoatTangentSpaceParams",g?1:-1,h?1:-1):b.updateFloat2("vClearCoatTangentSpaceParams",g?-1:1,h?-1:1)),this._tintTexture&&cb.a.ClearCoatTintTextureEnabled&&(b.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),Ua.a.BindTextureMatrix(this._tintTexture,b,"clearCoatTint")),b.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var j=1-this._indexOfRefraction,m=1+this._indexOfRefraction,w=Math.pow(-j/m,2),z=1/this._indexOfRefraction;b.updateFloat4("vClearCoatRefractionParams",w,z,j,m),this._isTintEnabled&&(b.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-05,this.tintThickness)),b.updateFloat("clearCoatColorAtDistance",Math.max(1e-05,this.tintColorAtDistance)))}a.texturesEnabled&&(this._texture&&cb.a.ClearCoatTextureEnabled&&b.setTexture("clearCoatSampler",this._texture),this._bumpTexture&&c.getCaps().standardDerivatives&&cb.a.ClearCoatBumpTextureEnabled&&!d&&b.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&cb.a.ClearCoatTintTextureEnabled&&b.setTexture("clearCoatTintSampler",this._tintTexture))},e.prototype.hasTexture=function(b){return this._texture===b||(this._bumpTexture===b||this._tintTexture===b)},e.prototype.getActiveTextures=function(b){this._texture&&b.push(this._texture),this._bumpTexture&&b.push(this._bumpTexture),this._tintTexture&&b.push(this._tintTexture)},e.prototype.getAnimatables=function(b){this._texture&&this._texture.animations&&this._texture.animations.length>0&&b.push(this._texture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&b.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&b.push(this._tintTexture)},e.prototype.dispose=function(b){b&&(this._texture&&this._texture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._tintTexture&&this._tintTexture.dispose())},e.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},e.AddFallbacks=function(b,a,c){return b.CLEARCOAT_BUMP&&a.addFallback(c++,"CLEARCOAT_BUMP"),b.CLEARCOAT_TINT&&a.addFallback(c++,"CLEARCOAT_TINT"),b.CLEARCOAT&&a.addFallback(c++,"CLEARCOAT"),c},e.AddUniforms=function(b){b.push("vClearCoatTangentSpaceParams","vClearCoatParams","vClearCoatRefractionParams","vClearCoatTintParams","clearCoatColorAtDistance","clearCoatMatrix","clearCoatBumpMatrix","clearCoatTintMatrix","vClearCoatInfos","vClearCoatBumpInfos","vClearCoatTintInfos")},e.AddSamplers=function(b){b.push("clearCoatSampler","clearCoatBumpSampler","clearCoatTintSampler")},e.PrepareUniformBuffer=function(b){b.addUniform("vClearCoatParams",2),b.addUniform("vClearCoatRefractionParams",4),b.addUniform("vClearCoatInfos",2),b.addUniform("clearCoatMatrix",16),b.addUniform("vClearCoatBumpInfos",2),b.addUniform("vClearCoatTangentSpaceParams",2),b.addUniform("clearCoatBumpMatrix",16),b.addUniform("vClearCoatTintParams",4),b.addUniform("clearCoatColorAtDistance",1),b.addUniform("vClearCoatTintInfos",2),b.addUniform("clearCoatTintMatrix",16)},e.prototype.copyTo=function(b){F.a.Clone(function(){return b},this)},e.prototype.serialize=function(){return F.a.Serialize(this)},e.prototype.parse=function(b,a,c){var d=this;F.a.Parse(function(){return d},b,a,c)},e._DefaultIndexOfRefraction=1.5,Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),Object(l.c)([Object(F.c)()],e.prototype,"intensity",void 0),Object(l.c)([Object(F.c)()],e.prototype,"roughness",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"indexOfRefraction",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"bumpTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isTintEnabled",void 0),Object(l.c)([Object(F.e)()],e.prototype,"tintColor",void 0),Object(l.c)([Object(F.c)()],e.prototype,"tintColorAtDistance",void 0),Object(l.c)([Object(F.c)()],e.prototype,"tintThickness",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"tintTexture",void 0),e}(),Pd=function(){function e(b){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new i.d(1,0),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=b}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(b,a){return!(b._areTexturesDirty&&a.texturesEnabled&&this._texture&&cb.a.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},e.prototype.prepareDefines=function(b,a,c){this._isEnabled?(b.ANISOTROPIC=this._isEnabled,this._isEnabled&&!a.isVerticesDataPresent(ra.b.TangentKind)&&(b._needUVs=!0,b.MAINUV1=!0),b._areTexturesDirty&&c.texturesEnabled&&(this._texture&&cb.a.AnisotropicTextureEnabled?Ua.a.PrepareDefinesForMergedUV(this._texture,b,"ANISOTROPIC_TEXTURE"):b.ANISOTROPIC_TEXTURE=!1)):(b.ANISOTROPIC=!1,b.ANISOTROPIC_TEXTURE=!1)},e.prototype.bindForSubMesh=function(b,a,c){b.useUbo&&c&&b.isSync||(this._texture&&cb.a.AnisotropicTextureEnabled&&(b.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),Ua.a.BindTextureMatrix(this._texture,b,"anisotropy")),b.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),a.texturesEnabled&&this._texture&&cb.a.AnisotropicTextureEnabled&&b.setTexture("anisotropySampler",this._texture)},e.prototype.hasTexture=function(b){return this._texture===b},e.prototype.getActiveTextures=function(b){this._texture&&b.push(this._texture)},e.prototype.getAnimatables=function(b){this._texture&&this._texture.animations&&this._texture.animations.length>0&&b.push(this._texture)},e.prototype.dispose=function(b){b&&this._texture&&this._texture.dispose()},e.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},e.AddFallbacks=function(b,a,c){return b.ANISOTROPIC&&a.addFallback(c++,"ANISOTROPIC"),c},e.AddUniforms=function(b){b.push("vAnisotropy","vAnisotropyInfos","anisotropyMatrix")},e.PrepareUniformBuffer=function(b){b.addUniform("vAnisotropy",3),b.addUniform("vAnisotropyInfos",2),b.addUniform("anisotropyMatrix",16)},e.AddSamplers=function(b){b.push("anisotropySampler")},e.prototype.copyTo=function(b){F.a.Clone(function(){return b},this)},e.prototype.serialize=function(){return F.a.Serialize(this)},e.prototype.parse=function(b,a,c){var d=this;F.a.Parse(function(){return d},b,a,c)},Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),Object(l.c)([Object(F.c)()],e.prototype,"intensity",void 0),Object(l.c)([Object(F.n)()],e.prototype,"direction",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),e}(),Hm=function(){function e(b){this._useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=e.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=e.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=b}return e.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},e.prototype.prepareDefines=function(b){b.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,b.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,b.SPHERICAL_HARMONICS=this._useSphericalHarmonics,b.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation},e.prototype.getClassName=function(){return"PBRBRDFConfiguration"},e.prototype.copyTo=function(b){F.a.Clone(function(){return b},this)},e.prototype.serialize=function(){return F.a.Serialize(this)},e.prototype.parse=function(b,a,c){var d=this;F.a.Parse(function(){return d},b,a,c)},e.DEFAULT_USE_ENERGY_CONSERVATION=!0,e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,e.DEFAULT_USE_SPHERICAL_HARMONICS=!0,e.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useEnergyConservation",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSmithVisibilityHeightCorrelated",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSphericalHarmonics",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),e}(),ye=function(){function e(b){this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=G.a.White(),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=b}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(b,a){return!(b._areTexturesDirty&&a.texturesEnabled&&this._texture&&cb.a.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())},e.prototype.prepareDefines=function(b,a){this._isEnabled?(b.SHEEN=this._isEnabled,b.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,b._areTexturesDirty&&a.texturesEnabled&&(this._texture&&cb.a.SheenTextureEnabled?Ua.a.PrepareDefinesForMergedUV(this._texture,b,"SHEEN_TEXTURE"):b.SHEEN_TEXTURE=!1)):(b.SHEEN=!1,b.SHEEN_TEXTURE=!1,b.SHEEN_LINKWITHALBEDO=!1)},e.prototype.bindForSubMesh=function(b,a,c){b.useUbo&&c&&b.isSync||(this._texture&&cb.a.SheenTextureEnabled&&(b.updateFloat2("vSheenInfos",this._texture.coordinatesIndex,this._texture.level),Ua.a.BindTextureMatrix(this._texture,b,"sheen")),b.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity)),a.texturesEnabled&&this._texture&&cb.a.SheenTextureEnabled&&b.setTexture("sheenSampler",this._texture)},e.prototype.hasTexture=function(b){return this._texture===b},e.prototype.getActiveTextures=function(b){this._texture&&b.push(this._texture)},e.prototype.getAnimatables=function(b){this._texture&&this._texture.animations&&this._texture.animations.length>0&&b.push(this._texture)},e.prototype.dispose=function(b){b&&this._texture&&this._texture.dispose()},e.prototype.getClassName=function(){return"PBRSheenConfiguration"},e.AddFallbacks=function(b,a,c){return b.SHEEN&&a.addFallback(c++,"SHEEN"),c},e.AddUniforms=function(b){b.push("vSheenColor","vSheenInfos","sheenMatrix")},e.PrepareUniformBuffer=function(b){b.addUniform("vSheenColor",4),b.addUniform("vSheenInfos",2),b.addUniform("sheenMatrix",16)},e.AddSamplers=function(b){b.push("sheenSampler")},e.prototype.copyTo=function(b){F.a.Clone(function(){return b},this)},e.prototype.serialize=function(){return F.a.Serialize(this)},e.prototype.parse=function(b,a,c){var d=this;F.a.Parse(function(){return d},b,a,c)},Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkSheenWithAlbedo",void 0),Object(l.c)([Object(F.c)()],e.prototype,"intensity",void 0),Object(l.c)([Object(F.e)()],e.prototype,"color",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),e}(),ze=function(){function e(b){this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isScatteringEnabled=!1,this.refractionIntensity=1,this.translucencyIntensity=1,this.scatteringIntensity=1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1,this.indexOfRefraction=1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.tintColor=G.a.White(),this.tintColorAtDistance=1,this.diffusionDistance=G.a.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._internalMarkAllSubMeshesAsTexturesDirty=b}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(b,a){if(b._areTexturesDirty&&a.texturesEnabled){if(this._thicknessTexture&&cb.a.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var c=this._getRefractionTexture(a);if(c&&cb.a.RefractionTextureEnabled&&!c.isReadyOrNotBlocking())return!1}return!0},e.prototype.prepareDefines=function(b,a){if(b._areTexturesDirty&&(b.SUBSURFACE=!1,b.SS_TRANSLUCENCY=this._isTranslucencyEnabled,b.SS_SCATERRING=this._isScatteringEnabled,b.SS_THICKNESSANDMASK_TEXTURE=!1,b.SS_MASK_FROM_THICKNESS_TEXTURE=!1,b.SS_REFRACTION=!1,b.SS_REFRACTIONMAP_3D=!1,b.SS_GAMMAREFRACTION=!1,b.SS_RGBDREFRACTION=!1,b.SS_LINEARSPECULARREFRACTION=!1,b.SS_REFRACTIONMAP_OPPOSITEZ=!1,b.SS_LODINREFRACTIONALPHA=!1,b.SS_LINKREFRACTIONTOTRANSPARENCY=!1,(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)&&(b.SUBSURFACE=!0,b._areTexturesDirty&&a.texturesEnabled&&this._thicknessTexture&&cb.a.ThicknessTextureEnabled&&Ua.a.PrepareDefinesForMergedUV(this._thicknessTexture,b,"SS_THICKNESSANDMASK_TEXTURE"),b.SS_MASK_FROM_THICKNESS_TEXTURE=this._useMaskFromThicknessTexture),this._isRefractionEnabled&&a.texturesEnabled)){var c=this._getRefractionTexture(a);c&&cb.a.RefractionTextureEnabled&&(b.SS_REFRACTION=!0,b.SS_REFRACTIONMAP_3D=c.isCube,b.SS_GAMMAREFRACTION=c.gammaSpace,b.SS_RGBDREFRACTION=c.isRGBD,b.SS_LINEARSPECULARREFRACTION=c.linearSpecularLOD,b.SS_REFRACTIONMAP_OPPOSITEZ=c.invertZ,b.SS_LODINREFRACTIONALPHA=c.lodLevelInAlpha,b.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency)}},e.prototype.bindForSubMesh=function(b,a,c,d,f){var g=this._getRefractionTexture(a);if(!b.useUbo||!d||!b.isSync){if(this._thicknessTexture&&cb.a.ThicknessTextureEnabled&&(b.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),Ua.a.BindTextureMatrix(this._thicknessTexture,b,"thickness")),b.updateFloat2("vThicknessParam",this.minimumThickness,this.maximumThickness-this.minimumThickness),g&&cb.a.RefractionTextureEnabled){b.updateMatrix("refractionMatrix",g.getReflectionTextureMatrix());var h=1;g.isCube||g.depth&&(h=g.depth),b.updateFloat4("vRefractionInfos",g.level,1/this._indexOfRefraction,h,this._invertRefractionY?-1:1),b.updateFloat3("vRefractionMicrosurfaceInfos",g.getSize().width,g.lodGenerationScale,g.lodGenerationOffset)}b.updateColor3("vDiffusionDistance",this.diffusionDistance),b.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,this.tintColorAtDistance),b.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,this.scatteringIntensity)}a.texturesEnabled&&(this._thicknessTexture&&cb.a.ThicknessTextureEnabled&&b.setTexture("thicknessSampler",this._thicknessTexture),g&&cb.a.RefractionTextureEnabled&&(f?b.setTexture("refractionSampler",g):(b.setTexture("refractionSampler",g._lodTextureMid||g),b.setTexture("refractionSamplerLow",g._lodTextureLow||g),b.setTexture("refractionSamplerHigh",g._lodTextureHigh||g))))},e.prototype.unbind=function(b){return!(!this._refractionTexture||!this._refractionTexture.isRenderTarget)&&(b.setTexture("refractionSampler",null),!0)},e.prototype._getRefractionTexture=function(b){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?b.environmentTexture:null},Object.defineProperty(e.prototype,"disableAlphaBlending",{get:function(){return this.isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!0,configurable:!0}),e.prototype.fillRenderTargetTextures=function(b){cb.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&b.push(this._refractionTexture)},e.prototype.hasTexture=function(b){return this._thicknessTexture===b||this._refractionTexture===b},e.prototype.hasRenderTargetTextures=function(){return!!(cb.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},e.prototype.getActiveTextures=function(b){this._thicknessTexture&&b.push(this._thicknessTexture),this._refractionTexture&&b.push(this._refractionTexture)},e.prototype.getAnimatables=function(b){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&b.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&b.push(this._refractionTexture)},e.prototype.dispose=function(b){b&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},e.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},e.AddFallbacks=function(b,a,c){return b.SS_SCATERRING&&a.addFallback(c++,"SS_SCATERRING"),b.SS_TRANSLUCENCY&&a.addFallback(c++,"SS_TRANSLUCENCY"),c},e.AddUniforms=function(b){b.push("vDiffusionDistance","vTintColor","vSubSurfaceIntensity","vRefractionMicrosurfaceInfos","vRefractionInfos","vThicknessInfos","vThicknessParam","refractionMatrix","thicknessMatrix")},e.AddSamplers=function(b){b.push("thicknessSampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},e.PrepareUniformBuffer=function(b){b.addUniform("vRefractionMicrosurfaceInfos",3),b.addUniform("vRefractionInfos",4),b.addUniform("refractionMatrix",16),b.addUniform("vThicknessInfos",2),b.addUniform("thicknessMatrix",16),b.addUniform("vThicknessParam",2),b.addUniform("vDiffusionDistance",3),b.addUniform("vTintColor",4),b.addUniform("vSubSurfaceIntensity",3)},e.prototype.copyTo=function(b){F.a.Clone(function(){return b},this)},e.prototype.serialize=function(){return F.a.Serialize(this)},e.prototype.parse=function(b,a,c){var d=this;F.a.Parse(function(){return d},b,a,c)},Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isRefractionEnabled",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isTranslucencyEnabled",void 0),Object(l.c)([Object(F.c)()],e.prototype,"refractionIntensity",void 0),Object(l.c)([Object(F.c)()],e.prototype,"translucencyIntensity",void 0),Object(l.c)([Object(F.c)()],e.prototype,"scatteringIntensity",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"thicknessTexture",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"refractionTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"indexOfRefraction",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"invertRefractionY",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkRefractionWithTransparency",void 0),Object(l.c)([Object(F.c)()],e.prototype,"minimumThickness",void 0),Object(l.c)([Object(F.c)()],e.prototype,"maximumThickness",void 0),Object(l.c)([Object(F.e)()],e.prototype,"tintColor",void 0),Object(l.c)([Object(F.c)()],e.prototype,"tintColorAtDistance",void 0),Object(l.c)([Object(F.e)()],e.prototype,"diffusionDistance",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useMaskFromThicknessTexture",void 0),e}(),Im=`uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;

uniform vec4 vLightingIntensity;
uniform vec4 vReflectivityColor;
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef ALBEDO
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform vec4 vAmbientInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
#endif

#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION)
uniform mat4 view;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif

#ifdef CLEARCOAT
uniform vec2 vClearCoatParams;
uniform vec4 vClearCoatRefractionParams;
#ifdef CLEARCOAT_TEXTURE
uniform vec2 vClearCoatInfos;
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;
uniform vec2 vClearCoatTangentSpaceParams;
uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT
uniform vec4 vClearCoatTintParams;
uniform float clearCoatColorAtDistance;
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
#endif
#endif
#endif

#ifdef ANISOTROPIC
uniform vec3 vAnisotropy;
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
#endif
#endif

#ifdef SHEEN
uniform vec4 vSheenColor;
#ifdef SHEEN_TEXTURE
uniform vec2 vSheenInfos;
uniform mat4 sheenMatrix;
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
#endif
uniform vec2 vThicknessParam;
uniform vec3 vDiffusionDistance;
uniform vec4 vTintColor;
uniform vec3 vSubSurfaceIntensity;
#endif`;Pa.a.IncludesShadersStore.pbrFragmentDeclaration=Im;var Jm=`layout(std140,column_major) uniform;
uniform Material
{
uniform vec2 vAlbedoInfos;
uniform vec4 vAmbientInfos;
uniform vec2 vOpacityInfos;
uniform vec2 vEmissiveInfos;
uniform vec2 vLightmapInfos;
uniform vec3 vReflectivityInfos;
uniform vec2 vMicroSurfaceSamplerInfos;
uniform vec2 vReflectionInfos;
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
uniform vec3 vBumpInfos;
uniform mat4 albedoMatrix;
uniform mat4 ambientMatrix;
uniform mat4 opacityMatrix;
uniform mat4 emissiveMatrix;
uniform mat4 lightmapMatrix;
uniform mat4 reflectivityMatrix;
uniform mat4 microSurfaceSamplerMatrix;
uniform mat4 bumpMatrix;
uniform vec2 vTangentSpaceParams;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;
uniform vec4 vLightingIntensity;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float pointSize;
uniform vec4 vReflectivityColor;
uniform vec3 vEmissiveColor;
uniform float visibility;
uniform vec2 vClearCoatParams;
uniform vec4 vClearCoatRefractionParams;
uniform vec2 vClearCoatInfos;
uniform mat4 clearCoatMatrix;
uniform vec2 vClearCoatBumpInfos;
uniform vec2 vClearCoatTangentSpaceParams;
uniform mat4 clearCoatBumpMatrix;
uniform vec4 vClearCoatTintParams;
uniform float clearCoatColorAtDistance;
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
uniform vec3 vAnisotropy;
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
uniform vec4 vSheenColor;
uniform vec2 vSheenInfos;
uniform mat4 sheenMatrix;
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
uniform vec2 vThicknessParam;
uniform vec3 vDiffusionDistance;
uniform vec4 vTintColor;
uniform vec3 vSubSurfaceIntensity;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};`;Pa.a.IncludesShadersStore.pbrUboDeclaration=Jm;var Km=`uniform vec4 vEyePosition;
uniform vec3 vAmbientColor;
uniform vec4 vCameraInfos;

varying vec3 vPositionW;
#if DEBUGMODE>0
uniform vec2 vDebugMode;
varying vec4 vClipSpacePosition;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif`;Pa.a.IncludesShadersStore.pbrFragmentExtraDeclaration=Km;var Lm=`#ifdef ALBEDO
#if ALBEDODIRECTUV == 1
#define vAlbedoUV vMainUV1
#elif ALBEDODIRECTUV == 2
#define vAlbedoUV vMainUV2
#else
varying vec2 vAlbedoUV;
#endif
uniform sampler2D albedoSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFLECTIVITY
#if REFLECTIVITYDIRECTUV == 1
#define vReflectivityUV vMainUV1
#elif REFLECTIVITYDIRECTUV == 2
#define vReflectivityUV vMainUV2
#else
varying vec2 vReflectivityUV;
#endif
uniform sampler2D reflectivitySampler;
#endif
#ifdef MICROSURFACEMAP
#if MICROSURFACEMAPDIRECTUV == 1
#define vMicroSurfaceSamplerUV vMainUV1
#elif MICROSURFACEMAPDIRECTUV == 2
#define vMicroSurfaceSamplerUV vMainUV2
#else
varying vec2 vMicroSurfaceSamplerUV;
#endif
uniform sampler2D microSurfaceSampler;
#endif
#ifdef CLEARCOAT
#ifdef CLEARCOAT_TEXTURE
#if CLEARCOAT_TEXTUREDIRECTUV == 1
#define vClearCoatUV vMainUV1
#elif CLEARCOAT_TEXTUREDIRECTUV == 2
#define vClearCoatUV vMainUV2
#else
varying vec2 vClearCoatUV;
#endif
uniform sampler2D clearCoatSampler;
#endif
#ifdef CLEARCOAT_BUMP
#if CLEARCOAT_BUMPDIRECTUV == 1
#define vClearCoatBumpUV vMainUV1
#elif CLEARCOAT_BUMPDIRECTUV == 2
#define vClearCoatBumpUV vMainUV2
#else
varying vec2 vClearCoatBumpUV;
#endif
uniform sampler2D clearCoatBumpSampler;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
#if CLEARCOAT_TINT_TEXTUREDIRECTUV == 1
#define vClearCoatTintUV vMainUV1
#elif CLEARCOAT_TINT_TEXTUREDIRECTUV == 2
#define vClearCoatTintUV vMainUV2
#else
varying vec2 vClearCoatTintUV;
#endif
uniform sampler2D clearCoatTintSampler;
#endif
#endif
#ifdef SHEEN
#ifdef SHEEN_TEXTURE
#if SHEEN_TEXTUREDIRECTUV == 1
#define vSheenUV vMainUV1
#elif SHEEN_TEXTUREDIRECTUV == 2
#define vSheenUV vMainUV2
#else
varying vec2 vSheenUV;
#endif
uniform sampler2D sheenSampler;
#endif
#endif
#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
#if ANISOTROPIC_TEXTUREDIRECTUV == 1
#define vAnisotropyUV vMainUV1
#elif ANISOTROPIC_TEXTUREDIRECTUV == 2
#define vAnisotropyUV vMainUV2
#else
varying vec2 vAnisotropyUV;
#endif
uniform sampler2D anisotropySampler;
#endif
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#ifdef USEIRRADIANCEMAP
uniform samplerCube irradianceSampler;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform sampler2D reflectionSamplerLow;
uniform sampler2D reflectionSamplerHigh;
#endif
#ifdef USEIRRADIANCEMAP
uniform sampler2D irradianceSampler;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#endif
#ifdef ENVIRONMENTBRDF
uniform sampler2D environmentBrdfSampler;
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
#ifdef SS_REFRACTIONMAP_3D
#define sampleRefraction(s,c) textureCube(s,c)
uniform samplerCube refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube refractionSamplerLow;
uniform samplerCube refractionSamplerHigh;
#endif
#else
#define sampleRefraction(s,c) texture2D(s,c)
uniform sampler2D refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube refractionSamplerLow;
uniform samplerCube refractionSamplerHigh;
#endif
#endif
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
#if SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 1
#define vThicknessUV vMainUV1
#elif SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 2
#define vThicknessUV vMainUV2
#else
varying vec2 vThicknessUV;
#endif
uniform sampler2D thicknessSampler;
#endif
#endif`;Pa.a.IncludesShadersStore.pbrFragmentSamplersDeclaration=Lm,o(107);var Mm=`
#define RECIPROCAL_PI2 0.15915494
#define RECIPROCAL_PI 0.31830988618

#define MINIMUMVARIANCE 0.0005
float convertRoughnessToAverageSlope(float roughness)
{

return square(roughness)+MINIMUMVARIANCE;
}
float fresnelGrazingReflectance(float reflectance0) {


float reflectance90=saturate(reflectance0*25.0);
return reflectance90;
}
vec2 getAARoughnessFactors(vec3 normalVector) {
#ifdef SPECULARAA
vec3 nDfdx=dFdx(normalVector.xyz);
vec3 nDfdy=dFdy(normalVector.xyz);
float slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));

float geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);

float geometricAlphaGFactor=sqrt(slopeSquare);

geometricAlphaGFactor*=0.75;
return vec2(geometricRoughnessFactor,geometricAlphaGFactor);
#else
return vec2(0.);
#endif
}
#ifdef ANISOTROPIC


vec2 getAnisotropicRoughness(float alphaG,float anisotropy) {
float alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);
float alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);
return vec2(alphaT,alphaB);
}


vec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {
vec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;
vec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);
vec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);
vec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));
return anisotropicNormal;

}
#endif
#if defined(CLEARCOAT) || defined(SS_REFRACTION)



vec3 cocaLambert(vec3 alpha,float distance) {
return exp(-alpha*distance);
}

vec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {
return cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));
}

vec3 computeColorAtDistanceInMedia(vec3 color,float distance) {
return -log(color)/distance;
}
vec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {
vec3 clearCoatAbsorption=mix(vec3(1.0),
cocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),
clearCoatIntensity);
return clearCoatAbsorption;
}
#endif




#ifdef MICROSURFACEAUTOMATIC
float computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)
{
const float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;
float reflectivityLuminance=getLuminance(reflectivityColor);
float reflectivityLuma=sqrt(reflectivityLuminance);
microSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;
return microSurface;
}
#endif`;Pa.a.IncludesShadersStore.pbrHelperFunctions=Mm;var Nm=`#ifdef USESPHERICALFROMREFLECTIONMAP
#ifdef SPHERICAL_HARMONICS
uniform vec3 vSphericalL00;
uniform vec3 vSphericalL1_1;
uniform vec3 vSphericalL10;
uniform vec3 vSphericalL11;
uniform vec3 vSphericalL2_2;
uniform vec3 vSphericalL2_1;
uniform vec3 vSphericalL20;
uniform vec3 vSphericalL21;
uniform vec3 vSphericalL22;







vec3 computeEnvironmentIrradiance(vec3 normal) {
return vSphericalL00
+vSphericalL1_1*(normal.y)
+vSphericalL10*(normal.z)
+vSphericalL11*(normal.x)
+vSphericalL2_2*(normal.y*normal.x)
+vSphericalL2_1*(normal.y*normal.z)
+vSphericalL20*((3.0*normal.z*normal.z)-1.0)
+vSphericalL21*(normal.z*normal.x)
+vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));
}
#else
uniform vec3 vSphericalX;
uniform vec3 vSphericalY;
uniform vec3 vSphericalZ;
uniform vec3 vSphericalXX_ZZ;
uniform vec3 vSphericalYY_ZZ;
uniform vec3 vSphericalZZ;
uniform vec3 vSphericalXY;
uniform vec3 vSphericalYZ;
uniform vec3 vSphericalZX;

vec3 computeEnvironmentIrradiance(vec3 normal) {









float Nx=normal.x;
float Ny=normal.y;
float Nz=normal.z;
vec3 C1=vSphericalZZ.rgb;
vec3 Cx=vSphericalX.rgb;
vec3 Cy=vSphericalY.rgb;
vec3 Cz=vSphericalZ.rgb;
vec3 Cxx_zz=vSphericalXX_ZZ.rgb;
vec3 Cyy_zz=vSphericalYY_ZZ.rgb;
vec3 Cxy=vSphericalXY.rgb;
vec3 Cyz=vSphericalYZ.rgb;
vec3 Czx=vSphericalZX.rgb;
vec3 a1=Cyy_zz*Ny+Cy;
vec3 a2=Cyz*Nz+a1;
vec3 b1=Czx*Nz+Cx;
vec3 b2=Cxy*Ny+b1;
vec3 b3=Cxx_zz*Nx+b2;
vec3 t1=Cz*Nz+C1;
vec3 t2=a2*Ny+t1;
vec3 t3=b3*Nx+t2;
return t3;
}
#endif
#endif`;Pa.a.IncludesShadersStore.harmonicsFunctions=Nm;var Om=`
struct preLightingInfo
{

vec3 lightOffset;
float lightDistanceSquared;
float lightDistance;

float attenuation;

vec3 L;
vec3 H;
float NdotV;
float NdotLUnclamped;
float NdotL;
float VdotH;
float roughness;
};
preLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;

result.lightOffset=lightData.xyz-vPositionW;
result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);

result.lightDistance=sqrt(result.lightDistanceSquared);

result.L=normalize(result.lightOffset);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
result.NdotLUnclamped=dot(N,result.L);
result.NdotL=saturateEps(result.NdotLUnclamped);
return result;
}
preLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;

result.lightDistance=length(-lightData.xyz);

result.L=normalize(-lightData.xyz);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
result.NdotLUnclamped=dot(N,result.L);
result.NdotL=saturateEps(result.NdotLUnclamped);
return result;
}
preLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;


result.NdotL=dot(N,lightData.xyz)*0.5+0.5;
result.NdotL=saturateEps(result.NdotL);
result.NdotLUnclamped=result.NdotL;
#ifdef SPECULARTERM
result.L=normalize(lightData.xyz);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
#endif
return result;
}`;Pa.a.IncludesShadersStore.pbrDirectLightingSetupFunctions=Om;var Pm=`float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)
{
return max(0.,1.0-length(lightOffset)/range);
}
float computeDistanceLightFalloff_Physical(float lightDistanceSquared)
{
return 1.0/maxEps(lightDistanceSquared);
}
float computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)
{
float lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);
float factor=lightDistanceSquared*inverseSquaredRange;
float attenuation=saturate(1.0-factor*factor);
attenuation*=attenuation;

lightDistanceFalloff*=attenuation;
return lightDistanceFalloff;
}
float computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDistanceLightFalloff_Physical(lightDistanceSquared);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);
#else
return computeDistanceLightFalloff_Standard(lightOffset,range);
#endif
}
float computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)
{
float falloff=0.0;
float cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));
if (cosAngle>=cosHalfAngle)
{
falloff=max(0.,pow(cosAngle,exponent));
}
return falloff;
}
float computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)
{
const float kMinusLog2ConeAngleIntensityRatio=6.64385618977;





float concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);


vec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);
float falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));
return falloff;
}
float computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)
{



float cd=dot(-lightDirection,directionToLightCenterW);
float falloff=saturate(cd*lightAngleScale+lightAngleOffset);

falloff*=falloff;
return falloff;
}
float computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);
#else
return computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);
#endif
}`;Pa.a.IncludesShadersStore.pbrDirectLightingFalloffFunctions=Pm;var Qm=`
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25




#ifdef MS_BRDF_ENERGY_CONSERVATION


vec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);
}
#endif
#ifdef ENVIRONMENTBRDF
vec3 getBRDFLookup(float NdotV,float perceptualRoughness) {

vec2 UV=vec2(NdotV,perceptualRoughness);

vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);
#ifdef ENVIRONMENTBRDF_RGBD
brdfLookup.rgb=fromRGBD(brdfLookup.rgba);
#endif
return brdfLookup.rgb;
}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);
#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;
#endif
return reflectance;
}
#endif
#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)
vec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
#if defined(SHEEN) && defined(REFLECTION)

vec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {
vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;
return sheenEnvironmentReflectance;
}
#endif























vec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
float fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
#ifdef CLEARCOAT





vec3 getR0RemappedForClearCoat(vec3 f0) {
#ifdef CLEARCOAT_DEFAULTIOR
#ifdef MOBILE
return saturate(f0*(f0*0.526868+0.529324)-0.0482256);
#else
return saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);
#endif
#else
vec3 s=sqrt(f0);
vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);
return t*t;
#endif
}
#endif






float normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)
{



float a2=square(alphaG);
float d=NdotH*NdotH*(a2-1.0)+1.0;
return a2/(PI*d*d);
}
#ifdef SHEEN

float normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)
{
float invR=1./alphaG;
float cos2h=NdotH*NdotH;
float sin2h=1.-cos2h;
return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);
}
#endif
#ifdef ANISOTROPIC


float normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {
float a2=alphaTB.x*alphaTB.y;
vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x*BdotH,a2*NdotH);
float v2=dot(v,v);
float w2=a2/v2;
return a2*w2*w2*RECIPROCAL_PI;
}
#endif




#ifdef BRDF_V_HEIGHT_CORRELATED



float smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {
#ifdef MOBILE

float GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);
float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);
return 0.5/(GGXV+GGXL);
#else
float a2=alphaG*alphaG;
float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);
float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);
return 0.5/(GGXV+GGXL);
#endif
}
#else















float smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)
{
#ifdef MOBILE

return 1.0/(dot+alphaG+(1.0-alphaG)*dot ));
#else
float alphaSquared=alphaG*alphaG;
return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));
#endif
}
float smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)
{
float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);

return visibility;
}
#endif
#ifdef ANISOTROPIC


float smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {
float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));
float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));
float v=0.5/(lambdaV+lambdaL);
return v;
}
#endif
#ifdef CLEARCOAT
float visibility_Kelemen(float VdotH) {



return 0.25/(VdotH*VdotH);
}
#endif
#ifdef SHEEN



float visibility_Ashikhmin(float NdotL,float NdotV)
{
return 1./(4.*(NdotL+NdotV-NdotL*NdotV));
}
#endif







float diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {


float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));
float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));
float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;
float fresnel =
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);
return fresnel/PI;
}
#ifdef SS_TRANSLUCENCY


vec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {
vec3 S=1./maxEps(diffusionDistance);
vec3 temp=exp((-0.333333333*thickness)*S);
return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);
}


float computeWrappedDiffuseNdotL(float NdotL,float w) {
float t=1.0+w;
float invt2=1.0/square(t);
return saturate((NdotL+w)*invt2);
}
#endif
`;Pa.a.IncludesShadersStore.pbrBRDFFunctions=Qm;var Rm=`#define CLEARCOATREFLECTANCE90 1.0

struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef CLEARCOAT


vec4 clearCoat;
#endif
#ifdef SHEEN
vec3 sheen;
#endif
};

float adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {
#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)

float lightRoughness=lightRadius/lightDistance;

float totalRoughness=saturate(lightRoughness+roughness);
return totalRoughness;
#else
return roughness;
#endif
}
vec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {
return mix(groundColor,lightColor,info.NdotL);
}
vec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {
float diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);
return diffuseTerm*info.attenuation*info.NdotL*lightColor;
}
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return toLinearSpace(textureColor);
}
#ifdef SS_TRANSLUCENCY
vec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {
float NdotL=absEps(info.NdotLUnclamped);

float wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);

float trAdapt=step(0.,info.NdotLUnclamped);
vec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);
float diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);
return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;
}
#endif
#ifdef SPECULARTERM
vec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float roughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);
vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);
#ifdef BRDF_V_HEIGHT_CORRELATED
float smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);
#else
float smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);
#endif
vec3 specTerm=fresnel*distribution*smithVisibility;
return specTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
#ifdef ANISOTROPIC
vec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float TdotH=dot(T,info.H);
float BdotH=dot(B,info.H);
float TdotV=dot(T,V);
float BdotV=dot(B,V);
float TdotL=dot(T,info.L);
float BdotL=dot(B,info.L);
float alphaG=convertRoughnessToAverageSlope(info.roughness);
vec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);
alphaTB=max(alphaTB,square(geometricRoughnessFactor));
vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
float distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);
float smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);
vec3 specTerm=fresnel*distribution*smithVisibility;
return specTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
#ifdef CLEARCOAT
vec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {
float NccdotL=saturateEps(dot(Ncc,info.L));
float NccdotH=saturateEps(dot(Ncc,info.H));
float clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
float fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);
fresnel*=clearCoatIntensity;
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);
float kelemenVisibility=visibility_Kelemen(info.VdotH);
float clearCoatTerm=fresnel*distribution*kelemenVisibility;
return vec4(
clearCoatTerm*info.attenuation*NccdotL*lightColor,
1.0-fresnel
);
}
vec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {
vec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);
float NdotLRefract=saturateEps(dot(Ncc,LRefract));
vec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);
return absorption;
}
#endif
#ifdef SHEEN
vec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float roughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);


float fresnel=1.;
float distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);
float ashikhminvisibility=visibility_Ashikhmin(info.NdotL,info.NdotV);
float sheenTerm=fresnel*distribution*ashikhminvisibility;
return sheenTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
`;Pa.a.IncludesShadersStore.pbrDirectLightingFunctions=Rm;var Sm=`#if defined(REFLECTION) || defined(SS_REFRACTION)
float getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {
float microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;
float lod=log2(microsurfaceAverageSlopeTexels);
return lod;
}
float getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {
float lod=log2(cubeMapDimensionPixels)*roughness;
return lod;
}
#endif
#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)
float environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {


float temp=NdotVUnclamped+ambientOcclusion;
return saturate(square(temp)-1.0+ambientOcclusion);
}
#endif
#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)
float environmentHorizonOcclusion(vec3 view,vec3 normal) {

vec3 reflection=reflect(view,normal);
float temp=saturate(1.0+1.1*dot(reflection,normal));
return square(temp);
}
#endif




#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)


#define UNPACK_LOD(x) (1.0-x)*255.0
float getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {
float microsurfaceAverageSlope=alphaG;






microsurfaceAverageSlope*=sqrt(abs(NdotV));
return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);
}
#endif`;Pa.a.IncludesShadersStore.pbrIBLFunctions=Sm,o(119),o(120),o(146),o(140);var Tm=`#if DEBUGMODE>0
if (vClipSpacePosition.x/vClipSpacePosition.w<vDebugMode.x) {
return;
}

#if DEBUGMODE == 1
gl_FragColor.rgb=vPositionW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 2 && defined(NORMAL)
gl_FragColor.rgb=vNormalW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 3 && (defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC))

gl_FragColor.rgb=TBN[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 4 && (defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC))

gl_FragColor.rgb=TBN[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 5

gl_FragColor.rgb=normalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 6 && defined(MAINUV1)
gl_FragColor.rgb=vec3(vMainUV1,0.0);
#elif DEBUGMODE == 7 && defined(MAINUV2)
gl_FragColor.rgb=vec3(vMainUV2,0.0);
#elif DEBUGMODE == 8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)

gl_FragColor.rgb=TBNClearCoat[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)

gl_FragColor.rgb=TBNClearCoat[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 10 && defined(CLEARCOAT)

gl_FragColor.rgb=clearCoatNormalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 11 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicNormal;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 12 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicTangent;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 13 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicBitangent;
#define DEBUGMODE_NORMALIZE

#elif DEBUGMODE == 20 && defined(ALBEDO)
gl_FragColor.rgb=albedoTexture.rgb;
#elif DEBUGMODE == 21 && defined(AMBIENT)
gl_FragColor.rgb=ambientOcclusionColorMap.rgb;
#elif DEBUGMODE == 22 && defined(OPACITY)
gl_FragColor.rgb=opacityMap.rgb;
#elif DEBUGMODE == 23 && defined(EMISSIVE)
gl_FragColor.rgb=emissiveColorTex.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 24 && defined(LIGHTMAP)
gl_FragColor.rgb=lightmapColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)
gl_FragColor.rgb=surfaceMetallicColorMap.rgb;
#elif DEBUGMODE == 26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)
gl_FragColor.rgb=surfaceReflectivityColorMap.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)
gl_FragColor.rgb=vec3(clearCoatMapData.rg,0.0);
#elif DEBUGMODE == 28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
gl_FragColor.rgb=clearCoatTintMapData.rgb;
#elif DEBUGMODE == 29 && defined(SHEEN) && defined(SHEEN_TEXTURE)
gl_FragColor.rgb=sheenMapData.rgb;
#elif DEBUGMODE == 30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)
gl_FragColor.rgb=anisotropyMapData.rgb;
#elif DEBUGMODE == 31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)
gl_FragColor.rgb=thicknessMap.rgb;

#elif DEBUGMODE == 40 && defined(SS_REFRACTION)

gl_FragColor.rgb=environmentRefraction.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 41 && defined(REFLECTION)
gl_FragColor.rgb=environmentRadiance.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 42 && defined(CLEARCOAT) && defined(REFLECTION)
gl_FragColor.rgb=environmentClearCoatRadiance;
#define DEBUGMODE_GAMMA

#elif DEBUGMODE == 50
gl_FragColor.rgb=diffuseBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 51 && defined(SPECULARTERM)
gl_FragColor.rgb=specularBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 52 && defined(CLEARCOAT)
gl_FragColor.rgb=clearCoatBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 53 && defined(SHEEN)
gl_FragColor.rgb=sheenBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 54 && defined(REFLECTION)
gl_FragColor.rgb=environmentIrradiance.rgb;
#define DEBUGMODE_GAMMA

#elif DEBUGMODE == 60
gl_FragColor.rgb=surfaceAlbedo.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 61
gl_FragColor.rgb=specularEnvironmentR0;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 62 && defined(METALLICWORKFLOW)
gl_FragColor.rgb=vec3(metallicRoughness.r);
#elif DEBUGMODE == 71 && defined(METALLICWORKFLOW)
gl_FragColor.rgb=metallicF0;
#elif DEBUGMODE == 63
gl_FragColor.rgb=vec3(roughness);
#elif DEBUGMODE == 64
gl_FragColor.rgb=vec3(alphaG);
#elif DEBUGMODE == 65
gl_FragColor.rgb=vec3(NdotV);
#elif DEBUGMODE == 66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)
gl_FragColor.rgb=clearCoatColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 67 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearCoatRoughness);
#elif DEBUGMODE == 68 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearCoatNdotV);
#elif DEBUGMODE == 69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)
gl_FragColor.rgb=transmittance;
#elif DEBUGMODE == 70 && defined(SUBSURFACE) && defined(SS_REFRACTION)
gl_FragColor.rgb=refractionTransmittance;

#elif DEBUGMODE == 80 && defined(RADIANCEOCCLUSION)
gl_FragColor.rgb=vec3(seo);
#elif DEBUGMODE == 81 && defined(HORIZONOCCLUSION)
gl_FragColor.rgb=vec3(eho);
#elif DEBUGMODE == 82 && defined(MS_BRDF_ENERGY_CONSERVATION)
gl_FragColor.rgb=vec3(energyConservationFactor);
#elif DEBUGMODE == 83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=specularEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=clearCoatEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 85 && defined(SHEEN) && defined(REFLECTION)
gl_FragColor.rgb=sheenEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 86 && defined(ALPHABLEND)
gl_FragColor.rgb=vec3(luminanceOverAlpha);
#elif DEBUGMODE == 87
gl_FragColor.rgb=vec3(alpha);
#endif
gl_FragColor.rgb*=vDebugMode.y;
#ifdef DEBUGMODE_NORMALIZE
gl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;
#endif
#ifdef DEBUGMODE_GAMMA
gl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);
#endif
gl_FragColor.a=1.0;
#endif`;Pa.a.IncludesShadersStore.pbrDebug=Tm;var Um=`#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#extension GL_OES_standard_derivatives : enable
#endif
#ifdef LODBASEDMICROSFURACE
#extension GL_EXT_shader_texture_lod : enable
#endif
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
precision highp float;

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE
#endif

#include<__decl__pbrFragment>
#include<pbrFragmentExtraDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<pbrFragmentSamplersDeclaration>
#include<imageProcessingDeclaration>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>

#include<helperFunctions>
#include<pbrHelperFunctions>
#include<imageProcessingFunctions>
#include<shadowsFragmentFunctions>
#include<harmonicsFunctions>
#include<pbrDirectLightingSetupFunctions>
#include<pbrDirectLightingFalloffFunctions>
#include<pbrBRDFFunctions>
#include<pbrDirectLightingFunctions>
#include<pbrIBLFunctions>
#include<bumpFragmentFunctions>
#ifdef REFLECTION
#include<reflectionFunction>
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS

void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>

vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#endif
#ifdef CLEARCOAT

vec3 clearCoatNormalW=normalW;
#endif
#include<bumpFragment>
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
vec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#if defined(TWOSIDEDLIGHTING)
faceNormal=gl_FrontFacing ? faceNormal : -faceNormal;
#endif
normalW*=sign(dot(normalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
normalW=gl_FrontFacing ? normalW : -normalW;
#endif


vec3 surfaceAlbedo=vAlbedoColor.rgb;

float alpha=vAlbedoColor.a;
#ifdef ALBEDO
vec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);
#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)
alpha*=albedoTexture.a;
#endif
#ifdef GAMMAALBEDO
surfaceAlbedo*=toLinearSpace(albedoTexture.rgb);
#else
surfaceAlbedo*=albedoTexture.rgb;
#endif
surfaceAlbedo*=vAlbedoInfos.y;
#endif
#ifdef VERTEXCOLOR
surfaceAlbedo*=vColor.rgb;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALBEDO

#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
alpha=getLuminance(opacityMap.rgb);
#else
alpha*=opacityMap.a;
#endif
alpha*=vOpacityInfos.y;
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)
#ifdef ALPHATEST
if (alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
#include<depthPrePass>
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

vec3 ambientOcclusionColor=vec3(1.,1.,1.);
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#ifdef AMBIENTINGRAYSCALE
ambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);
#endif
ambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);
#endif
#ifdef UNLIT
vec3 diffuseBase=vec3(1.,1.,1.);
#else

float microSurface=vReflectivityColor.a;
vec3 surfaceReflectivityColor=vReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec2 metallicRoughness=surfaceReflectivityColor.rg;
#ifdef REFLECTIVITY
vec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);
#ifdef AOSTOREINMETALMAPRED
vec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);
ambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);
#endif
#ifdef METALLNESSSTOREINMETALMAPBLUE
metallicRoughness.r*=surfaceMetallicColorMap.b;
#else
metallicRoughness.r*=surfaceMetallicColorMap.r;
#endif
#ifdef ROUGHNESSSTOREINMETALMAPALPHA
metallicRoughness.g*=surfaceMetallicColorMap.a;
#else
#ifdef ROUGHNESSSTOREINMETALMAPGREEN
metallicRoughness.g*=surfaceMetallicColorMap.g;
#endif
#endif
#endif
#ifdef MICROSURFACEMAP
vec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;
metallicRoughness.g*=microSurfaceTexel.r;
#endif
#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS

microSurface=1.0-metallicRoughness.g;

vec3 baseColor=surfaceAlbedo;
#ifdef REFLECTANCE





surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);

surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);
#else
vec3 metallicF0=vec3(vReflectivityColor.a,vReflectivityColor.a,vReflectivityColor.a);
#ifdef METALLICF0FACTORFROMMETALLICMAP
#ifdef REFLECTIVITY
metallicF0*=surfaceMetallicColorMap.a;
#endif
#endif

surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0.r),vec3(0.,0.,0.),metallicRoughness.r);

surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);
#endif
#else
#ifdef REFLECTIVITY
vec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);
surfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);
surfaceReflectivityColor*=vReflectivityInfos.y;
#ifdef MICROSURFACEFROMREFLECTIVITYMAP
microSurface*=surfaceReflectivityColorMap.a;
microSurface*=vReflectivityInfos.z;
#else
#ifdef MICROSURFACEAUTOMATIC
microSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);
#endif
#ifdef MICROSURFACEMAP
vec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;
microSurface*=microSurfaceTexel.r;
#endif
#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE
#endif
#endif
#endif

microSurface=saturate(microSurface);

float roughness=1.-microSurface;

#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)



float opacityPerceptual=alpha;
#ifdef LINEARALPHAFRESNEL
float opacity0=opacityPerceptual;
#else
float opacity0=opacityPerceptual*opacityPerceptual;
#endif
float opacity90=fresnelGrazingReflectance(opacity0);
vec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);

alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;
#ifdef ALPHATEST
if (alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif
#endif
#endif

float NdotVUnclamped=dot(normalW,viewDirectionW);

float NdotV=absEps(NdotVUnclamped);
float alphaG=convertRoughnessToAverageSlope(roughness);
vec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);
#ifdef SPECULARAA

alphaG+=AARoughnessFactors.y;
#endif
#ifdef ANISOTROPIC
float anisotropy=vAnisotropy.b;
vec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);
#ifdef ANISOTROPIC_TEXTURE
vec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;
anisotropy*=anisotropyMapData.b;
anisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;
#endif
mat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));
vec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);
vec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));
vec3 anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);
#endif

#ifdef SS_REFRACTION
vec4 environmentRefraction=vec4(0.,0.,0.,0.);
#ifdef ANISOTROPIC
vec3 refractionVector=refract(-viewDirectionW,anisotropicNormal,vRefractionInfos.y);
#else
vec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);
#endif
#ifdef SS_REFRACTIONMAP_OPPOSITEZ
refractionVector.z*=-1.0;
#endif

#ifdef SS_REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
vec3 refractionCoords=refractionVector;
refractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
#endif
#ifdef SS_LODINREFRACTIONALPHA
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#elif defined(SS_LINEARSPECULARREFRACTION)
float refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,roughness);
#else
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE

refractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;
#ifdef SS_LODINREFRACTIONALPHA









float automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);
float requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);
#else
float requestedRefractionLOD=refractionLOD;
#endif
environmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);
#else
float lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));
float lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;
vec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);
if(lodRefractionNormalizedDoubled<1.0){
environmentRefraction=mix(
sampleRefraction(refractionSamplerHigh,refractionCoords),
environmentRefractionMid,
lodRefractionNormalizedDoubled
);
}else{
environmentRefraction=mix(
environmentRefractionMid,
sampleRefraction(refractionSamplerLow,refractionCoords),
lodRefractionNormalizedDoubled-1.0
);
}
#endif
#ifdef SS_RGBDREFRACTION
environmentRefraction.rgb=fromRGBD(environmentRefraction);
#endif
#ifdef SS_GAMMAREFRACTION
environmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);
#endif

environmentRefraction.rgb*=vRefractionInfos.x;
#endif

#ifdef REFLECTION
vec4 environmentRadiance=vec4(0.,0.,0.,0.);
vec3 environmentIrradiance=vec3(0.,0.,0.);
#ifdef ANISOTROPIC
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicNormal);
#else
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=reflectionVector;
#else
vec2 reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#elif defined(LINEARSPECULARREFLECTION)
float reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);
#else
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE

reflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
#ifdef LODINREFLECTIONALPHA









float automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);
float requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);
#else
float requestedReflectionLOD=reflectionLOD;
#endif
environmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD);
#else
float lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodReflectionNormalizedDoubled<1.0){
environmentRadiance=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
environmentSpecularMid,
lodReflectionNormalizedDoubled
);
}else{
environmentRadiance=mix(
environmentSpecularMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#ifdef RGBDREFLECTION
environmentRadiance.rgb=fromRGBD(environmentRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);
#endif

#ifdef USESPHERICALFROMREFLECTIONMAP
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
environmentIrradiance=vEnvironmentIrradiance;
#else
#ifdef ANISOTROPIC
vec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicNormal,0)).xyz;
#else
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
environmentIrradiance=computeEnvironmentIrradiance(irradianceVector);
#endif
#elif defined(USEIRRADIANCEMAP)
environmentIrradiance=sampleReflection(irradianceSampler,reflectionCoords).rgb;
#ifdef RGBDREFLECTION
environmentIrradiance.rgb=fromRGBD(environmentIrradiance);
#endif
#ifdef GAMMAREFLECTION
environmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);
#endif
#endif

environmentRadiance.rgb*=vReflectionInfos.x;
environmentRadiance.rgb*=vReflectionColor.rgb;
environmentIrradiance*=vReflectionColor.rgb;
#endif

float reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);
float reflectance90=fresnelGrazingReflectance(reflectance);
vec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;
vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;

#ifdef SHEEN
float sheenIntensity=vSheenColor.a;
#ifdef SHEEN_TEXTURE
vec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset)*vSheenInfos.y;
sheenIntensity*=sheenMapData.a;
#endif
#ifdef SHEEN_LINKWITHALBEDO
float sheenFactor=pow5(1.0-sheenIntensity);
vec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);
float sheenRoughness=sheenIntensity;

surfaceAlbedo.rgb*=sheenFactor;
#else
vec3 sheenColor=vSheenColor.rgb;
#ifdef SHEEN_TEXTURE
sheenColor.rgb*=toLinearSpace(sheenMapData.rgb);
#endif
float sheenRoughness=roughness;

sheenIntensity*=(1.-reflectance);

sheenColor*=sheenIntensity;
#endif

#if defined(REFLECTION)
float sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);
#ifdef SPECULARAA

sheenAlphaG+=AARoughnessFactors.y;
#endif
vec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);

#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float sheenReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,sheenAlphaG,NdotVUnclamped);
#elif defined(LINEARSPECULARREFLECTION)
float sheenReflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,sheenRoughness);
#else
float sheenReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,sheenAlphaG);
#endif
#ifdef LODBASEDMICROSFURACE

sheenReflectionLOD=sheenReflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
environmentSheenRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,sheenReflectionLOD);
#else
float lodSheenReflectionNormalized=saturate(sheenReflectionLOD/log2(vReflectionMicrosurfaceInfos.x));
float lodSheenReflectionNormalizedDoubled=lodSheenReflectionNormalized*2.0;
vec4 environmentSheenMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodSheenReflectionNormalizedDoubled<1.0){
environmentSheenRadiance=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
environmentSheenMid,
lodSheenReflectionNormalizedDoubled
);
}else{
environmentSheenRadiance=mix(
environmentSheenMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodSheenReflectionNormalizedDoubled-1.0
);
}
#endif
#ifdef RGBDREFLECTION
environmentSheenRadiance.rgb=fromRGBD(environmentSheenRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentSheenRadiance.rgb=toLinearSpace(environmentSheenRadiance.rgb);
#endif

environmentSheenRadiance.rgb*=vReflectionInfos.x;
environmentSheenRadiance.rgb*=vReflectionColor.rgb;
#endif
#endif

#ifdef CLEARCOAT

float clearCoatIntensity=vClearCoatParams.x;
float clearCoatRoughness=vClearCoatParams.y;
#ifdef CLEARCOAT_TEXTURE
vec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;
clearCoatIntensity*=clearCoatMapData.x;
clearCoatRoughness*=clearCoatMapData.y;
#endif
#ifdef CLEARCOAT_TINT
vec3 clearCoatColor=vClearCoatTintParams.rgb;
float clearCoatThickness=vClearCoatTintParams.a;
#ifdef CLEARCOAT_TINT_TEXTURE
vec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);
clearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);
clearCoatThickness*=clearCoatTintMapData.a;
#endif
clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);
#endif




vec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);
specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);
#ifdef CLEARCOAT_BUMP
#ifdef NORMALXYSCALE
float clearCoatNormalScale=1.0;
#else
float clearCoatNormalScale=vClearCoatBumpInfos.y;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBNClearCoat=vTBN;
#else
mat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,vClearCoatBumpUV,vClearCoatTangentSpaceParams);
#endif
#ifdef OBJECTSPACE_NORMALMAP
clearCoatNormalW=normalize(texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset).xyz*2.0-1.0);
clearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);
#else
clearCoatNormalW=perturbNormal(TBNClearCoat,texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset).xyz,vClearCoatBumpInfos.y);
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
clearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
clearCoatNormalW=gl_FrontFacing ? clearCoatNormalW : -clearCoatNormalW;
#endif

vec2 clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);

float clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);

float clearCoatNdotV=absEps(clearCoatNdotVUnclamped);
#ifdef CLEARCOAT_TINT

vec3 clearCoatVRefract=-refract(vPositionW,clearCoatNormalW,vClearCoatRefractionParams.y);

float clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));
vec3 absorption=vec3(0.);
#endif

#if defined(REFLECTION)
float clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
#ifdef SPECULARAA

clearCoatAlphaG+=clearCoatAARoughnessFactors.y;
#endif
vec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);
vec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
clearCoatReflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 clearCoatReflectionCoords=clearCoatReflectionVector;
#else
vec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
clearCoatReflectionCoords/=clearCoatReflectionVector.z;
#endif
clearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float clearCoatReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,clearCoatAlphaG,clearCoatNdotVUnclamped);
#elif defined(LINEARSPECULARREFLECTION)
float sheenReflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,clearCoatRoughness);
#else
float clearCoatReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,clearCoatAlphaG);
#endif
#ifdef LODBASEDMICROSFURACE

clearCoatReflectionLOD=clearCoatReflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
float requestedClearCoatReflectionLOD=clearCoatReflectionLOD;
environmentClearCoatRadiance=sampleReflectionLod(reflectionSampler,clearCoatReflectionCoords,requestedClearCoatReflectionLOD);
#else
float lodClearCoatReflectionNormalized=saturate(clearCoatReflectionLOD/log2(vReflectionMicrosurfaceInfos.x));
float lodClearCoatReflectionNormalizedDoubled=lodClearCoatReflectionNormalized*2.0;
vec4 environmentClearCoatMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodClearCoatReflectionNormalizedDoubled<1.0){
environmentClearCoatRadiance=mix(
sampleReflection(reflectionSamplerHigh,clearCoatReflectionCoords),
environmentClearCoatMid,
lodClearCoatReflectionNormalizedDoubled
);
}else{
environmentClearCoatRadiance=mix(
environmentClearCoatMid,
sampleReflection(reflectionSamplerLow,clearCoatReflectionCoords),
lodClearCoatReflectionNormalizedDoubled-1.0
);
}
#endif
#ifdef RGBDREFLECTION
environmentClearCoatRadiance.rgb=fromRGBD(environmentClearCoatRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentClearCoatRadiance.rgb=toLinearSpace(environmentClearCoatRadiance.rgb);
#endif

environmentClearCoatRadiance.rgb*=vReflectionInfos.x;
environmentClearCoatRadiance.rgb*=vReflectionColor.rgb;
#endif
#endif

#if defined(ENVIRONMENTBRDF)

vec3 environmentBrdf=getBRDFLookup(NdotV,roughness);
#ifdef MS_BRDF_ENERGY_CONSERVATION
vec3 energyConservationFactor=getEnergyConservationFactor(specularEnvironmentR0,environmentBrdf);
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
float refractionIntensity=vSubSurfaceIntensity.x;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
refractionIntensity*=(1.0-alpha);

alpha=1.0;
#endif
#endif
#ifdef SS_TRANSLUCENCY
float translucencyIntensity=vSubSurfaceIntensity.y;
#endif
#ifdef SS_SCATTERING
float scatteringIntensity=vSubSurfaceIntensity.z;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);
float thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;
#ifdef SS_MASK_FROM_THICKNESS_TEXTURE
#ifdef SS_REFRACTION
refractionIntensity*=thicknessMap.g;
#endif
#ifdef SS_TRANSLUCENCY
translucencyIntensity*=thicknessMap.b;
#endif
#ifdef SS_SCATTERING
scatteringIntensity*=thicknessMap.a;
#endif
#endif
#else
float thickness=vThicknessParam.y;
#endif
#ifdef SS_TRANSLUCENCY
thickness=maxEps(thickness);
vec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);
transmittance*=translucencyIntensity;
#endif
#endif


vec3 diffuseBase=vec3(0.,0.,0.);
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#ifdef CLEARCOAT
vec3 clearCoatBase=vec3(0.,0.,0.);
#endif
#ifdef SHEEN
vec3 sheenBase=vec3(0.,0.,0.);
#endif
#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
#ifdef GAMMALIGHTMAP
lightmapColor.rgb=toLinearSpace(lightmapColor.rgb);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif

preLightingInfo preInfo;
lightingInfo info;
float shadow=1.;
#include<lightFragment>[0..maxSimultaneousLights]

#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
vec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(specularEnvironmentR0,environmentBrdf);
#ifdef RADIANCEOCCLUSION
#ifdef AMBIENTINGRAYSCALE
float ambientMonochrome=ambientOcclusionColor.r;
#else
float ambientMonochrome=getLuminance(ambientOcclusionColor);
#endif
float seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);
specularEnvironmentReflectance*=seo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float eho=environmentHorizonOcclusion(-viewDirectionW,normalW);
specularEnvironmentReflectance*=eho;
#endif
#endif
#endif
#else

vec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));
#endif

#if defined(SHEEN) && defined(REFLECTION)
vec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentBrdf);
#ifdef RADIANCEOCCLUSION
sheenEnvironmentReflectance*=seo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
sheenEnvironmentReflectance*=eho;
#endif
#endif
#endif
#endif

#ifdef CLEARCOAT
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)

vec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);
vec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);
#ifdef RADIANCEOCCLUSION
float clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);
clearCoatEnvironmentReflectance*=clearCoatSeo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW);
clearCoatEnvironmentReflectance*=clearCoatEho;
#endif
#endif
#endif
#else

vec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));
#endif
clearCoatEnvironmentReflectance*=clearCoatIntensity;
#if defined(CLEARCOAT_TINT)

absorption=computeClearCoatAbsorption(clearCoatNdotVRefract,clearCoatNdotVRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);
#ifdef REFLECTION
environmentIrradiance*=absorption;
#ifdef SHEEN
sheenEnvironmentReflectance*=absorption;
#endif
#endif
specularEnvironmentReflectance*=absorption;
#endif

float fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);
fresnelIBLClearCoat*=clearCoatIntensity;
float conservationFactor=(1.-fresnelIBLClearCoat);
#ifdef REFLECTION
environmentIrradiance*=conservationFactor;
#ifdef SHEEN
sheenEnvironmentReflectance*=conservationFactor;
#endif
#endif
specularEnvironmentReflectance*=conservationFactor;
#endif

#ifdef SS_REFRACTION
vec3 refractionTransmittance=vec3(refractionIntensity);
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);





refractionTransmittance*=cocaLambert(volumeAlbedo,thickness);
#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)

float maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);
vec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);

environmentRefraction.rgb*=volumeAlbedo;
#else

vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);
refractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);
#endif

surfaceAlbedo*=(1.-refractionIntensity);
#ifdef REFLECTION

environmentIrradiance*=(1.-refractionIntensity);
#endif

vec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);
specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);

refractionTransmittance*=1.0-specularEnvironmentReflectance;
#endif

#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)
#if defined(USESPHERICALINVERTEX)
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
#endif
#if defined(USESPHERICALFROMREFLECTIONMAP)
vec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);
#elif defined(USEIRRADIANCEMAP)
vec3 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceVector).rgb;
#ifdef RGBDREFLECTION
refractionIrradiance.rgb=fromRGBD(refractionIrradiance);
#endif
#ifdef GAMMAREFLECTION
refractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);
#endif
#else
vec3 refractionIrradiance=vec3(0.);
#endif
refractionIrradiance*=transmittance;
#endif



#ifndef METALLICWORKFLOW
#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION
surfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;
#endif
#endif

#ifdef REFLECTION
vec3 finalIrradiance=environmentIrradiance;
#if defined(SS_TRANSLUCENCY)
finalIrradiance+=refractionIrradiance;
#endif
finalIrradiance*=surfaceAlbedo.rgb;
#endif

#ifdef SPECULARTERM
vec3 finalSpecular=specularBase;
finalSpecular=max(finalSpecular,0.0);

vec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalSpecularScaled*=energyConservationFactor;
#endif
#endif

#ifdef REFLECTION
vec3 finalRadiance=environmentRadiance.rgb;
finalRadiance*=specularEnvironmentReflectance;

vec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalRadianceScaled*=energyConservationFactor;
#endif
#endif

#ifdef SS_REFRACTION
vec3 finalRefraction=environmentRefraction.rgb;
finalRefraction*=refractionTransmittance;
#endif

#ifdef CLEARCOAT
vec3 finalClearCoat=clearCoatBase;
finalClearCoat=max(finalClearCoat,0.0);

vec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalClearCoatScaled*=energyConservationFactor;
#endif

#ifdef REFLECTION
vec3 finalClearCoatRadiance=environmentClearCoatRadiance.rgb;
finalClearCoatRadiance*=clearCoatEnvironmentReflectance;

vec3 finalClearCoatRadianceScaled=finalClearCoatRadiance*vLightingIntensity.z;
#endif
#ifdef SS_REFRACTION
finalRefraction*=conservationFactor;
#ifdef CLEARCOAT_TINT
finalRefraction*=absorption;
#endif
#endif
#endif

#ifdef SHEEN
vec3 finalSheen=sheenBase*sheenColor;
finalSheen=max(finalSheen,0.0);
vec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;





#ifdef REFLECTION
vec3 finalSheenRadiance=environmentSheenRadiance.rgb;
finalSheenRadiance*=sheenEnvironmentReflectance;

vec3 finalSheenRadianceScaled=finalSheenRadiance*vLightingIntensity.z;
#endif
#endif

#ifdef ALPHABLEND
float luminanceOverAlpha=0.0;
#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)
luminanceOverAlpha+=getLuminance(finalRadianceScaled);
#if defined(CLEARCOAT)
luminanceOverAlpha+=getLuminance(finalClearCoatRadianceScaled);
#endif
#endif
#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)
luminanceOverAlpha+=getLuminance(finalSpecularScaled);
#endif
#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)
luminanceOverAlpha+=getLuminance(finalClearCoatScaled);
#endif
#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)
alpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);
#endif
#endif
#endif


vec3 finalDiffuse=diffuseBase;
finalDiffuse*=surfaceAlbedo.rgb;
finalDiffuse=max(finalDiffuse,0.0);

vec3 finalAmbient=vAmbientColor;
finalAmbient*=surfaceAlbedo.rgb;

vec3 finalEmissive=vEmissiveColor;
#ifdef EMISSIVE
vec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;
finalEmissive*=toLinearSpace(emissiveColorTex.rgb);
finalEmissive*=vEmissiveInfos.y;
#endif

#ifdef AMBIENT
vec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),ambientOcclusionColor,vAmbientInfos.w);
#else
vec3 ambientOcclusionForDirectDiffuse=ambientOcclusionColor;
#endif



vec4 finalColor=vec4(
finalAmbient*ambientOcclusionColor +
finalDiffuse*ambientOcclusionForDirectDiffuse*vLightingIntensity.x +
#ifndef UNLIT
#ifdef REFLECTION
finalIrradiance*ambientOcclusionColor*vLightingIntensity.z +
#endif
#ifdef SPECULARTERM


finalSpecularScaled +
#endif
#ifdef CLEARCOAT


finalClearCoatScaled +
#endif
#ifdef SHEEN


finalSheenScaled +
#endif
#ifdef REFLECTION


finalRadianceScaled +
#ifdef CLEARCOAT


finalClearCoatRadianceScaled +
#endif
#ifdef SHEEN


finalSheenRadianceScaled +
#endif
#endif
#ifdef SS_REFRACTION
finalRefraction*vLightingIntensity.z +
#endif
#endif
finalEmissive*vLightingIntensity.y,
alpha);

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
finalColor.rgb*=lightmapColor.rgb;
#else
finalColor.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG

finalColor=max(finalColor,0.0);
#include<logDepthFragment>
#include<fogFragment>(color,finalColor)
#ifdef IMAGEPROCESSINGPOSTPROCESS


finalColor.rgb=clamp(finalColor.rgb,0.,30.0);
#else

finalColor=applyImageProcessing(finalColor);
#endif
finalColor.a*=visibility;
#ifdef PREMULTIPLYALPHA

finalColor.rgb*=finalColor.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
gl_FragColor=finalColor;
#include<pbrDebug>
}
`;Pa.a.ShadersStore.pbrPixelShader=Um;var Vm=`uniform mat4 view;
uniform mat4 viewProjection;
#ifdef ALBEDO
uniform mat4 albedoMatrix;
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec4 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
uniform mat4 reflectivityMatrix;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
uniform mat4 microSurfaceSamplerMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
#endif

#ifdef CLEARCOAT
#ifdef CLEARCOAT_TEXTURE
uniform vec2 vClearCoatInfos;
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;
uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
#endif
#endif

#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
#endif
#endif

#ifdef SHEEN
#ifdef SHEEN_TEXTURE
uniform vec2 vSheenInfos;
uniform mat4 sheenMatrix;
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
#endif
#endif
`;Pa.a.IncludesShadersStore.pbrVertexDeclaration=Vm,o(147),o(88),o(89),o(94),o(141),o(143);var Wm=`precision highp float;
#include<__decl__pbrVertex>
#define CUSTOM_VERTEX_BEGIN

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
varying vec2 vAlbedoUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
varying vec2 vReflectivityUV;
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
varying vec2 vMicroSurfaceSamplerUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0
varying vec2 vClearCoatUV;
#endif
#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0
varying vec2 vClearCoatBumpUV;
#endif
#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0
varying vec2 vClearCoatTintUV;
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0
varying vec2 vSheenUV;
#endif
#endif
#ifdef ANISOTROPIC
#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0
varying vec2 vAnisotropyUV;
#endif
#endif
#ifdef SUBSURFACE
#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0
varying vec2 vThicknessUV;
#endif
#endif

varying vec3 vPositionW;
#if DEBUGMODE>0
varying vec4 vClipSpacePosition;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#include<harmonicsFunctions>
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#include<bonesVertex>
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
} else {
gl_Position=viewProjectionR*finalWorld*vec4(positionUpdated,1.0);
}
#else
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#endif
#if DEBUGMODE>0
vClipSpacePosition=gl_Position;
#endif
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
vec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif
vEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);
#endif
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
if (vAlbedoInfos.x == 0.)
{
vAlbedoUV=vec2(albedoMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
if (vReflectivityInfos.x == 0.)
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
if (vMicroSurfaceSamplerInfos.x == 0.)
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0
if (vClearCoatInfos.x == 0.)
{
vClearCoatUV=vec2(clearCoatMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatUV=vec2(clearCoatMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0
if (vClearCoatBumpInfos.x == 0.)
{
vClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0
if (vClearCoatTintInfos.x == 0.)
{
vClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0
if (vSheenInfos.x == 0.)
{
vSheenUV=vec2(sheenMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSheenUV=vec2(sheenMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef ANISOTROPIC
#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0
if (vAnisotropyInfos.x == 0.)
{
vAnisotropyUV=vec2(anisotropyMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAnisotropyUV=vec2(anisotropyMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef SUBSURFACE
#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0
if (vThicknessInfos.x == 0.)
{
vThicknessUV=vec2(thicknessMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vThicknessUV=vec2(thicknessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif

#include<bumpVertex>

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif

#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}`;Pa.a.ShadersStore.pbrVertexShader=Wm;var Fg=function(e){function b(){var a=e.call(this)||this;return a.PBR=!0,a.MAINUV1=!1,a.MAINUV2=!1,a.UV1=!1,a.UV2=!1,a.ALBEDO=!1,a.GAMMAALBEDO=!1,a.ALBEDODIRECTUV=0,a.VERTEXCOLOR=!1,a.AMBIENT=!1,a.AMBIENTDIRECTUV=0,a.AMBIENTINGRAYSCALE=!1,a.OPACITY=!1,a.VERTEXALPHA=!1,a.OPACITYDIRECTUV=0,a.OPACITYRGB=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.ALPHABLEND=!1,a.ALPHAFROMALBEDO=!1,a.ALPHATESTVALUE="0.5",a.SPECULAROVERALPHA=!1,a.RADIANCEOVERALPHA=!1,a.ALPHAFRESNEL=!1,a.LINEARALPHAFRESNEL=!1,a.PREMULTIPLYALPHA=!1,a.EMISSIVE=!1,a.EMISSIVEDIRECTUV=0,a.REFLECTIVITY=!1,a.REFLECTIVITYDIRECTUV=0,a.SPECULARTERM=!1,a.MICROSURFACEFROMREFLECTIVITYMAP=!1,a.MICROSURFACEAUTOMATIC=!1,a.LODBASEDMICROSFURACE=!1,a.MICROSURFACEMAP=!1,a.MICROSURFACEMAPDIRECTUV=0,a.METALLICWORKFLOW=!1,a.ROUGHNESSSTOREINMETALMAPALPHA=!1,a.ROUGHNESSSTOREINMETALMAPGREEN=!1,a.METALLNESSSTOREINMETALMAPBLUE=!1,a.AOSTOREINMETALMAPRED=!1,a.METALLICF0FACTORFROMMETALLICMAP=!1,a.ENVIRONMENTBRDF=!1,a.ENVIRONMENTBRDF_RGBD=!1,a.NORMAL=!1,a.TANGENT=!1,a.BUMP=!1,a.BUMPDIRECTUV=0,a.OBJECTSPACE_NORMALMAP=!1,a.PARALLAX=!1,a.PARALLAXOCCLUSION=!1,a.NORMALXYSCALE=!0,a.LIGHTMAP=!1,a.LIGHTMAPDIRECTUV=0,a.USELIGHTMAPASSHADOWMAP=!1,a.GAMMALIGHTMAP=!1,a.RGBDLIGHTMAP=!1,a.REFLECTION=!1,a.REFLECTIONMAP_3D=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_CUBIC=!1,a.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.INVERTCUBICMAP=!1,a.USESPHERICALFROMREFLECTIONMAP=!1,a.USEIRRADIANCEMAP=!1,a.SPHERICAL_HARMONICS=!1,a.USESPHERICALINVERTEX=!1,a.REFLECTIONMAP_OPPOSITEZ=!1,a.LODINREFLECTIONALPHA=!1,a.GAMMAREFLECTION=!1,a.RGBDREFLECTION=!1,a.LINEARSPECULARREFLECTION=!1,a.RADIANCEOCCLUSION=!1,a.HORIZONOCCLUSION=!1,a.INSTANCES=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.BONETEXTURE=!1,a.NONUNIFORMSCALING=!1,a.MORPHTARGETS=!1,a.MORPHTARGETS_NORMAL=!1,a.MORPHTARGETS_TANGENT=!1,a.MORPHTARGETS_UV=!1,a.NUM_MORPH_INFLUENCERS=0,a.IMAGEPROCESSING=!1,a.VIGNETTE=!1,a.VIGNETTEBLENDMODEMULTIPLY=!1,a.VIGNETTEBLENDMODEOPAQUE=!1,a.TONEMAPPING=!1,a.TONEMAPPING_ACES=!1,a.CONTRAST=!1,a.COLORCURVES=!1,a.COLORGRADING=!1,a.COLORGRADING3D=!1,a.SAMPLER3DGREENDEPTH=!1,a.SAMPLER3DBGRMAP=!1,a.IMAGEPROCESSINGPOSTPROCESS=!1,a.EXPOSURE=!1,a.MULTIVIEW=!1,a.USEPHYSICALLIGHTFALLOFF=!1,a.USEGLTFLIGHTFALLOFF=!1,a.TWOSIDEDLIGHTING=!1,a.SHADOWFLOAT=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.POINTSIZE=!1,a.FOG=!1,a.LOGARITHMICDEPTH=!1,a.FORCENORMALFORWARD=!1,a.SPECULARAA=!1,a.CLEARCOAT=!1,a.CLEARCOAT_DEFAULTIOR=!1,a.CLEARCOAT_TEXTURE=!1,a.CLEARCOAT_TEXTUREDIRECTUV=0,a.CLEARCOAT_BUMP=!1,a.CLEARCOAT_BUMPDIRECTUV=0,a.CLEARCOAT_TINT=!1,a.CLEARCOAT_TINT_TEXTURE=!1,a.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,a.ANISOTROPIC=!1,a.ANISOTROPIC_TEXTURE=!1,a.ANISOTROPIC_TEXTUREDIRECTUV=0,a.BRDF_V_HEIGHT_CORRELATED=!1,a.MS_BRDF_ENERGY_CONSERVATION=!1,a.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,a.SHEEN=!1,a.SHEEN_TEXTURE=!1,a.SHEEN_TEXTUREDIRECTUV=0,a.SHEEN_LINKWITHALBEDO=!1,a.SUBSURFACE=!1,a.SS_REFRACTION=!1,a.SS_TRANSLUCENCY=!1,a.SS_SCATERRING=!1,a.SS_THICKNESSANDMASK_TEXTURE=!1,a.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,a.SS_REFRACTIONMAP_3D=!1,a.SS_REFRACTIONMAP_OPPOSITEZ=!1,a.SS_LODINREFRACTIONALPHA=!1,a.SS_GAMMAREFRACTION=!1,a.SS_RGBDREFRACTION=!1,a.SS_LINEARSPECULARREFRACTION=!1,a.SS_LINKREFRACTIONTOTRANSPARENCY=!1,a.SS_MASK_FROM_THICKNESS_TEXTURE=!1,a.UNLIT=!1,a.DEBUGMODE=0,a.rebuild(),a}return Object(l.d)(b,e),b.prototype.reset=function(){e.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},b}(mf.a),ec=function(e){function b(a,c){var d=e.call(this,a,c)||this;return d._directIntensity=1,d._emissiveIntensity=1,d._environmentIntensity=1,d._specularIntensity=1,d._lightingInfos=new i.f(d._directIntensity,d._emissiveIntensity,d._environmentIntensity,d._specularIntensity),d._disableBumpMap=!1,d._albedoTexture=null,d._ambientTexture=null,d._ambientTextureStrength=1,d._ambientTextureImpactOnAnalyticalLights=b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,d._opacityTexture=null,d._reflectionTexture=null,d._emissiveTexture=null,d._reflectivityTexture=null,d._metallicTexture=null,d._metallic=null,d._roughness=null,d._metallicF0Factor=.5,d._useMetallicF0FactorFromMetallicTexture=!1,d._microSurfaceTexture=null,d._bumpTexture=null,d._lightmapTexture=null,d._ambientColor=new G.a(0,0,0),d._albedoColor=new G.a(1,1,1),d._reflectivityColor=new G.a(1,1,1),d._reflectionColor=new G.a(1,1,1),d._emissiveColor=new G.a(0,0,0),d._microSurface=.9,d._useLightmapAsShadowmap=!1,d._useHorizonOcclusion=!0,d._useRadianceOcclusion=!0,d._useAlphaFromAlbedoTexture=!1,d._useSpecularOverAlpha=!0,d._useMicroSurfaceFromReflectivityMapAlpha=!1,d._useRoughnessFromMetallicTextureAlpha=!0,d._useRoughnessFromMetallicTextureGreen=!1,d._useMetallnessFromMetallicTextureBlue=!1,d._useAmbientOcclusionFromMetallicTextureRed=!1,d._useAmbientInGrayScale=!1,d._useAutoMicroSurfaceFromReflectivityMap=!1,d._lightFalloff=b.LIGHTFALLOFF_PHYSICAL,d._useRadianceOverAlpha=!0,d._useObjectSpaceNormalMap=!1,d._useParallax=!1,d._useParallaxOcclusion=!1,d._parallaxScaleBias=.05,d._disableLighting=!1,d._maxSimultaneousLights=4,d._invertNormalMapX=!1,d._invertNormalMapY=!1,d._twoSidedLighting=!1,d._alphaCutOff=.4,d._forceAlphaTest=!1,d._useAlphaFresnel=!1,d._useLinearAlphaFresnel=!1,d._transparencyMode=null,d._environmentBRDFTexture=null,d._forceIrradianceInFragment=!1,d._forceNormalForward=!1,d._enableSpecularAntiAliasing=!1,d._imageProcessingObserver=null,d._renderTargets=new Ic.a(16),d._globalAmbientColor=new G.a(0,0,0),d._useLogarithmicDepth=!1,d._unlit=!1,d._debugMode=0,d.debugMode=0,d.debugLimit=-1,d.debugFactor=1,d.clearCoat=new of(d._markAllSubMeshesAsTexturesDirty.bind(d)),d.anisotropy=new Pd(d._markAllSubMeshesAsTexturesDirty.bind(d)),d.brdf=new Hm(d._markAllSubMeshesAsMiscDirty.bind(d)),d.sheen=new ye(d._markAllSubMeshesAsTexturesDirty.bind(d)),d.subSurface=new ze(d._markAllSubMeshesAsTexturesDirty.bind(d)),d._rebuildInParallel=!1,d._attachImageProcessingConfiguration(null),d.getRenderTargetTextures=function(){return d._renderTargets.reset(),cb.a.ReflectionTextureEnabled&&d._reflectionTexture&&d._reflectionTexture.isRenderTarget&&d._renderTargets.push(d._reflectionTexture),d.subSurface.fillRenderTargetTextures(d._renderTargets),d._renderTargets},d._environmentBRDFTexture=Eg.GetEnvironmentBRDFTexture(c),d}return Object(l.d)(b,e),b.prototype._attachImageProcessingConfiguration=function(a){var c=this;a!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=a||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){c._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(b.prototype,"hasRenderTargetTextures",{get:function(){return!!(cb.a.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this.subSurface.hasRenderTargetTextures()},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(b.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(a){this._useLogarithmicDepth=a&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(a){this._transparencyMode!==a&&(this._transparencyMode=a,this._forceAlphaTest=a===b.PBRMATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"_disableAlphaBlending",{get:function(){return this.subSurface.disableAlphaBlending||this._transparencyMode===b.PBRMATERIAL_OPAQUE||this._transparencyMode===b.PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),b.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},b.prototype.needAlphaBlendingForMesh=function(a){return!(this._disableAlphaBlending&&a.visibility>=1)&&e.prototype.needAlphaBlendingForMesh.call(this,a)},b.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this.subSurface.disableAlphaBlending&&(null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&(null==this._transparencyMode||this._transparencyMode===b.PBRMATERIAL_ALPHATEST))},b.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==b.PBRMATERIAL_OPAQUE},b.prototype.getAlphaTestTexture=function(){return this._albedoTexture},b.prototype.isReadyForSubMesh=function(a,c,d){if(c.effect&&this.isFrozen&&c.effect._wasPreviouslyReady)return!0;c._materialDefines||(c._materialDefines=new Fg());var f=c._materialDefines;if(!this.checkReadyOnEveryCall&&c.effect&&f._renderId===this.getScene().getRenderId())return!0;var g=this.getScene(),h=g.getEngine();if(f._areTexturesDirty&&g.texturesEnabled){if(this._albedoTexture&&cb.a.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&cb.a.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&cb.a.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var j=this._getReflectionTexture();if(j&&cb.a.ReflectionTextureEnabled){if(!j.isReadyOrNotBlocking())return!1;if(j.irradianceTexture&&!j.irradianceTexture.isReadyOrNotBlocking())return!1}if(this._lightmapTexture&&cb.a.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&cb.a.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(cb.a.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(h.getCaps().standardDerivatives&&this._bumpTexture&&cb.a.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&cb.a.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(!(this.subSurface.isReadyForSubMesh(f,g)&&this.clearCoat.isReadyForSubMesh(f,g,h,this._disableBumpMap)&&this.sheen.isReadyForSubMesh(f,g)&&this.anisotropy.isReadyForSubMesh(f,g)))return!1;if(f._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;h.getCaps().standardDerivatives||a.isVerticesDataPresent(ra.b.NormalKind)||(a.createNormals(!0),k.a.Warn("PBRMaterial: Normals have been created for the mesh: "+a.name));var m=c.effect,w=f._areLightsDisposed,z=this._prepareEffect(a,f,this.onCompiled,this.onError,d);if(z)if(this.allowShaderHotSwapping&&m&&!z.isReady()){if(z=m,this._rebuildInParallel=!0,f.markAsUnprocessed(),w)return f._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,g.resetCachedMaterial(),c.setEffect(z,f),this.buildUniformLayout();return!(!c.effect||!c.effect.isReady())&&(f._renderId=g.getRenderId(),c.effect._wasPreviouslyReady=!0,!0)},b.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},b.prototype._prepareEffect=function(a,c,d,f,g,h){if(void 0===d&&(d=null),void 0===f&&(f=null),void 0===g&&(g=null),void 0===h&&(h=null),this._prepareDefines(a,c,g,h),!c.isDirty)return null;c.markAsProcessed();var j=this.getScene().getEngine(),m=new Nd.a(),w=0;c.USESPHERICALINVERTEX&&m.addFallback(w++,"USESPHERICALINVERTEX"),c.FOG&&m.addFallback(w,"FOG"),c.SPECULARAA&&m.addFallback(w,"SPECULARAA"),c.POINTSIZE&&m.addFallback(w,"POINTSIZE"),c.LOGARITHMICDEPTH&&m.addFallback(w,"LOGARITHMICDEPTH"),c.PARALLAX&&m.addFallback(w,"PARALLAX"),c.PARALLAXOCCLUSION&&m.addFallback(w++,"PARALLAXOCCLUSION"),w=Pd.AddFallbacks(c,m,w),w=Pd.AddFallbacks(c,m,w),w=ze.AddFallbacks(c,m,w),w=ye.AddFallbacks(c,m,w),c.ENVIRONMENTBRDF&&m.addFallback(w++,"ENVIRONMENTBRDF"),c.TANGENT&&m.addFallback(w++,"TANGENT"),c.BUMP&&m.addFallback(w++,"BUMP"),w=Ua.a.HandleFallbacksForShadows(c,m,this._maxSimultaneousLights,w++),c.SPECULARTERM&&m.addFallback(w++,"SPECULARTERM"),c.USESPHERICALFROMREFLECTIONMAP&&m.addFallback(w++,"USESPHERICALFROMREFLECTIONMAP"),c.USEIRRADIANCEMAP&&m.addFallback(w++,"USEIRRADIANCEMAP"),c.LIGHTMAP&&m.addFallback(w++,"LIGHTMAP"),c.NORMAL&&m.addFallback(w++,"NORMAL"),c.AMBIENT&&m.addFallback(w++,"AMBIENT"),c.EMISSIVE&&m.addFallback(w++,"EMISSIVE"),c.VERTEXCOLOR&&m.addFallback(w++,"VERTEXCOLOR"),c.MORPHTARGETS&&m.addFallback(w++,"MORPHTARGETS"),c.MULTIVIEW&&m.addFallback(0,"MULTIVIEW");var z=[ra.b.PositionKind];c.NORMAL&&z.push(ra.b.NormalKind),c.TANGENT&&z.push(ra.b.TangentKind),c.UV1&&z.push(ra.b.UVKind),c.UV2&&z.push(ra.b.UV2Kind),c.VERTEXCOLOR&&z.push(ra.b.ColorKind),Ua.a.PrepareAttributesForBones(z,a,c,m),Ua.a.PrepareAttributesForInstances(z,c),Ua.a.PrepareAttributesForMorphTargets(z,a,c);var C="pbr",J=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode"],K=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler"],N=["Material","Scene"];ze.AddUniforms(J),ze.AddSamplers(K),of.AddUniforms(J),of.AddSamplers(K),Pd.AddUniforms(J),Pd.AddSamplers(K),ye.AddUniforms(J),ye.AddSamplers(K),Sb.a&&(Sb.a.PrepareUniforms(J,c),Sb.a.PrepareSamplers(K,c)),Ua.a.PrepareUniformsAndSamplersList({uniformsNames:J,uniformBuffersNames:N,samplers:K,defines:c,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(C=this.customShaderNameResolve(C,J,N,K,c));var T=c.toString();return j.createEffect(C,{attributes:z,uniformsNames:J,uniformBuffersNames:N,samplers:K,defines:T,fallbacks:m,onCompiled:d,onError:f,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:c.NUM_MORPH_INFLUENCERS}},j)},b.prototype._prepareDefines=function(a,c,d,f){void 0===d&&(d=null),void 0===f&&(f=null);var g=this.getScene(),h=g.getEngine();if(Ua.a.PrepareDefinesForLights(g,a,c,!0,this._maxSimultaneousLights,this._disableLighting),c._needNormals=!0,Ua.a.PrepareDefinesForMultiview(g,c),c.METALLICWORKFLOW=this.isMetallicWorkflow(),c._areTexturesDirty){if(c._needUVs=!1,g.texturesEnabled){g.getEngine().getCaps().textureLOD&&(c.LODBASEDMICROSFURACE=!0),this._albedoTexture&&cb.a.DiffuseTextureEnabled?(Ua.a.PrepareDefinesForMergedUV(this._albedoTexture,c,"ALBEDO"),c.GAMMAALBEDO=this._albedoTexture.gammaSpace):c.ALBEDO=!1,this._ambientTexture&&cb.a.AmbientTextureEnabled?(Ua.a.PrepareDefinesForMergedUV(this._ambientTexture,c,"AMBIENT"),c.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):c.AMBIENT=!1,this._opacityTexture&&cb.a.OpacityTextureEnabled?(Ua.a.PrepareDefinesForMergedUV(this._opacityTexture,c,"OPACITY"),c.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):c.OPACITY=!1;var j=this._getReflectionTexture();if(j&&cb.a.ReflectionTextureEnabled){switch(c.REFLECTION=!0,c.GAMMAREFLECTION=j.gammaSpace,c.RGBDREFLECTION=j.isRGBD,c.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!j.invertZ:j.invertZ,c.LODINREFLECTIONALPHA=j.lodLevelInAlpha,c.LINEARSPECULARREFLECTION=j.linearSpecularLOD,j.coordinatesMode===ya.a.INVCUBIC_MODE&&(c.INVERTCUBICMAP=!0),c.REFLECTIONMAP_3D=j.isCube,c.REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,j.coordinatesMode){case ya.a.EXPLICIT_MODE:c.REFLECTIONMAP_EXPLICIT=!0;break;case ya.a.PLANAR_MODE:c.REFLECTIONMAP_PLANAR=!0;break;case ya.a.PROJECTION_MODE:c.REFLECTIONMAP_PROJECTION=!0;break;case ya.a.SKYBOX_MODE:c.REFLECTIONMAP_SKYBOX=!0;break;case ya.a.SPHERICAL_MODE:c.REFLECTIONMAP_SPHERICAL=!0;break;case ya.a.EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case ya.a.FIXED_EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case ya.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case ya.a.CUBIC_MODE:case ya.a.INVCUBIC_MODE:default:c.REFLECTIONMAP_CUBIC=!0,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!!j.boundingBoxSize}j.coordinatesMode!==ya.a.SKYBOX_MODE&&(j.irradianceTexture?(c.USEIRRADIANCEMAP=!0,c.USESPHERICALFROMREFLECTIONMAP=!1):j.isCube&&(c.USESPHERICALFROMREFLECTIONMAP=!0,c.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||g.getEngine().getCaps().maxVaryingVectors<=8?c.USESPHERICALINVERTEX=!1:c.USESPHERICALINVERTEX=!0))}else c.REFLECTION=!1,c.REFLECTIONMAP_3D=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_CUBIC=!1,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,c.INVERTCUBICMAP=!1,c.USESPHERICALFROMREFLECTIONMAP=!1,c.USEIRRADIANCEMAP=!1,c.USESPHERICALINVERTEX=!1,c.REFLECTIONMAP_OPPOSITEZ=!1,c.LODINREFLECTIONALPHA=!1,c.GAMMAREFLECTION=!1,c.RGBDREFLECTION=!1,c.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&cb.a.LightmapTextureEnabled?(Ua.a.PrepareDefinesForMergedUV(this._lightmapTexture,c,"LIGHTMAP"),c.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,c.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,c.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):c.LIGHTMAP=!1,this._emissiveTexture&&cb.a.EmissiveTextureEnabled?Ua.a.PrepareDefinesForMergedUV(this._emissiveTexture,c,"EMISSIVE"):c.EMISSIVE=!1,cb.a.SpecularTextureEnabled?(this._metallicTexture?(Ua.a.PrepareDefinesForMergedUV(this._metallicTexture,c,"REFLECTIVITY"),c.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,c.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,c.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,c.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,c.METALLICF0FACTORFROMMETALLICMAP=this._useMetallicF0FactorFromMetallicTexture):this._reflectivityTexture?(Ua.a.PrepareDefinesForMergedUV(this._reflectivityTexture,c,"REFLECTIVITY"),c.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,c.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):c.REFLECTIVITY=!1,this._microSurfaceTexture?Ua.a.PrepareDefinesForMergedUV(this._microSurfaceTexture,c,"MICROSURFACEMAP"):c.MICROSURFACEMAP=!1):(c.REFLECTIVITY=!1,c.MICROSURFACEMAP=!1),g.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&cb.a.BumpTextureEnabled&&!this._disableBumpMap?(Ua.a.PrepareDefinesForMergedUV(this._bumpTexture,c,"BUMP"),this._useParallax&&this._albedoTexture&&cb.a.DiffuseTextureEnabled?(c.PARALLAX=!0,c.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):c.PARALLAX=!1,c.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):c.BUMP=!1,this._environmentBRDFTexture&&cb.a.ReflectionTextureEnabled?(c.ENVIRONMENTBRDF=!0,c.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(c.ENVIRONMENTBRDF=!1,c.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?c.ALPHAFROMALBEDO=!0:c.ALPHAFROMALBEDO=!1}c.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===b.LIGHTFALLOFF_STANDARD?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===b.LIGHTFALLOFF_GLTF?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!0):(c.USEPHYSICALLIGHTFALLOFF=!0,c.USEGLTFLIGHTFALLOFF=!1),c.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?c.TWOSIDEDLIGHTING=!0:c.TWOSIDEDLIGHTING=!1,c.SPECULARAA=g.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(c._areTexturesDirty||c._areMiscDirty)&&(c.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),c.PREMULTIPLYALPHA=this.alphaMode===p.a.ALPHA_PREMULTIPLIED||this.alphaMode===p.a.ALPHA_PREMULTIPLIED_PORTERDUFF,c.ALPHABLEND=this.needAlphaBlendingForMesh(a),c.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,c.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),c._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(c),c.FORCENORMALFORWARD=this._forceNormalForward,c.RADIANCEOCCLUSION=this._useRadianceOcclusion,c.HORIZONOCCLUSION=this._useHorizonOcclusion,c._areMiscDirty&&(Ua.a.PrepareDefinesForMisc(a,g,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a)||this._forceAlphaTest,c),c.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!a.isVerticesDataPresent(ra.b.NormalKind),c.DEBUGMODE=this._debugMode),this.subSurface.prepareDefines(c,g),this.clearCoat.prepareDefines(c,g),this.anisotropy.prepareDefines(c,a,g),this.brdf.prepareDefines(c),this.sheen.prepareDefines(c,g),Ua.a.PrepareDefinesForFrameBoundValues(g,h,c,!!d,f),Ua.a.PrepareDefinesForAttributes(a,c,!0,!0,!0,this._transparencyMode!==b.PBRMATERIAL_OPAQUE)},b.prototype.forceCompilation=function(a,c,d){var f=this,g=Object(l.a)({clipPlane:!1,useInstances:!1},d),h=new Fg(),j=this._prepareEffect(a,h,void 0,void 0,g.useInstances,g.clipPlane);j.isReady()?c&&c(this):j.onCompileObservable.add(function(){c&&c(f)})},b.prototype.buildUniformLayout=function(){var a=this._uniformBuffer;a.addUniform("vAlbedoInfos",2),a.addUniform("vAmbientInfos",4),a.addUniform("vOpacityInfos",2),a.addUniform("vEmissiveInfos",2),a.addUniform("vLightmapInfos",2),a.addUniform("vReflectivityInfos",3),a.addUniform("vMicroSurfaceSamplerInfos",2),a.addUniform("vReflectionInfos",2),a.addUniform("vReflectionPosition",3),a.addUniform("vReflectionSize",3),a.addUniform("vBumpInfos",3),a.addUniform("albedoMatrix",16),a.addUniform("ambientMatrix",16),a.addUniform("opacityMatrix",16),a.addUniform("emissiveMatrix",16),a.addUniform("lightmapMatrix",16),a.addUniform("reflectivityMatrix",16),a.addUniform("microSurfaceSamplerMatrix",16),a.addUniform("bumpMatrix",16),a.addUniform("vTangentSpaceParams",2),a.addUniform("reflectionMatrix",16),a.addUniform("vReflectionColor",3),a.addUniform("vAlbedoColor",4),a.addUniform("vLightingIntensity",4),a.addUniform("vReflectionMicrosurfaceInfos",3),a.addUniform("pointSize",1),a.addUniform("vReflectivityColor",4),a.addUniform("vEmissiveColor",3),a.addUniform("visibility",1),of.PrepareUniformBuffer(a),Pd.PrepareUniformBuffer(a),ye.PrepareUniformBuffer(a),ze.PrepareUniformBuffer(a),a.create()},b.prototype.unbind=function(){if(this._activeEffect){var a=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),a=!0),this.subSurface.unbind(this._activeEffect)&&(a=!0),a&&this._markAllSubMeshesAsTexturesDirty()}e.prototype.unbind.call(this)},b.prototype.bindForSubMesh=function(a,c,d){var f=this.getScene(),g=d._materialDefines;if(g){var h=d.effect;if(h){this._activeEffect=h,g.INSTANCES||this.bindOnlyWorldMatrix(a),g.OBJECTSPACE_NORMALMAP&&(a.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var j=this._mustRebind(f,h,c.visibility);Ua.a.BindBonesParameters(c,this._activeEffect);var m=null,w=this._uniformBuffer;if(j){var z=f.getEngine();if(w.bindToEffect(h,"Material"),this.bindViewProjection(h),m=this._getReflectionTexture(),!w.useUbo||!this.isFrozen||!w.isSync){if(f.texturesEnabled){if(this._albedoTexture&&cb.a.DiffuseTextureEnabled&&(w.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),Ua.a.BindTextureMatrix(this._albedoTexture,w,"albedo")),this._ambientTexture&&cb.a.AmbientTextureEnabled&&(w.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),Ua.a.BindTextureMatrix(this._ambientTexture,w,"ambient")),this._opacityTexture&&cb.a.OpacityTextureEnabled&&(w.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),Ua.a.BindTextureMatrix(this._opacityTexture,w,"opacity")),m&&cb.a.ReflectionTextureEnabled){if(w.updateMatrix("reflectionMatrix",m.getReflectionTextureMatrix()),w.updateFloat2("vReflectionInfos",m.level,0),m.boundingBoxSize){var C=m;w.updateVector3("vReflectionPosition",C.boundingBoxPosition),w.updateVector3("vReflectionSize",C.boundingBoxSize)}if(!g.USEIRRADIANCEMAP){var J=m.sphericalPolynomial;if(g.USESPHERICALFROMREFLECTIONMAP&&J)if(g.SPHERICAL_HARMONICS){var K=J.preScaledHarmonics;this._activeEffect.setVector3("vSphericalL00",K.l00),this._activeEffect.setVector3("vSphericalL1_1",K.l1_1),this._activeEffect.setVector3("vSphericalL10",K.l10),this._activeEffect.setVector3("vSphericalL11",K.l11),this._activeEffect.setVector3("vSphericalL2_2",K.l2_2),this._activeEffect.setVector3("vSphericalL2_1",K.l2_1),this._activeEffect.setVector3("vSphericalL20",K.l20),this._activeEffect.setVector3("vSphericalL21",K.l21),this._activeEffect.setVector3("vSphericalL22",K.l22)}else this._activeEffect.setFloat3("vSphericalX",J.x.x,J.x.y,J.x.z),this._activeEffect.setFloat3("vSphericalY",J.y.x,J.y.y,J.y.z),this._activeEffect.setFloat3("vSphericalZ",J.z.x,J.z.y,J.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",J.xx.x-J.zz.x,J.xx.y-J.zz.y,J.xx.z-J.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",J.yy.x-J.zz.x,J.yy.y-J.zz.y,J.yy.z-J.zz.z),this._activeEffect.setFloat3("vSphericalZZ",J.zz.x,J.zz.y,J.zz.z),this._activeEffect.setFloat3("vSphericalXY",J.xy.x,J.xy.y,J.xy.z),this._activeEffect.setFloat3("vSphericalYZ",J.yz.x,J.yz.y,J.yz.z),this._activeEffect.setFloat3("vSphericalZX",J.zx.x,J.zx.y,J.zx.z)}w.updateFloat3("vReflectionMicrosurfaceInfos",m.getSize().width,m.lodGenerationScale,m.lodGenerationOffset)}this._emissiveTexture&&cb.a.EmissiveTextureEnabled&&(w.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),Ua.a.BindTextureMatrix(this._emissiveTexture,w,"emissive")),this._lightmapTexture&&cb.a.LightmapTextureEnabled&&(w.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),Ua.a.BindTextureMatrix(this._lightmapTexture,w,"lightmap")),cb.a.SpecularTextureEnabled&&(this._metallicTexture?(w.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),Ua.a.BindTextureMatrix(this._metallicTexture,w,"reflectivity")):this._reflectivityTexture&&(w.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),Ua.a.BindTextureMatrix(this._reflectivityTexture,w,"reflectivity")),this._microSurfaceTexture&&(w.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),Ua.a.BindTextureMatrix(this._microSurfaceTexture,w,"microSurfaceSampler"))),this._bumpTexture&&z.getCaps().standardDerivatives&&cb.a.BumpTextureEnabled&&!this._disableBumpMap&&(w.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),Ua.a.BindTextureMatrix(this._bumpTexture,w,"bump"),f._mirroredCameraPosition?w.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):w.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&w.updateFloat("pointSize",this.pointSize),g.METALLICWORKFLOW){G.c.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,G.c.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;var N=.08*this._metallicF0Factor;w.updateColor4("vReflectivityColor",G.c.Color3[0],N)}else w.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);w.updateColor3("vEmissiveColor",cb.a.EmissiveTextureEnabled?this._emissiveColor:G.a.BlackReadOnly),w.updateColor3("vReflectionColor",this._reflectionColor),!g.SS_REFRACTION&&this.subSurface.linkRefractionWithTransparency?w.updateColor4("vAlbedoColor",this._albedoColor,1):w.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),w.updateFloat("visibility",c.visibility),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*f.environmentIntensity,this._lightingInfos.w=this._specularIntensity,w.updateVector4("vLightingIntensity",this._lightingInfos)}f.texturesEnabled&&(this._albedoTexture&&cb.a.DiffuseTextureEnabled&&w.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&cb.a.AmbientTextureEnabled&&w.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&cb.a.OpacityTextureEnabled&&w.setTexture("opacitySampler",this._opacityTexture),m&&cb.a.ReflectionTextureEnabled&&(g.LODBASEDMICROSFURACE?w.setTexture("reflectionSampler",m):(w.setTexture("reflectionSampler",m._lodTextureMid||m),w.setTexture("reflectionSamplerLow",m._lodTextureLow||m),w.setTexture("reflectionSamplerHigh",m._lodTextureHigh||m)),g.USEIRRADIANCEMAP&&w.setTexture("irradianceSampler",m.irradianceTexture)),g.ENVIRONMENTBRDF&&w.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&cb.a.EmissiveTextureEnabled&&w.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&cb.a.LightmapTextureEnabled&&w.setTexture("lightmapSampler",this._lightmapTexture),cb.a.SpecularTextureEnabled&&(this._metallicTexture?w.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&w.setTexture("reflectivitySampler",this._reflectivityTexture),this._microSurfaceTexture&&w.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&z.getCaps().standardDerivatives&&cb.a.BumpTextureEnabled&&!this._disableBumpMap&&w.setTexture("bumpSampler",this._bumpTexture)),this.subSurface.bindForSubMesh(w,f,z,this.isFrozen,g.LODBASEDMICROSFURACE),this.clearCoat.bindForSubMesh(w,f,z,this._disableBumpMap,this.isFrozen,this._invertNormalMapX,this._invertNormalMapY),this.anisotropy.bindForSubMesh(w,f,this.isFrozen),this.sheen.bindForSubMesh(w,f,this.isFrozen),Ua.a.BindClipPlane(this._activeEffect,f),f.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var T=f._forcedViewPosition?f._forcedViewPosition:f._mirroredCameraPosition?f._mirroredCameraPosition:f.activeCamera.globalPosition,Z=f.useRightHandedSystem===(null!=f._mirroredCameraPosition);h.setFloat4("vEyePosition",T.x,T.y,T.z,Z?-1:1),h.setColor3("vAmbientColor",this._globalAmbientColor),h.setFloat2("vDebugMode",this.debugLimit,this.debugFactor)}!j&&this.isFrozen||(f.lightsEnabled&&!this._disableLighting&&Ua.a.BindLights(f,c,this._activeEffect,g,this._maxSimultaneousLights,this._rebuildInParallel),(f.fogEnabled&&c.applyFog&&f.fogMode!==wa.a.FOGMODE_NONE||m)&&this.bindView(h),Ua.a.BindFogParameters(f,c,this._activeEffect,!0),g.NUM_MORPH_INFLUENCERS&&Ua.a.BindMorphTargetParameters(c,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),Ua.a.BindLogDepth(g,this._activeEffect,f)),w.update(),this._afterBind(c,this._activeEffect)}}},b.prototype.getAnimatables=function(){var a=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&a.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&a.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&a.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&a.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&a.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?a.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&a.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&a.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&a.push(this._lightmapTexture),this.subSurface.getAnimatables(a),this.clearCoat.getAnimatables(a),this.sheen.getAnimatables(a),this.anisotropy.getAnimatables(a),a},b.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},b.prototype.getActiveTextures=function(){var a=e.prototype.getActiveTextures.call(this);return this._albedoTexture&&a.push(this._albedoTexture),this._ambientTexture&&a.push(this._ambientTexture),this._opacityTexture&&a.push(this._opacityTexture),this._reflectionTexture&&a.push(this._reflectionTexture),this._emissiveTexture&&a.push(this._emissiveTexture),this._reflectivityTexture&&a.push(this._reflectivityTexture),this._metallicTexture&&a.push(this._metallicTexture),this._microSurfaceTexture&&a.push(this._microSurfaceTexture),this._bumpTexture&&a.push(this._bumpTexture),this._lightmapTexture&&a.push(this._lightmapTexture),this.subSurface.getActiveTextures(a),this.clearCoat.getActiveTextures(a),this.sheen.getActiveTextures(a),this.anisotropy.getActiveTextures(a),a},b.prototype.hasTexture=function(a){return!!e.prototype.hasTexture.call(this,a)||(this._albedoTexture===a||(this._ambientTexture===a||(this._opacityTexture===a||(this._reflectionTexture===a||(this._reflectivityTexture===a||(this._metallicTexture===a||(this._microSurfaceTexture===a||(this._bumpTexture===a||(this._lightmapTexture===a||(this.subSurface.hasTexture(a)||this.clearCoat.hasTexture(a)||this.sheen.hasTexture(a)||this.anisotropy.hasTexture(a)))))))))))},b.prototype.dispose=function(a,c){c&&(this._albedoTexture&&this._albedoTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._metallicTexture&&this._metallicTexture.dispose(),this._reflectivityTexture&&this._reflectivityTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose()),this.subSurface.dispose(c),this.clearCoat.dispose(c),this.sheen.dispose(c),this.anisotropy.dispose(c),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,a,c)},b.PBRMATERIAL_OPAQUE=0,b.PBRMATERIAL_ALPHATEST=1,b.PBRMATERIAL_ALPHABLEND=2,b.PBRMATERIAL_ALPHATESTANDBLEND=3,b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,b.LIGHTFALLOFF_PHYSICAL=0,b.LIGHTFALLOFF_GLTF=1,b.LIGHTFALLOFF_STANDARD=2,Object(l.c)([Object(F.i)()],b.prototype,"_imageProcessingConfiguration",void 0),Object(l.c)([Object(F.b)("_markAllSubMeshesAsMiscDirty")],b.prototype,"debugMode",void 0),Object(l.c)([Object(F.c)()],b.prototype,"useLogarithmicDepth",null),Object(l.c)([Object(F.c)()],b.prototype,"transparencyMode",null),b}(nf.a),Ae=function(e){function b(a,c){var d=e.call(this,a,c)||this;return d.directIntensity=1,d.emissiveIntensity=1,d.environmentIntensity=1,d.specularIntensity=1,d.disableBumpMap=!1,d.ambientTextureStrength=1,d.ambientTextureImpactOnAnalyticalLights=b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,d.metallicF0Factor=.5,d.useMetallicF0FactorFromMetallicTexture=!1,d.ambientColor=new G.a(0,0,0),d.albedoColor=new G.a(1,1,1),d.reflectivityColor=new G.a(1,1,1),d.reflectionColor=new G.a(1,1,1),d.emissiveColor=new G.a(0,0,0),d.microSurface=1,d.useLightmapAsShadowmap=!1,d.useAlphaFromAlbedoTexture=!1,d.forceAlphaTest=!1,d.alphaCutOff=.4,d.useSpecularOverAlpha=!0,d.useMicroSurfaceFromReflectivityMapAlpha=!1,d.useRoughnessFromMetallicTextureAlpha=!0,d.useRoughnessFromMetallicTextureGreen=!1,d.useMetallnessFromMetallicTextureBlue=!1,d.useAmbientOcclusionFromMetallicTextureRed=!1,d.useAmbientInGrayScale=!1,d.useAutoMicroSurfaceFromReflectivityMap=!1,d.useRadianceOverAlpha=!0,d.useObjectSpaceNormalMap=!1,d.useParallax=!1,d.useParallaxOcclusion=!1,d.parallaxScaleBias=.05,d.disableLighting=!1,d.forceIrradianceInFragment=!1,d.maxSimultaneousLights=4,d.invertNormalMapX=!1,d.invertNormalMapY=!1,d.twoSidedLighting=!1,d.useAlphaFresnel=!1,d.useLinearAlphaFresnel=!1,d.environmentBRDFTexture=null,d.forceNormalForward=!1,d.enableSpecularAntiAliasing=!1,d.useHorizonOcclusion=!0,d.useRadianceOcclusion=!0,d.unlit=!1,d._environmentBRDFTexture=Eg.GetEnvironmentBRDFTexture(c),d}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(a){this.subSurface.refractionTexture=a,a?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"indexOfRefraction",{get:function(){return 1/this.subSurface.indexOfRefraction},set:function(a){this.subSurface.indexOfRefraction=1/a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(a){this.subSurface.invertRefractionY=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(a){this.subSurface.linkRefractionWithTransparency=a,a&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===ec.LIGHTFALLOFF_PHYSICAL},set:function(a){a!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=a?ec.LIGHTFALLOFF_PHYSICAL:ec.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===ec.LIGHTFALLOFF_GLTF},set:function(a){a!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=a?ec.LIGHTFALLOFF_GLTF:ec.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(a){this._attachImageProcessingConfiguration(a),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(a){this.imageProcessingConfiguration.colorCurvesEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(a){this.imageProcessingConfiguration.colorGradingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(a){this._imageProcessingConfiguration.toneMappingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(a){this._imageProcessingConfiguration.exposure=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(a){this._imageProcessingConfiguration.contrast=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(a){this._imageProcessingConfiguration.colorGradingTexture=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(a){this._imageProcessingConfiguration.colorCurves=a},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"PBRMaterial"},b.prototype.clone=function(a){var c=this,d=F.a.Clone(function(){return new b(a,c.getScene())},this);return d.id=a,d.name=a,this.clearCoat.copyTo(d.clearCoat),this.anisotropy.copyTo(d.anisotropy),this.brdf.copyTo(d.brdf),this.sheen.copyTo(d.sheen),this.subSurface.copyTo(d.subSurface),d},b.prototype.serialize=function(){var a=F.a.Serialize(this);return a.customType="BABYLON.PBRMaterial",a.clearCoat=this.clearCoat.serialize(),a.anisotropy=this.anisotropy.serialize(),a.brdf=this.brdf.serialize(),a.sheen=this.sheen.serialize(),a.subSurface=this.subSurface.serialize(),a},b.Parse=function(a,c,d){var f=F.a.Parse(function(){return new b(a.name,c)},a,c,d);return a.clearCoat&&f.clearCoat.parse(a.clearCoat,c,d),a.anisotropy&&f.anisotropy.parse(a.anisotropy,c,d),a.brdf&&f.brdf.parse(a.brdf,c,d),a.sheen&&f.sheen.parse(a.sheen,c,d),a.subSurface&&f.subSurface.parse(a.subSurface,c,d),f},b.PBRMATERIAL_OPAQUE=ec.PBRMATERIAL_OPAQUE,b.PBRMATERIAL_ALPHATEST=ec.PBRMATERIAL_ALPHATEST,b.PBRMATERIAL_ALPHABLEND=ec.PBRMATERIAL_ALPHABLEND,b.PBRMATERIAL_ALPHATESTANDBLEND=ec.PBRMATERIAL_ALPHATESTANDBLEND,b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=ec.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"directIntensity",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"emissiveIntensity",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"environmentIntensity",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"specularIntensity",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"disableBumpMap",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"albedoTexture",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"ambientTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"ambientTextureStrength",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],b.prototype,"opacityTexture",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionTexture",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"emissiveTexture",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectivityTexture",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"metallicTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"metallic",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"roughness",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"metallicF0Factor",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useMetallicF0FactorFromMetallicTexture",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"microSurfaceTexture",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"bumpTexture",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty",null)],b.prototype,"lightmapTexture",void 0),Object(l.c)([Object(F.e)("ambient"),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"ambientColor",void 0),Object(l.c)([Object(F.e)("albedo"),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"albedoColor",void 0),Object(l.c)([Object(F.e)("reflectivity"),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectivityColor",void 0),Object(l.c)([Object(F.e)("reflection"),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"reflectionColor",void 0),Object(l.c)([Object(F.e)("emissive"),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"emissiveColor",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"microSurface",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useLightmapAsShadowmap",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],b.prototype,"useAlphaFromAlbedoTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],b.prototype,"forceAlphaTest",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],b.prototype,"alphaCutOff",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useSpecularOverAlpha",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRoughnessFromMetallicTextureGreen",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useMetallnessFromMetallicTextureBlue",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useAmbientInGrayScale",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),Object(l.c)([Object(F.c)()],b.prototype,"usePhysicalLightFalloff",null),Object(l.c)([Object(F.c)()],b.prototype,"useGLTFLightFalloff",null),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRadianceOverAlpha",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useObjectSpaceNormalMap",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useParallax",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useParallaxOcclusion",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"parallaxScaleBias",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsLightsDirty")],b.prototype,"disableLighting",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"forceIrradianceInFragment",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsLightsDirty")],b.prototype,"maxSimultaneousLights",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"invertNormalMapX",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"invertNormalMapY",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"twoSidedLighting",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useAlphaFresnel",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useLinearAlphaFresnel",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"environmentBRDFTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"forceNormalForward",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"enableSpecularAntiAliasing",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useHorizonOcclusion",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useRadianceOcclusion",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsMiscDirty")],b.prototype,"unlit",void 0),b}(ec);D.a.RegisteredTypes["BABYLON.PBRMaterial"]=Ae;function pf(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var Ki=pf("DXT1"),Li=pf("DXT3"),Mi=pf("DXT5"),Gg=pf("DX10"),_c=function(){function e(){}return e.GetDDSInfo=function(b){var a=new Int32Array(b.buffer,b.byteOffset,31),c=new Int32Array(b.buffer,b.byteOffset,35),d=1;131072&a[2]&&(d=Math.max(1,a[7]));var f=a[21],g=f===Gg?c[32]:0,h=p.a.TEXTURETYPE_UNSIGNED_INT;switch(f){case 113:h=p.a.TEXTURETYPE_HALF_FLOAT;break;case 116:h=p.a.TEXTURETYPE_FLOAT;break;case Gg:if(10===g){h=p.a.TEXTURETYPE_HALF_FLOAT;break}if(2===g){h=p.a.TEXTURETYPE_FLOAT;break}}return{width:a[4],height:a[3],mipmapCount:d,isFourCC:4==(4&a[20]),isRGB:64==(64&a[20]),isLuminance:131072==(131072&a[20]),isCube:512==(512&a[28]),isCompressed:f===Ki||f===Li||f===Mi,dxgiFormat:g,textureType:h}},e._ToHalfFloat=function(b){e._FloatView||(e._FloatView=new Float32Array(1),e._Int32View=new Int32Array(e._FloatView.buffer)),e._FloatView[0]=b;var a=e._Int32View[0],c=a>>16&32768,d=a>>12&2047,f=a>>23&255;return f<103?c:f>142?(c|=31744,c|=(255==f?0:1)&&8388607&a):f<113?c|=((d|=2048)>>114-f)+(d>>113-f&1):(c|=f-112<<10|d>>1,c+=1&d)},e._FromHalfFloat=function(b){var a=(32768&b)>>15,c=(31744&b)>>10,d=1023&b;return 0===c?(a?-1:1)*Math.pow(2,-14)*(d/Math.pow(2,10)):31==c?d?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,c-15)*(1+d/Math.pow(2,10))},e._GetHalfFloatAsFloatRGBAArrayBuffer=function(b,a,c,d,f,g){for(var h=new Float32Array(d),j=new Uint16Array(f,c),m=0,w=0;w<a;w++)for(var z=0;z<b;z++){var C=4*(z+w*b);h[m]=e._FromHalfFloat(j[C]),h[m+1]=e._FromHalfFloat(j[C+1]),h[m+2]=e._FromHalfFloat(j[C+2]),e.StoreLODInAlphaChannel?h[m+3]=g:h[m+3]=e._FromHalfFloat(j[C+3]),m+=4}return h},e._GetHalfFloatRGBAArrayBuffer=function(b,a,c,d,f,g){if(e.StoreLODInAlphaChannel){for(var h=new Uint16Array(d),j=new Uint16Array(f,c),m=0,w=0;w<a;w++)for(var z=0;z<b;z++){var C=4*(z+w*b);h[m]=j[C],h[m+1]=j[C+1],h[m+2]=j[C+2],h[m+3]=e._ToHalfFloat(g),m+=4}return h}return new Uint16Array(f,c,d)},e._GetFloatRGBAArrayBuffer=function(b,a,c,d,f,g){if(e.StoreLODInAlphaChannel){for(var h=new Float32Array(d),j=new Float32Array(f,c),m=0,w=0;w<a;w++)for(var z=0;z<b;z++){var C=4*(z+w*b);h[m]=j[C],h[m+1]=j[C+1],h[m+2]=j[C+2],h[m+3]=g,m+=4}return h}return new Float32Array(f,c,d)},e._GetFloatAsUIntRGBAArrayBuffer=function(b,a,c,d,f,g){for(var h=new Uint8Array(d),j=new Float32Array(f,c),m=0,w=0;w<a;w++)for(var z=0;z<b;z++){var C=4*(z+w*b);h[m]=255*aa.a.Clamp(j[C]),h[m+1]=255*aa.a.Clamp(j[C+1]),h[m+2]=255*aa.a.Clamp(j[C+2]),e.StoreLODInAlphaChannel?h[m+3]=g:h[m+3]=255*aa.a.Clamp(j[C+3]),m+=4}return h},e._GetHalfFloatAsUIntRGBAArrayBuffer=function(b,a,c,d,f,g){for(var h=new Uint8Array(d),j=new Uint16Array(f,c),m=0,w=0;w<a;w++)for(var z=0;z<b;z++){var C=4*(z+w*b);h[m]=255*aa.a.Clamp(e._FromHalfFloat(j[C])),h[m+1]=255*aa.a.Clamp(e._FromHalfFloat(j[C+1])),h[m+2]=255*aa.a.Clamp(e._FromHalfFloat(j[C+2])),e.StoreLODInAlphaChannel?h[m+3]=g:h[m+3]=255*aa.a.Clamp(e._FromHalfFloat(j[C+3])),m+=4}return h},e._GetRGBAArrayBuffer=function(b,a,c,d,f,g,h,j,m){for(var w=new Uint8Array(d),z=new Uint8Array(f,c),C=0,J=0;J<a;J++)for(var K=0;K<b;K++){var N=4*(K+J*b);w[C]=z[N+g],w[C+1]=z[N+h],w[C+2]=z[N+j],w[C+3]=z[N+m],C+=4}return w},e._ExtractLongWordOrder=function(b){return 0===b||255===b||-16777216===b?0:1+e._ExtractLongWordOrder(b>>8)},e._GetRGBArrayBuffer=function(b,a,c,d,f,g,h,j){for(var m=new Uint8Array(d),w=new Uint8Array(f,c),z=0,C=0;C<a;C++)for(var J=0;J<b;J++){var K=3*(J+C*b);m[z]=w[K+g],m[z+1]=w[K+h],m[z+2]=w[K+j],z+=3}return m},e._GetLuminanceArrayBuffer=function(b,a,c,d,f){for(var g=new Uint8Array(d),h=new Uint8Array(f,c),j=0,m=0;m<a;m++)for(var w=0;w<b;w++){var z=w+m*b;g[j]=h[z],j++}return g},e.UploadDDSLevels=function(b,a,c,d,f,g,h,j){void 0===h&&(h=-1);var m=null;d.sphericalPolynomial&&(m=new Array());var w,z,C,J,K,N,T,Z=b.getCaps().s3tc,_=new Int32Array(c.buffer,c.byteOffset,31),ca=0,ea=0,fa=1;if(542327876===_[0])if(d.isFourCC||d.isRGB||d.isLuminance)if(!d.isCompressed||Z){var ka=_[22];J=_[1]+4;var pa,va=!1;if(d.isFourCC)switch(w=_[21]){case Ki:fa=8,ea=Z.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case Li:fa=16,ea=Z.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Mi:fa=16,ea=Z.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:va=!0;break;case Gg:J+=20;var sa=!1;switch(d.dxgiFormat){case 10:case 2:va=!0,sa=!0;break;case 88:d.isRGB=!0,d.isFourCC=!1,ka=32,sa=!0}if(sa)break;default:return void console.error("Unsupported FourCC code:",(pa=w,String.fromCharCode(255&pa,pa>>8&255,pa>>16&255,pa>>24&255)))}var la=e._ExtractLongWordOrder(_[23]),ta=e._ExtractLongWordOrder(_[24]),Da=e._ExtractLongWordOrder(_[25]),ua=e._ExtractLongWordOrder(_[26]);va&&(ea=b._getRGBABufferInternalSizedFormat(d.textureType)),N=1,131072&_[2]&&!1!==f&&(N=Math.max(1,_[7]));for(var Aa=j||0;Aa<g;Aa++){for(z=_[4],C=_[3],T=0;T<N;++T){if(-1===h||h===T){var za=-1===h?T:0;if(!d.isCompressed&&d.isFourCC){a.format=p.a.TEXTUREFORMAT_RGBA,ca=z*C*4;var Fa=null;b._badOS||b._badDesktopOS||!b.getCaps().textureHalfFloat&&!b.getCaps().textureFloat?(128===ka?(Fa=e._GetFloatAsUIntRGBAArrayBuffer(z,C,c.byteOffset+J,ca,c.buffer,za),m&&0==za&&m.push(e._GetFloatRGBAArrayBuffer(z,C,c.byteOffset+J,ca,c.buffer,za))):64===ka&&(Fa=e._GetHalfFloatAsUIntRGBAArrayBuffer(z,C,c.byteOffset+J,ca,c.buffer,za),m&&0==za&&m.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(z,C,c.byteOffset+J,ca,c.buffer,za))),a.type=p.a.TEXTURETYPE_UNSIGNED_INT):128===ka?(a.type=p.a.TEXTURETYPE_FLOAT,Fa=e._GetFloatRGBAArrayBuffer(z,C,c.byteOffset+J,ca,c.buffer,za),m&&0==za&&m.push(Fa)):64!==ka||b.getCaps().textureHalfFloat?(a.type=p.a.TEXTURETYPE_HALF_FLOAT,Fa=e._GetHalfFloatRGBAArrayBuffer(z,C,c.byteOffset+J,ca,c.buffer,za),m&&0==za&&m.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(z,C,J,ca,c.buffer,za))):(a.type=p.a.TEXTURETYPE_FLOAT,Fa=e._GetHalfFloatAsFloatRGBAArrayBuffer(z,C,c.byteOffset+J,ca,c.buffer,za),m&&0==za&&m.push(Fa)),Fa&&b._uploadDataToTextureDirectly(a,Fa,Aa,za)}else if(d.isRGB)a.type=p.a.TEXTURETYPE_UNSIGNED_INT,24===ka?(a.format=p.a.TEXTUREFORMAT_RGB,ca=z*C*3,K=e._GetRGBArrayBuffer(z,C,c.byteOffset+J,ca,c.buffer,la,ta,Da),b._uploadDataToTextureDirectly(a,K,Aa,za)):(a.format=p.a.TEXTUREFORMAT_RGBA,ca=z*C*4,K=e._GetRGBAArrayBuffer(z,C,c.byteOffset+J,ca,c.buffer,la,ta,Da,ua),b._uploadDataToTextureDirectly(a,K,Aa,za));else if(d.isLuminance){var La=b._getUnpackAlignement(),Ta=z;ca=Math.floor((z+La-1)/La)*La*(C-1)+Ta,K=e._GetLuminanceArrayBuffer(z,C,c.byteOffset+J,ca,c.buffer),a.format=p.a.TEXTUREFORMAT_LUMINANCE,a.type=p.a.TEXTURETYPE_UNSIGNED_INT,b._uploadDataToTextureDirectly(a,K,Aa,za)}else ca=Math.max(4,z)/4*Math.max(4,C)/4*fa,K=new Uint8Array(c.buffer,c.byteOffset+J,ca),a.type=p.a.TEXTURETYPE_UNSIGNED_INT,b._uploadCompressedDataToTextureDirectly(a,ea,z,C,K,Aa,za)}J+=ka?z*C*(ka/8):ca,z*=.5,C*=.5,z=Math.max(1,z),C=Math.max(1,C)}if(void 0!==j)break}m&&m.length>0?d.sphericalPolynomial=cf.ConvertCubeMapToSphericalPolynomial({size:_[4],right:m[0],left:m[1],up:m[2],down:m[3],front:m[4],back:m[5],format:p.a.TEXTUREFORMAT_RGBA,type:p.a.TEXTURETYPE_FLOAT,gammaSpace:!1}):d.sphericalPolynomial=void 0}else k.a.Error("Compressed textures are not supported on this platform.");else k.a.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else k.a.Error("Invalid magic number in DDS header")},e.StoreLODInAlphaChannel=!1,e}();Cb.a.prototype.createPrefilteredCubeTexture=function(e,b,a,c,d,f,g,h,j){var m=this;return void 0===d&&(d=null),void 0===f&&(f=null),void 0===h&&(h=null),void 0===j&&(j=!0),this.createCubeTexture(e,b,null,!1,function(w){if(w){var z=w.texture;if(j?w.info.sphericalPolynomial&&(z._sphericalPolynomial=w.info.sphericalPolynomial):z._sphericalPolynomial=new te(),z._source=mb.b.CubePrefiltered,m.getCaps().textureLOD)d&&d(z);else{var C=m._gl,J=w.width;if(J){for(var K=[],N=0;N<3;N++){var T=1-N/2,Z=c,_=aa.a.Log2(J)*a+c,ca=Z+(_-Z)*T,ea=Math.round(Math.min(Math.max(ca,0),_)),fa=new mb.a(m,mb.b.Temp);if(fa.type=z.type,fa.format=z.format,fa.width=Math.pow(2,Math.max(aa.a.Log2(J)-ea,0)),fa.height=fa.width,fa.isCube=!0,m._bindTextureDirectly(C.TEXTURE_CUBE_MAP,fa,!0),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MAG_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),w.isDDS){var ka=w.info,pa=w.data;m._unpackFlipY(ka.isCompressed),_c.UploadDDSLevels(m,fa,pa,ka,!0,6,ea)}else k.a.Warn("DDS is the only prefiltered cube map supported so far.");m._bindTextureDirectly(C.TEXTURE_CUBE_MAP,null);var va=new hc.a(b);va.isCube=!0,va._texture=fa,fa.isReady=!0,K.push(va)}z._lodTextureHigh=K[2],z._lodTextureMid=K[1],z._lodTextureLow=K[0],d&&d(z)}}}else d&&d(null)},f,g,h,j,a,c)};var Ni=function(){function e(){this.supportCascades=!0}return e.prototype.canLoad=function(b){return oc.a.EndsWith(b,".dds")},e.prototype.loadCubeData=function(b,a,c,d,f){var g,h=a.getEngine(),j=!1;if(Array.isArray(b))for(var m=0;m<b.length;m++){var w=b[m];g=_c.GetDDSInfo(w),a.width=g.width,a.height=g.height,j=(g.isRGB||g.isLuminance||g.mipmapCount>1)&&a.generateMipMaps,h._unpackFlipY(g.isCompressed),_c.UploadDDSLevels(h,a,w,g,j,6,-1,m),g.isFourCC||1!==g.mipmapCount||h.generateMipMapsForCubemap(a)}else{var z=b;g=_c.GetDDSInfo(z),a.width=g.width,a.height=g.height,c&&(g.sphericalPolynomial=new te()),j=(g.isRGB||g.isLuminance||g.mipmapCount>1)&&a.generateMipMaps,h._unpackFlipY(g.isCompressed),_c.UploadDDSLevels(h,a,z,g,j,6),g.isFourCC||1!==g.mipmapCount||h.generateMipMapsForCubemap(a,!1)}h._setCubeMapTextureParams(j),a.isReady=!0,a.onLoadedObservable.notifyObservers(a),a.onLoadedObservable.clear(),d&&d({isDDS:!0,width:a.width,info:g,data:b,texture:a})},e.prototype.loadData=function(b,a,c){var d=_c.GetDDSInfo(b),f=(d.isRGB||d.isLuminance||d.mipmapCount>1)&&a.generateMipMaps&&d.width>>d.mipmapCount-1==1;c(d.width,d.height,f,d.isFourCC,function(){_c.UploadDDSLevels(a.getEngine(),a,b,d,f,1)})},e}();Ha.a._TextureLoaders.push(new Ni());var Oi=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(b){return oc.a.EndsWith(b,".env")},e.prototype.loadCubeData=function(b,a,c,d,f){if(!Array.isArray(b)){var g=Nc.GetEnvInfo(b);g?(a.width=g.width,a.height=g.width,Nc.UploadEnvSpherical(a,g),Nc.UploadEnvLevelsAsync(a,b,g).then(function(){a.isReady=!0,a.onLoadedObservable.notifyObservers(a),a.onLoadedObservable.clear(),d&&d()})):f&&f("Can not parse the environment file",null)}},e.prototype.loadData=function(b,a,c){throw".env not supported in 2d."},e}();Ha.a._TextureLoaders.push(new Oi());var qf=function(){function e(b,a,c,d){if(this.data=b,this.isInvalid=!1,!e.IsValid(b))return this.isInvalid=!0,void k.a.Error("texture missing KTX identifier");var f=Uint32Array.BYTES_PER_ELEMENT,g=new DataView(this.data.buffer,this.data.byteOffset+12,13*f),h=67305985===g.getUint32(0,!0);this.glType=g.getUint32(1*f,h),this.glTypeSize=g.getUint32(2*f,h),this.glFormat=g.getUint32(3*f,h),this.glInternalFormat=g.getUint32(4*f,h),this.glBaseInternalFormat=g.getUint32(5*f,h),this.pixelWidth=g.getUint32(6*f,h),this.pixelHeight=g.getUint32(7*f,h),this.pixelDepth=g.getUint32(8*f,h),this.numberOfArrayElements=g.getUint32(9*f,h),this.numberOfFaces=g.getUint32(10*f,h),this.numberOfMipmapLevels=g.getUint32(11*f,h),this.bytesOfKeyValueData=g.getUint32(12*f,h),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===a?this.loadType=e.COMPRESSED_2D:k.a.Error("number of faces expected"+a+", but found "+this.numberOfFaces):k.a.Error("texture arrays not currently supported"):k.a.Error("only 2D textures currently supported")):k.a.Error("only compressed formats currently supported")}return e.prototype.uploadLevels=function(b,a){switch(this.loadType){case e.COMPRESSED_2D:this._upload2DCompressedLevels(b,a);break;case e.TEX_2D:case e.COMPRESSED_3D:case e.TEX_3D:}},e.prototype._upload2DCompressedLevels=function(b,a){for(var c=e.HEADER_LEN+this.bytesOfKeyValueData,d=this.pixelWidth,f=this.pixelHeight,g=a?this.numberOfMipmapLevels:1,h=0;h<g;h++){var j=new Int32Array(this.data.buffer,this.data.byteOffset+c,1)[0];c+=4;for(var m=0;m<this.numberOfFaces;m++){var w=new Uint8Array(this.data.buffer,this.data.byteOffset+c,j);b.getEngine()._uploadCompressedDataToTextureDirectly(b,this.glInternalFormat,d,f,w,m,h),c+=j,c+=3-(j+3)%4}d=Math.max(1,.5*d),f=Math.max(1,.5*f)}},e.IsValid=function(b){if(b.byteLength>=12){var a=new Uint8Array(b.buffer,b.byteOffset,12);if(171===a[0]&&75===a[1]&&84===a[2]&&88===a[3]&&32===a[4]&&49===a[5]&&49===a[6]&&187===a[7]&&13===a[8]&&10===a[9]&&26===a[10]&&10===a[11])return!0}return!1},e.HEADER_LEN=64,e.COMPRESSED_2D=0,e.COMPRESSED_3D=1,e.TEX_2D=2,e.TEX_3D=3,e}(),Pi=function(){function e(b){var a=this;e._ModulePromise||(e._ModulePromise=new Promise(function(c){LIBKTX().then(function(d){d.GL.makeContextCurrent(d.GL.registerContext(b._gl,{majorVersion:b._webGLVersion})),e._TranscodeFormat=a._determineTranscodeFormat(d.TranscodeTarget,b.getCaps()),c({module:d})})}))}return e.prototype.uploadAsync=function(b,a){return e._ModulePromise.then(function(c){var d=new c.module.ktxTexture(b);try{d.isBasisSupercompressed&&d.transcodeBasis(e._TranscodeFormat,0),a.width=a.baseWidth=d.baseWidth,a.height=a.baseHeight=d.baseHeight,a.generateMipMaps=!1;var f=d.glUpload();if(0!==f.error)throw new Error("Failed to upload: "+f.error);a._webGLTexture=f.texture,a.isReady=!0}finally{d.delete()}})},e.prototype._determineTranscodeFormat=function(b,a){if(a.s3tc)return b.BC1_OR_3;if(a.etc2)return b.ETC;throw new Error("No compatible format available")},e.IsValid=function(b){if(b.byteLength>=12){var a=new Uint8Array(b.buffer,b.byteOffset,12);if(171===a[0]&&75===a[1]&&84===a[2]&&88===a[3]&&32===a[4]&&50===a[5]&&48===a[6]&&187===a[7]&&13===a[8]&&10===a[9]&&26===a[10]&&10===a[11])return!0}return!1},e}(),Qi=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(b){return oc.a.EndsWith(b,".ktx")||oc.a.EndsWith(b,".ktx2")},e.prototype.loadCubeData=function(b,a,c,d,f){if(!Array.isArray(b)){a._invertVScale=!a.invertY;var g=a.getEngine(),h=new qf(b,6),j=h.numberOfMipmapLevels>1&&a.generateMipMaps;g._unpackFlipY(!0),h.uploadLevels(a,a.generateMipMaps),a.width=h.pixelWidth,a.height=h.pixelHeight,g._setCubeMapTextureParams(j),a.isReady=!0,a.onLoadedObservable.notifyObservers(a),a.onLoadedObservable.clear(),d&&d()}},e.prototype.loadData=function(b,a,c){if(qf.IsValid(b)){a._invertVScale=!a.invertY;var d=new qf(b,1);c(d.pixelWidth,d.pixelHeight,a.generateMipMaps,!0,function(){d.uploadLevels(a,a.generateMipMaps)},d.isInvalid)}else Pi.IsValid(b)?new Pi(a.getEngine()).uploadAsync(b,a).then(function(){c(a.width,a.height,!1,!0,function(){},!1)},function(f){k.a.Warn("Failed to load KTX2 texture data: "+f.message),c(0,0,!1,!1,function(){},!0)}):c(0,0,!1,!1,function(){},!0)},e}();Ha.a._TextureLoaders.unshift(new Qi());var Ri=function(e){function b(a,c,d){var f=e.call(this,a,i.e.Zero(),c)||this;return f._xrSessionManager=d,f._firstFrame=!1,f._referenceQuaternion=i.b.Identity(),f._referencedPosition=new i.e(),f._xrInvPositionCache=new i.e(),f._xrInvQuaternionCache=i.b.Identity(),f.compensateOnFirstFrame=!0,f.minZ=.1,f.rotationQuaternion=new i.b(),f.cameraRigMode=hb.a.RIG_MODE_CUSTOM,f.updateUpVectorFromRotation=!0,f._updateNumberOfRigCameras(1),f._xrSessionManager.onXRSessionInit.add(function(){f._referencedPosition.copyFromFloats(0,0,0),f._referenceQuaternion.copyFromFloats(0,0,0,1),f._firstFrame=f.compensateOnFirstFrame}),f._xrSessionManager.onXRFrameObservable.add(function(g){f._firstFrame&&f._updateFromXRSession(),f._updateReferenceSpace(),f._updateFromXRSession()},void 0,!0),f}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"realWorldHeight",{get:function(){var a=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.baseReferenceSpace);return a&&a.transform?a.transform.position.y:0},enumerable:!0,configurable:!0}),b.prototype._updateForDualEyeDebugging=function(){this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new Jc.a(0,0,.5,1),this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new Jc.a(.5,0,.5,1),this.rigCameras[1].outputRenderTarget=null},b.prototype.setTransformationFromNonVRCamera=function(a,c){(void 0===a&&(a=this.getScene().activeCamera),void 0===c&&(c=!0),a&&a!==this)&&(a.computeWorldMatrix().decompose(void 0,this.rotationQuaternion,this.position),this.position.y=0,i.b.FromEulerAnglesToRef(0,this.rotationQuaternion.toEulerAngles().y,0,this.rotationQuaternion),this._firstFrame=!0,c&&this._xrSessionManager.resetReferenceSpace())},b.prototype.getClassName=function(){return"WebXRCamera"},b.prototype._updateFromXRSession=function(){var a=this,c=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.referenceSpace);c&&(c.transform&&(this._referencedPosition.copyFrom(c.transform.position),this._referenceQuaternion.copyFrom(c.transform.orientation),this._scene.useRightHandedSystem||(this._referencedPosition.z*=-1,this._referenceQuaternion.z*=-1,this._referenceQuaternion.w*=-1),this._firstFrame?(this._firstFrame=!1,this.position.y+=this._referencedPosition.y,this._referenceQuaternion.copyFromFloats(0,0,0,1)):(this.rotationQuaternion.copyFrom(this._referenceQuaternion),this.position.copyFrom(this._referencedPosition))),this.rigCameras.length!==c.views.length&&this._updateNumberOfRigCameras(c.views.length),c.views.forEach(function(d,f){var g=a.rigCameras[f];if(g.isLeftCamera||g.isRightCamera||("right"===d.eye?g._isRightCamera=!0:"left"===d.eye&&(g._isLeftCamera=!0)),d.transform.position?(g.position.copyFrom(d.transform.position),g.rotationQuaternion.copyFrom(d.transform.orientation),a._scene.useRightHandedSystem||(g.position.z*=-1,g.rotationQuaternion.z*=-1,g.rotationQuaternion.w*=-1)):(i.a.FromFloat32ArrayToRefScaled(d.transform.matrix,0,1,g._computedViewMatrix),a._scene.useRightHandedSystem||g._computedViewMatrix.toggleModelMatrixHandInPlace()),i.a.FromFloat32ArrayToRefScaled(d.projectionMatrix,0,1,g._projectionMatrix),a._scene.useRightHandedSystem||g._projectionMatrix.toggleProjectionMatrixHandInPlace(),a._xrSessionManager.session.renderState.baseLayer){var h=a._xrSessionManager.session.renderState.baseLayer.getViewport(d),j=a._xrSessionManager.session.renderState.baseLayer.framebufferWidth,m=a._xrSessionManager.session.renderState.baseLayer.framebufferHeight;g.viewport.width=h.width/j,g.viewport.height=h.height/m,g.viewport.x=h.x/j,g.viewport.y=h.y/m}g.outputRenderTarget=a._xrSessionManager.getRenderTargetTextureForEye(d.eye)}))},b.prototype._updateNumberOfRigCameras=function(a){for(void 0===a&&(a=1);this.rigCameras.length<a;){var c=new Uc("XR-RigCamera: "+this.rigCameras.length,i.e.Zero(),this.getScene());c.minZ=.1,c.rotationQuaternion=new i.b(),c.updateUpVectorFromRotation=!0,c.isRigCamera=!0,c.rigParent=this,this.rigCameras.push(c)}for(;this.rigCameras.length>a;){var d=this.rigCameras.pop();d&&d.dispose()}},b.prototype._updateReferenceSpace=function(){this.position.equals(this._referencedPosition)&&this.rotationQuaternion.equals(this._referenceQuaternion)||(this.position.subtractToRef(this._referencedPosition,this._referencedPosition),this._referenceQuaternion.conjugateInPlace(),this._referenceQuaternion.multiplyToRef(this.rotationQuaternion,this._referenceQuaternion),this._updateReferenceSpaceOffset(this._referencedPosition,this._referenceQuaternion.normalize()))},b.prototype._updateReferenceSpaceOffset=function(a,c,d){if(void 0===d&&(d=!1),this._xrSessionManager.referenceSpace&&this._xrSessionManager.currentFrame){this._xrInvPositionCache.copyFrom(a),c?this._xrInvQuaternionCache.copyFrom(c):this._xrInvQuaternionCache.copyFromFloats(0,0,0,1),this._scene.useRightHandedSystem||(this._xrInvPositionCache.z*=-1,this._xrInvQuaternionCache.z*=-1,this._xrInvQuaternionCache.w*=-1),this._xrInvPositionCache.negateInPlace(),this._xrInvQuaternionCache.conjugateInPlace(),this._xrInvPositionCache.rotateByQuaternionToRef(this._xrInvQuaternionCache,this._xrInvPositionCache),d&&(this._xrInvPositionCache.y=0);var f=new XRRigidTransform(Object(l.a)({},this._xrInvPositionCache),Object(l.a)({},this._xrInvQuaternionCache)),g=this._xrSessionManager.referenceSpace.getOffsetReferenceSpace(f),h=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(g);if(h){var j=new i.e();j.copyFrom(h.transform.position),this._scene.useRightHandedSystem||(j.z*=-1),this.position.subtractToRef(j,j),this._scene.useRightHandedSystem||(j.z*=-1),j.negateInPlace();var m=new XRRigidTransform(Object(l.a)({},j));this._xrSessionManager.referenceSpace=g.getOffsetReferenceSpace(m)}}},b}(nc),$c=function(){function e(){}return e.ANCHOR_SYSTEM="xr-anchor-system",e.BACKGROUND_REMOVER="xr-background-remover",e.HIT_TEST="xr-hit-test",e.PHYSICS_CONTROLLERS="xr-physics-controller",e.PLANE_DETECTION="xr-plane-detection",e.POINTER_SELECTION="xr-controller-pointer-selection",e.TELEPORTATION="xr-controller-teleportation",e}(),ad=function(){function e(b){var a=this;this._xrSessionManager=b,this._features={},this._xrSessionManager.onXRSessionInit.add(function(){a.getEnabledFeatures().forEach(function(c){var d=a._features[c];!d.enabled||d.featureImplementation.attached||d.featureImplementation.disableAutoAttach||a.attachFeature(c)})}),this._xrSessionManager.onXRSessionEnded.add(function(){a.getEnabledFeatures().forEach(function(c){var d=a._features[c];d.enabled&&d.featureImplementation.attached&&a.detachFeature(c)})})}return e.AddWebXRFeature=function(b,a,c,d){void 0===c&&(c=1),void 0===d&&(d=!1),this._AvailableFeatures[b]=this._AvailableFeatures[b]||{latest:c},c>this._AvailableFeatures[b].latest&&(this._AvailableFeatures[b].latest=c),d&&(this._AvailableFeatures[b].stable=c),this._AvailableFeatures[b][c]=a},e.ConstructFeature=function(b,a,c,d){void 0===a&&(a=1);var f=this._AvailableFeatures[b][a];if(!f)throw new Error("feature not found");return f(c,d)},e.GetAvailableFeatures=function(){return Object.keys(this._AvailableFeatures)},e.GetAvailableVersions=function(b){return Object.keys(this._AvailableFeatures[b])},e.GetLatestVersionOfFeature=function(b){return this._AvailableFeatures[b]&&this._AvailableFeatures[b].latest||-1},e.GetStableVersionOfFeature=function(b){return this._AvailableFeatures[b]&&this._AvailableFeatures[b].stable||-1},e.prototype.attachFeature=function(b){var a=this._features[b];a&&a.enabled&&!a.featureImplementation.attached&&a.featureImplementation.attach()},e.prototype.detachFeature=function(b){var a=this._features[b];a&&a.featureImplementation.attached&&a.featureImplementation.detach()},e.prototype.disableFeature=function(b){var a="string"==typeof b?b:b.Name,c=this._features[a];return!(!c||!c.enabled)&&(c.enabled=!1,this.detachFeature(a),c.featureImplementation.dispose(),!0)},e.prototype.dispose=function(){var b=this;this.getEnabledFeatures().forEach(function(a){b.disableFeature(a),b._features[a].featureImplementation.dispose()})},e.prototype.enableFeature=function(b,a,c,d){void 0===a&&(a="latest"),void 0===c&&(c={}),void 0===d&&(d=!0);var f="string"==typeof b?b:b.Name,g=0;if("string"==typeof a){if(!a)throw new Error("Error in provided version - "+f+" ("+a+")");if(-1===(g="stable"===a?e.GetStableVersionOfFeature(f):"latest"===a?e.GetLatestVersionOfFeature(f):+a)||isNaN(g))throw new Error("feature not found - "+f+" ("+a+")")}else g=a;var h=this._features[f],j=e.ConstructFeature(f,g,this._xrSessionManager,c);if(!j)throw new Error("feature not found - "+f);return h&&this.disableFeature(f),this._features[f]={featureImplementation:j(),enabled:!0,version:g},d?this._xrSessionManager.session&&!h.featureImplementation.attached&&this.attachFeature(f):this._features[f].featureImplementation.disableAutoAttach=!0,this._features[f].featureImplementation},e.prototype.getEnabledFeature=function(b){return this._features[b]&&this._features[b].featureImplementation},e.prototype.getEnabledFeatures=function(){return Object.keys(this._features)},e._AvailableFeatures={},e}(),Si=function(){function e(b){var a=this;this.scene=b,this._nonVRCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this.onInitialXRPoseSetObservable=new I.c(),this.onStateChangedObservable=new I.c(),this.state=Tb.NOT_IN_XR,this.sessionManager=new pg(b),this.camera=new Ri("",b,this.sessionManager),this.featuresManager=new ad(this.sessionManager),b.onDisposeObservable.add(function(){a.exitXRAsync()})}return e.CreateAsync=function(b){var a=new e(b);return a.sessionManager.initializeAsync().then(function(){return a._supported=!0,a}).catch(function(c){throw a._setState(Tb.NOT_IN_XR),a.dispose(),c})},e.prototype.dispose=function(){this.camera.dispose(),this.onStateChangedObservable.clear(),this.onInitialXRPoseSetObservable.clear(),this.sessionManager.dispose(),this._nonVRCamera&&(this.scene.activeCamera=this._nonVRCamera)},e.prototype.enterXRAsync=function(b,a,c){var d=this;if(void 0===c&&(c=this.sessionManager.getWebXRRenderTarget()),!this._supported)throw"WebXR not supported in this browser or environment";this._setState(Tb.ENTERING_XR);var f={optionalFeatures:"viewer"!==a&&"local"!==a?[a]:[]};return"immersive-ar"===b&&"local"!==a&&k.a.Warn("We recommend using 'local' reference space type when using 'immersive-ar' session mode"),this.sessionManager.isSessionSupportedAsync(b).then(function(g){if(!g)throw new Error('Session mode "'+b+'" not supported in browser');return d.sessionManager.initializeSessionAsync(b,f)}).then(function(){return d.sessionManager.setReferenceSpaceTypeAsync(a)}).then(function(){return c.initializeXRLayerAsync(d.sessionManager.session)}).then(function(){return d.sessionManager.updateRenderStateAsync({depthFar:d.camera.maxZ,depthNear:d.camera.minZ,baseLayer:c.xrLayer})}).then(function(){return d.sessionManager.runXRRenderLoop(),d._originalSceneAutoClear=d.scene.autoClear,d._nonVRCamera=d.scene.activeCamera,d.scene.autoClear=!1,d.scene.activeCamera=d.camera,"immersive-ar"!==b?d._nonXRToXRCamera():d.camera.compensateOnFirstFrame=!1,d.sessionManager.onXRSessionEnded.addOnce(function(){d.camera.rigCameras.forEach(function(g){g.outputRenderTarget=null}),d.scene.autoClear=d._originalSceneAutoClear,d.scene.activeCamera=d._nonVRCamera,"immersive-ar"!==b&&d.camera.compensateOnFirstFrame&&(d._nonVRCamera.setPosition?d._nonVRCamera.setPosition(d.camera.position):d._nonVRCamera.position.copyFrom(d.camera.position)),d._setState(Tb.NOT_IN_XR)}),d.sessionManager.onXRFrameObservable.addOnce(function(){d._setState(Tb.IN_XR)}),d.sessionManager}).catch(function(g){throw console.log(g),console.log(g.message),d._setState(Tb.NOT_IN_XR),g})},e.prototype.exitXRAsync=function(){return this._setState(Tb.EXITING_XR),this.sessionManager.exitXRAsync()},e.prototype._nonXRToXRCamera=function(){this.camera.setTransformationFromNonVRCamera(this._nonVRCamera),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)},e.prototype._setState=function(b){this.state!==b&&(this.state=b,this.onStateChangedObservable.notifyObservers(this.state))},e}(),Qd=function(){function e(b,a,c,d){void 0===c&&(c=-1),void 0===d&&(d=[]),this.id=b,this.type=a,this._buttonIndex=c,this._axesIndices=d,this._axes={x:0,y:0},this._changes={},this._currentValue=0,this._hasChanges=!1,this._pressed=!1,this._touched=!1,this.onAxisValueChangedObservable=new I.c(),this.onButtonStateChangedObservable=new I.c()}return Object.defineProperty(e.prototype,"axes",{get:function(){return this._axes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changes",{get:function(){return this._changes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasChanges",{get:function(){return this._hasChanges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pressed",{get:function(){return this._pressed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"touched",{get:function(){return this._touched},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._currentValue},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.onAxisValueChangedObservable.clear(),this.onButtonStateChangedObservable.clear()},e.prototype.isAxes=function(){return 0!==this._axesIndices.length},e.prototype.isButton=function(){return-1!==this._buttonIndex},e.prototype.update=function(b){var a=!1,c=!1;if(this._hasChanges=!1,this._changes={},this.isButton()){var d=b.buttons[this._buttonIndex];if(!d)return;this._currentValue!==d.value&&(this.changes.value={current:d.value,previous:this._currentValue},a=!0,this._currentValue=d.value),this._touched!==d.touched&&(this.changes.touched={current:d.touched,previous:this._touched},a=!0,this._touched=d.touched),this._pressed!==d.pressed&&(this.changes.pressed={current:d.pressed,previous:this._pressed},a=!0,this._pressed=d.pressed)}this.isAxes()&&(this._axes.x!==b.axes[this._axesIndices[0]]&&(this.changes.axes={current:{x:b.axes[this._axesIndices[0]],y:this._axes.y},previous:{x:this._axes.x,y:this._axes.y}},this._axes.x=b.axes[this._axesIndices[0]],c=!0),this._axes.y!==b.axes[this._axesIndices[1]]&&(this.changes.axes?this.changes.axes.current.y=b.axes[this._axesIndices[1]]:this.changes.axes={current:{x:this._axes.x,y:b.axes[this._axesIndices[1]]},previous:{x:this._axes.x,y:this._axes.y}},this._axes.y=b.axes[this._axesIndices[1]],c=!0)),a&&(this._hasChanges=!0,this.onButtonStateChangedObservable.notifyObservers(this)),c&&(this._hasChanges=!0,this.onAxisValueChangedObservable.notifyObservers(this._axes))},e.BUTTON_TYPE="button",e.SQUEEZE_TYPE="squeeze",e.THUMBSTICK_TYPE="thumbstick",e.TOUCHPAD_TYPE="touchpad",e.TRIGGER_TYPE="trigger",e}(),Rd=function(){function e(b,a,c,d,f){var g=this;void 0===f&&(f=!1),this.scene=b,this.layout=a,this.gamepadObject=c,this.handness=d,this._initComponent=function(h){if(h){var j=g.layout.components[h],m=j.type,w=j.gamepadIndices.button,z=[];void 0!==j.gamepadIndices.xAxis&&void 0!==j.gamepadIndices.yAxis&&z.push(j.gamepadIndices.xAxis,j.gamepadIndices.yAxis),g.components[h]=new Qd(h,m,w,z)}},this._modelReady=!1,this.components={},this.disableAnimation=!1,this.onModelLoadedObservable=new I.c(),a.components&&Object.keys(a.components).forEach(this._initComponent)}return e.prototype.dispose=function(){var b=this;this.getComponentIds().forEach(function(a){return b.getComponent(a).dispose()}),this.rootMesh&&this.rootMesh.dispose()},e.prototype.getAllComponentsOfType=function(b){var a=this;return this.getComponentIds().map(function(c){return a.components[c]}).filter(function(c){return c.type===b})},e.prototype.getComponent=function(b){return this.components[b]},e.prototype.getComponentIds=function(){return Object.keys(this.components)},e.prototype.getComponentOfType=function(b){return this.getAllComponentsOfType(b)[0]||null},e.prototype.getMainComponent=function(){return this.getComponent(this.layout.selectComponentId)},e.prototype.loadModel=function(){return Object(l.b)(this,void 0,void 0,function(){var b,a,c=this;return Object(l.e)(this,function(d){return b=!this._getModelLoadingConstraints(),a=this._getGenericFilenameAndPath(),b?k.a.Warn("Falling back to generic models"):a=this._getFilenameAndPath(),[2,new Promise(function(f,g){yb.ImportMesh("",a.path,a.filename,c.scene,function(h){b?c._getGenericParentMesh(h):c._setRootMesh(h),c._processLoadedModel(h),c._modelReady=!0,c.onModelLoadedObservable.notifyObservers(c),f(!0)},null,function(h,j){k.a.Log(j),k.a.Warn("Failed to retrieve controller model of type "+c.profileId+" from the remote server: "+a.path+a.filename),g(j)})})]})})},e.prototype.updateFromXRFrame=function(b){var a=this;this.getComponentIds().forEach(function(c){return a.getComponent(c).update(a.gamepadObject)}),this.updateModel(b)},e.prototype._getChildByName=function(b,a){return b.getChildren(function(c){return c.name===a},!1)[0]},e.prototype._getImmediateChildByName=function(b,a){return b.getChildren(function(c){return c.name==a},!0)[0]},e.prototype._lerpTransform=function(b,a,c){if(b.minMesh&&b.maxMesh&&b.minMesh.rotationQuaternion&&b.maxMesh.rotationQuaternion&&b.valueMesh.rotationQuaternion){var d=c?.5*a+.5:a;i.b.SlerpToRef(b.minMesh.rotationQuaternion,b.maxMesh.rotationQuaternion,d,b.valueMesh.rotationQuaternion),i.e.LerpToRef(b.minMesh.position,b.maxMesh.position,d,b.valueMesh.position)}},e.prototype.updateModel=function(b){this._modelReady&&this._updateModel(b)},e.prototype._getGenericFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},e.prototype._getGenericParentMesh=function(b){var a=this;this.rootMesh=new xa.a(this.profileId+" "+this.handness,this.scene),b.forEach(function(c){c.parent||(c.isPickable=!1,c.setParent(a.rootMesh))}),this.rootMesh.rotationQuaternion=i.b.FromEulerAngles(0,Math.PI,0)},e}(),Hg=function(e){function b(a,c,d){var f=e.call(this,a,Xm[d],c,d)||this;return f.profileId=b.ProfileId,f}return Object(l.d)(b,e),b.prototype._getFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},b.prototype._getModelLoadingConstraints=function(){return!0},b.prototype._processLoadedModel=function(a){},b.prototype._setRootMesh=function(a){var c=this;this.rootMesh=new xa.a(this.profileId+" "+this.handness,this.scene),a.forEach(function(d){d.isPickable=!1,d.parent||d.setParent(c.rootMesh)}),this.rootMesh.rotationQuaternion=i.b.FromEulerAngles(0,Math.PI,0)},b.prototype._updateModel=function(){},b.ProfileId="generic-trigger",b}(Rd),Xm={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-none",assetPath:"none.glb"}},Ti=function(e){function b(a,c,d,f){var g=e.call(this,a,d.layouts[c.handedness||"none"],c.gamepad,c.handedness)||this;return g._repositoryUrl=f,g._buttonMeshMapping={},g._touchDots={},g.profileId=d.profileId,g}return Object(l.d)(b,e),b.prototype.dispose=function(){var a=this;e.prototype.dispose.call(this),Object.keys(this._touchDots).forEach(function(c){a._touchDots[c].dispose()})},b.prototype._getFilenameAndPath=function(){return{filename:this.layout.assetPath,path:this._repositoryUrl+"/profiles/"+this.profileId+"/"}},b.prototype._getModelLoadingConstraints=function(){var a=yb.IsPluginForExtensionAvailable(".glb");return a||k.a.Warn("glTF / glb loaded was not registered, using generic controller instead"),a},b.prototype._processLoadedModel=function(a){var c=this;this.getComponentIds().forEach(function(d){var f=c.layout.components[d];c._buttonMeshMapping[d]={mainMesh:c._getChildByName(c.rootMesh,f.rootNodeName),states:{}},Object.keys(f.visualResponses).forEach(function(g){var h=f.visualResponses[g];if("transform"===h.valueNodeProperty)c._buttonMeshMapping[d].states[g]={valueMesh:c._getChildByName(c.rootMesh,h.valueNodeName),minMesh:c._getChildByName(c.rootMesh,h.minNodeName),maxMesh:c._getChildByName(c.rootMesh,h.maxNodeName)};else{var j=f.type===Qd.TOUCHPAD_TYPE&&f.touchPointNodeName?f.touchPointNodeName:h.valueNodeName;if(c._buttonMeshMapping[d].states[g]={valueMesh:c._getChildByName(c.rootMesh,j)},f.type===Qd.TOUCHPAD_TYPE&&!c._touchDots[g]){var m=jc.a.CreateSphere(g+"dot",{diameter:.0015,segments:8},c.scene);m.material=new Ab.a(g+"mat",c.scene),m.material.diffuseColor=G.a.Red(),m.parent=c._buttonMeshMapping[d].states[g].valueMesh,m.isVisible=!1,c._touchDots[g]=m}}})})},b.prototype._setRootMesh=function(a){var c;this.rootMesh=new xa.a(this.profileId+"-"+this.handness,this.scene),this.rootMesh.isPickable=!1;for(var d=0;d<a.length;d++){var f=a[d];f.isPickable=!1,f.parent||(c=f)}c&&c.setParent(this.rootMesh),this.rootMesh.rotate(Ba.a.Y,Math.PI,Ba.b.WORLD)},b.prototype._updateModel=function(a){var c=this;this.disableAnimation||this.getComponentIds().forEach(function(d){var f=c.getComponent(d);if(f.hasChanges){var g=c._buttonMeshMapping[d],h=c.layout.components[d];Object.keys(h.visualResponses).forEach(function(j){var m=h.visualResponses[j],w=f.value;"xAxis"===m.componentProperty?w=f.axes.x:"yAxis"===m.componentProperty&&(w=f.axes.y),"transform"===m.valueNodeProperty?c._lerpTransform(g.states[j],w,"button"!==m.componentProperty):(g.states[j].valueMesh.isVisible=f.touched||f.pressed,c._touchDots[j]&&(c._touchDots[j].isVisible=f.touched||f.pressed))})}})},b}(Rd),qc=function(){function e(){}return e.ClearProfilesCache=function(){delete this._ProfilesList,this._ProfileLoadingPromises={}},e.DefaultFallbacks=function(){this.RegisterFallbacksForProfileId("google-daydream",["generic-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive-focus",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("magicleap-one",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("windows-mixed-reality",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("microsoft-mixed-reality",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-go",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("oculus-touch-v2",["oculus-touch","generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-touch",["generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-gearvr",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-odyssey",["generic-touchpad"]),this.RegisterFallbacksForProfileId("valve-index",["generic-trigger-squeeze-touchpad-thumbstick"])},e.FindFallbackWithProfileId=function(b){var a=this._Fallbacks[b]||[];return a.unshift(b),a},e.GetMotionControllerWithXRInput=function(b,a,c){var d=this,f=[];if(c&&f.push(c),f.push.apply(f,b.profiles||[]),f.length&&!f[0]&&f.pop(),b.gamepad&&b.gamepad.id)switch(b.gamepad.id){case(b.gamepad.id.match(/oculus touch/gi)?b.gamepad.id:void 0):f.push("oculus-touch-v2")}var g=f.indexOf("windows-mixed-reality");if(-1!==g&&f.splice(g,0,"microsoft-mixed-reality"),f.length||f.push("generic-trigger"),this.UseOnlineRepository){var h=this.PrioritizeOnlineRepository?this._LoadProfileFromRepository:this._LoadProfilesFromAvailableControllers,j=this.PrioritizeOnlineRepository?this._LoadProfilesFromAvailableControllers:this._LoadProfileFromRepository;return h.call(this,f,b,a).catch(function(){return j.call(d,f,b,a)})}return this._LoadProfilesFromAvailableControllers(f,b,a)},e.RegisterController=function(b,a){this._AvailableControllers[b]=a},e.RegisterFallbacksForProfileId=function(b,a){var c;this._Fallbacks[b]?(c=this._Fallbacks[b]).push.apply(c,a):this._Fallbacks[b]=a},e.UpdateProfilesList=function(){return this._ProfilesList=Qa.b.LoadFileAsync(this.BaseRepositoryUrl+"/profiles/profilesList.json",!1).then(function(b){return JSON.parse(b.toString())}),this._ProfilesList},e._LoadProfileFromRepository=function(b,a,c){var d=this;return Promise.resolve().then(function(){return d._ProfilesList?d._ProfilesList:d.UpdateProfilesList()}).then(function(f){for(var g=0;g<b.length;++g)if(b[g]&&f[b[g]])return b[g];throw new Error("neither controller "+b[0]+" nor all fallbacks were found in the repository,")}).then(function(f){return d._ProfileLoadingPromises[f]||(d._ProfileLoadingPromises[f]=Qa.b.LoadFileAsync(d.BaseRepositoryUrl+"/profiles/"+f+"/profile.json",!1).then(function(g){return JSON.parse(g)})),d._ProfileLoadingPromises[f]}).then(function(f){return new Ti(c,a,f,d.BaseRepositoryUrl)})},e._LoadProfilesFromAvailableControllers=function(b,a,c){for(var d=0;d<b.length;++d)if(b[d])for(var f=this.FindFallbackWithProfileId(b[d]),g=0;g<f.length;++g){var h=this._AvailableControllers[f[g]];if(h)return Promise.resolve(h(a,c))}throw new Error("no controller requested was found in the available controllers list")},e._AvailableControllers={},e._Fallbacks={},e._ProfileLoadingPromises={},e.BaseRepositoryUrl="https://immersive-web.github.io/webxr-input-profiles/packages/viewer/dist",e.PrioritizeOnlineRepository=!0,e.UseOnlineRepository=!0,e}();qc.RegisterController(Hg.ProfileId,function(e,b){return new Hg(b,e.gamepad,e.handedness)}),qc.DefaultFallbacks();var Ym=0,Ui=function(){function e(b,a,c){var d=this;void 0===c&&(c={}),this._scene=b,this.inputSource=a,this._options=c,this._tmpQuaternion=new i.b(),this._tmpVector=new i.e(),this.onDisposeObservable=new I.c(),this.onMeshLoadedObservable=new I.c(),this.onMotionControllerInitObservable=new I.c(),this._uniqueId="controller-"+Ym+++"-"+a.targetRayMode+"-"+a.handedness,this.pointer=new qb.a(this._uniqueId+"-pointer",b),this.pointer.rotationQuaternion=new i.b(),this.inputSource.gripSpace&&(this.grip=new qb.a(this._uniqueId+"-grip",this._scene),this.grip.rotationQuaternion=new i.b()),this.inputSource.gamepad&&qc.GetMotionControllerWithXRInput(a,b,this._options.forceControllerProfile).then(function(f){d.motionController=f,d.onMotionControllerInitObservable.notifyObservers(f),d._options.doNotLoadControllerMesh||d.motionController.loadModel().then(function(g){g&&(d.onMeshLoadedObservable.notifyObservers(d.motionController.rootMesh),d.motionController.rootMesh.parent=d.grip||d.pointer,d.motionController.disableAnimation=!!d._options.disableMotionControllerAnimation)})})}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.grip&&this.grip.dispose(),this.motionController&&this.motionController.dispose(),this.pointer.dispose(),this.onMotionControllerInitObservable.clear(),this.onMeshLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e.prototype.getWorldPointerRayToRef=function(b,a){void 0===a&&(a=!1);var c=a&&this.grip?this.grip:this.pointer;c.computeWorldMatrix().decompose(void 0,this._tmpQuaternion,void 0),this._tmpVector.set(0,0,1),this._tmpVector.rotateByQuaternionToRef(this._tmpQuaternion,this._tmpVector),b.origin.copyFrom(c.absolutePosition),b.direction.copyFrom(this._tmpVector),b.length=1000},e.prototype.updateFromXRFrame=function(b,a){var c=b.getPose(this.inputSource.targetRaySpace,a);if(c&&(this.pointer.position.copyFrom(c.transform.position),this.pointer.rotationQuaternion.copyFrom(c.transform.orientation),this._scene.useRightHandedSystem||(this.pointer.position.z*=-1,this.pointer.rotationQuaternion.z*=-1,this.pointer.rotationQuaternion.w*=-1)),this.inputSource.gripSpace&&this.grip){var d=b.getPose(this.inputSource.gripSpace,a);d&&(this.grip.position.copyFrom(d.transform.position),this.grip.rotationQuaternion.copyFrom(d.transform.orientation),this._scene.useRightHandedSystem||(this.grip.position.z*=-1,this.grip.rotationQuaternion.z*=-1,this.grip.rotationQuaternion.w*=-1))}this.motionController&&this.motionController.updateFromXRFrame(b)},e}(),Vi=function(){function e(b,a,c){var d=this;void 0===c&&(c={}),this.xrSessionManager=b,this.xrCamera=a,this.options=c,this.controllers=[],this.onControllerAddedObservable=new I.c(),this.onControllerRemovedObservable=new I.c(),this._onInputSourcesChange=function(f){d._addAndRemoveControllers(f.added,f.removed)},this._sessionEndedObserver=this.xrSessionManager.onXRSessionEnded.add(function(){d._addAndRemoveControllers([],d.controllers.map(function(f){return f.inputSource}))}),this._sessionInitObserver=this.xrSessionManager.onXRSessionInit.add(function(f){f.addEventListener("inputsourceschange",d._onInputSourcesChange)}),this._frameObserver=this.xrSessionManager.onXRFrameObservable.add(function(f){d.controllers.forEach(function(g){g.updateFromXRFrame(f,d.xrSessionManager.referenceSpace)})}),this.options.customControllersRepositoryURL&&(qc.BaseRepositoryUrl=this.options.customControllersRepositoryURL),this.options.disableOnlineControllerRepository?qc.UseOnlineRepository=!1:(qc.UseOnlineRepository=!0,qc.UpdateProfilesList())}return e.prototype._addAndRemoveControllers=function(b,a){for(var c=this,d=this.controllers.map(function(z){return z.inputSource}),f=0,g=b;f<g.length;f++){var h=g[f];if(-1===d.indexOf(h)){var j=new Ui(this.xrSessionManager.scene,h,{forceControllerProfile:this.options.forceInputProfile,doNotLoadControllerMesh:this.options.doNotLoadControllerMeshes,disableMotionControllerAnimation:this.options.disableControllerAnimation});this.controllers.push(j),this.onControllerAddedObservable.notifyObservers(j)}}var m=[],w=[];this.controllers.forEach(function(z){-1===a.indexOf(z.inputSource)?m.push(z):w.push(z)}),this.controllers=m,w.forEach(function(z){c.onControllerRemovedObservable.notifyObservers(z),z.dispose()})},e.prototype.dispose=function(){this.controllers.forEach(function(b){b.dispose()}),this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver),this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver),this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver),this.onControllerAddedObservable.clear(),this.onControllerRemovedObservable.clear()},e}(),qd=function(){function e(b){this._xrSessionManager=b,this._attached=!1,this._removeOnDetach=[],this.disableAutoAttach=!1}return Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},enumerable:!0,configurable:!0}),e.prototype.attach=function(b){var a=this;if(b)this.attached&&this.detach();else if(this.attached)return!1;return this._attached=!0,this._addNewAttachObserver(this._xrSessionManager.onXRFrameObservable,function(c){return a._onXRFrame(c)}),!0},e.prototype.detach=function(){return this._attached?(this._attached=!1,this._removeOnDetach.forEach(function(b){b.observable.remove(b.observer)}),!0):(this.disableAutoAttach=!0,!1)},e.prototype.dispose=function(){this.detach()},e.prototype._addNewAttachObserver=function(b,a){this._removeOnDetach.push({observable:b,observer:b.add(a)})},e}(),Be=function(e){function b(a,c){var d=e.call(this,a)||this;return d._options=c,d._attachController=function(f){if(!d._controllers[f.uniqueId]){var g=d._generateNewMeshPair(f),h=g.laserPointer,j=g.selectionMesh;switch(d._controllers[f.uniqueId]={xrController:f,laserPointer:h,selectionMesh:j,meshUnderPointer:null,pick:null,tmpRay:new Rb.a(new i.e(),new i.e()),id:b._idCounter++},f.inputSource.targetRayMode){case"tracked-pointer":return d._attachTrackedPointerRayMode(f);case"gaze":return d._attachGazeMode(f);case"screen":return d._attachScreenRayMode(f)}}},d._controllers={},d._tmpVectorForPickCompare=new i.e(),d.disablePointerLighting=!0,d.disableSelectionMeshLighting=!0,d.displayLaserPointer=!0,d.displaySelectionMesh=!0,d.laserPointerPickedColor=new G.a(.9,.9,.9),d.lasterPointerDefaultColor=new G.a(.7,.7,.7),d.selectionMeshDefaultColor=new G.a(.8,.8,.8),d.selectionMeshPickedColor=new G.a(.3,.3,1),d._scene=d._xrSessionManager.scene,d}return Object(l.d)(b,e),b.prototype.attach=function(){var a=this;return!!e.prototype.attach.call(this)&&(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(c){a._detachController(c.uniqueId)}),!0)},b.prototype.detach=function(){var a=this;return!!e.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(c){a._detachController(c)}),!0)},b.prototype.getMeshUnderPointer=function(a){return this._controllers[a]?this._controllers[a].meshUnderPointer:null},b.prototype.getXRControllerByPointerId=function(a){for(var c=Object.keys(this._controllers),d=0;d<c.length;++d)if(this._controllers[c[d]].id===a)return this._controllers[c[d]].xrController;return null},b.prototype._onXRFrame=function(a){var c=this;Object.keys(this._controllers).forEach(function(d){var f=c._controllers[d];f.xrController.getWorldPointerRayToRef(f.tmpRay),f.pick=c._scene.pickWithRay(f.tmpRay);var g=f.pick;if(g&&g.pickedPoint&&g.hit){c._updatePointerDistance(f.laserPointer,g.distance),f.selectionMesh.position.copyFrom(g.pickedPoint),f.selectionMesh.scaling.x=Math.sqrt(g.distance),f.selectionMesh.scaling.y=Math.sqrt(g.distance),f.selectionMesh.scaling.z=Math.sqrt(g.distance);var h=c._convertNormalToDirectionOfRay(g.getNormal(!0),f.tmpRay);if(f.selectionMesh.position.copyFrom(g.pickedPoint),h){var j=i.e.Cross(Ba.a.Y,h),m=i.e.Cross(h,j);i.e.RotationFromAxisToRef(m,h,j,f.selectionMesh.rotation),f.selectionMesh.position.addInPlace(h.scale(.001))}f.selectionMesh.isVisible=c.displaySelectionMesh,f.meshUnderPointer=g.pickedMesh}else f.selectionMesh.isVisible=!1,f.meshUnderPointer=null})},b.prototype._attachGazeMode=function(a){var c=this,d=this._controllers[a.uniqueId],f=this._options.timeToSelect||3000,g=this._options.useUtilityLayer?this._options.customUtilityLayerScene||ic.a.DefaultUtilityLayer.utilityLayerScene:this._scene,h=new nd.a(),j=Jd.CreateTorus("selection",{diameter:.0525,thickness:.015,tessellation:20},g);j.isVisible=!1,j.isPickable=!1,j.parent=d.selectionMesh;var m=0,w=!1;d.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){if(d.pick){if(j.isVisible=!1,d.pick.hit)if(c._pickingMoved(h,d.pick))w&&(c._options.disablePointerUpOnTouchOut||c._scene.simulatePointerUp(d.pick,{pointerId:d.id})),w=!1,m=0;else if(m>f/10&&(j.isVisible=!0),(m+=c._scene.getEngine().getDeltaTime())>=f)c._scene.simulatePointerDown(d.pick,{pointerId:d.id}),w=!0,c._options.disablePointerUpOnTouchOut&&c._scene.simulatePointerUp(d.pick,{pointerId:d.id}),j.isVisible=!1;else{var z=1-m/f;j.scaling.set(z,z,z)}else w=!1,m=0;c._scene.simulatePointerMove(d.pick,{pointerId:d.id}),h=d.pick}}),void 0!==this._options.renderingGroupId&&(j.renderingGroupId=this._options.renderingGroupId),a.onDisposeObservable.addOnce(function(){d.pick&&!c._options.disablePointerUpOnTouchOut&&w&&c._scene.simulatePointerUp(d.pick,{pointerId:d.id}),j.dispose()})},b.prototype._attachScreenRayMode=function(a){var c=this,d=this._controllers[a.uniqueId],f=!1;d.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){!d.pick||c._options.disablePointerUpOnTouchOut&&f||(f?c._scene.simulatePointerMove(d.pick,{pointerId:d.id}):(c._scene.simulatePointerDown(d.pick,{pointerId:d.id}),f=!0,c._options.disablePointerUpOnTouchOut&&c._scene.simulatePointerUp(d.pick,{pointerId:d.id})))}),a.onDisposeObservable.addOnce(function(){d.pick&&f&&!c._options.disablePointerUpOnTouchOut&&c._scene.simulatePointerUp(d.pick,{pointerId:d.id})})},b.prototype._attachTrackedPointerRayMode=function(a){var c=this;a.onMotionControllerInitObservable.add(function(d){if(c._options.forceGazeMode)return c._attachGazeMode(a);var f=c._controllers[a.uniqueId];c._options.overrideButtonId&&(f.selectionComponent=d.getComponent(c._options.overrideButtonId)),f.selectionComponent||(f.selectionComponent=d.getMainComponent()),f.onFrameObserver=c._xrSessionManager.onXRFrameObservable.add(function(){f.selectionComponent&&f.selectionComponent.pressed?(f.selectionMesh.material.emissiveColor=c.selectionMeshPickedColor,f.laserPointer.material.emissiveColor=c.laserPointerPickedColor):(f.selectionMesh.material.emissiveColor=c.selectionMeshDefaultColor,f.laserPointer.material.emissiveColor=c.lasterPointerDefaultColor),f.laserPointer.isVisible=c.displayLaserPointer,f.laserPointer.material.disableLighting=c.disablePointerLighting,f.selectionMesh.material.disableLighting=c.disableSelectionMeshLighting,f.pick&&c._scene.simulatePointerMove(f.pick,{pointerId:f.id})}),f.onButtonChangedObserver=f.selectionComponent.onButtonStateChangedObservable.add(function(g){if(g.changes.pressed){var h=g.changes.pressed.current;f.pick&&(h?c._scene.simulatePointerDown(f.pick,{pointerId:f.id}):c._scene.simulatePointerUp(f.pick,{pointerId:f.id}))}})})},b.prototype._convertNormalToDirectionOfRay=function(a,c){return a&&(Math.acos(i.e.Dot(a,c.direction))<Math.PI/2&&a.scaleInPlace(-1)),a},b.prototype._detachController=function(a){var c=this._controllers[a];c&&(c.selectionComponent&&c.onButtonChangedObserver&&c.selectionComponent.onButtonStateChangedObservable.remove(c.onButtonChangedObserver),c.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(c.onFrameObserver),c.selectionMesh.dispose(),c.laserPointer.dispose(),delete this._controllers[a])},b.prototype._generateNewMeshPair=function(a){var c=this._options.useUtilityLayer?this._options.customUtilityLayerScene||ic.a.DefaultUtilityLayer.utilityLayerScene:this._scene,d=md.a.CreateCylinder("laserPointer",{height:1,diameterTop:.0002,diameterBottom:.004,tessellation:20,subdivisions:1},c);d.parent=a.pointer;var f=new Ab.a("laserPointerMat",c);f.emissiveColor=this.lasterPointerDefaultColor,f.alpha=.7,d.material=f,d.rotation.x=Math.PI/2,this._updatePointerDistance(d,1),d.isPickable=!1;var g=Jd.CreateTorus("gazeTracker",{diameter:.0105,thickness:.0075,tessellation:20},c);g.bakeCurrentTransformIntoVertices(),g.isPickable=!1,g.isVisible=!1;var h=new Ab.a("targetMat",c);return h.specularColor=G.a.Black(),h.emissiveColor=this.selectionMeshDefaultColor,h.backFaceCulling=!1,g.material=h,void 0!==this._options.renderingGroupId&&(d.renderingGroupId=this._options.renderingGroupId,g.renderingGroupId=this._options.renderingGroupId),{laserPointer:d,selectionMesh:g}},b.prototype._pickingMoved=function(a,c){var d;if(!a.hit||!c.hit)return!0;if(!(a.pickedMesh&&a.pickedPoint&&c.pickedMesh&&c.pickedPoint))return!0;if(a.pickedMesh!==c.pickedMesh)return!0;null===(d=a.pickedPoint)||void 0===d||d.subtractToRef(c.pickedPoint,this._tmpVectorForPickCompare),this._tmpVectorForPickCompare.set(Math.abs(this._tmpVectorForPickCompare.x),Math.abs(this._tmpVectorForPickCompare.y),Math.abs(this._tmpVectorForPickCompare.z));var f=.01*(this._options.gazeModePointerMovedFactor||1)/c.distance;return this._tmpVectorForPickCompare.length()>f},b.prototype._updatePointerDistance=function(a,c){void 0===c&&(c=100),a.scaling.y=c,a.position.z=c/2+.05},b._idCounter=0,b.Name=$c.POINTER_SELECTION,b.Version=1,b}(qd);ad.AddWebXRFeature(Be.Name,function(e,b){return function(){return new Be(e,b)}},Be.Version,!0);var Wi=function(){function e(b,a,c){this.element=b,this.sessionMode=a,this.referenceSpaceType=c}return e.prototype.update=function(b){},e}(),Zm=function(){},Xi=function(){function e(b,a){var c=this;if(this.scene=b,this.options=a,this._activeButton=null,this._buttons=[],this.activeButtonChangedObservable=new I.c(),this._overlay=document.createElement("div"),this._overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;",a.customButtons)this._buttons=a.customButtons;else{var d=a.sessionMode||"immersive-vr",f=a.referenceSpaceType||"local-floor",g=".babylonVRicon { color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";g+='.babylonVRicon.vrdisplaypresenting { background-image: none;} .vrdisplaypresenting::after { content: "EXIT"} .xr-error::after { content: "ERROR"}';var h=document.createElement("style");h.appendChild(document.createTextNode(g)),document.getElementsByTagName("head")[0].appendChild(h);var j=document.createElement("button");j.className="babylonVRicon",j.title=d+" - "+f,this._buttons.push(new Wi(j,d,f)),this._buttons[this._buttons.length-1].update=function(w){this.element.style.display=null===w||w===this?"":"none",j.className="babylonVRicon"+(w===this?" vrdisplaypresenting":"")},this._updateButtons(null)}var m=b.getEngine().getInputElement();m&&m.parentNode&&(m.parentNode.appendChild(this._overlay),b.onDisposeObservable.addOnce(function(){c.dispose()}))}return e.CreateAsync=function(b,a,c){var d=this,f=new e(b,c),g=f._buttons.map(function(h){return a.sessionManager.isSessionSupportedAsync(h.sessionMode)});return a.onStateChangedObservable.add(function(h){h==Tb.NOT_IN_XR&&f._updateButtons(null)}),Promise.all(g).then(function(h){return h.forEach(function(j,m){j&&(f._overlay.appendChild(f._buttons[m].element),f._buttons[m].element.onclick=function(){return Object(l.b)(d,void 0,void 0,function(){var w,z;return Object(l.e)(this,function(C){switch(C.label){case 0:return a.state!=Tb.IN_XR?[3,2]:[4,a.exitXRAsync()];case 1:return C.sent(),f._updateButtons(null),[3,6];case 2:if(a.state!=Tb.NOT_IN_XR)return[3,6];if(!c.renderTarget)return[3,6];C.label=3;case 3:return C.trys.push([3,5,,6]),[4,a.enterXRAsync(f._buttons[m].sessionMode,f._buttons[m].referenceSpaceType,c.renderTarget)];case 4:return C.sent(),f._updateButtons(f._buttons[m]),[3,6];case 5:return C.sent(),f._updateButtons(null),w=f._buttons[m].element,z=w.title,w.title="Error entering XR session : "+z,w.classList.add("xr-error"),[3,6];case 6:return[2]}})})})}),f})},e.prototype.dispose=function(){var b=this.scene.getEngine().getInputElement();b&&b.parentNode&&b.parentNode.contains(this._overlay)&&b.parentNode.removeChild(this._overlay),this.activeButtonChangedObservable.clear()},e.prototype._updateButtons=function(b){var a=this;this._activeButton=b,this._buttons.forEach(function(c){c.update(a._activeButton)}),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},e}(),Ce=function(e){function b(a,c){var d=e.call(this,a)||this;return d._options=c,d._controllers={},d._snappedToPoint=!1,d._tmpRay=new Rb.a(new i.e(),new i.e()),d._tmpVector=new i.e(),d.backwardsMovementEnabled=!0,d.backwardsTeleportationDistance=.7,d.parabolicCheckRadius=5,d.parabolicRayEnabled=!0,d.rotationAngle=Math.PI/8,d.rotationEnabled=!0,d._attachController=function(f){if(!d._controllers[f.uniqueId]){d._controllers[f.uniqueId]={xrController:f,teleportationState:{forward:!1,backwards:!1,rotating:!1,currentRotation:0,baseRotation:0}};var g=d._controllers[f.uniqueId];f.onMotionControllerInitObservable.addOnce(function(){if(f.motionController){var h=f.motionController.getComponentOfType(Qd.THUMBSTICK_TYPE)||f.motionController.getComponentOfType(Qd.TOUCHPAD_TYPE);if(!h||d._options.useMainComponentOnly){var j=f.motionController.getMainComponent();if(!j)return;g.onButtonChangedObserver=j.onButtonStateChangedObservable.add(function(){if(j.changes.pressed)if(j.changes.pressed.current){g.teleportationState.forward=!0,d._currentTeleportationControllerId=g.xrController.uniqueId,g.teleportationState.baseRotation=d._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,g.teleportationState.currentRotation=0;var m=d._options.timeToTeleport||3000,w=0,z=d._xrSessionManager.onXRFrameObservable.add(function(){j.pressed?((w+=d._xrSessionManager.scene.getEngine().getDeltaTime())>=m&&d._currentTeleportationControllerId===g.xrController.uniqueId&&g.teleportationState.forward&&d._teleportForward(f.uniqueId),w>=m&&d._xrSessionManager.onXRFrameObservable.remove(z)):d._xrSessionManager.onXRFrameObservable.remove(z)})}else g.teleportationState.forward=!1,d._currentTeleportationControllerId=""})}else g.onButtonChangedObserver=h.onButtonStateChangedObservable.add(function(){d._currentTeleportationControllerId===g.xrController.uniqueId&&g.teleportationState.forward&&!h.touched&&d._teleportForward(f.uniqueId)}),g.onAxisChangedObserver=h.onAxisValueChangedObservable.add(function(m){if(m.y<=.7&&g.teleportationState.backwards&&(g.teleportationState.backwards=!1),m.y>.7&&!g.teleportationState.forward&&d.backwardsMovementEnabled&&!d.snapPointsOnly&&!g.teleportationState.backwards){g.teleportationState.backwards=!0,d._tmpVector.set(0,0,d.backwardsTeleportationDistance),d._tmpVector.rotateByQuaternionToRef(d._options.xrInput.xrCamera.rotationQuaternion,d._tmpVector),d._tmpVector.addInPlace(d._options.xrInput.xrCamera.position),d._options.xrInput.xrCamera.position.subtractToRef(d._tmpVector,d._tmpVector),d._tmpRay.origin.copyFrom(d._tmpVector),d._tmpRay.direction.set(0,-1,0);var w=d._xrSessionManager.scene.pickWithRay(d._tmpRay,function(C){return-1!==d._floorMeshes.indexOf(C)});w&&w.pickedPoint&&d._options.xrInput.xrCamera.position.addInPlace(w.pickedPoint)}if(m.y<-.7&&!d._currentTeleportationControllerId&&!g.teleportationState.rotating&&(g.teleportationState.forward=!0,d._currentTeleportationControllerId=g.xrController.uniqueId,g.teleportationState.baseRotation=d._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y),m.x){if(g.teleportationState.forward)d._currentTeleportationControllerId===g.xrController.uniqueId&&(d.rotationEnabled?setTimeout(function(){g.teleportationState.currentRotation=Math.atan2(m.x,-m.y)}):g.teleportationState.currentRotation=0);else if(!g.teleportationState.rotating&&Math.abs(m.x)>.7){g.teleportationState.rotating=!0;var z=d.rotationAngle*(m.x>0?1:-1);d._options.xrInput.xrCamera.rotationQuaternion.multiplyInPlace(i.b.FromEulerAngles(0,z,0))}}else g.teleportationState.rotating=!1})}})}},d._options.teleportationTargetMesh||d._createDefaultTargetMesh(),d._floorMeshes=d._options.floorMeshes||[],d._snapToPositions=d._options.snapPositions||[],d._setTargetMeshVisibility(!1),d}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"snapPointsOnly",{get:function(){return!!this._options.snapPointsOnly},set:function(a){this._options.snapPointsOnly=a},enumerable:!0,configurable:!0}),b.prototype.addFloorMesh=function(a){this._floorMeshes.push(a)},b.prototype.addSnapPoint=function(a){this._snapToPositions.push(a)},b.prototype.attach=function(){var a=this;return!!e.prototype.attach.call(this)&&(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(c){a._detachController(c.uniqueId)}),!0)},b.prototype.detach=function(){var a=this;return!!e.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(c){a._detachController(c)}),this._setTargetMeshVisibility(!1),!0)},b.prototype.dispose=function(){e.prototype.dispose.call(this),this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.dispose(!1,!0)},b.prototype.removeFloorMesh=function(a){var c=this._floorMeshes.indexOf(a);-1!==c&&this._floorMeshes.splice(c,1)},b.prototype.removeFloorMeshByName=function(a){var c=this._xrSessionManager.scene.getMeshByName(a);c&&this.removeFloorMesh(c)},b.prototype.removeSnapPoint=function(a){var c=this._snapToPositions.indexOf(a);if(-1===c){for(var d=0;d<this._snapToPositions.length;++d)if(this._snapToPositions[d].equals(a)){c=d;break}}return-1!==c&&(this._snapToPositions.splice(c,1),!0)},b.prototype.setSelectionFeature=function(a){this._selectionFeature=a},b.prototype._onXRFrame=function(a){var c=this,d=this._xrSessionManager.currentFrame,f=this._xrSessionManager.scene;if(this.attach&&d){var g=this._options.teleportationTargetMesh;if(this._currentTeleportationControllerId){if(!g)return;g.rotationQuaternion=g.rotationQuaternion||new i.b();var h=this._controllers[this._currentTeleportationControllerId];if(h.teleportationState.forward){i.b.RotationYawPitchRollToRef(h.teleportationState.currentRotation+h.teleportationState.baseRotation,0,0,g.rotationQuaternion);var j=!1;h.xrController.getWorldPointerRayToRef(this._tmpRay);var m=f.pickWithRay(this._tmpRay,function(K){var N=c._floorMeshes.indexOf(K);return-1!==N&&c._floorMeshes[N].absolutePosition.y<c._options.xrInput.xrCamera.position.y});if(m&&m.pickedPoint)j=!0,this._setTargetMeshPosition(m.pickedPoint),this._setTargetMeshVisibility(!0),this._showParabolicPath(m);else if(this.parabolicRayEnabled){var w=h.xrController.pointer.rotationQuaternion.toEulerAngles().x,z=Math.PI/2-Math.abs(w)+1,C=this.parabolicCheckRadius*z;this._tmpRay.origin.addToRef(this._tmpRay.direction.scale(2*C),this._tmpVector),this._tmpVector.y=this._tmpRay.origin.y,this._tmpRay.origin.addInPlace(this._tmpRay.direction.scale(C)),this._tmpVector.subtractToRef(this._tmpRay.origin,this._tmpRay.direction),this._tmpRay.direction.normalize();var J=f.pickWithRay(this._tmpRay,function(K){return-1!==c._floorMeshes.indexOf(K)});J&&J.pickedPoint&&(j=!0,this._setTargetMeshPosition(J.pickedPoint),this._setTargetMeshVisibility(!0),this._showParabolicPath(J))}this._setTargetMeshVisibility(j)}else this._setTargetMeshVisibility(!1)}else this._setTargetMeshVisibility(!1)}},b.prototype._createDefaultTargetMesh=function(){this._options.defaultTargetMeshOptions=this._options.defaultTargetMeshOptions||{};var a=this._options.useUtilityLayer?this._options.customUtilityLayerScene||ic.a.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,c=Yc.CreateGround("teleportationTarget",{width:2,height:2,subdivisions:2},a);c.isPickable=!1;var d=new Bc("teleportationPlaneDynamicTexture",512,a,!0);d.hasAlpha=!0;var f=d.getContext();f.beginPath(),f.arc(256,256,200,0,2*Math.PI,!1),f.fillStyle=this._options.defaultTargetMeshOptions.teleportationFillColor||"#444444",f.fill(),f.lineWidth=10,f.strokeStyle=this._options.defaultTargetMeshOptions.teleportationBorderColor||"#FFFFFF",f.stroke(),f.closePath(),d.update();var g=new Ab.a("teleportationPlaneMaterial",a);g.diffuseTexture=d,c.material=g;var h=Jd.CreateTorus("torusTeleportation",{diameter:.75,thickness:.1,tessellation:20},a);if(h.isPickable=!1,h.parent=c,!this._options.defaultTargetMeshOptions.disableAnimation){var j=new V("animationInnerCircle","position.y",30,V.ANIMATIONTYPE_FLOAT,V.ANIMATIONLOOPMODE_CYCLE),m=[];m.push({frame:0,value:0}),m.push({frame:30,value:.4}),m.push({frame:60,value:0}),j.setKeys(m);var w=new Sf();w.setEasingMode(Fb.EASINGMODE_EASEINOUT),j.setEasingFunction(w),h.animations=[],h.animations.push(j),a.beginAnimation(h,0,60,!0)}var z=md.a.CreateCylinder("cone",{diameterTop:0,tessellation:4},a);if(z.isPickable=!1,z.scaling.set(.5,.12,.2),z.rotate(Ba.a.X,Math.PI/2),z.position.z=.6,z.parent=h,this._options.defaultTargetMeshOptions.torusArrowMaterial)h.material=this._options.defaultTargetMeshOptions.torusArrowMaterial,z.material=this._options.defaultTargetMeshOptions.torusArrowMaterial;else{var C=new Ab.a("torusConsMat",a);C.disableLighting=!!this._options.defaultTargetMeshOptions.disableLighting,C.disableLighting?C.emissiveColor=new G.a(.3,.3,1):C.diffuseColor=new G.a(.3,.3,1),C.alpha=.9,h.material=C,z.material=C,this._teleportationRingMaterial=C}void 0!==this._options.renderingGroupId&&(c.renderingGroupId=this._options.renderingGroupId,h.renderingGroupId=this._options.renderingGroupId,z.renderingGroupId=this._options.renderingGroupId),this._options.teleportationTargetMesh=c},b.prototype._detachController=function(a){var c=this._controllers[a];c&&(c.teleportationComponent&&(c.onAxisChangedObserver&&c.teleportationComponent.onAxisValueChangedObservable.remove(c.onAxisChangedObserver),c.onButtonChangedObserver&&c.teleportationComponent.onButtonStateChangedObservable.remove(c.onButtonChangedObserver)),delete this._controllers[a])},b.prototype._findClosestSnapPointWithRadius=function(a,c){void 0===c&&(c=this._options.snapToPositionRadius||.8);var d=null,f=Number.MAX_VALUE;if(this._snapToPositions.length){var g=c*c;this._snapToPositions.forEach(function(h){var j=i.e.DistanceSquared(h,a);j<=g&&j<f&&(f=j,d=h)})}return d},b.prototype._setTargetMeshPosition=function(a){if(this._options.teleportationTargetMesh){var c=this._findClosestSnapPointWithRadius(a);this._snappedToPoint=!!c,this.snapPointsOnly&&!this._snappedToPoint&&this._teleportationRingMaterial?this._teleportationRingMaterial.diffuseColor.set(1,.3,.3):this.snapPointsOnly&&this._snappedToPoint&&this._teleportationRingMaterial&&this._teleportationRingMaterial.diffuseColor.set(.3,.3,1),this._options.teleportationTargetMesh.position.copyFrom(c||a),this._options.teleportationTargetMesh.position.y+=.01}},b.prototype._setTargetMeshVisibility=function(a){this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible!==a&&(this._options.teleportationTargetMesh.isVisible=a,this._options.teleportationTargetMesh.getChildren(void 0,!1).forEach(function(c){c.isVisible=a}),a?this._selectionFeature&&this._selectionFeature.detach():(this._quadraticBezierCurve&&this._quadraticBezierCurve.dispose(),this._selectionFeature&&this._selectionFeature.attach()))},b.prototype._showParabolicPath=function(a){if(a.pickedPoint){var c=this._controllers[this._currentTeleportationControllerId],d=Tc.CreateQuadraticBezier(c.xrController.pointer.absolutePosition,a.ray.origin,a.pickedPoint,25);this._quadraticBezierCurve&&this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=Wb.a.CreateLines("path line",{points:d.getPoints()}),this._quadraticBezierCurve.isPickable=!1}},b.prototype._teleportForward=function(a){var c=this._controllers[a];if(c.teleportationState.forward=!1,this._currentTeleportationControllerId="",(!this.snapPointsOnly||this._snappedToPoint)&&this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible){var d=this._options.xrInput.xrCamera.realWorldHeight;this._options.xrInput.xrCamera.position.copyFrom(this._options.teleportationTargetMesh.position),this._options.xrInput.xrCamera.position.y+=d,this._options.xrInput.xrCamera.rotationQuaternion.multiplyInPlace(i.b.FromEulerAngles(0,c.teleportationState.currentRotation,0))}},b.Name=$c.TELEPORTATION,b.Version=1,b}(qd);ad.AddWebXRFeature(Ce.Name,function(e,b){return function(){return new Ce(e,b)}},Ce.Version,!0);var _m=function(){},Yi=function(){function e(){}return e.CreateAsync=function(b,a){void 0===a&&(a={});var c=new e();return Si.CreateAsync(b).then(function(d){return c.baseExperience=d,a.ignoreNativeCameraTransformation&&(c.baseExperience.camera.compensateOnFirstFrame=!1),c.input=new Vi(d.sessionManager,d.camera,a.inputOptions),c.pointerSelection=c.baseExperience.featuresManager.enableFeature(Be.Name,a.useStablePlugins?"stable":"latest",{xrInput:c.input}),a.disableTeleportation||(c.teleportation=c.baseExperience.featuresManager.enableFeature(Ce.Name,a.useStablePlugins?"stable":"latest",{floorMeshes:a.floorMeshes,xrInput:c.input}),c.teleportation.setSelectionFeature(c.pointerSelection)),c.renderTarget=c.baseExperience.sessionManager.getWebXRRenderTarget(a.outputCanvasOptions),a.disableDefaultUI?void 0:(a.uiOptions&&(a.uiOptions.renderTarget=a.uiOptions.renderTarget||c.renderTarget),Xi.CreateAsync(b,c.baseExperience,a.uiOptions||{renderTarget:c.renderTarget}).then(function(f){c.enterExitUI=f}))}).then(function(){return c}).catch(function(d){return k.a.Error("Error initializing XR"),k.a.Error(d),c})},e.prototype.dispose=function(){this.baseExperience&&this.baseExperience.dispose(),this.input&&this.input.dispose(),this.enterExitUI&&this.enterExitUI.dispose(),this.renderTarget&&this.renderTarget.dispose()},e}();wa.a.prototype.createDefaultLight=function(e){if(void 0===e&&(e=!1),e&&this.lights)for(var b=0;b<this.lights.length;b++)this.lights[b].dispose();0===this.lights.length&&new _e.a("default light",i.e.Up(),this)},wa.a.prototype.createDefaultCamera=function(e,b,a){if(void 0===e&&(e=!1),void 0===b&&(b=!1),void 0===a&&(a=!1),b&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var c,d=this.getWorldExtends(),f=d.max.subtract(d.min),g=d.min.add(f.scale(.5)),h=1.5*f.length();if(isFinite(h)||(h=1,g.copyFromFloats(0,0,0)),e){var j=new jd("default camera",-Math.PI/2,Math.PI/2,h,g,this);j.lowerRadiusLimit=.01*h,j.wheelPrecision=100/h,c=j}else{var m=new nc("default camera",new i.e(g.x,g.y,-h),this);m.setTarget(g),c=m}c.minZ=.01*h,c.maxZ=1000*h,c.speed=.2*h,this.activeCamera=c;var w=this.getEngine().getInputElement();a&&w&&c.attachControl(w)}},wa.a.prototype.createDefaultCameraOrLight=function(e,b,a){void 0===e&&(e=!1),void 0===b&&(b=!1),void 0===a&&(a=!1),this.createDefaultLight(b),this.createDefaultCamera(e,b,a)},wa.a.prototype.createDefaultSkybox=function(e,b,a,c,d){if(void 0===b&&(b=!1),void 0===a&&(a=1000),void 0===c&&(c=0),void 0===d&&(d=!0),!e)return k.a.Warn("Can not create default skybox without environment texture."),null;d&&e&&(this.environmentTexture=e);var f=xa.a.CreateBox("hdrSkyBox",a,this);if(b){var g=new Ae("skyBox",this);g.backFaceCulling=!1,g.reflectionTexture=e.clone(),g.reflectionTexture&&(g.reflectionTexture.coordinatesMode=ya.a.SKYBOX_MODE),g.microSurface=1-c,g.disableLighting=!0,g.twoSidedLighting=!0,f.infiniteDistance=!0,f.material=g}else{var h=new Ab.a("skyBox",this);h.backFaceCulling=!1,h.reflectionTexture=e.clone(),h.reflectionTexture&&(h.reflectionTexture.coordinatesMode=ya.a.SKYBOX_MODE),h.disableLighting=!0,f.infiniteDistance=!0,f.material=h}return f.isPickable=!1,f},wa.a.prototype.createDefaultEnvironment=function(e){return Dg?new Dg(e,this):null},wa.a.prototype.createDefaultVRExperience=function(e){return void 0===e&&(e={}),new ri(this,e)},wa.a.prototype.createDefaultXRExperienceAsync=function(e){return Yi.CreateAsync(this,e).then(function(b){return b})},Cb.a.prototype.updateVideoTexture=function(e,b,a){if(e&&!e._isDisabled){var c=this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0);this._unpackFlipY(!a);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b);else{if(!e._workingCanvas){e._workingCanvas=af.a.CreateCanvas(e.width,e.height);var d=e._workingCanvas.getContext("2d");if(!d)throw new Error("Unable to get 2d context");e._workingContext=d,e._workingCanvas.width=e.width,e._workingCanvas.height=e.height}e._workingContext.drawImage(b,0,0,b.videoWidth,b.videoHeight,0,0,e.width,e.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)}e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),c||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}catch(f){e._isDisabled=!0}}};var Zi=function(e){function b(a,c,d,f,g,h,j){void 0===f&&(f=!1),void 0===g&&(g=!1),void 0===h&&(h=ya.a.TRILINEAR_SAMPLINGMODE),void 0===j&&(j={autoPlay:!0,loop:!0,autoUpdateTexture:!0});var m=e.call(this,null,d,!f,g)||this;m._onUserActionRequestedObservable=null,m._stillImageCaptured=!1,m._displayingPosterTexture=!1,m._frameId=-1,m._currentSrc=null,m._createInternalTexture=function(){if(null!=m._texture){if(!m._displayingPosterTexture)return;m._texture.dispose(),m._displayingPosterTexture=!1}if(!m._engine.needPOTTextures||Qa.b.IsExponentOfTwo(m.video.videoWidth)&&Qa.b.IsExponentOfTwo(m.video.videoHeight)?(m.wrapU=ya.a.WRAP_ADDRESSMODE,m.wrapV=ya.a.WRAP_ADDRESSMODE):(m.wrapU=ya.a.CLAMP_ADDRESSMODE,m.wrapV=ya.a.CLAMP_ADDRESSMODE,m._generateMipMaps=!1),m._texture=m._engine.createDynamicTexture(m.video.videoWidth,m.video.videoHeight,m._generateMipMaps,m.samplingMode),m.video.autoplay||m._settings.poster)m._texture.isReady=!0,m._updateInternalTexture(),m.onLoadObservable.hasObservers()&&m.onLoadObservable.notifyObservers(m);else{var z=m.video.onplaying,C=!1,J=m.video.muted;m.video.muted=!0,m.video.onplaying=function(){m.video.muted=J,m.video.onplaying=z,m._texture.isReady=!0,m._updateInternalTexture(),C||m.video.pause(),m.onLoadObservable.hasObservers()&&m.onLoadObservable.notifyObservers(m)};var K=m.video.play();K?K.then(function(){}).catch(function(){C=!0,m._onUserActionRequestedObservable&&m._onUserActionRequestedObservable.hasObservers()&&m._onUserActionRequestedObservable.notifyObservers(m)}):(m.video.onplaying=z,m._texture.isReady=!0,m._updateInternalTexture(),m.onLoadObservable.hasObservers()&&m.onLoadObservable.notifyObservers(m))}},m.reset=function(){null!=m._texture&&(m._displayingPosterTexture||(m._texture.dispose(),m._texture=null))},m._updateInternalTexture=function(){if(null!=m._texture&&m._texture.isReady&&!(m.video.readyState<m.video.HAVE_CURRENT_DATA||m._displayingPosterTexture)){var z=m.getScene().getFrameId();m._frameId!==z&&(m._frameId=z,m._engine.updateVideoTexture(m._texture,m.video,m._invertY))}},m._engine=m.getScene().getEngine(),m._generateMipMaps=f,m._initialSamplingMode=h,m.autoUpdateTexture=j.autoUpdateTexture,m._currentSrc=c,m.name=a||m._getName(c),m.video=m._getVideo(c),m._settings=j,j.poster&&(m.video.poster=j.poster),void 0!==j.autoPlay&&(m.video.autoplay=j.autoPlay),void 0!==j.loop&&(m.video.loop=j.loop),m.video.setAttribute("playsinline",""),m.video.addEventListener("paused",m._updateInternalTexture),m.video.addEventListener("seeked",m._updateInternalTexture),m.video.addEventListener("emptied",m.reset),m._createInternalTextureOnEvent=j.poster&&!j.autoPlay?"play":"canplay",m.video.addEventListener(m._createInternalTextureOnEvent,m._createInternalTexture);var w=m.video.readyState>=m.video.HAVE_CURRENT_DATA;return!j.poster||j.autoPlay&&w?w&&m._createInternalTexture():(m._texture=m._engine.createTexture(j.poster,!1,!m.invertY,d),m._displayingPosterTexture=!0),m}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new I.c()),this._onUserActionRequestedObservable},enumerable:!0,configurable:!0}),b.prototype._getName=function(a){return a instanceof HTMLVideoElement?a.currentSrc:"object"==typeof a?a.toString():a},b.prototype._getVideo=function(a){if(a instanceof HTMLVideoElement)return Qa.b.SetCorsBehavior(a.currentSrc,a),a;var c=document.createElement("video");return"string"==typeof a?(Qa.b.SetCorsBehavior(a,c),c.src=a):(Qa.b.SetCorsBehavior(a[0],c),a.forEach(function(d){var f=document.createElement("source");f.src=d,c.appendChild(f)})),c},b.prototype._rebuild=function(){this.update()},b.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},b.prototype.updateTexture=function(a){a&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},b.prototype.updateURL=function(a){this.video.src=a,this._currentSrc=a},b.prototype.clone=function(){return new b(this.name,this._currentSrc,this.getScene(),this._generateMipMaps,this.invertY,this.samplingMode,this._settings)},b.prototype.dispose=function(){e.prototype.dispose.call(this),this._currentSrc=null,this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener(this._createInternalTextureOnEvent,this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this.reset),this.video.pause()},b.CreateFromStreamAsync=function(a,c){var d=document.createElement("video");return d.setAttribute("autoplay",""),d.setAttribute("muted","true"),d.setAttribute("playsinline",""),d.muted=!0,void 0!==d.mozSrcObject?d.mozSrcObject=c:"object"==typeof d.srcObject?d.srcObject=c:(window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,d.src=window.URL&&window.URL.createObjectURL(c)),new Promise(function(f){var g=function(){f(new b("video",d,a,!0,!0)),d.removeEventListener("playing",g)};d.addEventListener("playing",g),d.play()})},b.CreateFromWebCamAsync=function(a,c,d){var f,g=this;return void 0===d&&(d=!1),c&&c.deviceId&&(f={exact:c.deviceId}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:c,audio:d}).then(function(h){return g.CreateFromStreamAsync(a,h)}):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:f,width:{min:c&&c.minWidth||256,max:c&&c.maxWidth||640},height:{min:c&&c.minHeight||256,max:c&&c.maxHeight||480}},audio:d},function(h){return g.CreateFromStreamAsync(a,h)},function(h){k.a.Error(h.name)}),Promise.reject("No support for userMedia on this device"))},b.CreateFromWebCam=function(a,c,d,f){void 0===f&&(f=!1),this.CreateFromWebCamAsync(a,d,f).then(function(g){c&&c(g)}).catch(function(g){k.a.Error(g.name)})},b}(ya.a),Ig=function(){function e(b,a){void 0===b&&(b=i.e.Zero()),void 0===a&&(a=i.e.Up()),this.position=b,this.normal=a}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}(),$m=function(){function e(b,a,c){void 0===b&&(b=i.e.Zero()),void 0===a&&(a=i.e.Up()),void 0===c&&(c=i.d.Zero()),this.position=b,this.normal=a,this.uv=c}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}(),an=function(e){function b(a,c,d,f){var g=e.call(this,a,f)||this;g._halfDome=!1,g._useDirectMapping=!1,g._videoMode=b.MODE_MONOSCOPIC,g._onBeforeCameraRenderObserver=null,f=g.getScene(),a=a||"videoDome",d.resolution=0|Math.abs(d.resolution)||32,d.clickToPlay=Boolean(d.clickToPlay),d.autoPlay=void 0===d.autoPlay||Boolean(d.autoPlay),d.loop=void 0===d.loop||Boolean(d.loop),d.size=Math.abs(d.size)||(f.activeCamera?.48*f.activeCamera.maxZ:1000),void 0===d.useDirectMapping?g._useDirectMapping=!0:g._useDirectMapping=d.useDirectMapping,void 0===d.faceForward&&(d.faceForward=!0),g._setReady(!1);var h={loop:d.loop,autoPlay:d.autoPlay,autoUpdateTexture:!0,poster:d.poster},j=g._material=new Od(a+"_material",f),m=g._videoTexture=new Zi(a+"_texture",c,f,!1,g._useDirectMapping,ya.a.TRILINEAR_SAMPLINGMODE,h);if(g._mesh=xa.a.CreateSphere(a+"_mesh",d.resolution,d.size,f,!1,xa.a.BACKSIDE),m.anisotropicFilteringLevel=1,m.onLoadObservable.addOnce(function(){g._setReady(!0)}),j.useEquirectangularFOV=!0,j.fovMultiplier=1,j.opacityFresnel=!1,g._useDirectMapping?(m.wrapU=ya.a.CLAMP_ADDRESSMODE,m.wrapV=ya.a.CLAMP_ADDRESSMODE,j.diffuseTexture=m):(m.coordinatesMode=ya.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,m.wrapV=ya.a.CLAMP_ADDRESSMODE,j.reflectionTexture=m),g._mesh.material=j,g._mesh.parent=g,g._halfDomeMask=jc.a.CreateSphere("",{slice:.5,diameter:.99*d.size,segments:d.resolution,sideOrientation:xa.a.BACKSIDE},f),g._halfDomeMask.rotate(Ba.a.X,-Math.PI/2),g._halfDomeMask.parent=g._mesh,g._halfDome=!!d.halfDomeMode,g._halfDomeMask.setEnabled(g._halfDome),d.clickToPlay&&(f.onPointerUp=function(){g._videoTexture.video.play()}),d.faceForward&&f.activeCamera){var w=f.activeCamera,z=i.e.Forward(),C=i.e.TransformNormal(z,w.getViewMatrix());C.normalize(),g.rotation.y=Math.acos(i.e.Dot(z,C))}return g}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"videoTexture",{get:function(){return this._videoTexture},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(a){this._material.fovMultiplier=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"videoMode",{get:function(){return this._videoMode},set:function(a){this._videoMode!==a&&this._changeVideoMode(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"halfDome",{get:function(){return this._halfDome},set:function(a){this._halfDome=a,this._halfDomeMask.setEnabled(a)},enumerable:!0,configurable:!0}),b.prototype._changeVideoMode=function(a){var c=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._videoMode=a,this._videoTexture.uScale=1,this._videoTexture.vScale=1,this._videoTexture.uOffset=0,this._videoTexture.vOffset=0,a){case b.MODE_SIDEBYSIDE:this._videoTexture.uScale=this._halfDome?.99999:.5;var d=this._halfDome?0:.5,f=this._halfDome?.5:0;this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(g){c._videoTexture.uOffset=g.isRightCamera?d:f});break;case b.MODE_TOPBOTTOM:this._videoTexture.vScale=this._halfDome?.99999:.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(g){c._videoTexture.vOffset=g.isRightCamera?.5:0})}},b.prototype.dispose=function(a,c){void 0===c&&(c=!1),this._videoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),e.prototype.dispose.call(this,a,c)},b.MODE_MONOSCOPIC=0,b.MODE_TOPBOTTOM=1,b.MODE_SIDEBYSIDE=2,b}(pd.a),kc=o(51),bn=function(){function e(b){this.engine=b,this._captureGPUFrameTime=!1,this._gpuFrameTime=new kc.a(),this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new kc.a(),this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(e.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(b){var a=this;b!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=b,b?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){a._gpuFrameTimeToken||(a._gpuFrameTimeToken=a.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(a._gpuFrameTimeToken){var c=a.engine.endTimeQuery(a._gpuFrameTimeToken);c>-1&&(a._gpuFrameTimeToken=null,a._gpuFrameTime.fetchNewFrame(),a._gpuFrameTime.addCount(c,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(b){var a=this;b!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=b,b?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){a._shaderCompilationTime.fetchNewFrame(),a._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){a._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},e}(),cn=function(){function e(b){var a=this;this.scene=b,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new kc.a(),this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new kc.a(),this._captureFrameTime=!1,this._frameTime=new kc.a(),this._captureRenderTime=!1,this._renderTime=new kc.a(),this._captureInterFrameTime=!1,this._interFrameTime=new kc.a(),this._captureParticlesRenderTime=!1,this._particlesRenderTime=new kc.a(),this._captureSpritesRenderTime=!1,this._spritesRenderTime=new kc.a(),this._capturePhysicsTime=!1,this._physicsTime=new kc.a(),this._captureAnimationsTime=!1,this._animationsTime=new kc.a(),this._captureCameraRenderTime=!1,this._cameraRenderTime=new kc.a(),this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=b.onBeforeAnimationsObservable.add(function(){a._captureActiveMeshesEvaluationTime&&a._activeMeshesEvaluationTime.fetchNewFrame(),a._captureRenderTargetsRenderTime&&a._renderTargetsRenderTime.fetchNewFrame(),a._captureFrameTime&&(Qa.b.StartPerformanceCounter("Scene rendering"),a._frameTime.beginMonitoring()),a._captureInterFrameTime&&a._interFrameTime.endMonitoring(),a._captureParticlesRenderTime&&a._particlesRenderTime.fetchNewFrame(),a._captureSpritesRenderTime&&a._spritesRenderTime.fetchNewFrame(),a._captureAnimationsTime&&a._animationsTime.beginMonitoring(),a.scene.getEngine()._drawCalls.fetchNewFrame()}),this._onAfterRenderObserver=b.onAfterRenderObservable.add(function(){a._captureFrameTime&&(Qa.b.EndPerformanceCounter("Scene rendering"),a._frameTime.endMonitoring()),a._captureRenderTime&&a._renderTime.endMonitoring(!1),a._captureInterFrameTime&&a._interFrameTime.beginMonitoring()})}return Object.defineProperty(e.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(b){var a=this;b!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=b,b?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){Qa.b.StartPerformanceCounter("Active meshes evaluation"),a._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){Qa.b.EndPerformanceCounter("Active meshes evaluation"),a._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(b){var a=this;b!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=b,b?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add(function(){Qa.b.StartPerformanceCounter("Render targets rendering"),a._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add(function(){Qa.b.EndPerformanceCounter("Render targets rendering"),a._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(b){var a=this;b!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=b,b?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){Qa.b.StartPerformanceCounter("Particles"),a._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){Qa.b.EndPerformanceCounter("Particles"),a._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(b){var a=this;b!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=b,this.scene.spriteManagers&&(b?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){Qa.b.StartPerformanceCounter("Sprites"),a._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){Qa.b.EndPerformanceCounter("Sprites"),a._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(b){var a=this;b!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=b,b?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){Qa.b.StartPerformanceCounter("Physics"),a._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){Qa.b.EndPerformanceCounter("Physics"),a._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(b){var a=this;b!==this._captureAnimationsTime&&(this._captureAnimationsTime=b,b?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){a._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(b){this._captureFrameTime=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(b){this._captureInterFrameTime=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(b){var a=this;b!==this._captureRenderTime&&(this._captureRenderTime=b,b?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){a._renderTime.beginMonitoring(),Qa.b.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){a._renderTime.endMonitoring(!1),Qa.b.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(b){var a=this;b!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=b,b?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add(function(c){a._cameraRenderTime.beginMonitoring(),Qa.b.StartPerformanceCounter("Rendering camera "+c.name)}),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add(function(c){a._cameraRenderTime.endMonitoring(!1),Qa.b.EndPerformanceCounter("Rendering camera "+c.name)})):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},e}(),Hb=o(29),dn=`#ifdef DIFFUSE
varying vec2 vUVDiffuse;
uniform sampler2D diffuseSampler;
#endif
#ifdef OPACITY
varying vec2 vUVOpacity;
uniform sampler2D opacitySampler;
uniform float opacityIntensity;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform sampler2D emissiveSampler;
#endif
#ifdef VERTEXALPHA
varying vec4 vColor;
#endif
uniform vec4 glowColor;
void main(void)
{
vec4 finalColor=glowColor;

#ifdef DIFFUSE
vec4 albedoTexture=texture2D(diffuseSampler,vUVDiffuse);
finalColor.a*=albedoTexture.a;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vUVOpacity);
#ifdef OPACITYRGB
finalColor.a*=getLuminance(opacityMap.rgb);
#else
finalColor.a*=opacityMap.a;
#endif
finalColor.a*=opacityIntensity;
#endif
#ifdef VERTEXALPHA
finalColor.a*=vColor.a;
#endif
#ifdef ALPHATEST
if (finalColor.a<ALPHATESTVALUE)
discard;
#endif
#ifdef EMISSIVE
gl_FragColor=texture2D(emissiveSampler,vUVEmissive)*finalColor;
#else
gl_FragColor=finalColor;
#endif
}`;Pa.a.ShadersStore.glowMapGenerationPixelShader=dn;var en=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
varying vec4 vPosition;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef DIFFUSE
varying vec2 vUVDiffuse;
uniform mat4 diffuseMatrix;
#endif
#ifdef OPACITY
varying vec2 vUVOpacity;
uniform mat4 opacityMatrix;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform mat4 emissiveMatrix;
#endif
#ifdef VERTEXALPHA
attribute vec4 color;
varying vec4 vColor;
#endif
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#ifdef CUBEMAP
vPosition=finalWorld*vec4(positionUpdated,1.0);
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#else
vPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
gl_Position=vPosition;
#endif
#ifdef DIFFUSE
#ifdef DIFFUSEUV1
vUVDiffuse=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef DIFFUSEUV2
vUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef OPACITY
#ifdef OPACITYUV1
vUVOpacity=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef OPACITYUV2
vUVOpacity=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef EMISSIVE
#ifdef EMISSIVEUV1
vUVEmissive=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef EMISSIVEUV2
vUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef VERTEXALPHA
vColor=color;
#endif
}`;Pa.a.ShadersStore.glowMapGenerationVertexShader=en;var De=function(){function e(b,a){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new G.b()},this.neutralColor=new G.b(),this.isEnabled=!0,this.onDisposeObservable=new I.c(),this.onBeforeRenderMainTextureObservable=new I.c(),this.onBeforeComposeObservable=new I.c(),this.onBeforeRenderMeshToEffect=new I.c(),this.onAfterRenderMeshToEffect=new I.c(),this.onAfterComposeObservable=new I.c(),this.onSizeChangedObservable=new I.c(),this.name=b,this._scene=a||U.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._generateVertexBuffer()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},set:function(b){this._effectLayerOptions.renderingGroupId=b},enumerable:!0,configurable:!0}),e.prototype._init=function(b){this._effectLayerOptions=Object(l.a)({mainTextureRatio:.5,alphaBlendingMode:p.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},b),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},e.prototype._generateIndexBuffer=function(){var b=[];b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),this._indexBuffer=this._engine.createIndexBuffer(b)},e.prototype._generateVertexBuffer=function(){var b=[];b.push(1,1),b.push(-1,1),b.push(-1,-1),b.push(1,-1);var a=new ra.b(this._engine,b,ra.b.PositionKind,!1,!1,2);this._vertexBuffers[ra.b.PositionKind]=a},e.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?Ha.a.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?Ha.a.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},e.prototype._createMainTexture=function(){var b=this;this._mainTexture=new Jb("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,p.a.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=ya.a.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=ya.a.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(ya.a.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(a,c,d,f){var g;b.onBeforeRenderMainTextureObservable.notifyObservers(b);var h=b._scene.getEngine();if(f.length){for(h.setColorWrite(!1),g=0;g<f.length;g++)b._renderSubMesh(f.data[g]);h.setColorWrite(!0)}for(g=0;g<a.length;g++)b._renderSubMesh(a.data[g]);for(g=0;g<c.length;g++)b._renderSubMesh(c.data[g]);var j=h.getAlphaMode();for(g=0;g<d.length;g++)b._renderSubMesh(d.data[g],!0);h.setAlphaMode(j)},this._mainTexture.onClearObservable.add(function(a){a.clear(b.neutralColor,!0,!0,!0)})},e.prototype._addCustomEffectDefines=function(b){},e.prototype._isReady=function(b,a,c){var d=b.getMaterial();if(!d)return!1;if(!d.isReadyForSubMesh(b.getMesh(),b,a))return!1;var f=[],g=[ra.b.PositionKind],h=b.getMesh(),j=!1,m=!1;if(d){var w=d.needAlphaTesting(),z=d.getAlphaTestTexture(),C=z&&z.hasAlpha&&(d.useAlphaFromDiffuseTexture||d._useAlphaFromAlbedoTexture);z&&(w||C)&&(f.push("#define DIFFUSE"),h.isVerticesDataPresent(ra.b.UV2Kind)&&1===z.coordinatesIndex?(f.push("#define DIFFUSEUV2"),m=!0):h.isVerticesDataPresent(ra.b.UVKind)&&(f.push("#define DIFFUSEUV1"),j=!0),w&&(f.push("#define ALPHATEST"),f.push("#define ALPHATESTVALUE 0.4")));var J=d.opacityTexture;J&&(f.push("#define OPACITY"),h.isVerticesDataPresent(ra.b.UV2Kind)&&1===J.coordinatesIndex?(f.push("#define OPACITYUV2"),m=!0):h.isVerticesDataPresent(ra.b.UVKind)&&(f.push("#define OPACITYUV1"),j=!0))}c&&(f.push("#define EMISSIVE"),h.isVerticesDataPresent(ra.b.UV2Kind)&&1===c.coordinatesIndex?(f.push("#define EMISSIVEUV2"),m=!0):h.isVerticesDataPresent(ra.b.UVKind)&&(f.push("#define EMISSIVEUV1"),j=!0)),h.isVerticesDataPresent(ra.b.ColorKind)&&h.hasVertexAlpha&&(g.push(ra.b.ColorKind),f.push("#define VERTEXALPHA")),j&&(g.push(ra.b.UVKind),f.push("#define UV1")),m&&(g.push(ra.b.UV2Kind),f.push("#define UV2"));var K=new Nd.a();if(h.useBones&&h.computeBonesUsingShaders){g.push(ra.b.MatricesIndicesKind),g.push(ra.b.MatricesWeightsKind),h.numBoneInfluencers>4&&(g.push(ra.b.MatricesIndicesExtraKind),g.push(ra.b.MatricesWeightsExtraKind)),f.push("#define NUM_BONE_INFLUENCERS "+h.numBoneInfluencers);var N=h.skeleton;N&&N.isUsingTextureForMatrices?f.push("#define BONETEXTURE"):f.push("#define BonesPerMesh "+(N?N.bones.length+1:0)),h.numBoneInfluencers>0&&K.addCPUSkinningFallback(0,h)}else f.push("#define NUM_BONE_INFLUENCERS 0");var T=h.morphTargetManager,Z=0;T&&T.numInfluencers>0&&(f.push("#define MORPHTARGETS"),Z=T.numInfluencers,f.push("#define NUM_MORPH_INFLUENCERS "+Z),Ua.a.PrepareAttributesForMorphTargetsInfluencers(g,h,Z)),a&&(f.push("#define INSTANCES"),Ua.a.PushAttributesForInstances(g)),this._addCustomEffectDefines(f);var _=f.join(`
`);return this._cachedDefines!==_&&(this._cachedDefines=_,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",g,["world","mBones","viewProjection","glowColor","morphTargetInfluences","boneTextureWidth","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity"],["diffuseSampler","emissiveSampler","opacitySampler","boneSampler"],_,K,void 0,void 0,{maxSimultaneousMorphTargets:Z})),this._effectLayerMapGenerationEffect.isReady()},e.prototype.render=function(){var b=this._mergeEffect;if(b.isReady()){for(var a=0;a<this._postProcesses.length;a++)if(!this._postProcesses[a].isReady())return;var c=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),c.enableEffect(b),c.setState(!1),c.bindBuffers(this._vertexBuffers,this._indexBuffer,b);var d=c.getAlphaMode();c.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(b),c.setAlphaMode(d),this.onAfterComposeObservable.notifyObservers(this);var f=this._mainTexture.getSize();this._setMainTextureSize(),f.width===this._mainTextureDesiredSize.width&&f.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},e.prototype.hasMesh=function(b){return-1===this.renderingGroupId||b.renderingGroupId===this.renderingGroupId},e.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},e.prototype._shouldRenderMesh=function(b){return!0},e.prototype._canRenderMesh=function(b,a){return!a.needAlphaBlendingForMesh(b)},e.prototype._shouldRenderEmissiveTextureForMesh=function(){return!0},e.prototype._renderSubMesh=function(b,a){var c=this;if(void 0===a&&(a=!1),this.shouldRender()){var d=b.getMaterial(),f=b.getRenderingMesh(),g=this._scene,h=g.getEngine();if(f._internalAbstractMeshDataInfo._isActiveIntermediate=!1,d&&this._canRenderMesh(f,d)){h.setState(d.backFaceCulling);var j=f._getInstancesRenderList(b._id);if(!j.mustReturn&&this._shouldRenderMesh(f)){var m=j.hardwareInstancedRendering[b._id];if(this._setEmissiveTextureAndColor(f,b,d),this.onBeforeRenderMeshToEffect.notifyObservers(f),this._useMeshMaterial(f))f.render(b,m);else if(this._isReady(b,m,this._emissiveTextureAndColor.texture)){h.enableEffect(this._effectLayerMapGenerationEffect),f._bind(b,this._effectLayerMapGenerationEffect,Hb.a.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",g.getTransformMatrix()),this._effectLayerMapGenerationEffect.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a);var w=d.needAlphaTesting(),z=d.getAlphaTestTexture(),C=z&&z.hasAlpha&&(d.useAlphaFromDiffuseTexture||d._useAlphaFromAlbedoTexture);z&&(w||C)&&(this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",z),(J=z.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",J));var J,K=d.opacityTexture;K&&(this._effectLayerMapGenerationEffect.setTexture("opacitySampler",K),this._effectLayerMapGenerationEffect.setFloat("opacityIntensity",K.level),(J=K.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("opacityMatrix",J));if(this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),f.useBones&&f.computeBonesUsingShaders&&f.skeleton){var N=f.skeleton;if(N.isUsingTextureForMatrices){var T=N.getTransformMatrixTexture(f);if(!T)return;this._effectLayerMapGenerationEffect.setTexture("boneSampler",T),this._effectLayerMapGenerationEffect.setFloat("boneTextureWidth",4*(N.bones.length+1))}else this._effectLayerMapGenerationEffect.setMatrices("mBones",N.getTransformMatrices(f))}Ua.a.BindMorphTargetParameters(f,this._effectLayerMapGenerationEffect),a&&h.setAlphaMode(d.alphaMode),f._processRendering(b,this._effectLayerMapGenerationEffect,d.fillMode,j,m,function(Z,_){return c._effectLayerMapGenerationEffect.setMatrix("world",_)})}else this._mainTexture.resetRefreshCounter();this.onAfterRenderMeshToEffect.notifyObservers(f)}}}},e.prototype._useMeshMaterial=function(b){return!1},e.prototype._rebuild=function(){var b=this._vertexBuffers[ra.b.PositionKind];b&&b._rebuild(),this._generateIndexBuffer()},e.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var b=0;b<this._postProcesses.length;b++)this._postProcesses[b]&&this._postProcesses[b].dispose();for(this._postProcesses=[],b=0;b<this._textures.length;b++)this._textures[b]&&this._textures[b].dispose();this._textures=[]},e.prototype.dispose=function(){var b=this._vertexBuffers[ra.b.PositionKind];b&&(b.dispose(),this._vertexBuffers[ra.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var a=this._scene.effectLayers.indexOf(this,0);a>-1&&this._scene.effectLayers.splice(a,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onBeforeRenderMeshToEffect.clear(),this.onAfterRenderMeshToEffect.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},e.prototype.getClassName=function(){return"EffectLayer"},e.Parse=function(b,a,c){return Qa.b.Instantiate(b.customType).Parse(b,a,c)},e._SceneComponentInitialization=function(b){throw Gc.a.WarnImport("EffectLayerSceneComponent")},Object(l.c)([Object(F.c)()],e.prototype,"name",void 0),Object(l.c)([Object(F.f)()],e.prototype,"neutralColor",void 0),Object(l.c)([Object(F.c)()],e.prototype,"isEnabled",void 0),Object(l.c)([Object(F.d)()],e.prototype,"camera",null),Object(l.c)([Object(F.c)()],e.prototype,"renderingGroupId",null),e}();R.a.AddParser(_a.a.NAME_EFFECTLAYER,function(e,b,a,c){if(e.effectLayers){a.effectLayers||(a.effectLayers=new Array());for(var d=0;d<e.effectLayers.length;d++){var f=De.Parse(e.effectLayers[d],b,c);a.effectLayers.push(f)}}}),R.a.prototype.removeEffectLayer=function(e){var b=this.effectLayers.indexOf(e);return-1!==b&&this.effectLayers.splice(b,1),b},R.a.prototype.addEffectLayer=function(e){this.effectLayers.push(e)};var _i=function(){function e(b){this.name=_a.a.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=b,this._engine=b.getEngine(),b.effectLayers=new Array()}return e.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(_a.a.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(_a.a.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(_a.a.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(_a.a.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(_a.a.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(_a.a.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},e.prototype.rebuild=function(){for(var b=0,a=this.scene.effectLayers;b<a.length;b++)a[b]._rebuild()},e.prototype.serialize=function(b){b.effectLayers=[];for(var a=0,c=this.scene.effectLayers;a<c.length;a++){var d=c[a];d.serialize&&b.effectLayers.push(d.serialize())}},e.prototype.addFromContainer=function(b){var a=this;b.effectLayers&&b.effectLayers.forEach(function(c){a.scene.addEffectLayer(c)})},e.prototype.removeFromContainer=function(b,a){var c=this;b.effectLayers&&b.effectLayers.forEach(function(d){c.scene.removeEffectLayer(d),a&&d.dispose()})},e.prototype.dispose=function(){for(var b=this.scene.effectLayers;b.length;)b[0].dispose()},e.prototype._isReadyForMesh=function(b,a){for(var c=0,d=this.scene.effectLayers;c<d.length;c++){var f=d[c];if(f.hasMesh(b))for(var g=0,h=b.subMeshes;g<h.length;g++){var j=h[g];if(!f.isReady(j,a))return!1}}return!0},e.prototype._renderMainTexture=function(b){this._renderEffects=!1,this._needStencil=!1;var a=!1,c=this.scene.effectLayers;if(c&&c.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var d=0,f=c;d<f.length;d++){var g=f[d];if(g.shouldRender()&&(!g.camera||g.camera.cameraRigMode===hb.a.RIG_MODE_NONE&&b===g.camera||g.camera.cameraRigMode!==hb.a.RIG_MODE_NONE&&g.camera._rigCameras.indexOf(b)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||g.needStencil();var h=g._mainTexture;h._shouldRender()&&(this.scene.incrementRenderId(),h.render(!1,!1),a=!0)}}this.scene.incrementRenderId()}return a},e.prototype._setStencil=function(){this._needStencil&&this._engine.setStencilBuffer(!0)},e.prototype._setStencilBack=function(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},e.prototype._draw=function(b){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var a=this.scene.effectLayers,c=0;c<a.length;c++){var d=a[c];d.renderingGroupId===b&&d.shouldRender()&&d.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCamera=function(){this._renderEffects&&this._draw(-1)},e.prototype._drawRenderingGroup=function(b){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(b)},e}();De._SceneComponentInitialization=function(e){var b=e._getComponent(_a.a.NAME_EFFECTLAYER);b||(b=new _i(e),e._addComponent(b))};var fn=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#ifdef EMISSIVE
uniform sampler2D textureSampler2;
#endif

uniform float offset;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef EMISSIVE
baseColor+=texture2D(textureSampler2,vUV);
baseColor*=offset;
#else
baseColor.a=abs(offset-baseColor.a);
#ifdef STROKE
float alpha=smoothstep(.0,.1,baseColor.a);
baseColor.a=alpha;
baseColor.rgb=baseColor.rgb*alpha;
#endif
#endif
gl_FragColor=baseColor;
}`;Pa.a.ShadersStore.glowMapMergePixelShader=fn;var gn=`
attribute vec2 position;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`;Pa.a.ShadersStore.glowMapMergeVertexShader=gn,R.a.prototype.getGlowLayerByName=function(e){for(var b=0;b<this.effectLayers.length;b++)if(this.effectLayers[b].name===e&&this.effectLayers[b].getEffectName()===rf.EffectName)return this.effectLayers[b];return null};var rf=function(e){function b(a,c,d){var f=e.call(this,a,c)||this;return f._intensity=1,f._includedOnlyMeshes=[],f._excludedMeshes=[],f._meshesUsingTheirOwnMaterials=[],f.neutralColor=new G.b(0,0,0,1),f._options=Object(l.a)({mainTextureRatio:b.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},d),f._init({alphaBlendingMode:p.a.ALPHA_ADD,camera:f._options.camera,mainTextureFixedSize:f._options.mainTextureFixedSize,mainTextureRatio:f._options.mainTextureRatio,renderingGroupId:f._options.renderingGroupId}),f}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(a){this._horizontalBlurPostprocess1.kernel=a,this._verticalBlurPostprocess1.kernel=a,this._horizontalBlurPostprocess2.kernel=a,this._verticalBlurPostprocess2.kernel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"intensity",{get:function(){return this._intensity},set:function(a){this._intensity=a},enumerable:!0,configurable:!0}),b.prototype.getEffectName=function(){return b.EffectName},b.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[ra.b.PositionKind],["offset"],["textureSampler","textureSampler2"],`#define EMISSIVE 
`)},b.prototype._createTextureAndPostProcesses=function(){var a=this,c=this._mainTextureDesiredSize.width,d=this._mainTextureDesiredSize.height;c=this._engine.needPOTTextures?Ha.a.GetExponentOfTwo(c,this._maxSize):c,d=this._engine.needPOTTextures?Ha.a.GetExponentOfTwo(d,this._maxSize):d;var f=0;f=this._engine.getCaps().textureHalfFloatRender?p.a.TEXTURETYPE_HALF_FLOAT:p.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new Jb("GlowLayerBlurRTT",{width:c,height:d},this._scene,!1,!0,f),this._blurTexture1.wrapU=ya.a.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=ya.a.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(ya.a.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var g=Math.floor(c/2),h=Math.floor(d/2);this._blurTexture2=new Jb("GlowLayerBlurRTT2",{width:g,height:h},this._scene,!1,!0,f),this._blurTexture2.wrapU=ya.a.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=ya.a.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(ya.a.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new Xb("GlowLayerHBP1",new i.d(1,0),this._options.blurKernelSize/2,{width:c,height:d},null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._horizontalBlurPostprocess1.width=c,this._horizontalBlurPostprocess1.height=d,this._horizontalBlurPostprocess1.onApplyObservable.add(function(j){j.setTexture("textureSampler",a._mainTexture)}),this._verticalBlurPostprocess1=new Xb("GlowLayerVBP1",new i.d(0,1),this._options.blurKernelSize/2,{width:c,height:d},null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._horizontalBlurPostprocess2=new Xb("GlowLayerHBP2",new i.d(1,0),this._options.blurKernelSize/2,{width:g,height:h},null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._horizontalBlurPostprocess2.width=g,this._horizontalBlurPostprocess2.height=h,this._horizontalBlurPostprocess2.onApplyObservable.add(function(j){j.setTexture("textureSampler",a._blurTexture1)}),this._verticalBlurPostprocess2=new Xb("GlowLayerVBP2",new i.d(0,1),this._options.blurKernelSize/2,{width:g,height:h},null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add(function(){var j=a._blurTexture1.getInternalTexture();j&&(a._scene.postProcessManager.directRender(a._postProcesses1,j,!0),(j=a._blurTexture2.getInternalTexture())&&a._scene.postProcessManager.directRender(a._postProcesses2,j,!0))}),this._postProcesses.map(function(j){j.autoClear=!1})},b.prototype.isReady=function(a,c){var d=a.getMaterial(),f=a.getRenderingMesh();if(!d||!f)return!1;var g=d.emissiveTexture;return e.prototype._isReady.call(this,a,c,g)},b.prototype.needStencil=function(){return!1},b.prototype._canRenderMesh=function(a,c){return!0},b.prototype._internalRender=function(a){a.setTexture("textureSampler",this._blurTexture1),a.setTexture("textureSampler2",this._blurTexture2),a.setFloat("offset",this._intensity);var c=this._engine,d=c.getStencilBuffer();c.setStencilBuffer(!1),c.drawElementsType(Hb.a.TriangleFillMode,0,6),c.setStencilBuffer(d)},b.prototype._setEmissiveTextureAndColor=function(a,c,d){var f=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(a,c,d):d?(this._emissiveTextureAndColor.texture=d.emissiveTexture,this._emissiveTextureAndColor.texture&&(f=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(a,c,d,this._emissiveTextureAndColor.color):d.emissiveColor?this._emissiveTextureAndColor.color.set(d.emissiveColor.r*f,d.emissiveColor.g*f,d.emissiveColor.b*f,d.alpha):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},b.prototype._shouldRenderMesh=function(a){return this.hasMesh(a)},b.prototype._addCustomEffectDefines=function(a){a.push("#define GLOW")},b.prototype.addExcludedMesh=function(a){-1===this._excludedMeshes.indexOf(a.uniqueId)&&this._excludedMeshes.push(a.uniqueId)},b.prototype.removeExcludedMesh=function(a){var c=this._excludedMeshes.indexOf(a.uniqueId);-1!==c&&this._excludedMeshes.splice(c,1)},b.prototype.addIncludedOnlyMesh=function(a){-1===this._includedOnlyMeshes.indexOf(a.uniqueId)&&this._includedOnlyMeshes.push(a.uniqueId)},b.prototype.removeIncludedOnlyMesh=function(a){var c=this._includedOnlyMeshes.indexOf(a.uniqueId);-1!==c&&this._includedOnlyMeshes.splice(c,1)},b.prototype.hasMesh=function(a){return!!e.prototype.hasMesh.call(this,a)&&(this._includedOnlyMeshes.length?-1!==this._includedOnlyMeshes.indexOf(a.uniqueId):!this._excludedMeshes.length||-1===this._excludedMeshes.indexOf(a.uniqueId))},b.prototype._useMeshMaterial=function(a){return 0!=this._meshesUsingTheirOwnMaterials.length&&this._meshesUsingTheirOwnMaterials.indexOf(a.uniqueId)>-1},b.prototype.referenceMeshToUseItsOwnMaterial=function(a){this._meshesUsingTheirOwnMaterials.push(a.uniqueId)},b.prototype.unReferenceMeshFromUsingItsOwnMaterial=function(a){for(var c=this._meshesUsingTheirOwnMaterials.indexOf(a.uniqueId);c>0;)this._meshesUsingTheirOwnMaterials.slice(c,c+1),c=this._meshesUsingTheirOwnMaterials.indexOf(a.uniqueId)},b.prototype._disposeMesh=function(a){this.removeIncludedOnlyMesh(a),this.removeExcludedMesh(a)},b.prototype.getClassName=function(){return"GlowLayer"},b.prototype.serialize=function(){var a,c=F.a.Serialize(this);if(c.customType="BABYLON.GlowLayer",c.includedMeshes=[],this._includedOnlyMeshes.length)for(a=0;a<this._includedOnlyMeshes.length;a++)(d=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[a]))&&c.includedMeshes.push(d.id);if(c.excludedMeshes=[],this._excludedMeshes.length)for(a=0;a<this._excludedMeshes.length;a++){var d;(d=this._scene.getMeshByUniqueID(this._excludedMeshes[a]))&&c.excludedMeshes.push(d.id)}return c},b.Parse=function(a,c,d){var f,g=F.a.Parse(function(){return new b(a.name,c,a.options)},a,c,d);for(f=0;f<a.excludedMeshes.length;f++)(h=c.getMeshByID(a.excludedMeshes[f]))&&g.addExcludedMesh(h);for(f=0;f<a.includedMeshes.length;f++){var h;(h=c.getMeshByID(a.includedMeshes[f]))&&g.addIncludedOnlyMesh(h)}return g},b.EffectName="GlowLayer",b.DefaultBlurKernelSize=32,b.DefaultTextureRatio=.5,Object(l.c)([Object(F.c)()],b.prototype,"blurKernelSize",null),Object(l.c)([Object(F.c)()],b.prototype,"intensity",null),Object(l.c)([Object(F.c)("options")],b.prototype,"_options",void 0),b}(De);D.a.RegisteredTypes["BABYLON.GlowLayer"]=rf;var hn=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
uniform vec2 direction;
uniform float blurWidth;

float getLuminance(vec3 color)
{
return dot(color,vec3(0.2126,0.7152,0.0722));
}
void main(void)
{
float weights[7];
weights[0]=0.05;
weights[1]=0.1;
weights[2]=0.2;
weights[3]=0.3;
weights[4]=0.2;
weights[5]=0.1;
weights[6]=0.05;
vec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);
vec2 texelStep=texelSize*direction*blurWidth;
vec2 start=vUV-3.0*texelStep;
vec4 baseColor=vec4(0.,0.,0.,0.);
vec2 texelOffset=vec2(0.,0.);
for (int i=0; i<7; i++)
{

vec4 texel=texture2D(textureSampler,start+texelOffset);
baseColor.a+=texel.a*weights[i];

float luminance=getLuminance(baseColor.rgb);
float luminanceTexel=getLuminance(texel.rgb);
float choice=step(luminanceTexel,luminance);
baseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;
texelOffset+=texelStep;
}
gl_FragColor=baseColor;
}`;Pa.a.ShadersStore.glowBlurPostProcessPixelShader=hn,R.a.prototype.getHighlightLayerByName=function(e){for(var b=0;b<this.effectLayers.length;b++)if(this.effectLayers[b].name===e&&this.effectLayers[b].getEffectName()===Jg.EffectName)return this.effectLayers[b];return null};var $i=function(e){function b(a,c,d,f,g,h,j,m){void 0===h&&(h=ya.a.BILINEAR_SAMPLINGMODE);var w=e.call(this,a,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,f,g,h,j,m)||this;return w.direction=c,w.kernel=d,w.onApplyObservable.add(function(z){z.setFloat2("screenSize",w.width,w.height),z.setVector2("direction",w.direction),z.setFloat("blurWidth",w.kernel)}),w}return Object(l.d)(b,e),b}(gb),Jg=function(e){function b(a,c,d){var f=e.call(this,a,c)||this;return f.name=a,f.innerGlow=!0,f.outerGlow=!0,f.onBeforeBlurObservable=new I.c(),f.onAfterBlurObservable=new I.c(),f._instanceGlowingMeshStencilReference=b.GlowingMeshStencilReference++,f._meshes={},f._excludedMeshes={},f.neutralColor=b.NeutralColor,f._engine.isStencilEnable||k.a.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),f._options=Object(l.a)({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:p.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},d),f._init({alphaBlendingMode:f._options.alphaBlendingMode,camera:f._options.camera,mainTextureFixedSize:f._options.mainTextureFixedSize,mainTextureRatio:f._options.mainTextureRatio,renderingGroupId:f._options.renderingGroupId}),f._shouldRender=!1,f}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(a){this._horizontalBlurPostprocess.kernel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(a){this._verticalBlurPostprocess.kernel=a},enumerable:!0,configurable:!0}),b.prototype.getEffectName=function(){return b.EffectName},b.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[ra.b.PositionKind],["offset"],["textureSampler"],this._options.isStroke?`#define STROKE 
`:void 0)},b.prototype._createTextureAndPostProcesses=function(){var a=this,c=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,d=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;c=this._engine.needPOTTextures?Ha.a.GetExponentOfTwo(c,this._maxSize):c,d=this._engine.needPOTTextures?Ha.a.GetExponentOfTwo(d,this._maxSize):d;var f=0;f=this._engine.getCaps().textureHalfFloatRender?p.a.TEXTURETYPE_HALF_FLOAT:p.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new Jb("HighlightLayerBlurRTT",{width:c,height:d},this._scene,!1,!0,f),this._blurTexture.wrapU=ya.a.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=ya.a.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(ya.a.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===p.a.ALPHA_COMBINE?(this._downSamplePostprocess=new Wc("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(g){g.setTexture("textureSampler",a._mainTexture)}),this._horizontalBlurPostprocess=new $i("HighlightLayerHBP",new i.d(1,0),this._options.blurHorizontalSize,1,null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(g){g.setFloat2("screenSize",c,d)}),this._verticalBlurPostprocess=new $i("HighlightLayerVBP",new i.d(0,1),this._options.blurVerticalSize,1,null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(g){g.setFloat2("screenSize",c,d)}),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new Xb("HighlightLayerHBP",new i.d(1,0),this._options.blurHorizontalSize/2,{width:c,height:d},null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._horizontalBlurPostprocess.width=c,this._horizontalBlurPostprocess.height=d,this._horizontalBlurPostprocess.onApplyObservable.add(function(g){g.setTexture("textureSampler",a._mainTexture)}),this._verticalBlurPostprocess=new Xb("HighlightLayerVBP",new i.d(0,1),this._options.blurVerticalSize/2,{width:c,height:d},null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add(function(){a.onBeforeBlurObservable.notifyObservers(a);var g=a._blurTexture.getInternalTexture();g&&a._scene.postProcessManager.directRender(a._postProcesses,g,!0),a.onAfterBlurObservable.notifyObservers(a)}),this._postProcesses.map(function(g){g.autoClear=!1})},b.prototype.needStencil=function(){return!0},b.prototype.isReady=function(a,c){var d=a.getMaterial(),f=a.getRenderingMesh();if(!d||!f||!this._meshes)return!1;var g=null,h=this._meshes[f.uniqueId];return h&&h.glowEmissiveOnly&&d&&(g=d.emissiveTexture),e.prototype._isReady.call(this,a,c,g)},b.prototype._internalRender=function(a){a.setTexture("textureSampler",this._blurTexture);var c=this._engine;c.cacheStencilState(),c.setStencilOperationPass(p.a.REPLACE),c.setStencilOperationFail(p.a.KEEP),c.setStencilOperationDepthFail(p.a.KEEP),c.setStencilMask(0),c.setStencilBuffer(!0),c.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(a.setFloat("offset",0),c.setStencilFunction(p.a.NOTEQUAL),c.drawElementsType(Hb.a.TriangleFillMode,0,6)),this.innerGlow&&(a.setFloat("offset",1),c.setStencilFunction(p.a.EQUAL),c.drawElementsType(Hb.a.TriangleFillMode,0,6)),c.restoreStencilState()},b.prototype.shouldRender=function(){return!!e.prototype.shouldRender.call(this)&&!!this._meshes},b.prototype._shouldRenderMesh=function(a){return(!this._excludedMeshes||!this._excludedMeshes[a.uniqueId])&&!!e.prototype.hasMesh.call(this,a)},b.prototype._setEmissiveTextureAndColor=function(a,c,d){var f=this._meshes[a.uniqueId];f?this._emissiveTextureAndColor.color.set(f.color.r,f.color.g,f.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),f&&f.glowEmissiveOnly&&d?(this._emissiveTextureAndColor.texture=d.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},b.prototype.addExcludedMesh=function(a){this._excludedMeshes&&(this._excludedMeshes[a.uniqueId]||(this._excludedMeshes[a.uniqueId]={mesh:a,beforeBind:a.onBeforeBindObservable.add(function(c){c.getEngine().setStencilBuffer(!1)}),afterRender:a.onAfterRenderObservable.add(function(c){c.getEngine().setStencilBuffer(!0)})}))},b.prototype.removeExcludedMesh=function(a){if(this._excludedMeshes){var c=this._excludedMeshes[a.uniqueId];c&&(c.beforeBind&&a.onBeforeBindObservable.remove(c.beforeBind),c.afterRender&&a.onAfterRenderObservable.remove(c.afterRender)),this._excludedMeshes[a.uniqueId]=null}},b.prototype.hasMesh=function(a){return!!this._meshes&&(!!e.prototype.hasMesh.call(this,a)&&(void 0!==this._meshes[a.uniqueId]&&null!==this._meshes[a.uniqueId]))},b.prototype.addMesh=function(a,c,d){var f=this;if(void 0===d&&(d=!1),this._meshes){var g=this._meshes[a.uniqueId];g?g.color=c:(this._meshes[a.uniqueId]={mesh:a,color:c,observerHighlight:a.onBeforeBindObservable.add(function(h){f.isEnabled&&(f._excludedMeshes&&f._excludedMeshes[h.uniqueId]?f._defaultStencilReference(h):h.getScene().getEngine().setStencilFunctionReference(f._instanceGlowingMeshStencilReference))}),observerDefault:a.onAfterRenderObservable.add(function(h){f.isEnabled&&f._defaultStencilReference(h)}),glowEmissiveOnly:d},a.onDisposeObservable.add(function(){f._disposeMesh(a)})),this._shouldRender=!0}},b.prototype.removeMesh=function(a){if(this._meshes){var c=this._meshes[a.uniqueId];for(var d in c&&(c.observerHighlight&&a.onBeforeBindObservable.remove(c.observerHighlight),c.observerDefault&&a.onAfterRenderObservable.remove(c.observerDefault),delete this._meshes[a.uniqueId]),this._shouldRender=!1,this._meshes)if(this._meshes[d]){this._shouldRender=!0;break}}},b.prototype.removeAllMeshes=function(){if(this._meshes){for(var a in this._meshes)if(this._meshes.hasOwnProperty(a)){var c=this._meshes[a];c&&this.removeMesh(c.mesh)}}},b.prototype._defaultStencilReference=function(a){a.getScene().getEngine().setStencilFunctionReference(b.NormalMeshStencilReference)},b.prototype._disposeMesh=function(a){this.removeMesh(a),this.removeExcludedMesh(a)},b.prototype.dispose=function(){if(this._meshes){for(var a in this._meshes)(c=this._meshes[a])&&c.mesh&&(c.observerHighlight&&c.mesh.onBeforeBindObservable.remove(c.observerHighlight),c.observerDefault&&c.mesh.onAfterRenderObservable.remove(c.observerDefault));this._meshes=null}if(this._excludedMeshes){for(var a in this._excludedMeshes){var c;(c=this._excludedMeshes[a])&&(c.beforeBind&&c.mesh.onBeforeBindObservable.remove(c.beforeBind),c.afterRender&&c.mesh.onAfterRenderObservable.remove(c.afterRender))}this._excludedMeshes=null}e.prototype.dispose.call(this)},b.prototype.getClassName=function(){return"HighlightLayer"},b.prototype.serialize=function(){var a=F.a.Serialize(this);if(a.customType="BABYLON.HighlightLayer",a.meshes=[],this._meshes)for(var c in this._meshes){var d=this._meshes[c];d&&a.meshes.push({glowEmissiveOnly:d.glowEmissiveOnly,color:d.color.asArray(),meshId:d.mesh.id})}if(a.excludedMeshes=[],this._excludedMeshes)for(var f in this._excludedMeshes){var g=this._excludedMeshes[f];g&&a.excludedMeshes.push(g.mesh.id)}return a},b.Parse=function(a,c,d){var f,g=F.a.Parse(function(){return new b(a.name,c,a.options)},a,c,d);for(f=0;f<a.excludedMeshes.length;f++)(h=c.getMeshByID(a.excludedMeshes[f]))&&g.addExcludedMesh(h);for(f=0;f<a.meshes.length;f++){var h,j=a.meshes[f];(h=c.getMeshByID(j.meshId))&&g.addMesh(h,G.a.FromArray(j.color),j.glowEmissiveOnly)}return g},b.EffectName="HighlightLayer",b.NeutralColor=new G.b(0,0,0,0),b.GlowingMeshStencilReference=2,b.NormalMeshStencilReference=1,Object(l.c)([Object(F.c)()],b.prototype,"innerGlow",void 0),Object(l.c)([Object(F.c)()],b.prototype,"outerGlow",void 0),Object(l.c)([Object(F.c)()],b.prototype,"blurHorizontalSize",null),Object(l.c)([Object(F.c)()],b.prototype,"blurVerticalSize",null),Object(l.c)([Object(F.c)("options")],b.prototype,"_options",void 0),b}(De);D.a.RegisteredTypes["BABYLON.HighlightLayer"]=Jg;var aj=function(){function e(b){this.name=_a.a.NAME_LAYER,this.scene=b,this._engine=b.getEngine(),b.layers=new Array()}return e.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(_a.a.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(_a.a.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(_a.a.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(_a.a.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},e.prototype.rebuild=function(){for(var b=0,a=this.scene.layers;b<a.length;b++)a[b]._rebuild()},e.prototype.dispose=function(){for(var b=this.scene.layers;b.length;)b[0].dispose()},e.prototype._draw=function(b){var a=this.scene.layers;if(a.length){this._engine.setDepthBuffer(!1);for(var c=0,d=a;c<d.length;c++){var f=d[c];b(f)&&f.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCameraPredicate=function(b,a,c){return!b.renderOnlyInRenderTargetTextures&&b.isBackground===a&&0!=(b.layerMask&c)},e.prototype._drawCameraBackground=function(b){var a=this;this._draw(function(c){return a._drawCameraPredicate(c,!0,b.layerMask)})},e.prototype._drawCameraForeground=function(b){var a=this;this._draw(function(c){return a._drawCameraPredicate(c,!1,b.layerMask)})},e.prototype._drawRenderTargetPredicate=function(b,a,c,d){return b.renderTargetTextures.length>0&&b.isBackground===a&&b.renderTargetTextures.indexOf(d)>-1&&0!=(b.layerMask&c)},e.prototype._drawRenderTargetBackground=function(b){var a=this;this._draw(function(c){return a._drawRenderTargetPredicate(c,!0,a.scene.activeCamera.layerMask,b)})},e.prototype._drawRenderTargetForeground=function(b){var a=this;this._draw(function(c){return a._drawRenderTargetPredicate(c,!1,a.scene.activeCamera.layerMask,b)})},e.prototype.addFromContainer=function(b){var a=this;b.layers&&b.layers.forEach(function(c){a.scene.layers.push(c)})},e.prototype.removeFromContainer=function(b,a){var c=this;void 0===a&&(a=!1),b.layers&&b.layers.forEach(function(d){var f=c.scene.layers.indexOf(d);-1!==f&&c.scene.layers.splice(f,1),a&&d.dispose()})},e}(),jn=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;

#include<helperFunctions>
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef LINEAR
baseColor.rgb=toGammaSpace(baseColor.rgb);
#endif
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
gl_FragColor=baseColor*color;
}`;Pa.a.ShadersStore.layerPixelShader=jn;var kn=`
attribute vec2 position;

uniform vec2 scale;
uniform vec2 offset;
uniform mat4 textureMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vec2 shiftedPosition=position*scale+offset;
vUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));
gl_Position=vec4(shiftedPosition,0.0,1.0);
}`;Pa.a.ShadersStore.layerVertexShader=kn;var ln=function(){function e(b,a,c,d,f){this.name=b,this.scale=new i.d(1,1),this.offset=new i.d(0,0),this.alphaBlendingMode=p.a.ALPHA_COMBINE,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new I.c(),this.onBeforeRenderObservable=new I.c(),this.onAfterRenderObservable=new I.c(),this.texture=a?new ya.a(a,c,!0):null,this.isBackground=void 0===d||d,this.color=void 0===f?new G.b(1,1,1,1):f,this._scene=c||U.a.LastCreatedScene;var g=this._scene._getComponent(_a.a.NAME_LAYER);g||(g=new aj(this._scene),this._scene._addComponent(g)),this._scene.layers.push(this);var h=this._scene.getEngine(),j=[];j.push(1,1),j.push(-1,1),j.push(-1,-1),j.push(1,-1);var m=new ra.b(h,j,ra.b.PositionKind,!1,!1,2);this._vertexBuffers[ra.b.PositionKind]=m,this._createIndexBuffer()}return Object.defineProperty(e.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(b){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(b)},enumerable:!0,configurable:!0}),e.prototype._createIndexBuffer=function(){var b=this._scene.getEngine(),a=[];a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=b.createIndexBuffer(a)},e.prototype._rebuild=function(){var b=this._vertexBuffers[ra.b.PositionKind];b&&b._rebuild(),this._createIndexBuffer()},e.prototype.render=function(){var b=this._scene.getEngine(),a="";this.alphaTest&&(a="#define ALPHATEST"),this.texture&&!this.texture.gammaSpace&&(a+=`\r
#define LINEAR`),this._previousDefines!==a&&(this._previousDefines=a,this._effect=b.createEffect("layer",[ra.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],a));var c=this._effect;c&&c.isReady()&&this.texture&&this.texture.isReady()&&(b=this._scene.getEngine(),this.onBeforeRenderObservable.notifyObservers(this),b.enableEffect(c),b.setState(!1),c.setTexture("textureSampler",this.texture),c.setMatrix("textureMatrix",this.texture.getTextureMatrix()),c.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),c.setVector2("offset",this.offset),c.setVector2("scale",this.scale),b.bindBuffers(this._vertexBuffers,this._indexBuffer,c),this.alphaTest?b.drawElementsType(Hb.a.TriangleFillMode,0,6):(b.setAlphaMode(this.alphaBlendingMode),b.drawElementsType(Hb.a.TriangleFillMode,0,6),b.setAlphaMode(p.a.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this))},e.prototype.dispose=function(){var b=this._vertexBuffers[ra.b.PositionKind];b&&(b.dispose(),this._vertexBuffers[ra.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var a=this._scene.layers.indexOf(this);this._scene.layers.splice(a,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},e}(),bj=function(){function e(b,a,c,d,f){this.size=b,this.position=a,this.alphaMode=p.a.ALPHA_ONEONE,this.color=c||new G.a(1,1,1),this.texture=d?new ya.a(d,f.getScene(),!0):null,this._system=f,f.lensFlares.push(this)}return e.AddFlare=function(b,a,c,d,f){return new e(b,a,c,d,f)},e.prototype.dispose=function(){this.texture&&this.texture.dispose();var b=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(b,1)},e}(),mn=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
gl_FragColor=baseColor*color;
}`;Pa.a.ShadersStore.lensFlarePixelShader=mn;var nn=`
attribute vec2 position;

uniform mat4 viewportMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=viewportMatrix*vec4(position,0.0,1.0);
}`;Pa.a.ShadersStore.lensFlareVertexShader=nn;var Kg=function(){function e(b,a,c){this.name=b,this.lensFlares=new Array(),this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=c||U.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._emitter=a,this.id=b,c.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(h){return c.activeCamera&&h.material&&h.isVisible&&h.isEnabled()&&h.isBlocker&&0!=(h.layerMask&c.activeCamera.layerMask)};var d=c.getEngine(),f=[];f.push(1,1),f.push(-1,1),f.push(-1,-1),f.push(1,-1),this._vertexBuffers[ra.b.PositionKind]=new ra.b(d,f,ra.b.PositionKind,!1,!1,2);var g=[];g.push(0),g.push(1),g.push(2),g.push(0),g.push(2),g.push(3),this._indexBuffer=d.createIndexBuffer(g),this._effect=d.createEffect("lensFlare",[ra.b.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(b){this._isEnabled=b},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEmitter=function(){return this._emitter},e.prototype.setEmitter=function(b){this._emitter=b},e.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},e.prototype.computeEffectivePosition=function(b){var a=this.getEmitterPosition();return a=i.e.Project(a,i.a.Identity(),this._scene.getTransformMatrix(),b),this._positionX=a.x,this._positionY=a.y,a=i.e.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(b.x-=this.viewportBorder,b.y-=this.viewportBorder,b.width+=2*this.viewportBorder,b.height+=2*this.viewportBorder,a.x+=this.viewportBorder,a.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),a.z>0&&(this._positionX>b.x&&this._positionX<b.x+b.width&&this._positionY>b.y&&(this._positionY,b.y,b.height),!0)},e.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var b=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),a=b.length();b.normalize();var c=new Rb.a(this._scene.activeCamera.globalPosition,b),d=this._scene.pickWithRay(c,this.meshesSelectionPredicate,!0);return!d||!d.hit||d.distance>a},e.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var b,a,c=this._scene.getEngine(),d=this._scene.activeCamera.viewport.toGlobal(c.getRenderWidth(!0),c.getRenderHeight(!0));if(!this.computeEffectivePosition(d))return!1;if(!this._isVisible())return!1;var f=(b=this._positionX<this.borderLimit+d.x?this.borderLimit+d.x-this._positionX:this._positionX>d.x+d.width-this.borderLimit?this._positionX-d.x-d.width+this.borderLimit:0)>(a=this._positionY<this.borderLimit+d.y?this.borderLimit+d.y-this._positionY:this._positionY>d.y+d.height-this.borderLimit?this._positionY-d.y-d.height+this.borderLimit:0)?b:a;(f-=this.viewportBorder)>this.borderLimit&&(f=this.borderLimit);var g=1-aa.a.Clamp(f/this.borderLimit,0,1);if(g<0)return!1;g>1&&(g=1),this.viewportBorder>0&&(d.x+=this.viewportBorder,d.y+=this.viewportBorder,d.width-=2*this.viewportBorder,d.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var h=d.x+d.width/2,j=d.y+d.height/2,m=h-this._positionX,w=j-this._positionY;c.enableEffect(this._effect),c.setState(!1),c.setDepthBuffer(!1),c.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var z=0;z<this.lensFlares.length;z++){var C=this.lensFlares[z];if(!C.texture||C.texture.isReady()){c.setAlphaMode(C.alphaMode);var J=h-m*C.position,K=j-w*C.position,N=C.size,T=C.size*c.getAspectRatio(this._scene.activeCamera,!0),Z=J/(d.width+2*d.x)*2-1,_=1-K/(d.height+2*d.y)*2,ca=i.a.FromValues(N/2,0,0,0,0,T/2,0,0,0,0,1,0,Z,_,0,1);this._effect.setMatrix("viewportMatrix",ca),this._effect.setTexture("textureSampler",C.texture),this._effect.setFloat4("color",C.color.r*g,C.color.g*g,C.color.b*g,1),c.drawElementsType(Hb.a.TriangleFillMode,0,6)}}return c.setDepthBuffer(!0),c.setAlphaMode(p.a.ALPHA_DISABLE),!0},e.prototype.dispose=function(){var b=this._vertexBuffers[ra.b.PositionKind];for(b&&(b.dispose(),this._vertexBuffers[ra.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var a=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(a,1)},e.Parse=function(b,a,c){var d=a.getLastEntryByID(b.emitterId),f=b.name||"lensFlareSystem#"+b.emitterId,g=new e(f,d,a);g.id=b.id||f,g.borderLimit=b.borderLimit;for(var h=0;h<b.flares.length;h++){var j=b.flares[h];bj.AddFlare(j.size,j.position,G.a.FromArray(j.color),j.textureName?c+j.textureName:"",g)}return g},e.prototype.serialize=function(){var b={};b.id=this.id,b.name=this.name,b.emitterId=this.getEmitter().id,b.borderLimit=this.borderLimit,b.flares=[];for(var a=0;a<this.lensFlares.length;a++){var c=this.lensFlares[a];b.flares.push({size:c.size,position:c.position,color:c.color.asArray(),textureName:Qa.b.GetFilename(c.texture?c.texture.name:"")})}return b},e._SceneComponentInitialization=function(b){throw Gc.a.WarnImport("LensFlareSystemSceneComponent")},e}();R.a.AddParser(_a.a.NAME_LENSFLARESYSTEM,function(e,b,a,c){if(void 0!==e.lensFlareSystems&&null!==e.lensFlareSystems){a.lensFlareSystems||(a.lensFlareSystems=new Array());for(var d=0,f=e.lensFlareSystems.length;d<f;d++){var g=e.lensFlareSystems[d],h=Kg.Parse(g,b,c);a.lensFlareSystems.push(h)}}}),R.a.prototype.getLensFlareSystemByName=function(e){for(var b=0;b<this.lensFlareSystems.length;b++)if(this.lensFlareSystems[b].name===e)return this.lensFlareSystems[b];return null},R.a.prototype.getLensFlareSystemByID=function(e){for(var b=0;b<this.lensFlareSystems.length;b++)if(this.lensFlareSystems[b].id===e)return this.lensFlareSystems[b];return null},R.a.prototype.removeLensFlareSystem=function(e){var b=this.lensFlareSystems.indexOf(e);return-1!==b&&this.lensFlareSystems.splice(b,1),b},R.a.prototype.addLensFlareSystem=function(e){this.lensFlareSystems.push(e)};var cj=function(){function e(b){this.name=_a.a.NAME_LENSFLARESYSTEM,this.scene=b,b.lensFlareSystems=new Array()}return e.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(_a.a.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},e.prototype.rebuild=function(){},e.prototype.addFromContainer=function(b){var a=this;b.lensFlareSystems&&b.lensFlareSystems.forEach(function(c){a.scene.addLensFlareSystem(c)})},e.prototype.removeFromContainer=function(b,a){var c=this;b.lensFlareSystems&&b.lensFlareSystems.forEach(function(d){c.scene.removeLensFlareSystem(d),a&&d.dispose()})},e.prototype.serialize=function(b){b.lensFlareSystems=[];for(var a=0,c=this.scene.lensFlareSystems;a<c.length;a++){var d=c[a];b.lensFlareSystems.push(d.serialize())}},e.prototype.dispose=function(){for(var b=this.scene.lensFlareSystems;b.length;)b[0].dispose()},e.prototype._draw=function(b){if(this.scene.lensFlaresEnabled){var a=this.scene.lensFlareSystems;Qa.b.StartPerformanceCounter("Lens flares",a.length>0);for(var c=0,d=a;c<d.length;c++){var f=d[c];0!=(b.layerMask&f.layerMask)&&f.render()}Qa.b.EndPerformanceCounter("Lens flares",a.length>0)}},e}();Kg._SceneComponentInitialization=function(e){var b=e._getComponent(_a.a.NAME_LENSFLARESYSTEM);b||(b=new cj(e),e._addComponent(b))};var on=`#ifndef FLOAT
#include<packingFunctions>
#endif
varying float vDepthMetric;
#ifdef USEDISTANCE
uniform vec3 lightData;
varying vec3 vPositionW;
#endif
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
uniform vec3 biasAndScale;
uniform vec2 depthValues;
#ifdef DEPTHCLAMP
varying float z;
#endif
#include<clipPlaneFragmentDeclaration>
void main(void)
{
#include<clipPlaneFragment>
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
float depth=vDepthMetric;
#ifdef DEPTHCLAMP
#ifdef USEDISTANCE
depth=clamp(((length(vPositionW-lightData)+depthValues.x)/(depthValues.y))+biasAndScale.x,0.0,1.0);
#else
depth=clamp(((z+depthValues.x)/(depthValues.y))+biasAndScale.x,0.0,1.0);
#endif
gl_FragDepth=depth;
#elif defined(USEDISTANCE)
depth=(length(vPositionW-lightData)+depthValues.x)/(depthValues.y)+biasAndScale.x;
#endif
#ifdef ESM
depth=clamp(exp(-min(87.,biasAndScale.z*depth)),0.,1.);
#endif
#ifdef FLOAT
gl_FragColor=vec4(depth,1.0,1.0,1.0);
#else
gl_FragColor=pack(depth);
#endif
}`;Pa.a.ShadersStore.shadowMapPixelShader=on;var pn=`
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
uniform vec3 lightData;
#endif
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
#include<helperFunctions>
uniform mat4 viewProjection;
uniform vec3 biasAndScale;
uniform vec2 depthValues;
varying float vDepthMetric;
#ifdef USEDISTANCE
varying vec3 vPositionW;
#endif
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#ifdef DEPTHCLAMP
varying float z;
#endif
#include<clipPlaneVertexDeclaration>
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);

#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vec3 worldNor=normalize(normalWorld*normal);
#ifdef DIRECTIONINLIGHTDATA
vec3 worldLightDir=normalize(-lightData.xyz);
#else
vec3 directionToLight=lightData.xyz-worldPos.xyz;
vec3 worldLightDir=normalize(directionToLight);
#endif
float ndl=dot(worldNor,worldLightDir);
float sinNL=sqrt(1.0-ndl*ndl);
float normalBias=biasAndScale.y*sinNL;
worldPos.xyz-=worldNor*normalBias;
#endif
#ifdef USEDISTANCE
vPositionW=worldPos.xyz;
#endif

gl_Position=viewProjection*worldPos;
#ifdef DEPTHTEXTURE

gl_Position.z+=biasAndScale.x*gl_Position.w;
#endif
#ifdef DEPTHCLAMP
z=gl_Position.z;
gl_Position.z=0.0;
#elif !defined(USEDISTANCE)

vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;
#endif
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<clipPlaneVertex>
}`;Pa.a.ShadersStore.shadowMapVertexShader=pn;var qn=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
void main(void)
{
vec4 colorDepth=vec4(0.0);
for (int x=-OFFSET; x<=OFFSET; x++)
for (int y=-OFFSET; y<=OFFSET; y++)
colorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);
gl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));
}`;Pa.a.ShadersStore.depthBoxBlurPixelShader=qn;var lc=function(){function e(b,a,c){this.onBeforeShadowMapRenderObservable=new I.c(),this.onAfterShadowMapRenderObservable=new I.c(),this.onBeforeShadowMapRenderMeshObservable=new I.c(),this.onAfterShadowMapRenderMeshObservable=new I.c(),this._bias=5e-05,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=e.FILTER_NONE,this._filteringQuality=e.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=i.e.Zero(),this._viewMatrix=i.a.Zero(),this._projectionMatrix=i.a.Zero(),this._transformMatrix=i.a.Zero(),this._cachedPosition=new i.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new i.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=i.a.Identity(),this._mapSize=b,this._light=a,this._scene=a.getScene(),a._shadowGenerator=this,e._SceneComponentInitialization(this._scene);var d=this._scene.getEngine().getCaps();c?d.textureFloatRender&&d.textureFloatLinearFiltering?this._textureType=p.a.TEXTURETYPE_FLOAT:d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?this._textureType=p.a.TEXTURETYPE_HALF_FLOAT:this._textureType=p.a.TEXTURETYPE_UNSIGNED_INT:d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?this._textureType=p.a.TEXTURETYPE_HALF_FLOAT:d.textureFloatRender&&d.textureFloatLinearFiltering?this._textureType=p.a.TEXTURETYPE_FLOAT:this._textureType=p.a.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(b){this._bias=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalBias",{get:function(){return this._normalBias},set:function(b){this._normalBias=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(b){this._blurBoxOffset!==b&&(this._blurBoxOffset=b,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurScale",{get:function(){return this._blurScale},set:function(b){this._blurScale!==b&&(this._blurScale=b,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(b){this._blurKernel!==b&&(this._blurKernel=b,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(b){this._useKernelBlur!==b&&(this._useKernelBlur=b,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(b){this._depthScale=b},enumerable:!0,configurable:!0}),e.prototype._validateFilter=function(b){return b},Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(b){if(b=this._validateFilter(b),this._light.needCube()){if(b===e.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(b===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(b===e.FILTER_PCF||b===e.FILTER_PCSS)return void(this.usePoissonSampling=!0)}b!==e.FILTER_PCF&&b!==e.FILTER_PCSS||1!==this._scene.getEngine().webGLVersion?this._filter!==b&&(this._filter=b,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){return this.filter===e.FILTER_POISSONSAMPLING},set:function(b){var a=this._validateFilter(e.FILTER_POISSONSAMPLING);(b||this.filter===e.FILTER_POISSONSAMPLING)&&(this.filter=b?a:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useExponentialShadowMap",{get:function(){return this.filter===e.FILTER_EXPONENTIALSHADOWMAP},set:function(b){var a=this._validateFilter(e.FILTER_EXPONENTIALSHADOWMAP);(b||this.filter===e.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=b?a:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(b){var a=this._validateFilter(e.FILTER_BLUREXPONENTIALSHADOWMAP);(b||this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=b?a:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(b){var a=this._validateFilter(e.FILTER_CLOSEEXPONENTIALSHADOWMAP);(b||this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=b?a:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(b){var a=this._validateFilter(e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(b||this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=b?a:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===e.FILTER_PCF},set:function(b){var a=this._validateFilter(e.FILTER_PCF);(b||this.filter===e.FILTER_PCF)&&(this.filter=b?a:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(b){this._filteringQuality!==b&&(this._filteringQuality=b,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useContactHardeningShadow",{get:function(){return this.filter===e.FILTER_PCSS},set:function(b){var a=this._validateFilter(e.FILTER_PCSS);(b||this.filter===e.FILTER_PCSS)&&(this.filter=b?a:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(b){this._contactHardeningLightSizeUVRatio=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"darkness",{get:function(){return this._darkness},set:function(b){this.setDarkness(b)},enumerable:!0,configurable:!0}),e.prototype.getDarkness=function(){return this._darkness},e.prototype.setDarkness=function(b){return this._darkness=b>=1?1:b<=0?0:b,this},Object.defineProperty(e.prototype,"transparencyShadow",{get:function(){return this._transparencyShadow},set:function(b){this.setTransparencyShadow(b)},enumerable:!0,configurable:!0}),e.prototype.setTransparencyShadow=function(b){return this._transparencyShadow=b,this},e.prototype.getShadowMap=function(){return this._shadowMap},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},e.prototype.getClassName=function(){return e.CLASSNAME},e.prototype.addShadowCaster=function(b,a){var c;return void 0===a&&(a=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(b),a&&(c=this._shadowMap.renderList).push.apply(c,b.getChildMeshes()),this):this},e.prototype.removeShadowCaster=function(b,a){if(void 0===a&&(a=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var c=this._shadowMap.renderList.indexOf(b);if(-1!==c&&this._shadowMap.renderList.splice(c,1),a)for(var d=0,f=b.getChildren();d<f.length;d++){var g=f[d];this.removeShadowCaster(g)}return this},e.prototype.getLight=function(){return this._light},e.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},e.prototype._createTargetRenderTexture=function(){this._scene.getEngine().webGLVersion>1?(this._shadowMap=new Jb(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(p.a.LESS,!0)):this._shadowMap=new Jb(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube())},e.prototype._initializeShadowMap=function(){var b=this;if(this._createTargetRenderTexture(),null!==this._shadowMap){this._shadowMap.wrapU=ya.a.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=ya.a.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(ya.a.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.uniqueId=this._storedUniqueId),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this);var a=this._scene.getEngine();this._shadowMap.onBeforeRenderObservable.add(function(g){b._currentFaceIndex=g,b._filter===e.FILTER_PCF&&a.setColorWrite(!1)}),this._shadowMap.onAfterUnbindObservable.add(function(){if(b._filter===e.FILTER_PCF&&a.setColorWrite(!0),b.useBlurExponentialShadowMap||b.useBlurCloseExponentialShadowMap){var g=b.getShadowMapForRendering();g&&b._scene.postProcessManager.directRender(b._blurPostProcesses,g.getInternalTexture(),!0)}});var c=new G.b(0,0,0,0),d=new G.b(1,1,1,1);this._shadowMap.onClearObservable.add(function(g){b._filter===e.FILTER_PCF?g.clear(d,!1,!0,!1):b.useExponentialShadowMap||b.useBlurExponentialShadowMap?g.clear(c,!0,!0,!1):g.clear(d,!0,!0,!1)}),this._shadowMap.onResizeObservable.add(function(g){b._storedUniqueId=b._shadowMap.uniqueId,b._mapSize=g.getRenderSize(),b._light._markMeshesAsLightDirty(),b.recreateShadowMap()});for(var f=re.b.MIN_RENDERINGGROUPS;f<re.b.MAX_RENDERINGGROUPS;f++)this._shadowMap.setRenderingAutoClearDepthStencil(f,!1)}},e.prototype._initializeBlurRTTAndPostProcesses=function(){var b=this,a=this._scene.getEngine(),c=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new Jb(this._light.name+"_shadowMap2",c,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=ya.a.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=ya.a.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(ya.a.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new Xb(this._light.name+"KernelBlurX",new i.d(1,0),this.blurKernel,1,null,ya.a.BILINEAR_SAMPLINGMODE,a,!1,this._textureType),this._kernelBlurXPostprocess.width=c,this._kernelBlurXPostprocess.height=c,this._kernelBlurXPostprocess.onApplyObservable.add(function(d){d.setTexture("textureSampler",b._shadowMap)}),this._kernelBlurYPostprocess=new Xb(this._light.name+"KernelBlurY",new i.d(0,1),this.blurKernel,1,null,ya.a.BILINEAR_SAMPLINGMODE,a,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===p.a.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new gb(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,ya.a.BILINEAR_SAMPLINGMODE,a,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(d){d.setFloat2("screenSize",c,c),d.setTexture("textureSampler",b._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},e.prototype._renderForShadowMap=function(b,a,c,d){var f,g=this._scene.getEngine(),h=g.getColorWrite();if(d.length){for(g.setColorWrite(!1),f=0;f<d.length;f++)this._renderSubMeshForShadowMap(d.data[f]);g.setColorWrite(h)}for(f=0;f<b.length;f++)this._renderSubMeshForShadowMap(b.data[f]);for(f=0;f<a.length;f++)this._renderSubMeshForShadowMap(a.data[f]);if(this._transparencyShadow)for(f=0;f<c.length;f++)this._renderSubMeshForShadowMap(c.data[f])},e.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(b,a){},e.prototype._renderSubMeshForShadowMap=function(b){var a=this,c=b.getRenderingMesh(),d=this._scene,f=d.getEngine(),g=b.getMaterial();if(c._internalAbstractMeshDataInfo._isActiveIntermediate=!1,g&&0!==b.verticesCount){f.setState(g.backFaceCulling);var h=c._getInstancesRenderList(b._id);if(!h.mustReturn){var j=f.getCaps().instancedArrays&&null!==h.visibleInstances[b._id]&&void 0!==h.visibleInstances[b._id];if(this.isReady(b,j)){if(f.enableEffect(this._effect),c._bind(b,this._effect,g.fillMode),this._effect.setFloat3("biasAndScale",this.bias,this.normalBias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this.getLight().getTypeID()===Zc.a.LIGHTTYPEID_DIRECTIONALLIGHT?this._effect.setVector3("lightData",this._cachedDirection):this._effect.setVector3("lightData",this._cachedPosition),d.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(d.activeCamera),this.getLight().getDepthMinZ(d.activeCamera)+this.getLight().getDepthMaxZ(d.activeCamera)),g&&g.needAlphaTesting()){var m=g.getAlphaTestTexture();m&&(this._effect.setTexture("diffuseSampler",m),this._effect.setMatrix("diffuseMatrix",m.getTextureMatrix()||this._defaultTextureMatrix))}if(c.useBones&&c.computeBonesUsingShaders&&c.skeleton){var w=c.skeleton;if(w.isUsingTextureForMatrices){var z=w.getTransformMatrixTexture(c);if(!z)return;this._effect.setTexture("boneSampler",z),this._effect.setFloat("boneTextureWidth",4*(w.bones.length+1))}else this._effect.setMatrices("mBones",w.getTransformMatrices(c))}Ua.a.BindMorphTargetParameters(c,this._effect),Ua.a.BindClipPlane(this._effect,d),this._bindCustomEffectForRenderSubMeshForShadowMap(b,this._effect),this.forceBackFacesOnly&&f.setState(!0,0,!1,!0),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(c),this.onBeforeShadowMapRenderObservable.notifyObservers(this._effect),c._processRendering(b,this._effect,g.fillMode,h,j,function(C,J){return a._effect.setMatrix("world",J)}),this.forceBackFacesOnly&&f.setState(!0,0,!1,!1),this.onAfterShadowMapRenderObservable.notifyObservers(this._effect),this.onAfterShadowMapRenderMeshObservable.notifyObservers(c)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},e.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===e.FILTER_NONE||this.filter===e.FILTER_PCSS?this._shadowMap.updateSamplingMode(ya.a.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(ya.a.BILINEAR_SAMPLINGMODE))},e.prototype.forceCompilation=function(b,a){var c=this,d=Object(l.a)({useInstances:!1},a),f=this.getShadowMap();if(f){var g=f.renderList;if(g){for(var h=new Array(),j=0,m=g;j<m.length;j++){var w=m[j];h.push.apply(h,w.subMeshes)}if(0!==h.length){var z=0,C=function(){if(c._scene&&c._scene.getEngine()){for(;c.isReady(h[z],d.useInstances);)if(++z>=h.length)return void(b&&b(c));setTimeout(C,16)}};C()}else b&&b(this)}else b&&b(this)}else b&&b(this)},e.prototype.forceCompilationAsync=function(b){var a=this;return new Promise(function(c){a.forceCompilation(function(){c()},b)})},e.prototype._isReadyCustomDefines=function(b,a,c){},e.prototype.isReady=function(b,a){var c=[];this._textureType!==p.a.TEXTURETYPE_UNSIGNED_INT&&c.push("#define FLOAT"),this.useExponentialShadowMap||this.useBlurExponentialShadowMap?c.push("#define ESM"):(this.usePercentageCloserFiltering||this.useContactHardeningShadow)&&c.push("#define DEPTHTEXTURE");var d=[ra.b.PositionKind],f=b.getMesh(),g=b.getMaterial();if(this.normalBias&&f.isVerticesDataPresent(ra.b.NormalKind)&&(d.push(ra.b.NormalKind),c.push("#define NORMAL"),f.nonUniformScaling&&c.push("#define NONUNIFORMSCALING"),this.getLight().getTypeID()===Zc.a.LIGHTTYPEID_DIRECTIONALLIGHT&&c.push("#define DIRECTIONINLIGHTDATA")),g&&g.needAlphaTesting()){var h=g.getAlphaTestTexture();h&&(c.push("#define ALPHATEST"),f.isVerticesDataPresent(ra.b.UVKind)&&(d.push(ra.b.UVKind),c.push("#define UV1")),f.isVerticesDataPresent(ra.b.UV2Kind)&&1===h.coordinatesIndex&&(d.push(ra.b.UV2Kind),c.push("#define UV2")))}var j=new Nd.a();if(f.useBones&&f.computeBonesUsingShaders&&f.skeleton){d.push(ra.b.MatricesIndicesKind),d.push(ra.b.MatricesWeightsKind),f.numBoneInfluencers>4&&(d.push(ra.b.MatricesIndicesExtraKind),d.push(ra.b.MatricesWeightsExtraKind));var m=f.skeleton;c.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),f.numBoneInfluencers>0&&j.addCPUSkinningFallback(0,f),m.isUsingTextureForMatrices?c.push("#define BONETEXTURE"):c.push("#define BonesPerMesh "+(m.bones.length+1))}else c.push("#define NUM_BONE_INFLUENCERS 0");var w=f.morphTargetManager,z=0;w&&w.numInfluencers>0&&(c.push("#define MORPHTARGETS"),z=w.numInfluencers,c.push("#define NUM_MORPH_INFLUENCERS "+z),Ua.a.PrepareAttributesForMorphTargetsInfluencers(d,f,z));var C=this._scene;if(C.clipPlane&&c.push("#define CLIPPLANE"),C.clipPlane2&&c.push("#define CLIPPLANE2"),C.clipPlane3&&c.push("#define CLIPPLANE3"),C.clipPlane4&&c.push("#define CLIPPLANE4"),C.clipPlane5&&c.push("#define CLIPPLANE5"),C.clipPlane6&&c.push("#define CLIPPLANE6"),a&&(c.push("#define INSTANCES"),Ua.a.PushAttributesForInstances(d)),this.customShaderOptions&&this.customShaderOptions.defines)for(var J=0,K=this.customShaderOptions.defines;J<K.length;J++){var N=K[J];-1===c.indexOf(N)&&c.push(N)}this._light.needCube()&&c.push("#define USEDISTANCE"),this._isReadyCustomDefines(c,b,a);var T=c.join(`
`);if(this._cachedDefines!==T){this._cachedDefines=T;var Z="shadowMap",_=["world","mBones","viewProjection","diffuseMatrix","lightData","depthValues","biasAndScale","morphTargetInfluences","boneTextureWidth","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6"],ca=["diffuseSampler","boneSampler"];if(this.customShaderOptions){if(Z=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(var ea=0,fa=this.customShaderOptions.attributes;ea<fa.length;ea++){var ka=fa[ea];-1===d.indexOf(ka)&&d.push(ka)}if(this.customShaderOptions.uniforms)for(var pa=0,va=this.customShaderOptions.uniforms;pa<va.length;pa++){var sa=va[pa];-1===_.indexOf(sa)&&_.push(sa)}if(this.customShaderOptions.samplers)for(var la=0,ta=this.customShaderOptions.samplers;la<ta.length;la++){var Da=ta[la];-1===ca.indexOf(Da)&&ca.push(Da)}}this._effect=this._scene.getEngine().createEffect(Z,d,_,ca,T,j,void 0,void 0,{maxSimultaneousMorphTargets:z})}return!!this._effect.isReady()&&((this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&(!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())))},e.prototype.prepareDefines=function(b,a){var c=this._scene,d=this._light;c.shadowsEnabled&&d.shadowEnabled&&(b["SHADOW"+a]=!0,this.useContactHardeningShadow?(b["SHADOWPCSS"+a]=!0,this._filteringQuality===e.QUALITY_LOW?b["SHADOWLOWQUALITY"+a]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(b["SHADOWMEDIUMQUALITY"+a]=!0)):this.usePercentageCloserFiltering?(b["SHADOWPCF"+a]=!0,this._filteringQuality===e.QUALITY_LOW?b["SHADOWLOWQUALITY"+a]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(b["SHADOWMEDIUMQUALITY"+a]=!0)):this.usePoissonSampling?b["SHADOWPOISSON"+a]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?b["SHADOWESM"+a]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(b["SHADOWCLOSEESM"+a]=!0),d.needCube()&&(b["SHADOWCUBE"+a]=!0))},e.prototype.bindShadowLight=function(b,a){var c=this._light,d=this._scene;if(d.shadowsEnabled&&c.shadowEnabled){var f=d.activeCamera;if(f){var g=this.getShadowMap();g&&(c.needCube()||a.setMatrix("lightMatrix"+b,this.getTransformMatrix()),this._filter===e.FILTER_PCF?(a.setDepthStencilTexture("shadowSampler"+b,this.getShadowMapForRendering()),c._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),g.getSize().width,1/g.getSize().width,this.frustumEdgeFalloff,b)):this._filter===e.FILTER_PCSS?(a.setDepthStencilTexture("shadowSampler"+b,this.getShadowMapForRendering()),a.setTexture("depthSampler"+b,this.getShadowMapForRendering()),c._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/g.getSize().width,this._contactHardeningLightSizeUVRatio*g.getSize().width,this.frustumEdgeFalloff,b)):(a.setTexture("shadowSampler"+b,this.getShadowMapForRendering()),c._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/g.getSize().width,this.depthScale,this.frustumEdgeFalloff,b)),c._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(f),this.getLight().getDepthMinZ(f)+this.getLight().getDepthMaxZ(f),b))}}},e.prototype.getTransformMatrix=function(){var b=this._scene;if(this._currentRenderID===b.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=b.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var a=this._light.position;if(this._light.computeTransformedInformation()&&(a=this._light.transformedPosition),i.e.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(i.e.Dot(this._lightDirection,i.e.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!a.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(a),this._cachedDirection.copyFrom(this._lightDirection),i.a.LookAtLHToRef(a,a.add(this._lightDirection),i.e.Up(),this._viewMatrix);var c=this.getShadowMap();if(c){var d=c.renderList;d&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,d)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},e.prototype.recreateShadowMap=function(){var b=this._shadowMap;if(b){var a=b.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=a}},e.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},e.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},e.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty()),this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()},e.prototype.serialize=function(){var b={},a=this.getShadowMap();if(!a)return b;if(b.className=this.getClassName(),b.lightId=this._light.id,b.mapSize=a.getRenderSize(),b.forceBackFacesOnly=this.forceBackFacesOnly,b.darkness=this.getDarkness(),b.transparencyShadow=this._transparencyShadow,b.frustumEdgeFalloff=this.frustumEdgeFalloff,b.bias=this.bias,b.normalBias=this.normalBias,b.usePercentageCloserFiltering=this.usePercentageCloserFiltering,b.useContactHardeningShadow=this.useContactHardeningShadow,b.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,b.filteringQuality=this.filteringQuality,b.useExponentialShadowMap=this.useExponentialShadowMap,b.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,b.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,b.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,b.usePoissonSampling=this.usePoissonSampling,b.depthScale=this.depthScale,b.blurBoxOffset=this.blurBoxOffset,b.blurKernel=this.blurKernel,b.blurScale=this.blurScale,b.useKernelBlur=this.useKernelBlur,b.renderList=[],a.renderList)for(var c=0;c<a.renderList.length;c++){var d=a.renderList[c];b.renderList.push(d.id)}return b},e.Parse=function(b,a,c){for(var d=a.getLightByID(b.lightId),f=c?c(b.mapSize,d):new e(b.mapSize,d),g=f.getShadowMap(),h=0;h<b.renderList.length;h++)a.getMeshesByID(b.renderList[h]).forEach(function(j){g&&(g.renderList||(g.renderList=[]),g.renderList.push(j))});return f.forceBackFacesOnly=!!b.forceBackFacesOnly,void 0!==b.darkness&&f.setDarkness(b.darkness),b.transparencyShadow&&f.setTransparencyShadow(!0),void 0!==b.frustumEdgeFalloff&&(f.frustumEdgeFalloff=b.frustumEdgeFalloff),void 0!==b.bias&&(f.bias=b.bias),void 0!==b.normalBias&&(f.normalBias=b.normalBias),b.usePercentageCloserFiltering?f.usePercentageCloserFiltering=!0:b.useContactHardeningShadow?f.useContactHardeningShadow=!0:b.usePoissonSampling?f.usePoissonSampling=!0:b.useExponentialShadowMap?f.useExponentialShadowMap=!0:b.useBlurExponentialShadowMap?f.useBlurExponentialShadowMap=!0:b.useCloseExponentialShadowMap?f.useCloseExponentialShadowMap=!0:b.useBlurCloseExponentialShadowMap?f.useBlurCloseExponentialShadowMap=!0:b.useVarianceShadowMap?f.useExponentialShadowMap=!0:b.useBlurVarianceShadowMap&&(f.useBlurExponentialShadowMap=!0),void 0!==b.contactHardeningLightSizeUVRatio&&(f.contactHardeningLightSizeUVRatio=b.contactHardeningLightSizeUVRatio),void 0!==b.filteringQuality&&(f.filteringQuality=b.filteringQuality),b.depthScale&&(f.depthScale=b.depthScale),b.blurScale&&(f.blurScale=b.blurScale),b.blurBoxOffset&&(f.blurBoxOffset=b.blurBoxOffset),b.useKernelBlur&&(f.useKernelBlur=b.useKernelBlur),b.blurKernel&&(f.blurKernel=b.blurKernel),f},e.CLASSNAME="ShadowGenerator",e.FILTER_NONE=0,e.FILTER_EXPONENTIALSHADOWMAP=1,e.FILTER_POISSONSAMPLING=2,e.FILTER_BLUREXPONENTIALSHADOWMAP=3,e.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,e.FILTER_PCF=6,e.FILTER_PCSS=7,e.QUALITY_HIGH=0,e.QUALITY_MEDIUM=1,e.QUALITY_LOW=2,e._SceneComponentInitialization=function(b){throw Gc.a.WarnImport("ShadowGeneratorSceneComponent")},e}(),rn=`#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
varying float vDepthMetric;
#ifdef PACKED
#include<packingFunctions>
#endif
void main(void)
{
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#ifdef NONLINEARDEPTH
#ifdef PACKED
gl_FragColor=pack(gl_FragCoord.z);
#else
gl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);
#endif
#else
#ifdef PACKED
gl_FragColor=pack(vDepthMetric);
#else
gl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);
#endif
#endif
}`;Pa.a.ShadersStore.depthPixelShader=rn;var sn=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
varying float vDepthMetric;
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}
`;Pa.a.ShadersStore.depthVertexShader=sn;var sf=function(){function e(b,a,c,d){var f=this;void 0===a&&(a=p.a.TEXTURETYPE_FLOAT),void 0===c&&(c=null),void 0===d&&(d=!1),this.enabled=!0,this.useOnlyInActiveCamera=!1,this._scene=b,this._storeNonLinearDepth=d,this.isPacked=a===p.a.TEXTURETYPE_UNSIGNED_BYTE,this.isPacked?this._clearColor=new G.b(1,1,1,1):this._clearColor=new G.b(1,0,0,1),e._SceneComponentInitialization(this._scene),this._camera=c;var g=b.getEngine(),h=this.isPacked||1===g.webGLVersion?p.a.TEXTUREFORMAT_RGBA:p.a.TEXTUREFORMAT_R;this._depthMap=new Jb("depthMap",{width:g.getRenderWidth(),height:g.getRenderHeight()},this._scene,!1,!0,a,!1,void 0,void 0,void 0,void 0,h),this._depthMap.wrapU=ya.a.CLAMP_ADDRESSMODE,this._depthMap.wrapV=ya.a.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add(function(m){m.clear(f._clearColor,!0,!0,!0)});var j=function(m){var w=m.getRenderingMesh(),z=f._scene,C=z.getEngine(),J=m.getMaterial();if(w._internalAbstractMeshDataInfo._isActiveIntermediate=!1,J){C.setState(J.backFaceCulling,0,!1,z.useRightHandedSystem);var K=w._getInstancesRenderList(m._id);if(!K.mustReturn){var N=C.getCaps().instancedArrays&&null!==K.visibleInstances[m._id],T=f._camera||z.activeCamera;if(f.isReady(m,N)&&T){if(C.enableEffect(f._effect),w._bind(m,f._effect,J.fillMode),f._effect.setMatrix("viewProjection",z.getTransformMatrix()),f._effect.setFloat2("depthValues",T.minZ,T.minZ+T.maxZ),J&&J.needAlphaTesting()){var Z=J.getAlphaTestTexture();Z&&(f._effect.setTexture("diffuseSampler",Z),f._effect.setMatrix("diffuseMatrix",Z.getTextureMatrix()))}w.useBones&&w.computeBonesUsingShaders&&w.skeleton&&f._effect.setMatrices("mBones",w.skeleton.getTransformMatrices(w)),Ua.a.BindMorphTargetParameters(w,f._effect),w._processRendering(m,f._effect,J.fillMode,K,N,function(_,ca){return f._effect.setMatrix("world",ca)})}}}};this._depthMap.customRenderFunction=function(m,w,z,C){var J;if(C.length){for(g.setColorWrite(!1),J=0;J<C.length;J++)j(C.data[J]);g.setColorWrite(!0)}for(J=0;J<m.length;J++)j(m.data[J]);for(J=0;J<w.length;J++)j(w.data[J])}}return e.prototype.isReady=function(b,a){var c=b.getMaterial();if(c.disableDepthWrite)return!1;var d=[],f=[ra.b.PositionKind],g=b.getMesh();c&&c.needAlphaTesting()&&c.getAlphaTestTexture()&&(d.push("#define ALPHATEST"),g.isVerticesDataPresent(ra.b.UVKind)&&(f.push(ra.b.UVKind),d.push("#define UV1")),g.isVerticesDataPresent(ra.b.UV2Kind)&&(f.push(ra.b.UV2Kind),d.push("#define UV2"))),g.useBones&&g.computeBonesUsingShaders?(f.push(ra.b.MatricesIndicesKind),f.push(ra.b.MatricesWeightsKind),g.numBoneInfluencers>4&&(f.push(ra.b.MatricesIndicesExtraKind),f.push(ra.b.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+g.numBoneInfluencers),d.push("#define BonesPerMesh "+(g.skeleton?g.skeleton.bones.length+1:0))):d.push("#define NUM_BONE_INFLUENCERS 0");var h=g.morphTargetManager,j=0;h&&h.numInfluencers>0&&(j=h.numInfluencers,d.push("#define MORPHTARGETS"),d.push("#define NUM_MORPH_INFLUENCERS "+j),Ua.a.PrepareAttributesForMorphTargetsInfluencers(f,g,j)),a&&(d.push("#define INSTANCES"),Ua.a.PushAttributesForInstances(f)),this._storeNonLinearDepth&&d.push("#define NONLINEARDEPTH"),this.isPacked&&d.push("#define PACKED");var m=d.join(`
`);return this._cachedDefines!==m&&(this._cachedDefines=m,this._effect=this._scene.getEngine().createEffect("depth",f,["world","mBones","viewProjection","diffuseMatrix","depthValues","morphTargetInfluences"],["diffuseSampler"],m,void 0,void 0,void 0,{maxSimultaneousMorphTargets:j})),this._effect.isReady()},e.prototype.getDepthMap=function(){return this._depthMap},e.prototype.dispose=function(){this._depthMap.dispose()},e._SceneComponentInitialization=function(b){throw Gc.a.WarnImport("DepthRendererSceneComponent")},e}(),tn=`attribute vec2 vUV;
uniform sampler2D textureSampler;
#if defined(INITIAL)
uniform sampler2D sourceTexture;
uniform vec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*(texSize-1.0));
float f1=texelFetch(sourceTexture,coord,0).r;
float f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;
float f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;
float f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;
float minz=min(min(min(f1,f2),f3),f4);
#ifdef DEPTH_REDUX
float maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);
#else
float maxz=max(max(max(f1,f2),f3),f4);
#endif
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(MAIN)
uniform vec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*(texSize-1.0));
vec2 f1=texelFetch(textureSampler,coord,0).rg;
vec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;
vec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;
vec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;
float minz=min(min(min(f1.x,f2.x),f3.x),f4.x);
float maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(ONEBEFORELAST)
uniform ivec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*vec2(texSize-1));
vec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;
vec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;
vec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;
vec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;
float minz=min(f1.x,f2.x);
float maxz=max(f1.y,f2.y);
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(LAST)
void main(void)
{
discard;
glFragColor=vec4(0.);
}
#endif
`;Pa.a.ShadersStore.minmaxReduxPixelShader=tn;var dj=function(){function e(b){this.onAfterReductionPerformed=new I.c(),this._forceFullscreenViewport=!0,this._activated=!1,this._camera=b,this._postProcessManager=new mg.a(b.getScene())}return Object.defineProperty(e.prototype,"sourceTexture",{get:function(){return this._sourceTexture},enumerable:!0,configurable:!0}),e.prototype.setSourceTexture=function(b,a,c,d){var f=this;if(void 0===c&&(c=p.a.TEXTURETYPE_HALF_FLOAT),void 0===d&&(d=!0),b!==this._sourceTexture){this.dispose(!1),this._sourceTexture=b,this._reductionSteps=[],this._forceFullscreenViewport=d;var g=this._camera.getScene(),h=new gb("Initial reduction phase","minmaxRedux",["texSize"],["sourceTexture"],1,null,p.a.TEXTURE_NEAREST_NEAREST,g.getEngine(),!1,"#define INITIAL"+(a?`
#define DEPTH_REDUX`:""),c,void 0,void 0,void 0,p.a.TEXTUREFORMAT_RG);h.autoClear=!1,h.forceFullscreenViewport=d;var j=this._sourceTexture.getRenderWidth(),m=this._sourceTexture.getRenderHeight();h.onApply=function(C,J){return function(K){K.setTexture("sourceTexture",f._sourceTexture),K.setFloatArray2("texSize",new Float32Array([C,J]))}}(j,m),this._reductionSteps.push(h);for(var w=1;j>1||m>1;){j=Math.max(Math.round(j/2),1),m=Math.max(Math.round(m/2),1);var z=new gb("Reduction phase "+w,"minmaxRedux",["texSize"],null,{width:j,height:m},null,p.a.TEXTURE_NEAREST_NEAREST,g.getEngine(),!1,"#define "+(1==j&&1==m?"LAST":1==j||1==m?"ONEBEFORELAST":"MAIN"),c,void 0,void 0,void 0,p.a.TEXTUREFORMAT_RG);(z.autoClear=!1,z.forceFullscreenViewport=d,z.onApply=function(C,J){return function(K){1==C||1==J?K.setIntArray2("texSize",new Int32Array([C,J])):K.setFloatArray2("texSize",new Float32Array([C,J]))}}(j,m),this._reductionSteps.push(z),w++,1==j&&1==m)&&z.onAfterRenderObservable.add(function(C,J,K){var N=new Float32Array(4*C*J),T={min:0,max:0};return function(){g.getEngine()._readTexturePixels(K.inputTexture,C,J,-1,0,N),T.min=N[0],T.max=N[1],f.onAfterReductionPerformed.notifyObservers(T)}}(j,m,z))}}},Object.defineProperty(e.prototype,"refreshRate",{get:function(){return this._sourceTexture?this._sourceTexture.refreshRate:-1},set:function(b){this._sourceTexture&&(this._sourceTexture.refreshRate=b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activated",{get:function(){return this._activated},enumerable:!0,configurable:!0}),e.prototype.activate=function(){var b=this;!this._onAfterUnbindObserver&&this._sourceTexture&&(this._onAfterUnbindObserver=this._sourceTexture.onAfterUnbindObservable.add(function(){b._reductionSteps[0].activate(b._camera),b._postProcessManager.directRender(b._reductionSteps,b._reductionSteps[0].inputTexture,b._forceFullscreenViewport),b._camera.getScene().getEngine().unBindFramebuffer(b._reductionSteps[0].inputTexture,!1)}),this._activated=!0)},e.prototype.deactivate=function(){this._onAfterUnbindObserver&&this._sourceTexture&&(this._sourceTexture.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=null,this._activated=!1)},e.prototype.dispose=function(b){if(void 0===b&&(b=!0),b&&this.onAfterReductionPerformed.clear(),this.deactivate(),this._reductionSteps){for(var a=0;a<this._reductionSteps.length;++a)this._reductionSteps[a].dispose();this._reductionSteps=null}this._postProcessManager&&b&&this._postProcessManager.dispose(),this._sourceTexture=null},e}(),ej=function(e){function b(a){return e.call(this,a)||this}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"depthRenderer",{get:function(){return this._depthRenderer},enumerable:!0,configurable:!0}),b.prototype.setDepthRenderer=function(a,c,d){void 0===a&&(a=null),void 0===c&&(c=p.a.TEXTURETYPE_HALF_FLOAT),void 0===d&&(d=!0);var f=this._camera.getScene();this._depthRenderer&&(delete f._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null),null===a&&(f._depthRenderer||(f._depthRenderer={}),(a=this._depthRenderer=new sf(f,c,this._camera,!1)).enabled=!1,this._depthRendererId="minmax"+this._camera.id,f._depthRenderer[this._depthRendererId]=a),e.prototype.setSourceTexture.call(this,a.getDepthMap(),!0,c,d)},b.prototype.setSourceTexture=function(a,c,d,f){void 0===d&&(d=p.a.TEXTURETYPE_HALF_FLOAT),void 0===f&&(f=!0),e.prototype.setSourceTexture.call(this,a,c,d,f)},b.prototype.activate=function(){this._depthRenderer&&(this._depthRenderer.enabled=!0),e.prototype.activate.call(this)},b.prototype.deactivate=function(){e.prototype.deactivate.call(this),this._depthRenderer&&(this._depthRenderer.enabled=!1)},b.prototype.dispose=function(a){var c;void 0===a&&(a=!0),e.prototype.dispose.call(this,a),this._depthRenderer&&a&&(null===(c=this._depthRenderer.getDepthMap().getScene())||void 0===c||c._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null)},b}(dj),fj=i.e.Up(),un=i.e.Zero(),Ub=new i.e(),Sd=new i.e(),tf=new i.a(),Lg=function(e){function b(a,c,d){var f=e.call(this,a,c,d)||this;if(1==f._scene.getEngine().webGLVersion)throw"CSM can only be used in WebGL2";return f.usePercentageCloserFiltering=!0,f}return Object(l.d)(b,e),b.prototype._validateFilter=function(a){return a===lc.FILTER_NONE||a===lc.FILTER_PCF||a===lc.FILTER_PCSS?a:(console.error('Unsupported filter "'+a+'"!'),lc.FILTER_NONE)},Object.defineProperty(b.prototype,"numCascades",{get:function(){return this._numCascades},set:function(a){(a=Math.min(Math.max(a,b.MIN_CASCADES_COUNT),b.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=a,this.recreateShadowMap())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"freezeShadowCastersBoundingInfo",{get:function(){return this._freezeShadowCastersBoundingInfo},set:function(a){this._freezeShadowCastersBoundingInfoObservable&&a&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||a||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this))),this._freezeShadowCastersBoundingInfo=a,a&&this._computeShadowCastersBoundingInfo()},enumerable:!0,configurable:!0}),b.prototype._computeShadowCastersBoundingInfo=function(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._shadowMap&&this._shadowMap.renderList){for(var a=this._shadowMap.renderList,c=0;c<a.length;c++)if(g=a[c]){var d=g.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(d.minimumWorld),this._scbiMax.maximizeInPlace(d.maximumWorld)}var f=this._scene.meshes;for(c=0;c<f.length;c++){var g;(g=f[c])&&g.isVisible&&g.isEnabled&&g.receiveShadows&&(d=g.getBoundingInfo().boundingBox,this._scbiMin.minimizeInPlace(d.minimumWorld),this._scbiMax.maximizeInPlace(d.maximumWorld))}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)},Object.defineProperty(b.prototype,"shadowCastersBoundingInfo",{get:function(){return this._shadowCastersBoundingInfo},set:function(a){this._shadowCastersBoundingInfo=a},enumerable:!0,configurable:!0}),b.prototype.setMinMaxDistance=function(a,c){this._minDistance===a&&this._maxDistance===c||(a>c&&(a=0,c=1),a<0&&(a=0),c>1&&(c=1),this._minDistance=a,this._maxDistance=c,this._breaksAreDirty=!0)},Object.defineProperty(b.prototype,"minDistance",{get:function(){return this._minDistance},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maxDistance",{get:function(){return this._maxDistance},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return b.CLASSNAME},b.prototype.getCascadeMinExtents=function(a){return a>=0&&a<this._numCascades?this._cascadeMinExtents[a]:null},b.prototype.getCascadeMaxExtents=function(a){return a>=0&&a<this._numCascades?this._cascadeMaxExtents[a]:null},Object.defineProperty(b.prototype,"shadowMaxZ",{get:function(){return this._scene&&this._scene.activeCamera?this._shadowMaxZ:0},set:function(a){this._scene&&this._scene.activeCamera?this._shadowMaxZ===a||a<this._scene.activeCamera.minZ||a>this._scene.activeCamera.maxZ||(this._shadowMaxZ=a,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"debug",{get:function(){return this._debug},set:function(a){this._debug=a,this._light._markMeshesAsLightDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"depthClamp",{get:function(){return this._depthClamp},set:function(a){this._depthClamp=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cascadeBlendPercentage",{get:function(){return this._cascadeBlendPercentage},set:function(a){this._cascadeBlendPercentage=a,this._light._markMeshesAsLightDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lambda",{get:function(){return this._lambda},set:function(a){var c=Math.min(Math.max(a,0),1);this._lambda!=c&&(this._lambda=c,this._breaksAreDirty=!0)},enumerable:!0,configurable:!0}),b.prototype.getCascadeViewMatrix=function(a){return a>=0&&a<this._numCascades?this._viewMatrices[a]:null},b.prototype.getCascadeProjectionMatrix=function(a){return a>=0&&a<this._numCascades?this._projectionMatrices[a]:null},b.prototype.getCascadeTransformMatrix=function(a){return a>=0&&a<this._numCascades?this._transformMatrices[a]:null},b.prototype.setDepthRenderer=function(a){this._depthRenderer=a,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)},Object.defineProperty(b.prototype,"autoCalcDepthBounds",{get:function(){return this._autoCalcDepthBounds},set:function(a){var c=this,d=this._scene.activeCamera;if(d){if(this._autoCalcDepthBounds=a,!a)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new ej(d),this._depthReducer.onAfterReductionPerformed.add(function(f){var g=f.min,h=f.max;g>=h&&(g=0,h=1),g==c._minDistance&&h==c._maxDistance||c.setMinMaxDistance(g,h)}),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"autoCalcDepthBoundsRefreshRate",{get:function(){var a,c,d;return null!=(d=null===(c=null===(a=this._depthReducer)||void 0===a?void 0:a.depthRenderer)||void 0===c?void 0:c.getDepthMap().refreshRate)?d:-1},set:function(a){var c;(null===(c=this._depthReducer)||void 0===c?void 0:c.depthRenderer)&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=a)},enumerable:!0,configurable:!0}),b.prototype.splitFrustum=function(){this._breaksAreDirty=!0},b.prototype._splitFrustum=function(){var a=this._scene.activeCamera;if(a){for(var c=a.minZ,d=a.maxZ,f=d-c,g=this._minDistance,h=c+g*f,j=c+(this._shadowMaxZ<d&&this._shadowMaxZ>=c?Math.min((this._shadowMaxZ-c)/(d-c),this._maxDistance):this._maxDistance)*f,m=j-h,w=j/h,z=0;z<this._cascades.length;++z){var C=(z+1)/this._numCascades,J=h*Math.pow(w,C),K=h+m*C,N=this._lambda*(J-K)+K;this._cascades[z].prevBreakDistance=0===z?g:this._cascades[z-1].breakDistance,this._cascades[z].breakDistance=(N-c)/f,this._viewSpaceFrustumsZ[z]=c+this._cascades[z].breakDistance*f,this._frustumLengths[z]=(this._cascades[z].breakDistance-this._cascades[z].prevBreakDistance)*f}this._breaksAreDirty=!1}},b.prototype._computeMatrices=function(){if(this._scene.activeCamera){i.e.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),1===Math.abs(i.e.Dot(this._lightDirection,i.e.Up()))&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);for(var a=0;a<this._numCascades;++a){this._computeFrustumInWorldSpace(a),this._computeCascadeFrustum(a),this._cascadeMaxExtents[a].subtractToRef(this._cascadeMinExtents[a],Ub),this._frustumCenter[a].addToRef(this._lightDirection.scale(this._cascadeMinExtents[a].z),this._shadowCameraPos[a]),i.a.LookAtLHToRef(this._shadowCameraPos[a],this._frustumCenter[a],fj,this._viewMatrices[a]);var c=0,d=Ub.z,f=this._shadowCastersBoundingInfo;f.update(this._viewMatrices[a]),d=Math.min(d,f.boundingBox.maximumWorld.z),c=this._depthClamp&&this.filter!==lc.FILTER_PCSS?Math.max(c,f.boundingBox.minimumWorld.z):Math.min(c,f.boundingBox.minimumWorld.z),i.a.OrthoOffCenterLHToRef(this._cascadeMinExtents[a].x,this._cascadeMaxExtents[a].x,this._cascadeMinExtents[a].y,this._cascadeMaxExtents[a].y,c,d,this._projectionMatrices[a]),this._cascadeMinExtents[a].z=c,this._cascadeMaxExtents[a].z=d,this._viewMatrices[a].multiplyToRef(this._projectionMatrices[a],this._transformMatrices[a]),i.e.TransformCoordinatesToRef(un,this._transformMatrices[a],Ub),Ub.scaleInPlace(this._mapSize/2),Sd.copyFromFloats(Math.round(Ub.x),Math.round(Ub.y),Math.round(Ub.z)),Sd.subtractInPlace(Ub).scaleInPlace(2/this._mapSize),i.a.TranslationToRef(Sd.x,Sd.y,0,tf),this._projectionMatrices[a].multiplyToRef(tf,this._projectionMatrices[a]),this._viewMatrices[a].multiplyToRef(this._projectionMatrices[a],this._transformMatrices[a]),this._transformMatrices[a].copyToArray(this._transformMatricesAsArray,16*a)}}},b.prototype._computeFrustumInWorldSpace=function(a){if(this._scene.activeCamera){var c=this._cascades[a].prevBreakDistance,d=this._cascades[a].breakDistance;this._scene.activeCamera.getViewMatrix();for(var f=i.a.Invert(this._scene.activeCamera.getTransformationMatrix()),g=0;g<b.frustumCornersNDCSpace.length;++g)i.e.TransformCoordinatesToRef(b.frustumCornersNDCSpace[g],f,this._frustumCornersWorldSpace[a][g]);for(g=0;g<b.frustumCornersNDCSpace.length/2;++g)Ub.copyFrom(this._frustumCornersWorldSpace[a][g+4]).subtractInPlace(this._frustumCornersWorldSpace[a][g]),Sd.copyFrom(Ub).scaleInPlace(c),Ub.scaleInPlace(d),Ub.addInPlace(this._frustumCornersWorldSpace[a][g]),this._frustumCornersWorldSpace[a][g+4].copyFrom(Ub),this._frustumCornersWorldSpace[a][g].addInPlace(Sd)}},b.prototype._computeCascadeFrustum=function(a){if(this._cascadeMinExtents[a].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[a].copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._frustumCenter[a].copyFromFloats(0,0,0),this._scene.activeCamera){for(var c=0;c<this._frustumCornersWorldSpace[a].length;++c)this._frustumCenter[a].addInPlace(this._frustumCornersWorldSpace[a][c]);if(this._frustumCenter[a].scaleInPlace(1/this._frustumCornersWorldSpace[a].length),this.stabilizeCascades){var d=0;for(c=0;c<this._frustumCornersWorldSpace[a].length;++c){var f=this._frustumCornersWorldSpace[a][c].subtractToRef(this._frustumCenter[a],Ub).length();d=Math.max(d,f)}d=Math.ceil(16*d)/16,this._cascadeMaxExtents[a].copyFromFloats(d,d,d),this._cascadeMinExtents[a].copyFromFloats(-d,-d,-d)}else{var g=this._frustumCenter[a];for(this._frustumCenter[a].addToRef(this._lightDirection,Ub),i.a.LookAtLHToRef(g,Ub,fj,tf),c=0;c<this._frustumCornersWorldSpace[a].length;++c)i.e.TransformCoordinatesToRef(this._frustumCornersWorldSpace[a][c],tf,Ub),this._cascadeMinExtents[a].minimizeInPlace(Ub),this._cascadeMaxExtents[a].maximizeInPlace(Ub)}}},b.prototype._initializeGenerator=function(){var a,c,d,f,g,h,j,m,w,z,C,J,K,N,T,Z,_,ca,ea,fa;this.penumbraDarkness=null!=(a=this.penumbraDarkness)?a:1,this._numCascades=null!=(c=this._numCascades)?c:b.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=null!=(d=this.stabilizeCascades)&&d,this._freezeShadowCastersBoundingInfoObservable=null!=(f=this._freezeShadowCastersBoundingInfoObservable)?f:null,this.freezeShadowCastersBoundingInfo=null!=(g=this.freezeShadowCastersBoundingInfo)&&g,this._scbiMin=null!=(h=this._scbiMin)?h:new i.e(0,0,0),this._scbiMax=null!=(j=this._scbiMax)?j:new i.e(0,0,0),this._shadowCastersBoundingInfo=null!=(m=this._shadowCastersBoundingInfo)?m:new Kc.a(new i.e(0,0,0),new i.e(0,0,0)),this._breaksAreDirty=null==(w=this._breaksAreDirty)||w,this._minDistance=null!=(z=this._minDistance)?z:0,this._maxDistance=null!=(C=this._maxDistance)?C:1,this._currentLayer=null!=(J=this._currentLayer)?J:0,this._shadowMaxZ=null!=(T=null!=(K=this._shadowMaxZ)?K:null===(N=this._scene.activeCamera)||void 0===N?void 0:N.maxZ)?T:10000,this._debug=null!=(Z=this._debug)&&Z,this._depthClamp=null==(_=this._depthClamp)||_,this._cascadeBlendPercentage=null!=(ca=this._cascadeBlendPercentage)?ca:.1,this._lambda=null!=(ea=this._lambda)?ea:.5,this._autoCalcDepthBounds=null!=(fa=this._autoCalcDepthBounds)&&fa,e.prototype._initializeGenerator.call(this)},b.prototype._createTargetRenderTexture=function(){var a={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new Jb(this._light.name+"_shadowMap",a,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0),this._shadowMap.createDepthStencilTexture(p.a.LESS,!0)},b.prototype._initializeShadowMap=function(){var a=this;if(e.prototype._initializeShadowMap.call(this),null!==this._shadowMap){this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(var c=0;c<this._numCascades;++c){this._cascades[c]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[c]=i.a.Zero(),this._projectionMatrices[c]=i.a.Zero(),this._transformMatrices[c]=i.a.Zero(),this._cascadeMinExtents[c]=new i.e(),this._cascadeMaxExtents[c]=new i.e(),this._frustumCenter[c]=new i.e(),this._shadowCameraPos[c]=new i.e(),this._frustumCornersWorldSpace[c]=new Array(b.frustumCornersNDCSpace.length);for(var d=0;d<b.frustumCornersNDCSpace.length;++d)this._frustumCornersWorldSpace[c][d]=new i.e()}this._shadowMap.onBeforeRenderObservable.add(function(f){a._currentLayer=f}),this._shadowMap.onBeforeBindObservable.add(function(){a._breaksAreDirty&&a._splitFrustum(),a._computeMatrices()}),this._splitFrustum()}},b.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(a,c){c.setMatrix("viewProjection",this.getCascadeTransformMatrix(this._currentLayer))},b.prototype._isReadyCustomDefines=function(a,c,d){this._depthClamp&&this._filter!==lc.FILTER_PCSS&&a.push("#define DEPTHCLAMP")},b.prototype.prepareDefines=function(a,c){e.prototype.prepareDefines.call(this,a,c);var d=this._scene,f=this._light;if(d.shadowsEnabled&&f.shadowEnabled){a["SHADOWCSM"+c]=!0,a["SHADOWCSMDEBUG"+c]=this.debug,a["SHADOWCSMNUM_CASCADES"+c]=this.numCascades,a["SHADOWCSM_RIGHTHANDED"+c]=d.useRightHandedSystem;var g=d.activeCamera;g&&this._shadowMaxZ<g.maxZ&&(a["SHADOWCSMUSESHADOWMAXZ"+c]=!0),0===this.cascadeBlendPercentage&&(a["SHADOWCSMNOBLEND"+c]=!0)}},b.prototype.bindShadowLight=function(a,c){var d=this._light,f=this._scene;if(f.shadowsEnabled&&d.shadowEnabled){var g=f.activeCamera;if(g){var h=this.getShadowMap();if(h){var j=h.getSize().width;if(c.setMatrices("lightMatrix"+a,this._transformMatricesAsArray),c.setArray("viewFrustumZ"+a,this._viewSpaceFrustumsZ),c.setFloat("cascadeBlendFactor"+a,0===this.cascadeBlendPercentage?10000:1/this.cascadeBlendPercentage),c.setArray("frustumLengths"+a,this._frustumLengths),this._filter===lc.FILTER_PCF)c.setDepthStencilTexture("shadowSampler"+a,h),d._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),j,1/j,this.frustumEdgeFalloff,a);else if(this._filter===lc.FILTER_PCSS){for(var m=0;m<this._numCascades;++m)this._lightSizeUVCorrection[2*m+0]=0===m?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[m].x-this._cascadeMinExtents[m].x),this._lightSizeUVCorrection[2*m+1]=0===m?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[m].y-this._cascadeMinExtents[m].y),this._depthCorrection[m]=0===m?1:(this._cascadeMaxExtents[m].z-this._cascadeMinExtents[m].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);c.setDepthStencilTexture("shadowSampler"+a,h),c.setTexture("depthSampler"+a,h),c.setArray2("lightSizeUVCorrection"+a,this._lightSizeUVCorrection),c.setArray("depthCorrection"+a,this._depthCorrection),c.setFloat("penumbraDarkness"+a,this.penumbraDarkness),d._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/j,this._contactHardeningLightSizeUVRatio*j,this.frustumEdgeFalloff,a)}else c.setTexture("shadowSampler"+a,h),d._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),j,1/j,this.frustumEdgeFalloff,a);d._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(g),this.getLight().getDepthMinZ(g)+this.getLight().getDepthMaxZ(g),a)}}}},b.prototype.getTransformMatrix=function(){return this.getCascadeTransformMatrix(0)},b.prototype.dispose=function(){e.prototype.dispose.call(this),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this),c=this.getShadowMap();if(!c)return a;if(a.numCascades=this._numCascades,a.debug=this._debug,a.stabilizeCascades=this.stabilizeCascades,a.lambda=this._lambda,a.cascadeBlendPercentage=this.cascadeBlendPercentage,a.depthClamp=this._depthClamp,a.autoCalcDepthBounds=this.autoCalcDepthBounds,a.shadowMaxZ=this._shadowMaxZ,a.penumbraDarkness=this.penumbraDarkness,a.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,a.minDistance=this.minDistance,a.maxDistance=this.maxDistance,a.renderList=[],c.renderList)for(var d=0;d<c.renderList.length;d++){var f=c.renderList[d];a.renderList.push(f.id)}return a},b.Parse=function(a,c){var d=lc.Parse(a,c,function(f,g){return new b(f,g)});return void 0!==a.numCascades&&(d.numCascades=a.numCascades),void 0!==a.debug&&(d.debug=a.debug),void 0!==a.stabilizeCascades&&(d.stabilizeCascades=a.stabilizeCascades),void 0!==a.lambda&&(d.lambda=a.lambda),void 0!==a.cascadeBlendPercentage&&(d.cascadeBlendPercentage=a.cascadeBlendPercentage),void 0!==a.depthClamp&&(d.depthClamp=a.depthClamp),void 0!==a.autoCalcDepthBounds&&(d.autoCalcDepthBounds=a.autoCalcDepthBounds),void 0!==a.shadowMaxZ&&(d.shadowMaxZ=a.shadowMaxZ),void 0!==a.penumbraDarkness&&(d.penumbraDarkness=a.penumbraDarkness),void 0!==a.freezeShadowCastersBoundingInfo&&(d.freezeShadowCastersBoundingInfo=a.freezeShadowCastersBoundingInfo),void 0!==a.minDistance&&void 0!==a.maxDistance&&d.setMinMaxDistance(a.minDistance,a.maxDistance),d},b.frustumCornersNDCSpace=[new i.e(-1,1,-1),new i.e(1,1,-1),new i.e(1,-1,-1),new i.e(-1,-1,-1),new i.e(-1,1,1),new i.e(1,1,1),new i.e(1,-1,1),new i.e(-1,-1,1)],b.CLASSNAME="CascadedShadowGenerator",b.DEFAULT_CASCADES_COUNT=4,b.MIN_CASCADES_COUNT=2,b.MAX_CASCADES_COUNT=4,b._SceneComponentInitialization=function(a){throw Gc.a.WarnImport("ShadowGeneratorSceneComponent")},b}(lc);R.a.AddParser(_a.a.NAME_SHADOWGENERATOR,function(e,b){if(void 0!==e.shadowGenerators&&null!==e.shadowGenerators)for(var a=0,c=e.shadowGenerators.length;a<c;a++){var d=e.shadowGenerators[a];d.className===Lg.CLASSNAME?Lg.Parse(d,b):lc.Parse(d,b)}});var gj=function(){function e(b){this.name=_a.a.NAME_SHADOWGENERATOR,this.scene=b}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(_a.a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.serialize=function(b){b.shadowGenerators=[];for(var a=0,c=this.scene.lights;a<c.length;a++){var d=c[a].getShadowGenerator();d&&b.shadowGenerators.push(d.serialize())}},e.prototype.addFromContainer=function(b){},e.prototype.removeFromContainer=function(b,a){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(b){var a=this.scene;if(this.scene.shadowsEnabled)for(var c=0;c<a.lights.length;c++){var d=a.lights[c],f=d.getShadowGenerator();if(d.isEnabled()&&d.shadowEnabled&&f){var g=f.getShadowMap();-1!==a.textures.indexOf(g)&&b.push(g)}}},e}();lc._SceneComponentInitialization=function(e){var b=e._getComponent(_a.a.NAME_SHADOWGENERATOR);b||(b=new gj(e),e._addComponent(b))},ia.a.AddNodeConstructor("Light_Type_0",function(e,b){return function(){return new Mg(e,i.e.Zero(),b)}});var Mg=function(e){function b(a,c,d){var f=e.call(this,a,d)||this;return f._shadowAngle=Math.PI/2,f.position=c,f}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(a){this._shadowAngle=a,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"direction",{get:function(){return this._direction},set:function(a){var c=this.needCube();this._direction=a,this.needCube()!==c&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"PointLight"},b.prototype.getTypeID=function(){return Zc.a.LIGHTTYPEID_POINTLIGHT},b.prototype.needCube=function(){return!this.direction},b.prototype.getShadowDirection=function(a){if(this.direction)return e.prototype.getShadowDirection.call(this,a);switch(a){case 0:return new i.e(1,0,0);case 1:return new i.e(-1,0,0);case 2:return new i.e(0,-1,0);case 3:return new i.e(0,1,0);case 4:return new i.e(0,0,1);case 5:return new i.e(0,0,-1)}return i.e.Zero()},b.prototype._setDefaultShadowProjectionMatrix=function(a,c,d){var f=this.getScene().activeCamera;f&&i.a.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(f),this.getDepthMaxZ(f),a)},b.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},b.prototype.transferToEffect=function(a,c){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,c):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,c),this},b.prototype.transferToNodeMaterialEffect=function(a,c){return this.computeTransformedInformation()?a.setFloat3(c,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):a.setFloat3(c,this.position.x,this.position.y,this.position.z),this},b.prototype.prepareLightSpecificDefines=function(a,c){a["POINTLIGHT"+c]=!0},Object(l.c)([Object(F.c)()],b.prototype,"shadowAngle",null),b}(kf),hj=function(){function e(b,a,c){var d=this;void 0===a&&(a=""),void 0===c&&(c="black"),this._renderingCanvas=b,this._loadingText=a,this._loadingDivBackgroundColor=c,this._resizeLoadingUI=function(){var f=d._renderingCanvas.getBoundingClientRect(),g=window.getComputedStyle(d._renderingCanvas).position;d._loadingDiv&&(d._loadingDiv.style.position="fixed"===g?"fixed":"absolute",d._loadingDiv.style.left=f.left+"px",d._loadingDiv.style.top=f.top+"px",d._loadingDiv.style.width=f.width+"px",d._loadingDiv.style.height=f.height+"px")}}return e.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var b=document.createElement("style");b.type="text/css",b.innerHTML=`@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}
                    100% { -webkit-transform: rotate(360deg);}
                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}
                    100% { transform: rotate(360deg);}
                }`,document.getElementsByTagName("head")[0].appendChild(b);var a=!!window.SVGSVGElement,c=new Image();e.DefaultLogoUrl?c.src=e.DefaultLogoUrl:c.src=a?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+":"https://cdn.babylonjs.com/Assets/babylonLogo.png",c.style.position="absolute",c.style.left="40%",c.style.top="40%",c.style.width="20%",c.style.height="20%";var d=new Image();if(e.DefaultSpinnerUrl?d.src=e.DefaultSpinnerUrl:d.src=a?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==":"https://cdn.babylonjs.com/Assets/loadingIcon.png",d.style.position="absolute",d.style.left="30%",d.style.top="30%",d.style.width="40%",d.style.height="40%",d.style.animation="spin1 0.75s infinite linear",d.style.webkitAnimation="spin1 0.75s infinite linear",d.style.transformOrigin="50% 50%",d.style.webkitTransformOrigin="50% 50%",!a){var f={w:16,h:18.5},g={w:30,h:30};c.style.width=f.w+"vh",c.style.height=f.h+"vh",c.style.left="calc(50% - "+f.w/2+"vh)",c.style.top="calc(50% - "+f.h/2+"vh)",d.style.width=g.w+"vh",d.style.height=g.h+"vh",d.style.left="calc(50% - "+g.w/2+"vh)",d.style.top="calc(50% - "+g.h/2+"vh)"}this._loadingDiv.appendChild(c),this._loadingDiv.appendChild(d),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},e.prototype.hideLoadingUI=function(){var b=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){b._loadingDiv&&(b._loadingDiv.parentElement&&b._loadingDiv.parentElement.removeChild(b._loadingDiv),window.removeEventListener("resize",b._resizeLoadingUI),b._loadingDiv=null)}))},Object.defineProperty(e.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(b){this._loadingText=b,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(b){this._loadingDivBackgroundColor=b,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),e.DefaultLogoUrl="",e.DefaultSpinnerUrl="",e}();Ha.a.DefaultLoadingScreenFactory=function(e){return new hj(e)};var Ng=o(69),Td=o(71),Og=function(){function e(){}return e.ConvertPanoramaToCubemap=function(b,a,c,d){if(!b)throw"ConvertPanoramaToCubemap: input cannot be null";if(b.length!=a*c*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(d,this.FACE_FRONT,b,a,c),back:this.CreateCubemapTexture(d,this.FACE_BACK,b,a,c),left:this.CreateCubemapTexture(d,this.FACE_LEFT,b,a,c),right:this.CreateCubemapTexture(d,this.FACE_RIGHT,b,a,c),up:this.CreateCubemapTexture(d,this.FACE_UP,b,a,c),down:this.CreateCubemapTexture(d,this.FACE_DOWN,b,a,c),size:d,type:p.a.TEXTURETYPE_FLOAT,format:p.a.TEXTUREFORMAT_RGB,gammaSpace:!1}},e.CreateCubemapTexture=function(b,a,c,d,f){for(var g=new ArrayBuffer(b*b*4*3),h=new Float32Array(g),j=a[1].subtract(a[0]).scale(1/b),m=a[3].subtract(a[2]).scale(1/b),w=1/b,z=0,C=0;C<b;C++){for(var J=a[0],K=a[2],N=0;N<b;N++){var T=K.subtract(J).scale(z).add(J);T.normalize();var Z=this.CalcProjectionSpherical(T,c,d,f);h[C*b*3+3*N+0]=Z.r,h[C*b*3+3*N+1]=Z.g,h[C*b*3+3*N+2]=Z.b,J=J.add(j),K=K.add(m)}z+=w}return h},e.CalcProjectionSpherical=function(b,a,c,d){for(var f=Math.atan2(b.z,b.x),g=Math.acos(b.y);f<-Math.PI;)f+=2*Math.PI;for(;f>Math.PI;)f-=2*Math.PI;var h=f/Math.PI,j=g/Math.PI;h=.5*h+.5;var m=Math.round(h*c);m<0?m=0:m>=c&&(m=c-1);var w=Math.round(j*d);w<0?w=0:w>=d&&(w=d-1);var z=d-w-1;return{r:a[z*c*3+3*m+0],g:a[z*c*3+3*m+1],b:a[z*c*3+3*m+2]}},e.FACE_FRONT=[new i.e(-1,-1,-1),new i.e(1,-1,-1),new i.e(-1,1,-1),new i.e(1,1,-1)],e.FACE_BACK=[new i.e(1,-1,1),new i.e(-1,-1,1),new i.e(1,1,1),new i.e(-1,1,1)],e.FACE_RIGHT=[new i.e(1,-1,-1),new i.e(1,-1,1),new i.e(1,1,-1),new i.e(1,1,1)],e.FACE_LEFT=[new i.e(-1,-1,1),new i.e(-1,-1,-1),new i.e(-1,1,1),new i.e(-1,1,-1)],e.FACE_DOWN=[new i.e(-1,1,-1),new i.e(1,1,-1),new i.e(-1,1,1),new i.e(1,1,1)],e.FACE_UP=[new i.e(-1,-1,1),new i.e(1,-1,1),new i.e(-1,-1,-1),new i.e(1,-1,-1)],e}(),ij=function(){function e(){}return e.Ldexp=function(b,a){return a>1023?b*Math.pow(2,1023)*Math.pow(2,a-1023):a<-1074?b*Math.pow(2,-1074)*Math.pow(2,a+1074):b*Math.pow(2,a)},e.Rgbe2float=function(b,a,c,d,f,g){f>0?(f=this.Ldexp(1,f-136),b[g+0]=a*f,b[g+1]=c*f,b[g+2]=d*f):(b[g+0]=0,b[g+1]=0,b[g+2]=0)},e.readStringLine=function(b,a){for(var c="",d="",f=a;f<b.length-a&&`
`!=(d=String.fromCharCode(b[f]));f++)c+=d;return c},e.RGBE_ReadHeader=function(b){var a,c,d=this.readStringLine(b,0);if("#"!=d[0]||"?"!=d[1])throw"Bad HDR Format.";var f=!1,g=!1,h=0;do h+=d.length+1,"FORMAT=32-bit_rle_rgbe"==(d=this.readStringLine(b,h))?g=!0:0==d.length&&(f=!0);while(!f);if(!g)throw"HDR Bad header format, unsupported FORMAT";h+=d.length+1,d=this.readStringLine(b,h);var j=/^\-Y (.*) \+X (.*)$/g.exec(d);if(!j||j.length<3)throw"HDR Bad header format, no size";if(c=parseInt(j[2]),a=parseInt(j[1]),c<8||c>32767)throw"HDR Bad header format, unsupported size";return{height:a,width:c,dataPosition:h+=d.length+1}},e.GetCubeMapTextureData=function(b,a){var c=new Uint8Array(b),d=this.RGBE_ReadHeader(c),f=this.RGBE_ReadPixels_RLE(c,d);return Og.ConvertPanoramaToCubemap(f,d.width,d.height,a)},e.RGBE_ReadPixels=function(b,a){return this.RGBE_ReadPixels_RLE(b,a)},e.RGBE_ReadPixels_RLE=function(b,a){for(var c,d,f,g,h,j=a.height,m=a.width,w=a.dataPosition,z=0,C=0,J=0,K=new ArrayBuffer(4*m),N=new Uint8Array(K),T=new ArrayBuffer(a.width*a.height*4*3),Z=new Float32Array(T);j>0;){if(c=b[w++],d=b[w++],f=b[w++],g=b[w++],2!=c||2!=d||128&f)throw"HDR Bad header format, not RLE";if((f<<8|g)!=m)throw"HDR Bad header format, wrong scan line width";for(z=0,J=0;J<4;J++)for(C=(J+1)*m;z<C;)if(c=b[w++],d=b[w++],c>128){if(0==(h=c-128)||h>C-z)throw"HDR Bad Format, bad scanline data (run)";for(;h-- >0;)N[z++]=d}else{if(0==(h=c)||h>C-z)throw"HDR Bad Format, bad scanline data (non-run)";if(N[z++]=d,--h>0)for(var _=0;_<h;_++)N[z++]=b[w++]}for(J=0;J<m;J++)c=N[J],d=N[J+m],f=N[J+2*m],g=N[J+3*m],this.Rgbe2float(Z,c,d,f,g,(a.height-j)*m*3+3*J);j--}return Z},e}(),Ee=function(e){function b(a,c,d,f,g,h,j,m,w){void 0===f&&(f=!1),void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===j&&(j=!1),void 0===m&&(m=null),void 0===w&&(w=null);var z=e.call(this,c)||this;return z._generateHarmonics=!0,z._onLoad=null,z._onError=null,z.coordinatesMode=ya.a.CUBIC_MODE,z._isBlocking=!0,z._rotationY=0,z.boundingBoxPosition=i.e.Zero(),a?(z.name=a,z.url=a,z.hasAlpha=!1,z.isCube=!0,z._textureMatrix=i.a.Identity(),z._onLoad=m,z._onError=w,z.gammaSpace=h,z._noMipmap=f,z._size=d,z._generateHarmonics=g,z._texture=z._getFromCache(a,z._noMipmap),z._texture?m&&(z._texture.isReady?Qa.b.SetImmediate(function(){return m()}):z._texture.onLoadedObservable.add(m)):c.useDelayedTextureLoading?z.delayLoadState=p.a.DELAYLOADSTATE_NOTLOADED:z.loadTexture(),z):z}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(a){this._isBlocking=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotationY",{get:function(){return this._rotationY},set:function(a){this._rotationY=a,this.setReflectionTextureMatrix(i.a.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(a){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(a)){this._boundingBoxSize=a;var c=this.getScene();c&&c.markAllMaterialsAsDirty(p.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"HDRCubeTexture"},b.prototype.loadTexture=function(){var a=this,c=this.getScene();c&&(this._texture=c.getEngine().createRawCubeTextureFromUrl(this.url,c,this._size,p.a.TEXTUREFORMAT_RGB,c.getEngine().getCaps().textureFloat?p.a.TEXTURETYPE_FLOAT:p.a.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(d){a.lodGenerationOffset=0,a.lodGenerationScale=.8;var f=a.getScene();if(!f)return null;var g=ij.GetCubeMapTextureData(d,a._size);if(a._generateHarmonics){var h=cf.ConvertCubeMapToSphericalPolynomial(g);a.sphericalPolynomial=h}for(var j=[],m=null,w=0;w<6;w++){if(!f.getEngine().getCaps().textureFloat){var z=new ArrayBuffer(a._size*a._size*3);m=new Uint8Array(z)}var C=g[b._facesMapping[w]];if(a.gammaSpace||m){for(var J=0;J<a._size*a._size;J++)if(a.gammaSpace&&(C[3*J+0]=Math.pow(C[3*J+0],kb.b),C[3*J+1]=Math.pow(C[3*J+1],kb.b),C[3*J+2]=Math.pow(C[3*J+2],kb.b)),m){var K=Math.max(255*C[3*J+0],0),N=Math.max(255*C[3*J+1],0),T=Math.max(255*C[3*J+2],0),Z=Math.max(Math.max(K,N),T);if(Z>255){var _=255/Z;K*=_,N*=_,T*=_}m[3*J+0]=K,m[3*J+1]=N,m[3*J+2]=T}}m?j.push(m):j.push(C)}return j},null,this._onLoad,this._onError))},b.prototype.clone=function(){var a=this.getScene();if(!a)return this;var c=new b(this.url,a,this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return c.level=this.level,c.wrapU=this.wrapU,c.wrapV=this.wrapV,c.coordinatesIndex=this.coordinatesIndex,c.coordinatesMode=this.coordinatesMode,c},b.prototype.delayLoad=function(){this.delayLoadState===p.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=p.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},b.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},b.prototype.setReflectionTextureMatrix=function(a){var c=this;this._textureMatrix=a,a.updateFlag!==this._textureMatrix.updateFlag&&a.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(p.a.MATERIAL_TextureDirtyFlag,function(d){return-1!==d.getActiveTextures().indexOf(c)})},b.Parse=function(a,c,d){var f=null;return a.name&&!a.isRenderTarget&&((f=new b(d+a.name,c,a.size,a.noMipmap,a.generateHarmonics,a.useInGammaSpace)).name=a.name,f.hasAlpha=a.hasAlpha,f.level=a.level,f.coordinatesMode=a.coordinatesMode,f.isBlocking=a.isBlocking),f&&(a.boundingBoxPosition&&(f.boundingBoxPosition=i.e.FromArray(a.boundingBoxPosition)),a.boundingBoxSize&&(f.boundingBoxSize=i.e.FromArray(a.boundingBoxSize)),a.rotationY&&(f.rotationY=a.rotationY)),f},b.prototype.serialize=function(){if(!this.name)return null;var a={};return a.name=this.name,a.hasAlpha=this.hasAlpha,a.isCube=!0,a.level=this.level,a.size=this._size,a.coordinatesMode=this.coordinatesMode,a.useInGammaSpace=this.gammaSpace,a.generateHarmonics=this._generateHarmonics,a.customType="BABYLON.HDRCubeTexture",a.noMipmap=this._noMipmap,a.isBlocking=this._isBlocking,a.rotationY=this._rotationY,a},b._facesMapping=["right","left","up","down","front","back"],b}(hc.a);D.a.RegisteredTypes["BABYLON.HDRCubeTexture"]=Ee;var jj=function(){function e(b,a,c){void 0===a&&(a=0),void 0===c&&(c=null),this.name=b,this.animations=new Array(),this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new I.c(),this._onDataLayoutChanged=new I.c(),this._animationPropertiesOverride=null,this._scene=c||U.a.LastCreatedScene,this.influence=a,this._scene&&(this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(e.prototype,"influence",{get:function(){return this._influence},set:function(b){if(this._influence!==b){var a=this._influence;this._influence=b,this.onInfluenceChanged.hasObservers&&this.onInfluenceChanged.notifyObservers(0===a||0===b)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(b){this._animationPropertiesOverride=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!0,configurable:!0}),e.prototype.setPositions=function(b){var a=this.hasPositions;this._positions=b,a!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getPositions=function(){return this._positions},e.prototype.setNormals=function(b){var a=this.hasNormals;this._normals=b,a!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getNormals=function(){return this._normals},e.prototype.setTangents=function(b){var a=this.hasTangents;this._tangents=b,a!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getTangents=function(){return this._tangents},e.prototype.setUVs=function(b){var a=this.hasUVs;this._uvs=b,a!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getUVs=function(){return this._uvs},e.prototype.clone=function(){var b=this,a=F.a.Clone(function(){return new e(b.name,b.influence,b._scene)},this);return a._positions=this._positions,a._normals=this._normals,a._tangents=this._tangents,a._uvs=this._uvs,a},e.prototype.serialize=function(){var b={};return b.name=this.name,b.influence=this.influence,b.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(b.id=this.id),this.hasNormals&&(b.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(b.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(b.uvs=Array.prototype.slice.call(this.getUVs())),F.a.AppendSerializedAnimations(this,b),b},e.prototype.getClassName=function(){return"MorphTarget"},e.Parse=function(b){var a=new e(b.name,b.influence);if(a.setPositions(b.positions),null!=b.id&&(a.id=b.id),b.normals&&a.setNormals(b.normals),b.tangents&&a.setTangents(b.tangents),b.uvs&&a.setUVs(b.uvs),b.animations)for(var c=0;c<b.animations.length;c++){var d=b.animations[c],f=D.a.GetClass("BABYLON.Animation");f&&a.animations.push(f.Parse(d))}return a},e.FromMesh=function(b,a,c){a||(a=b.name);var d=new e(a,c,b.getScene());return d.setPositions(b.getVerticesData(ra.b.PositionKind)),b.isVerticesDataPresent(ra.b.NormalKind)&&d.setNormals(b.getVerticesData(ra.b.NormalKind)),b.isVerticesDataPresent(ra.b.TangentKind)&&d.setTangents(b.getVerticesData(ra.b.TangentKind)),b.isVerticesDataPresent(ra.b.UVKind)&&d.setUVs(b.getVerticesData(ra.b.UVKind)),d},Object(l.c)([Object(F.c)()],e.prototype,"id",void 0),e}(),Pg=function(){function e(b){void 0===b&&(b=null),this._targets=new Array(),this._targetInfluenceChangedObservers=new Array(),this._targetDataLayoutChangedObservers=new Array(),this._activeTargets=new Ic.a(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array(),this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,b||(b=U.a.LastCreatedScene),this._scene=b,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&this.enableNormalMorphing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"influences",{get:function(){return this._influences},enumerable:!0,configurable:!0}),e.prototype.getActiveTarget=function(b){return this._activeTargets.data[b]},e.prototype.getTarget=function(b){return this._targets[b]},e.prototype.addTarget=function(b){var a=this;this._targets.push(b),this._targetInfluenceChangedObservers.push(b.onInfluenceChanged.add(function(c){a._syncActiveTargets(c)})),this._targetDataLayoutChangedObservers.push(b._onDataLayoutChanged.add(function(){a._syncActiveTargets(!0)})),this._syncActiveTargets(!0)},e.prototype.removeTarget=function(b){var a=this._targets.indexOf(b);a>=0&&(this._targets.splice(a,1),b.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(a,1)[0]),b._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(a,1)[0]),this._syncActiveTargets(!0))},e.prototype.clone=function(){for(var b=new e(this._scene),a=0,c=this._targets;a<c.length;a++){var d=c[a];b.addTarget(d.clone())}return b.enableNormalMorphing=this.enableNormalMorphing,b.enableTangentMorphing=this.enableTangentMorphing,b.enableUVMorphing=this.enableUVMorphing,b},e.prototype.serialize=function(){var b={};b.id=this.uniqueId,b.targets=[];for(var a=0,c=this._targets;a<c.length;a++){var d=c[a];b.targets.push(d.serialize())}return b},e.prototype._syncActiveTargets=function(b){var a=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0;for(var c=0,d=this._targets;c<d.length;c++){var f=d[c];if(0!==f.influence){this._activeTargets.push(f),this._tempInfluences[a++]=f.influence,this._supportsNormals=this._supportsNormals&&f.hasNormals,this._supportsTangents=this._supportsTangents&&f.hasTangents,this._supportsUVs=this._supportsUVs&&f.hasUVs;var g=f.getPositions();if(g){var h=g.length/3;if(0===this._vertexCount)this._vertexCount=h;else if(this._vertexCount!==h)return void k.a.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===a||(this._influences=new Float32Array(a));for(var j=0;j<a;j++)this._influences[j]=this._tempInfluences[j];b&&this.synchronize()},e.prototype.synchronize=function(){if(this._scene)for(var b=0,a=this._scene.meshes;b<a.length;b++){var c=a[b];c.morphTargetManager===this&&c._syncGeometryWithMorphTargetManager()}},e.Parse=function(b,a){var c=new e(a);c._uniqueId=b.id;for(var d=0,f=b.targets;d<f.length;d++){var g=f[d];c.addTarget(jj.Parse(g))}return c},e}(),ob=o(30),Db=o(47),Ud=function(){function e(b,a){if(void 0===a&&(a=e.DefaultPluginFactory()),this._physicsPlugin=a,this._impostors=[],this._joints=[],this._subTimeStep=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");b=b||new i.e(0,-9.807,0),this.setGravity(b),this.setTimeStep()}return e.DefaultPluginFactory=function(){throw Gc.a.WarnImport("CannonJSPlugin")},e.prototype.setGravity=function(b){this.gravity=b,this._physicsPlugin.setGravity(this.gravity)},e.prototype.setTimeStep=function(b){void 0===b&&(b=1/60),this._physicsPlugin.setTimeStep(b)},e.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},e.prototype.setSubTimeStep=function(b){void 0===b&&(b=0),this._subTimeStep=b},e.prototype.getSubTimeStep=function(){return this._subTimeStep},e.prototype.dispose=function(){this._impostors.forEach(function(b){b.dispose()}),this._physicsPlugin.dispose()},e.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},e.prototype.addImpostor=function(b){b.uniqueId=this._impostors.push(b),b.parent||this._physicsPlugin.generatePhysicsBody(b)},e.prototype.removeImpostor=function(b){var a=this._impostors.indexOf(b);a>-1&&(this._impostors.splice(a,1).length&&this.getPhysicsPlugin().removePhysicsBody(b))},e.prototype.addJoint=function(b,a,c){var d={mainImpostor:b,connectedImpostor:a,joint:c};c.physicsPlugin=this._physicsPlugin,this._joints.push(d),this._physicsPlugin.generateJoint(d)},e.prototype.removeJoint=function(b,a,c){var d=this._joints.filter(function(f){return f.connectedImpostor===a&&f.joint===c&&f.mainImpostor===b});d.length&&this._physicsPlugin.removeJoint(d[0])},e.prototype._step=function(b){var a=this;this._impostors.forEach(function(c){c.isBodyInitRequired()&&a._physicsPlugin.generatePhysicsBody(c)}),b>.1?b=.1:b<=0&&(b=1/60),this._physicsPlugin.executeStep(b,this._impostors)},e.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},e.prototype.getImpostors=function(){return this._impostors},e.prototype.getImpostorForPhysicsObject=function(b){for(var a=0;a<this._impostors.length;++a)if(this._impostors[a].object===b)return this._impostors[a];return null},e.prototype.getImpostorWithPhysicsBody=function(b){for(var a=0;a<this._impostors.length;++a)if(this._impostors[a].physicsBody===b)return this._impostors[a];return null},e.prototype.raycast=function(b,a){return this._physicsPlugin.raycast(b,a)},e.Epsilon=.001,e}(),Qg=function(){function e(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=i.e.Zero(),this._hitPointWorld=i.e.Zero(),this._rayFromWorld=i.e.Zero(),this._rayToWorld=i.e.Zero()}return Object.defineProperty(e.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!0,configurable:!0}),e.prototype.setHitData=function(b,a){this._hasHit=!0,this._hitNormalWorld=new i.e(b.x,b.y,b.z),this._hitPointWorld=new i.e(a.x,a.y,a.z)},e.prototype.setHitDistance=function(b){this._hitDistance=b},e.prototype.calculateHitDistance=function(){this._hitDistance=i.e.Distance(this._rayFromWorld,this._hitPointWorld)},e.prototype.reset=function(b,a){void 0===b&&(b=i.e.Zero()),void 0===a&&(a=i.e.Zero()),this._rayFromWorld=b,this._rayToWorld=a,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=i.e.Zero(),this._hitPointWorld=i.e.Zero()},e}(),Rg=function(){function e(b,a,c){void 0===b&&(b=!0),void 0===a&&(a=10),void 0===c&&(c=CANNON),this._useDeltaForWorldStep=b,this.name="CannonJSPlugin",this._physicsMaterials=new Array(),this._fixedTimeStep=1/60,this._physicsBodysToRemoveAfterStep=new Array(),this._minus90X=new i.b(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new i.b(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=i.e.Zero(),this._tmpDeltaPosition=i.e.Zero(),this._tmpUnityRotation=new i.b(),this.BJSCANNON=c,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World(),this.world.broadphase=new this.BJSCANNON.NaiveBroadphase(),this.world.solver.iterations=a,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult(),this._raycastResult=new Qg()):k.a.Error("CannonJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(b){this.world.gravity.copy(b)},e.prototype.setTimeStep=function(b){this._fixedTimeStep=b},e.prototype.getTimeStep=function(){return this._fixedTimeStep},e.prototype.executeStep=function(b){this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?b:0,3),this._removeMarkedPhysicsBodiesFromWorld()},e.prototype._removeMarkedPhysicsBodiesFromWorld=function(){var b=this;this._physicsBodysToRemoveAfterStep.length>0&&(this._physicsBodysToRemoveAfterStep.forEach(function(a){b.world.remove(a)}),this._physicsBodysToRemoveAfterStep=[])},e.prototype.applyImpulse=function(b,a,c){var d=new this.BJSCANNON.Vec3(c.x,c.y,c.z),f=new this.BJSCANNON.Vec3(a.x,a.y,a.z);b.physicsBody.applyImpulse(f,d)},e.prototype.applyForce=function(b,a,c){var d=new this.BJSCANNON.Vec3(c.x,c.y,c.z),f=new this.BJSCANNON.Vec3(a.x,a.y,a.z);b.physicsBody.applyForce(f,d)},e.prototype.generatePhysicsBody=function(b){if(this._removeMarkedPhysicsBodiesFromWorld(),b.parent)b.physicsBody&&(this.removePhysicsBody(b),b.forceUpdate());else{if(b.isBodyInitRequired()){var a=this._createShape(b),c=b.physicsBody;c&&this.removePhysicsBody(b);var d=this._addMaterial("mat-"+b.uniqueId,b.getParam("friction"),b.getParam("restitution")),f={mass:b.getParam("mass"),material:d},g=b.getParam("nativeOptions");for(var h in g)g.hasOwnProperty(h)&&(f[h]=g[h]);b.physicsBody=new this.BJSCANNON.Body(f),b.physicsBody.addEventListener("collide",b.onCollide),this.world.addEventListener("preStep",b.beforeStep),this.world.addEventListener("postStep",b.afterStep),b.physicsBody.addShape(a),this.world.add(b.physicsBody),c&&["force","torque","velocity","angularVelocity"].forEach(function(j){b.physicsBody[j].copy(c[j])}),this._processChildMeshes(b)}this._updatePhysicsBodyTransformation(b)}},e.prototype._processChildMeshes=function(b){var a=this,c=b.object.getChildMeshes?b.object.getChildMeshes(!0):[],d=b.object.rotationQuaternion;if(c.length){var f=function(g,h){if(d&&h.rotationQuaternion){var j=h.getPhysicsImpostor();if(j){if(j.parent!==b){var m=h.position.clone(),w=h.rotationQuaternion.multiply(i.b.Inverse(d));j.physicsBody&&(a.removePhysicsBody(j),j.physicsBody=null),j.parent=b,j.resetUpdateFlags(),b.physicsBody.addShape(a._createShape(j),new a.BJSCANNON.Vec3(m.x,m.y,m.z),new a.BJSCANNON.Quaternion(w.x,w.y,w.z,w.w)),b.physicsBody.mass+=j.getParam("mass")}}d.multiplyInPlace(h.rotationQuaternion),h.getChildMeshes(!0).filter(function(z){return!!z.physicsImpostor}).forEach(f.bind(a,h.getAbsolutePosition()))}};c.filter(function(g){return!!g.physicsImpostor}).forEach(f.bind(this,b.object.getAbsolutePosition()))}},e.prototype.removePhysicsBody=function(b){b.physicsBody.removeEventListener("collide",b.onCollide),this.world.removeEventListener("preStep",b.beforeStep),this.world.removeEventListener("postStep",b.afterStep),-1===this._physicsBodysToRemoveAfterStep.indexOf(b.physicsBody)&&this._physicsBodysToRemoveAfterStep.push(b.physicsBody)},e.prototype.generateJoint=function(b){var a=b.mainImpostor.physicsBody,c=b.connectedImpostor.physicsBody;if(a&&c){var d,f=b.joint.jointData,g={pivotA:f.mainPivot?new this.BJSCANNON.Vec3().copy(f.mainPivot):null,pivotB:f.connectedPivot?new this.BJSCANNON.Vec3().copy(f.connectedPivot):null,axisA:f.mainAxis?new this.BJSCANNON.Vec3().copy(f.mainAxis):null,axisB:f.connectedAxis?new this.BJSCANNON.Vec3().copy(f.connectedAxis):null,maxForce:f.nativeParams.maxForce,collideConnected:!!f.collision};switch(b.joint.type){case Db.e.HingeJoint:case Db.e.Hinge2Joint:d=new this.BJSCANNON.HingeConstraint(a,c,g);break;case Db.e.DistanceJoint:d=new this.BJSCANNON.DistanceConstraint(a,c,f.maxDistance||2);break;case Db.e.SpringJoint:var h=f;d=new this.BJSCANNON.Spring(a,c,{restLength:h.length,stiffness:h.stiffness,damping:h.damping,localAnchorA:g.pivotA,localAnchorB:g.pivotB});break;case Db.e.LockJoint:d=new this.BJSCANNON.LockConstraint(a,c,g);break;case Db.e.PointToPointJoint:case Db.e.BallAndSocketJoint:default:d=new this.BJSCANNON.PointToPointConstraint(a,g.pivotA,c,g.pivotB,g.maxForce)}d.collideConnected=!!f.collision,b.joint.physicsJoint=d,b.joint.type!==Db.e.SpringJoint?this.world.addConstraint(d):(b.joint.jointData.forceApplicationCallback=b.joint.jointData.forceApplicationCallback||function(){d.applyForce()},b.mainImpostor.registerAfterPhysicsStep(b.joint.jointData.forceApplicationCallback))}},e.prototype.removeJoint=function(b){b.joint.type!==Db.e.SpringJoint?this.world.removeConstraint(b.joint.physicsJoint):b.mainImpostor.unregisterAfterPhysicsStep(b.joint.jointData.forceApplicationCallback)},e.prototype._addMaterial=function(b,a,c){var d,f;for(d=0;d<this._physicsMaterials.length;d++)if((f=this._physicsMaterials[d]).friction===a&&f.restitution===c)return f;var g=new this.BJSCANNON.Material(b);return g.friction=a,g.restitution=c,this._physicsMaterials.push(g),g},e.prototype._checkWithEpsilon=function(b){return b<Ud.Epsilon?Ud.Epsilon:b},e.prototype._createShape=function(b){var a,c=b.object,d=b.getObjectExtendSize();switch(b.type){case ob.a.SphereImpostor:var f=d.x,g=d.y,h=d.z;a=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(f),this._checkWithEpsilon(g),this._checkWithEpsilon(h))/2);break;case ob.a.CylinderImpostor:var j=b.getParam("nativeOptions");j||(j={});var m=void 0!==j.radiusTop?j.radiusTop:this._checkWithEpsilon(d.x)/2,w=void 0!==j.radiusBottom?j.radiusBottom:this._checkWithEpsilon(d.x)/2,z=void 0!==j.height?j.height:this._checkWithEpsilon(d.y),C=void 0!==j.numSegments?j.numSegments:16;a=new this.BJSCANNON.Cylinder(m,w,z,C);var J=new this.BJSCANNON.Quaternion();J.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);var K=new this.BJSCANNON.Vec3(0,0,0);a.transformAllPoints(K,J);break;case ob.a.BoxImpostor:var N=d.scale(.5);a=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(N.x),this._checkWithEpsilon(N.y),this._checkWithEpsilon(N.z)));break;case ob.a.PlaneImpostor:k.a.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),a=new this.BJSCANNON.Plane();break;case ob.a.MeshImpostor:var T=c.getVerticesData?c.getVerticesData(ra.b.PositionKind):[],Z=c.getIndices?c.getIndices():[];if(!T)return;var _=c.position.clone(),ca=c.rotation&&c.rotation.clone(),ea=c.rotationQuaternion&&c.rotationQuaternion.clone();c.position.copyFromFloats(0,0,0),c.rotation&&c.rotation.copyFromFloats(0,0,0),c.rotationQuaternion&&c.rotationQuaternion.copyFrom(b.getParentsRotation()),c.rotationQuaternion&&c.parent&&c.rotationQuaternion.conjugateInPlace();var fa,ka=c.computeWorldMatrix(!0),pa=new Array();for(fa=0;fa<T.length;fa+=3)i.e.TransformCoordinates(i.e.FromArray(T,fa),ka).toArray(pa,fa);k.a.Warn("MeshImpostor only collides against spheres."),a=new this.BJSCANNON.Trimesh(pa,Z),c.position.copyFrom(_),ca&&c.rotation&&c.rotation.copyFrom(ca),ea&&c.rotationQuaternion&&c.rotationQuaternion.copyFrom(ea);break;case ob.a.HeightmapImpostor:var va=c.position.clone(),sa=c.rotation&&c.rotation.clone(),la=c.rotationQuaternion&&c.rotationQuaternion.clone();c.position.copyFromFloats(0,0,0),c.rotation&&c.rotation.copyFromFloats(0,0,0),c.rotationQuaternion&&c.rotationQuaternion.copyFrom(b.getParentsRotation()),c.rotationQuaternion&&c.parent&&c.rotationQuaternion.conjugateInPlace(),c.rotationQuaternion&&c.rotationQuaternion.multiplyInPlace(this._minus90X),a=this._createHeightmap(c),c.position.copyFrom(va),sa&&c.rotation&&c.rotation.copyFrom(sa),la&&c.rotationQuaternion&&c.rotationQuaternion.copyFrom(la),c.computeWorldMatrix(!0);break;case ob.a.ParticleImpostor:a=new this.BJSCANNON.Particle();break;case ob.a.NoImpostor:a=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return a},e.prototype._createHeightmap=function(b,a){var c,d=b.getVerticesData(ra.b.PositionKind),f=b.computeWorldMatrix(!0),g=new Array();for(c=0;c<d.length;c+=3)i.e.TransformCoordinates(i.e.FromArray(d,c),f).toArray(g,c);d=g;for(var h=new Array(),j=a||~~(Math.sqrt(d.length/3)-1),m=b.getBoundingInfo(),w=Math.min(m.boundingBox.extendSizeWorld.x,m.boundingBox.extendSizeWorld.y),z=m.boundingBox.extendSizeWorld.z,C=2*w/j,J=0;J<d.length;J+=3){var K=Math.round(d[J+0]/C+j/2),N=Math.round(-1*(d[J+1]/C-j/2)),T=-d[J+2]+z;h[K]||(h[K]=[]),h[K][N]||(h[K][N]=T),h[K][N]=Math.max(T,h[K][N])}for(K=0;K<=j;++K){if(!h[K]){for(var Z=1;!h[(K+Z)%j];)Z++;h[K]=h[(K+Z)%j].slice()}for(N=0;N<=j;++N)if(!h[K][N]){var _;for(Z=1;void 0===_;)_=h[K][(N+Z++)%j];h[K][N]=_}}var ca=new this.BJSCANNON.Heightfield(h,{elementSize:C});return ca.minY=z,ca},e.prototype._updatePhysicsBodyTransformation=function(b){var a=b.object;if(a.computeWorldMatrix&&a.computeWorldMatrix(!0),a.getBoundingInfo()){var c=b.getObjectCenter();this._tmpDeltaPosition.copyFrom(a.getAbsolutePivotPoint().subtract(c)),this._tmpDeltaPosition.divideInPlace(b.object.scaling),this._tmpPosition.copyFrom(c);var d=a.rotationQuaternion;if(d){if(b.type!==ob.a.PlaneImpostor&&b.type!==ob.a.HeightmapImpostor||(d=d.multiply(this._minus90X),b.setDeltaRotation(this._plus90X)),b.type===ob.a.HeightmapImpostor){var f=a,g=f.getBoundingInfo(),h=f.rotationQuaternion;f.rotationQuaternion=this._tmpUnityRotation,f.computeWorldMatrix(!0);var j=c.clone(),m=f.getPivotMatrix();m=m?m.clone():i.a.Identity();var w=i.a.Translation(g.boundingBox.extendSizeWorld.x,0,-g.boundingBox.extendSizeWorld.z);f.setPreTransformMatrix(w),f.computeWorldMatrix(!0);var z=g.boundingBox.centerWorld.subtract(c).subtract(f.position).negate();this._tmpPosition.copyFromFloats(z.x,z.y-g.boundingBox.extendSizeWorld.y,z.z),this._tmpDeltaPosition.copyFrom(g.boundingBox.centerWorld.subtract(j)),this._tmpDeltaPosition.y+=g.boundingBox.extendSizeWorld.y,f.rotationQuaternion=h,f.setPreTransformMatrix(m),f.computeWorldMatrix(!0)}else b.type===ob.a.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);b.setDeltaPosition(this._tmpDeltaPosition),b.physicsBody.position.copy(this._tmpPosition),b.physicsBody.quaternion.copy(d)}}},e.prototype.setTransformationFromPhysicsBody=function(b){b.object.position.copyFrom(b.physicsBody.position),b.object.rotationQuaternion&&b.object.rotationQuaternion.copyFrom(b.physicsBody.quaternion)},e.prototype.setPhysicsBodyTransformation=function(b,a,c){b.physicsBody.position.copy(a),b.physicsBody.quaternion.copy(c)},e.prototype.isSupported=function(){return void 0!==this.BJSCANNON},e.prototype.setLinearVelocity=function(b,a){b.physicsBody.velocity.copy(a)},e.prototype.setAngularVelocity=function(b,a){b.physicsBody.angularVelocity.copy(a)},e.prototype.getLinearVelocity=function(b){var a=b.physicsBody.velocity;return a?new i.e(a.x,a.y,a.z):null},e.prototype.getAngularVelocity=function(b){var a=b.physicsBody.angularVelocity;return a?new i.e(a.x,a.y,a.z):null},e.prototype.setBodyMass=function(b,a){b.physicsBody.mass=a,b.physicsBody.updateMassProperties()},e.prototype.getBodyMass=function(b){return b.physicsBody.mass},e.prototype.getBodyFriction=function(b){return b.physicsBody.material.friction},e.prototype.setBodyFriction=function(b,a){b.physicsBody.material.friction=a},e.prototype.getBodyRestitution=function(b){return b.physicsBody.material.restitution},e.prototype.setBodyRestitution=function(b,a){b.physicsBody.material.restitution=a},e.prototype.sleepBody=function(b){b.physicsBody.sleep()},e.prototype.wakeUpBody=function(b){b.physicsBody.wakeUp()},e.prototype.updateDistanceJoint=function(b,a){b.physicsJoint.distance=a},e.prototype.setMotor=function(b,a,c,d){d||(b.physicsJoint.enableMotor(),b.physicsJoint.setMotorSpeed(a),c&&this.setLimit(b,c))},e.prototype.setLimit=function(b,a,c){b.physicsJoint.motorEquation.maxForce=a,b.physicsJoint.motorEquation.minForce=void 0===c?-a:c},e.prototype.syncMeshWithImpostor=function(b,a){var c=a.physicsBody;b.position.x=c.position.x,b.position.y=c.position.y,b.position.z=c.position.z,b.rotationQuaternion&&(b.rotationQuaternion.x=c.quaternion.x,b.rotationQuaternion.y=c.quaternion.y,b.rotationQuaternion.z=c.quaternion.z,b.rotationQuaternion.w=c.quaternion.w)},e.prototype.getRadius=function(b){return b.physicsBody.shapes[0].boundingSphereRadius},e.prototype.getBoxSizeToRef=function(b,a){var c=b.physicsBody.shapes[0];a.x=2*c.halfExtents.x,a.y=2*c.halfExtents.y,a.z=2*c.halfExtents.z},e.prototype.dispose=function(){},e.prototype._extendNamespace=function(){var b=new this.BJSCANNON.Vec3(),a=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(c,d,f){if(f=f||10,0===(d=d||0))this.internalStep(c),this.time+=c;else{var g=Math.floor((this.time+d)/c)-Math.floor(this.time/c);g=Math.min(g,f)||1;for(var h=performance.now(),j=0;j!==g&&(this.internalStep(c),!(performance.now()-h>1000*c));j++);this.time+=d;for(var m=this.time%c/c,w=b,z=this.bodies,C=0;C!==z.length;C++){var J=z[C];J.type!==a.Body.STATIC&&J.sleepState!==a.Body.SLEEPING?(J.position.vsub(J.previousPosition,w),w.scale(m,w),J.position.vadd(w,J.interpolatedPosition)):(J.interpolatedPosition.copy(J.position),J.interpolatedQuaternion.copy(J.quaternion))}}}},e.prototype.raycast=function(b,a){return this._cannonRaycastResult.reset(),this.world.raycastClosest(b,a,{},this._cannonRaycastResult),this._raycastResult.reset(b,a),this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance)),this._raycastResult},e}();Ud.DefaultPluginFactory=function(){return new Rg()};var kj=function(){function e(b,a){void 0===a&&(a=OIMO),this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=i.e.Zero(),this.BJSOIMO=a,this.world=new this.BJSOIMO.World({iterations:b}),this.world.clear(),this._raycastResult=new Qg()}return e.prototype.setGravity=function(b){this.world.gravity.copy(b)},e.prototype.setTimeStep=function(b){this.world.timeStep=b},e.prototype.getTimeStep=function(){return this.world.timeStep},e.prototype.executeStep=function(b,a){var c=this;a.forEach(function(h){h.beforeStep()}),this.world.step(),a.forEach(function(h){h.afterStep(),c._tmpImpostorsArray[h.uniqueId]=h});for(var d=this.world.contacts;null!==d;)if(!d.touching||d.body1.sleeping||d.body2.sleeping){var f=this._tmpImpostorsArray[+d.body1.name],g=this._tmpImpostorsArray[+d.body2.name];f&&g?(f.onCollide({body:g.physicsBody}),g.onCollide({body:f.physicsBody}),d=d.next):d=d.next}else d=d.next},e.prototype.applyImpulse=function(b,a,c){var d=b.physicsBody.mass;b.physicsBody.applyImpulse(c.scale(this.world.invScale),a.scale(this.world.invScale*d))},e.prototype.applyForce=function(b,a,c){k.a.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(b,a,c)},e.prototype.generatePhysicsBody=function(b){var a=this;if(b.parent)b.physicsBody&&(this.removePhysicsBody(b),b.forceUpdate());else{if(b.isBodyInitRequired()){var c={name:b.uniqueId,config:[b.getParam("mass")||.001,b.getParam("friction"),b.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:0!==b.getParam("mass"),density:b.getParam("mass"),friction:b.getParam("friction"),restitution:b.getParam("restitution"),world:this.world},d=[b];(h=b.object).getChildMeshes&&h.getChildMeshes().forEach(function(j){j.physicsImpostor&&d.push(j.physicsImpostor)});var f=function(j){return Math.max(j,Ud.Epsilon)},g=new i.b();d.forEach(function(j){if(j.object.rotationQuaternion){var m=j.object.rotationQuaternion;g=m.clone(),j.object.rotationQuaternion.set(0,0,0,1),j.object.computeWorldMatrix(!0);var w=m.toEulerAngles(),z=j.getObjectExtendSize();if(j===b){var C=b.getObjectCenter();b.object.getAbsolutePivotPoint().subtractToRef(C,a._tmpPositionVector),a._tmpPositionVector.divideInPlace(b.object.scaling),c.pos.push(C.x),c.pos.push(C.y),c.pos.push(C.z),c.posShape.push(0,0,0),c.rotShape.push(0,0,0)}else{var J=j.object.position.clone();c.posShape.push(J.x),c.posShape.push(J.y),c.posShape.push(J.z),c.rotShape.push(57.29577951308232*w.x),c.rotShape.push(57.29577951308232*w.y),c.rotShape.push(57.29577951308232*w.z)}switch(j.object.rotationQuaternion.copyFrom(g),j.type){case ob.a.ParticleImpostor:k.a.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case ob.a.SphereImpostor:var K=z.x,N=z.y,T=z.z,Z=Math.max(f(K),f(N),f(T))/2;c.type.push("sphere"),c.size.push(Z),c.size.push(Z),c.size.push(Z);break;case ob.a.CylinderImpostor:var _=f(z.x)/2,ca=f(z.y);c.type.push("cylinder"),c.size.push(_),c.size.push(ca),c.size.push(ca);break;case ob.a.PlaneImpostor:case ob.a.BoxImpostor:default:_=f(z.x),ca=f(z.y);var ea=f(z.z);c.type.push("box"),c.size.push(_),c.size.push(ca),c.size.push(ea)}j.object.rotationQuaternion=m}}),b.physicsBody=this.world.add(c),b.physicsBody.resetQuaternion(g),b.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);var h;b.setDeltaPosition(this._tmpPositionVector)}},e.prototype.removePhysicsBody=function(b){this.world.removeRigidBody(b.physicsBody)},e.prototype.generateJoint=function(b){var a=b.mainImpostor.physicsBody,c=b.connectedImpostor.physicsBody;if(a&&c){var d,f=b.joint.jointData,g=f.nativeParams||{},h={body1:a,body2:c,axe1:g.axe1||(f.mainAxis?f.mainAxis.asArray():null),axe2:g.axe2||(f.connectedAxis?f.connectedAxis.asArray():null),pos1:g.pos1||(f.mainPivot?f.mainPivot.asArray():null),pos2:g.pos2||(f.connectedPivot?f.connectedPivot.asArray():null),min:g.min,max:g.max,collision:g.collision||f.collision,spring:g.spring,world:this.world};switch(b.joint.type){case Db.e.BallAndSocketJoint:d="jointBall";break;case Db.e.SpringJoint:k.a.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var j=f;h.min=j.length||h.min,h.max=Math.max(h.min,h.max);case Db.e.DistanceJoint:d="jointDistance",h.max=f.maxDistance;break;case Db.e.PrismaticJoint:d="jointPrisme";break;case Db.e.SliderJoint:d="jointSlide";break;case Db.e.WheelJoint:d="jointWheel";break;case Db.e.HingeJoint:default:d="jointHinge"}h.type=d,b.joint.physicsJoint=this.world.add(h)}},e.prototype.removeJoint=function(b){try{this.world.removeJoint(b.joint.physicsJoint)}catch(a){k.a.Warn(a)}},e.prototype.isSupported=function(){return void 0!==this.BJSOIMO},e.prototype.setTransformationFromPhysicsBody=function(b){if(!b.physicsBody.sleeping){if(b.physicsBody.shapes.next){for(var a=b.physicsBody.shapes;a.next;)a=a.next;b.object.position.copyFrom(a.position)}else b.object.position.copyFrom(b.physicsBody.getPosition());b.object.rotationQuaternion&&b.object.rotationQuaternion.copyFrom(b.physicsBody.getQuaternion())}},e.prototype.setPhysicsBodyTransformation=function(b,a,c){var d=b.physicsBody;b.physicsBody.shapes.next||(d.position.copy(a),d.orientation.copy(c),d.syncShapes(),d.awake())},e.prototype.setLinearVelocity=function(b,a){b.physicsBody.linearVelocity.copy(a)},e.prototype.setAngularVelocity=function(b,a){b.physicsBody.angularVelocity.copy(a)},e.prototype.getLinearVelocity=function(b){var a=b.physicsBody.linearVelocity;return a?new i.e(a.x,a.y,a.z):null},e.prototype.getAngularVelocity=function(b){var a=b.physicsBody.angularVelocity;return a?new i.e(a.x,a.y,a.z):null},e.prototype.setBodyMass=function(b,a){var c=0===a;b.physicsBody.shapes.density=c?1:a,b.physicsBody.setupMass(c?2:1)},e.prototype.getBodyMass=function(b){return b.physicsBody.shapes.density},e.prototype.getBodyFriction=function(b){return b.physicsBody.shapes.friction},e.prototype.setBodyFriction=function(b,a){b.physicsBody.shapes.friction=a},e.prototype.getBodyRestitution=function(b){return b.physicsBody.shapes.restitution},e.prototype.setBodyRestitution=function(b,a){b.physicsBody.shapes.restitution=a},e.prototype.sleepBody=function(b){b.physicsBody.sleep()},e.prototype.wakeUpBody=function(b){b.physicsBody.awake()},e.prototype.updateDistanceJoint=function(b,a,c){b.physicsJoint.limitMotor.upperLimit=a,void 0!==c&&(b.physicsJoint.limitMotor.lowerLimit=c)},e.prototype.setMotor=function(b,a,c,d){void 0!==c?k.a.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):c=1e06,a*=-1;var f=d?b.physicsJoint.rotationalLimitMotor2:b.physicsJoint.rotationalLimitMotor1||b.physicsJoint.rotationalLimitMotor||b.physicsJoint.limitMotor;f&&f.setMotor(a,c)},e.prototype.setLimit=function(b,a,c,d){var f=d?b.physicsJoint.rotationalLimitMotor2:b.physicsJoint.rotationalLimitMotor1||b.physicsJoint.rotationalLimitMotor||b.physicsJoint.limitMotor;f&&f.setLimit(a,void 0===c?-a:c)},e.prototype.syncMeshWithImpostor=function(b,a){var c=a.physicsBody;b.position.x=c.position.x,b.position.y=c.position.y,b.position.z=c.position.z,b.rotationQuaternion&&(b.rotationQuaternion.x=c.orientation.x,b.rotationQuaternion.y=c.orientation.y,b.rotationQuaternion.z=c.orientation.z,b.rotationQuaternion.w=c.orientation.s)},e.prototype.getRadius=function(b){return b.physicsBody.shapes.radius},e.prototype.getBoxSizeToRef=function(b,a){var c=b.physicsBody.shapes;a.x=2*c.halfWidth,a.y=2*c.halfHeight,a.z=2*c.halfDepth},e.prototype.dispose=function(){this.world.clear()},e.prototype.raycast=function(b,a){return k.a.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(b,a),this._raycastResult},e}();Xa.a.CreateRibbon=function(e){var b=e.pathArray,a=e.closeArray||!1,c=e.closePath||!1,d=e.invertUV||!1,f=Math.floor(b[0].length/2),g=e.offset||f;g=g>f?f:Math.floor(g);var h,j,m,w,z=0===e.sideOrientation?0:e.sideOrientation||Xa.a.DEFAULTSIDE,C=e.uvs,J=e.colors,K=[],N=[],T=[],Z=[],_=[],ca=[],ea=[],fa=[],ka=[],pa=[];if(b.length<2){var va=[],sa=[];for(m=0;m<b[0].length-g;m++)va.push(b[0][m]),sa.push(b[0][m+g]);b=[va,sa]}var la,ta,Da,ua,Aa,za=0,Fa=c?1:0;for(h=b[0].length,j=0;j<b.length;j++){for(ea[j]=0,_[j]=[0],h=h<(ta=(la=b[j]).length)?h:ta,w=0;w<ta;)K.push(la[w].x,la[w].y,la[w].z),w>0&&(Da=la[w].subtract(la[w-1]).length()+ea[j],_[j].push(Da),ea[j]=Da),w++;c&&(w--,K.push(la[0].x,la[0].y,la[0].z),Da=la[w].subtract(la[0]).length()+ea[j],_[j].push(Da),ea[j]=Da),ka[j]=ta+Fa,pa[j]=za,za+=ta+Fa}var La,Ta,bb=null,Ra=null;for(m=0;m<h+Fa;m++){for(fa[m]=0,ca[m]=[0],j=0;j<b.length-1;j++)ua=b[j],Aa=b[j+1],m===h?(bb=ua[0],Ra=Aa[0]):(bb=ua[m],Ra=Aa[m]),Da=Ra.subtract(bb).length()+fa[m],ca[m].push(Da),fa[m]=Da;a&&Ra&&bb&&(ua=b[j],Aa=b[0],m===h&&(Ra=Aa[0]),Da=Ra.subtract(bb).length()+fa[m],fa[m]=Da)}if(C)for(j=0;j<C.length;j++)Z.push(C[j].x,C[j].y);else for(j=0;j<b.length;j++)for(m=0;m<h+Fa;m++)La=0!=ea[j]?_[j][m]/ea[j]:0,Ta=0!=fa[m]?ca[m][j]/fa[m]:0,d?Z.push(Ta,La):Z.push(La,Ta);for(var Oa=0,Za=ka[j=0]-1,Va=ka[j+1]-1,$a=Za<Va?Za:Va,fb=pa[1]-pa[0],Ma=a?ka.length:ka.length-1;Oa<=$a&&j<Ma;)N.push(Oa,Oa+fb,Oa+1),N.push(Oa+fb+1,Oa+1,Oa+fb),(Oa+=1)===$a&&(++j===ka.length-1?(fb=pa[0]-pa[j],Za=ka[j]-1,Va=ka[0]-1):(fb=pa[j+1]-pa[j],Za=ka[j]-1,Va=ka[j+1]-1),Oa=pa[j],$a=Za<Va?Za+Oa:Va+Oa);if(Xa.a.ComputeNormals(K,N,T),c){var Wa=0,ab=0;for(j=0;j<b.length;j++)Wa=3*pa[j],ab=j+1<b.length?3*(pa[j+1]-1):T.length-3,T[Wa]=.5*(T[Wa]+T[ab]),T[Wa+1]=.5*(T[Wa+1]+T[ab+1]),T[Wa+2]=.5*(T[Wa+2]+T[ab+2]),T[ab]=T[Wa],T[ab+1]=T[Wa+1],T[ab+2]=T[Wa+2]}Xa.a._ComputeSides(z,K,N,T,Z,e.frontUVs,e.backUVs);var vb=null;if(J){vb=new Float32Array(4*J.length);for(var rb=0;rb<J.length;rb++)vb[4*rb]=J[rb].r,vb[4*rb+1]=J[rb].g,vb[4*rb+2]=J[rb].b,vb[4*rb+3]=J[rb].a}var ub=new Xa.a(),Bb=new Float32Array(K),jb=new Float32Array(T),Eb=new Float32Array(Z);return ub.indices=N,ub.positions=Bb,ub.normals=jb,ub.uvs=Eb,vb&&ub.set(vb,ra.b.ColorKind),c&&(ub._idx=pa),ub},xa.a.CreateRibbon=function(e,b,a,c,d,f,g,h,j){return void 0===a&&(a=!1),void 0===g&&(g=!1),rd.CreateRibbon(e,{pathArray:b,closeArray:a,closePath:c,offset:d,updatable:g,sideOrientation:h,instance:j},f)};var rd=function(){function e(){}return e.CreateRibbon=function(b,a,c){void 0===c&&(c=null);var d=a.pathArray,f=a.closeArray,g=a.closePath,h=xa.a._GetDefaultSideOrientation(a.sideOrientation),j=a.instance,m=a.updatable;if(j){var w=i.c.Vector3[0].setAll(Number.MAX_VALUE),z=i.c.Vector3[1].setAll(-Number.MAX_VALUE),C=j.getVerticesData(ra.b.PositionKind);if(function(ta){for(var Da=d[0].length,ua=j,Aa=0,za=ua._originalBuilderSideOrientation===xa.a.DOUBLESIDE?2:1,Fa=1;Fa<=za;++Fa)for(var La=0;La<d.length;++La){var Ta=d[La],bb=Ta.length;Da=Da<bb?Da:bb;for(var Ra=0;Ra<Da;++Ra){var Oa=Ta[Ra];ta[Aa]=Oa.x,ta[Aa+1]=Oa.y,ta[Aa+2]=Oa.z,w.minimizeInPlaceFromFloats(Oa.x,Oa.y,Oa.z),z.maximizeInPlaceFromFloats(Oa.x,Oa.y,Oa.z),Aa+=3}ua._creationDataStorage&&ua._creationDataStorage.closePath&&(Oa=Ta[0],ta[Aa]=Oa.x,ta[Aa+1]=Oa.y,ta[Aa+2]=Oa.z,Aa+=3)}}(C),j._boundingInfo?j._boundingInfo.reConstruct(w,z,j._worldMatrix):j._boundingInfo=new Kc.a(w,z,j._worldMatrix),j.updateVerticesData(ra.b.PositionKind,C,!1,!1),a.colors){for(var J=j.getVerticesData(ra.b.ColorKind),K=0,N=0;K<a.colors.length;K++,N+=4){var T=a.colors[K];J[N]=T.r,J[N+1]=T.g,J[N+2]=T.b,J[N+3]=T.a}j.updateVerticesData(ra.b.ColorKind,J,!1,!1)}if(a.uvs){for(var Z=j.getVerticesData(ra.b.UVKind),_=0;_<a.uvs.length;_++)Z[2*_]=a.uvs[_].x,Z[2*_+1]=a.uvs[_].y;j.updateVerticesData(ra.b.UVKind,Z,!1,!1)}if(!j.areNormalsFrozen||j.isFacetDataEnabled){var ca=j.getIndices(),ea=j.getVerticesData(ra.b.NormalKind),fa=j.isFacetDataEnabled?j.getFacetDataParameters():null;if(Xa.a.ComputeNormals(C,ca,ea,fa),j._creationDataStorage&&j._creationDataStorage.closePath)for(var ka=0,pa=0,va=0;va<d.length;va++)ka=3*j._creationDataStorage.idx[va],pa=va+1<d.length?3*(j._creationDataStorage.idx[va+1]-1):ea.length-3,ea[ka]=.5*(ea[ka]+ea[pa]),ea[ka+1]=.5*(ea[ka+1]+ea[pa+1]),ea[ka+2]=.5*(ea[ka+2]+ea[pa+2]),ea[pa]=ea[ka],ea[pa+1]=ea[ka+1],ea[pa+2]=ea[ka+2];j.areNormalsFrozen||j.updateVerticesData(ra.b.NormalKind,ea,!1,!1)}return j}var sa=new xa.a(b,c);sa._originalBuilderSideOrientation=h,sa._creationDataStorage=new xa.b();var la=Xa.a.CreateRibbon(a);return g&&(sa._creationDataStorage.idx=la._idx),sa._creationDataStorage.closePath=g,sa._creationDataStorage.closeArray=f,la.applyToMesh(sa,m),sa},e}();xa.a.ExtrudeShape=function(e,b,a,c,d,f,g,h,j,m){void 0===g&&(g=null);var w={shape:b,path:a,scale:c,rotation:d,cap:0===f?0:f||xa.a.NO_CAP,sideOrientation:j,instance:m,updatable:h};return Vd.ExtrudeShape(e,w,g)},xa.a.ExtrudeShapeCustom=function(e,b,a,c,d,f,g,h,j,m,w,z){var C={shape:b,path:a,scaleFunction:c,rotationFunction:d,ribbonCloseArray:f,ribbonClosePath:g,cap:0===h?0:h||xa.a.NO_CAP,sideOrientation:w,instance:z,updatable:m};return Vd.ExtrudeShapeCustom(e,C,j)};var Vd=function(){function e(){}return e.ExtrudeShape=function(b,a,c){void 0===c&&(c=null);var d=a.path,f=a.shape,g=a.scale||1,h=a.rotation||0,j=0===a.cap?0:a.cap||xa.a.NO_CAP,m=a.updatable,w=xa.a._GetDefaultSideOrientation(a.sideOrientation),z=a.instance||null,C=a.invertUV||!1;return e._ExtrudeShapeGeneric(b,f,d,g,h,null,null,!1,!1,j,!1,c,!!m,w,z,C,a.frontUVs||null,a.backUVs||null)},e.ExtrudeShapeCustom=function(b,a,c){void 0===c&&(c=null);var d=a.path,f=a.shape,g=a.scaleFunction||function(){return 1},h=a.rotationFunction||function(){return 0},j=a.ribbonCloseArray||!1,m=a.ribbonClosePath||!1,w=0===a.cap?0:a.cap||xa.a.NO_CAP,z=a.updatable,C=xa.a._GetDefaultSideOrientation(a.sideOrientation),J=a.instance,K=a.invertUV||!1;return e._ExtrudeShapeGeneric(b,f,d,null,null,g,h,j,m,w,!0,c,!!z,C,J||null,K,a.frontUVs||null,a.backUVs||null)},e._ExtrudeShapeGeneric=function(b,a,c,d,f,g,h,j,m,w,z,C,J,K,N,T,Z,_){var ca,ea,fa=function(va,sa,la,ta,Da,ua,Aa,za,Fa,La){for(var Ta=la.getTangents(),bb=la.getNormals(),Ra=la.getBinormals(),Oa=la.getDistances(),Za=0,Va=La&&za?za:function(){return null!==ua?ua:0},$a=La&&Aa?Aa:function(){return null!==Da?Da:1},fb=Fa===xa.a.NO_CAP||Fa===xa.a.CAP_END?0:2,Ma=i.c.Matrix[0],Wa=0;Wa<sa.length;Wa++){for(var ab=new Array(),vb=Va(Wa,Oa[Wa]),rb=$a(Wa,Oa[Wa]),ub=0;ub<va.length;ub++){i.a.RotationAxisToRef(Ta[Wa],Za,Ma);var Bb=Ta[Wa].scale(va[ub].z).add(bb[Wa].scale(va[ub].x)).add(Ra[Wa].scale(va[ub].y)),jb=ab[ub]?ab[ub]:i.e.Zero();i.e.TransformCoordinatesToRef(Bb,Ma,jb),jb.scaleInPlace(rb).addInPlace(sa[Wa]),ab[ub]=jb}ta[fb]=ab,Za+=vb,fb++}var Eb=function(_b){var Kb,cc=Array(),$b=i.e.Zero();for(Kb=0;Kb<_b.length;Kb++)$b.addInPlace(_b[Kb]);for($b.scaleInPlace(1/_b.length),Kb=0;Kb<_b.length;Kb++)cc.push($b);return cc};switch(Fa){case xa.a.NO_CAP:break;case xa.a.CAP_START:ta[0]=Eb(ta[2]),ta[1]=ta[2];break;case xa.a.CAP_END:ta[fb]=ta[fb-1],ta[fb+1]=Eb(ta[fb-1]);break;case xa.a.CAP_ALL:ta[0]=Eb(ta[2]),ta[1]=ta[2],ta[fb]=ta[fb-1],ta[fb+1]=Eb(ta[fb-1])}return ta};if(N){var ka=N._creationDataStorage;return ca=ka.path3D.update(c),ea=fa(a,c,ka.path3D,ka.pathArray,d,f,g,h,ka.cap,z),N=xa.a.CreateRibbon("",ea,!1,!1,0,C||void 0,!1,0,N)}ea=fa(a,c,ca=new tc(c),new Array(),d,f,g,h,w=w<0||w>3?0:w,z);var pa=rd.CreateRibbon(b,{pathArray:ea,closeArray:j,closePath:m,updatable:J,sideOrientation:K,invertUV:T,frontUVs:Z||void 0,backUVs:_||void 0},C);return pa._creationDataStorage.pathArray=ea,pa._creationDataStorage.path3D=ca,pa._creationDataStorage.cap=w,pa},e}(),lj=function(){function e(b,a,c){var d=this;void 0===b&&(b=!0),void 0===a&&(a=Ammo),void 0===c&&(c=null),this._useDeltaForWorldStep=b,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new i.b(),this._tmpContactCallbackResult=!1,this._tmpVector=new i.e(),this._tmpMatrix=new i.a(),"function"==typeof a?a(this.bjsAMMO):this.bjsAMMO=a,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration(),this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=c||new this.bjsAMMO.btDbvtBroadphase(),this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver(),this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver(),this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback(),this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(){d._tmpContactCallbackResult=!0},this._raycastResult=new Qg(),this._tmpAmmoTransform=new this.bjsAMMO.btTransform(),this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):k.a.Error("AmmoJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(b){this._tmpAmmoVectorA.setValue(b.x,b.y,b.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)},e.prototype.setTimeStep=function(b){this._timeStep=b},e.prototype.setFixedTimeStep=function(b){this._fixedTimeStep=b},e.prototype.setMaxSteps=function(b){this._maxSteps=b},e.prototype.getTimeStep=function(){return this._timeStep},e.prototype._isImpostorInContact=function(b){return this._tmpContactCallbackResult=!1,this.world.contactTest(b.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},e.prototype._isImpostorPairInContact=function(b,a){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(b.physicsBody,a.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},e.prototype._stepSimulation=function(b,a,c){if(void 0===b&&(b=1/60),void 0===a&&(a=10),void 0===c&&(c=1/60),0==a)this.world.stepSimulation(b,0);else for(;a>0&&b>0;)b-c<c?(this.world.stepSimulation(b,0),b=0):(b-=c,this.world.stepSimulation(c,0)),a--},e.prototype.executeStep=function(b,a){for(var c=0,d=a;c<d.length;c++){var f=d[c];f.soft||f.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?b:this._timeStep,this._maxSteps,this._fixedTimeStep);for(var g=0,h=a;g<h.length;g++){var j=h[g];if(j.soft?this._afterSoftStep(j):j.afterStep(),j._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(j))for(var m=0,w=j._onPhysicsCollideCallbacks;m<w.length;m++)for(var z=0,C=w[m].otherImpostors;z<C.length;z++){var J=C[z];(j.physicsBody.isActive()||J.physicsBody.isActive())&&this._isImpostorPairInContact(j,J)&&(j.onCollide({body:J.physicsBody}),J.onCollide({body:j.physicsBody}))}}},e.prototype._afterSoftStep=function(b){b.type===ob.a.RopeImpostor?this._ropeStep(b):this._softbodyOrClothStep(b)},e.prototype._ropeStep=function(b){for(var a,c,d,f,g=b.physicsBody.get_m_nodes(),h=g.size(),j=new Array(),m=0;m<h;m++)c=(a=g.at(m).get_m_x()).x(),d=a.y(),f=a.z(),j.push(new i.e(c,d,f));var w=b.object,z=b.getParam("shape");b._isFromLine?b.object=Wb.a.CreateLines("lines",{points:j,instance:w}):b.object=Vd.ExtrudeShape("ext",{shape:z,path:j,instance:w})},e.prototype._softbodyOrClothStep=function(b){var a=b.type===ob.a.ClothImpostor?1:-1,c=b.object,d=c.getVerticesData(ra.b.PositionKind);d||(d=[]);var f=c.getVerticesData(ra.b.NormalKind);f||(f=[]);for(var g,h,j,m,w,z,C,J,K=d.length/3,N=b.physicsBody.get_m_nodes(),T=0;T<K;T++){var Z;j=(h=(g=N.at(T)).get_m_x()).x(),m=h.y(),w=h.z()*a,z=(Z=g.get_m_n()).x(),C=Z.y(),J=Z.z()*a,d[3*T]=j,d[3*T+1]=m,d[3*T+2]=w,f[3*T]=z,f[3*T+1]=C,f[3*T+2]=J}var _=new Xa.a();_.positions=d,_.normals=f,_.uvs=c.getVerticesData(ra.b.UVKind),_.colors=c.getVerticesData(ra.b.ColorKind),c&&c.getIndices&&(_.indices=c.getIndices()),_.applyToMesh(c)},e.prototype.applyImpulse=function(b,a,c){if(b.soft)k.a.Warn("Cannot be applied to a soft body");else{b.physicsBody.activate();var d=this._tmpAmmoVectorA,f=this._tmpAmmoVectorB;b.object&&b.object.getWorldMatrix&&(b.object.getWorldMatrix().invertToRef(this._tmpMatrix),i.e.TransformCoordinatesToRef(c,this._tmpMatrix,this._tmpVector),c=this._tmpVector),d.setValue(c.x,c.y,c.z),f.setValue(a.x,a.y,a.z),b.physicsBody.applyImpulse(f,d)}},e.prototype.applyForce=function(b,a,c){if(b.soft)k.a.Warn("Cannot be applied to a soft body");else{b.physicsBody.activate();var d=this._tmpAmmoVectorA,f=this._tmpAmmoVectorB;b.object&&b.object.getWorldMatrix&&(b.object.getWorldMatrix().invertToRef(this._tmpMatrix),i.e.TransformCoordinatesToRef(c,this._tmpMatrix,this._tmpVector),c=this._tmpVector),d.setValue(c.x,c.y,c.z),f.setValue(a.x,a.y,a.z),b.physicsBody.applyForce(f,d)}},e.prototype.generatePhysicsBody=function(b){if(b._pluginData.toDispose=[],b.parent)b.physicsBody&&(this.removePhysicsBody(b),b.forceUpdate());else if(b.isBodyInitRequired()){var a=this._createShape(b),c=b.getParam("mass");if(b._pluginData.mass=c,b.soft)a.get_m_cfg().set_collisions(17),a.get_m_cfg().set_kDP(b.getParam("damping")),this.bjsAMMO.castObject(a,this.bjsAMMO.btCollisionObject).getCollisionShape().setMargin(b.getParam("margin")),a.setActivationState(e.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(a,1,-1),b.physicsBody=a,b._pluginData.toDispose.push(a),this.setBodyPressure(b,0),b.type===ob.a.SoftbodyImpostor&&this.setBodyPressure(b,b.getParam("pressure")),this.setBodyStiffness(b,b.getParam("stiffness")),this.setBodyVelocityIterations(b,b.getParam("velocityIterations")),this.setBodyPositionIterations(b,b.getParam("positionIterations"));else{var d=new this.bjsAMMO.btVector3(0,0,0),f=new this.bjsAMMO.btTransform();f.setIdentity(),0!==c&&a.calculateLocalInertia(c,d),this._tmpAmmoVectorA.setValue(b.object.position.x,b.object.position.y,b.object.position.z),this._tmpAmmoQuaternion.setValue(b.object.rotationQuaternion.x,b.object.rotationQuaternion.y,b.object.rotationQuaternion.z,b.object.rotationQuaternion.w),f.setOrigin(this._tmpAmmoVectorA),f.setRotation(this._tmpAmmoQuaternion);var g=new this.bjsAMMO.btDefaultMotionState(f),h=new this.bjsAMMO.btRigidBodyConstructionInfo(c,g,a,d),j=new this.bjsAMMO.btRigidBody(h);0===c&&(j.setCollisionFlags(j.getCollisionFlags()|e.KINEMATIC_FLAG),j.setActivationState(e.DISABLE_DEACTIVATION_FLAG)),b.type!=ob.a.NoImpostor||a.getChildShape||j.setCollisionFlags(j.getCollisionFlags()|e.DISABLE_COLLISION_FLAG),this.world.addRigidBody(j),b.physicsBody=j,b._pluginData.toDispose=b._pluginData.toDispose.concat([j,h,g,f,d,a])}this.setBodyRestitution(b,b.getParam("restitution")),this.setBodyFriction(b,b.getParam("friction"))}},e.prototype.removePhysicsBody=function(b){var a=this;this.world&&(b.soft?this.world.removeSoftBody(b.physicsBody):this.world.removeRigidBody(b.physicsBody),b._pluginData&&(b._pluginData.toDispose.forEach(function(c){a.bjsAMMO.destroy(c)}),b._pluginData.toDispose=[]))},e.prototype.generateJoint=function(b){var a=b.mainImpostor.physicsBody,c=b.connectedImpostor.physicsBody;if(a&&c){var d,f=b.joint.jointData;switch(f.mainPivot||(f.mainPivot=new i.e(0,0,0)),f.connectedPivot||(f.connectedPivot=new i.e(0,0,0)),b.joint.type){case Db.e.DistanceJoint:var g=f.maxDistance;g&&(f.mainPivot=new i.e(0,-g/2,0),f.connectedPivot=new i.e(0,g/2,0)),d=new this.bjsAMMO.btPoint2PointConstraint(a,c,new this.bjsAMMO.btVector3(f.mainPivot.x,f.mainPivot.y,f.mainPivot.z),new this.bjsAMMO.btVector3(f.connectedPivot.x,f.connectedPivot.y,f.connectedPivot.z));break;case Db.e.HingeJoint:f.mainAxis||(f.mainAxis=new i.e(0,0,0)),f.connectedAxis||(f.connectedAxis=new i.e(0,0,0));var h=new this.bjsAMMO.btVector3(f.mainAxis.x,f.mainAxis.y,f.mainAxis.z),j=new this.bjsAMMO.btVector3(f.connectedAxis.x,f.connectedAxis.y,f.connectedAxis.z);d=new this.bjsAMMO.btHingeConstraint(a,c,new this.bjsAMMO.btVector3(f.mainPivot.x,f.mainPivot.y,f.mainPivot.z),new this.bjsAMMO.btVector3(f.connectedPivot.x,f.connectedPivot.y,f.connectedPivot.z),h,j);break;case Db.e.BallAndSocketJoint:d=new this.bjsAMMO.btPoint2PointConstraint(a,c,new this.bjsAMMO.btVector3(f.mainPivot.x,f.mainPivot.y,f.mainPivot.z),new this.bjsAMMO.btVector3(f.connectedPivot.x,f.connectedPivot.y,f.connectedPivot.z));break;default:k.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),d=new this.bjsAMMO.btPoint2PointConstraint(a,c,new this.bjsAMMO.btVector3(f.mainPivot.x,f.mainPivot.y,f.mainPivot.z),new this.bjsAMMO.btVector3(f.connectedPivot.x,f.connectedPivot.y,f.connectedPivot.z))}this.world.addConstraint(d,!b.joint.jointData.collision),b.joint.physicsJoint=d}},e.prototype.removeJoint=function(b){this.world&&this.world.removeConstraint(b.joint.physicsJoint)},e.prototype._addMeshVerts=function(b,a,c){var d=this,f=0;if(c&&c.getIndices&&c.getWorldMatrix&&c.getChildMeshes){var g=c.getIndices();g||(g=[]);var h=c.getVerticesData(ra.b.PositionKind);h||(h=[]),c.computeWorldMatrix(!1);for(var j=g.length/3,m=0;m<j;m++){for(var w=[],z=0;z<3;z++){var C,J=new i.e(h[3*g[3*m+z]+0],h[3*g[3*m+z]+1],h[3*g[3*m+z]+2]);i.a.ScalingToRef(c.scaling.x,c.scaling.y,c.scaling.z,this._tmpMatrix),J=i.e.TransformCoordinates(J,this._tmpMatrix),(C=0==z?this._tmpAmmoVectorA:1==z?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(J.x,J.y,J.z),w.push(C)}b.addTriangle(w[0],w[1],w[2]),f++}c.getChildMeshes().forEach(function(K){f+=d._addMeshVerts(b,a,K)})}return f},e.prototype._softVertexData=function(b){var a=b.object;if(a&&a.getIndices&&a.getWorldMatrix&&a.getChildMeshes){var c=a.getIndices();c||(c=[]);var d=a.getVerticesData(ra.b.PositionKind);d||(d=[]);var f=a.getVerticesData(ra.b.NormalKind);f||(f=[]),a.computeWorldMatrix(!1);for(var g=[],h=[],j=0;j<d.length;j+=3){var m=new i.e(d[j],d[j+1],d[j+2]),w=new i.e(f[j],f[j+1],f[j+2]);m=i.e.TransformCoordinates(m,a.getWorldMatrix()),w=i.e.TransformNormal(w,a.getWorldMatrix()),g.push(m.x,m.y,m.z),h.push(w.x,w.y,w.z)}var z=new Xa.a();return z.positions=g,z.normals=h,z.uvs=a.getVerticesData(ra.b.UVKind),z.colors=a.getVerticesData(ra.b.ColorKind),a&&a.getIndices&&(z.indices=a.getIndices()),z.applyToMesh(a),a.position=i.e.Zero(),a.rotationQuaternion=null,a.rotation=i.e.Zero(),a.computeWorldMatrix(!0),z}return Xa.a.ExtractFromMesh(a)},e.prototype._createSoftbody=function(b){var a=b.object;if(a&&a.getIndices){var c=a.getIndices();c||(c=[]);var d=this._softVertexData(b),f=d.positions,g=d.normals;if(null===f||null===g)return new this.bjsAMMO.btCompoundShape();for(var h=[],j=[],m=0;m<f.length;m+=3){var w=new i.e(f[m],f[m+1],f[m+2]),z=new i.e(g[m],g[m+1],g[m+2]);h.push(w.x,w.y,-w.z),j.push(z.x,z.y,-z.z)}var C=new this.bjsAMMO.btSoftBodyHelpers().CreateFromTriMesh(this.world.getWorldInfo(),h,a.getIndices(),c.length/3,!0),J=f.length/3,K=C.get_m_nodes();for(m=0;m<J;m++){var N;(N=K.at(m).get_m_n()).setX(j[3*m]),N.setY(j[3*m+1]),N.setZ(j[3*m+2])}return C}},e.prototype._createCloth=function(b){var a=b.object;if(a&&a.getIndices){var c=a.getIndices();c||(c=[]);var d=this._softVertexData(b),f=d.positions,g=d.normals;if(null===f||null===g)return new this.bjsAMMO.btCompoundShape();var h=f.length,j=Math.sqrt(h/3);b.segments=j;var m=j-1;return this._tmpAmmoVectorA.setValue(f[0],f[1],f[2]),this._tmpAmmoVectorB.setValue(f[3*m],f[3*m+1],f[3*m+2]),this._tmpAmmoVectorD.setValue(f[h-3],f[h-2],f[h-1]),this._tmpAmmoVectorC.setValue(f[h-3-3*m],f[h-2-3*m],f[h-1-3*m]),new this.bjsAMMO.btSoftBodyHelpers().CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,j,j,b.getParam("fixedPoints"),!0)}},e.prototype._createRope=function(b){var a,c,d=this._softVertexData(b),f=d.positions,g=d.normals;if(null===f||null===g)return new this.bjsAMMO.btCompoundShape();d.applyToMesh(b.object,!0),b._isFromLine=!0;if(0===g.map(function(w){return w*w}).reduce(function(w,z){return w+z}))c=(a=f.length)/3-1,this._tmpAmmoVectorA.setValue(f[0],f[1],f[2]),this._tmpAmmoVectorB.setValue(f[a-3],f[a-2],f[a-1]);else{b._isFromLine=!1;var h=b.getParam("path");if(null===b.getParam("shape"))return k.a.Warn("No shape available for extruded mesh"),new this.bjsAMMO.btCompoundShape();if(f.length%(3*h.length)!=0)return k.a.Warn("Path does not match extrusion"),new this.bjsAMMO.btCompoundShape();c=(a=h.length)-1,this._tmpAmmoVectorA.setValue(h[0].x,h[0].y,h[0].z),this._tmpAmmoVectorB.setValue(h[a-1].x,h[a-1].y,h[a-1].z)}b.segments=c;var j=b.getParam("fixedPoints");j=j>3?3:j;var m=new this.bjsAMMO.btSoftBodyHelpers().CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,c-1,j);return m.get_m_cfg().set_collisions(17),m},e.prototype._createCustom=function(b){var a=null;return this.onCreateCustomShape&&(a=this.onCreateCustomShape(b)),null==a&&(a=new this.bjsAMMO.btCompoundShape()),a},e.prototype._addHullVerts=function(b,a,c){var d=this,f=0;if(c&&c.getIndices&&c.getWorldMatrix&&c.getChildMeshes){var g=c.getIndices();g||(g=[]);var h=c.getVerticesData(ra.b.PositionKind);h||(h=[]),c.computeWorldMatrix(!1);for(var j=g.length/3,m=0;m<j;m++){for(var w=[],z=0;z<3;z++){var C,J=new i.e(h[3*g[3*m+z]+0],h[3*g[3*m+z]+1],h[3*g[3*m+z]+2]);i.a.ScalingToRef(c.scaling.x,c.scaling.y,c.scaling.z,this._tmpMatrix),J=i.e.TransformCoordinates(J,this._tmpMatrix),(C=0==z?this._tmpAmmoVectorA:1==z?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(J.x,J.y,J.z),w.push(C)}b.addPoint(w[0],!0),b.addPoint(w[1],!0),b.addPoint(w[2],!0),f++}c.getChildMeshes().forEach(function(K){f+=d._addHullVerts(b,a,K)})}return f},e.prototype._createShape=function(b,a){var c=this;void 0===a&&(a=!1);var d,f=b.object,g=b.getObjectExtendSize();if(!a){var h=b.object.getChildMeshes?b.object.getChildMeshes(!0):[];d=new this.bjsAMMO.btCompoundShape();var j=0;if(h.forEach(function(K){var N=K.getPhysicsImpostor();if(N){if(N.type==ob.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var T=c._createShape(N),Z=K.parent.getWorldMatrix().clone(),_=new i.e();Z.decompose(_),c._tmpAmmoTransform.getOrigin().setValue(K.position.x*_.x,K.position.y*_.y,K.position.z*_.z),c._tmpAmmoQuaternion.setValue(K.rotationQuaternion.x,K.rotationQuaternion.y,K.rotationQuaternion.z,K.rotationQuaternion.w),c._tmpAmmoTransform.setRotation(c._tmpAmmoQuaternion),d.addChildShape(c._tmpAmmoTransform,T),N.dispose(),j++}}),j>0){if(b.type!=ob.a.NoImpostor){var m=this._createShape(b,!0);m&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),d.addChildShape(this._tmpAmmoTransform,m))}return d}this.bjsAMMO.destroy(d),d=null}switch(b.type){case ob.a.SphereImpostor:if(aa.a.WithinEpsilon(g.x,g.y,.0001)&&aa.a.WithinEpsilon(g.x,g.z,.0001))d=new this.bjsAMMO.btSphereShape(g.x/2);else{var w=[new this.bjsAMMO.btVector3(0,0,0)];(d=new this.bjsAMMO.btMultiSphereShape(w,[1],1)).setLocalScaling(new this.bjsAMMO.btVector3(g.x/2,g.y/2,g.z/2))}break;case ob.a.CapsuleImpostor:d=new this.bjsAMMO.btCapsuleShape(g.x/2,g.y/2);break;case ob.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(g.x/2,g.y/2,g.z/2),d=new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA);break;case ob.a.PlaneImpostor:case ob.a.BoxImpostor:this._tmpAmmoVectorA.setValue(g.x/2,g.y/2,g.z/2),d=new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA);break;case ob.a.MeshImpostor:if(0==b.getParam("mass")){var z=new this.bjsAMMO.btTriangleMesh();b._pluginData.toDispose.push(z);var C=this._addMeshVerts(z,f,f);d=0==C?new this.bjsAMMO.btCompoundShape():new this.bjsAMMO.btBvhTriangleMeshShape(z);break}case ob.a.ConvexHullImpostor:var J=new this.bjsAMMO.btConvexHullShape();0==(C=this._addHullVerts(J,f,f))?(b._pluginData.toDispose.push(J),d=new this.bjsAMMO.btCompoundShape()):d=J;break;case ob.a.NoImpostor:d=new this.bjsAMMO.btSphereShape(g.x/2);break;case ob.a.CustomImpostor:d=this._createCustom(b);break;case ob.a.SoftbodyImpostor:d=this._createSoftbody(b);break;case ob.a.ClothImpostor:d=this._createCloth(b);break;case ob.a.RopeImpostor:d=this._createRope(b);break;default:k.a.Warn("The impostor type is not currently supported by the ammo plugin.")}return d},e.prototype.setTransformationFromPhysicsBody=function(b){b.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),b.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),b.object.rotationQuaternion?b.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):b.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(b.object.rotation))},e.prototype.setPhysicsBodyTransformation=function(b,a,c){var d=b.physicsBody.getWorldTransform();if(d.getOrigin().x()!=a.x||d.getOrigin().y()!=a.y||d.getOrigin().z()!=a.z||d.getRotation().x()!=c.x||d.getRotation().y()!=c.y||d.getRotation().z()!=c.z||d.getRotation().w()!=c.w)if(this._tmpAmmoVectorA.setValue(a.x,a.y,a.z),d.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(c.x,c.y,c.z,c.w),d.setRotation(this._tmpAmmoQuaternion),b.physicsBody.setWorldTransform(d),0==b.mass){var f=b.physicsBody.getMotionState();f&&f.setWorldTransform(d)}else b.physicsBody.activate()},e.prototype.isSupported=function(){return void 0!==this.bjsAMMO},e.prototype.setLinearVelocity=function(b,a){this._tmpAmmoVectorA.setValue(a.x,a.y,a.z),b.soft?b.physicsBody.linearVelocity(this._tmpAmmoVectorA):b.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)},e.prototype.setAngularVelocity=function(b,a){this._tmpAmmoVectorA.setValue(a.x,a.y,a.z),b.soft?b.physicsBody.angularVelocity(this._tmpAmmoVectorA):b.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)},e.prototype.getLinearVelocity=function(b){if(b.soft)var a=b.physicsBody.linearVelocity();else a=b.physicsBody.getLinearVelocity();if(!a)return null;var c=new i.e(a.x(),a.y(),a.z());return this.bjsAMMO.destroy(a),c},e.prototype.getAngularVelocity=function(b){if(b.soft)var a=b.physicsBody.angularVelocity();else a=b.physicsBody.getAngularVelocity();if(!a)return null;var c=new i.e(a.x(),a.y(),a.z());return this.bjsAMMO.destroy(a),c},e.prototype.setBodyMass=function(b,a){b.soft?b.physicsBody.setTotalMass(a,!1):b.physicsBody.setMassProps(a),b._pluginData.mass=a},e.prototype.getBodyMass=function(b){return b._pluginData.mass||0},e.prototype.getBodyFriction=function(b){return b._pluginData.friction||0},e.prototype.setBodyFriction=function(b,a){b.soft?b.physicsBody.get_m_cfg().set_kDF(a):b.physicsBody.setFriction(a),b._pluginData.friction=a},e.prototype.getBodyRestitution=function(b){return b._pluginData.restitution||0},e.prototype.setBodyRestitution=function(b,a){b.physicsBody.setRestitution(a),b._pluginData.restitution=a},e.prototype.getBodyPressure=function(b){return b.soft?b._pluginData.pressure||0:(k.a.Warn("Pressure is not a property of a rigid body"),0)},e.prototype.setBodyPressure=function(b,a){b.soft?b.type===ob.a.SoftbodyImpostor?(b.physicsBody.get_m_cfg().set_kPR(a),b._pluginData.pressure=a):(b.physicsBody.get_m_cfg().set_kPR(0),b._pluginData.pressure=0):k.a.Warn("Pressure can only be applied to a softbody")},e.prototype.getBodyStiffness=function(b){return b.soft?b._pluginData.stiffness||0:(k.a.Warn("Stiffness is not a property of a rigid body"),0)},e.prototype.setBodyStiffness=function(b,a){b.soft?(a=(a=a<0?0:a)>1?1:a,b.physicsBody.get_m_materials().at(0).set_m_kLST(a),b._pluginData.stiffness=a):k.a.Warn("Stiffness cannot be applied to a rigid body")},e.prototype.getBodyVelocityIterations=function(b){return b.soft?b._pluginData.velocityIterations||0:(k.a.Warn("Velocity iterations is not a property of a rigid body"),0)},e.prototype.setBodyVelocityIterations=function(b,a){b.soft?(a=a<0?0:a,b.physicsBody.get_m_cfg().set_viterations(a),b._pluginData.velocityIterations=a):k.a.Warn("Velocity iterations cannot be applied to a rigid body")},e.prototype.getBodyPositionIterations=function(b){return b.soft?b._pluginData.positionIterations||0:(k.a.Warn("Position iterations is not a property of a rigid body"),0)},e.prototype.setBodyPositionIterations=function(b,a){b.soft?(a=a<0?0:a,b.physicsBody.get_m_cfg().set_piterations(a),b._pluginData.positionIterations=a):k.a.Warn("Position iterations cannot be applied to a rigid body")},e.prototype.appendAnchor=function(b,a,c,d,f,g){void 0===f&&(f=1),void 0===g&&(g=!1);var h=b.segments,j=Math.round((h-1)*c)+h*(h-1-Math.round((h-1)*d));b.physicsBody.appendAnchor(j,a.physicsBody,g,f)},e.prototype.appendHook=function(b,a,c,d,f){void 0===d&&(d=1),void 0===f&&(f=!1);var g=Math.round(b.segments*c);b.physicsBody.appendAnchor(g,a.physicsBody,f,d)},e.prototype.sleepBody=function(b){k.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")},e.prototype.wakeUpBody=function(b){b.physicsBody.activate()},e.prototype.updateDistanceJoint=function(b,a,c){k.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")},e.prototype.setMotor=function(b,a,c,d){b.physicsJoint.enableAngularMotor(!0,a,c)},e.prototype.setLimit=function(b,a,c){k.a.Warn("setLimit is not currently supported by the Ammo physics plugin")},e.prototype.syncMeshWithImpostor=function(b,a){a.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),b.position.x=this._tmpAmmoTransform.getOrigin().x(),b.position.y=this._tmpAmmoTransform.getOrigin().y(),b.position.z=this._tmpAmmoTransform.getOrigin().z(),b.rotationQuaternion&&(b.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),b.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),b.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),b.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())},e.prototype.getRadius=function(b){return b.getObjectExtendSize().x/2},e.prototype.getBoxSizeToRef=function(b,a){var c=b.getObjectExtendSize();a.x=c.x,a.y=c.y,a.z=c.z},e.prototype.dispose=function(){this.bjsAMMO.destroy(this.world),this.bjsAMMO.destroy(this._solver),this.bjsAMMO.destroy(this._overlappingPairCache),this.bjsAMMO.destroy(this._dispatcher),this.bjsAMMO.destroy(this._collisionConfiguration),this.bjsAMMO.destroy(this._tmpAmmoVectorA),this.bjsAMMO.destroy(this._tmpAmmoVectorB),this.bjsAMMO.destroy(this._tmpAmmoVectorC),this.bjsAMMO.destroy(this._tmpAmmoTransform),this.bjsAMMO.destroy(this._tmpAmmoQuaternion),this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null},e.prototype.raycast=function(b,a){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(b.x,b.y,b.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(a.x,a.y,a.z);var c=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,c),this._raycastResult.reset(b,a),c.hasHit()&&(this._raycastResult.setHitData({x:c.get_m_hitNormalWorld().x(),y:c.get_m_hitNormalWorld().y(),z:c.get_m_hitNormalWorld().z()},{x:c.get_m_hitPointWorld().x(),y:c.get_m_hitPointWorld().y(),z:c.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),this.bjsAMMO.destroy(c),this.bjsAMMO.destroy(this._tmpAmmoVectorRCA),this.bjsAMMO.destroy(this._tmpAmmoVectorRCB),this._raycastResult},e.DISABLE_COLLISION_FLAG=4,e.KINEMATIC_FLAG=2,e.DISABLE_DEACTIVATION_FLAG=4,e}();R.a.prototype.removeReflectionProbe=function(e){if(!this.reflectionProbes)return-1;var b=this.reflectionProbes.indexOf(e);return-1!==b&&this.reflectionProbes.splice(b,1),b},R.a.prototype.addReflectionProbe=function(e){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(e)};var mj=function(){function e(b,a,c,d,f){var g=this;void 0===d&&(d=!0),void 0===f&&(f=!1),this.name=b,this._viewMatrix=i.a.Identity(),this._target=i.e.Zero(),this._add=i.e.Zero(),this._invertYAxis=!1,this.position=i.e.Zero(),this._scene=c,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array()),this._scene.reflectionProbes.push(this),this._renderTargetTexture=new Jb(b,a,c,d,!0,f?p.a.TEXTURETYPE_FLOAT:p.a.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(h){switch(h){case 0:g._add.copyFromFloats(1,0,0);break;case 1:g._add.copyFromFloats(-1,0,0);break;case 2:g._add.copyFromFloats(0,g._invertYAxis?1:-1,0);break;case 3:g._add.copyFromFloats(0,g._invertYAxis?-1:1,0);break;case 4:g._add.copyFromFloats(0,0,1);break;case 5:g._add.copyFromFloats(0,0,-1)}g._attachedMesh&&g.position.copyFrom(g._attachedMesh.getAbsolutePosition()),g.position.addToRef(g._add,g._target),i.a.LookAtLHToRef(g.position,g._target,i.e.Up(),g._viewMatrix),c.activeCamera&&(g._projectionMatrix=i.a.PerspectiveFovLH(Math.PI/2,1,c.activeCamera.minZ,c.activeCamera.maxZ),c.setTransformMatrix(g._viewMatrix,g._projectionMatrix)),c._forcedViewPosition=g.position}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){c._forcedViewPosition=null,c.updateTransformMatrix(!0)})}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(b){this._renderTargetTexture.samples=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(b){this._renderTargetTexture.refreshRate=b},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},Object.defineProperty(e.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),e.prototype.attachToMesh=function(b){this._attachedMesh=b},e.prototype.setRenderingAutoClearDepthStencil=function(b,a){this._renderTargetTexture.setRenderingAutoClearDepthStencil(b,a)},e.prototype.dispose=function(){var b=this._scene.reflectionProbes.indexOf(this);-1!==b&&this._scene.reflectionProbes.splice(b,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},e.prototype.toString=function(b){var a="Name: "+this.name;return b&&(a+=", position: "+this.position.toString(),this._attachedMesh&&(a+=", attached mesh: "+this._attachedMesh.name)),a},e.prototype.getClassName=function(){return"ReflectionProbe"},e.prototype.serialize=function(){var b=F.a.Serialize(this,this._renderTargetTexture.serialize());return b.isReflectionProbe=!0,b},e.Parse=function(b,a,c){var d=null;if(a.reflectionProbes)for(var f=0;f<a.reflectionProbes.length;f++){var g=a.reflectionProbes[f];if(g.name===b.name){d=g;break}}return(d=F.a.Parse(function(){return d||new e(b.name,b.renderTargetSize,a,b._generateMipMaps)},b,a,c)).cubeTexture._waitingRenderList=b.renderList,b._attachedMesh&&d.attachToMesh(a.getMeshByID(b._attachedMesh)),d},Object(l.c)([Object(F.k)()],e.prototype,"_attachedMesh",void 0),Object(l.c)([Object(F.o)()],e.prototype,"position",void 0),e}(),uf=function(){function e(){}return e.LoaderInjectedPhysicsEngine=void 0,e}(),nj=function(e,b,a,c){for(var d=0,f=b.materials.length;d<f;d++){var g=b.materials[d];if(g.id===e)return Hb.a.Parse(g,a,c)}return null},vn=function(e,b,a){for(var c in b)if(e.name===b[c])return a.push(e.id),!0;return!(!e.parentId||-1===a.indexOf(e.parentId))&&(a.push(e.id),!0)},Wd=function(e,b){return e+" of "+(b?b.file+" from "+b.name+" version: "+b.version+", exporter version: "+b.exporter_version:"unknown")},oj=function(e,b){var a=b;if(b._waitingData.lods){if(b._waitingData.lods.ids&&b._waitingData.lods.ids.length>0){var c=b._waitingData.lods.ids,d=a.isEnabled(!1);if(b._waitingData.lods.distances){var f=b._waitingData.lods.distances;if(f.length>=c.length){var g=f.length>c.length?f[f.length-1]:0;a.setEnabled(!1);for(var h=0;h<c.length;h++){var j=c[h],m=e.getMeshByID(j);null!=m&&a.addLODLevel(f[h],m)}g>0&&a.addLODLevel(g,null),!0===d&&a.setEnabled(!0)}else Qa.b.Warn("Invalid level of detail distances for "+b.name)}}b._waitingData.lods=null}},pj=function(e,b,a,c,d){void 0===d&&(d=!1);var f=new Eh(e),g="importScene has failed JSON parse";try{var h=JSON.parse(b);g="";var j,m,w=yb.loggingLevel===yb.DETAILED_LOGGING;if(void 0!==h.environmentTexture&&null!==h.environmentTexture){var z=void 0===h.isPBR||h.isPBR;if(h.environmentTextureType&&"BABYLON.HDRCubeTexture"===h.environmentTextureType){var C=h.environmentTextureSize?h.environmentTextureSize:128,J=new Ee((h.environmentTexture.match(/https?:\/\//g)?"":a)+h.environmentTexture,e,C,!0,!z);h.environmentTextureRotationY&&(J.rotationY=h.environmentTextureRotationY),e.environmentTexture=J}else if(oc.a.EndsWith(h.environmentTexture,".env")){var K=new pc((h.environmentTexture.match(/https?:\/\//g)?"":a)+h.environmentTexture,e);h.environmentTextureRotationY&&(K.rotationY=h.environmentTextureRotationY),e.environmentTexture=K}else{var N=pc.CreateFromPrefilteredData((h.environmentTexture.match(/https?:\/\//g)?"":a)+h.environmentTexture,e);h.environmentTextureRotationY&&(N.rotationY=h.environmentTextureRotationY),e.environmentTexture=N}if(!0===h.createDefaultSkybox){var T=void 0!==e.activeCamera&&null!==e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1000,Z=h.skyboxBlurLevel||0;e.createDefaultSkybox(e.environmentTexture,z,T,Z)}f.environmentTexture=e.environmentTexture}if(void 0!==h.environmentIntensity&&null!==h.environmentIntensity&&(e.environmentIntensity=h.environmentIntensity),void 0!==h.lights&&null!==h.lights)for(j=0,m=h.lights.length;j<m;j++){var _=h.lights[j],ca=Zc.a.Parse(_,e);ca&&(f.lights.push(ca),g+=0===j?`
	Lights:`:"",g+=`
		`+ca.toString(w))}if(void 0!==h.reflectionProbes&&null!==h.reflectionProbes)for(j=0,m=h.reflectionProbes.length;j<m;j++){var ea=h.reflectionProbes[j],fa=mj.Parse(ea,e,a);fa&&(f.reflectionProbes.push(fa),g+=0===j?`
	Reflection Probes:`:"",g+=`
		`+fa.toString(w))}if(void 0!==h.animations&&null!==h.animations)for(j=0,m=h.animations.length;j<m;j++){var ka=h.animations[j],pa=D.a.GetClass("BABYLON.Animation");if(pa){var va=pa.Parse(ka);e.animations.push(va),f.animations.push(va),g+=0===j?`
	Animations:`:"",g+=`
		`+va.toString(w)}}if(void 0!==h.materials&&null!==h.materials)for(j=0,m=h.materials.length;j<m;j++){var sa=h.materials[j],la=Hb.a.Parse(sa,e,a);la&&(f.materials.push(la),g+=0===j?`
	Materials:`:"",g+=`
		`+la.toString(w),la.getActiveTextures().forEach(function(Lb){-1==f.textures.indexOf(Lb)&&f.textures.push(Lb)}))}if(void 0!==h.multiMaterials&&null!==h.multiMaterials)for(j=0,m=h.multiMaterials.length;j<m;j++){var ta=h.multiMaterials[j],Da=Td.a.ParseMultiMaterial(ta,e);f.multiMaterials.push(Da),g+=0===j?`
	MultiMaterials:`:"",g+=`
		`+Da.toString(w),Da.getActiveTextures().forEach(function(Lb){-1==f.textures.indexOf(Lb)&&f.textures.push(Lb)})}if(void 0!==h.morphTargetManagers&&null!==h.morphTargetManagers)for(var ua=0,Aa=h.morphTargetManagers;ua<Aa.length;ua++){var za=Aa[ua];f.morphTargetManagers.push(Pg.Parse(za,e))}if(void 0!==h.skeletons&&null!==h.skeletons)for(j=0,m=h.skeletons.length;j<m;j++){var Fa=h.skeletons[j],La=Tf.Parse(Fa,e);f.skeletons.push(La),g+=0===j?`
	Skeletons:`:"",g+=`
		`+La.toString(w)}var Ta=h.geometries;if(null!=Ta){var bb=new Array(),Ra=Ta.vertexData;if(null!=Ra)for(j=0,m=Ra.length;j<m;j++){var Oa=Ra[j];bb.push(Ng.a.Parse(Oa,e,a))}bb.forEach(function(Lb){Lb&&f.geometries.push(Lb)})}if(void 0!==h.transformNodes&&null!==h.transformNodes)for(j=0,m=h.transformNodes.length;j<m;j++){var Za=h.transformNodes[j],Va=pd.a.Parse(Za,e,a);f.transformNodes.push(Va)}if(void 0!==h.meshes&&null!==h.meshes)for(j=0,m=h.meshes.length;j<m;j++){var $a=h.meshes[j],fb=xa.a.Parse($a,e,a);f.meshes.push(fb),g+=0===j?`
	Meshes:`:"",g+=`
		`+fb.toString(w)}if(void 0!==h.cameras&&null!==h.cameras)for(j=0,m=h.cameras.length;j<m;j++){var Ma=h.cameras[j],Wa=hb.a.Parse(Ma,e);f.cameras.push(Wa),g+=0===j?`
	Cameras:`:"",g+=`
		`+Wa.toString(w)}if(void 0!==h.animationGroups&&null!==h.animationGroups)for(j=0,m=h.animationGroups.length;j<m;j++){var ab=h.animationGroups[j],vb=Sa.Parse(ab,e);f.animationGroups.push(vb),g+=0===j?`
	AnimationGroups:`:"",g+=`
		`+vb.toString(w)}for(j=0,m=e.cameras.length;j<m;j++)(Wa=e.cameras[j])._waitingParentId&&(Wa.parent=e.getLastEntryByID(Wa._waitingParentId),Wa._waitingParentId=null);for(j=0,m=e.lights.length;j<m;j++){var rb=e.lights[j];rb&&rb._waitingParentId&&(rb.parent=e.getLastEntryByID(rb._waitingParentId),rb._waitingParentId=null)}for(j=0,m=e.transformNodes.length;j<m;j++){var ub=e.transformNodes[j];ub._waitingParentId&&(ub.parent=e.getLastEntryByID(ub._waitingParentId),ub._waitingParentId=null)}for(j=0,m=e.meshes.length;j<m;j++)(fb=e.meshes[j])._waitingParentId&&(fb.parent=e.getLastEntryByID(fb._waitingParentId),fb._waitingParentId=null),fb._waitingData.lods&&oj(e,fb);for(j=0,m=e.skeletons.length;j<m;j++)(La=e.skeletons[j])._hasWaitingData&&(null!=La.bones&&La.bones.forEach(function(Lb){if(Lb._waitingTransformNodeId){var bd=e.getLastEntryByID(Lb._waitingTransformNodeId);bd&&Lb.linkTransformNode(bd),Lb._waitingTransformNodeId=null}}),La._hasWaitingData=null);for(j=0,m=e.meshes.length;j<m;j++){var Bb=e.meshes[j];Bb._waitingData.freezeWorldMatrix?(Bb.freezeWorldMatrix(),Bb._waitingData.freezeWorldMatrix=null):Bb.computeWorldMatrix(!0)}for(j=0,m=e.lights.length;j<m;j++){var jb=e.lights[j];if(jb._excludedMeshesIds.length>0){for(var Eb=0;Eb<jb._excludedMeshesIds.length;Eb++){var _b=e.getMeshByID(jb._excludedMeshesIds[Eb]);_b&&jb.excludedMeshes.push(_b)}jb._excludedMeshesIds=[]}if(jb._includedOnlyMeshesIds.length>0){for(var Kb=0;Kb<jb._includedOnlyMeshesIds.length;Kb++){var cc=e.getMeshByID(jb._includedOnlyMeshesIds[Kb]);cc&&jb.includedOnlyMeshes.push(cc)}jb._includedOnlyMeshesIds=[]}}for(R.a.Parse(h,e,f,a),j=0,m=e.meshes.length;j<m;j++)(fb=e.meshes[j])._waitingData.actions&&(ga.Parse(fb._waitingData.actions,fb,e),fb._waitingData.actions=null);void 0!==h.actions&&null!==h.actions&&ga.Parse(h.actions,null,e)}catch(Lb){var $b=Wd("loadAssets",h?h.producer:"Unknown")+g;if(!c)throw k.a.Log($b),Lb;c($b,Lb)}finally{d||f.removeAllFromScene(),null!==g&&yb.loggingLevel!==yb.NO_LOGGING&&k.a.Log(Wd("loadAssets",h?h.producer:"Unknown")+(yb.loggingLevel!==yb.MINIMAL_LOGGING?g:""))}return f};yb.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(e){return-1!==e.indexOf("babylon")},importMesh:function(e,b,a,c,d,f,g,h){var j="importMesh has failed JSON parse";try{var m=JSON.parse(a);j="";var w=yb.loggingLevel===yb.DETAILED_LOGGING;e?Array.isArray(e)||(e=[e]):e=null;var z=new Array();if(void 0!==m.meshes&&null!==m.meshes){var C,J,K,N=[],T=[];for(C=0,J=m.meshes.length;C<J;C++){var Z=m.meshes[C];if(null===e||vn(Z,e,z)){if(null!==e&&delete e[e.indexOf(Z.name)],void 0!==Z.geometryId&&null!==Z.geometryId&&void 0!==m.geometries&&null!==m.geometries){var _=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(Va){!0!==_&&m.geometries[Va]&&Array.isArray(m.geometries[Va])&&m.geometries[Va].forEach(function($a){if($a.id===Z.geometryId){switch(Va){case"vertexData":Ng.a.Parse($a,b,c)}_=!0}})}),!1===_&&k.a.Warn("Geometry not found for mesh "+Z.id)}if(Z.materialId){var ca=-1!==T.indexOf(Z.materialId);if(!1===ca&&void 0!==m.multiMaterials&&null!==m.multiMaterials)for(var ea=0,fa=m.multiMaterials.length;ea<fa;ea++){var ka=m.multiMaterials[ea];if(ka.id===Z.materialId){for(var pa=0,va=ka.materials.length;pa<va;pa++){var sa,la=ka.materials[pa];T.push(la),(sa=nj(la,m,b,c))&&(j+=`
	Material `+sa.toString(w))}T.push(ka.id);var ta=Td.a.ParseMultiMaterial(ka,b);ta&&(ca=!0,j+=`
	Multi-Material `+ta.toString(w));break}}!1===ca&&(T.push(Z.materialId),(sa=nj(Z.materialId,m,b,c))?j+=`
	Material `+sa.toString(w):k.a.Warn("Material not found for mesh "+Z.id))}if(Z.skeletonId>-1&&void 0!==m.skeletons&&null!==m.skeletons){if(!1===N.indexOf(Z.skeletonId)>-1)for(var Da=0,ua=m.skeletons.length;Da<ua;Da++){var Aa=m.skeletons[Da];if(Aa.id===Z.skeletonId){var za=Tf.Parse(Aa,b);g.push(za),N.push(Aa.id),j+=`
	Skeleton `+za.toString(w)}}}if(void 0!==m.morphTargetManagers&&null!==m.morphTargetManagers)for(var Fa=0,La=m.morphTargetManagers;Fa<La.length;Fa++){var Ta=La[Fa];Pg.Parse(Ta,b)}var bb=xa.a.Parse(Z,b,c);d.push(bb),j+=`
	Mesh `+bb.toString(w)}}for(C=0,J=b.meshes.length;C<J;C++)(K=b.meshes[C])._waitingParentId&&(K.parent=b.getLastEntryByID(K._waitingParentId),K._waitingParentId=null),K._waitingData.lods&&oj(b,K);for(C=0,J=b.skeletons.length;C<J;C++)(za=b.skeletons[C])._hasWaitingData&&(null!=za.bones&&za.bones.forEach(function(Va){if(Va._waitingTransformNodeId){var $a=b.getLastEntryByID(Va._waitingTransformNodeId);$a&&Va.linkTransformNode($a),Va._waitingTransformNodeId=null}}),za._hasWaitingData=null);for(C=0,J=b.meshes.length;C<J;C++)(K=b.meshes[C])._waitingData.freezeWorldMatrix?(K.freezeWorldMatrix(),K._waitingData.freezeWorldMatrix=null):K.computeWorldMatrix(!0)}if(void 0!==m.particleSystems&&null!==m.particleSystems){var Ra=R.a.GetIndividualParser(_a.a.NAME_PARTICLESYSTEM);if(Ra)for(C=0,J=m.particleSystems.length;C<J;C++){var Oa=m.particleSystems[C];-1!==z.indexOf(Oa.emitterId)&&f.push(Ra(Oa,b,c))}}return!0}catch(Va){var Za=Wd("importMesh",m?m.producer:"Unknown")+j;if(!h)throw k.a.Log(Za),Va;h(Za,Va)}finally{null!==j&&yb.loggingLevel!==yb.NO_LOGGING&&k.a.Log(Wd("importMesh",m?m.producer:"Unknown")+(yb.loggingLevel!==yb.MINIMAL_LOGGING?j:""))}return!1},load:function(e,b,a,c){var d="importScene has failed JSON parse";try{var f=JSON.parse(b);if(d="",void 0!==f.useDelayedTextureLoading&&null!==f.useDelayedTextureLoading&&(e.useDelayedTextureLoading=f.useDelayedTextureLoading&&!yb.ForceFullSceneLoadingForIncremental),void 0!==f.autoClear&&null!==f.autoClear&&(e.autoClear=f.autoClear),void 0!==f.clearColor&&null!==f.clearColor&&(e.clearColor=G.b.FromArray(f.clearColor)),void 0!==f.ambientColor&&null!==f.ambientColor&&(e.ambientColor=G.a.FromArray(f.ambientColor)),void 0!==f.gravity&&null!==f.gravity&&(e.gravity=i.e.FromArray(f.gravity)),f.fogMode&&0!==f.fogMode)switch(e.fogMode=f.fogMode,e.fogColor=G.a.FromArray(f.fogColor),e.fogStart=f.fogStart,e.fogEnd=f.fogEnd,e.fogDensity=f.fogDensity,d+="	Fog mode for scene:  ",e.fogMode){case 1:d+=`exp
`;break;case 2:d+=`exp2
`;break;case 3:d+=`linear
`}if(f.physicsEnabled){var g;"cannon"===f.physicsEngine?g=new Rg(void 0,void 0,uf.LoaderInjectedPhysicsEngine):"oimo"===f.physicsEngine?g=new kj(void 0,uf.LoaderInjectedPhysicsEngine):"ammo"===f.physicsEngine&&(g=new lj(void 0,uf.LoaderInjectedPhysicsEngine,void 0)),d="	Physics engine "+(f.physicsEngine?f.physicsEngine:"oimo")+` enabled
`;var h=f.physicsGravity?i.e.FromArray(f.physicsGravity):null;e.enablePhysics(h,g)}if(void 0!==f.metadata&&null!==f.metadata&&(e.metadata=f.metadata),void 0!==f.collisionsEnabled&&null!==f.collisionsEnabled&&(e.collisionsEnabled=f.collisionsEnabled),!pj(e,b,a,c,!0))return!1;if(f.autoAnimate&&e.beginAnimation(e,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1),void 0!==f.activeCameraID&&null!==f.activeCameraID&&e.setActiveCameraByID(f.activeCameraID),void 0!==f.environmentTexture&&null!==f.environmentTexture){var j=void 0===f.isPBR||f.isPBR;if(f.environmentTextureType&&"BABYLON.HDRCubeTexture"===f.environmentTextureType){var m=f.environmentTextureSize?f.environmentTextureSize:128,w=new Ee(a+f.environmentTexture,e,m,!0,!j);f.environmentTextureRotationY&&(w.rotationY=f.environmentTextureRotationY),e.environmentTexture=w}else if(oc.a.EndsWith(f.environmentTexture,".env")){var z=new pc(a+f.environmentTexture,e);f.environmentTextureRotationY&&(z.rotationY=f.environmentTextureRotationY),e.environmentTexture=z}else{var C=pc.CreateFromPrefilteredData(a+f.environmentTexture,e);f.environmentTextureRotationY&&(C.rotationY=f.environmentTextureRotationY),e.environmentTexture=C}if(!0===f.createDefaultSkybox){var J=void 0!==e.activeCamera&&null!==e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1000,K=f.skyboxBlurLevel||0;e.createDefaultSkybox(e.environmentTexture,j,J,K)}}return!0}catch(T){var N=Wd("importScene",f?f.producer:"Unknown")+d;if(!c)throw k.a.Log(N),T;c(N,T)}finally{null!==d&&yb.loggingLevel!==yb.NO_LOGGING&&k.a.Log(Wd("importScene",f?f.producer:"Unknown")+(yb.loggingLevel!==yb.MINIMAL_LOGGING?d:""))}return!1},loadAssetContainer:function(e,b,a,c){return pj(e,b,a,c)}});var wn=o(111),qj=function(){function e(){this._isEnabled=!0,this.leftColor=G.a.White(),this.rightColor=G.a.Black(),this.bias=0,this.power=1}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(b){this._isEnabled!==b&&(this._isEnabled=b,Ha.a.MarkAllMaterialsAsDirty(p.a.MATERIAL_FresnelDirtyFlag|p.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var b=new e();return P.a.DeepCopy(this,b),b},e.prototype.serialize=function(){var b={};return b.isEnabled=this.isEnabled,b.leftColor=this.leftColor.asArray(),b.rightColor=this.rightColor.asArray(),b.bias=this.bias,b.power=this.power,b},e.Parse=function(b){var a=new e();return a.isEnabled=b.isEnabled,a.leftColor=G.a.FromArray(b.leftColor),a.rightColor=G.a.FromArray(b.rightColor),a.bias=b.bias,a.power=b.power||1,a},e}();F.a._FresnelParametersParser=qj.Parse;var Sg=function(e){function b(a,c){var d=e.call(this,a,c)||this;return d.maxSimultaneousLights=4,d.disableLighting=!1,d.invertNormalMapX=!1,d.invertNormalMapY=!1,d.emissiveColor=new G.a(0,0,0),d.occlusionStrength=1,d.useLightmapAsShadowmap=!1,d._useAlphaFromAlbedoTexture=!0,d._useAmbientInGrayScale=!0,d}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(a){this._twoSidedLighting!==a&&(this._twoSidedLighting=a,this.backFaceCulling=!a,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsLightsDirty")],b.prototype,"maxSimultaneousLights",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsLightsDirty")],b.prototype,"disableLighting",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],b.prototype,"environmentTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"invertNormalMapX",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"invertNormalMapY",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],b.prototype,"normalTexture",void 0),Object(l.c)([Object(F.e)("emissive"),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"emissiveColor",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"emissiveTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],b.prototype,"occlusionStrength",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],b.prototype,"occlusionTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],b.prototype,"alphaCutOff",void 0),Object(l.c)([Object(F.c)()],b.prototype,"doubleSided",null),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty",null)],b.prototype,"lightmapTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"useLightmapAsShadowmap",void 0),b}(ec),rj=function(e){function b(a,c){var d=e.call(this,a,c)||this;return d._useRoughnessFromMetallicTextureAlpha=!1,d._useRoughnessFromMetallicTextureGreen=!0,d._useMetallnessFromMetallicTextureBlue=!0,d.metallic=1,d.roughness=1,d}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},b.prototype.clone=function(a){var c=this,d=F.a.Clone(function(){return new b(a,c.getScene())},this);return d.id=a,d.name=a,this.clearCoat.copyTo(d.clearCoat),this.anisotropy.copyTo(d.anisotropy),this.brdf.copyTo(d.brdf),this.sheen.copyTo(d.sheen),this.subSurface.copyTo(d.subSurface),d},b.prototype.serialize=function(){var a=F.a.Serialize(this);return a.customType="BABYLON.PBRMetallicRoughnessMaterial",a.clearCoat=this.clearCoat.serialize(),a.anisotropy=this.anisotropy.serialize(),a.brdf=this.brdf.serialize(),a.sheen=this.sheen.serialize(),a.subSurface=this.subSurface.serialize(),a},b.Parse=function(a,c,d){var f=F.a.Parse(function(){return new b(a.name,c)},a,c,d);return a.clearCoat&&f.clearCoat.parse(a.clearCoat,c,d),a.anisotropy&&f.anisotropy.parse(a.anisotropy,c,d),a.brdf&&f.brdf.parse(a.brdf,c,d),a.sheen&&f.sheen.parse(a.sheen,c,d),a.subSurface&&f.subSurface.parse(a.subSurface,c,d),f},Object(l.c)([Object(F.e)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],b.prototype,"baseColor",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],b.prototype,"baseTexture",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"metallic",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty")],b.prototype,"roughness",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],b.prototype,"metallicRoughnessTexture",void 0),b}(Sg);D.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessMaterial"]=rj;var sj=function(e){function b(a,c){var d=e.call(this,a,c)||this;return d._useMicroSurfaceFromReflectivityMapAlpha=!0,d}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},b.prototype.clone=function(a){var c=this,d=F.a.Clone(function(){return new b(a,c.getScene())},this);return d.id=a,d.name=a,this.clearCoat.copyTo(d.clearCoat),this.anisotropy.copyTo(d.anisotropy),this.brdf.copyTo(d.brdf),this.sheen.copyTo(d.sheen),this.subSurface.copyTo(d.subSurface),d},b.prototype.serialize=function(){var a=F.a.Serialize(this);return a.customType="BABYLON.PBRSpecularGlossinessMaterial",a.clearCoat=this.clearCoat.serialize(),a.anisotropy=this.anisotropy.serialize(),a.brdf=this.brdf.serialize(),a.sheen=this.sheen.serialize(),a.subSurface=this.subSurface.serialize(),a},b.Parse=function(a,c,d){var f=F.a.Parse(function(){return new b(a.name,c)},a,c,d);return a.clearCoat&&f.clearCoat.parse(a.clearCoat,c,d),a.anisotropy&&f.anisotropy.parse(a.anisotropy,c,d),a.brdf&&f.brdf.parse(a.brdf,c,d),a.sheen&&f.sheen.parse(a.sheen,c,d),a.subSurface&&f.subSurface.parse(a.subSurface,c,d),f},Object(l.c)([Object(F.e)("diffuse"),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],b.prototype,"diffuseColor",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],b.prototype,"diffuseTexture",void 0),Object(l.c)([Object(F.e)("specular"),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],b.prototype,"specularColor",void 0),Object(l.c)([Object(F.c)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_microSurface")],b.prototype,"glossiness",void 0),Object(l.c)([Object(F.m)(),Object(F.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],b.prototype,"specularGlossinessTexture",void 0),b}(Sg);D.a.RegisteredTypes["BABYLON.PBRSpecularGlossinessMaterial"]=sj;var vf=o(82),tj=function(e){function b(a,c){var d=e.call(this,c)||this;return a?(d._engine=c.getEngine(),d._textureMatrix=i.a.Identity(),d.name=a,d.url=a,d.hasAlpha=!1,d.isCube=!1,d.is3D=d._engine.webGLVersion>1,d.wrapU=p.a.TEXTURE_CLAMP_ADDRESSMODE,d.wrapV=p.a.TEXTURE_CLAMP_ADDRESSMODE,d.wrapR=p.a.TEXTURE_CLAMP_ADDRESSMODE,d.anisotropicFilteringLevel=1,d._texture=d._getFromCache(a,!0),d._texture||(c.useDelayedTextureLoading?d.delayLoadState=p.a.DELAYLOADSTATE_NOTLOADED:d.loadTexture()),d):d}return Object(l.d)(b,e),b.prototype.getTextureMatrix=function(){return this._textureMatrix},b.prototype.load3dlTexture=function(){var a,c=this._engine;a=1===c.webGLVersion?c.createRawTexture(null,1,1,p.a.TEXTUREFORMAT_RGBA,!1,!1,p.a.TEXTURE_BILINEAR_SAMPLINGMODE,null,p.a.TEXTURETYPE_UNSIGNED_INT):c.createRawTexture3D(null,1,1,1,p.a.TEXTUREFORMAT_RGBA,!1,!1,p.a.TEXTURE_BILINEAR_SAMPLINGMODE,null,p.a.TEXTURETYPE_UNSIGNED_INT),this._texture=a;var d=function(g){if("string"==typeof g){for(var h,j=null,m=null,w=g.split(`
`),z=0,C=0,J=0,K=0,N=0,T=0;T<w.length;T++)if(h=w[T],b._noneEmptyLineRegex.test(h)&&0!==h.indexOf("#")){var Z=h.split(" ");if(0!==z){if(0!=z){var _=Math.max(parseInt(Z[0]),0),ca=Math.max(parseInt(Z[1]),0),ea=Math.max(parseInt(Z[2]),0);N=Math.max(_,N),N=Math.max(ca,N),N=Math.max(ea,N);var fa=4*(C+K*z+J*z*z);m&&(m[fa+0]=_,m[fa+1]=ca,m[fa+2]=ea),++J%z==0&&(J=0,++K%z==0&&(C++,K=0))}}else z=Z.length,j=new Uint8Array(z*z*z*4),m=new Float32Array(z*z*z*4)}if(m&&j)for(T=0;T<m.length;T++)if(T>0&&(T+1)%4==0)j[T]=255;else{var ka=m[T];j[T]=ka/N*255}a.is3D?(a.updateSize(z,z,z),c.updateRawTexture3D(a,j,p.a.TEXTUREFORMAT_RGBA,!1)):(a.updateSize(z*z,z),c.updateRawTexture(a,j,p.a.TEXTUREFORMAT_RGBA,!1))}},f=this.getScene();return f?f._loadFile(this.url,d):this._engine._loadFile(this.url,d),this._texture},b.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},b.prototype.clone=function(){var a=new b(this.url,this.getScene());return a.level=this.level,a},b.prototype.delayLoad=function(){this.delayLoadState===p.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=p.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},b.Parse=function(a,c){var d=null;return a.name&&!a.isRenderTarget&&((d=new b(a.name,c)).name=a.name,d.level=a.level),d},b.prototype.serialize=function(){if(!this.name)return null;var a={};return a.name=this.name,a.level=this.level,a.customType="BABYLON.ColorGradingTexture",a},b._noneEmptyLineRegex=/\S+/,b}(hc.a);D.a.RegisteredTypes["BABYLON.ColorGradingTexture"]=tj;var uj=function(e){function b(a,c,d,f,g,h,j){void 0===f&&(f=!1),void 0===g&&(g=!0),void 0===h&&(h=null),void 0===j&&(j=null);var m=e.call(this,c)||this;if(m._onLoad=null,m._onError=null,m.coordinatesMode=ya.a.CUBIC_MODE,!a)throw new Error("Image url is not set");return m.name=a,m.url=a,m._size=d,m._noMipmap=f,m.gammaSpace=g,m._onLoad=h,m._onError=j,m.hasAlpha=!1,m.isCube=!0,m._texture=m._getFromCache(a,m._noMipmap),m._texture?h&&(m._texture.isReady?Qa.b.SetImmediate(function(){return h()}):m._texture.onLoadedObservable.add(h)):c.useDelayedTextureLoading?m.delayLoadState=p.a.DELAYLOADSTATE_NOTLOADED:m.loadImage(m.loadTexture.bind(m),m._onError),m}return Object(l.d)(b,e),b.prototype.loadImage=function(a,c){var d=this,f=document.createElement("canvas"),g=new Image();g.addEventListener("load",function(){d._width=g.width,d._height=g.height,f.width=d._width,f.height=d._height;var h=f.getContext("2d");h.drawImage(g,0,0);var j=h.getImageData(0,0,g.width,g.height);d._buffer=j.data.buffer,f.remove(),a()}),g.addEventListener("error",function(h){c&&c(d.getClassName()+" could not be loaded",h)}),g.src=this.url},b.prototype.loadTexture=function(){var a=this,c=this.getScene();c&&(this._texture=c.getEngine().createRawCubeTextureFromUrl(this.url,c,this._size,p.a.TEXTUREFORMAT_RGB,c.getEngine().getCaps().textureFloat?p.a.TEXTURETYPE_FLOAT:p.a.TEXTURETYPE_UNSIGNED_INTEGER,this._noMipmap,function(){for(var d=a.getFloat32ArrayFromArrayBuffer(a._buffer),f=Og.ConvertPanoramaToCubemap(d,a._width,a._height,a._size),g=[],h=0;h<6;h++){var j=f[b._FacesMapping[h]];g.push(j)}return g},null,this._onLoad,this._onError))},b.prototype.getFloat32ArrayFromArrayBuffer=function(a){for(var c=new DataView(a),d=new Float32Array(3*a.byteLength/4),f=0,g=0;g<a.byteLength;g++)(g+1)%4!=0&&(d[f++]=c.getUint8(g)/255);return d},b.prototype.getClassName=function(){return"EquiRectangularCubeTexture"},b.prototype.clone=function(){var a=this.getScene();if(!a)return this;var c=new b(this.url,a,this._size,this._noMipmap,this.gammaSpace);return c.level=this.level,c.wrapU=this.wrapU,c.wrapV=this.wrapV,c.coordinatesIndex=this.coordinatesIndex,c.coordinatesMode=this.coordinatesMode,c},b._FacesMapping=["right","left","up","down","front","back"],b}(hc.a),wf=function(){function e(){}return e.GetTGAHeader=function(b){var a=0;return{id_length:b[a++],colormap_type:b[a++],image_type:b[a++],colormap_index:b[a++]|b[a++]<<8,colormap_length:b[a++]|b[a++]<<8,colormap_size:b[a++],origin:[b[a++]|b[a++]<<8,b[a++]|b[a++]<<8],width:b[a++]|b[a++]<<8,height:b[a++]|b[a++]<<8,pixel_size:b[a++],flags:b[a++]}},e.UploadContent=function(b,a){if(a.length<19)k.a.Error("Unable to load TGA file - Not enough data to contain header");else{var c=18,d=e.GetTGAHeader(a);if(d.id_length+c>a.length)k.a.Error("Unable to load TGA file - Not enough data");else{c+=d.id_length;var f,g=!1,h=!1,j=!1;switch(d.image_type){case e._TYPE_RLE_INDEXED:g=!0;case e._TYPE_INDEXED:h=!0;break;case e._TYPE_RLE_RGB:g=!0;case e._TYPE_RGB:break;case e._TYPE_RLE_GREY:g=!0;case e._TYPE_GREY:j=!0}var m,w,z,C,J,K,N,T=d.pixel_size>>3,Z=d.width*d.height*T;if(h&&(m=a.subarray(c,c+=d.colormap_length*(d.colormap_size>>3))),g){var _,ca,ea;f=new Uint8Array(Z);for(var fa=0,ka=new Uint8Array(T);c<Z&&fa<Z;)if(ca=1+(127&(_=a[c++])),128&_){for(ea=0;ea<T;++ea)ka[ea]=a[c++];for(ea=0;ea<ca;++ea)f.set(ka,fa+ea*T);fa+=T*ca}else{for(ca*=T,ea=0;ea<ca;++ea)f[fa+ea]=a[c++];fa+=ca}}else f=a.subarray(c,c+=h?d.width*d.height:Z);switch((d.flags&e._ORIGIN_MASK)>>e._ORIGIN_SHIFT){default:case e._ORIGIN_UL:w=0,C=1,N=d.width,z=0,J=1,K=d.height;break;case e._ORIGIN_BL:w=0,C=1,N=d.width,z=d.height-1,J=-1,K=-1;break;case e._ORIGIN_UR:w=d.width-1,C=-1,N=-1,z=0,J=1,K=d.height;break;case e._ORIGIN_BR:w=d.width-1,C=-1,N=-1,z=d.height-1,J=-1,K=-1}var pa=e["_getImageData"+(j?"Grey":"")+d.pixel_size+"bits"](d,m,f,z,J,K,w,C,N);b.getEngine()._uploadDataToTextureDirectly(b,pa)}}},e._getImageData8bits=function(b,a,c,d,f,g,h,j,m){var w,z,C,J=c,K=a,N=b.width,T=b.height,Z=0,_=new Uint8Array(N*T*4);for(C=d;C!==g;C+=f)for(z=h;z!==m;z+=j,Z++)w=J[Z],_[4*(z+N*C)+3]=255,_[4*(z+N*C)+2]=K[3*w+0],_[4*(z+N*C)+1]=K[3*w+1],_[4*(z+N*C)+0]=K[3*w+2];return _},e._getImageData16bits=function(b,a,c,d,f,g,h,j,m){var w,z,C,J=c,K=b.width,N=b.height,T=0,Z=new Uint8Array(K*N*4);for(C=d;C!==g;C+=f)for(z=h;z!==m;z+=j,T+=2){var _=255*((31744&(w=J[T+0]+(J[T+1]<<8)))>>10)/31|0,ca=255*((992&w)>>5)/31|0,ea=255*(31&w)/31|0;Z[4*(z+K*C)+0]=_,Z[4*(z+K*C)+1]=ca,Z[4*(z+K*C)+2]=ea,Z[4*(z+K*C)+3]=32768&w?0:255}return Z},e._getImageData24bits=function(b,a,c,d,f,g,h,j,m){var w,z,C=c,J=b.width,K=b.height,N=0,T=new Uint8Array(J*K*4);for(z=d;z!==g;z+=f)for(w=h;w!==m;w+=j,N+=3)T[4*(w+J*z)+3]=255,T[4*(w+J*z)+2]=C[N+0],T[4*(w+J*z)+1]=C[N+1],T[4*(w+J*z)+0]=C[N+2];return T},e._getImageData32bits=function(b,a,c,d,f,g,h,j,m){var w,z,C=c,J=b.width,K=b.height,N=0,T=new Uint8Array(J*K*4);for(z=d;z!==g;z+=f)for(w=h;w!==m;w+=j,N+=4)T[4*(w+J*z)+2]=C[N+0],T[4*(w+J*z)+1]=C[N+1],T[4*(w+J*z)+0]=C[N+2],T[4*(w+J*z)+3]=C[N+3];return T},e._getImageDataGrey8bits=function(b,a,c,d,f,g,h,j,m){var w,z,C,J=c,K=b.width,N=b.height,T=0,Z=new Uint8Array(K*N*4);for(C=d;C!==g;C+=f)for(z=h;z!==m;z+=j,T++)w=J[T],Z[4*(z+K*C)+0]=w,Z[4*(z+K*C)+1]=w,Z[4*(z+K*C)+2]=w,Z[4*(z+K*C)+3]=255;return Z},e._getImageDataGrey16bits=function(b,a,c,d,f,g,h,j,m){var w,z,C=c,J=b.width,K=b.height,N=0,T=new Uint8Array(J*K*4);for(z=d;z!==g;z+=f)for(w=h;w!==m;w+=j,N+=2)T[4*(w+J*z)+0]=C[N+0],T[4*(w+J*z)+1]=C[N+0],T[4*(w+J*z)+2]=C[N+0],T[4*(w+J*z)+3]=C[N+1];return T},e._TYPE_INDEXED=1,e._TYPE_RGB=2,e._TYPE_GREY=3,e._TYPE_RLE_INDEXED=9,e._TYPE_RLE_RGB=10,e._TYPE_RLE_GREY=11,e._ORIGIN_MASK=48,e._ORIGIN_SHIFT=4,e._ORIGIN_BL=0,e._ORIGIN_BR=1,e._ORIGIN_UL=2,e._ORIGIN_UR=3,e}(),vj=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(b){return oc.a.EndsWith(b,".tga")},e.prototype.loadCubeData=function(b,a,c,d,f){throw".env not supported in Cube."},e.prototype.loadData=function(b,a,c){var d=new Uint8Array(b.buffer,b.byteOffset,b.byteLength),f=wf.GetTGAHeader(d);c(f.width,f.height,a.generateMipMaps,!1,function(){wf.UploadContent(a,d)})},e}();Ha.a._TextureLoaders.push(new vj());var Fe,xn=function(){};!function(e){e[e.cTFETC1=0]="cTFETC1",e[e.cTFBC1=1]="cTFBC1",e[e.cTFBC4=2]="cTFBC4",e[e.cTFPVRTC1_4_OPAQUE_ONLY=3]="cTFPVRTC1_4_OPAQUE_ONLY",e[e.cTFBC7_M6_OPAQUE_ONLY=4]="cTFBC7_M6_OPAQUE_ONLY",e[e.cTFETC2=5]="cTFETC2",e[e.cTFBC3=6]="cTFBC3",e[e.cTFBC5=7]="cTFBC5"}(Fe||(Fe={}));var Ge=function(){function e(){}return e.GetInternalFormatFromBasisFormat=function(b){if(b===Fe.cTFETC1)return 36196;if(b===Fe.cTFBC1)return 33776;if(b===Fe.cTFBC3)return 33779;throw"The chosen Basis transcoder format is not currently supported"},e._CreateWorkerAsync=function(){var b=this;return this._WorkerPromise||(this._WorkerPromise=new Promise(function(a){b._Worker?a(b._Worker):Qa.b.LoadFileAsync(e.WasmModuleURL).then(function(c){var d=URL.createObjectURL(new Blob(["("+yn+")()"],{type:"application/javascript"}));b._Worker=new Worker(d);var f=function(g){"init"===g.data.action&&(b._Worker.removeEventListener("message",f),a(b._Worker))};b._Worker.addEventListener("message",f),b._Worker.postMessage({action:"init",url:e.JSModuleURL,wasmBinary:c})})})),this._WorkerPromise},e.TranscodeAsync=function(b,a){var c=this,d=b instanceof ArrayBuffer?new Uint8Array(b):b;return new Promise(function(f,g){c._CreateWorkerAsync().then(function(){var h=c._actionId++,j=function(w){"transcode"===w.data.action&&w.data.id===h&&(c._Worker.removeEventListener("message",j),w.data.success?f(w.data):g("Transcode is not supported on this device"))};c._Worker.addEventListener("message",j);var m=new Uint8Array(d.byteLength);m.set(new Uint8Array(d.buffer,d.byteOffset,d.byteLength)),c._Worker.postMessage({action:"transcode",id:h,imageData:m,config:a,ignoreSupportedFormats:c._IgnoreSupportedFormats},[m.buffer])})})},e.LoadTextureFromTranscodeResult=function(b,a){for(var c,d=b.getEngine(),f=function(){if(c=a.fileInfo.images[g].levels[0],b._invertVScale=b.invertY,-1===a.format)if(b.type=p.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,b.format=p.a.TEXTUREFORMAT_RGB,d.webGLVersion<2&&(aa.a.Log2(c.width)%1!=0||aa.a.Log2(c.height)%1!=0)){var h=new mb.a(d,mb.b.Temp);b._invertVScale=b.invertY,h.type=p.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,h.format=p.a.TEXTUREFORMAT_RGB,h.width=c.width+3&-4,h.height=c.height+3&-4,d._bindTextureDirectly(d._gl.TEXTURE_2D,h,!0),d._uploadDataToTextureDirectly(h,c.transcodedPixels,g,0,p.a.TEXTUREFORMAT_RGB,!0),d._rescaleTexture(h,b,d.scenes[0],d._getInternalFormat(p.a.TEXTUREFORMAT_RGB),function(){d._releaseTexture(h),d._bindTextureDirectly(d._gl.TEXTURE_2D,b,!0)})}else b._invertVScale=!b.invertY,b.width=c.width+3&-4,b.height=c.height+3&-4,d._uploadDataToTextureDirectly(b,c.transcodedPixels,g,0,p.a.TEXTUREFORMAT_RGB,!0);else b.width=c.width,b.height=c.height,a.fileInfo.images[g].levels.forEach(function(j,m){d._uploadCompressedDataToTextureDirectly(b,e.GetInternalFormatFromBasisFormat(a.format),j.width,j.height,j.transcodedPixels,g,m)}),d.webGLVersion<2&&(aa.a.Log2(b.width)%1!=0||aa.a.Log2(b.height)%1!=0)&&(Qa.b.Warn("Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."),b._cachedWrapU=ya.a.CLAMP_ADDRESSMODE,b._cachedWrapV=ya.a.CLAMP_ADDRESSMODE)},g=0;g<a.fileInfo.images.length;g++)f()},e._IgnoreSupportedFormats=!1,e.JSModuleURL="https://preview.babylonjs.com/basisTranscoder/basis_transcoder.js",e.WasmModuleURL="https://preview.babylonjs.com/basisTranscoder/basis_transcoder.wasm",e._WorkerPromise=null,e._Worker=null,e._actionId=0,e}();function yn(){var e={cTFETC1:0,cTFBC1:1,cTFBC4:2,cTFPVRTC1_4_OPAQUE_ONLY:3,cTFBC7_M6_OPAQUE_ONLY:4,cTFETC2:5,cTFBC3:6,cTFBC5:7},b=null;function a(c,d,f,g,h){var j=c.getImageTranscodedSizeInBytes(d,f,g),m=new Uint8Array(j);return c.transcodeImage(m,d,f,g,1,0)?(h&&(m=function(w,z,C,J){for(var K=new Uint16Array(4),N=new Uint16Array(C*J),T=C/4,Z=J/4,_=0;_<Z;_++)for(var ca=0;ca<T;ca++){var ea=z+8*(_*T+ca);K[0]=w[ea]|w[ea+1]<<8,K[1]=w[ea+2]|w[ea+3]<<8,K[2]=(2*(31&K[0])+1*(31&K[1]))/3|(2*(2016&K[0])+1*(2016&K[1]))/3&2016|(2*(63488&K[0])+1*(63488&K[1]))/3&63488,K[3]=(2*(31&K[1])+1*(31&K[0]))/3|(2*(2016&K[1])+1*(2016&K[0]))/3&2016|(2*(63488&K[1])+1*(63488&K[0]))/3&63488;for(var fa=0;fa<4;fa++){var ka=w[ea+4+fa],pa=(4*_+fa)*C+4*ca;N[pa++]=K[3&ka],N[pa++]=K[ka>>2&3],N[pa++]=K[ka>>4&3],N[pa++]=K[ka>>6&3]}}return N}(m,0,c.getImageWidth(d,f)+3&-4,c.getImageHeight(d,f)+3&-4)),m):null}onmessage=function(c){if("init"===c.data.action)b||(Module={wasmBinary:c.data.wasmBinary},importScripts(c.data.url),b=new Promise(function(_){Module.onRuntimeInitialized=function(){Module.initializeBasis(),_()}})),b.then(function(){postMessage({action:"init"})});else if("transcode"===c.data.action){var d=c.data.config,f=c.data.imageData,g=new Module.BasisFile(f),h=function(_){for(var ca=_.getHasAlpha(),ea=_.getNumImages(),fa=[],ka=0;ka<ea;ka++){for(var pa={levels:[]},va=_.getNumLevels(ka),sa=0;sa<va;sa++){var la={width:_.getImageWidth(ka,sa),height:_.getImageHeight(ka,sa)};pa.levels.push(la)}fa.push(pa)}return{hasAlpha:ca,images:fa}}(g),j=c.data.ignoreSupportedFormats?null:function(_,ca){var ea=null;return _.supportedCompressionFormats&&(_.supportedCompressionFormats.etc1?ea=e.cTFETC1:_.supportedCompressionFormats.s3tc?ea=ca.hasAlpha?e.cTFBC3:e.cTFBC1:_.supportedCompressionFormats.pvrtc||_.supportedCompressionFormats.etc2&&(ea=e.cTFETC2)),ea}(c.data.config,h),m=!1;null===j&&(m=!0,j=h.hasAlpha?e.cTFBC3:e.cTFBC1);var w=!0;g.startTranscoding()||(w=!1);for(var z=[],C=0;C<h.images.length&&w;C++){var J=h.images[C];if(void 0===d.loadSingleImage||d.loadSingleImage===C){var K=J.levels.length;!1===d.loadMipmapLevels&&(K=1);for(var N=0;N<K;N++){var T=J.levels[N],Z=a(g,C,N,j,m);if(!Z){w=!1;break}T.transcodedPixels=Z,z.push(T.transcodedPixels.buffer)}}}g.close(),g.delete(),m&&(j=-1),w?postMessage({action:"transcode",success:w,id:c.data.id,fileInfo:h,format:j},z):postMessage({action:"transcode",success:w,id:c.data.id})}}}var wj=function(){function e(){this.supportCascades=!0}return e.prototype.canLoad=function(b){return oc.a.EndsWith(b,".basis")},e.prototype.loadCubeData=function(b,a,c,d,f){if(!Array.isArray(b)){var g=a.getEngine().getCaps(),h={supportedCompressionFormats:{etc1:!!g.etc1,s3tc:!!g.s3tc,pvrtc:!!g.pvrtc,etc2:!!g.etc2}};Ge.TranscodeAsync(b,h).then(function(j){var m=j.fileInfo.images[0].levels.length>1&&a.generateMipMaps;Ge.LoadTextureFromTranscodeResult(a,j),a.getEngine()._setCubeMapTextureParams(m),a.isReady=!0,a.onLoadedObservable.notifyObservers(a),a.onLoadedObservable.clear(),d&&d()}).catch(function(j){Qa.b.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),a.isReady=!0})}},e.prototype.loadData=function(b,a,c){var d=a.getEngine().getCaps(),f={supportedCompressionFormats:{etc1:!!d.etc1,s3tc:!!d.s3tc,pvrtc:!!d.pvrtc,etc2:!!d.etc2}};Ge.TranscodeAsync(b,f).then(function(g){var h=g.fileInfo.images[0].levels[0],j=g.fileInfo.images[0].levels.length>1&&a.generateMipMaps;c(h.width,h.height,j,-1!==g.format,function(){Ge.LoadTextureFromTranscodeResult(a,g)})}).catch(function(g){Qa.b.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),c(0,0,!1,!1,function(){})})},e}();Ha.a._TextureLoaders.push(new wj()),Cb.a.prototype.unBindMultiColorAttachmentFramebuffer=function(e,b,a){void 0===b&&(b=!1),this._currentRenderTarget=null;var c=this._gl;if(e[0]._MSAAFramebuffer){c.bindFramebuffer(c.READ_FRAMEBUFFER,e[0]._MSAAFramebuffer),c.bindFramebuffer(c.DRAW_FRAMEBUFFER,e[0]._framebuffer);var d=e[0]._attachments;d||(d=new Array(e.length),e[0]._attachments=d);for(var f=0;f<e.length;f++){for(var g=e[f],h=0;h<d.length;h++)d[h]=c.NONE;d[f]=c[this.webGLVersion>1?"COLOR_ATTACHMENT"+f:"COLOR_ATTACHMENT"+f+"_WEBGL"],c.readBuffer(d[f]),c.drawBuffers(d),c.blitFramebuffer(0,0,g.width,g.height,0,0,g.width,g.height,c.COLOR_BUFFER_BIT,c.NEAREST)}for(f=0;f<d.length;f++)d[f]=c[this.webGLVersion>1?"COLOR_ATTACHMENT"+f:"COLOR_ATTACHMENT"+f+"_WEBGL"];c.drawBuffers(d)}for(f=0;f<e.length;f++)!(g=e[f]).generateMipMaps||b||g.isCube||(this._bindTextureDirectly(c.TEXTURE_2D,g,!0),c.generateMipmap(c.TEXTURE_2D),this._bindTextureDirectly(c.TEXTURE_2D,null));a&&(e[0]._MSAAFramebuffer&&this._bindUnboundFramebuffer(e[0]._framebuffer),a()),this._bindUnboundFramebuffer(null)},Cb.a.prototype.createMultipleRenderTarget=function(e,b){var a=!1,c=!0,d=!1,f=!1,g=1,h=p.a.TEXTURETYPE_UNSIGNED_INT,j=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE,m=new Array(),w=new Array();void 0!==b&&(a=void 0!==b.generateMipMaps&&b.generateMipMaps,c=void 0===b.generateDepthBuffer||b.generateDepthBuffer,d=void 0!==b.generateStencilBuffer&&b.generateStencilBuffer,f=void 0!==b.generateDepthTexture&&b.generateDepthTexture,g=b.textureCount||1,b.types&&(m=b.types),b.samplingModes&&(w=b.samplingModes));var z=this._gl,C=z.createFramebuffer();this._bindUnboundFramebuffer(C);for(var J=e.width||e,K=e.height||e,N=[],T=[],Z=this._setupFramebufferDepthAttachments(d,c,J,K),_=0;_<g;_++){var ca=w[_]||j,ea=m[_]||h;(ea!==p.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(ea!==p.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(ca=p.a.TEXTURE_NEAREST_SAMPLINGMODE);var fa=this._getSamplingParameters(ca,a);ea!==p.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(ea=p.a.TEXTURETYPE_UNSIGNED_INT,k.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var ka=new mb.a(this,mb.b.MultiRenderTarget),pa=z[this.webGLVersion>1?"COLOR_ATTACHMENT"+_:"COLOR_ATTACHMENT"+_+"_WEBGL"];N.push(ka),T.push(pa),z.activeTexture(z["TEXTURE"+_]),z.bindTexture(z.TEXTURE_2D,ka._webGLTexture),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,fa.mag),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,fa.min),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texImage2D(z.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(ea),J,K,0,z.RGBA,this._getWebGLTextureType(ea),null),z.framebufferTexture2D(z.DRAW_FRAMEBUFFER,pa,z.TEXTURE_2D,ka._webGLTexture,0),a&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(z.TEXTURE_2D,null),ka._framebuffer=C,ka._depthStencilBuffer=Z,ka.baseWidth=J,ka.baseHeight=K,ka.width=J,ka.height=K,ka.isReady=!0,ka.samples=1,ka.generateMipMaps=a,ka.samplingMode=ca,ka.type=ea,ka._generateDepthBuffer=c,ka._generateStencilBuffer=d,ka._attachments=T,this._internalTexturesCache.push(ka)}if(f&&this._caps.depthTextureExtension){var va=new mb.a(this,mb.b.MultiRenderTarget);z.activeTexture(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,va._webGLTexture),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texImage2D(z.TEXTURE_2D,0,this.webGLVersion<2?z.DEPTH_COMPONENT:z.DEPTH_COMPONENT16,J,K,0,z.DEPTH_COMPONENT,z.UNSIGNED_SHORT,null),z.framebufferTexture2D(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,z.TEXTURE_2D,va._webGLTexture,0),va._framebuffer=C,va.baseWidth=J,va.baseHeight=K,va.width=J,va.height=K,va.isReady=!0,va.samples=1,va.generateMipMaps=a,va.samplingMode=z.NEAREST,va._generateDepthBuffer=c,va._generateStencilBuffer=d,N.push(va),this._internalTexturesCache.push(va)}return z.drawBuffers(T),this._bindUnboundFramebuffer(null),this.resetTextureCache(),N},Cb.a.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,b){if(this.webGLVersion<2||!e||0==e.length)return 1;if(e[0].samples===b)return b;var a=this._gl;b=Math.min(b,this.getCaps().maxMSAASamples),e[0]._depthStencilBuffer&&(a.deleteRenderbuffer(e[0]._depthStencilBuffer),e[0]._depthStencilBuffer=null),e[0]._MSAAFramebuffer&&(a.deleteFramebuffer(e[0]._MSAAFramebuffer),e[0]._MSAAFramebuffer=null);for(var c=0;c<e.length;c++)e[c]._MSAARenderBuffer&&(a.deleteRenderbuffer(e[c]._MSAARenderBuffer),e[c]._MSAARenderBuffer=null);if(b>1&&a.renderbufferStorageMultisample){var d=a.createFramebuffer();if(!d)throw new Error("Unable to create multi sampled framebuffer");this._bindUnboundFramebuffer(d);var f=this._setupFramebufferDepthAttachments(e[0]._generateStencilBuffer,e[0]._generateDepthBuffer,e[0].width,e[0].height,b),g=[];for(c=0;c<e.length;c++){var h=e[c],j=a[this.webGLVersion>1?"COLOR_ATTACHMENT"+c:"COLOR_ATTACHMENT"+c+"_WEBGL"],m=a.createRenderbuffer();if(!m)throw new Error("Unable to create multi sampled framebuffer");a.bindRenderbuffer(a.RENDERBUFFER,m),a.renderbufferStorageMultisample(a.RENDERBUFFER,b,this._getRGBAMultiSampleBufferFormat(h.type),h.width,h.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,j,a.RENDERBUFFER,m),h._MSAAFramebuffer=d,h._MSAARenderBuffer=m,h.samples=b,h._depthStencilBuffer=f,a.bindRenderbuffer(a.RENDERBUFFER,null),g.push(j)}a.drawBuffers(g)}else this._bindUnboundFramebuffer(e[0]._framebuffer);return this._bindUnboundFramebuffer(null),b};var xj=function(e){function b(a,c,d,f,g){var h=this,j=!(!g||!g.generateMipMaps)&&g.generateMipMaps,m=!(!g||!g.generateDepthTexture)&&g.generateDepthTexture,w=!g||void 0===g.doNotChangeAspectRatio||g.doNotChangeAspectRatio;if((h=e.call(this,a,c,f,j,w)||this)._engine=f.getEngine(),h.isSupported){for(var z=[],C=[],J=0;J<d;J++)g&&g.types&&void 0!==g.types[J]?z.push(g.types[J]):z.push(g&&g.defaultType?g.defaultType:p.a.TEXTURETYPE_UNSIGNED_INT),g&&g.samplingModes&&void 0!==g.samplingModes[J]?C.push(g.samplingModes[J]):C.push(ya.a.BILINEAR_SAMPLINGMODE);var K=!g||void 0===g.generateDepthBuffer||g.generateDepthBuffer,N=!(!g||void 0===g.generateStencilBuffer)&&g.generateStencilBuffer;return h._size=c,h._multiRenderTargetOptions={samplingModes:C,generateMipMaps:j,generateDepthBuffer:K,generateStencilBuffer:N,generateDepthTexture:m,types:z,textureCount:d},h._createInternalTextures(),h._createTextures(),h}h.dispose()}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._engine.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"wrapU",{set:function(a){if(this._textures)for(var c=0;c<this._textures.length;c++)this._textures[c].wrapU=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"wrapV",{set:function(a){if(this._textures)for(var c=0;c<this._textures.length;c++)this._textures[c].wrapV=a},enumerable:!0,configurable:!0}),b.prototype._rebuild=function(){this.releaseInternalTextures(),this._createInternalTextures();for(var a=0;a<this._internalTextures.length;a++)this._textures[a]._texture=this._internalTextures[a];this._texture=this._internalTextures[0]},b.prototype._createInternalTextures=function(){this._internalTextures=this._engine.createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},b.prototype._createTextures=function(){this._textures=[];for(var a=0;a<this._internalTextures.length;a++){var c=new ya.a(null,this.getScene());c._texture=this._internalTextures[a],this._textures.push(c)}this._texture=this._internalTextures[0]},Object.defineProperty(b.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples!==a&&(this._samples=this._engine.updateMultipleRenderTargetTextureSampleCount(this._internalTextures,a))},enumerable:!0,configurable:!0}),b.prototype.resize=function(a){this.releaseInternalTextures(),this._size=a,this._createInternalTextures()},b.prototype.unbindFrameBuffer=function(a,c){var d=this;a.unBindMultiColorAttachmentFramebuffer(this._internalTextures,this.isCube,function(){d.onAfterRenderObservable.notifyObservers(c)})},b.prototype.dispose=function(){this.releaseInternalTextures(),e.prototype.dispose.call(this)},b.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var a=this._internalTextures.length-1;a>=0;a--)void 0!==this._internalTextures[a]&&(this._internalTextures[a].dispose(),this._internalTextures.splice(a,1))},b}(Jb),yj=function(){function e(b){this.name=_a.a.NAME_PROCEDURALTEXTURE,this.scene=b,this.scene.proceduralTextures=new Array()}return e.prototype.register=function(){this.scene._beforeClearStage.registerStep(_a.a.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){Qa.b.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var b=0;b<this.scene.proceduralTextures.length;b++){var a=this.scene.proceduralTextures[b];a._shouldRender()&&a.render()}Qa.b.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},e}(),zn=`
attribute vec2 position;

varying vec2 vPosition;
varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vPosition=position;
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`;Pa.a.ShadersStore.proceduralVertexShader=zn;var xf=function(e){function b(a,c,d,f,g,h,j){void 0===g&&(g=null),void 0===h&&(h=!0),void 0===j&&(j=!1);var m=e.call(this,null,f,!h)||this;m.isCube=j,m.isEnabled=!0,m.autoClear=!0,m.onGeneratedObservable=new I.c(),m._textures={},m._currentRefreshId=-1,m._frameId=-1,m._refreshRate=1,m._vertexBuffers={},m._uniforms=new Array(),m._samplers=new Array(),m._floats={},m._ints={},m._floatsArrays={},m._colors3={},m._colors4={},m._vectors2={},m._vectors3={},m._matrices={},m._fallbackTextureUsed=!1,m._cachedDefines="",m._contentUpdateId=-1;var w=(f=m.getScene())._getComponent(_a.a.NAME_PROCEDURALTEXTURE);w||(w=new yj(f),f._addComponent(w)),f.proceduralTextures.push(m),m._engine=f.getEngine(),m.name=a,m.isRenderTarget=!0,m._size=c,m._generateMipMaps=h,m.setFragment(d),m._fallbackTexture=g,j?(m._texture=m._engine.createRenderTargetCubeTexture(c,{generateMipMaps:h,generateDepthBuffer:!1,generateStencilBuffer:!1}),m.setFloat("face",0)):m._texture=m._engine.createRenderTargetTexture(c,{generateMipMaps:h,generateDepthBuffer:!1,generateStencilBuffer:!1});var z=[];return z.push(1,1),z.push(-1,1),z.push(-1,-1),z.push(1,-1),m._vertexBuffers[ra.b.PositionKind]=new ra.b(m._engine,z,ra.b.PositionKind,!1,!1,2),m._createIndexBuffer(),m}return Object(l.d)(b,e),b.prototype.getEffect=function(){return this._effect},b.prototype.getContent=function(){return this._contentData&&this._frameId===this._contentUpdateId?this._contentData:(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._frameId,this._contentData)},b.prototype._createIndexBuffer=function(){var a=this._engine,c=[];c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),this._indexBuffer=a.createIndexBuffer(c)},b.prototype._rebuild=function(){var a=this._vertexBuffers[ra.b.PositionKind];a&&a._rebuild(),this._createIndexBuffer(),this.refreshRate===Jb.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=Jb.REFRESHRATE_RENDER_ONCE)},b.prototype.reset=function(){void 0!==this._effect&&this._effect.dispose()},b.prototype._getDefines=function(){return""},b.prototype.isReady=function(){var a,c=this,d=this._engine;if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var f=this._getDefines();return!(!this._effect||f!==this._cachedDefines||!this._effect.isReady())||(a=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines=f,this._effect=d.createEffect(a,[ra.b.PositionKind],this._uniforms,this._samplers,f,void 0,void 0,function(){c.releaseInternalTexture(),c._fallbackTexture&&(c._texture=c._fallbackTexture._texture,c._texture&&c._texture.incrementReferences()),c._fallbackTextureUsed=!0}),this._effect.isReady())},b.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},b.prototype.setFragment=function(a){this._fragment=a},Object.defineProperty(b.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(a){this._refreshRate=a,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),b.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)},b.prototype.getRenderSize=function(){return this._size},b.prototype.resize=function(a,c){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._engine.createRenderTargetTexture(a,c),this._size=a,this._generateMipMaps=c)},b.prototype._checkUniform=function(a){-1===this._uniforms.indexOf(a)&&this._uniforms.push(a)},b.prototype.setTexture=function(a,c){return-1===this._samplers.indexOf(a)&&this._samplers.push(a),this._textures[a]=c,this},b.prototype.setFloat=function(a,c){return this._checkUniform(a),this._floats[a]=c,this},b.prototype.setInt=function(a,c){return this._checkUniform(a),this._ints[a]=c,this},b.prototype.setFloats=function(a,c){return this._checkUniform(a),this._floatsArrays[a]=c,this},b.prototype.setColor3=function(a,c){return this._checkUniform(a),this._colors3[a]=c,this},b.prototype.setColor4=function(a,c){return this._checkUniform(a),this._colors4[a]=c,this},b.prototype.setVector2=function(a,c){return this._checkUniform(a),this._vectors2[a]=c,this},b.prototype.setVector3=function(a,c){return this._checkUniform(a),this._vectors3[a]=c,this},b.prototype.setMatrix=function(a,c){return this._checkUniform(a),this._matrices[a]=c,this},b.prototype.render=function(a){var c=this.getScene();if(c){var d=this._engine;for(var f in d.enableEffect(this._effect),d.setState(!1),this._textures)this._effect.setTexture(f,this._textures[f]);for(f in this._ints)this._effect.setInt(f,this._ints[f]);for(f in this._floats)this._effect.setFloat(f,this._floats[f]);for(f in this._floatsArrays)this._effect.setArray(f,this._floatsArrays[f]);for(f in this._colors3)this._effect.setColor3(f,this._colors3[f]);for(f in this._colors4){var g=this._colors4[f];this._effect.setFloat4(f,g.r,g.g,g.b,g.a)}for(f in this._vectors2)this._effect.setVector2(f,this._vectors2[f]);for(f in this._vectors3)this._effect.setVector3(f,this._vectors3[f]);for(f in this._matrices)this._effect.setMatrix(f,this._matrices[f]);if(this._texture){if(this.isCube)for(var h=0;h<6;h++)d.bindFramebuffer(this._texture,h,void 0,void 0,!0),d.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",h),this.autoClear&&d.clear(c.clearColor,!0,!1,!1),d.drawElementsType(Hb.a.TriangleFillMode,0,6),5===h&&d.generateMipMapsForCubemap(this._texture);else d.bindFramebuffer(this._texture,0,void 0,void 0,!0),d.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&d.clear(c.clearColor,!0,!1,!1),d.drawElementsType(Hb.a.TriangleFillMode,0,6);d.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},b.prototype.clone=function(){var a=this.getSize(),c=new b(this.name,a.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return c.hasAlpha=this.hasAlpha,c.level=this.level,c.coordinatesMode=this.coordinatesMode,c},b.prototype.dispose=function(){var a=this.getScene();if(a){var c=a.proceduralTextures.indexOf(this);c>=0&&a.proceduralTextures.splice(c,1);var d=this._vertexBuffers[ra.b.PositionKind];d&&(d.dispose(),this._vertexBuffers[ra.b.PositionKind]=null),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),e.prototype.dispose.call(this)}},Object(l.c)([Object(F.c)()],b.prototype,"isEnabled",void 0),Object(l.c)([Object(F.c)()],b.prototype,"autoClear",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_generateMipMaps",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_size",void 0),Object(l.c)([Object(F.c)()],b.prototype,"refreshRate",null),b}(ya.a),Xd=o(65),An=function(e){function b(a,c,d,f,g,h){var j=e.call(this,a,d,null,f,g,h)||this;return j._animate=!0,j._time=0,j._texturePath=c,j._loadJson(c),j.refreshRate=1,j}return Object(l.d)(b,e),b.prototype._loadJson=function(a){var c=this,d=function(){k.a.Log("No config file found in "+a+" trying to use ShadersStore or DOM element");try{c.setFragment(c._texturePath)}catch(h){k.a.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},f=a+"/config.json",g=new Xd.a();g.open("GET",f),g.addEventListener("load",function(){if(200===g.status||g.responseText&&g.responseText.length>0)try{c._config=JSON.parse(g.response),c.updateShaderUniforms(),c.updateTextures(),c.setFragment(c._texturePath+"/custom"),c._animate=c._config.animate,c.refreshRate=c._config.refreshrate}catch(h){d()}else d()},!1),g.addEventListener("error",function(){d()},!1);try{g.send()}catch(h){k.a.Error("CustomProceduralTexture: Error on XHR send request.")}},b.prototype.isReady=function(){if(!e.prototype.isReady.call(this))return!1;for(var a in this._textures)if(!this._textures[a].isReady())return!1;return!0},b.prototype.render=function(a){var c=this.getScene();this._animate&&c&&(this._time+=.03*c.getAnimationRatio(),this.updateShaderUniforms()),e.prototype.render.call(this,a)},b.prototype.updateTextures=function(){for(var a=0;a<this._config.sampler2Ds.length;a++)this.setTexture(this._config.sampler2Ds[a].sample2Dname,new ya.a(this._texturePath+"/"+this._config.sampler2Ds[a].textureRelativeUrl,this.getScene()))},b.prototype.updateShaderUniforms=function(){if(this._config)for(var a=0;a<this._config.uniforms.length;a++){var c=this._config.uniforms[a];switch(c.type){case"float":this.setFloat(c.name,c.value);break;case"color3":this.setColor3(c.name,new G.a(c.r,c.g,c.b));break;case"color4":this.setColor4(c.name,new G.b(c.r,c.g,c.b,c.a));break;case"vector2":this.setVector2(c.name,new i.d(c.x,c.y));break;case"vector3":this.setVector3(c.name,new i.e(c.x,c.y,c.z))}}this.setFloat("time",this._time)},Object.defineProperty(b.prototype,"animate",{get:function(){return this._animate},set:function(a){this._animate=a},enumerable:!0,configurable:!0}),b}(xf),Bn=`

uniform float brightness;
uniform float persistence;
uniform float timeScale;

varying vec2 vUV;

vec2 hash22(vec2 p)
{
p=p*mat2(127.1,311.7,269.5,183.3);
p=-1.0+2.0*fract(sin(p)*43758.5453123);
return sin(p*6.283+timeScale);
}
float interpolationNoise(vec2 p)
{
vec2 pi=floor(p);
vec2 pf=p-pi;
vec2 w=pf*pf*(3.-2.*pf);
float f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));
float f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));
float f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));
float f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));
float xm1=mix(f00,f10,w.x);
float xm2=mix(f01,f11,w.x);
float ym=mix(xm1,xm2,w.y);
return ym;
}
float perlinNoise2D(float x,float y)
{
float sum=0.0;
float frequency=0.0;
float amplitude=0.0;
for(int i=0; i<OCTAVES; i++)
{
frequency=pow(2.0,float(i));
amplitude=pow(persistence,float(i));
sum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;
}
return sum;
}

void main(void)
{
float x=abs(vUV.x);
float y=abs(vUV.y);
float noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);
gl_FragColor=vec4(noise,noise,noise,1.0);
}
`;Pa.a.ShadersStore.noisePixelShader=Bn;var zj=function(e){function b(a,c,d,f,g){void 0===c&&(c=256),void 0===d&&(d=U.a.LastCreatedScene);var h=e.call(this,a,c,"noise",d,f,g)||this;return h._time=0,h.brightness=.2,h.octaves=3,h.persistence=.8,h.animationSpeedFactor=1,h.autoClear=!1,h._updateShaderUniforms(),h}return Object(l.d)(b,e),b.prototype._updateShaderUniforms=function(){var a=this.getScene();a&&(this._time+=a.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this._time))},b.prototype._getDefines=function(){return"#define OCTAVES "+(0|this.octaves)},b.prototype.render=function(a){this._updateShaderUniforms(),e.prototype.render.call(this,a)},b.prototype.serialize=function(){var a={customType:"BABYLON.NoiseProceduralTexture"};return a.brightness=this.brightness,a.octaves=this.octaves,a.persistence=this.persistence,a.animationSpeedFactor=this.animationSpeedFactor,a.size=this.getSize().width,a.generateMipMaps=this._generateMipMaps,a},b.Parse=function(a,c){var d=new b(a.name,a.size,c,void 0,a.generateMipMaps);return d.brightness=a.brightness,d.octaves=a.octaves,d.persistence=a.persistence,d.animationSpeedFactor=a.animationSpeedFactor,d},b}(xf);D.a.RegisteredTypes["BABYLON.NoiseProceduralTexture"]=zj;var Ia,ha,Vb,nb,mc,He,Cn=function(e){function b(a,c,d,f,g,h,j,m,w){void 0===f&&(f=p.a.TEXTUREFORMAT_RGBA),void 0===g&&(g=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=!1),void 0===j&&(j=!1),void 0===m&&(m=p.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===w&&(w=null);var z=e.call(this,"",a)||this;return z._texture=a.getEngine().createRawCubeTexture(c,d,f,g,h,j,m,w),z}return Object(l.d)(b,e),b.prototype.update=function(a,c,d,f,g){void 0===g&&(g=null),this._texture.getEngine().updateRawCubeTexture(this._texture,a,c,d,f,g)},b.prototype.updateRGBDAsync=function(a,c,d,f){return void 0===c&&(c=null),void 0===d&&(d=.8),void 0===f&&(f=0),b._UpdateRGBDAsync(this._texture,a,c,d,f)},b.prototype.clone=function(){var a=this;return F.a.Clone(function(){var c=a.getScene(),d=a._texture,f=new b(c,d._bufferViewArray,d.width,d.format,d.type,d.generateMipMaps,d.invertY,d.samplingMode,d._compression);return d.source===mb.b.CubeRawRGBD&&f.updateRGBDAsync(d._bufferViewArrayArray,d._sphericalPolynomial,d._lodGenerationScale,d._lodGenerationOffset),f},this)},b._UpdateRGBDAsync=function(a,c,d,f,g){return a._source=mb.b.CubeRawRGBD,a._bufferViewArrayArray=c,a._lodGenerationScale=f,a._lodGenerationOffset=g,a._sphericalPolynomial=d,Nc.UploadLevelsAsync(a,c).then(function(){a.isReady=!0})},b}(pc),Dn=function(e){function b(a,c,d,f,g,h,j,m,w,z){void 0===j&&(j=!0),void 0===m&&(m=!1),void 0===w&&(w=ya.a.TRILINEAR_SAMPLINGMODE),void 0===z&&(z=p.a.TEXTURETYPE_UNSIGNED_INT);var C=e.call(this,null,h,!j,m)||this;return C.format=g,C._engine=h.getEngine(),C._texture=h.getEngine().createRawTexture3D(a,c,d,f,g,j,m,w,null,z),C.is3D=!0,C}return Object(l.d)(b,e),b.prototype.update=function(a){this._texture&&this._engine.updateRawTexture3D(this._texture,a,this._texture.format,this._texture.invertY,null,this._texture.type)},b}(ya.a),En=function(e){function b(a,c,d,f,g,h,j,m,w,z){void 0===j&&(j=!0),void 0===m&&(m=!1),void 0===w&&(w=ya.a.TRILINEAR_SAMPLINGMODE),void 0===z&&(z=p.a.TEXTURETYPE_UNSIGNED_INT);var C=e.call(this,null,h,!j,m)||this;return C.format=g,C._engine=h.getEngine(),C._texture=h.getEngine().createRawTexture2DArray(a,c,d,f,g,j,m,w,null,z),C.is2DArray=!0,C}return Object(l.d)(b,e),b.prototype.update=function(a){this._texture&&this._engine.updateRawTexture2DArray(this._texture,a,this._texture.format,this._texture.invertY,null,this._texture.type)},b}(ya.a),Fn=function(e){function b(a,c,d,f){var g=e.call(this,a,c,d,f,!0)||this;return g.refractionPlane=new Kd.a(0,1,0,1),g.depth=2,g.onBeforeRenderObservable.add(function(){d.clipPlane=g.refractionPlane}),g.onAfterRenderObservable.add(function(){d.clipPlane=null}),g}return Object(l.d)(b,e),b.prototype.clone=function(){var a=this.getScene();if(!a)return this;var c=this.getSize(),d=new b(this.name,c.width,a,this._generateMipMaps);return d.hasAlpha=this.hasAlpha,d.level=this.level,d.refractionPlane=this.refractionPlane.clone(),this.renderList&&(d.renderList=this.renderList.slice(0)),d.depth=this.depth,d},b.prototype.serialize=function(){if(!this.name)return null;var a=e.prototype.serialize.call(this);return a.mirrorPlane=this.refractionPlane.asArray(),a.depth=this.depth,a},b}(Jb),Gn=function(e){function b(a,c,d){var f=e.call(this,d.scene)||this;return c&&(d.engine||d.scene)?(d=Object(l.a)(Object(l.a)({},b.DefaultOptions),d),f._engine=d.engine||d.scene.getEngine(),f._generateMipMaps=d.generateMipMaps,f._samplingMode=d.samplingMode,f._textureMatrix=i.a.Identity(),f.name=a,f.element=c,f._isVideo=c instanceof HTMLVideoElement,f.anisotropicFilteringLevel=1,f._createInternalTexture(),f):f}return Object(l.d)(b,e),b.prototype._createInternalTexture=function(){var a=0,c=0;this._isVideo?(a=this.element.videoWidth,c=this.element.videoHeight):(a=this.element.width,c=this.element.height),this._texture=this._engine.createDynamicTexture(a,c,this._generateMipMaps,this._samplingMode),this.update()},b.prototype.getTextureMatrix=function(){return this._textureMatrix},b.prototype.update=function(a){if(void 0===a&&(a=null),null!=this._texture)if(this._isVideo){var c=this.element;if(c.readyState<c.HAVE_CURRENT_DATA)return;this._engine.updateVideoTexture(this._texture,c,null===a||a)}else{var d=this.element;this._engine.updateDynamicTexture(this._texture,d,null===a||a,!1)}},b.DefaultOptions={generateMipMaps:!1,samplingMode:p.a.TEXTURE_BILINEAR_SAMPLINGMODE,engine:null,scene:null},b}(hc.a),Tg=function(e,b,a){this.id=e,this.scale=b,this.offset=a},Hn=function(){function e(b,a,c,d){return this.name=b,this.meshes=a,this.scene=d,this.options=c,this.options.map=this.options.map||["ambientTexture","bumpTexture","diffuseTexture","emissiveTexture","lightmapTexture","opacityTexture","reflectionTexture","refractionTexture","specularTexture"],this.options.uvsIn=this.options.uvsIn||ra.b.UVKind,this.options.uvsOut=this.options.uvsOut||ra.b.UVKind,this.options.layout=this.options.layout||e.LAYOUT_STRIP,this.options.layout===e.LAYOUT_COLNUM&&(this.options.colnum=this.options.colnum||8),this.options.updateInputMeshes=this.options.updateInputMeshes||!0,this.options.disposeSources=this.options.disposeSources||!0,this._expecting=0,this.options.fillBlanks=this.options.fillBlanks||!0,!0===this.options.fillBlanks&&(this.options.customFillColor=this.options.customFillColor||"black"),this.options.frameSize=this.options.frameSize||256,this.options.paddingRatio=this.options.paddingRatio||.0115,this._paddingValue=Math.ceil(this.options.frameSize*this.options.paddingRatio),this._paddingValue%2!=0&&this._paddingValue++,this.options.paddingMode=this.options.paddingMode||e.SUBUV_WRAP,this.options.paddingMode===e.SUBUV_COLOR&&(this.options.paddingColor=this.options.paddingColor||new G.b(0,0,0,1)),this.sets={},this.frames=[],this}return e.prototype._createFrames=function(b){for(var a=this,c=this._calculateSize(),d=new i.d(1,1).divide(c),f=0,g=this._expecting,h=this.meshes.length,j=Object.keys(this.sets),m=0;m<j.length;m++){var w=j[m],z=new Bc(this.name+".TexturePack."+w+"Set",{width:c.x,height:c.y},this.scene,!0,ya.a.TRILINEAR_SAMPLINGMODE,Ha.a.TEXTUREFORMAT_RGBA),C=z.getContext();C.fillStyle="rgba(0,0,0,0)",C.fillRect(0,0,c.x,c.y),z.update(!1),this.sets[w]=z}var J=this.options.frameSize||256,K=this._paddingValue,N=J+2*K;for(m=0;m<h;m++)for(var T=this.meshes[m].material,Z=function(ea){var fa=new Bc("temp",N,_.scene,!0),ka=fa.getContext(),pa=_._getFrameOffset(m),va=function(){f++,fa.update(!1);var Da=ka.getImageData(0,0,N,N),ua=a.sets[sa];if(ua.getContext().putImageData(Da,c.x*pa.x,c.y*pa.y),fa.dispose(),ua.update(!1),f==g)return a._calculateMeshUVFrames(J,K,c,d,a.options.updateInputMeshes||!1),void b()},sa=j[ea]||"_blank";if(T&&null!==T[sa]){var la=T[sa],ta=new Image();ta.src=la instanceof Bc?la.getContext().canvas.toDataURL("image/png"):la.url,ta.onload=function(){ka.fillStyle="rgba(0,0,0,0)",ka.fillRect(0,0,N,N),fa.update(!1),ka.setTransform(1,0,0,-1,0,0);var Da=[0,0,1,0,1,1,0,1,-1,1,-1,0,-2,0,-1,1,-1];switch(a.options.paddingMode){case 0:for(var ua=0;ua<9;ua++)ka.drawImage(ta,0,0,ta.width,ta.height,K+J*Da[ua],K+J*Da[ua+1]-N,J,J);break;case 1:for(var Aa=0;Aa<K;Aa++)ka.drawImage(ta,0,0,ta.width,ta.height,Aa+J*Da[0],K-N,J,J),ka.drawImage(ta,0,0,ta.width,ta.height,2*K-Aa,K-N,J,J),ka.drawImage(ta,0,0,ta.width,ta.height,K,Aa-N,J,J),ka.drawImage(ta,0,0,ta.width,ta.height,K,2*K-Aa-N,J,J);ka.drawImage(ta,0,0,ta.width,ta.height,K+J*Da[0],K+J*Da[1]-N,J,J);break;case 2:ka.fillStyle=(a.options.paddingColor||G.a.Black()).toHexString(),ka.fillRect(0,0,N,-N),ka.clearRect(K,K,J,J),ka.drawImage(ta,0,0,ta.width,ta.height,K+J*Da[0],K+J*Da[1]-N,J,J)}ka.setTransform(1,0,0,1,0,0),va()}}else ka.fillStyle="rgba(0,0,0,0)",_.options.fillBlanks&&(ka.fillStyle=_.options.customFillColor),ka.fillRect(0,0,N,N),va()},_=this,ca=0;ca<j.length;ca++)Z(ca)},e.prototype._calculateSize=function(){var b=this.meshes.length||0,a=this.options.frameSize||0,c=this._paddingValue||0;switch(this.options.layout){case 0:return new i.d(a*b+2*c*b,a+2*c);case 1:var d=Math.max(2,Math.ceil(Math.sqrt(b))),f=a*d+2*c*d;return new i.d(f,f);case 2:var g=this.options.colnum||1,h=Math.max(1,Math.ceil(b/g));return new i.d(a*g+2*c*g,a*h+2*c*h)}return i.d.Zero()},e.prototype._calculateMeshUVFrames=function(b,a,c,d,f){for(var g=this.meshes.length,h=0;h<g;h++){var j=this.meshes[h],m=new i.d(b/c.x,b/c.y),w=d.clone().scale(a),z=this._getFrameOffset(h).add(w),C=new Tg(h,m,z);this.frames.push(C),f&&(this._updateMeshUV(j,h),this._updateTextureReferences(j))}},e.prototype._getFrameOffset=function(b){var a,c,d,f=this.meshes.length;switch(this.options.layout){case 0:return a=1/f,new i.d(b*a,0);case 1:var g=Math.max(2,Math.ceil(Math.sqrt(f)));return d=b-(c=Math.floor(b/g))*g,a=1/g,new i.d(d*a,c*a);case 2:var h=this.options.colnum||1,j=Math.max(1,Math.ceil(f/h));return c=b-(d=Math.floor(b/j))*j,a=new i.d(1/h,1/j),new i.d(d*a.x,c*a.y)}return i.d.Zero()},e.prototype._updateMeshUV=function(b,a){var c=this.frames[a],d=b.getVerticesData(this.options.uvsIn||ra.b.UVKind),f=[],g=0;d.length&&(g=d.length||0);for(var h=0;h<g;h+=2)f.push(d[h]*c.scale.x+c.offset.x,d[h+1]*c.scale.y+c.offset.y);b.setVerticesData(this.options.uvsOut||ra.b.UVKind,f)},e.prototype._updateTextureReferences=function(b,a){void 0===a&&(a=!1);for(var c=b.material,d=Object.keys(this.sets),f=function(j){j.dispose&&j.dispose()},g=0;g<d.length;g++){var h=d[g];if(a)null!==c[h]&&f(c[h]),c[h]=this.sets[h];else{if(!c)return;null!==c[h]&&(f(c[h]),c[h]=this.sets[h])}}},e.prototype.setMeshToFrame=function(b,a,c){void 0===c&&(c=!1),this._updateMeshUV(b,a),c&&this._updateTextureReferences(b,!0)},e.prototype.processAsync=function(){var b=this;return new Promise(function(a,c){try{if(0===b.meshes.length)return void a();for(var d=0,f=function(j){var m=b.meshes[j],w=m.material;if(!w)return++d===b.meshes.length?{value:b._createFrames(a)}:"continue";w.forceCompilationAsync(m).then(function(){!function(z){if(d++,b.options.map){for(var C=0;C<b.options.map.length;C++)null!==z[b.options.map[C]]&&(b.sets[b.options.map[C]]||(b.sets[b.options.map[C]]=!0),b._expecting++);d===b.meshes.length&&b._createFrames(a)}}(w)})},g=0;g<b.meshes.length;g++){var h=f(g);if("object"==typeof h)return h.value}}catch(j){return c(j)}})},e.prototype.dispose=function(){for(var b=Object.keys(this.sets),a=0;a<b.length;a++){var c=b[a];this.sets[c].dispose()}},e.prototype.download=function(b,a){var c=this;void 0===b&&(b="png"),void 0===a&&(a=1),setTimeout(function(){var d={name:c.name,sets:{},options:{},frames:[]},f=Object.keys(c.sets),g=Object.keys(c.options);try{for(var h=0;h<f.length;h++){var j=f[h],m=c.sets[j];d.sets[j]=m.getContext().canvas.toDataURL("image/"+b,a)}for(h=0;h<g.length;h++){var w=g[h];d.options[w]=c.options[w]}for(h=0;h<c.frames.length;h++){var z=c.frames[h];d.frames.push(z.scale.x,z.scale.y,z.offset.x,z.offset.y)}}catch(K){return void k.a.Warn("Unable to download: "+K)}var C="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(d,null,4)),J=document.createElement("a");J.setAttribute("href",C),J.setAttribute("download",c.name+"_texurePackage.json"),document.body.appendChild(J),J.click(),J.remove()},0)},e.prototype.updateFromJSON=function(b){try{var a=JSON.parse(b);this.name=a.name;for(var c=Object.keys(a.options),d=0;d<c.length;d++)this.options[c[d]]=a.options[c[d]];for(d=0;d<a.frames.length;d+=4){var f=new Tg(d/4,new i.d(a.frames[d],a.frames[d+1]),new i.d(a.frames[d+2],a.frames[d+3]));this.frames.push(f)}var g=Object.keys(a.sets);for(d=0;d<g.length;d++){var h=new ya.a(a.sets[g[d]],this.scene,!1,!1);this.sets[g[d]]=h}}catch(j){k.a.Warn("Unable to update from JSON: "+j)}},e.LAYOUT_STRIP=0,e.LAYOUT_POWER2=1,e.LAYOUT_COLNUM=2,e.SUBUV_WRAP=0,e.SUBUV_EXTEND=1,e.SUBUV_COLOR=2,e}();!function(e){e[e.Vertex=1]="Vertex",e[e.Fragment=2]="Fragment",e[e.Neutral=4]="Neutral",e[e.VertexAndFragment=3]="VertexAndFragment"}(Ia||(Ia={})),function(e){e[e.Float=1]="Float",e[e.Int=2]="Int",e[e.Vector2=4]="Vector2",e[e.Vector3=8]="Vector3",e[e.Vector4=16]="Vector4",e[e.Color3=32]="Color3",e[e.Color4=64]="Color4",e[e.Matrix=128]="Matrix",e[e.AutoDetect=1024]="AutoDetect",e[e.BasedOnInput=2048]="BasedOnInput"}(ha||(ha={})),function(e){e[e.Uniform=0]="Uniform",e[e.Attribute=1]="Attribute",e[e.Varying=2]="Varying",e[e.Undefined=3]="Undefined"}(Vb||(Vb={})),function(e){e[e.World=1]="World",e[e.View=2]="View",e[e.Projection=3]="Projection",e[e.ViewProjection=4]="ViewProjection",e[e.WorldView=5]="WorldView",e[e.WorldViewProjection=6]="WorldViewProjection",e[e.CameraPosition=7]="CameraPosition",e[e.FogColor=8]="FogColor",e[e.DeltaTime=9]="DeltaTime"}(nb||(nb={})),function(e){e[e.Compatible=0]="Compatible",e[e.TypeIncompatible=1]="TypeIncompatible",e[e.TargetIncompatible=2]="TargetIncompatible"}(mc||(mc={})),function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(He||(He={}));var Ug=function(){function e(b,a,c){this._connectedPoint=null,this._endpoints=new Array(),this._typeConnectionSource=null,this._linkedConnectionSource=null,this._type=ha.Float,this._enforceAssociatedVariableName=!1,this.acceptedConnectionPointTypes=new Array(),this.excludedConnectionPointTypes=new Array(),this.onConnectionObservable=new I.c(),this._prioritizeVertex=!1,this._target=Ia.VertexAndFragment,this._ownerBlock=a,this.name=b,this._direction=c}return Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"associatedVariableName",{get:function(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName},set:function(b){this._associatedVariableName=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerType",{get:function(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){if(this._type===ha.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}return this._type===ha.BasedOnInput&&this._typeConnectionSource?this._typeConnectionSource.type:this._type},set:function(b){this._type=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._prioritizeVertex&&this._ownerBlock?this._target!==Ia.VertexAndFragment?this._target:this._ownerBlock.target===Ia.Fragment?Ia.Fragment:Ia.Vertex:this._target},set:function(b){this._target=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isConnected",{get:function(){return null!==this.connectedPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isConnectedToInputBlock",{get:function(){return null!==this.connectedPoint&&this.connectedPoint.ownerBlock.isInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectInputBlock",{get:function(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectedPoint",{get:function(){return this._connectedPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownerBlock",{get:function(){return this._ownerBlock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceBlock",{get:function(){return this._connectedPoint?this._connectedPoint.ownerBlock:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectedBlocks",{get:function(){return 0===this._endpoints.length?[]:this._endpoints.map(function(b){return b.ownerBlock})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endpoints",{get:function(){return this._endpoints},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasEndpoints",{get:function(){return this._endpoints&&this._endpoints.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isConnectedInVertexShader",{get:function(){if(this.target===Ia.Vertex)return!0;if(!this.hasEndpoints)return!1;for(var b=0,a=this._endpoints;b<a.length;b++){var c=a[b];if(c.ownerBlock.target===Ia.Vertex)return!0;if(c.target===Ia.Vertex)return!0;if((c.ownerBlock.target===Ia.Neutral||c.ownerBlock.target===Ia.VertexAndFragment)&&c.ownerBlock.outputs.some(function(d){return d.isConnectedInVertexShader}))return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isConnectedInFragmentShader",{get:function(){if(this.target===Ia.Fragment)return!0;if(!this.hasEndpoints)return!1;for(var b=0,a=this._endpoints;b<a.length;b++){var c=a[b];if(c.ownerBlock.target===Ia.Fragment)return!0;if((c.ownerBlock.target===Ia.Neutral||c.ownerBlock.target===Ia.VertexAndFragment)&&c.ownerBlock.outputs.some(function(d){return d.isConnectedInFragmentShader}))return!0}return!1},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"NodeMaterialConnectionPoint"},e.prototype.canConnectTo=function(b){return this.checkCompatibilityState(b)===mc.Compatible},e.prototype.checkCompatibilityState=function(b){if(this._ownerBlock.target===Ia.Fragment){var a=b.ownerBlock;if(a.target===Ia.Vertex)return mc.TargetIncompatible;for(var c=0,d=a.outputs;c<d.length;c++)if(d[c].isConnectedInVertexShader)return mc.TargetIncompatible}if(this.type!==b.type&&b.innerType!==ha.AutoDetect){switch(this.type){case ha.Vector3:if(b.type===ha.Color3)return mc.Compatible;break;case ha.Vector4:if(b.type===ha.Color4)return mc.Compatible;break;case ha.Color3:if(b.type===ha.Vector3)return mc.Compatible;break;case ha.Color4:if(b.type===ha.Vector4)return mc.Compatible}return b.acceptedConnectionPointTypes&&-1!==b.acceptedConnectionPointTypes.indexOf(this.type)?mc.Compatible:mc.TypeIncompatible}return b.excludedConnectionPointTypes&&-1!==b.excludedConnectionPointTypes.indexOf(this.type)?1:mc.Compatible},e.prototype.connectTo=function(b,a){if(void 0===a&&(a=!1),!a&&!this.canConnectTo(b))throw"Cannot connect these two connectors.";return this._endpoints.push(b),b._connectedPoint=this,this._enforceAssociatedVariableName=!1,this.onConnectionObservable.notifyObservers(b),b.onConnectionObservable.notifyObservers(this),this},e.prototype.disconnectFrom=function(b){var a=this._endpoints.indexOf(b);return-1===a?this:(this._endpoints.splice(a,1),b._connectedPoint=null,this._enforceAssociatedVariableName=!1,b._enforceAssociatedVariableName=!1,this)},e.prototype.serialize=function(){var b={};return b.name=this.name,this.connectedPoint&&(b.inputName=this.name,b.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,b.targetConnectionName=this.connectedPoint.name),b},e.prototype.dispose=function(){this.onConnectionObservable.clear()},e}(),In=o(138),ib=function(){function e(b,a,c,d){void 0===a&&(a=Ia.Vertex),void 0===c&&(c=!1),void 0===d&&(d=!1),this._isFinalMerger=!1,this._isInput=!1,this._isUnique=!1,this.inputsAreExclusive=!1,this._codeVariableName="",this._inputs=new Array(),this._outputs=new Array(),this.comments="",this.name=b,this._target=a,this._isFinalMerger=c,this._isInput=d,this.uniqueId=In.a.UniqueId}return Object.defineProperty(e.prototype,"isUnique",{get:function(){return this._isUnique},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFinalMerger",{get:function(){return this._isFinalMerger},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInput",{get:function(){return this._isInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buildId",{get:function(){return this._buildId},set:function(b){this._buildId=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(b){0==(this._target&b)&&(this._target=b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs},enumerable:!0,configurable:!0}),e.prototype.getInputByName=function(b){var a=this._inputs.filter(function(c){return c.name===b});return a.length?a[0]:null},e.prototype.getOutputByName=function(b){var a=this._outputs.filter(function(c){return c.name===b});return a.length?a[0]:null},e.prototype.initialize=function(b){},e.prototype.bind=function(b,a,c){},e.prototype._declareOutput=function(b,a){return a._getGLType(b.type)+" "+b.associatedVariableName},e.prototype._writeVariable=function(b){return b.connectedPoint?""+b.associatedVariableName:"0."},e.prototype._writeFloat=function(b){var a=b.toString();return-1===a.indexOf(".")&&(a+=".0"),""+a},e.prototype.getClassName=function(){return"NodeMaterialBlock"},e.prototype.registerInput=function(b,a,c,d){void 0===c&&(c=!1);var f=new Ug(b,this,He.Input);return f.type=a,f.isOptional=c,d&&(f.target=d),this._inputs.push(f),this},e.prototype.registerOutput=function(b,a,c){var d=new Ug(b,this,He.Output);return d.type=a,c&&(d.target=c),this._outputs.push(d),this},e.prototype.getFirstAvailableInput=function(b){void 0===b&&(b=null);for(var a=0,c=this._inputs;a<c.length;a++){var d=c[a];if(!(d.connectedPoint||b&&b.type!==d.type&&d.type!==ha.AutoDetect))return d}return null},e.prototype.getFirstAvailableOutput=function(b){void 0===b&&(b=null);for(var a=0,c=this._outputs;a<c.length;a++){var d=c[a];if(!b||!b.target||b.target===Ia.Neutral||0!=(b.target&d.target))return d}return null},e.prototype.getSiblingOutput=function(b){var a=this._outputs.indexOf(b);return-1===a||a>=this._outputs.length?null:this._outputs[a+1]},e.prototype.connectTo=function(b,a){if(0!==this._outputs.length){for(var c=a&&a.output?this.getOutputByName(a.output):this.getFirstAvailableOutput(b),d=!0;d;){var f=a&&a.input?b.getInputByName(a.input):b.getFirstAvailableInput(c);if(c&&f&&c.canConnectTo(f))c.connectTo(f),d=!1;else{if(!c)throw"Unable to find a compatible match";c=this.getSiblingOutput(c)}}return this}},e.prototype._buildBlock=function(b){},e.prototype.updateUniformsAndSamples=function(b,a,c,d){},e.prototype.provideFallbacks=function(b,a){},e.prototype.initializeDefines=function(b,a,c,d){void 0===d&&(d=!1)},e.prototype.prepareDefines=function(b,a,c,d){void 0===d&&(d=!1)},e.prototype.autoConfigure=function(b){},e.prototype.replaceRepeatableContent=function(b,a,c,d){},e.prototype.isReady=function(b,a,c,d){return void 0===d&&(d=!1),!0},e.prototype._linkConnectionTypes=function(b,a){this._inputs[b]._linkedConnectionSource=this._inputs[a],this._inputs[a]._linkedConnectionSource=this._inputs[b]},e.prototype._processBuild=function(b,a,c,d){b.build(a,d);var f=null!=a._vertexState,g=b._buildTarget===Ia.Vertex&&b.target!==Ia.VertexAndFragment;if(f&&(0==(b.target&b._buildTarget)||0==(b.target&c.target)||this.target!==Ia.VertexAndFragment&&g)&&(!b.isInput&&a.target!==b._buildTarget||b.isInput&&b.isAttribute)){var h=c.connectedPoint;a._vertexState._emitVaryingFromString("v_"+h.associatedVariableName,a._getGLType(h.type))&&(a._vertexState.compilationString+="v_"+h.associatedVariableName+" = "+h.associatedVariableName+`;\r
`),c.associatedVariableName="v_"+h.associatedVariableName,c._enforceAssociatedVariableName=!0}},e.prototype.build=function(b,a){if(this._buildId===b.sharedData.buildId)return!0;if(!this.isInput)for(var c=0,d=this._outputs;c<d.length;c++)(w=d[c]).associatedVariableName||(w.associatedVariableName=b._getFreeVariableName(w.name));for(var f=0,g=this._inputs;f<g.length;f++){var h=g[f];if(h.connectedPoint){if(this.target!==Ia.Neutral){if(0==(h.target&this.target))continue;if(0==(h.target&b.target))continue}(J=h.connectedPoint.ownerBlock)&&J!==this&&this._processBuild(J,b,h,a)}else h.isOptional||b.sharedData.checks.notConnectedNonOptionalInputs.push(h)}if(this._buildId===b.sharedData.buildId)return!0;if(b.sharedData.verbose&&console.log((b.target===Ia.Vertex?"Vertex shader":"Fragment shader")+": Building "+this.name+" ["+this.getClassName()+"]"),this.isFinalMerger)switch(b.target){case Ia.Vertex:b.sharedData.checks.emitVertex=!0;break;case Ia.Fragment:b.sharedData.checks.emitFragment=!0}!this.isInput&&b.sharedData.emitComments&&(b.compilationString+=`\r
//`+this.name+`\r
`),this._buildBlock(b),this._buildId=b.sharedData.buildId,this._buildTarget=b.target;for(var j=0,m=this._outputs;j<m.length;j++){var w;if(0!=((w=m[j]).target&b.target))for(var z=0,C=w.endpoints;z<C.length;z++){var J,K=C[z];(J=K.ownerBlock)&&0!=(J.target&b.target)&&-1!==a.indexOf(J)&&this._processBuild(J,b,K,a)}}return!1},e.prototype._inputRename=function(b){return b},e.prototype._outputRename=function(b){return b},e.prototype._dumpPropertiesCode=function(){return""},e.prototype._dumpCode=function(b,a){var c;a.push(this);var d=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=d||this.getClassName()+"_"+this.uniqueId,-1!==b.indexOf(this._codeVariableName)){var f=0;do f++,this._codeVariableName=d+f;while(-1!==b.indexOf(this._codeVariableName))}b.push(this._codeVariableName),c=`\r
// `+this.getClassName()+`\r
`,this.comments&&(c+="// "+this.comments+`\r
`),c+="var "+this._codeVariableName+" = new BABYLON."+this.getClassName()+'("'+this.name+`");\r
`,c+=this._dumpPropertiesCode();for(var g=0,h=this.inputs;g<h.length;g++){var j=h[g];if(j.isConnected){var m=j.connectedPoint.ownerBlock;-1===a.indexOf(m)&&(c+=m._dumpCode(b,a))}}for(var w=0,z=this.outputs;w<z.length;w++){var C=z[w];if(C.hasEndpoints)for(var J=0,K=C.endpoints;J<K.length;J++)(m=K[J].ownerBlock)&&-1===a.indexOf(m)&&(c+=m._dumpCode(b,a))}return c},e.prototype._dumpCodeForOutputConnections=function(b){var a="";if(-1!==b.indexOf(this))return a;b.push(this);for(var c=0,d=this.inputs;c<d.length;c++){var f=d[c];if(f.isConnected){var g=f.connectedPoint,h=g.ownerBlock;a+=h._dumpCodeForOutputConnections(b),a+=h._codeVariableName+"."+h._outputRename(g.name)+".connectTo("+this._codeVariableName+"."+this._inputRename(f.name)+`);\r
`}}return a},e.prototype.clone=function(b,a){void 0===a&&(a="");var c=this.serialize(),d=D.a.GetClass(c.customType);if(d){var f=new d();return f._deserialize(c,b,a),f}return null},e.prototype.serialize=function(){var b={};b.customType="BABYLON."+this.getClassName(),b.id=this.uniqueId,b.name=this.name,b.comments=this.comments,b.inputs=[];for(var a=0,c=this.inputs;a<c.length;a++){var d=c[a];b.inputs.push(d.serialize())}return b},e.prototype._deserialize=function(b,a,c){this.name=b.name,this.comments=b.comments},e.prototype.dispose=function(){for(var b=0,a=this.inputs;b<a.length;b++)a[b].dispose();for(var c=0,d=this.outputs;c<d.length;c++)d[c].dispose()},e}(),Aj=function(){function e(){this.supportUniformBuffers=!1,this.attributes=new Array(),this.uniforms=new Array(),this.constants=new Array(),this.samplers=new Array(),this.functions={},this.extensions={},this.counters={},this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}return e.prototype.finalize=function(b){var a=b.sharedData.emitComments,c=this.target===Ia.Fragment;this.compilationString=`\r
`+(a?`//Entry point\r
`:"")+`void main(void) {\r
`+this.compilationString,this._constantDeclaration&&(this.compilationString=`\r
`+(a?`//Constants\r
`:"")+this._constantDeclaration+`\r
`+this.compilationString);var d="";for(var f in this.functions)d+=this.functions[f]+`\r
`;for(var g in this.compilationString=`\r
`+d+`\r
`+this.compilationString,!c&&this._varyingTransfer&&(this.compilationString=this.compilationString+`\r
`+this._varyingTransfer),this.compilationString=this.compilationString+`\r
}`,this.sharedData.varyingDeclaration&&(this.compilationString=`\r
`+(a?`//Varyings\r
`:"")+this.sharedData.varyingDeclaration+`\r
`+this.compilationString),this._samplerDeclaration&&(this.compilationString=`\r
`+(a?`//Samplers\r
`:"")+this._samplerDeclaration+`\r
`+this.compilationString),this._uniformDeclaration&&(this.compilationString=`\r
`+(a?`//Uniforms\r
`:"")+this._uniformDeclaration+`\r
`+this.compilationString),this._attributeDeclaration&&!c&&(this.compilationString=`\r
`+(a?`//Attributes\r
`:"")+this._attributeDeclaration+`\r
`+this.compilationString),this.extensions){var h=this.extensions[g];this.compilationString=`\r
`+h+`\r
`+this.compilationString}this._builtCompilationString=this.compilationString},Object.defineProperty(e.prototype,"_repeatableContentAnchor",{get:function(){return"###___ANCHOR"+this._repeatableContentAnchorIndex+++"___###"},enumerable:!0,configurable:!0}),e.prototype._getFreeVariableName=function(b){return b=b.replace(/[^a-zA-Z_]+/g,""),void 0===this.sharedData.variableNames[b]?(this.sharedData.variableNames[b]=0,"output"===b||"texture"===b?b+this.sharedData.variableNames[b]:b):(this.sharedData.variableNames[b]++,b+this.sharedData.variableNames[b])},e.prototype._getFreeDefineName=function(b){return void 0===this.sharedData.defineNames[b]?this.sharedData.defineNames[b]=0:this.sharedData.defineNames[b]++,b+this.sharedData.defineNames[b]},e.prototype._excludeVariableName=function(b){this.sharedData.variableNames[b]=0},e.prototype._emit2DSampler=function(b){this._samplerDeclaration+="uniform sampler2D "+b+`;\r
`,this.samplers.push(b)},e.prototype._getGLType=function(b){switch(b){case ha.Float:return"float";case ha.Int:return"int";case ha.Vector2:return"vec2";case ha.Color3:case ha.Vector3:return"vec3";case ha.Color4:case ha.Vector4:return"vec4";case ha.Matrix:return"mat4"}return""},e.prototype._emitExtension=function(b,a){this.extensions[b]||(this.extensions[b]=a)},e.prototype._emitFunction=function(b,a,c){this.functions[b]||(this.sharedData.emitComments&&(a=c+`\r
`+a),this.functions[b]=a)},e.prototype._emitCodeFromInclude=function(b,a,c){if(c&&c.repeatKey)return"#include<"+b+">[0.."+c.repeatKey+`]\r
`;var d=Pa.a.IncludesShadersStore[b]+`\r
`;if(this.sharedData.emitComments&&(d=a+`\r
`+d),!c)return d;if(c.replaceStrings)for(var f=0;f<c.replaceStrings.length;f++){var g=c.replaceStrings[f];d=d.replace(g.search,g.replace)}return d},e.prototype._emitFunctionFromInclude=function(b,a,c,d){void 0===d&&(d="");var f=b+d;if(!this.functions[f]){if(!(c&&(c.removeAttributes||c.removeUniforms||c.removeVaryings||c.removeIfDef||c.replaceStrings)))return c&&c.repeatKey?this.functions[f]="#include<"+b+">[0.."+c.repeatKey+`]\r
`:this.functions[f]="#include<"+b+`>\r
`,void(this.sharedData.emitComments&&(this.functions[f]=a+`\r
`+this.functions[f]));if(this.functions[f]=Pa.a.IncludesShadersStore[b],this.sharedData.emitComments&&(this.functions[f]=a+`\r
`+this.functions[f]),c.removeIfDef&&(this.functions[f]=this.functions[f].replace(/^\s*?#ifdef.+$/gm,""),this.functions[f]=this.functions[f].replace(/^\s*?#endif.*$/gm,""),this.functions[f]=this.functions[f].replace(/^\s*?#else.*$/gm,""),this.functions[f]=this.functions[f].replace(/^\s*?#elif.*$/gm,"")),c.removeAttributes&&(this.functions[f]=this.functions[f].replace(/^\s*?attribute.+$/gm,"")),c.removeUniforms&&(this.functions[f]=this.functions[f].replace(/^\s*?uniform.+$/gm,"")),c.removeVaryings&&(this.functions[f]=this.functions[f].replace(/^\s*?varying.+$/gm,"")),c.replaceStrings)for(var g=0;g<c.replaceStrings.length;g++){var h=c.replaceStrings[g];this.functions[f]=this.functions[f].replace(h.search,h.replace)}}},e.prototype._registerTempVariable=function(b){return-1===this.sharedData.temps.indexOf(b)&&(this.sharedData.temps.push(b),!0)},e.prototype._emitVaryingFromString=function(b,a,c,d){return void 0===c&&(c=""),void 0===d&&(d=!1),-1===this.sharedData.varyings.indexOf(b)&&(this.sharedData.varyings.push(b),c&&(oc.a.StartsWith(c,"defined(")?this.sharedData.varyingDeclaration+="#if "+c+`\r
`:this.sharedData.varyingDeclaration+=(d?"#ifndef":"#ifdef")+" "+c+`\r
`),this.sharedData.varyingDeclaration+="varying "+a+" "+b+`;\r
`,c&&(this.sharedData.varyingDeclaration+=`#endif\r
`),!0)},e.prototype._emitUniformFromString=function(b,a,c,d){void 0===c&&(c=""),void 0===d&&(d=!1),-1===this.uniforms.indexOf(b)&&(this.uniforms.push(b),c&&(this._uniformDeclaration+=(d?"#ifndef":"#ifdef")+" "+c+`\r
`),this._uniformDeclaration+="uniform "+a+" "+b+`;\r
`,c&&(this._uniformDeclaration+=`#endif\r
`))},e.prototype._emitFloat=function(b){return b.toString()===b.toFixed(0)?b+".0":b.toString()},e}(),Jn=function(){function e(){this.temps=new Array(),this.varyings=new Array(),this.varyingDeclaration="",this.inputBlocks=new Array(),this.textureBlocks=new Array(),this.bindableBlocks=new Array(),this.blocksWithFallbacks=new Array(),this.blocksWithDefines=new Array(),this.repeatableContentBlocks=new Array(),this.dynamicUniformBlocks=new Array(),this.blockingBlocks=new Array(),this.animatedInputs=new Array(),this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:new Array()},this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}return e.prototype.emitErrors=function(){var b="";this.checks.emitVertex||(b+=`NodeMaterial does not have a vertex output. You need to at least add a block that generates a glPosition value.\r
`),this.checks.emitFragment||(b+=`NodeMaterial does not have a fragment output. You need to at least add a block that generates a glFragColor value.\r
`);for(var a=0,c=this.checks.notConnectedNonOptionalInputs;a<c.length;a++){var d=c[a];b+="input "+d.name+" from block "+d.ownerBlock.name+"["+d.ownerBlock.getClassName()+`] is not connected and is not optional.\r
`}if(b)throw`Build of NodeMaterial failed:\r
`+b},e}(),yf=function(e){function b(a){var c=e.call(this,a,Ia.Vertex)||this;return c.complementW=1,c.complementZ=0,c.registerInput("vector",ha.AutoDetect),c.registerInput("transform",ha.Matrix),c.registerOutput("output",ha.Vector4),c.registerOutput("xyz",ha.Vector3),c._inputs[0].onConnectionObservable.add(function(d){if(d.ownerBlock.isInput){var f=d.ownerBlock;"normal"!==f.name&&"tangent"!==f.name||(c.complementW=0)}}),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"TransformBlock"},Object.defineProperty(b.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"transform",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this.vector,d=this.transform;if(c.connectedPoint){switch(c.connectedPoint.type){case ha.Vector2:a.compilationString+=this._declareOutput(this.output,a)+" = "+d.associatedVariableName+" * vec4("+c.associatedVariableName+", "+this._writeFloat(this.complementZ)+", "+this._writeFloat(this.complementW)+`);\r
`;break;case ha.Vector3:case ha.Color3:a.compilationString+=this._declareOutput(this.output,a)+" = "+d.associatedVariableName+" * vec4("+c.associatedVariableName+", "+this._writeFloat(this.complementW)+`);\r
`;break;default:a.compilationString+=this._declareOutput(this.output,a)+" = "+d.associatedVariableName+" * "+c.associatedVariableName+`;\r
`}this.xyz.hasEndpoints&&(a.compilationString+=this._declareOutput(this.xyz,a)+" = "+this.output.associatedVariableName+`.xyz;\r
`)}return this},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.complementZ=this.complementZ,a.complementW=this.complementW,a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),this.complementZ=void 0!==a.complementZ?a.complementZ:0,this.complementW=void 0!==a.complementW?a.complementW:1},b.prototype._dumpPropertiesCode=function(){var a=this._codeVariableName+".complementZ = "+this.complementZ+`;\r
`;return a+=this._codeVariableName+".complementW = "+this.complementW+`;\r
`},b}(ib);D.a.RegisteredTypes["BABYLON.TransformBlock"]=yf;var Vg=function(e){function b(a){var c=e.call(this,a,Ia.Vertex,!0)||this;return c.registerInput("vector",ha.Vector4),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"VertexOutputBlock"},Object.defineProperty(b.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this.vector;return a.compilationString+="gl_Position = "+c.associatedVariableName+`;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.VertexOutputBlock"]=Vg;var sd,Wg=function(e){function b(a){var c=e.call(this,a,Ia.Fragment,!0)||this;return c.registerInput("rgba",ha.Color4,!0),c.registerInput("rgb",ha.Color3,!0),c.registerInput("a",ha.Float,!0),c.rgb.acceptedConnectionPointTypes.push(ha.Float),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"FragmentOutputBlock"},Object.defineProperty(b.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgb",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"a",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this.rgba,d=this.rgb,f=this.a;if(a.sharedData.hints.needAlphaBlending=c.isConnected||f.isConnected,c.connectedPoint)f.isConnected?a.compilationString+="gl_FragColor = vec4("+c.associatedVariableName+".rgb, "+f.associatedVariableName+`);\r
`:a.compilationString+="gl_FragColor = "+c.associatedVariableName+`;\r
`;else if(d.connectedPoint){var g="1.0";f.connectedPoint&&(g=f.associatedVariableName),d.connectedPoint.type===ha.Float?a.compilationString+="gl_FragColor = vec4("+d.associatedVariableName+", "+d.associatedVariableName+", "+d.associatedVariableName+", "+g+`);\r
`:a.compilationString+="gl_FragColor = vec4("+d.associatedVariableName+", "+g+`);\r
`}else a.sharedData.checks.notConnectedNonOptionalInputs.push(c);return this},b}(ib);D.a.RegisteredTypes["BABYLON.FragmentOutputBlock"]=Wg,function(e){e[e.None=0]="None",e[e.Time=1]="Time"}(sd||(sd={}));var xb=function(e){function b(a,c,d){void 0===c&&(c=Ia.Vertex),void 0===d&&(d=ha.AutoDetect);var f=e.call(this,a,c,!1,!0)||this;return f._mode=Vb.Undefined,f._animationType=sd.None,f.min=0,f.max=0,f.isBoolean=!1,f.matrixMode=0,f._systemValue=null,f.visibleInInspector=!1,f.isConstant=!1,f.groupInInspector="",f.onValueChangedObservable=new I.c(),f._type=d,f.setDefaultValue(),f.registerOutput("output",d),f}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"type",{get:function(){if(this._type===ha.AutoDetect){if(this.isUniform&&null!=this.value){if(!isNaN(this.value))return this._type=ha.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=ha.Vector2,this._type;case"Vector3":return this._type=ha.Vector3,this._type;case"Vector4":return this._type=ha.Vector4,this._type;case"Color3":return this._type=ha.Color3,this._type;case"Color4":return this._type=ha.Color4,this._type;case"Matrix":return this._type=ha.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"position":case"normal":case"tangent":return this._type=ha.Vector3,this._type;case"uv":case"uv2":return this._type=ha.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"world0":case"world1":case"world2":case"world3":return this._type=ha.Vector4,this._type;case"color":return this._type=ha.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case nb.World:case nb.WorldView:case nb.WorldViewProjection:case nb.View:case nb.ViewProjection:case nb.Projection:return this._type=ha.Matrix,this._type;case nb.CameraPosition:return this._type=ha.Vector3,this._type;case nb.FogColor:return this._type=ha.Color3,this._type;case nb.DeltaTime:return this._type=ha.Float,this._type}}return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype.setAsAttribute=function(a){return a&&(this.name=a),this._mode=Vb.Attribute,this},b.prototype.setAsSystemValue=function(a){return this.systemValue=a,this},Object.defineProperty(b.prototype,"value",{get:function(){return this._storedValue},set:function(a){this.type===ha.Float&&(this.isBoolean?a=a?1:0:this.min!==this.max&&(a=Math.max(this.min,a),a=Math.min(this.max,a))),this._storedValue=a,this._mode=Vb.Uniform,this.onValueChangedObservable.notifyObservers(this)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"valueCallback",{get:function(){return this._valueCallback},set:function(a){this._valueCallback=a,this._mode=Vb.Uniform},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"associatedVariableName",{get:function(){return this._associatedVariableName},set:function(a){this._associatedVariableName=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"animationType",{get:function(){return this._animationType},set:function(a){this._animationType=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isUndefined",{get:function(){return this._mode===Vb.Undefined},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isUniform",{get:function(){return this._mode===Vb.Uniform},set:function(a){this._mode=a?Vb.Uniform:Vb.Undefined,this.associatedVariableName=""},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isAttribute",{get:function(){return this._mode===Vb.Attribute},set:function(a){this._mode=a?Vb.Attribute:Vb.Undefined,this.associatedVariableName=""},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isVarying",{get:function(){return this._mode===Vb.Varying},set:function(a){this._mode=a?Vb.Varying:Vb.Undefined,this.associatedVariableName=""},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isSystemValue",{get:function(){return null!=this._systemValue},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"systemValue",{get:function(){return this._systemValue},set:function(a){this._mode=Vb.Uniform,this.associatedVariableName="",this._systemValue=a},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"InputBlock"},b.prototype.animate=function(a){switch(this._animationType){case sd.Time:this.type===ha.Float&&(this.value+=.01*a.getAnimationRatio())}},b.prototype._emitDefine=function(a){return"!"===a[0]?"#ifndef "+a.substring(1)+`\r
`:"#ifdef "+a+`\r
`},b.prototype.initialize=function(a){this.associatedVariableName=""},b.prototype.setDefaultValue=function(){switch(this.type){case ha.Float:this.value=0;break;case ha.Vector2:this.value=i.d.Zero();break;case ha.Vector3:this.value=i.e.Zero();break;case ha.Vector4:this.value=i.f.Zero();break;case ha.Color3:this.value=G.a.White();break;case ha.Color4:this.value=new G.b(1,1,1,1);break;case ha.Matrix:this.value=i.a.Identity()}},b.prototype._emitConstant=function(a){switch(this.type){case ha.Float:return""+a._emitFloat(this.value);case ha.Vector2:return"vec2("+this.value.x+", "+this.value.y+")";case ha.Vector3:return"vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")";case ha.Vector4:return"vec4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";case ha.Color3:return"vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")";case ha.Color4:return"vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")"}return""},b.prototype._emit=function(a,c){if(this.isUniform){if(this.associatedVariableName||(this.associatedVariableName=a._getFreeVariableName("u_"+this.name)),this.isConstant)return-1!==a.constants.indexOf(this.associatedVariableName)?void 0:(a.constants.push(this.associatedVariableName),void(a._constantDeclaration+=this._declareOutput(this.output,a)+" = "+this._emitConstant(a)+`;\r
`));if(-1!==a.uniforms.indexOf(this.associatedVariableName))return;a.uniforms.push(this.associatedVariableName),c&&(a._uniformDeclaration+=this._emitDefine(c)),a._uniformDeclaration+="uniform "+a._getGLType(this.type)+" "+this.associatedVariableName+`;\r
`,c&&(a._uniformDeclaration+=`#endif\r
`);var d=a.sharedData.hints;if(null!==this._systemValue&&void 0!==this._systemValue)switch(this._systemValue){case nb.WorldView:d.needWorldViewMatrix=!0;break;case nb.WorldViewProjection:d.needWorldViewProjectionMatrix=!0}else this._animationType!==sd.None&&a.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=this.name,this.target===Ia.Vertex&&a._vertexState)return void this._emit(a._vertexState,c);if(-1!==a.attributes.indexOf(this.associatedVariableName))return;a.attributes.push(this.associatedVariableName),c&&(a._attributeDeclaration+=this._emitDefine(c)),a._attributeDeclaration+="attribute "+a._getGLType(this.type)+" "+this.associatedVariableName+`;\r
`,c&&(a._attributeDeclaration+=`#endif\r
`)}},b.prototype._transmitWorld=function(a,c,d,f){if(this._systemValue){var g=this.associatedVariableName;switch(this._systemValue){case nb.World:a.setMatrix(g,c);break;case nb.WorldView:a.setMatrix(g,d);break;case nb.WorldViewProjection:a.setMatrix(g,f)}}},b.prototype._transmit=function(a,c){if(!this.isAttribute){var d=this.associatedVariableName;if(this._systemValue)switch(this._systemValue){case nb.World:case nb.WorldView:case nb.WorldViewProjection:return;case nb.View:a.setMatrix(d,c.getViewMatrix());break;case nb.Projection:a.setMatrix(d,c.getProjectionMatrix());break;case nb.ViewProjection:a.setMatrix(d,c.getTransformMatrix());break;case nb.CameraPosition:a.setVector3(d,c.activeCamera.globalPosition);break;case nb.FogColor:a.setColor3(d,c.fogColor);break;case nb.DeltaTime:a.setFloat(d,c.deltaTime/1000)}else{var f=this._valueCallback?this._valueCallback():this._storedValue;if(null!==f)switch(this.type){case ha.Float:a.setFloat(d,f);break;case ha.Int:a.setInt(d,f);break;case ha.Color3:a.setColor3(d,f);break;case ha.Color4:a.setDirectColor4(d,f);break;case ha.Vector2:a.setVector2(d,f);break;case ha.Vector3:a.setVector3(d,f);break;case ha.Vector4:a.setVector4(d,f);break;case ha.Matrix:a.setMatrix(d,f)}}}},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a),(this.isUniform||this.isSystemValue)&&a.sharedData.inputBlocks.push(this),this._emit(a)},b.prototype._dumpPropertiesCode=function(){var a=this._codeVariableName;if(this.isAttribute)return a+'.setAsAttribute("'+this.name+`");\r
`;if(this.isSystemValue)return a+".setAsSystemValue(BABYLON.NodeMaterialSystemValues."+nb[this._systemValue]+`);\r
`;if(this.isUniform){var c="";switch(this.type){case ha.Float:var d=a+".value = "+this.value+`;\r
`;return d+=a+".min = "+this.min+`;\r
`,d+=a+".max = "+this.max+`;\r
`,d+=a+".isBoolean = "+this.isBoolean+`;\r
`,d+=a+".matrixMode = "+this.matrixMode+`;\r
`,d+=a+".animationType  = BABYLON.AnimatedInputBlockTypes."+sd[this.animationType]+`;\r
`;case ha.Vector2:c="new BABYLON.Vector2("+this.value.x+", "+this.value.y+")";break;case ha.Vector3:c="new BABYLON.Vector3("+this.value.x+", "+this.value.y+", "+this.value.z+")";break;case ha.Vector4:c="new BABYLON.Vector4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";break;case ha.Color3:c="new BABYLON.Color3("+this.value.r+", "+this.value.g+", "+this.value.b+")";break;case ha.Color4:c="new BABYLON.Color4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")";break;case ha.Matrix:c="BABYLON.Matrix.FromArray(["+this.value.m.toString()+"])"}var f=a+".value = "+c+`;\r
`;return f+=a+".isConstant = "+(this.isConstant?"true":"false")+`;\r
`,f+=a+".visibleInInspector = "+(this.visibleInInspector?"true":"false")+`;\r
`}return""},b.prototype.dispose=function(){this.onValueChangedObservable.clear(),e.prototype.dispose.call(this)},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.type=this.type,a.mode=this._mode,a.systemValue=this._systemValue,a.animationType=this._animationType,a.visibleInInspector=this.visibleInInspector,a.min=this.min,a.max=this.max,a.isBoolean=this.isBoolean,a.matrixMode=this.matrixMode,a.isConstant=this.isConstant,a.groupInInspector=this.groupInInspector,null!=this._storedValue&&this._mode===Vb.Uniform&&(this._storedValue.asArray?(a.valueType="BABYLON."+this._storedValue.getClassName(),a.value=this._storedValue.asArray()):(a.valueType="number",a.value=this._storedValue)),a},b.prototype._deserialize=function(a,c,d){if(e.prototype._deserialize.call(this,a,c,d),this._type=a.type,this._mode=a.mode,this._systemValue=a.systemValue||a.wellKnownValue,this._animationType=a.animationType,this.visibleInInspector=a.visibleInInspector,this.min=a.min||0,this.max=a.max||0,this.isBoolean=!!a.isBoolean,this.matrixMode=a.matrixMode||0,this.isConstant=!!a.isConstant,this.groupInInspector=a.groupInInspector||"",a.valueType)if("number"===a.valueType)this._storedValue=a.value;else{var f=D.a.GetClass(a.valueType);f&&(this._storedValue=f.FromArray(a.value))}},b}(ib);D.a.RegisteredTypes["BABYLON.InputBlock"]=xb;var Bj=function(e){function b(){var a=e.call(this)||this;return a.NORMAL=!1,a.TANGENT=!1,a.UV1=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.BONETEXTURE=!1,a.MORPHTARGETS=!1,a.MORPHTARGETS_NORMAL=!1,a.MORPHTARGETS_TANGENT=!1,a.MORPHTARGETS_UV=!1,a.NUM_MORPH_INFLUENCERS=0,a.IMAGEPROCESSING=!1,a.VIGNETTE=!1,a.VIGNETTEBLENDMODEMULTIPLY=!1,a.VIGNETTEBLENDMODEOPAQUE=!1,a.TONEMAPPING=!1,a.TONEMAPPING_ACES=!1,a.CONTRAST=!1,a.EXPOSURE=!1,a.COLORCURVES=!1,a.COLORGRADING=!1,a.COLORGRADING3D=!1,a.SAMPLER3DGREENDEPTH=!1,a.SAMPLER3DBGRMAP=!1,a.IMAGEPROCESSINGPOSTPROCESS=!1,a.BUMPDIRECTUV=0,a.rebuild(),a}return Object(l.d)(b,e),b.prototype.setValue=function(a,c){void 0===this[a]&&this._keys.push(a),this[a]=c},b}(mf.a),Cj=function(e){function b(a,c,d){void 0===d&&(d={});var f=e.call(this,a,c||Ha.a.LastCreatedScene)||this;return f._buildId=b._BuildIdGenerator++,f._buildWasSuccessful=!1,f._cachedWorldViewMatrix=new i.a(),f._cachedWorldViewProjectionMatrix=new i.a(),f._optimizers=new Array(),f._animationFrame=-1,f.BJSNODEMATERIALEDITOR=f._getGlobalNodeMaterialEditor(),f.editorData=null,f.ignoreAlpha=!1,f.maxSimultaneousLights=4,f.onBuildObservable=new I.c(),f._vertexOutputNodes=new Array(),f._fragmentOutputNodes=new Array(),f.attachedBlocks=new Array(),f._options=Object(l.a)({emitComments:!1},d),f._attachImageProcessingConfiguration(null),f}return Object(l.d)(b,e),b.prototype._getGlobalNodeMaterialEditor=function(){return"undefined"!=typeof NODEEDITOR?NODEEDITOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.NodeEditor?BABYLON:void 0},Object.defineProperty(b.prototype,"options",{get:function(){return this._options},set:function(a){this._options=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(a){this._attachImageProcessingConfiguration(a),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"NodeMaterial"},b.prototype._attachImageProcessingConfiguration=function(a){var c=this;a!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=a||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){c._markAllSubMeshesAsImageProcessingDirty()})))},b.prototype.getBlockByName=function(a){for(var c=0,d=this.attachedBlocks;c<d.length;c++){var f=d[c];if(f.name===a)return f}return null},b.prototype.getBlockByPredicate=function(a){for(var c=0,d=this.attachedBlocks;c<d.length;c++){var f=d[c];if(a(f))return f}return null},b.prototype.getInputBlockByPredicate=function(a){for(var c=0,d=this.attachedBlocks;c<d.length;c++){var f=d[c];if(f.isInput&&a(f))return f}return null},b.prototype.getInputBlocks=function(){for(var a=[],c=0,d=this.attachedBlocks;c<d.length;c++){var f=d[c];f.isInput&&a.push(f)}return a},b.prototype.registerOptimizer=function(a){if(!(this._optimizers.indexOf(a)>-1))return this._optimizers.push(a),this},b.prototype.unregisterOptimizer=function(a){var c=this._optimizers.indexOf(a);if(-1!==c)return this._optimizers.splice(c,1),this},b.prototype.addOutputNode=function(a){if(null===a.target)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";return 0!=(a.target&Ia.Vertex)&&this._addVertexOutputNode(a),0!=(a.target&Ia.Fragment)&&this._addFragmentOutputNode(a),this},b.prototype.removeOutputNode=function(a){return null===a.target?this:(0!=(a.target&Ia.Vertex)&&this._removeVertexOutputNode(a),0!=(a.target&Ia.Fragment)&&this._removeFragmentOutputNode(a),this)},b.prototype._addVertexOutputNode=function(a){if(-1===this._vertexOutputNodes.indexOf(a))return a.target=Ia.Vertex,this._vertexOutputNodes.push(a),this},b.prototype._removeVertexOutputNode=function(a){var c=this._vertexOutputNodes.indexOf(a);if(-1!==c)return this._vertexOutputNodes.splice(c,1),this},b.prototype._addFragmentOutputNode=function(a){if(-1===this._fragmentOutputNodes.indexOf(a))return a.target=Ia.Fragment,this._fragmentOutputNodes.push(a),this},b.prototype._removeFragmentOutputNode=function(a){var c=this._fragmentOutputNodes.indexOf(a);if(-1!==c)return this._fragmentOutputNodes.splice(c,1),this},b.prototype.needAlphaBlending=function(){return!this.ignoreAlpha&&(this.alpha<1||this._sharedData&&this._sharedData.hints.needAlphaBlending)},b.prototype.needAlphaTesting=function(){return this._sharedData&&this._sharedData.hints.needAlphaTesting},b.prototype._initializeBlock=function(a,c,d){if(a.initialize(c),a.autoConfigure(this),a._preparationId=this._buildId,-1===this.attachedBlocks.indexOf(a)){if(a.isUnique){for(var f=a.getClassName(),g=0,h=this.attachedBlocks;g<h.length;g++)if(h[g].getClassName()===f)throw"Cannot have multiple blocks of type "+f+" in the same NodeMaterial"}this.attachedBlocks.push(a)}for(var j=0,m=a.inputs;j<m.length;j++){var w=m[j];w.associatedVariableName="";var z=w.connectedPoint;if(z){var C=z.ownerBlock;C!==a&&(C.target===Ia.VertexAndFragment?d.push(C):c.target===Ia.Fragment&&C.target===Ia.Vertex&&C._preparationId!==this._buildId&&d.push(C),this._initializeBlock(C,c,d))}}for(var J=0,K=a.outputs;J<K.length;J++)K[J].associatedVariableName=""},b.prototype._resetDualBlocks=function(a,c){a.target===Ia.VertexAndFragment&&(a.buildId=c);for(var d=0,f=a.inputs;d<f.length;d++){var g=f[d].connectedPoint;if(g){var h=g.ownerBlock;h!==a&&this._resetDualBlocks(h,c)}}},b.prototype.removeBlock=function(a){var c=this.attachedBlocks.indexOf(a);c>-1&&this.attachedBlocks.splice(c,1),a.isFinalMerger&&this.removeOutputNode(a)},b.prototype.build=function(a){void 0===a&&(a=!1),this._buildWasSuccessful=!1;var c=this.getScene().getEngine();if(0===this._vertexOutputNodes.length)throw"You must define at least one vertexOutputNode";if(0===this._fragmentOutputNodes.length)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new Aj(),this._vertexCompilationState.supportUniformBuffers=c.supportsUniformBuffers,this._vertexCompilationState.target=Ia.Vertex,this._fragmentCompilationState=new Aj(),this._fragmentCompilationState.supportUniformBuffers=c.supportsUniformBuffers,this._fragmentCompilationState.target=Ia.Fragment,this._sharedData=new Jn(),this._vertexCompilationState.sharedData=this._sharedData,this._fragmentCompilationState.sharedData=this._sharedData,this._sharedData.buildId=this._buildId,this._sharedData.emitComments=this._options.emitComments,this._sharedData.verbose=a,this._sharedData.scene=this.getScene();for(var d=[],f=[],g=0,h=this._vertexOutputNodes;g<h.length;g++){var j=h[g];d.push(j),this._initializeBlock(j,this._vertexCompilationState,f)}for(var m=0,w=this._fragmentOutputNodes;m<w.length;m++){var z=w[m];f.push(z),this._initializeBlock(z,this._fragmentCompilationState,d)}this.optimize();for(var C=0,J=d;C<J.length;C++)(j=J[C]).build(this._vertexCompilationState,d);this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0),this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration,this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration,this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(var K=0,N=f;K<N.length;K++)z=N[K],this._resetDualBlocks(z,this._buildId-1);for(var T=0,Z=f;T<Z.length;T++)(z=Z[T]).build(this._fragmentCompilationState,f);this._vertexCompilationState.finalize(this._vertexCompilationState),this._fragmentCompilationState.finalize(this._fragmentCompilationState),this._buildId=b._BuildIdGenerator++,this._sharedData.emitErrors(),a&&(console.log("Vertex shader:"),console.log(this._vertexCompilationState.compilationString),console.log("Fragment shader:"),console.log(this._fragmentCompilationState.compilationString)),this._buildWasSuccessful=!0,this.onBuildObservable.notifyObservers(this);for(var _=0,ca=this.getScene().meshes;_<ca.length;_++){var ea=ca[_];if(ea.subMeshes)for(var fa=0,ka=ea.subMeshes;fa<ka.length;fa++){var pa=ka[fa];if(pa.getMaterial()===this&&pa._materialDefines){var va=pa._materialDefines;va.markAllAsDirty(),va.reset()}}}},b.prototype.optimize=function(){for(var a=0,c=this._optimizers;a<c.length;a++)c[a].optimize(this._vertexOutputNodes,this._fragmentOutputNodes)},b.prototype._prepareDefinesForAttributes=function(a,c){var d=c.NORMAL,f=c.TANGENT,g=c.UV1;c.NORMAL=a.isVerticesDataPresent(ra.b.NormalKind),c.TANGENT=a.isVerticesDataPresent(ra.b.TangentKind),c.UV1=a.isVerticesDataPresent(ra.b.UVKind),d===c.NORMAL&&f===c.TANGENT&&g===c.UV1||c.markAsAttributesDirty()},b.prototype.isReadyForSubMesh=function(a,c,d){var f=this;if(void 0===d&&(d=!1),!this._buildWasSuccessful)return!1;var g=this.getScene();if(this._sharedData.animatedInputs){var h=g.getFrameId();if(this._animationFrame!==h){for(var j=0,m=this._sharedData.animatedInputs;j<m.length;j++)m[j].animate(g);this._animationFrame=h}}if(c.effect&&this.isFrozen&&c.effect._wasPreviouslyReady)return!0;c._materialDefines||(c._materialDefines=new Bj());var w=c._materialDefines;if(!this.checkReadyOnEveryCall&&c.effect&&w._renderId===g.getRenderId())return!0;var z=g.getEngine();if(this._prepareDefinesForAttributes(a,w),this._sharedData.blockingBlocks.some(function(ca){return!ca.isReady(a,f,w,d)}))return!1;if(this._sharedData.blocksWithDefines.forEach(function(ca){ca.initializeDefines(a,f,w,d)}),this._sharedData.blocksWithDefines.forEach(function(ca){ca.prepareDefines(a,f,w,d)}),w.isDirty){w.markAsProcessed(),this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString,this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString,this._sharedData.repeatableContentBlocks.forEach(function(ca){ca.replaceRepeatableContent(f._vertexCompilationState,f._fragmentCompilationState,a,w)});var C=[];this._sharedData.dynamicUniformBlocks.forEach(function(ca){ca.updateUniformsAndSamples(f._vertexCompilationState,f,w,C)});var J=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach(function(ca){-1===J.indexOf(ca)&&J.push(ca)});var K=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach(function(ca){-1===K.indexOf(ca)&&K.push(ca)});var N=new Nd.a();this._sharedData.blocksWithFallbacks.forEach(function(ca){ca.provideFallbacks(a,N)});var T=c.effect,Z=w.toString(),_=z.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,uniformsNames:J,uniformBuffersNames:C,samplers:K,defines:Z,fallbacks:N,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:w.NUM_MORPH_INFLUENCERS}},z);_&&(this.allowShaderHotSwapping&&T&&!_.isReady()?(_=T,w.markAsUnprocessed()):(g.resetCachedMaterial(),c.setEffect(_,w)))}return!(!c.effect||!c.effect.isReady())&&(w._renderId=g.getRenderId(),c.effect._wasPreviouslyReady=!0,!0)},Object.defineProperty(b.prototype,"compiledShaders",{get:function(){return`// Vertex shader\r
`+this._vertexCompilationState.compilationString+`\r
\r
// Fragment shader\r
`+this._fragmentCompilationState.compilationString},enumerable:!0,configurable:!0}),b.prototype.bindOnlyWorldMatrix=function(a){var c=this.getScene();if(this._activeEffect){var d=this._sharedData.hints;d.needWorldViewMatrix&&a.multiplyToRef(c.getViewMatrix(),this._cachedWorldViewMatrix),d.needWorldViewProjectionMatrix&&a.multiplyToRef(c.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);for(var f=0,g=this._sharedData.inputBlocks;f<g.length;f++)g[f]._transmitWorld(this._activeEffect,a,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}},b.prototype.bindForSubMesh=function(a,c,d){var f=this.getScene(),g=d.effect;if(g){if(this._activeEffect=g,this.bindOnlyWorldMatrix(a),this._mustRebind(f,g,c.visibility)){var h=this._sharedData;if(g&&f.getCachedEffect()!==g){for(var j=0,m=h.bindableBlocks;j<m.length;j++)m[j].bind(g,this,c);for(var w=0,z=h.inputBlocks;w<z.length;w++)z[w]._transmit(g,f)}}this._afterBind(c,this._activeEffect)}},b.prototype.getActiveTextures=function(){var a=e.prototype.getActiveTextures.call(this);return this._sharedData&&a.push.apply(a,this._sharedData.textureBlocks.filter(function(c){return c.texture}).map(function(c){return c.texture})),a},b.prototype.getTextureBlocks=function(){return this._sharedData?this._sharedData.textureBlocks:[]},b.prototype.hasTexture=function(a){if(e.prototype.hasTexture.call(this,a))return!0;if(!this._sharedData)return!1;for(var c=0,d=this._sharedData.textureBlocks;c<d.length;c++)if(d[c].texture===a)return!0;return!1},b.prototype.dispose=function(a,c,d){if(c)for(var f=0,g=this._sharedData.textureBlocks.filter(function(m){return m.texture}).map(function(m){return m.texture});f<g.length;f++)g[f].dispose();for(var h=0,j=this.attachedBlocks;h<j.length;h++)j[h].dispose();this.onBuildObservable.clear(),e.prototype.dispose.call(this,a,c,d)},b.prototype._createNodeEditor=function(){this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),this.BJSNODEMATERIALEDITOR.NodeEditor.Show({nodeMaterial:this})},b.prototype.edit=function(a){var c=this;return new Promise(function(d,f){if(void 0===c.BJSNODEMATERIALEDITOR){var g=a&&a.editorURL?a.editorURL:b.EditorURL;Qa.b.LoadScript(g,function(){c._createNodeEditor(),d()})}else c._createNodeEditor(),d()})},b.prototype.clear=function(){this._vertexOutputNodes=[],this._fragmentOutputNodes=[],this.attachedBlocks=[]},b.prototype.setToDefault=function(){this.clear(),this.editorData=null;var a=new xb("Position");a.setAsAttribute("position");var c=new xb("World");c.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);var d=new yf("WorldPos");a.connectTo(d),c.connectTo(d);var f=new xb("ViewProjection");f.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);var g=new yf("WorldPos * ViewProjectionTransform");d.connectTo(g),f.connectTo(g);var h=new Vg("VertexOutput");g.connectTo(h);var j=new xb("color");j.value=new G.b(.8,.8,.8,1);var m=new Wg("FragmentOutput");j.connectTo(m),this.addOutputNode(h),this.addOutputNode(m)},b.prototype.loadAsync=function(a){var c=this;return this.getScene()._loadFileAsync(a).then(function(d){var f=JSON.parse(d);c.loadFromSerialization(f,"")})},b.prototype._gatherBlocks=function(a,c){if(-1===c.indexOf(a)){c.push(a);for(var d=0,f=a.inputs;d<f.length;d++){var g=f[d].connectedPoint;if(g){var h=g.ownerBlock;h!==a&&this._gatherBlocks(h,c)}}}},b.prototype.generateCode=function(){for(var a=[],c=[],d=[],f=0,g=this._vertexOutputNodes;f<g.length;f++){var h=g[f];this._gatherBlocks(h,c)}for(var j=[],m=0,w=this._fragmentOutputNodes;m<w.length;m++)h=w[m],this._gatherBlocks(h,j);for(var z='var nodeMaterial = new BABYLON.NodeMaterial("'+(this.name||"node material")+`");\r
`,C=0,J=c;C<J.length;C++)(va=J[C]).isInput&&-1===a.indexOf(va)&&(z+=va._dumpCode(d,a));for(var K=0,N=j;K<N.length;K++)(va=N[K]).isInput&&-1===a.indexOf(va)&&(z+=va._dumpCode(d,a));a=[],z+=`\r
// Connections\r
`;for(var T=0,Z=this._vertexOutputNodes;T<Z.length;T++)z+=(va=Z[T])._dumpCodeForOutputConnections(a);for(var _=0,ca=this._fragmentOutputNodes;_<ca.length;_++)z+=(va=ca[_])._dumpCodeForOutputConnections(a);z+=`\r
// Output nodes\r
`;for(var ea=0,fa=this._vertexOutputNodes;ea<fa.length;ea++)z+="nodeMaterial.addOutputNode("+(va=fa[ea])._codeVariableName+`);\r
`;for(var ka=0,pa=this._fragmentOutputNodes;ka<pa.length;ka++){var va;z+="nodeMaterial.addOutputNode("+(va=pa[ka])._codeVariableName+`);\r
`}return z+=`nodeMaterial.build();\r
`},b.prototype.serialize=function(a){var c=a?{}:F.a.Serialize(this);c.editorData=JSON.parse(JSON.stringify(this.editorData));var d=[];if(a)d=a;else{c.customType="BABYLON.NodeMaterial",c.outputNodes=[];for(var f=0,g=this._vertexOutputNodes;f<g.length;f++){var h=g[f];this._gatherBlocks(h,d),c.outputNodes.push(h.uniqueId)}for(var j=0,m=this._fragmentOutputNodes;j<m.length;j++)h=m[j],this._gatherBlocks(h,d),-1===c.outputNodes.indexOf(h.uniqueId)&&c.outputNodes.push(h.uniqueId)}c.blocks=[];for(var w=0,z=d;w<z.length;w++){var C=z[w];c.blocks.push(C.serialize())}if(!a)for(var J=0,K=this.attachedBlocks;J<K.length;J++)C=K[J],-1===d.indexOf(C)&&c.blocks.push(C.serialize());return c},b.prototype._restoreConnections=function(a,c,d){for(var f=0,g=a.outputs;f<g.length;f++)for(var h=g[f],j=0,m=c.blocks;j<m.length;j++)for(var w=m[j],z=d[w.id],C=0,J=w.inputs;C<J.length;C++){var K=J[C];if(!(d[K.targetBlockId]!==a||K.targetConnectionName!==h.name)){var N=z.getInputByName(K.inputName);if(!N||N.isConnected)continue;h.connectTo(N,!0),this._restoreConnections(z,c,d)}}},b.prototype.loadFromSerialization=function(a,c){void 0===c&&(c=""),this.clear();for(var d={},f=0,g=a.blocks;f<g.length;f++){var h=g[f],j=D.a.GetClass(h.customType);j&&((w=new j())._deserialize(h,this.getScene(),c),d[h.id]=w,this.attachedBlocks.push(w))}for(var m=0;m<a.blocks.length;m++){var w;(w=d[a.blocks[m].id]).inputs.length||this._restoreConnections(w,a,d)}for(var z=0,C=a.outputNodes;z<C.length;z++){var J=C[z];this.addOutputNode(d[J])}if(a.locations||a.editorData&&a.editorData.locations){for(var K=a.locations||a.editorData.locations,N=0,T=K;N<T.length;N++){var Z=T[N];d[Z.blockId]&&(Z.blockId=d[Z.blockId].uniqueId)}a.locations?this.editorData={locations:K}:(this.editorData=a.editorData,this.editorData.locations=K);var _=[];for(var ca in d)_[ca]=d[ca].uniqueId;this.editorData.map=_}},b.Parse=function(a,c,d){void 0===d&&(d="");var f=F.a.Parse(function(){return new b(a.name,c)},a,c,d);return f.loadFromSerialization(a,d),f.build(),f},b.ParseFromFileAsync=function(a,c,d){var f=new b(a,d);return new Promise(function(g,h){return f.loadAsync(c).then(function(){return g(f)}).catch(h)})},b.ParseFromSnippetAsync=function(a,c,d){var f=this;return void 0===d&&(d=""),new Promise(function(g,h){var j=new Xd.a();j.addEventListener("readystatechange",function(){if(4==j.readyState)if(200==j.status){var m=JSON.parse(JSON.parse(j.responseText).jsonPayload),w=JSON.parse(m.nodeMaterial),z=F.a.Parse(function(){return new b(a,c)},w,c,d);z.loadFromSerialization(w);try{z.build(!0),g(z)}catch(C){h(C)}}else h("Unable to load the snippet "+a)}),j.open("GET",f.SnippetUrl+"/"+a.replace("#","/")),j.send()})},b.CreateDefault=function(a,c){var d=new b(a,c);return d.setToDefault(),d.build(),d},b._BuildIdGenerator=0,b.EditorURL="https://unpkg.com/babylonjs-node-editor@"+Ha.a.Version+"/babylon.nodeEditor.js",b.SnippetUrl="https://snippet.babylonjs.com",b}(nf.a);D.a.RegisteredTypes["BABYLON.NodeMaterial"]=Cj;var Dj=function(e){function b(a){var c=e.call(this,a,Ia.Vertex)||this;return c.registerInput("matricesIndices",ha.Vector4),c.registerInput("matricesWeights",ha.Vector4),c.registerInput("matricesIndicesExtra",ha.Vector4,!0),c.registerInput("matricesWeightsExtra",ha.Vector4,!0),c.registerInput("world",ha.Matrix),c.registerOutput("output",ha.Matrix),c}return Object(l.d)(b,e),b.prototype.initialize=function(a){a._excludeVariableName("boneSampler"),a._excludeVariableName("boneTextureWidth"),a._excludeVariableName("mBones"),a._excludeVariableName("BonesPerMesh")},b.prototype.getClassName=function(){return"BonesBlock"},Object.defineProperty(b.prototype,"matricesIndices",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"matricesWeights",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"matricesIndicesExtra",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"matricesWeightsExtra",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype.autoConfigure=function(a){if(!this.matricesIndices.isConnected){var c=a.getInputBlockByPredicate(function(g){return g.isAttribute&&"matricesIndices"===g.name});c||(c=new xb("matricesIndices")).setAsAttribute("matricesIndices"),c.output.connectTo(this.matricesIndices)}if(!this.matricesWeights.isConnected){var d=a.getInputBlockByPredicate(function(g){return g.isAttribute&&"matricesWeights"===g.name});d||(d=new xb("matricesWeights")).setAsAttribute("matricesWeights"),d.output.connectTo(this.matricesWeights)}if(!this.world.isConnected){var f=a.getInputBlockByPredicate(function(g){return g.systemValue===nb.World});f||(f=new xb("world")).setAsSystemValue(nb.World),f.output.connectTo(this.world)}},b.prototype.provideFallbacks=function(a,c){a&&a.useBones&&a.computeBonesUsingShaders&&a.skeleton&&c.addCPUSkinningFallback(0,a)},b.prototype.bind=function(a,c,d){Ua.a.BindBonesParameters(d,a)},b.prototype.prepareDefines=function(a,c,d){d._areAttributesDirty&&Ua.a.PrepareDefinesForBones(a,d)},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a),a.sharedData.blocksWithFallbacks.push(this),a.sharedData.bindableBlocks.push(this),a.sharedData.blocksWithDefines.push(this),a.uniforms.push("boneTextureWidth"),a.uniforms.push("mBones"),a.samplers.push("boneSampler");var c="//"+this.name;a._emitFunctionFromInclude("bonesDeclaration",c,{removeAttributes:!0,removeUniforms:!1,removeVaryings:!0,removeIfDef:!1});var d=a._getFreeVariableName("influence");a.compilationString+=a._emitCodeFromInclude("bonesVertex",c,{replaceStrings:[{search:/finalWorld=finalWorld\*influence;/,replace:""},{search:/influence/gm,replace:d}]});var f=this._outputs[0],g=this.world;return a.compilationString+=`#if NUM_BONE_INFLUENCERS>0\r
`,a.compilationString+=this._declareOutput(f,a)+" = "+g.associatedVariableName+" * "+d+`;\r
`,a.compilationString+=`#else\r
`,a.compilationString+=this._declareOutput(f,a)+" = "+g.associatedVariableName+`;\r
`,a.compilationString+=`#endif\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.BonesBlock"]=Dj;var Ej=function(e){function b(a){var c=e.call(this,a,Ia.Vertex)||this;return c.registerInput("world0",ha.Vector4),c.registerInput("world1",ha.Vector4),c.registerInput("world2",ha.Vector4),c.registerInput("world3",ha.Vector4),c.registerInput("world",ha.Matrix,!0),c.registerOutput("output",ha.Matrix),c.registerOutput("instanceID",ha.Float),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"InstancesBlock"},Object.defineProperty(b.prototype,"world0",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"world1",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"world2",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"world3",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"instanceID",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),b.prototype.autoConfigure=function(a){if(!this.world0.connectedPoint){var c=a.getInputBlockByPredicate(function(j){return j.isAttribute&&"world0"===j.name});c||(c=new xb("world0")).setAsAttribute("world0"),c.output.connectTo(this.world0)}if(!this.world1.connectedPoint){var d=a.getInputBlockByPredicate(function(j){return j.isAttribute&&"world1"===j.name});d||(d=new xb("world1")).setAsAttribute("world1"),d.output.connectTo(this.world1)}if(!this.world2.connectedPoint){var f=a.getInputBlockByPredicate(function(j){return j.isAttribute&&"world2"===j.name});f||(f=new xb("world2")).setAsAttribute("world2"),f.output.connectTo(this.world2)}if(!this.world3.connectedPoint){var g=a.getInputBlockByPredicate(function(j){return j.isAttribute&&"world3"===j.name});g||(g=new xb("world3")).setAsAttribute("world3"),g.output.connectTo(this.world3)}if(!this.world.connectedPoint){var h=a.getInputBlockByPredicate(function(j){return j.isAttribute&&"world"===j.name});h||(h=new xb("world")).setAsSystemValue(nb.World),h.output.connectTo(this.world)}this.world.define="!INSTANCES"},b.prototype.prepareDefines=function(a,c,d,f){void 0===f&&(f=!1);var g=!1;d.INSTANCES!==f&&(d.setValue("INSTANCES",f),g=!0),g&&d.markAsUnprocessed()},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a),a.sharedData.blocksWithDefines.push(this);var c=this._outputs[0],d=this._outputs[1],f=this.world0,g=this.world1,h=this.world2,j=this.world3;return a.compilationString+=`#ifdef INSTANCES\r
`,a.compilationString+=this._declareOutput(c,a)+" = mat4("+f.associatedVariableName+", "+g.associatedVariableName+", "+h.associatedVariableName+", "+j.associatedVariableName+`);\r
`,a.compilationString+=this._declareOutput(d,a)+` = float(gl_InstanceID);\r
`,a.compilationString+=`#else\r
`,a.compilationString+=this._declareOutput(c,a)+" = "+this.world.associatedVariableName+`;\r
`,a.compilationString+=this._declareOutput(d,a)+` = 0.0;\r
`,a.compilationString+=`#endif\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.InstancesBlock"]=Ej;var Fj=function(e){function b(a){var c=e.call(this,a,Ia.Vertex)||this;return c.registerInput("position",ha.Vector3),c.registerInput("normal",ha.Vector3),c.registerInput("tangent",ha.Vector3),c.registerInput("uv",ha.Vector2),c.registerOutput("positionOutput",ha.Vector3),c.registerOutput("normalOutput",ha.Vector3),c.registerOutput("tangentOutput",ha.Vector3),c.registerOutput("uvOutput",ha.Vector2),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"MorphTargetsBlock"},Object.defineProperty(b.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"tangent",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"positionOutput",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"normalOutput",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"tangentOutput",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"uvOutput",{get:function(){return this._outputs[3]},enumerable:!0,configurable:!0}),b.prototype.initialize=function(a){a._excludeVariableName("morphTargetInfluences")},b.prototype.autoConfigure=function(a){if(!this.position.isConnected){var c=a.getInputBlockByPredicate(function(h){return h.isAttribute&&"position"===h.name});c||(c=new xb("position")).setAsAttribute(),c.output.connectTo(this.position)}if(!this.normal.isConnected){var d=a.getInputBlockByPredicate(function(h){return h.isAttribute&&"normal"===h.name});d||(d=new xb("normal")).setAsAttribute("normal"),d.output.connectTo(this.normal)}if(!this.tangent.isConnected){var f=a.getInputBlockByPredicate(function(h){return h.isAttribute&&"tangent"===h.name});f||(f=new xb("tangent")).setAsAttribute("tangent"),f.output.connectTo(this.tangent)}if(!this.uv.isConnected){var g=a.getInputBlockByPredicate(function(h){return h.isAttribute&&"uv"===h.name});g||(g=new xb("uv")).setAsAttribute("uv"),g.output.connectTo(this.uv)}},b.prototype.prepareDefines=function(a,c,d){d._areAttributesDirty&&Ua.a.PrepareDefinesForMorphTargets(a,d)},b.prototype.bind=function(a,c,d){d&&d.morphTargetManager&&d.morphTargetManager.numInfluencers>0&&Ua.a.BindMorphTargetParameters(d,a)},b.prototype.replaceRepeatableContent=function(a,c,d,f){for(var g=this.position,h=this.normal,j=this.tangent,m=this.uv,w=this.positionOutput,z=this.normalOutput,C=this.tangentOutput,J=this.uvOutput,K=a,N=f.NUM_MORPH_INFLUENCERS,T=d.morphTargetManager,Z=T&&T.supportsNormals&&f.NORMAL,_=T&&T.supportsTangents&&f.TANGENT,ca=T&&T.supportsUVs&&f.UV1,ea="",fa=0;fa<N;fa++)ea+=`#ifdef MORPHTARGETS\r
`,ea+=w.associatedVariableName+" += (position"+fa+" - "+g.associatedVariableName+") * morphTargetInfluences["+fa+`];\r
`,Z&&(ea+=`#ifdef MORPHTARGETS_NORMAL\r
`,ea+=z.associatedVariableName+" += (normal"+fa+" - "+h.associatedVariableName+") * morphTargetInfluences["+fa+`];\r
`,ea+=`#endif\r
`),_&&(ea+=`#ifdef MORPHTARGETS_TANGENT\r
`,ea+=C.associatedVariableName+".xyz += (tangent"+fa+" - "+j.associatedVariableName+".xyz) * morphTargetInfluences["+fa+`];\r
`,ea+=`#endif\r
`),ca&&(ea+=`#ifdef MORPHTARGETS_UV\r
`,ea+=J.associatedVariableName+".xy += (uv_"+fa+" - "+m.associatedVariableName+".xy) * morphTargetInfluences["+fa+`];\r
`,ea+=`#endif\r
`),ea+=`#endif\r
`;if(K.compilationString=K.compilationString.replace(this._repeatableContentAnchor,ea),N>0)for(fa=0;fa<N;fa++)K.attributes.push(ra.b.PositionKind+fa),Z&&K.attributes.push(ra.b.NormalKind+fa),_&&K.attributes.push(ra.b.TangentKind+fa),ca&&K.attributes.push(ra.b.UVKind+"_"+fa)},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a),a.sharedData.blocksWithDefines.push(this),a.sharedData.bindableBlocks.push(this),a.sharedData.repeatableContentBlocks.push(this);var c=this.position,d=this.normal,f=this.tangent,g=this.uv,h=this.positionOutput,j=this.normalOutput,m=this.tangentOutput,w=this.uvOutput,z="//"+this.name;return a.uniforms.push("morphTargetInfluences"),a._emitFunctionFromInclude("morphTargetsVertexGlobalDeclaration",z),a._emitFunctionFromInclude("morphTargetsVertexDeclaration",z,{repeatKey:"maxSimultaneousMorphTargets"}),a.compilationString+=this._declareOutput(h,a)+" = "+c.associatedVariableName+`;\r
`,a.compilationString+=`#ifdef NORMAL\r
`,a.compilationString+=this._declareOutput(j,a)+" = "+d.associatedVariableName+`;\r
`,a.compilationString+=`#else\r
`,a.compilationString+=this._declareOutput(j,a)+` = vec3(0., 0., 0.);\r
`,a.compilationString+=`#endif\r
`,a.compilationString+=`#ifdef TANGENT\r
`,a.compilationString+=this._declareOutput(m,a)+" = "+f.associatedVariableName+`;\r
`,a.compilationString+=`#else\r
`,a.compilationString+=this._declareOutput(m,a)+` = vec3(0., 0., 0.);\r
`,a.compilationString+=`#endif\r
`,a.compilationString+=`#ifdef UV1\r
`,a.compilationString+=this._declareOutput(w,a)+" = "+g.associatedVariableName+`;\r
`,a.compilationString+=`#else\r
`,a.compilationString+=this._declareOutput(w,a)+` = vec2(0., 0.);\r
`,a.compilationString+=`#endif\r
`,this._repeatableContentAnchor=a._repeatableContentAnchor,a.compilationString+=this._repeatableContentAnchor,this},b}(ib);D.a.RegisteredTypes["BABYLON.MorphTargetsBlock"]=Fj;var Gj=function(e){function b(a){var c=e.call(this,a,Ia.Vertex)||this;return c.registerInput("worldPosition",ha.Vector4,!1,Ia.Vertex),c.registerOutput("direction",ha.Vector3),c.registerOutput("color",ha.Color3),c.registerOutput("intensity",ha.Float),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"LightInformationBlock"},Object.defineProperty(b.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"direction",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"color",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"intensity",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),b.prototype.bind=function(a,c,d){if(d){this.light&&this.light.isDisposed&&(this.light=null);var f=this.light,g=c.getScene();if(!f&&g.lights.length&&(f=g.lights[0]),!f||!f.isEnabled)return a.setFloat3(this._lightDataUniformName,0,0,0),void a.setFloat4(this._lightColorUniformName,0,0,0,0);f.transferToNodeMaterialEffect(a,this._lightDataUniformName),a.setColor4(this._lightColorUniformName,f.diffuse,f.intensity)}},b.prototype.prepareDefines=function(a,c,d){if(d._areLightsDirty){var f=this.light;d.setValue(this._lightTypeDefineName,!!(f&&f instanceof Mg))}},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a),a.sharedData.bindableBlocks.push(this),a.sharedData.blocksWithDefines.push(this);var c=this.direction,d=this.color,f=this.intensity;return this._lightDataUniformName=a._getFreeVariableName("lightData"),this._lightColorUniformName=a._getFreeVariableName("lightColor"),this._lightTypeDefineName=a._getFreeDefineName("LIGHTPOINTTYPE"),a._emitUniformFromString(this._lightDataUniformName,"vec3"),a._emitUniformFromString(this._lightColorUniformName,"vec4"),a.compilationString+="#ifdef "+this._lightTypeDefineName+`\r
`,a.compilationString+=this._declareOutput(c,a)+" = normalize("+this.worldPosition.associatedVariableName+".xyz - "+this._lightDataUniformName+`);\r
`,a.compilationString+=`#else\r
`,a.compilationString+=this._declareOutput(c,a)+" = "+this._lightDataUniformName+`;\r
`,a.compilationString+=`#endif\r
`,a.compilationString+=this._declareOutput(d,a)+" = "+this._lightColorUniformName+`.rgb;\r
`,a.compilationString+=this._declareOutput(f,a)+" = "+this._lightColorUniformName+`.a;\r
`,this},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return this.light&&(a.lightId=this.light.id),a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),a.lightId&&(this.light=c.getLightByID(a.lightId))},b}(ib);D.a.RegisteredTypes["BABYLON.LightInformationBlock"]=Gj;var Hj=function(e){function b(a){var c=e.call(this,a,Ia.Fragment)||this;return c.registerInput("color",ha.Color4),c.registerOutput("output",ha.Color4),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color3),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ImageProcessingBlock"},Object.defineProperty(b.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype.initialize=function(a){a._excludeVariableName("exposureLinear"),a._excludeVariableName("contrast"),a._excludeVariableName("vInverseScreenSize"),a._excludeVariableName("vignetteSettings1"),a._excludeVariableName("vignetteSettings2"),a._excludeVariableName("vCameraColorCurveNegative"),a._excludeVariableName("vCameraColorCurveNeutral"),a._excludeVariableName("vCameraColorCurvePositive"),a._excludeVariableName("txColorTransform"),a._excludeVariableName("colorTransformSettings")},b.prototype.isReady=function(a,c,d){return!(d._areImageProcessingDirty&&c.imageProcessingConfiguration&&!c.imageProcessingConfiguration.isReady())},b.prototype.prepareDefines=function(a,c,d){d._areImageProcessingDirty&&c.imageProcessingConfiguration&&c.imageProcessingConfiguration.prepareDefines(d)},b.prototype.bind=function(a,c,d){d&&c.imageProcessingConfiguration&&c.imageProcessingConfiguration.bind(a)},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a),a.sharedData.blocksWithDefines.push(this),a.sharedData.blockingBlocks.push(this),a.sharedData.bindableBlocks.push(this),a.uniforms.push("exposureLinear"),a.uniforms.push("contrast"),a.uniforms.push("vInverseScreenSize"),a.uniforms.push("vignetteSettings1"),a.uniforms.push("vignetteSettings2"),a.uniforms.push("vCameraColorCurveNegative"),a.uniforms.push("vCameraColorCurveNeutral"),a.uniforms.push("vCameraColorCurvePositive"),a.uniforms.push("txColorTransform"),a.uniforms.push("colorTransformSettings");var c=this.color,d=this._outputs[0],f="//"+this.name;return a._emitFunctionFromInclude("helperFunctions",f),a._emitFunctionFromInclude("imageProcessingDeclaration",f),a._emitFunctionFromInclude("imageProcessingFunctions",f),c.connectedPoint.type===ha.Color4||c.connectedPoint.type===ha.Vector4?a.compilationString+=this._declareOutput(d,a)+" = "+c.associatedVariableName+`;\r
`:a.compilationString+=this._declareOutput(d,a)+" = vec4("+c.associatedVariableName+`, 1.0);\r
`,a.compilationString+=`#ifdef IMAGEPROCESSINGPOSTPROCESS\r
`,a.compilationString+=d.associatedVariableName+".rgb = toLinearSpace("+c.associatedVariableName+`.rgb);\r
`,a.compilationString+=`#else\r
`,a.compilationString+=`#ifdef IMAGEPROCESSING\r
`,a.compilationString+=d.associatedVariableName+".rgb = toLinearSpace("+c.associatedVariableName+`.rgb);\r
`,a.compilationString+=d.associatedVariableName+" = applyImageProcessing("+d.associatedVariableName+`);\r
`,a.compilationString+=`#endif\r
`,a.compilationString+=`#endif\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.ImageProcessingBlock"]=Hj;var Ij=function(e){function b(a){var c=e.call(this,a,Ia.Fragment)||this;return c._tangentSpaceParameterName="",c.invertX=!1,c.invertY=!1,c.registerInput("worldPosition",ha.Vector4,!1),c.registerInput("worldNormal",ha.Vector4,!1),c.registerInput("worldTangent",ha.Vector4,!0),c.registerInput("uv",ha.Vector2,!1),c.registerInput("normalMapColor",ha.Color3,!1),c.registerInput("strength",ha.Float,!1),c.registerOutput("output",ha.Vector4),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"PerturbNormalBlock"},Object.defineProperty(b.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"worldTangent",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"normalMapColor",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"strength",{get:function(){return this._inputs[5]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype.prepareDefines=function(a,c,d){d.setValue("BUMP",!0)},b.prototype.bind=function(a,c,d){c.getScene()._mirroredCameraPosition?a.setFloat2(this._tangentSpaceParameterName,this.invertX?1:-1,this.invertY?1:-1):a.setFloat2(this._tangentSpaceParameterName,this.invertX?-1:1,this.invertY?-1:1)},b.prototype.autoConfigure=function(a){if(!this.uv.isConnected){var c=a.getInputBlockByPredicate(function(f){return f.isAttribute&&"uv"===f.name});c||(c=new xb("uv")).setAsAttribute(),c.output.connectTo(this.uv)}if(!this.strength.isConnected){var d=new xb("strength");d.value=1,d.output.connectTo(this.strength)}},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c="//"+this.name,d=this.uv,f=this.worldPosition,g=this.worldNormal,h=this.worldTangent;a.sharedData.blocksWithDefines.push(this),a.sharedData.bindableBlocks.push(this),this._tangentSpaceParameterName=a._getFreeDefineName("tangentSpaceParameter"),a._emitUniformFromString(this._tangentSpaceParameterName,"vec2");var j=this.strength.isConnectedToInputBlock&&this.strength.connectInputBlock.isConstant?""+a._emitFloat(1/this.strength.connectInputBlock.value):"1.0 / "+this.strength.associatedVariableName;a._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var m={search:/defined\(TANGENT\)/g,replace:h.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return h.isConnected&&(a.compilationString+="vec3 tbnNormal = normalize("+g.associatedVariableName+`.xyz);\r
`,a.compilationString+="vec3 tbnTangent = normalize("+h.associatedVariableName+`.xyz);\r
`,a.compilationString+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r
`,a.compilationString+=`mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r
`),a._emitFunctionFromInclude("bumpFragmentFunctions",c,{replaceStrings:[{search:/vBumpInfos.y/g,replace:j},{search:/vTangentSpaceParams/g,replace:this._tangentSpaceParameterName},{search:/vPositionW/g,replace:f.associatedVariableName+".xyz"},m]}),a.compilationString+=this._declareOutput(this.output,a)+` = vec4(0.);\r
`,a.compilationString+=a._emitCodeFromInclude("bumpFragment",c,{replaceStrings:[{search:/perturbNormal\(TBN,vBumpUV\+uvOffset\)/g,replace:"perturbNormal(TBN, "+this.normalMapColor.associatedVariableName+")"},{search:/vBumpInfos.y/g,replace:j},{search:/vBumpUV/g,replace:d.associatedVariableName},{search:/vPositionW/g,replace:f.associatedVariableName+".xyz"},{search:/normalW=/g,replace:this.output.associatedVariableName+".xyz = "},{search:/normalW/g,replace:g.associatedVariableName+".xyz"},m]}),this},b.prototype._dumpPropertiesCode=function(){var a=this._codeVariableName+".invertX = "+this.invertX+`;\r
`;return a+=this._codeVariableName+".invertY = "+this.invertY+`;\r
`},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.invertX=this.invertX,a.invertY=this.invertY,a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),this.invertX=a.invertX,this.invertY=a.invertY},b}(ib);D.a.RegisteredTypes["BABYLON.PerturbNormalBlock"]=Ij;var Jj=function(e){function b(a){var c=e.call(this,a,Ia.Fragment,!0)||this;return c.registerInput("value",ha.Float,!0),c.registerInput("cutoff",ha.Float,!0),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"DiscardBlock"},Object.defineProperty(b.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cutoff",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){return e.prototype._buildBlock.call(this,a),a.sharedData.hints.needAlphaTesting=!0,a.compilationString+="if ("+this.value.associatedVariableName+" < "+this.cutoff.associatedVariableName+`) discard;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.DiscardBlock"]=Jj;var Kj=function(e){function b(a){var c=e.call(this,a,Ia.Fragment)||this;return c.registerOutput("output",ha.Float,Ia.Fragment),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"FrontFacingBlock"},Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){if(e.prototype._buildBlock.call(this,a),a.target===Ia.Vertex)throw"FrontFacingBlock must only be used in a fragment shader";var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+` = gl_FrontFacing ? 1.0 : 0.0;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.FrontFacingBlock"]=Kj;var Lj=function(e){function b(a){var c=e.call(this,a,Ia.Fragment)||this;return c.registerInput("input",ha.AutoDetect,!1),c.registerOutput("dx",ha.BasedOnInput),c.registerOutput("dy",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._outputs[1]._typeConnectionSource=c._inputs[0],c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"DerivativeBlock"},Object.defineProperty(b.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dx",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dy",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0],d=this._outputs[1];return a._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),c.hasEndpoints&&(a.compilationString+=this._declareOutput(c,a)+" = dFdx("+this.input.associatedVariableName+`);\r
`),d.hasEndpoints&&(a.compilationString+=this._declareOutput(d,a)+" = dFdy("+this.input.associatedVariableName+`);\r
`),this},b}(ib);D.a.RegisteredTypes["BABYLON.DerivativeBlock"]=Lj;var Mj=function(e){function b(a){var c=e.call(this,a,Ia.VertexAndFragment,!0)||this;return c.registerInput("worldPosition",ha.Vector4,!1,Ia.Vertex),c.registerInput("view",ha.Matrix,!1,Ia.Vertex),c.registerInput("input",ha.Color3,!1,Ia.Fragment),c.registerInput("fogColor",ha.Color3,!1,Ia.Fragment),c.registerOutput("output",ha.Color3,Ia.Fragment),c.input.acceptedConnectionPointTypes.push(ha.Color4),c.fogColor.acceptedConnectionPointTypes.push(ha.Color4),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"FogBlock"},Object.defineProperty(b.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"view",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"input",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fogColor",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype.autoConfigure=function(a){if(!this.view.isConnected){var c=a.getInputBlockByPredicate(function(f){return f.systemValue===nb.View});c||(c=new xb("view")).setAsSystemValue(nb.View),c.output.connectTo(this.view)}if(!this.fogColor.isConnected){var d=a.getInputBlockByPredicate(function(f){return f.systemValue===nb.FogColor});d||(d=new xb("fogColor",void 0,ha.Color3)).setAsSystemValue(nb.FogColor),d.output.connectTo(this.fogColor)}},b.prototype.prepareDefines=function(a,c,d){var f=a.getScene();d.setValue("FOG",c.fogEnabled&&Ua.a.GetFogState(a,f))},b.prototype.bind=function(a,c,d){if(d){var f=d.getScene();a.setFloat4(this._fogParameters,f.fogMode,f.fogStart,f.fogEnd,f.fogDensity)}},b.prototype._buildBlock=function(a){if(e.prototype._buildBlock.call(this,a),a.target===Ia.Fragment){a.sharedData.blocksWithDefines.push(this),a.sharedData.bindableBlocks.push(this),a._emitFunctionFromInclude("fogFragmentDeclaration","//"+this.name,{removeUniforms:!0,removeVaryings:!0,removeIfDef:!1,replaceStrings:[{search:/float CalcFogFactor\(\)/,replace:"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)"}]});var c=a._getFreeVariableName("fog"),d=this.input,f=this.fogColor;this._fogParameters=a._getFreeVariableName("fogParameters");var g=this._outputs[0];a._emitUniformFromString(this._fogParameters,"vec4"),a.compilationString+=`#ifdef FOG\r
`,a.compilationString+="float "+c+" = CalcFogFactor("+this._fogDistanceName+", "+this._fogParameters+`);\r
`,a.compilationString+=this._declareOutput(g,a)+" = "+c+" * "+d.associatedVariableName+".rgb + (1.0 - "+c+") * "+f.associatedVariableName+`.rgb;\r
`,a.compilationString+=`#else\r
`+this._declareOutput(g,a)+" =  "+d.associatedVariableName+`.rgb;\r
`,a.compilationString+=`#endif\r
`}else{var h=this.worldPosition,j=this.view;this._fogDistanceName=a._getFreeVariableName("vFogDistance"),a._emitVaryingFromString(this._fogDistanceName,"vec3"),a.compilationString+=this._fogDistanceName+" = ("+j.associatedVariableName+" * "+h.associatedVariableName+`).xyz;\r
`}return this},b}(ib);D.a.RegisteredTypes["BABYLON.FogBlock"]=Mj;var Nj=function(e){function b(a){var c=e.call(this,a,Ia.VertexAndFragment)||this;return c._isUnique=!0,c.registerInput("worldPosition",ha.Vector4,!1,Ia.Vertex),c.registerInput("worldNormal",ha.Vector4,!1,Ia.Fragment),c.registerInput("cameraPosition",ha.Vector3,!1,Ia.Fragment),c.registerInput("glossiness",ha.Float,!0,Ia.Fragment),c.registerInput("glossPower",ha.Float,!0,Ia.Fragment),c.registerInput("diffuseColor",ha.Color3,!0,Ia.Fragment),c.registerInput("specularColor",ha.Color3,!0,Ia.Fragment),c.registerOutput("diffuseOutput",ha.Color3,Ia.Fragment),c.registerOutput("specularOutput",ha.Color3,Ia.Fragment),c.registerOutput("shadow",ha.Float,Ia.Fragment),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"LightBlock"},Object.defineProperty(b.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraPosition",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"glossiness",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"glossPower",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"diffuseColor",{get:function(){return this._inputs[5]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"specularColor",{get:function(){return this._inputs[6]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"diffuseOutput",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"specularOutput",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"shadow",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),b.prototype.autoConfigure=function(a){if(!this.cameraPosition.isConnected){var c=a.getInputBlockByPredicate(function(d){return d.systemValue===nb.CameraPosition});c||(c=new xb("cameraPosition")).setAsSystemValue(nb.CameraPosition),c.output.connectTo(this.cameraPosition)}},b.prototype.prepareDefines=function(a,c,d){if(d._areLightsDirty){var f=a.getScene();if(this.light){var g={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};Ua.a.PrepareDefinesForLight(f,a,this.light,this._lightId,d,!0,g),g.needRebuild&&d.rebuild()}else Ua.a.PrepareDefinesForLights(f,a,d,!0,c.maxSimultaneousLights)}},b.prototype.updateUniformsAndSamples=function(a,c,d,f){for(var g=0;g<c.maxSimultaneousLights&&d["LIGHT"+g];g++)Ua.a.PrepareUniformsAndSamplersForLight(g,a.uniforms,a.samplers,d["PROJECTEDLIGHTTEXTURE"+g],f)},b.prototype.bind=function(a,c,d){if(d){var f=d.getScene();this.light?Ua.a.BindLight(this.light,this._lightId,f,a,!0):Ua.a.BindLights(f,d,a,!0,c.maxSimultaneousLights)}},b.prototype._injectVertexCode=function(a){var c=this.worldPosition,d="//"+this.name;this.light?(this._lightId=(void 0!==a.counters.lightCounter?a.counters.lightCounter:-1)+1,a.counters.lightCounter=this._lightId,a._emitFunctionFromInclude(a.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",d,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(a._emitFunctionFromInclude(a.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",d,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,a.sharedData.dynamicUniformBlocks.push(this));var f="v_"+c.associatedVariableName;a._emitVaryingFromString(f,"vec4")&&(a.compilationString+=f+" = "+c.associatedVariableName+`;\r
`),this.light?a.compilationString+=a._emitCodeFromInclude("shadowsVertex",d,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:c.associatedVariableName}]}):(a.compilationString+="vec4 worldPos = "+c.associatedVariableName+`;\r
`,a.compilationString+=a._emitCodeFromInclude("shadowsVertex",d,{repeatKey:"maxSimultaneousLights"}))},b.prototype._buildBlock=function(a){if(e.prototype._buildBlock.call(this,a),a.target===Ia.Fragment){a.sharedData.bindableBlocks.push(this),a.sharedData.blocksWithDefines.push(this);var c="//"+this.name,d=this.worldPosition;a._emitFunctionFromInclude("helperFunctions",c),a._emitFunctionFromInclude("lightsFragmentFunctions",c,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+d.associatedVariableName+".xyz"}]}),a._emitFunctionFromInclude("shadowsFragmentFunctions",c,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+d.associatedVariableName+".xyz"}]}),this.light?a._emitFunctionFromInclude(a.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",c,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):a._emitFunctionFromInclude(a.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",c,{repeatKey:"maxSimultaneousLights"}),0===this._lightId&&(a._registerTempVariable("viewDirectionW")&&(a.compilationString+="vec3 viewDirectionW = normalize("+this.cameraPosition.associatedVariableName+" - v_"+d.associatedVariableName+`.xyz);\r
`),a.compilationString+=`lightingInfo info;\r
`,a.compilationString+=`float shadow = 1.;\r
`,a.compilationString+="float glossiness = "+(this.glossiness.isConnected?this.glossiness.associatedVariableName:"1.0")+" * "+(this.glossPower.isConnected?this.glossPower.associatedVariableName:"1024.0")+`;\r
`,a.compilationString+=`vec3 diffuseBase = vec3(0., 0., 0.);\r
`,a.compilationString+=`vec3 specularBase = vec3(0., 0., 0.);\r
`,a.compilationString+="vec3 normalW = "+this.worldNormal.associatedVariableName+`.xyz;\r
`),this.light?a.compilationString+=a._emitCodeFromInclude("lightFragment",c,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):a.compilationString+=a._emitCodeFromInclude("lightFragment",c,{repeatKey:"maxSimultaneousLights"});var f=this.diffuseOutput,g=this.specularOutput;return a.compilationString+=this._declareOutput(f,a)+" = diffuseBase"+(this.diffuseColor.isConnected?" * "+this.diffuseColor.associatedVariableName:"")+`;\r
`,g.hasEndpoints&&(a.compilationString+=this._declareOutput(g,a)+" = specularBase"+(this.specularColor.isConnected?" * "+this.specularColor.associatedVariableName:"")+`;\r
`),this.shadow.hasEndpoints&&(a.compilationString+=this._declareOutput(this.shadow,a)+` = shadow;\r
`),this}this._injectVertexCode(a)},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return this.light&&(a.lightId=this.light.id),a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),a.lightId&&(this.light=c.getLightByID(a.lightId))},b}(ib);D.a.RegisteredTypes["BABYLON.LightBlock"]=Nj;var Oj=function(e){function b(a){var c=e.call(this,a,Ia.VertexAndFragment)||this;return c.convertToGammaSpace=!1,c.registerInput("uv",ha.Vector2,!1,Ia.VertexAndFragment),c.registerOutput("rgba",ha.Color4,Ia.Neutral),c.registerOutput("rgb",ha.Color3,Ia.Neutral),c.registerOutput("r",ha.Float,Ia.Neutral),c.registerOutput("g",ha.Float,Ia.Neutral),c.registerOutput("b",ha.Float,Ia.Neutral),c.registerOutput("a",ha.Float,Ia.Neutral),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector4),c._inputs[0]._prioritizeVertex=!0,c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"TextureBlock"},Object.defineProperty(b.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"target",{get:function(){if(!this.uv.isConnected)return Ia.VertexAndFragment;if(this.uv.sourceBlock.isInput)return Ia.VertexAndFragment;for(var a=this.uv.connectedPoint;a;){if(a.target===Ia.Fragment)return Ia.Fragment;if(a.target===Ia.Vertex)return Ia.VertexAndFragment;if(a.target===Ia.Neutral||a.target===Ia.VertexAndFragment){var c=a.ownerBlock;a=null;for(var d=0,f=c.inputs;d<f.length;d++){var g=f[d];if(g.connectedPoint){a=g.connectedPoint;break}}}}return Ia.VertexAndFragment},enumerable:!0,configurable:!0}),b.prototype.autoConfigure=function(a){if(!this.uv.isConnected){var c=a.getInputBlockByPredicate(function(d){return d.isAttribute&&"uv"===d.name});c||(c=new xb("uv")).setAsAttribute(),c.output.connectTo(this.uv)}},b.prototype.initializeDefines=function(a,c,d,f){void 0===f&&(f=!1),d._areTexturesDirty&&d.setValue(this._mainUVDefineName,!1)},b.prototype.prepareDefines=function(a,c,d){if(d._areTexturesDirty){if(!this.texture||!this.texture.getTextureMatrix)return d.setValue(this._defineName,!1),void d.setValue(this._mainUVDefineName,!0);d.setValue(this._linearDefineName,this.convertToGammaSpace),this._isMixed&&(this.texture.getTextureMatrix().isIdentityAs3x2()?(d.setValue(this._defineName,!1),d.setValue(this._mainUVDefineName,!0)):d.setValue(this._defineName,!0))}},b.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},b.prototype.bind=function(a,c,d){d&&this.texture&&(this._isMixed&&(a.setFloat(this._textureInfoName,this.texture.level),a.setMatrix(this._textureTransformName,this.texture.getTextureMatrix())),a.setTexture(this._samplerName,this.texture))},Object.defineProperty(b.prototype,"_isMixed",{get:function(){return this.target!==Ia.Fragment},enumerable:!0,configurable:!0}),b.prototype._injectVertexCode=function(a){var c=this.uv;(this._defineName=a._getFreeDefineName("UVTRANSFORM"),this._mainUVDefineName="VMAIN"+c.associatedVariableName.toUpperCase(),c.connectedPoint.ownerBlock.isInput)&&(c.connectedPoint.ownerBlock.isAttribute||a._emitUniformFromString(c.associatedVariableName,"vec2"));if(this._mainUVName="vMain"+c.associatedVariableName,this._transformedUVName=a._getFreeVariableName("transformedUV"),this._textureTransformName=a._getFreeVariableName("textureTransform"),this._textureInfoName=a._getFreeVariableName("textureInfoName"),a._emitVaryingFromString(this._transformedUVName,"vec2",this._defineName),a._emitVaryingFromString(this._mainUVName,"vec2",this._mainUVDefineName),a._emitUniformFromString(this._textureTransformName,"mat4",this._defineName),a.compilationString+="#ifdef "+this._defineName+`\r
`,a.compilationString+=this._transformedUVName+" = vec2("+this._textureTransformName+" * vec4("+c.associatedVariableName+`.xy, 1.0, 0.0));\r
`,a.compilationString+="#elif defined("+this._mainUVDefineName+`)\r
`,a.compilationString+=this._mainUVName+" = "+c.associatedVariableName+`.xy;\r
`,a.compilationString+=`#endif\r
`,this._outputs.some(function(h){return h.isConnectedInVertexShader})){this._writeTextureRead(a,!0);for(var d=0,f=this._outputs;d<f.length;d++){var g=f[d];g.hasEndpoints&&this._writeOutput(a,g,g.name,!0)}}},b.prototype._writeTextureRead=function(a,c){void 0===c&&(c=!1);var d=this.uv;if(c){if(a.target===Ia.Fragment)return;a.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+d.associatedVariableName+`);\r
`}else this.uv.ownerBlock.target!==Ia.Fragment?(a.compilationString+="#ifdef "+this._defineName+`\r
`,a.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._transformedUVName+`);\r
`,a.compilationString+="#elif defined("+this._mainUVDefineName+`)\r
`,a.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._mainUVName+`);\r
`,a.compilationString+=`#endif\r
`):a.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+d.associatedVariableName+`);\r
`},b.prototype._writeOutput=function(a,c,d,f){if(void 0===f&&(f=!1),f){if(a.target===Ia.Fragment)return;a.compilationString+=this._declareOutput(c,a)+" = "+this._tempTextureRead+"."+d+`;\r
`}else if(this.uv.ownerBlock.target!==Ia.Fragment){var g=" * "+this._textureInfoName;a.compilationString+=this._declareOutput(c,a)+" = "+this._tempTextureRead+"."+d+g+`;\r
`,a.compilationString+="#ifdef "+this._linearDefineName+`\r
`,a.compilationString+=c.associatedVariableName+" = toGammaSpace("+c.associatedVariableName+`);\r
`,a.compilationString+=`#endif\r
`}else a.compilationString+=this._declareOutput(c,a)+" = "+this._tempTextureRead+"."+d+`;\r
`},b.prototype._buildBlock=function(a){if(e.prototype._buildBlock.call(this,a),a.target===Ia.Vertex&&(this._tempTextureRead=a._getFreeVariableName("tempTextureRead")),(!this._isMixed&&a.target===Ia.Fragment||this._isMixed&&a.target===Ia.Vertex)&&(this._samplerName=a._getFreeVariableName(this.name+"Sampler"),a._emit2DSampler(this._samplerName),a.sharedData.blockingBlocks.push(this),a.sharedData.textureBlocks.push(this),a.sharedData.blocksWithDefines.push(this),a.sharedData.bindableBlocks.push(this)),a.target===Ia.Fragment){if(this._outputs.some(function(h){return h.isConnectedInFragmentShader})){this._isMixed&&a._emit2DSampler(this._samplerName),this._linearDefineName=a._getFreeDefineName("ISLINEAR");var c="//"+this.name;a._emitFunctionFromInclude("helperFunctions",c),this._isMixed&&a._emitUniformFromString(this._textureInfoName,"float"),this._writeTextureRead(a);for(var d=0,f=this._outputs;d<f.length;d++){var g=f[d];g.hasEndpoints&&this._writeOutput(a,g,g.name)}return this}}else this._injectVertexCode(a)},b.prototype._dumpPropertiesCode=function(){if(!this.texture)return"";var a=this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`");\r
`;return a+=this._codeVariableName+".texture.wrapU = "+this.texture.wrapU+`;\r
`,a+=this._codeVariableName+".texture.wrapV = "+this.texture.wrapV+`;\r
`,a+=this._codeVariableName+".texture.uAng = "+this.texture.uAng+`;\r
`,a+=this._codeVariableName+".texture.vAng = "+this.texture.vAng+`;\r
`,a+=this._codeVariableName+".texture.wAng = "+this.texture.wAng+`;\r
`,a+=this._codeVariableName+".texture.uOffset = "+this.texture.uOffset+`;\r
`,a+=this._codeVariableName+".texture.vOffset = "+this.texture.vOffset+`;\r
`,a+=this._codeVariableName+".texture.uScale = "+this.texture.uScale+`;\r
`,a+=this._codeVariableName+".texture.vScale = "+this.texture.vScale+`;\r
`,a+=this._codeVariableName+".convertToGammaSpace = "+this.convertToGammaSpace+`;\r
`},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.convertToGammaSpace=this.convertToGammaSpace,this.texture&&(a.texture=this.texture.serialize()),a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),this.convertToGammaSpace=a.convertToGammaSpace,a.texture&&(d=0===a.texture.url.indexOf("data:")?"":d,this.texture=ya.a.Parse(a.texture,c,d))},b}(ib);D.a.RegisteredTypes["BABYLON.TextureBlock"]=Oj;var Pj=function(e){function b(a){var c=e.call(this,a,Ia.VertexAndFragment)||this;return c.registerInput("position",ha.Vector3,!1,Ia.Vertex),c.registerInput("worldPosition",ha.Vector4,!1,Ia.Vertex),c.registerInput("worldNormal",ha.Vector4,!1,Ia.Fragment),c.registerInput("world",ha.Matrix,!1,Ia.Vertex),c.registerInput("cameraPosition",ha.Vector3,!1,Ia.Fragment),c.registerInput("view",ha.Matrix,!1,Ia.Fragment),c.registerOutput("rgb",ha.Color3,Ia.Fragment),c.registerOutput("r",ha.Float,Ia.Fragment),c.registerOutput("g",ha.Float,Ia.Fragment),c.registerOutput("b",ha.Float,Ia.Fragment),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector4),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ReflectionTextureBlock"},Object.defineProperty(b.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"worldPosition",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"worldNormal",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"world",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraPosition",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"view",{get:function(){return this._inputs[5]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgb",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"r",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"g",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"b",{get:function(){return this._outputs[3]},enumerable:!0,configurable:!0}),b.prototype.autoConfigure=function(a){if(!this.position.isConnected){var c=a.getInputBlockByPredicate(function(h){return h.isAttribute&&"position"===h.name});c||(c=new xb("position")).setAsAttribute(),c.output.connectTo(this.position)}if(!this.world.isConnected){var d=a.getInputBlockByPredicate(function(h){return h.systemValue===nb.World});d||(d=new xb("world")).setAsSystemValue(nb.World),d.output.connectTo(this.world)}if(!this.cameraPosition.isConnected){var f=a.getInputBlockByPredicate(function(h){return h.systemValue===nb.CameraPosition});f||(f=new xb("cameraPosition")).setAsSystemValue(nb.CameraPosition),f.output.connectTo(this.cameraPosition)}if(!this.view.isConnected){var g=a.getInputBlockByPredicate(function(h){return h.systemValue===nb.View});g||(g=new xb("view")).setAsSystemValue(nb.View),g.output.connectTo(this.view)}},b.prototype.prepareDefines=function(a,c,d){d._areTexturesDirty&&this.texture&&this.texture.getTextureMatrix&&(d.setValue(this._define3DName,this.texture.isCube),d.setValue(this._defineLocalCubicName,!!this.texture.boundingBoxSize),d.setValue(this._defineExplicitName,this.texture.coordinatesMode===p.a.TEXTURE_EXPLICIT_MODE),d.setValue(this._defineSkyboxName,this.texture.coordinatesMode===p.a.TEXTURE_SKYBOX_MODE),d.setValue(this._defineCubicName,this.texture.coordinatesMode===p.a.TEXTURE_CUBIC_MODE),d.setValue(this._defineSphericalName,this.texture.coordinatesMode===p.a.TEXTURE_SPHERICAL_MODE),d.setValue(this._definePlanarName,this.texture.coordinatesMode===p.a.TEXTURE_PLANAR_MODE),d.setValue(this._defineProjectionName,this.texture.coordinatesMode===p.a.TEXTURE_PROJECTION_MODE),d.setValue(this._defineEquirectangularName,this.texture.coordinatesMode===p.a.TEXTURE_EQUIRECTANGULAR_MODE),d.setValue(this._defineEquirectangularFixedName,this.texture.coordinatesMode===p.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE),d.setValue(this._defineMirroredEquirectangularFixedName,this.texture.coordinatesMode===p.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE))},b.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},b.prototype.bind=function(a,c,d){d&&this.texture&&(a.setMatrix(this._reflectionMatrixName,this.texture.getReflectionTextureMatrix()),this.texture.isCube?a.setTexture(this._cubeSamplerName,this.texture):a.setTexture(this._2DSamplerName,this.texture))},b.prototype._injectVertexCode=function(a){var c="v_"+this.worldPosition.associatedVariableName;a._emitVaryingFromString(c,"vec4")&&(a.compilationString+=c+" = "+this.worldPosition.associatedVariableName+`;\r
`),this._positionUVWName=a._getFreeVariableName("positionUVW"),this._directionWName=a._getFreeVariableName("directionW"),a._emitVaryingFromString(this._positionUVWName,"vec3",this._defineSkyboxName)&&(a.compilationString+="#ifdef "+this._defineSkyboxName+`\r
`,a.compilationString+=this._positionUVWName+" = "+this.position.associatedVariableName+`.xyz;\r
`,a.compilationString+=`#endif\r
`),a._emitVaryingFromString(this._directionWName,"vec3","defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+")")&&(a.compilationString+="#if defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+`)\r
`,a.compilationString+=this._directionWName+" = normalize(vec3("+this.world.associatedVariableName+" * vec4("+this.position.associatedVariableName+`.xyz, 0.0)));\r
`,a.compilationString+=`#endif\r
`)},b.prototype._writeOutput=function(a,c,d){a.compilationString+=this._declareOutput(c,a)+" = "+this._reflectionColorName+"."+d+`;\r
`},b.prototype._buildBlock=function(a){if(e.prototype._buildBlock.call(this,a),this.texture){if(a.target!==Ia.Fragment)return this._define3DName=a._getFreeDefineName("REFLECTIONMAP_3D"),this._defineCubicName=a._getFreeDefineName("REFLECTIONMAP_CUBIC"),this._defineSphericalName=a._getFreeDefineName("REFLECTIONMAP_SPHERICAL"),this._definePlanarName=a._getFreeDefineName("REFLECTIONMAP_PLANAR"),this._defineProjectionName=a._getFreeDefineName("REFLECTIONMAP_PROJECTION"),this._defineExplicitName=a._getFreeDefineName("REFLECTIONMAP_EXPLICIT"),this._defineEquirectangularName=a._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR"),this._defineLocalCubicName=a._getFreeDefineName("USE_LOCAL_REFLECTIONMAP_CUBIC"),this._defineMirroredEquirectangularFixedName=a._getFreeDefineName("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"),this._defineEquirectangularFixedName=a._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR_FIXED"),this._defineSkyboxName=a._getFreeDefineName("REFLECTIONMAP_SKYBOX"),void this._injectVertexCode(a);a.sharedData.blockingBlocks.push(this),a.sharedData.textureBlocks.push(this),this._cubeSamplerName=a._getFreeVariableName(this.name+"CubeSampler"),a.samplers.push(this._cubeSamplerName),this._2DSamplerName=a._getFreeVariableName(this.name+"2DSampler"),a.samplers.push(this._2DSamplerName),a._samplerDeclaration+="#ifdef "+this._define3DName+`\r
`,a._samplerDeclaration+="uniform samplerCube "+this._cubeSamplerName+`;\r
`,a._samplerDeclaration+=`#else\r
`,a._samplerDeclaration+="uniform sampler2D "+this._2DSamplerName+`;\r
`,a._samplerDeclaration+=`#endif\r
`,a.sharedData.blocksWithDefines.push(this),a.sharedData.bindableBlocks.push(this);var c="//"+this.name;a._emitFunction("ReciprocalPI","#define RECIPROCAL_PI2 0.15915494",""),a._emitFunctionFromInclude("reflectionFunction",c),this._reflectionColorName=a._getFreeVariableName("reflectionColor"),this._reflectionCoordsName=a._getFreeVariableName("reflectionUVW"),this._reflection2DCoordsName=a._getFreeVariableName("reflectionUV"),this._reflectionMatrixName=a._getFreeVariableName("reflectionMatrix"),a._emitUniformFromString(this._reflectionMatrixName,"mat4");var d="v_"+this.worldPosition.associatedVariableName,f=this.worldNormal.associatedVariableName+".xyz",g=this._reflectionMatrixName,h="normalize("+this._directionWName+")",j=""+this._positionUVWName,m=""+this.cameraPosition.associatedVariableName,w=""+this.view.associatedVariableName;a.compilationString+="vec3 "+this._reflectionColorName+`;\r
`,a.compilationString+="#ifdef "+this._defineMirroredEquirectangularFixedName+`\r
`,a.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeMirroredFixedEquirectangularCoords("+d+", "+f+", "+h+`);\r
`,a.compilationString+=`#endif\r
`,a.compilationString+="#ifdef "+this._defineEquirectangularFixedName+`\r
`,a.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeFixedEquirectangularCoords("+d+", "+f+", "+h+`);\r
`,a.compilationString+=`#endif\r
`,a.compilationString+="#ifdef "+this._defineEquirectangularName+`\r
`,a.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeEquirectangularCoords("+d+", "+f+", "+m+".xyz, "+g+`);\r
`,a.compilationString+=` #endif\r
`,a.compilationString+="#ifdef "+this._defineSphericalName+`\r
`,a.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeSphericalCoords("+d+", "+f+", "+w+", "+g+`);\r
`,a.compilationString+=`#endif\r
`,a.compilationString+="#ifdef "+this._definePlanarName+`\r
`,a.compilationString+="    vec3 "+this._reflectionCoordsName+" = computePlanarCoords("+d+", "+f+", "+m+".xyz, "+g+`);\r
`,a.compilationString+=`#endif\r
`,a.compilationString+="#ifdef "+this._defineCubicName+`\r
`,a.compilationString+="    #ifdef "+this._defineLocalCubicName+`\r
`,a.compilationString+="        vec3 "+this._reflectionCoordsName+" = computeCubicLocalCoords("+d+", "+f+", "+m+".xyz, "+g+`, vReflectionSize, vReflectionPosition);\r
`,a.compilationString+=`    #else\r
`,a.compilationString+="       vec3 "+this._reflectionCoordsName+" = computeCubicCoords("+d+", "+f+", "+m+".xyz, "+g+`);\r
`,a.compilationString+=`    #endif\r
`,a.compilationString+=`#endif\r
`,a.compilationString+="#ifdef "+this._defineProjectionName+`\r
`,a.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeProjectionCoords("+d+", "+w+", "+g+`);\r
`,a.compilationString+=`#endif\r
`,a.compilationString+="#ifdef "+this._defineSkyboxName+`\r
`,a.compilationString+="    vec3 "+this._reflectionCoordsName+" = computeSkyBoxCoords("+j+", "+g+`);\r
`,a.compilationString+=`#endif\r
`,a.compilationString+="#ifdef "+this._defineExplicitName+`\r
`,a.compilationString+="    vec3 "+this._reflectionCoordsName+` = vec3(0, 0, 0);\r
`,a.compilationString+=`#endif\r
`,a.compilationString+="#ifdef "+this._define3DName+`\r
`,a.compilationString+=this._reflectionColorName+" = textureCube("+this._cubeSamplerName+", "+this._reflectionCoordsName+`).rgb;\r
`,a.compilationString+=`#else\r
`,a.compilationString+="vec2 "+this._reflection2DCoordsName+" = "+this._reflectionCoordsName+`.xy;\r
`,a.compilationString+="#ifdef "+this._defineProjectionName+`\r
`,a.compilationString+=this._reflection2DCoordsName+" /= "+this._reflectionCoordsName+`.z;\r
`,a.compilationString+=`#endif\r
`,a.compilationString+=this._reflection2DCoordsName+".y = 1.0 - "+this._reflection2DCoordsName+`.y;\r
`,a.compilationString+=this._reflectionColorName+" = texture2D("+this._2DSamplerName+", "+this._reflection2DCoordsName+`).rgb;\r
`,a.compilationString+=`#endif\r
`;for(var z=0,C=this._outputs;z<C.length;z++)(N=C[z]).hasEndpoints&&this._writeOutput(a,N,N.name);return this}if(a.target===Ia.Fragment)for(var J=0,K=this._outputs;J<K.length;J++){var N;(N=K[J]).hasEndpoints&&(a.compilationString+=this._declareOutput(N,a)+" = vec3(0.)."+N.name+`;\r
`)}},b.prototype._dumpPropertiesCode=function(){return this.texture?(a=this.texture.isCube?this._codeVariableName+'.texture = new BABYLON.CubeTexture("'+this.texture.name+`");\r
`:this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`");\r
`,a+=this._codeVariableName+".texture.coordinatesMode = "+this.texture.coordinatesMode+`;\r
`):"";var a},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return this.texture&&(a.texture=this.texture.serialize()),a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),a.texture&&(d=0===a.texture.url.indexOf("data:")?"":d,a.texture.isCube?this.texture=pc.Parse(a.texture,c,d):this.texture=ya.a.Parse(a.texture,c,d))},b}(ib);D.a.RegisteredTypes["BABYLON.ReflectionTextureBlock"]=Pj;var Qj=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._linkConnectionTypes(0,1),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"MultiplyBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = "+this.left.associatedVariableName+" * "+this.right.associatedVariableName+`;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.MultiplyBlock"]=Qj;var Rj=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._linkConnectionTypes(0,1),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"AddBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = "+this.left.associatedVariableName+" + "+this.right.associatedVariableName+`;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.AddBlock"]=Rj;var Sj=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("input",ha.AutoDetect),c.registerInput("factor",ha.Float),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ScaleBlock"},Object.defineProperty(b.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"factor",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = "+this.input.associatedVariableName+" * "+this.factor.associatedVariableName+`;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.ScaleBlock"]=Sj;var Tj=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.minimum=0,c.maximum=1,c.registerInput("value",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ClampBlock"},Object.defineProperty(b.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = clamp("+this.value.associatedVariableName+", "+this._writeFloat(this.minimum)+", "+this._writeFloat(this.maximum)+`);\r
`,this},b.prototype._dumpPropertiesCode=function(){var a=this._codeVariableName+".minimum = "+this.minimum+`;\r
`;return a+=this._codeVariableName+".maximum = "+this.maximum+`;\r
`},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.minimum=this.minimum,a.maximum=this.maximum,a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),this.minimum=a.minimum,this.maximum=a.maximum},b}(ib);D.a.RegisteredTypes["BABYLON.ClampBlock"]=Tj;var Uj=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerOutput("output",ha.Vector3),c._linkConnectionTypes(0,1),c._inputs[0].excludedConnectionPointTypes.push(ha.Float),c._inputs[0].excludedConnectionPointTypes.push(ha.Matrix),c._inputs[0].excludedConnectionPointTypes.push(ha.Vector2),c._inputs[1].excludedConnectionPointTypes.push(ha.Float),c._inputs[1].excludedConnectionPointTypes.push(ha.Matrix),c._inputs[1].excludedConnectionPointTypes.push(ha.Vector2),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"CrossBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = cross("+this.left.associatedVariableName+".xyz, "+this.right.associatedVariableName+`.xyz);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.CrossBlock"]=Uj;var Vj=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerOutput("output",ha.Float),c._linkConnectionTypes(0,1),c._inputs[0].excludedConnectionPointTypes.push(ha.Float),c._inputs[0].excludedConnectionPointTypes.push(ha.Matrix),c._inputs[1].excludedConnectionPointTypes.push(ha.Float),c._inputs[1].excludedConnectionPointTypes.push(ha.Matrix),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"DotBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = dot("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.DotBlock"]=Vj;var Wj=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.sourceRange=new i.d(-1,1),c.targetRange=new i.d(0,1),c.registerInput("input",ha.AutoDetect),c.registerInput("sourceMin",ha.Float,!0),c.registerInput("sourceMax",ha.Float,!0),c.registerInput("targetMin",ha.Float,!0),c.registerInput("targetMax",ha.Float,!0),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"RemapBlock"},Object.defineProperty(b.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sourceMin",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sourceMax",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"targetMin",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"targetMax",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0],d=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),f=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),g=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),h=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return a.compilationString+=this._declareOutput(c,a)+" = "+g+" + ("+this._inputs[0].associatedVariableName+" - "+d+") * ("+h+" - "+g+") / ("+f+" - "+d+`);\r
`,this},b.prototype._dumpPropertiesCode=function(){var a=this._codeVariableName+".sourceRange = new BABYLON.Vector2("+this.sourceRange.x+", "+this.sourceRange.y+`);\r
`;return a+=this._codeVariableName+".targetRange = new BABYLON.Vector2("+this.targetRange.x+", "+this.targetRange.y+`);\r
`},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.sourceRange=this.sourceRange.asArray(),a.targetRange=this.targetRange.asArray(),a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),this.sourceRange=i.d.FromArray(a.sourceRange),this.targetRange=i.d.FromArray(a.targetRange)},b}(ib);D.a.RegisteredTypes["BABYLON.RemapBlock"]=Wj;var Ib,Xj=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("input",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._inputs[0].excludedConnectionPointTypes.push(ha.Float),c._inputs[0].excludedConnectionPointTypes.push(ha.Matrix),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"NormalizeBlock"},Object.defineProperty(b.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0],d=this._inputs[0];return a.compilationString+=this._declareOutput(c,a)+" = normalize("+d.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.NormalizeBlock"]=Xj,function(e){e[e.Cos=0]="Cos",e[e.Sin=1]="Sin",e[e.Abs=2]="Abs",e[e.Exp=3]="Exp",e[e.Exp2=4]="Exp2",e[e.Round=5]="Round",e[e.Floor=6]="Floor",e[e.Ceiling=7]="Ceiling",e[e.Sqrt=8]="Sqrt",e[e.Log=9]="Log",e[e.Tan=10]="Tan",e[e.ArcTan=11]="ArcTan",e[e.ArcCos=12]="ArcCos",e[e.ArcSin=13]="ArcSin",e[e.Fract=14]="Fract",e[e.Sign=15]="Sign",e[e.Radians=16]="Radians",e[e.Degrees=17]="Degrees"}(Ib||(Ib={}));var Yj=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.operation=Ib.Cos,c.registerInput("input",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"TrigonometryBlock"},Object.defineProperty(b.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0],d="";switch(this.operation){case Ib.Cos:d="cos";break;case Ib.Sin:d="sin";break;case Ib.Abs:d="abs";break;case Ib.Exp:d="exp";break;case Ib.Exp2:d="exp2";break;case Ib.Round:d="round";break;case Ib.Floor:d="floor";break;case Ib.Ceiling:d="ceil";break;case Ib.Sqrt:d="sqrt";break;case Ib.Log:d="log";break;case Ib.Tan:d="tan";break;case Ib.ArcTan:d="atan";break;case Ib.ArcCos:d="acos";break;case Ib.ArcSin:d="asin";break;case Ib.Fract:d="fract";break;case Ib.Sign:d="sign";break;case Ib.Radians:d="radians";break;case Ib.Degrees:d="degrees"}return a.compilationString+=this._declareOutput(c,a)+" = "+d+"("+this.input.associatedVariableName+`);\r
`,this},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.operation=this.operation,a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),this.operation=a.operation},b.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".operation = BABYLON.TrigonometryBlockOperations."+Ib[this.operation]+`;\r
`},b}(ib);D.a.RegisteredTypes["BABYLON.TrigonometryBlock"]=Yj;var Zj=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("rgb ",ha.Color3,!0),c.registerInput("r",ha.Float,!0),c.registerInput("g",ha.Float,!0),c.registerInput("b",ha.Float,!0),c.registerInput("a",ha.Float,!0),c.registerOutput("rgba",ha.Color4),c.registerOutput("rgb",ha.Color3),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ColorMergerBlock"},Object.defineProperty(b.prototype,"rgbIn",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"r",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"g",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"b",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"a",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgbOut",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgb",{get:function(){return this.rgbOut},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this.r,d=this.g,f=this.b,g=this.a,h=this.rgbIn,j=this._outputs[0],m=this._outputs[1];return h.isConnected?j.hasEndpoints?a.compilationString+=this._declareOutput(j,a)+" = vec4("+h.associatedVariableName+", "+(g.isConnected?this._writeVariable(g):"0.0")+`);\r
`:m.hasEndpoints&&(a.compilationString+=this._declareOutput(m,a)+" = "+h.associatedVariableName+`;\r
`):j.hasEndpoints?a.compilationString+=this._declareOutput(j,a)+" = vec4("+(c.isConnected?this._writeVariable(c):"0.0")+", "+(d.isConnected?this._writeVariable(d):"0.0")+", "+(f.isConnected?this._writeVariable(f):"0.0")+", "+(g.isConnected?this._writeVariable(g):"0.0")+`);\r
`:m.hasEndpoints&&(a.compilationString+=this._declareOutput(m,a)+" = vec3("+(c.isConnected?this._writeVariable(c):"0.0")+", "+(d.isConnected?this._writeVariable(d):"0.0")+", "+(f.isConnected?this._writeVariable(f):"0.0")+`);\r
`),this},b}(ib);D.a.RegisteredTypes["BABYLON.ColorMergerBlock"]=Zj;var _j=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("xyz ",ha.Vector3,!0),c.registerInput("xy ",ha.Vector2,!0),c.registerInput("x",ha.Float,!0),c.registerInput("y",ha.Float,!0),c.registerInput("z",ha.Float,!0),c.registerInput("w",ha.Float,!0),c.registerOutput("xyzw",ha.Vector4),c.registerOutput("xyz",ha.Vector3),c.registerOutput("xy",ha.Vector2),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"VectorMergerBlock"},Object.defineProperty(b.prototype,"xyzIn",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xyIn",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"z",{get:function(){return this._inputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"w",{get:function(){return this._inputs[5]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xyzw",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xyzOut",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xyOut",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xy",{get:function(){return this.xyOut},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xyz",{get:function(){return this.xyzOut},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this.x,d=this.y,f=this.z,g=this.w,h=this.xyIn,j=this.xyzIn,m=this._outputs[0],w=this._outputs[1],z=this._outputs[2];return h.isConnected?m.hasEndpoints?a.compilationString+=this._declareOutput(m,a)+" = vec4("+h.associatedVariableName+", "+(f.isConnected?this._writeVariable(f):"0.0")+", "+(g.isConnected?this._writeVariable(g):"0.0")+`);\r
`:w.hasEndpoints?a.compilationString+=this._declareOutput(w,a)+" = vec3("+h.associatedVariableName+", "+(f.isConnected?this._writeVariable(f):"0.0")+`);\r
`:z.hasEndpoints&&(a.compilationString+=this._declareOutput(z,a)+" = "+h.associatedVariableName+`;\r
`):j.isConnected?m.hasEndpoints?a.compilationString+=this._declareOutput(m,a)+" = vec4("+j.associatedVariableName+", "+(g.isConnected?this._writeVariable(g):"0.0")+`);\r
`:w.hasEndpoints?a.compilationString+=this._declareOutput(w,a)+" = "+j.associatedVariableName+`;\r
`:z.hasEndpoints&&(a.compilationString+=this._declareOutput(z,a)+" = "+j.associatedVariableName+`.xy;\r
`):m.hasEndpoints?a.compilationString+=this._declareOutput(m,a)+" = vec4("+(c.isConnected?this._writeVariable(c):"0.0")+", "+(d.isConnected?this._writeVariable(d):"0.0")+", "+(f.isConnected?this._writeVariable(f):"0.0")+", "+(g.isConnected?this._writeVariable(g):"0.0")+`);\r
`:w.hasEndpoints?a.compilationString+=this._declareOutput(w,a)+" = vec3("+(c.isConnected?this._writeVariable(c):"0.0")+", "+(d.isConnected?this._writeVariable(d):"0.0")+", "+(f.isConnected?this._writeVariable(f):"0.0")+`);\r
`:z.hasEndpoints&&(a.compilationString+=this._declareOutput(z,a)+" = vec2("+(c.isConnected?this._writeVariable(c):"0.0")+", "+(d.isConnected?this._writeVariable(d):"0.0")+`);\r
`),this},b}(ib);D.a.RegisteredTypes["BABYLON.VectorMergerBlock"]=_j;var $j=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("rgba",ha.Color4,!0),c.registerInput("rgb ",ha.Color3,!0),c.registerOutput("rgb",ha.Color3),c.registerOutput("r",ha.Float),c.registerOutput("g",ha.Float),c.registerOutput("b",ha.Float),c.registerOutput("a",ha.Float),c.inputsAreExclusive=!0,c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ColorSplitterBlock"},Object.defineProperty(b.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgbIn",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgbOut",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"r",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"g",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"b",{get:function(){return this._outputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"a",{get:function(){return this._outputs[4]},enumerable:!0,configurable:!0}),b.prototype._inputRename=function(a){return"rgb "===a?"rgbIn":a},b.prototype._outputRename=function(a){return"rgb"===a?"rgbOut":a},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this.rgba.isConnected?this.rgba:this.rgbIn;if(c.isConnected){var d=this._outputs[0],f=this._outputs[1],g=this._outputs[2],h=this._outputs[3],j=this._outputs[4];return d.hasEndpoints&&(a.compilationString+=this._declareOutput(d,a)+" = "+c.associatedVariableName+`.rgb;\r
`),f.hasEndpoints&&(a.compilationString+=this._declareOutput(f,a)+" = "+c.associatedVariableName+`.r;\r
`),g.hasEndpoints&&(a.compilationString+=this._declareOutput(g,a)+" = "+c.associatedVariableName+`.g;\r
`),h.hasEndpoints&&(a.compilationString+=this._declareOutput(h,a)+" = "+c.associatedVariableName+`.b;\r
`),j.hasEndpoints&&(a.compilationString+=this._declareOutput(j,a)+" = "+c.associatedVariableName+`.a;\r
`),this}},b}(ib);D.a.RegisteredTypes["BABYLON.ColorSplitterBlock"]=$j;var ak=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("xyzw",ha.Vector4,!0),c.registerInput("xyz ",ha.Vector3,!0),c.registerInput("xy ",ha.Vector2,!0),c.registerOutput("xyz",ha.Vector3),c.registerOutput("xy",ha.Vector2),c.registerOutput("x",ha.Float),c.registerOutput("y",ha.Float),c.registerOutput("z",ha.Float),c.registerOutput("w",ha.Float),c.inputsAreExclusive=!0,c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"VectorSplitterBlock"},Object.defineProperty(b.prototype,"xyzw",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xyzIn",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xyIn",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xyzOut",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xyOut",{get:function(){return this._outputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x",{get:function(){return this._outputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._outputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"z",{get:function(){return this._outputs[4]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"w",{get:function(){return this._outputs[5]},enumerable:!0,configurable:!0}),b.prototype._inputRename=function(a){switch(a){case"xy ":return"xyIn";case"xyz ":return"xyzIn";default:return a}},b.prototype._outputRename=function(a){switch(a){case"xy":return"xyOut";case"xyz":return"xyzOut";default:return a}},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this.xyzw.isConnected?this.xyzw:this.xyzIn.isConnected?this.xyzIn:this.xyIn,d=this._outputs[0],f=this._outputs[1],g=this._outputs[2],h=this._outputs[3],j=this._outputs[4],m=this._outputs[5];return d.hasEndpoints&&(c===this.xyIn?a.compilationString+=this._declareOutput(d,a)+" = vec3("+c.associatedVariableName+`, 0.0);\r
`:a.compilationString+=this._declareOutput(d,a)+" = "+c.associatedVariableName+`.xyz;\r
`),f.hasEndpoints&&(a.compilationString+=this._declareOutput(f,a)+" = "+c.associatedVariableName+`.xy;\r
`),g.hasEndpoints&&(a.compilationString+=this._declareOutput(g,a)+" = "+c.associatedVariableName+`.x;\r
`),h.hasEndpoints&&(a.compilationString+=this._declareOutput(h,a)+" = "+c.associatedVariableName+`.y;\r
`),j.hasEndpoints&&(a.compilationString+=this._declareOutput(j,a)+" = "+c.associatedVariableName+`.z;\r
`),m.hasEndpoints&&(a.compilationString+=this._declareOutput(m,a)+" = "+c.associatedVariableName+`.w;\r
`),this},b}(ib);D.a.RegisteredTypes["BABYLON.VectorSplitterBlock"]=ak;var bk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerInput("gradient",ha.Float),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._linkConnectionTypes(0,1),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"LerpBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = mix("+this.left.associatedVariableName+" , "+this.right.associatedVariableName+", "+this.gradient.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.LerpBlock"]=bk;var ck=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._linkConnectionTypes(0,1),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"DivideBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = "+this.left.associatedVariableName+" / "+this.right.associatedVariableName+`;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.DivideBlock"]=ck;var dk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._linkConnectionTypes(0,1),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"SubtractBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = "+this.left.associatedVariableName+" - "+this.right.associatedVariableName+`;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.SubtractBlock"]=dk;var ek=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("value",ha.Float),c.registerInput("edge",ha.Float),c.registerOutput("output",ha.Float),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"StepBlock"},Object.defineProperty(b.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"edge",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = step("+this.edge.associatedVariableName+", "+this.value.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.StepBlock"]=ek;var Xg=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("input",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._outputs[0].excludedConnectionPointTypes.push(ha.Matrix),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"OneMinusBlock"},Object.defineProperty(b.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = 1. - "+this.input.associatedVariableName+`;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.OneMinusBlock"]=Xg,D.a.RegisteredTypes["BABYLON.OppositeBlock"]=Xg;var Yg=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("worldPosition",ha.Vector4),c.registerInput("cameraPosition",ha.Vector3),c.registerOutput("output",ha.Vector3),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ViewDirectionBlock"},Object.defineProperty(b.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"cameraPosition",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype.autoConfigure=function(a){if(!this.cameraPosition.isConnected){var c=a.getInputBlockByPredicate(function(d){return d.systemValue===nb.CameraPosition});c||(c=new xb("cameraPosition")).setAsSystemValue(nb.CameraPosition),c.output.connectTo(this.cameraPosition)}},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = normalize("+this.cameraPosition.associatedVariableName+" - "+this.worldPosition.associatedVariableName+`.xyz);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.ViewDirectionBlock"]=Yg,o(145);var fk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("worldNormal",ha.Vector4),c.registerInput("viewDirection",ha.Vector3),c.registerInput("bias",ha.Float),c.registerInput("power",ha.Float),c.registerOutput("fresnel",ha.Float),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"FresnelBlock"},Object.defineProperty(b.prototype,"worldNormal",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"viewDirection",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bias",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"power",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fresnel",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype.autoConfigure=function(a){if(!this.viewDirection.isConnected){var c=new Yg("View direction");c.output.connectTo(this.viewDirection),c.autoConfigure(a)}if(!this.bias.isConnected){var d=new xb("bias");d.value=0,d.output.connectTo(this.bias)}if(!this.power.isConnected){var f=new xb("power");f.value=1,f.output.connectTo(this.power)}},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c="//"+this.name;return a._emitFunctionFromInclude("fresnelFunction",c,{removeIfDef:!0}),a.compilationString+=this._declareOutput(this.fresnel,a)+" = computeFresnelTerm("+this.viewDirection.associatedVariableName+".xyz, "+this.worldNormal.associatedVariableName+".xyz, "+this.bias.associatedVariableName+", "+this.power.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.FresnelBlock"]=fk;var gk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._linkConnectionTypes(0,1),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"MaxBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = max("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.MaxBlock"]=gk;var hk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._linkConnectionTypes(0,1),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"MinBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = min("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.MinBlock"]=hk;var ik=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerOutput("output",ha.Float),c._linkConnectionTypes(0,1),c._inputs[0].excludedConnectionPointTypes.push(ha.Float),c._inputs[0].excludedConnectionPointTypes.push(ha.Matrix),c._inputs[1].excludedConnectionPointTypes.push(ha.Float),c._inputs[1].excludedConnectionPointTypes.push(ha.Matrix),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"DistanceBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = length("+this.left.associatedVariableName+" - "+this.right.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.DistanceBlock"]=ik;var jk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("value",ha.AutoDetect),c.registerOutput("output",ha.Float),c._inputs[0].excludedConnectionPointTypes.push(ha.Float),c._inputs[0].excludedConnectionPointTypes.push(ha.Matrix),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"LengthBlock"},Object.defineProperty(b.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = length("+this.value.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.LengthBlock"]=jk;var kk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("value",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"NegateBlock"},Object.defineProperty(b.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = -1.0 * "+this.value.associatedVariableName+`;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.NegateBlock"]=kk;var lk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("value",ha.Float),c.registerInput("power",ha.Float),c.registerOutput("output",ha.Float),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"PowBlock"},Object.defineProperty(b.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"power",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = pow("+this.value.associatedVariableName+", "+this.power.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.PowBlock"]=lk;var mk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("seed",ha.Vector2),c.registerOutput("output",ha.Float),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector4),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color4),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"RandomNumberBlock"},Object.defineProperty(b.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0],d="//"+this.name;return a._emitFunctionFromInclude("helperFunctions",d),a.compilationString+=this._declareOutput(c,a)+" = getRand("+this.seed.associatedVariableName+`.xy);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.RandomNumberBlock"]=mk;var nk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("x",ha.Float),c.registerInput("y",ha.Float),c.registerOutput("output",ha.Float),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ArcTan2Block"},Object.defineProperty(b.prototype,"x",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = atan("+this.x.associatedVariableName+", "+this.y.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.ArcTan2Block"]=nk;var ok=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("value",ha.Float),c.registerInput("edge0",ha.Float),c.registerInput("edge1",ha.Float),c.registerOutput("output",ha.Float),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"SmoothStepBlock"},Object.defineProperty(b.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"edge0",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"edge1",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = smoothstep("+this.edge0.associatedVariableName+", "+this.edge1.associatedVariableName+", "+this.value.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.SmoothStepBlock"]=ok;var pk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("input",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._outputs[0].excludedConnectionPointTypes.push(ha.Matrix),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ReciprocalBlock"},Object.defineProperty(b.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = 1. / "+this.input.associatedVariableName+`;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.ReciprocalBlock"]=pk;var qk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("value",ha.AutoDetect),c.registerInput("reference",ha.AutoDetect),c.registerInput("distance",ha.Float),c.registerInput("replacement",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._linkConnectionTypes(0,1),c._linkConnectionTypes(0,3),c._inputs[0].excludedConnectionPointTypes.push(ha.Float),c._inputs[0].excludedConnectionPointTypes.push(ha.Matrix),c._inputs[1].excludedConnectionPointTypes.push(ha.Float),c._inputs[1].excludedConnectionPointTypes.push(ha.Matrix),c._inputs[3].excludedConnectionPointTypes.push(ha.Float),c._inputs[3].excludedConnectionPointTypes.push(ha.Matrix),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ReplaceColorBlock"},Object.defineProperty(b.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"reference",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"distance",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"replacement",{get:function(){return this._inputs[3]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+`;\r
`,a.compilationString+="if (length("+this.value.associatedVariableName+" - "+this.reference.associatedVariableName+") < "+this.distance.associatedVariableName+`) {\r
`,a.compilationString+=c.associatedVariableName+" = "+this.replacement.associatedVariableName+`;\r
`,a.compilationString+=`} else {\r
`,a.compilationString+=c.associatedVariableName+" = "+this.value.associatedVariableName+`;\r
`,a.compilationString+=`}\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.ReplaceColorBlock"]=qk;var td,rk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("value",ha.AutoDetect),c.registerInput("steps",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._linkConnectionTypes(0,1),c._inputs[0].excludedConnectionPointTypes.push(ha.Matrix),c._inputs[1].excludedConnectionPointTypes.push(ha.Matrix),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"PosterizeBlock"},Object.defineProperty(b.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"steps",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = floor("+this.value.associatedVariableName+" / (1.0 / "+this.steps.associatedVariableName+")) * (1.0 / "+this.steps.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.PosterizeBlock"]=rk,function(e){e[e.SawTooth=0]="SawTooth",e[e.Square=1]="Square",e[e.Triangle=2]="Triangle"}(td||(td={}));var sk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.kind=td.SawTooth,c.registerInput("input",ha.AutoDetect),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._inputs[0].excludedConnectionPointTypes.push(ha.Matrix),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"WaveBlock"},Object.defineProperty(b.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];switch(this.kind){case td.SawTooth:a.compilationString+=this._declareOutput(c,a)+" = "+this.input.associatedVariableName+" - floor(0.5 + "+this.input.associatedVariableName+`);\r
`;break;case td.Square:a.compilationString+=this._declareOutput(c,a)+" = 1.0 - 2.0 * round(fract("+this.input.associatedVariableName+`));\r
`;break;case td.Triangle:a.compilationString+=this._declareOutput(c,a)+" = 2.0 * abs(2.0 * ("+this.input.associatedVariableName+" - floor(0.5 + "+this.input.associatedVariableName+`))) - 1.0;\r
`}return this},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.kind=this.kind,a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),this.kind=a.kind},b}(ib);D.a.RegisteredTypes["BABYLON.WaveBlock"]=sk;var zf=function(e,b){this.step=e,this.color=b},tk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.colorSteps=[new zf(0,G.a.Black()),new zf(1,G.a.White())],c.registerInput("gradient",ha.Float),c.registerOutput("output",ha.Color3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector2),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector4),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color4),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"GradientBlock"},Object.defineProperty(b.prototype,"gradient",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._writeColorConstant=function(a){var c=this.colorSteps[a];return"vec3("+c.color.r+", "+c.color.g+", "+c.color.b+")"},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];if(this.colorSteps.length&&this.gradient.connectedPoint){var d=a._getFreeVariableName("gradientTempColor"),f=a._getFreeVariableName("gradientTempPosition");a.compilationString+="vec3 "+d+" = "+this._writeColorConstant(0)+`;\r
`,a.compilationString+="float "+f+`;\r
`;var g=this.gradient.associatedVariableName;this.gradient.connectedPoint.type!==ha.Float&&(g+=".x");for(var h=1;h<this.colorSteps.length;h++){var j=this.colorSteps[h],m=this.colorSteps[h-1];a.compilationString+=f+" = clamp(("+g+" - "+a._emitFloat(m.step)+") / ("+a._emitFloat(j.step)+" -  "+a._emitFloat(m.step)+"), 0.0, 1.0) * step("+a._emitFloat(h)+", "+a._emitFloat(this.colorSteps.length-1)+`);\r
`,a.compilationString+=d+" = mix("+d+", "+this._writeColorConstant(h)+", "+f+`);\r
`}return a.compilationString+=this._declareOutput(c,a)+" = "+d+`;\r
`,this}a.compilationString+=this._declareOutput(c,a)+` = vec3(0., 0., 0.);\r
`},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.colorSteps=this.colorSteps,a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),this.colorSteps=[];for(var f=0,g=a.colorSteps;f<g.length;f++){var h=g[f];this.colorSteps.push(new zf(h.step,new G.a(h.color.r,h.color.g,h.color.b)))}},b.prototype._dumpPropertiesCode=function(){for(var a="",c=0,d=this.colorSteps;c<d.length;c++){var f=d[c];a+=this._codeVariableName+".colorSteps.push(new BABYLON.GradientBlockColorStep("+f.step+", new BABYLON.Color3("+f.color.r+", "+f.color.g+", "+f.color.b+`)));\r
`}return a},b}(ib);D.a.RegisteredTypes["BABYLON.GradientBlock"]=tk;var uk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("left",ha.AutoDetect),c.registerInput("right",ha.AutoDetect),c.registerInput("gradient",ha.Float),c.registerOutput("output",ha.BasedOnInput),c._outputs[0]._typeConnectionSource=c._inputs[0],c._linkConnectionTypes(0,1),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"NLerpBlock"},Object.defineProperty(b.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = normalize(mix("+this.left.associatedVariableName+" , "+this.right.associatedVariableName+", "+this.gradient.associatedVariableName+`));\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.NLerpBlock"]=uk;var vk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.manhattanDistance=!1,c.registerInput("seed",ha.Vector3),c.registerInput("jitter",ha.Float),c.registerOutput("output",ha.Vector2),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"WorleyNoise3DBlock"},Object.defineProperty(b.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"jitter",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){if(e.prototype._buildBlock.call(this,a),this.seed.isConnected&&this._outputs[0].hasEndpoints)return`    return mod((34.0 * x + 1.0) * x, 289.0);\r
`,`}\r
\r
`,`vec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\r
`,`    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\r
`,`}\r
\r
`,`vec2 worley(vec3 P, float jitter, bool manhattanDistance){\r
`,`    float K = 0.142857142857; // 1/7\r
`,`    float Ko = 0.428571428571; // 1/2-K/2\r
`,`    float  K2 = 0.020408163265306; // 1/(7*7)\r
`,`    float Kz = 0.166666666667; // 1/6\r
`,`    float Kzo = 0.416666666667; // 1/2-1/6*2\r
`,`\r
`,`    vec3 Pi = mod(floor(P), 289.0);\r
`,`    vec3 Pf = fract(P) - 0.5;\r
`,`\r
`,`    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\r
`,`    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\r
`,`    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\r
`,`\r
`,`    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\r
`,`    vec3 p1 = permute(p + Pi.y - 1.0);\r
`,`    vec3 p2 = permute(p + Pi.y);\r
`,`    vec3 p3 = permute(p + Pi.y + 1.0);\r
`,`\r
`,`    vec3 p11 = permute(p1 + Pi.z - 1.0);\r
`,`    vec3 p12 = permute(p1 + Pi.z);\r
`,`    vec3 p13 = permute(p1 + Pi.z + 1.0);\r
`,`\r
`,`    vec3 p21 = permute(p2 + Pi.z - 1.0);\r
`,`    vec3 p22 = permute(p2 + Pi.z);\r
`,`    vec3 p23 = permute(p2 + Pi.z + 1.0);\r
`,`\r
`,`    vec3 p31 = permute(p3 + Pi.z - 1.0);\r
`,`    vec3 p32 = permute(p3 + Pi.z);\r
`,`    vec3 p33 = permute(p3 + Pi.z + 1.0);\r
`,`\r
`,`    vec3 ox11 = fract(p11*K) - Ko;\r
`,`    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\r
`,`    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\r
`,`\r
`,`    vec3 ox12 = fract(p12*K) - Ko;\r
`,`    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\r
`,`    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\r
`,`\r
`,`    vec3 ox13 = fract(p13*K) - Ko;\r
`,`    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\r
`,`    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\r
`,`\r
`,`    vec3 ox21 = fract(p21*K) - Ko;\r
`,`    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\r
`,`    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\r
`,`\r
`,`    vec3 ox22 = fract(p22*K) - Ko;\r
`,`    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\r
`,`    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\r
`,`\r
`,`    vec3 ox23 = fract(p23*K) - Ko;\r
`,`    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\r
`,`    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\r
`,`\r
`,`    vec3 ox31 = fract(p31*K) - Ko;\r
`,`    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\r
`,`    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\r
`,`\r
`,`    vec3 ox32 = fract(p32*K) - Ko;\r
`,`    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\r
`,`    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\r
`,`\r
`,`    vec3 ox33 = fract(p33*K) - Ko;\r
`,`    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\r
`,`    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\r
`,`\r
`,`    vec3 dx11 = Pfx + jitter*ox11;\r
`,`    vec3 dy11 = Pfy.x + jitter*oy11;\r
`,`    vec3 dz11 = Pfz.x + jitter*oz11;\r
`,`\r
`,`    vec3 dx12 = Pfx + jitter*ox12;\r
`,`    vec3 dy12 = Pfy.x + jitter*oy12;\r
`,`    vec3 dz12 = Pfz.y + jitter*oz12;\r
`,`\r
`,`    vec3 dx13 = Pfx + jitter*ox13;\r
`,`    vec3 dy13 = Pfy.x + jitter*oy13;\r
`,`    vec3 dz13 = Pfz.z + jitter*oz13;\r
`,`\r
`,`    vec3 dx21 = Pfx + jitter*ox21;\r
`,`    vec3 dy21 = Pfy.y + jitter*oy21;\r
`,`    vec3 dz21 = Pfz.x + jitter*oz21;\r
`,`\r
`,`    vec3 dx22 = Pfx + jitter*ox22;\r
`,`    vec3 dy22 = Pfy.y + jitter*oy22;\r
`,`    vec3 dz22 = Pfz.y + jitter*oz22;\r
`,`\r
`,`    vec3 dx23 = Pfx + jitter*ox23;\r
`,`    vec3 dy23 = Pfy.y + jitter*oy23;\r
`,`    vec3 dz23 = Pfz.z + jitter*oz23;\r
`,`\r
`,`    vec3 dx31 = Pfx + jitter*ox31;\r
`,`    vec3 dy31 = Pfy.z + jitter*oy31;\r
`,`    vec3 dz31 = Pfz.x + jitter*oz31;\r
`,`\r
`,`    vec3 dx32 = Pfx + jitter*ox32;\r
`,`    vec3 dy32 = Pfy.z + jitter*oy32;\r
`,`    vec3 dz32 = Pfz.y + jitter*oz32;\r
`,`\r
`,`    vec3 dx33 = Pfx + jitter*ox33;\r
`,`    vec3 dy33 = Pfy.z + jitter*oy33;\r
`,`    vec3 dz33 = Pfz.z + jitter*oz33;\r
`,`\r
`,`    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\r
`,`    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\r
`,`    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\r
`,`    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\r
`,`    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\r
`,`    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\r
`,`    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\r
`,`    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\r
`,`    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\r
`,`\r
`,`    vec3 d1a = min(d11, d12);\r
`,`    d12 = max(d11, d12);\r
`,`    d11 = min(d1a, d13); // Smallest now not in d12 or d13\r
`,`    d13 = max(d1a, d13);\r
`,`    d12 = min(d12, d13); // 2nd smallest now not in d13\r
`,`    vec3 d2a = min(d21, d22);\r
`,`    d22 = max(d21, d22);\r
`,`    d21 = min(d2a, d23); // Smallest now not in d22 or d23\r
`,`    d23 = max(d2a, d23);\r
`,`    d22 = min(d22, d23); // 2nd smallest now not in d23\r
`,`    vec3 d3a = min(d31, d32);\r
`,`    d32 = max(d31, d32);\r
`,`    d31 = min(d3a, d33); // Smallest now not in d32 or d33\r
`,`    d33 = max(d3a, d33);\r
`,`    d32 = min(d32, d33); // 2nd smallest now not in d33\r
`,`    vec3 da = min(d11, d21);\r
`,`    d21 = max(d11, d21);\r
`,`    d11 = min(da, d31); // Smallest now in d11\r
`,`    d31 = max(da, d31); // 2nd smallest now not in d31\r
`,`    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\r
`,`    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\r
`,`    d12 = min(d12, d21); // 2nd smallest now not in d21\r
`,`    d12 = min(d12, d22); // nor in d22\r
`,`    d12 = min(d12, d31); // nor in d31\r
`,`    d12 = min(d12, d32); // nor in d32\r
`,`    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\r
`,`    d11.y = min(d11.y,d12.z); // Only two more to go\r
`,`    d11.y = min(d11.y,d11.z); // Done! (Phew!)\r
`,`    return sqrt(d11.xy); // F1, F2\r
`,`}\r
\r
`,a._emitFunction("worley3D",`vec3 permute(vec3 x){\r
    return mod((34.0 * x + 1.0) * x, 289.0);\r
}\r
\r
vec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\r
    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\r
}\r
\r
vec2 worley(vec3 P, float jitter, bool manhattanDistance){\r
    float K = 0.142857142857; // 1/7\r
    float Ko = 0.428571428571; // 1/2-K/2\r
    float  K2 = 0.020408163265306; // 1/(7*7)\r
    float Kz = 0.166666666667; // 1/6\r
    float Kzo = 0.416666666667; // 1/2-1/6*2\r
\r
    vec3 Pi = mod(floor(P), 289.0);\r
    vec3 Pf = fract(P) - 0.5;\r
\r
    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\r
    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\r
    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\r
\r
    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\r
    vec3 p1 = permute(p + Pi.y - 1.0);\r
    vec3 p2 = permute(p + Pi.y);\r
    vec3 p3 = permute(p + Pi.y + 1.0);\r
\r
    vec3 p11 = permute(p1 + Pi.z - 1.0);\r
    vec3 p12 = permute(p1 + Pi.z);\r
    vec3 p13 = permute(p1 + Pi.z + 1.0);\r
\r
    vec3 p21 = permute(p2 + Pi.z - 1.0);\r
    vec3 p22 = permute(p2 + Pi.z);\r
    vec3 p23 = permute(p2 + Pi.z + 1.0);\r
\r
    vec3 p31 = permute(p3 + Pi.z - 1.0);\r
    vec3 p32 = permute(p3 + Pi.z);\r
    vec3 p33 = permute(p3 + Pi.z + 1.0);\r
\r
    vec3 ox11 = fract(p11*K) - Ko;\r
    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\r
    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\r
\r
    vec3 ox12 = fract(p12*K) - Ko;\r
    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\r
    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\r
\r
    vec3 ox13 = fract(p13*K) - Ko;\r
    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\r
    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\r
\r
    vec3 ox21 = fract(p21*K) - Ko;\r
    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\r
    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\r
\r
    vec3 ox22 = fract(p22*K) - Ko;\r
    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\r
    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\r
\r
    vec3 ox23 = fract(p23*K) - Ko;\r
    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\r
    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\r
\r
    vec3 ox31 = fract(p31*K) - Ko;\r
    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\r
    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\r
\r
    vec3 ox32 = fract(p32*K) - Ko;\r
    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\r
    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\r
\r
    vec3 ox33 = fract(p33*K) - Ko;\r
    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\r
    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\r
\r
    vec3 dx11 = Pfx + jitter*ox11;\r
    vec3 dy11 = Pfy.x + jitter*oy11;\r
    vec3 dz11 = Pfz.x + jitter*oz11;\r
\r
    vec3 dx12 = Pfx + jitter*ox12;\r
    vec3 dy12 = Pfy.x + jitter*oy12;\r
    vec3 dz12 = Pfz.y + jitter*oz12;\r
\r
    vec3 dx13 = Pfx + jitter*ox13;\r
    vec3 dy13 = Pfy.x + jitter*oy13;\r
    vec3 dz13 = Pfz.z + jitter*oz13;\r
\r
    vec3 dx21 = Pfx + jitter*ox21;\r
    vec3 dy21 = Pfy.y + jitter*oy21;\r
    vec3 dz21 = Pfz.x + jitter*oz21;\r
\r
    vec3 dx22 = Pfx + jitter*ox22;\r
    vec3 dy22 = Pfy.y + jitter*oy22;\r
    vec3 dz22 = Pfz.y + jitter*oz22;\r
\r
    vec3 dx23 = Pfx + jitter*ox23;\r
    vec3 dy23 = Pfy.y + jitter*oy23;\r
    vec3 dz23 = Pfz.z + jitter*oz23;\r
\r
    vec3 dx31 = Pfx + jitter*ox31;\r
    vec3 dy31 = Pfy.z + jitter*oy31;\r
    vec3 dz31 = Pfz.x + jitter*oz31;\r
\r
    vec3 dx32 = Pfx + jitter*ox32;\r
    vec3 dy32 = Pfy.z + jitter*oy32;\r
    vec3 dz32 = Pfz.y + jitter*oz32;\r
\r
    vec3 dx33 = Pfx + jitter*ox33;\r
    vec3 dy33 = Pfy.z + jitter*oy33;\r
    vec3 dz33 = Pfz.z + jitter*oz33;\r
\r
    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\r
    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\r
    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\r
    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\r
    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\r
    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\r
    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\r
    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\r
    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\r
\r
    vec3 d1a = min(d11, d12);\r
    d12 = max(d11, d12);\r
    d11 = min(d1a, d13); // Smallest now not in d12 or d13\r
    d13 = max(d1a, d13);\r
    d12 = min(d12, d13); // 2nd smallest now not in d13\r
    vec3 d2a = min(d21, d22);\r
    d22 = max(d21, d22);\r
    d21 = min(d2a, d23); // Smallest now not in d22 or d23\r
    d23 = max(d2a, d23);\r
    d22 = min(d22, d23); // 2nd smallest now not in d23\r
    vec3 d3a = min(d31, d32);\r
    d32 = max(d31, d32);\r
    d31 = min(d3a, d33); // Smallest now not in d32 or d33\r
    d33 = max(d3a, d33);\r
    d32 = min(d32, d33); // 2nd smallest now not in d33\r
    vec3 da = min(d11, d21);\r
    d21 = max(d11, d21);\r
    d11 = min(da, d31); // Smallest now in d11\r
    d31 = max(da, d31); // 2nd smallest now not in d31\r
    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\r
    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\r
    d12 = min(d12, d21); // 2nd smallest now not in d21\r
    d12 = min(d12, d22); // nor in d22\r
    d12 = min(d12, d31); // nor in d31\r
    d12 = min(d12, d32); // nor in d32\r
    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\r
    d11.y = min(d11.y,d12.z); // Only two more to go\r
    d11.y = min(d11.y,d11.z); // Done! (Phew!)\r
    return sqrt(d11.xy); // F1, F2\r
}\r
\r
`,"// Worley3D"),a.compilationString+=this._declareOutput(this._outputs[0],a)+" = worley("+this.seed.associatedVariableName+", "+this.jitter.associatedVariableName+", "+this.manhattanDistance+`);\r
`,this},b.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".manhattanDistance = "+this.manhattanDistance+`;\r
`},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.manhattanDistance=this.manhattanDistance,a},b.prototype._deserialize=function(a,c,d){e.prototype._deserialize.call(this,a,c,d),this.manhattanDistance=a.manhattanDistance},b}(ib);D.a.RegisteredTypes["BABYLON.WorleyNoise3DBlock"]=vk;var wk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("seed",ha.Vector3),c.registerOutput("output",ha.Float),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"SimplexPerlin3DBlock"},Object.defineProperty(b.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){if(e.prototype._buildBlock.call(this,a),this.seed.isConnected&&this._outputs[0].hasEndpoints)return`const float UNSKEWFACTOR = 1.0/6.0;\r
`,`const float SIMPLEX_CORNER_POS = 0.5;\r
`,`const float SIMPLEX_TETRAHADRON_HEIGHT = 0.70710678118654752440084436210485;\r
`,`float SimplexPerlin3D( vec3 P ){\r
`,`    P *= SIMPLEX_TETRAHADRON_HEIGHT;\r
`,"    vec3 Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );",`    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\r
`,`    vec3 g = step(x0.yzx, x0.xyz);\r
`,`    vec3 l = 1.0 - g;\r
`,`    vec3 Pi_1 = min( g.xyz, l.zxy );\r
`,`    vec3 Pi_2 = max( g.xyz, l.zxy );\r
`,`    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\r
`,`    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\r
`,`    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\r
`,`    vec4 v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\r
`,`    vec4 v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\r
`,`    vec4 v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\r
`,`    Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\r
`,`    vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\r
`,`    vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\r
`,`    Pt *= Pt;\r
`,`    vec4 V1xy_V2xy = mix( Pt.xyxy, Pt.zwzw, vec4( Pi_1.xy, Pi_2.xy ) );\r
`,`    Pt = vec4( Pt.x, V1xy_V2xy.xz, Pt.z ) * vec4( Pt.y, V1xy_V2xy.yw, Pt.w );\r
`,`    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\r
`,`    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\r
`,`    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi.zzz * ZINC.xyz ) );\r
`,`    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi_inc1.zzz * ZINC.xyz ) );\r
`,`    Pi_1 = ( Pi_1.z < 0.5 ) ? lowz_mods : highz_mods;\r
`,`    Pi_2 = ( Pi_2.z < 0.5 ) ? lowz_mods : highz_mods;\r
`,`    vec4 hash_0 = fract( Pt * vec4( lowz_mods.x, Pi_1.x, Pi_2.x, highz_mods.x ) ) - 0.49999;\r
`,`    vec4 hash_1 = fract( Pt * vec4( lowz_mods.y, Pi_1.y, Pi_2.y, highz_mods.y ) ) - 0.49999;\r
`,`    vec4 hash_2 = fract( Pt * vec4( lowz_mods.z, Pi_1.z, Pi_2.z, highz_mods.z ) ) - 0.49999;\r
`,`    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\r
`,`    const float FINAL_NORMALIZATION = 37.837227241611314102871574478976;\r
`,`    vec4 kernel_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\r
`,`    kernel_weights = max(0.5 - kernel_weights, 0.0);\r
`,`    kernel_weights = kernel_weights*kernel_weights*kernel_weights;\r
`,`    return dot( kernel_weights, grad_results ) * FINAL_NORMALIZATION;\r
`,`}\r
`,a._emitFunction("SimplexPerlin3D",`const float SKEWFACTOR = 1.0/3.0;\r
const float UNSKEWFACTOR = 1.0/6.0;\r
const float SIMPLEX_CORNER_POS = 0.5;\r
const float SIMPLEX_TETRAHADRON_HEIGHT = 0.70710678118654752440084436210485;\r
float SimplexPerlin3D( vec3 P ){\r
    P *= SIMPLEX_TETRAHADRON_HEIGHT;\r
    vec3 Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\r
    vec3 g = step(x0.yzx, x0.xyz);\r
    vec3 l = 1.0 - g;\r
    vec3 Pi_1 = min( g.xyz, l.zxy );\r
    vec3 Pi_2 = max( g.xyz, l.zxy );\r
    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\r
    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\r
    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\r
    vec4 v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\r
    vec4 v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\r
    vec4 v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\r
    Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\r
    vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\r
    vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\r
    Pt *= Pt;\r
    vec4 V1xy_V2xy = mix( Pt.xyxy, Pt.zwzw, vec4( Pi_1.xy, Pi_2.xy ) );\r
    Pt = vec4( Pt.x, V1xy_V2xy.xz, Pt.z ) * vec4( Pt.y, V1xy_V2xy.yw, Pt.w );\r
    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\r
    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\r
    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi.zzz * ZINC.xyz ) );\r
    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi_inc1.zzz * ZINC.xyz ) );\r
    Pi_1 = ( Pi_1.z < 0.5 ) ? lowz_mods : highz_mods;\r
    Pi_2 = ( Pi_2.z < 0.5 ) ? lowz_mods : highz_mods;\r
    vec4 hash_0 = fract( Pt * vec4( lowz_mods.x, Pi_1.x, Pi_2.x, highz_mods.x ) ) - 0.49999;\r
    vec4 hash_1 = fract( Pt * vec4( lowz_mods.y, Pi_1.y, Pi_2.y, highz_mods.y ) ) - 0.49999;\r
    vec4 hash_2 = fract( Pt * vec4( lowz_mods.z, Pi_1.z, Pi_2.z, highz_mods.z ) ) - 0.49999;\r
    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\r
    const float FINAL_NORMALIZATION = 37.837227241611314102871574478976;\r
    vec4 kernel_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\r
    kernel_weights = max(0.5 - kernel_weights, 0.0);\r
    kernel_weights = kernel_weights*kernel_weights*kernel_weights;\r
    return dot( kernel_weights, grad_results ) * FINAL_NORMALIZATION;\r
}\r
`,"// SimplexPerlin3D"),a.compilationString+=this._declareOutput(this._outputs[0],a)+" = SimplexPerlin3D("+this.seed.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.SimplexPerlin3DBlock"]=wk;var xk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("normalMap0",ha.Vector3),c.registerInput("normalMap1",ha.Vector3),c.registerOutput("output",ha.Vector3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color4),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector4),c._inputs[1].acceptedConnectionPointTypes.push(ha.Color3),c._inputs[1].acceptedConnectionPointTypes.push(ha.Color4),c._inputs[1].acceptedConnectionPointTypes.push(ha.Vector4),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"NormalBlendBlock"},Object.defineProperty(b.prototype,"normalMap0",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"normalMap1",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0],d=this._inputs[0],f=this._inputs[1],g=a._getFreeVariableName("stepR"),h=a._getFreeVariableName("stepG");return a.compilationString+="float "+g+" = step(0.5, "+d.associatedVariableName+`.r);\r
`,a.compilationString+="float "+h+" = step(0.5, "+d.associatedVariableName+`.g);\r
`,a.compilationString+=this._declareOutput(c,a)+`;\r
`,a.compilationString+=c.associatedVariableName+".r = (1.0 - "+g+") * "+d.associatedVariableName+".r * "+f.associatedVariableName+".r * 2.0 + "+g+" * (1.0 - "+d.associatedVariableName+".r) * (1.0 - "+f.associatedVariableName+`.r) * 2.0;\r
`,a.compilationString+=c.associatedVariableName+".g = (1.0 - "+h+") * "+d.associatedVariableName+".g * "+f.associatedVariableName+".g * 2.0 + "+h+" * (1.0 - "+d.associatedVariableName+".g) * (1.0 - "+f.associatedVariableName+`.g) * 2.0;\r
`,a.compilationString+=c.associatedVariableName+".b = "+d.associatedVariableName+".b * "+f.associatedVariableName+`.b;\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.NormalBlendBlock"]=xk;var yk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("input",ha.Vector2),c.registerInput("angle",ha.Float),c.registerOutput("output",ha.Vector2),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"Rotate2dBlock"},Object.defineProperty(b.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"angle",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype.autoConfigure=function(a){if(!this.angle.isConnected){var c=new xb("angle");c.value=0,c.output.connectTo(this.angle)}},b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0],d=this.angle,f=this.input;return a.compilationString+=this._declareOutput(c,a)+" = vec2(cos("+d.associatedVariableName+") * "+f.associatedVariableName+".x - sin("+d.associatedVariableName+") * "+f.associatedVariableName+".y, sin("+d.associatedVariableName+") * "+f.associatedVariableName+".x + cos("+d.associatedVariableName+") * "+f.associatedVariableName+`.y);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.Rotate2dBlock"]=yk;var zk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("incident",ha.Vector3),c.registerInput("normal",ha.Vector3),c.registerOutput("output",ha.Vector3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector4),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color4),c._inputs[1].acceptedConnectionPointTypes.push(ha.Vector4),c._inputs[1].acceptedConnectionPointTypes.push(ha.Color3),c._inputs[1].acceptedConnectionPointTypes.push(ha.Color4),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"ReflectBlock"},Object.defineProperty(b.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = reflect("+this.incident.associatedVariableName+".xyz, "+this.normal.associatedVariableName+`.xyz);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.ReflectBlock"]=zk;var Ak=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("incident",ha.Vector3),c.registerInput("normal",ha.Vector3),c.registerInput("ior",ha.Float),c.registerOutput("output",ha.Vector3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Vector4),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color3),c._inputs[0].acceptedConnectionPointTypes.push(ha.Color4),c._inputs[1].acceptedConnectionPointTypes.push(ha.Vector4),c._inputs[1].acceptedConnectionPointTypes.push(ha.Color3),c._inputs[1].acceptedConnectionPointTypes.push(ha.Color4),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"RefractBlock"},Object.defineProperty(b.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ior",{get:function(){return this._inputs[2]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0];return a.compilationString+=this._declareOutput(c,a)+" = refract("+this.incident.associatedVariableName+".xyz, "+this.normal.associatedVariableName+".xyz, "+this.ior.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.RefractBlock"]=Ak;var Bk=function(e){function b(a){var c=e.call(this,a,Ia.Neutral)||this;return c.registerInput("color",ha.Color3),c.registerInput("level",ha.Float),c.registerOutput("output",ha.Color3),c}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"DesaturateBlock"},Object.defineProperty(b.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"level",{get:function(){return this._inputs[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!0,configurable:!0}),b.prototype._buildBlock=function(a){e.prototype._buildBlock.call(this,a);var c=this._outputs[0],d=this.color.associatedVariableName,f=a._getFreeVariableName("colorMin"),g=a._getFreeVariableName("colorMax"),h=a._getFreeVariableName("colorMerge");return a.compilationString+="float "+f+" = min(min("+d+".x, "+d+".y), "+d+`.z);\r
`,a.compilationString+="float "+g+" = max(max("+d+".x, "+d+".y), "+d+`.z);\r
`,a.compilationString+="float "+h+" = 0.5 * ("+f+" + "+g+`);\r
`,a.compilationString+=this._declareOutput(c,a)+" = mix("+d+", vec3("+h+", "+h+", "+h+"), "+this.level.associatedVariableName+`);\r
`,this},b}(ib);D.a.RegisteredTypes["BABYLON.DesaturateBlock"]=Bk;var Kn=function(){function e(){}return e.prototype.optimize=function(b,a){},e}(),Ln=function(){function e(b,a){var c;void 0===a&&(a=e._DefaultOptions),this.engine=b,this._ringBufferIndex=0,this._ringScreenBuffer=null,this._fullscreenViewport=new Jc.a(0,0,1,1),a=Object(l.a)(Object(l.a)({},e._DefaultOptions),a),this._vertexBuffers=((c={})[ra.b.PositionKind]=new ra.b(b,a.positions,ra.b.PositionKind,!1,!1,2),c),this._indexBuffer=b.createIndexBuffer(a.indices),b.depthCullingState.depthTest=!1,b.stencilState.stencilTest=!1}return e.prototype._getNextFrameBuffer=function(b){if(void 0===b&&(b=!0),!this._ringScreenBuffer){this._ringScreenBuffer=[];for(var a=0;a<2;a++){var c=this.engine.createRenderTargetTexture({width:this.engine.getRenderWidth(!0),height:this.engine.getRenderHeight(!0)},{generateDepthBuffer:!1,generateStencilBuffer:!1,generateMipMaps:!1,samplingMode:p.a.TEXTURE_NEAREST_NEAREST}),d=new ya.a("",null);d._texture=c,this._ringScreenBuffer.push(d)}}var f=this._ringScreenBuffer[this._ringBufferIndex];return b&&(this._ringBufferIndex=(this._ringBufferIndex+1)%2),f},e.prototype.setViewport=function(b){void 0===b&&(b=this._fullscreenViewport),this.engine.setViewport(b)},e.prototype.bindBuffers=function(b){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,b)},e.prototype.applyEffectWrapper=function(b){this.engine.enableEffect(b.effect),this.bindBuffers(b.effect),b.onApplyObservable.notifyObservers({})},e.prototype.draw=function(){this.engine.drawElementsType(p.a.MATERIAL_TriangleFillMode,0,6)},e.prototype.render=function(b,a){var c=this;void 0===a&&(a=null),Array.isArray(b)||(b=[b]);for(var d=0,f=b;d<f.length;d++)if(!f[d].effect.isReady())return;b.forEach(function(g,h){var j=a;0!==h&&g.effect.onBindObservable.addOnce(function(){g.effect.setTexture("textureSampler",c._getNextFrameBuffer(!1))}),j=b.length>1&&h!=b.length-1?c._getNextFrameBuffer():a,c.setViewport(),c.applyEffectWrapper(g),j&&c.engine.bindFramebuffer(j.getInternalTexture()),c.draw(),j&&c.engine.unBindFramebuffer(j.getInternalTexture())})},e.prototype.dispose=function(){this._ringScreenBuffer&&(this._ringScreenBuffer.forEach(function(a){a.dispose()}),this._ringScreenBuffer=null);var b=this._vertexBuffers[ra.b.PositionKind];b&&(b.dispose(),delete this._vertexBuffers[ra.b.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer)},e._DefaultOptions={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]},e}(),Mn=function(){function e(b){var a,c=this;this.onApplyObservable=new I.c();var d=b.uniformNames||[];b.vertexShader?a={fragmentSource:b.fragmentShader,vertexSource:b.vertexShader,spectorName:b.name||"effectWrapper"}:(d.push("scale"),a={fragmentSource:b.fragmentShader,vertex:"postprocess",spectorName:b.name||"effectWrapper"},this.onApplyObservable.add(function(){c.effect.setFloat2("scale",1,1)})),this.effect=new Pa.a(a,b.attributeNames||["position"],d,b.samplerNames,b.engine)}return e.prototype.dispose=function(){this.effect.dispose()},e}(),Ck=function(){function e(b){this._pendingActions=new Array(),this._workerInfos=b.map(function(a){return{worker:a,active:!1}})}return e.prototype.dispose=function(){for(var b=0,a=this._workerInfos;b<a.length;b++)a[b].worker.terminate();delete this._workerInfos,delete this._pendingActions},e.prototype.push=function(b){for(var a=0,c=this._workerInfos;a<c.length;a++){var d=c[a];if(!d.active)return void this._execute(d,b)}this._pendingActions.push(b)},e.prototype._execute=function(b,a){var c=this;b.active=!0,a(b.worker,function(){b.active=!1;var d=c._pendingActions.shift();d&&c._execute(b,d)})},e}();function Zg(e){return new Promise(function(b){DracoDecoderModule({wasmBinary:e}).then(function(a){b({module:a})})})}function _g(e,b,a,c,d){var f=new e.DecoderBuffer();f.Init(b,b.byteLength);var g,h,j=new e.Decoder();try{var m=j.GetEncodedGeometryType(f);switch(m){case e.TRIANGULAR_MESH:g=new e.Mesh(),h=j.DecodeBufferToMesh(f,g);break;case e.POINT_CLOUD:g=new e.PointCloud(),h=j.DecodeBufferToPointCloud(f,g);break;default:throw new Error("Invalid geometry type "+m)}if(!h.ok()||!g.ptr)throw new Error(h.error_msg());var w=g.num_points();if(m===e.TRIANGULAR_MESH){var z=g.num_faces(),C=new e.DracoInt32Array();try{for(var J=new Uint32Array(3*z),K=0;K<z;K++){j.GetFaceFromMesh(g,K,C);var N=3*K;J[N+0]=C.GetValue(0),J[N+1]=C.GetValue(1),J[N+2]=C.GetValue(2)}c(J)}finally{e.destroy(C)}}var T=function(ea,fa){var ka=new e.DracoFloat32Array();try{j.GetAttributeFloatForAllPoints(g,fa,ka);var pa=fa.num_components();if("color"===ea&&3===pa){for(var va=new Float32Array(4*w),sa=0,la=0;sa<va.length;sa+=4,la+=pa)va[sa+0]=ka.GetValue(la+0),va[sa+1]=ka.GetValue(la+1),va[sa+2]=ka.GetValue(la+2),va[sa+3]=1;d(ea,va)}else{for(va=new Float32Array(w*pa),sa=0;sa<va.length;sa++)va[sa]=ka.GetValue(sa);d(ea,va)}}finally{e.destroy(ka)}};if(a)for(var Z in a){var _=a[Z];T(Z,j.GetAttributeByUniqueId(g,_))}else{var ca={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var Z in ca)-1!==(_=j.GetAttributeId(g,e[ca[Z]]))&&T(Z,j.GetAttribute(g,_))}}finally{g&&e.destroy(g),e.destroy(j),e.destroy(f)}}function Dk(e){return"object"!=typeof document||"string"!=typeof e?e:Qa.b.GetAbsoluteUrl(e)}var Nn=function(){function e(b){void 0===b&&(b=e.DefaultNumWorkers);var a=e.Configuration.decoder,c=a.wasmUrl&&a.wasmBinaryUrl&&"object"==typeof WebAssembly?{url:a.wasmUrl,wasmBinaryPromise:Qa.b.LoadFileAsync(Dk(a.wasmBinaryUrl))}:{url:a.fallbackUrl,wasmBinaryPromise:Promise.resolve(void 0)};b&&"function"==typeof Worker?this._workerPoolPromise=c.wasmBinaryPromise.then(function(d){for(var f=""+Zg+_g+"("+function(){var m;onmessage=function(w){var z=w.data;switch(z.id){case"init":var C=z.decoder;C.url&&(importScripts(C.url),m=Zg(C.wasmBinary)),postMessage("done");break;case"decodeMesh":if(!m)throw new Error("Draco decoder module is not available");m.then(function(J){_g(J.module,z.dataView,z.attributes,function(K){postMessage({id:"indices",value:K},[K.buffer])},function(K,N){postMessage({id:K,value:N},[N.buffer])}),postMessage("done")})}}}+")()",g=URL.createObjectURL(new Blob([f],{type:"application/javascript"})),h=new Array(b),j=0;j<h.length;j++)h[j]=new Promise(function(m,w){var z=new Worker(g),C=function(K){z.removeEventListener("error",C),z.removeEventListener("message",J),w(K)},J=function(K){"done"===K.data&&(z.removeEventListener("error",C),z.removeEventListener("message",J),m(z))};z.addEventListener("error",C),z.addEventListener("message",J),z.postMessage({id:"init",decoder:{url:Dk(c.url),wasmBinary:d}})});return Promise.all(h).then(function(m){return new Ck(m)})}):this._decoderModulePromise=c.wasmBinaryPromise.then(function(d){if(!c.url)throw new Error("Draco decoder module is not available");return Qa.b.LoadScriptAsync(c.url).then(function(){return Zg(d)})})}return Object.defineProperty(e,"DecoderAvailable",{get:function(){var b=e.Configuration.decoder;return!!(b.wasmUrl&&b.wasmBinaryUrl&&"object"==typeof WebAssembly||b.fallbackUrl)},enumerable:!0,configurable:!0}),e.GetDefaultNumWorkers=function(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(e,"Default",{get:function(){return e._Default||(e._Default=new e()),e._Default},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then(function(b){b.dispose()}),delete this._workerPoolPromise,delete this._decoderModulePromise},e.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then(function(){}):this._decoderModulePromise?this._decoderModulePromise.then(function(){}):Promise.resolve()},e.prototype.decodeMeshAsync=function(b,a){var c=b instanceof ArrayBuffer?new Uint8Array(b):b;if(this._workerPoolPromise)return this._workerPoolPromise.then(function(d){return new Promise(function(f,g){d.push(function(h,j){var m=new Xa.a(),w=function(J){h.removeEventListener("error",w),h.removeEventListener("message",z),g(J),j()},z=function(J){"done"===J.data?(h.removeEventListener("error",w),h.removeEventListener("message",z),f(m),j()):"indices"===J.data.id?m.indices=J.data.value:m.set(J.data.value,J.data.id)};h.addEventListener("error",w),h.addEventListener("message",z);var C=new Uint8Array(c.byteLength);C.set(new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),h.postMessage({id:"decodeMesh",dataView:C,attributes:a},[C.buffer])})})});if(this._decoderModulePromise)return this._decoderModulePromise.then(function(d){var f=new Xa.a();return _g(d.module,c,a,function(g){f.indices=g},function(g,h){f.set(h,g)}),f});throw new Error("Draco decoder module is not available")},e.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},e.DefaultNumWorkers=e.GetDefaultNumWorkers(),e._Default=null,e}(),Yd=o(57),Ek=0,On=function(){function e(b,a,c){this.pos=b,this.normal=a,this.uv=c}return e.prototype.clone=function(){return new e(this.pos.clone(),this.normal.clone(),this.uv.clone())},e.prototype.flip=function(){this.normal=this.normal.scale(-1)},e.prototype.interpolate=function(b,a){return new e(i.e.Lerp(this.pos,b.pos,a),i.e.Lerp(this.normal,b.normal,a),i.d.Lerp(this.uv,b.uv,a))},e}(),Pn=function(){function e(b,a){this.normal=b,this.w=a}return e.FromPoints=function(b,a,c){var d=c.subtract(b),f=a.subtract(b);if(0===d.lengthSquared()||0===f.lengthSquared())return null;var g=i.e.Normalize(i.e.Cross(d,f));return new e(g,i.e.Dot(g,b))},e.prototype.clone=function(){return new e(this.normal.clone(),this.w)},e.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},e.prototype.splitPolygon=function(b,a,c,d,f){var g,h,j=0,m=[];for(g=0;g<b.vertices.length;g++){var w=(h=i.e.Dot(this.normal,b.vertices[g].pos)-this.w)<-e.EPSILON?2:h>e.EPSILON?1:0;j|=w,m.push(w)}switch(j){case 0:(i.e.Dot(this.normal,b.plane.normal)>0?a:c).push(b);break;case 1:d.push(b);break;case 2:f.push(b);break;case 3:var z,C=[],J=[];for(g=0;g<b.vertices.length;g++){var K=(g+1)%b.vertices.length,N=m[g],T=m[K],Z=b.vertices[g],_=b.vertices[K];if(2!==N&&C.push(Z),1!==N&&J.push(2!==N?Z.clone():Z),3==(N|T)){h=(this.w-i.e.Dot(this.normal,Z.pos))/i.e.Dot(this.normal,_.pos.subtract(Z.pos));var ca=Z.interpolate(_,h);C.push(ca),J.push(ca.clone())}}C.length>=3&&(z=new $g(C,b.shared)).plane&&d.push(z),J.length>=3&&(z=new $g(J,b.shared)).plane&&f.push(z)}},e.EPSILON=1e-05,e}(),$g=function(){function e(b,a){this.vertices=b,this.shared=a,this.plane=Pn.FromPoints(b[0].pos,b[1].pos,b[2].pos)}return e.prototype.clone=function(){return new e(this.vertices.map(function(b){return b.clone()}),this.shared)},e.prototype.flip=function(){this.vertices.reverse().map(function(b){b.flip()}),this.plane.flip()},e}(),rc=function(){function e(b){this.plane=null,this.front=null,this.back=null,this.polygons=new Array(),b&&this.build(b)}return e.prototype.clone=function(){var b=new e();return b.plane=this.plane&&this.plane.clone(),b.front=this.front&&this.front.clone(),b.back=this.back&&this.back.clone(),b.polygons=this.polygons.map(function(a){return a.clone()}),b},e.prototype.invert=function(){for(var b=0;b<this.polygons.length;b++)this.polygons[b].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var a=this.front;this.front=this.back,this.back=a},e.prototype.clipPolygons=function(b){if(!this.plane)return b.slice();for(var a=new Array(),c=new Array(),d=0;d<b.length;d++)this.plane.splitPolygon(b[d],a,c,a,c);return this.front&&(a=this.front.clipPolygons(a)),c=this.back?this.back.clipPolygons(c):[],a.concat(c)},e.prototype.clipTo=function(b){this.polygons=b.clipPolygons(this.polygons),this.front&&this.front.clipTo(b),this.back&&this.back.clipTo(b)},e.prototype.allPolygons=function(){var b=this.polygons.slice();return this.front&&(b=b.concat(this.front.allPolygons())),this.back&&(b=b.concat(this.back.allPolygons())),b},e.prototype.build=function(b){if(b.length){this.plane||(this.plane=b[0].plane.clone());for(var a=new Array(),c=new Array(),d=0;d<b.length;d++)this.plane.splitPolygon(b[d],this.polygons,this.polygons,a,c);a.length&&(this.front||(this.front=new e()),this.front.build(a)),c.length&&(this.back||(this.back=new e()),this.back.build(c))}},e}(),Qn=function(){function e(){this.polygons=new Array()}return e.FromMesh=function(b){var a,c,d,f,g,h,j,m,w,z,C=new Array(),J=null;if(!(b instanceof xa.a))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";b.computeWorldMatrix(!0),j=b.getWorldMatrix(),m=b.position.clone(),w=b.rotation.clone(),b.rotationQuaternion&&(J=b.rotationQuaternion.clone()),z=b.scaling.clone();for(var K=b.getIndices(),N=b.getVerticesData(ra.b.PositionKind),T=b.getVerticesData(ra.b.NormalKind),Z=b.getVerticesData(ra.b.UVKind),_=b.subMeshes,ca=0,ea=_.length;ca<ea;ca++)for(var fa=_[ca].indexStart,ka=_[ca].indexCount+_[ca].indexStart;fa<ka;fa+=3){h=[];for(var pa=0;pa<3;pa++){var va=new i.e(T[3*K[fa+pa]],T[3*K[fa+pa]+1],T[3*K[fa+pa]+2]);d=new i.d(Z[2*K[fa+pa]],Z[2*K[fa+pa]+1]);var sa=new i.e(N[3*K[fa+pa]],N[3*K[fa+pa]+1],N[3*K[fa+pa]+2]);f=i.e.TransformCoordinates(sa,j),c=i.e.TransformNormal(va,j),a=new On(f,c,d),h.push(a)}(g=new $g(h,{subMeshId:ca,meshId:Ek,materialIndex:_[ca].materialIndex})).plane&&C.push(g)}var la=e.FromPolygons(C);return la.matrix=j,la.position=m,la.rotation=w,la.scaling=z,la.rotationQuaternion=J,Ek++,la},e.FromPolygons=function(b){var a=new e();return a.polygons=b,a},e.prototype.clone=function(){var b=new e();return b.polygons=this.polygons.map(function(a){return a.clone()}),b.copyTransformAttributes(this),b},e.prototype.union=function(b){var a=new rc(this.clone().polygons),c=new rc(b.clone().polygons);return a.clipTo(c),c.clipTo(a),c.invert(),c.clipTo(a),c.invert(),a.build(c.allPolygons()),e.FromPolygons(a.allPolygons()).copyTransformAttributes(this)},e.prototype.unionInPlace=function(b){var a=new rc(this.polygons),c=new rc(b.polygons);a.clipTo(c),c.clipTo(a),c.invert(),c.clipTo(a),c.invert(),a.build(c.allPolygons()),this.polygons=a.allPolygons()},e.prototype.subtract=function(b){var a=new rc(this.clone().polygons),c=new rc(b.clone().polygons);return a.invert(),a.clipTo(c),c.clipTo(a),c.invert(),c.clipTo(a),c.invert(),a.build(c.allPolygons()),a.invert(),e.FromPolygons(a.allPolygons()).copyTransformAttributes(this)},e.prototype.subtractInPlace=function(b){var a=new rc(this.polygons),c=new rc(b.polygons);a.invert(),a.clipTo(c),c.clipTo(a),c.invert(),c.clipTo(a),c.invert(),a.build(c.allPolygons()),a.invert(),this.polygons=a.allPolygons()},e.prototype.intersect=function(b){var a=new rc(this.clone().polygons),c=new rc(b.clone().polygons);return a.invert(),c.clipTo(a),c.invert(),a.clipTo(c),c.clipTo(a),a.build(c.allPolygons()),a.invert(),e.FromPolygons(a.allPolygons()).copyTransformAttributes(this)},e.prototype.intersectInPlace=function(b){var a=new rc(this.polygons),c=new rc(b.polygons);a.invert(),c.clipTo(a),c.invert(),a.clipTo(c),c.clipTo(a),a.build(c.allPolygons()),a.invert(),this.polygons=a.allPolygons()},e.prototype.inverse=function(){var b=this.clone();return b.inverseInPlace(),b},e.prototype.inverseInPlace=function(){this.polygons.map(function(b){b.flip()})},e.prototype.copyTransformAttributes=function(b){return this.matrix=b.matrix,this.position=b.position,this.rotation=b.rotation,this.scaling=b.scaling,this.rotationQuaternion=b.rotationQuaternion,this},e.prototype.buildMeshGeometry=function(b,a,c){var d=this.matrix.clone();d.invert();var f,g,h,j=new xa.a(b,a),m=[],w=[],z=[],C=[],J=i.e.Zero(),K=i.e.Zero(),N=i.d.Zero(),T=this.polygons,Z=[0,0,0],_={},ca=0,ea={};c&&T.sort(function(Fa,La){return Fa.shared.meshId===La.shared.meshId?Fa.shared.subMeshId-La.shared.subMeshId:Fa.shared.meshId-La.shared.meshId});for(var fa=0,ka=T.length;fa<ka;fa++){ea[(f=T[fa]).shared.meshId]||(ea[f.shared.meshId]={}),ea[f.shared.meshId][f.shared.subMeshId]||(ea[f.shared.meshId][f.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:f.shared.materialIndex}),h=ea[f.shared.meshId][f.shared.subMeshId];for(var pa=2,va=f.vertices.length;pa<va;pa++){Z[0]=0,Z[1]=pa-1,Z[2]=pa;for(var sa=0;sa<3;sa++){J.copyFrom(f.vertices[Z[sa]].pos),K.copyFrom(f.vertices[Z[sa]].normal),N.copyFrom(f.vertices[Z[sa]].uv);var la=i.e.TransformCoordinates(J,d),ta=i.e.TransformNormal(K,d);void 0!==(g=_[la.x+","+la.y+","+la.z])&&z[3*g]===ta.x&&z[3*g+1]===ta.y&&z[3*g+2]===ta.z&&C[2*g]===N.x&&C[2*g+1]===N.y||(m.push(la.x,la.y,la.z),C.push(N.x,N.y),z.push(K.x,K.y,K.z),g=_[la.x+","+la.y+","+la.z]=m.length/3-1),w.push(g),h.indexStart=Math.min(ca,h.indexStart),h.indexEnd=Math.max(ca,h.indexEnd),ca++}}}if(j.setVerticesData(ra.b.PositionKind,m),j.setVerticesData(ra.b.NormalKind,z),j.setVerticesData(ra.b.UVKind,C),j.setIndices(w,null),c){var Da,ua=0;for(var Aa in j.subMeshes=new Array(),ea){for(var za in Da=-1,ea[Aa])h=ea[Aa][za],Yd.b.CreateFromIndices(h.materialIndex+ua,h.indexStart,h.indexEnd-h.indexStart+1,j),Da=Math.max(h.materialIndex,Da);ua+=++Da}}return j},e.prototype.toMesh=function(b,a,c,d){void 0===a&&(a=null);var f=this.buildMeshGeometry(b,c,d);return f.material=a,f.position.copyFrom(this.position),f.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(f.rotationQuaternion=this.rotationQuaternion.clone()),f.scaling.copyFrom(this.scaling),f.computeWorldMatrix(!0),f},e}(),Rn=function(e){function b(a,c,d,f,g,h){void 0===f&&(f=1),void 0===g&&(g=60),void 0===h&&(h=!0);var j=e.call(this,a,d)||this;j._sectionPolygonPointsCount=4,j._running=!1,j._autoStart=h,j._generator=c,j._diameter=f,j._length=g,j._sectionVectors=[],j._sectionNormalVectors=[];for(var m=0;m<j._sectionPolygonPointsCount;m++)j._sectionVectors[m]=i.e.Zero(),j._sectionNormalVectors[m]=i.e.Zero();return j._createMesh(),j}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"TrailMesh"},b.prototype._createMesh=function(){var a=new Xa.a(),c=[],d=[],f=[],g=i.e.Zero();g=this._generator instanceof qb.a&&this._generator._boundingInfo?this._generator._boundingInfo.boundingBox.centerWorld:this._generator.position;for(var h=2*Math.PI/this._sectionPolygonPointsCount,j=0;j<this._sectionPolygonPointsCount;j++)c.push(g.x+Math.cos(j*h)*this._diameter,g.y+Math.sin(j*h)*this._diameter,g.z);for(j=1;j<=this._length;j++){for(var m=0;m<this._sectionPolygonPointsCount;m++)c.push(g.x+Math.cos(m*h)*this._diameter,g.y+Math.sin(m*h)*this._diameter,g.z);var w=c.length/3-2*this._sectionPolygonPointsCount;for(m=0;m<this._sectionPolygonPointsCount-1;m++)f.push(w+m,w+m+this._sectionPolygonPointsCount,w+m+this._sectionPolygonPointsCount+1),f.push(w+m,w+m+this._sectionPolygonPointsCount+1,w+m+1);f.push(w+this._sectionPolygonPointsCount-1,w+this._sectionPolygonPointsCount-1+this._sectionPolygonPointsCount,w+this._sectionPolygonPointsCount),f.push(w+this._sectionPolygonPointsCount-1,w+this._sectionPolygonPointsCount,w)}Xa.a.ComputeNormals(c,f,d),a.positions=c,a.normals=d,a.indices=f,a.applyToMesh(this,!0),this._autoStart&&this.start()},b.prototype.start=function(){var a=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add(function(){a.update()}))},b.prototype.stop=function(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))},b.prototype.update=function(){var a=this.getVerticesData(ra.b.PositionKind),c=this.getVerticesData(ra.b.NormalKind),d=this._generator.getWorldMatrix();if(a&&c){for(var f=3*this._sectionPolygonPointsCount;f<a.length;f++)a[f-3*this._sectionPolygonPointsCount]=a[f]-c[f]/this._length*this._diameter;for(f=3*this._sectionPolygonPointsCount;f<c.length;f++)c[f-3*this._sectionPolygonPointsCount]=c[f];var g=a.length-3*this._sectionPolygonPointsCount,h=2*Math.PI/this._sectionPolygonPointsCount;for(f=0;f<this._sectionPolygonPointsCount;f++)this._sectionVectors[f].copyFromFloats(Math.cos(f*h)*this._diameter,Math.sin(f*h)*this._diameter,0),this._sectionNormalVectors[f].copyFromFloats(Math.cos(f*h),Math.sin(f*h),0),i.e.TransformCoordinatesToRef(this._sectionVectors[f],d,this._sectionVectors[f]),i.e.TransformNormalToRef(this._sectionNormalVectors[f],d,this._sectionNormalVectors[f]);for(f=0;f<this._sectionPolygonPointsCount;f++)a[g+3*f]=this._sectionVectors[f].x,a[g+3*f+1]=this._sectionVectors[f].y,a[g+3*f+2]=this._sectionVectors[f].z,c[g+3*f]=this._sectionNormalVectors[f].x,c[g+3*f+1]=this._sectionNormalVectors[f].y,c[g+3*f+2]=this._sectionNormalVectors[f].z;this.updateVerticesData(ra.b.PositionKind,a,!0,!1),this.updateVerticesData(ra.b.NormalKind,c,!0,!1)}},b.prototype.clone=function(a,c){return void 0===a&&(a=""),new b(a,void 0===c?this._generator:c,this.getScene(),this._diameter,this._length,this._autoStart)},b.prototype.serialize=function(a){e.prototype.serialize.call(this,a)},b.Parse=function(a,c){return new b(a.name,a._generator,c,a._diameter,a._length,a._autoStart)},b}(xa.a),Sn=o(136),Ie=o(92);Xa.a.CreateDisc=function(e){var b=new Array(),a=new Array(),c=new Array(),d=new Array(),f=e.radius||.5,g=e.tessellation||64,h=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,j=0===e.sideOrientation?0:e.sideOrientation||Xa.a.DEFAULTSIDE;b.push(0,0,0),d.push(.5,.5);for(var m=2*Math.PI*h,w=m/g,z=0;z<m;z+=w){var C=Math.cos(z),J=Math.sin(z),K=(C+1)/2,N=(1-J)/2;b.push(f*C,f*J,0),d.push(K,N)}1===h&&(b.push(b[3],b[4],b[5]),d.push(d[2],d[3]));for(var T=b.length/3,Z=1;Z<T-1;Z++)a.push(Z+1,0,Z);Xa.a.ComputeNormals(b,a,c),Xa.a._ComputeSides(j,b,a,c,d,e.frontUVs,e.backUVs);var _=new Xa.a();return _.indices=a,_.positions=b,_.normals=c,_.uvs=d,_},xa.a.CreateDisc=function(e,b,a,c,d,f){void 0===c&&(c=null);var g={radius:b,tessellation:a,sideOrientation:f,updatable:d};return Af.CreateDisc(e,g,c)};var Af=function(){function e(){}return e.CreateDisc=function(b,a,c){void 0===c&&(c=null);var d=new xa.a(b,c);return a.sideOrientation=xa.a._GetDefaultSideOrientation(a.sideOrientation),d._originalBuilderSideOrientation=a.sideOrientation,Xa.a.CreateDisc(a).applyToMesh(d,a.updatable),d},e}();Xa.a.CreateTiledBox=function(e){for(var b=e.faceUV||new Array(6),a=e.faceColors,c=e.pattern||xa.a.NO_FLIP,d=e.width||e.size||1,f=e.height||e.size||1,g=e.depth||e.size||1,h=e.tileWidth||e.tileSize||1,j=e.tileHeight||e.tileSize||1,m=e.alignHorizontal||0,w=e.alignVertical||0,z=0===e.sideOrientation?0:e.sideOrientation||Xa.a.DEFAULTSIDE,C=0;C<6;C++)void 0===b[C]&&(b[C]=new i.f(0,0,1,1)),a&&void 0===a[C]&&(a[C]=new G.b(1,1,1,1));var J=d/2,K=f/2,N=g/2,T=[];for(C=0;C<2;C++)T[C]=Xa.a.CreateTiledPlane({pattern:c,tileWidth:h,tileHeight:j,width:d,height:f,alignVertical:w,alignHorizontal:m,sideOrientation:z});for(C=2;C<4;C++)T[C]=Xa.a.CreateTiledPlane({pattern:c,tileWidth:h,tileHeight:j,width:g,height:f,alignVertical:w,alignHorizontal:m,sideOrientation:z});var Z=w;for(w===xa.a.BOTTOM?Z=xa.a.TOP:w===xa.a.TOP&&(Z=xa.a.BOTTOM),C=4;C<6;C++)T[C]=Xa.a.CreateTiledPlane({pattern:c,tileWidth:h,tileHeight:j,width:d,height:g,alignVertical:Z,alignHorizontal:m,sideOrientation:z});var _=[],ca=[],ea=[],fa=[],ka=[],pa=[],va=[],sa=[],la=0,ta=0,Da=0;for(C=0;C<6;C++){la=T[C].positions.length,pa[C]=[],va[C]=[];for(var ua=0;ua<la/3;ua++)pa[C].push(new i.e(T[C].positions[3*ua],T[C].positions[3*ua+1],T[C].positions[3*ua+2])),va[C].push(new i.e(T[C].normals[3*ua],T[C].normals[3*ua+1],T[C].normals[3*ua+2]));ta=T[C].uvs.length,sa[C]=[];for(var Aa=0;Aa<ta;Aa+=2)sa[C][Aa]=b[C].x+(b[C].z-b[C].x)*T[C].uvs[Aa],sa[C][Aa+1]=b[C].y+(b[C].w-b[C].y)*T[C].uvs[Aa+1];if(ea=ea.concat(sa[C]),fa=fa.concat(T[C].indices.map(function(Ma){return Ma+Da})),Da+=pa[C].length,a)for(var za=0;za<4;za++)ka.push(a[C].r,a[C].g,a[C].b,a[C].a)}var Fa=new i.e(0,0,N),La=i.a.RotationY(Math.PI);_=pa[0].map(function(Ma){return i.e.TransformNormal(Ma,La).add(Fa)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[]),ca=va[0].map(function(Ma){return i.e.TransformNormal(Ma,La)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[]),_=_.concat(pa[1].map(function(Ma){return Ma.subtract(Fa)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[])),ca=ca.concat(va[1].map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[]));var Ta=new i.e(J,0,0),bb=i.a.RotationY(-Math.PI/2);_=_.concat(pa[2].map(function(Ma){return i.e.TransformNormal(Ma,bb).add(Ta)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[])),ca=ca.concat(va[2].map(function(Ma){return i.e.TransformNormal(Ma,bb)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[]));var Ra=i.a.RotationY(Math.PI/2);_=_.concat(pa[3].map(function(Ma){return i.e.TransformNormal(Ma,Ra).subtract(Ta)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[])),ca=ca.concat(va[3].map(function(Ma){return i.e.TransformNormal(Ma,Ra)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[]));var Oa=new i.e(0,K,0),Za=i.a.RotationX(Math.PI/2);_=_.concat(pa[4].map(function(Ma){return i.e.TransformNormal(Ma,Za).add(Oa)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[])),ca=ca.concat(va[4].map(function(Ma){return i.e.TransformNormal(Ma,Za)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[]));var Va=i.a.RotationX(-Math.PI/2);_=_.concat(pa[5].map(function(Ma){return i.e.TransformNormal(Ma,Va).subtract(Oa)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[])),ca=ca.concat(va[5].map(function(Ma){return i.e.TransformNormal(Ma,Va)}).map(function(Ma){return[Ma.x,Ma.y,Ma.z]}).reduce(function(Ma,Wa){return Ma.concat(Wa)},[])),Xa.a._ComputeSides(z,_,fa,ca,ea);var $a=new Xa.a();if($a.indices=fa,$a.positions=_,$a.normals=ca,$a.uvs=ea,a){var fb=z===Xa.a.DOUBLESIDE?ka.concat(ka):ka;$a.colors=fb}return $a};var Fk=function(){function e(){}return e.CreateTiledBox=function(b,a,c){void 0===c&&(c=null);var d=new xa.a(b,c);return a.sideOrientation=xa.a._GetDefaultSideOrientation(a.sideOrientation),d._originalBuilderSideOrientation=a.sideOrientation,Xa.a.CreateTiledBox(a).applyToMesh(d,a.updatable),d},e}();Xa.a.CreateTorusKnot=function(e){var b,a,c=new Array(),d=new Array(),f=new Array(),g=new Array(),h=e.radius||2,j=e.tube||.5,m=e.radialSegments||32,w=e.tubularSegments||32,z=e.p||2,C=e.q||3,J=0===e.sideOrientation?0:e.sideOrientation||Xa.a.DEFAULTSIDE,K=function(Aa){var za=Math.cos(Aa),Fa=Math.sin(Aa),La=C/z*Aa,Ta=Math.cos(La),bb=h*(2+Ta)*.5*za,Ra=h*(2+Ta)*Fa*.5,Oa=h*Math.sin(La)*.5;return new i.e(bb,Ra,Oa)};for(b=0;b<=m;b++){var N=b%m/m*2*z*Math.PI,T=K(N),Z=K(N+.01),_=Z.subtract(T),ca=Z.add(T),ea=i.e.Cross(_,ca);for(ca=i.e.Cross(ea,_),ea.normalize(),ca.normalize(),a=0;a<w;a++){var fa=a%w/w*2*Math.PI,ka=-j*Math.cos(fa),pa=j*Math.sin(fa);d.push(T.x+ka*ca.x+pa*ea.x),d.push(T.y+ka*ca.y+pa*ea.y),d.push(T.z+ka*ca.z+pa*ea.z),g.push(b/m),g.push(a/w)}}for(b=0;b<m;b++)for(a=0;a<w;a++){var va=(a+1)%w,sa=b*w+a,la=(b+1)*w+a,ta=(b+1)*w+va,Da=b*w+va;c.push(Da),c.push(la),c.push(sa),c.push(Da),c.push(ta),c.push(la)}Xa.a.ComputeNormals(d,c,f),Xa.a._ComputeSides(J,d,c,f,g,e.frontUVs,e.backUVs);var ua=new Xa.a();return ua.indices=c,ua.positions=d,ua.normals=f,ua.uvs=g,ua},xa.a.CreateTorusKnot=function(e,b,a,c,d,f,g,h,j,m){var w={radius:b,tube:a,radialSegments:c,tubularSegments:d,p:f,q:g,sideOrientation:m,updatable:j};return ah.CreateTorusKnot(e,w,h)};var ah=function(){function e(){}return e.CreateTorusKnot=function(b,a,c){var d=new xa.a(b,c);return a.sideOrientation=xa.a._GetDefaultSideOrientation(a.sideOrientation),d._originalBuilderSideOrientation=a.sideOrientation,Xa.a.CreateTorusKnot(a).applyToMesh(d,a.updatable),d},e}(),Tn=function(e){function b(a,c){var d=e.call(this,a.x,a.y)||this;return d.index=c,d}return Object(l.d)(b,e),b}(i.d),bh=function(){function e(){this.elements=new Array()}return e.prototype.add=function(b){var a=this,c=new Array();return b.forEach(function(d){if(0===c.length||!d.equalsWithEpsilon(c[0])){var f=new Tn(d,a.elements.length);c.push(f),a.elements.push(f)}}),c},e.prototype.computeBounds=function(){var b=new i.d(this.elements[0].x,this.elements[0].y),a=new i.d(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(c){c.x<b.x?b.x=c.x:c.x>a.x&&(a.x=c.x),c.y<b.y?b.y=c.y:c.y>a.y&&(a.y=c.y)}),{min:b,max:a,width:a.x-b.x,height:a.y-b.y}},e}(),Un=function(){function e(){}return e.Rectangle=function(b,a,c,d){return[new i.d(b,a),new i.d(c,a),new i.d(c,d),new i.d(b,d)]},e.Circle=function(b,a,c,d){void 0===a&&(a=0),void 0===c&&(c=0),void 0===d&&(d=32);for(var f=new Array(),g=0,h=2*Math.PI/d,j=0;j<d;j++)f.push(new i.d(a+Math.cos(g)*b,c+Math.sin(g)*b)),g-=h;return f},e.Parse=function(b){var a,c=b.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(f){return!isNaN(f)}),d=[];for(a=0;a<(2147483646&c.length);a+=2)d.push(new i.d(c[a],c[a+1]));return d},e.StartingAt=function(b,a){return dc.StartingAt(b,a)},e}(),Gk=function(){function e(b,a,c,d){var f;void 0===d&&(d=earcut),this._points=new bh(),this._outlinepoints=new bh(),this._holes=new Array(),this._epoints=new Array(),this._eholes=new Array(),this.bjsEarcut=d,this._name=b,this._scene=c||Ha.a.LastCreatedScene,f=a instanceof dc?a.getPoints():a,this._addToepoint(f),this._points.add(f),this._outlinepoints.add(f),void 0===this.bjsEarcut&&k.a.Warn("Earcut was not found, the polygon will not be built.")}return e.prototype._addToepoint=function(b){for(var a=0,c=b;a<c.length;a++){var d=c[a];this._epoints.push(d.x,d.y)}},e.prototype.addHole=function(b){this._points.add(b);var a=new bh();return a.add(b),this._holes.push(a),this._eholes.push(this._epoints.length/2),this._addToepoint(b),this},e.prototype.build=function(b,a){void 0===b&&(b=!1),void 0===a&&(a=0);var c=new xa.a(this._name,this._scene),d=this.buildVertexData(a);return c.setVerticesData(ra.b.PositionKind,d.positions,b),c.setVerticesData(ra.b.NormalKind,d.normals,b),c.setVerticesData(ra.b.UVKind,d.uvs,b),c.setIndices(d.indices),c},e.prototype.buildVertexData=function(b){var a=this;void 0===b&&(b=0);var c=new Xa.a(),d=new Array(),f=new Array(),g=new Array(),h=this._points.computeBounds();this._points.elements.forEach(function(T){d.push(0,1,0),f.push(T.x,0,T.y),g.push((T.x-h.min.x)/h.width,(T.y-h.min.y)/h.height)});for(var j=new Array(),m=this.bjsEarcut(this._epoints,this._eholes,2),w=0;w<m.length;w++)j.push(m[w]);if(b>0){var z=f.length/3;this._points.elements.forEach(function(T){d.push(0,-1,0),f.push(T.x,-b,T.y),g.push(1-(T.x-h.min.x)/h.width,1-(T.y-h.min.y)/h.height)});var C=j.length;for(w=0;w<C;w+=3){var J=j[w+0],K=j[w+1],N=j[w+2];j.push(N+z),j.push(K+z),j.push(J+z)}this.addSide(f,d,g,j,h,this._outlinepoints,b,!1),this._holes.forEach(function(T){a.addSide(f,d,g,j,h,T,b,!0)})}return c.indices=j,c.positions=f,c.normals=d,c.uvs=g,c},e.prototype.addSide=function(b,a,c,d,f,g,h,j){for(var m=b.length/3,w=0,z=0;z<g.elements.length;z++){var C,J=g.elements[z];C=z+1>g.elements.length-1?g.elements[0]:g.elements[z+1],b.push(J.x,0,J.y),b.push(J.x,-h,J.y),b.push(C.x,0,C.y),b.push(C.x,-h,C.y);var K=new i.e(J.x,0,J.y),N=new i.e(C.x,0,C.y).subtract(K),T=new i.e(0,1,0),Z=i.e.Cross(N,T);Z=Z.normalize(),c.push(w/f.width,0),c.push(w/f.width,1),w+=N.length(),c.push(w/f.width,0),c.push(w/f.width,1),j?(a.push(Z.x,Z.y,Z.z),a.push(Z.x,Z.y,Z.z),a.push(Z.x,Z.y,Z.z),a.push(Z.x,Z.y,Z.z),d.push(m),d.push(m+2),d.push(m+1),d.push(m+1),d.push(m+2),d.push(m+3)):(a.push(-Z.x,-Z.y,-Z.z),a.push(-Z.x,-Z.y,-Z.z),a.push(-Z.x,-Z.y,-Z.z),a.push(-Z.x,-Z.y,-Z.z),d.push(m),d.push(m+1),d.push(m+2),d.push(m+1),d.push(m+3),d.push(m+2)),m+=4}},e}();Xa.a.CreatePolygon=function(e,b,a,c,d,f){for(var g=a||new Array(3),h=c,j=[],m=0;m<3;m++)void 0===g[m]&&(g[m]=new i.f(0,0,1,1)),h&&void 0===h[m]&&(h[m]=new G.b(1,1,1,1));for(var w=e.getVerticesData(ra.b.PositionKind),z=e.getVerticesData(ra.b.NormalKind),C=e.getVerticesData(ra.b.UVKind),J=e.getIndices(),K=0,N=0,T=0;T<z.length;T+=3)Math.abs(z[T+1])<.001&&(N=1),Math.abs(z[T+1]-1)<.001&&(N=0),Math.abs(z[T+1]+1)<.001&&(N=2),C[2*(K=T/3)]=(1-C[2*K])*g[N].x+C[2*K]*g[N].z,C[2*K+1]=(1-C[2*K+1])*g[N].y+C[2*K+1]*g[N].w,h&&j.push(h[N].r,h[N].g,h[N].b,h[N].a);Xa.a._ComputeSides(b,w,J,z,C,d,f);var Z=new Xa.a();if(Z.indices=J,Z.positions=w,Z.normals=z,Z.uvs=C,h){var _=b===Xa.a.DOUBLESIDE?j.concat(j):j;Z.colors=_}return Z},xa.a.CreatePolygon=function(e,b,a,c,d,f,g){void 0===g&&(g=earcut);var h={shape:b,holes:c,updatable:d,sideOrientation:f};return Je.CreatePolygon(e,h,a,g)},xa.a.ExtrudePolygon=function(e,b,a,c,d,f,g,h){void 0===h&&(h=earcut);var j={shape:b,holes:d,depth:a,updatable:f,sideOrientation:g};return Je.ExtrudePolygon(e,j,c,h)};var Je=function(){function e(){}return e.CreatePolygon=function(b,a,c,d){void 0===c&&(c=null),void 0===d&&(d=earcut),a.sideOrientation=xa.a._GetDefaultSideOrientation(a.sideOrientation);for(var f=a.shape,g=a.holes||[],h=a.depth||0,j=[],m=[],w=0;w<f.length;w++)j[w]=new i.d(f[w].x,f[w].z);j[0].equalsWithEpsilon(j[j.length-1],1e-08)&&j.pop();for(var z=new Gk(b,j,c||U.a.LastCreatedScene,d),C=0;C<g.length;C++){m=[];for(var J=0;J<g[C].length;J++)m.push(new i.d(g[C][J].x,g[C][J].z));z.addHole(m)}var K=z.build(a.updatable,h);return K._originalBuilderSideOrientation=a.sideOrientation,Xa.a.CreatePolygon(K,a.sideOrientation,a.faceUV,a.faceColors,a.frontUVs,a.backUVs).applyToMesh(K,a.updatable),K},e.ExtrudePolygon=function(b,a,c,d){return void 0===c&&(c=null),void 0===d&&(d=earcut),e.CreatePolygon(b,a,c,d)},e}();xa.a.CreateLathe=function(e,b,a,c,d,f,g){var h={shape:b,radius:a,tessellation:c,sideOrientation:g,updatable:f};return ch.CreateLathe(e,h,d)};var ch=function(){function e(){}return e.CreateLathe=function(b,a,c){void 0===c&&(c=null);var d,f=a.arc?a.arc<=0||a.arc>1?1:a.arc:1,g=void 0===a.closed||a.closed,h=a.shape,j=a.radius||1,m=a.tessellation||64,w=a.clip||0,z=a.updatable,C=xa.a._GetDefaultSideOrientation(a.sideOrientation),J=a.cap||xa.a.NO_CAP,K=2*Math.PI,N=new Array(),T=a.invertUV||!1,Z=0,_=0,ca=K/m*f,ea=new Array();for(Z=0;Z<=m-w;Z++){for(ea=[],J!=xa.a.CAP_START&&J!=xa.a.CAP_ALL||(ea.push(new i.e(0,h[0].y,0)),ea.push(new i.e(Math.cos(Z*ca)*h[0].x*j,h[0].y,Math.sin(Z*ca)*h[0].x*j))),_=0;_<h.length;_++)d=new i.e(Math.cos(Z*ca)*h[_].x*j,h[_].y,Math.sin(Z*ca)*h[_].x*j),ea.push(d);J!=xa.a.CAP_END&&J!=xa.a.CAP_ALL||(ea.push(new i.e(Math.cos(Z*ca)*h[h.length-1].x*j,h[h.length-1].y,Math.sin(Z*ca)*h[h.length-1].x*j)),ea.push(new i.e(0,h[h.length-1].y,0))),N.push(ea)}return rd.CreateRibbon(b,{pathArray:N,closeArray:g,sideOrientation:C,updatable:z,invertUV:T,frontUVs:a.frontUVs,backUVs:a.backUVs},c)},e}();Xa.a.CreateTiledPlane=function(e){var b=e.pattern||xa.a.NO_FLIP,a=e.tileWidth||e.tileSize||1,c=e.tileHeight||e.tileSize||1,d=e.alignHorizontal||0,f=e.alignVertical||0,g=e.width||e.size||1,h=Math.floor(g/a),j=g-h*a,m=e.height||e.size||1,w=Math.floor(m/c),z=m-w*c,C=a*h/2,J=c*w/2,K=0,N=0,T=0,Z=0,_=0,ca=0;if(j>0||z>0){T=-C,Z=-J,_=C,ca=J;switch(d){case xa.a.CENTER:T-=j/=2,_+=j;break;case xa.a.LEFT:_+=j,K=-j/2;break;case xa.a.RIGHT:T-=j,K=j/2}switch(f){case xa.a.CENTER:Z-=z/=2,ca+=z;break;case xa.a.BOTTOM:ca+=z,N=-z/2;break;case xa.a.TOP:Z-=z,N=z/2}}var ea=[],fa=[],ka=[];ka[0]=[0,0,1,0,1,1,0,1],ka[1]=[0,0,1,0,1,1,0,1],b!==xa.a.ROTATE_TILE&&b!==xa.a.ROTATE_ROW||(ka[1]=[1,1,0,1,0,0,1,0]),b!==xa.a.FLIP_TILE&&b!==xa.a.FLIP_ROW||(ka[1]=[1,0,0,0,0,1,1,1]),b!==xa.a.FLIP_N_ROTATE_TILE&&b!==xa.a.FLIP_N_ROTATE_ROW||(ka[1]=[0,1,1,1,1,0,0,0]);for(var pa=[],va=[],sa=[],la=0,ta=0;ta<w;ta++)for(var Da=0;Da<h;Da++)ea.push(Da*a-C+K,ta*c-J+N,0),ea.push((Da+1)*a-C+K,ta*c-J+N,0),ea.push((Da+1)*a-C+K,(ta+1)*c-J+N,0),ea.push(Da*a-C+K,(ta+1)*c-J+N,0),sa.push(la,la+1,la+3,la+1,la+2,la+3),pa=b===xa.a.FLIP_TILE||b===xa.a.ROTATE_TILE||b===xa.a.FLIP_N_ROTATE_TILE?pa.concat(ka[(Da%2+ta%2)%2]):b===xa.a.FLIP_ROW||b===xa.a.ROTATE_ROW||b===xa.a.FLIP_N_ROTATE_ROW?pa.concat(ka[ta%2]):pa.concat(ka[0]),va.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),fa.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),la+=4;if(j>0||z>0){var ua,Aa,za,Fa,La=z>0&&(f===xa.a.CENTER||f===xa.a.TOP),Ta=z>0&&(f===xa.a.CENTER||f===xa.a.BOTTOM),bb=j>0&&(d===xa.a.CENTER||d===xa.a.RIGHT),Ra=j>0&&(d===xa.a.CENTER||d===xa.a.LEFT),Oa=[];if(La&&bb&&(ea.push(T+K,Z+N,0),ea.push(-C+K,Z+N,0),ea.push(-C+K,Z+z+N,0),ea.push(T+K,Z+z+N,0),sa.push(la,la+1,la+3,la+1,la+2,la+3),la+=4,Oa=[ua=1-j/a,Aa=1-z/c,za=1,Aa,za,Fa=1,ua,Fa],b===xa.a.ROTATE_ROW&&(Oa=[1-ua,1-Aa,1-za,1-Aa,1-za,1-Fa,1-ua,1-Fa]),b===xa.a.FLIP_ROW&&(Oa=[1-ua,Aa,1-za,Aa,1-za,Fa,1-ua,Fa]),b===xa.a.FLIP_N_ROTATE_ROW&&(Oa=[ua,1-Aa,za,1-Aa,za,1-Fa,ua,1-Fa]),pa=pa.concat(Oa),va.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),fa.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),La&&Ra&&(ea.push(C+K,Z+N,0),ea.push(_+K,Z+N,0),ea.push(_+K,Z+z+N,0),ea.push(C+K,Z+z+N,0),sa.push(la,la+1,la+3,la+1,la+2,la+3),la+=4,Oa=[ua=0,Aa=1-z/c,za=j/a,Aa,za,Fa=1,ua,Fa],(b===xa.a.ROTATE_ROW||b===xa.a.ROTATE_TILE&&h%2==0)&&(Oa=[1-ua,1-Aa,1-za,1-Aa,1-za,1-Fa,1-ua,1-Fa]),(b===xa.a.FLIP_ROW||b===xa.a.FLIP_TILE&&h%2==0)&&(Oa=[1-ua,Aa,1-za,Aa,1-za,Fa,1-ua,Fa]),(b===xa.a.FLIP_N_ROTATE_ROW||b===xa.a.FLIP_N_ROTATE_TILE&&h%2==0)&&(Oa=[ua,1-Aa,za,1-Aa,za,1-Fa,ua,1-Fa]),pa=pa.concat(Oa),va.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),fa.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Ta&&bb&&(ea.push(T+K,J+N,0),ea.push(-C+K,J+N,0),ea.push(-C+K,ca+N,0),ea.push(T+K,ca+N,0),sa.push(la,la+1,la+3,la+1,la+2,la+3),la+=4,Oa=[ua=1-j/a,Aa=0,za=1,Aa,za,Fa=z/c,ua,Fa],(b===xa.a.ROTATE_ROW&&w%2==1||b===xa.a.ROTATE_TILE&&w%1==0)&&(Oa=[1-ua,1-Aa,1-za,1-Aa,1-za,1-Fa,1-ua,1-Fa]),(b===xa.a.FLIP_ROW&&w%2==1||b===xa.a.FLIP_TILE&&w%2==0)&&(Oa=[1-ua,Aa,1-za,Aa,1-za,Fa,1-ua,Fa]),(b===xa.a.FLIP_N_ROTATE_ROW&&w%2==1||b===xa.a.FLIP_N_ROTATE_TILE&&w%2==0)&&(Oa=[ua,1-Aa,za,1-Aa,za,1-Fa,ua,1-Fa]),pa=pa.concat(Oa),va.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),fa.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Ta&&Ra&&(ea.push(C+K,J+N,0),ea.push(_+K,J+N,0),ea.push(_+K,ca+N,0),ea.push(C+K,ca+N,0),sa.push(la,la+1,la+3,la+1,la+2,la+3),la+=4,Oa=[ua=0,Aa=0,za=j/a,Aa,za,Fa=z/c,ua,Fa],(b===xa.a.ROTATE_ROW&&w%2==1||b===xa.a.ROTATE_TILE&&(w+h)%2==1)&&(Oa=[1-ua,1-Aa,1-za,1-Aa,1-za,1-Fa,1-ua,1-Fa]),(b===xa.a.FLIP_ROW&&w%2==1||b===xa.a.FLIP_TILE&&(w+h)%2==1)&&(Oa=[1-ua,Aa,1-za,Aa,1-za,Fa,1-ua,Fa]),(b===xa.a.FLIP_N_ROTATE_ROW&&w%2==1||b===xa.a.FLIP_N_ROTATE_TILE&&(w+h)%2==1)&&(Oa=[ua,1-Aa,za,1-Aa,za,1-Fa,ua,1-Fa]),pa=pa.concat(Oa),va.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),fa.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),La){var Za=[];for(ua=0,Aa=1-z/c,za=1,Fa=1,Za[0]=[ua,Aa,za,Aa,za,Fa,ua,Fa],Za[1]=[ua,Aa,za,Aa,za,Fa,ua,Fa],b!==xa.a.ROTATE_TILE&&b!==xa.a.ROTATE_ROW||(Za[1]=[1-ua,1-Aa,1-za,1-Aa,1-za,1-Fa,1-ua,1-Fa]),b!==xa.a.FLIP_TILE&&b!==xa.a.FLIP_ROW||(Za[1]=[1-ua,Aa,1-za,Aa,1-za,Fa,1-ua,Fa]),b!==xa.a.FLIP_N_ROTATE_TILE&&b!==xa.a.FLIP_N_ROTATE_ROW||(Za[1]=[ua,1-Aa,za,1-Aa,za,1-Fa,ua,1-Fa]),Da=0;Da<h;Da++)ea.push(Da*a-C+K,Z+N,0),ea.push((Da+1)*a-C+K,Z+N,0),ea.push((Da+1)*a-C+K,Z+z+N,0),ea.push(Da*a-C+K,Z+z+N,0),sa.push(la,la+1,la+3,la+1,la+2,la+3),la+=4,pa=b===xa.a.FLIP_TILE||b===xa.a.ROTATE_TILE||b===xa.a.FLIP_N_ROTATE_TILE?pa.concat(Za[(Da+1)%2]):b===xa.a.FLIP_ROW||b===xa.a.ROTATE_ROW||b===xa.a.FLIP_N_ROTATE_ROW?pa.concat(Za[1]):pa.concat(Za[0]),va.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),fa.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Ta){var Va=[];for(ua=0,Aa=0,za=1,Fa=z/c,Va[0]=[ua,Aa,za,Aa,za,Fa,ua,Fa],Va[1]=[ua,Aa,za,Aa,za,Fa,ua,Fa],b!==xa.a.ROTATE_TILE&&b!==xa.a.ROTATE_ROW||(Va[1]=[1-ua,1-Aa,1-za,1-Aa,1-za,1-Fa,1-ua,1-Fa]),b!==xa.a.FLIP_TILE&&b!==xa.a.FLIP_ROW||(Va[1]=[1-ua,Aa,1-za,Aa,1-za,Fa,1-ua,Fa]),b!==xa.a.FLIP_N_ROTATE_TILE&&b!==xa.a.FLIP_N_ROTATE_ROW||(Va[1]=[ua,1-Aa,za,1-Aa,za,1-Fa,ua,1-Fa]),Da=0;Da<h;Da++)ea.push(Da*a-C+K,ca-z+N,0),ea.push((Da+1)*a-C+K,ca-z+N,0),ea.push((Da+1)*a-C+K,ca+N,0),ea.push(Da*a-C+K,ca+N,0),sa.push(la,la+1,la+3,la+1,la+2,la+3),la+=4,pa=b===xa.a.FLIP_TILE||b===xa.a.ROTATE_TILE||b===xa.a.FLIP_N_ROTATE_TILE?pa.concat(Va[(Da+w)%2]):b===xa.a.FLIP_ROW||b===xa.a.ROTATE_ROW||b===xa.a.FLIP_N_ROTATE_ROW?pa.concat(Va[w%2]):pa.concat(Va[0]),va.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),fa.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(bb){var $a=[];for(ua=1-j/a,Aa=0,za=1,Fa=1,$a[0]=[ua,Aa,za,Aa,za,Fa,ua,Fa],$a[1]=[ua,Aa,za,Aa,za,Fa,ua,Fa],b!==xa.a.ROTATE_TILE&&b!==xa.a.ROTATE_ROW||($a[1]=[1-ua,1-Aa,1-za,1-Aa,1-za,1-Fa,1-ua,1-Fa]),b!==xa.a.FLIP_TILE&&b!==xa.a.FLIP_ROW||($a[1]=[1-ua,Aa,1-za,Aa,1-za,Fa,1-ua,Fa]),b!==xa.a.FLIP_N_ROTATE_TILE&&b!==xa.a.FLIP_N_ROTATE_ROW||($a[1]=[ua,1-Aa,za,1-Aa,za,1-Fa,ua,1-Fa]),ta=0;ta<w;ta++)ea.push(T+K,ta*c-J+N,0),ea.push(T+j+K,ta*c-J+N,0),ea.push(T+j+K,(ta+1)*c-J+N,0),ea.push(T+K,(ta+1)*c-J+N,0),sa.push(la,la+1,la+3,la+1,la+2,la+3),la+=4,pa=b===xa.a.FLIP_TILE||b===xa.a.ROTATE_TILE||b===xa.a.FLIP_N_ROTATE_TILE?pa.concat($a[(ta+1)%2]):b===xa.a.FLIP_ROW||b===xa.a.ROTATE_ROW||b===xa.a.FLIP_N_ROTATE_ROW?pa.concat($a[ta%2]):pa.concat($a[0]),va.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),fa.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Ra){var fb=[];for(ua=0,Aa=0,za=j/c,Fa=1,fb[0]=[ua,Aa,za,Aa,za,Fa,ua,Fa],fb[1]=[ua,Aa,za,Aa,za,Fa,ua,Fa],b!==xa.a.ROTATE_TILE&&b!==xa.a.ROTATE_ROW||(fb[1]=[1-ua,1-Aa,1-za,1-Aa,1-za,1-Fa,1-ua,1-Fa]),b!==xa.a.FLIP_TILE&&b!==xa.a.FLIP_ROW||(fb[1]=[1-ua,Aa,1-za,Aa,1-za,Fa,1-ua,Fa]),b!==xa.a.FLIP_N_ROTATE_TILE&&b!==xa.a.FLIP_N_ROTATE_ROW||(fb[1]=[ua,1-Aa,za,1-Aa,za,1-Fa,ua,1-Fa]),ta=0;ta<w;ta++)ea.push(_-j+K,ta*c-J+N,0),ea.push(_+K,ta*c-J+N,0),ea.push(_+K,(ta+1)*c-J+N,0),ea.push(_-j+K,(ta+1)*c-J+N,0),sa.push(la,la+1,la+3,la+1,la+2,la+3),la+=4,pa=b===xa.a.FLIP_TILE||b===xa.a.ROTATE_TILE||b===xa.a.FLIP_N_ROTATE_TILE?pa.concat(fb[(ta+h)%2]):b===xa.a.FLIP_ROW||b===xa.a.ROTATE_ROW||b===xa.a.FLIP_N_ROTATE_ROW?pa.concat(fb[ta%2]):pa.concat(fb[0]),va.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),fa.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var Ma=0===e.sideOrientation?0:e.sideOrientation||Xa.a.DEFAULTSIDE;Xa.a._ComputeSides(Ma,ea,sa,fa,pa,e.frontUVs,e.backUVs);var Wa=new Xa.a();Wa.indices=sa,Wa.positions=ea,Wa.normals=fa,Wa.uvs=pa;var ab=Ma===Xa.a.DOUBLESIDE?va.concat(va):va;return Wa.colors=ab,Wa};var Hk=function(){function e(){}return e.CreateTiledPlane=function(b,a,c){void 0===c&&(c=null);var d=new xa.a(b,c);return a.sideOrientation=xa.a._GetDefaultSideOrientation(a.sideOrientation),d._originalBuilderSideOrientation=a.sideOrientation,Xa.a.CreateTiledPlane(a).applyToMesh(d,a.updatable),d},e}();xa.a.CreateTube=function(e,b,a,c,d,f,g,h,j,m){var w={path:b,radius:a,tessellation:c,radiusFunction:d,arc:1,cap:f,updatable:h,sideOrientation:j,instance:m};return dh.CreateTube(e,w,g)};var dh=function(){function e(){}return e.CreateTube=function(b,a,c){void 0===c&&(c=null);var d=a.path,f=a.instance,g=1;void 0!==a.radius?g=a.radius:f&&(g=f._creationDataStorage.radius);var h=a.tessellation||64,j=a.radiusFunction||null,m=a.cap||xa.a.NO_CAP,w=a.invertUV||!1,z=a.updatable,C=xa.a._GetDefaultSideOrientation(a.sideOrientation);a.arc=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1;var J,K,N=function(ca,ea,fa,ka,pa,va,sa,la){for(var ta,Da,ua,Aa,za=ea.getTangents(),Fa=ea.getNormals(),La=ea.getDistances(),Ta=2*Math.PI/pa*la,bb=va||function(){return ka},Ra=i.c.Matrix[0],Oa=sa===xa.a.NO_CAP||sa===xa.a.CAP_END?0:2,Za=0;Za<ca.length;Za++){Da=bb(Za,La[Za]),ta=Array(),ua=Fa[Za];for(var Va=0;Va<pa;Va++)i.a.RotationAxisToRef(za[Za],Ta*Va,Ra),Aa=ta[Va]?ta[Va]:i.e.Zero(),i.e.TransformCoordinatesToRef(ua,Ra,Aa),Aa.scaleInPlace(Da).addInPlace(ca[Za]),ta[Va]=Aa;fa[Oa]=ta,Oa++}var $a=function(fb,Ma){for(var Wa=Array(),ab=0;ab<fb;ab++)Wa.push(ca[Ma]);return Wa};switch(sa){case xa.a.NO_CAP:break;case xa.a.CAP_START:fa[0]=$a(pa,0),fa[1]=fa[2].slice(0);break;case xa.a.CAP_END:fa[Oa]=fa[Oa-1].slice(0),fa[Oa+1]=$a(pa,ca.length-1);break;case xa.a.CAP_ALL:fa[0]=$a(pa,0),fa[1]=fa[2].slice(0),fa[Oa]=fa[Oa-1].slice(0),fa[Oa+1]=$a(pa,ca.length-1)}return fa};if(f){var T=f._creationDataStorage,Z=a.arc||T.arc;return K=N(d,J=T.path3D.update(d),T.pathArray,g,T.tessellation,j,T.cap,Z),f=rd.CreateRibbon("",{pathArray:K,instance:f}),T.path3D=J,T.pathArray=K,T.arc=Z,T.radius=g,f}K=N(d,J=new tc(d),new Array(),g,h,j,m=m<0||m>3?0:m,a.arc);var _=rd.CreateRibbon(b,{pathArray:K,closePath:!0,closeArray:!1,updatable:z,sideOrientation:C,invertUV:w,frontUVs:a.frontUVs,backUVs:a.backUVs},c);return _._creationDataStorage.pathArray=K,_._creationDataStorage.path3D=J,_._creationDataStorage.tessellation=h,_._creationDataStorage.cap=m,_._creationDataStorage.arc=a.arc,_._creationDataStorage.radius=g,_},e}();Xa.a.CreateIcoSphere=function(e){var b,a=e.sideOrientation||Xa.a.DEFAULTSIDE,c=e.radius||1,d=void 0===e.flat||e.flat,f=e.subdivisions||4,g=e.radiusX||c,h=e.radiusY||c,j=e.radiusZ||c,m=(1+Math.sqrt(5))/2,w=[-1,m,-0,1,m,0,-1,-m,0,1,-m,0,0,-1,-m,0,1,-m,0,-1,m,0,1,m,m,0,1,m,0,-1,-m,0,1,-m,0,-1],z=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],C=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],J=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],K=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],N=new Array(),T=new Array(),Z=new Array(),_=new Array(),ca=0,ea=new Array(3),fa=new Array(3);for(b=0;b<3;b++)ea[b]=i.e.Zero(),fa[b]=i.d.Zero();for(var ka=0;ka<20;ka++){for(b=0;b<3;b++){var pa=z[3*ka+b];ea[b].copyFromFloats(w[3*C[pa]],w[3*C[pa]+1],w[3*C[pa]+2]),ea[b].normalize().scaleInPlace(c),fa[b].copyFromFloats(J[2*pa]*(138/1024)+60/1024+K[ka]*(-40/1024),J[2*pa+1]*(239/1024)+26/1024+K[ka]*(20/1024))}for(var va=function(Da,ua,Aa,za){var Fa,La=i.e.Lerp(ea[0],ea[2],ua/f),Ta=i.e.Lerp(ea[1],ea[2],ua/f),bb=f===ua?ea[2]:i.e.Lerp(La,Ta,Da/(f-ua));if(bb.normalize(),d){var Ra=i.e.Lerp(ea[0],ea[2],za/f),Oa=i.e.Lerp(ea[1],ea[2],za/f);Fa=i.e.Lerp(Ra,Oa,Aa/(f-za))}else Fa=new i.e(bb.x,bb.y,bb.z);Fa.x/=g,Fa.y/=h,Fa.z/=j,Fa.normalize();var Za=i.d.Lerp(fa[0],fa[2],ua/f),Va=i.d.Lerp(fa[1],fa[2],ua/f),$a=f===ua?fa[2]:i.d.Lerp(Za,Va,Da/(f-ua));T.push(bb.x*g,bb.y*h,bb.z*j),Z.push(Fa.x,Fa.y,Fa.z),_.push($a.x,$a.y),N.push(ca),ca++},sa=0;sa<f;sa++)for(var la=0;la+sa<f;la++)va(la,sa,la+1/3,sa+1/3),va(la+1,sa,la+1/3,sa+1/3),va(la,sa+1,la+1/3,sa+1/3),la+sa+1<f&&(va(la+1,sa,la+2/3,sa+2/3),va(la+1,sa+1,la+2/3,sa+2/3),va(la,sa+1,la+2/3,sa+2/3))}Xa.a._ComputeSides(a,T,N,Z,_,e.frontUVs,e.backUVs);var ta=new Xa.a();return ta.indices=N,ta.positions=T,ta.normals=Z,ta.uvs=_,ta},xa.a.CreateIcoSphere=function(e,b,a){return eh.CreateIcoSphere(e,b,a)};var eh=function(){function e(){}return e.CreateIcoSphere=function(b,a,c){void 0===c&&(c=null);var d=new xa.a(b,c);return a.sideOrientation=xa.a._GetDefaultSideOrientation(a.sideOrientation),d._originalBuilderSideOrientation=a.sideOrientation,Xa.a.CreateIcoSphere(a).applyToMesh(d,a.updatable),d},e}();xa.a.CreateDecal=function(e,b,a,c,d,f){var g={position:a,normal:c,size:d,angle:f};return fh.CreateDecal(e,b,g)};var Ke,fh=function(){function e(){}return e.CreateDecal=function(b,a,c){var d=a.getIndices(),f=a.getVerticesData(ra.b.PositionKind),g=a.getVerticesData(ra.b.NormalKind),h=c.position||i.e.Zero(),j=c.normal||i.e.Up(),m=c.size||i.e.One(),w=c.angle||0;if(!j){var z=new i.e(0,0,1),C=a.getScene().activeCamera,J=i.e.TransformCoordinates(z,C.getWorldMatrix());j=C.globalPosition.subtract(J)}var K=-Math.atan2(j.z,j.x)-Math.PI/2,N=Math.sqrt(j.x*j.x+j.z*j.z),T=Math.atan2(j.y,N),Z=i.a.RotationYawPitchRoll(K,T,w).multiply(i.a.Translation(h.x,h.y,h.z)),_=i.a.Invert(Z),ca=a.getWorldMatrix().multiply(_),ea=new Xa.a();ea.indices=[],ea.positions=[],ea.normals=[],ea.uvs=[];for(var fa=0,ka=function(ua){var Aa=new Ig();if(!d||!f||!g)return Aa;var za=d[ua];return Aa.position=new i.e(f[3*za],f[3*za+1],f[3*za+2]),Aa.position=i.e.TransformCoordinates(Aa.position,ca),Aa.normal=new i.e(g[3*za],g[3*za+1],g[3*za+2]),Aa.normal=i.e.TransformNormal(Aa.normal,ca),Aa},pa=function(ua,Aa){if(0===ua.length)return ua;for(var za=.5*Math.abs(i.e.Dot(m,Aa)),Fa=function(Ma,Wa){var ab=i.e.GetClipFactor(Ma.position,Wa.position,Aa,za);return new Ig(i.e.Lerp(Ma.position,Wa.position,ab),i.e.Lerp(Ma.normal,Wa.normal,ab))},La=new Array(),Ta=0;Ta<ua.length;Ta+=3){var bb,Ra,Oa,Za=null,Va=null,$a=null,fb=null;switch(((bb=i.e.Dot(ua[Ta].position,Aa)-za>0)?1:0)+((Ra=i.e.Dot(ua[Ta+1].position,Aa)-za>0)?1:0)+((Oa=i.e.Dot(ua[Ta+2].position,Aa)-za>0)?1:0)){case 0:La.push(ua[Ta]),La.push(ua[Ta+1]),La.push(ua[Ta+2]);break;case 1:if(bb&&(Za=ua[Ta+1],Va=ua[Ta+2],$a=Fa(ua[Ta],Za),fb=Fa(ua[Ta],Va)),Ra){Za=ua[Ta],Va=ua[Ta+2],$a=Fa(ua[Ta+1],Za),fb=Fa(ua[Ta+1],Va),La.push($a),La.push(Va.clone()),La.push(Za.clone()),La.push(Va.clone()),La.push($a.clone()),La.push(fb);break}Oa&&(Za=ua[Ta],Va=ua[Ta+1],$a=Fa(ua[Ta+2],Za),fb=Fa(ua[Ta+2],Va)),Za&&Va&&$a&&fb&&(La.push(Za.clone()),La.push(Va.clone()),La.push($a),La.push(fb),La.push($a.clone()),La.push(Va.clone()));break;case 2:bb||(Va=Fa(Za=ua[Ta].clone(),ua[Ta+1]),$a=Fa(Za,ua[Ta+2]),La.push(Za),La.push(Va),La.push($a)),Ra||(Va=Fa(Za=ua[Ta+1].clone(),ua[Ta+2]),$a=Fa(Za,ua[Ta]),La.push(Za),La.push(Va),La.push($a)),Oa||(Va=Fa(Za=ua[Ta+2].clone(),ua[Ta]),$a=Fa(Za,ua[Ta+1]),La.push(Za),La.push(Va),La.push($a))}}return La},va=0;va<d.length;va+=3){var sa=new Array();if(sa.push(ka(va)),sa.push(ka(va+1)),sa.push(ka(va+2)),sa=pa(sa,new i.e(1,0,0)),sa=pa(sa,new i.e(-1,0,0)),sa=pa(sa,new i.e(0,1,0)),sa=pa(sa,new i.e(0,-1,0)),sa=pa(sa,new i.e(0,0,1)),0!==(sa=pa(sa,new i.e(0,0,-1))).length)for(var la=0;la<sa.length;la++){var ta=sa[la];ea.indices.push(fa),ta.position.toArray(ea.positions,3*fa),ta.normal.toArray(ea.normals,3*fa),ea.uvs.push(.5+ta.position.x/m.x),ea.uvs.push(.5+ta.position.y/m.y),fa++}}var Da=new xa.a(b,a.getScene());return ea.applyToMesh(Da),Da.position=h.clone(),Da.rotation=new i.e(T,K,w),Da},e}(),Vn=function(){function e(){}return e.CreateBox=function(b,a,c){return void 0===c&&(c=null),ue.a.CreateBox(b,a,c)},e.CreateTiledBox=function(b,a,c){return void 0===c&&(c=null),Fk.CreateTiledBox(b,a,c)},e.CreateSphere=function(b,a,c){return void 0===c&&(c=null),jc.a.CreateSphere(b,a,c)},e.CreateDisc=function(b,a,c){return void 0===c&&(c=null),Af.CreateDisc(b,a,c)},e.CreateIcoSphere=function(b,a,c){return void 0===c&&(c=null),eh.CreateIcoSphere(b,a,c)},e.CreateRibbon=function(b,a,c){return void 0===c&&(c=null),rd.CreateRibbon(b,a,c)},e.CreateCylinder=function(b,a,c){return void 0===c&&(c=null),md.a.CreateCylinder(b,a,c)},e.CreateTorus=function(b,a,c){return void 0===c&&(c=null),Jd.CreateTorus(b,a,c)},e.CreateTorusKnot=function(b,a,c){return void 0===c&&(c=null),ah.CreateTorusKnot(b,a,c)},e.CreateLineSystem=function(b,a,c){return Wb.a.CreateLineSystem(b,a,c)},e.CreateLines=function(b,a,c){return void 0===c&&(c=null),Wb.a.CreateLines(b,a,c)},e.CreateDashedLines=function(b,a,c){return void 0===c&&(c=null),Wb.a.CreateDashedLines(b,a,c)},e.ExtrudeShape=function(b,a,c){return void 0===c&&(c=null),Vd.ExtrudeShape(b,a,c)},e.ExtrudeShapeCustom=function(b,a,c){return void 0===c&&(c=null),Vd.ExtrudeShapeCustom(b,a,c)},e.CreateLathe=function(b,a,c){return void 0===c&&(c=null),ch.CreateLathe(b,a,c)},e.CreateTiledPlane=function(b,a,c){return void 0===c&&(c=null),Hk.CreateTiledPlane(b,a,c)},e.CreatePlane=function(b,a,c){return void 0===c&&(c=null),zg.a.CreatePlane(b,a,c)},e.CreateGround=function(b,a,c){return void 0===c&&(c=null),Yc.CreateGround(b,a,c)},e.CreateTiledGround=function(b,a,c){return void 0===c&&(c=null),Yc.CreateTiledGround(b,a,c)},e.CreateGroundFromHeightMap=function(b,a,c,d){return void 0===d&&(d=null),Yc.CreateGroundFromHeightMap(b,a,c,d)},e.CreatePolygon=function(b,a,c,d){return void 0===c&&(c=null),void 0===d&&(d=earcut),Je.CreatePolygon(b,a,c,d)},e.ExtrudePolygon=function(b,a,c,d){return void 0===c&&(c=null),void 0===d&&(d=earcut),Je.ExtrudePolygon(b,a,c,d)},e.CreateTube=function(b,a,c){return void 0===c&&(c=null),dh.CreateTube(b,a,c)},e.CreatePolyhedron=function(b,a,c){return void 0===c&&(c=null),we.CreatePolyhedron(b,a,c)},e.CreateDecal=function(b,a,c){return fh.CreateDecal(b,a,c)},e}(),Wn=function(e,b,a){this.quality=e,this.distance=b,this.optimizeMesh=a},Ik=function(){function e(){this.running=!1,this._simplificationArray=[]}return e.prototype.addTask=function(b){this._simplificationArray.push(b)},e.prototype.executeNext=function(){var b=this._simplificationArray.pop();b?(this.running=!0,this.runSimplification(b)):this.running=!1},e.prototype.runSimplification=function(b){var a=this;if(b.parallelProcessing)b.settings.forEach(function(d){a.getSimplifier(b).simplify(d,function(f){b.mesh.addLODLevel(d.distance,f),f.isVisible=!0,d.quality===b.settings[b.settings.length-1].quality&&b.successCallback&&b.successCallback(),a.executeNext()})});else{var c=this.getSimplifier(b);Qa.a.Run(b.settings.length,function(d){var f,g;f=b.settings[d.index],g=function(){d.executeNext()},c.simplify(f,function(h){b.mesh.addLODLevel(f.distance,h),h.isVisible=!0,g()})},function(){b.successCallback&&b.successCallback(),a.executeNext()})}},e.prototype.getSimplifier=function(b){switch(b.simplificationType){case Ke.QUADRATIC:default:return new _n(b.mesh)}},e}();!function(e){e[e.QUADRATIC=0]="QUADRATIC"}(Ke||(Ke={}));var Xn=function(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0},Yn=function(){function e(b,a){this.position=b,this.id=a,this.isBorder=!0,this.q=new Jk(),this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(b){this.position.copyFrom(b)},e}(),Jk=function(){function e(b){this.data=new Array(10);for(var a=0;a<10;++a)b&&b[a]?this.data[a]=b[a]:this.data[a]=0}return e.prototype.det=function(b,a,c,d,f,g,h,j,m){return this.data[b]*this.data[f]*this.data[m]+this.data[c]*this.data[d]*this.data[j]+this.data[a]*this.data[g]*this.data[h]-this.data[c]*this.data[f]*this.data[h]-this.data[b]*this.data[g]*this.data[j]-this.data[a]*this.data[d]*this.data[m]},e.prototype.addInPlace=function(b){for(var a=0;a<10;++a)this.data[a]+=b.data[a]},e.prototype.addArrayInPlace=function(b){for(var a=0;a<10;++a)this.data[a]+=b[a]},e.prototype.add=function(b){for(var a=new e(),c=0;c<10;++c)a.data[c]=this.data[c]+b.data[c];return a},e.FromData=function(b,a,c,d){return new e(e.DataFromNumbers(b,a,c,d))},e.DataFromNumbers=function(b,a,c,d){return[b*b,b*a,b*c,b*d,a*a,a*c,a*d,c*c,c*d,d*d]},e}(),Zn=function(e,b){this.vertexId=e,this.triangleId=b},_n=function(){function e(b){this._mesh=b,this.syncIterations=5000,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=kb.a}return e.prototype.simplify=function(b,a){var c=this;this.initDecimatedMesh(),Qa.a.Run(this._mesh.subMeshes.length,function(d){c.initWithMesh(d.index,function(){c.runDecimation(b,d.index,function(){d.executeNext()})},b.optimizeMesh)},function(){setTimeout(function(){a(c._reconstructedMesh)},0)})},e.prototype.runDecimation=function(b,a,c){var d=this,f=~~(this.triangles.length*b.quality),g=0,h=this.triangles.length;Qa.a.Run(this.decimationIterations,function(j){var m,w;h-g<=f?j.breakLoop():(m=j.index,w=function(){j.executeNext()},setTimeout(function(){m%5==0&&d.updateMesh(0===m);for(var z=0;z<d.triangles.length;++z)d.triangles[z].isDirty=!1;var C=1e-09*Math.pow(m+3,d.aggressiveness);Qa.a.SyncAsyncForLoop(d.triangles.length,d.syncIterations,function(J){var K=~~((d.triangles.length/2+J)%d.triangles.length),N=d.triangles[K];if(N&&!(N.error[3]>C||N.deleted||N.isDirty)){for(var T=0;T<3;++T)if(N.error[T]<C){var Z=[],_=[],ca=N.vertices[T],ea=N.vertices[(T+1)%3];if(ca.isBorder||ea.isBorder)continue;var fa=i.e.Zero();d.calculateError(ca,ea,fa);var ka=new Array();if(d.isFlipped(ca,ea,fa,Z,ka))continue;if(d.isFlipped(ea,ca,fa,_,ka))continue;if(Z.indexOf(!0)<0||_.indexOf(!0)<0)continue;var pa=new Array();if(ka.forEach(function(ta){-1===pa.indexOf(ta)&&(ta.deletePending=!0,pa.push(ta))}),pa.length%2!=0)continue;ca.q=ea.q.add(ca.q),ca.updatePosition(fa);var va=d.references.length;g=d.updateTriangles(ca,ca,Z,g),g=d.updateTriangles(ca,ea,_,g);var sa=d.references.length-va;if(sa<=ca.triangleCount){if(sa)for(var la=0;la<sa;la++)d.references[ca.triangleStart+la]=d.references[va+la]}else ca.triangleStart=va;ca.triangleCount=sa;break}}},w,function(){return h-g<=f})},0))},function(){setTimeout(function(){d.reconstructMesh(a),c()},0)})},e.prototype.initWithMesh=function(b,a,c){var d=this;this.vertices=[],this.triangles=[];var f=this._mesh.getVerticesData(ra.b.PositionKind),g=this._mesh.getIndices(),h=this._mesh.subMeshes[b],j=[],m=h.verticesCount;Qa.a.SyncAsyncForLoop(m,this.syncIterations/4>>0,function(w){if(f){var z=w+h.verticesStart,C=i.e.FromArray(f,3*z),J=function(K){if(c){for(var N=0;N<d.vertices.length;++N)if(d.vertices[N].position.equals(K))return d.vertices[N]}return null}(C)||new Yn(C,d.vertices.length);J.originalOffsets.push(z),J.id===d.vertices.length&&d.vertices.push(J),j.push(J.id)}},function(){Qa.a.SyncAsyncForLoop(h.indexCount/3,d.syncIterations,function(w){if(g){var z=3*(h.indexStart/3+w),C=g[z+0],J=g[z+1],K=g[z+2],N=d.vertices[j[C-h.verticesStart]],T=d.vertices[j[J-h.verticesStart]],Z=d.vertices[j[K-h.verticesStart]],_=new Xn([N,T,Z]);_.originalOffset=z,d.triangles.push(_)}},function(){d.init(a)})})},e.prototype.init=function(b){var a=this;Qa.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(c){var d=a.triangles[c];d.normal=i.e.Cross(d.vertices[1].position.subtract(d.vertices[0].position),d.vertices[2].position.subtract(d.vertices[0].position)).normalize();for(var f=0;f<3;f++)d.vertices[f].q.addArrayInPlace(Jk.DataFromNumbers(d.normal.x,d.normal.y,d.normal.z,-i.e.Dot(d.normal,d.vertices[0].position)))},function(){Qa.a.SyncAsyncForLoop(a.triangles.length,a.syncIterations,function(c){for(var d=a.triangles[c],f=0;f<3;++f)d.error[f]=a.calculateError(d.vertices[f],d.vertices[(f+1)%3]);d.error[3]=Math.min(d.error[0],d.error[1],d.error[2])},function(){b()})})},e.prototype.reconstructMesh=function(b){var a,c,d,f=[];for(a=0;a<this.vertices.length;++a)this.vertices[a].triangleCount=0;for(a=0;a<this.triangles.length;++a)if(!this.triangles[a].deleted){for(c=this.triangles[a],d=0;d<3;++d)c.vertices[d].triangleCount=1;f.push(c)}var g=this._reconstructedMesh.getVerticesData(ra.b.PositionKind)||[],h=this._reconstructedMesh.getVerticesData(ra.b.NormalKind)||[],j=this._reconstructedMesh.getVerticesData(ra.b.UVKind)||[],m=this._reconstructedMesh.getVerticesData(ra.b.ColorKind)||[],w=this._mesh.getVerticesData(ra.b.NormalKind),z=this._mesh.getVerticesData(ra.b.UVKind),C=this._mesh.getVerticesData(ra.b.ColorKind),J=0;for(a=0;a<this.vertices.length;++a){var K=this.vertices[a];K.id=J,K.triangleCount&&K.originalOffsets.forEach(function(fa){w&&(g.push(K.position.x),g.push(K.position.y),g.push(K.position.z),h.push(w[3*fa]),h.push(w[3*fa+1]),h.push(w[3*fa+2]),z&&z.length&&(j.push(z[2*fa]),j.push(z[2*fa+1])),C&&C.length&&(m.push(C[4*fa]),m.push(C[4*fa+1]),m.push(C[4*fa+2]),m.push(C[4*fa+3])),++J)})}var N=this._reconstructedMesh.getTotalIndices(),T=this._reconstructedMesh.getTotalVertices(),Z=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var _=this._reconstructedMesh.getIndices(),ca=this._mesh.getIndices();for(a=0;a<f.length;++a)c=f[a],[0,1,2].forEach(function(fa){var ka=ca[c.originalOffset+fa],pa=c.vertices[fa].originalOffsets.indexOf(ka);pa<0&&(pa=0),_.push(c.vertices[fa].id+pa+T)});this._reconstructedMesh.setIndices(_),this._reconstructedMesh.setVerticesData(ra.b.PositionKind,g),this._reconstructedMesh.setVerticesData(ra.b.NormalKind,h),j.length>0&&this._reconstructedMesh.setVerticesData(ra.b.UVKind,j),m.length>0&&this._reconstructedMesh.setVerticesData(ra.b.ColorKind,m);var ea=this._mesh.subMeshes[b];b>0&&(this._reconstructedMesh.subMeshes=[],Z.forEach(function(fa){Yd.b.AddToMesh(fa.materialIndex,fa.verticesStart,fa.verticesCount,fa.indexStart,fa.indexCount,fa.getMesh())}),Yd.b.AddToMesh(ea.materialIndex,T,J,N,3*f.length,this._reconstructedMesh))},e.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new xa.a(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},e.prototype.isFlipped=function(b,a,c,d,f){for(var g=0;g<b.triangleCount;++g){var h=this.triangles[this.references[b.triangleStart+g].triangleId];if(!h.deleted){var j=this.references[b.triangleStart+g].vertexId,m=h.vertices[(j+1)%3],w=h.vertices[(j+2)%3];if(m!==a&&w!==a){var z=m.position.subtract(c);z=z.normalize();var C=w.position.subtract(c);if(C=C.normalize(),Math.abs(i.e.Dot(z,C))>.999)return!0;var J=i.e.Cross(z,C).normalize();if(d[g]=!1,i.e.Dot(J,h.normal)<.2)return!0}else d[g]=!0,f.push(h)}}return!1},e.prototype.updateTriangles=function(b,a,c,d){for(var f=d,g=0;g<a.triangleCount;++g){var h=this.references[a.triangleStart+g],j=this.triangles[h.triangleId];j.deleted||(c[g]&&j.deletePending?(j.deleted=!0,f++):(j.vertices[h.vertexId]=b,j.isDirty=!0,j.error[0]=this.calculateError(j.vertices[0],j.vertices[1])+j.borderFactor/2,j.error[1]=this.calculateError(j.vertices[1],j.vertices[2])+j.borderFactor/2,j.error[2]=this.calculateError(j.vertices[2],j.vertices[0])+j.borderFactor/2,j.error[3]=Math.min(j.error[0],j.error[1],j.error[2]),this.references.push(h)))}return f},e.prototype.identifyBorder=function(){for(var b=0;b<this.vertices.length;++b){var a,c=[],d=[],f=this.vertices[b];for(a=0;a<f.triangleCount;++a)for(var g=this.triangles[this.references[f.triangleStart+a].triangleId],h=0;h<3;h++){for(var j=0,m=g.vertices[h];j<c.length&&d[j]!==m.id;)++j;j===c.length?(c.push(1),d.push(m.id)):c[j]++}for(a=0;a<c.length;++a)1===c[a]?this.vertices[d[a]].isBorder=!0:this.vertices[d[a]].isBorder=!1}},e.prototype.updateMesh=function(b){var a,c,d,f;if(void 0===b&&(b=!1),!b){var g=[];for(a=0;a<this.triangles.length;++a)this.triangles[a].deleted||g.push(this.triangles[a]);this.triangles=g}for(a=0;a<this.vertices.length;++a)this.vertices[a].triangleCount=0,this.vertices[a].triangleStart=0;for(a=0;a<this.triangles.length;++a)for(c=this.triangles[a],d=0;d<3;++d)(f=c.vertices[d]).triangleCount++;var h=0;for(a=0;a<this.vertices.length;++a)this.vertices[a].triangleStart=h,h+=this.vertices[a].triangleCount,this.vertices[a].triangleCount=0;var j=new Array(3*this.triangles.length);for(a=0;a<this.triangles.length;++a)for(c=this.triangles[a],d=0;d<3;++d)j[(f=c.vertices[d]).triangleStart+f.triangleCount]=new Zn(d,a),f.triangleCount++;this.references=j,b&&this.identifyBorder()},e.prototype.vertexError=function(b,a){var c=a.x,d=a.y,f=a.z;return b.data[0]*c*c+2*b.data[1]*c*d+2*b.data[2]*c*f+2*b.data[3]*c+b.data[4]*d*d+2*b.data[5]*d*f+2*b.data[6]*d+b.data[7]*f*f+2*b.data[8]*f+b.data[9]},e.prototype.calculateError=function(b,a,c){var d=b.q.add(a.q),f=b.isBorder&&a.isBorder,g=0,h=d.det(0,1,2,1,4,5,2,5,7);if(0===h||f){var j=b.position.add(a.position).divide(new i.e(2,2,2)),m=this.vertexError(d,b.position),w=this.vertexError(d,a.position),z=this.vertexError(d,j);(g=Math.min(m,w,z))===m?c&&c.copyFrom(b.position):g===w?c&&c.copyFrom(a.position):c&&c.copyFrom(j)}else c||(c=i.e.Zero()),c.x=-1/h*d.det(1,2,3,4,5,6,5,7,8),c.y=1/h*d.det(0,2,3,1,5,6,2,7,8),c.z=-1/h*d.det(0,1,3,1,4,6,2,5,8),g=this.vertexError(d,c);return g},e}();Object.defineProperty(wa.a.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new Ik();var e=this._getComponent(_a.a.NAME_SIMPLIFICATIONQUEUE);e||(e=new Kk(this),this._addComponent(e))}return this._simplificationQueue},set:function(e){this._simplificationQueue=e},enumerable:!0,configurable:!0}),xa.a.prototype.simplify=function(e,b,a,c){return void 0===b&&(b=!0),void 0===a&&(a=Ke.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:e,parallelProcessing:b,mesh:this,simplificationType:a,successCallback:c}),this};var Kk=function(){function e(b){this.name=_a.a.NAME_SIMPLIFICATIONQUEUE,this.scene=b}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(_a.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},e}(),$n=o(135),ao=o(84),bo=function(){function e(b){void 0===b&&(b=Recast),this.bjsRECAST={},this.name="RecastJSPlugin","function"==typeof b?b(this.bjsRECAST):this.bjsRECAST=b,this.isSupported()||k.a.Error("RecastJS is not available. Please make sure you included the js file.")}return e.prototype.createNavMesh=function(b,a){var c,d,f,g=new this.bjsRECAST.rcConfig();g.cs=a.cs,g.ch=a.ch,g.borderSize=0,g.tileSize=0,g.walkableSlopeAngle=a.walkableSlopeAngle,g.walkableHeight=a.walkableHeight,g.walkableClimb=a.walkableClimb,g.walkableRadius=a.walkableRadius,g.maxEdgeLen=a.maxEdgeLen,g.maxSimplificationError=a.maxSimplificationError,g.minRegionArea=a.minRegionArea,g.mergeRegionArea=a.mergeRegionArea,g.maxVertsPerPoly=a.maxVertsPerPoly,g.detailSampleDist=a.detailSampleDist,g.detailSampleMaxError=a.detailSampleMaxError,this.navMesh=new this.bjsRECAST.NavMesh();var h=[],j=[],m=0;for(c=0;c<b.length;c++)if(b[c]){var w=b[c],z=w.getIndices();if(!z)continue;var C=w.getVerticesData(ra.b.PositionKind,!1,!1);if(!C)continue;var J=w.computeWorldMatrix(!1);for(d=0;d<z.length;d++)h.push(z[d]+m);var K=i.e.Zero(),N=i.e.Zero();for(f=0;f<C.length;f+=3)i.e.FromArrayToRef(C,f,N),i.e.TransformCoordinatesToRef(N,J,K),j.push(K.x,K.y,K.z);m+=C.length/3}this.navMesh.build(j,m,h,h.length,g)},e.prototype.createDebugNavMesh=function(b){var a,c,d=this.navMesh.getDebugNavMesh(),f=d.getTriangleCount(),g=[],h=[];for(a=0;a<3*f;a++)g.push(a);for(a=0;a<f;a++)for(c=0;c<3;c++){var j=d.getTriangle(a).getPoint(c);h.push(j.x,j.y,j.z)}var m=new xa.a("NavMeshDebug",b),w=new Xa.a();return w.indices=g,w.positions=h,w.applyToMesh(m,!1),m},e.prototype.getClosestPoint=function(b){var a=new this.bjsRECAST.Vec3(b.x,b.y,b.z),c=this.navMesh.getClosestPoint(a);return new i.e(c.x,c.y,c.z)},e.prototype.getRandomPointAround=function(b,a){var c=new this.bjsRECAST.Vec3(b.x,b.y,b.z),d=this.navMesh.getRandomPointAround(c,a);return new i.e(d.x,d.y,d.z)},e.prototype.moveAlong=function(b,a){var c=new this.bjsRECAST.Vec3(b.x,b.y,b.z),d=new this.bjsRECAST.Vec3(a.x,a.y,a.z),f=this.navMesh.moveAlong(c,d);return new i.e(f.x,f.y,f.z)},e.prototype.computePath=function(b,a){var c,d=new this.bjsRECAST.Vec3(b.x,b.y,b.z),f=new this.bjsRECAST.Vec3(a.x,a.y,a.z),g=this.navMesh.computePath(d,f),h=g.getPointCount(),j=[];for(c=0;c<h;c++){var m=g.getPoint(c);j.push(new i.e(m.x,m.y,m.z))}return j},e.prototype.createCrowd=function(b,a,c){return new Lk(this,b,a,c)},e.prototype.setDefaultQueryExtent=function(b){var a=new this.bjsRECAST.Vec3(b.x,b.y,b.z);this.navMesh.setDefaultQueryExtent(a)},e.prototype.getDefaultQueryExtent=function(){var b=this.navMesh.getDefaultQueryExtent();return new i.e(b.x,b.y,b.z)},e.prototype.dispose=function(){},e.prototype.isSupported=function(){return void 0!==this.bjsRECAST},e}(),Lk=function(){function e(b,a,c,d){var f=this;this.recastCrowd={},this.transforms=new Array(),this.agents=new Array(),this._onBeforeAnimationsObserver=null,this.bjsRECASTPlugin=b,this.recastCrowd=new this.bjsRECASTPlugin.bjsRECAST.Crowd(a,c,this.bjsRECASTPlugin.navMesh.getNavMesh()),this._scene=d,this._onBeforeAnimationsObserver=d.onBeforeAnimationsObservable.add(function(){f.update(.001*d.getEngine().getDeltaTime())})}return e.prototype.addAgent=function(b,a,c){var d=new this.bjsRECASTPlugin.bjsRECAST.dtCrowdAgentParams();d.radius=a.radius,d.height=a.height,d.maxAcceleration=a.maxAcceleration,d.maxSpeed=a.maxSpeed,d.collisionQueryRange=a.collisionQueryRange,d.pathOptimizationRange=a.pathOptimizationRange,d.separationWeight=a.separationWeight,d.updateFlags=7,d.obstacleAvoidanceType=0,d.queryFilterType=0,d.userData=0;var f=this.recastCrowd.addAgent(new this.bjsRECASTPlugin.bjsRECAST.Vec3(b.x,b.y,b.z),d);return this.transforms.push(c),this.agents.push(f),f},e.prototype.getAgentPosition=function(b){var a=this.recastCrowd.getAgentPosition(b);return new i.e(a.x,a.y,a.z)},e.prototype.getAgentVelocity=function(b){var a=this.recastCrowd.getAgentVelocity(b);return new i.e(a.x,a.y,a.z)},e.prototype.agentGoto=function(b,a){this.recastCrowd.agentGoto(b,new this.bjsRECASTPlugin.bjsRECAST.Vec3(a.x,a.y,a.z))},e.prototype.agentTeleport=function(b,a){this.recastCrowd.agentTeleport(b,new this.bjsRECASTPlugin.bjsRECAST.Vec3(a.x,a.y,a.z))},e.prototype.updateAgentParameters=function(b,a){var c=this.recastCrowd.getAgentParameters(b);void 0!==a.radius&&(c.radius=a.radius),void 0!==a.height&&(c.height=a.height),void 0!==a.maxAcceleration&&(c.maxAcceleration=a.maxAcceleration),void 0!==a.maxSpeed&&(c.maxSpeed=a.maxSpeed),void 0!==a.collisionQueryRange&&(c.collisionQueryRange=a.collisionQueryRange),void 0!==a.pathOptimizationRange&&(c.pathOptimizationRange=a.pathOptimizationRange),void 0!==a.separationWeight&&(c.separationWeight=a.separationWeight),this.recastCrowd.setAgentParameters(b,c)},e.prototype.removeAgent=function(b){this.recastCrowd.removeAgent(b);var a=this.agents.indexOf(b);a>-1&&(this.agents.splice(a,1),this.transforms.splice(a,1))},e.prototype.getAgents=function(){return this.agents},e.prototype.update=function(b){this.recastCrowd.update(b);for(var a=0;a<this.agents.length;a++)this.transforms[a].position=this.getAgentPosition(this.agents[a])},e.prototype.setDefaultQueryExtent=function(b){var a=new this.bjsRECASTPlugin.bjsRECAST.Vec3(b.x,b.y,b.z);this.recastCrowd.setDefaultQueryExtent(a)},e.prototype.getDefaultQueryExtent=function(){var b=this.recastCrowd.getDefaultQueryExtent();return new i.e(b.x,b.y,b.z)},e.prototype.dispose=function(){this.recastCrowd.destroy(),this._scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null},e}();Ha.a.OfflineProviderFactory=function(e,b,a){return void 0===a&&(a=!1),new Mk(e,b,a)};var Zd,Mk=function(){function e(b,a,c){var d=this;void 0===c&&(c=!1),this._idbFactory="undefined"!=typeof window?window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB:indexedDB,this._callbackManifestChecked=a,this._currentSceneUrl=e._ReturnFullUrlLocation(b),this._db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this._manifestVersionFound=0,this._mustUpdateRessources=!1,this._hasReachedQuota=!1,e.IDBStorageEnabled?c?(this._enableSceneOffline=!0,this._enableTexturesOffline=!0,this._manifestVersionFound=1,Qa.b.SetImmediate(function(){d._callbackManifestChecked(!0)})):this._checkManifestFile():this._callbackManifestChecked(!0)}return Object.defineProperty(e.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!0,configurable:!0}),e.prototype._checkManifestFile=function(){var b=this,a=function(){b._enableSceneOffline=!1,b._enableTexturesOffline=!1,b._callbackManifestChecked(!1)},c=!1,d=this._currentSceneUrl+".manifest",f=new Xd.a();navigator.onLine&&(c=!0,d=d+(null==d.match(/\?/)?"?":"&")+Date.now()),f.open("GET",d),f.addEventListener("load",function(){if(200===f.status||e._ValidateXHRData(f,1))try{var g=JSON.parse(f.response);b._enableSceneOffline=g.enableSceneOffline,b._enableTexturesOffline=g.enableTexturesOffline&&e.IsUASupportingBlobStorage,g.version&&!isNaN(parseInt(g.version))&&(b._manifestVersionFound=g.version),b._callbackManifestChecked&&b._callbackManifestChecked(!0)}catch(h){a()}else a()},!1),f.addEventListener("error",function(){if(c){c=!1;var g=b._currentSceneUrl+".manifest";f.open("GET",g),f.send()}else a()},!1);try{f.send()}catch(g){k.a.Error("Error on XHR send request."),this._callbackManifestChecked(!1)}},e.prototype.open=function(b,a){var c=this,d=function(){c._isSupported=!1,a&&a()};if(this._idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this._db)b&&b();else{this._hasReachedQuota=!1,this._isSupported=!0;var f=this._idbFactory.open("babylonjs",1);f.onerror=function(){d()},f.onblocked=function(){k.a.Error("IDB request blocked. Please reload the page."),d()},f.onsuccess=function(){c._db=f.result,b()},f.onupgradeneeded=function(g){if(c._db=g.target.result,c._db)try{c._db.createObjectStore("scenes",{keyPath:"sceneUrl"}),c._db.createObjectStore("versions",{keyPath:"sceneUrl"}),c._db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(h){k.a.Error("Error while creating object stores. Exception: "+h.message),d()}}}else this._isSupported=!1,a&&a()},e.prototype.loadImage=function(b,a){var c=this,d=e._ReturnFullUrlLocation(b),f=function(){c._hasReachedQuota||null===c._db?a.src=b:c._saveImageIntoDBAsync(d,a)};this._mustUpdateRessources?f():this._loadImageFromDBAsync(d,a,f)},e.prototype._loadImageFromDBAsync=function(b,a,c){if(this._isSupported&&null!==this._db){var d,f=this._db.transaction(["textures"]);f.onabort=function(){a.src=b},f.oncomplete=function(){var h;if(d){var j=window.URL||window.webkitURL;h=j.createObjectURL(d.data),a.onerror=function(){k.a.Error("Error loading image from blob URL: "+h+" switching back to web url: "+b),a.src=b},a.src=h}else c()};var g=f.objectStore("textures").get(b);g.onsuccess=function(h){d=h.target.result},g.onerror=function(){k.a.Error("Error loading texture "+b+" from DB."),a.src=b}}else k.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),a.src=b},e.prototype._saveImageIntoDBAsync=function(b,a){var c=this;if(this._isSupported){var d=function(){var h;if(f){var j=window.URL||window.webkitURL;try{h=j.createObjectURL(f)}catch(m){h=j.createObjectURL(f)}}h&&(a.src=h)};if(e.IsUASupportingBlobStorage){var f,g=new Xd.a();g.open("GET",b),g.responseType="blob",g.addEventListener("load",function(){if(200===g.status&&c._db){f=g.response;var h=c._db.transaction(["textures"],"readwrite");h.onabort=function(w){try{var z=(w.srcElement||w.target).error;z&&"QuotaExceededError"===z.name&&(c._hasReachedQuota=!0)}catch(C){}d()},h.oncomplete=function(){d()};var j={textureUrl:b,data:f};try{var m=h.objectStore("textures").put(j);m.onsuccess=function(){},m.onerror=function(){d()}}catch(w){25===w.code&&(e.IsUASupportingBlobStorage=!1,c._enableTexturesOffline=!1),a.src=b}}else a.src=b},!1),g.addEventListener("error",function(){k.a.Error("Error in XHR request in BABYLON.Database."),a.src=b},!1),g.send()}else a.src=b}else k.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),a.src=b},e.prototype._checkVersionFromDB=function(b,a){var c=this;this._loadVersionFromDBAsync(b,a,function(){c._saveVersionIntoDBAsync(b,a)})},e.prototype._loadVersionFromDBAsync=function(b,a,c){var d,f=this;if(this._isSupported&&this._db)try{var g=this._db.transaction(["versions"]);g.oncomplete=function(){d?f._manifestVersionFound!==d.data?(f._mustUpdateRessources=!0,c()):a(d.data):(f._mustUpdateRessources=!0,c())},g.onabort=function(){a(-1)};var h=g.objectStore("versions").get(b);h.onsuccess=function(j){d=j.target.result},h.onerror=function(){k.a.Error("Error loading version for scene "+b+" from DB."),a(-1)}}catch(j){k.a.Error("Error while accessing 'versions' object store (READ OP). Exception: "+j.message),a(-1)}else k.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),a(-1)},e.prototype._saveVersionIntoDBAsync=function(b,a){var c=this;if(this._isSupported&&!this._hasReachedQuota&&this._db)try{var d=this._db.transaction(["versions"],"readwrite");d.onabort=function(h){try{var j=h.srcElement.error;j&&"QuotaExceededError"===j.name&&(c._hasReachedQuota=!0)}catch(m){}a(-1)},d.oncomplete=function(){a(c._manifestVersionFound)};var f={sceneUrl:b,data:this._manifestVersionFound},g=d.objectStore("versions").put(f);g.onsuccess=function(){},g.onerror=function(){k.a.Error("Error in DB add version request in BABYLON.Database.")}}catch(h){k.a.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+h.message),a(-1)}else a(-1)},e.prototype.loadFile=function(b,a,c,d,f){var g=this,h=e._ReturnFullUrlLocation(b),j=function(){g._saveFileAsync(h,a,c,f,d)};this._checkVersionFromDB(h,function(m){-1!==m?g._mustUpdateRessources?g._saveFileAsync(h,a,c,f,d):g._loadFileAsync(h,a,j):d&&d()})},e.prototype._loadFileAsync=function(b,a,c){if(this._isSupported&&this._db){var d,f;d=-1!==b.indexOf(".babylon")?"scenes":"textures";var g=this._db.transaction([d]);g.oncomplete=function(){f?a(f.data):c()},g.onabort=function(){c()};var h=g.objectStore(d).get(b);h.onsuccess=function(j){f=j.target.result},h.onerror=function(){k.a.Error("Error loading file "+b+" from DB."),c()}}else k.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),a()},e.prototype._saveFileAsync=function(b,a,c,d,f){var g=this;if(this._isSupported){var h;h=-1!==b.indexOf(".babylon")?"scenes":"textures";var j,m=new Xd.a();m.open("GET",b+"?"+Date.now()),d&&(m.responseType="arraybuffer"),c&&(m.onprogress=c),m.addEventListener("load",function(){if(200===m.status||m.status<400&&e._ValidateXHRData(m,d?6:1))if(j=d?m.response:m.responseText,!g._hasReachedQuota&&g._db){var w,z=g._db.transaction([h],"readwrite");z.onabort=function(J){try{var K=J.srcElement.error;K&&"QuotaExceededError"===K.name&&(g._hasReachedQuota=!0)}catch(N){}a(j)},z.oncomplete=function(){a(j)},w="scenes"===h?{sceneUrl:b,data:j,version:g._manifestVersionFound}:{textureUrl:b,data:j};try{var C=z.objectStore(h).put(w);C.onsuccess=function(){},C.onerror=function(){k.a.Error("Error in DB add file request in BABYLON.Database.")}}catch(J){a(j)}}else a(j);else m.status>=400&&f?f(m):a()},!1),m.addEventListener("error",function(){k.a.Error("error on XHR request."),a()},!1),m.send()}else k.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),a()},e._ValidateXHRData=function(b,a){void 0===a&&(a=7);try{if(1&a){if(b.responseText&&b.responseText.length>0)return!0;if(1===a)return!1}if(2&a){var c=wf.GetTGAHeader(b.response);if(c.width&&c.height&&c.width>0&&c.height>0)return!0;if(2===a)return!1}if(4&a){var d=new Uint8Array(b.response,0,3);return 68===d[0]&&68===d[1]&&83===d[2]}}catch(f){}return!1},e.IsUASupportingBlobStorage=!0,e.IDBStorageEnabled=!1,e._ParseURL=function(b){document.createElement("a").href=b;var a=b.substring(0,b.lastIndexOf("#")),c=b.substring(a.lastIndexOf("/")+1,b.length);return b.substring(0,b.indexOf(c,0))},e._ReturnFullUrlLocation=function(b){return-1===b.indexOf("http:/")&&-1===b.indexOf("https:/")?e._ParseURL(window.location.href)+b:b},e}(),_d=function(){function e(){this.direction1=new i.e(0,1,0),this.direction2=new i.e(0,1,0),this.minEmitBox=new i.e(-.5,-.5,-.5),this.maxEmitBox=new i.e(.5,.5,.5)}return e.prototype.startDirectionFunction=function(b,a,c,d){var f=aa.a.RandomRange(this.direction1.x,this.direction2.x),g=aa.a.RandomRange(this.direction1.y,this.direction2.y),h=aa.a.RandomRange(this.direction1.z,this.direction2.z);if(d)return a.x=f,a.y=g,void(a.z=h);i.e.TransformNormalFromFloatsToRef(f,g,h,b,a)},e.prototype.startPositionFunction=function(b,a,c,d){var f=aa.a.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),g=aa.a.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),h=aa.a.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);if(d)return a.x=f,a.y=g,void(a.z=h);i.e.TransformCoordinatesFromFloatsToRef(f,g,h,b,a)},e.prototype.clone=function(){var b=new e();return P.a.DeepCopy(this,b),b},e.prototype.applyToShader=function(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2),b.setVector3("minEmitBox",this.minEmitBox),b.setVector3("maxEmitBox",this.maxEmitBox)},e.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},e.prototype.getClassName=function(){return"BoxParticleEmitter"},e.prototype.serialize=function(){var b={};return b.type=this.getClassName(),b.direction1=this.direction1.asArray(),b.direction2=this.direction2.asArray(),b.minEmitBox=this.minEmitBox.asArray(),b.maxEmitBox=this.maxEmitBox.asArray(),b},e.prototype.parse=function(b){i.e.FromArrayToRef(b.direction1,0,this.direction1),i.e.FromArrayToRef(b.direction2,0,this.direction2),i.e.FromArrayToRef(b.minEmitBox,0,this.minEmitBox),i.e.FromArrayToRef(b.maxEmitBox,0,this.maxEmitBox)},e}(),gh=function(){function e(b,a,c){void 0===b&&(b=1),void 0===a&&(a=Math.PI),void 0===c&&(c=0),this.directionRandomizer=c,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=a,this.radius=b}return Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(b){this._radius=b,this._buildHeight()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(b){this._angle=b,this._buildHeight()},enumerable:!0,configurable:!0}),e.prototype._buildHeight=function(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1},e.prototype.startDirectionFunction=function(b,a,c,d){if(1===Math.abs(Math.cos(this._angle))){if(d)return a.x=0,a.y=1,void(a.z=0);i.e.TransformNormalFromFloatsToRef(0,1,0,b,a)}else{var f=c.position.subtract(b.getTranslation()).normalize(),g=aa.a.RandomRange(0,this.directionRandomizer),h=aa.a.RandomRange(0,this.directionRandomizer),j=aa.a.RandomRange(0,this.directionRandomizer);if(f.x+=g,f.y+=h,f.z+=j,f.normalize(),d)return void a.copyFrom(f);i.e.TransformNormalFromFloatsToRef(f.x,f.y,f.z,b,a)}},e.prototype.startPositionFunction=function(b,a,c,d){var f,g=aa.a.RandomRange(0,2*Math.PI);f=this.emitFromSpawnPointOnly?.0001:1-(f=aa.a.RandomRange(0,this.heightRange))*f;var h=this._radius-aa.a.RandomRange(0,this._radius*this.radiusRange),j=(h*=f)*Math.sin(g),m=h*Math.cos(g),w=f*this._height;if(d)return a.x=j,a.y=w,void(a.z=m);i.e.TransformCoordinatesFromFloatsToRef(j,w,m,b,a)},e.prototype.clone=function(){var b=new e(this._radius,this._angle,this.directionRandomizer);return P.a.DeepCopy(this,b),b},e.prototype.applyToShader=function(b){b.setFloat2("radius",this._radius,this.radiusRange),b.setFloat("coneAngle",this._angle),b.setFloat2("height",this._height,this.heightRange),b.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){var b="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(b+=`
#define CONEEMITTERSPAWNPOINT`),b},e.prototype.getClassName=function(){return"ConeParticleEmitter"},e.prototype.serialize=function(){var b={};return b.type=this.getClassName(),b.radius=this._radius,b.angle=this._angle,b.directionRandomizer=this.directionRandomizer,b.radiusRange=this.radiusRange,b.heightRange=this.heightRange,b.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,b},e.prototype.parse=function(b){this.radius=b.radius,this.angle=b.angle,this.directionRandomizer=b.directionRandomizer,this.radiusRange=b.radiusRange,this.heightRange=b.heightRange,this.emitFromSpawnPointOnly=b.emitFromSpawnPointOnly},e}(),Bf=function(){function e(b,a,c,d){void 0===b&&(b=1),void 0===a&&(a=1),void 0===c&&(c=1),void 0===d&&(d=0),this.radius=b,this.height=a,this.radiusRange=c,this.directionRandomizer=d}return e.prototype.startDirectionFunction=function(b,a,c,d){var f=c.position.subtract(b.getTranslation()).normalize(),g=aa.a.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),h=Math.atan2(f.x,f.z);h+=aa.a.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,f.y=g,f.x=Math.sin(h),f.z=Math.cos(h),f.normalize(),d?a.copyFrom(f):i.e.TransformNormalFromFloatsToRef(f.x,f.y,f.z,b,a)},e.prototype.startPositionFunction=function(b,a,c,d){var f=aa.a.RandomRange(-this.height/2,this.height/2),g=aa.a.RandomRange(0,2*Math.PI),h=aa.a.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),j=Math.sqrt(h)*this.radius,m=j*Math.cos(g),w=j*Math.sin(g);d?a.copyFromFloats(m,f,w):i.e.TransformCoordinatesFromFloatsToRef(m,f,w,b,a)},e.prototype.clone=function(){var b=new e(this.radius,this.directionRandomizer);return P.a.DeepCopy(this,b),b},e.prototype.applyToShader=function(b){b.setFloat("radius",this.radius),b.setFloat("height",this.height),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},e.prototype.getClassName=function(){return"CylinderParticleEmitter"},e.prototype.serialize=function(){var b={};return b.type=this.getClassName(),b.radius=this.radius,b.height=this.height,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b},e.prototype.parse=function(b){this.radius=b.radius,this.height=b.height,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer},e}(),Nk=function(e){function b(a,c,d,f,g){void 0===a&&(a=1),void 0===c&&(c=1),void 0===d&&(d=1),void 0===f&&(f=new i.e(0,1,0)),void 0===g&&(g=new i.e(0,1,0));var h=e.call(this,a,c,d)||this;return h.direction1=f,h.direction2=g,h}return Object(l.d)(b,e),b.prototype.startDirectionFunction=function(a,c,d){var f=aa.a.RandomRange(this.direction1.x,this.direction2.x),g=aa.a.RandomRange(this.direction1.y,this.direction2.y),h=aa.a.RandomRange(this.direction1.z,this.direction2.z);i.e.TransformNormalFromFloatsToRef(f,g,h,a,c)},b.prototype.clone=function(){var a=new b(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return P.a.DeepCopy(this,a),a},b.prototype.applyToShader=function(a){a.setFloat("radius",this.radius),a.setFloat("height",this.height),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)},b.prototype.getEffectDefines=function(){return`#define CYLINDEREMITTER
#define DIRECTEDCYLINDEREMITTER`},b.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.direction1=this.direction1.asArray(),a.direction2=this.direction2.asArray(),a},b.prototype.parse=function(a){e.prototype.parse.call(this,a),this.direction1.copyFrom(a.direction1),this.direction2.copyFrom(a.direction2)},b}(Bf),hh=function(){function e(b,a,c){void 0===b&&(b=1),void 0===a&&(a=1),void 0===c&&(c=0),this.radius=b,this.radiusRange=a,this.directionRandomizer=c}return e.prototype.startDirectionFunction=function(b,a,c,d){var f=c.position.subtract(b.getTranslation()).normalize(),g=aa.a.RandomRange(0,this.directionRandomizer),h=aa.a.RandomRange(0,this.directionRandomizer),j=aa.a.RandomRange(0,this.directionRandomizer);f.x+=g,f.y+=h,f.z+=j,f.normalize(),d?a.copyFrom(f):i.e.TransformNormalFromFloatsToRef(f.x,f.y,f.z,b,a)},e.prototype.startPositionFunction=function(b,a,c,d){var f=this.radius-aa.a.RandomRange(0,this.radius*this.radiusRange),g=aa.a.RandomRange(0,1),h=aa.a.RandomRange(0,2*Math.PI),j=Math.acos(2*g-1),m=f*Math.cos(h)*Math.sin(j),w=f*Math.cos(j),z=f*Math.sin(h)*Math.sin(j);d?a.copyFromFloats(m,Math.abs(w),z):i.e.TransformCoordinatesFromFloatsToRef(m,Math.abs(w),z,b,a)},e.prototype.clone=function(){var b=new e(this.radius,this.directionRandomizer);return P.a.DeepCopy(this,b),b},e.prototype.applyToShader=function(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},e.prototype.getClassName=function(){return"HemisphericParticleEmitter"},e.prototype.serialize=function(){var b={};return b.type=this.getClassName(),b.radius=this.radius,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b},e.prototype.parse=function(b){this.radius=b.radius,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer},e}(),Ok=function(){function e(){this.direction1=new i.e(0,1,0),this.direction2=new i.e(0,1,0)}return e.prototype.startDirectionFunction=function(b,a,c,d){var f=aa.a.RandomRange(this.direction1.x,this.direction2.x),g=aa.a.RandomRange(this.direction1.y,this.direction2.y),h=aa.a.RandomRange(this.direction1.z,this.direction2.z);d?a.copyFromFloats(f,g,h):i.e.TransformNormalFromFloatsToRef(f,g,h,b,a)},e.prototype.startPositionFunction=function(b,a,c,d){d?a.copyFromFloats(0,0,0):i.e.TransformCoordinatesFromFloatsToRef(0,0,0,b,a)},e.prototype.clone=function(){var b=new e();return P.a.DeepCopy(this,b),b},e.prototype.applyToShader=function(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)},e.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},e.prototype.getClassName=function(){return"PointParticleEmitter"},e.prototype.serialize=function(){var b={};return b.type=this.getClassName(),b.direction1=this.direction1.asArray(),b.direction2=this.direction2.asArray(),b},e.prototype.parse=function(b){i.e.FromArrayToRef(b.direction1,0,this.direction1),i.e.FromArrayToRef(b.direction2,0,this.direction2)},e}(),Cf=function(){function e(b,a,c){void 0===b&&(b=1),void 0===a&&(a=1),void 0===c&&(c=0),this.radius=b,this.radiusRange=a,this.directionRandomizer=c}return e.prototype.startDirectionFunction=function(b,a,c,d){var f=c.position.subtract(b.getTranslation()).normalize(),g=aa.a.RandomRange(0,this.directionRandomizer),h=aa.a.RandomRange(0,this.directionRandomizer),j=aa.a.RandomRange(0,this.directionRandomizer);f.x+=g,f.y+=h,f.z+=j,f.normalize(),d?a.copyFrom(f):i.e.TransformNormalFromFloatsToRef(f.x,f.y,f.z,b,a)},e.prototype.startPositionFunction=function(b,a,c,d){var f=this.radius-aa.a.RandomRange(0,this.radius*this.radiusRange),g=aa.a.RandomRange(0,1),h=aa.a.RandomRange(0,2*Math.PI),j=Math.acos(2*g-1),m=f*Math.cos(h)*Math.sin(j),w=f*Math.cos(j),z=f*Math.sin(h)*Math.sin(j);d?a.copyFromFloats(m,w,z):i.e.TransformCoordinatesFromFloatsToRef(m,w,z,b,a)},e.prototype.clone=function(){var b=new e(this.radius,this.directionRandomizer);return P.a.DeepCopy(this,b),b},e.prototype.applyToShader=function(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},e.prototype.getClassName=function(){return"SphereParticleEmitter"},e.prototype.serialize=function(){var b={};return b.type=this.getClassName(),b.radius=this.radius,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b},e.prototype.parse=function(b){this.radius=b.radius,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer},e}(),ih=function(e){function b(a,c,d){void 0===a&&(a=1),void 0===c&&(c=new i.e(0,1,0)),void 0===d&&(d=new i.e(0,1,0));var f=e.call(this,a)||this;return f.direction1=c,f.direction2=d,f}return Object(l.d)(b,e),b.prototype.startDirectionFunction=function(a,c,d){var f=aa.a.RandomRange(this.direction1.x,this.direction2.x),g=aa.a.RandomRange(this.direction1.y,this.direction2.y),h=aa.a.RandomRange(this.direction1.z,this.direction2.z);i.e.TransformNormalFromFloatsToRef(f,g,h,a,c)},b.prototype.clone=function(){var a=new b(this.radius,this.direction1,this.direction2);return P.a.DeepCopy(this,a),a},b.prototype.applyToShader=function(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)},b.prototype.getEffectDefines=function(){return`#define SPHEREEMITTER
#define DIRECTEDSPHEREEMITTER`},b.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},b.prototype.serialize=function(){var a=e.prototype.serialize.call(this);return a.direction1=this.direction1.asArray(),a.direction2=this.direction2.asArray(),a},b.prototype.parse=function(a){e.prototype.parse.call(this,a),this.direction1.copyFrom(a.direction1),this.direction2.copyFrom(a.direction2)},b}(Cf),$d=function(){function e(){this.particlePositionGenerator=function(){},this.particleDestinationGenerator=function(){}}return e.prototype.startDirectionFunction=function(b,a,c,d){var f=i.c.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,c,f);var g=i.c.Vector3[1];f.subtractToRef(c.position,g),g.scaleToRef(1/c.lifeTime,f)}else f.set(0,0,0);d?a.copyFrom(f):i.e.TransformNormalToRef(f,b,a)},e.prototype.startPositionFunction=function(b,a,c,d){var f=i.c.Vector3[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,c,f):f.set(0,0,0),d?a.copyFrom(f):i.e.TransformCoordinatesToRef(f,b,a)},e.prototype.clone=function(){var b=new e();return P.a.DeepCopy(this,b),b},e.prototype.applyToShader=function(b){},e.prototype.getEffectDefines=function(){return"#define CUSTOMEMITTER"},e.prototype.getClassName=function(){return"CustomParticleEmitter"},e.prototype.serialize=function(){var b={};return b.type=this.getClassName(),b},e.prototype.parse=function(b){},e}(),co=function(){function e(b){this.mesh=b,this._indices=null,this._positions=null,this._normals=null,this._storedNormal=i.e.Zero(),this.direction1=new i.e(0,1,0),this.direction2=new i.e(0,1,0),this.useMeshNormalsForDirection=!0,b&&(this._indices=b.getIndices(),this._positions=b.getVerticesData(ra.b.PositionKind),this._normals=b.getVerticesData(ra.b.NormalKind))}return e.prototype.startDirectionFunction=function(b,a,c,d){if(this.useMeshNormalsForDirection&&this._normals)i.e.TransformNormalToRef(this._storedNormal,b,a);else{var f=aa.a.RandomRange(this.direction1.x,this.direction2.x),g=aa.a.RandomRange(this.direction1.y,this.direction2.y),h=aa.a.RandomRange(this.direction1.z,this.direction2.z);d?a.copyFromFloats(f,g,h):i.e.TransformNormalFromFloatsToRef(f,g,h,b,a)}},e.prototype.startPositionFunction=function(b,a,c,d){if(this._indices&&this._positions){var f=3*Math.random()*(this._indices.length/3)|0,g=Math.random(),h=Math.random()*(1-g),j=1-g-h,m=this._indices[f],w=this._indices[f+1],z=this._indices[f+2],C=i.c.Vector3[0],J=i.c.Vector3[1],K=i.c.Vector3[2],N=i.c.Vector3[3];i.e.FromArrayToRef(this._positions,3*m,C),i.e.FromArrayToRef(this._positions,3*w,J),i.e.FromArrayToRef(this._positions,3*z,K),N.x=g*C.x+h*J.x+j*K.x,N.y=g*C.y+h*J.y+j*K.y,N.z=g*C.z+h*J.z+j*K.z,d?a.copyFromFloats(N.x,N.y,N.z):i.e.TransformCoordinatesFromFloatsToRef(N.x,N.y,N.z,b,a),this.useMeshNormalsForDirection&&this._normals&&(i.e.FromArrayToRef(this._normals,3*m,C),i.e.FromArrayToRef(this._normals,3*w,J),i.e.FromArrayToRef(this._normals,3*z,K),this._storedNormal.x=g*C.x+h*J.x+j*K.x,this._storedNormal.y=g*C.y+h*J.y+j*K.y,this._storedNormal.z=g*C.z+h*J.z+j*K.z)}},e.prototype.clone=function(){var b=new e(this.mesh);return P.a.DeepCopy(this,b),b},e.prototype.applyToShader=function(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)},e.prototype.getEffectDefines=function(){return""},e.prototype.getClassName=function(){return"MeshParticleEmitter"},e.prototype.serialize=function(){var b,a={};return a.type=this.getClassName(),a.direction1=this.direction1.asArray(),a.direction2=this.direction2.asArray(),a.meshId=null===(b=this.mesh)||void 0===b?void 0:b.id,a.useMeshNormalsForDirection=this.useMeshNormalsForDirection,a},e.prototype.parse=function(b,a){i.e.FromArrayToRef(b.direction1,0,this.direction1),i.e.FromArrayToRef(b.direction2,0,this.direction2),b.meshId&&(this.mesh=a.getLastMeshByID(b.meshId)||void 0),this.useMeshNormalsForDirection=b.useMeshNormalsForDirection},e}(),jh=function(){function e(b){this.animations=[],this.renderingGroupId=0,this.emitter=i.e.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new i.e(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new i.d(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new i.e(0,0,0),this.gravity=i.e.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new G.b(1,1,1,1),this.color2=new G.b(1,1,1,1),this.colorDead=new G.b(0,0,0,1),this.textureMask=new G.b(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=p.a.PARTICLES_BILLBOARDMODE_ALL,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Sb.b(),this.id=b,this.name=b}return Object.defineProperty(e.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(b){this._noiseTexture!==b&&(this._noiseTexture=b,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(b){this._isAnimationSheetEnabled!=b&&(this._isAnimationSheetEnabled=b,this._reset())},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},e.prototype.getDragGradients=function(){return this._dragGradients},e.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},e.prototype.getColorGradients=function(){return this._colorGradients},e.prototype.getSizeGradients=function(){return this._sizeGradients},e.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},e.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},e.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},e.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},e.prototype.getVelocityGradients=function(){return this._velocityGradients},e.prototype.getStartSizeGradients=function(){return this._startSizeGradients},e.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(e.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:i.e.Zero()},set:function(b){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:i.e.Zero()},set:function(b){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:i.e.Zero()},set:function(b){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:i.e.Zero()},set:function(b){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(b){this._isBillboardBased!==b&&(this._isBillboardBased=b,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(b){this._attachImageProcessingConfiguration(b)},enumerable:!0,configurable:!0}),e.prototype._attachImageProcessingConfiguration=function(b){b!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration=b||this._scene.imageProcessingConfiguration)},e.prototype._reset=function(){},e.prototype._removeGradientAndTexture=function(b,a,c){if(!a)return this;for(var d=0,f=0,g=a;f<g.length;f++){if(g[f].gradient===b){a.splice(d,1);break}d++}return c&&c.dispose(),this},e.prototype.createPointEmitter=function(b,a){var c=new Ok();return c.direction1=b,c.direction2=a,this.particleEmitterType=c,c},e.prototype.createHemisphericEmitter=function(b,a){void 0===b&&(b=1),void 0===a&&(a=1);var c=new hh(b,a);return this.particleEmitterType=c,c},e.prototype.createSphereEmitter=function(b,a){void 0===b&&(b=1),void 0===a&&(a=1);var c=new Cf(b,a);return this.particleEmitterType=c,c},e.prototype.createDirectedSphereEmitter=function(b,a,c){void 0===b&&(b=1),void 0===a&&(a=new i.e(0,1,0)),void 0===c&&(c=new i.e(0,1,0));var d=new ih(b,a,c);return this.particleEmitterType=d,d},e.prototype.createCylinderEmitter=function(b,a,c,d){void 0===b&&(b=1),void 0===a&&(a=1),void 0===c&&(c=1),void 0===d&&(d=0);var f=new Bf(b,a,c,d);return this.particleEmitterType=f,f},e.prototype.createDirectedCylinderEmitter=function(b,a,c,d,f){void 0===b&&(b=1),void 0===a&&(a=1),void 0===c&&(c=1),void 0===d&&(d=new i.e(0,1,0)),void 0===f&&(f=new i.e(0,1,0));var g=new Nk(b,a,c,d,f);return this.particleEmitterType=g,g},e.prototype.createConeEmitter=function(b,a){void 0===b&&(b=1),void 0===a&&(a=Math.PI/4);var c=new gh(b,a);return this.particleEmitterType=c,c},e.prototype.createBoxEmitter=function(b,a,c,d){var f=new _d();return this.particleEmitterType=f,this.direction1=b,this.direction2=a,this.minEmitBox=c,this.maxEmitBox=d,f},e.BLENDMODE_ONEONE=0,e.BLENDMODE_STANDARD=1,e.BLENDMODE_ADD=2,e.BLENDMODE_MULTIPLY=3,e.BLENDMODE_MULTIPLYADD=4,e}(),kh=function(){function e(){}return e.prototype.getColorToRef=function(b){this.color2?G.b.LerpToRef(this.color1,this.color2,Math.random(),b):b.copyFrom(this.color1)},e}(),Pk=function(){},lh=function(){function e(){}return e.prototype.getFactor=function(){return void 0===this.factor2?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()},e}(),bc=function(){function e(){}return e.GetCurrentGradient=function(b,a,c){for(var d=0;d<a.length-1;d++){var f=a[d],g=a[d+1];if(b>=f.gradient&&b<=g.gradient)return void c(f,g,(b-f.gradient)/(g.gradient-f.gradient))}var h=a.length-1;c(a[h],a[h],1)},e}(),Qk=function(){function e(b){this.particleSystem=b,this.position=i.e.Zero(),this.direction=i.e.Zero(),this.color=new G.b(0,0,0,0),this.colorStep=new G.b(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new i.d(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new G.b(0,0,0,0),this._currentColor2=new G.b(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=e._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return e.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},e.prototype.updateCellIndex=function(){var b=this.age,a=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===a?(a=1,b=this._randomCellOffset):b+=this._randomCellOffset);var c=this._initialEndSpriteCellID-this._initialStartSpriteCellID,d=aa.a.Clamp(b*a%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+d*c|0},e.prototype._inheritParticleInfoToSubEmitter=function(b){if(b.particleSystem.emitter.position){var a=b.particleSystem.emitter;a.position.copyFrom(this.position),b.inheritDirection&&a.setDirection(this.direction.normalize(),0,Math.PI/2)}else b.particleSystem.emitter.copyFrom(this.position);this.direction.scaleToRef(b.inheritedVelocityAmount/2,i.c.Vector3[0]),b.particleSystem._inheritedVelocityOffset.copyFrom(i.c.Vector3[0])},e.prototype._inheritParticleInfoToSubEmitters=function(){var b=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach(function(a){b._inheritParticleInfoToSubEmitter(a)})},e.prototype._reset=function(){this.age=0,this.id=e._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},e.prototype.copyTo=function(b){b.position.copyFrom(this.position),this._initialDirection?b._initialDirection?b._initialDirection.copyFrom(this._initialDirection):b._initialDirection=this._initialDirection.clone():b._initialDirection=null,b.direction.copyFrom(this.direction),this._localPosition&&(b._localPosition?b._localPosition.copyFrom(this._localPosition):b._localPosition=this._localPosition.clone()),b.color.copyFrom(this.color),b.colorStep.copyFrom(this.colorStep),b.lifeTime=this.lifeTime,b.age=this.age,b._randomCellOffset=this._randomCellOffset,b.size=this.size,b.scale.copyFrom(this.scale),b.angle=this.angle,b.angularSpeed=this.angularSpeed,b.particleSystem=this.particleSystem,b.cellIndex=this.cellIndex,b.id=this.id,b._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(b._currentColorGradient=this._currentColorGradient,b._currentColor1.copyFrom(this._currentColor1),b._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(b._currentSizeGradient=this._currentSizeGradient,b._currentSize1=this._currentSize1,b._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(b._currentAngularSpeedGradient=this._currentAngularSpeedGradient,b._currentAngularSpeed1=this._currentAngularSpeed1,b._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(b._currentVelocityGradient=this._currentVelocityGradient,b._currentVelocity1=this._currentVelocity1,b._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(b._currentLimitVelocityGradient=this._currentLimitVelocityGradient,b._currentLimitVelocity1=this._currentLimitVelocity1,b._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(b._currentDragGradient=this._currentDragGradient,b._currentDrag1=this._currentDrag1,b._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(b._initialStartSpriteCellID=this._initialStartSpriteCellID,b._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&b.remapData.copyFrom(this.remapData),this._randomNoiseCoordinates1&&(b._randomNoiseCoordinates1?(b._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),b._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(b._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),b._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},e._Count=0,e}();!function(e){e[e.ATTACHED=0]="ATTACHED",e[e.END=1]="END"}(Zd||(Zd={}));var Le=function(){function e(b){this.particleSystem=b,this.type=Zd.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,b.emitter&&b.emitter.dispose||(b.emitter=new qb.a("SubemitterSystemEmitter",b.getScene())),b.onDisposeObservable.add(function(){b.emitter&&b.emitter.dispose&&b.emitter.dispose()})}return e.prototype.clone=function(){var b=this.particleSystem.emitter;b?b instanceof i.e?b=b.clone():b instanceof qb.a&&((b=new xa.a("",b.getScene())).isVisible=!1):b=new i.e();var a=new e(this.particleSystem.clone("",b));return a.particleSystem.name+="Clone",a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem._disposeEmitterOnDispose=!0,a.particleSystem.disposeOnStop=!0,a},e.prototype.serialize=function(){var b={};return b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem=this.particleSystem.serialize(),b},e._ParseParticleSystem=function(b,a,c){throw Gc.a.WarnImport("ParseParticle")},e.Parse=function(b,a,c){var d=b.particleSystem,f=new e(e._ParseParticleSystem(d,a,c));return f.type=b.type,f.inheritDirection=b.inheritDirection,f.inheritedVelocityAmount=b.inheritedVelocityAmount,f.particleSystem._isSubEmitter=!0,f},e.prototype.dispose=function(){this.particleSystem.dispose()},e}(),eo=`
varying vec2 vUV;
varying vec4 vColor;
uniform vec4 textureMask;
uniform sampler2D diffuseSampler;
#include<clipPlaneFragmentDeclaration>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
uniform sampler2D rampSampler;
#endif
void main(void) {
#include<clipPlaneFragment>
vec4 textureColor=texture2D(diffuseSampler,vUV);
vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;
#ifdef RAMPGRADIENT
float alpha=baseColor.a;
float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);
vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));
baseColor.rgb*=rampColor.rgb;

float finalAlpha=baseColor.a;
baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);
#endif
#ifdef BLENDMULTIPLYMODE
float sourceAlpha=vColor.a*textureColor.a;
baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
baseColor.rgb=toLinearSpace(baseColor.rgb);
#else
#ifdef IMAGEPROCESSING
baseColor.rgb=toLinearSpace(baseColor.rgb);
baseColor=applyImageProcessing(baseColor);
#endif
#endif
gl_FragColor=baseColor;
}`;Pa.a.ShadersStore.particlesPixelShader=eo;var fo=`
attribute vec3 position;
attribute vec4 color;
attribute float angle;
attribute vec2 size;
#ifdef ANIMATESHEET
attribute float cellIndex;
#endif
#ifndef BILLBOARD
attribute vec3 direction;
#endif
#ifdef BILLBOARDSTRETCHED
attribute vec3 direction;
#endif
#ifdef RAMPGRADIENT
attribute vec4 remapData;
#endif
attribute vec2 offset;

uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
#ifdef ANIMATESHEET
uniform vec3 particlesInfos;
#endif

varying vec2 vUV;
varying vec4 vColor;
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
#endif
#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration>
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#endif
void main(void) {
vec2 cornerPos;
cornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;
#ifdef BILLBOARD

vec3 rotatedCorner;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=position-eyePosition;
yaxis.y=0.;
vec3 worldPos=rotate(normalize(yaxis),rotatedCorner);
vec3 viewPos=(view*vec4(worldPos,1.0)).xyz;
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=position-eyePosition;
vec3 worldPos=rotateAlign(toCamera,rotatedCorner);
vec3 viewPos=(view*vec4(worldPos,1.0)).xyz;
#else
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;
#endif
#ifdef RAMPGRADIENT
remapRanges=remapData;
#endif

gl_Position=projection*vec4(viewPos,1.0);
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=normalize(direction);
vec3 worldPos=rotate(yaxis,rotatedCorner);
gl_Position=projection*view*vec4(worldPos,1.0);
#endif
vColor=color;
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex/particlesInfos.z);
float columnOffset=cellIndex-rowOffset*particlesInfos.z;
vec2 uvScale=particlesInfos.xy;
vec2 uvOffset=vec2(offset.x ,1.0-offset.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=offset;
#endif

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
vec4 worldPos=invView*vec4(viewPos,1.0);
#endif
#include<clipPlaneVertex>
}`;Pa.a.ShadersStore.particlesVertexShader=fo;var Yb=function(e){function b(a,c,d,f,g,h){void 0===f&&(f=null),void 0===g&&(g=!1),void 0===h&&(h=.01);var j=e.call(this,a)||this;return j._inheritedVelocityOffset=new i.e(),j.onDisposeObservable=new I.c(),j._particles=new Array(),j._stockParticles=new Array(),j._newPartsExcess=0,j._vertexBuffers={},j._scaledColorStep=new G.b(0,0,0,0),j._colorDiff=new G.b(0,0,0,0),j._scaledDirection=i.e.Zero(),j._scaledGravity=i.e.Zero(),j._currentRenderId=-1,j._useInstancing=!1,j._started=!1,j._stopped=!1,j._actualFrame=0,j._currentEmitRate1=0,j._currentEmitRate2=0,j._currentStartSize1=0,j._currentStartSize2=0,j._rawTextureWidth=256,j._useRampGradients=!1,j._disposeEmitterOnDispose=!1,j.isLocal=!1,j.recycleParticle=function(m){var w=j._particles.pop();w!==m&&w.copyTo(m),j._stockParticles.push(w)},j._createParticle=function(){var m;if(0!==j._stockParticles.length?(m=j._stockParticles.pop())._reset():m=new Qk(j),j._subEmitters&&j._subEmitters.length>0){var w=j._subEmitters[Math.floor(Math.random()*j._subEmitters.length)];m._attachedSubEmitters=[],w.forEach(function(z){if(z.type===Zd.ATTACHED){var C=z.clone();m._attachedSubEmitters.push(C),C.particleSystem.start()}})}return m},j._emitFromParticle=function(m){if(j._subEmitters&&0!==j._subEmitters.length){var w=Math.floor(Math.random()*j._subEmitters.length);j._subEmitters[w].forEach(function(z){if(z.type===Zd.END){var C=z.clone();m._inheritParticleInfoToSubEmitter(C),C.particleSystem._rootParticleSystem=j,j.activeSubSystems.push(C.particleSystem),C.particleSystem.start()}})}},j._capacity=c,j._epsilon=h,j._isAnimationSheetEnabled=g,j._scene=d||U.a.LastCreatedScene,j._attachImageProcessingConfiguration(null),j._customEffect=f,j._scene.particleSystems.push(j),j._useInstancing=j._scene.getEngine().getCaps().instancedArrays,j._createIndexBuffer(),j._createVertexBuffers(),j.particleEmitterType=new _d(),j.updateFunction=function(m){var w=null,z=null;j.noiseTexture&&(w=j.noiseTexture.getSize(),z=j.noiseTexture.getContent());for(var C,J=function(){C=m[K];var N=j._scaledUpdateSpeed,T=C.age;if(C.age+=N,C.age>C.lifeTime){var Z=C.age-T;N=(C.lifeTime-T)*N/Z,C.age=C.lifeTime}var _=C.age/C.lifeTime;j._colorGradients&&j._colorGradients.length>0?bc.GetCurrentGradient(_,j._colorGradients,function(sa,la,ta){sa!==C._currentColorGradient&&(C._currentColor1.copyFrom(C._currentColor2),la.getColorToRef(C._currentColor2),C._currentColorGradient=sa),G.b.LerpToRef(C._currentColor1,C._currentColor2,ta,C.color)}):(C.colorStep.scaleToRef(N,j._scaledColorStep),C.color.addInPlace(j._scaledColorStep),C.color.a<0&&(C.color.a=0)),j._angularSpeedGradients&&j._angularSpeedGradients.length>0&&bc.GetCurrentGradient(_,j._angularSpeedGradients,function(sa,la,ta){sa!==C._currentAngularSpeedGradient&&(C._currentAngularSpeed1=C._currentAngularSpeed2,C._currentAngularSpeed2=la.getFactor(),C._currentAngularSpeedGradient=sa),C.angularSpeed=aa.a.Lerp(C._currentAngularSpeed1,C._currentAngularSpeed2,ta)}),C.angle+=C.angularSpeed*N;var ca=N;if(j._velocityGradients&&j._velocityGradients.length>0&&bc.GetCurrentGradient(_,j._velocityGradients,function(sa,la,ta){sa!==C._currentVelocityGradient&&(C._currentVelocity1=C._currentVelocity2,C._currentVelocity2=la.getFactor(),C._currentVelocityGradient=sa),ca*=aa.a.Lerp(C._currentVelocity1,C._currentVelocity2,ta)}),C.direction.scaleToRef(ca,j._scaledDirection),j._limitVelocityGradients&&j._limitVelocityGradients.length>0&&bc.GetCurrentGradient(_,j._limitVelocityGradients,function(sa,la,ta){sa!==C._currentLimitVelocityGradient&&(C._currentLimitVelocity1=C._currentLimitVelocity2,C._currentLimitVelocity2=la.getFactor(),C._currentLimitVelocityGradient=sa);var Da=aa.a.Lerp(C._currentLimitVelocity1,C._currentLimitVelocity2,ta);C.direction.length()>Da&&C.direction.scaleInPlace(j.limitVelocityDamping)}),j._dragGradients&&j._dragGradients.length>0&&bc.GetCurrentGradient(_,j._dragGradients,function(sa,la,ta){sa!==C._currentDragGradient&&(C._currentDrag1=C._currentDrag2,C._currentDrag2=la.getFactor(),C._currentDragGradient=sa);var Da=aa.a.Lerp(C._currentDrag1,C._currentDrag2,ta);j._scaledDirection.scaleInPlace(1-Da)}),j.isLocal?(C._localPosition.addInPlace(j._scaledDirection),i.e.TransformCoordinatesToRef(C._localPosition,j._emitterWorldMatrix,C.position)):C.position.addInPlace(j._scaledDirection),z&&w&&C._randomNoiseCoordinates1){var ea=j._fetchR(C._randomNoiseCoordinates1.x,C._randomNoiseCoordinates1.y,w.width,w.height,z),fa=j._fetchR(C._randomNoiseCoordinates1.z,C._randomNoiseCoordinates2.x,w.width,w.height,z),ka=j._fetchR(C._randomNoiseCoordinates2.y,C._randomNoiseCoordinates2.z,w.width,w.height,z),pa=i.c.Vector3[0],va=i.c.Vector3[1];pa.copyFromFloats((2*ea-1)*j.noiseStrength.x,(2*fa-1)*j.noiseStrength.y,(2*ka-1)*j.noiseStrength.z),pa.scaleToRef(N,va),C.direction.addInPlace(va)}if(j.gravity.scaleToRef(N,j._scaledGravity),C.direction.addInPlace(j._scaledGravity),j._sizeGradients&&j._sizeGradients.length>0&&bc.GetCurrentGradient(_,j._sizeGradients,function(sa,la,ta){sa!==C._currentSizeGradient&&(C._currentSize1=C._currentSize2,C._currentSize2=la.getFactor(),C._currentSizeGradient=sa),C.size=aa.a.Lerp(C._currentSize1,C._currentSize2,ta)}),j._useRampGradients&&(j._colorRemapGradients&&j._colorRemapGradients.length>0&&bc.GetCurrentGradient(_,j._colorRemapGradients,function(sa,la,ta){var Da=aa.a.Lerp(sa.factor1,la.factor1,ta),ua=aa.a.Lerp(sa.factor2,la.factor2,ta);C.remapData.x=Da,C.remapData.y=ua-Da}),j._alphaRemapGradients&&j._alphaRemapGradients.length>0&&bc.GetCurrentGradient(_,j._alphaRemapGradients,function(sa,la,ta){var Da=aa.a.Lerp(sa.factor1,la.factor1,ta),ua=aa.a.Lerp(sa.factor2,la.factor2,ta);C.remapData.z=Da,C.remapData.w=ua-Da})),j._isAnimationSheetEnabled&&C.updateCellIndex(),C._inheritParticleInfoToSubEmitters(),C.age>=C.lifeTime)return j._emitFromParticle(C),C._attachedSubEmitters&&(C._attachedSubEmitters.forEach(function(sa){sa.particleSystem.disposeOnStop=!0,sa.particleSystem.stop()}),C._attachedSubEmitters=null),j.recycleParticle(C),K--,"continue"},K=0;K<m.length;K++)J()},j}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(a){this._useRampGradients!==a&&(this._useRampGradients=a,this._resetEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"particles",{get:function(){return this._particles},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"ParticleSystem"},b.prototype._addFactorGradient=function(a,c,d,f){var g=new lh();g.gradient=c,g.factor1=d,g.factor2=f,a.push(g),a.sort(function(h,j){return h.gradient<j.gradient?-1:h.gradient>j.gradient?1:0})},b.prototype._removeFactorGradient=function(a,c){if(a)for(var d=0,f=0,g=a;f<g.length;f++){if(g[f].gradient===c){a.splice(d,1);break}d++}},b.prototype.addLifeTimeGradient=function(a,c,d){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,a,c,d),this},b.prototype.removeLifeTimeGradient=function(a){return this._removeFactorGradient(this._lifeTimeGradients,a),this},b.prototype.addSizeGradient=function(a,c,d){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,a,c,d),this},b.prototype.removeSizeGradient=function(a){return this._removeFactorGradient(this._sizeGradients,a),this},b.prototype.addColorRemapGradient=function(a,c,d){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,a,c,d),this},b.prototype.removeColorRemapGradient=function(a){return this._removeFactorGradient(this._colorRemapGradients,a),this},b.prototype.addAlphaRemapGradient=function(a,c,d){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,a,c,d),this},b.prototype.removeAlphaRemapGradient=function(a){return this._removeFactorGradient(this._alphaRemapGradients,a),this},b.prototype.addAngularSpeedGradient=function(a,c,d){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,a,c,d),this},b.prototype.removeAngularSpeedGradient=function(a){return this._removeFactorGradient(this._angularSpeedGradients,a),this},b.prototype.addVelocityGradient=function(a,c,d){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,a,c,d),this},b.prototype.removeVelocityGradient=function(a){return this._removeFactorGradient(this._velocityGradients,a),this},b.prototype.addLimitVelocityGradient=function(a,c,d){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,a,c,d),this},b.prototype.removeLimitVelocityGradient=function(a){return this._removeFactorGradient(this._limitVelocityGradients,a),this},b.prototype.addDragGradient=function(a,c,d){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,a,c,d),this},b.prototype.removeDragGradient=function(a){return this._removeFactorGradient(this._dragGradients,a),this},b.prototype.addEmitRateGradient=function(a,c,d){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,a,c,d),this},b.prototype.removeEmitRateGradient=function(a){return this._removeFactorGradient(this._emitRateGradients,a),this},b.prototype.addStartSizeGradient=function(a,c,d){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,a,c,d),this},b.prototype.removeStartSizeGradient=function(a){return this._removeFactorGradient(this._emitRateGradients,a),this},b.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture){for(var a=new Uint8Array(4*this._rawTextureWidth),c=G.c.Color3[0],d=0;d<this._rawTextureWidth;d++){var f=d/this._rawTextureWidth;bc.GetCurrentGradient(f,this._rampGradients,function(g,h,j){G.a.LerpToRef(g.color,h.color,j,c),a[4*d]=255*c.r,a[4*d+1]=255*c.g,a[4*d+2]=255*c.b,a[4*d+3]=255})}this._rampGradientsTexture=vc.CreateRGBATexture(a,this._rawTextureWidth,1,this._scene,!1,!1,ya.a.NEAREST_SAMPLINGMODE)}},b.prototype.getRampGradients=function(){return this._rampGradients},b.prototype.addRampGradient=function(a,c){this._rampGradients||(this._rampGradients=[]);var d=new Pk();return d.gradient=a,d.color=c,this._rampGradients.push(d),this._rampGradients.sort(function(f,g){return f.gradient<g.gradient?-1:f.gradient>g.gradient?1:0}),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture(),this},b.prototype.removeRampGradient=function(a){return this._removeGradientAndTexture(a,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},b.prototype.addColorGradient=function(a,c,d){this._colorGradients||(this._colorGradients=[]);var f=new kh();return f.gradient=a,f.color1=c,f.color2=d,this._colorGradients.push(f),this._colorGradients.sort(function(g,h){return g.gradient<h.gradient?-1:g.gradient>h.gradient?1:0}),this},b.prototype.removeColorGradient=function(a){if(!this._colorGradients)return this;for(var c=0,d=0,f=this._colorGradients;d<f.length;d++){if(f[d].gradient===a){this._colorGradients.splice(c,1);break}c++}return this},b.prototype._fetchR=function(a,c,d,f,g){return g[4*(((a=.5*Math.abs(a)+.5)*d%d|0)+((c=.5*Math.abs(c)+.5)*f%f|0)*d)]/255},b.prototype._reset=function(){this._resetEffect()},b.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._createVertexBuffers()},b.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==b.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var a=this._scene.getEngine();this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new ra.a(a,this._vertexData,!0,this._vertexBufferSize);var c=0,d=this._vertexBuffer.createVertexBuffer(ra.b.PositionKind,c,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[ra.b.PositionKind]=d,c+=3;var f=this._vertexBuffer.createVertexBuffer(ra.b.ColorKind,c,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[ra.b.ColorKind]=f,c+=4;var g=this._vertexBuffer.createVertexBuffer("angle",c,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=g,c+=1;var h,j=this._vertexBuffer.createVertexBuffer("size",c,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=j,c+=2,this._isAnimationSheetEnabled){var m=this._vertexBuffer.createVertexBuffer("cellIndex",c,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=m,c+=1}if(!this._isBillboardBased||this.billboardMode===b.BILLBOARDMODE_STRETCHED){var w=this._vertexBuffer.createVertexBuffer("direction",c,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=w,c+=3}if(this._useRampGradients){var z=this._vertexBuffer.createVertexBuffer("remapData",c,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=z,c+=4}if(this._useInstancing){var C=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new ra.a(a,C,!1,2),h=this._spriteBuffer.createVertexBuffer("offset",0,2)}else h=this._vertexBuffer.createVertexBuffer("offset",c,2,this._vertexBufferSize,this._useInstancing),c+=2;this._vertexBuffers.offset=h},b.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var a=[],c=0,d=0;d<this._capacity;d++)a.push(c),a.push(c+1),a.push(c+2),a.push(c),a.push(c+2),a.push(c+3),c+=4;this._indexBuffer=this._scene.getEngine().createIndexBuffer(a)}},b.prototype.getCapacity=function(){return this._capacity},b.prototype.isAlive=function(){return this._alive},b.prototype.isStarted=function(){return this._started},b.prototype._prepareSubEmitterInternalArray=function(){var a=this;this._subEmitters=new Array(),this.subEmitters&&this.subEmitters.forEach(function(c){c instanceof b?a._subEmitters.push([new Le(c)]):c instanceof Le?a._subEmitters.push([c]):c instanceof Array&&a._subEmitters.push(c)})},b.prototype.start=function(a){var c=this;if(void 0===a&&(a=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(a)setTimeout(function(){c.start(0)},a);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=new Array()),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){this.emitter instanceof qb.a&&this.emitter.computeWorldMatrix(!0);var d=this.noiseTexture;if(d&&d.onGeneratedObservable)d.onGeneratedObservable.addOnce(function(){setTimeout(function(){for(var g=0;g<c.preWarmCycles;g++)c.animate(!0),d.render()})});else for(var f=0;f<this.preWarmCycles;f++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},b.prototype.stop=function(a){void 0===a&&(a=!0),this._stopped=!0,a&&this._stopSubEmitters()},b.prototype.reset=function(){this._stockParticles=[],this._particles=[]},b.prototype._appendParticleVertex=function(a,c,d,f){var g=a*this._vertexBufferSize;if(this._vertexData[g++]=c.position.x+this.worldOffset.x,this._vertexData[g++]=c.position.y+this.worldOffset.y,this._vertexData[g++]=c.position.z+this.worldOffset.z,this._vertexData[g++]=c.color.r,this._vertexData[g++]=c.color.g,this._vertexData[g++]=c.color.b,this._vertexData[g++]=c.color.a,this._vertexData[g++]=c.angle,this._vertexData[g++]=c.scale.x*c.size,this._vertexData[g++]=c.scale.y*c.size,this._isAnimationSheetEnabled&&(this._vertexData[g++]=c.cellIndex),this._isBillboardBased)this.billboardMode===b.BILLBOARDMODE_STRETCHED&&(this._vertexData[g++]=c.direction.x,this._vertexData[g++]=c.direction.y,this._vertexData[g++]=c.direction.z);else if(c._initialDirection){var h=c._initialDirection;this.isLocal&&(i.e.TransformNormalToRef(h,this._emitterWorldMatrix,i.c.Vector3[0]),h=i.c.Vector3[0]),0===h.x&&0===h.z&&(h.x=.001),this._vertexData[g++]=h.x,this._vertexData[g++]=h.y,this._vertexData[g++]=h.z}else{var j=c.direction;this.isLocal&&(i.e.TransformNormalToRef(j,this._emitterWorldMatrix,i.c.Vector3[0]),j=i.c.Vector3[0]),0===j.x&&0===j.z&&(j.x=.001),this._vertexData[g++]=j.x,this._vertexData[g++]=j.y,this._vertexData[g++]=j.z}this._useRampGradients&&(this._vertexData[g++]=c.remapData.x,this._vertexData[g++]=c.remapData.y,this._vertexData[g++]=c.remapData.z,this._vertexData[g++]=c.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===d?d=this._epsilon:1===d&&(d=1-this._epsilon),0===f?f=this._epsilon:1===f&&(f=1-this._epsilon)),this._vertexData[g++]=d,this._vertexData[g++]=f)},b.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach(function(a){a.stop(!0)}),this.activeSubSystems=new Array())},b.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var a=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==a&&this._rootParticleSystem.activeSubSystems.splice(a,1),this._rootParticleSystem=null}},b.prototype._update=function(a){var c,d=this;if(this._alive=this._particles.length>0,this.emitter.position){var f=this.emitter;this._emitterWorldMatrix=f.getWorldMatrix()}else{var g=this.emitter;this._emitterWorldMatrix=i.a.Translation(g.x,g.y,g.z)}this.updateFunction(this._particles);for(var h,j=function(){if(m._particles.length===m._capacity)return"break";if(c=m._createParticle(),m._particles.push(c),m.targetStopDuration&&m._lifeTimeGradients&&m._lifeTimeGradients.length>0){var z=aa.a.Clamp(m._actualFrame/m.targetStopDuration);bc.GetCurrentGradient(z,m._lifeTimeGradients,function(K,N){var T=K,Z=N,_=T.getFactor(),ca=Z.getFactor(),ea=(z-T.gradient)/(Z.gradient-T.gradient);c.lifeTime=aa.a.Lerp(_,ca,ea)})}else c.lifeTime=aa.a.RandomRange(m.minLifeTime,m.maxLifeTime);var C=aa.a.RandomRange(m.minEmitPower,m.maxEmitPower);if(m.startPositionFunction?m.startPositionFunction(m._emitterWorldMatrix,c.position,c,m.isLocal):m.particleEmitterType.startPositionFunction(m._emitterWorldMatrix,c.position,c,m.isLocal),m.isLocal&&(c._localPosition?c._localPosition.copyFrom(c.position):c._localPosition=c.position.clone(),i.e.TransformCoordinatesToRef(c._localPosition,m._emitterWorldMatrix,c.position)),m.startDirectionFunction?m.startDirectionFunction(m._emitterWorldMatrix,c.direction,c,m.isLocal):m.particleEmitterType.startDirectionFunction(m._emitterWorldMatrix,c.direction,c,m.isLocal),0===C?c._initialDirection?c._initialDirection.copyFrom(c.direction):c._initialDirection=c.direction.clone():c._initialDirection=null,c.direction.scaleInPlace(C),m._sizeGradients&&0!==m._sizeGradients.length?(c._currentSizeGradient=m._sizeGradients[0],c._currentSize1=c._currentSizeGradient.getFactor(),c.size=c._currentSize1,m._sizeGradients.length>1?c._currentSize2=m._sizeGradients[1].getFactor():c._currentSize2=c._currentSize1):c.size=aa.a.RandomRange(m.minSize,m.maxSize),c.scale.copyFromFloats(aa.a.RandomRange(m.minScaleX,m.maxScaleX),aa.a.RandomRange(m.minScaleY,m.maxScaleY)),m._startSizeGradients&&m._startSizeGradients[0]&&m.targetStopDuration){var J=m._actualFrame/m.targetStopDuration;bc.GetCurrentGradient(J,m._startSizeGradients,function(K,N,T){K!==d._currentStartSizeGradient&&(d._currentStartSize1=d._currentStartSize2,d._currentStartSize2=N.getFactor(),d._currentStartSizeGradient=K);var Z=aa.a.Lerp(d._currentStartSize1,d._currentStartSize2,T);c.scale.scaleInPlace(Z)})}m._angularSpeedGradients&&0!==m._angularSpeedGradients.length?(c._currentAngularSpeedGradient=m._angularSpeedGradients[0],c.angularSpeed=c._currentAngularSpeedGradient.getFactor(),c._currentAngularSpeed1=c.angularSpeed,m._angularSpeedGradients.length>1?c._currentAngularSpeed2=m._angularSpeedGradients[1].getFactor():c._currentAngularSpeed2=c._currentAngularSpeed1):c.angularSpeed=aa.a.RandomRange(m.minAngularSpeed,m.maxAngularSpeed),c.angle=aa.a.RandomRange(m.minInitialRotation,m.maxInitialRotation),m._velocityGradients&&m._velocityGradients.length>0&&(c._currentVelocityGradient=m._velocityGradients[0],c._currentVelocity1=c._currentVelocityGradient.getFactor(),m._velocityGradients.length>1?c._currentVelocity2=m._velocityGradients[1].getFactor():c._currentVelocity2=c._currentVelocity1),m._limitVelocityGradients&&m._limitVelocityGradients.length>0&&(c._currentLimitVelocityGradient=m._limitVelocityGradients[0],c._currentLimitVelocity1=c._currentLimitVelocityGradient.getFactor(),m._limitVelocityGradients.length>1?c._currentLimitVelocity2=m._limitVelocityGradients[1].getFactor():c._currentLimitVelocity2=c._currentLimitVelocity1),m._dragGradients&&m._dragGradients.length>0&&(c._currentDragGradient=m._dragGradients[0],c._currentDrag1=c._currentDragGradient.getFactor(),m._dragGradients.length>1?c._currentDrag2=m._dragGradients[1].getFactor():c._currentDrag2=c._currentDrag1),m._colorGradients&&0!==m._colorGradients.length?(c._currentColorGradient=m._colorGradients[0],c._currentColorGradient.getColorToRef(c.color),c._currentColor1.copyFrom(c.color),m._colorGradients.length>1?m._colorGradients[1].getColorToRef(c._currentColor2):c._currentColor2.copyFrom(c.color)):(h=aa.a.RandomRange(0,1),G.b.LerpToRef(m.color1,m.color2,h,c.color),m.colorDead.subtractToRef(c.color,m._colorDiff),m._colorDiff.scaleToRef(1/c.lifeTime,c.colorStep)),m._isAnimationSheetEnabled&&(c._initialStartSpriteCellID=m.startSpriteCellID,c._initialEndSpriteCellID=m.endSpriteCellID),c.direction.addInPlace(m._inheritedVelocityOffset),m._useRampGradients&&(c.remapData=new i.f(0,1,0,1)),m.noiseTexture&&(c._randomNoiseCoordinates1?(c._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),c._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(c._randomNoiseCoordinates1=new i.e(Math.random(),Math.random(),Math.random()),c._randomNoiseCoordinates2=new i.e(Math.random(),Math.random(),Math.random()))),c._inheritParticleInfoToSubEmitters()},m=this,w=0;w<a;w++)if("break"===j())break},b._GetAttributeNamesOrOptions=function(a,c,d){void 0===a&&(a=!1),void 0===c&&(c=!1),void 0===d&&(d=!1);var f=[ra.b.PositionKind,ra.b.ColorKind,"angle","offset","size"];return a&&f.push("cellIndex"),c||f.push("direction"),d&&f.push("remapData"),f},b._GetEffectCreationOptions=function(a){void 0===a&&(a=!1);var c=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMask","translationPivot","eyePosition"];return a&&c.push("particlesInfos"),c},b.prototype._getEffect=function(a){if(this._customEffect)return this._customEffect;var c=[];if(this._scene.clipPlane&&c.push("#define CLIPPLANE"),this._scene.clipPlane2&&c.push("#define CLIPPLANE2"),this._scene.clipPlane3&&c.push("#define CLIPPLANE3"),this._scene.clipPlane4&&c.push("#define CLIPPLANE4"),this._scene.clipPlane5&&c.push("#define CLIPPLANE5"),this._scene.clipPlane6&&c.push("#define CLIPPLANE6"),this._isAnimationSheetEnabled&&c.push("#define ANIMATESHEET"),a===b.BLENDMODE_MULTIPLY&&c.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&c.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(c.push("#define BILLBOARD"),this.billboardMode){case b.BILLBOARDMODE_Y:c.push("#define BILLBOARDY");break;case b.BILLBOARDMODE_STRETCHED:c.push("#define BILLBOARDSTRETCHED");break;case b.BILLBOARDMODE_ALL:}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),c.push(this._imageProcessingConfigurationDefines.toString()));var d=c.join(`
`);if(this._cachedDefines!==d){this._cachedDefines=d;var f=b._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==b.BILLBOARDMODE_STRETCHED,this._useRampGradients),g=b._GetEffectCreationOptions(this._isAnimationSheetEnabled),h=["diffuseSampler","rampSampler"];Sb.a&&(Sb.a.PrepareUniforms(g,this._imageProcessingConfigurationDefines),Sb.a.PrepareSamplers(h,this._imageProcessingConfigurationDefines)),this._effect=this._scene.getEngine().createEffect("particles",f,g,h,d)}return this._effect},b.prototype.animate=function(a){var c=this;if(void 0===a&&(a=!1),this._started){if(!a){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var d;if(this._scaledUpdateSpeed=this.updateSpeed*(a?this.preWarmStepOffset:this._scene.getAnimationRatio()),this.manualEmitCount>-1)d=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var f=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var g=this._actualFrame/this.targetStopDuration;bc.GetCurrentGradient(g,this._emitRateGradients,function(w,z,C){w!==c._currentEmitRateGradient&&(c._currentEmitRate1=c._currentEmitRate2,c._currentEmitRate2=z.getFactor(),c._currentEmitRateGradient=w),f=aa.a.Lerp(c._currentEmitRate1,c._currentEmitRate2,C)})}d=f*this._scaledUpdateSpeed>>0,this._newPartsExcess+=f*this._scaledUpdateSpeed-d}if(this._newPartsExcess>1&&(d+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?d=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(d),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene._toBeDisposed.push(this))),!a){for(var h=0,j=0;j<this._particles.length;j++){var m=this._particles[j];this._appendParticleVertices(h,m),h+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}},b.prototype._appendParticleVertices=function(a,c){this._appendParticleVertex(a++,c,0,0),this._useInstancing||(this._appendParticleVertex(a++,c,1,0),this._appendParticleVertex(a++,c,1,1),this._appendParticleVertex(a++,c,0,1))},b.prototype.rebuild=function(){for(var a in this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild(),this._vertexBuffers)this._vertexBuffers[a]._rebuild()},b.prototype.isReady=function(){if(!(this.emitter&&this._imageProcessingConfiguration.isReady()&&this.particleTexture&&this.particleTexture.isReady()))return!1;if(this.blendMode!==b.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else{if(!this._getEffect(b.BLENDMODE_MULTIPLY).isReady())return!1;if(!this._getEffect(b.BLENDMODE_ADD).isReady())return!1}return!0},b.prototype._render=function(a){var c=this._getEffect(a),d=this._scene.getEngine();d.enableEffect(c);var f=this._scene.getViewMatrix();if(c.setTexture("diffuseSampler",this.particleTexture),c.setMatrix("view",f),c.setMatrix("projection",this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var g=this.particleTexture.getBaseSize();c.setFloat3("particlesInfos",this.spriteCellWidth/g.width,this.spriteCellHeight/g.height,g.width/this.spriteCellWidth)}if(c.setVector2("translationPivot",this.translationPivot),c.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased){var h=this._scene.activeCamera;c.setVector3("eyePosition",h.globalPosition)}if(this._rampGradientsTexture&&c.setTexture("rampSampler",this._rampGradientsTexture),this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6){var j=f.clone();j.invert(),c.setMatrix("invView",j),Ua.a.BindClipPlane(c,this._scene)}switch(d.bindBuffers(this._vertexBuffers,this._indexBuffer,c),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(c),a){case b.BLENDMODE_ADD:d.setAlphaMode(p.a.ALPHA_ADD);break;case b.BLENDMODE_ONEONE:d.setAlphaMode(p.a.ALPHA_ONEONE);break;case b.BLENDMODE_STANDARD:d.setAlphaMode(p.a.ALPHA_COMBINE);break;case b.BLENDMODE_MULTIPLY:d.setAlphaMode(p.a.ALPHA_MULTIPLY)}return this._useInstancing?d.drawArraysType(Hb.a.TriangleFanDrawMode,0,4,this._particles.length):d.drawElementsType(Hb.a.TriangleFillMode,0,6*this._particles.length),this._particles.length},b.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var a=this._scene.getEngine();a.setState(!1),this.forceDepthWrite&&a.setDepthWrite(!0);var c=0;return this.blendMode===b.BLENDMODE_MULTIPLYADD&&(c=this._render(b.BLENDMODE_MULTIPLY)+this._render(b.BLENDMODE_ADD)),c=this._render(this.blendMode),a.unbindInstanceAttributes(),a.setAlphaMode(p.a.ALPHA_DISABLE),c},b.prototype.dispose=function(a){if(void 0===a&&(a=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),a&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),a&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var c=0;c<this._subEmitters.length;c++)for(var d=0,f=this._subEmitters[c];d<f.length;d++)f[d].dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),(c=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(c,1),this._scene._activeParticleSystems.dispose(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.reset()},b.prototype.clone=function(a,c){var d=null,f=null;if(null!=this.customShader){var g=(f=this.customShader).shaderOptions.defines.length>0?f.shaderOptions.defines.join(`
`):"";d=this._scene.getEngine().createEffectForParticles(f.shaderPath.fragmentElement,f.shaderOptions.uniforms,f.shaderOptions.samplers,g)}else this._customEffect&&(d=this._customEffect);var h=new b(a,this._capacity,this._scene,d);return(h.customShader=f,P.a.DeepCopy(this,h,["particles","customShader","noiseTexture","particleTexture","onDisposeObservable"]),void 0===c&&(c=this.emitter),h.noiseTexture=this.noiseTexture,h.emitter=c,this.particleTexture)&&(this.particleTexture instanceof Bc?(h.particleTexture=this.particleTexture.clone(),h.particleTexture.getContext().drawImage(this.particleTexture.getContext().canvas,0,0),h.particleTexture.update()):h.particleTexture=new ya.a(this.particleTexture.url,this._scene)),this._colorGradients&&this._colorGradients.forEach(function(j){h.addColorGradient(j.gradient,j.color1,j.color2)}),this._dragGradients&&this._dragGradients.forEach(function(j){h.addDragGradient(j.gradient,j.factor1,j.factor2)}),this._angularSpeedGradients&&this._angularSpeedGradients.forEach(function(j){h.addAngularSpeedGradient(j.gradient,j.factor1,j.factor2)}),this._emitRateGradients&&this._emitRateGradients.forEach(function(j){h.addEmitRateGradient(j.gradient,j.factor1,j.factor2)}),this._lifeTimeGradients&&this._lifeTimeGradients.forEach(function(j){h.addLifeTimeGradient(j.gradient,j.factor1,j.factor2)}),this._limitVelocityGradients&&this._limitVelocityGradients.forEach(function(j){h.addLimitVelocityGradient(j.gradient,j.factor1,j.factor2)}),this._sizeGradients&&this._sizeGradients.forEach(function(j){h.addSizeGradient(j.gradient,j.factor1,j.factor2)}),this._startSizeGradients&&this._startSizeGradients.forEach(function(j){h.addStartSizeGradient(j.gradient,j.factor1,j.factor2)}),this._velocityGradients&&this._velocityGradients.forEach(function(j){h.addVelocityGradient(j.gradient,j.factor1,j.factor2)}),this._rampGradients&&this._rampGradients.forEach(function(j){h.addRampGradient(j.gradient,j.color)}),this._colorRemapGradients&&this._colorRemapGradients.forEach(function(j){h.addColorRemapGradient(j.gradient,j.factor1,j.factor2)}),this._alphaRemapGradients&&this._alphaRemapGradients.forEach(function(j){h.addAlphaRemapGradient(j.gradient,j.factor1,j.factor2)}),this.preventAutoStart||h.start(),h},b.prototype.serialize=function(){var a={};if(b._Serialize(a,this),a.textureMask=this.textureMask.asArray(),a.customShader=this.customShader,a.preventAutoStart=this.preventAutoStart,this.subEmitters){a.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var c=0,d=this._subEmitters;c<d.length;c++){for(var f=[],g=0,h=d[c];g<h.length;g++){var j=h[g];f.push(j.serialize())}a.subEmitters.push(f)}}return a},b._Serialize=function(a,c){if(a.name=c.name,a.id=c.id,a.capacity=c.getCapacity(),c.emitter.position){var d=c.emitter;a.emitterId=d.id}else{var f=c.emitter;a.emitter=f.asArray()}c.particleEmitterType&&(a.particleEmitterType=c.particleEmitterType.serialize()),c.particleTexture&&(a.textureName=c.particleTexture.name,a.invertY=c.particleTexture._invertY),a.isLocal=c.isLocal,F.a.AppendSerializedAnimations(c,a),a.beginAnimationOnStart=c.beginAnimationOnStart,a.beginAnimationFrom=c.beginAnimationFrom,a.beginAnimationTo=c.beginAnimationTo,a.beginAnimationLoop=c.beginAnimationLoop,a.startDelay=c.startDelay,a.renderingGroupId=c.renderingGroupId,a.isBillboardBased=c.isBillboardBased,a.billboardMode=c.billboardMode,a.minAngularSpeed=c.minAngularSpeed,a.maxAngularSpeed=c.maxAngularSpeed,a.minSize=c.minSize,a.maxSize=c.maxSize,a.minScaleX=c.minScaleX,a.maxScaleX=c.maxScaleX,a.minScaleY=c.minScaleY,a.maxScaleY=c.maxScaleY,a.minEmitPower=c.minEmitPower,a.maxEmitPower=c.maxEmitPower,a.minLifeTime=c.minLifeTime,a.maxLifeTime=c.maxLifeTime,a.emitRate=c.emitRate,a.gravity=c.gravity.asArray(),a.noiseStrength=c.noiseStrength.asArray(),a.color1=c.color1.asArray(),a.color2=c.color2.asArray(),a.colorDead=c.colorDead.asArray(),a.updateSpeed=c.updateSpeed,a.targetStopDuration=c.targetStopDuration,a.blendMode=c.blendMode,a.preWarmCycles=c.preWarmCycles,a.preWarmStepOffset=c.preWarmStepOffset,a.minInitialRotation=c.minInitialRotation,a.maxInitialRotation=c.maxInitialRotation,a.startSpriteCellID=c.startSpriteCellID,a.endSpriteCellID=c.endSpriteCellID,a.spriteCellChangeSpeed=c.spriteCellChangeSpeed,a.spriteCellWidth=c.spriteCellWidth,a.spriteCellHeight=c.spriteCellHeight,a.spriteRandomStartCell=c.spriteRandomStartCell,a.isAnimationSheetEnabled=c.isAnimationSheetEnabled;var g=c.getColorGradients();if(g){a.colorGradients=[];for(var h=0,j=g;h<j.length;h++){var m=j[h],w={gradient:m.gradient,color1:m.color1.asArray()};m.color2&&(w.color2=m.color2.asArray()),a.colorGradients.push(w)}}var z=c.getRampGradients();if(z){a.rampGradients=[];for(var C=0,J=z;C<J.length;C++){var K=J[C];w={gradient:K.gradient,color:K.color.asArray()},a.rampGradients.push(w)}a.useRampGradients=c.useRampGradients}var N=c.getColorRemapGradients();if(N){a.colorRemapGradients=[];for(var T=0,Z=N;T<Z.length;T++){var _=Z[T];w={gradient:_.gradient,factor1:_.factor1},void 0!==_.factor2&&(w.factor2=_.factor2),a.colorRemapGradients.push(w)}}var ca=c.getAlphaRemapGradients();if(ca){a.alphaRemapGradients=[];for(var ea=0,fa=ca;ea<fa.length;ea++){var ka=fa[ea];w={gradient:ka.gradient,factor1:ka.factor1},void 0!==ka.factor2&&(w.factor2=ka.factor2),a.alphaRemapGradients.push(w)}}var pa=c.getSizeGradients();if(pa){a.sizeGradients=[];for(var va=0,sa=pa;va<sa.length;va++){var la=sa[va];w={gradient:la.gradient,factor1:la.factor1},void 0!==la.factor2&&(w.factor2=la.factor2),a.sizeGradients.push(w)}}var ta=c.getAngularSpeedGradients();if(ta){a.angularSpeedGradients=[];for(var Da=0,ua=ta;Da<ua.length;Da++){var Aa=ua[Da];w={gradient:Aa.gradient,factor1:Aa.factor1},void 0!==Aa.factor2&&(w.factor2=Aa.factor2),a.angularSpeedGradients.push(w)}}var za=c.getVelocityGradients();if(za){a.velocityGradients=[];for(var Fa=0,La=za;Fa<La.length;Fa++){var Ta=La[Fa];w={gradient:Ta.gradient,factor1:Ta.factor1},void 0!==Ta.factor2&&(w.factor2=Ta.factor2),a.velocityGradients.push(w)}}var bb=c.getDragGradients();if(bb){a.dragGradients=[];for(var Ra=0,Oa=bb;Ra<Oa.length;Ra++){var Za=Oa[Ra];w={gradient:Za.gradient,factor1:Za.factor1},void 0!==Za.factor2&&(w.factor2=Za.factor2),a.dragGradients.push(w)}}var Va=c.getEmitRateGradients();if(Va){a.emitRateGradients=[];for(var $a=0,fb=Va;$a<fb.length;$a++){var Ma=fb[$a];w={gradient:Ma.gradient,factor1:Ma.factor1},void 0!==Ma.factor2&&(w.factor2=Ma.factor2),a.emitRateGradients.push(w)}}var Wa=c.getStartSizeGradients();if(Wa){a.startSizeGradients=[];for(var ab=0,vb=Wa;ab<vb.length;ab++){var rb=vb[ab];w={gradient:rb.gradient,factor1:rb.factor1},void 0!==rb.factor2&&(w.factor2=rb.factor2),a.startSizeGradients.push(w)}}var ub=c.getLifeTimeGradients();if(ub){a.lifeTimeGradients=[];for(var Bb=0,jb=ub;Bb<jb.length;Bb++){var Eb=jb[Bb];w={gradient:Eb.gradient,factor1:Eb.factor1},void 0!==Eb.factor2&&(w.factor2=Eb.factor2),a.lifeTimeGradients.push(w)}}var _b=c.getLimitVelocityGradients();if(_b){a.limitVelocityGradients=[];for(var Kb=0,cc=_b;Kb<cc.length;Kb++){var $b=cc[Kb];w={gradient:$b.gradient,factor1:$b.factor1},void 0!==$b.factor2&&(w.factor2=$b.factor2),a.limitVelocityGradients.push(w)}a.limitVelocityDamping=c.limitVelocityDamping}c.noiseTexture&&(a.noiseTexture=c.noiseTexture.serialize())},b._Parse=function(a,c,d,f){if(a.textureName&&(c.particleTexture=new ya.a(f+a.textureName,d,!1,void 0===a.invertY||a.invertY),c.particleTexture.name=a.textureName),a.emitterId||0===a.emitterId||void 0!==a.emitter?a.emitterId?c.emitter=d.getLastMeshByID(a.emitterId):c.emitter=i.e.FromArray(a.emitter):c.emitter=i.e.Zero(),c.isLocal=!!a.isLocal,void 0!==a.renderingGroupId&&(c.renderingGroupId=a.renderingGroupId),void 0!==a.isBillboardBased&&(c.isBillboardBased=a.isBillboardBased),void 0!==a.billboardMode&&(c.billboardMode=a.billboardMode),a.animations){for(var g=0;g<a.animations.length;g++){var h=a.animations[g],j=D.a.GetClass("BABYLON.Animation");j&&c.animations.push(j.Parse(h))}c.beginAnimationOnStart=a.beginAnimationOnStart,c.beginAnimationFrom=a.beginAnimationFrom,c.beginAnimationTo=a.beginAnimationTo,c.beginAnimationLoop=a.beginAnimationLoop}if(a.autoAnimate&&d.beginAnimation(c,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),c.startDelay=0|a.startDelay,c.minAngularSpeed=a.minAngularSpeed,c.maxAngularSpeed=a.maxAngularSpeed,c.minSize=a.minSize,c.maxSize=a.maxSize,a.minScaleX&&(c.minScaleX=a.minScaleX,c.maxScaleX=a.maxScaleX,c.minScaleY=a.minScaleY,c.maxScaleY=a.maxScaleY),void 0!==a.preWarmCycles&&(c.preWarmCycles=a.preWarmCycles,c.preWarmStepOffset=a.preWarmStepOffset),void 0!==a.minInitialRotation&&(c.minInitialRotation=a.minInitialRotation,c.maxInitialRotation=a.maxInitialRotation),c.minLifeTime=a.minLifeTime,c.maxLifeTime=a.maxLifeTime,c.minEmitPower=a.minEmitPower,c.maxEmitPower=a.maxEmitPower,c.emitRate=a.emitRate,c.gravity=i.e.FromArray(a.gravity),a.noiseStrength&&(c.noiseStrength=i.e.FromArray(a.noiseStrength)),c.color1=G.b.FromArray(a.color1),c.color2=G.b.FromArray(a.color2),c.colorDead=G.b.FromArray(a.colorDead),c.updateSpeed=a.updateSpeed,c.targetStopDuration=a.targetStopDuration,c.blendMode=a.blendMode,a.colorGradients)for(var m=0,w=a.colorGradients;m<w.length;m++){var z=w[m];c.addColorGradient(z.gradient,G.b.FromArray(z.color1),z.color2?G.b.FromArray(z.color2):void 0)}if(a.rampGradients){for(var C=0,J=a.rampGradients;C<J.length;C++){var K=J[C];c.addRampGradient(K.gradient,G.a.FromArray(K.color))}c.useRampGradients=a.useRampGradients}if(a.colorRemapGradients)for(var N=0,T=a.colorRemapGradients;N<T.length;N++){var Z=T[N];c.addColorRemapGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2)}if(a.alphaRemapGradients)for(var _=0,ca=a.alphaRemapGradients;_<ca.length;_++){var ea=ca[_];c.addAlphaRemapGradient(ea.gradient,void 0!==ea.factor1?ea.factor1:ea.factor,ea.factor2)}if(a.sizeGradients)for(var fa=0,ka=a.sizeGradients;fa<ka.length;fa++){var pa=ka[fa];c.addSizeGradient(pa.gradient,void 0!==pa.factor1?pa.factor1:pa.factor,pa.factor2)}if(a.angularSpeedGradients)for(var va=0,sa=a.angularSpeedGradients;va<sa.length;va++){var la=sa[va];c.addAngularSpeedGradient(la.gradient,void 0!==la.factor1?la.factor1:la.factor,la.factor2)}if(a.velocityGradients)for(var ta=0,Da=a.velocityGradients;ta<Da.length;ta++){var ua=Da[ta];c.addVelocityGradient(ua.gradient,void 0!==ua.factor1?ua.factor1:ua.factor,ua.factor2)}if(a.dragGradients)for(var Aa=0,za=a.dragGradients;Aa<za.length;Aa++){var Fa=za[Aa];c.addDragGradient(Fa.gradient,void 0!==Fa.factor1?Fa.factor1:Fa.factor,Fa.factor2)}if(a.emitRateGradients)for(var La=0,Ta=a.emitRateGradients;La<Ta.length;La++){var bb=Ta[La];c.addEmitRateGradient(bb.gradient,void 0!==bb.factor1?bb.factor1:bb.factor,bb.factor2)}if(a.startSizeGradients)for(var Ra=0,Oa=a.startSizeGradients;Ra<Oa.length;Ra++){var Za=Oa[Ra];c.addStartSizeGradient(Za.gradient,void 0!==Za.factor1?Za.factor1:Za.factor,Za.factor2)}if(a.lifeTimeGradients)for(var Va=0,$a=a.lifeTimeGradients;Va<$a.length;Va++){var fb=$a[Va];c.addLifeTimeGradient(fb.gradient,void 0!==fb.factor1?fb.factor1:fb.factor,fb.factor2)}if(a.limitVelocityGradients){for(var Ma=0,Wa=a.limitVelocityGradients;Ma<Wa.length;Ma++){var ab=Wa[Ma];c.addLimitVelocityGradient(ab.gradient,void 0!==ab.factor1?ab.factor1:ab.factor,ab.factor2)}c.limitVelocityDamping=a.limitVelocityDamping}var vb;if(a.noiseTexture&&(c.noiseTexture=xf.Parse(a.noiseTexture,d,f)),a.particleEmitterType){switch(a.particleEmitterType.type){case"SphereParticleEmitter":vb=new Cf();break;case"SphereDirectedParticleEmitter":vb=new ih();break;case"ConeEmitter":case"ConeParticleEmitter":vb=new gh();break;case"CylinderParticleEmitter":vb=new Bf();break;case"HemisphericParticleEmitter":vb=new hh();break;case"BoxEmitter":case"BoxParticleEmitter":default:vb=new _d()}vb.parse(a.particleEmitterType,d)}else(vb=new _d()).parse(a,d);c.particleEmitterType=vb,c.startSpriteCellID=a.startSpriteCellID,c.endSpriteCellID=a.endSpriteCellID,c.spriteCellWidth=a.spriteCellWidth,c.spriteCellHeight=a.spriteCellHeight,c.spriteCellChangeSpeed=a.spriteCellChangeSpeed,c.spriteRandomStartCell=a.spriteRandomStartCell},b.Parse=function(a,c,d,f){void 0===f&&(f=!1);var g=a.name,h=null,j=null;if(a.customShader){var m=(j=a.customShader).shaderOptions.defines.length>0?j.shaderOptions.defines.join(`
`):"";h=c.getEngine().createEffectForParticles(j.shaderPath.fragmentElement,j.shaderOptions.uniforms,j.shaderOptions.samplers,m)}var w=new b(g,a.capacity,c,h,a.isAnimationSheetEnabled);if(w.customShader=j,a.id&&(w.id=a.id),a.subEmitters){w.subEmitters=[];for(var z=0,C=a.subEmitters;z<C.length;z++){for(var J=[],K=0,N=C[z];K<N.length;K++){var T=N[K];J.push(Le.Parse(T,c,d))}w.subEmitters.push(J)}}return b._Parse(a,w,c,d),w.textureMask=G.b.FromArray(a.textureMask),a.preventAutoStart&&(w.preventAutoStart=a.preventAutoStart),f||w.preventAutoStart||w.start(),w},b.BILLBOARDMODE_Y=p.a.PARTICLES_BILLBOARDMODE_Y,b.BILLBOARDMODE_ALL=p.a.PARTICLES_BILLBOARDMODE_ALL,b.BILLBOARDMODE_STRETCHED=p.a.PARTICLES_BILLBOARDMODE_STRETCHED,b}(jh);Le._ParseParticleSystem=Yb.Parse,Pa.a.ShadersStore.gpuUpdateParticlesPixelShader=`#version 300 es
void main() {
discard;
}
`;var go=`#version 300 es
#define PI 3.14159
uniform float currentCount;
uniform float timeDelta;
uniform float stopFactor;
uniform mat4 emitterWM;
uniform vec2 lifeTime;
uniform vec2 emitPower;
uniform vec2 sizeRange;
uniform vec4 scaleRange;
#ifndef COLORGRADIENTS
uniform vec4 color1;
uniform vec4 color2;
#endif
uniform vec3 gravity;
uniform sampler2D randomSampler;
uniform sampler2D randomSampler2;
uniform vec4 angleRange;
#ifdef BOXEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
uniform vec3 minEmitBox;
uniform vec3 maxEmitBox;
#endif
#ifdef POINTEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#endif
#ifdef HEMISPHERICEMITTER
uniform float radius;
uniform float radiusRange;
uniform float directionRandomizer;
#endif
#ifdef SPHEREEMITTER
uniform float radius;
uniform float radiusRange;
#ifdef DIRECTEDSPHEREEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CYLINDEREMITTER
uniform float radius;
uniform float height;
uniform float radiusRange;
#ifdef DIRECTEDCYLINDEREMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CONEEMITTER
uniform vec2 radius;
uniform float coneAngle;
uniform vec2 height;
uniform float directionRandomizer;
#endif

in vec3 position;
#ifdef CUSTOMEMITTER
in vec3 initialPosition;
#endif
in float age;
in float life;
in vec4 seed;
in vec3 size;
#ifndef COLORGRADIENTS
in vec4 color;
#endif
in vec3 direction;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
in float angle;
#else
in vec2 angle;
#endif
#ifdef ANIMATESHEET
in float cellIndex;
#ifdef ANIMATESHEETRANDOMSTART
in float cellStartOffset;
#endif
#endif
#ifdef NOISE
in vec3 noiseCoordinates1;
in vec3 noiseCoordinates2;
#endif

out vec3 outPosition;
#ifdef CUSTOMEMITTER
out vec3 outInitialPosition;
#endif
out float outAge;
out float outLife;
out vec4 outSeed;
out vec3 outSize;
#ifndef COLORGRADIENTS
out vec4 outColor;
#endif
out vec3 outDirection;
#ifndef BILLBOARD
out vec3 outInitialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
out float outAngle;
#else
out vec2 outAngle;
#endif
#ifdef ANIMATESHEET
out float outCellIndex;
#ifdef ANIMATESHEETRANDOMSTART
out float outCellStartOffset;
#endif
#endif
#ifdef NOISE
out vec3 outNoiseCoordinates1;
out vec3 outNoiseCoordinates2;
#endif
#ifdef SIZEGRADIENTS
uniform sampler2D sizeGradientSampler;
#endif
#ifdef ANGULARSPEEDGRADIENTS
uniform sampler2D angularSpeedGradientSampler;
#endif
#ifdef VELOCITYGRADIENTS
uniform sampler2D velocityGradientSampler;
#endif
#ifdef LIMITVELOCITYGRADIENTS
uniform sampler2D limitVelocityGradientSampler;
uniform float limitVelocityDamping;
#endif
#ifdef DRAGGRADIENTS
uniform sampler2D dragGradientSampler;
#endif
#ifdef NOISE
uniform vec3 noiseStrength;
uniform sampler2D noiseSampler;
#endif
#ifdef ANIMATESHEET
uniform vec3 cellInfos;
#endif
vec3 getRandomVec3(float offset) {
return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;
}
vec4 getRandomVec4(float offset) {
return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));
}
void main() {
float newAge=age+timeDelta;

if (newAge>=life && stopFactor != 0.) {
vec3 newPosition;
vec3 newDirection;

vec4 randoms=getRandomVec4(seed.x);

outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;
outAge=newAge-life;

outSeed=seed;

#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(0,0)).r;
#else
outSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;
#endif
outSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;
outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a;
#ifndef COLORGRADIENTS

outColor=color1+(color2-color1)*randoms.b;
#endif

#ifndef ANGULARSPEEDGRADIENTS
outAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;
outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#else
outAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#endif

#ifdef POINTEMITTER
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
newPosition=vec3(0,0,0);
newDirection=direction1+(direction2-direction1)*randoms3;
#elif defined(BOXEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;
newDirection=direction1+(direction2-direction1)*randoms3;
#elif defined(HEMISPHERICEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);
newDirection=newPosition+directionRandomizer*randoms3;
#elif defined(SPHEREEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);
#ifdef DIRECTEDSPHEREEMITTER
newDirection=direction1+(direction2-direction1)*randoms3;
#else

newDirection=newPosition+directionRandomizer*randoms3;
#endif
#elif defined(CYLINDEREMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float yPos=(randoms2.x-0.5)*height;
float angle=randoms2.y*PI*2.;
float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));
float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));
float xPos=positionRadius*cos(angle);
float zPos=positionRadius*sin(angle);
newPosition=vec3(xPos,yPos,zPos);
#ifdef DIRECTEDCYLINDEREMITTER
newDirection=direction1+(direction2-direction1)*randoms3;
#else

angle=angle+((randoms3.x-0.5)*PI);
newDirection=vec3(cos(angle),randoms3.y-0.5,sin(angle));
newDirection=normalize(newDirection);
#endif
#elif defined(CONEEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
float s=2.0*PI*randoms2.x;
#ifdef CONEEMITTERSPAWNPOINT
float h=0.0001;
#else
float h=randoms2.y*height.y;

h=1.-h*h;
#endif
float lRadius=radius.x-radius.x*randoms2.z*radius.y;
lRadius=lRadius*h;
float randX=lRadius*sin(s);
float randZ=lRadius*cos(s);
float randY=h*height.x;
newPosition=vec3(randX,randY,randZ);

if (abs(cos(coneAngle)) == 1.0) {
newDirection=vec3(0.,1.0,0.);
} else {
vec3 randoms3=getRandomVec3(seed.z);
newDirection=normalize(newPosition+directionRandomizer*randoms3);
}
#elif defined(CUSTOMEMITTER)
newPosition=initialPosition;
outInitialPosition=initialPosition;
#else

newPosition=vec3(0.,0.,0.);

newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));
#endif
float power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;
outPosition=(emitterWM*vec4(newPosition,1.)).xyz;
#ifdef CUSTOMEMITTER
outDirection=direction;
#ifndef BILLBOARD
outInitialDirection=direction;
#endif
#else
vec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;
outDirection=initial*power;
#ifndef BILLBOARD
outInitialDirection=initial;
#endif
#endif
#ifdef ANIMATESHEET
outCellIndex=cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=randoms.a*outLife;
#endif
#endif
#ifdef NOISE
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
} else {
float directionScale=timeDelta;
outAge=newAge;
float ageGradient=newAge/life;
#ifdef VELOCITYGRADIENTS
directionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;
#endif
#ifdef DRAGGRADIENTS
directionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;
#endif
#if defined(CUSTOMEMITTER)
outPosition=position+(direction-position)*ageGradient;
outInitialPosition=initialPosition;
#else
outPosition=position+direction*directionScale;
#endif
outLife=life;
outSeed=seed;
#ifndef COLORGRADIENTS
outColor=color;
#endif
#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;
outSize.yz=size.yz;
#else
outSize=size;
#endif
#ifndef BILLBOARD
outInitialDirection=initialDirection;
#endif
#ifdef CUSTOMEMITTER
outDirection=direction;
#else
vec3 updatedDirection=direction+gravity*timeDelta;
#ifdef LIMITVELOCITYGRADIENTS
float limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;
float currentVelocity=length(updatedDirection);
if (currentVelocity>limitVelocity) {
updatedDirection=updatedDirection*limitVelocityDamping;
}
#endif
outDirection=updatedDirection;
#ifdef NOISE
vec3 localPosition=outPosition-emitterWM[3].xyz;
float fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;
float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;
float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;
vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;
outDirection=outDirection+force*timeDelta;
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
#endif
#ifdef ANGULARSPEEDGRADIENTS
float angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;
outAngle=angle+angularSpeed*timeDelta;
#else
outAngle=vec2(angle.x+angle.y*timeDelta,angle.y);
#endif
#ifdef ANIMATESHEET
float offsetAge=outAge;
float dist=cellInfos.y-cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=cellStartOffset;
offsetAge+=cellStartOffset;
#else
float cellStartOffset=0.;
#endif
float ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);
outCellIndex=float(int(cellInfos.x+ratio*dist));
#endif
}
}`;Pa.a.ShadersStore.gpuUpdateParticlesVertexShader=go;var ho=`#ifdef CLIPPLANE
in float fClipDistance;
#endif
#ifdef CLIPPLANE2
in float fClipDistance2;
#endif
#ifdef CLIPPLANE3
in float fClipDistance3;
#endif
#ifdef CLIPPLANE4
in float fClipDistance4;
#endif
#ifdef CLIPPLANE5
in float fClipDistance5;
#endif
#ifdef CLIPPLANE6
in float fClipDistance6;
#endif`;Pa.a.IncludesShadersStore.clipPlaneFragmentDeclaration2=ho;var io=`#version 300 es
uniform sampler2D textureSampler;
in vec2 vUV;
in vec4 vColor;
out vec4 outFragColor;
#include<clipPlaneFragmentDeclaration2>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main() {
#include<clipPlaneFragment>
vec4 textureColor=texture(textureSampler,vUV);
outFragColor=textureColor*vColor;
#ifdef BLENDMULTIPLYMODE
float alpha=vColor.a*textureColor.a;
outFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
#else
#ifdef IMAGEPROCESSING
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
outFragColor=applyImageProcessing(outFragColor);
#endif
#endif
}
`;Pa.a.ShadersStore.gpuRenderParticlesPixelShader=io;var jo=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
out float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
out float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
out float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
out float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;
out float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;
out float fClipDistance6;
#endif`;Pa.a.IncludesShadersStore.clipPlaneVertexDeclaration2=jo;var ko=`#version 300 es
uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
uniform vec3 worldOffset;

in vec3 position;
in float age;
in float life;
in vec3 size;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef BILLBOARDSTRETCHED
in vec3 direction;
#endif
in float angle;
#ifdef ANIMATESHEET
in float cellIndex;
#endif
in vec2 offset;
in vec2 uv;
out vec2 vUV;
out vec4 vColor;
#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration2>
#ifdef COLORGRADIENTS
uniform sampler2D colorGradientSampler;
#else
uniform vec4 colorDead;
in vec4 color;
#endif
#ifdef ANIMATESHEET
uniform vec3 sheetInfos;
#endif
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return (position+worldOffset)+alignedCorner;
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return (position+worldOffset)+alignedCorner;
}
#endif
void main() {
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex/sheetInfos.z);
float columnOffset=cellIndex-rowOffset*sheetInfos.z;
vec2 uvScale=sheetInfos.xy;
vec2 uvOffset=vec2(uv.x ,1.0-uv.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=uv;
#endif
float ratio=age/life;
#ifdef COLORGRADIENTS
vColor=texture(colorGradientSampler,vec2(ratio,0));
#else
vColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);
#endif
vec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;
#ifdef BILLBOARD
vec4 rotatedCorner;
rotatedCorner.w=0.;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=(position+worldOffset)-eyePosition;
yaxis.y=0.;
vec3 worldPos=rotate(normalize(yaxis),rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(worldPos,1.0));
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=(position+worldOffset)-eyePosition;
vec3 worldPos=rotateAlign(toCamera,rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(worldPos,1.0));
#else

rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

vec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;
#endif
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=0.;
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
vec3 yaxis=normalize(initialDirection);
vec3 worldPos=rotate(yaxis,rotatedCorner);

vec4 viewPosition=view*vec4(worldPos,1.0);
#endif
gl_Position=projection*viewPosition;

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
vec4 worldPos=invView*viewPosition;
#endif
#include<clipPlaneVertex>
}`;Pa.a.ShadersStore.gpuRenderParticlesVertexShader=ko;var Me=function(e){function b(a,c,d,f){void 0===f&&(f=!1);var g=e.call(this,a)||this;g.layerMask=268435455,g._accumulatedCount=0,g._targetIndex=0,g._currentRenderId=-1,g._started=!1,g._stopped=!1,g._timeDelta=0,g._actualFrame=0,g._rawTextureWidth=256,g.onDisposeObservable=new I.c(),g.forceDepthWrite=!1,g._preWarmDone=!1,g._scene=d||U.a.LastCreatedScene,g._attachImageProcessingConfiguration(null),g._engine=g._scene.getEngine(),c.randomTextureSize||delete c.randomTextureSize;var h=Object(l.a)({capacity:50000,randomTextureSize:g._engine.getCaps().maxTextureSize},c),j=c;isFinite(j)&&(h.capacity=j),g._capacity=h.capacity,g._activeCount=h.capacity,g._currentActiveCount=0,g._isAnimationSheetEnabled=f,g._scene.particleSystems.push(g),g._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]},g.particleEmitterType=new _d();for(var m=Math.min(g._engine.getCaps().maxTextureSize,h.randomTextureSize),w=[],z=0;z<m;++z)w.push(Math.random()),w.push(Math.random()),w.push(Math.random()),w.push(Math.random());for(g._randomTexture=new vc(new Float32Array(w),m,1,p.a.TEXTUREFORMAT_RGBA,g._scene,!1,!1,p.a.TEXTURE_NEAREST_SAMPLINGMODE,p.a.TEXTURETYPE_FLOAT),g._randomTexture.wrapU=ya.a.WRAP_ADDRESSMODE,g._randomTexture.wrapV=ya.a.WRAP_ADDRESSMODE,w=[],z=0;z<m;++z)w.push(Math.random()),w.push(Math.random()),w.push(Math.random()),w.push(Math.random());return g._randomTexture2=new vc(new Float32Array(w),m,1,p.a.TEXTUREFORMAT_RGBA,g._scene,!1,!1,p.a.TEXTURE_NEAREST_SAMPLINGMODE,p.a.TEXTURETYPE_FLOAT),g._randomTexture2.wrapU=ya.a.WRAP_ADDRESSMODE,g._randomTexture2.wrapV=ya.a.WRAP_ADDRESSMODE,g._randomTextureSize=m,g}return Object(l.d)(b,e),Object.defineProperty(b,"IsSupported",{get:function(){return!!U.a.LastCreatedEngine&&U.a.LastCreatedEngine.webGLVersion>1},enumerable:!0,configurable:!0}),b.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(b.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(a){this._activeCount=Math.min(a,this._capacity)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isLocal",{get:function(){return!1},set:function(a){},enumerable:!0,configurable:!0}),b.prototype.isReady=function(){return this._updateEffect?!!(this.emitter&&this._updateEffect.isReady()&&this._imageProcessingConfiguration.isReady()&&this._renderEffect.isReady()&&this.particleTexture&&this.particleTexture.isReady()):(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)},b.prototype.isStarted=function(){return this._started},b.prototype.start=function(a){var c=this;if(void 0===a&&(a=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";a?setTimeout(function(){c.start(0)},a):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},b.prototype.stop=function(){this._stopped=!0},b.prototype.reset=function(){this._releaseBuffers(),this._releaseVAOs(),this._currentActiveCount=0,this._targetIndex=0},b.prototype.getClassName=function(){return"GPUParticleSystem"},b.prototype._removeGradientAndTexture=function(a,c,d){return e.prototype._removeGradientAndTexture.call(this,a,c,d),this._releaseBuffers(),this},b.prototype.addColorGradient=function(a,c,d){this._colorGradients||(this._colorGradients=[]);var f=new kh();return f.gradient=a,f.color1=c,this._colorGradients.push(f),this._colorGradients.sort(function(g,h){return g.gradient<h.gradient?-1:g.gradient>h.gradient?1:0}),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._releaseBuffers(),this},b.prototype.removeColorGradient=function(a){return this._removeGradientAndTexture(a,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},b.prototype._addFactorGradient=function(a,c,d){var f=new lh();f.gradient=c,f.factor1=d,a.push(f),a.sort(function(g,h){return g.gradient<h.gradient?-1:g.gradient>h.gradient?1:0}),this._releaseBuffers()},b.prototype.addSizeGradient=function(a,c){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,a,c),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._releaseBuffers(),this},b.prototype.removeSizeGradient=function(a){return this._removeGradientAndTexture(a,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},b.prototype.addAngularSpeedGradient=function(a,c){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,a,c),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._releaseBuffers(),this},b.prototype.removeAngularSpeedGradient=function(a){return this._removeGradientAndTexture(a,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},b.prototype.addVelocityGradient=function(a,c){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,a,c),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._releaseBuffers(),this},b.prototype.removeVelocityGradient=function(a){return this._removeGradientAndTexture(a,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},b.prototype.addLimitVelocityGradient=function(a,c){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,a,c),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._releaseBuffers(),this},b.prototype.removeLimitVelocityGradient=function(a){return this._removeGradientAndTexture(a,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},b.prototype.addDragGradient=function(a,c){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,a,c),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._releaseBuffers(),this},b.prototype.removeDragGradient=function(a){return this._removeGradientAndTexture(a,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},b.prototype.addEmitRateGradient=function(a,c,d){return this},b.prototype.removeEmitRateGradient=function(a){return this},b.prototype.addStartSizeGradient=function(a,c,d){return this},b.prototype.removeStartSizeGradient=function(a){return this},b.prototype.addColorRemapGradient=function(a,c,d){return this},b.prototype.removeColorRemapGradient=function(){return this},b.prototype.addAlphaRemapGradient=function(a,c,d){return this},b.prototype.removeAlphaRemapGradient=function(){return this},b.prototype.addRampGradient=function(a,c){return this},b.prototype.removeRampGradient=function(){return this},b.prototype.getRampGradients=function(){return null},Object.defineProperty(b.prototype,"useRampGradients",{get:function(){return!1},set:function(a){},enumerable:!0,configurable:!0}),b.prototype.addLifeTimeGradient=function(a,c,d){return this},b.prototype.removeLifeTimeGradient=function(a){return this},b.prototype._reset=function(){this._releaseBuffers()},b.prototype._createUpdateVAO=function(a){var c={};c.position=a.createVertexBuffer("position",0,3);var d=3;this.particleEmitterType instanceof $d&&(c.initialPosition=a.createVertexBuffer("initialPosition",d,3),d+=3),c.age=a.createVertexBuffer("age",d,1),d+=1,c.life=a.createVertexBuffer("life",d,1),d+=1,c.seed=a.createVertexBuffer("seed",d,4),d+=4,c.size=a.createVertexBuffer("size",d,3),d+=3,this._colorGradientsTexture||(c.color=a.createVertexBuffer("color",d,4),d+=4),c.direction=a.createVertexBuffer("direction",d,3),d+=3,this._isBillboardBased||(c.initialDirection=a.createVertexBuffer("initialDirection",d,3),d+=3),this._angularSpeedGradientsTexture?(c.angle=a.createVertexBuffer("angle",d,1),d+=1):(c.angle=a.createVertexBuffer("angle",d,2),d+=2),this._isAnimationSheetEnabled&&(c.cellIndex=a.createVertexBuffer("cellIndex",d,1),d+=1,this.spriteRandomStartCell&&(c.cellStartOffset=a.createVertexBuffer("cellStartOffset",d,1),d+=1)),this.noiseTexture&&(c.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",d,3),d+=3,c.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",d,3),d+=3);var f=this._engine.recordVertexArrayObject(c,null,this._updateEffect);return this._engine.bindArrayBuffer(null),f},b.prototype._createRenderVAO=function(a,c){var d={};d.position=a.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);var f=3;this.particleEmitterType instanceof $d&&(f+=3),d.age=a.createVertexBuffer("age",f,1,this._attributesStrideSize,!0),f+=1,d.life=a.createVertexBuffer("life",f,1,this._attributesStrideSize,!0),f+=5,d.size=a.createVertexBuffer("size",f,3,this._attributesStrideSize,!0),f+=3,this._colorGradientsTexture||(d.color=a.createVertexBuffer("color",f,4,this._attributesStrideSize,!0),f+=4),this.billboardMode===Yb.BILLBOARDMODE_STRETCHED&&(d.direction=a.createVertexBuffer("direction",f,3,this._attributesStrideSize,!0)),f+=3,this._isBillboardBased||(d.initialDirection=a.createVertexBuffer("initialDirection",f,3,this._attributesStrideSize,!0),f+=3),d.angle=a.createVertexBuffer("angle",f,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?f++:f+=2,this._isAnimationSheetEnabled&&(d.cellIndex=a.createVertexBuffer("cellIndex",f,1,this._attributesStrideSize,!0),f+=1,this.spriteRandomStartCell&&(d.cellStartOffset=a.createVertexBuffer("cellStartOffset",f,1,this._attributesStrideSize,!0),f+=1)),this.noiseTexture&&(d.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",f,3,this._attributesStrideSize,!0),f+=3,d.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",f,3,this._attributesStrideSize,!0),f+=3),d.offset=c.createVertexBuffer("offset",0,2),d.uv=c.createVertexBuffer("uv",2,2);var g=this._engine.recordVertexArrayObject(d,null,this._renderEffect);return this._engine.bindArrayBuffer(null),g},b.prototype._initialize=function(a){if(void 0===a&&(a=!1),!this._buffer0||a){var c=this._scene.getEngine(),d=new Array();this._attributesStrideSize=21,this._targetIndex=0,this.particleEmitterType instanceof $d&&(this._attributesStrideSize+=3),this.isBillboardBased||(this._attributesStrideSize+=3),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6);for(var f=this.particleEmitterType instanceof $d,g=i.c.Vector3[0],h=0;h<this._capacity;h++)d.push(0),d.push(0),d.push(0),f&&(this.particleEmitterType.particlePositionGenerator(h,null,g),d.push(g.x),d.push(g.y),d.push(g.z)),d.push(0),d.push(0),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(0),d.push(0),d.push(0),this._colorGradientsTexture||(d.push(0),d.push(0),d.push(0),d.push(0)),f?(this.particleEmitterType.particleDestinationGenerator(h,null,g),d.push(g.x),d.push(g.y),d.push(g.z)):(d.push(0),d.push(0),d.push(0)),this.isBillboardBased||(d.push(0),d.push(0),d.push(0)),d.push(0),this._angularSpeedGradientsTexture||d.push(0),this._isAnimationSheetEnabled&&(d.push(0),this.spriteRandomStartCell&&d.push(0)),this.noiseTexture&&(d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()));var j=new Float32Array([.5,.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new ra.a(c,d,!1,this._attributesStrideSize),this._buffer1=new ra.a(c,d,!1,this._attributesStrideSize),this._spriteBuffer=new ra.a(c,j,!1,4),this._updateVAO=[],this._updateVAO.push(this._createUpdateVAO(this._buffer0)),this._updateVAO.push(this._createUpdateVAO(this._buffer1)),this._renderVAO=[],this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer)),this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer)),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},b.prototype._recreateUpdateEffect=function(){var a=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(a+=`
#define BILLBOARD`),this._colorGradientsTexture&&(a+=`
#define COLORGRADIENTS`),this._sizeGradientsTexture&&(a+=`
#define SIZEGRADIENTS`),this._angularSpeedGradientsTexture&&(a+=`
#define ANGULARSPEEDGRADIENTS`),this._velocityGradientsTexture&&(a+=`
#define VELOCITYGRADIENTS`),this._limitVelocityGradientsTexture&&(a+=`
#define LIMITVELOCITYGRADIENTS`),this._dragGradientsTexture&&(a+=`
#define DRAGGRADIENTS`),this.isAnimationSheetEnabled&&(a+=`
#define ANIMATESHEET`,this.spriteRandomStartCell&&(a+=`
#define ANIMATESHEETRANDOMSTART`)),this.noiseTexture&&(a+=`
#define NOISE`),this._updateEffect&&this._updateEffectOptions.defines===a||(this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this.particleEmitterType instanceof $d&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.defines=a,this._updateEffect=new Pa.a("gpuUpdateParticles",this._updateEffectOptions,this._scene.getEngine()))},b.prototype._recreateRenderEffect=function(){var a="";if(this._scene.clipPlane&&(a=`
#define CLIPPLANE`),this._scene.clipPlane2&&(a=`
#define CLIPPLANE2`),this._scene.clipPlane3&&(a=`
#define CLIPPLANE3`),this._scene.clipPlane4&&(a=`
#define CLIPPLANE4`),this._scene.clipPlane5&&(a=`
#define CLIPPLANE5`),this._scene.clipPlane6&&(a=`
#define CLIPPLANE6`),this.blendMode===Yb.BLENDMODE_MULTIPLY&&(a=`
#define BLENDMULTIPLYMODE`),this._isBillboardBased)switch(a+=`
#define BILLBOARD`,this.billboardMode){case Yb.BILLBOARDMODE_Y:a+=`
#define BILLBOARDY`;break;case Yb.BILLBOARDMODE_STRETCHED:a+=`
#define BILLBOARDSTRETCHED`;break;case Yb.BILLBOARDMODE_ALL:}if(this._colorGradientsTexture&&(a+=`
#define COLORGRADIENTS`),this.isAnimationSheetEnabled&&(a+=`
#define ANIMATESHEET`),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),a+=`
`+this._imageProcessingConfigurationDefines.toString()),!this._renderEffect||this._renderEffect.defines!==a){var c=["worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","sheetInfos","translationPivot","eyePosition"],d=["textureSampler","colorGradientSampler"];Sb.a&&(Sb.a.PrepareUniforms(c,this._imageProcessingConfigurationDefines),Sb.a.PrepareSamplers(d,this._imageProcessingConfigurationDefines)),this._renderEffect=new Pa.a("gpuRenderParticles",["position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex"],c,d,this._scene.getEngine(),a)}},b.prototype.animate=function(a){void 0===a&&(a=!1),this._timeDelta=this.updateSpeed*(a?this.preWarmStepOffset:this._scene.getAnimationRatio()),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},b.prototype._createFactorGradientTexture=function(a,c){var d=this[c];if(a&&a.length&&!d){for(var f=new Float32Array(this._rawTextureWidth),g=0;g<this._rawTextureWidth;g++){var h=g/this._rawTextureWidth;bc.GetCurrentGradient(h,a,function(j,m,w){f[g]=aa.a.Lerp(j.factor1,m.factor1,w)})}this[c]=vc.CreateRTexture(f,this._rawTextureWidth,1,this._scene,!1,!1,ya.a.NEAREST_SAMPLINGMODE)}},b.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},b.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},b.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},b.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},b.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},b.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var a=new Uint8Array(4*this._rawTextureWidth),c=G.c.Color4[0],d=0;d<this._rawTextureWidth;d++){var f=d/this._rawTextureWidth;bc.GetCurrentGradient(f,this._colorGradients,function(g,h,j){G.b.LerpToRef(g.color1,h.color1,j,c),a[4*d]=255*c.r,a[4*d+1]=255*c.g,a[4*d+2]=255*c.b,a[4*d+3]=255*c.a})}this._colorGradientsTexture=vc.CreateRGBATexture(a,this._rawTextureWidth,1,this._scene,!1,!1,ya.a.NEAREST_SAMPLINGMODE)}},b.prototype.render=function(a){if(void 0===a&&(a=!1),!this._started)return 0;if(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),this._recreateRenderEffect(),!this.isReady())return 0;if(!a){if(!this._preWarmDone&&this.preWarmCycles){for(var c=0;c<this.preWarmCycles;c++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId())return 0;this._currentRenderId=this._scene.getFrameId()}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var d=0|this._accumulatedCount;this._accumulatedCount-=d,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+d)}if(!this._currentActiveCount)return 0;var f;if(this._engine.enableEffect(this._updateEffect),this._engine.setState(!1),this._updateEffect.setFloat("currentCount",this._currentActiveCount),this._updateEffect.setFloat("timeDelta",this._timeDelta),this._updateEffect.setFloat("stopFactor",this._stopped?0:1),this._updateEffect.setTexture("randomSampler",this._randomTexture),this._updateEffect.setTexture("randomSampler2",this._randomTexture2),this._updateEffect.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2)),this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateEffect.setVector3("gravity",this.gravity),this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture),this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture),this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture),this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping)),this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect),this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed),this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength)),this.emitter.position)f=this.emitter.getWorldMatrix();else{var g=this.emitter;f=i.a.Translation(g.x,g.y,g.z)}if(this._updateEffect.setMatrix("emitterWM",f),this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex],null),this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),this._engine.setRasterizerState(!1),this._engine.beginTransformFeedback(!0),this._engine.drawArraysType(Hb.a.PointListDrawMode,0,this._currentActiveCount),this._engine.endTransformFeedback(),this._engine.setRasterizerState(!0),this._engine.bindTransformFeedbackBuffer(null),!a){this._engine.enableEffect(this._renderEffect);var h=this._scene.getViewMatrix();if(this._renderEffect.setMatrix("view",h),this._renderEffect.setMatrix("projection",this._scene.getProjectionMatrix()),this._renderEffect.setTexture("textureSampler",this.particleTexture),this._renderEffect.setVector2("translationPivot",this.translationPivot),this._renderEffect.setVector3("worldOffset",this.worldOffset),this._colorGradientsTexture?this._renderEffect.setTexture("colorGradientSampler",this._colorGradientsTexture):this._renderEffect.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var j=this.particleTexture.getBaseSize();this._renderEffect.setFloat3("sheetInfos",this.spriteCellWidth/j.width,this.spriteCellHeight/j.height,j.width/this.spriteCellWidth)}if(this._isBillboardBased){var m=this._scene.activeCamera;this._renderEffect.setVector3("eyePosition",m.globalPosition)}if(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6){var w=h.clone();w.invert(),this._renderEffect.setMatrix("invView",w),Ua.a.BindClipPlane(this._renderEffect,this._scene)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._renderEffect),this.blendMode){case Yb.BLENDMODE_ADD:this._engine.setAlphaMode(p.a.ALPHA_ADD);break;case Yb.BLENDMODE_ONEONE:this._engine.setAlphaMode(p.a.ALPHA_ONEONE);break;case Yb.BLENDMODE_STANDARD:this._engine.setAlphaMode(p.a.ALPHA_COMBINE);break;case Yb.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(p.a.ALPHA_MULTIPLY)}this.forceDepthWrite&&this._engine.setDepthWrite(!0),this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex],null),this._engine.drawArraysType(Hb.a.TriangleFanDrawMode,0,4,this._currentActiveCount),this._engine.setAlphaMode(p.a.ALPHA_DISABLE)}this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);var z=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=z,this._currentActiveCount},b.prototype.rebuild=function(){this._initialize(!0)},b.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)},b.prototype._releaseVAOs=function(){if(this._updateVAO){for(var a=0;a<this._updateVAO.length;a++)this._engine.releaseVertexArrayObject(this._updateVAO[a]);for(this._updateVAO=[],a=0;a<this._renderVAO.length;a++)this._engine.releaseVertexArrayObject(this._renderVAO[a]);this._renderVAO=[]}},b.prototype.dispose=function(a){void 0===a&&(a=!0);var c=this._scene.particleSystems.indexOf(this);c>-1&&this._scene.particleSystems.splice(c,1),this._releaseBuffers(),this._releaseVAOs(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),a&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),a&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},b.prototype.clone=function(a,c){var d=new b(a,{capacity:this._capacity,randomTextureSize:this._randomTextureSize},this._scene);return P.a.DeepCopy(this,d,["particles","customShader","noiseTexture","particleTexture","onDisposeObservable"]),void 0===c&&(c=this.emitter),d.emitter=c,this.particleTexture&&(d.particleTexture=new ya.a(this.particleTexture.url,this._scene)),d.noiseTexture=this.noiseTexture,this._colorGradients&&this._colorGradients.forEach(function(f){d.addColorGradient(f.gradient,f.color1,f.color2)}),this._dragGradients&&this._dragGradients.forEach(function(f){d.addDragGradient(f.gradient,f.factor1)}),this._angularSpeedGradients&&this._angularSpeedGradients.forEach(function(f){d.addAngularSpeedGradient(f.gradient,f.factor1)}),this._emitRateGradients&&this._emitRateGradients.forEach(function(f){d.addEmitRateGradient(f.gradient,f.factor1,f.factor2)}),this._lifeTimeGradients&&this._lifeTimeGradients.forEach(function(f){d.addLifeTimeGradient(f.gradient,f.factor1,f.factor2)}),this._limitVelocityGradients&&this._limitVelocityGradients.forEach(function(f){d.addLimitVelocityGradient(f.gradient,f.factor1)}),this._sizeGradients&&this._sizeGradients.forEach(function(f){d.addSizeGradient(f.gradient,f.factor1)}),this._startSizeGradients&&this._startSizeGradients.forEach(function(f){d.addStartSizeGradient(f.gradient,f.factor1,f.factor2)}),this._velocityGradients&&this._velocityGradients.forEach(function(f){d.addVelocityGradient(f.gradient,f.factor1)}),this._rampGradients&&this._rampGradients.forEach(function(f){d.addRampGradient(f.gradient,f.color)}),this._colorRemapGradients&&this._colorRemapGradients.forEach(function(f){d.addColorRemapGradient(f.gradient,f.factor1,f.factor2)}),this._alphaRemapGradients&&this._alphaRemapGradients.forEach(function(f){d.addAlphaRemapGradient(f.gradient,f.factor1,f.factor2)}),d},b.prototype.serialize=function(){var a={};return Yb._Serialize(a,this),a.activeParticleCount=this.activeParticleCount,a},b.Parse=function(a,c,d,f){void 0===f&&(f=!1);var g=new b(a.name,{capacity:a.capacity,randomTextureSize:a.randomTextureSize},c);return a.activeParticleCount&&(g.activeParticleCount=a.activeParticleCount),Yb._Parse(a,g,c,d),a.preventAutoStart&&(g.preventAutoStart=a.preventAutoStart),f||g.preventAutoStart||g.start(),g},b}(jh),Df=function(){function e(){this.systems=new Array()}return Object.defineProperty(e.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!0,configurable:!0}),e.prototype.setEmitterAsSphere=function(b,a,c){this._emitterNode&&this._emitterNode.dispose(),this._emitterCreationOptions={kind:"Sphere",options:b,renderingGroupId:a};var d=jc.a.CreateSphere("emitterSphere",{diameter:b.diameter,segments:b.segments},c);d.renderingGroupId=a;var f=new Ab.a("emitterSphereMaterial",c);f.emissiveColor=b.color,d.material=f;for(var g=0,h=this.systems;g<h.length;g++)h[g].emitter=d;this._emitterNode=d},e.prototype.start=function(b){for(var a=0,c=this.systems;a<c.length;a++){var d=c[a];b&&(d.emitter=b),d.start()}},e.prototype.dispose=function(){for(var b=0,a=this.systems;b<a.length;b++)a[b].dispose();this.systems=[],this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)},e.prototype.serialize=function(){for(var b={systems:[]},a=0,c=this.systems;a<c.length;a++){var d=c[a];b.systems.push(d.serialize())}return this._emitterNode&&(b.emitter=this._emitterCreationOptions),b},e.Parse=function(b,a,c){void 0===c&&(c=!1);var d=new e(),f=this.BaseAssetsUrl+"/textures/";a=a||U.a.LastCreatedScene;for(var g=0,h=b.systems;g<h.length;g++){var j=h[g];d.systems.push(c?Me.Parse(j,a,f,!0):Yb.Parse(j,a,f,!0))}if(b.emitter){var m=b.emitter.options;switch(b.emitter.kind){case"Sphere":d.setEmitterAsSphere({diameter:m.diameter,segments:m.segments,color:G.a.FromArray(m.color)},b.emitter.renderingGroupId,a)}}return d},e.BaseAssetsUrl="https://assets.babylonjs.com/particles",e}(),lo=function(){function e(){}return e.CreateDefault=function(b,a,c,d){var f;return void 0===a&&(a=500),void 0===d&&(d=!1),(f=d?new Me("default system",{capacity:a},c):new Yb("default system",a,c)).emitter=b,f.particleTexture=new ya.a("https://www.babylonjs.com/assets/Flare.png",f.getScene()),f.createConeEmitter(.1,Math.PI/4),f.color1=new G.b(1,1,1,1),f.color2=new G.b(1,1,1,1),f.colorDead=new G.b(1,1,1,0),f.minSize=.1,f.maxSize=.1,f.minEmitPower=2,f.maxEmitPower=2,f.updateSpeed=1/60,f.emitRate=30,f},e.CreateAsync=function(b,a,c){void 0===c&&(c=!1),a||(a=U.a.LastCreatedScene);var d={};return a._addPendingData(d),new Promise(function(f,g){if(c&&!Me.IsSupported)return a._removePendingData(d),g("Particle system with GPU is not supported.");Qa.b.LoadFile(e.BaseAssetsUrl+"/systems/"+b+".json",function(h){a._removePendingData(d);var j=JSON.parse(h.toString());return f(Df.Parse(j,a,c))},void 0,void 0,void 0,function(){return a._removePendingData(d),g("An error occured while the creation of your particle system. Check if your type '"+b+"' exists.")})})},e.ExportSet=function(b){for(var a=new Df(),c=0,d=b;c<d.length;c++){var f=d[c];a.systems.push(f)}return a},e.BaseAssetsUrl=Df.BaseAssetsUrl,e}();R.a.AddParser(_a.a.NAME_PARTICLESYSTEM,function(e,b,a,c){var d=R.a.GetIndividualParser(_a.a.NAME_PARTICLESYSTEM);if(d&&void 0!==e.particleSystems&&null!==e.particleSystems)for(var f=0,g=e.particleSystems.length;f<g;f++){var h=e.particleSystems[f];a.particleSystems.push(d(h,b,c))}}),R.a.AddIndividualParser(_a.a.NAME_PARTICLESYSTEM,function(e,b,a){return e.activeParticleCount?Me.Parse(e,b,a):Yb.Parse(e,b,a)}),Ha.a.prototype.createEffectForParticles=function(e,b,a,c,d,f,g){void 0===b&&(b=[]),void 0===a&&(a=[]),void 0===c&&(c="");var h=Yb._GetAttributeNamesOrOptions(),j=Yb._GetEffectCreationOptions();return-1===c.indexOf(" BILLBOARD")&&(c+=`
#define BILLBOARD
`),-1===a.indexOf("diffuseSampler")&&a.push("diffuseSampler"),this.createEffect({vertex:"particles",fragmentElement:e},h,j.concat(b),a,c,d,f,g)},xa.a.prototype.getEmittedParticleSystems=function(){for(var e=new Array(),b=0;b<this.getScene().particleSystems.length;b++){var a=this.getScene().particleSystems[b];a.emitter===this&&e.push(a)}return e},xa.a.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array(),b=this.getDescendants();b.push(this);for(var a=0;a<this.getScene().particleSystems.length;a++){var c=this.getScene().particleSystems[a],d=c.emitter;d.position&&-1!==b.indexOf(d)&&e.push(c)}return e};var Zb,mh=function(){function e(b,a,c,d,f,g,h,j,m,w){void 0===m&&(m=null),void 0===w&&(w=null),this.idx=0,this.id=0,this.color=new G.b(1,1,1,1),this.position=i.e.Zero(),this.rotation=i.e.Zero(),this.scaling=i.e.One(),this.uvs=new i.f(0,0,1,1),this.velocity=i.e.Zero(),this.pivot=i.e.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.cullingStrategy=qb.a.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=i.e.Zero(),this.idx=b,this.id=a,this._pos=c,this._ind=d,this._model=f,this.shapeId=g,this.idxInShape=h,this._sps=j,m&&(this._modelBoundingInfo=m,this._boundingInfo=new Kc.a(m.minimum,m.maximum)),null!==w&&(this.materialIndex=w)}return e.prototype.copyToRef=function(b){return b.position.copyFrom(this.position),b.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(b.rotationQuaternion?b.rotationQuaternion.copyFrom(this.rotationQuaternion):b.rotationQuaternion=this.rotationQuaternion.clone()),b.scaling.copyFrom(this.scaling),this.color&&(b.color?b.color.copyFrom(this.color):b.color=this.color.clone()),b.uvs.copyFrom(this.uvs),b.velocity.copyFrom(this.velocity),b.pivot.copyFrom(this.pivot),b.translateFromPivot=this.translateFromPivot,b.alive=this.alive,b.isVisible=this.isVisible,b.parentId=this.parentId,b.cullingStrategy=this.cullingStrategy,null!==this.materialIndex&&(b.materialIndex=this.materialIndex),this},Object.defineProperty(e.prototype,"scale",{get:function(){return this.scaling},set:function(b){this.scaling=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(b){this.rotationQuaternion=b},enumerable:!0,configurable:!0}),e.prototype.intersectsMesh=function(b){return!(!this._boundingInfo||!b._boundingInfo)&&(this._sps._bSphereOnly?ui.a.Intersects(this._boundingInfo.boundingSphere,b._boundingInfo.boundingSphere):this._boundingInfo.intersects(b._boundingInfo,!1))},e.prototype.isInFrustum=function(b){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(b,this.cullingStrategy)},e.prototype.getRotationMatrix=function(b){var a;if(this.rotationQuaternion)a=this.rotationQuaternion;else{a=i.c.Quaternion[0];var c=this.rotation;i.b.RotationYawPitchRollToRef(c.y,c.x,c.z,a)}a.toRotationMatrix(b)},e}(),nh=function(e,b,a,c,d,f,g,h,j){this._indicesLength=0,this.shapeID=e,this._shape=b,this._indices=a,this._indicesLength=a.length,this._shapeUV=f,this._shapeColors=d,this._normals=c,this._positionFunction=g,this._vertexFunction=h,this._material=j},Rk=function(e,b,a){this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.ind=e,this.indicesLength=b,this.materialIndex=a},mo=function(){function e(b,a,c){this.particles=new Array(),this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array(),this._indices=new Array(),this._normals=new Array(),this._colors=new Array(),this._uvs=new Array(),this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new mh(0,0,0,0,null,0,0,this),this._color=new G.b(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=function(d,f){return f.sqDistance-d.sqDistance},this._materialSortFunction=function(d,f){return d.materialIndex-f.materialIndex},this._autoUpdateSubMeshes=!1,this.name=b,this._scene=a||U.a.LastCreatedScene,this._camera=a.activeCamera,this._pickable=!!c&&c.isPickable,this._depthSort=!!c&&c.enableDepthSort,this._multimaterialEnabled=!!c&&c.enableMultiMaterial,this._useModelMaterial=!!c&&c.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!c&&c.expandable,this._particlesIntersect=!!c&&c.particleIntersection,this._bSphereOnly=!!c&&c.boundingSphereOnly,this._bSphereRadiusFactor=c&&c.bSphereRadiusFactor?c.bSphereRadiusFactor:1,c&&void 0!==c.updatable?this._updatable=c.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new Td.a(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={})}return e.prototype.buildMesh=function(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(0===this.nbParticles&&!this.mesh){var b=Af.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(b,1),b.dispose()}if(this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){var a=new xa.a(this.name,this._scene);this.mesh=a}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&Xa.a.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var c=new Xa.a();return c.indices=this._depthSort?this._indices:this._indices32,c.set(this._positions32,ra.b.PositionKind),c.set(this._normals32,ra.b.NormalKind),this._uvs32.length>0&&c.set(this._uvs32,ra.b.UVKind),this._colors32.length>0&&c.set(this._colors32,ra.b.ColorKind),c.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this.mesh},e.prototype.digest=function(b,a){var c=a&&a.facetNb||1,d=a&&a.number||0,f=a&&a.delta||0,g=b.getVerticesData(ra.b.PositionKind),h=b.getIndices(),j=b.getVerticesData(ra.b.UVKind),m=b.getVerticesData(ra.b.ColorKind),w=b.getVerticesData(ra.b.NormalKind),z=a&&a.storage?a.storage:null,C=0,J=h.length/3;d?(d=d>J?J:d,c=Math.round(J/d),f=0):c=c>J?J:c;for(var K=[],N=[],T=[],Z=[],_=[],ca=i.e.Zero(),ea=c;C<J;){C>J-(c=ea+Math.floor((1+f)*Math.random()))&&(c=J-C),K.length=0,N.length=0,T.length=0,Z.length=0,_.length=0;for(var fa=0,ka=3*C;ka<3*(C+c);ka++){T.push(fa);var pa=h[ka],va=3*pa;if(K.push(g[va],g[va+1],g[va+2]),N.push(w[va],w[va+1],w[va+2]),j){var sa=2*pa;Z.push(j[sa],j[sa+1])}if(m){var la=4*pa;_.push(m[la],m[la+1],m[la+2],m[la+3])}fa++}var ta,Da=this.nbParticles,ua=this._posToShape(K),Aa=this._uvsToShapeUV(Z),za=Array.from(T),Fa=Array.from(_),La=Array.from(N);for(ca.copyFromFloats(0,0,0),ta=0;ta<ua.length;ta++)ca.addInPlace(ua[ta]);ca.scaleInPlace(1/ua.length);var Ta,bb=new i.e(1/0,1/0,1/0),Ra=new i.e(-1/0,-1/0,-1/0);for(ta=0;ta<ua.length;ta++)ua[ta].subtractInPlace(ca),bb.minimizeInPlaceFromFloats(ua[ta].x,ua[ta].y,ua[ta].z),Ra.maximizeInPlaceFromFloats(ua[ta].x,ua[ta].y,ua[ta].z);this._particlesIntersect&&(Ta=new Kc.a(bb,Ra));var Oa=null;this._useModelMaterial&&(Oa=b.material?b.material:this._setDefaultMaterial());var Za=new nh(this._shapeCounter,ua,za,La,Fa,Aa,null,null,Oa),Va=this._positions.length,$a=this._indices.length;this._meshBuilder(this._index,$a,ua,this._positions,za,this._indices,Z,this._uvs,Fa,this._colors,La,this._normals,Da,0,null,Za),this._addParticle(Da,this._lastParticleId,Va,$a,Za,this._shapeCounter,0,Ta,z),this.particles[this.nbParticles].position.addInPlace(ca),z||(this._index+=ua.length,Da++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,C+=c}return this._isNotBuilt=!0,this},e.prototype._unrotateFixedNormals=function(){for(var b=0,a=0,c=i.c.Vector3[0],d=i.c.Quaternion[0],f=i.c.Matrix[0],g=0;g<this.particles.length;g++){var h=this.particles[g],j=h._model._shape;if(h.rotationQuaternion)h.rotationQuaternion.conjugateToRef(d);else{var m=h.rotation;i.b.RotationYawPitchRollToRef(m.y,m.x,m.z,d),d.conjugateInPlace()}d.toRotationMatrix(f);for(var w=0;w<j.length;w++)a=b+3*w,i.e.TransformNormalFromFloatsToRef(this._normals32[a],this._normals32[a+1],this._normals32[a+2],f,c),c.toArray(this._fixedNormal32,a);b=a+3}},e.prototype._resetCopy=function(){var b=this._copy;b.position.setAll(0),b.rotation.setAll(0),b.rotationQuaternion=null,b.scaling.setAll(1),b.uvs.copyFromFloats(0,0,1,1),b.color=null,b.translateFromPivot=!1,b.materialIndex=null},e.prototype._meshBuilder=function(b,a,c,d,f,g,h,j,m,w,z,C,J,K,N,T){var Z,_=0,ca=0,ea=0;this._resetCopy();var fa=this._copy,ka=!(!N||!N.storage);if(fa.idx=J,fa.idxInShape=K,this._useModelMaterial){var pa=T._material.uniqueId,va=this._materialIndexesById;va.hasOwnProperty(pa)||(va[pa]=this._materials.length,this._materials.push(T._material));var sa=va[pa];fa.materialIndex=sa}if(N&&N.positionFunction&&(N.positionFunction(fa,J,K),this._mustUnrotateFixedNormals=!0),ka)return fa;var la=i.c.Matrix[0],ta=i.c.Vector3[0],Da=i.c.Vector3[1],ua=i.c.Vector3[2],Aa=i.c.Vector3[3];i.a.IdentityToRef(la),fa.getRotationMatrix(la),fa.pivot.multiplyToRef(fa.scaling,Aa),fa.translateFromPivot?ua.setAll(0):ua.copyFrom(Aa);var za=N&&N.vertexFunction;for(Z=0;Z<c.length;Z++){if(ta.copyFrom(c[Z]),za&&N.vertexFunction(fa,ta,Z),ta.multiplyInPlace(fa.scaling).subtractInPlace(Aa),i.e.TransformCoordinatesToRef(ta,la,Da),Da.addInPlace(ua).addInPlace(fa.position),d.push(Da.x,Da.y,Da.z),h){var Fa=fa.uvs;j.push((Fa.z-Fa.x)*h[_]+Fa.x,(Fa.w-Fa.y)*h[_+1]+Fa.y),_+=2}if(fa.color)this._color=fa.color;else{var La=this._color;m&&void 0!==m[ca]?(La.r=m[ca],La.g=m[ca+1],La.b=m[ca+2],La.a=m[ca+3]):(La.r=1,La.g=1,La.b=1,La.a=1)}w.push(this._color.r,this._color.g,this._color.b,this._color.a),ca+=4,!this.recomputeNormals&&z&&(i.e.TransformNormalFromFloatsToRef(z[ea],z[ea+1],z[ea+2],la,ta),C.push(ta.x,ta.y,ta.z),ea+=3)}for(Z=0;Z<f.length;Z++){var Ta=b+f[Z];g.push(Ta),Ta>65535&&(this._needs32Bits=!0)}if(this._pickable){var bb=f.length/3;for(Z=0;Z<bb;Z++)this.pickedParticles.push({idx:J,faceId:Z})}if(this._depthSort||this._multimaterialEnabled){var Ra=null!==fa.materialIndex?fa.materialIndex:0;this.depthSortedParticles.push(new Rk(a,f.length,Ra))}return fa},e.prototype._posToShape=function(b){for(var a=[],c=0;c<b.length;c+=3)a.push(i.e.FromArray(b,c));return a},e.prototype._uvsToShapeUV=function(b){var a=[];if(b)for(var c=0;c<b.length;c++)a.push(b[c]);return a},e.prototype._addParticle=function(b,a,c,d,f,g,h,j,m){void 0===j&&(j=null),void 0===m&&(m=null);var w=new mh(b,a,c,d,f,g,h,this,j);return(m||this.particles).push(w),w},e.prototype.addShape=function(b,a,c){var d=b.getVerticesData(ra.b.PositionKind),f=b.getIndices(),g=b.getVerticesData(ra.b.UVKind),h=b.getVerticesData(ra.b.ColorKind),j=b.getVerticesData(ra.b.NormalKind);this.recomputeNormals=!j;var m=Array.from(f),w=Array.from(j),z=h?Array.from(h):[],C=c&&c.storage?c.storage:null,J=null;this._particlesIntersect&&(J=b.getBoundingInfo());var K=this._posToShape(d),N=this._uvsToShapeUV(g),T=c?c.positionFunction:null,Z=c?c.vertexFunction:null,_=null;this._useModelMaterial&&(_=b.material?b.material:this._setDefaultMaterial());for(var ca=new nh(this._shapeCounter,K,m,w,z,N,T,Z,_),ea=0;ea<a;ea++)this._insertNewParticle(this.nbParticles,ea,ca,K,f,g,h,j,J,C,c);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1},e.prototype._rebuildParticle=function(b,a){void 0===a&&(a=!1),this._resetCopy();var c=this._copy;b._model._positionFunction&&b._model._positionFunction(c,b.idx,b.idxInShape);var d=i.c.Matrix[0],f=i.c.Vector3[0],g=i.c.Vector3[1],h=i.c.Vector3[2],j=i.c.Vector3[3];c.getRotationMatrix(d),b.pivot.multiplyToRef(b.scaling,j),c.translateFromPivot?h.copyFromFloats(0,0,0):h.copyFrom(j);for(var m=b._model._shape,w=0;w<m.length;w++)f.copyFrom(m[w]),b._model._vertexFunction&&b._model._vertexFunction(c,f,w),f.multiplyInPlace(c.scaling).subtractInPlace(j),i.e.TransformCoordinatesToRef(f,d,g),g.addInPlace(h).addInPlace(c.position).toArray(this._positions32,b._pos+3*w);a&&(b.position.setAll(0),b.rotation.setAll(0),b.rotationQuaternion=null,b.scaling.setAll(1),b.uvs.setAll(0),b.pivot.setAll(0),b.translateFromPivot=!1,b.parentId=null)},e.prototype.rebuildMesh=function(b){void 0===b&&(b=!1);for(var a=0;a<this.particles.length;a++)this._rebuildParticle(this.particles[a],b);return this.mesh.updateVerticesData(ra.b.PositionKind,this._positions32,!1,!1),this},e.prototype.removeParticles=function(b,a){var c=a-b+1;if(!this._expandable||c<=0||c>=this.nbParticles||!this._updatable)return[];var d=this.particles,f=this.nbParticles;if(a<f-1)for(var g=a+1,h=d[g]._pos-d[b]._pos,j=d[g]._ind-d[b]._ind,m=g;m<f;m++){var w=d[m];w._pos-=h,w._ind-=j}var z=d.splice(b,c);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);for(var C=0,J=d.length,K=0;K<J;K++){var N=d[K],T=N._model,Z=T._shape,_=T._indices,ca=T._normals,ea=T._shapeColors,fa=T._shapeUV;N.idx=K,this._idxOfId[N.id]=K,this._meshBuilder(this._index,C,Z,this._positions,_,this._indices,fa,this._uvs,ea,this._colors,ca,this._normals,N.idx,N.idxInShape,null,T),this._index+=Z.length,C+=_.length}return this.nbParticles-=c,this._isNotBuilt=!0,z},e.prototype.insertParticlesFromArray=function(b){if(!this._expandable)return this;for(var a=0,c=b[0].shapeId,d=b.length,f=0;f<d;f++){var g=b[f],h=g._model,j=h._shape,m=h._indices,w=h._shapeUV,z=h._shapeColors,C=h._normals,J=!C;this.recomputeNormals=J||this.recomputeNormals;var K=g._boundingInfo,N=this._insertNewParticle(this.nbParticles,a,h,j,m,w,z,C,K,null,null);g.copyToRef(N),a++,c!=g.shapeId&&(c=g.shapeId,a=0)}return this._isNotBuilt=!0,this},e.prototype._insertNewParticle=function(b,a,c,d,f,g,h,j,m,w,z){var C=this._positions.length,J=this._indices.length,K=this._meshBuilder(this._index,J,d,this._positions,f,this._indices,g,this._uvs,h,this._colors,j,this._normals,b,a,z,c),N=null;return this._updatable&&((N=this._addParticle(this.nbParticles,this._lastParticleId,C,J,c,this._shapeCounter,a,m,w)).position.copyFrom(K.position),N.rotation.copyFrom(K.rotation),K.rotationQuaternion&&(N.rotationQuaternion?N.rotationQuaternion.copyFrom(K.rotationQuaternion):N.rotationQuaternion=K.rotationQuaternion.clone()),K.color&&(N.color?N.color.copyFrom(K.color):N.color=K.color.clone()),N.scaling.copyFrom(K.scaling),N.uvs.copyFrom(K.uvs),null!==K.materialIndex&&(N.materialIndex=K.materialIndex),this.expandable&&(this._idxOfId[N.id]=N.idx)),w||(this._index+=d.length,this.nbParticles++,this._lastParticleId++),N},e.prototype.setParticles=function(b,a,c){if(void 0===b&&(b=0),void 0===a&&(a=this.nbParticles-1),void 0===c&&(c=!0),!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(b,a,c);var d=i.c.Matrix[0],f=i.c.Matrix[1],g=this.mesh,h=this._colors32,j=this._positions32,m=this._normals32,w=this._uvs32,z=this._indices32,C=this._indices,J=this._fixedNormal32,K=i.c.Vector3,N=K[5].copyFromFloats(1,0,0),T=K[6].copyFromFloats(0,1,0),Z=K[7].copyFromFloats(0,0,1),_=K[8].setAll(Number.MAX_VALUE),ca=K[9].setAll(-Number.MAX_VALUE),ea=K[10].setAll(0);if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(f)),this.billboard){var fa=K[0];this._camera.getDirectionToRef(Ba.a.Z,fa),i.e.TransformNormalToRef(fa,f,Z),Z.normalize();var ka=this._camera.getViewMatrix(!0);i.e.TransformNormalFromFloatsToRef(ka.m[1],ka.m[5],ka.m[9],f,T),i.e.CrossToRef(T,Z,N),T.normalize(),N.normalize()}this._depthSort&&i.e.TransformCoordinatesToRef(this._camera.globalPosition,f,ea),i.a.IdentityToRef(d);var pa=0,va=0,sa=0,la=0,ta=0,Da=0,ua=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),a=a>=this.nbParticles?this.nbParticles-1:a,this._computeBoundingBox&&(0!=b||a!=this.nbParticles-1)){var Aa=this.mesh._boundingInfo;Aa&&(_.copyFrom(Aa.minimum),ca.copyFrom(Aa.maximum))}var za=(va=this.particles[b]._pos)/3|0;la=4*za,Da=2*za;for(var Fa=b;Fa<=a;Fa++){var La=this.particles[Fa];this.updateParticle(La);var Ta=La._model._shape,bb=La._model._shapeUV,Ra=La._rotationMatrix,Oa=La.position,Za=La.rotation,Va=La.scaling,$a=La._globalPosition;if(this._depthSort&&this._depthSortParticles){var fb=this.depthSortedParticles[Fa];fb.ind=La._ind,fb.indicesLength=La._model._indicesLength,fb.sqDistance=i.e.DistanceSquared(La.position,ea)}if(!La.alive||La._stillInvisible&&!La.isVisible)va+=3*(ua=Ta.length),la+=4*ua,Da+=2*ua;else{if(La.isVisible){La._stillInvisible=!1;var Ma=K[12];if(La.pivot.multiplyToRef(Va,Ma),this.billboard&&(Za.x=0,Za.y=0),(this._computeParticleRotation||this.billboard)&&La.getRotationMatrix(d),null!==La.parentId){var Wa=this.getParticleById(La.parentId);if(Wa){var ab=Wa._rotationMatrix,vb=Wa._globalPosition,rb=Oa.x*ab[1]+Oa.y*ab[4]+Oa.z*ab[7],ub=Oa.x*ab[0]+Oa.y*ab[3]+Oa.z*ab[6],Bb=Oa.x*ab[2]+Oa.y*ab[5]+Oa.z*ab[8];if($a.x=vb.x+ub,$a.y=vb.y+rb,$a.z=vb.z+Bb,this._computeParticleRotation||this.billboard){var jb=d.m;Ra[0]=jb[0]*ab[0]+jb[1]*ab[3]+jb[2]*ab[6],Ra[1]=jb[0]*ab[1]+jb[1]*ab[4]+jb[2]*ab[7],Ra[2]=jb[0]*ab[2]+jb[1]*ab[5]+jb[2]*ab[8],Ra[3]=jb[4]*ab[0]+jb[5]*ab[3]+jb[6]*ab[6],Ra[4]=jb[4]*ab[1]+jb[5]*ab[4]+jb[6]*ab[7],Ra[5]=jb[4]*ab[2]+jb[5]*ab[5]+jb[6]*ab[8],Ra[6]=jb[8]*ab[0]+jb[9]*ab[3]+jb[10]*ab[6],Ra[7]=jb[8]*ab[1]+jb[9]*ab[4]+jb[10]*ab[7],Ra[8]=jb[8]*ab[2]+jb[9]*ab[5]+jb[10]*ab[8]}}else La.parentId=null}else($a.x=Oa.x,$a.y=Oa.y,$a.z=Oa.z,this._computeParticleRotation||this.billboard)&&(jb=d.m,Ra[0]=jb[0],Ra[1]=jb[1],Ra[2]=jb[2],Ra[3]=jb[4],Ra[4]=jb[5],Ra[5]=jb[6],Ra[6]=jb[8],Ra[7]=jb[9],Ra[8]=jb[10]);var Eb=K[11];for(La.translateFromPivot?Eb.setAll(0):Eb.copyFrom(Ma),ua=0;ua<Ta.length;ua++){pa=va+3*ua,sa=la+4*ua,ta=Da+2*ua,(fa=K[0]).copyFrom(Ta[ua]),this._computeParticleVertex&&this.updateParticleVertex(La,fa,ua);var _b=fa.x*Va.x-Ma.x,Kb=fa.y*Va.y-Ma.y,cc=fa.z*Va.z-Ma.z;ub=_b*Ra[0]+Kb*Ra[3]+cc*Ra[6],rb=_b*Ra[1]+Kb*Ra[4]+cc*Ra[7],Bb=_b*Ra[2]+Kb*Ra[5]+cc*Ra[8],ub+=Eb.x,rb+=Eb.y,Bb+=Eb.z;var $b=j[pa]=$a.x+N.x*ub+T.x*rb+Z.x*Bb,Lb=j[pa+1]=$a.y+N.y*ub+T.y*rb+Z.y*Bb,bd=j[pa+2]=$a.z+N.z*ub+T.z*rb+Z.z*Bb;if(this._computeBoundingBox&&(_.minimizeInPlaceFromFloats($b,Lb,bd),ca.maximizeInPlaceFromFloats($b,Lb,bd)),!this._computeParticleVertex){var ee=J[pa],fe=J[pa+1],ge=J[pa+2],Sc=ee*Ra[0]+fe*Ra[3]+ge*Ra[6],wd=ee*Ra[1]+fe*Ra[4]+ge*Ra[7],he=ee*Ra[2]+fe*Ra[5]+ge*Ra[8];m[pa]=N.x*Sc+T.x*wd+Z.x*he,m[pa+1]=N.y*Sc+T.y*wd+Z.y*he,m[pa+2]=N.z*Sc+T.z*wd+Z.z*he}if(this._computeParticleColor&&La.color){var sc=La.color,xd=this._colors32;xd[sa]=sc.r,xd[sa+1]=sc.g,xd[sa+2]=sc.b,xd[sa+3]=sc.a}if(this._computeParticleTexture){var Mb=La.uvs;w[ta]=bb[2*ua]*(Mb.z-Mb.x)+Mb.x,w[ta+1]=bb[2*ua+1]*(Mb.w-Mb.y)+Mb.y}}}else for(La._stillInvisible=!0,ua=0;ua<Ta.length;ua++)(sa=la+4*ua,ta=Da+2*ua,j[pa=va+3*ua]=j[pa+1]=j[pa+2]=0,m[pa]=m[pa+1]=m[pa+2]=0,this._computeParticleColor&&La.color)&&(sc=La.color,h[sa]=sc.r,h[sa+1]=sc.g,h[sa+2]=sc.b,h[sa+3]=sc.a),this._computeParticleTexture&&(Mb=La.uvs,w[ta]=bb[2*ua]*(Mb.z-Mb.x)+Mb.x,w[ta+1]=bb[2*ua+1]*(Mb.w-Mb.y)+Mb.y);if(this._particlesIntersect){var yd=La._boundingInfo,Qf=yd.boundingBox,zb=yd.boundingSphere,zd=La._modelBoundingInfo;if(!this._bSphereOnly){var Ad=zd.boundingBox.vectors,ie=K[1],Fc=K[2];ie.setAll(Number.MAX_VALUE),Fc.setAll(-Number.MAX_VALUE);for(var cd=0;cd<8;cd++){var je=Ad[cd].x*Va.x,ke=Ad[cd].y*Va.y,dd=Ad[cd].z*Va.z,Bd=(ub=je*Ra[0]+ke*Ra[3]+dd*Ra[6],rb=je*Ra[1]+ke*Ra[4]+dd*Ra[7],Bb=je*Ra[2]+ke*Ra[5]+dd*Ra[8],Oa.x+N.x*ub+T.x*rb+Z.x*Bb),le=Oa.y+N.y*ub+T.y*rb+Z.y*Bb,Qe=Oa.z+N.z*ub+T.z*rb+Z.z*Bb;ie.minimizeInPlaceFromFloats(Bd,le,Qe),Fc.maximizeInPlaceFromFloats(Bd,le,Qe)}Qf.reConstruct(ie,Fc,g._worldMatrix)}var Re=zd.minimum.multiplyToRef(Va,K[1]),Se=zd.maximum.multiplyToRef(Va,K[2]),Te=Se.addToRef(Re,K[3]).scaleInPlace(.5).addInPlace($a),ed=Se.subtractToRef(Re,K[4]).scaleInPlace(.5*this._bSphereRadiusFactor),Cd=Te.subtractToRef(ed,K[1]),Ue=Te.addToRef(ed,K[2]);zb.reConstruct(Cd,Ue,g._worldMatrix)}va=pa+3,la=sa+4,Da=ta+2}}if(c){if(this._computeParticleColor&&g.updateVerticesData(ra.b.ColorKind,h,!1,!1),this._computeParticleTexture&&g.updateVerticesData(ra.b.UVKind,w,!1,!1),g.updateVerticesData(ra.b.PositionKind,j,!1,!1),!g.areNormalsFrozen||g.isFacetDataEnabled){if(this._computeParticleVertex||g.isFacetDataEnabled){var fd=g.isFacetDataEnabled?g.getFacetDataParameters():null;Xa.a.ComputeNormals(j,z,m,fd);for(var Nb=0;Nb<m.length;Nb++)J[Nb]=m[Nb]}g.areNormalsFrozen||g.updateVerticesData(ra.b.NormalKind,m,!1,!1)}if(this._depthSort&&this._depthSortParticles){var Dd=this.depthSortedParticles;Dd.sort(this._depthSortFunction);for(var me=Dd.length,ne=0,Rf=0;Rf<me;Rf++){var Qp=Dd[Rf].indicesLength,Rp=Dd[Rf].ind;for(Nb=0;Nb<Qp;Nb++)z[ne]=C[Rp+Nb],ne++}g.updateIndices(z)}}return this._computeBoundingBox&&(g._boundingInfo?g._boundingInfo.reConstruct(_,ca,g._worldMatrix):g._boundingInfo=new Kc.a(_,ca,g._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this.afterUpdateParticles(b,a,c),this},e.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},e.prototype.getParticleById=function(b){var a=this.particles[b];if(a&&a.id==b)return a;var c=this.particles,d=this._idxOfId[b];if(void 0!==d)return c[d];for(var f=0,g=this.nbParticles;f<g;){var h=c[f];if(h.id==b)return h;f++}return null},e.prototype.getParticlesByShapeId=function(b){var a=[];return this.getParticlesByShapeIdToRef(b,a),a},e.prototype.getParticlesByShapeIdToRef=function(b,a){a.length=0;for(var c=0;c<this.nbParticles;c++){var d=this.particles[c];d.shapeId==b&&a.push(d)}return this},e.prototype.computeSubMeshes=function(){if(!this.mesh||!this._multimaterialEnabled)return this;var b=this.depthSortedParticles;if(this.particles.length>0)for(var a=0;a<this.particles.length;a++){var c=this.particles[a];c.materialIndex||(c.materialIndex=0);var d=b[a];d.materialIndex=c.materialIndex,d.ind=c._ind,d.indicesLength=c._model._indicesLength}this._sortParticlesByMaterial();var f=this._indicesByMaterial,g=this._materialIndexes,h=this.mesh;h.subMeshes=[];for(var j=h.getTotalVertices(),m=0;m<g.length;m++){var w=f[m],z=f[m+1]-w,C=g[m];new Yd.b(C,0,j,w,z,h)}return this},e.prototype._sortParticlesByMaterial=function(){var b=[0];this._indicesByMaterial=b;var a=[];this._materialIndexes=a;var c=this.depthSortedParticles;c.sort(this._materialSortFunction);var d=c.length,f=this._indices32,g=this._indices,h=0,j=c[0].materialIndex;a.push(j);for(var m=0;m<d;m++){var w=c[m],z=w.indicesLength,C=w.ind;w.materialIndex!==j&&(j=w.materialIndex,b.push(h),a.push(j));for(var J=0;J<z;J++)f[h]=g[C+J],h++}return b.push(f.length),this._updatable&&this.mesh.updateIndices(f),this},e.prototype._setMaterialIndexesById=function(){this._materialIndexesById={};for(var b=0;b<this._materials.length;b++){var a=this._materials[b].uniqueId;this._materialIndexesById[a]=b}},e.prototype._filterUniqueMaterialId=function(b){return b.filter(function(a,c,d){return d.indexOf(a)===c})},e.prototype._setDefaultMaterial=function(){return this._defaultMaterial||(this._defaultMaterial=new Ab.a(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial},e.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},e.prototype.setVisibilityBox=function(b){var a=b/2;this.mesh._boundingInfo=new Kc.a(new i.e(-a,-a,-a),new i.e(a,a,a))},Object.defineProperty(e.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(b){this._alwaysVisible=b,this.mesh.alwaysSelectAsActiveMesh=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(b){this._isVisibilityBoxLocked=b,this.mesh.getBoundingInfo().isLocked=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(b){this._computeParticleRotation=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(b){this._computeParticleColor=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(b){this._computeParticleTexture=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(b){this._computeParticleVertex=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(b){this._computeBoundingBox=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(b){this._depthSortParticles=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expandable",{get:function(){return this._expandable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multimaterialEnabled",{get:function(){return this._multimaterialEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useModelMaterial",{get:function(){return this._useModelMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"materials",{get:function(){return this._materials},enumerable:!0,configurable:!0}),e.prototype.setMultiMaterial=function(b){this._materials=this._filterUniqueMaterialId(b),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new Td.a(this.name+"MultiMaterial",this._scene);for(var a=0;a<this._materials.length;a++)this._multimaterial.subMaterials.push(this._materials[a]);this.computeSubMeshes(),this.mesh.material=this._multimaterial},Object.defineProperty(e.prototype,"multimaterial",{get:function(){return this._multimaterial},set:function(b){this._multimaterial=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdateSubMeshes",{get:function(){return this._autoUpdateSubMeshes},set:function(b){this._autoUpdateSubMeshes=b},enumerable:!0,configurable:!0}),e.prototype.initParticles=function(){},e.prototype.recycleParticle=function(b){return b},e.prototype.updateParticle=function(b){return b},e.prototype.updateParticleVertex=function(b,a,c){return a},e.prototype.beforeUpdateParticles=function(b,a,c){},e.prototype.afterUpdateParticles=function(b,a,c){},e}(),Sk=function(){function e(b,a,c,d,f){this.idx=0,this.color=new G.b(1,1,1,1),this.position=i.e.Zero(),this.rotation=i.e.Zero(),this.uv=new i.d(0,0),this.velocity=i.e.Zero(),this.pivot=i.e.Zero(),this.translateFromPivot=!1,this._pos=0,this._ind=0,this.groupId=0,this.idxInGroup=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=i.e.Zero(),this.idx=b,this._group=a,this.groupId=c,this.idxInGroup=d,this._pcs=f}return Object.defineProperty(e.prototype,"size",{get:function(){return this.size},set:function(b){this.size=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(b){this.rotationQuaternion=b},enumerable:!0,configurable:!0}),e.prototype.intersectsMesh=function(b,a){if(!b._boundingInfo)return!1;if(a=a||!1)return b.getBoundingInfo().boundingSphere.intersectsPoint(this.position.add(this._pcs.mesh.position));var c,d,f,g,h,j;c=b.getBoundingInfo().boundingBox.maximumWorld.x,d=b.getBoundingInfo().boundingBox.minimumWorld.x,f=b.getBoundingInfo().boundingBox.maximumWorld.y,g=b.getBoundingInfo().boundingBox.minimumWorld.y,h=b.getBoundingInfo().boundingBox.maximumWorld.z,j=b.getBoundingInfo().boundingBox.minimumWorld.z;var m=this.position.x+this._pcs.mesh.position.x,w=this.position.y+this._pcs.mesh.position.y,z=this.position.z+this._pcs.mesh.position.z;return d<=m&&m<=c&&g<=w&&w<=f&&j<=z&&z<=h},e.prototype.getRotationMatrix=function(b){var a;if(this.rotationQuaternion)a=this.rotationQuaternion;else{a=i.c.Quaternion[0];var c=this.rotation;i.b.RotationYawPitchRollToRef(c.y,c.x,c.z,a)}a.toRotationMatrix(b)},e}(),Ef=function(e,b){this.groupID=e,this._positionFunction=b};!function(e){e[e.Color=2]="Color",e[e.UV=1]="UV",e[e.Random=0]="Random",e[e.Stated=3]="Stated"}(Zb||(Zb={}));var no=function(){function e(b,a,c,d){this.particles=new Array(),this.nbParticles=0,this.counter=0,this.vars={},this._promises=[],this._positions=new Array(),this._indices=new Array(),this._normals=new Array(),this._colors=new Array(),this._uvs=new Array(),this._updatable=!0,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._groups=new Array(),this._groupCounter=0,this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeBoundingBox=!1,this._isReady=!1,this.name=b,this._size=a,this._scene=c||U.a.LastCreatedScene,d&&void 0!==d.updatable?this._updatable=d.updatable:this._updatable=!0}return e.prototype.buildMeshAsync=function(){var b=this;return Promise.all(this._promises).then(function(){return b._isReady=!0,b._buildMesh()})},e.prototype._buildMesh=function(){0===this.nbParticles&&this.addPoints(1),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors);var b=new Xa.a();b.set(this._positions32,ra.b.PositionKind),this._uvs32.length>0&&b.set(this._uvs32,ra.b.UVKind);var a=0;this._colors32.length>0&&(a=1,b.set(this._colors32,ra.b.ColorKind));var c=new xa.a(this.name,this._scene);b.applyToMesh(c,this._updatable),this.mesh=c,this._positions=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0);var d=new Ab.a("point cloud material",this._scene);return d.emissiveColor=new G.a(a,a,a),d.disableLighting=!0,d.pointsCloud=!0,d.pointSize=this._size,c.material=d,new Promise(function(f){return f(c)})},e.prototype._addParticle=function(b,a,c,d){var f=new Sk(b,a,c,d,this);return this.particles.push(f),f},e.prototype._randomUnitVector=function(b){b.position=new i.e(Math.random(),Math.random(),Math.random()),b.color=new G.b(1,1,1,1)},e.prototype._getColorIndicesForCoord=function(b,a,c,d){var f=b._groupImageData,g=c*(4*d)+4*a,h=[g,g+1,g+2,g+3],j=h[1],m=h[2],w=h[3],z=f[h[0]],C=f[j],J=f[m],K=f[w];return new G.b(z/255,C/255,J/255,K)},e.prototype._setPointsColorOrUV=function(b,a,c,d,f,g,h){c&&b.updateFacetData();var j=2*b.getBoundingInfo().boundingSphere.radius,m=b.getVerticesData(ra.b.PositionKind),w=b.getIndices(),z=b.getVerticesData(ra.b.UVKind),C=b.getVerticesData(ra.b.ColorKind),J=i.e.Zero();b.computeWorldMatrix();var K=b.getWorldMatrix();if(!K.isIdentity())for(var N=0;N<m.length/3;N++)i.e.TransformCoordinatesFromFloatsToRef(m[3*N],m[3*N+1],m[3*N+2],K,J),m[3*N]=J.x,m[3*N+1]=J.y,m[3*N+2]=J.z;var T,Z,_=0,ca=0,ea=0,fa=0,ka=0,pa=0,va=0,sa=0,la=0,ta=0,Da=0,ua=0,Aa=0,za=0,Fa=i.e.Zero(),La=i.e.Zero(),Ta=i.e.Zero(),bb=i.e.Zero(),Ra=i.e.Zero(),Oa=0,Za=0,Va=0,$a=0,fb=0,Ma=0,Wa=i.d.Zero(),ab=i.d.Zero(),vb=i.d.Zero(),rb=i.d.Zero(),ub=i.d.Zero(),Bb=0,jb=0,Eb=0,_b=0,Kb=0,cc=0,$b=0,Lb=0,bd=0,ee=0,fe=0,ge=0,Sc=i.f.Zero(),wd=i.f.Zero(),he=i.f.Zero(),sc=i.f.Zero(),xd=i.f.Zero(),Mb=0,yd=0;h=h||0;var Qf,zb=new i.f(0,0,0,0),zd=i.e.Zero(),Ad=i.e.Zero(),ie=i.e.Zero(),Fc=0,cd=i.e.Zero(),je=0,ke=0,dd=new Rb.a(i.e.Zero(),new i.e(1,0,0)),Bd=i.e.Zero();for(ca=0;ca<w.length/3;ca++){var le,Qe,Re,Se,Te,ed,Cd,Ue;ea=w[3*ca],fa=w[3*ca+1],ka=w[3*ca+2],pa=m[3*ea],va=m[3*ea+1],sa=m[3*ea+2],la=m[3*fa],ta=m[3*fa+1],Da=m[3*fa+2],ua=m[3*ka],Aa=m[3*ka+1],za=m[3*ka+2],Fa.set(pa,va,sa),La.set(la,ta,Da),Ta.set(ua,Aa,za),La.subtractToRef(Fa,bb),Ta.subtractToRef(La,Ra),z&&(Oa=z[2*ea],Za=z[2*ea+1],Va=z[2*fa],$a=z[2*fa+1],fb=z[2*ka],Ma=z[2*ka+1],Wa.set(Oa,Za),ab.set(Va,$a),vb.set(fb,Ma),ab.subtractToRef(Wa,rb),vb.subtractToRef(ab,ub)),C&&d&&(Bb=C[4*ea],jb=C[4*ea+1],Eb=C[4*ea+2],_b=C[4*ea+3],Kb=C[4*fa],cc=C[4*fa+1],$b=C[4*fa+2],Lb=C[4*fa+3],bd=C[4*ka],ee=C[4*ka+1],fe=C[4*ka+2],ge=C[4*ka+3],Sc.set(Bb,jb,Eb,_b),wd.set(Kb,cc,$b,Lb),he.set(bd,ee,fe,ge),wd.subtractToRef(Sc,sc),he.subtractToRef(wd,xd));for(var fd,Nb,Dd=new G.a(0,0,0),me=new G.a(0,0,0),ne=0;ne<a._groupDensity[ca];ne++)_=this.particles.length,this._addParticle(_,a,this._groupCounter,ca+ne),Nb=this.particles[_],Mb=aa.a.RandomRange(0,1),yd=aa.a.RandomRange(0,1),T=Fa.add(bb.scale(Mb)).add(Ra.scale(Mb*yd)),c&&(zd=b.getFacetNormal(ca).normalize().scale(-1),Ad=bb.clone().normalize(),ie=i.e.Cross(zd,Ad),Fc=aa.a.RandomRange(0,2*Math.PI),cd=Ad.scale(Math.cos(Fc)).add(ie.scale(Math.sin(Fc))),Fc=aa.a.RandomRange(.1,Math.PI/2),Bd=cd.scale(Math.cos(Fc)).add(zd.scale(Math.sin(Fc))),dd.origin=T.add(Bd.scale(1e-05)),dd.direction=Bd,dd.length=j,(Qf=dd.intersectsMesh(b)).hit&&(ke=Qf.pickedPoint.subtract(T).length(),je=aa.a.RandomRange(0,1)*ke,T.addInPlace(Bd.scale(je)))),Nb.position=T.clone(),this._positions.push(Nb.position.x,Nb.position.y,Nb.position.z),void 0!==d?z&&(Z=Wa.add(rb.scale(Mb)).add(ub.scale(Mb*yd)),d?f&&null!==a._groupImageData?(le=a._groupImgWidth,Qe=a._groupImgHeight,fd=this._getColorIndicesForCoord(a,Math.round(Z.x*le),Math.round(Z.y*Qe),le),Nb.color=fd,this._colors.push(fd.r,fd.g,fd.b,fd.a)):C?(zb=Sc.add(sc.scale(Mb)).add(xd.scale(Mb*yd)),Nb.color=new G.b(zb.x,zb.y,zb.z,zb.w),this._colors.push(zb.x,zb.y,zb.z,zb.w)):(zb=Sc.set(Math.random(),Math.random(),Math.random(),1),Nb.color=new G.b(zb.x,zb.y,zb.z,zb.w),this._colors.push(zb.x,zb.y,zb.z,zb.w)):(Nb.uv=Z.clone(),this._uvs.push(Nb.uv.x,Nb.uv.y))):(g?(Dd.set(g.r,g.g,g.b),Re=aa.a.RandomRange(-h,h),Se=aa.a.RandomRange(-h,h),Te=(Ue=Dd.toHSV()).r,(ed=Ue.g+Re)<0&&(ed=0),ed>1&&(ed=1),(Cd=Ue.b+Se)<0&&(Cd=0),Cd>1&&(Cd=1),G.a.HSVtoRGBToRef(Te,ed,Cd,me),zb.set(me.r,me.g,me.b,1)):zb=Sc.set(Math.random(),Math.random(),Math.random(),1),Nb.color=new G.b(zb.x,zb.y,zb.z,zb.w),this._colors.push(zb.x,zb.y,zb.z,zb.w))}},e.prototype._colorFromTexture=function(b,a,c){var d=this;if(null===b.material)return k.a.Warn(b.name+"has no material."),a._groupImageData=null,void this._setPointsColorOrUV(b,a,c,!0,!1);var f=b.material.getActiveTextures();if(0===f.length)return k.a.Warn(b.name+"has no useable texture."),a._groupImageData=null,void this._setPointsColorOrUV(b,a,c,!0,!1);var g=b.clone();g.setEnabled(!1),this._promises.push(new Promise(function(h){hc.a.WhenAllReady(f,function(){var j=a._textureNb;return j<0&&(j=0),j>f.length-1&&(j=f.length-1),a._groupImageData=f[j].readPixels(),a._groupImgWidth=f[j].getSize().width,a._groupImgHeight=f[j].getSize().height,d._setPointsColorOrUV(g,a,c,!0,!0),g.dispose(),h()})}))},e.prototype._calculateDensity=function(b,a,c){for(var d,f,g,h,j,m,w,z,C,J,K,N,T,Z,_,ca,ea,fa=new Array(),ka=i.e.Zero(),pa=i.e.Zero(),va=i.e.Zero(),sa=i.e.Zero(),la=i.e.Zero(),ta=i.e.Zero(),Da=new Array(),ua=0,Aa=c.length/3,za=0;za<Aa;za++)d=c[3*za],f=c[3*za+1],g=c[3*za+2],h=a[3*d],j=a[3*d+1],m=a[3*d+2],w=a[3*f],z=a[3*f+1],C=a[3*f+2],J=a[3*g],K=a[3*g+1],N=a[3*g+2],ka.set(h,j,m),pa.set(w,z,C),va.set(J,K,N),pa.subtractToRef(ka,sa),va.subtractToRef(pa,la),va.subtractToRef(ka,ta),ca=((T=sa.length())+(Z=la.length())+(_=ta.length()))/2,ua+=ea=Math.sqrt(ca*(ca-T)*(ca-Z)*(ca-_)),Da[za]=ea;var Fa=0;for(za=0;za<Aa;za++)fa[za]=Math.floor(b*Da[za]/ua),Fa+=fa[za];var La=b-Fa,Ta=Math.floor(La/Aa),bb=La%Aa;for(Ta>0&&(fa=fa.map(function(Ra){return Ra+Ta})),za=0;za<bb;za++)fa[za]+=1;return fa},e.prototype.addPoints=function(b,a){void 0===a&&(a=this._randomUnitVector);for(var c,d=new Ef(this._groupCounter,a),f=this.nbParticles,g=0;g<b;g++)c=this._addParticle(f,d,this._groupCounter,g),d&&d._positionFunction&&d._positionFunction(c,f,g),this._positions.push(c.position.x,c.position.y,c.position.z),c.color&&this._colors.push(c.color.r,c.color.g,c.color.b,c.color.a),c.uv&&this._uvs.push(c.uv.x,c.uv.y),f++;return this.nbParticles+=b,this._groupCounter++,this._groupCounter},e.prototype.addSurfacePoints=function(b,a,c,d,f){var g=c||Zb.Random;(isNaN(g)||g<0||g>3)&&(g=Zb.Random);var h=b.getVerticesData(ra.b.PositionKind),j=b.getIndices();this._groups.push(this._groupCounter);var m=new Ef(this._groupCounter,null);switch(m._groupDensity=this._calculateDensity(a,h,j),g===Zb.Color?m._textureNb=d||0:d=d||new G.b(1,1,1,1),g){case Zb.Color:this._colorFromTexture(b,m,!1);break;case Zb.UV:this._setPointsColorOrUV(b,m,!1,!1,!1);break;case Zb.Random:this._setPointsColorOrUV(b,m,!1);break;case Zb.Stated:this._setPointsColorOrUV(b,m,!1,void 0,void 0,d,f)}return this.nbParticles+=a,this._groupCounter++,this._groupCounter-1},e.prototype.addVolumePoints=function(b,a,c,d,f){var g=c||Zb.Random;(isNaN(g)||g<0||g>3)&&(g=Zb.Random);var h=b.getVerticesData(ra.b.PositionKind),j=b.getIndices();this._groups.push(this._groupCounter);var m=new Ef(this._groupCounter,null);switch(m._groupDensity=this._calculateDensity(a,h,j),g===Zb.Color?m._textureNb=d||0:d=d||new G.b(1,1,1,1),g){case Zb.Color:this._colorFromTexture(b,m,!0);break;case Zb.UV:this._setPointsColorOrUV(b,m,!0,!1,!1);break;case Zb.Random:this._setPointsColorOrUV(b,m,!0);break;case Zb.Stated:this._setPointsColorOrUV(b,m,!0,void 0,void 0,d,f)}return this.nbParticles+=a,this._groupCounter++,this._groupCounter-1},e.prototype.setParticles=function(b,a,c){if(void 0===b&&(b=0),void 0===a&&(a=this.nbParticles-1),void 0===c&&(c=!0),!this._updatable||!this._isReady)return this;this.beforeUpdateParticles(b,a,c);var d=i.c.Matrix[0],f=this.mesh,g=this._colors32,h=this._positions32,j=this._uvs32,m=i.c.Vector3,w=m[5].copyFromFloats(1,0,0),z=m[6].copyFromFloats(0,1,0),C=m[7].copyFromFloats(0,0,1),J=m[8].setAll(Number.MAX_VALUE),K=m[9].setAll(-Number.MAX_VALUE);i.a.IdentityToRef(d);var N=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),a=a>=this.nbParticles?this.nbParticles-1:a,this._computeBoundingBox&&(0!=b||a!=this.nbParticles-1)){var T=this.mesh._boundingInfo;T&&(J.copyFrom(T.minimum),K.copyFrom(T.maximum))}N=0;for(var Z=0,_=0,ca=0,ea=b;ea<=a;ea++){var fa=this.particles[ea];Z=3*(N=fa.idx),_=4*N,ca=2*N,this.updateParticle(fa);var ka=fa._rotationMatrix,pa=fa.position,va=fa._globalPosition;if(this._computeParticleRotation&&fa.getRotationMatrix(d),null!==fa.parentId){var sa=this.particles[fa.parentId],la=sa._rotationMatrix,ta=sa._globalPosition,Da=pa.x*la[1]+pa.y*la[4]+pa.z*la[7],ua=pa.x*la[0]+pa.y*la[3]+pa.z*la[6],Aa=pa.x*la[2]+pa.y*la[5]+pa.z*la[8];if(va.x=ta.x+ua,va.y=ta.y+Da,va.z=ta.z+Aa,this._computeParticleRotation){var za=d.m;ka[0]=za[0]*la[0]+za[1]*la[3]+za[2]*la[6],ka[1]=za[0]*la[1]+za[1]*la[4]+za[2]*la[7],ka[2]=za[0]*la[2]+za[1]*la[5]+za[2]*la[8],ka[3]=za[4]*la[0]+za[5]*la[3]+za[6]*la[6],ka[4]=za[4]*la[1]+za[5]*la[4]+za[6]*la[7],ka[5]=za[4]*la[2]+za[5]*la[5]+za[6]*la[8],ka[6]=za[8]*la[0]+za[9]*la[3]+za[10]*la[6],ka[7]=za[8]*la[1]+za[9]*la[4]+za[10]*la[7],ka[8]=za[8]*la[2]+za[9]*la[5]+za[10]*la[8]}}else(va.x=0,va.y=0,va.z=0,this._computeParticleRotation)&&(za=d.m,ka[0]=za[0],ka[1]=za[1],ka[2]=za[2],ka[3]=za[4],ka[4]=za[5],ka[5]=za[6],ka[6]=za[8],ka[7]=za[9],ka[8]=za[10]);var Fa=m[11];fa.translateFromPivot?Fa.setAll(0):Fa.copyFrom(fa.pivot);var La=m[0];La.copyFrom(fa.position);var Ta=La.x-fa.pivot.x,bb=La.y-fa.pivot.y,Ra=La.z-fa.pivot.z,Oa=Ta*ka[0]+bb*ka[3]+Ra*ka[6],Za=Ta*ka[1]+bb*ka[4]+Ra*ka[7],Va=Ta*ka[2]+bb*ka[5]+Ra*ka[8];Oa+=Fa.x,Za+=Fa.y,Va+=Fa.z;var $a=h[Z]=va.x+w.x*Oa+z.x*Za+C.x*Va,fb=h[Z+1]=va.y+w.y*Oa+z.y*Za+C.y*Va,Ma=h[Z+2]=va.z+w.z*Oa+z.z*Za+C.z*Va;if(this._computeBoundingBox&&(J.minimizeInPlaceFromFloats($a,fb,Ma),K.maximizeInPlaceFromFloats($a,fb,Ma)),this._computeParticleColor&&fa.color){var Wa=fa.color,ab=this._colors32;ab[_]=Wa.r,ab[_+1]=Wa.g,ab[_+2]=Wa.b,ab[_+3]=Wa.a}if(this._computeParticleTexture&&fa.uv){var vb=fa.uv,rb=this._uvs32;rb[ca]=vb.x,rb[ca+1]=vb.y}}return c&&(this._computeParticleColor&&f.updateVerticesData(ra.b.ColorKind,g,!1,!1),this._computeParticleTexture&&f.updateVerticesData(ra.b.UVKind,j,!1,!1),f.updateVerticesData(ra.b.PositionKind,h,!1,!1)),this._computeBoundingBox&&(f._boundingInfo?f._boundingInfo.reConstruct(J,K,f._worldMatrix):f._boundingInfo=new Kc.a(J,K,f._worldMatrix)),this.afterUpdateParticles(b,a,c),this},e.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._uvs32=null,this._colors32=null},e.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},e.prototype.setVisibilityBox=function(b){var a=b/2;this.mesh._boundingInfo=new Kc.a(new i.e(-a,-a,-a),new i.e(a,a,a))},Object.defineProperty(e.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(b){this._alwaysVisible=b,this.mesh.alwaysSelectAsActiveMesh=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleRotation",{set:function(b){this._computeParticleRotation=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(b){this._computeParticleColor=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(b){this._computeParticleTexture=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(b){this._computeBoundingBox=b},enumerable:!0,configurable:!0}),e.prototype.initParticles=function(){},e.prototype.recycleParticle=function(b){return b},e.prototype.updateParticle=function(b){return b},e.prototype.beforeUpdateParticles=function(b,a,c){},e.prototype.afterUpdateParticles=function(b,a,c){},e}();wa.a.prototype.getPhysicsEngine=function(){return this._physicsEngine},wa.a.prototype.enablePhysics=function(e,b){if(void 0===e&&(e=null),this._physicsEngine)return!0;var a=this._getComponent(_a.a.NAME_PHYSICSENGINE);a||(a=new Tk(this),this._addComponent(a));try{return this._physicsEngine=new Ud(e,b),this._physicsTimeAccumulator=0,!0}catch(c){return k.a.Error(c.message),!1}},wa.a.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},wa.a.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},wa.a.prototype.deleteCompoundImpostor=function(e){var b=e.parts[0].mesh;b.physicsImpostor&&(b.physicsImpostor.dispose(),b.physicsImpostor=null)},wa.a.prototype._advancePhysicsEngineStep=function(e){if(this._physicsEngine){var b=this._physicsEngine.getSubTimeStep();if(b>0)for(this._physicsTimeAccumulator+=e;this._physicsTimeAccumulator>b;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(b/1000),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=b;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1000),this.onAfterPhysicsObservable.notifyObservers(this)}},Object.defineProperty(qb.a.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(e){var b=this;this._physicsImpostor!==e&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=e,e&&(this._disposePhysicsObserver=this.onDisposeObservable.add(function(){b.physicsImpostor&&(b.physicsImpostor.dispose(),b.physicsImpostor=null)})))},enumerable:!0,configurable:!0}),qb.a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},qb.a.prototype.applyImpulse=function(e,b){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(e,b),this):this},qb.a.prototype.setPhysicsLinkWith=function(e,b,a,c){return this.physicsImpostor&&e.physicsImpostor?(this.physicsImpostor.createJoint(e.physicsImpostor,Db.e.HingeJoint,{mainPivot:b,connectedPivot:a,nativeParams:c}),this):this};var Ne,ae,Tk=function(){function e(b){var a=this;this.name=_a.a.NAME_PHYSICSENGINE,this.scene=b,this.scene.onBeforePhysicsObservable=new I.c(),this.scene.onAfterPhysicsObservable=new I.c(),this.scene.getDeterministicFrameTime=function(){return a.scene._physicsEngine?1000*a.scene._physicsEngine.getTimeStep():1000/60}}return e.prototype.register=function(){},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},e}(),oo=function(){function e(b){this._scene=b,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||k.a.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return e.prototype.applyRadialExplosionImpulse=function(b,a,c,d){if(!this._physicsEngine)return k.a.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var f=this._physicsEngine.getImpostors();if(0===f.length)return null;"number"==typeof a&&((a=new be()).radius=a,a.strength=c||a.strength,a.falloff=d||a.falloff);var g=new Uk(this._scene,a),h=Array();return f.forEach(function(j){var m=g.getImpostorHitData(j,b);m&&(j.applyImpulse(m.force,m.contactPoint),h.push({impostor:j,hitData:m}))}),g.triggerAffectedImpostorsCallback(h),g.dispose(!1),g},e.prototype.applyRadialExplosionForce=function(b,a,c,d){if(!this._physicsEngine)return k.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var f=this._physicsEngine.getImpostors();if(0===f.length)return null;"number"==typeof a&&((a=new be()).radius=a,a.strength=c||a.strength,a.falloff=d||a.falloff);var g=new Uk(this._scene,a),h=Array();return f.forEach(function(j){var m=g.getImpostorHitData(j,b);m&&(j.applyForce(m.force,m.contactPoint),h.push({impostor:j,hitData:m}))}),g.triggerAffectedImpostorsCallback(h),g.dispose(!1),g},e.prototype.gravitationalField=function(b,a,c,d){if(!this._physicsEngine)return k.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof a&&((a=new be()).radius=a,a.strength=c||a.strength,a.falloff=d||a.falloff);var f=new po(this,this._scene,b,a);return f.dispose(!1),f},e.prototype.updraft=function(b,a,c,d,f){if(!this._physicsEngine)return k.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof a&&((a=new oh()).radius=a,a.strength=c||a.strength,a.height=d||a.height,a.updraftMode=f||a.updraftMode);var g=new qo(this._scene,b,a);return g.dispose(!1),g},e.prototype.vortex=function(b,a,c,d){if(!this._physicsEngine)return k.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof a&&((a=new ph()).radius=a,a.strength=c||a.strength,a.height=d||a.height);var f=new ro(this._scene,b,a);return f.dispose(!1),f},e}(),Uk=function(){function e(b,a){this._scene=b,this._options=a,this._dataFetched=!1,this._options=Object(l.a)(Object(l.a)({},new be()),this._options)}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.getImpostorHitData=function(b,a){if(0===b.mass)return null;if(!this._intersectsWithSphere(b,a,this._options.radius))return null;if("Mesh"!==b.object.getClassName()&&"InstancedMesh"!==b.object.getClassName())return null;var c=b.getObjectCenter().subtract(a),d=new Rb.a(a,c,this._options.radius).intersectsMesh(b.object).pickedPoint;if(!d)return null;var f=i.e.Distance(a,d);if(f>this._options.radius)return null;var g=this._options.falloff===Ne.Constant?this._options.strength:this._options.strength*(1-f/this._options.radius);return{force:c.multiplyByFloats(g,g,g),contactPoint:d,distanceFromOrigin:f}},e.prototype.triggerAffectedImpostorsCallback=function(b){this._options.affectedImpostorsCallback&&this._options.affectedImpostorsCallback(b)},e.prototype.dispose=function(b){var a=this;void 0===b&&(b=!0),b?this._sphere.dispose():setTimeout(function(){a._dataFetched||a._sphere.dispose()},0)},e.prototype._prepareSphere=function(){this._sphere||(this._sphere=jc.a.CreateSphere("radialExplosionEventSphere",this._options.sphere,this._scene),this._sphere.isVisible=!1)},e.prototype._intersectsWithSphere=function(b,a,c){var d=b.object;return this._prepareSphere(),this._sphere.position=a,this._sphere.scaling=new i.e(2*c,2*c,2*c),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(d,!0)},e}(),po=function(){function e(b,a,c,d){this._physicsHelper=b,this._scene=a,this._origin=c,this._options=d,this._dataFetched=!1,this._options=Object(l.a)(Object(l.a)({},new be()),this._options),this._tickCallback=this._tick.bind(this),this._options.strength=-1*this._options.strength}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(b){var a=this;void 0===b&&(b=!0),b?this._sphere.dispose():setTimeout(function(){a._dataFetched||a._sphere.dispose()},0)},e.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);else{var b=this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);b&&(this._sphere=b.getData().sphere.clone("radialExplosionEventSphereClone"))}},e}(),qo=function(){function e(b,a,c){this._scene=b,this._origin=a,this._options=c,this._originTop=i.e.Zero(),this._originDirection=i.e.Zero(),this._cylinderPosition=i.e.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=Object(l.a)(Object(l.a)({},new oh()),this._options),this._origin.addToRef(new i.e(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new i.e(0,this._options.height,0),this._originTop),this._options.updraftMode===ae.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(b){var a=this;void 0===b&&(b=!0),this._cylinder&&(b?this._cylinder.dispose():setTimeout(function(){a._dataFetched||a._cylinder.dispose()},0))},e.prototype.getImpostorHitData=function(b){if(0===b.mass)return null;if(!this._intersectsWithCylinder(b))return null;var a=b.getObjectCenter();if(this._options.updraftMode===ae.Perpendicular)var c=this._originDirection;else c=a.subtract(this._originTop);var d=i.e.Distance(this._origin,a),f=-1*this._options.strength;return{force:c.multiplyByFloats(f,f,f),contactPoint:a,distanceFromOrigin:d}},e.prototype._tick=function(){var b=this;this._physicsEngine.getImpostors().forEach(function(a){var c=b.getImpostorHitData(a);c&&a.applyForce(c.force,c.contactPoint)})},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=md.a.CreateCylinder("updraftEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(b){var a=b.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(a,!0)},e}(),ro=function(){function e(b,a,c){this._scene=b,this._origin=a,this._options=c,this._originTop=i.e.Zero(),this._cylinderPosition=i.e.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=Object(l.a)(Object(l.a)({},new ph()),this._options),this._origin.addToRef(new i.e(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new i.e(0,this._options.height,0),this._originTop),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(b){var a=this;void 0===b&&(b=!0),b?this._cylinder.dispose():setTimeout(function(){a._dataFetched||a._cylinder.dispose()},0)},e.prototype.getImpostorHitData=function(b){if(0===b.mass)return null;if(!this._intersectsWithCylinder(b))return null;if("Mesh"!==b.object.getClassName()&&"InstancedMesh"!==b.object.getClassName())return null;var a=b.getObjectCenter(),c=new i.e(this._origin.x,a.y,this._origin.z),d=a.subtract(c),f=new Rb.a(c,d,this._options.radius).intersectsMesh(b.object),g=f.pickedPoint;if(!g)return null;var h=f.distance/this._options.radius,j=g.normalize();if(h>this._options.centripetalForceThreshold&&(j=j.negate()),h>this._options.centripetalForceThreshold)var m=j.x*this._options.centripetalForceMultiplier,w=j.y*this._options.updraftForceMultiplier,z=j.z*this._options.centripetalForceMultiplier;else{var C=i.e.Cross(c,a).normalize();m=(C.x+j.x)*this._options.centrifugalForceMultiplier,w=this._originTop.y*this._options.updraftForceMultiplier,z=(C.z+j.z)*this._options.centrifugalForceMultiplier}var J=new i.e(m,w,z);return{force:J=J.multiplyByFloats(this._options.strength,this._options.strength,this._options.strength),contactPoint:a,distanceFromOrigin:h}},e.prototype._tick=function(){var b=this;this._physicsEngine.getImpostors().forEach(function(a){var c=b.getImpostorHitData(a);c&&a.applyForce(c.force,c.contactPoint)})},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=md.a.CreateCylinder("vortexEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(b){var a=b.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(a,!0)},e}(),be=function(){this.radius=5,this.strength=10,this.falloff=Ne.Constant,this.sphere={segments:32,diameter:1}},oh=function(){this.radius=5,this.strength=10,this.height=10,this.updraftMode=ae.Center},ph=function(){this.radius=5,this.strength=10,this.height=10,this.centripetalForceThreshold=.7,this.centripetalForceMultiplier=5,this.centrifugalForceMultiplier=.5,this.updraftForceMultiplier=.02};!function(e){e[e.Constant=0]="Constant",e[e.Linear=1]="Linear"}(Ne||(Ne={})),function(e){e[e.Center=0]="Center",e[e.Perpendicular=1]="Perpendicular"}(ae||(ae={}));var so=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float degree;
void main(void)
{
vec3 color=texture2D(textureSampler,vUV).rgb;
float luminance=dot(color,vec3(0.3,0.59,0.11));
vec3 blackAndWhite=vec3(luminance,luminance,luminance);
gl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);
}`;Pa.a.ShadersStore.blackAndWhitePixelShader=so;var to=function(e){function b(a,c,d,f,g,h){var j=e.call(this,a,"blackAndWhite",["degree"],null,c,d,f,g,h)||this;return j.degree=1,j.onApplyObservable.add(function(m){m.setFloat("degree",j.degree)}),j}return Object(l.d)(b,e),b}(gb),pb=function(){function e(b,a,c,d){this._name=a,this._singleInstance=d||!0,this._getPostProcesses=c,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var b in this._postProcesses)if(this._postProcesses.hasOwnProperty(b)){for(var a=this._postProcesses[b],c=0;c<a.length;c++)if(!a[c].isSupported)return!1}return!0},enumerable:!0,configurable:!0}),e.prototype._update=function(){},e.prototype._attachCameras=function(b){var a,c=this,d=Qa.b.MakeArray(b||this._cameras);if(d)for(var f=0;f<d.length;f++){var g=d[f],h=g.name;if(a=this._singleInstance?0:h,!this._postProcesses[a]){var j=this._getPostProcesses();j&&(this._postProcesses[a]=Array.isArray(j)?j:[j])}this._indicesForCamera[h]||(this._indicesForCamera[h]=[]),this._postProcesses[a].forEach(function(m){var w=g.attachPostProcess(m);c._indicesForCamera[h].push(w)}),this._cameras[h]||(this._cameras[h]=g)}},e.prototype._detachCameras=function(b){var a=Qa.b.MakeArray(b||this._cameras);if(a)for(var c=0;c<a.length;c++){var d=a[c],f=d.name,g=this._postProcesses[this._singleInstance?0:f];g&&g.forEach(function(h){d.detachPostProcess(h)}),this._cameras[f]&&(this._cameras[f]=null)}},e.prototype._enable=function(b){var a=this,c=Qa.b.MakeArray(b||this._cameras);if(c)for(var d=0;d<c.length;d++)for(var f=c[d],g=f.name,h=0;h<this._indicesForCamera[g].length;h++)void 0!==f._postProcesses[this._indicesForCamera[g][h]]&&null!==f._postProcesses[this._indicesForCamera[g][h]]||this._postProcesses[this._singleInstance?0:g].forEach(function(j){c[d].attachPostProcess(j,a._indicesForCamera[g][h])})},e.prototype._disable=function(b){var a=Qa.b.MakeArray(b||this._cameras);if(a)for(var c=0;c<a.length;c++){var d=a[c],f=d.name;this._postProcesses[this._singleInstance?0:f].forEach(function(g){d.detachPostProcess(g)})}},e.prototype.getPostProcesses=function(b){return this._singleInstance?this._postProcesses[0]:b?this._postProcesses[b.name]:null},e}(),uo=`#include<helperFunctions>

varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float threshold;
uniform float exposure;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
float luma=getLuminance(gl_FragColor.rgb*exposure);
gl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;
}`;Pa.a.ShadersStore.extractHighlightsPixelShader=uo;var Vk=function(e){function b(a,c,d,f,g,h,j,m){void 0===j&&(j=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1);var w=e.call(this,a,"extractHighlights",["threshold","exposure"],null,c,d,f,g,h,null,j,void 0,null,m)||this;return w.threshold=.9,w._exposure=1,w._inputPostProcess=null,w.onApplyObservable.add(function(z){w._inputPostProcess&&z.setTextureFromPostProcess("textureSampler",w._inputPostProcess),z.setFloat("threshold",Math.pow(w.threshold,kb.b)),z.setFloat("exposure",w._exposure)}),w}return Object(l.d)(b,e),b}(gb),vo=`uniform sampler2D textureSampler;
uniform sampler2D bloomBlur;
varying vec2 vUV;
uniform float bloomWeight;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec3 blurred=texture2D(bloomBlur,vUV).rgb;
gl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight);
}
`;Pa.a.ShadersStore.bloomMergePixelShader=vo;var Wk=function(e){function b(a,c,d,f,g,h,j,m,w,z,C){void 0===z&&(z=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===C&&(C=!1);var J=e.call(this,a,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],g,h,j,m,w,null,z,void 0,null,!0)||this;return J.weight=f,J.onApplyObservable.add(function(K){K.setTextureFromPostProcess("textureSampler",c),K.setTextureFromPostProcessOutput("bloomBlur",d),K.setFloat("bloomWeight",J.weight)}),C||J.updateEffect(),J}return Object(l.d)(b,e),b}(gb),qh=function(e){function b(a,c,d,f,g,h){void 0===g&&(g=0),void 0===h&&(h=!1);var j=e.call(this,a.getEngine(),"bloom",function(){return j._effects},!0)||this;return j.bloomScale=c,j._effects=[],j._downscale=new Vk("highlights",1,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,g,h),j._blurX=new Xb("horizontal blur",new i.d(1,0),10,c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,g,void 0,h),j._blurX.alwaysForcePOT=!0,j._blurX.autoClear=!1,j._blurY=new Xb("vertical blur",new i.d(0,1),10,c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,g,void 0,h),j._blurY.alwaysForcePOT=!0,j._blurY.autoClear=!1,j.kernel=f,j._effects=[j._downscale,j._blurX,j._blurY],j._merge=new Wk("bloomMerge",j._downscale,j._blurY,d,c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,g,h),j._merge.autoClear=!1,j._effects.push(j._merge),j}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(a){this._downscale.threshold=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"weight",{get:function(){return this._merge.weight},set:function(a){this._merge.weight=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(a){this._blurX.kernel=a*this.bloomScale,this._blurY.kernel=a*this.bloomScale},enumerable:!0,configurable:!0}),b.prototype.disposeEffects=function(a){for(var c=0;c<this._effects.length;c++)this._effects[c].dispose(a)},b.prototype._updateEffects=function(){for(var a=0;a<this._effects.length;a++)this._effects[a].updateEffect()},b.prototype._isReady=function(){for(var a=0;a<this._effects.length;a++)if(!this._effects[a].isReady())return!1;return!0},b}(pb),wo=`
uniform sampler2D textureSampler;

uniform float chromatic_aberration;
uniform float radialIntensity;
uniform vec2 direction;
uniform vec2 centerPosition;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;
void main(void)
{
vec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);
vec2 directionOfEffect=direction;
if(directionOfEffect.x == 0. && directionOfEffect.y == 0.){
directionOfEffect=normalize(centered_screen_pos);
}
float radius2=centered_screen_pos.x*centered_screen_pos.x
+centered_screen_pos.y*centered_screen_pos.y;
float radius=sqrt(radius2);
vec4 original=texture2D(textureSampler,vUV);

vec3 ref_indices=vec3(-0.3,0.0,0.3);
float ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;
float ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;

vec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);
vec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);
vec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);
original.r=texture2D(textureSampler,ref_coords_r).r;
original.g=texture2D(textureSampler,ref_coords_g).g;
original.b=texture2D(textureSampler,ref_coords_b).b;
original.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);
gl_FragColor=original;
}`;Pa.a.ShadersStore.chromaticAberrationPixelShader=wo;var Xk=function(e){function b(a,c,d,f,g,h,j,m,w,z){void 0===w&&(w=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===z&&(z=!1);var C=e.call(this,a,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],f,g,h,j,m,null,w,void 0,null,z)||this;return C.aberrationAmount=30,C.radialIntensity=0,C.direction=new i.d(.707,.707),C.centerPosition=new i.d(.5,.5),C.onApplyObservable.add(function(J){J.setFloat("chromatic_aberration",C.aberrationAmount),J.setFloat("screen_width",c),J.setFloat("screen_height",d),J.setFloat("radialIntensity",C.radialIntensity),J.setFloat2("direction",C.direction.x,C.direction.y),J.setFloat2("centerPosition",C.centerPosition.x,C.centerPosition.y)}),C}return Object(l.d)(b,e),b}(gb),xo=`
uniform sampler2D depthSampler;

varying vec2 vUV;

uniform vec2 cameraMinMaxZ;

uniform float focusDistance;
uniform float cocPrecalculation;
void main(void)
{
float depth=texture2D(depthSampler,vUV).r;
float pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0;
float coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));
coc=clamp(coc,0.0,1.0);
gl_FragColor=vec4(coc,depth,coc,1.0);
}
`;Pa.a.ShadersStore.circleOfConfusionPixelShader=xo;var Yk=function(e){function b(a,c,d,f,g,h,j,m,w){void 0===m&&(m=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===w&&(w=!1);var z=e.call(this,a,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],d,f,g,h,j,null,m,void 0,null,w)||this;return z.lensSize=50,z.fStop=1.4,z.focusDistance=2000,z.focalLength=50,z._depthTexture=null,z._depthTexture=c,z.onApplyObservable.add(function(C){if(z._depthTexture){C.setTexture("depthSampler",z._depthTexture);var J=z.lensSize/z.fStop*z.focalLength/(z.focusDistance-z.focalLength);C.setFloat("focusDistance",z.focusDistance),C.setFloat("cocPrecalculation",J),C.setFloat2("cameraMinMaxZ",z._depthTexture.activeCamera.minZ,z._depthTexture.activeCamera.maxZ)}else k.a.Warn("No depth texture set on CircleOfConfusionPostProcess")}),z}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"depthTexture",{set:function(a){this._depthTexture=a},enumerable:!0,configurable:!0}),b}(gb),yo=`
uniform sampler2D textureSampler;
uniform sampler2D colorTable;

varying vec2 vUV;

const float SLICE_COUNT=16.0;

vec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {
float sliceSize=1.0/width;
float slicePixelSize=sliceSize/width;
float sliceInnerSize=slicePixelSize*(width-1.0);
float zSlice0=min(floor(uv.z*width),width-1.0);
float zSlice1=min(zSlice0+1.0,width-1.0);
float xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;
float s0=xOffset+(zSlice0*sliceSize);
float s1=xOffset+(zSlice1*sliceSize);
vec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));
vec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));
float zOffset=mod(uv.z*width,1.0);
vec4 result=mix(slice0Color,slice1Color,zOffset);
return result;
}
void main(void)
{
vec4 screen_color=texture2D(textureSampler,vUV);
gl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);
}`;Pa.a.ShadersStore.colorCorrectionPixelShader=yo;var zo=function(e){function b(a,c,d,f,g,h,j){var m=e.call(this,a,"colorCorrection",null,["colorTable"],d,f,g,h,j)||this;return m._colorTableTexture=new ya.a(c,f.getScene(),!0,!1,ya.a.TRILINEAR_SAMPLINGMODE),m._colorTableTexture.anisotropicFilteringLevel=1,m._colorTableTexture.wrapU=ya.a.CLAMP_ADDRESSMODE,m._colorTableTexture.wrapV=ya.a.CLAMP_ADDRESSMODE,m.onApply=function(w){w.setTexture("colorTable",m._colorTableTexture)},m}return Object(l.d)(b,e),b}(gb),Ao=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform float kernel[9];
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 colorSum =
texture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +
texture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +
texture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +
texture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +
texture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +
texture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +
texture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];
float kernelWeight =
kernel[0] +
kernel[1] +
kernel[2] +
kernel[3] +
kernel[4] +
kernel[5] +
kernel[6] +
kernel[7] +
kernel[8];
if (kernelWeight<=0.0) {
kernelWeight=1.0;
}
gl_FragColor=vec4((colorSum/kernelWeight).rgb,1);
}`;Pa.a.ShadersStore.convolutionPixelShader=Ao;var Bo=function(e){function b(a,c,d,f,g,h,j,m){void 0===m&&(m=p.a.TEXTURETYPE_UNSIGNED_INT);var w=e.call(this,a,"convolution",["kernel","screenSize"],null,d,f,g,h,j,null,m)||this;return w.kernel=c,w.onApply=function(z){z.setFloat2("screenSize",w.width,w.height),z.setArray("kernel",w.kernel)},w}return Object(l.d)(b,e),b.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],b.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],b.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],b.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],b.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],b.GaussianKernel=[0,1,0,1,1,1,0,1,0],b}(gb),rh=function(e){function b(a,c,d,f,g,h,j,m,w,z,C,J,K){void 0===m&&(m=null),void 0===w&&(w=ya.a.BILINEAR_SAMPLINGMODE),void 0===J&&(J=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===K&&(K=!1);var N=e.call(this,a,d,f,g,h,w=p.a.TEXTURE_BILINEAR_SAMPLINGMODE,z,C,J=p.a.TEXTURETYPE_UNSIGNED_INT,`#define DOF 1\r
`,K)||this;return N.direction=d,N.onApplyObservable.add(function(T){null!=m&&T.setTextureFromPostProcess("textureSampler",m),T.setTextureFromPostProcessOutput("circleOfConfusionSampler",j),c.activeCamera&&T.setFloat2("cameraMinMaxZ",c.activeCamera.minZ,c.activeCamera.maxZ)}),N}return Object(l.d)(b,e),b}(Xb),Co=`uniform sampler2D textureSampler;
varying vec2 vUV;
uniform sampler2D circleOfConfusionSampler;
uniform sampler2D blurStep0;
#if BLUR_LEVEL>0
uniform sampler2D blurStep1;
#endif
#if BLUR_LEVEL>1
uniform sampler2D blurStep2;
#endif
void main(void)
{
float coc=texture2D(circleOfConfusionSampler,vUV).r;
#if BLUR_LEVEL == 0
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred0=texture2D(blurStep0,vUV);
gl_FragColor=mix(original,blurred0,coc);
#endif
#if BLUR_LEVEL == 1
if(coc<0.5){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(original,blurred1,coc/0.5);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);
}
#endif
#if BLUR_LEVEL == 2
if(coc<0.33){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(original,blurred2,coc/0.33);
}else if(coc<0.66){
vec4 blurred1=texture2D(blurStep1,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);
}
#endif
}
`;Pa.a.ShadersStore.depthOfFieldMergePixelShader=Co;var ud,Do=function(){},Zk=function(e){function b(a,c,d,f,g,h,j,m,w,z,C){void 0===z&&(z=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===C&&(C=!1);var J=e.call(this,a,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],g,h,j,m,w,null,z,void 0,null,!0)||this;return J.blurSteps=f,J.onApplyObservable.add(function(K){K.setTextureFromPostProcess("textureSampler",c),K.setTextureFromPostProcessOutput("circleOfConfusionSampler",d),f.forEach(function(N,T){K.setTextureFromPostProcessOutput("blurStep"+(f.length-T-1),N)})}),C||J.updateEffect(),J}return Object(l.d)(b,e),b.prototype.updateEffect=function(a,c,d,f,g,h){void 0===a&&(a=null),void 0===c&&(c=null),void 0===d&&(d=null),a||(a="",a+="#define BLUR_LEVEL "+(this.blurSteps.length-1)+`
`),e.prototype.updateEffect.call(this,a,c,d,f,g,h)},b}(gb);!function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(ud||(ud={}));var sh=function(e){function b(a,c,d,f,g){void 0===d&&(d=ud.Low),void 0===f&&(f=0),void 0===g&&(g=!1);var h=e.call(this,a.getEngine(),"depth of field",function(){return h._effects},!0)||this;h._effects=[],h._circleOfConfusion=new Yk("circleOfConfusion",c,1,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,f,g),h._depthOfFieldBlurY=[],h._depthOfFieldBlurX=[];var j=1,m=15;switch(d){case ud.High:j=3,m=51;break;case ud.Medium:j=2,m=31;break;default:m=15,j=1}for(var w=m/Math.pow(2,j-1),z=1,C=0;C<j;C++){var J=new rh("verticle blur",a,new i.d(0,1),w,z,null,h._circleOfConfusion,0==C?h._circleOfConfusion:null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,f,g);J.autoClear=!1,z=.75/Math.pow(2,C);var K=new rh("horizontal blur",a,new i.d(1,0),w,z,null,h._circleOfConfusion,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,f,g);K.autoClear=!1,h._depthOfFieldBlurY.push(J),h._depthOfFieldBlurX.push(K)}for(h._effects=[h._circleOfConfusion],C=0;C<h._depthOfFieldBlurX.length;C++)h._effects.push(h._depthOfFieldBlurY[C]),h._effects.push(h._depthOfFieldBlurX[C]);return h._dofMerge=new Zk("dofMerge",h._circleOfConfusion,h._circleOfConfusion,h._depthOfFieldBlurX,z,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,f,g),h._dofMerge.autoClear=!1,h._effects.push(h._dofMerge),h}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(a){this._circleOfConfusion.focalLength=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(a){this._circleOfConfusion.fStop=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(a){this._circleOfConfusion.focusDistance=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(a){this._circleOfConfusion.lensSize=a},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"DepthOfFieldEffect"},Object.defineProperty(b.prototype,"depthTexture",{set:function(a){this._circleOfConfusion.depthTexture=a},enumerable:!0,configurable:!0}),b.prototype.disposeEffects=function(a){for(var c=0;c<this._effects.length;c++)this._effects[c].dispose(a)},b.prototype._updateEffects=function(){for(var a=0;a<this._effects.length;a++)this._effects[a].updateEffect()},b.prototype._isReady=function(){for(var a=0;a<this._effects.length;a++)if(!this._effects[a].isReady())return!1;return!0},b}(pb),Eo=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D passSampler;
void main(void)
{
gl_FragColor=texture2D(passSampler,vUV);
}`;Pa.a.ShadersStore.displayPassPixelShader=Eo;var Fo=function(e){function b(a,c,d,f,g,h){return e.call(this,a,"displayPass",["passSampler"],["passSampler"],c,d,f,g,h)||this}return Object(l.d)(b,e),b}(gb),Go=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform mat4 kernelMatrix;
void main(void)
{
vec3 baseColor=texture2D(textureSampler,vUV).rgb;
vec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;
gl_FragColor=vec4(updatedColor,1.0);
}`;Pa.a.ShadersStore.filterPixelShader=Go;var Ho=function(e){function b(a,c,d,f,g,h,j){var m=e.call(this,a,"filter",["kernelMatrix"],null,d,f,g,h,j)||this;return m.kernelMatrix=c,m.onApply=function(w){w.setMatrix("kernelMatrix",m.kernelMatrix)},m}return Object(l.d)(b,e),b}(gb),Io=`uniform sampler2D textureSampler;
uniform vec2 texelSize;
varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const float fxaaQualitySubpix=1.0;
const float fxaaQualityEdgeThreshold=0.166;
const float fxaaQualityEdgeThresholdMin=0.0833;
const vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);
#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)
void main(){
vec2 posM;
posM.x=vUV.x;
posM.y=vUV.y;
vec4 rgbyM=texture2D(textureSampler,vUV,0.0);
float lumaM=FxaaLuma(rgbyM);
float lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));
float lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));
float lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));
float lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));
float maxSM=max(lumaS,lumaM);
float minSM=min(lumaS,lumaM);
float maxESM=max(lumaE,maxSM);
float minESM=min(lumaE,minSM);
float maxWN=max(lumaN,lumaW);
float minWN=min(lumaN,lumaW);
float rangeMax=max(maxWN,maxESM);
float rangeMin=min(minWN,minESM);
float rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;
float range=rangeMax-rangeMin;
float rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);
#ifndef MALI
if(range<rangeMaxClamped)
{
gl_FragColor=rgbyM;
return;
}
#endif
float lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));
float lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));
float lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));
float lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));
float lumaNS=lumaN+lumaS;
float lumaWE=lumaW+lumaE;
float subpixRcpRange=1.0/range;
float subpixNSWE=lumaNS+lumaWE;
float edgeHorz1=(-2.0*lumaM)+lumaNS;
float edgeVert1=(-2.0*lumaM)+lumaWE;
float lumaNESE=lumaNE+lumaSE;
float lumaNWNE=lumaNW+lumaNE;
float edgeHorz2=(-2.0*lumaE)+lumaNESE;
float edgeVert2=(-2.0*lumaN)+lumaNWNE;
float lumaNWSW=lumaNW+lumaSW;
float lumaSWSE=lumaSW+lumaSE;
float edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);
float edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);
float edgeHorz3=(-2.0*lumaW)+lumaNWSW;
float edgeVert3=(-2.0*lumaS)+lumaSWSE;
float edgeHorz=abs(edgeHorz3)+edgeHorz4;
float edgeVert=abs(edgeVert3)+edgeVert4;
float subpixNWSWNESE=lumaNWSW+lumaNESE;
float lengthSign=texelSize.x;
bool horzSpan=edgeHorz>=edgeVert;
float subpixA=subpixNSWE*2.0+subpixNWSWNESE;
if (!horzSpan)
{
lumaN=lumaW;
}
if (!horzSpan)
{
lumaS=lumaE;
}
if (horzSpan)
{
lengthSign=texelSize.y;
}
float subpixB=(subpixA*(1.0/12.0))-lumaM;
float gradientN=lumaN-lumaM;
float gradientS=lumaS-lumaM;
float lumaNN=lumaN+lumaM;
float lumaSS=lumaS+lumaM;
bool pairN=abs(gradientN)>=abs(gradientS);
float gradient=max(abs(gradientN),abs(gradientS));
if (pairN)
{
lengthSign=-lengthSign;
}
float subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);
vec2 posB;
posB.x=posM.x;
posB.y=posM.y;
vec2 offNP;
offNP.x=(!horzSpan) ? 0.0 : texelSize.x;
offNP.y=(horzSpan) ? 0.0 : texelSize.y;
if (!horzSpan)
{
posB.x+=lengthSign*0.5;
}
if (horzSpan)
{
posB.y+=lengthSign*0.5;
}
vec2 posN;
posN.x=posB.x-offNP.x*1.5;
posN.y=posB.y-offNP.y*1.5;
vec2 posP;
posP.x=posB.x+offNP.x*1.5;
posP.y=posB.y+offNP.y*1.5;
float subpixD=((-2.0)*subpixC)+3.0;
float lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));
float subpixE=subpixC*subpixC;
float lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));
if (!pairN)
{
lumaNN=lumaSS;
}
float gradientScaled=gradient*1.0/4.0;
float lumaMM=lumaM-lumaNN*0.5;
float subpixF=subpixD*subpixE;
bool lumaMLTZero=lumaMM<0.0;
lumaEndN-=lumaNN*0.5;
lumaEndP-=lumaNN*0.5;
bool doneN=abs(lumaEndN)>=gradientScaled;
bool doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)
{
posN.x-=offNP.x*3.0;
}
if (!doneN)
{
posN.y-=offNP.y*3.0;
}
bool doneNP=(!doneN) || (!doneP);
if (!doneP)
{
posP.x+=offNP.x*3.0;
}
if (!doneP)
{
posP.y+=offNP.y*3.0;
}
if (doneNP)
{
if (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));
if (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));
if (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN) posN.x-=offNP.x*12.0;
if (!doneN) posN.y-=offNP.y*12.0;
doneNP=(!doneN) || (!doneP);
if (!doneP) posP.x+=offNP.x*12.0;
if (!doneP) posP.y+=offNP.y*12.0;
}
float dstN=posM.x-posN.x;
float dstP=posP.x-posM.x;
if (!horzSpan)
{
dstN=posM.y-posN.y;
}
if (!horzSpan)
{
dstP=posP.y-posM.y;
}
bool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;
float spanLength=(dstP+dstN);
bool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;
float spanLengthRcp=1.0/spanLength;
bool directionN=dstN<dstP;
float dst=min(dstN,dstP);
bool goodSpan=directionN ? goodSpanN : goodSpanP;
float subpixG=subpixF*subpixF;
float pixelOffset=(dst*(-spanLengthRcp))+0.5;
float subpixH=subpixG*fxaaQualitySubpix;
float pixelOffsetGood=goodSpan ? pixelOffset : 0.0;
float pixelOffsetSubpix=max(pixelOffsetGood,subpixH);
if (!horzSpan)
{
posM.x+=pixelOffsetSubpix*lengthSign;
}
if (horzSpan)
{
posM.y+=pixelOffsetSubpix*lengthSign;
}
#ifdef MALI
if(range<rangeMaxClamped)
{
gl_FragColor=rgbyM;
}
else
{
gl_FragColor=texture2D(textureSampler,posM,0.0);
}
#else
gl_FragColor=texture2D(textureSampler,posM,0.0);
#endif
}`;Pa.a.ShadersStore.fxaaPixelShader=Io;var Jo=`
attribute vec2 position;
uniform vec2 texelSize;

varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd);
sampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;
sampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;
sampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;
sampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;
sampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;
sampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;
sampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;
sampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;
gl_Position=vec4(position,0.0,1.0);
}`;Pa.a.ShadersStore.fxaaVertexShader=Jo;var Ff=function(e){function b(a,c,d,f,g,h,j){void 0===d&&(d=null),void 0===j&&(j=p.a.TEXTURETYPE_UNSIGNED_INT);var m=e.call(this,a,"fxaa",["texelSize"],null,c,d,f||ya.a.BILINEAR_SAMPLINGMODE,g,h,null,j,"fxaa",void 0,!0)||this,w=m._getDefines();return m.updateEffect(w),m.onApplyObservable.add(function(z){var C=m.texelSize;z.setFloat2("texelSize",C.x,C.y)}),m}return Object(l.d)(b,e),b.prototype._getDefines=function(){var a=this.getEngine();if(!a)return null;var c=a.getGlInfo();return c&&c.renderer&&c.renderer.toLowerCase().indexOf("mali")>-1?`#define MALI 1
`:null},b}(gb),Ko=`#include<helperFunctions>

uniform sampler2D textureSampler;

uniform float intensity;
uniform float animatedSeed;

varying vec2 vUV;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec2 seed=vUV*(animatedSeed);
float grain=dither(seed,intensity);

float lum=getLuminance(gl_FragColor.rgb);
float grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;
gl_FragColor.rgb+=grain*grainAmount;
gl_FragColor.rgb=max(gl_FragColor.rgb,0.0);
}`;Pa.a.ShadersStore.grainPixelShader=Ko;var _k=function(e){function b(a,c,d,f,g,h,j,m){void 0===j&&(j=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1);var w=e.call(this,a,"grain",["intensity","animatedSeed"],[],c,d,f,g,h,null,j,void 0,null,m)||this;return w.intensity=30,w.animated=!1,w.onApplyObservable.add(function(z){z.setFloat("intensity",w.intensity),z.setFloat("animatedSeed",w.animated?Math.random()+1:1)}),w}return Object(l.d)(b,e),b}(gb),Lo=`
varying vec2 vUV;
uniform sampler2D textureSampler;
const vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);
void main(void)
{
vec4 tex=texture2D(textureSampler,vUV);
vec3 c=tex.rgb;
float luma=dot(c.rgb,RGBLuminanceCoefficients);


gl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a);
}`;Pa.a.ShadersStore.highlightsPixelShader=Lo;var Mo=function(e){function b(a,c,d,f,g,h,j){return void 0===j&&(j=p.a.TEXTURETYPE_UNSIGNED_INT),e.call(this,a,"highlights",null,null,c,d,f,g,h,null,j)||this}return Object(l.d)(b,e),b}(gb);Pa.a.IncludesShadersStore.mrtFragmentDeclaration=`#if __VERSION__>=200
layout(location=0) out vec4 glFragData[{X}];
#endif
`;var No=`#extension GL_EXT_draw_buffers : require
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
precision highp float;
precision highp int;
#ifdef BUMP
varying mat4 vWorldView;
varying vec3 vNormalW;
#else
varying vec3 vNormalV;
#endif
varying vec4 vViewPos;
#if defined(POSITION) || defined(BUMP)
varying vec3 vPositionW;
#endif
#ifdef VELOCITY
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
#ifdef NEED_UV
varying vec2 vUV;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#ifdef REFLECTIVITY
varying vec2 vReflectivityUV;
uniform sampler2D reflectivitySampler;
#endif
#ifdef ALPHATEST
uniform sampler2D diffuseSampler;
#endif
#include<mrtFragmentDeclaration>[RENDER_TARGET_COUNT]
#include<bumpFragmentFunctions>
void main() {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
gl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);

#ifdef BUMP
vec3 normalW=normalize(vNormalW);
#include<bumpFragment>
gl_FragData[1]=vec4(normalize(vec3(vWorldView*vec4(normalW,0.0))),1.0);
#else
gl_FragData[1]=vec4(normalize(vNormalV),1.0);
#endif
#ifdef POSITION
gl_FragData[POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef REFLECTIVITY
#ifdef HAS_SPECULAR

vec4 reflectivity=texture2D(reflectivitySampler,vReflectivityUV);
#elif HAS_REFLECTIVITY

vec4 reflectivity=vec4(texture2D(reflectivitySampler,vReflectivityUV).rgb,1.0);
#else
vec4 reflectivity=vec4(0.0,0.0,0.0,1.0);
#endif
gl_FragData[REFLECTIVITY_INDEX]=reflectivity;
#endif
}`;Pa.a.ShadersStore.geometryPixelShader=No;var Oo=`precision highp float;
precision highp int;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#include<instancesDeclaration>
attribute vec3 position;
attribute vec3 normal;
#ifdef NEED_UV
varying vec2 vUV;
#ifdef ALPHATEST
uniform mat4 diffuseMatrix;
#endif
#ifdef BUMP
uniform mat4 bumpMatrix;
varying vec2 vBumpUV;
#endif
#ifdef REFLECTIVITY
uniform mat4 reflectivityMatrix;
varying vec2 vReflectivityUV;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif

uniform mat4 viewProjection;
uniform mat4 view;
#ifdef BUMP
varying mat4 vWorldView;
#endif
#ifdef BUMP
varying vec3 vNormalW;
#else
varying vec3 vNormalV;
#endif
varying vec4 vViewPos;
#if defined(POSITION) || defined(BUMP)
varying vec3 vPositionW;
#endif
#ifdef VELOCITY
uniform mat4 previousWorld;
uniform mat4 previousViewProjection;
#ifdef BONES_VELOCITY_ENABLED
#if NUM_BONE_INFLUENCERS>0
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#endif
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
void main(void)
{
vec3 positionUpdated=position;
vec3 normalUpdated=normal;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#if defined(VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 pos=vec4(finalWorld*vec4(positionUpdated,1.0));
#ifdef BUMP
vWorldView=view*finalWorld;
vNormalW=normalUpdated;
#else
vNormalV=normalize(vec3((view*finalWorld)*vec4(normalUpdated,0.0)));
#endif
vViewPos=view*pos;
#if defined(VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;
previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#endif
#if defined(POSITION) || defined(BUMP)
vPositionW=pos.xyz/pos.w;
#endif
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#ifdef NEED_UV
#ifdef UV1
#ifdef ALPHATEST
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#else
vUV=uv;
#endif
#ifdef BUMP
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef REFLECTIVITY
vReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#endif
#ifdef UV2
#ifdef ALPHATEST
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#else
vUV=uv2;
#endif
#ifdef BUMP
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
#endif
#ifdef REFLECTIVITY
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#endif
#include<bumpVertex>
}
`;Pa.a.ShadersStore.geometryVertexShader=Oo;var ce=function(){function e(b,a){void 0===a&&(a=1),this._previousTransformationMatrices={},this._previousBonesTransformationMatrices={},this.excludedSkinnedMeshesFromVelocity=[],this.renderTransparentMeshes=!0,this._enablePosition=!1,this._enableVelocity=!1,this._enableReflectivity=!1,this._positionIndex=-1,this._velocityIndex=-1,this._reflectivityIndex=-1,this._scene=b,this._ratio=a,e._SceneComponentInitialization(this._scene),this._createRenderTargets()}return Object.defineProperty(e.prototype,"renderList",{set:function(b){this._multiRenderTarget.renderList=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!0,configurable:!0}),e.prototype.getTextureIndex=function(b){switch(b){case e.POSITION_TEXTURE_TYPE:return this._positionIndex;case e.VELOCITY_TEXTURE_TYPE:return this._velocityIndex;case e.REFLECTIVITY_TEXTURE_TYPE:return this._reflectivityIndex;default:return-1}},Object.defineProperty(e.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(b){this._enablePosition=b,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableVelocity",{get:function(){return this._enableVelocity},set:function(b){this._enableVelocity=b,b||(this._previousTransformationMatrices={}),this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableReflectivity",{get:function(){return this._enableReflectivity},set:function(b){this._enableReflectivity=b,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ratio",{get:function(){return this._ratio},enumerable:!0,configurable:!0}),e.prototype.isReady=function(b,a){var c=b.getMaterial();if(c&&c.disableDepthWrite)return!1;var d=[],f=[ra.b.PositionKind,ra.b.NormalKind],g=b.getMesh();if(c){var h=!1;c.needAlphaBlending()&&(d.push("#define ALPHATEST"),h=!0),c.bumpTexture&&Ab.a.BumpTextureEnabled&&(d.push("#define BUMP"),h=!0),this._enableReflectivity&&(c instanceof Ab.a&&c.specularTexture?(d.push("#define HAS_SPECULAR"),h=!0):c instanceof Ae&&c.reflectivityTexture&&(d.push("#define HAS_REFLECTIVITY"),h=!0)),h&&(d.push("#define NEED_UV"),g.isVerticesDataPresent(ra.b.UVKind)&&(f.push(ra.b.UVKind),d.push("#define UV1")),g.isVerticesDataPresent(ra.b.UV2Kind)&&(f.push(ra.b.UV2Kind),d.push("#define UV2")))}this._enablePosition&&(d.push("#define POSITION"),d.push("#define POSITION_INDEX "+this._positionIndex)),this._enableVelocity&&(d.push("#define VELOCITY"),d.push("#define VELOCITY_INDEX "+this._velocityIndex),-1===this.excludedSkinnedMeshesFromVelocity.indexOf(g)&&d.push("#define BONES_VELOCITY_ENABLED")),this._enableReflectivity&&(d.push("#define REFLECTIVITY"),d.push("#define REFLECTIVITY_INDEX "+this._reflectivityIndex)),g.useBones&&g.computeBonesUsingShaders?(f.push(ra.b.MatricesIndicesKind),f.push(ra.b.MatricesWeightsKind),g.numBoneInfluencers>4&&(f.push(ra.b.MatricesIndicesExtraKind),f.push(ra.b.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+g.numBoneInfluencers),d.push("#define BonesPerMesh "+(g.skeleton?g.skeleton.bones.length+1:0))):d.push("#define NUM_BONE_INFLUENCERS 0");var j=g.morphTargetManager,m=0;j&&j.numInfluencers>0&&(m=j.numInfluencers,d.push("#define MORPHTARGETS"),d.push("#define NUM_MORPH_INFLUENCERS "+m),Ua.a.PrepareAttributesForMorphTargetsInfluencers(f,g,m)),a&&(d.push("#define INSTANCES"),Ua.a.PushAttributesForInstances(f)),d.push("#define RENDER_TARGET_COUNT "+this._multiRenderTarget.textures.length);var w=d.join(`
`);return this._cachedDefines!==w&&(this._cachedDefines=w,this._effect=this._scene.getEngine().createEffect("geometry",f,["world","mBones","viewProjection","diffuseMatrix","view","previousWorld","previousViewProjection","mPreviousBones","morphTargetInfluences","bumpMatrix","reflectivityMatrix","vTangentSpaceParams","vBumpInfos"],["diffuseSampler","bumpSampler","reflectivitySampler"],w,void 0,void 0,void 0,{buffersCount:this._multiRenderTarget.textures.length-1,maxSimultaneousMorphTargets:m})),this._effect.isReady()},e.prototype.getGBuffer=function(){return this._multiRenderTarget},Object.defineProperty(e.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(b){this._multiRenderTarget.samples=b},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.getGBuffer().dispose()},e.prototype._createRenderTargets=function(){var b=this,a=this._scene.getEngine(),c=2;if(this._enablePosition&&(this._positionIndex=c,c++),this._enableVelocity&&(this._velocityIndex=c,c++),this._enableReflectivity&&(this._reflectivityIndex=c,c++),this._multiRenderTarget=new xj("gBuffer",{width:a.getRenderWidth()*this._ratio,height:a.getRenderHeight()*this._ratio},c,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:p.a.TEXTURETYPE_FLOAT}),this.isSupported){this._multiRenderTarget.wrapU=ya.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=ya.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add(function(f){f.clear(new G.b(0,0,0,1),!0,!0,!0)});var d=function(f){var g=f.getRenderingMesh(),h=b._scene,j=h.getEngine(),m=f.getMaterial();if(m){if(g._internalAbstractMeshDataInfo._isActiveIntermediate=!1,b._enableVelocity&&!b._previousTransformationMatrices[g.uniqueId]&&(b._previousTransformationMatrices[g.uniqueId]={world:i.a.Identity(),viewProjection:h.getTransformMatrix()},g.skeleton)){var w=g.skeleton.getTransformMatrices(g);b._previousBonesTransformationMatrices[g.uniqueId]=b._copyBonesTransformationMatrices(w,new Float32Array(w.length))}j.setState(m.backFaceCulling,0,!1,h.useRightHandedSystem);var z=g._getInstancesRenderList(f._id);if(!z.mustReturn){var C=j.getCaps().instancedArrays&&null!==z.visibleInstances[f._id];if(b.isReady(f,C)){if(j.enableEffect(b._effect),g._bind(f,b._effect,m.fillMode),b._effect.setMatrix("viewProjection",h.getTransformMatrix()),b._effect.setMatrix("view",h.getViewMatrix()),m){if(m.needAlphaTesting()){var J=m.getAlphaTestTexture();J&&(b._effect.setTexture("diffuseSampler",J),b._effect.setMatrix("diffuseMatrix",J.getTextureMatrix()))}m.bumpTexture&&h.getEngine().getCaps().standardDerivatives&&Ab.a.BumpTextureEnabled&&(b._effect.setFloat3("vBumpInfos",m.bumpTexture.coordinatesIndex,1/m.bumpTexture.level,m.parallaxScaleBias),b._effect.setMatrix("bumpMatrix",m.bumpTexture.getTextureMatrix()),b._effect.setTexture("bumpSampler",m.bumpTexture),b._effect.setFloat2("vTangentSpaceParams",m.invertNormalMapX?-1:1,m.invertNormalMapY?-1:1)),b._enableReflectivity&&(m instanceof Ab.a&&m.specularTexture?(b._effect.setMatrix("reflectivityMatrix",m.specularTexture.getTextureMatrix()),b._effect.setTexture("reflectivitySampler",m.specularTexture)):m instanceof Ae&&m.reflectivityTexture&&(b._effect.setMatrix("reflectivityMatrix",m.reflectivityTexture.getTextureMatrix()),b._effect.setTexture("reflectivitySampler",m.reflectivityTexture)))}g.useBones&&g.computeBonesUsingShaders&&g.skeleton&&(b._effect.setMatrices("mBones",g.skeleton.getTransformMatrices(g)),b._enableVelocity&&b._effect.setMatrices("mPreviousBones",b._previousBonesTransformationMatrices[g.uniqueId])),Ua.a.BindMorphTargetParameters(g,b._effect),b._enableVelocity&&(b._effect.setMatrix("previousWorld",b._previousTransformationMatrices[g.uniqueId].world),b._effect.setMatrix("previousViewProjection",b._previousTransformationMatrices[g.uniqueId].viewProjection)),g._processRendering(f,b._effect,m.fillMode,z,C,function(K,N){return b._effect.setMatrix("world",N)})}b._enableVelocity&&(b._previousTransformationMatrices[g.uniqueId].world=g.getWorldMatrix().clone(),b._previousTransformationMatrices[g.uniqueId].viewProjection=b._scene.getTransformMatrix().clone(),g.skeleton&&b._copyBonesTransformationMatrices(g.skeleton.getTransformMatrices(g),b._previousBonesTransformationMatrices[g.uniqueId]))}}};this._multiRenderTarget.customRenderFunction=function(f,g,h,j){var m;if(j.length){for(a.setColorWrite(!1),m=0;m<j.length;m++)d(j.data[m]);a.setColorWrite(!0)}for(m=0;m<f.length;m++)d(f.data[m]);for(m=0;m<g.length;m++)d(g.data[m]);if(b.renderTransparentMeshes)for(m=0;m<h.length;m++)d(h.data[m])}}},e.prototype._copyBonesTransformationMatrices=function(b,a){for(var c=0;c<b.length;c++)a[c]=b[c];return a},e.POSITION_TEXTURE_TYPE=1,e.VELOCITY_TEXTURE_TYPE=2,e.REFLECTIVITY_TEXTURE_TYPE=3,e._SceneComponentInitialization=function(b){throw Gc.a.WarnImport("GeometryBufferRendererSceneComponent")},e}();Object.defineProperty(wa.a.prototype,"geometryBufferRenderer",{get:function(){this._geometryBufferRenderer},set:function(e){e&&e.isSupported&&(this._geometryBufferRenderer=e)},enumerable:!0,configurable:!0}),wa.a.prototype.enableGeometryBufferRenderer=function(e){return void 0===e&&(e=1),this._geometryBufferRenderer?this._geometryBufferRenderer:(this._geometryBufferRenderer=new ce(this,e),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null),this._geometryBufferRenderer)},wa.a.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var $k=function(){function e(b){this.name=_a.a.NAME_GEOMETRYBUFFERRENDERER,this.scene=b}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(_a.a.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(b){this.scene._geometryBufferRenderer&&b.push(this.scene._geometryBufferRenderer.getGBuffer())},e}();ce._SceneComponentInitialization=function(e){var b=e._getComponent(_a.a.NAME_GEOMETRYBUFFERRENDERER);b||(b=new $k(e),e._addComponent(b))};var Po=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D velocitySampler;
uniform float motionStrength;
uniform float motionScale;
uniform vec2 screenSize;
void main(void)
{
#ifdef GEOMETRY_SUPPORTED
vec2 texelSize=1.0/screenSize;
vec2 velocityColor=texture2D(velocitySampler,vUV).rg*2.0-1.0;
vec2 velocity=vec2(pow(velocityColor.r,3.0),pow(velocityColor.g,3.0));
velocity*=motionScale*motionStrength;
float speed=length(velocity/texelSize);
int samplesCount=int(clamp(speed,1.0,SAMPLES));
velocity=normalize(velocity)*texelSize;
float hlim=float(-samplesCount)*0.5+0.5;
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(SAMPLES); ++i)
{
if (i>=samplesCount)
break;
vec2 offset=vUV+velocity*(hlim+float(i));
result+=texture2D(textureSampler,offset);
}
gl_FragColor=result/float(samplesCount);
gl_FragColor.a=1.0;
#else
gl_FragColor=texture2D(textureSampler,vUV);
#endif
}
`;Pa.a.ShadersStore.motionBlurPixelShader=Po;var al=function(e){function b(a,c,d,f,g,h,j,m,w){void 0===m&&(m=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===w&&(w=!1);var z=e.call(this,a,"motionBlur",["motionStrength","motionScale","screenSize"],["velocitySampler"],d,f,g,h,j,`#define GEOMETRY_SUPPORTED
#define SAMPLES 64.0`,m,void 0,null,w)||this;return z.motionStrength=1,z._motionBlurSamples=32,z._geometryBufferRenderer=c.enableGeometryBufferRenderer(),z._geometryBufferRenderer?(z._geometryBufferRenderer.enableVelocity=!0,z.onApply=function(C){if(C.setVector2("screenSize",new i.d(z.width,z.height)),C.setFloat("motionScale",c.getAnimationRatio()),C.setFloat("motionStrength",z.motionStrength),z._geometryBufferRenderer){var J=z._geometryBufferRenderer.getTextureIndex(ce.VELOCITY_TEXTURE_TYPE);C.setTexture("velocitySampler",z._geometryBufferRenderer.getGBuffer().textures[J])}}):(k.a.Warn("Multiple Render Target support needed to compute object based motion blur"),z.updateEffect()),z}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(a){this._motionBlurSamples=a,this._geometryBufferRenderer&&this.updateEffect(`#define GEOMETRY_SUPPORTED
#define SAMPLES `+a.toFixed(1))},enumerable:!0,configurable:!0}),b.prototype.excludeSkinnedMesh=function(a){this._geometryBufferRenderer&&a.skeleton&&this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.push(a)},b.prototype.removeExcludedSkinnedMesh=function(a){if(this._geometryBufferRenderer&&a.skeleton){var c=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.indexOf(a);-1!==c&&this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.splice(c,1)}},b.prototype.dispose=function(a){this._geometryBufferRenderer&&(this._geometryBufferRenderer._previousTransformationMatrices={},this._geometryBufferRenderer._previousBonesTransformationMatrices={},this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity=[]),e.prototype.dispose.call(this,a)},b}(gb),Qo=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D refractionSampler;

uniform vec3 baseColor;
uniform float depth;
uniform float colorLevel;
void main() {
float ref=1.0-texture2D(refractionSampler,vUV).r;
vec2 uv=vUV-vec2(0.5);
vec2 offset=uv*depth*ref;
vec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;
gl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);
}`;Pa.a.ShadersStore.refractionPixelShader=Qo;var Ro=function(e){function b(a,c,d,f,g,h,j,m,w,z){var C=e.call(this,a,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],h,j,m,w,z)||this;return C.color=d,C.depth=f,C.colorLevel=g,C._ownRefractionTexture=!0,C.onActivateObservable.add(function(J){C._refTexture=C._refTexture||new ya.a(c,J.getScene())}),C.onApplyObservable.add(function(J){J.setColor3("baseColor",C.color),J.setFloat("depth",C.depth),J.setFloat("colorLevel",C.colorLevel),J.setTexture("refractionSampler",C._refTexture)}),C}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(a){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=a,this._ownRefractionTexture=!1},enumerable:!0,configurable:!0}),b.prototype.dispose=function(a){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),e.prototype.dispose.call(this,a)},b}(gb),So=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform vec2 sharpnessAmounts;
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 color=texture2D(textureSampler,vUV);
vec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(0,1)) -
color*4.0;
gl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);
}`;Pa.a.ShadersStore.sharpenPixelShader=So;var bl=function(e){function b(a,c,d,f,g,h,j,m){void 0===j&&(j=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1);var w=e.call(this,a,"sharpen",["sharpnessAmounts","screenSize"],null,c,d,f,g,h,null,j,void 0,null,m)||this;return w.colorAmount=1,w.edgeAmount=.3,w.onApply=function(z){z.setFloat2("screenSize",w.width,w.height),z.setFloat2("sharpnessAmounts",w.edgeAmount,w.colorAmount)},w}return Object(l.d)(b,e),b}(gb),de=function(){function e(b,a){this.engine=b,this._name=a,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array(),this._cameras=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameras",{get:function(){return this._cameras},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var b in this._renderEffects)if(this._renderEffects.hasOwnProperty(b)&&!this._renderEffects[b].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype.addEffect=function(b){this._renderEffects[b._name]=b},e.prototype._rebuild=function(){},e.prototype._enableEffect=function(b,a){var c=this._renderEffects[b];c&&c._enable(Qa.b.MakeArray(a||this._cameras))},e.prototype._disableEffect=function(b,a){var c=this._renderEffects[b];c&&c._disable(Qa.b.MakeArray(a||this._cameras))},e.prototype._attachCameras=function(b,a){var c=Qa.b.MakeArray(b||this._cameras);if(c){var d,f=[];for(d=0;d<c.length;d++){var g=c[d],h=g.name;-1===this._cameras.indexOf(g)?this._cameras[h]=g:a&&f.push(d)}for(d=0;d<f.length;d++)b.splice(f[d],1);for(var j in this._renderEffects)this._renderEffects.hasOwnProperty(j)&&this._renderEffects[j]._attachCameras(c)}},e.prototype._detachCameras=function(b){var a=Qa.b.MakeArray(b||this._cameras);if(a){for(var c in this._renderEffects)this._renderEffects.hasOwnProperty(c)&&this._renderEffects[c]._detachCameras(a);for(var d=0;d<a.length;d++)this._cameras.splice(this._cameras.indexOf(a[d]),1)}},e.prototype._update=function(){for(var b in this._renderEffects)this._renderEffects.hasOwnProperty(b)&&this._renderEffects[b]._update();for(var a=0;a<this._cameras.length;a++){var c=this._cameras[a].name;this._renderEffectsForIsolatedPass[c]&&this._renderEffectsForIsolatedPass[c]._update()}},e.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array()},e.prototype._enableMSAAOnFirstPostProcess=function(b){if(1===this.engine.webGLVersion)return!1;var a=Object.keys(this._renderEffects);if(a.length>0){var c=this._renderEffects[a[0]].getPostProcesses();c&&(c[0].samples=b)}return!0},e.prototype.dispose=function(){},Object(l.c)([Object(F.c)()],e.prototype,"_name",void 0),e}(),cl=function(){function e(){this._renderPipelines={}}return Object.defineProperty(e.prototype,"supportedPipelines",{get:function(){var b=[];for(var a in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(a)){var c=this._renderPipelines[a];c.isSupported&&b.push(c)}return b},enumerable:!0,configurable:!0}),e.prototype.addPipeline=function(b){this._renderPipelines[b._name]=b},e.prototype.attachCamerasToRenderPipeline=function(b,a,c){void 0===c&&(c=!1);var d=this._renderPipelines[b];d&&d._attachCameras(a,c)},e.prototype.detachCamerasFromRenderPipeline=function(b,a){var c=this._renderPipelines[b];c&&c._detachCameras(a)},e.prototype.enableEffectInPipeline=function(b,a,c){var d=this._renderPipelines[b];d&&d._enableEffect(a,c)},e.prototype.disableEffectInPipeline=function(b,a,c){var d=this._renderPipelines[b];d&&d._disableEffect(a,c)},e.prototype.update=function(){for(var b in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(b)){var a=this._renderPipelines[b];a.isSupported?a._update():(a.dispose(),delete this._renderPipelines[b])}},e.prototype._rebuild=function(){for(var b in this._renderPipelines)this._renderPipelines.hasOwnProperty(b)&&this._renderPipelines[b]._rebuild()},e.prototype.dispose=function(){for(var b in this._renderPipelines)this._renderPipelines.hasOwnProperty(b)&&this._renderPipelines[b].dispose()},e}();Object.defineProperty(wa.a.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var e=this._getComponent(_a.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER);e||(e=new dl(this),this._addComponent(e)),this._postProcessRenderPipelineManager=new cl()}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var dl=function(){function e(b){this.name=_a.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=b}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(_a.a.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},e.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},e.prototype._gatherRenderTargets=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},e}(),el=function(e){function b(a,c,d,f,g){void 0===a&&(a=""),void 0===c&&(c=!0),void 0===d&&(d=U.a.LastCreatedScene),void 0===g&&(g=!0);var h=e.call(this,d.getEngine(),a)||this;h._camerasToBeAttached=[],h.SharpenPostProcessId="SharpenPostProcessEffect",h.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",h.FxaaPostProcessId="FxaaPostProcessEffect",h.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",h.GrainPostProcessId="GrainPostProcessEffect",h._glowLayer=null,h.animations=[],h._imageProcessingConfigurationObserver=null,h._sharpenEnabled=!1,h._bloomEnabled=!1,h._depthOfFieldEnabled=!1,h._depthOfFieldBlurLevel=ud.Low,h._fxaaEnabled=!1,h._imageProcessingEnabled=!0,h._bloomScale=.5,h._chromaticAberrationEnabled=!1,h._grainEnabled=!1,h._buildAllowed=!0,h._resizeObserver=null,h._hardwareScaleLevel=1,h._bloomKernel=64,h._bloomWeight=.15,h._bloomThreshold=.9,h._samples=1,h._hasCleared=!1,h._prevPostProcess=null,h._prevPrevPostProcess=null,h._depthOfFieldSceneObserver=null,h._cameras=f||d.cameras,h._cameras=h._cameras.slice(),h._camerasToBeAttached=h._cameras.slice(),h._buildAllowed=g,h._scene=d;var j=h._scene.getEngine().getCaps();h._hdr=c&&(j.textureHalfFloatRender||j.textureFloatRender),h._hdr?j.textureHalfFloatRender?h._defaultPipelineTextureType=p.a.TEXTURETYPE_HALF_FLOAT:j.textureFloatRender&&(h._defaultPipelineTextureType=p.a.TEXTURETYPE_FLOAT):h._defaultPipelineTextureType=p.a.TEXTURETYPE_UNSIGNED_INT,d.postProcessRenderPipelineManager.addPipeline(h);var m=h._scene.getEngine();return h.sharpen=new bl("sharpen",1,null,ya.a.BILINEAR_SAMPLINGMODE,m,!1,h._defaultPipelineTextureType,!0),h._sharpenEffect=new pb(m,h.SharpenPostProcessId,function(){return h.sharpen},!0),h.depthOfField=new sh(h._scene,null,h._depthOfFieldBlurLevel,h._defaultPipelineTextureType,!0),h.bloom=new qh(h._scene,h._bloomScale,h._bloomWeight,h.bloomKernel,h._defaultPipelineTextureType,!0),h.chromaticAberration=new Xk("ChromaticAberration",m.getRenderWidth(),m.getRenderHeight(),1,null,ya.a.BILINEAR_SAMPLINGMODE,m,!1,h._defaultPipelineTextureType,!0),h._chromaticAberrationEffect=new pb(m,h.ChromaticAberrationPostProcessId,function(){return h.chromaticAberration},!0),h.grain=new _k("Grain",1,null,ya.a.BILINEAR_SAMPLINGMODE,m,!1,h._defaultPipelineTextureType,!0),h._grainEffect=new pb(m,h.GrainPostProcessId,function(){return h.grain},!0),h._resizeObserver=m.onResizeObservable.add(function(){h._hardwareScaleLevel=m.getHardwareScalingLevel(),h.bloomKernel=h.bloomKernel}),h._imageProcessingConfigurationObserver=h._scene.imageProcessingConfiguration.onUpdateParameters.add(function(){h.bloom._downscale._exposure=h._scene.imageProcessingConfiguration.exposure}),h._buildPipeline(),h}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(a){this._sharpenEnabled!==a&&(this._sharpenEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(a){this._bloomKernel=a,this.bloom.kernel=a/this._hardwareScaleLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(a){this._bloomWeight!==a&&(this.bloom.weight=a,this._bloomWeight=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(a){this._bloomThreshold!==a&&(this.bloom.threshold=a,this._bloomThreshold=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(a){this._bloomScale!==a&&(this._bloomScale=a,this._rebuildBloom(),this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(a){this._bloomEnabled!==a&&(this._bloomEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),b.prototype._rebuildBloom=function(){var a=this.bloom;this.bloom=new qh(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=a.threshold;for(var c=0;c<this._cameras.length;c++)a.disposeEffects(this._cameras[c])},Object.defineProperty(b.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(a){this._depthOfFieldEnabled!==a&&(this._depthOfFieldEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(a){if(this._depthOfFieldBlurLevel!==a){this._depthOfFieldBlurLevel=a;var c=this.depthOfField;this.depthOfField=new sh(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=c.focalLength,this.depthOfField.focusDistance=c.focusDistance,this.depthOfField.fStop=c.fStop,this.depthOfField.lensSize=c.lensSize;for(var d=0;d<this._cameras.length;d++)c.disposeEffects(this._cameras[d]);this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(a){this._fxaaEnabled!==a&&(this._fxaaEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples!==a&&(this._samples=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(a){this._imageProcessingEnabled!==a&&(this._imageProcessingEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"glowLayerEnabled",{get:function(){return null!=this._glowLayer},set:function(a){a&&!this._glowLayer?this._glowLayer=new rf("",this._scene):!a&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"glowLayer",{get:function(){return this._glowLayer},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(a){this._chromaticAberrationEnabled!==a&&(this._chromaticAberrationEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(a){this._grainEnabled!==a&&(this._grainEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"DefaultRenderingPipeline"},b.prototype.prepare=function(){var a=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=a},b.prototype._setAutoClearAndTextureSharing=function(a,c){void 0===c&&(c=!1),this._hasCleared?a.autoClear=!1:(a.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),c||(this._prevPrevPostProcess?a.shareOutputWith(this._prevPrevPostProcess):a.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=a)},b.prototype._buildPipeline=function(){var a=this;if(this._buildAllowed){this._scene.autoClear=!0;var c=this._scene.getEngine();if(this._disposePostProcesses(),null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var d=0,f=this._cameras;d<f.length;d++){var g=f[d];(h=this._scene.enableDepthRenderer(g)).useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add(function(j){a._cameras.indexOf(j.activeCamera)>-1&&(a.depthOfField.depthTexture=j.enableDepthRenderer(j.activeCamera).getDepthMap())})}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var h=this._scene.enableDepthRenderer(this._cameras[0]);this.depthOfField.depthTexture=h.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new og("imageProcessing",1,null,ya.a.BILINEAR_SAMPLINGMODE,c,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new pb(c,this.ImageProcessingPostProcessId,function(){return a.imageProcessing},!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new Ff("fxaa",1,null,ya.a.BILINEAR_SAMPLINGMODE,c,!1,this._defaultPipelineTextureType),this.addEffect(new pb(c,this.FxaaPostProcessId,function(){return a.fxaa},!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),this._scene.activeCameras&&this._scene.activeCameras.length>1&&(this._scene.autoClear=!0),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&k.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")}},b.prototype._disposePostProcesses=function(a){void 0===a&&(a=!1);for(var c=0;c<this._cameras.length;c++){var d=this._cameras[c];this.imageProcessing&&this.imageProcessing.dispose(d),this.fxaa&&this.fxaa.dispose(d),a&&(this.sharpen&&this.sharpen.dispose(d),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(d)),this.bloom&&this.bloom.disposeEffects(d),this.chromaticAberration&&this.chromaticAberration.dispose(d),this.grain&&this.grain.dispose(d),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,a&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},b.prototype.addCamera=function(a){this._camerasToBeAttached.push(a),this._buildPipeline()},b.prototype.removeCamera=function(a){var c=this._camerasToBeAttached.indexOf(a);this._camerasToBeAttached.splice(c,1),this._buildPipeline()},b.prototype.dispose=function(){this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),e.prototype.dispose.call(this)},b.prototype.serialize=function(){var a=F.a.Serialize(this);return a.customType="DefaultRenderingPipeline",a},b.Parse=function(a,c,d){return F.a.Parse(function(){return new b(a._name,a._name._hdr,c)},a,c,d)},Object(l.c)([Object(F.c)()],b.prototype,"sharpenEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"bloomKernel",null),Object(l.c)([Object(F.c)()],b.prototype,"_bloomWeight",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_bloomThreshold",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_hdr",void 0),Object(l.c)([Object(F.c)()],b.prototype,"bloomWeight",null),Object(l.c)([Object(F.c)()],b.prototype,"bloomThreshold",null),Object(l.c)([Object(F.c)()],b.prototype,"bloomScale",null),Object(l.c)([Object(F.c)()],b.prototype,"bloomEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"depthOfFieldEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"depthOfFieldBlurLevel",null),Object(l.c)([Object(F.c)()],b.prototype,"fxaaEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"samples",null),Object(l.c)([Object(F.c)()],b.prototype,"imageProcessingEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"glowLayerEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"chromaticAberrationEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"grainEnabled",null),b}(de);D.a.RegisteredTypes["BABYLON.DefaultRenderingPipeline"]=el;var To=`
uniform sampler2D textureSampler;

uniform float gain;
uniform float threshold;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;

vec4 highlightColor(vec4 color) {
vec4 highlight=color;
float luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));
float lum_threshold;
if (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }
else { lum_threshold=0.5+0.44*threshold; }
luminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);
highlight*=luminance*gain;
highlight.a=1.0;
return highlight;
}
void main(void)
{
vec4 original=texture2D(textureSampler,vUV);

if (gain == -1.0) {
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
return;
}
float w=2.0/screen_width;
float h=2.0/screen_height;
float weight=1.0;

vec4 blurred=vec4(0.0,0.0,0.0,0.0);
#ifdef PENTAGON
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));
#else
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));
#endif
blurred/=39.0;
gl_FragColor=blurred;

}`;Pa.a.ShadersStore.lensHighlightsPixelShader=To;var Uo=`




uniform sampler2D textureSampler;
uniform sampler2D highlightsSampler;
uniform sampler2D depthSampler;
uniform sampler2D grainSampler;

uniform float grain_amount;
uniform bool blur_noise;
uniform float screen_width;
uniform float screen_height;
uniform float distortion;
uniform bool dof_enabled;

uniform float screen_distance;
uniform float aperture;
uniform float darken;
uniform float edge_blur;
uniform bool highlights;

uniform float near;
uniform float far;

varying vec2 vUV;

#define PI 3.14159265
#define TWOPI 6.28318530
#define inverse_focal_length 0.1

vec2 centered_screen_pos;
vec2 distorted_coords;
float radius2;
float radius;

vec2 rand(vec2 co)
{
float noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));
float noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));
return clamp(vec2(noise1,noise2),0.0,1.0);
}

vec2 getDistortedCoords(vec2 coords) {
if (distortion == 0.0) { return coords; }
vec2 direction=1.0*normalize(centered_screen_pos);
vec2 dist_coords=vec2(0.5,0.5);
dist_coords.x=0.5+direction.x*radius2*1.0;
dist_coords.y=0.5+direction.y*radius2*1.0;
float dist_amount=clamp(distortion*0.23,0.0,1.0);
dist_coords=mix(coords,dist_coords,dist_amount);
return dist_coords;
}

float sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {

vec2 coords=distorted_coords;
float angle=rand(coords*100.0).x*TWOPI;
coords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));
color+=texture2D(textureSampler,coords)*weight;
return weight;
}

float getBlurLevel(float size) {
return min(3.0,ceil(size/1.0));
}

vec4 getBlurColor(float size) {
vec4 col=texture2D(textureSampler,distorted_coords);
if (size == 0.0) { return col; }


float blur_level=getBlurLevel(size);
float w=(size/screen_width);
float h=(size/screen_height);
float total_weight=1.0;
vec2 sample_coords;
total_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);
total_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);
total_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);
total_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);
total_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);
total_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);
total_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);
total_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);
total_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);
total_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);
if (blur_level>1.0) {
total_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);
total_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);
total_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);
total_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);
total_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);
total_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);
total_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);
total_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);
total_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);
total_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);
}
if (blur_level>2.0) {
total_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);
total_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);
total_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);
total_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);
total_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);
total_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);
total_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);
total_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);
total_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);
}
col/=total_weight;

if (darken>0.0) {
col.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);
}




return col;
}
void main(void)
{

centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);
radius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;
radius=sqrt(radius2);
distorted_coords=getDistortedCoords(vUV);
vec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height);
float depth=texture2D(depthSampler,distorted_coords).r;
float distance=near+(far-near)*depth;
vec4 color=texture2D(textureSampler,vUV);


float coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));

if (dof_enabled == false || coc<0.07) { coc=0.0; }

float edge_blur_amount=0.0;
if (edge_blur>0.0) {
edge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;
}

float blur_amount=max(edge_blur_amount,coc);

if (blur_amount == 0.0) {
gl_FragColor=texture2D(textureSampler,distorted_coords);
}
else {

gl_FragColor=getBlurColor(blur_amount*1.7);

if (highlights) {
gl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;
}
if (blur_noise) {

vec2 noise=rand(distorted_coords)*0.01*blur_amount;
vec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);
gl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;
}
}

if (grain_amount>0.0) {
vec4 grain_color=texture2D(grainSampler,texels_coords*0.003);
gl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;
}
}
`;Pa.a.ShadersStore.depthOfFieldPixelShader=Uo;var Vo=function(e){function b(a,c,d,f,g){void 0===f&&(f=1);var h=e.call(this,d.getEngine(),a)||this;return h.LensChromaticAberrationEffect="LensChromaticAberrationEffect",h.HighlightsEnhancingEffect="HighlightsEnhancingEffect",h.LensDepthOfFieldEffect="LensDepthOfFieldEffect",h._pentagonBokehIsEnabled=!1,h._scene=d,h._depthTexture=d.enableDepthRenderer().getDepthMap(),c.grain_texture?h._grainTexture=c.grain_texture:h._createGrainTexture(),h._edgeBlur=c.edge_blur?c.edge_blur:0,h._grainAmount=c.grain_amount?c.grain_amount:0,h._chromaticAberration=c.chromatic_aberration?c.chromatic_aberration:0,h._distortion=c.distortion?c.distortion:0,h._highlightsGain=void 0!==c.dof_gain?c.dof_gain:-1,h._highlightsThreshold=c.dof_threshold?c.dof_threshold:1,h._dofDistance=void 0!==c.dof_focus_distance?c.dof_focus_distance:-1,h._dofAperture=c.dof_aperture?c.dof_aperture:1,h._dofDarken=c.dof_darken?c.dof_darken:0,h._dofPentagon=void 0===c.dof_pentagon||c.dof_pentagon,h._blurNoise=void 0===c.blur_noise||c.blur_noise,h._createChromaticAberrationPostProcess(f),h._createHighlightsPostProcess(f),h._createDepthOfFieldPostProcess(f/4),h.addEffect(new pb(d.getEngine(),h.LensChromaticAberrationEffect,function(){return h._chromaticAberrationPostProcess},!0)),h.addEffect(new pb(d.getEngine(),h.HighlightsEnhancingEffect,function(){return h._highlightsPostProcess},!0)),h.addEffect(new pb(d.getEngine(),h.LensDepthOfFieldEffect,function(){return h._depthOfFieldPostProcess},!0)),-1===h._highlightsGain&&h._disableEffect(h.HighlightsEnhancingEffect,null),d.postProcessRenderPipelineManager.addPipeline(h),g&&d.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(a,g),h}return Object(l.d)(b,e),b.prototype.getClassName=function(){return"LensRenderingPipeline"},Object.defineProperty(b.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"edgeBlur",{get:function(){return this._edgeBlur},set:function(a){this.setEdgeBlur(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"grainAmount",{get:function(){return this._grainAmount},set:function(a){this.setGrainAmount(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"chromaticAberration",{get:function(){return this._chromaticAberration},set:function(a){this.setChromaticAberration(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dofAperture",{get:function(){return this._dofAperture},set:function(a){this.setAperture(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"edgeDistortion",{get:function(){return this._distortion},set:function(a){this.setEdgeDistortion(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dofDistortion",{get:function(){return this._dofDistance},set:function(a){this.setFocusDistance(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"darkenOutOfFocus",{get:function(){return this._dofDarken},set:function(a){this.setDarkenOutOfFocus(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"blurNoise",{get:function(){return this._blurNoise},set:function(a){this._blurNoise=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"pentagonBokeh",{get:function(){return this._pentagonBokehIsEnabled},set:function(a){a?this.enablePentagonBokeh():this.disablePentagonBokeh()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"highlightsGain",{get:function(){return this._highlightsGain},set:function(a){this.setHighlightsGain(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"highlightsThreshold",{get:function(){return this._highlightsThreshold},set:function(a){this.setHighlightsThreshold(a)},enumerable:!0,configurable:!0}),b.prototype.setEdgeBlur=function(a){this._edgeBlur=a},b.prototype.disableEdgeBlur=function(){this._edgeBlur=0},b.prototype.setGrainAmount=function(a){this._grainAmount=a},b.prototype.disableGrain=function(){this._grainAmount=0},b.prototype.setChromaticAberration=function(a){this._chromaticAberration=a},b.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},b.prototype.setEdgeDistortion=function(a){this._distortion=a},b.prototype.disableEdgeDistortion=function(){this._distortion=0},b.prototype.setFocusDistance=function(a){this._dofDistance=a},b.prototype.disableDepthOfField=function(){this._dofDistance=-1},b.prototype.setAperture=function(a){this._dofAperture=a},b.prototype.setDarkenOutOfFocus=function(a){this._dofDarken=a},b.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect(`#define PENTAGON
`),this._pentagonBokehIsEnabled=!0},b.prototype.disablePentagonBokeh=function(){this._pentagonBokehIsEnabled=!1,this._highlightsPostProcess.updateEffect()},b.prototype.enableNoiseBlur=function(){this._blurNoise=!0},b.prototype.disableNoiseBlur=function(){this._blurNoise=!1},b.prototype.setHighlightsGain=function(a){this._highlightsGain=a},b.prototype.setHighlightsThreshold=function(a){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=a},b.prototype.disableHighlights=function(){this._highlightsGain=-1},b.prototype.dispose=function(a){void 0===a&&(a=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),a&&this._scene.disableDepthRenderer()},b.prototype._createChromaticAberrationPostProcess=function(a){var c=this;this._chromaticAberrationPostProcess=new gb("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],a,null,ya.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(d){d.setFloat("chromatic_aberration",c._chromaticAberration),d.setFloat("screen_width",c._scene.getEngine().getRenderWidth()),d.setFloat("screen_height",c._scene.getEngine().getRenderHeight()),d.setFloat("radialIntensity",1),d.setFloat2("direction",17,17),d.setFloat2("centerPosition",.5,.5)}},b.prototype._createHighlightsPostProcess=function(a){var c=this;this._highlightsPostProcess=new gb("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],a,null,ya.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?`#define PENTAGON
`:""),this._highlightsPostProcess.onApply=function(d){d.setFloat("gain",c._highlightsGain),d.setFloat("threshold",c._highlightsThreshold),d.setTextureFromPostProcess("textureSampler",c._chromaticAberrationPostProcess),d.setFloat("screen_width",c._scene.getEngine().getRenderWidth()),d.setFloat("screen_height",c._scene.getEngine().getRenderHeight())}},b.prototype._createDepthOfFieldPostProcess=function(a){var c=this;this._depthOfFieldPostProcess=new gb("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],a,null,ya.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(d){d.setTexture("depthSampler",c._depthTexture),d.setTexture("grainSampler",c._grainTexture),d.setTextureFromPostProcess("textureSampler",c._highlightsPostProcess),d.setTextureFromPostProcess("highlightsSampler",c._depthOfFieldPostProcess),d.setFloat("grain_amount",c._grainAmount),d.setBool("blur_noise",c._blurNoise),d.setFloat("screen_width",c._scene.getEngine().getRenderWidth()),d.setFloat("screen_height",c._scene.getEngine().getRenderHeight()),d.setFloat("distortion",c._distortion),d.setBool("dof_enabled",-1!==c._dofDistance),d.setFloat("screen_distance",1/(.1-1/c._dofDistance)),d.setFloat("aperture",c._dofAperture),d.setFloat("darken",c._dofDarken),d.setFloat("edge_blur",c._edgeBlur),d.setBool("highlights",-1!==c._highlightsGain),c._scene.activeCamera&&(d.setFloat("near",c._scene.activeCamera.minZ),d.setFloat("far",c._scene.activeCamera.maxZ))}},b.prototype._createGrainTexture=function(){this._grainTexture=new Bc("LensNoiseTexture",512,this._scene,!1,ya.a.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=ya.a.WRAP_ADDRESSMODE,this._grainTexture.wrapV=ya.a.WRAP_ADDRESSMODE;for(var a,c,d,f=this._grainTexture.getContext(),g=0;g<512;g++)for(var h=0;h<512;h++)a=Math.floor(255*(c=.42,d=.58,Math.random()*(d-c)+c)),f.fillStyle="rgb("+a+", "+a+", "+a+")",f.fillRect(g,h,1,1);this._grainTexture.update(!1)},b}(de),Wo=`
precision highp float;
uniform sampler2D textureSampler;
uniform float near;
uniform float far;
uniform float radius;
float scales[16]=float[16](
0.1,
0.11406250000000001,
0.131640625,
0.15625,
0.187890625,
0.2265625,
0.272265625,
0.325,
0.384765625,
0.4515625,
0.525390625,
0.60625,
0.694140625,
0.7890625,
0.891015625,
1.0
);
varying vec2 vUV;
float perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {
return ( near*far )/( ( far-near )*invClipZ-far );
}
float viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {
return ( near*far/viewZ+far)/( far-near );
}
float viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {
return ( viewZ+near )/( near-far );
}
#ifdef SSAO
uniform sampler2D randomSampler;
uniform sampler2D normalSampler;
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float base;
uniform float xViewport;
uniform float yViewport;
uniform float maxZ;
uniform float minZAspect;
uniform vec2 texelSize;
uniform mat4 projection;
void main()
{
vec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;
float depth=texture2D(textureSampler,vUV).r;
float depthSign=depth/abs(depth);
depth=depth*depthSign;
vec3 normal=texture2D(normalSampler,vUV).rgb;
float occlusion=0.0;
float correctedRadius=min(radius,minZAspect*depth/near);
vec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);
vec3 origin=vViewRay*depth;
vec3 rvec=random*2.0-1.0;
rvec.z=0.0;

float dotProduct=dot(rvec,normal);
rvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);
vec3 tangent=normalize(rvec-normal*dot(rvec,normal));
vec3 bitangent=cross(normal,tangent);
mat3 tbn=mat3(tangent,bitangent,normal);
float difference;
for (int i=0; i<SAMPLES; ++i) {

vec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];
samplePosition=samplePosition*correctedRadius+origin;

vec4 offset=vec4(samplePosition,1.0);
offset=projection*offset;
offset.xyz/=offset.w;
offset.xy=offset.xy*0.5+0.5;
if (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {
continue;
}

float sampleDepth=abs(texture2D(textureSampler,offset.xy).r);

difference=depthSign*samplePosition.z-sampleDepth;
float rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);
occlusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;
}
occlusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor=vec4(vec3(result),1.0);
}
#endif
#ifdef BILATERAL_BLUR
uniform sampler2D depthSampler;
uniform float outSize;
uniform float samplerOffsets[SAMPLES];
vec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.3846153846)*direction;
vec2 off2=vec2(3.2307692308)*direction;
color+=texture2D(image,uv)*0.2270270270;
color+=texture2D(image,uv+(off1/resolution))*0.3162162162;
color+=texture2D(image,uv-(off1/resolution))*0.3162162162;
color+=texture2D(image,uv+(off2/resolution))*0.0702702703;
color+=texture2D(image,uv-(off2/resolution))*0.0702702703;
return color;
}
vec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
color+=texture2D(image,uv)*0.1964825501511404;
color+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;
color+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;
return color;
}
vec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
float compareDepth=abs(texture2D(depthSampler,uv).r);
float sampleDepth;
float weight;
float weightSum=30.0;
color+=texture2D(image,uv)*30.0;
sampleDepth=abs(texture2D(depthSampler,uv+(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv-(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv+(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv-(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv+(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off3/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv-(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off3/resolution))*weight;
return color/weightSum;
}
void main()
{
#if EXPENSIVE
float compareDepth=abs(texture2D(depthSampler,vUV).r);
float texelsize=1.0/outSize;
float result=0.0;
float weightSum=0.0;
for (int i=0; i<SAMPLES; ++i)
{
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
vec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);
#else
vec2 direction=vec2(0.0,1.0);
vec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);
#endif
vec2 samplePos=vUV+sampleOffset;
float sampleDepth=abs(texture2D(depthSampler,samplePos).r);
float weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);
result+=texture2D(textureSampler,samplePos).r*weight;
weightSum+=weight;
}
result/=weightSum;
gl_FragColor.rgb=vec3(result);
gl_FragColor.a=1.0;
#else
vec4 color;
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#else
vec2 direction=vec2(0.0,1.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#endif
gl_FragColor.rgb=vec3(color.r);
gl_FragColor.a=1.0;
#endif
}
#endif
`;Pa.a.ShadersStore.ssao2PixelShader=Wo;var Xo=`uniform sampler2D textureSampler;
uniform sampler2D originalColor;
uniform vec4 viewport;
varying vec2 vUV;
void main(void) {
vec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);
vec4 sceneColor=texture2D(originalColor,vUV);
gl_FragColor=sceneColor*ssaoColor;
}
`;Pa.a.ShadersStore.ssaoCombinePixelShader=Xo;var fl=function(e){function b(a,c,d,f){var g=e.call(this,c.getEngine(),a)||this;if(g.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",g.SSAORenderEffect="SSAORenderEffect",g.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",g.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",g.SSAOCombineRenderEffect="SSAOCombineRenderEffect",g.totalStrength=1,g.maxZ=100,g.minZAspect=.2,g._samples=8,g._textureSamples=1,g._expensiveBlur=!0,g.radius=2,g.base=0,g._bits=new Uint32Array(1),g._scene=c,g._ratio=d,!g.isSupported)return k.a.Error("SSAO 2 needs WebGL 2 support."),g;var h=g._ratio.ssaoRatio||d,j=g._ratio.blurRatio||d,m=c.enableGeometryBufferRenderer();return g._createRandomTexture(),g._depthTexture=m.getGBuffer().textures[0],g._normalTexture=m.getGBuffer().textures[1],g._originalColorPostProcess=new Wc("SSAOOriginalSceneColor",1,null,ya.a.BILINEAR_SAMPLINGMODE,c.getEngine(),!1),g._originalColorPostProcess.samples=g.textureSamples,g._createSSAOPostProcess(1),g._createBlurPostProcess(h,j),g._createSSAOCombinePostProcess(j),g.addEffect(new pb(c.getEngine(),g.SSAOOriginalSceneColorEffect,function(){return g._originalColorPostProcess},!0)),g.addEffect(new pb(c.getEngine(),g.SSAORenderEffect,function(){return g._ssaoPostProcess},!0)),g.addEffect(new pb(c.getEngine(),g.SSAOBlurHRenderEffect,function(){return g._blurHPostProcess},!0)),g.addEffect(new pb(c.getEngine(),g.SSAOBlurVRenderEffect,function(){return g._blurVPostProcess},!0)),g.addEffect(new pb(c.getEngine(),g.SSAOCombineRenderEffect,function(){return g._ssaoCombinePostProcess},!0)),c.postProcessRenderPipelineManager.addPipeline(g),f&&c.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(a,f),g}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"samples",{get:function(){return this._samples},set:function(a){this._ssaoPostProcess.updateEffect("#define SAMPLES "+a+`
#define SSAO`),this._samples=a,this._sampleSphere=this._generateHemisphere()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(a){this._textureSamples=a,this._originalColorPostProcess.samples=a,this._blurHPostProcess.samples=a,this._blurVPostProcess.samples=a,this._ssaoPostProcess.samples=a,this._ssaoCombinePostProcess.samples=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(a){this._blurHPostProcess.updateEffect(`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(a?"1":"0")+`
`,null,["textureSampler","depthSampler"]),this._blurVPostProcess.updateEffect(`#define BILATERAL_BLUR
#define SAMPLES 16
#define EXPENSIVE `+(a?"1":"0")+`
`,null,["textureSampler","depthSampler"]),this._expensiveBlur=a},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsSupported",{get:function(){var a=U.a.LastCreatedEngine;return!!a&&a.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"SSAO2RenderingPipeline"},b.prototype.dispose=function(a){void 0===a&&(a=!1);for(var c=0;c<this._scene.cameras.length;c++){var d=this._scene.cameras[c];this._originalColorPostProcess.dispose(d),this._ssaoPostProcess.dispose(d),this._blurHPostProcess.dispose(d),this._blurVPostProcess.dispose(d),this._ssaoCombinePostProcess.dispose(d)}this._randomTexture.dispose(),a&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),e.prototype.dispose.call(this)},b.prototype._createBlurPostProcess=function(a,c){var d=this;this._samplerOffsets=[];for(var f=this.expensiveBlur,g=-8;g<8;g++)this._samplerOffsets.push(2*g+.5);this._blurHPostProcess=new gb("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],a,null,ya.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(f?"1":"0")+`
`),this._blurHPostProcess.onApply=function(h){d._scene.activeCamera&&(h.setFloat("outSize",d._ssaoCombinePostProcess.width>0?d._ssaoCombinePostProcess.width:d._originalColorPostProcess.width),h.setFloat("near",d._scene.activeCamera.minZ),h.setFloat("far",d._scene.activeCamera.maxZ),h.setFloat("radius",d.radius),h.setTexture("depthSampler",d._depthTexture),h.setArray("samplerOffsets",d._samplerOffsets))},this._blurVPostProcess=new gb("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],c,null,ya.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_V
#define SAMPLES 16
#define EXPENSIVE `+(f?"1":"0")+`
`),this._blurVPostProcess.onApply=function(h){d._scene.activeCamera&&(h.setFloat("outSize",d._ssaoCombinePostProcess.height>0?d._ssaoCombinePostProcess.height:d._originalColorPostProcess.height),h.setFloat("near",d._scene.activeCamera.minZ),h.setFloat("far",d._scene.activeCamera.maxZ),h.setFloat("radius",d.radius),h.setTexture("depthSampler",d._depthTexture),h.setArray("samplerOffsets",d._samplerOffsets))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},b.prototype._rebuild=function(){e.prototype._rebuild.call(this)},b.prototype._radicalInverse_VdC=function(a){return this._bits[0]=a,this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0,this._bits[0]=(1431655765&this._bits[0])<<1|(2863311530&this._bits[0])>>>1>>>0,this._bits[0]=(858993459&this._bits[0])<<2|(3435973836&this._bits[0])>>>2>>>0,this._bits[0]=(252645135&this._bits[0])<<4|(4042322160&this._bits[0])>>>4>>>0,this._bits[0]=(16711935&this._bits[0])<<8|(4278255360&this._bits[0])>>>8>>>0,2.3283064365386963e-10*this._bits[0]},b.prototype._hammersley=function(a,c){return[a/c,this._radicalInverse_VdC(a)]},b.prototype._hemisphereSample_uniform=function(a,c){var d=2*c*Math.PI,f=1-(.85*a+.15),g=Math.sqrt(1-f*f);return new i.e(Math.cos(d)*g,Math.sin(d)*g,f)},b.prototype._generateHemisphere=function(){for(var a,c=this.samples,d=[],f=0;f<c;){if(c<16)a=this._hemisphereSample_uniform(Math.random(),Math.random());else{var g=this._hammersley(f,c);a=this._hemisphereSample_uniform(g[0],g[1])}d.push(a.x,a.y,a.z),f++}return d},b.prototype._createSSAOPostProcess=function(a){var c=this,d=this.samples;this._sampleSphere=this._generateHemisphere(),this._ssaoPostProcess=new gb("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],["randomSampler","normalSampler"],a,null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+d+`
#define SSAO`),this._ssaoPostProcess.onApply=function(f){c._scene.activeCamera&&(f.setArray3("sampleSphere",c._sampleSphere),f.setFloat("randTextureTiles",32),f.setFloat("samplesFactor",1/c.samples),f.setFloat("totalStrength",c.totalStrength),f.setFloat2("texelSize",1/c._ssaoPostProcess.width,1/c._ssaoPostProcess.height),f.setFloat("radius",c.radius),f.setFloat("maxZ",c.maxZ),f.setFloat("minZAspect",c.minZAspect),f.setFloat("base",c.base),f.setFloat("near",c._scene.activeCamera.minZ),f.setFloat("far",c._scene.activeCamera.maxZ),f.setFloat("xViewport",Math.tan(c._scene.activeCamera.fov/2)*c._scene.getEngine().getAspectRatio(c._scene.activeCamera,!0)),f.setFloat("yViewport",Math.tan(c._scene.activeCamera.fov/2)),f.setMatrix("projection",c._scene.getProjectionMatrix()),f.setTexture("textureSampler",c._depthTexture),f.setTexture("normalSampler",c._normalTexture),f.setTexture("randomSampler",c._randomTexture))},this._ssaoPostProcess.samples=this.textureSamples},b.prototype._createSSAOCombinePostProcess=function(a){var c=this;this._ssaoCombinePostProcess=new gb("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],a,null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(d){var f=c._scene.activeCamera.viewport;d.setVector4("viewport",i.c.Vector4[0].copyFromFloats(f.x,f.y,f.width,f.height)),d.setTextureFromPostProcess("originalColor",c._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples},b.prototype._createRandomTexture=function(){this._randomTexture=new Bc("SSAORandomTexture",128,this._scene,!1,ya.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=ya.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=ya.a.WRAP_ADDRESSMODE;for(var a=this._randomTexture.getContext(),c=function(h,j){return Math.random()*(j-h)+h},d=i.e.Zero(),f=0;f<128;f++)for(var g=0;g<128;g++)d.x=c(0,1),d.y=c(0,1),d.z=0,d.normalize(),d.scaleInPlace(255),d.x=Math.floor(d.x),d.y=Math.floor(d.y),a.fillStyle="rgb("+d.x+", "+d.y+", "+d.z+")",a.fillRect(f,g,1,1);this._randomTexture.update(!1)},b.prototype.serialize=function(){var a=F.a.Serialize(this);return a.customType="SSAO2RenderingPipeline",a},b.Parse=function(a,c,d){return F.a.Parse(function(){return new b(a._name,c,a._ratio)},a,c,d)},Object(l.c)([Object(F.c)()],b.prototype,"totalStrength",void 0),Object(l.c)([Object(F.c)()],b.prototype,"maxZ",void 0),Object(l.c)([Object(F.c)()],b.prototype,"minZAspect",void 0),Object(l.c)([Object(F.c)("samples")],b.prototype,"_samples",void 0),Object(l.c)([Object(F.c)("textureSamples")],b.prototype,"_textureSamples",void 0),Object(l.c)([Object(F.c)()],b.prototype,"_ratio",void 0),Object(l.c)([Object(F.c)("expensiveBlur")],b.prototype,"_expensiveBlur",void 0),Object(l.c)([Object(F.c)()],b.prototype,"radius",void 0),Object(l.c)([Object(F.c)()],b.prototype,"base",void 0),b}(de);D.a.RegisteredTypes["BABYLON.SSAO2RenderingPipeline"]=fl;var Yo=`
uniform sampler2D textureSampler;
varying vec2 vUV;
#ifdef SSAO
uniform sampler2D randomSampler;
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float radius;
uniform float area;
uniform float fallOff;
uniform float base;
vec3 normalFromDepth(float depth,vec2 coords)
{
vec2 offset1=vec2(0.0,radius);
vec2 offset2=vec2(radius,0.0);
float depth1=texture2D(textureSampler,coords+offset1).r;
float depth2=texture2D(textureSampler,coords+offset2).r;
vec3 p1=vec3(offset1,depth1-depth);
vec3 p2=vec3(offset2,depth2-depth);
vec3 normal=cross(p1,p2);
normal.z=-normal.z;
return normalize(normal);
}
void main()
{
vec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);
float depth=texture2D(textureSampler,vUV).r;
vec3 position=vec3(vUV,depth);
vec3 normal=normalFromDepth(depth,vUV);
float radiusDepth=radius/depth;
float occlusion=0.0;
vec3 ray;
vec3 hemiRay;
float occlusionDepth;
float difference;
for (int i=0; i<SAMPLES; i++)
{
ray=radiusDepth*reflect(sampleSphere[i],random);
hemiRay=position+sign(dot(ray,normal))*ray;
occlusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;
difference=depth-occlusionDepth;
occlusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));
}
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor.r=result;
gl_FragColor.g=result;
gl_FragColor.b=result;
gl_FragColor.a=1.0;
}
#endif
`;Pa.a.ShadersStore.ssaoPixelShader=Yo;var Zo=function(e){function b(a,c,d,f){var g=e.call(this,c.getEngine(),a)||this;g.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",g.SSAORenderEffect="SSAORenderEffect",g.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",g.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",g.SSAOCombineRenderEffect="SSAOCombineRenderEffect",g.totalStrength=1,g.radius=.0001,g.area=.0075,g.fallOff=1e-06,g.base=.5,g._firstUpdate=!0,g._scene=c,g._createRandomTexture(),g._depthTexture=c.enableDepthRenderer().getDepthMap();var h=d.ssaoRatio||d,j=d.combineRatio||d;return g._originalColorPostProcess=new Wc("SSAOOriginalSceneColor",j,null,ya.a.BILINEAR_SAMPLINGMODE,c.getEngine(),!1),g._createSSAOPostProcess(h),g._createBlurPostProcess(h),g._createSSAOCombinePostProcess(j),g.addEffect(new pb(c.getEngine(),g.SSAOOriginalSceneColorEffect,function(){return g._originalColorPostProcess},!0)),g.addEffect(new pb(c.getEngine(),g.SSAORenderEffect,function(){return g._ssaoPostProcess},!0)),g.addEffect(new pb(c.getEngine(),g.SSAOBlurHRenderEffect,function(){return g._blurHPostProcess},!0)),g.addEffect(new pb(c.getEngine(),g.SSAOBlurVRenderEffect,function(){return g._blurVPostProcess},!0)),g.addEffect(new pb(c.getEngine(),g.SSAOCombineRenderEffect,function(){return g._ssaoCombinePostProcess},!0)),c.postProcessRenderPipelineManager.addPipeline(g),f&&c.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(a,f),g}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"SSAORenderingPipeline"},b.prototype.dispose=function(a){void 0===a&&(a=!1);for(var c=0;c<this._scene.cameras.length;c++){var d=this._scene.cameras[c];this._originalColorPostProcess.dispose(d),this._ssaoPostProcess.dispose(d),this._blurHPostProcess.dispose(d),this._blurVPostProcess.dispose(d),this._ssaoCombinePostProcess.dispose(d)}this._randomTexture.dispose(),a&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),e.prototype.dispose.call(this)},b.prototype._createBlurPostProcess=function(a){var c=this;this._blurHPostProcess=new Xb("BlurH",new i.d(1,0),16,a,null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,p.a.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new Xb("BlurV",new i.d(0,1),16,a,null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,p.a.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add(function(){var d=c._blurHPostProcess.width/c._scene.getEngine().getRenderWidth();c._blurHPostProcess.kernel=16*d}),this._blurVPostProcess.onActivateObservable.add(function(){var d=c._blurVPostProcess.height/c._scene.getEngine().getRenderHeight();c._blurVPostProcess.kernel=16*d})},b.prototype._rebuild=function(){this._firstUpdate=!0,e.prototype._rebuild.call(this)},b.prototype._createSSAOPostProcess=function(a){var c=this,d=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new gb("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],a,null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define SAMPLES 16
#define SSAO`),this._ssaoPostProcess.onApply=function(f){c._firstUpdate&&(f.setArray3("sampleSphere",d),f.setFloat("samplesFactor",1/16),f.setFloat("randTextureTiles",4)),f.setFloat("totalStrength",c.totalStrength),f.setFloat("radius",c.radius),f.setFloat("area",c.area),f.setFloat("fallOff",c.fallOff),f.setFloat("base",c.base),f.setTexture("textureSampler",c._depthTexture),f.setTexture("randomSampler",c._randomTexture)}},b.prototype._createSSAOCombinePostProcess=function(a){var c=this;this._ssaoCombinePostProcess=new gb("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],a,null,ya.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(d){d.setVector4("viewport",i.c.Vector4[0].copyFromFloats(0,0,1,1)),d.setTextureFromPostProcess("originalColor",c._originalColorPostProcess)}},b.prototype._createRandomTexture=function(){this._randomTexture=new Bc("SSAORandomTexture",512,this._scene,!1,ya.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=ya.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=ya.a.WRAP_ADDRESSMODE;for(var a=this._randomTexture.getContext(),c=function(h,j){return Math.random()*(j-h)+h},d=i.e.Zero(),f=0;f<512;f++)for(var g=0;g<512;g++)d.x=Math.floor(255*c(-1,1)),d.y=Math.floor(255*c(-1,1)),d.z=Math.floor(255*c(-1,1)),a.fillStyle="rgb("+d.x+", "+d.y+", "+d.z+")",a.fillRect(f,g,1,1);this._randomTexture.update(!1)},Object(l.c)([Object(F.c)()],b.prototype,"totalStrength",void 0),Object(l.c)([Object(F.c)()],b.prototype,"radius",void 0),Object(l.c)([Object(F.c)()],b.prototype,"area",void 0),Object(l.c)([Object(F.c)()],b.prototype,"fallOff",void 0),Object(l.c)([Object(F.c)()],b.prototype,"base",void 0),b}(de),_o=`

uniform sampler2D textureSampler;
uniform sampler2D normalSampler;
uniform sampler2D positionSampler;
uniform sampler2D reflectivitySampler;
uniform mat4 view;
uniform mat4 projection;
uniform float step;
uniform float strength;
uniform float threshold;
uniform float roughnessFactor;
uniform float reflectionSpecularFalloffExponent;

varying vec2 vUV;

struct ReflectionInfo {
vec3 color;
vec4 coords;
};

vec3 fresnelSchlick(float cosTheta,vec3 F0)
{
return F0+(1.0-F0)*pow(1.0-cosTheta,5.0);
}

ReflectionInfo smoothReflectionInfo(vec3 dir,vec3 hitCoord)
{
ReflectionInfo info;
info.color=vec3(0.0);
vec4 projectedCoord;
float sampledDepth;
for(int i=0; i<SMOOTH_STEPS; i++)
{
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);
sampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;
float depth=sampledDepth-hitCoord.z;
dir*=0.5;
if(depth>0.0)
hitCoord-=dir;
else
hitCoord+=dir;
info.color+=texture2D(textureSampler,projectedCoord.xy).rgb;
}
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);

info.coords=vec4(projectedCoord.xy,sampledDepth,1.0);
info.color+=texture2D(textureSampler,projectedCoord.xy).rgb;
info.color/=float(SMOOTH_STEPS+1);
return info;
}

ReflectionInfo getReflectionInfo(vec3 dir,vec3 hitCoord)
{
ReflectionInfo info;
vec4 projectedCoord;
float sampledDepth;
dir*=step;
for(int i=0; i<REFLECTION_SAMPLES; i++)
{
hitCoord+=dir;
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);
sampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;
float depth=sampledDepth-hitCoord.z;
if(((depth-dir.z)<threshold) && depth<=0.0)
{
#ifdef ENABLE_SMOOTH_REFLECTIONS
return smoothReflectionInfo(dir,hitCoord);
#else
info.color=texture2D(textureSampler,projectedCoord.xy).rgb;
info.coords=vec4(projectedCoord.xy,sampledDepth,0.0);
return info;
#endif
}
}
info.color=texture2D(textureSampler,projectedCoord.xy).rgb;
info.coords=vec4(projectedCoord.xy,sampledDepth,0.0);
return info;
}
vec3 hash(vec3 a)
{
a=fract(a*0.8);
a+=dot(a,a.yxz+19.19);
return fract((a.xxy+a.yxx)*a.zyx);
}
void main()
{
#ifdef SSR_SUPPORTED

vec3 albedo=texture2D(textureSampler,vUV).rgb;
float spec=texture2D(reflectivitySampler,vUV).r;
if (spec == 0.0) {
gl_FragColor=vec4(albedo,1.0);
return;
}

vec3 normal=(texture2D(normalSampler,vUV)).xyz;
vec3 position=(view*texture2D(positionSampler,vUV)).xyz;
vec3 reflected=normalize(reflect(normalize(position),normalize(normal)));
float roughness=1.0-texture2D(reflectivitySampler,vUV).a;
vec3 jitt=mix(vec3(0.0),hash(position),roughness)*roughnessFactor;
ReflectionInfo info=getReflectionInfo(jitt+reflected,position);

vec2 dCoords=smoothstep(0.2,0.6,abs(vec2(0.5,0.5)-info.coords.xy));
float screenEdgefactor=clamp(1.0-(dCoords.x+dCoords.y),0.0,1.0);

vec3 F0=vec3(0.04);
F0=mix(F0,albedo,spec);
vec3 fresnel=fresnelSchlick(max(dot(normalize(normal),normalize(position)),0.0),F0);

float reflectionMultiplier=clamp(pow(spec*strength,reflectionSpecularFalloffExponent)*screenEdgefactor*reflected.z,0.0,0.9);
float albedoMultiplier=1.0-reflectionMultiplier;
vec3 SSR=info.color*fresnel;
gl_FragColor=vec4((albedo*albedoMultiplier)+(SSR*reflectionMultiplier),1.0);
#else
gl_FragColor=texture2D(textureSampler,vUV);
#endif
}
`;Pa.a.ShadersStore.screenSpaceReflectionPixelShader=_o;var gl=function(e){function b(a,c,d,f,g,h,j,m,w){void 0===m&&(m=p.a.TEXTURETYPE_UNSIGNED_INT),void 0===w&&(w=!1);var z=e.call(this,a,"screenSpaceReflection",["projection","view","threshold","reflectionSpecularFalloffExponent","strength","step","roughnessFactor"],["textureSampler","normalSampler","positionSampler","reflectivitySampler"],d,f,g,h,j,`#define SSR_SUPPORTED
#define REFLECTION_SAMPLES 64
#define SMOOTH_STEPS 5
`,m,void 0,null,w)||this;z.threshold=1.2,z.strength=1,z.reflectionSpecularFalloffExponent=3,z.step=1,z.roughnessFactor=.2,z._enableSmoothReflections=!1,z._reflectionSamples=64,z._smoothSteps=5;var C=c.enableGeometryBufferRenderer();return C&&C.isSupported&&(C.enablePosition=!0,C.enableReflectivity=!0,z._geometryBufferRenderer=C),z._updateEffectDefines(),z.onApply=function(J){if(C){var K=C.getTextureIndex(ce.POSITION_TEXTURE_TYPE),N=C.getTextureIndex(ce.REFLECTIVITY_TEXTURE_TYPE);J.setTexture("normalSampler",C.getGBuffer().textures[1]),J.setTexture("positionSampler",C.getGBuffer().textures[K]),J.setTexture("reflectivitySampler",C.getGBuffer().textures[N]);var T=c.activeCamera;if(T){var Z=T.getViewMatrix(),_=T.getProjectionMatrix();J.setMatrix("projection",_),J.setMatrix("view",Z),J.setFloat("threshold",z.threshold),J.setFloat("reflectionSpecularFalloffExponent",z.reflectionSpecularFalloffExponent),J.setFloat("strength",z.strength),J.setFloat("step",z.step),J.setFloat("roughnessFactor",z.roughnessFactor)}}},z}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"enableSmoothReflections",{get:function(){return this._enableSmoothReflections},set:function(a){a!==this._enableSmoothReflections&&(this._enableSmoothReflections=a,this._updateEffectDefines())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"reflectionSamples",{get:function(){return this._reflectionSamples},set:function(a){a!==this._reflectionSamples&&(this._reflectionSamples=a,this._updateEffectDefines())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"smoothSteps",{get:function(){return this._smoothSteps},set:function(a){a!==this._smoothSteps&&(this._smoothSteps=a,this._updateEffectDefines())},enumerable:!0,configurable:!0}),b.prototype._updateEffectDefines=function(){var a=[];this._geometryBufferRenderer&&a.push("#define SSR_SUPPORTED"),this._enableSmoothReflections&&a.push("#define ENABLE_SMOOTH_REFLECTIONS"),a.push("#define REFLECTION_SAMPLES "+(this._reflectionSamples>>0)),a.push("#define SMOOTH_STEPS "+(this._smoothSteps>>0)),this.updateEffect(a.join(`
`))},Object(l.c)([Object(F.c)()],b.prototype,"threshold",void 0),Object(l.c)([Object(F.c)()],b.prototype,"strength",void 0),Object(l.c)([Object(F.c)()],b.prototype,"reflectionSpecularFalloffExponent",void 0),Object(l.c)([Object(F.c)()],b.prototype,"step",void 0),Object(l.c)([Object(F.c)()],b.prototype,"roughnessFactor",void 0),Object(l.c)([Object(F.c)()],b.prototype,"enableSmoothReflections",null),Object(l.c)([Object(F.c)()],b.prototype,"reflectionSamples",null),Object(l.c)([Object(F.c)()],b.prototype,"smoothSteps",null),b}(gb),$o=`uniform sampler2D textureSampler;
varying vec2 vUV;
#if defined(PASS_POST_PROCESS)
void main(void)
{
vec4 color=texture2D(textureSampler,vUV);
gl_FragColor=color;
}
#endif
#if defined(DOWN_SAMPLE_X4)
uniform vec2 dsOffsets[16];
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+dsOffsets[0]);
average+=texture2D(textureSampler,vUV+dsOffsets[1]);
average+=texture2D(textureSampler,vUV+dsOffsets[2]);
average+=texture2D(textureSampler,vUV+dsOffsets[3]);
average+=texture2D(textureSampler,vUV+dsOffsets[4]);
average+=texture2D(textureSampler,vUV+dsOffsets[5]);
average+=texture2D(textureSampler,vUV+dsOffsets[6]);
average+=texture2D(textureSampler,vUV+dsOffsets[7]);
average+=texture2D(textureSampler,vUV+dsOffsets[8]);
average+=texture2D(textureSampler,vUV+dsOffsets[9]);
average+=texture2D(textureSampler,vUV+dsOffsets[10]);
average+=texture2D(textureSampler,vUV+dsOffsets[11]);
average+=texture2D(textureSampler,vUV+dsOffsets[12]);
average+=texture2D(textureSampler,vUV+dsOffsets[13]);
average+=texture2D(textureSampler,vUV+dsOffsets[14]);
average+=texture2D(textureSampler,vUV+dsOffsets[15]);
average/=16.0;
gl_FragColor=average;
}
#endif
#if defined(BRIGHT_PASS)
uniform vec2 dsOffsets[4];
uniform float brightThreshold;
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));
average*=0.25;
float luminance=length(average.rgb);
if (luminance<brightThreshold) {
average=vec4(0.0,0.0,0.0,1.0);
}
gl_FragColor=average;
}
#endif
#if defined(TEXTURE_ADDER)
uniform sampler2D otherSampler;
uniform sampler2D lensSampler;
uniform float exposure;
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
colour*=exposure;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
colour+=colour*texture2D(lensSampler,vUV).rgb;
vec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);
gl_FragColor=finalColor;
}
#endif
#if defined(VLS)
#define PI 3.1415926535897932384626433832795
uniform mat4 shadowViewProjection;
uniform mat4 lightWorld;
uniform vec3 cameraPosition;
uniform vec3 sunDirection;
uniform vec3 sunColor;
uniform vec2 depthValues;
uniform float scatteringCoefficient;
uniform float scatteringPower;
uniform sampler2D shadowMapSampler;
uniform sampler2D positionSampler;
float computeScattering(float lightDotView)
{
float result=1.0-scatteringCoefficient*scatteringCoefficient;
result/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));
return result;
}
void main(void)
{

vec3 worldPos=texture2D(positionSampler,vUV).rgb;
vec3 startPosition=cameraPosition;
vec3 rayVector=worldPos-startPosition;
float rayLength=length(rayVector);
vec3 rayDirection=rayVector/rayLength;
float stepLength=rayLength/NB_STEPS;
vec3 stepL=rayDirection*stepLength;
vec3 currentPosition=startPosition;
vec3 accumFog=vec3(0.0);
for (int i=0; i<int(NB_STEPS); i++)
{
vec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);
float depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depthMetric,0.0,1.0);
worldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;
worldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);
float shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;
if (shadowMapValue>shadowPixelDepth)
accumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));
currentPosition+=stepL;
}
accumFog/=NB_STEPS;
vec3 color=accumFog*scatteringPower;
gl_FragColor=vec4(color*exp(color) ,1.0);
}
#endif
#if defined(VLSMERGE)
uniform sampler2D originalSampler;
void main(void)
{
gl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);
}
#endif
#if defined(LUMINANCE)
uniform vec2 lumOffsets[4];
void main()
{
float average=0.0;
vec4 color=vec4(0.0);
float maximum=-1e20;
vec3 weight=vec3(0.299,0.587,0.114);
for (int i=0; i<4; i++)
{
color=texture2D(textureSampler,vUV+ lumOffsets[i]);

float GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));

#ifdef WEIGHTED_AVERAGE
float GreyValue=dot(color.rgb,weight);
#endif
#ifdef BRIGHTNESS
float GreyValue=max(color.r,max(color.g,color.b));
#endif
#ifdef HSL_COMPONENT
float GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));
#endif
#ifdef MAGNITUDE
float GreyValue=length(color.rgb);
#endif
maximum=max(maximum,GreyValue);
average+=(0.25*log(1e-5+GreyValue));
}
average=exp(average);
gl_FragColor=vec4(average,maximum,0.0,1.0);
}
#endif
#if defined(LUMINANCE_DOWN_SAMPLE)
uniform vec2 dsOffsets[9];
uniform float halfDestPixelSize;
#ifdef FINAL_DOWN_SAMPLER
#include<packingFunctions>
#endif
void main()
{
vec4 color=vec4(0.0);
float average=0.0;
for (int i=0; i<9; i++)
{
color=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);
average+=color.r;
}
average/=9.0;
#ifdef FINAL_DOWN_SAMPLER
gl_FragColor=pack(average);
#else
gl_FragColor=vec4(average,average,0.0,1.0);
#endif
}
#endif
#if defined(HDR)
uniform sampler2D textureAdderSampler;
uniform float averageLuminance;
void main()
{
vec4 color=texture2D(textureAdderSampler,vUV);
#ifndef AUTO_EXPOSURE
vec4 adjustedColor=color/averageLuminance;
color=adjustedColor;
color.a=1.0;
#endif
gl_FragColor=color;
}
#endif
#if defined(LENS_FLARE)
#define GHOSTS 3
uniform sampler2D lensColorSampler;
uniform float strength;
uniform float ghostDispersal;
uniform float haloWidth;
uniform vec2 resolution;
uniform float distortionStrength;
float hash(vec2 p)
{
float h=dot(p,vec2(127.1,311.7));
return -1.0+2.0*fract(sin(h)*43758.5453123);
}
float noise(in vec2 p)
{
vec2 i=floor(p);
vec2 f=fract(p);
vec2 u=f*f*(3.0-2.0*f);
return mix(mix(hash(i+vec2(0.0,0.0)),
hash(i+vec2(1.0,0.0)),u.x),
mix(hash(i+vec2(0.0,1.0)),
hash(i+vec2(1.0,1.0)),u.x),u.y);
}
float fbm(vec2 p)
{
float f=0.0;
f+=0.5000*noise(p); p*=2.02;
f+=0.2500*noise(p); p*=2.03;
f+=0.1250*noise(p); p*=2.01;
f+=0.0625*noise(p); p*=2.04;
f/=0.9375;
return f;
}
vec3 pattern(vec2 uv)
{
vec2 p=-1.0+2.0*uv;
float p2=dot(p,p);
float f=fbm(vec2(15.0*p2))/2.0;
float r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));
float g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));
float b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));
return (1.0-f)*vec3(r,g,b);
}
float luminance(vec3 color)
{
return dot(color.rgb,vec3(0.2126,0.7152,0.0722));
}
vec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)
{
return vec4(
texture2D(tex,texcoord+direction*distortion.r).r,
texture2D(tex,texcoord+direction*distortion.g).g,
texture2D(tex,texcoord+direction*distortion.b).b,
1.0
);
}
void main(void)
{
vec2 uv=-vUV+vec2(1.0);
vec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;
vec2 texelSize=1.0/resolution;
vec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);
vec4 result=vec4(0.0);
float ghostIndice=1.0;
for (int i=0; i<GHOSTS; ++i)
{
vec2 offset=fract(uv+ghostDir*ghostIndice);
float weight=length(vec2(0.5)-offset)/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;
ghostIndice+=1.0;
}
vec2 haloVec=normalize(ghostDir)*haloWidth;
float weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;
result*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));
gl_FragColor=result;
}
#endif
#if defined(LENS_FLARE_COMPOSE)
uniform sampler2D otherSampler;
uniform sampler2D lensDirtSampler;
uniform sampler2D lensStarSampler;
uniform mat4 lensStarMatrix;
void main(void)
{
vec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;
vec4 lensMod=texture2D(lensDirtSampler,vUV);
lensMod+=texture2D(lensStarSampler,vUV);
vec4 result=texture2D(textureSampler,vUV)*lensMod;
gl_FragColor=texture2D(otherSampler,vUV)+result;
}
#endif
#if defined(DEPTH_OF_FIELD)
uniform sampler2D otherSampler;
uniform sampler2D depthSampler;
uniform float distance;
void main(void)
{
vec4 sharp=texture2D(otherSampler,vUV);
vec4 blur=texture2D(textureSampler,vUV);
float dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);
float factor=0.0;
if (dist<0.05)
factor=1.0;
else if (dist<0.1)
factor=20.0*(0.1-dist);
else if (dist<0.5)
factor=0.0;
else
factor=2.0*(dist-0.5);
factor=clamp(factor,0.0,0.90);
gl_FragColor=mix(sharp,blur,factor);
}
#endif
#if defined(MOTION_BLUR)
uniform mat4 inverseViewProjection;
uniform mat4 prevViewProjection;
uniform vec2 screenSize;
uniform float motionScale;
uniform float motionStrength;
uniform sampler2D depthSampler;
void main(void)
{
vec2 texelSize=1.0/screenSize;
float depth=texture2D(depthSampler,vUV).r;
vec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);
cpos=cpos*inverseViewProjection;
vec4 ppos=cpos*prevViewProjection;
ppos.xyz/=ppos.w;
ppos.xy=ppos.xy*0.5+0.5;
vec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;
float speed=length(velocity/texelSize);
int nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {
if (i>=nSamples)
break;
vec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);
result+=texture2D(textureSampler,offset1);
}
gl_FragColor=result/float(nSamples);
}
#endif
`;Pa.a.ShadersStore.standardPixelShader=$o;var hl=function(e){function b(a,c,d,f,g){void 0===f&&(f=null);var h=e.call(this,c.getEngine(),a)||this;return h.downSampleX4PostProcess=null,h.brightPassPostProcess=null,h.blurHPostProcesses=[],h.blurVPostProcesses=[],h.textureAdderPostProcess=null,h.volumetricLightPostProcess=null,h.volumetricLightSmoothXPostProcess=null,h.volumetricLightSmoothYPostProcess=null,h.volumetricLightMergePostProces=null,h.volumetricLightFinalPostProcess=null,h.luminancePostProcess=null,h.luminanceDownSamplePostProcesses=[],h.hdrPostProcess=null,h.textureAdderFinalPostProcess=null,h.lensFlareFinalPostProcess=null,h.hdrFinalPostProcess=null,h.lensFlarePostProcess=null,h.lensFlareComposePostProcess=null,h.motionBlurPostProcess=null,h.depthOfFieldPostProcess=null,h.fxaaPostProcess=null,h.screenSpaceReflectionPostProcess=null,h.brightThreshold=1,h.blurWidth=512,h.horizontalBlur=!1,h.lensTexture=null,h.volumetricLightCoefficient=.2,h.volumetricLightPower=4,h.volumetricLightBlurScale=64,h.sourceLight=null,h.hdrMinimumLuminance=1,h.hdrDecreaseRate=.5,h.hdrIncreaseRate=.5,h.lensColorTexture=null,h.lensFlareStrength=20,h.lensFlareGhostDispersal=1.4,h.lensFlareHaloWidth=.7,h.lensFlareDistortionStrength=16,h.lensFlareBlurWidth=512,h.lensStarTexture=null,h.lensFlareDirtTexture=null,h.depthOfFieldDistance=10,h.depthOfFieldBlurWidth=64,h.animations=[],h._currentDepthOfFieldSource=null,h._fixedExposure=1,h._currentExposure=1,h._hdrAutoExposure=!1,h._hdrCurrentLuminance=1,h._motionStrength=1,h._isObjectBasedMotionBlur=!1,h._camerasToBeAttached=[],h._bloomEnabled=!1,h._depthOfFieldEnabled=!1,h._vlsEnabled=!1,h._lensFlareEnabled=!1,h._hdrEnabled=!1,h._motionBlurEnabled=!1,h._fxaaEnabled=!1,h._screenSpaceReflectionsEnabled=!1,h._motionBlurSamples=64,h._volumetricLightStepsCount=50,h._samples=1,h._cameras=g||c.cameras,h._cameras=h._cameras.slice(),h._camerasToBeAttached=h._cameras.slice(),h._scene=c,h._basePostProcess=f,h._ratio=d,h._floatTextureType=c.getEngine().getCaps().textureFloatRender?p.a.TEXTURETYPE_FLOAT:p.a.TEXTURETYPE_HALF_FLOAT,c.postProcessRenderPipelineManager.addPipeline(h),h._buildPipeline(),h}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"exposure",{get:function(){return this._fixedExposure},set:function(a){this._fixedExposure=a,this._currentExposure=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hdrAutoExposure",{get:function(){return this._hdrAutoExposure},set:function(a){if(this._hdrAutoExposure=a,this.hdrPostProcess){var c=["#define HDR"];a&&c.push("#define AUTO_EXPOSURE"),this.hdrPostProcess.updateEffect(c.join(`
`))}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"motionStrength",{get:function(){return this._motionStrength},set:function(a){this._motionStrength=a,this._isObjectBasedMotionBlur&&this.motionBlurPostProcess&&(this.motionBlurPostProcess.motionStrength=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"objectBasedMotionBlur",{get:function(){return this._isObjectBasedMotionBlur},set:function(a){var c=this._isObjectBasedMotionBlur!==a;this._isObjectBasedMotionBlur=a,c&&this._buildPipeline()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(a){this._bloomEnabled!==a&&(this._bloomEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(a){this._depthOfFieldEnabled!==a&&(this._depthOfFieldEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(a){this._lensFlareEnabled!==a&&(this._lensFlareEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(a){this._hdrEnabled!==a&&(this._hdrEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(a){if(this._vlsEnabled!==a){if(a){if(!this._scene.enableGeometryBufferRenderer())return void k.a.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline")}this._vlsEnabled=a,this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(a){this._motionBlurEnabled!==a&&(this._motionBlurEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(a){this._fxaaEnabled!==a&&(this._fxaaEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"screenSpaceReflectionsEnabled",{get:function(){return this._screenSpaceReflectionsEnabled},set:function(a){this._screenSpaceReflectionsEnabled!==a&&(this._screenSpaceReflectionsEnabled=a,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(a){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect(`#define VLS
#define NB_STEPS `+a.toFixed(1)),this._volumetricLightStepsCount=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(a){this.motionBlurPostProcess&&(this._isObjectBasedMotionBlur?this.motionBlurPostProcess.motionBlurSamples=a:this.motionBlurPostProcess.updateEffect(`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+a.toFixed(1))),this._motionBlurSamples=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples!==a&&(this._samples=a,this._buildPipeline())},enumerable:!0,configurable:!0}),b.prototype._buildPipeline=function(){var a=this,c=this._ratio,d=this._scene;this._disposePostProcesses(),null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._screenSpaceReflectionsEnabled&&(this.screenSpaceReflectionPostProcess=new gl("HDRPass",d,c,null,ya.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,this._floatTextureType),this.screenSpaceReflectionPostProcess.onApplyObservable.add(function(){a._currentDepthOfFieldSource=a.screenSpaceReflectionPostProcess}),this.addEffect(new pb(d.getEngine(),"HDRScreenSpaceReflections",function(){return a.screenSpaceReflectionPostProcess},!0))),this._basePostProcess?this.originalPostProcess=this._basePostProcess:this.originalPostProcess=new gb("HDRPass","standard",[],[],c,null,ya.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.autoClear=!this.screenSpaceReflectionPostProcess,this.originalPostProcess.onApplyObservable.add(function(){a._currentDepthOfFieldSource=a.originalPostProcess}),this.addEffect(new pb(d.getEngine(),"HDRPassPostProcess",function(){return a.originalPostProcess},!0)),this._bloomEnabled&&(this._createDownSampleX4PostProcess(d,c/4),this._createBrightPassPostProcess(d,c/4),this._createBlurPostProcesses(d,c/4,1),this._createTextureAdderPostProcess(d,c),this.textureAdderFinalPostProcess=new gb("HDRDepthOfFieldSource","standard",[],[],c,null,ya.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,"#define PASS_POST_PROCESS",p.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new pb(d.getEngine(),"HDRBaseDepthOfFieldSource",function(){return a.textureAdderFinalPostProcess},!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(d,c),this.volumetricLightFinalPostProcess=new gb("HDRVLSFinal","standard",[],[],c,null,ya.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,"#define PASS_POST_PROCESS",p.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new pb(d.getEngine(),"HDRVLSFinal",function(){return a.volumetricLightFinalPostProcess},!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(d,c),this.lensFlareFinalPostProcess=new gb("HDRPostLensFlareDepthOfFieldSource","standard",[],[],c,null,ya.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,"#define PASS_POST_PROCESS",p.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new pb(d.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return a.lensFlareFinalPostProcess},!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(d,this._floatTextureType),this._createHdrPostProcess(d,c),this.hdrFinalPostProcess=new gb("HDRPostHDReDepthOfFieldSource","standard",[],[],c,null,ya.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,"#define PASS_POST_PROCESS",p.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new pb(d.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return a.hdrFinalPostProcess},!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(d,c/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(d,c)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(d,c),this._fxaaEnabled&&(this.fxaaPostProcess=new Ff("fxaa",1,null,ya.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,p.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new pb(d.getEngine(),"HDRFxaa",function(){return a.fxaaPostProcess},!0))),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&k.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},b.prototype._createDownSampleX4PostProcess=function(a,c){var d=this,f=new Array(32);this.downSampleX4PostProcess=new gb("HDRDownSampleX4","standard",["dsOffsets"],[],c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define DOWN_SAMPLE_X4",this._floatTextureType),this.downSampleX4PostProcess.onApply=function(g){for(var h=0,j=d.downSampleX4PostProcess.width,m=d.downSampleX4PostProcess.height,w=-2;w<2;w++)for(var z=-2;z<2;z++)f[h]=(w+.5)*(1/j),f[h+1]=(z+.5)*(1/m),h+=2;g.setArray2("dsOffsets",f)},this.addEffect(new pb(a.getEngine(),"HDRDownSampleX4",function(){return d.downSampleX4PostProcess},!0))},b.prototype._createBrightPassPostProcess=function(a,c){var d=this,f=new Array(8);this.brightPassPostProcess=new gb("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define BRIGHT_PASS",this._floatTextureType),this.brightPassPostProcess.onApply=function(g){var h=1/d.brightPassPostProcess.width,j=1/d.brightPassPostProcess.height;f[0]=-.5*h,f[1]=.5*j,f[2]=.5*h,f[3]=.5*j,f[4]=-.5*h,f[5]=-.5*j,f[6]=.5*h,f[7]=-.5*j,g.setArray2("dsOffsets",f),g.setFloat("brightThreshold",d.brightThreshold)},this.addEffect(new pb(a.getEngine(),"HDRBrightPass",function(){return d.brightPassPostProcess},!0))},b.prototype._createBlurPostProcesses=function(a,c,d,f){var g=this;void 0===f&&(f="blurWidth");var h=a.getEngine(),j=new Xb("HDRBlurH_"+d,new i.d(1,0),this[f],c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,this._floatTextureType),m=new Xb("HDRBlurV_"+d,new i.d(0,1),this[f],c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,this._floatTextureType);j.onActivateObservable.add(function(){var w=j.width/h.getRenderWidth();j.kernel=g[f]*w}),m.onActivateObservable.add(function(){var w=m.height/h.getRenderHeight();m.kernel=g.horizontalBlur?64*w:g[f]*w}),this.addEffect(new pb(a.getEngine(),"HDRBlurH"+d,function(){return j},!0)),this.addEffect(new pb(a.getEngine(),"HDRBlurV"+d,function(){return m},!0)),this.blurHPostProcesses.push(j),this.blurVPostProcesses.push(m)},b.prototype._createTextureAdderPostProcess=function(a,c){var d=this;this.textureAdderPostProcess=new gb("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define TEXTURE_ADDER",this._floatTextureType),this.textureAdderPostProcess.onApply=function(f){f.setTextureFromPostProcess("otherSampler",d._vlsEnabled?d._currentDepthOfFieldSource:d.originalPostProcess),f.setTexture("lensSampler",d.lensTexture),f.setFloat("exposure",d._currentExposure),d._currentDepthOfFieldSource=d.textureAdderFinalPostProcess},this.addEffect(new pb(a.getEngine(),"HDRTextureAdder",function(){return d.textureAdderPostProcess},!0))},b.prototype._createVolumetricLightPostProcess=function(a,c){var d=this,f=a.enableGeometryBufferRenderer();f.enablePosition=!0;var g=f.getGBuffer();this.volumetricLightPostProcess=new gb("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],c/8,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,`#define VLS
#define NB_STEPS `+this._volumetricLightStepsCount.toFixed(1));var h=i.d.Zero();this.volumetricLightPostProcess.onApply=function(j){if(d.sourceLight&&d.sourceLight.getShadowGenerator()&&d._scene.activeCamera){var m=d.sourceLight.getShadowGenerator();j.setTexture("shadowMapSampler",m.getShadowMap()),j.setTexture("positionSampler",g.textures[2]),j.setColor3("sunColor",d.sourceLight.diffuse),j.setVector3("sunDirection",d.sourceLight.getShadowDirection()),j.setVector3("cameraPosition",d._scene.activeCamera.globalPosition),j.setMatrix("shadowViewProjection",m.getTransformMatrix()),j.setFloat("scatteringCoefficient",d.volumetricLightCoefficient),j.setFloat("scatteringPower",d.volumetricLightPower),h.x=d.sourceLight.getDepthMinZ(d._scene.activeCamera),h.y=d.sourceLight.getDepthMaxZ(d._scene.activeCamera),j.setVector2("depthValues",h)}},this.addEffect(new pb(a.getEngine(),"HDRVLS",function(){return d.volumetricLightPostProcess},!0)),this._createBlurPostProcesses(a,c/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new gb("HDRVLSMerge","standard",[],["originalSampler"],c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(j){j.setTextureFromPostProcess("originalSampler",d._bloomEnabled?d.textureAdderFinalPostProcess:d.originalPostProcess),d._currentDepthOfFieldSource=d.volumetricLightFinalPostProcess},this.addEffect(new pb(a.getEngine(),"HDRVLSMerge",function(){return d.volumetricLightMergePostProces},!0))},b.prototype._createLuminancePostProcesses=function(a,c){var d=this,f=Math.pow(3,b.LuminanceSteps);this.luminancePostProcess=new gb("HDRLuminance","standard",["lumOffsets"],[],{width:f,height:f},null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define LUMINANCE",c);var g=[];this.luminancePostProcess.onApply=function(z){var C=1/d.luminancePostProcess.width,J=1/d.luminancePostProcess.height;g[0]=-.5*C,g[1]=.5*J,g[2]=.5*C,g[3]=.5*J,g[4]=-.5*C,g[5]=-.5*J,g[6]=.5*C,g[7]=-.5*J,z.setArray2("lumOffsets",g)},this.addEffect(new pb(a.getEngine(),"HDRLuminance",function(){return d.luminancePostProcess},!0));for(var h=b.LuminanceSteps-1;h>=0;h--){f=Math.pow(3,h);var j=`#define LUMINANCE_DOWN_SAMPLE
`;0===h&&(j+="#define FINAL_DOWN_SAMPLER");var m=new gb("HDRLuminanceDownSample"+h,"standard",["dsOffsets","halfDestPixelSize"],[],{width:f,height:f},null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,j,c);this.luminanceDownSamplePostProcesses.push(m)}var w=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(z,C){var J=new Array(18);z.onApply=function(K){if(w){for(var N=0,T=-1;T<2;T++)for(var Z=-1;Z<2;Z++)J[N]=T/w.width,J[N+1]=Z/w.height,N+=2;K.setArray2("dsOffsets",J),K.setFloat("halfDestPixelSize",.5/w.width),w=C===d.luminanceDownSamplePostProcesses.length-1?d.luminancePostProcess:z}},C===d.luminanceDownSamplePostProcesses.length-1&&(z.onAfterRender=function(){var K=a.getEngine().readPixels(0,0,1,1),N=new i.f(1/16581375,1/65025,1/255,1);d._hdrCurrentLuminance=(K[0]*N.x+K[1]*N.y+K[2]*N.z+K[3]*N.w)/100}),d.addEffect(new pb(a.getEngine(),"HDRLuminanceDownSample"+C,function(){return z},!0))})},b.prototype._createHdrPostProcess=function(a,c){var d=this,f=["#define HDR"];this._hdrAutoExposure&&f.push("#define AUTO_EXPOSURE"),this.hdrPostProcess=new gb("HDR","standard",["averageLuminance"],["textureAdderSampler"],c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,f.join(`
`),p.a.TEXTURETYPE_UNSIGNED_INT);var g=1,h=0,j=0;this.hdrPostProcess.onApply=function(m){if(m.setTextureFromPostProcess("textureAdderSampler",d._currentDepthOfFieldSource),h+=a.getEngine().getDeltaTime(),g<0)g=d._hdrCurrentLuminance;else{var w=(j-h)/1000;d._hdrCurrentLuminance<g+d.hdrDecreaseRate*w?g+=d.hdrDecreaseRate*w:d._hdrCurrentLuminance>g-d.hdrIncreaseRate*w?g-=d.hdrIncreaseRate*w:g=d._hdrCurrentLuminance}d.hdrAutoExposure?d._currentExposure=d._fixedExposure/g:(g=aa.a.Clamp(g,d.hdrMinimumLuminance,1e20),m.setFloat("averageLuminance",g)),j=h,d._currentDepthOfFieldSource=d.hdrFinalPostProcess},this.addEffect(new pb(a.getEngine(),"HDR",function(){return d.hdrPostProcess},!0))},b.prototype._createLensFlarePostProcess=function(a,c){var d=this;this.lensFlarePostProcess=new gb("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],c/2,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define LENS_FLARE",p.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new pb(a.getEngine(),"HDRLensFlare",function(){return d.lensFlarePostProcess},!0)),this._createBlurPostProcesses(a,c/4,2,"lensFlareBlurWidth"),this.lensFlareComposePostProcess=new gb("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define LENS_FLARE_COMPOSE",p.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new pb(a.getEngine(),"HDRLensFlareCompose",function(){return d.lensFlareComposePostProcess},!0));var f=new i.d(0,0);this.lensFlarePostProcess.onApply=function(j){j.setTextureFromPostProcess("textureSampler",d._bloomEnabled?d.blurHPostProcesses[0]:d.originalPostProcess),j.setTexture("lensColorSampler",d.lensColorTexture),j.setFloat("strength",d.lensFlareStrength),j.setFloat("ghostDispersal",d.lensFlareGhostDispersal),j.setFloat("haloWidth",d.lensFlareHaloWidth),f.x=d.lensFlarePostProcess.width,f.y=d.lensFlarePostProcess.height,j.setVector2("resolution",f),j.setFloat("distortionStrength",d.lensFlareDistortionStrength)};var g=i.a.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),h=i.a.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(j){if(d._scene.activeCamera){j.setTextureFromPostProcess("otherSampler",d.lensFlarePostProcess),j.setTexture("lensDirtSampler",d.lensFlareDirtTexture),j.setTexture("lensStarSampler",d.lensStarTexture);var m=d._scene.activeCamera.getViewMatrix().getRow(0),w=d._scene.activeCamera.getViewMatrix().getRow(2),z=i.e.Dot(m.toVector3(),new i.e(1,0,0))+i.e.Dot(w.toVector3(),new i.e(0,0,1));z*=4;var C=i.a.FromValues(.5*Math.cos(z),-Math.sin(z),0,0,Math.sin(z),.5*Math.cos(z),0,0,0,0,1,0,0,0,0,1),J=h.multiply(C).multiply(g);j.setMatrix("lensStarMatrix",J),d._currentDepthOfFieldSource=d.lensFlareFinalPostProcess}}},b.prototype._createDepthOfFieldPostProcess=function(a,c){var d=this;this.depthOfFieldPostProcess=new gb("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define DEPTH_OF_FIELD",p.a.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(f){f.setTextureFromPostProcess("otherSampler",d._currentDepthOfFieldSource),f.setTexture("depthSampler",d._getDepthTexture()),f.setFloat("distance",d.depthOfFieldDistance)},this.addEffect(new pb(a.getEngine(),"HDRDepthOfField",function(){return d.depthOfFieldPostProcess},!0))},b.prototype._createMotionBlurPostProcess=function(a,c){var d=this;if(this._isObjectBasedMotionBlur){var f=new al("HDRMotionBlur",a,c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,p.a.TEXTURETYPE_UNSIGNED_INT);f.motionStrength=this.motionStrength,f.motionBlurSamples=this.motionBlurSamples,this.motionBlurPostProcess=f}else{this.motionBlurPostProcess=new gb("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],c,null,ya.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+this.motionBlurSamples.toFixed(1),p.a.TEXTURETYPE_UNSIGNED_INT);var g=0,h=i.a.Identity(),j=i.a.Identity(),m=i.a.Identity(),w=i.d.Zero();this.motionBlurPostProcess.onApply=function(z){(m=a.getProjectionMatrix().multiply(a.getViewMatrix())).invertToRef(j),z.setMatrix("inverseViewProjection",j),z.setMatrix("prevViewProjection",h),h=m,w.x=d.motionBlurPostProcess.width,w.y=d.motionBlurPostProcess.height,z.setVector2("screenSize",w),g=a.getEngine().getFps()/60,z.setFloat("motionScale",g),z.setFloat("motionStrength",d.motionStrength),z.setTexture("depthSampler",d._getDepthTexture())}}this.addEffect(new pb(a.getEngine(),"HDRMotionBlur",function(){return d.motionBlurPostProcess},!0))},b.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()},b.prototype._disposePostProcesses=function(){for(var a=0;a<this._cameras.length;a++){var c=this._cameras[a];this.originalPostProcess&&this.originalPostProcess.dispose(c),this.screenSpaceReflectionPostProcess&&this.screenSpaceReflectionPostProcess.dispose(c),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(c),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(c),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(c),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(c),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(c),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(c),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(c),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(c),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(c),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(c);for(var d=0;d<this.luminanceDownSamplePostProcesses.length;d++)this.luminanceDownSamplePostProcesses[d].dispose(c);for(this.luminancePostProcess&&this.luminancePostProcess.dispose(c),this.hdrPostProcess&&this.hdrPostProcess.dispose(c),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(c),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(c),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(c),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(c),d=0;d<this.blurHPostProcesses.length;d++)this.blurHPostProcesses[d].dispose(c);for(d=0;d<this.blurVPostProcesses.length;d++)this.blurVPostProcesses[d].dispose(c)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.screenSpaceReflectionPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},b.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),e.prototype.dispose.call(this)},b.prototype.serialize=function(){var a=F.a.Serialize(this);return this.sourceLight&&(a.sourceLightId=this.sourceLight.id),this.screenSpaceReflectionPostProcess&&(a.screenSpaceReflectionPostProcess=F.a.Serialize(this.screenSpaceReflectionPostProcess)),a.customType="StandardRenderingPipeline",a},b.Parse=function(a,c,d){var f=F.a.Parse(function(){return new b(a._name,c,a._ratio)},a,c,d);return a.sourceLightId&&(f.sourceLight=c.getLightByID(a.sourceLightId)),a.screenSpaceReflectionPostProcess&&F.a.Parse(function(){return f.screenSpaceReflectionPostProcess},a.screenSpaceReflectionPostProcess,c,d),f},b.LuminanceSteps=6,Object(l.c)([Object(F.c)()],b.prototype,"brightThreshold",void 0),Object(l.c)([Object(F.c)()],b.prototype,"blurWidth",void 0),Object(l.c)([Object(F.c)()],b.prototype,"horizontalBlur",void 0),Object(l.c)([Object(F.c)()],b.prototype,"exposure",null),Object(l.c)([Object(F.m)("lensTexture")],b.prototype,"lensTexture",void 0),Object(l.c)([Object(F.c)()],b.prototype,"volumetricLightCoefficient",void 0),Object(l.c)([Object(F.c)()],b.prototype,"volumetricLightPower",void 0),Object(l.c)([Object(F.c)()],b.prototype,"volumetricLightBlurScale",void 0),Object(l.c)([Object(F.c)()],b.prototype,"hdrMinimumLuminance",void 0),Object(l.c)([Object(F.c)()],b.prototype,"hdrDecreaseRate",void 0),Object(l.c)([Object(F.c)()],b.prototype,"hdrIncreaseRate",void 0),Object(l.c)([Object(F.c)()],b.prototype,"hdrAutoExposure",null),Object(l.c)([Object(F.m)("lensColorTexture")],b.prototype,"lensColorTexture",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lensFlareStrength",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lensFlareGhostDispersal",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lensFlareHaloWidth",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lensFlareDistortionStrength",void 0),Object(l.c)([Object(F.c)()],b.prototype,"lensFlareBlurWidth",void 0),Object(l.c)([Object(F.m)("lensStarTexture")],b.prototype,"lensStarTexture",void 0),Object(l.c)([Object(F.m)("lensFlareDirtTexture")],b.prototype,"lensFlareDirtTexture",void 0),Object(l.c)([Object(F.c)()],b.prototype,"depthOfFieldDistance",void 0),Object(l.c)([Object(F.c)()],b.prototype,"depthOfFieldBlurWidth",void 0),Object(l.c)([Object(F.c)()],b.prototype,"motionStrength",null),Object(l.c)([Object(F.c)()],b.prototype,"objectBasedMotionBlur",null),Object(l.c)([Object(F.c)()],b.prototype,"_ratio",void 0),Object(l.c)([Object(F.c)()],b.prototype,"BloomEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"DepthOfFieldEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"LensFlareEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"HDREnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"VLSEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"MotionBlurEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"fxaaEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"screenSpaceReflectionsEnabled",null),Object(l.c)([Object(F.c)()],b.prototype,"volumetricLightStepsCount",null),Object(l.c)([Object(F.c)()],b.prototype,"motionBlurSamples",null),Object(l.c)([Object(F.c)()],b.prototype,"samples",null),b}(de);D.a.RegisteredTypes["BABYLON.StandardRenderingPipeline"]=hl;var ap=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform float _ExposureAdjustment;
#if defined(HABLE_TONEMAPPING)
const float A=0.15;
const float B=0.50;
const float C=0.10;
const float D=0.20;
const float E=0.02;
const float F=0.30;
const float W=11.2;
#endif
float Luminance(vec3 c)
{
return dot(c,vec3(0.22,0.707,0.071));
}
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
#if defined(REINHARD_TONEMAPPING)
float lum=Luminance(colour.rgb);
float lumTm=lum*_ExposureAdjustment;
float scale=lumTm/(1.0+lumTm);
colour*=scale/lum;
#elif defined(HABLE_TONEMAPPING)
colour*=_ExposureAdjustment;
const float ExposureBias=2.0;
vec3 x=ExposureBias*colour;
vec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;
x=vec3(W,W,W);
vec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);
colour=curr*whiteScale;
#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)
colour*=_ExposureAdjustment;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
#elif defined(PHOTOGRAPHIC_TONEMAPPING)
colour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);
#endif
gl_FragColor=vec4(colour.rgb,1.0);
}`;Pa.a.ShadersStore.tonemapPixelShader=ap;var vd;!function(e){e[e.Hable=0]="Hable",e[e.Reinhard=1]="Reinhard",e[e.HejiDawson=2]="HejiDawson",e[e.Photographic=3]="Photographic"}(vd||(vd={}));var bp=function(e){function b(a,c,d,f,g,h,j){void 0===g&&(g=p.a.TEXTURE_BILINEAR_SAMPLINGMODE),void 0===j&&(j=p.a.TEXTURETYPE_UNSIGNED_INT);var m=e.call(this,a,"tonemap",["_ExposureAdjustment"],null,1,f,g,h,!0,null,j)||this;m._operator=c,m.exposureAdjustment=d;var w="#define ";return m._operator===vd.Hable?w+="HABLE_TONEMAPPING":m._operator===vd.Reinhard?w+="REINHARD_TONEMAPPING":m._operator===vd.HejiDawson?w+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":m._operator===vd.Photographic&&(w+="PHOTOGRAPHIC_TONEMAPPING"),m.updateEffect(w),m.onApply=function(z){z.setFloat("_ExposureAdjustment",m.exposureAdjustment)},m}return Object(l.d)(b,e),b}(gb),cp=`uniform sampler2D textureSampler;
uniform sampler2D lightScatteringSampler;
uniform float decay;
uniform float exposure;
uniform float weight;
uniform float density;
uniform vec2 meshPositionOnScreen;
varying vec2 vUV;
void main(void) {
vec2 tc=vUV;
vec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);
deltaTexCoord*=1.0/float(NUM_SAMPLES)*density;
float illuminationDecay=1.0;
vec4 color=texture2D(lightScatteringSampler,tc)*0.4;
for(int i=0; i<NUM_SAMPLES; i++) {
tc-=deltaTexCoord;
vec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;
dataSample*=illuminationDecay*weight;
color+=dataSample;
illuminationDecay*=decay;
}
vec4 realColor=texture2D(textureSampler,vUV);
gl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));
}
`;Pa.a.ShadersStore.volumetricLightScatteringPixelShader=cp;var dp=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
void main(void)
{
vec3 positionUpdated=position;
#if (defined(ALPHATEST) || defined(NEED_UV)) && defined(UV1)
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}
`;Pa.a.ShadersStore.volumetricLightScatteringPassVertexShader=dp;var ep=`#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
#endif
#if defined(ALPHATEST)
uniform sampler2D diffuseSampler;
#endif
void main(void)
{
#if defined(ALPHATEST)
vec4 diffuseColor=texture2D(diffuseSampler,vUV);
if (diffuseColor.a<0.4)
discard;
#endif
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
}
`;Pa.a.ShadersStore.volumetricLightScatteringPassPixelShader=ep;var fp=function(e){function b(a,c,d,f,g,h,j,m,w){void 0===g&&(g=100),void 0===h&&(h=ya.a.BILINEAR_SAMPLINGMODE);var z=e.call(this,a,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],c.postProcessRatio||c,d,h,j,m,"#define NUM_SAMPLES "+g)||this;return z._screenCoordinates=i.d.Zero(),z.customMeshPosition=i.e.Zero(),z.useCustomMeshPosition=!1,z.invert=!0,z.excludedMeshes=new Array(),z.exposure=.3,z.decay=.96815,z.weight=.58767,z.density=.926,j=(w=null===d?w:d.getScene()).getEngine(),z._viewPort=new Jc.a(0,0,1,1).toGlobal(j.getRenderWidth(),j.getRenderHeight()),z.mesh=null!==f?f:b.CreateDefaultMesh("VolumetricLightScatteringMesh",w),z._createPass(w,c.passRatio||c),z.onActivate=function(C){z.isSupported||z.dispose(C),z.onActivate=null},z.onApplyObservable.add(function(C){z._updateMeshScreenCoordinates(w),C.setTexture("lightScatteringSampler",z._volumetricLightScatteringRTT),C.setFloat("exposure",z.exposure),C.setFloat("decay",z.decay),C.setFloat("weight",z.weight),C.setFloat("density",z.density),C.setVector2("meshPositionOnScreen",z._screenCoordinates)}),z}return Object(l.d)(b,e),Object.defineProperty(b.prototype,"useDiffuseColor",{get:function(){return k.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(a){k.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},b.prototype._isReady=function(a,c){var d=a.getMesh();if(d===this.mesh&&d.material)return d.material.isReady(d);var f=[],g=[ra.b.PositionKind],h=a.getMaterial();h&&(h.needAlphaTesting()&&f.push("#define ALPHATEST"),d.isVerticesDataPresent(ra.b.UVKind)&&(g.push(ra.b.UVKind),f.push("#define UV1")),d.isVerticesDataPresent(ra.b.UV2Kind)&&(g.push(ra.b.UV2Kind),f.push("#define UV2"))),d.useBones&&d.computeBonesUsingShaders?(g.push(ra.b.MatricesIndicesKind),g.push(ra.b.MatricesWeightsKind),f.push("#define NUM_BONE_INFLUENCERS "+d.numBoneInfluencers),f.push("#define BonesPerMesh "+(d.skeleton?d.skeleton.bones.length+1:0))):f.push("#define NUM_BONE_INFLUENCERS 0"),c&&(f.push("#define INSTANCES"),Ua.a.PushAttributesForInstances(g));var j=f.join(`
`);return this._cachedDefines!==j&&(this._cachedDefines=j,this._volumetricLightScatteringPass=d.getScene().getEngine().createEffect("volumetricLightScatteringPass",g,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],j,void 0,void 0,void 0,{maxSimultaneousMorphTargets:d.numBoneInfluencers})),this._volumetricLightScatteringPass.isReady()},b.prototype.setCustomMeshPosition=function(a){this.customMeshPosition=a},b.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},b.prototype.dispose=function(a){var c=a.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==c&&a.getScene().customRenderTargets.splice(c,1),this._volumetricLightScatteringRTT.dispose(),e.prototype.dispose.call(this,a)},b.prototype.getPass=function(){return this._volumetricLightScatteringRTT},b.prototype._meshExcluded=function(a){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(a)},b.prototype._createPass=function(a,c){var d=this,f=a.getEngine();this._volumetricLightScatteringRTT=new Jb("volumetricLightScatteringMap",{width:f.getRenderWidth()*c,height:f.getRenderHeight()*c},a,!1,!0,p.a.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=ya.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=ya.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var g=this.getCamera();g?g.customRenderTargets.push(this._volumetricLightScatteringRTT):a.customRenderTargets.push(this._volumetricLightScatteringRTT);var h,j=function(w){var z=w.getRenderingMesh();if(!d._meshExcluded(z)){z._internalAbstractMeshDataInfo._isActiveIntermediate=!1;var C=w.getMaterial();if(C){var J=z.getScene(),K=J.getEngine();K.setState(C.backFaceCulling);var N=z._getInstancesRenderList(w._id);if(!N.mustReturn){var T=K.getCaps().instancedArrays&&null!==N.visibleInstances[w._id];if(d._isReady(w,T)){var Z=d._volumetricLightScatteringPass;if(z===d.mesh&&(Z=w.effect?w.effect:C.getEffect()),K.enableEffect(Z),z._bind(w,Z,C.fillMode),z===d.mesh)C.bind(z.getWorldMatrix(),z);else{if(d._volumetricLightScatteringPass.setMatrix("viewProjection",J.getTransformMatrix()),C&&C.needAlphaTesting()){var _=C.getAlphaTestTexture();d._volumetricLightScatteringPass.setTexture("diffuseSampler",_),_&&d._volumetricLightScatteringPass.setMatrix("diffuseMatrix",_.getTextureMatrix())}z.useBones&&z.computeBonesUsingShaders&&z.skeleton&&d._volumetricLightScatteringPass.setMatrices("mBones",z.skeleton.getTransformMatrices(z))}z._processRendering(w,d._volumetricLightScatteringPass,Hb.a.TriangleFillMode,N,T,function(ca,ea){return Z.setMatrix("world",ea)})}}}}},m=new G.b(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){h=a.clearColor,a.clearColor=m}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){a.clearColor=h}),this._volumetricLightScatteringRTT.customRenderFunction=function(w,z,C,J){var K,N=a.getEngine();if(J.length){for(N.setColorWrite(!1),K=0;K<J.length;K++)j(J.data[K]);N.setColorWrite(!0)}for(K=0;K<w.length;K++)j(w.data[K]);for(K=0;K<z.length;K++)j(z.data[K]);if(C.length){for(K=0;K<C.length;K++){var T=C.data[K],Z=T.getBoundingInfo();Z&&a.activeCamera&&(T._alphaIndex=T.getMesh().alphaIndex,T._distanceToCamera=Z.boundingSphere.centerWorld.subtract(a.activeCamera.position).length())}var _=C.data.slice(0,C.length);for(_.sort(function(ca,ea){return ca._alphaIndex>ea._alphaIndex?1:ca._alphaIndex<ea._alphaIndex?-1:ca._distanceToCamera<ea._distanceToCamera?1:ca._distanceToCamera>ea._distanceToCamera?-1:0}),N.setAlphaMode(p.a.ALPHA_COMBINE),K=0;K<_.length;K++)j(_[K]);N.setAlphaMode(p.a.ALPHA_DISABLE)}}},b.prototype._updateMeshScreenCoordinates=function(a){var c,d=a.getTransformMatrix();c=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var f=i.e.Project(c,i.a.Identity(),d,this._viewPort);this._screenCoordinates.x=f.x/this._viewPort.width,this._screenCoordinates.y=f.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},b.CreateDefaultMesh=function(a,c){var d=xa.a.CreatePlane(a,1,c);d.billboardMode=qb.a.BILLBOARDMODE_ALL;var f=new Ab.a(a+"Material",c);return f.emissiveColor=new G.a(1,1,1),d.material=f,d},Object(l.c)([Object(F.o)()],b.prototype,"customMeshPosition",void 0),Object(l.c)([Object(F.c)()],b.prototype,"useCustomMeshPosition",void 0),Object(l.c)([Object(F.c)()],b.prototype,"invert",void 0),Object(l.c)([Object(F.k)()],b.prototype,"mesh",void 0),Object(l.c)([Object(F.c)()],b.prototype,"excludedMeshes",void 0),Object(l.c)([Object(F.c)()],b.prototype,"exposure",void 0),Object(l.c)([Object(F.c)()],b.prototype,"decay",void 0),Object(l.c)([Object(F.c)()],b.prototype,"weight",void 0),Object(l.c)([Object(F.c)()],b.prototype,"density",void 0),b}(gb);o(148),o(149),Object.defineProperty(wa.a.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(e){this._forceShowBoundingBoxes=e,e&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),wa.a.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new il(this)),this._boundingBoxRenderer},Object.defineProperty(qb.a.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(e){this._showBoundingBox=e,e&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var il=function(){function e(b){this.name=_a.a.NAME_BOUNDINGBOXRENDERER,this.frontColor=new G.a(1,1,1),this.backColor=new G.a(.1,.1,.1),this.showBackLines=!0,this.renderList=new Ic.a(32),this._vertexBuffers={},this._fillIndexBuffer=null,this._fillIndexData=null,this.scene=b,b._addComponent(this)}return e.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(_a.a.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._activeMeshStage.registerStep(_a.a.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER,this,this._activeMesh),this.scene._evaluateSubMeshStage.registerStep(_a.a.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(_a.a.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)},e.prototype._evaluateSubMesh=function(b,a){if(b.showSubMeshesBoundingBox){var c=a.getBoundingInfo();null!=c&&(c.boundingBox._tag=b.renderingGroupId,this.renderList.push(c.boundingBox))}},e.prototype._activeMesh=function(b,a){if(b.showBoundingBox||this.scene.forceShowBoundingBoxes){var c=b.getBoundingInfo();c.boundingBox._tag=a.renderingGroupId,this.renderList.push(c.boundingBox)}},e.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new vf.a("colorShader",this.scene,"color",{attributes:[ra.b.PositionKind],uniforms:["world","viewProjection","color"]}),this._colorShader.reservedDataStore={hidden:!0};var b=this.scene.getEngine(),a=Xa.a.CreateBox({size:1});this._vertexBuffers[ra.b.PositionKind]=new ra.b(b,a.positions,ra.b.PositionKind,!1),this._createIndexBuffer(),this._fillIndexData=a.indices}},e.prototype._createIndexBuffer=function(){var b=this.scene.getEngine();this._indexBuffer=b.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},e.prototype.rebuild=function(){var b=this._vertexBuffers[ra.b.PositionKind];b&&b._rebuild(),this._createIndexBuffer()},e.prototype.reset=function(){this.renderList.reset()},e.prototype.render=function(b){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var a=this.scene.getEngine();a.setDepthWrite(!1),this._colorShader._preBind();for(var c=0;c<this.renderList.length;c++){var d=this.renderList.data[c];if(d._tag===b){var f=d.minimum,g=d.maximum.subtract(f),h=f.add(g.scale(.5)),j=i.a.Scaling(g.x,g.y,g.z).multiply(i.a.Translation(h.x,h.y,h.z)).multiply(d.getWorldMatrix());a.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(a.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(j),a.drawElementsType(Hb.a.LineListDrawMode,0,24)),a.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(j),a.drawElementsType(Hb.a.LineListDrawMode,0,24)}}this._colorShader.unbind(),a.setDepthFunctionToLessOrEqual(),a.setDepthWrite(!0)}},e.prototype.renderOcclusionBoundingBox=function(b){if(this._prepareRessources(),this._colorShader.isReady()&&b._boundingInfo){var a=this.scene.getEngine();this._fillIndexBuffer||(this._fillIndexBuffer=a.createIndexBuffer(this._fillIndexData)),a.setDepthWrite(!1),a.setColorWrite(!1),this._colorShader._preBind();var c=b._boundingInfo.boundingBox,d=c.minimum,f=c.maximum.subtract(d),g=d.add(f.scale(.5)),h=i.a.Scaling(f.x,f.y,f.z).multiply(i.a.Translation(g.x,g.y,g.z)).multiply(c.getWorldMatrix());a.bindBuffers(this._vertexBuffers,this._fillIndexBuffer,this._colorShader.getEffect()),a.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.bind(h),a.drawElementsType(Hb.a.TriangleFillMode,0,36),this._colorShader.unbind(),a.setDepthFunctionToLessOrEqual(),a.setDepthWrite(!0),a.setColorWrite(!0)}},e.prototype.dispose=function(){if(this._colorShader){this.renderList.dispose(),this._colorShader.dispose();var b=this._vertexBuffers[ra.b.PositionKind];b&&(b.dispose(),this._vertexBuffers[ra.b.PositionKind]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer),this._fillIndexBuffer&&(this.scene.getEngine()._releaseBuffer(this._fillIndexBuffer),this._fillIndexBuffer=null)}},e}();wa.a.prototype.enableDepthRenderer=function(e,b){if(void 0===b&&(b=!1),!(e=e||this.activeCamera))throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[e.id]){var a=0;a=this.getEngine().getCaps().textureHalfFloatRender?p.a.TEXTURETYPE_HALF_FLOAT:this.getEngine().getCaps().textureFloatRender?p.a.TEXTURETYPE_FLOAT:p.a.TEXTURETYPE_UNSIGNED_BYTE,this._depthRenderer[e.id]=new sf(this,a,e,b)}return this._depthRenderer[e.id]},wa.a.prototype.disableDepthRenderer=function(e){(e=e||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[e.id]&&(this._depthRenderer[e.id].dispose(),delete this._depthRenderer[e.id])};var jl=function(){function e(b){this.name=_a.a.NAME_DEPTHRENDERER,this.scene=b}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(_a.a.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(_a.a.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){for(var b in this.scene._depthRenderer)this.scene._depthRenderer[b].dispose()},e.prototype._gatherRenderTargets=function(b){if(this.scene._depthRenderer)for(var a in this.scene._depthRenderer){var c=this.scene._depthRenderer[a];c.enabled&&!c.useOnlyInActiveCamera&&b.push(c.getDepthMap())}},e.prototype._gatherActiveCameraRenderTargets=function(b){if(this.scene._depthRenderer)for(var a in this.scene._depthRenderer){var c=this.scene._depthRenderer[a];c.enabled&&c.useOnlyInActiveCamera&&this.scene.activeCamera.id===a&&b.push(c.getDepthMap())}},e}();sf._SceneComponentInitialization=function(e){var b=e._getComponent(_a.a.NAME_DEPTHRENDERER);b||(b=new jl(e),e._addComponent(b))};var gp=`uniform vec4 color;
void main(void) {
gl_FragColor=color;
}`;Pa.a.ShadersStore.linePixelShader=gp;var hp=`
attribute vec3 position;
attribute vec4 normal;

uniform mat4 worldViewProjection;
uniform float width;
uniform float aspectRatio;
void main(void) {
vec4 viewPosition=worldViewProjection*vec4(position,1.0);
vec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);
vec2 currentScreen=viewPosition.xy/viewPosition.w;
vec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;
currentScreen.x*=aspectRatio;
nextScreen.x*=aspectRatio;
vec2 dir=normalize(nextScreen-currentScreen);
vec2 normalDir=vec2(-dir.y,dir.x);
normalDir*=width/2.0;
normalDir.x/=aspectRatio;
vec4 offset=vec4(normalDir*normal.w,0.0,0.0);
gl_Position=viewPosition+offset;
}`;Pa.a.ShadersStore.lineVertexShader=hp,qb.a.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},qb.a.prototype.enableEdgesRendering=function(e,b){return void 0===e&&(e=.95),void 0===b&&(b=!1),this.disableEdgesRendering(),this._edgesRenderer=new th(this,e,b),this},Object.defineProperty(qb.a.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),Ie.b.prototype.enableEdgesRendering=function(e,b){return void 0===e&&(e=.95),void 0===b&&(b=!1),this.disableEdgesRendering(),this._edgesRenderer=new kl(this,e,b),this},Ie.a.prototype.enableEdgesRendering=function(e,b){return void 0===e&&(e=.95),void 0===b&&(b=!1),Ie.b.prototype.enableEdgesRendering.apply(this,arguments),this};var ip=function(){this.edges=new Array(),this.edgesConnectedCount=0},th=function(){function e(b,a,c,d){var f=this;void 0===a&&(a=.95),void 0===c&&(c=!1),void 0===d&&(d=!0),this.edgesWidthScalerForOrthographic=1000,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array(),this._linesNormals=new Array(),this._linesIndices=new Array(),this._buffers={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this._source=b,this._checkVerticesInsteadOfIndices=c,this._epsilon=a,this._prepareRessources(),d&&this._generateEdgesLines(),this._meshRebuildObserver=this._source.onRebuildObservable.add(function(){f._rebuild()}),this._meshDisposeObserver=this._source.onDisposeObservable.add(function(){f.dispose()})}return e.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new vf.a("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},e.prototype._rebuild=function(){var b=this._buffers[ra.b.PositionKind];b&&b._rebuild(),(b=this._buffers[ra.b.NormalKind])&&b._rebuild();var a=this._source.getScene().getEngine();this._ib=a.createIndexBuffer(this._linesIndices)},e.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);var b=this._buffers[ra.b.PositionKind];b&&(b.dispose(),this._buffers[ra.b.PositionKind]=null),(b=this._buffers[ra.b.NormalKind])&&(b.dispose(),this._buffers[ra.b.NormalKind]=null),this._ib&&this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},e.prototype._processEdgeForAdjacencies=function(b,a,c,d,f){return b===c&&a===d||b===d&&a===c?0:b===d&&a===f||b===f&&a===d?1:b===f&&a===c||b===c&&a===f?2:-1},e.prototype._processEdgeForAdjacenciesWithVertices=function(b,a,c,d,f){return b.equalsWithEpsilon(c)&&a.equalsWithEpsilon(d)||b.equalsWithEpsilon(d)&&a.equalsWithEpsilon(c)?0:b.equalsWithEpsilon(d)&&a.equalsWithEpsilon(f)||b.equalsWithEpsilon(f)&&a.equalsWithEpsilon(d)?1:b.equalsWithEpsilon(f)&&a.equalsWithEpsilon(c)||b.equalsWithEpsilon(c)&&a.equalsWithEpsilon(f)?2:-1},e.prototype._checkEdge=function(b,a,c,d,f){var g;void 0===a?g=!0:g=i.e.Dot(c[b],c[a])<this._epsilon,g&&this.createLine(d,f,this._linesPositions.length/3)},e.prototype.createLine=function(b,a,c){this._linesPositions.push(b.x,b.y,b.z,b.x,b.y,b.z,a.x,a.y,a.z,a.x,a.y,a.z),this._linesNormals.push(a.x,a.y,a.z,-1,a.x,a.y,a.z,1,b.x,b.y,b.z,-1,b.x,b.y,b.z,1),this._linesIndices.push(c,c+1,c+2,c,c+2,c+3)},e.prototype._generateEdgesLines=function(){var b=this._source.getVerticesData(ra.b.PositionKind),a=this._source.getIndices();if(a&&b){var c,d,f=new Array(),g=new Array();for(c=0;c<a.length;c+=3){d=new ip();var h=a[c],j=a[c+1],m=a[c+2];d.p0=new i.e(b[3*h],b[3*h+1],b[3*h+2]),d.p1=new i.e(b[3*j],b[3*j+1],b[3*j+2]),d.p2=new i.e(b[3*m],b[3*m+1],b[3*m+2]);var w=i.e.Cross(d.p1.subtract(d.p0),d.p2.subtract(d.p1));w.normalize(),g.push(w),f.push(d)}for(c=0;c<f.length;c++){d=f[c];for(var z=c+1;z<f.length;z++){var C=f[z];if(3===d.edgesConnectedCount)break;if(3!==C.edgesConnectedCount)for(var J=a[3*z],K=a[3*z+1],N=a[3*z+2],T=0;T<3;T++){var Z=0;if(void 0===d.edges[T]){switch(T){case 0:Z=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p0,d.p1,C.p0,C.p1,C.p2):this._processEdgeForAdjacencies(a[3*c],a[3*c+1],J,K,N);break;case 1:Z=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p1,d.p2,C.p0,C.p1,C.p2):this._processEdgeForAdjacencies(a[3*c+1],a[3*c+2],J,K,N);break;case 2:Z=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p2,d.p0,C.p0,C.p1,C.p2):this._processEdgeForAdjacencies(a[3*c+2],a[3*c],J,K,N)}if(-1!==Z&&(d.edges[T]=z,C.edges[Z]=c,d.edgesConnectedCount++,C.edgesConnectedCount++,3===d.edgesConnectedCount))break}}}}for(c=0;c<f.length;c++){var _=f[c];this._checkEdge(c,_.edges[0],g,_.p0,_.p1),this._checkEdge(c,_.edges[1],g,_.p1,_.p2),this._checkEdge(c,_.edges[2],g,_.p2,_.p0)}var ca=this._source.getScene().getEngine();this._buffers[ra.b.PositionKind]=new ra.b(ca,this._linesPositions,ra.b.PositionKind,!1),this._buffers[ra.b.NormalKind]=new ra.b(ca,this._linesNormals,ra.b.NormalKind,!1,!1,4),this._ib=ca.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},e.prototype.isReady=function(){return this._lineShader.isReady()},e.prototype.render=function(){var b=this._source.getScene();if(this.isReady()&&b.activeCamera){var a=b.getEngine();this._lineShader._preBind(),1!==this._source.edgesColor.a?a.setAlphaMode(p.a.ALPHA_COMBINE):a.setAlphaMode(p.a.ALPHA_DISABLE),a.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),b.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),b.activeCamera.mode===hb.a.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",a.getAspectRatio(b.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),a.drawElementsType(Hb.a.TriangleFillMode,0,this._indicesCount),this._lineShader.unbind()}},e}(),kl=function(e){function b(a,c,d){void 0===c&&(c=.95),void 0===d&&(d=!1);var f=e.call(this,a,c,d,!1)||this;return f._generateEdgesLines(),f}return Object(l.d)(b,e),b.prototype._generateEdgesLines=function(){var a=this._source.getVerticesData(ra.b.PositionKind),c=this._source.getIndices();if(c&&a){for(var d=i.c.Vector3[0],f=i.c.Vector3[1],g=c.length-1,h=0,j=0;h<g;h+=2,j+=4)i.e.FromArrayToRef(a,3*c[h],d),i.e.FromArrayToRef(a,3*c[h+1],f),this.createLine(d,f,j);var m=this._source.getScene().getEngine();this._buffers[ra.b.PositionKind]=new ra.b(m,this._linesPositions,ra.b.PositionKind,!1),this._buffers[ra.b.NormalKind]=new ra.b(m,this._linesNormals,ra.b.NormalKind,!1,!1,4),this._ib=m.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},b}(th),jp=`#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
uniform vec4 color;
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#include<logDepthDeclaration>
void main(void) {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#include<logDepthFragment>
gl_FragColor=color;
}`;Pa.a.ShadersStore.outlinePixelShader=jp;var kp=`
attribute vec3 position;
attribute vec3 normal;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

uniform float offset;
#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#include<logDepthDeclaration>
void main(void)
{
vec3 positionUpdated=position;
vec3 normalUpdated=normal;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
vec3 offsetPosition=positionUpdated+(normalUpdated*offset);
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<logDepthVertex>
}
`;Pa.a.ShadersStore.outlineVertexShader=kp,wa.a.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new ll(this)),this._outlineRenderer},Object.defineProperty(xa.a.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOutline=e},enumerable:!0,configurable:!0}),Object.defineProperty(xa.a.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOverlay=e},enumerable:!0,configurable:!0});var ll=function(){function e(b){this.name=_a.a.NAME_OUTLINERENDERER,this.zOffset=1,this.scene=b,this._engine=b.getEngine(),this.scene._addComponent(this)}return e.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(_a.a.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(_a.a.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype.render=function(b,a,c){var d=this;void 0===c&&(c=!1);var f=this.scene,g=f.getEngine(),h=g.getCaps().instancedArrays&&null!==a.visibleInstances[b._id]&&void 0!==a.visibleInstances[b._id];if(this.isReady(b,h)){var j=b.getRenderingMesh(),m=b.getMaterial();if(m&&f.activeCamera){if(g.enableEffect(this._effect),m.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(f.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",c?0:j.outlineWidth),this._effect.setColor4("color",c?j.overlayColor:j.outlineColor,c?j.overlayAlpha:m.alpha),this._effect.setMatrix("viewProjection",f.getTransformMatrix()),j.useBones&&j.computeBonesUsingShaders&&j.skeleton&&this._effect.setMatrices("mBones",j.skeleton.getTransformMatrices(j)),Ua.a.BindMorphTargetParameters(j,this._effect),j._bind(b,this._effect,m.fillMode),m&&m.needAlphaTesting()){var w=m.getAlphaTestTexture();w&&(this._effect.setTexture("diffuseSampler",w),this._effect.setMatrix("diffuseMatrix",w.getTextureMatrix()))}g.setZOffset(-this.zOffset),j._processRendering(b,this._effect,m.fillMode,a,h,function(z,C){d._effect.setMatrix("world",C)}),g.setZOffset(0)}}},e.prototype.isReady=function(b,a){var c=[],d=[ra.b.PositionKind,ra.b.NormalKind],f=b.getMesh(),g=b.getMaterial();g&&(g.needAlphaTesting()&&(c.push("#define ALPHATEST"),f.isVerticesDataPresent(ra.b.UVKind)&&(d.push(ra.b.UVKind),c.push("#define UV1")),f.isVerticesDataPresent(ra.b.UV2Kind)&&(d.push(ra.b.UV2Kind),c.push("#define UV2"))),g.useLogarithmicDepth&&c.push("#define LOGARITHMICDEPTH")),f.useBones&&f.computeBonesUsingShaders?(d.push(ra.b.MatricesIndicesKind),d.push(ra.b.MatricesWeightsKind),f.numBoneInfluencers>4&&(d.push(ra.b.MatricesIndicesExtraKind),d.push(ra.b.MatricesWeightsExtraKind)),c.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),c.push("#define BonesPerMesh "+(f.skeleton?f.skeleton.bones.length+1:0))):c.push("#define NUM_BONE_INFLUENCERS 0");var h=f.morphTargetManager,j=0;h&&h.numInfluencers>0&&(j=h.numInfluencers,c.push("#define MORPHTARGETS"),c.push("#define NUM_MORPH_INFLUENCERS "+j),Ua.a.PrepareAttributesForMorphTargetsInfluencers(d,f,j)),a&&(c.push("#define INSTANCES"),Ua.a.PushAttributesForInstances(d));var m=c.join(`
`);return this._cachedDefines!==m&&(this._cachedDefines=m,this._effect=this.scene.getEngine().createEffect("outline",d,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant","morphTargetInfluences"],["diffuseSampler"],m,void 0,void 0,void 0,{maxSimultaneousMorphTargets:j})),this._effect.isReady()},e.prototype._beforeRenderingMesh=function(b,a,c){if(this._savedDepthWrite=this._engine.getDepthWrite(),b.renderOutline){var d=a.getMaterial();d&&d.needAlphaBlending()&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(p.a.REPLACE),this._engine.setStencilFunction(p.a.ALWAYS),this._engine.setStencilMask(e._StencilReference),this._engine.setStencilFunctionReference(e._StencilReference),this.render(a,c,!0),this._engine.setColorWrite(!0),this._engine.setStencilFunction(p.a.NOTEQUAL)),this._engine.setDepthWrite(!1),this.render(a,c),this._engine.setDepthWrite(this._savedDepthWrite),d&&d.needAlphaBlending()&&this._engine.restoreStencilState()}},e.prototype._afterRenderingMesh=function(b,a,c){if(b.renderOverlay){var d=this._engine.getAlphaMode(),f=this._engine.alphaState.alphaBlend;this._engine.setAlphaMode(p.a.ALPHA_COMBINE),this.render(a,c,!0),this._engine.setAlphaMode(d),this._engine.setDepthWrite(this._savedDepthWrite),this._engine.alphaState.alphaBlend=f}b.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(a,c),this._engine.setColorWrite(!0))},e._StencilReference=4,e}(),lp=o(134),mp=function(){function e(b,a){this.name=b,this.color=new G.b(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.invertU=0,this.invertV=0,this.animations=new Array(),this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this.isVisible=!0,this._manager=a,this._manager.sprites.push(this),this.position=i.e.Zero()}return Object.defineProperty(e.prototype,"size",{get:function(){return this.width},set:function(b){this.width=b,this.height=b},enumerable:!0,configurable:!0}),e.prototype.playAnimation=function(b,a,c,d,f){this._fromIndex=b,this._toIndex=a,this._loopAnimation=c,this._delay=d,this._animationStarted=!0,b<a?this._direction=1:(this._direction=-1,this._toIndex=b,this._fromIndex=a),this.cellIndex=b,this._time=0,this._onAnimationEnd=f},e.prototype.stopAnimation=function(){this._animationStarted=!1},e.prototype._animate=function(b){this._animationStarted&&(this._time+=b,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()))))},e.prototype.dispose=function(){for(var b=0;b<this._manager.sprites.length;b++)this._manager.sprites[b]==this&&this._manager.sprites.splice(b,1)},e}();wa.a.prototype._internalPickSprites=function(e,b,a,c){if(!nd.a)return null;var d=null;if(!c){if(!this.activeCamera)return null;c=this.activeCamera}if(this.spriteManagers.length>0)for(var f=0;f<this.spriteManagers.length;f++){var g=this.spriteManagers[f];if(g.isPickable){var h=g.intersects(e,c,b,a);if(h&&h.hit&&(a||null==d||!(h.distance>=d.distance))&&(d=h,a))break}}return d||new nd.a()},wa.a.prototype._internalMultiPickSprites=function(e,b,a){if(!nd.a)return null;var c=new Array();if(!a){if(!this.activeCamera)return null;a=this.activeCamera}if(this.spriteManagers.length>0)for(var d=0;d<this.spriteManagers.length;d++){var f=this.spriteManagers[d];if(f.isPickable){var g=f.multiIntersects(e,a,b);null!==g&&(c=c.concat(g))}}return c},wa.a.prototype.pickSprite=function(e,b,a,c,d){return this.createPickingRayInCameraSpaceToRef(e,b,this._tempSpritePickingRay,d),this._internalPickSprites(this._tempSpritePickingRay,a,c,d)},wa.a.prototype.pickSpriteWithRay=function(e,b,a,c){if(!this._tempSpritePickingRay)return null;if(!c){if(!this.activeCamera)return null;c=this.activeCamera}return Rb.a.TransformToRef(e,c.getViewMatrix(),this._tempSpritePickingRay),this._internalPickSprites(this._tempSpritePickingRay,b,a,c)},wa.a.prototype.multiPickSprite=function(e,b,a,c){return this.createPickingRayInCameraSpaceToRef(e,b,this._tempSpritePickingRay,c),this._internalMultiPickSprites(this._tempSpritePickingRay,a,c)},wa.a.prototype.multiPickSpriteWithRay=function(e,b,a){if(!this._tempSpritePickingRay)return null;if(!a){if(!this.activeCamera)return null;a=this.activeCamera}return Rb.a.TransformToRef(e,a.getViewMatrix(),this._tempSpritePickingRay),this._internalMultiPickSprites(this._tempSpritePickingRay,b,a)},wa.a.prototype.setPointerOverSprite=function(e){this._pointerOverSprite!==e&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(p.a.ACTION_OnPointerOutTrigger,x.a.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=e,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(p.a.ACTION_OnPointerOverTrigger,x.a.CreateNewFromSprite(this._pointerOverSprite,this)))},wa.a.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var ml=function(){function e(b){this.name=_a.a.NAME_SPRITE,this.scene=b,this.scene.spriteManagers=new Array(),this.scene._tempSpritePickingRay=Rb.a?Rb.a.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new I.c(),this.scene.onAfterSpritesRenderingObservable=new I.c(),this._spritePredicate=function(a){return!!a.actionManager&&(a.isPickable&&a.actionManager.hasPointerTriggers)}}return e.prototype.register=function(){this.scene._pointerMoveStage.registerStep(_a.a.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(_a.a.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(_a.a.STEP_POINTERUP_SPRITE,this,this._pointerUp)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();for(var b=this.scene.spriteManagers;b.length;)b[0].dispose()},e.prototype._pickSpriteButKeepRay=function(b,a,c,d,f){var g=this.scene.pickSprite(a,c,this._spritePredicate,d,f);return g&&(g.ray=b?b.ray:null),g},e.prototype._pointerMove=function(b,a,c,d,f){var g=this.scene;return d?g.setPointerOverSprite(null):(c=this._pickSpriteButKeepRay(c,b,a,!1,g.cameraToUseForPointers||void 0))&&c.hit&&c.pickedSprite?(g.setPointerOverSprite(c.pickedSprite),g.doNotHandleCursors||(g._pointerOverSprite&&g._pointerOverSprite.actionManager&&g._pointerOverSprite.actionManager.hoverCursor?f.style.cursor=g._pointerOverSprite.actionManager.hoverCursor:f.style.cursor=g.hoverCursor)):g.setPointerOverSprite(null),c},e.prototype._pointerDown=function(b,a,c,d){var f=this.scene;if(f._pickedDownSprite=null,f.spriteManagers.length>0&&(c=f.pickSprite(b,a,this._spritePredicate,!1,f.cameraToUseForPointers||void 0))&&c.hit&&c.pickedSprite&&c.pickedSprite.actionManager){switch(f._pickedDownSprite=c.pickedSprite,d.button){case 0:c.pickedSprite.actionManager.processTrigger(p.a.ACTION_OnLeftPickTrigger,x.a.CreateNewFromSprite(c.pickedSprite,f,d));break;case 1:c.pickedSprite.actionManager.processTrigger(p.a.ACTION_OnCenterPickTrigger,x.a.CreateNewFromSprite(c.pickedSprite,f,d));break;case 2:c.pickedSprite.actionManager.processTrigger(p.a.ACTION_OnRightPickTrigger,x.a.CreateNewFromSprite(c.pickedSprite,f,d))}c.pickedSprite.actionManager&&c.pickedSprite.actionManager.processTrigger(p.a.ACTION_OnPickDownTrigger,x.a.CreateNewFromSprite(c.pickedSprite,f,d))}return c},e.prototype._pointerUp=function(b,a,c,d){var f=this.scene;if(f.spriteManagers.length>0){var g=f.pickSprite(b,a,this._spritePredicate,!1,f.cameraToUseForPointers||void 0);g&&(g.hit&&g.pickedSprite&&g.pickedSprite.actionManager&&(g.pickedSprite.actionManager.processTrigger(p.a.ACTION_OnPickUpTrigger,x.a.CreateNewFromSprite(g.pickedSprite,f,d)),g.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||g.pickedSprite.actionManager.processTrigger(p.a.ACTION_OnPickTrigger,x.a.CreateNewFromSprite(g.pickedSprite,f,d)))),f._pickedDownSprite&&f._pickedDownSprite.actionManager&&f._pickedDownSprite!==g.pickedSprite&&f._pickedDownSprite.actionManager.processTrigger(p.a.ACTION_OnPickOutTrigger,x.a.CreateNewFromSprite(f._pickedDownSprite,f,d)))}return c},e}(),np=`uniform bool alphaTest;
varying vec4 vColor;

varying vec2 vUV;
uniform sampler2D diffuseSampler;

#include<fogFragmentDeclaration>
void main(void) {
vec4 color=texture2D(diffuseSampler,vUV);
if (alphaTest)
{
if (color.a<0.95)
discard;
}
color*=vColor;
#include<fogFragment>
gl_FragColor=color;
}`;Pa.a.ShadersStore.spritesPixelShader=np;var op=`
attribute vec4 position;
attribute vec4 options;
attribute vec2 inverts;
attribute vec4 cellInfo;
attribute vec4 color;

uniform mat4 view;
uniform mat4 projection;

varying vec2 vUV;
varying vec4 vColor;
#include<fogVertexDeclaration>
void main(void) {
vec3 viewPos=(view*vec4(position.xyz,1.0)).xyz;
vec2 cornerPos;
float angle=position.w;
vec2 size=vec2(options.x,options.y);
vec2 offset=options.zw;
cornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

viewPos+=rotatedCorner;
gl_Position=projection*vec4(viewPos,1.0);

vColor=color;

vec2 uvOffset=vec2(abs(offset.x-inverts.x),abs(1.0-offset.y-inverts.y));
vec2 uvPlace=cellInfo.xy;
vec2 uvSize=cellInfo.zw;
vUV.x=uvPlace.x+uvSize.x*uvOffset.x;
vUV.y=uvPlace.y+uvSize.y*uvOffset.y;

#ifdef FOG
vFogDistance=viewPos;
#endif
}`;Pa.a.ShadersStore.spritesVertexShader=op;var nl=function(){function e(b,a,c,d,f,g,h,j,m){if(void 0===g&&(g=.01),void 0===h&&(h=ya.a.TRILINEAR_SAMPLINGMODE),void 0===j&&(j=!1),void 0===m&&(m=null),this.name=b,this.sprites=new Array(),this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this._packedAndReady=!1,this.onDisposeObservable=new I.c(),this._vertexBuffers={},this._blendMode=p.a.ALPHA_COMBINE,this.disableDepthWrite=!1,f._getComponent(_a.a.NAME_SPRITE)||f._addComponent(new ml(f)),this._capacity=c,this._fromPacked=j,this._spriteTexture=new ya.a(a,f,!0,!1,h),this._spriteTexture.wrapU=ya.a.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=ya.a.CLAMP_ADDRESSMODE,d.width&&d.height)this.cellWidth=d.width,this.cellHeight=d.height;else{if(void 0===d)return;this.cellWidth=d,this.cellHeight=d}this._epsilon=g,this._scene=f,this._scene.spriteManagers.push(this);for(var w=[],z=0,C=0;C<c;C++)w.push(z),w.push(z+1),w.push(z+2),w.push(z),w.push(z+2),w.push(z+3),z+=4;this._indexBuffer=f.getEngine().createIndexBuffer(w),this._vertexData=new Float32Array(18*c*4),this._buffer=new ra.a(f.getEngine(),this._vertexData,!0,18);var J=this._buffer.createVertexBuffer(ra.b.PositionKind,0,4),K=this._buffer.createVertexBuffer("options",4,4),N=this._buffer.createVertexBuffer("inverts",8,2),T=this._buffer.createVertexBuffer("cellInfo",10,4),Z=this._buffer.createVertexBuffer(ra.b.ColorKind,14,4);this._vertexBuffers[ra.b.PositionKind]=J,this._vertexBuffers.options=K,this._vertexBuffers.inverts=N,this._vertexBuffers.cellInfo=T,this._vertexBuffers[ra.b.ColorKind]=Z,this._effectBase=this._scene.getEngine().createEffect("sprites",[ra.b.PositionKind,"options","inverts","cellInfo",ra.b.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[ra.b.PositionKind,"options","inverts","cellInfo",ra.b.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG"),this._fromPacked&&this._makePacked(a,m)}return Object.defineProperty(e.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._spriteTexture},set:function(b){this._spriteTexture=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(b){this._blendMode=b},enumerable:!0,configurable:!0}),e.prototype._makePacked=function(b,a){var c=this;if(null!==a)try{var d;if((d="string"==typeof a?JSON.parse(a):a).frames.length){for(var f={},g=0;g<d.frames.length;g++){var h=d.frames[g];if("string"!=typeof Object.keys(h)[0])throw new Error("Invalid JSON Format.  Check the frame values and make sure the name is the first parameter.");f[h[Object.keys(h)[0]]]=h}d.frames=f}var j=Reflect.ownKeys(d.frames);this._spriteMap=j,this._packedAndReady=!0,this._cellData=d.frames}catch(J){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON from string. Spritesheet managed with constant cell size.")}else{var m=/\./g,w;do w=m.lastIndex,m.test(b);while(m.lastIndex>0);var z=b.substring(0,w-1)+".json",C=new XMLHttpRequest();C.open("GET",z,!0),C.onerror=function(){k.a.Error("JSON ERROR: Unable to load JSON file."),c._fromPacked=!1,c._packedAndReady=!1},C.onload=function(){try{var J=JSON.parse(C.response),K=Reflect.ownKeys(J.frames);c._spriteMap=K,c._packedAndReady=!0,c._cellData=J.frames}catch(N){throw c._fromPacked=!1,c._packedAndReady=!1,new Error("Invalid JSON format. Please check documentation for format specifications.")}},C.send()}},e.prototype._appendSpriteVertex=function(b,a,c,d,f){var g=18*b;if(0===c?c=this._epsilon:1===c&&(c=1-this._epsilon),0===d?d=this._epsilon:1===d&&(d=1-this._epsilon),this._vertexData[g]=a.position.x,this._vertexData[g+1]=a.position.y,this._vertexData[g+2]=a.position.z,this._vertexData[g+3]=a.angle,this._vertexData[g+4]=a.width,this._vertexData[g+5]=a.height,this._vertexData[g+6]=c,this._vertexData[g+7]=d,this._vertexData[g+8]=a.invertU?1:0,this._vertexData[g+9]=a.invertV?1:0,this._packedAndReady){a.cellRef||(a.cellIndex=0);var h=a.cellIndex;"number"==typeof h&&isFinite(h)&&Math.floor(h)===h&&(a.cellRef=this._spriteMap[a.cellIndex]),this._vertexData[g+10]=this._cellData[a.cellRef].frame.x/f.width,this._vertexData[g+11]=this._cellData[a.cellRef].frame.y/f.height,this._vertexData[g+12]=this._cellData[a.cellRef].frame.w/f.width,this._vertexData[g+13]=this._cellData[a.cellRef].frame.h/f.height}else{a.cellIndex||(a.cellIndex=0);var j=f.width/this.cellWidth,m=a.cellIndex/j>>0;this._vertexData[g+10]=(a.cellIndex-m*j)*this.cellWidth/f.width,this._vertexData[g+11]=m*this.cellHeight/f.height,this._vertexData[g+12]=this.cellWidth/f.width,this._vertexData[g+13]=this.cellHeight/f.height}this._vertexData[g+14]=a.color.r,this._vertexData[g+15]=a.color.g,this._vertexData[g+16]=a.color.b,this._vertexData[g+17]=a.color.a},e.prototype.intersects=function(b,a,c,d){for(var f=Math.min(this._capacity,this.sprites.length),g=i.e.Zero(),h=i.e.Zero(),j=Number.MAX_VALUE,m=null,w=i.c.Vector3[0],z=i.c.Vector3[1],C=a.getViewMatrix(),J=0;J<f;J++){var K=this.sprites[J];if(K){if(c){if(!c(K))continue}else if(!K.isPickable)continue;if(i.e.TransformCoordinatesToRef(K.position,C,z),g.copyFromFloats(z.x-K.width/2,z.y-K.height/2,z.z),h.copyFromFloats(z.x+K.width/2,z.y+K.height/2,z.z),b.intersectsBoxMinMax(g,h)){var N=i.e.Distance(z,b.origin);if(j>N&&(j=N,m=K,d))break}}}if(m){var T=new nd.a();C.invertToRef(i.c.Matrix[0]),T.hit=!0,T.pickedSprite=m,T.distance=j;var Z=i.c.Vector3[2];return Z.copyFrom(b.direction),Z.normalize(),Z.scaleInPlace(j),b.origin.addToRef(Z,w),T.pickedPoint=i.e.TransformCoordinates(w,i.c.Matrix[0]),T}return null},e.prototype.multiIntersects=function(b,a,c){for(var d,f=Math.min(this._capacity,this.sprites.length),g=i.e.Zero(),h=i.e.Zero(),j=[],m=i.c.Vector3[0].copyFromFloats(0,0,0),w=i.c.Vector3[1].copyFromFloats(0,0,0),z=a.getViewMatrix(),C=0;C<f;C++){var J=this.sprites[C];if(J){if(c){if(!c(J))continue}else if(!J.isPickable)continue;if(i.e.TransformCoordinatesToRef(J.position,z,w),g.copyFromFloats(w.x-J.width/2,w.y-J.height/2,w.z),h.copyFromFloats(w.x+J.width/2,w.y+J.height/2,w.z),b.intersectsBoxMinMax(g,h)){d=i.e.Distance(w,b.origin);var K=new nd.a();j.push(K),z.invertToRef(i.c.Matrix[0]),K.hit=!0,K.pickedSprite=J,K.distance=d;var N=i.c.Vector3[2];N.copyFrom(b.direction),N.normalize(),N.scaleInPlace(d),b.origin.addToRef(N,m),K.pickedPoint=i.e.TransformCoordinates(m,i.c.Matrix[0])}}}return j},e.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()&&this.sprites.length&&(!this._fromPacked||this._packedAndReady&&this._spriteMap&&this._cellData)){for(var b=this._scene.getEngine(),a=this._spriteTexture.getBaseSize(),c=b.getDeltaTime(),d=Math.min(this._capacity,this.sprites.length),f=0,g=!0,h=0;h<d;h++){var j=this.sprites[h];j&&j.isVisible&&(g=!1,j._animate(c),this._appendSpriteVertex(f++,j,0,0,a),this._appendSpriteVertex(f++,j,1,0,a),this._appendSpriteVertex(f++,j,1,1,a),this._appendSpriteVertex(f++,j,0,1,a))}if(!g){this._buffer.update(this._vertexData);var m=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==wa.a.FOGMODE_NONE&&this.fogEnabled&&(m=this._effectFog),b.enableEffect(m);var w=this._scene.getViewMatrix();m.setTexture("diffuseSampler",this._spriteTexture),m.setMatrix("view",w),m.setMatrix("projection",this._scene.getProjectionMatrix()),this._scene.fogEnabled&&this._scene.fogMode!==wa.a.FOGMODE_NONE&&this.fogEnabled&&(m.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),m.setColor3("vFogColor",this._scene.fogColor)),b.bindBuffers(this._vertexBuffers,this._indexBuffer,m),b.setDepthFunctionToLessOrEqual(),this.disableDepthWrite||(m.setBool("alphaTest",!0),b.setColorWrite(!1),b.drawElementsType(Hb.a.TriangleFillMode,0,f/4*6),b.setColorWrite(!0),m.setBool("alphaTest",!1)),b.setAlphaMode(this._blendMode),b.drawElementsType(Hb.a.TriangleFillMode,0,f/4*6),b.setAlphaMode(p.a.ALPHA_DISABLE)}}},e.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var b=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(b,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e}(),pp=`precision highp float;
varying vec3 vPosition;
varying vec2 vUV;
varying vec2 tUV;
uniform float time;
uniform float spriteCount;
uniform sampler2D spriteSheet;
uniform vec2 spriteMapSize;
uniform vec2 outputSize;
uniform vec2 stageSize;
uniform sampler2D frameMap;
uniform sampler2D tileMaps[LAYERS];
uniform sampler2D animationMap;
uniform vec3 colorMul;
float mt;
const float fdStep=1./4.;
const float aFrameSteps=1./MAX_ANIMATION_FRAMES;
mat4 getFrameData(float frameID){
float fX=frameID/spriteCount;
return mat4(
texture2D(frameMap,vec2(fX,0.),0.),
texture2D(frameMap,vec2(fX,fdStep*1.),0.),
texture2D(frameMap,vec2(fX,fdStep*2.),0.),
vec4(0.)
);
}
void main(){
vec4 color=vec4(0.);
vec2 tileUV=fract(tUV);
#ifdef FLIPU
tileUV.y=1.0-tileUV.y;
#endif
vec2 tileID=floor(tUV);
vec2 sheetUnits=1./spriteMapSize;
float spriteUnits=1./spriteCount;
vec2 stageUnits=1./stageSize;
for(int i=0; i<LAYERS; i++) {
float frameID;
#define LAYER_ID_SWITCH
vec4 animationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,0.),0.);
if(animationData.y>0.) {
mt=mod(time*animationData.z,1.0);
for(float f=0.; f<MAX_ANIMATION_FRAMES; f++){
if(animationData.y>mt){
frameID=animationData.x;
break;
}
animationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,aFrameSteps*f),0.);
}
}

mat4 frameData=getFrameData(frameID+0.5);
vec2 frameSize=(frameData[0].wz)/spriteMapSize;
vec2 offset=frameData[0].xy*sheetUnits;
vec2 ratio=frameData[2].xy/frameData[0].wz;

if (frameData[2].z == 1.){
tileUV.xy=tileUV.yx;
}
if (i == 0){
color=texture2D(spriteSheet,tileUV*frameSize+offset);
} else {
vec4 nc=texture2D(spriteSheet,tileUV*frameSize+offset);
float alpha=min(color.a+nc.a,1.0);
vec3 mixed=mix(color.xyz,nc.xyz,nc.a);
color=vec4(mixed,alpha);
}
}
color.xyz*=colorMul;
gl_FragColor=color;
}`;Pa.a.ShadersStore.spriteMapPixelShader=pp;var qp=`precision highp float;

attribute vec3 position;
attribute vec3 normal;
attribute vec2 uv;

varying vec3 vPosition;
varying vec2 vUV;
varying vec2 tUV;
varying vec2 stageUnits;
varying vec2 levelUnits;
varying vec2 tileID;

uniform float time;
uniform mat4 worldViewProjection;
uniform vec2 outputSize;
uniform vec2 stageSize;
uniform vec2 spriteMapSize;
uniform float stageScale;
void main() {
vec4 p=vec4( position,1. );
vPosition=p.xyz;
vUV=uv;
tUV=uv*stageSize;
gl_Position=worldViewProjection*p;
}`;Pa.a.ShadersStore.spriteMapVertexShader=qp;var Dc,rp=function(){function e(b,a,c,d,f){var g=this;this.name=b,this.sprites=[],this.atlasJSON=a,this.sprites=this.atlasJSON.frames,this.spriteSheet=c,this.options=d,d.stageSize=d.stageSize||new i.d(1,1),d.outputSize=d.outputSize||d.stageSize,d.outputPosition=d.outputPosition||i.e.Zero(),d.outputRotation=d.outputRotation||i.e.Zero(),d.layerCount=d.layerCount||1,d.maxAnimationFrames=d.maxAnimationFrames||0,d.baseTile=d.baseTile||0,d.flipU=d.flipU||!1,d.colorMultiply=d.colorMultiply||new i.e(1,1,1),this._scene=f,this._frameMap=this._createFrameBuffer(),this._tileMaps=new Array();for(var h=0;h<d.layerCount;h++)this._tileMaps.push(this._createTileBuffer(null,h));this._animationMap=this._createTileAnimationBuffer(null);var j=[];j.push("#define LAYERS "+d.layerCount),d.flipU&&j.push("#define FLIPU"),j.push("#define MAX_ANIMATION_FRAMES "+d.maxAnimationFrames+".0");var m,w=Pa.a.ShadersStore.spriteMapPixelShader;if(1===this._scene.getEngine().webGLVersion)for(m="",h=0;h<d.layerCount;h++)m+="if ("+h+" == i) { frameID = texture2D(tileMaps["+h+"], (tileID + 0.5) / stageSize, 0.).x; }";else{for(m="switch(i) {",h=0;h<d.layerCount;h++)m+="case "+h+" : frameID = texture(tileMaps["+h+"], (tileID + 0.5) / stageSize, 0.).x;",m+="break;";m+="}"}Pa.a.ShadersStore["spriteMap"+this.name+"PixelShader"]=w.replace("#define LAYER_ID_SWITCH",m),this._material=new vf.a("spriteMap:"+this.name,this._scene,{vertex:"spriteMap",fragment:"spriteMap"+this.name},{defines:j,attributes:["position","normal","uv"],uniforms:["worldViewProjection","time","stageSize","outputSize","spriteMapSize","spriteCount","time","colorMul","mousePosition","curTile","flipU"],samplers:["spriteSheet","frameMap","tileMaps","animationMap"],needAlphaBlending:!0}),this._time=0,this._material.setFloat("spriteCount",this.spriteCount),this._material.setVector2("stageSize",d.stageSize),this._material.setVector2("outputSize",d.outputSize),this._material.setTexture("spriteSheet",this.spriteSheet),this._material.setVector2("spriteMapSize",new i.d(1,1)),this._material.setVector3("colorMul",d.colorMultiply);var z=0,C=function(){g.spriteSheet&&g.spriteSheet.isReady()&&g.spriteSheet._texture?g._material.setVector2("spriteMapSize",new i.d(g.spriteSheet._texture.baseWidth||1,g.spriteSheet._texture.baseHeight||1)):z<100&&setTimeout(function(){z++,C()},100)};C(),this._material.setVector3("colorMul",d.colorMultiply),this._material.setTexture("frameMap",this._frameMap),this._material.setTextureArray("tileMaps",this._tileMaps),this._material.setTexture("animationMap",this._animationMap),this._material.setFloat("time",this._time),this._output=xa.a.CreatePlane(b+":output",1,f,!0),this._output.scaling.x=d.outputSize.x,this._output.scaling.y=d.outputSize.y,this._scene.onBeforeRenderObservable.add(function(){g._time+=g._scene.getEngine().getDeltaTime(),g._material.setFloat("time",g._time)}),this._output.material=this._material}return Object.defineProperty(e.prototype,"spriteCount",{get:function(){return this.sprites.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._output.position},set:function(b){this._output.position=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._output.rotation},set:function(b){this._output.rotation=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationMap",{get:function(){return this._animationMap},set:function(b){var a=b._texture._bufferView,c=this._createTileAnimationBuffer(a);this._animationMap.dispose(),this._animationMap=c,this._material.setTexture("animationMap",this._animationMap)},enumerable:!0,configurable:!0}),e.prototype.getTileID=function(){var b=this.getMousePosition();return b.multiplyInPlace(this.options.stageSize||i.d.Zero()),b.x=Math.floor(b.x),b.y=Math.floor(b.y),b},e.prototype.getMousePosition=function(){var b=this._output,a=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(d){return d===b});if(!a||!a.hit||!a.getTextureCoordinates)return new i.d(-1,-1);var c=a.getTextureCoordinates();return c||new i.d(-1,-1)},e.prototype._createFrameBuffer=function(){for(var b=new Array(),a=0;a<this.spriteCount;a++)b.push(0,0,0,0),b.push(0,0,0,0),b.push(0,0,0,0),b.push(0,0,0,0);for(a=0;a<this.spriteCount;a++){var c=this.sprites[a].frame,d=this.sprites[a].spriteSourceSize,f=this.sprites[a].sourceSize,g=this.sprites[a].rotated?1:0,h=this.sprites[a].trimmed?1:0;b[4*a]=c.x,b[4*a+1]=c.y,b[4*a+2]=c.w,b[4*a+3]=c.h,b[4*a+4*this.spriteCount]=d.x,b[4*a+1+4*this.spriteCount]=d.y,b[4*a+3+4*this.spriteCount]=d.h,b[4*a+8*this.spriteCount]=f.w,b[4*a+1+8*this.spriteCount]=f.h,b[4*a+2+8*this.spriteCount]=g,b[4*a+3+8*this.spriteCount]=h}var j=new Float32Array(b);return vc.CreateRGBATexture(j,this.spriteCount,4,this._scene,!1,!1,ya.a.NEAREST_NEAREST,Ha.a.TEXTURETYPE_FLOAT)},e.prototype._createTileBuffer=function(b,a){void 0===a&&(a=0);var c=new Array(),d=this.options.stageSize.y||0,f=this.options.stageSize.x||0;if(b)c=b;else{var g=this.options.baseTile;0!=a&&(g=0);for(var h=0;h<d;h++)for(var j=0;j<4*f;j+=4)c.push(g,0,0,0)}var m=new Float32Array(c);return vc.CreateRGBATexture(m,f,d,this._scene,!1,!1,ya.a.NEAREST_NEAREST,Ha.a.TEXTURETYPE_FLOAT)},e.prototype.changeTiles=function(b,a,c){var d;if(void 0===b&&(b=0),void 0===c&&(c=0),null!==(d=this._tileMaps[b]._texture._bufferView)){var f=new Array();a instanceof i.d?f.push(a):f=a;for(var g=this.options.stageSize.x||0,h=0;h<f.length;h++){var j=f[h];j.x=Math.floor(j.x),j.y=Math.floor(j.y),d[4*j.x+j.y*(4*g)]=c}var m=this._createTileBuffer(d);this._tileMaps[b].dispose(),this._tileMaps[b]=m,this._material.setTextureArray("tileMap",this._tileMaps)}},e.prototype._createTileAnimationBuffer=function(b){var a,c=new Array();if(b)a=b;else{for(var d=0;d<this.spriteCount;d++){c.push(0,0,0,0);for(var f=1;f<(this.options.maxAnimationFrames||4);)c.push(0,0,0,0),f++}a=new Float32Array(c)}return vc.CreateRGBATexture(a,this.spriteCount,this.options.maxAnimationFrames||4,this._scene,!1,!1,ya.a.NEAREST_NEAREST,Ha.a.TEXTURETYPE_FLOAT)},e.prototype.addAnimationToTile=function(b,a,c,d,f){void 0===b&&(b=0),void 0===a&&(a=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===f&&(f=1);var g=this._animationMap._texture._bufferView,h=4*b+4*this.spriteCount*a;if(g){g[h]=c,g[h+1]=d,g[h+2]=f;var j=this._createTileAnimationBuffer(g);this._animationMap.dispose(),this._animationMap=j,this._material.setTexture("animationMap",this._animationMap)}},e.prototype.saveTileMaps=function(){for(var b="",a=0;a<this._tileMaps.length;a++)a>0&&(b+=`
\r`),b+=this._tileMaps[a]._texture._bufferView.toString();var c=document.createElement("a");c.href="data:octet/stream;charset=utf-8,"+encodeURI(b),c.target="_blank",c.download=this.name+".tilemaps",c.click(),c.remove()},e.prototype.loadTileMaps=function(b){var a=this,c=new XMLHttpRequest();c.open("GET",b);var d=this.options.layerCount||0;c.onload=function(){for(var f=c.response.split(`
\r`),g=0;g<d;g++){var h=f[g].split(",").map(Number),j=a._createTileBuffer(h);a._tileMaps[g].dispose(),a._tileMaps[g]=j}a._material.setTextureArray("tileMap",a._tileMaps)},c.send()},e.prototype.dispose=function(){this._output.dispose(),this._material.dispose(),this._animationMap.dispose(),this._tileMaps.forEach(function(b){b.dispose()}),this._frameMap.dispose()},e}(),sp=function(e){function b(a,c,d,f,g,h,j){void 0===g&&(g=null),void 0===h&&(h=.01),void 0===j&&(j=ya.a.TRILINEAR_SAMPLINGMODE);var m=e.call(this,a,c,d,64,f,h,j,!0,g)||this;return m.name=a,m}return Object(l.d)(b,e),b}(nl),tp=o(129),up=o(127),vp=o(128),wp=o(125);!function(e){e[e.INIT=0]="INIT",e[e.RUNNING=1]="RUNNING",e[e.DONE=2]="DONE",e[e.ERROR=3]="ERROR"}(Dc||(Dc={}));var uh,Rc=function(){function e(b){this.name=b,this._isCompleted=!1,this._taskState=Dc.INIT}return Object.defineProperty(e.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"taskState",{get:function(){return this._taskState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!0,configurable:!0}),e.prototype._setErrorObject=function(b,a){this._errorObject||(this._errorObject={message:b,exception:a})},e.prototype.run=function(b,a,c){var d=this;this._taskState=Dc.RUNNING,this.runTask(b,function(){d.onDoneCallback(a,c)},function(f,g){d.onErrorCallback(c,f,g)})},e.prototype.runTask=function(b,a,c){throw new Error("runTask is not implemented")},e.prototype.reset=function(){this._taskState=Dc.INIT},e.prototype.onErrorCallback=function(b,a,c){this._taskState=Dc.ERROR,this._errorObject={message:a,exception:c},this.onError&&this.onError(this,a,c),b()},e.prototype.onDoneCallback=function(b,a){try{this._taskState=Dc.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),b()}catch(c){this.onErrorCallback(a,"Task is done, error executing success callback(s)",c)}},e}(),ol=function(e,b,a){this.remainingCount=e,this.totalCount=b,this.task=a},pl=function(e){function b(a,c,d,f){var g=e.call(this,a)||this;return g.name=a,g.meshesNames=c,g.rootUrl=d,g.sceneFilename=f,g}return Object(l.d)(b,e),b.prototype.runTask=function(a,c,d){var f=this;yb.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,a,function(g,h,j,m){f.loadedMeshes=g,f.loadedParticleSystems=h,f.loadedSkeletons=j,f.loadedAnimationGroups=m,c()},null,function(g,h,j){d(h,j)})},b}(Rc),ql=function(e){function b(a,c){var d=e.call(this,a)||this;return d.name=a,d.url=c,d}return Object(l.d)(b,e),b.prototype.runTask=function(a,c,d){var f=this;a._loadFile(this.url,function(g){f.text=g,c()},void 0,!1,!1,function(g,h){g&&d(g.status+" "+g.statusText,h)})},b}(Rc),rl=function(e){function b(a,c){var d=e.call(this,a)||this;return d.name=a,d.url=c,d}return Object(l.d)(b,e),b.prototype.runTask=function(a,c,d){var f=this;a._loadFile(this.url,function(g){f.data=g,c()},void 0,!0,!0,function(g,h){g&&d(g.status+" "+g.statusText,h)})},b}(Rc),sl=function(e){function b(a,c){var d=e.call(this,a)||this;return d.name=a,d.url=c,d}return Object(l.d)(b,e),b.prototype.runTask=function(a,c,d){var f=this,g=new Image();Qa.b.SetCorsBehavior(this.url,g),g.onload=function(){f.image=g,c()},g.onerror=function(h){d("Error loading image",h)},g.src=this.url},b}(Rc),tl=function(e){function b(a,c,d,f,g){void 0===g&&(g=ya.a.TRILINEAR_SAMPLINGMODE);var h=e.call(this,a)||this;return h.name=a,h.url=c,h.noMipmap=d,h.invertY=f,h.samplingMode=g,h}return Object(l.d)(b,e),b.prototype.runTask=function(a,c,d){this.texture=new ya.a(this.url,a,this.noMipmap,this.invertY,this.samplingMode,function(){c()},function(f,g){d(f,g)})},b}(Rc),ul=function(e){function b(a,c,d,f,g){var h=e.call(this,a)||this;return h.name=a,h.url=c,h.extensions=d,h.noMipmap=f,h.files=g,h}return Object(l.d)(b,e),b.prototype.runTask=function(a,c,d){this.texture=new pc(this.url,a,this.extensions,this.noMipmap,this.files,function(){c()},function(f,g){d(f,g)})},b}(Rc),vl=function(e){function b(a,c,d,f,g,h,j){void 0===f&&(f=!1),void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===j&&(j=!1);var m=e.call(this,a)||this;return m.name=a,m.url=c,m.size=d,m.noMipmap=f,m.generateHarmonics=g,m.gammaSpace=h,m.reserved=j,m}return Object(l.d)(b,e),b.prototype.runTask=function(a,c,d){this.texture=new Ee(this.url,a,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,function(){c()},function(f,g){d(f,g)})},b}(Rc),wl=function(e){function b(a,c,d,f,g){void 0===f&&(f=!1),void 0===g&&(g=!0);var h=e.call(this,a)||this;return h.name=a,h.url=c,h.size=d,h.noMipmap=f,h.gammaSpace=g,h}return Object(l.d)(b,e),b.prototype.runTask=function(a,c,d){this.texture=new uj(this.url,a,this.size,this.noMipmap,this.gammaSpace,function(){c()},function(f,g){d(f,g)})},b}(Rc),xp=function(){function e(b){this._isLoading=!1,this._tasks=new Array(),this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new I.c(),this.onTaskErrorObservable=new I.c(),this.onTasksDoneObservable=new I.c(),this.onProgressObservable=new I.c(),this.useDefaultLoadingScreen=!0,this.autoHideLoadingUI=!0,this._scene=b}return e.prototype.addMeshTask=function(b,a,c,d){var f=new pl(b,a,c,d);return this._tasks.push(f),f},e.prototype.addTextFileTask=function(b,a){var c=new ql(b,a);return this._tasks.push(c),c},e.prototype.addBinaryFileTask=function(b,a){var c=new rl(b,a);return this._tasks.push(c),c},e.prototype.addImageTask=function(b,a){var c=new sl(b,a);return this._tasks.push(c),c},e.prototype.addTextureTask=function(b,a,c,d,f){void 0===f&&(f=ya.a.TRILINEAR_SAMPLINGMODE);var g=new tl(b,a,c,d,f);return this._tasks.push(g),g},e.prototype.addCubeTextureTask=function(b,a,c,d,f){var g=new ul(b,a,c,d,f);return this._tasks.push(g),g},e.prototype.addHDRCubeTextureTask=function(b,a,c,d,f,g,h){void 0===d&&(d=!1),void 0===f&&(f=!0),void 0===g&&(g=!1),void 0===h&&(h=!1);var j=new vl(b,a,c,d,f,g,h);return this._tasks.push(j),j},e.prototype.addEquiRectangularCubeTextureAssetTask=function(b,a,c,d,f){void 0===d&&(d=!1),void 0===f&&(f=!0);var g=new wl(b,a,c,d,f);return this._tasks.push(g),g},e.prototype.removeTask=function(b){var a=this._tasks.indexOf(b);a>-1&&this._tasks.splice(a,1)},e.prototype._decreaseWaitingTasksCount=function(b){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,b),this.onProgressObservable.notifyObservers(new ol(this._waitingTasksCount,this._totalTasksCount,b))}catch(g){k.a.Error("Error running progress callbacks."),console.log(g)}if(0===this._waitingTasksCount){try{var a=this._tasks.slice();this.onFinish&&this.onFinish(a);for(var c=0,d=a;c<d.length;c++)if((b=d[c]).taskState===Dc.DONE){var f=this._tasks.indexOf(b);f>-1&&this._tasks.splice(f,1)}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(g){k.a.Error("Error running tasks-done callbacks."),console.log(g)}this._isLoading=!1,this.autoHideLoadingUI&&this._scene.getEngine().hideLoadingUI()}},e.prototype._runTask=function(b){var a=this,c=function(d,f){b._setErrorObject(d,f),a.onTaskError&&a.onTaskError(b),a.onTaskErrorObservable.notifyObservers(b),a._decreaseWaitingTasksCount(b)};b.run(this._scene,function(){try{a.onTaskSuccess&&a.onTaskSuccess(b),a.onTaskSuccessObservable.notifyObservers(b),a._decreaseWaitingTasksCount(b)}catch(d){c("Error executing task success callbacks",d)}},c)},e.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array(),this},e.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,0===this._waitingTasksCount)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var b=0;b<this._tasks.length;b++){var a=this._tasks[b];a.taskState===Dc.INIT&&this._runTask(a)}return this},e.prototype.loadAsync=function(){var b=this;return new Promise(function(a,c){b._isLoading?a():(b.onTasksDoneObservable.addOnce(function(d){d&&d.length?c(d):a()}),b.load())})},e}(),yp=function(){function e(){var b=this;this.promise=new Promise(function(a,c){b._resolve=a,b._reject=c})}return Object.defineProperty(e.prototype,"resolve",{get:function(){return this._resolve},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){return this._reject},enumerable:!0,configurable:!0}),e}(),zp=function(){function e(b,a){this._meshesOrigins=[],this._toCenterVectors=[],this._scaledDirection=i.e.Zero(),this._newPosition=i.e.Zero(),this._centerPosition=i.e.Zero(),this._meshes=b.slice(),a?this._centerMesh=a:this._setCenterMesh();var c=this._meshes.indexOf(this._centerMesh);c>=0&&this._meshes.splice(c,1),this._centerPosition=this._centerMesh.getAbsolutePosition().clone();for(var d=0;d<this._meshes.length;d++)if(this._meshes[d]){var f=this._meshes[d];this._meshesOrigins[d]=f.getAbsolutePosition().clone(),this._toCenterVectors[d]=i.e.Zero(),f._boundingInfo&&this._centerMesh._boundingInfo&&f._boundingInfo.boundingBox.centerWorld.subtractToRef(this._centerMesh._boundingInfo.boundingBox.centerWorld,this._toCenterVectors[d])}}return e.prototype._setCenterMesh=function(){for(var b=i.e.Zero(),a=i.e.Zero(),c=Number.MAX_VALUE,d=0;d<this._meshes.length;d++)this._meshes[d]&&((g=(f=this._meshes[d]).getBoundingInfo())&&a.addInPlace(g.boundingBox.centerWorld));for(b=a.scale(1/this._meshes.length),d=0;d<this._meshes.length;d++){var f,g;if(this._meshes[d]){if(g=(f=this._meshes[d]).getBoundingInfo()){var h=g.boundingBox.centerWorld.subtract(b).lengthSquared();h<c&&(this._centerMesh=f,c=h)}}}},e.prototype.getClassName=function(){return"MeshExploder"},e.prototype.getMeshes=function(){var b=this._meshes.slice();return b.unshift(this._centerMesh),b},e.prototype.explode=function(b){void 0===b&&(b=1);for(var a=0;a<this._meshes.length;a++)this._meshes[a]&&this._meshesOrigins[a]&&this._toCenterVectors[a]&&(this._toCenterVectors[a].scaleToRef(b,this._scaledDirection),this._meshesOrigins[a].addToRef(this._scaledDirection,this._newPosition),this._meshes[a].setAbsolutePosition(this._newPosition));this._centerMesh.setAbsolutePosition(this._centerPosition)},e}(),Ap=function(){function e(b,a,c,d,f,g,h,j,m){this.onProcessFileCallback=function(){return!0},this._engine=b,this._currentScene=a,this._sceneLoadedCallback=c,this._progressCallback=d,this._additionalRenderLoopLogicCallback=f,this._textureLoadingCallback=g,this._startingProcessingFilesCallback=h,this._onReloadCallback=j,this._errorCallback=m}return Object.defineProperty(e,"FilesToLoad",{get:function(){return vg.a.FilesToLoad},enumerable:!0,configurable:!0}),e.prototype.monitorElementForDragNDrop=function(b){var a=this;b&&(this._elementToMonitor=b,this._dragEnterHandler=function(c){a.drag(c)},this._dragOverHandler=function(c){a.drag(c)},this._dropHandler=function(c){a.drop(c)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},e.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},e.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var b=this._currentScene.getWaitingItemsCount();b>0&&this._textureLoadingCallback(b)}this._currentScene.render()}},e.prototype.drag=function(b){b.stopPropagation(),b.preventDefault()},e.prototype.drop=function(b){b.stopPropagation(),b.preventDefault(),this.loadFiles(b)},e.prototype._traverseFolder=function(b,a,c,d){var f=this,g=b.createReader(),h=b.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");g.readEntries(function(j){c.count+=j.length;for(var m=0,w=j;m<w.length;m++){var z=w[m];z.isFile?z.file(function(C){C.correctName=h+C.name,a.push(C),0==--c.count&&d()}):z.isDirectory&&f._traverseFolder(z,a,c,d)}--c.count&&d()})},e.prototype._processFiles=function(b){for(var a=0;a<b.length;a++){var c=b[a].correctName.toLowerCase(),d=c.split(".").pop();this.onProcessFileCallback(b[a],c,d)&&("babylon"!==d&&"stl"!==d&&"obj"!==d&&"gltf"!==d&&"glb"!==d||-1!==c.indexOf(".binary.babylon")||-1!==c.indexOf(".incremental.babylon")||(this._sceneFileToLoad=b[a]),e.FilesToLoad[c]=b[a])}},e.prototype.loadFiles=function(b){var a=this;if(b&&b.dataTransfer&&b.dataTransfer.files&&(this._filesToLoad=b.dataTransfer.files),b&&b.target&&b.target.files&&(this._filesToLoad=b.target.files),this._filesToLoad&&0!==this._filesToLoad.length&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var c=new Array(),d=[],f=b.dataTransfer?b.dataTransfer.items:null,g=0;g<this._filesToLoad.length;g++){var h=this._filesToLoad[g],j=h.name.toLowerCase(),m;if(h.correctName=j,f){var w=f[g];w.getAsEntry?m=w.getAsEntry():w.webkitGetAsEntry&&(m=w.webkitGetAsEntry())}m&&m.isDirectory?d.push(m):c.push(h)}if(0===d.length)this._processFiles(c),this._processReload();else for(var z={count:d.length},C=0,J=d;C<J.length;C++){var K=J[C];this._traverseFolder(K,c,z,function(){a._processFiles(c),0===z.count&&a._processReload()})}}},e.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},e.prototype.reload=function(){var b=this;this._sceneFileToLoad?(this._currentScene&&(k.a.errorsCount>0&&k.a.ClearLogCache(),this._engine.stopRenderLoop()),yb.LoadAsync("file:",this._sceneFileToLoad,this._engine,function(a){b._progressCallback&&b._progressCallback(a)}).then(function(a){b._currentScene&&b._currentScene.dispose(),b._currentScene=a,b._sceneLoadedCallback&&b._sceneLoadedCallback(b._sceneFileToLoad,b._currentScene),b._currentScene.executeWhenReady(function(){b._engine.runRenderLoop(function(){b.renderFunction()})})}).catch(function(a){b._errorCallback&&b._errorCallback(b._sceneFileToLoad,b._currentScene,a.message)})):k.a.Error("Please provide a valid .babylon file.")},e}(),xl=o(132),Bp=o(131),Ec=function(){function e(b){void 0===b&&(b=0),this.priority=b}return e.prototype.getDescription=function(){return""},e.prototype.apply=function(b,a){return!0},e}(),Gf=function(e){function b(a,c,d){void 0===a&&(a=0),void 0===c&&(c=1024),void 0===d&&(d=.5);var f=e.call(this,a)||this;return f.priority=a,f.maximumSize=c,f.step=d,f}return Object(l.d)(b,e),b.prototype.getDescription=function(){return"Reducing render target texture size to "+this.maximumSize},b.prototype.apply=function(a,c){for(var d=!0,f=0;f<a.textures.length;f++){var g=a.textures[f];if(g.canRescale&&!g.getContext){var h=g.getSize();Math.max(h.width,h.height)>this.maximumSize&&(g.scale(this.step),d=!1)}}return d},b}(Ec),vh=function(e){function b(a,c,d){void 0===a&&(a=0),void 0===c&&(c=2),void 0===d&&(d=.25);var f=e.call(this,a)||this;return f.priority=a,f.maximumScale=c,f.step=d,f._currentScale=-1,f._directionOffset=1,f}return Object(l.d)(b,e),b.prototype.getDescription=function(){return"Setting hardware scaling level to "+this._currentScale},b.prototype.apply=function(a,c){return-1===this._currentScale&&(this._currentScale=a.getEngine().getHardwareScalingLevel(),this._currentScale>this.maximumScale&&(this._directionOffset=-1)),this._currentScale+=this._directionOffset*this.step,a.getEngine().setHardwareScalingLevel(this._currentScale),1===this._directionOffset?this._currentScale>=this.maximumScale:this._currentScale<=this.maximumScale},b}(Ec),Hf=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.getDescription=function(){return"Turning shadows on/off"},b.prototype.apply=function(a,c){return a.shadowsEnabled=c.isInImprovementMode,!0},b}(Ec),If=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.getDescription=function(){return"Turning post-processes on/off"},b.prototype.apply=function(a,c){return a.postProcessesEnabled=c.isInImprovementMode,!0},b}(Ec),Jf=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.getDescription=function(){return"Turning lens flares on/off"},b.prototype.apply=function(a,c){return a.lensFlaresEnabled=c.isInImprovementMode,!0},b}(Ec),yl=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.getDescription=function(){return this.onGetDescription?this.onGetDescription():"Running user defined callback"},b.prototype.apply=function(a,c){return!this.onApply||this.onApply(a,c)},b}(Ec),Kf=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.getDescription=function(){return"Turning particles on/off"},b.prototype.apply=function(a,c){return a.particlesEnabled=c.isInImprovementMode,!0},b}(Ec),wh=function(e){function b(){return null!==e&&e.apply(this,arguments)||this}return Object(l.d)(b,e),b.prototype.getDescription=function(){return"Turning render targets off"},b.prototype.apply=function(a,c){return a.renderTargetsEnabled=c.isInImprovementMode,!0},b}(Ec),Lf=function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;return a._canBeMerged=function(c){if(!(c instanceof xa.a))return!1;var d=c;return!d.isDisposed()&&(!(!d.isVisible||!d.isEnabled())&&(!(d.instances.length>0)&&(!d.skeleton&&!d.hasLODLevels)))},a}return Object(l.d)(b,e),Object.defineProperty(b,"UpdateSelectionTree",{get:function(){return b._UpdateSelectionTree},set:function(a){b._UpdateSelectionTree=a},enumerable:!0,configurable:!0}),b.prototype.getDescription=function(){return"Merging similar meshes together"},b.prototype.apply=function(a,c,d){for(var f=a.meshes.slice(0),g=f.length,h=0;h<g;h++){var j=new Array(),m=f[h];if(this._canBeMerged(m)){j.push(m);for(var w=h+1;w<g;w++){var z=f[w];this._canBeMerged(z)&&(z.material===m.material&&z.checkCollisions===m.checkCollisions&&(j.push(z),g--,f.splice(w,1),w--))}j.length<2||xa.a.MergeMeshes(j,void 0,!0)}}var C=a;return C.createOrUpdateSelectionOctree&&(null!=d?d&&C.createOrUpdateSelectionOctree():b.UpdateSelectionTree&&C.createOrUpdateSelectionOctree()),!0},b._UpdateSelectionTree=!1,b}(Ec),xh=function(){function e(b,a){void 0===b&&(b=60),void 0===a&&(a=2000),this.targetFrameRate=b,this.trackerDuration=a,this.optimizations=new Array()}return e.prototype.addOptimization=function(b){return this.optimizations.push(b),this},e.prototype.addCustomOptimization=function(b,a,c){void 0===c&&(c=0);var d=new yl(c);return d.onApply=b,d.onGetDescription=a,this.optimizations.push(d),this},e.LowDegradationAllowed=function(b){var a=new e(b),c=0;return a.addOptimization(new Lf(c)),a.addOptimization(new Hf(c)),a.addOptimization(new Jf(c)),c++,a.addOptimization(new If(c)),a.addOptimization(new Kf(c)),c++,a.addOptimization(new Gf(c,1024)),a},e.ModerateDegradationAllowed=function(b){var a=new e(b),c=0;return a.addOptimization(new Lf(c)),a.addOptimization(new Hf(c)),a.addOptimization(new Jf(c)),c++,a.addOptimization(new If(c)),a.addOptimization(new Kf(c)),c++,a.addOptimization(new Gf(c,512)),c++,a.addOptimization(new wh(c)),c++,a.addOptimization(new vh(c,2)),a},e.HighDegradationAllowed=function(b){var a=new e(b),c=0;return a.addOptimization(new Lf(c)),a.addOptimization(new Hf(c)),a.addOptimization(new Jf(c)),c++,a.addOptimization(new If(c)),a.addOptimization(new Kf(c)),c++,a.addOptimization(new Gf(c,256)),c++,a.addOptimization(new wh(c)),c++,a.addOptimization(new vh(c,4)),a},e}(),Cp=function(){function e(b,a,c,d){var f=this;if(void 0===c&&(c=!0),void 0===d&&(d=!1),this._isRunning=!1,this._currentPriorityLevel=0,this._targetFrameRate=60,this._trackerDuration=2000,this._currentFrameRate=0,this._improvementMode=!1,this.onSuccessObservable=new I.c(),this.onNewOptimizationAppliedObservable=new I.c(),this.onFailureObservable=new I.c(),this._options=a||new xh(),this._options.targetFrameRate&&(this._targetFrameRate=this._options.targetFrameRate),this._options.trackerDuration&&(this._trackerDuration=this._options.trackerDuration),c)for(var g=0,h=0,j=this._options.optimizations;h<j.length;h++)j[h].priority=g++;this._improvementMode=d,this._scene=b||U.a.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(function(){f._sceneDisposeObserver=null,f.dispose()})}return Object.defineProperty(e.prototype,"isInImprovementMode",{get:function(){return this._improvementMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPriorityLevel",{get:function(){return this._currentPriorityLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrameRate",{get:function(){return this._currentFrameRate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetFrameRate",{get:function(){return this._targetFrameRate},set:function(b){this._targetFrameRate=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trackerDuration",{get:function(){return this._trackerDuration},set:function(b){this._trackerDuration=b},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizations",{get:function(){return this._options.optimizations},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this._isRunning=!1},e.prototype.reset=function(){this._currentPriorityLevel=0},e.prototype.start=function(){var b=this;this._isRunning||(this._isRunning=!0,this._scene.executeWhenReady(function(){setTimeout(function(){b._checkCurrentState()},b._trackerDuration)}))},e.prototype._checkCurrentState=function(){var b=this;if(this._isRunning){var a=this._scene,c=this._options;if(this._currentFrameRate=Math.round(a.getEngine().getFps()),this._improvementMode&&this._currentFrameRate<=this._targetFrameRate||!this._improvementMode&&this._currentFrameRate>=this._targetFrameRate)return this._isRunning=!1,void this.onSuccessObservable.notifyObservers(this);for(var d=!0,f=!0,g=0;g<c.optimizations.length;g++){var h=c.optimizations[g];h.priority===this._currentPriorityLevel&&(f=!1,d=d&&h.apply(a,this),this.onNewOptimizationAppliedObservable.notifyObservers(h))}if(f)return this._isRunning=!1,void this.onFailureObservable.notifyObservers(this);d&&this._currentPriorityLevel++,a.executeWhenReady(function(){setTimeout(function(){b._checkCurrentState()},b._trackerDuration)})}},e.prototype.dispose=function(){this.stop(),this.onSuccessObservable.clear(),this.onFailureObservable.clear(),this.onNewOptimizationAppliedObservable.clear(),this._sceneDisposeObserver&&this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)},e.OptimizeAsync=function(b,a,c,d){var f=new e(b,a||xh.ModerateDegradationAllowed(),!1);return c&&f.onSuccessObservable.add(function(){c()}),d&&f.onFailureObservable.add(function(){d()}),f.start(),f},e}(),Mf=[],yh=function(e,b){Mf[e.id]||e.doNotSerialize||(b.vertexData.push(e.serializeVerticeData()),Mf[e.id]=!0)},zl=function(e,b){var a={},c=e._geometry;return c&&(e.getScene().getGeometryByID(c.id)||yh(c,b.geometries)),e.serialize&&e.serialize(a),a},Dp=function(){function e(){}return e.ClearCache=function(){Mf=[]},e.Serialize=function(b){var a,c,d,f={};if(e.ClearCache(),f.useDelayedTextureLoading=b.useDelayedTextureLoading,f.autoClear=b.autoClear,f.clearColor=b.clearColor.asArray(),f.ambientColor=b.ambientColor.asArray(),f.gravity=b.gravity.asArray(),f.collisionsEnabled=b.collisionsEnabled,b.fogMode&&0!==b.fogMode&&(f.fogMode=b.fogMode,f.fogColor=b.fogColor.asArray(),f.fogStart=b.fogStart,f.fogEnd=b.fogEnd,f.fogDensity=b.fogDensity),b.isPhysicsEnabled()){var g=b.getPhysicsEngine();g&&(f.physicsEnabled=!0,f.physicsGravity=g.gravity.asArray(),f.physicsEngine=g.getPhysicsPluginName())}b.metadata&&(f.metadata=b.metadata),f.morphTargetManagers=[];for(var h=0,j=b.meshes;h<j.length;h++){var m=(_=j[h]).morphTargetManager;m&&f.morphTargetManagers.push(m.serialize())}for(f.lights=[],a=0;a<b.lights.length;a++)(c=b.lights[a]).doNotSerialize||f.lights.push(c.serialize());for(f.cameras=[],a=0;a<b.cameras.length;a++){var w=b.cameras[a];w.doNotSerialize||f.cameras.push(w.serialize())}if(b.activeCamera&&(f.activeCameraID=b.activeCamera.id),F.a.AppendSerializedAnimations(b,f),b.animationGroups&&b.animationGroups.length>0){f.animationGroups=[];for(var z=0;z<b.animationGroups.length;z++){var C=b.animationGroups[z];f.animationGroups.push(C.serialize())}}if(b.reflectionProbes&&b.reflectionProbes.length>0)for(f.reflectionProbes=[],a=0;a<b.reflectionProbes.length;a++){var J=b.reflectionProbes[a];f.reflectionProbes.push(J.serialize())}for(f.materials=[],f.multiMaterials=[],a=0;a<b.materials.length;a++)(d=b.materials[a]).doNotSerialize||f.materials.push(d.serialize());for(f.multiMaterials=[],a=0;a<b.multiMaterials.length;a++){var K=b.multiMaterials[a];f.multiMaterials.push(K.serialize())}for(b.environmentTexture&&(f.environmentTexture=b.environmentTexture.name),f.environmentIntensity=b.environmentIntensity,f.skeletons=[],a=0;a<b.skeletons.length;a++){var N=b.skeletons[a];N.doNotSerialize||f.skeletons.push(N.serialize())}for(f.transformNodes=[],a=0;a<b.transformNodes.length;a++)b.transformNodes[a].doNotSerialize||f.transformNodes.push(b.transformNodes[a].serialize());f.geometries={},f.geometries.boxes=[],f.geometries.spheres=[],f.geometries.cylinders=[],f.geometries.toruses=[],f.geometries.grounds=[],f.geometries.planes=[],f.geometries.torusKnots=[],f.geometries.vertexData=[],Mf=[];var T=b.getGeometries();for(a=0;a<T.length;a++){var Z=T[a];Z.isReady()&&yh(Z,f.geometries)}for(f.meshes=[],a=0;a<b.meshes.length;a++){var _;if((_=b.meshes[a])instanceof xa.a){var ca=_;ca.doNotSerialize||ca.delayLoadState!==p.a.DELAYLOADSTATE_LOADED&&ca.delayLoadState!==p.a.DELAYLOADSTATE_NONE||f.meshes.push(zl(ca,f))}}for(f.particleSystems=[],a=0;a<b.particleSystems.length;a++)f.particleSystems.push(b.particleSystems[a].serialize());b.actionManager&&(f.actions=b.actionManager.serialize("scene"));for(var ea=0,fa=b._serializableComponents;ea<fa.length;ea++)fa[ea].serialize(f);return f},e.SerializeMesh=function(b,a,c){void 0===a&&(a=!1),void 0===c&&(c=!1);var d={};if(e.ClearCache(),b=b instanceof Array?b:[b],a||c)for(var f=0;f<b.length;++f)c&&b[f].getDescendants().forEach(function(g){g instanceof xa.a&&b.indexOf(g)<0&&!g.doNotSerialize&&b.push(g)}),a&&b[f].parent&&b.indexOf(b[f].parent)<0&&!b[f].parent.doNotSerialize&&b.push(b[f].parent);return b.forEach(function(g){!function(h,j){if(h.delayLoadState===p.a.DELAYLOADSTATE_LOADED||h.delayLoadState===p.a.DELAYLOADSTATE_NONE){if(h.material&&!h.material.doNotSerialize)if(h.material instanceof Td.a){if(j.multiMaterials=j.multiMaterials||[],j.materials=j.materials||[],!j.multiMaterials.some(function(J){return J.id===h.material.id})){j.multiMaterials.push(h.material.serialize());for(var m=function(J){J&&(j.materials.some(function(K){return K.id===J.id})||j.materials.push(J.serialize()))},w=0,z=h.material.subMaterials;w<z.length;w++)m(z[w])}}else j.materials=j.materials||[],j.materials.some(function(J){return J.id===h.material.id})||j.materials.push(h.material.serialize());var C=h._geometry;C&&(j.geometries||(j.geometries={},j.geometries.boxes=[],j.geometries.spheres=[],j.geometries.cylinders=[],j.geometries.toruses=[],j.geometries.grounds=[],j.geometries.planes=[],j.geometries.torusKnots=[],j.geometries.vertexData=[]),yh(C,j.geometries)),h.skeleton&&!h.skeleton.doNotSerialize&&(j.skeletons=j.skeletons||[],j.skeletons.push(h.skeleton.serialize())),j.meshes=j.meshes||[],j.meshes.push(zl(h,j))}}(g,d)}),d},e}(),Ep=o(35),Fp=function(){function e(){}return e.CreateResizedCopy=function(b,a,c,d){void 0===d&&(d=!0);var f=b.getScene(),g=f.getEngine(),h=new Jb("resized"+b.name,{width:a,height:c},f,!b.noMipmap,!0,b._texture.type,!1,b.samplingMode,!1);h.wrapU=b.wrapU,h.wrapV=b.wrapV,h.uOffset=b.uOffset,h.vOffset=b.vOffset,h.uScale=b.uScale,h.vScale=b.vScale,h.uAng=b.uAng,h.vAng=b.vAng,h.wAng=b.wAng,h.coordinatesIndex=b.coordinatesIndex,h.level=b.level,h.anisotropicFilteringLevel=b.anisotropicFilteringLevel,h._texture.isReady=!1,b.wrapU=ya.a.CLAMP_ADDRESSMODE,b.wrapV=ya.a.CLAMP_ADDRESSMODE;var j=new Wc("pass",1,null,d?ya.a.BILINEAR_SAMPLINGMODE:ya.a.NEAREST_SAMPLINGMODE,g,!1,p.a.TEXTURETYPE_UNSIGNED_INT);return j.getEffect().executeWhenCompiled(function(){j.onApply=function(w){w.setTexture("textureSampler",b)};var m=h.getInternalTexture();m&&(f.postProcessManager.directRender([j],m),g.unBindFramebuffer(m),h.disposeFramebufferObjects(),j.dispose(),m.isReady=!0)}),h},e}(),Gp=function(){function e(b,a){if(void 0===a&&(a=null),!e.IsSupported(b))throw"Your browser does not support recording so far.";var c=b.getRenderingCanvas();if(!c)throw"The babylon engine must have a canvas to be recorded";this._canvas=c,this._canvas.isRecording=!1,this._options=Object(l.a)(Object(l.a)({},e._defaultOptions),a);var d=this._canvas.captureStream(this._options.fps);if(this._options.audioTracks)for(var f=0,g=this._options.audioTracks;f<g.length;f++){var h=g[f];d.addTrack(h)}this._mediaRecorder=new MediaRecorder(d,{mimeType:this._options.mimeType}),this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this._mediaRecorder.onerror=this._handleError.bind(this),this._mediaRecorder.onstop=this._handleStop.bind(this)}return e.IsSupported=function(b){var a=b.getRenderingCanvas();return!!a&&"function"==typeof a.captureStream},Object.defineProperty(e.prototype,"isRecording",{get:function(){return!!this._canvas&&this._canvas.isRecording},enumerable:!0,configurable:!0}),e.prototype.stopRecording=function(){this._canvas&&this._mediaRecorder&&this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())},e.prototype.startRecording=function(b,a){var c=this;if(void 0===b&&(b="babylonjs.webm"),void 0===a&&(a=7),!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";return a>0&&setTimeout(function(){c.stopRecording()},1000*a),this._fileName=b,this._recordedChunks=[],this._resolve=null,this._reject=null,this._canvas.isRecording=!0,this._mediaRecorder.start(this._options.recordChunckSize),new Promise(function(d,f){c._resolve=d,c._reject=f})},e.prototype.dispose=function(){this._canvas=null,this._mediaRecorder=null,this._recordedChunks=[],this._fileName=null,this._resolve=null,this._reject=null},e.prototype._handleDataAvailable=function(b){b.data.size>0&&this._recordedChunks.push(b.data)},e.prototype._handleError=function(b){if(this.stopRecording(),!this._reject)throw new b.error();this._reject(b.error)},e.prototype._handleStop=function(){this.stopRecording();var b=new Blob(this._recordedChunks);this._resolve&&this._resolve(b),window.URL.createObjectURL(b),this._fileName&&Qa.b.Download(b,this._fileName)},e._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3000},e}(),Oe=function(){function e(){}return e.CreateScreenshot=function(b,a,c,d,f){void 0===f&&(f="image/png");var g=e._getScreenshotSize(b,a,c),h=g.height,j=g.width;if(h&&j){Qa.b._ScreenshotCanvas||(Qa.b._ScreenshotCanvas=document.createElement("canvas")),Qa.b._ScreenshotCanvas.width=j,Qa.b._ScreenshotCanvas.height=h;var m=Qa.b._ScreenshotCanvas.getContext("2d"),w=b.getRenderWidth()/b.getRenderHeight(),z=j,C=z/w;C>h&&(z=(C=h)*w);var J=Math.max(0,j-z)/2,K=Math.max(0,h-C)/2,N=b.getRenderingCanvas();m&&N&&m.drawImage(N,J,K,z,C),Qa.b.EncodeScreenshotCanvasData(d,f)}else k.a.Error("Invalid 'size' parameter !")},e.CreateScreenshotAsync=function(b,a,c,d){return void 0===d&&(d="image/png"),new Promise(function(f,g){e.CreateScreenshot(b,a,c,function(h){void 0!==h?f(h):g(new Error("Data is undefined"))},d)})},e.CreateScreenshotUsingRenderTarget=function(b,a,c,d,f,g,h,j,m){void 0===f&&(f="image/png"),void 0===g&&(g=1),void 0===h&&(h=!1),void 0===m&&(m=!1);var w=e._getScreenshotSize(b,a,c),z=w.height,C=w.width,J={width:C,height:z};if(z&&C){var K=a.getScene(),N=null;K.activeCamera!==a&&(N=K.activeCamera,K.activeCamera=a);var T=b.getRenderingCanvas();if(T){var Z={width:T.width,height:T.height};b.setSize(C,z),K.render();var _=new Jb("screenShot",J,K,!1,!1,p.a.TEXTURETYPE_UNSIGNED_INT,!1,ya.a.NEAREST_SAMPLINGMODE);_.renderList=null,_.samples=g,_.renderSprites=m,_.onAfterRenderObservable.add(function(){Qa.b.DumpFramebuffer(C,z,b,d,f,j)});var ca=function(){K.incrementRenderId(),K.resetCachedMaterial(),_.render(!0),_.dispose(),N&&(K.activeCamera=N),b.setSize(Z.width,Z.height),a.getProjectionMatrix(!0)};if(h){var ea=new Ff("antialiasing",1,K.activeCamera);_.addPostProcess(ea),ea.getEffect().isReady()?ca():ea.getEffect().onCompiled=function(){ca()}}else ca()}else k.a.Error("No rendering canvas found !")}else k.a.Error("Invalid 'size' parameter !")},e.CreateScreenshotUsingRenderTargetAsync=function(b,a,c,d,f,g,h,j){return void 0===d&&(d="image/png"),void 0===f&&(f=1),void 0===g&&(g=!1),void 0===j&&(j=!1),new Promise(function(m,w){e.CreateScreenshotUsingRenderTarget(b,a,c,function(z){void 0!==z?m(z):w(new Error("Data is undefined"))},d,f,g,h,j)})},e._getScreenshotSize=function(b,a,c){var d=0,f=0;if("object"==typeof c){var g=c.precision?Math.abs(c.precision):1;c.width&&c.height?(d=c.height*g,f=c.width*g):c.width&&!c.height?(f=c.width*g,d=Math.round(f/b.getAspectRatio(a))):c.height&&!c.width?(d=c.height*g,f=Math.round(d*b.getAspectRatio(a))):(f=Math.round(b.getRenderWidth()*g),d=Math.round(f/b.getAspectRatio(a)))}else isNaN(c)||(d=c,f=c);return f&&(f=Math.floor(f)),d&&(d=Math.floor(d)),{height:0|d,width:0|f}},e}();Qa.b.CreateScreenshot=Oe.CreateScreenshot,Qa.b.CreateScreenshotAsync=Oe.CreateScreenshotAsync,Qa.b.CreateScreenshotUsingRenderTarget=Oe.CreateScreenshotUsingRenderTarget,Qa.b.CreateScreenshotUsingRenderTargetAsync=Oe.CreateScreenshotUsingRenderTargetAsync,function(e){e[e.Checkbox=0]="Checkbox",e[e.Slider=1]="Slider",e[e.Vector3=2]="Vector3",e[e.Quaternion=3]="Quaternion",e[e.Color3=4]="Color3",e[e.String=5]="String"}(uh||(uh={}));var Hp=o(126),Ip=function(){function e(b){this.byteOffset=0,this.buffer=b}return e.prototype.loadAsync=function(b){var a=this;return delete this._dataView,delete this._dataByteOffset,this.buffer.readAsync(this.byteOffset,b).then(function(c){a._dataView=new DataView(c.buffer,c.byteOffset,c.byteLength),a._dataByteOffset=0})},e.prototype.readUint32=function(){var b=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,b},e.prototype.readUint8Array=function(b){var a=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,b);return this._dataByteOffset+=b,this.byteOffset+=b,a},e.prototype.readString=function(b){return oc.a.Decode(this.readUint8Array(b))},e.prototype.skipBytes=function(b){this._dataByteOffset+=b,this.byteOffset+=b},e}(),Pe=function(e){function b(a,c){void 0===c&&(c={});var d=e.call(this,a)||this;return d.options=c,d._direction=new i.e(0,0,-1),d._mat=new i.a(),d._onSelectEnabled=!1,d._origin=new i.e(0,0,0),d.lastNativeXRHitResults=[],d.onHitTestResultObservable=new I.c(),d._onHitTestResults=function(f){var g=f.map(function(h){var j=i.a.FromArray(h.hitMatrix);return d._xrSessionManager.scene.useRightHandedSystem||j.toggleModelMatrixHandInPlace(),d.options.worldParentNode&&j.multiplyToRef(d.options.worldParentNode.getWorldMatrix(),j),{xrHitResult:h,transformationMatrix:j}});d.lastNativeXRHitResults=f,d.onHitTestResultObservable.notifyObservers(g)},d._onSelect=function(f){d._onSelectEnabled&&b.XRHitTestWithSelectEvent(f,d._xrSessionManager.referenceSpace)},d}return Object(l.d)(b,e),b.XRHitTestWithRay=function(a,c,d,f){return a.requestHitTest(c,d).then(function(g){var h=f||function(j){return!!j.hitMatrix};return g.filter(h)})},b.XRHitTestWithSelectEvent=function(a,c){var d=a.frame.getPose(a.inputSource.targetRaySpace,c);if(!d)return Promise.resolve([]);var f=new XRRay(d.transform);return this.XRHitTestWithRay(a.frame.session,f,c)},b.prototype.attach=function(){return!!e.prototype.attach.call(this)&&(this.options.testOnPointerDownOnly&&this._xrSessionManager.session.addEventListener("select",this._onSelect,!1),!0)},b.prototype.detach=function(){return!!e.prototype.detach.call(this)&&(this._onSelectEnabled=!1,this._xrSessionManager.session.removeEventListener("select",this._onSelect),!0)},b.prototype.dispose=function(){e.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},b.prototype._onXRFrame=function(a){if(this.attached&&!this.options.testOnPointerDownOnly){var c=a.getViewerPose(this._xrSessionManager.referenceSpace);if(c){i.a.FromArrayToRef(c.transform.matrix,0,this._mat),i.e.TransformCoordinatesFromFloatsToRef(0,0,0,this._mat,this._origin),i.e.TransformCoordinatesFromFloatsToRef(0,0,-1,this._mat,this._direction),this._direction.subtractInPlace(this._origin),this._direction.normalize();var d=new XRRay({x:this._origin.x,y:this._origin.y,z:this._origin.z,w:0},{x:this._direction.x,y:this._direction.y,z:this._direction.z,w:0});b.XRHitTestWithRay(this._xrSessionManager.session,d,this._xrSessionManager.referenceSpace).then(this._onHitTestResults)}}},b.Name=$c.HIT_TEST,b.Version=1,b}(qd);ad.AddWebXRFeature(Pe.Name,function(e,b){return function(){return new Pe(e,b)}},Pe.Version,!0);var Jp=0,Kp=function(e){function b(a,c){void 0===c&&(c={});var d=e.call(this,a)||this;return d._options=c,d._enabled=!1,d._lastFrameDetected=new Set(),d._onSelect=function(f){if(d._options.addAnchorOnSelect){var g=function(h){if(h.length){var j=h[0],m=new XRRigidTransform(j.hitMatrix);d.addAnchorAtRigidTransformation(m)}};d._hitTestModule&&!d._hitTestModule.options.testOnPointerDownOnly&&g(d._hitTestModule.lastNativeXRHitResults),Pe.XRHitTestWithSelectEvent(f,d._xrSessionManager.referenceSpace).then(g),d._planeDetector}},d._trackedAnchors=[],d.onAnchorAddedObservable=new I.c(),d.onAnchorRemovedObservable=new I.c(),d.onAnchorUpdatedObservable=new I.c(),d}return Object(l.d)(b,e),b.prototype.addAnchorAtRigidTransformation=function(a,c){return(c||this._xrSessionManager.session).createAnchor(a,this._xrSessionManager.referenceSpace)},b.prototype.attach=function(){return!!e.prototype.attach.call(this)&&(this._options.addAnchorOnSelect&&this._xrSessionManager.session.addEventListener("select",this._onSelect,!1),!0)},b.prototype.detach=function(){return!!e.prototype.detach.call(this)&&(this._xrSessionManager.session.removeEventListener("select",this._onSelect),!0)},b.prototype.dispose=function(){e.prototype.dispose.call(this),this.onAnchorAddedObservable.clear(),this.onAnchorRemovedObservable.clear(),this.onAnchorUpdatedObservable.clear()},b.prototype.setHitTestModule=function(a){this._hitTestModule=a},b.prototype.setPlaneDetector=function(a,c){void 0===c&&(c=!0),this._planeDetector=a,this._options.usePlaneDetection=c},b.prototype._onXRFrame=function(a){var c=this;if(this.attached&&this._enabled&&a){var d=a.trackedAnchors;d&&d.size&&(this._trackedAnchors.filter(function(f){return!d.has(f.xrAnchor)}).map(function(f){var g=c._trackedAnchors.indexOf(f);c._trackedAnchors.splice(g,1),c.onAnchorRemovedObservable.notifyObservers(f)}),d.forEach(function(f){if(c._lastFrameDetected.has(f)){if(f.lastChangedTime===c._xrSessionManager.currentTimestamp){var g=c._findIndexInAnchorArray(f),h=c._trackedAnchors[g];c._updateAnchorWithXRFrame(f,h,a),c.onAnchorUpdatedObservable.notifyObservers(h)}}else{var j={id:Jp++,xrAnchor:f},m=c._updateAnchorWithXRFrame(f,j,a);c._trackedAnchors.push(m),c.onAnchorAddedObservable.notifyObservers(m)}}),this._lastFrameDetected=d)}},b.prototype._findIndexInAnchorArray=function(a){for(var c=0;c<this._trackedAnchors.length;++c)if(this._trackedAnchors[c].xrAnchor===a)return c;return-1},b.prototype._updateAnchorWithXRFrame=function(a,c,d){var f=d.getPose(a.anchorSpace,this._xrSessionManager.referenceSpace);if(f){var g=c.transformationMatrix||new i.a();i.a.FromArrayToRef(f.transform.matrix,0,g),this._xrSessionManager.scene.useRightHandedSystem||g.toggleModelMatrixHandInPlace(),c.transformationMatrix=g,this._options.worldParentNode&&g.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),g)}return c},b.Name=$c.ANCHOR_SYSTEM,b.Version=1,b}(qd),Lp=0,Nf=function(e){function b(a,c){void 0===c&&(c={});var d=e.call(this,a)||this;return d._options=c,d._detectedPlanes=[],d._enabled=!1,d._lastFrameDetected=new Set(),d.onPlaneAddedObservable=new I.c(),d.onPlaneRemovedObservable=new I.c(),d.onPlaneUpdatedObservable=new I.c(),d._xrSessionManager.session?d._init():d._xrSessionManager.onXRSessionInit.addOnce(function(){d._init()}),d}return Object(l.d)(b,e),b.prototype.dispose=function(){e.prototype.dispose.call(this),this.onPlaneAddedObservable.clear(),this.onPlaneRemovedObservable.clear(),this.onPlaneUpdatedObservable.clear()},b.prototype._onXRFrame=function(a){var c=this;if(this.attached&&this._enabled&&a){var d=a.worldInformation.detectedPlanes;d&&d.size&&(this._detectedPlanes.filter(function(f){return!d.has(f.xrPlane)}).map(function(f){var g=c._detectedPlanes.indexOf(f);c._detectedPlanes.splice(g,1),c.onPlaneRemovedObservable.notifyObservers(f)}),d.forEach(function(f){if(c._lastFrameDetected.has(f)){if(f.lastChangedTime===c._xrSessionManager.currentTimestamp){var g=c.findIndexInPlaneArray(f);j=c._detectedPlanes[g],c._updatePlaneWithXRPlane(f,j,a),c.onPlaneUpdatedObservable.notifyObservers(j)}}else{var h={id:Lp++,xrPlane:f,polygonDefinition:[]},j=c._updatePlaneWithXRPlane(f,h,a);c._detectedPlanes.push(j),c.onPlaneAddedObservable.notifyObservers(j)}}),this._lastFrameDetected=d)}},b.prototype._init=function(){this._xrSessionManager.session.updateWorldTrackingState&&(this._xrSessionManager.session.updateWorldTrackingState({planeDetectionState:{enabled:!0}}),this._enabled=!0,this._detectedPlanes.length&&(this._detectedPlanes=[]))},b.prototype._updatePlaneWithXRPlane=function(a,c,d){var f=this;c.polygonDefinition=a.polygon.map(function(j){var m=f._xrSessionManager.scene.useRightHandedSystem?1:-1;return new i.e(j.x,j.y,j.z*m)});var g=d.getPose(a.planeSpace,this._xrSessionManager.referenceSpace);if(g){var h=c.transformationMatrix||new i.a();i.a.FromArrayToRef(g.transform.matrix,0,h),this._xrSessionManager.scene.useRightHandedSystem||h.toggleModelMatrixHandInPlace(),c.transformationMatrix=h,this._options.worldParentNode&&h.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),h)}return c},b.prototype.findIndexInPlaneArray=function(a){for(var c=0;c<this._detectedPlanes.length;++c)if(this._detectedPlanes[c].xrPlane===a)return c;return-1},b.Name=$c.PLANE_DETECTION,b.Version=1,b}(qd);ad.AddWebXRFeature(Nf.Name,function(e,b){return function(){return new Nf(e,b)}},Nf.Version);var Of=function(e){function b(a,c){void 0===c&&(c={});var d=e.call(this,a)||this;return d.options=c,d.onBackgroundStateChangedObservable=new I.c(),d}return Object(l.d)(b,e),b.prototype.attach=function(){return this._setBackgroundState(!1),e.prototype.attach.call(this)},b.prototype.detach=function(){return this._setBackgroundState(!0),e.prototype.detach.call(this)},b.prototype.dispose=function(){e.prototype.dispose.call(this),this.onBackgroundStateChangedObservable.clear()},b.prototype._onXRFrame=function(a){},b.prototype._setBackgroundState=function(a){var c=this._xrSessionManager.scene;if(!this.options.ignoreEnvironmentHelper)if(this.options.environmentHelperRemovalFlags){if(this.options.environmentHelperRemovalFlags.skyBox){var d=c.getMeshByName("BackgroundSkybox");d&&d.setEnabled(a)}if(this.options.environmentHelperRemovalFlags.ground){var f=c.getMeshByName("BackgroundPlane");f&&f.setEnabled(a)}}else{var g=c.getMeshByName("BackgroundHelper");g&&g.setEnabled(a)}this.options.backgroundMeshes&&this.options.backgroundMeshes.forEach(function(h){return h.setEnabled(a)}),this.onBackgroundStateChangedObservable.notifyObservers(a)},b.Name=$c.BACKGROUND_REMOVER,b.Version=1,b}(qd);ad.AddWebXRFeature(Of.Name,function(e,b){return function(){return new Of(e,b)}},Of.Version,!0);var Mp=function(){},Pf=function(e){function b(a,c){var d=e.call(this,a)||this;return d._options=c,d._attachController=function(f){if(!d._controllers[f.uniqueId])if(d._xrSessionManager.scene.isPhysicsEnabled()||k.a.Warn("physics engine not enabled, skipped. Please add this controller manually."),d._options.physicsProperties.useControllerMesh)f.onMotionControllerInitObservable.addOnce(function(z){z.onModelLoadedObservable.addOnce(function(){var C=new ob.a(z.rootMesh,ob.a.MeshImpostor,Object(l.a)({mass:0},d._options.physicsProperties)),J=f.grip||f.pointer;d._controllers[f.uniqueId]={xrController:f,impostor:C,oldPos:J.position.clone(),oldRotation:J.rotationQuaternion.clone()}})});else{var g=d._options.physicsProperties.impostorType||ob.a.SphereImpostor,h=d._options.physicsProperties.impostorSize||.1,j=jc.a.CreateSphere("impostor-mesh-"+f.uniqueId,{diameterX:"number"==typeof h?h:h.width,diameterY:"number"==typeof h?h:h.height,diameterZ:"number"==typeof h?h:h.depth});j.isVisible=d._debugMode,j.isPickable=!1,j.rotationQuaternion=new i.b();var m=f.grip||f.pointer;j.position.copyFrom(m.position),j.rotationQuaternion.copyFrom(m.rotationQuaternion);var w=new ob.a(j,g,Object(l.a)({mass:0},d._options.physicsProperties));d._controllers[f.uniqueId]={xrController:f,impostor:w,impostorMesh:j}}},d._controllers={},d._debugMode=!1,d._delta=0,d._lastTimestamp=0,d._tmpQuaternion=new i.b(),d._tmpVector=new i.e(),d._options.physicsProperties||(d._options.physicsProperties={}),d}return Object(l.d)(b,e),b.prototype._enablePhysicsDebug=function(){var a=this;this._debugMode=!0,Object.keys(this._controllers).forEach(function(c){var d=a._controllers[c];d.impostorMesh&&(d.impostorMesh.isVisible=!0)})},b.prototype.addController=function(a){this._attachController(a)},b.prototype.attach=function(){var a=this;if(!e.prototype.attach.call(this))return!1;if(!this._options.xrInput)return!0;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(f){a._detachController(f.uniqueId)}),this._options.enableHeadsetImpostor){var c=this._options.headsetImpostorParams||{impostorType:ob.a.SphereImpostor,restitution:.8,impostorSize:.3},d=c.impostorSize||.3;this._headsetMesh=jc.a.CreateSphere("headset-mesh",{diameterX:"number"==typeof d?d:d.width,diameterY:"number"==typeof d?d:d.height,diameterZ:"number"==typeof d?d:d.depth}),this._headsetMesh.rotationQuaternion=new i.b(),this._headsetMesh.isVisible=!1,this._headsetImpostor=new ob.a(this._headsetMesh,c.impostorType,Object(l.a)({mass:0},c))}return!0},b.prototype.detach=function(){var a=this;return!!e.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(c){a._detachController(c)}),this._headsetMesh&&this._headsetMesh.dispose(),!0)},b.prototype.getHeadsetImpostor=function(){return this._headsetImpostor},b.prototype.getImpostorForController=function(a){var c="string"==typeof a?a:a.uniqueId;return this._controllers[c]?this._controllers[c].impostor:null},b.prototype.setPhysicsProperties=function(a){this._options.physicsProperties=Object(l.a)(Object(l.a)({},this._options.physicsProperties),a)},b.prototype._onXRFrame=function(a){var c=this;this._delta=this._xrSessionManager.currentTimestamp-this._lastTimestamp,this._lastTimestamp=this._xrSessionManager.currentTimestamp,this._headsetMesh&&(this._headsetMesh.position.copyFrom(this._options.xrInput.xrCamera.position),this._headsetMesh.rotationQuaternion.copyFrom(this._options.xrInput.xrCamera.rotationQuaternion)),Object.keys(this._controllers).forEach(function(d){var f=c._controllers[d],g=f.xrController.grip||f.xrController.pointer,h=f.oldPos||f.impostorMesh.position,j=f.oldRotation||f.impostorMesh.rotationQuaternion;if(g.position.subtractToRef(h,c._tmpVector),c._tmpVector.scaleInPlace(1000/c._delta),f.impostor.setLinearVelocity(c._tmpVector),c._debugMode&&console.log(c._tmpVector,"linear"),!j.equalsWithEpsilon(g.rotationQuaternion)){j.conjugateInPlace().multiplyToRef(g.rotationQuaternion,c._tmpQuaternion);var m=Math.sqrt(c._tmpQuaternion.x*c._tmpQuaternion.x+c._tmpQuaternion.y*c._tmpQuaternion.y+c._tmpQuaternion.z*c._tmpQuaternion.z);if(c._tmpVector.set(c._tmpQuaternion.x,c._tmpQuaternion.y,c._tmpQuaternion.z),m<.001)c._tmpVector.scaleInPlace(2);else{var w=2*Math.atan2(m,c._tmpQuaternion.w);c._tmpVector.scaleInPlace(w/(m*(c._delta/1000)))}f.impostor.setAngularVelocity(c._tmpVector),c._debugMode&&console.log(c._tmpVector,c._tmpQuaternion,"angular")}h.copyFrom(g.position),j.copyFrom(g.rotationQuaternion)})},b.prototype._detachController=function(a){var c=this._controllers[a];c&&(c.impostorMesh&&c.impostorMesh.dispose(),delete this._controllers[a])},b.Name=$c.PHYSICS_CONTROLLERS,b.Version=1,b}(qd);ad.AddWebXRFeature(Pf.Name,function(e,b){return function(){return new Pf(e,b)}},Pf.Version,!0);var Al=function(e){function b(a,c,d){var f=e.call(this,a,Np["left-right"],c,d)||this;return f._mapping={defaultButton:{valueNodeName:"VALUE",unpressedNodeName:"UNPRESSED",pressedNodeName:"PRESSED"},defaultAxis:{valueNodeName:"VALUE",minNodeName:"MIN",maxNodeName:"MAX"},buttons:{"xr-standard-trigger":{rootNodeName:"SELECT",componentProperty:"button",states:["default","touched","pressed"]},"xr-standard-squeeze":{rootNodeName:"GRASP",componentProperty:"state",states:["pressed"]},"xr-standard-touchpad":{rootNodeName:"TOUCHPAD_PRESS",labelAnchorNodeName:"squeeze-label",touchPointNodeName:"TOUCH"},"xr-standard-thumbstick":{rootNodeName:"THUMBSTICK_PRESS",componentProperty:"state",states:["pressed"]}},axes:{"xr-standard-touchpad":{"x-axis":{rootNodeName:"TOUCHPAD_TOUCH_X"},"y-axis":{rootNodeName:"TOUCHPAD_TOUCH_Y"}},"xr-standard-thumbstick":{"x-axis":{rootNodeName:"THUMBSTICK_X"},"y-axis":{rootNodeName:"THUMBSTICK_Y"}}}},f.profileId="microsoft-mixed-reality",f}return Object(l.d)(b,e),b.prototype._getFilenameAndPath=function(){return{filename:"left"===this.handness?b.MODEL_LEFT_FILENAME:b.MODEL_RIGHT_FILENAME,path:b.MODEL_BASE_URL+"default/"}},b.prototype._getModelLoadingConstraints=function(){var a=yb.IsPluginForExtensionAvailable(".glb");return a||k.a.Warn("glTF / glb loaded was not registered, using generic controller instead"),a},b.prototype._processLoadedModel=function(a){var c=this;this.rootMesh&&(this.getComponentIds().forEach(function(d,f){if(!c.disableAnimation&&d&&c.rootMesh){var g=c._mapping.buttons[d],h=g.rootNodeName;if(!h)return void k.a.Log("Skipping unknown button at index: "+f+" with mapped name: "+d);var j=c._getChildByName(c.rootMesh,h);if(!j)return void k.a.Warn("Missing button mesh with name: "+h);if(g.valueMesh=c._getImmediateChildByName(j,c._mapping.defaultButton.valueNodeName),g.pressedMesh=c._getImmediateChildByName(j,c._mapping.defaultButton.pressedNodeName),g.unpressedMesh=c._getImmediateChildByName(j,c._mapping.defaultButton.unpressedNodeName),g.valueMesh&&g.pressedMesh&&g.unpressedMesh){var m=c.getComponent(d);m&&m.onButtonStateChangedObservable.add(function(w){c._lerpTransform(g,w.value)},void 0,!0)}else k.a.Warn("Missing button submesh under mesh with name: "+h)}}),this.getComponentIds().forEach(function(d,f){var g=c.getComponent(d);g.isAxes()&&["x-axis","y-axis"].forEach(function(h){if(c.rootMesh){var j=c._mapping.axes[d][h],m=c._getChildByName(c.rootMesh,j.rootNodeName);m?(j.valueMesh=c._getImmediateChildByName(m,c._mapping.defaultAxis.valueNodeName),j.minMesh=c._getImmediateChildByName(m,c._mapping.defaultAxis.minNodeName),j.maxMesh=c._getImmediateChildByName(m,c._mapping.defaultAxis.maxNodeName),j.valueMesh&&j.minMesh&&j.maxMesh?g&&g.onAxisValueChangedObservable.add(function(w){var z="x-axis"===h?w.x:w.y;c._lerpTransform(j,z,!0)},void 0,!0):k.a.Warn("Missing axis submesh under mesh with name: "+j.rootNodeName)):k.a.Warn("Missing axis mesh with name: "+j.rootNodeName)}})}))},b.prototype._setRootMesh=function(a){var c;this.rootMesh=new xa.a(this.profileId+" "+this.handness,this.scene),this.rootMesh.isPickable=!1;for(var d=0;d<a.length;d++){var f=a[d];f.isPickable=!1,f.parent||(c=f)}c&&c.setParent(this.rootMesh),this.rootMesh.rotationQuaternion=i.b.FromEulerAngles(0,Math.PI,0)},b.prototype._updateModel=function(){},b.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",b.MODEL_LEFT_FILENAME="left.glb",b.MODEL_RIGHT_FILENAME="right.glb",b}(Rd);qc.RegisterController("windows-mixed-reality",function(e,b){return new Al(b,e.gamepad,e.handedness)});var Np={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-right",assetPath:"right.glb"}},zh=function(e){function b(a,c,d,f,g){void 0===f&&(f=!1),void 0===g&&(g=!1);var h=e.call(this,a,Op[d],c,d)||this;return h._forceLegacyControllers=g,h.profileId="oculus-touch",h}return Object(l.d)(b,e),b.prototype._getFilenameAndPath=function(){return{filename:"left"===this.handness?b.MODEL_LEFT_FILENAME:b.MODEL_RIGHT_FILENAME,path:this._isQuest()?b.QUEST_MODEL_BASE_URL:b.MODEL_BASE_URL}},b.prototype._getModelLoadingConstraints=function(){return!0},b.prototype._processLoadedModel=function(a){var c=this,d=this._isQuest(),f="right"===this.handness?-1:1;this.getComponentIds().forEach(function(g){var h=g&&c.getComponent(g);h&&h.onButtonStateChangedObservable.add(function(j){if(c.rootMesh&&!c.disableAnimation)switch(g){case"xr-standard-trigger":return void(d||(c._modelRootNode.getChildren()[3].rotation.x=.2*-j.value,c._modelRootNode.getChildren()[3].position.y=.005*-j.value,c._modelRootNode.getChildren()[3].position.z=.005*-j.value));case"xr-standard-squeeze":return void(d||(c._modelRootNode.getChildren()[4].position.x=f*j.value*.0035));case"xr-standard-thumbstick":return;case"a-button":case"x-button":return void(d||(j.pressed?c._modelRootNode.getChildren()[1].position.y=-.001:c._modelRootNode.getChildren()[1].position.y=0));case"b-button":case"y-button":return void(d||(j.pressed?c._modelRootNode.getChildren()[2].position.y=-.001:c._modelRootNode.getChildren()[2].position.y=0))}},void 0,!0)})},b.prototype._setRootMesh=function(a){this.rootMesh=new xa.a(this.profileId+" "+this.handness,this.scene),this.rootMesh.rotationQuaternion=i.b.FromEulerAngles(0,Math.PI,0),a.forEach(function(c){c.isPickable=!1}),this._isQuest()?this._modelRootNode=a[0]:(this._modelRootNode=a[1],this.rootMesh.position.y=.034,this.rootMesh.position.z=.052),this._modelRootNode.parent=this.rootMesh},b.prototype._updateModel=function(){},b.prototype._isQuest=function(){return!!navigator.userAgent.match(/Quest/gi)&&!this._forceLegacyControllers},b.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",b.MODEL_LEFT_FILENAME="left.babylon",b.MODEL_RIGHT_FILENAME="right.babylon",b.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",b}(Rd);qc.RegisterController("oculus-touch",function(e,b){return new zh(b,e.gamepad,e.handedness)}),qc.RegisterController("oculus-touch-legacy",function(e,b){return new zh(b,e.gamepad,e.handedness,!0)});var Op={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"x-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"x_button",visualResponses:{}},"y-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"y_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"a-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"a_button",visualResponses:{}},"b-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"b_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-right",assetPath:"right.glb"}},Bl=function(e){function b(a,c,d){var f=e.call(this,a,Pp[d],c,d)||this;return f.profileId="htc-vive",f}return Object(l.d)(b,e),b.prototype._getFilenameAndPath=function(){return{filename:b.MODEL_FILENAME,path:b.MODEL_BASE_URL}},b.prototype._getModelLoadingConstraints=function(){return!0},b.prototype._processLoadedModel=function(a){var c=this;this.getComponentIds().forEach(function(d){var f=d&&c.getComponent(d);f&&f.onButtonStateChangedObservable.add(function(g){if(c.rootMesh&&!c.disableAnimation)switch(d){case"xr-standard-trigger":return void(c._modelRootNode.getChildren()[6].rotation.x=.15*-g.value);case"xr-standard-touchpad":case"xr-standard-squeeze":return}},void 0,!0)})},b.prototype._setRootMesh=function(a){this.rootMesh=new xa.a(this.profileId+" "+this.handness,this.scene),a.forEach(function(c){c.isPickable=!1}),this._modelRootNode=a[1],this._modelRootNode.parent=this.rootMesh,this.rootMesh.rotationQuaternion=i.b.FromEulerAngles(0,Math.PI,0)},b.prototype._updateModel=function(){},b.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",b.MODEL_FILENAME="wand.babylon",b}(Rd);qc.RegisterController("htc-vive",function(e,b){return new Bl(b,e.gamepad,e.handedness)});var Pp={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc-vive-none",assetPath:"none.glb"}};o.d(t,"AbstractScene",function(){return R.a}),o.d(t,"AbstractActionManager",function(){return r.a}),o.d(t,"Action",function(){return E}),o.d(t,"ActionEvent",function(){return x.a}),o.d(t,"ActionManager",function(){return ga}),o.d(t,"Condition",function(){return s}),o.d(t,"ValueCondition",function(){return y}),o.d(t,"PredicateCondition",function(){return q}),o.d(t,"StateCondition",function(){return n}),o.d(t,"SwitchBooleanAction",function(){return u}),o.d(t,"SetStateAction",function(){return A}),o.d(t,"SetValueAction",function(){return B}),o.d(t,"IncrementValueAction",function(){return v}),o.d(t,"PlayAnimationAction",function(){return H}),o.d(t,"StopAnimationAction",function(){return L}),o.d(t,"DoNothingAction",function(){return Q}),o.d(t,"CombineAction",function(){return M}),o.d(t,"ExecuteCodeAction",function(){return Y}),o.d(t,"SetParentAction",function(){return X}),o.d(t,"PlaySoundAction",function(){return ma}),o.d(t,"StopSoundAction",function(){return oa}),o.d(t,"InterpolateValueAction",function(){return O}),o.d(t,"Animatable",function(){return db}),o.d(t,"_IAnimationState",function(){return qa}),o.d(t,"Animation",function(){return V}),o.d(t,"TargetedAnimation",function(){return Ya}),o.d(t,"AnimationGroup",function(){return Sa}),o.d(t,"AnimationPropertiesOverride",function(){return sb}),o.d(t,"EasingFunction",function(){return Fb}),o.d(t,"CircleEase",function(){return gd}),o.d(t,"BackEase",function(){return hd}),o.d(t,"BounceEase",function(){return Ed}),o.d(t,"CubicEase",function(){return Cl}),o.d(t,"ElasticEase",function(){return Dl}),o.d(t,"ExponentialEase",function(){return Bh}),o.d(t,"PowerEase",function(){return El}),o.d(t,"QuadraticEase",function(){return Fl}),o.d(t,"QuarticEase",function(){return Gl}),o.d(t,"QuinticEase",function(){return Hl}),o.d(t,"SineEase",function(){return Sf}),o.d(t,"BezierCurveEase",function(){return Il}),o.d(t,"RuntimeAnimation",function(){return Ca}),o.d(t,"AnimationEvent",function(){return Jl}),o.d(t,"AnimationKeyInterpolation",function(){return ja}),o.d(t,"AnimationRange",function(){return $}),o.d(t,"KeepAssets",function(){return Ch}),o.d(t,"InstantiatedEntries",function(){return Dh}),o.d(t,"AssetContainer",function(){return Eh}),o.d(t,"Analyser",function(){return Kl}),o.d(t,"AudioEngine",function(){return Fh}),o.d(t,"AudioSceneComponent",function(){return uc}),o.d(t,"Sound",function(){return oe}),o.d(t,"SoundTrack",function(){return Gh}),o.d(t,"WeightedSound",function(){return Ll}),o.d(t,"AutoRotationBehavior",function(){return Hh}),o.d(t,"BouncingBehavior",function(){return Ih}),o.d(t,"FramingBehavior",function(){return Jh}),o.d(t,"AttachToBoxBehavior",function(){return Ml}),o.d(t,"FadeInOutBehavior",function(){return Nl}),o.d(t,"MultiPointerScaleBehavior",function(){return Ol}),o.d(t,"PointerDragBehavior",function(){return Hc.a}),o.d(t,"SixDofDragBehavior",function(){return Kh}),o.d(t,"Bone",function(){return Na}),o.d(t,"BoneIKController",function(){return Pl}),o.d(t,"BoneLookController",function(){return Ql}),o.d(t,"Skeleton",function(){return Tf}),o.d(t,"CameraInputTypes",function(){return Qb}),o.d(t,"CameraInputsManager",function(){return pe}),o.d(t,"Camera",function(){return hb.a}),o.d(t,"TargetCamera",function(){return Uc}),o.d(t,"FreeCamera",function(){return nc}),o.d(t,"FreeCameraInputsManager",function(){return qe}),o.d(t,"TouchCamera",function(){return jg}),o.d(t,"ArcRotateCamera",function(){return jd}),o.d(t,"ArcRotateCameraInputsManager",function(){return We}),o.d(t,"DeviceOrientationCamera",function(){return Xe}),o.d(t,"FlyCamera",function(){return Sl}),o.d(t,"FlyCameraInputsManager",function(){return Qh}),o.d(t,"FollowCamera",function(){return Sh}),o.d(t,"ArcFollowCamera",function(){return Th}),o.d(t,"FollowCameraInputsManager",function(){return Rh}),o.d(t,"GamepadCamera",function(){return Ye}),o.d(t,"UniversalCamera",function(){return Hd}),o.d(t,"VirtualJoysticksCamera",function(){return hi}),o.d(t,"ArcRotateCameraGamepadInput",function(){return Uf}),o.d(t,"ArcRotateCameraKeyboardMoveInput",function(){return Vf}),o.d(t,"ArcRotateCameraMouseWheelInput",function(){return Wf}),o.d(t,"ArcRotateCameraPointersInput",function(){return Xf}),o.d(t,"ArcRotateCameraVRDeviceOrientationInput",function(){return Yf}),o.d(t,"FlyCameraKeyboardInput",function(){return Zf}),o.d(t,"FlyCameraMouseInput",function(){return _f}),o.d(t,"FollowCameraKeyboardMoveInput",function(){return $f}),o.d(t,"FollowCameraMouseWheelInput",function(){return ag}),o.d(t,"FollowCameraPointersInput",function(){return bg}),o.d(t,"FreeCameraDeviceOrientationInput",function(){return fg}),o.d(t,"FreeCameraGamepadInput",function(){return gg}),o.d(t,"FreeCameraKeyboardMoveInput",function(){return cg}),o.d(t,"FreeCameraMouseInput",function(){return dg}),o.d(t,"FreeCameraTouchInput",function(){return eg}),o.d(t,"FreeCameraVirtualJoystickInput",function(){return ig}),o.d(t,"AnaglyphArcRotateCamera",function(){return _h}),o.d(t,"AnaglyphFreeCamera",function(){return $h}),o.d(t,"AnaglyphGamepadCamera",function(){return ai}),o.d(t,"AnaglyphUniversalCamera",function(){return bi}),o.d(t,"StereoscopicArcRotateCamera",function(){return di}),o.d(t,"StereoscopicFreeCamera",function(){return ei}),o.d(t,"StereoscopicGamepadCamera",function(){return fi}),o.d(t,"StereoscopicUniversalCamera",function(){return gi}),o.d(t,"VRCameraMetrics",function(){return Id}),o.d(t,"VRDeviceOrientationArcRotateCamera",function(){return li}),o.d(t,"VRDeviceOrientationFreeCamera",function(){return Ze}),o.d(t,"VRDeviceOrientationGamepadCamera",function(){return mi}),o.d(t,"OnAfterEnteringVRObservableEvent",function(){return cm}),o.d(t,"VRExperienceHelper",function(){return ri}),o.d(t,"WebVRFreeCamera",function(){return $e}),o.d(t,"Collider",function(){return si}),o.d(t,"DefaultCollisionCoordinator",function(){return ti}),o.d(t,"PickingInfo",function(){return nd.a}),o.d(t,"IntersectionInfo",function(){return dm.a}),o.d(t,"_MeshCollisionData",function(){return em.a}),o.d(t,"BoundingBox",function(){return qg.a}),o.d(t,"BoundingInfo",function(){return Kc.a}),o.d(t,"BoundingSphere",function(){return ui.a}),o.d(t,"Ray",function(){return Rb.a}),o.d(t,"Octree",function(){return se}),o.d(t,"OctreeBlock",function(){return vi}),o.d(t,"OctreeSceneComponent",function(){return rg}),o.d(t,"AxesViewer",function(){return od.AxesViewer}),o.d(t,"BoneAxesViewer",function(){return od.BoneAxesViewer}),o.d(t,"DebugLayerTab",function(){return od.DebugLayerTab}),o.d(t,"DebugLayer",function(){return od.DebugLayer}),o.d(t,"PhysicsViewer",function(){return od.PhysicsViewer}),o.d(t,"RayHelper",function(){return od.RayHelper}),o.d(t,"SkeletonViewer",function(){return od.SkeletonViewer}),o.d(t,"Constants",function(){return p.a}),o.d(t,"ThinEngine",function(){return Cb.a}),o.d(t,"Engine",function(){return Ha.a}),o.d(t,"EngineStore",function(){return U.a}),o.d(t,"NullEngineOptions",function(){return wi.b}),o.d(t,"NullEngine",function(){return wi.a}),o.d(t,"WebGLPipelineContext",function(){return gm.a}),o.d(t,"WebGL2ShaderProcessor",function(){return zi.a}),o.d(t,"NativeEngine",function(){return pm}),o.d(t,"_OcclusionDataStorage",function(){return yi}),o.d(t,"_forceTransformFeedbackToBundle",function(){return!0}),o.d(t,"EngineView",function(){return fm}),o.d(t,"KeyboardEventTypes",function(){return id.a}),o.d(t,"KeyboardInfo",function(){return id.b}),o.d(t,"KeyboardInfoPre",function(){return id.c}),o.d(t,"PointerEventTypes",function(){return lb.a}),o.d(t,"PointerInfoBase",function(){return lb.c}),o.d(t,"PointerInfoPre",function(){return lb.d}),o.d(t,"PointerInfo",function(){return lb.b}),o.d(t,"ClipboardEventTypes",function(){return df}),o.d(t,"ClipboardInfo",function(){return qm}),o.d(t,"StickValues",function(){return Rl}),o.d(t,"Gamepad",function(){return Pb}),o.d(t,"GenericPad",function(){return Nh}),o.d(t,"GamepadManager",function(){return Wh}),o.d(t,"GamepadSystemSceneComponent",function(){return Xh}),o.d(t,"Xbox360Button",function(){return ac}),o.d(t,"Xbox360Dpad",function(){return kd}),o.d(t,"Xbox360Pad",function(){return Uh}),o.d(t,"DualShockButton",function(){return gc}),o.d(t,"DualShockDpad",function(){return ld}),o.d(t,"DualShockPad",function(){return Vh}),o.d(t,"DaydreamController",function(){return wg}),o.d(t,"GearVRController",function(){return xg}),o.d(t,"GenericController",function(){return ef}),o.d(t,"OculusTouchController",function(){return yg}),o.d(t,"PoseEnabledControllerType",function(){return wc}),o.d(t,"PoseEnabledControllerHelper",function(){return Vc}),o.d(t,"PoseEnabledController",function(){return Gd}),o.d(t,"ViveController",function(){return Ei}),o.d(t,"WebVRController",function(){return Xc}),o.d(t,"WindowsMotionController",function(){return ff}),o.d(t,"XRWindowsMotionController",function(){return sm}),o.d(t,"AxisDragGizmo",function(){return gf.a}),o.d(t,"AxisScaleGizmo",function(){return ve}),o.d(t,"BoundingBoxGizmo",function(){return Fi}),o.d(t,"Gizmo",function(){return Qc.a}),o.d(t,"GizmoManager",function(){return tm}),o.d(t,"PlaneRotationGizmo",function(){return hf}),o.d(t,"PositionGizmo",function(){return Hi}),o.d(t,"RotationGizmo",function(){return Gi}),o.d(t,"ScaleGizmo",function(){return Ii}),o.d(t,"LightGizmo",function(){return um}),o.d(t,"PlaneDragGizmo",function(){return jf}),o.d(t,"EnvironmentHelper",function(){return Dg}),o.d(t,"PhotoDome",function(){return Gm}),o.d(t,"_forceSceneHelpersToBundle",function(){return!0}),o.d(t,"VideoDome",function(){return an}),o.d(t,"EngineInstrumentation",function(){return bn}),o.d(t,"SceneInstrumentation",function(){return cn}),o.d(t,"_TimeToken",function(){return xi}),o.d(t,"EffectLayer",function(){return De}),o.d(t,"EffectLayerSceneComponent",function(){return _i}),o.d(t,"GlowLayer",function(){return rf}),o.d(t,"HighlightLayer",function(){return Jg}),o.d(t,"Layer",function(){return ln}),o.d(t,"LayerSceneComponent",function(){return aj}),o.d(t,"LensFlare",function(){return bj}),o.d(t,"LensFlareSystem",function(){return Kg}),o.d(t,"LensFlareSystemSceneComponent",function(){return cj}),o.d(t,"Light",function(){return Zc.a}),o.d(t,"ShadowLight",function(){return kf}),o.d(t,"DirectionalLight",function(){return Ag}),o.d(t,"HemisphericLight",function(){return _e.a}),o.d(t,"PointLight",function(){return Mg}),o.d(t,"SpotLight",function(){return Bg}),o.d(t,"ShadowGenerator",function(){return lc}),o.d(t,"CascadedShadowGenerator",function(){return Lg}),o.d(t,"ShadowGeneratorSceneComponent",function(){return gj}),o.d(t,"DefaultLoadingScreen",function(){return hj}),o.d(t,"SceneLoaderProgressEvent",function(){return Di}),o.d(t,"SceneLoaderAnimationGroupLoadingMode",function(){return Oc}),o.d(t,"SceneLoader",function(){return yb}),o.d(t,"SceneLoaderFlags",function(){return Pc.a}),o.d(t,"_BabylonLoaderRegistered",function(){return!0}),o.d(t,"BabylonFileLoaderConfiguration",function(){return uf}),o.d(t,"ColorCurves",function(){return wn.a}),o.d(t,"EffectFallbacks",function(){return Nd.a}),o.d(t,"Effect",function(){return Pa.a}),o.d(t,"FresnelParameters",function(){return qj}),o.d(t,"ImageProcessingConfigurationDefines",function(){return Sb.b}),o.d(t,"ImageProcessingConfiguration",function(){return Sb.a}),o.d(t,"Material",function(){return Hb.a}),o.d(t,"MaterialDefines",function(){return mf.a}),o.d(t,"MaterialHelper",function(){return Ua.a}),o.d(t,"MultiMaterial",function(){return Td.a}),o.d(t,"PBRMaterial",function(){return Ae}),o.d(t,"PushMaterial",function(){return nf.a}),o.d(t,"ShaderMaterial",function(){return vf.a}),o.d(t,"StandardMaterialDefines",function(){return Ab.b}),o.d(t,"StandardMaterial",function(){return Ab.a}),o.d(t,"BaseTexture",function(){return hc.a}),o.d(t,"CubeTexture",function(){return pc}),o.d(t,"DynamicTexture",function(){return Bc}),o.d(t,"EquiRectangularCubeTexture",function(){return uj}),o.d(t,"HDRCubeTexture",function(){return Ee}),o.d(t,"InternalTextureSource",function(){return mb.b}),o.d(t,"InternalTexture",function(){return mb.a}),o.d(t,"MirrorTexture",function(){return Cg}),o.d(t,"MultiRenderTarget",function(){return xj}),o.d(t,"RawTexture",function(){return vc}),o.d(t,"RenderTargetTexture",function(){return Jb}),o.d(t,"Texture",function(){return ya.a}),o.d(t,"UniformBuffer",function(){return ii.a}),o.d(t,"MaterialFlags",function(){return cb.a}),o.d(t,"EffectRenderer",function(){return Ln}),o.d(t,"EffectWrapper",function(){return Mn}),o.d(t,"BackgroundMaterial",function(){return Od}),o.d(t,"PBRMaterialDefines",function(){return Fg}),o.d(t,"PBRBaseMaterial",function(){return ec}),o.d(t,"PBRBaseSimpleMaterial",function(){return Sg}),o.d(t,"PBRMetallicRoughnessMaterial",function(){return rj}),o.d(t,"PBRSpecularGlossinessMaterial",function(){return sj}),o.d(t,"ColorGradingTexture",function(){return tj}),o.d(t,"RawCubeTexture",function(){return Cn}),o.d(t,"RawTexture3D",function(){return Dn}),o.d(t,"RawTexture2DArray",function(){return En}),o.d(t,"RefractionTexture",function(){return Fn}),o.d(t,"VideoTexture",function(){return Zi}),o.d(t,"HtmlElementTexture",function(){return Gn}),o.d(t,"NodeMaterialConnectionPointCompatibilityStates",function(){return mc}),o.d(t,"NodeMaterialConnectionPointDirection",function(){return He}),o.d(t,"NodeMaterialConnectionPoint",function(){return Ug}),o.d(t,"NodeMaterialBlock",function(){return ib}),o.d(t,"NodeMaterialDefines",function(){return Bj}),o.d(t,"NodeMaterial",function(){return Cj}),o.d(t,"_DDSTextureLoader",function(){return Ni}),o.d(t,"_ENVTextureLoader",function(){return Oi}),o.d(t,"_KTXTextureLoader",function(){return Qi}),o.d(t,"_TGATextureLoader",function(){return vj}),o.d(t,"_BasisTextureLoader",function(){return wj}),o.d(t,"CustomProceduralTexture",function(){return An}),o.d(t,"NoiseProceduralTexture",function(){return zj}),o.d(t,"ProceduralTexture",function(){return xf}),o.d(t,"ProceduralTextureSceneComponent",function(){return yj}),o.d(t,"TexturePacker",function(){return Hn}),o.d(t,"TexturePackerFrame",function(){return Tg}),o.d(t,"NodeMaterialBlockTargets",function(){return Ia}),o.d(t,"NodeMaterialBlockConnectionPointTypes",function(){return ha}),o.d(t,"NodeMaterialBlockConnectionPointMode",function(){return Vb}),o.d(t,"NodeMaterialSystemValues",function(){return nb}),o.d(t,"MultiplyBlock",function(){return Qj}),o.d(t,"AddBlock",function(){return Rj}),o.d(t,"ScaleBlock",function(){return Sj}),o.d(t,"ClampBlock",function(){return Tj}),o.d(t,"CrossBlock",function(){return Uj}),o.d(t,"DotBlock",function(){return Vj}),o.d(t,"TransformBlock",function(){return yf}),o.d(t,"RemapBlock",function(){return Wj}),o.d(t,"NormalizeBlock",function(){return Xj}),o.d(t,"TrigonometryBlockOperations",function(){return Ib}),o.d(t,"TrigonometryBlock",function(){return Yj}),o.d(t,"ColorMergerBlock",function(){return Zj}),o.d(t,"VectorMergerBlock",function(){return _j}),o.d(t,"ColorSplitterBlock",function(){return $j}),o.d(t,"VectorSplitterBlock",function(){return ak}),o.d(t,"LerpBlock",function(){return bk}),o.d(t,"DivideBlock",function(){return ck}),o.d(t,"SubtractBlock",function(){return dk}),o.d(t,"StepBlock",function(){return ek}),o.d(t,"OneMinusBlock",function(){return Xg}),o.d(t,"ViewDirectionBlock",function(){return Yg}),o.d(t,"FresnelBlock",function(){return fk}),o.d(t,"MaxBlock",function(){return gk}),o.d(t,"MinBlock",function(){return hk}),o.d(t,"DistanceBlock",function(){return ik}),o.d(t,"LengthBlock",function(){return jk}),o.d(t,"NegateBlock",function(){return kk}),o.d(t,"PowBlock",function(){return lk}),o.d(t,"RandomNumberBlock",function(){return mk}),o.d(t,"ArcTan2Block",function(){return nk}),o.d(t,"SmoothStepBlock",function(){return ok}),o.d(t,"ReciprocalBlock",function(){return pk}),o.d(t,"ReplaceColorBlock",function(){return qk}),o.d(t,"PosterizeBlock",function(){return rk}),o.d(t,"WaveBlockKind",function(){return td}),o.d(t,"WaveBlock",function(){return sk}),o.d(t,"GradientBlockColorStep",function(){return zf}),o.d(t,"GradientBlock",function(){return tk}),o.d(t,"NLerpBlock",function(){return uk}),o.d(t,"WorleyNoise3DBlock",function(){return vk}),o.d(t,"SimplexPerlin3DBlock",function(){return wk}),o.d(t,"NormalBlendBlock",function(){return xk}),o.d(t,"Rotate2dBlock",function(){return yk}),o.d(t,"ReflectBlock",function(){return zk}),o.d(t,"RefractBlock",function(){return Ak}),o.d(t,"DesaturateBlock",function(){return Bk}),o.d(t,"NodeMaterialOptimizer",function(){return Kn}),o.d(t,"VertexOutputBlock",function(){return Vg}),o.d(t,"BonesBlock",function(){return Dj}),o.d(t,"InstancesBlock",function(){return Ej}),o.d(t,"MorphTargetsBlock",function(){return Fj}),o.d(t,"LightInformationBlock",function(){return Gj}),o.d(t,"FragmentOutputBlock",function(){return Wg}),o.d(t,"ImageProcessingBlock",function(){return Hj}),o.d(t,"PerturbNormalBlock",function(){return Ij}),o.d(t,"DiscardBlock",function(){return Jj}),o.d(t,"FrontFacingBlock",function(){return Kj}),o.d(t,"DerivativeBlock",function(){return Lj}),o.d(t,"FogBlock",function(){return Mj}),o.d(t,"LightBlock",function(){return Nj}),o.d(t,"TextureBlock",function(){return Oj}),o.d(t,"ReflectionTextureBlock",function(){return Pj}),o.d(t,"InputBlock",function(){return xb}),o.d(t,"AnimatedInputBlockTypes",function(){return sd}),o.d(t,"Scalar",function(){return aa.a}),o.d(t,"Space",function(){return Ba.b}),o.d(t,"Axis",function(){return Ba.a}),o.d(t,"Color3",function(){return G.a}),o.d(t,"Color4",function(){return G.b}),o.d(t,"TmpColors",function(){return G.c}),o.d(t,"ToGammaSpace",function(){return kb.b}),o.d(t,"ToLinearSpace",function(){return kb.c}),o.d(t,"Epsilon",function(){return kb.a}),o.d(t,"Frustum",function(){return ki.a}),o.d(t,"Plane",function(){return Kd.a}),o.d(t,"Size",function(){return ba.a}),o.d(t,"Vector2",function(){return i.d}),o.d(t,"Vector3",function(){return i.e}),o.d(t,"Vector4",function(){return i.f}),o.d(t,"Quaternion",function(){return i.b}),o.d(t,"Matrix",function(){return i.a}),o.d(t,"TmpVectors",function(){return i.c}),o.d(t,"Viewport",function(){return Jc.a}),o.d(t,"SphericalHarmonics",function(){return sg}),o.d(t,"SphericalPolynomial",function(){return te}),o.d(t,"Orientation",function(){return eb}),o.d(t,"BezierCurve",function(){return wb}),o.d(t,"Angle",function(){return tb}),o.d(t,"Arc2",function(){return Ob}),o.d(t,"Path2",function(){return dc}),o.d(t,"Path3D",function(){return tc}),o.d(t,"Curve3",function(){return Tc}),o.d(t,"PositionNormalVertex",function(){return Ig}),o.d(t,"PositionNormalTextureVertex",function(){return $m}),o.d(t,"AbstractMesh",function(){return qb.a}),o.d(t,"Buffer",function(){return ra.a}),o.d(t,"VertexBuffer",function(){return ra.b}),o.d(t,"CSG",function(){return Qn}),o.d(t,"Geometry",function(){return Ng.a}),o.d(t,"GroundMesh",function(){return bf}),o.d(t,"TrailMesh",function(){return Rn}),o.d(t,"InstancedMesh",function(){return Sn.a}),o.d(t,"LinesMesh",function(){return Ie.b}),o.d(t,"InstancedLinesMesh",function(){return Ie.a}),o.d(t,"_CreationDataStorage",function(){return xa.b}),o.d(t,"_InstancesBatch",function(){return xa.c}),o.d(t,"Mesh",function(){return xa.a}),o.d(t,"VertexData",function(){return Xa.a}),o.d(t,"MeshBuilder",function(){return Vn}),o.d(t,"SimplificationSettings",function(){return Wn}),o.d(t,"SimplificationQueue",function(){return Ik}),o.d(t,"SimplificationType",function(){return Ke}),o.d(t,"SimplicationQueueSceneComponent",function(){return Kk}),o.d(t,"Polygon",function(){return Un}),o.d(t,"PolygonMeshBuilder",function(){return Gk}),o.d(t,"BaseSubMesh",function(){return Yd.a}),o.d(t,"SubMesh",function(){return Yd.b}),o.d(t,"MeshLODLevel",function(){return $n.a}),o.d(t,"TransformNode",function(){return pd.a}),o.d(t,"BoxBuilder",function(){return ue.a}),o.d(t,"SphereBuilder",function(){return jc.a}),o.d(t,"CylinderBuilder",function(){return md.a}),o.d(t,"TorusBuilder",function(){return Jd}),o.d(t,"LinesBuilder",function(){return Wb.a}),o.d(t,"PlaneBuilder",function(){return zg.a}),o.d(t,"GroundBuilder",function(){return Yc}),o.d(t,"DataBuffer",function(){return Ai.a}),o.d(t,"WebGLDataBuffer",function(){return ao.a}),o.d(t,"DracoCompression",function(){return Nn}),o.d(t,"TiledBoxBuilder",function(){return Fk}),o.d(t,"DiscBuilder",function(){return Af}),o.d(t,"RibbonBuilder",function(){return rd}),o.d(t,"HemisphereBuilder",function(){return lf}),o.d(t,"TorusKnotBuilder",function(){return ah}),o.d(t,"PolygonBuilder",function(){return Je}),o.d(t,"ShapeBuilder",function(){return Vd}),o.d(t,"LatheBuilder",function(){return ch}),o.d(t,"TiledPlaneBuilder",function(){return Hk}),o.d(t,"TubeBuilder",function(){return dh}),o.d(t,"PolyhedronBuilder",function(){return we}),o.d(t,"IcoSphereBuilder",function(){return eh}),o.d(t,"DecalBuilder",function(){return fh}),o.d(t,"MorphTarget",function(){return jj}),o.d(t,"MorphTargetManager",function(){return Pg}),o.d(t,"RecastJSPlugin",function(){return bo}),o.d(t,"RecastJSCrowd",function(){return Lk}),o.d(t,"Node",function(){return ia.a}),o.d(t,"Database",function(){return Mk}),o.d(t,"BaseParticleSystem",function(){return jh}),o.d(t,"GPUParticleSystem",function(){return Me}),o.d(t,"Particle",function(){return Qk}),o.d(t,"ParticleHelper",function(){return lo}),o.d(t,"ParticleSystem",function(){return Yb}),o.d(t,"_IDoNeedToBeInTheBuild",function(){return 42}),o.d(t,"ParticleSystemSet",function(){return Df}),o.d(t,"SolidParticle",function(){return mh}),o.d(t,"ModelShape",function(){return nh}),o.d(t,"DepthSortedParticle",function(){return Rk}),o.d(t,"SolidParticleSystem",function(){return mo}),o.d(t,"CloudPoint",function(){return Sk}),o.d(t,"PointsGroup",function(){return Ef}),o.d(t,"PointColor",function(){return Zb}),o.d(t,"PointsCloudSystem",function(){return no}),o.d(t,"SubEmitterType",function(){return Zd}),o.d(t,"SubEmitter",function(){return Le}),o.d(t,"BoxParticleEmitter",function(){return _d}),o.d(t,"ConeParticleEmitter",function(){return gh}),o.d(t,"CylinderParticleEmitter",function(){return Bf}),o.d(t,"CylinderDirectedParticleEmitter",function(){return Nk}),o.d(t,"HemisphericParticleEmitter",function(){return hh}),o.d(t,"PointParticleEmitter",function(){return Ok}),o.d(t,"SphereParticleEmitter",function(){return Cf}),o.d(t,"SphereDirectedParticleEmitter",function(){return ih}),o.d(t,"CustomParticleEmitter",function(){return $d}),o.d(t,"MeshParticleEmitter",function(){return co}),o.d(t,"PhysicsEngine",function(){return Ud}),o.d(t,"PhysicsEngineSceneComponent",function(){return Tk}),o.d(t,"PhysicsHelper",function(){return oo}),o.d(t,"PhysicsRadialExplosionEventOptions",function(){return be}),o.d(t,"PhysicsUpdraftEventOptions",function(){return oh}),o.d(t,"PhysicsVortexEventOptions",function(){return ph}),o.d(t,"PhysicsRadialImpulseFalloff",function(){return Ne}),o.d(t,"PhysicsUpdraftMode",function(){return ae}),o.d(t,"PhysicsImpostor",function(){return ob.a}),o.d(t,"PhysicsJoint",function(){return Db.e}),o.d(t,"DistanceJoint",function(){return Db.a}),o.d(t,"MotorEnabledJoint",function(){return Db.d}),o.d(t,"HingeJoint",function(){return Db.c}),o.d(t,"Hinge2Joint",function(){return Db.b}),o.d(t,"CannonJSPlugin",function(){return Rg}),o.d(t,"AmmoJSPlugin",function(){return lj}),o.d(t,"OimoJSPlugin",function(){return kj}),o.d(t,"AnaglyphPostProcess",function(){return Zh}),o.d(t,"BlackAndWhitePostProcess",function(){return to}),o.d(t,"BloomEffect",function(){return qh}),o.d(t,"BloomMergePostProcess",function(){return Wk}),o.d(t,"BlurPostProcess",function(){return Xb}),o.d(t,"ChromaticAberrationPostProcess",function(){return Xk}),o.d(t,"CircleOfConfusionPostProcess",function(){return Yk}),o.d(t,"ColorCorrectionPostProcess",function(){return zo}),o.d(t,"ConvolutionPostProcess",function(){return Bo}),o.d(t,"DepthOfFieldBlurPostProcess",function(){return rh}),o.d(t,"DepthOfFieldEffectBlurLevel",function(){return ud}),o.d(t,"DepthOfFieldEffect",function(){return sh}),o.d(t,"DepthOfFieldMergePostProcessOptions",function(){return Do}),o.d(t,"DepthOfFieldMergePostProcess",function(){return Zk}),o.d(t,"DisplayPassPostProcess",function(){return Fo}),o.d(t,"ExtractHighlightsPostProcess",function(){return Vk}),o.d(t,"FilterPostProcess",function(){return Ho}),o.d(t,"FxaaPostProcess",function(){return Ff}),o.d(t,"GrainPostProcess",function(){return _k}),o.d(t,"HighlightsPostProcess",function(){return Mo}),o.d(t,"ImageProcessingPostProcess",function(){return og}),o.d(t,"MotionBlurPostProcess",function(){return al}),o.d(t,"PassPostProcess",function(){return Wc}),o.d(t,"PassCubePostProcess",function(){return Wl}),o.d(t,"PostProcess",function(){return gb}),o.d(t,"PostProcessManager",function(){return mg.a}),o.d(t,"RefractionPostProcess",function(){return Ro}),o.d(t,"SharpenPostProcess",function(){return bl}),o.d(t,"StereoscopicInterlacePostProcessI",function(){return ci}),o.d(t,"StereoscopicInterlacePostProcess",function(){return Zl}),o.d(t,"TonemappingOperator",function(){return vd}),o.d(t,"TonemapPostProcess",function(){return bp}),o.d(t,"VolumetricLightScatteringPostProcess",function(){return fp}),o.d(t,"VRDistortionCorrectionPostProcess",function(){return lg}),o.d(t,"VRMultiviewToSingleviewPostProcess",function(){return ng}),o.d(t,"ScreenSpaceReflectionPostProcess",function(){return gl}),o.d(t,"PostProcessRenderEffect",function(){return pb}),o.d(t,"PostProcessRenderPipeline",function(){return de}),o.d(t,"PostProcessRenderPipelineManager",function(){return cl}),o.d(t,"PostProcessRenderPipelineManagerSceneComponent",function(){return dl}),o.d(t,"DefaultRenderingPipeline",function(){return el}),o.d(t,"LensRenderingPipeline",function(){return Vo}),o.d(t,"SSAO2RenderingPipeline",function(){return fl}),o.d(t,"SSAORenderingPipeline",function(){return Zo}),o.d(t,"StandardRenderingPipeline",function(){return hl}),o.d(t,"ReflectionProbe",function(){return mj}),o.d(t,"BoundingBoxRenderer",function(){return il}),o.d(t,"DepthRenderer",function(){return sf}),o.d(t,"DepthRendererSceneComponent",function(){return jl}),o.d(t,"EdgesRenderer",function(){return th}),o.d(t,"LineEdgesRenderer",function(){return kl}),o.d(t,"GeometryBufferRenderer",function(){return ce}),o.d(t,"GeometryBufferRendererSceneComponent",function(){return $k}),o.d(t,"OutlineRenderer",function(){return ll}),o.d(t,"RenderingGroup",function(){return lp.a}),o.d(t,"RenderingGroupInfo",function(){return re.a}),o.d(t,"RenderingManager",function(){return re.b}),o.d(t,"UtilityLayerRenderer",function(){return ic.a}),o.d(t,"Scene",function(){return wa.a}),o.d(t,"SceneComponentConstants",function(){return _a.a}),o.d(t,"Stage",function(){return _a.b}),o.d(t,"Sprite",function(){return mp}),o.d(t,"SpriteManager",function(){return nl}),o.d(t,"SpriteMap",function(){return rp}),o.d(t,"SpritePackedManager",function(){return sp}),o.d(t,"SpriteSceneComponent",function(){return ml}),o.d(t,"AlphaState",function(){return tp.a}),o.d(t,"DepthCullingState",function(){return up.a}),o.d(t,"StencilState",function(){return vp.a}),o.d(t,"AndOrNotEvaluator",function(){return wp.a}),o.d(t,"AssetTaskState",function(){return Dc}),o.d(t,"AbstractAssetTask",function(){return Rc}),o.d(t,"AssetsProgressEvent",function(){return ol}),o.d(t,"MeshAssetTask",function(){return pl}),o.d(t,"TextFileAssetTask",function(){return ql}),o.d(t,"BinaryFileAssetTask",function(){return rl}),o.d(t,"ImageAssetTask",function(){return sl}),o.d(t,"TextureAssetTask",function(){return tl}),o.d(t,"CubeTextureAssetTask",function(){return ul}),o.d(t,"HDRCubeTextureAssetTask",function(){return vl}),o.d(t,"EquiRectangularCubeTextureAssetTask",function(){return wl}),o.d(t,"AssetsManager",function(){return xp}),o.d(t,"BasisTranscodeConfiguration",function(){return xn}),o.d(t,"BasisTools",function(){return Ge}),o.d(t,"DDSTools",function(){return _c}),o.d(t,"expandToProperty",function(){return F.b}),o.d(t,"serialize",function(){return F.c}),o.d(t,"serializeAsTexture",function(){return F.m}),o.d(t,"serializeAsColor3",function(){return F.e}),o.d(t,"serializeAsFresnelParameters",function(){return F.h}),o.d(t,"serializeAsVector2",function(){return F.n}),o.d(t,"serializeAsVector3",function(){return F.o}),o.d(t,"serializeAsMeshReference",function(){return F.k}),o.d(t,"serializeAsColorCurves",function(){return F.g}),o.d(t,"serializeAsColor4",function(){return F.f}),o.d(t,"serializeAsImageProcessingConfiguration",function(){return F.i}),o.d(t,"serializeAsQuaternion",function(){return F.l}),o.d(t,"serializeAsMatrix",function(){return F.j}),o.d(t,"serializeAsCameraReference",function(){return F.d}),o.d(t,"SerializationHelper",function(){return F.a}),o.d(t,"Deferred",function(){return yp}),o.d(t,"EnvironmentTextureTools",function(){return Nc}),o.d(t,"MeshExploder",function(){return zp}),o.d(t,"FilesInput",function(){return Ap}),o.d(t,"KhronosTextureContainer",function(){return qf}),o.d(t,"EventState",function(){return I.a}),o.d(t,"Observer",function(){return I.d}),o.d(t,"MultiObserver",function(){return I.b}),o.d(t,"Observable",function(){return I.c}),o.d(t,"PerformanceMonitor",function(){return xl.a}),o.d(t,"RollingAverage",function(){return xl.b}),o.d(t,"PromisePolyfill",function(){return Bp.a}),o.d(t,"SceneOptimization",function(){return Ec}),o.d(t,"TextureOptimization",function(){return Gf}),o.d(t,"HardwareScalingOptimization",function(){return vh}),o.d(t,"ShadowsOptimization",function(){return Hf}),o.d(t,"PostProcessesOptimization",function(){return If}),o.d(t,"LensFlaresOptimization",function(){return Jf}),o.d(t,"CustomOptimization",function(){return yl}),o.d(t,"ParticlesOptimization",function(){return Kf}),o.d(t,"RenderTargetsOptimization",function(){return wh}),o.d(t,"MergeMeshesOptimization",function(){return Lf}),o.d(t,"SceneOptimizerOptions",function(){return xh}),o.d(t,"SceneOptimizer",function(){return Cp}),o.d(t,"SceneSerializer",function(){return Dp}),o.d(t,"SmartArray",function(){return Ic.a}),o.d(t,"SmartArrayNoDuplicate",function(){return Ic.b}),o.d(t,"StringDictionary",function(){return Ph.a}),o.d(t,"Tags",function(){return Ep.a}),o.d(t,"TextureTools",function(){return Fp}),o.d(t,"TGATools",function(){return wf}),o.d(t,"Tools",function(){return Qa.b}),o.d(t,"className",function(){return Qa.c}),o.d(t,"AsyncLoop",function(){return Qa.a}),o.d(t,"VideoRecorder",function(){return Gp}),o.d(t,"JoystickAxis",function(){return Gb}),o.d(t,"VirtualJoystick",function(){return hg}),o.d(t,"WorkerPool",function(){return Ck}),o.d(t,"Logger",function(){return k.a}),o.d(t,"_TypeStore",function(){return D.a}),o.d(t,"FilesInputStore",function(){return vg.a}),o.d(t,"DeepCopier",function(){return P.a}),o.d(t,"PivotTools",function(){return fc.a}),o.d(t,"PrecisionDate",function(){return Ka.a}),o.d(t,"ScreenshotTools",function(){return Oe}),o.d(t,"WebRequest",function(){return Xd.a}),o.d(t,"InspectableType",function(){return uh}),o.d(t,"BRDFTextureTools",function(){return Eg}),o.d(t,"RGBDTextureTools",function(){return Ji}),o.d(t,"ColorGradient",function(){return kh}),o.d(t,"Color3Gradient",function(){return Pk}),o.d(t,"FactorGradient",function(){return lh}),o.d(t,"GradientHelper",function(){return bc}),o.d(t,"PerfCounter",function(){return kc.a}),o.d(t,"RetryStrategy",function(){return Hp.a}),o.d(t,"CanvasGenerator",function(){return af.a}),o.d(t,"LoadFileError",function(){return xe.b}),o.d(t,"RequestFileError",function(){return xe.d}),o.d(t,"ReadFileError",function(){return xe.c}),o.d(t,"FileTools",function(){return xe.a}),o.d(t,"StringTools",function(){return oc.a}),o.d(t,"DataReader",function(){return Ip}),o.d(t,"MinMaxReducer",function(){return dj}),o.d(t,"DepthReducer",function(){return ej}),o.d(t,"CubeMapToSphericalPolynomialTools",function(){return cf}),o.d(t,"HDRTools",function(){return ij}),o.d(t,"PanoramaToCubeMapTools",function(){return Og}),o.d(t,"WebXRCamera",function(){return Ri}),o.d(t,"WebXREnterExitUIButton",function(){return Wi}),o.d(t,"WebXREnterExitUIOptions",function(){return Zm}),o.d(t,"WebXREnterExitUI",function(){return Xi}),o.d(t,"WebXRExperienceHelper",function(){return Si}),o.d(t,"WebXRInput",function(){return Vi}),o.d(t,"WebXRInputSource",function(){return Ui}),o.d(t,"WebXRManagedOutputCanvasOptions",function(){return ni}),o.d(t,"WebXRManagedOutputCanvas",function(){return oi}),o.d(t,"WebXRState",function(){return Tb}),o.d(t,"WebXRSessionManager",function(){return pg}),o.d(t,"WebXRDefaultExperienceOptions",function(){return _m}),o.d(t,"WebXRDefaultExperience",function(){return Yi}),o.d(t,"WebXRFeatureName",function(){return $c}),o.d(t,"WebXRFeaturesManager",function(){return ad}),o.d(t,"WebXRHitTestLegacy",function(){return Pe}),o.d(t,"WebXRAnchorSystem",function(){return Kp}),o.d(t,"WebXRPlaneDetector",function(){return Nf}),o.d(t,"WebXRBackgroundRemover",function(){return Of}),o.d(t,"WebXRMotionControllerTeleportation",function(){return Ce}),o.d(t,"WebXRControllerPointerSelection",function(){return Be}),o.d(t,"IWebXRControllerPhysicsOptions",function(){return Mp}),o.d(t,"WebXRControllerPhysics",function(){return Pf}),o.d(t,"WebXRAbstractMotionController",function(){return Rd}),o.d(t,"WebXRControllerComponent",function(){return Qd}),o.d(t,"WebXRGenericTriggerMotionController",function(){return Hg}),o.d(t,"WebXRMicrosoftMixedRealityController",function(){return Al}),o.d(t,"WebXRMotionControllerManager",function(){return qc}),o.d(t,"WebXROculusTouchMotionController",function(){return zh}),o.d(t,"WebXRHTCViveMotionController",function(){return Bl}),o.d(t,"WebXRProfiledMotionController",function(){return Ti})},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(38),r=function(){function I(){}return I.SetImmediate=function(i){R.a.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(i):setTimeout(i,1)},I}()},function(Ja,t,o){"use strict";var R=o(36),r=function(){function k(){this.children=[]}return k.prototype.isValid=function(p){return!0},k.prototype.process=function(p,u){var A="";if(this.line){var B=this.line,v=u.processor;v&&((v.lineProcessor&&(B=v.lineProcessor(B,u.isFragment)),v.attributeProcessor&&R.a.StartsWith(this.line,"attribute"))?B=v.attributeProcessor(this.line):v.varyingProcessor&&R.a.StartsWith(this.line,"varying")?B=v.varyingProcessor(this.line,u.isFragment):(v.uniformProcessor||v.uniformBufferProcessor)&&R.a.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?v.uniformProcessor&&(B=v.uniformProcessor(this.line,u.isFragment)):v.uniformBufferProcessor&&(B=v.uniformBufferProcessor(this.line,u.isFragment),u.lookForClosingBracketForUniformBuffer=!0)),v.endOfUniformBufferProcessor&&u.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(u.lookForClosingBracketForUniformBuffer=!1,B=v.endOfUniformBufferProcessor(this.line,u.isFragment))),A+=B+`\r
`}return this.children.forEach(function(H){A+=H.process(p,u)}),this.additionalDefineKey&&(p[this.additionalDefineKey]=this.additionalDefineValue||"true"),A},k}(),I=function(){function k(){}return Object.defineProperty(k.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"lines",{set:function(p){this._lines=[];for(var u=0,A=p;u<A.length;u++){var B=A[u];if("#"!==B[0])for(var v=B.split(";"),H=0;H<v.length;H++){var L=v[H];(L=L.trim())&&this._lines.push(L+(H!==v.length-1?";":""))}else this._lines.push(B)}},enumerable:!0,configurable:!0}),k}(),i=o(1),G=function(k){function p(){return null!==k&&k.apply(this,arguments)||this}return Object(i.d)(p,k),p.prototype.process=function(u,A){for(var B=0;B<this.children.length;B++){var v=this.children[B];if(v.isValid(u))return v.process(u,A)}return""},p}(r),D=function(k){function p(){return null!==k&&k.apply(this,arguments)||this}return Object(i.d)(p,k),p.prototype.isValid=function(u){return this.testExpression.isTrue(u)},p}(r),E=function(){function k(){}return k.prototype.isTrue=function(p){return!0},k}(),x=function(k){function p(u,A){void 0===A&&(A=!1);var B=k.call(this)||this;return B.define=u,B.not=A,B}return Object(i.d)(p,k),p.prototype.isTrue=function(u){var A=void 0!==u[this.define];return this.not&&(A=!A),A},p}(E),l=function(k){function p(){return null!==k&&k.apply(this,arguments)||this}return Object(i.d)(p,k),p.prototype.isTrue=function(u){return this.leftOperand.isTrue(u)||this.rightOperand.isTrue(u)},p}(E),s=function(k){function p(){return null!==k&&k.apply(this,arguments)||this}return Object(i.d)(p,k),p.prototype.isTrue=function(u){return this.leftOperand.isTrue(u)&&this.rightOperand.isTrue(u)},p}(E),y=function(k){function p(u,A,B){var v=k.call(this)||this;return v.define=u,v.operand=A,v.testValue=B,v}return Object(i.d)(p,k),p.prototype.isTrue=function(u){var A=u[this.define];void 0===A&&(A=this.define);var B=!1,v=parseInt(A),H=parseInt(this.testValue);switch(this.operand){case">":B=v>H;break;case"<":B=v<H;break;case"<=":B=v<=H;break;case">=":B=v>=H;break;case"==":B=v===H}return B},p}(E),q=o(19);o.d(t,"a",function(){return n});var n=function(){function k(){}return k.Process=function(p,u,A){var B=this;this._ProcessIncludes(p,u,function(v){var H=B._ProcessShaderConversion(v,u);A(H)})},k._ProcessPrecision=function(p,u){var A=u.shouldUseHighPrecisionShader;return-1===p.indexOf("precision highp float")?p=A?`precision highp float;
`+p:`precision mediump float;
`+p:A||(p=p.replace("precision highp float","precision mediump float")),p},k._ExtractOperation=function(p){var u=/defined\((.+)\)/.exec(p);if(u&&u.length)return new x(u[1].trim(),"!"===p[0]);for(var A="",B=0,v=0,H=["==",">=","<=","<",">"];v<H.length&&(A=H[v],!((B=p.indexOf(A))>-1));v++);if(-1===B)return new x(p);var L=p.substring(0,B).trim(),Q=p.substring(B+A.length).trim();return new y(L,A,Q)},k._BuildSubExpression=function(p){var u=p.indexOf("||");if(-1===u){var A=p.indexOf("&&");if(A>-1){var B=new s(),v=p.substring(0,A).trim(),H=p.substring(A+2).trim();return B.leftOperand=this._BuildSubExpression(v),B.rightOperand=this._BuildSubExpression(H),B}return this._ExtractOperation(p)}var L=new l();return v=p.substring(0,u).trim(),H=p.substring(u+2).trim(),L.leftOperand=this._BuildSubExpression(v),L.rightOperand=this._BuildSubExpression(H),L},k._BuildExpression=function(p,u){var A=new D(),B=p.substring(0,u),v=p.substring(u).trim();return A.testExpression="#ifdef"===B?new x(v):"#ifndef"===B?new x(v,!0):this._BuildSubExpression(v),A},k._MoveCursorWithinIf=function(p,u,A){for(var B=p.currentLine;this._MoveCursor(p,A);){var v=(B=p.currentLine).substring(0,5).toLowerCase();if("#else"===v){var H=new r();return u.children.push(H),void this._MoveCursor(p,H)}if("#elif"===v){var L=this._BuildExpression(B,5);u.children.push(L),A=L}}},k._MoveCursor=function(p,u){for(;p.canRead;){p.lineIndex++;var A=p.currentLine,B=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(A);if(B&&B.length)switch(B[0]){case"#ifdef":var v=new G();u.children.push(v);var H=this._BuildExpression(A,6);v.children.push(H),this._MoveCursorWithinIf(p,v,H);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":v=new G(),u.children.push(v),H=this._BuildExpression(A,7),v.children.push(H),this._MoveCursorWithinIf(p,v,H);break;case"#if":v=new G(),H=this._BuildExpression(A,3),u.children.push(v),v.children.push(H),this._MoveCursorWithinIf(p,v,H)}else{var L=new r();if(L.line=A,u.children.push(L),"#"===A[0]&&"d"===A[1]){var Q=A.replace(";","").split(" ");L.additionalDefineKey=Q[1],3===Q.length&&(L.additionalDefineValue=Q[2])}}}return!1},k._EvaluatePreProcessors=function(p,u,A){var B=new r(),v=new I();return v.lineIndex=-1,v.lines=p.split(`
`),this._MoveCursor(v,B),B.process(u,A)},k._PreparePreProcessors=function(p){for(var u={},A=0,B=p.defines;A<B.length;A++){var v=B[A].replace("#define","").replace(";","").trim().split(" ");u[v[0]]=v.length>1?v[1]:""}return u.GL_ES="true",u.__VERSION__=p.version,u[p.platformName]="true",u},k._ProcessShaderConversion=function(p,u){var A=this._ProcessPrecision(p,u);if(!u.processor)return A;if(-1!==A.indexOf("#version 3"))return A.replace("#version 300 es","");var B=u.defines,v=this._PreparePreProcessors(u);return u.processor.preProcessor&&(A=u.processor.preProcessor(A,B,u.isFragment)),A=this._EvaluatePreProcessors(A,v,u),u.processor.postProcessor&&(A=u.processor.postProcessor(A,B,u.isFragment)),A},k._ProcessIncludes=function(p,u,A){for(var B=this,v=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,H=v.exec(p),L=new String(p);null!=H;){var Q=H[1];if(-1!==Q.indexOf("__decl__")&&(Q=Q.replace(/__decl__/,""),u.supportsUniformBuffers&&(Q=(Q=Q.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),Q+="Declaration"),!u.includesShadersStore[Q]){var M=u.shadersRepository+"ShadersInclude/"+Q+".fx";return void k._FileToolsLoadFile(M,function(ia){u.includesShadersStore[Q]=ia,B._ProcessIncludes(L,u,A)})}var Y=u.includesShadersStore[Q];if(H[2])for(var X=H[3].split(","),U=0;U<X.length;U+=2){var P=new RegExp(X[U],"g"),ga=X[U+1];Y=Y.replace(P,ga)}if(H[4]){var ma=H[5];if(-1!==ma.indexOf("..")){var oa=ma.split(".."),ja=parseInt(oa[0]),aa=parseInt(oa[1]),F=Y.slice(0);Y="",isNaN(aa)&&(aa=u.indexParameters[oa[1]]);for(var $=ja;$<aa;$++)u.supportsUniformBuffers||(F=F.replace(/light\{X\}.(\w*)/g,function(ia,ba){return ba+"{X}"})),Y+=F.replace(/\{X\}/g,$.toString())+`
`}else u.supportsUniformBuffers||(Y=Y.replace(/light\{X\}.(\w*)/g,function(ia,ba){return ba+"{X}"})),Y=Y.replace(/\{X\}/g,ma)}L=L.replace(H[0],Y),H=v.exec(p)}A(L)},k._FileToolsLoadFile=function(p,u,A,B,v,H){throw q.a.WarnImport("FileTools")},k}()},function(Ja,t,o){"use strict";var R="shadowsFragmentFunctions",r=`#ifdef SHADOWS
#ifndef SHADOWFLOAT

float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}
#endif
float computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)
{
float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));
return mix(value,1.0,mask);
}
float computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadow=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadow=textureCube(shadowSampler,directionToLight).x;
#endif
if (depth>shadow)
{
return darkness;
}
return 1.0;
}
float computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
float visibility=1.;
vec3 poissonDisk[4];
poissonDisk[0]=vec3(-1.0,1.0,-1.0);
poissonDisk[1]=vec3(1.0,-1.0,-1.0);
poissonDisk[2]=vec3(-1.0,-1.0,-1.0);
poissonDisk[3]=vec3(1.0,-1.0,1.0);

#ifndef SHADOWFLOAT
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;
#else
if (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;
#endif
return min(1.0,visibility+darkness);
}
float computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return esm;
}
float computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return esm;
}
#ifdef WEBGL2
float computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
vec3 uvLayer=vec3(uv.x,uv.y,layer);
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uvLayer));
#else
float shadow=texture2D(shadowSampler,uvLayer).x;
#endif
if (shadowPixelDepth>shadow)
{
return computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);
}
return 1.;
}
#endif
float computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uv));
#else
float shadow=texture2D(shadowSampler,uv).x;
#endif
if (shadowPixelDepth>shadow)
{
return computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);
}
return 1.;
}
float computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
float visibility=1.;
vec2 poissonDisk[4];
poissonDisk[0]=vec2(-0.94201624,-0.39906216);
poissonDisk[1]=vec2(0.94558609,-0.76890725);
poissonDisk[2]=vec2(-0.094184101,-0.92938870);
poissonDisk[3]=vec2(0.34495938,0.29387760);

#ifndef SHADOWFLOAT
if (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;
#else
if (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;
#endif
return computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);
}
float computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
float computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
#ifdef WEBGL2
#define GREATEST_LESS_THAN_ONE 0.99999994

float computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float shadow=texture(shadowSampler,uvDepthLayer);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



float computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



float computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}

float computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float shadow=texture2D(shadowSampler,uvDepth);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



float computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



float computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
const vec3 PoissonSamplers32[64]=vec3[64](
vec3(0.06407013,0.05409927,0.),
vec3(0.7366577,0.5789394,0.),
vec3(-0.6270542,-0.5320278,0.),
vec3(-0.4096107,0.8411095,0.),
vec3(0.6849564,-0.4990818,0.),
vec3(-0.874181,-0.04579735,0.),
vec3(0.9989998,0.0009880066,0.),
vec3(-0.004920578,-0.9151649,0.),
vec3(0.1805763,0.9747483,0.),
vec3(-0.2138451,0.2635818,0.),
vec3(0.109845,0.3884785,0.),
vec3(0.06876755,-0.3581074,0.),
vec3(0.374073,-0.7661266,0.),
vec3(0.3079132,-0.1216763,0.),
vec3(-0.3794335,-0.8271583,0.),
vec3(-0.203878,-0.07715034,0.),
vec3(0.5912697,0.1469799,0.),
vec3(-0.88069,0.3031784,0.),
vec3(0.5040108,0.8283722,0.),
vec3(-0.5844124,0.5494877,0.),
vec3(0.6017799,-0.1726654,0.),
vec3(-0.5554981,0.1559997,0.),
vec3(-0.3016369,-0.3900928,0.),
vec3(-0.5550632,-0.1723762,0.),
vec3(0.925029,0.2995041,0.),
vec3(-0.2473137,0.5538505,0.),
vec3(0.9183037,-0.2862392,0.),
vec3(0.2469421,0.6718712,0.),
vec3(0.3916397,-0.4328209,0.),
vec3(-0.03576927,-0.6220032,0.),
vec3(-0.04661255,0.7995201,0.),
vec3(0.4402924,0.3640312,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.)
);
const vec3 PoissonSamplers64[64]=vec3[64](
vec3(-0.613392,0.617481,0.),
vec3(0.170019,-0.040254,0.),
vec3(-0.299417,0.791925,0.),
vec3(0.645680,0.493210,0.),
vec3(-0.651784,0.717887,0.),
vec3(0.421003,0.027070,0.),
vec3(-0.817194,-0.271096,0.),
vec3(-0.705374,-0.668203,0.),
vec3(0.977050,-0.108615,0.),
vec3(0.063326,0.142369,0.),
vec3(0.203528,0.214331,0.),
vec3(-0.667531,0.326090,0.),
vec3(-0.098422,-0.295755,0.),
vec3(-0.885922,0.215369,0.),
vec3(0.566637,0.605213,0.),
vec3(0.039766,-0.396100,0.),
vec3(0.751946,0.453352,0.),
vec3(0.078707,-0.715323,0.),
vec3(-0.075838,-0.529344,0.),
vec3(0.724479,-0.580798,0.),
vec3(0.222999,-0.215125,0.),
vec3(-0.467574,-0.405438,0.),
vec3(-0.248268,-0.814753,0.),
vec3(0.354411,-0.887570,0.),
vec3(0.175817,0.382366,0.),
vec3(0.487472,-0.063082,0.),
vec3(-0.084078,0.898312,0.),
vec3(0.488876,-0.783441,0.),
vec3(0.470016,0.217933,0.),
vec3(-0.696890,-0.549791,0.),
vec3(-0.149693,0.605762,0.),
vec3(0.034211,0.979980,0.),
vec3(0.503098,-0.308878,0.),
vec3(-0.016205,-0.872921,0.),
vec3(0.385784,-0.393902,0.),
vec3(-0.146886,-0.859249,0.),
vec3(0.643361,0.164098,0.),
vec3(0.634388,-0.049471,0.),
vec3(-0.688894,0.007843,0.),
vec3(0.464034,-0.188818,0.),
vec3(-0.440840,0.137486,0.),
vec3(0.364483,0.511704,0.),
vec3(0.034028,0.325968,0.),
vec3(0.099094,-0.308023,0.),
vec3(0.693960,-0.366253,0.),
vec3(0.678884,-0.204688,0.),
vec3(0.001801,0.780328,0.),
vec3(0.145177,-0.898984,0.),
vec3(0.062655,-0.611866,0.),
vec3(0.315226,-0.604297,0.),
vec3(-0.780145,0.486251,0.),
vec3(-0.371868,0.882138,0.),
vec3(0.200476,0.494430,0.),
vec3(-0.494552,-0.711051,0.),
vec3(0.612476,0.705252,0.),
vec3(-0.578845,-0.768792,0.),
vec3(-0.772454,-0.090976,0.),
vec3(0.504440,0.372295,0.),
vec3(0.155736,0.065157,0.),
vec3(0.391522,0.849605,0.),
vec3(-0.620106,-0.328104,0.),
vec3(0.789239,-0.419965,0.),
vec3(-0.545396,0.538133,0.),
vec3(-0.178564,-0.596057,0.)
);





float computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);
vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec4 offset=vec4(poissonSamplers[i],0.);

offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);
shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}





float computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);
float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec3 offset=poissonSamplers[i];

offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);
shadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
float computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);
}
float computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);
}
float computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);
}
float computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
float computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
float computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#endif
#endif
`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="reflectionFunction",r=`vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {

vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;
vec3 halfSize=cubeSize*0.5;
vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;
vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;

vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);

float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);

vec3 intersectPositionWS=vertexPos+origVec*distance;

return intersectPositionWS-cubePos;
}
vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(1.0-s,t,0);
}
vec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);
vec3 r=normalize(reflect(cameraToVertex,worldNormal));
r=vec3(reflectionMatrix*vec4(r,0));
float lon=atan(r.z,r.x);
float lat=acos(r.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(vec3(view*worldPos));
vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));
vec3 r=reflect(viewDir,viewNormal);
r=vec3(reflectionMatrix*vec4(r,0));
r.z=r.z-1.0;
float m=2.0*length(r);
return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);
}
vec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=worldPos.xyz-eyePosition;
vec3 coords=normalize(reflect(viewDir,worldNormal));
return vec3(reflectionMatrix*vec4(coords,1));
}
vec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*(view*worldPos));
}
vec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*vec4(positionW,0));
}
#ifdef REFLECTION
vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)
{
#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR
return computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SPHERICAL
return computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_PLANAR
return computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_CUBIC
#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
return computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);
#else
return computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#endif
#ifdef REFLECTIONMAP_PROJECTION
return computeProjectionCoords(worldPos,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SKYBOX
return computeSkyBoxCoords(vPositionUVW,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_EXPLICIT
return vec3(0,0,0);
#endif
}
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="bumpFragmentFunctions",r=`#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat4 normalMatrix;
#endif
vec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)
{
textureSample=textureSample*2.0-1.0;
#ifdef NORMALXYSCALE
textureSample=normalize(textureSample*vec3(scale,scale,1.0));
#endif
return normalize(cotangentFrame*textureSample);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)
{

uv=gl_FrontFacing ? uv : -uv;

vec3 dp1=dFdx(p);
vec3 dp2=dFdy(p);
vec2 duv1=dFdx(uv);
vec2 duv2=dFdy(uv);

vec3 dp2perp=cross(dp2,normal);
vec3 dp1perp=cross(normal,dp1);
vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;
vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;

tangent*=tangentSpaceParams.x;
bitangent*=tangentSpaceParams.y;

float invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));
return mat3(tangent*invmax,bitangent*invmax,normal);
}
#endif
#if defined(BUMP)
#if BUMPDIRECTUV == 1
#define vBumpUV vMainUV1
#elif BUMPDIRECTUV == 2
#define vBumpUV vMainUV2
#else
varying vec2 vBumpUV;
#endif
uniform sampler2D bumpSampler;
vec3 perturbNormal(mat3 cotangentFrame,vec2 uv)
{
return perturbNormal(cotangentFrame,texture2D(bumpSampler,uv).xyz,vBumpInfos.y);
}
#endif
#if defined(BUMP) || defined(CLEARCOAT_BUMP)
vec3 perturbNormal(mat3 cotangentFrame,vec3 color)
{
return perturbNormal(cotangentFrame,color,vBumpInfos.y);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{
return cotangent_frame(normal,p,uv,vTangentSpaceParams);
}
#endif
#if defined(BUMP) && defined(PARALLAX)
const float minSamples=4.;
const float maxSamples=15.;
const int iMaxSamples=15;

vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {
float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;
parallaxLimit*=parallaxScale;
vec2 vOffsetDir=normalize(vViewDirCoT.xy);
vec2 vMaxOffset=vOffsetDir*parallaxLimit;
float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));
float stepSize=1.0/numSamples;

float currRayHeight=1.0;
vec2 vCurrOffset=vec2(0,0);
vec2 vLastOffset=vec2(0,0);
float lastSampledHeight=1.0;
float currSampledHeight=1.0;
for (int i=0; i<iMaxSamples; i++)
{
currSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;

if (currSampledHeight>currRayHeight)
{
float delta1=currSampledHeight-currRayHeight;
float delta2=(currRayHeight+stepSize)-lastSampledHeight;
float ratio=delta1/(delta1+delta2);
vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;

break;
}
else
{
currRayHeight-=stepSize;
vLastOffset=vCurrOffset;
vCurrOffset+=stepSize*vMaxOffset;
lastSampledHeight=currSampledHeight;
}
}
return vCurrOffset;
}
vec2 parallaxOffset(vec3 viewDir,float heightScale)
{

float height=texture2D(bumpSampler,vBumpUV).w;
vec2 texCoordOffset=heightScale*viewDir.xy*height;
return -texCoordOffset;
}
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R=`vec2 uvOffset=vec2(0.0,0.0);
#if defined(BUMP) || defined(PARALLAX)
#ifdef NORMALXYSCALE
float normalScale=1.0;
#else
float normalScale=vBumpInfos.y;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);
#endif
#elif defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
mat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));
#endif
#endif
#ifdef PARALLAX
mat3 invTBN=transposeMat3(TBN);
#ifdef PARALLAXOCCLUSION
uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);
#else
uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);
#endif
#endif
#ifdef BUMP
#ifdef OBJECTSPACE_NORMALMAP
normalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);
normalW=normalize(mat3(normalMatrix)*normalW);
#else
normalW=perturbNormal(TBN,vBumpUV+uvOffset);
#endif
#endif`;o(8).a.IncludesShadersStore.bumpFragment=R},function(Ja,t,o){"use strict";var R="lightFragment",r=`#ifdef LIGHT{X}
#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})

#else
#ifdef PBR

#ifdef SPOTLIGHT{X}
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(POINTLIGHT{X})
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(HEMILIGHT{X})
preInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(DIRLIGHT{X})
preInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#endif
preInfo.NdotV=NdotV;

#ifdef SPOTLIGHT{X}
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#endif
#elif defined(POINTLIGHT{X})
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
#endif
#else
preInfo.attenuation=1.0;
#endif


#ifdef HEMILIGHT{X}
preInfo.roughness=roughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif

#ifdef HEMILIGHT{X}
info.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);
#elif defined(SS_TRANSLUCENCY)
info.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,transmittance);
#else
info.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);
#endif

#ifdef SPECULARTERM
#ifdef ANISOTROPIC
info.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicTangent,anisotropicBitangent,anisotropy,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#else
info.specular=computeSpecularLighting(preInfo,normalW,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif
#endif

#ifdef SHEEN
#ifdef SHEEN_LINKWITHALBEDO

preInfo.roughness=sheenIntensity;
#endif
info.sheen=computeSheenLighting(preInfo,normalW,sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif

#ifdef CLEARCOAT

#ifdef HEMILIGHT{X}
preInfo.roughness=clearCoatRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
info.clearCoat=computeClearCoatLighting(preInfo,clearCoatNormalW,clearCoatAARoughnessFactors.x,clearCoatIntensity,light{X}.vLightDiffuse.rgb);
#ifdef CLEARCOAT_TINT

absorption=computeClearCoatLightingAbsorption(clearCoatNdotVRefract,preInfo.L,clearCoatNormalW,clearCoatColor,clearCoatThickness,clearCoatIntensity);
info.diffuse*=absorption;
#ifdef SPECULARTERM
info.specular*=absorption;
#endif
#endif

info.diffuse*=info.clearCoat.w;
#ifdef SPECULARTERM
info.specular*=info.clearCoat.w;
#endif
#ifdef SHEEN
info.sheen*=info.clearCoat.w;
#endif
#endif
#else
#ifdef SPOTLIGHT{X}
info=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);
#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})
info=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#endif
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
info.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});
#endif
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++)
{
#ifdef SHADOWCSM_RIGHTHANDED{X}
diff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;
#else
diff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;
#endif
if (diff{X}>=0.) {
index{X}=i;
break;
}
}
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
if (index{X}>=0)
#endif
{
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
shadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
shadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];
#endif
#ifndef SHADOWCSMNOBLEND{X}
float frustumLength=frustumLengths{X}[index{X}];
float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};
if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)
{
index{X}+=1;
float nextShadow=0.;
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
nextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
nextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
nextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
shadow=mix(nextShadow,shadow,diffRatio);
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);
#endif
}
#endif
}
#elif defined(SHADOWCLOSEESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPOISSON{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#else
#if defined(SHADOWCUBE{X})
shadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#endif
#ifdef SHADOWONLY
#ifndef SHADOWINUSE
#define SHADOWINUSE
#endif
globalShadow+=shadow;
shadowLightCount+=1.0;
#endif
#else
shadow=1.;
#endif
#ifndef SHADOWONLY
#ifdef CUSTOMUSERLIGHTING
diffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);
#ifdef SPECULARTERM
specularBase+=computeCustomSpecularLighting(info,specularBase,shadow);
#endif
#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})
diffuseBase+=lightmapColor.rgb*shadow;
#ifdef SPECULARTERM
#ifndef LIGHTMAPNOSPECULAR{X}
specularBase+=info.specular*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef CLEARCOAT
#ifndef LIGHTMAPNOSPECULAR{X}
clearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef SHEEN
#ifndef LIGHTMAPNOSPECULAR{X}
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#else
#ifdef SHADOWCSMDEBUG{X}
diffuseBase+=info.diffuse*shadowDebug{X};
#else
diffuseBase+=info.diffuse*shadow;
#endif
#ifdef SPECULARTERM
specularBase+=info.specular*shadow;
#endif
#ifdef CLEARCOAT
clearCoatBase+=info.clearCoat.rgb*shadow;
#endif
#ifdef SHEEN
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#endif
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R=`#ifdef FOG
float fog=CalcFogFactor();
color.rgb=fog*color.rgb+(1.0-fog)*vFogColor;
#endif`;o(8).a.IncludesShadersStore.fogFragment=R},function(Ja,t,o){"use strict";var R="fogVertexDeclaration",r=`#ifdef FOG
varying vec3 vFogDistance;
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="shadowsVertex",r=`#ifdef SHADOWS
#if defined(SHADOWCSM{X})
vPositionFromCamera{X}=view*worldPos;
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {
vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;
vDepthMetric{X}[i]=((vPositionFromLight{X}[i].z+light{X}.depthValues.x)/(light{X}.depthValues.y));
}
#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})
vPositionFromLight{X}=lightMatrix{X}*worldPos;
vDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));
#endif
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.Eval=function(I,i){return"true"===(I=I.match(/\([^\(\)]*\)/g)?I.replace(/\([^\(\)]*\)/g,function(G){return G=G.slice(1,G.length-1),r._HandleParenthesisContent(G,i)}):r._HandleParenthesisContent(I,i))||"false"!==I&&r.Eval(I,i)},r._HandleParenthesisContent=function(I,i){var G;i=i||function(q){return"true"===q};var D=I.split("||");for(var E in D)if(D.hasOwnProperty(E)){var x=r._SimplifyNegation(D[E].trim()),l=x.split("&&");if(l.length>1)for(var s=0;s<l.length;++s){var y=r._SimplifyNegation(l[s].trim());if(!(G="true"!==y&&"false"!==y?"!"===y[0]?!i(y.substring(1)):i(y):"true"===y)){x="false";break}}if(G||"true"===x){G=!0;break}G="true"!==x&&"false"!==x?"!"===x[0]?!i(x.substring(1)):i(x):"true"===x}return G?"true":"false"},r._SimplifyNegation=function(I){return"!true"===(I=(I=I.replace(/^[\s!]+/,function(i){return(i=i.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?I="false":"!false"===I&&(I="true"),I},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.ExponentialBackoff=function(I,i){return void 0===I&&(I=3),void 0===i&&(i=500),function(G,D,E){return 0!==D.status||E>=I||-1!==G.indexOf("file:")?-1:Math.pow(2,E)*i}},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"zOffset",{get:function(){return this._zOffset},set:function(I){this._zOffset!==I&&(this._zOffset=I,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cullFace",{get:function(){return this._cullFace},set:function(I){this._cullFace!==I&&(this._cullFace=I,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cull",{get:function(){return this._cull},set:function(I){this._cull!==I&&(this._cull=I,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(I){this._depthFunc!==I&&(this._depthFunc=I,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"depthMask",{get:function(){return this._depthMask},set:function(I){this._depthMask!==I&&(this._depthMask=I,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"depthTest",{get:function(){return this._depthTest},set:function(I){this._depthTest!==I&&(this._depthTest=I,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"frontFace",{get:function(){return this._frontFace},set:function(I){this._frontFace!==I&&(this._frontFace=I,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},r.prototype.apply=function(I){this.isDirty&&(this._isCullDirty&&(this.cull?I.enable(I.CULL_FACE):I.disable(I.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(I.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(I.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?I.enable(I.DEPTH_TEST):I.disable(I.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(I.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(I.enable(I.POLYGON_OFFSET_FILL),I.polygonOffset(this.zOffset,0)):I.disable(I.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(I.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(2),r=function(){function I(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(I.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(i){this._stencilFunc!==i&&(this._stencilFunc=i,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(i){this._stencilFuncRef!==i&&(this._stencilFuncRef=i,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(i){this._stencilFuncMask!==i&&(this._stencilFuncMask=i,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(i){this._stencilOpStencilFail!==i&&(this._stencilOpStencilFail=i,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(i){this._stencilOpDepthFail!==i&&(this._stencilOpDepthFail=i,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(i){this._stencilOpStencilDepthPass!==i&&(this._stencilOpStencilDepthPass=i,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(i){this._stencilMask!==i&&(this._stencilMask=i,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(i){this._stencilTest!==i&&(this._stencilTest=i,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),I.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=I.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=I.KEEP,this._stencilOpDepthFail=I.KEEP,this._stencilOpStencilDepthPass=I.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},I.prototype.apply=function(i){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(i.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(i.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(i.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},I.ALWAYS=R.a.ALWAYS,I.KEEP=R.a.KEEP,I.REPLACE=R.a.REPLACE,I}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(I){this._alphaBlend!==I&&(this._alphaBlend=I,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),r.prototype.setAlphaBlendConstants=function(I,i,G,D){this._blendConstants[0]===I&&this._blendConstants[1]===i&&this._blendConstants[2]===G&&this._blendConstants[3]===D||(this._blendConstants[0]=I,this._blendConstants[1]=i,this._blendConstants[2]=G,this._blendConstants[3]=D,this._isBlendConstantsDirty=!0)},r.prototype.setAlphaBlendFunctionParameters=function(I,i,G,D){this._blendFunctionParameters[0]===I&&this._blendFunctionParameters[1]===i&&this._blendFunctionParameters[2]===G&&this._blendFunctionParameters[3]===D||(this._blendFunctionParameters[0]=I,this._blendFunctionParameters[1]=i,this._blendFunctionParameters[2]=G,this._blendFunctionParameters[3]=D,this._isBlendFunctionParametersDirty=!0)},r.prototype.setAlphaEquationParameters=function(I,i){this._blendEquationParameters[0]===I&&this._blendEquationParameters[1]===i||(this._blendEquationParameters[0]=I,this._blendEquationParameters[1]=i,this._isBlendEquationParametersDirty=!0)},r.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},r.prototype.apply=function(I){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?I.enable(I.BLEND):I.disable(I.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(I.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(I.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(I.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(r.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!0,configurable:!0}),r.prototype._handlesSpectorRebuildCallback=function(I){I&&this.program&&I(this.program)},r}()},function(Ja,t,o){"use strict";var R;o.d(t,"a",function(){return i}),function(G){G[G.Pending=0]="Pending",G[G.Fulfilled=1]="Fulfilled",G[G.Rejected=2]="Rejected"}(R||(R={}));var r=function(){this.count=0,this.target=0,this.results=[]},I=function(){function G(D){var E=this;if(this._state=R.Pending,this._children=new Array(),this._rejectWasConsumed=!1,D)try{D(function(x){E._resolve(x)},function(x){E._reject(x)})}catch(x){this._reject(x)}}return Object.defineProperty(G.prototype,"_result",{get:function(){return this._resultValue},set:function(D){this._resultValue=D,this._parent&&void 0===this._parent._result&&(this._parent._result=D)},enumerable:!0,configurable:!0}),G.prototype.catch=function(D){return this.then(void 0,D)},G.prototype.then=function(D,E){var x=this,l=new G();return l._onFulfilled=D,l._onRejected=E,this._children.push(l),l._parent=this,this._state!==R.Pending&&setTimeout(function(){if(x._state===R.Fulfilled||x._rejectWasConsumed){var s=l._resolve(x._result);if(null!=s)if(void 0!==s._state){var y=s;l._children.push(y),y._parent=l,l=y}else l._result=s}else l._reject(x._reason)}),l},G.prototype._moveChildren=function(D){var E,x=this;if((E=this._children).push.apply(E,D.splice(0,D.length)),this._children.forEach(function(n){n._parent=x}),this._state===R.Fulfilled)for(var l=0,s=this._children;l<s.length;l++)s[l]._resolve(this._result);else if(this._state===R.Rejected)for(var y=0,q=this._children;y<q.length;y++)q[y]._reject(this._reason)},G.prototype._resolve=function(D){try{this._state=R.Fulfilled;var E=null;if(this._onFulfilled&&(E=this._onFulfilled(D)),null!=E)if(void 0!==E._state){var x=E;x._parent=this,x._moveChildren(this._children),D=x._result}else D=E;this._result=D;for(var l=0,s=this._children;l<s.length;l++)s[l]._resolve(D);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(y){this._reject(y,!0)}},G.prototype._reject=function(D,E){if(void 0===E&&(E=!1),this._state=R.Rejected,this._reason=D,this._onRejected&&!E)try{this._onRejected(D),this._rejectWasConsumed=!0}catch(y){D=y}for(var x=0,l=this._children;x<l.length;x++){var s=l[x];this._rejectWasConsumed?s._resolve(null):s._reject(D)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},G.resolve=function(D){var E=new G();return E._resolve(D),E},G._RegisterForFulfillment=function(D,E,x){D.then(function(l){return E.results[x]=l,E.count++,E.count===E.target&&E.rootPromise._resolve(E.results),null},function(l){E.rootPromise._state!==R.Rejected&&E.rootPromise._reject(l)})},G.all=function(D){var E=new G(),x=new r();if(x.target=D.length,x.rootPromise=E,D.length)for(var l=0;l<D.length;l++)G._RegisterForFulfillment(D[l],x,l);else E._resolve([]);return E},G.race=function(D){var E=new G();if(D.length)for(var x=0,l=D;x<l.length;x++)l[x].then(function(s){return E&&(E._resolve(s),E=null),null},function(s){E&&(E._reject(s),E=null)});return E},G}(),i=function(){function G(){}return G.Apply=function(D){(void 0===D&&(D=!1),D||"undefined"==typeof Promise)&&(window.Promise=I)},G}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r}),o.d(t,"b",function(){return I});var R=o(52),r=function(){function i(G){void 0===G&&(G=30),this._enabled=!0,this._rollingFrameTime=new I(G)}return i.prototype.sampleFrame=function(G){if(void 0===G&&(G=R.a.Now),this._enabled){if(null!=this._lastFrameTimeMs){var D=G-this._lastFrameTimeMs;this._rollingFrameTime.add(D)}this._lastFrameTimeMs=G}},Object.defineProperty(i.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"averageFPS",{get:function(){return 1000/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"instantaneousFPS",{get:function(){var G=this._rollingFrameTime.history(0);return 0===G?0:1000/G},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),i.prototype.enable=function(){this._enabled=!0},i.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),i.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},i}(),I=function(){function i(G){this._samples=new Array(G),this.reset()}return i.prototype.add=function(G){var D;if(this.isSaturated()){var E=this._samples[this._pos];D=E-this.average,this.average-=D/(this._sampleCount-1),this._m2-=D*(E-this.average)}else this._sampleCount++;D=G-this.average,this.average+=D/this._sampleCount,this._m2+=D*(G-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=G,this._pos++,this._pos%=this._samples.length},i.prototype.history=function(G){if(G>=this._sampleCount||G>=this._samples.length)return 0;var D=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(D-G)]},i.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},i.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},i.prototype._wrapPosition=function(G){var D=this._samples.length;return(G%D+D)%D},i}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return r});var R=o(0),r=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._collider=null,this._oldPositionForCollisions=new R.e(0,0,0),this._diffPositionForCollisions=new R.e(0,0,0)}},function(Ja,t,o){"use strict";o.d(t,"a",function(){return i});var R=o(34),r=o(0),I=o(2),i=function(){function G(D,E,x,l,s){void 0===x&&(x=null),void 0===l&&(l=null),void 0===s&&(s=null),this.index=D,this._opaqueSubMeshes=new R.a(256),this._transparentSubMeshes=new R.a(256),this._alphaTestSubMeshes=new R.a(256),this._depthOnlySubMeshes=new R.a(256),this._particleSystems=new R.a(256),this._spriteManagers=new R.a(256),this._edgesRenderers=new R.a(16),this._scene=E,this.opaqueSortCompareFn=x,this.alphaTestSortCompareFn=l,this.transparentSortCompareFn=s}return Object.defineProperty(G.prototype,"opaqueSortCompareFn",{set:function(D){this._opaqueSortCompareFn=D,this._renderOpaque=D?this.renderOpaqueSorted:G.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"alphaTestSortCompareFn",{set:function(D){this._alphaTestSortCompareFn=D,this._renderAlphaTest=D?this.renderAlphaTestSorted:G.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"transparentSortCompareFn",{set:function(D){this._transparentSortCompareFn=D||G.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),G.prototype.render=function(D,E,x,l){if(D)D(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var s=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(s.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),s.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var y=s.getStencilBuffer();if(s.setStencilBuffer(!1),E&&this._renderSprites(),x&&this._renderParticles(l),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),s.setAlphaMode(I.a.ALPHA_DISABLE)),s.setStencilBuffer(!1),this._edgesRenderers.length){for(var q=0;q<this._edgesRenderers.length;q++)this._edgesRenderers.data[q].render();s.setAlphaMode(I.a.ALPHA_DISABLE)}s.setStencilBuffer(y)}},G.prototype.renderOpaqueSorted=function(D){return G.renderSorted(D,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},G.prototype.renderAlphaTestSorted=function(D){return G.renderSorted(D,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},G.prototype.renderTransparentSorted=function(D){return G.renderSorted(D,this._transparentSortCompareFn,this._scene.activeCamera,!0)},G.renderSorted=function(D,E,x,l){for(var s,y=0,q=x?x.globalPosition:G._zeroVector;y<D.length;y++)(s=D.data[y])._alphaIndex=s.getMesh().alphaIndex,s._distanceToCamera=r.e.Distance(s.getBoundingInfo().boundingSphere.centerWorld,q);var n=D.data.slice(0,D.length);for(E&&n.sort(E),y=0;y<n.length;y++){if(s=n[y],l){var k=s.getMaterial();if(k&&k.needDepthPrePass){var p=k.getScene().getEngine();p.setColorWrite(!1),p.setAlphaMode(I.a.ALPHA_DISABLE),s.render(!1),p.setColorWrite(!0)}}s.render(l)}},G.renderUnsorted=function(D){for(var E=0;E<D.length;E++)D.data[E].render(!1)},G.defaultTransparentSortCompare=function(D,E){return D._alphaIndex>E._alphaIndex?1:D._alphaIndex<E._alphaIndex?-1:G.backToFrontSortCompare(D,E)},G.backToFrontSortCompare=function(D,E){return D._distanceToCamera<E._distanceToCamera?1:D._distanceToCamera>E._distanceToCamera?-1:0},G.frontToBackSortCompare=function(D,E){return D._distanceToCamera<E._distanceToCamera?-1:D._distanceToCamera>E._distanceToCamera?1:0},G.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},G.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},G.prototype.dispatch=function(D,E,x){void 0===E&&(E=D.getMesh()),void 0===x&&(x=D.getMaterial()),null!=x&&(x.needAlphaBlendingForMesh(E)?this._transparentSubMeshes.push(D):x.needAlphaTesting()?(x.needDepthPrePass&&this._depthOnlySubMeshes.push(D),this._alphaTestSubMeshes.push(D)):(x.needDepthPrePass&&this._depthOnlySubMeshes.push(D),this._opaqueSubMeshes.push(D)),E._renderingGroup=this,E._edgesRenderer&&E._edgesRenderer.isEnabled&&this._edgesRenderers.push(E._edgesRenderer))},G.prototype.dispatchSprites=function(D){this._spriteManagers.push(D)},G.prototype.dispatchParticles=function(D){this._particleSystems.push(D)},G.prototype._renderParticles=function(D){if(0!==this._particleSystems.length){var E=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var x=0;x<this._particleSystems.length;x++){var l=this._particleSystems.data[x];if(0!==(E&&E.layerMask&l.layerMask)){var s=l.emitter;s.position&&D&&-1===D.indexOf(s)||this._scene._activeParticles.addCount(l.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},G.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var D=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var E=0;E<this._spriteManagers.length;E++){var x=this._spriteManagers.data[E];0!==(D&&D.layerMask&x.layerMask)&&x.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},G._zeroVector=r.e.Zero(),G}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(r,I){this.distance=r,this.mesh=I}},function(Ja,t,o){"use strict";o.d(t,"a",function(){return l});var R=o(1),r=o(0),I=o(7),i=o(27),G=o(5),D=o(33),E=o(43),x=o(4);G.a._instancedMeshFactory=function(s,y){var q=new l(s,y);if(y.instancedBuffers)for(var n in q.instancedBuffers={},y.instancedBuffers)q.instancedBuffers[n]=y.instancedBuffers[n];return q};var l=function(s){function y(q,n){var k=s.call(this,q,n.getScene())||this;k._indexInSourceMeshInstanceArray=-1,n.addInstance(k),k._sourceMesh=n,k._unIndexed=n._unIndexed,k.position.copyFrom(n.position),k.rotation.copyFrom(n.rotation),k.scaling.copyFrom(n.scaling),n.rotationQuaternion&&(k.rotationQuaternion=n.rotationQuaternion.clone()),k.animations=n.animations;for(var p=0,u=n.getAnimationRanges();p<u.length;p++){var A=u[p];null!=A&&k.createAnimationRange(A.name,A.from,A.to)}return k.infiniteDistance=n.infiniteDistance,k.setPivotMatrix(n.getPivotMatrix()),k.refreshBoundingInfo(),k._syncSubMeshes(),k}return Object(R.d)(y,s),y.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(y.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!0,configurable:!0}),y.prototype._resyncLightSources=function(){},y.prototype._resyncLightSource=function(q){},y.prototype._removeLightSource=function(q,n){},Object.defineProperty(y.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(q){this._sourceMesh&&q!==this._sourceMesh.renderingGroupId&&I.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),y.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},y.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(y.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),y.prototype.isReady=function(q){return void 0===q&&(q=!1),this._sourceMesh.isReady(q,!0)},y.prototype.getVerticesData=function(q,n){return this._sourceMesh.getVerticesData(q,n)},y.prototype.setVerticesData=function(q,n,k,p){return this.sourceMesh&&this.sourceMesh.setVerticesData(q,n,k,p),this.sourceMesh},y.prototype.updateVerticesData=function(q,n,k,p){return this.sourceMesh&&this.sourceMesh.updateVerticesData(q,n,k,p),this.sourceMesh},y.prototype.setIndices=function(q,n){return void 0===n&&(n=null),this.sourceMesh&&this.sourceMesh.setIndices(q,n),this.sourceMesh},y.prototype.isVerticesDataPresent=function(q){return this._sourceMesh.isVerticesDataPresent(q)},y.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(y.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),y.prototype.refreshBoundingInfo=function(q){if(void 0===q&&(q=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var n=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(q),n),this},y.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},y.prototype._activate=function(q,n){if(this._sourceMesh.subMeshes||I.a.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>0!=this._getWorldMatrixDeterminant()>0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,q),n){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},y.prototype._postActivate=function(){this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},y.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==E.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var q=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,r.c.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),r.c.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(r.c.Vector3[7]),this._currentLOD._masterMesh=q,r.c.Matrix[0]}return s.prototype.getWorldMatrix.call(this)},Object.defineProperty(y.prototype,"isAnInstance",{get:function(){return!0},enumerable:!0,configurable:!0}),y.prototype.getLOD=function(q){if(!q)return this;var n=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(q,n.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},y.prototype._preActivateForIntermediateRendering=function(q){return this.sourceMesh._preActivateForIntermediateRendering(q)},y.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var q=0;q<this._sourceMesh.subMeshes.length;q++)this._sourceMesh.subMeshes[q].clone(this,this._sourceMesh);return this},y.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},y.prototype.clone=function(q,n,k){void 0===n&&(n=null);var p=this._sourceMesh.createInstance(q);if(D.a.DeepCopy(this,p,["name","subMeshes","uniqueId","parent"],[]),this.refreshBoundingInfo(),n&&(p.parent=n),!k)for(var u=0;u<this.getScene().meshes.length;u++){var A=this.getScene().meshes[u];A.parent===this&&A.clone(A.name,p)}return p.computeWorldMatrix(!0),p},y.prototype.dispose=function(q,n){void 0===n&&(n=!1),this._sourceMesh.removeInstance(this),s.prototype.dispose.call(this,q,n)},y}(i.a);G.a.prototype.registerInstancedBuffer=function(s,y){if(this.removeVerticesData(s),!this.instancedBuffers){this.instancedBuffers={};for(var q=0,n=this.instances;q<n.length;q++)n[q].instancedBuffers={};this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[s]=null,this._userInstancedBuffersStorage.strides[s]=y,this._userInstancedBuffersStorage.sizes[s]=32*y,this._userInstancedBuffersStorage.data[s]=new Float32Array(this._userInstancedBuffersStorage.sizes[s]),this._userInstancedBuffersStorage.vertexBuffers[s]=new x.b(this.getEngine(),this._userInstancedBuffersStorage.data[s],s,!0,!1,y,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[s]);for(var k=0,p=this.instances;k<p.length;k++)p[k].instancedBuffers[s]=null},G.a.prototype._processInstancedBuffers=function(s,y){var q=s.length;for(var n in this.instancedBuffers){for(var k=this._userInstancedBuffersStorage.sizes[n],p=this._userInstancedBuffersStorage.strides[n],u=(q+1)*p;k<u;)k*=2;this._userInstancedBuffersStorage.data[n].length!=k&&(this._userInstancedBuffersStorage.data[n]=new Float32Array(k),this._userInstancedBuffersStorage.sizes[n]=k,this._userInstancedBuffersStorage.vertexBuffers[n]&&(this._userInstancedBuffersStorage.vertexBuffers[n].dispose(),this._userInstancedBuffersStorage.vertexBuffers[n]=null));var A=this._userInstancedBuffersStorage.data[n],B=0;y&&(B+=p,(H=this.instancedBuffers[n]).toArray?H.toArray(A,B):H.copyToArray(A,B));for(var v=0;v<q;v++){var H;(H=s[v].instancedBuffers[n]).toArray?H.toArray(A,B):H.copyToArray(A,B),B+=p}this._userInstancedBuffersStorage.vertexBuffers[n]?this._userInstancedBuffersStorage.vertexBuffers[n].updateDirectly(A,0):(this._userInstancedBuffersStorage.vertexBuffers[n]=new x.b(this.getEngine(),this._userInstancedBuffersStorage.data[n],n,!0,!1,p,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[n]))}},G.a.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var s in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[s]&&this._userInstancedBuffersStorage.vertexBuffers[s].dispose();this.instancedBuffers={}}},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return r.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(I){var i=16*Math.random()|0;return("x"===I?i:3&i|8).toString(16)})},r}()},function(Ja,t,o){"use strict";o.d(t,"a",function(){return R});var R=function(){function r(){}return Object.defineProperty(r,"UniqueId",{get:function(){var I=this._UniqueIdCounter;return this._UniqueIdCounter++,I},enumerable:!0,configurable:!0}),r._UniqueIdCounter=0,r}()},function(Ja,t,o){"use strict";var R="lightsFragmentFunctions",r=`
struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef NDOTL
float ndl;
#endif
};
lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 lightVectorW;
float attenuation=1.0;
if (lightData.w == 0.)
{
vec3 direction=lightData.xyz-vPositionW;
attenuation=max(0.,1.0-length(direction)/range);
lightVectorW=normalize(direction);
}
else
{
lightVectorW=normalize(-lightData.xyz);
}

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
lightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 direction=lightData.xyz-vPositionW;
vec3 lightVectorW=normalize(direction);
float attenuation=max(0.,1.0-length(direction)/range);

float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));
if (cosAngle>=lightDirection.w)
{
cosAngle=max(0.,pow(cosAngle,lightData.w));
attenuation*=cosAngle;

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
result.diffuse=vec3(0.);
#ifdef SPECULARTERM
result.specular=vec3(0.);
#endif
#ifdef NDOTL
result.ndl=0.;
#endif
return result;
}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {
lightingInfo result;

float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=mix(groundColor,diffuseColor,ndl);
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightData.xyz);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor;
#endif
return result;
}
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return textureColor;
}`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R="logDepthFragment",r=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)
#if defined(TANGENT) && defined(NORMAL)
vec3 tbnNormal=normalize(normalUpdated);
vec3 tbnTangent=normalize(tangentUpdated.xyz);
vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;
vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);
#endif
#endif`;o(8).a.IncludesShadersStore.bumpVertex=R},function(Ja,t,o){"use strict";var R=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif`;o(8).a.IncludesShadersStore.fogVertex=R},function(Ja,t,o){"use strict";var R="logDepthVertex",r=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;
gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch(R){"object"==typeof window&&(o=window)}Ja.exports=o},function(Ja,t,o){"use strict";var R="fresnelFunction",r=`#ifdef FRESNEL
float computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)
{
float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);
return clamp(fresnelTerm,0.,1.);
}
#endif`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R=`#ifdef DEPTHPREPASS
gl_FragColor=vec4(0.,0.,0.,1.0);
return;
#endif`;o(8).a.IncludesShadersStore.depthPrePass=R},function(Ja,t,o){"use strict";var R="bumpVertexDeclaration",r=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#endif
`;o(8).a.IncludesShadersStore[R]=r},function(Ja,t,o){"use strict";var R=o(8),r=(o(106),o(101),"colorPixelShader"),I=`#ifdef VERTEXCOLOR
varying vec4 vColor;
#else
uniform vec4 color;
#endif
#include<clipPlaneFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
#ifdef VERTEXCOLOR
gl_FragColor=vColor;
#else
gl_FragColor=color;
#endif
}`;R.a.ShadersStore[r]=I},function(Ja,t,o){"use strict";var R=o(8),r=(o(74),o(108),o(77),o(78),o(75),o(102),"colorVertexShader"),I=`
attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<clipPlaneVertexDeclaration>

#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef MULTIVIEW
uniform mat4 viewProjectionR;
#endif

#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
#include<clipPlaneVertex>
#ifdef VERTEXCOLOR

vColor=color;
#endif
}`;R.a.ShadersStore[r]=I},function(Ja,t,o){"use strict";(function(R){o.d(t,"b",function(){return l}),o.d(t,"a",function(){return s});var r=o(1),I=o(7),i=o(11),G=o(95),D=o(25),E=o(2),x=o(85),l=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4},s=function(y){function q(n){void 0===n&&(n=new l());var k=y.call(this,null)||this;i.a.Instances.push(k),void 0===n.deterministicLockstep&&(n.deterministicLockstep=!1),void 0===n.lockstepMaxSteps&&(n.lockstepMaxSteps=4),k._options=n,k._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!1,astc:null,pvrtc:null,etc1:null,etc2:null,maxAnisotropy:0,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!1,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!1,instancedArrays:!1,canUseTimestampForTimerQuery:!1,maxMSAASamples:1,blendMinMax:!1},I.a.Log("Babylon.js v"+i.a.Version+" - Null engine");var p="undefined"!=typeof self?self:void 0!==R?R:window;return"undefined"==typeof URL&&(p.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(p.Blob=function(){}),k}return Object(r.d)(q,y),q.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},q.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},q.prototype.getHardwareScalingLevel=function(){return 1},q.prototype.createVertexBuffer=function(n){var k=new x.a();return k.references=1,k},q.prototype.createIndexBuffer=function(n){var k=new x.a();return k.references=1,k},q.prototype.clear=function(n,k,p,u){void 0===u&&(u=!1)},q.prototype.getRenderWidth=function(n){return void 0===n&&(n=!1),!n&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},q.prototype.getRenderHeight=function(n){return void 0===n&&(n=!1),!n&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},q.prototype.setViewport=function(n,k,p){this._cachedViewport=n},q.prototype.createShaderProgram=function(n,k,p,u,A){return{__SPECTOR_rebuildProgram:null}},q.prototype.getUniforms=function(n,k){return[]},q.prototype.getAttributes=function(n,k){return[]},q.prototype.bindSamplers=function(n){this._currentEffect=null},q.prototype.enableEffect=function(n){this._currentEffect=n,n.onBind&&n.onBind(n),n._onBindObservable&&n._onBindObservable.notifyObservers(n)},q.prototype.setState=function(n,k,p,u){void 0===k&&(k=0),void 0===u&&(u=!1)},q.prototype.setIntArray=function(n,k){},q.prototype.setIntArray2=function(n,k){},q.prototype.setIntArray3=function(n,k){},q.prototype.setIntArray4=function(n,k){},q.prototype.setFloatArray=function(n,k){},q.prototype.setFloatArray2=function(n,k){},q.prototype.setFloatArray3=function(n,k){},q.prototype.setFloatArray4=function(n,k){},q.prototype.setArray=function(n,k){},q.prototype.setArray2=function(n,k){},q.prototype.setArray3=function(n,k){},q.prototype.setArray4=function(n,k){},q.prototype.setMatrices=function(n,k){},q.prototype.setMatrix3x3=function(n,k){},q.prototype.setMatrix2x2=function(n,k){},q.prototype.setFloat=function(n,k){},q.prototype.setFloat2=function(n,k,p){},q.prototype.setFloat3=function(n,k,p,u){},q.prototype.setBool=function(n,k){},q.prototype.setFloat4=function(n,k,p,u,A){},q.prototype.setAlphaMode=function(n,k){void 0===k&&(k=!1),this._alphaMode!==n&&(this.alphaState.alphaBlend=n!==E.a.ALPHA_DISABLE,k||this.setDepthWrite(n===E.a.ALPHA_DISABLE),this._alphaMode=n)},q.prototype.bindBuffers=function(n,k,p){},q.prototype.wipeCaches=function(n){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,n&&(this._currentProgram=null,this.stencilState.reset(),this.depthCullingState.reset(),this.alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},q.prototype.draw=function(n,k,p,u){},q.prototype.drawElementsType=function(n,k,p,u){},q.prototype.drawArraysType=function(n,k,p,u){},q.prototype._createTexture=function(){return{}},q.prototype._releaseTexture=function(n){},q.prototype.createTexture=function(n,k,p,u,A,B,v,H,L,Q,M,Y){void 0===A&&(A=E.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===B&&(B=null),void 0===v&&(v=null),void 0===H&&(H=null),void 0===L&&(L=null),void 0===Q&&(Q=null),void 0===M&&(M=null);var X=new D.a(this,D.b.Url),U=String(n);return X.url=U,X.generateMipMaps=!k,X.samplingMode=A,X.invertY=p,X.baseWidth=this._options.textureSize,X.baseHeight=this._options.textureSize,X.width=this._options.textureSize,X.height=this._options.textureSize,Q&&(X.format=Q),X.isReady=!0,B&&B(),this._internalTexturesCache.push(X),X},q.prototype.createRenderTargetTexture=function(n,k){var p=new G.a();void 0!==k&&"object"==typeof k?(p.generateMipMaps=k.generateMipMaps,p.generateDepthBuffer=void 0===k.generateDepthBuffer||k.generateDepthBuffer,p.generateStencilBuffer=p.generateDepthBuffer&&k.generateStencilBuffer,p.type=void 0===k.type?E.a.TEXTURETYPE_UNSIGNED_INT:k.type,p.samplingMode=void 0===k.samplingMode?E.a.TEXTURE_TRILINEAR_SAMPLINGMODE:k.samplingMode):(p.generateMipMaps=k,p.generateDepthBuffer=!0,p.generateStencilBuffer=!1,p.type=E.a.TEXTURETYPE_UNSIGNED_INT,p.samplingMode=E.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var u=new D.a(this,D.b.RenderTarget),A=n.width||n,B=n.height||n;return u._depthStencilBuffer={},u._framebuffer={},u.baseWidth=A,u.baseHeight=B,u.width=A,u.height=B,u.isReady=!0,u.samples=1,u.generateMipMaps=!!p.generateMipMaps,u.samplingMode=p.samplingMode,u.type=p.type,u._generateDepthBuffer=p.generateDepthBuffer,u._generateStencilBuffer=!!p.generateStencilBuffer,this._internalTexturesCache.push(u),u},q.prototype.updateTextureSamplingMode=function(n,k){k.samplingMode=n},q.prototype.bindFramebuffer=function(n,k,p,u,A){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=n,this._currentFramebuffer=n._MSAAFramebuffer?n._MSAAFramebuffer:n._framebuffer,this._cachedViewport&&!A&&this.setViewport(this._cachedViewport,p,u)},q.prototype.unBindFramebuffer=function(n,k,p){void 0===k&&(k=!1),this._currentRenderTarget=null,p&&(n._MSAAFramebuffer&&(this._currentFramebuffer=n._framebuffer),p()),this._currentFramebuffer=null},q.prototype.createDynamicVertexBuffer=function(n){var k=new x.a();return k.references=1,k.capacity=1,k},q.prototype.updateDynamicTexture=function(n,k,p,u,A){void 0===u&&(u=!1)},q.prototype.areAllEffectsReady=function(){return!0},q.prototype.getError=function(){return 0},q.prototype._getUnpackAlignement=function(){return 1},q.prototype._unpackFlipY=function(n){},q.prototype.updateDynamicIndexBuffer=function(n,k,p){void 0===p&&(p=0)},q.prototype.updateDynamicVertexBuffer=function(n,k,p,u){},q.prototype._bindTextureDirectly=function(n,k){return this._boundTexturesCache[this._activeChannel]!==k&&(this._boundTexturesCache[this._activeChannel]=k,!0)},q.prototype._bindTexture=function(n,k){n<0||this._bindTextureDirectly(0,k)},q.prototype._deleteBuffer=function(n){},q.prototype.releaseEffects=function(){},q.prototype.displayLoadingUI=function(){},q.prototype.hideLoadingUI=function(){},q.prototype._uploadCompressedDataToTextureDirectly=function(n,k,p,u,A,B,v){void 0===B&&(B=0),void 0===v&&(v=0)},q.prototype._uploadDataToTextureDirectly=function(n,k,p,u){void 0===p&&(p=0),void 0===u&&(u=0)},q.prototype._uploadArrayBufferViewToTexture=function(n,k,p,u){void 0===p&&(p=0),void 0===u&&(u=0)},q.prototype._uploadImageToTexture=function(n,k,p,u){void 0===p&&(p=0),void 0===u&&(u=0)},q}(i.a)}).call(this,o(144))},function(Ja,t,o){"use strict";o.r(t),function(R){o.d(t,"Debug",function(){return x});var r=o(114),I=o(93);o.d(t,"AbstractScene",function(){return r.AbstractScene}),o.d(t,"KeepAssets",function(){return r.KeepAssets}),o.d(t,"InstantiatedEntries",function(){return r.InstantiatedEntries}),o.d(t,"AssetContainer",function(){return r.AssetContainer}),o.d(t,"Node",function(){return r.Node}),o.d(t,"Scene",function(){return r.Scene}),o.d(t,"SceneComponentConstants",function(){return r.SceneComponentConstants}),o.d(t,"Stage",function(){return r.Stage}),o.d(t,"AbstractActionManager",function(){return r.AbstractActionManager}),o.d(t,"Action",function(){return r.Action}),o.d(t,"ActionEvent",function(){return r.ActionEvent}),o.d(t,"ActionManager",function(){return r.ActionManager}),o.d(t,"Condition",function(){return r.Condition}),o.d(t,"ValueCondition",function(){return r.ValueCondition}),o.d(t,"PredicateCondition",function(){return r.PredicateCondition}),o.d(t,"StateCondition",function(){return r.StateCondition}),o.d(t,"SwitchBooleanAction",function(){return r.SwitchBooleanAction}),o.d(t,"SetStateAction",function(){return r.SetStateAction}),o.d(t,"SetValueAction",function(){return r.SetValueAction}),o.d(t,"IncrementValueAction",function(){return r.IncrementValueAction}),o.d(t,"PlayAnimationAction",function(){return r.PlayAnimationAction}),o.d(t,"StopAnimationAction",function(){return r.StopAnimationAction}),o.d(t,"DoNothingAction",function(){return r.DoNothingAction}),o.d(t,"CombineAction",function(){return r.CombineAction}),o.d(t,"ExecuteCodeAction",function(){return r.ExecuteCodeAction}),o.d(t,"SetParentAction",function(){return r.SetParentAction}),o.d(t,"PlaySoundAction",function(){return r.PlaySoundAction}),o.d(t,"StopSoundAction",function(){return r.StopSoundAction}),o.d(t,"InterpolateValueAction",function(){return r.InterpolateValueAction}),o.d(t,"Animatable",function(){return r.Animatable}),o.d(t,"_IAnimationState",function(){return r._IAnimationState}),o.d(t,"Animation",function(){return r.Animation}),o.d(t,"TargetedAnimation",function(){return r.TargetedAnimation}),o.d(t,"AnimationGroup",function(){return r.AnimationGroup}),o.d(t,"AnimationPropertiesOverride",function(){return r.AnimationPropertiesOverride}),o.d(t,"EasingFunction",function(){return r.EasingFunction}),o.d(t,"CircleEase",function(){return r.CircleEase}),o.d(t,"BackEase",function(){return r.BackEase}),o.d(t,"BounceEase",function(){return r.BounceEase}),o.d(t,"CubicEase",function(){return r.CubicEase}),o.d(t,"ElasticEase",function(){return r.ElasticEase}),o.d(t,"ExponentialEase",function(){return r.ExponentialEase}),o.d(t,"PowerEase",function(){return r.PowerEase}),o.d(t,"QuadraticEase",function(){return r.QuadraticEase}),o.d(t,"QuarticEase",function(){return r.QuarticEase}),o.d(t,"QuinticEase",function(){return r.QuinticEase}),o.d(t,"SineEase",function(){return r.SineEase}),o.d(t,"BezierCurveEase",function(){return r.BezierCurveEase}),o.d(t,"RuntimeAnimation",function(){return r.RuntimeAnimation}),o.d(t,"AnimationEvent",function(){return r.AnimationEvent}),o.d(t,"AnimationKeyInterpolation",function(){return r.AnimationKeyInterpolation}),o.d(t,"AnimationRange",function(){return r.AnimationRange}),o.d(t,"Analyser",function(){return r.Analyser}),o.d(t,"AudioEngine",function(){return r.AudioEngine}),o.d(t,"AudioSceneComponent",function(){return r.AudioSceneComponent}),o.d(t,"Sound",function(){return r.Sound}),o.d(t,"SoundTrack",function(){return r.SoundTrack}),o.d(t,"WeightedSound",function(){return r.WeightedSound}),o.d(t,"Bone",function(){return r.Bone}),o.d(t,"BoneIKController",function(){return r.BoneIKController}),o.d(t,"BoneLookController",function(){return r.BoneLookController}),o.d(t,"Skeleton",function(){return r.Skeleton}),o.d(t,"CameraInputTypes",function(){return r.CameraInputTypes}),o.d(t,"CameraInputsManager",function(){return r.CameraInputsManager}),o.d(t,"Camera",function(){return r.Camera}),o.d(t,"TargetCamera",function(){return r.TargetCamera}),o.d(t,"FreeCamera",function(){return r.FreeCamera}),o.d(t,"FreeCameraInputsManager",function(){return r.FreeCameraInputsManager}),o.d(t,"TouchCamera",function(){return r.TouchCamera}),o.d(t,"ArcRotateCamera",function(){return r.ArcRotateCamera}),o.d(t,"ArcRotateCameraInputsManager",function(){return r.ArcRotateCameraInputsManager}),o.d(t,"DeviceOrientationCamera",function(){return r.DeviceOrientationCamera}),o.d(t,"FlyCamera",function(){return r.FlyCamera}),o.d(t,"FlyCameraInputsManager",function(){return r.FlyCameraInputsManager}),o.d(t,"FollowCamera",function(){return r.FollowCamera}),o.d(t,"ArcFollowCamera",function(){return r.ArcFollowCamera}),o.d(t,"FollowCameraInputsManager",function(){return r.FollowCameraInputsManager}),o.d(t,"GamepadCamera",function(){return r.GamepadCamera}),o.d(t,"UniversalCamera",function(){return r.UniversalCamera}),o.d(t,"VirtualJoysticksCamera",function(){return r.VirtualJoysticksCamera}),o.d(t,"Collider",function(){return r.Collider}),o.d(t,"DefaultCollisionCoordinator",function(){return r.DefaultCollisionCoordinator}),o.d(t,"PickingInfo",function(){return r.PickingInfo}),o.d(t,"IntersectionInfo",function(){return r.IntersectionInfo}),o.d(t,"_MeshCollisionData",function(){return r._MeshCollisionData}),o.d(t,"BoundingBox",function(){return r.BoundingBox}),o.d(t,"BoundingInfo",function(){return r.BoundingInfo}),o.d(t,"BoundingSphere",function(){return r.BoundingSphere}),o.d(t,"Ray",function(){return r.Ray}),o.d(t,"AxesViewer",function(){return r.AxesViewer}),o.d(t,"BoneAxesViewer",function(){return r.BoneAxesViewer}),o.d(t,"DebugLayerTab",function(){return r.DebugLayerTab}),o.d(t,"DebugLayer",function(){return r.DebugLayer}),o.d(t,"PhysicsViewer",function(){return r.PhysicsViewer}),o.d(t,"RayHelper",function(){return r.RayHelper}),o.d(t,"SkeletonViewer",function(){return r.SkeletonViewer}),o.d(t,"Constants",function(){return r.Constants}),o.d(t,"ThinEngine",function(){return r.ThinEngine}),o.d(t,"Engine",function(){return r.Engine}),o.d(t,"EngineStore",function(){return r.EngineStore}),o.d(t,"NullEngineOptions",function(){return r.NullEngineOptions}),o.d(t,"NullEngine",function(){return r.NullEngine}),o.d(t,"WebGLPipelineContext",function(){return r.WebGLPipelineContext}),o.d(t,"WebGL2ShaderProcessor",function(){return r.WebGL2ShaderProcessor}),o.d(t,"NativeEngine",function(){return r.NativeEngine}),o.d(t,"KeyboardEventTypes",function(){return r.KeyboardEventTypes}),o.d(t,"KeyboardInfo",function(){return r.KeyboardInfo}),o.d(t,"KeyboardInfoPre",function(){return r.KeyboardInfoPre}),o.d(t,"PointerEventTypes",function(){return r.PointerEventTypes}),o.d(t,"PointerInfoBase",function(){return r.PointerInfoBase}),o.d(t,"PointerInfoPre",function(){return r.PointerInfoPre}),o.d(t,"PointerInfo",function(){return r.PointerInfo}),o.d(t,"ClipboardEventTypes",function(){return r.ClipboardEventTypes}),o.d(t,"ClipboardInfo",function(){return r.ClipboardInfo}),o.d(t,"StickValues",function(){return r.StickValues}),o.d(t,"Gamepad",function(){return r.Gamepad}),o.d(t,"GenericPad",function(){return r.GenericPad}),o.d(t,"GamepadManager",function(){return r.GamepadManager}),o.d(t,"GamepadSystemSceneComponent",function(){return r.GamepadSystemSceneComponent}),o.d(t,"Xbox360Button",function(){return r.Xbox360Button}),o.d(t,"Xbox360Dpad",function(){return r.Xbox360Dpad}),o.d(t,"Xbox360Pad",function(){return r.Xbox360Pad}),o.d(t,"DualShockButton",function(){return r.DualShockButton}),o.d(t,"DualShockDpad",function(){return r.DualShockDpad}),o.d(t,"DualShockPad",function(){return r.DualShockPad}),o.d(t,"AxisDragGizmo",function(){return r.AxisDragGizmo}),o.d(t,"AxisScaleGizmo",function(){return r.AxisScaleGizmo}),o.d(t,"BoundingBoxGizmo",function(){return r.BoundingBoxGizmo}),o.d(t,"Gizmo",function(){return r.Gizmo}),o.d(t,"GizmoManager",function(){return r.GizmoManager}),o.d(t,"PlaneRotationGizmo",function(){return r.PlaneRotationGizmo}),o.d(t,"PositionGizmo",function(){return r.PositionGizmo}),o.d(t,"RotationGizmo",function(){return r.RotationGizmo}),o.d(t,"ScaleGizmo",function(){return r.ScaleGizmo}),o.d(t,"LightGizmo",function(){return r.LightGizmo}),o.d(t,"PlaneDragGizmo",function(){return r.PlaneDragGizmo}),o.d(t,"EnvironmentHelper",function(){return r.EnvironmentHelper}),o.d(t,"PhotoDome",function(){return r.PhotoDome}),o.d(t,"_forceSceneHelpersToBundle",function(){return r._forceSceneHelpersToBundle}),o.d(t,"VideoDome",function(){return r.VideoDome}),o.d(t,"EngineInstrumentation",function(){return r.EngineInstrumentation}),o.d(t,"SceneInstrumentation",function(){return r.SceneInstrumentation}),o.d(t,"_TimeToken",function(){return r._TimeToken}),o.d(t,"EffectLayer",function(){return r.EffectLayer}),o.d(t,"EffectLayerSceneComponent",function(){return r.EffectLayerSceneComponent}),o.d(t,"GlowLayer",function(){return r.GlowLayer}),o.d(t,"HighlightLayer",function(){return r.HighlightLayer}),o.d(t,"Layer",function(){return r.Layer}),o.d(t,"LayerSceneComponent",function(){return r.LayerSceneComponent}),o.d(t,"LensFlare",function(){return r.LensFlare}),o.d(t,"LensFlareSystem",function(){return r.LensFlareSystem}),o.d(t,"LensFlareSystemSceneComponent",function(){return r.LensFlareSystemSceneComponent}),o.d(t,"Light",function(){return r.Light}),o.d(t,"ShadowLight",function(){return r.ShadowLight}),o.d(t,"DirectionalLight",function(){return r.DirectionalLight}),o.d(t,"HemisphericLight",function(){return r.HemisphericLight}),o.d(t,"PointLight",function(){return r.PointLight}),o.d(t,"SpotLight",function(){return r.SpotLight}),o.d(t,"DefaultLoadingScreen",function(){return r.DefaultLoadingScreen}),o.d(t,"SceneLoaderProgressEvent",function(){return r.SceneLoaderProgressEvent}),o.d(t,"SceneLoaderAnimationGroupLoadingMode",function(){return r.SceneLoaderAnimationGroupLoadingMode}),o.d(t,"SceneLoader",function(){return r.SceneLoader}),o.d(t,"SceneLoaderFlags",function(){return r.SceneLoaderFlags}),o.d(t,"ColorCurves",function(){return r.ColorCurves}),o.d(t,"EffectFallbacks",function(){return r.EffectFallbacks}),o.d(t,"Effect",function(){return r.Effect}),o.d(t,"FresnelParameters",function(){return r.FresnelParameters}),o.d(t,"ImageProcessingConfigurationDefines",function(){return r.ImageProcessingConfigurationDefines}),o.d(t,"ImageProcessingConfiguration",function(){return r.ImageProcessingConfiguration}),o.d(t,"Material",function(){return r.Material}),o.d(t,"MaterialDefines",function(){return r.MaterialDefines}),o.d(t,"MaterialHelper",function(){return r.MaterialHelper}),o.d(t,"MultiMaterial",function(){return r.MultiMaterial}),o.d(t,"PBRMaterial",function(){return r.PBRMaterial}),o.d(t,"PushMaterial",function(){return r.PushMaterial}),o.d(t,"ShaderMaterial",function(){return r.ShaderMaterial}),o.d(t,"StandardMaterialDefines",function(){return r.StandardMaterialDefines}),o.d(t,"StandardMaterial",function(){return r.StandardMaterial}),o.d(t,"BaseTexture",function(){return r.BaseTexture}),o.d(t,"CubeTexture",function(){return r.CubeTexture}),o.d(t,"DynamicTexture",function(){return r.DynamicTexture}),o.d(t,"EquiRectangularCubeTexture",function(){return r.EquiRectangularCubeTexture}),o.d(t,"HDRCubeTexture",function(){return r.HDRCubeTexture}),o.d(t,"InternalTextureSource",function(){return r.InternalTextureSource}),o.d(t,"InternalTexture",function(){return r.InternalTexture}),o.d(t,"MirrorTexture",function(){return r.MirrorTexture}),o.d(t,"MultiRenderTarget",function(){return r.MultiRenderTarget}),o.d(t,"RawTexture",function(){return r.RawTexture}),o.d(t,"RenderTargetTexture",function(){return r.RenderTargetTexture}),o.d(t,"Texture",function(){return r.Texture}),o.d(t,"UniformBuffer",function(){return r.UniformBuffer}),o.d(t,"MaterialFlags",function(){return r.MaterialFlags}),o.d(t,"EffectRenderer",function(){return r.EffectRenderer}),o.d(t,"EffectWrapper",function(){return r.EffectWrapper}),o.d(t,"Scalar",function(){return r.Scalar}),o.d(t,"Space",function(){return r.Space}),o.d(t,"Axis",function(){return r.Axis}),o.d(t,"Color3",function(){return r.Color3}),o.d(t,"Color4",function(){return r.Color4}),o.d(t,"TmpColors",function(){return r.TmpColors}),o.d(t,"ToGammaSpace",function(){return r.ToGammaSpace}),o.d(t,"ToLinearSpace",function(){return r.ToLinearSpace}),o.d(t,"Epsilon",function(){return r.Epsilon}),o.d(t,"Frustum",function(){return r.Frustum}),o.d(t,"Plane",function(){return r.Plane}),o.d(t,"Size",function(){return r.Size}),o.d(t,"Vector2",function(){return r.Vector2}),o.d(t,"Vector3",function(){return r.Vector3}),o.d(t,"Vector4",function(){return r.Vector4}),o.d(t,"Quaternion",function(){return r.Quaternion}),o.d(t,"Matrix",function(){return r.Matrix}),o.d(t,"TmpVectors",function(){return r.TmpVectors}),o.d(t,"Viewport",function(){return r.Viewport}),o.d(t,"SphericalHarmonics",function(){return r.SphericalHarmonics}),o.d(t,"SphericalPolynomial",function(){return r.SphericalPolynomial}),o.d(t,"AbstractMesh",function(){return r.AbstractMesh}),o.d(t,"Buffer",function(){return r.Buffer}),o.d(t,"VertexBuffer",function(){return r.VertexBuffer}),o.d(t,"CSG",function(){return r.CSG}),o.d(t,"Geometry",function(){return r.Geometry}),o.d(t,"GroundMesh",function(){return r.GroundMesh}),o.d(t,"TrailMesh",function(){return r.TrailMesh}),o.d(t,"InstancedMesh",function(){return r.InstancedMesh}),o.d(t,"LinesMesh",function(){return r.LinesMesh}),o.d(t,"InstancedLinesMesh",function(){return r.InstancedLinesMesh}),o.d(t,"_CreationDataStorage",function(){return r._CreationDataStorage}),o.d(t,"_InstancesBatch",function(){return r._InstancesBatch}),o.d(t,"Mesh",function(){return r.Mesh}),o.d(t,"VertexData",function(){return r.VertexData}),o.d(t,"MeshBuilder",function(){return r.MeshBuilder}),o.d(t,"SimplificationSettings",function(){return r.SimplificationSettings}),o.d(t,"SimplificationQueue",function(){return r.SimplificationQueue}),o.d(t,"SimplificationType",function(){return r.SimplificationType}),o.d(t,"SimplicationQueueSceneComponent",function(){return r.SimplicationQueueSceneComponent}),o.d(t,"Polygon",function(){return r.Polygon}),o.d(t,"PolygonMeshBuilder",function(){return r.PolygonMeshBuilder}),o.d(t,"BaseSubMesh",function(){return r.BaseSubMesh}),o.d(t,"SubMesh",function(){return r.SubMesh}),o.d(t,"MeshLODLevel",function(){return r.MeshLODLevel}),o.d(t,"TransformNode",function(){return r.TransformNode}),o.d(t,"BoxBuilder",function(){return r.BoxBuilder}),o.d(t,"SphereBuilder",function(){return r.SphereBuilder}),o.d(t,"CylinderBuilder",function(){return r.CylinderBuilder}),o.d(t,"TorusBuilder",function(){return r.TorusBuilder}),o.d(t,"LinesBuilder",function(){return r.LinesBuilder}),o.d(t,"PlaneBuilder",function(){return r.PlaneBuilder}),o.d(t,"GroundBuilder",function(){return r.GroundBuilder}),o.d(t,"DataBuffer",function(){return r.DataBuffer}),o.d(t,"WebGLDataBuffer",function(){return r.WebGLDataBuffer}),o.d(t,"MorphTarget",function(){return r.MorphTarget}),o.d(t,"MorphTargetManager",function(){return r.MorphTargetManager}),o.d(t,"Database",function(){return r.Database}),o.d(t,"BaseParticleSystem",function(){return r.BaseParticleSystem}),o.d(t,"GPUParticleSystem",function(){return r.GPUParticleSystem}),o.d(t,"Particle",function(){return r.Particle}),o.d(t,"ParticleHelper",function(){return r.ParticleHelper}),o.d(t,"ParticleSystem",function(){return r.ParticleSystem}),o.d(t,"_IDoNeedToBeInTheBuild",function(){return r._IDoNeedToBeInTheBuild}),o.d(t,"ParticleSystemSet",function(){return r.ParticleSystemSet}),o.d(t,"SolidParticle",function(){return r.SolidParticle}),o.d(t,"ModelShape",function(){return r.ModelShape}),o.d(t,"DepthSortedParticle",function(){return r.DepthSortedParticle}),o.d(t,"SolidParticleSystem",function(){return r.SolidParticleSystem}),o.d(t,"CloudPoint",function(){return r.CloudPoint}),o.d(t,"PointsGroup",function(){return r.PointsGroup}),o.d(t,"PointColor",function(){return r.PointColor}),o.d(t,"PointsCloudSystem",function(){return r.PointsCloudSystem}),o.d(t,"SubEmitterType",function(){return r.SubEmitterType}),o.d(t,"SubEmitter",function(){return r.SubEmitter}),o.d(t,"PhysicsEngine",function(){return r.PhysicsEngine}),o.d(t,"PhysicsEngineSceneComponent",function(){return r.PhysicsEngineSceneComponent}),o.d(t,"PhysicsHelper",function(){return r.PhysicsHelper}),o.d(t,"PhysicsRadialExplosionEventOptions",function(){return r.PhysicsRadialExplosionEventOptions}),o.d(t,"PhysicsUpdraftEventOptions",function(){return r.PhysicsUpdraftEventOptions}),o.d(t,"PhysicsVortexEventOptions",function(){return r.PhysicsVortexEventOptions}),o.d(t,"PhysicsRadialImpulseFalloff",function(){return r.PhysicsRadialImpulseFalloff}),o.d(t,"PhysicsUpdraftMode",function(){return r.PhysicsUpdraftMode}),o.d(t,"PhysicsImpostor",function(){return r.PhysicsImpostor}),o.d(t,"PhysicsJoint",function(){return r.PhysicsJoint}),o.d(t,"DistanceJoint",function(){return r.DistanceJoint}),o.d(t,"MotorEnabledJoint",function(){return r.MotorEnabledJoint}),o.d(t,"HingeJoint",function(){return r.HingeJoint}),o.d(t,"Hinge2Joint",function(){return r.Hinge2Joint}),o.d(t,"AnaglyphPostProcess",function(){return r.AnaglyphPostProcess}),o.d(t,"BlackAndWhitePostProcess",function(){return r.BlackAndWhitePostProcess}),o.d(t,"BloomEffect",function(){return r.BloomEffect}),o.d(t,"BloomMergePostProcess",function(){return r.BloomMergePostProcess}),o.d(t,"BlurPostProcess",function(){return r.BlurPostProcess}),o.d(t,"ChromaticAberrationPostProcess",function(){return r.ChromaticAberrationPostProcess}),o.d(t,"CircleOfConfusionPostProcess",function(){return r.CircleOfConfusionPostProcess}),o.d(t,"ColorCorrectionPostProcess",function(){return r.ColorCorrectionPostProcess}),o.d(t,"ConvolutionPostProcess",function(){return r.ConvolutionPostProcess}),o.d(t,"DepthOfFieldBlurPostProcess",function(){return r.DepthOfFieldBlurPostProcess}),o.d(t,"DepthOfFieldEffectBlurLevel",function(){return r.DepthOfFieldEffectBlurLevel}),o.d(t,"DepthOfFieldEffect",function(){return r.DepthOfFieldEffect}),o.d(t,"DepthOfFieldMergePostProcessOptions",function(){return r.DepthOfFieldMergePostProcessOptions}),o.d(t,"DepthOfFieldMergePostProcess",function(){return r.DepthOfFieldMergePostProcess}),o.d(t,"DisplayPassPostProcess",function(){return r.DisplayPassPostProcess}),o.d(t,"ExtractHighlightsPostProcess",function(){return r.ExtractHighlightsPostProcess}),o.d(t,"FilterPostProcess",function(){return r.FilterPostProcess}),o.d(t,"FxaaPostProcess",function(){return r.FxaaPostProcess}),o.d(t,"GrainPostProcess",function(){return r.GrainPostProcess}),o.d(t,"HighlightsPostProcess",function(){return r.HighlightsPostProcess}),o.d(t,"ImageProcessingPostProcess",function(){return r.ImageProcessingPostProcess}),o.d(t,"MotionBlurPostProcess",function(){return r.MotionBlurPostProcess}),o.d(t,"PassPostProcess",function(){return r.PassPostProcess}),o.d(t,"PassCubePostProcess",function(){return r.PassCubePostProcess}),o.d(t,"PostProcess",function(){return r.PostProcess}),o.d(t,"PostProcessManager",function(){return r.PostProcessManager}),o.d(t,"RefractionPostProcess",function(){return r.RefractionPostProcess}),o.d(t,"SharpenPostProcess",function(){return r.SharpenPostProcess}),o.d(t,"StereoscopicInterlacePostProcessI",function(){return r.StereoscopicInterlacePostProcessI}),o.d(t,"StereoscopicInterlacePostProcess",function(){return r.StereoscopicInterlacePostProcess}),o.d(t,"TonemappingOperator",function(){return r.TonemappingOperator}),o.d(t,"TonemapPostProcess",function(){return r.TonemapPostProcess}),o.d(t,"VolumetricLightScatteringPostProcess",function(){return r.VolumetricLightScatteringPostProcess}),o.d(t,"VRDistortionCorrectionPostProcess",function(){return r.VRDistortionCorrectionPostProcess}),o.d(t,"VRMultiviewToSingleviewPostProcess",function(){return r.VRMultiviewToSingleviewPostProcess}),o.d(t,"ScreenSpaceReflectionPostProcess",function(){return r.ScreenSpaceReflectionPostProcess}),o.d(t,"ReflectionProbe",function(){return r.ReflectionProbe}),o.d(t,"BoundingBoxRenderer",function(){return r.BoundingBoxRenderer}),o.d(t,"DepthRenderer",function(){return r.DepthRenderer}),o.d(t,"DepthRendererSceneComponent",function(){return r.DepthRendererSceneComponent}),o.d(t,"EdgesRenderer",function(){return r.EdgesRenderer}),o.d(t,"LineEdgesRenderer",function(){return r.LineEdgesRenderer}),o.d(t,"GeometryBufferRenderer",function(){return r.GeometryBufferRenderer}),o.d(t,"GeometryBufferRendererSceneComponent",function(){return r.GeometryBufferRendererSceneComponent}),o.d(t,"OutlineRenderer",function(){return r.OutlineRenderer}),o.d(t,"RenderingGroup",function(){return r.RenderingGroup}),o.d(t,"RenderingGroupInfo",function(){return r.RenderingGroupInfo}),o.d(t,"RenderingManager",function(){return r.RenderingManager}),o.d(t,"UtilityLayerRenderer",function(){return r.UtilityLayerRenderer}),o.d(t,"Sprite",function(){return r.Sprite}),o.d(t,"SpriteManager",function(){return r.SpriteManager}),o.d(t,"SpriteMap",function(){return r.SpriteMap}),o.d(t,"SpritePackedManager",function(){return r.SpritePackedManager}),o.d(t,"SpriteSceneComponent",function(){return r.SpriteSceneComponent}),o.d(t,"AlphaState",function(){return r.AlphaState}),o.d(t,"DepthCullingState",function(){return r.DepthCullingState}),o.d(t,"StencilState",function(){return r.StencilState}),o.d(t,"AndOrNotEvaluator",function(){return r.AndOrNotEvaluator}),o.d(t,"AssetTaskState",function(){return r.AssetTaskState}),o.d(t,"AbstractAssetTask",function(){return r.AbstractAssetTask}),o.d(t,"AssetsProgressEvent",function(){return r.AssetsProgressEvent}),o.d(t,"MeshAssetTask",function(){return r.MeshAssetTask}),o.d(t,"TextFileAssetTask",function(){return r.TextFileAssetTask}),o.d(t,"BinaryFileAssetTask",function(){return r.BinaryFileAssetTask}),o.d(t,"ImageAssetTask",function(){return r.ImageAssetTask}),o.d(t,"TextureAssetTask",function(){return r.TextureAssetTask}),o.d(t,"CubeTextureAssetTask",function(){return r.CubeTextureAssetTask}),o.d(t,"HDRCubeTextureAssetTask",function(){return r.HDRCubeTextureAssetTask}),o.d(t,"EquiRectangularCubeTextureAssetTask",function(){return r.EquiRectangularCubeTextureAssetTask}),o.d(t,"AssetsManager",function(){return r.AssetsManager}),o.d(t,"BasisTranscodeConfiguration",function(){return r.BasisTranscodeConfiguration}),o.d(t,"BasisTools",function(){return r.BasisTools}),o.d(t,"DDSTools",function(){return r.DDSTools}),o.d(t,"expandToProperty",function(){return r.expandToProperty}),o.d(t,"serialize",function(){return r.serialize}),o.d(t,"serializeAsTexture",function(){return r.serializeAsTexture}),o.d(t,"serializeAsColor3",function(){return r.serializeAsColor3}),o.d(t,"serializeAsFresnelParameters",function(){return r.serializeAsFresnelParameters}),o.d(t,"serializeAsVector2",function(){return r.serializeAsVector2}),o.d(t,"serializeAsVector3",function(){return r.serializeAsVector3}),o.d(t,"serializeAsMeshReference",function(){return r.serializeAsMeshReference}),o.d(t,"serializeAsColorCurves",function(){return r.serializeAsColorCurves}),o.d(t,"serializeAsColor4",function(){return r.serializeAsColor4}),o.d(t,"serializeAsImageProcessingConfiguration",function(){return r.serializeAsImageProcessingConfiguration}),o.d(t,"serializeAsQuaternion",function(){return r.serializeAsQuaternion}),o.d(t,"serializeAsMatrix",function(){return r.serializeAsMatrix}),o.d(t,"serializeAsCameraReference",function(){return r.serializeAsCameraReference}),o.d(t,"SerializationHelper",function(){return r.SerializationHelper}),o.d(t,"Deferred",function(){return r.Deferred}),o.d(t,"EnvironmentTextureTools",function(){return r.EnvironmentTextureTools}),o.d(t,"MeshExploder",function(){return r.MeshExploder}),o.d(t,"FilesInput",function(){return r.FilesInput}),o.d(t,"KhronosTextureContainer",function(){return r.KhronosTextureContainer}),o.d(t,"EventState",function(){return r.EventState}),o.d(t,"Observer",function(){return r.Observer}),o.d(t,"MultiObserver",function(){return r.MultiObserver}),o.d(t,"Observable",function(){return r.Observable}),o.d(t,"PerformanceMonitor",function(){return r.PerformanceMonitor}),o.d(t,"RollingAverage",function(){return r.RollingAverage}),o.d(t,"PromisePolyfill",function(){return r.PromisePolyfill}),o.d(t,"SceneOptimization",function(){return r.SceneOptimization}),o.d(t,"TextureOptimization",function(){return r.TextureOptimization}),o.d(t,"HardwareScalingOptimization",function(){return r.HardwareScalingOptimization}),o.d(t,"ShadowsOptimization",function(){return r.ShadowsOptimization}),o.d(t,"PostProcessesOptimization",function(){return r.PostProcessesOptimization}),o.d(t,"LensFlaresOptimization",function(){return r.LensFlaresOptimization}),o.d(t,"CustomOptimization",function(){return r.CustomOptimization}),o.d(t,"ParticlesOptimization",function(){return r.ParticlesOptimization}),o.d(t,"RenderTargetsOptimization",function(){return r.RenderTargetsOptimization}),o.d(t,"MergeMeshesOptimization",function(){return r.MergeMeshesOptimization}),o.d(t,"SceneOptimizerOptions",function(){return r.SceneOptimizerOptions}),o.d(t,"SceneOptimizer",function(){return r.SceneOptimizer}),o.d(t,"SceneSerializer",function(){return r.SceneSerializer}),o.d(t,"SmartArray",function(){return r.SmartArray}),o.d(t,"SmartArrayNoDuplicate",function(){return r.SmartArrayNoDuplicate}),o.d(t,"StringDictionary",function(){return r.StringDictionary}),o.d(t,"Tags",function(){return r.Tags}),o.d(t,"TextureTools",function(){return r.TextureTools}),o.d(t,"TGATools",function(){return r.TGATools}),o.d(t,"Tools",function(){return r.Tools}),o.d(t,"className",function(){return r.className}),o.d(t,"AsyncLoop",function(){return r.AsyncLoop}),o.d(t,"VideoRecorder",function(){return r.VideoRecorder}),o.d(t,"JoystickAxis",function(){return r.JoystickAxis}),o.d(t,"VirtualJoystick",function(){return r.VirtualJoystick}),o.d(t,"WorkerPool",function(){return r.WorkerPool}),o.d(t,"Logger",function(){return r.Logger}),o.d(t,"_TypeStore",function(){return r._TypeStore}),o.d(t,"FilesInputStore",function(){return r.FilesInputStore}),o.d(t,"DeepCopier",function(){return r.DeepCopier}),o.d(t,"PivotTools",function(){return r.PivotTools}),o.d(t,"PrecisionDate",function(){return r.PrecisionDate}),o.d(t,"ScreenshotTools",function(){return r.ScreenshotTools}),o.d(t,"WebRequest",function(){return r.WebRequest}),o.d(t,"InspectableType",function(){return r.InspectableType}),o.d(t,"BRDFTextureTools",function(){return r.BRDFTextureTools}),o.d(t,"RGBDTextureTools",function(){return r.RGBDTextureTools}),o.d(t,"ColorGradient",function(){return r.ColorGradient}),o.d(t,"Color3Gradient",function(){return r.Color3Gradient}),o.d(t,"FactorGradient",function(){return r.FactorGradient}),o.d(t,"GradientHelper",function(){return r.GradientHelper}),o.d(t,"PerfCounter",function(){return r.PerfCounter}),o.d(t,"RetryStrategy",function(){return r.RetryStrategy}),o.d(t,"CanvasGenerator",function(){return r.CanvasGenerator}),o.d(t,"LoadFileError",function(){return r.LoadFileError}),o.d(t,"RequestFileError",function(){return r.RequestFileError}),o.d(t,"ReadFileError",function(){return r.ReadFileError}),o.d(t,"FileTools",function(){return r.FileTools}),o.d(t,"StringTools",function(){return r.StringTools}),o.d(t,"DataReader",function(){return r.DataReader}),o.d(t,"MinMaxReducer",function(){return r.MinMaxReducer}),o.d(t,"DepthReducer",function(){return r.DepthReducer}),o.d(t,"WebXRCamera",function(){return r.WebXRCamera}),o.d(t,"WebXREnterExitUIButton",function(){return r.WebXREnterExitUIButton}),o.d(t,"WebXREnterExitUIOptions",function(){return r.WebXREnterExitUIOptions}),o.d(t,"WebXREnterExitUI",function(){return r.WebXREnterExitUI}),o.d(t,"WebXRExperienceHelper",function(){return r.WebXRExperienceHelper}),o.d(t,"WebXRInput",function(){return r.WebXRInput}),o.d(t,"WebXRInputSource",function(){return r.WebXRInputSource}),o.d(t,"WebXRManagedOutputCanvasOptions",function(){return r.WebXRManagedOutputCanvasOptions}),o.d(t,"WebXRManagedOutputCanvas",function(){return r.WebXRManagedOutputCanvas}),o.d(t,"WebXRState",function(){return r.WebXRState}),o.d(t,"WebXRSessionManager",function(){return r.WebXRSessionManager}),o.d(t,"WebXRDefaultExperienceOptions",function(){return r.WebXRDefaultExperienceOptions}),o.d(t,"WebXRDefaultExperience",function(){return r.WebXRDefaultExperience}),o.d(t,"WebXRFeatureName",function(){return r.WebXRFeatureName}),o.d(t,"WebXRFeaturesManager",function(){return r.WebXRFeaturesManager}),o.d(t,"AutoRotationBehavior",function(){return r.AutoRotationBehavior}),o.d(t,"BouncingBehavior",function(){return r.BouncingBehavior}),o.d(t,"FramingBehavior",function(){return r.FramingBehavior}),o.d(t,"AttachToBoxBehavior",function(){return r.AttachToBoxBehavior}),o.d(t,"FadeInOutBehavior",function(){return r.FadeInOutBehavior}),o.d(t,"MultiPointerScaleBehavior",function(){return r.MultiPointerScaleBehavior}),o.d(t,"PointerDragBehavior",function(){return r.PointerDragBehavior}),o.d(t,"SixDofDragBehavior",function(){return r.SixDofDragBehavior}),o.d(t,"ArcRotateCameraGamepadInput",function(){return r.ArcRotateCameraGamepadInput}),o.d(t,"ArcRotateCameraKeyboardMoveInput",function(){return r.ArcRotateCameraKeyboardMoveInput}),o.d(t,"ArcRotateCameraMouseWheelInput",function(){return r.ArcRotateCameraMouseWheelInput}),o.d(t,"ArcRotateCameraPointersInput",function(){return r.ArcRotateCameraPointersInput}),o.d(t,"ArcRotateCameraVRDeviceOrientationInput",function(){return r.ArcRotateCameraVRDeviceOrientationInput}),o.d(t,"FlyCameraKeyboardInput",function(){return r.FlyCameraKeyboardInput}),o.d(t,"FlyCameraMouseInput",function(){return r.FlyCameraMouseInput}),o.d(t,"FollowCameraKeyboardMoveInput",function(){return r.FollowCameraKeyboardMoveInput}),o.d(t,"FollowCameraMouseWheelInput",function(){return r.FollowCameraMouseWheelInput}),o.d(t,"FollowCameraPointersInput",function(){return r.FollowCameraPointersInput}),o.d(t,"FreeCameraDeviceOrientationInput",function(){return r.FreeCameraDeviceOrientationInput}),o.d(t,"FreeCameraGamepadInput",function(){return r.FreeCameraGamepadInput}),o.d(t,"FreeCameraKeyboardMoveInput",function(){return r.FreeCameraKeyboardMoveInput}),o.d(t,"FreeCameraMouseInput",function(){return r.FreeCameraMouseInput}),o.d(t,"FreeCameraTouchInput",function(){return r.FreeCameraTouchInput}),o.d(t,"FreeCameraVirtualJoystickInput",function(){return r.FreeCameraVirtualJoystickInput}),o.d(t,"AnaglyphArcRotateCamera",function(){return r.AnaglyphArcRotateCamera}),o.d(t,"AnaglyphFreeCamera",function(){return r.AnaglyphFreeCamera}),o.d(t,"AnaglyphGamepadCamera",function(){return r.AnaglyphGamepadCamera}),o.d(t,"AnaglyphUniversalCamera",function(){return r.AnaglyphUniversalCamera}),o.d(t,"StereoscopicArcRotateCamera",function(){return r.StereoscopicArcRotateCamera}),o.d(t,"StereoscopicFreeCamera",function(){return r.StereoscopicFreeCamera}),o.d(t,"StereoscopicGamepadCamera",function(){return r.StereoscopicGamepadCamera}),o.d(t,"StereoscopicUniversalCamera",function(){return r.StereoscopicUniversalCamera}),o.d(t,"VRCameraMetrics",function(){return r.VRCameraMetrics}),o.d(t,"VRDeviceOrientationArcRotateCamera",function(){return r.VRDeviceOrientationArcRotateCamera}),o.d(t,"VRDeviceOrientationFreeCamera",function(){return r.VRDeviceOrientationFreeCamera}),o.d(t,"VRDeviceOrientationGamepadCamera",function(){return r.VRDeviceOrientationGamepadCamera}),o.d(t,"OnAfterEnteringVRObservableEvent",function(){return r.OnAfterEnteringVRObservableEvent}),o.d(t,"VRExperienceHelper",function(){return r.VRExperienceHelper}),o.d(t,"WebVRFreeCamera",function(){return r.WebVRFreeCamera}),o.d(t,"Octree",function(){return r.Octree}),o.d(t,"OctreeBlock",function(){return r.OctreeBlock}),o.d(t,"OctreeSceneComponent",function(){return r.OctreeSceneComponent}),o.d(t,"_OcclusionDataStorage",function(){return r._OcclusionDataStorage}),o.d(t,"_forceTransformFeedbackToBundle",function(){return r._forceTransformFeedbackToBundle}),o.d(t,"EngineView",function(){return r.EngineView}),o.d(t,"DaydreamController",function(){return r.DaydreamController}),o.d(t,"GearVRController",function(){return r.GearVRController}),o.d(t,"GenericController",function(){return r.GenericController}),o.d(t,"OculusTouchController",function(){return r.OculusTouchController}),o.d(t,"PoseEnabledControllerType",function(){return r.PoseEnabledControllerType}),o.d(t,"PoseEnabledControllerHelper",function(){return r.PoseEnabledControllerHelper}),o.d(t,"PoseEnabledController",function(){return r.PoseEnabledController}),o.d(t,"ViveController",function(){return r.ViveController}),o.d(t,"WebVRController",function(){return r.WebVRController}),o.d(t,"WindowsMotionController",function(){return r.WindowsMotionController}),o.d(t,"XRWindowsMotionController",function(){return r.XRWindowsMotionController}),o.d(t,"ShadowGenerator",function(){return r.ShadowGenerator}),o.d(t,"CascadedShadowGenerator",function(){return r.CascadedShadowGenerator}),o.d(t,"ShadowGeneratorSceneComponent",function(){return r.ShadowGeneratorSceneComponent}),o.d(t,"_BabylonLoaderRegistered",function(){return r._BabylonLoaderRegistered}),o.d(t,"BabylonFileLoaderConfiguration",function(){return r.BabylonFileLoaderConfiguration}),o.d(t,"BackgroundMaterial",function(){return r.BackgroundMaterial}),o.d(t,"PBRMaterialDefines",function(){return r.PBRMaterialDefines}),o.d(t,"PBRBaseMaterial",function(){return r.PBRBaseMaterial}),o.d(t,"PBRBaseSimpleMaterial",function(){return r.PBRBaseSimpleMaterial}),o.d(t,"PBRMetallicRoughnessMaterial",function(){return r.PBRMetallicRoughnessMaterial}),o.d(t,"PBRSpecularGlossinessMaterial",function(){return r.PBRSpecularGlossinessMaterial}),o.d(t,"ColorGradingTexture",function(){return r.ColorGradingTexture}),o.d(t,"RawCubeTexture",function(){return r.RawCubeTexture}),o.d(t,"RawTexture3D",function(){return r.RawTexture3D}),o.d(t,"RawTexture2DArray",function(){return r.RawTexture2DArray}),o.d(t,"RefractionTexture",function(){return r.RefractionTexture}),o.d(t,"VideoTexture",function(){return r.VideoTexture}),o.d(t,"HtmlElementTexture",function(){return r.HtmlElementTexture}),o.d(t,"NodeMaterialConnectionPointCompatibilityStates",function(){return r.NodeMaterialConnectionPointCompatibilityStates}),o.d(t,"NodeMaterialConnectionPointDirection",function(){return r.NodeMaterialConnectionPointDirection}),o.d(t,"NodeMaterialConnectionPoint",function(){return r.NodeMaterialConnectionPoint}),o.d(t,"NodeMaterialBlock",function(){return r.NodeMaterialBlock}),o.d(t,"NodeMaterialDefines",function(){return r.NodeMaterialDefines}),o.d(t,"NodeMaterial",function(){return r.NodeMaterial}),o.d(t,"Orientation",function(){return r.Orientation}),o.d(t,"BezierCurve",function(){return r.BezierCurve}),o.d(t,"Angle",function(){return r.Angle}),o.d(t,"Arc2",function(){return r.Arc2}),o.d(t,"Path2",function(){return r.Path2}),o.d(t,"Path3D",function(){return r.Path3D}),o.d(t,"Curve3",function(){return r.Curve3}),o.d(t,"PositionNormalVertex",function(){return r.PositionNormalVertex}),o.d(t,"PositionNormalTextureVertex",function(){return r.PositionNormalTextureVertex}),o.d(t,"DracoCompression",function(){return r.DracoCompression}),o.d(t,"TiledBoxBuilder",function(){return r.TiledBoxBuilder}),o.d(t,"DiscBuilder",function(){return r.DiscBuilder}),o.d(t,"RibbonBuilder",function(){return r.RibbonBuilder}),o.d(t,"HemisphereBuilder",function(){return r.HemisphereBuilder}),o.d(t,"TorusKnotBuilder",function(){return r.TorusKnotBuilder}),o.d(t,"PolygonBuilder",function(){return r.PolygonBuilder}),o.d(t,"ShapeBuilder",function(){return r.ShapeBuilder}),o.d(t,"LatheBuilder",function(){return r.LatheBuilder}),o.d(t,"TiledPlaneBuilder",function(){return r.TiledPlaneBuilder}),o.d(t,"TubeBuilder",function(){return r.TubeBuilder}),o.d(t,"PolyhedronBuilder",function(){return r.PolyhedronBuilder}),o.d(t,"IcoSphereBuilder",function(){return r.IcoSphereBuilder}),o.d(t,"DecalBuilder",function(){return r.DecalBuilder}),o.d(t,"RecastJSPlugin",function(){return r.RecastJSPlugin}),o.d(t,"RecastJSCrowd",function(){return r.RecastJSCrowd}),o.d(t,"BoxParticleEmitter",function(){return r.BoxParticleEmitter}),o.d(t,"ConeParticleEmitter",function(){return r.ConeParticleEmitter}),o.d(t,"CylinderParticleEmitter",function(){return r.CylinderParticleEmitter}),o.d(t,"CylinderDirectedParticleEmitter",function(){return r.CylinderDirectedParticleEmitter}),o.d(t,"HemisphericParticleEmitter",function(){return r.HemisphericParticleEmitter}),o.d(t,"PointParticleEmitter",function(){return r.PointParticleEmitter}),o.d(t,"SphereParticleEmitter",function(){return r.SphereParticleEmitter}),o.d(t,"SphereDirectedParticleEmitter",function(){return r.SphereDirectedParticleEmitter}),o.d(t,"CustomParticleEmitter",function(){return r.CustomParticleEmitter}),o.d(t,"MeshParticleEmitter",function(){return r.MeshParticleEmitter}),o.d(t,"CannonJSPlugin",function(){return r.CannonJSPlugin}),o.d(t,"AmmoJSPlugin",function(){return r.AmmoJSPlugin}),o.d(t,"OimoJSPlugin",function(){return r.OimoJSPlugin}),o.d(t,"PostProcessRenderEffect",function(){return r.PostProcessRenderEffect}),o.d(t,"PostProcessRenderPipeline",function(){return r.PostProcessRenderPipeline}),o.d(t,"PostProcessRenderPipelineManager",function(){return r.PostProcessRenderPipelineManager}),o.d(t,"PostProcessRenderPipelineManagerSceneComponent",function(){return r.PostProcessRenderPipelineManagerSceneComponent}),o.d(t,"CubeMapToSphericalPolynomialTools",function(){return r.CubeMapToSphericalPolynomialTools}),o.d(t,"HDRTools",function(){return r.HDRTools}),o.d(t,"PanoramaToCubeMapTools",function(){return r.PanoramaToCubeMapTools}),o.d(t,"WebXRHitTestLegacy",function(){return r.WebXRHitTestLegacy}),o.d(t,"WebXRAnchorSystem",function(){return r.WebXRAnchorSystem}),o.d(t,"WebXRPlaneDetector",function(){return r.WebXRPlaneDetector}),o.d(t,"WebXRBackgroundRemover",function(){return r.WebXRBackgroundRemover}),o.d(t,"WebXRMotionControllerTeleportation",function(){return r.WebXRMotionControllerTeleportation}),o.d(t,"WebXRControllerPointerSelection",function(){return r.WebXRControllerPointerSelection}),o.d(t,"IWebXRControllerPhysicsOptions",function(){return r.IWebXRControllerPhysicsOptions}),o.d(t,"WebXRControllerPhysics",function(){return r.WebXRControllerPhysics}),o.d(t,"WebXRAbstractMotionController",function(){return r.WebXRAbstractMotionController}),o.d(t,"WebXRControllerComponent",function(){return r.WebXRControllerComponent}),o.d(t,"WebXRGenericTriggerMotionController",function(){return r.WebXRGenericTriggerMotionController}),o.d(t,"WebXRMicrosoftMixedRealityController",function(){return r.WebXRMicrosoftMixedRealityController}),o.d(t,"WebXRMotionControllerManager",function(){return r.WebXRMotionControllerManager}),o.d(t,"WebXROculusTouchMotionController",function(){return r.WebXROculusTouchMotionController}),o.d(t,"WebXRHTCViveMotionController",function(){return r.WebXRHTCViveMotionController}),o.d(t,"WebXRProfiledMotionController",function(){return r.WebXRProfiledMotionController}),o.d(t,"_DDSTextureLoader",function(){return r._DDSTextureLoader}),o.d(t,"_ENVTextureLoader",function(){return r._ENVTextureLoader}),o.d(t,"_KTXTextureLoader",function(){return r._KTXTextureLoader}),o.d(t,"_TGATextureLoader",function(){return r._TGATextureLoader}),o.d(t,"_BasisTextureLoader",function(){return r._BasisTextureLoader}),o.d(t,"CustomProceduralTexture",function(){return r.CustomProceduralTexture}),o.d(t,"NoiseProceduralTexture",function(){return r.NoiseProceduralTexture}),o.d(t,"ProceduralTexture",function(){return r.ProceduralTexture}),o.d(t,"ProceduralTextureSceneComponent",function(){return r.ProceduralTextureSceneComponent}),o.d(t,"TexturePacker",function(){return r.TexturePacker}),o.d(t,"TexturePackerFrame",function(){return r.TexturePackerFrame}),o.d(t,"NodeMaterialBlockTargets",function(){return r.NodeMaterialBlockTargets}),o.d(t,"NodeMaterialBlockConnectionPointTypes",function(){return r.NodeMaterialBlockConnectionPointTypes}),o.d(t,"NodeMaterialBlockConnectionPointMode",function(){return r.NodeMaterialBlockConnectionPointMode}),o.d(t,"NodeMaterialSystemValues",function(){return r.NodeMaterialSystemValues}),o.d(t,"MultiplyBlock",function(){return r.MultiplyBlock}),o.d(t,"AddBlock",function(){return r.AddBlock}),o.d(t,"ScaleBlock",function(){return r.ScaleBlock}),o.d(t,"ClampBlock",function(){return r.ClampBlock}),o.d(t,"CrossBlock",function(){return r.CrossBlock}),o.d(t,"DotBlock",function(){return r.DotBlock}),o.d(t,"TransformBlock",function(){return r.TransformBlock}),o.d(t,"RemapBlock",function(){return r.RemapBlock}),o.d(t,"NormalizeBlock",function(){return r.NormalizeBlock}),o.d(t,"TrigonometryBlockOperations",function(){return r.TrigonometryBlockOperations}),o.d(t,"TrigonometryBlock",function(){return r.TrigonometryBlock}),o.d(t,"ColorMergerBlock",function(){return r.ColorMergerBlock}),o.d(t,"VectorMergerBlock",function(){return r.VectorMergerBlock}),o.d(t,"ColorSplitterBlock",function(){return r.ColorSplitterBlock}),o.d(t,"VectorSplitterBlock",function(){return r.VectorSplitterBlock}),o.d(t,"LerpBlock",function(){return r.LerpBlock}),o.d(t,"DivideBlock",function(){return r.DivideBlock}),o.d(t,"SubtractBlock",function(){return r.SubtractBlock}),o.d(t,"StepBlock",function(){return r.StepBlock}),o.d(t,"OneMinusBlock",function(){return r.OneMinusBlock}),o.d(t,"ViewDirectionBlock",function(){return r.ViewDirectionBlock}),o.d(t,"FresnelBlock",function(){return r.FresnelBlock}),o.d(t,"MaxBlock",function(){return r.MaxBlock}),o.d(t,"MinBlock",function(){return r.MinBlock}),o.d(t,"DistanceBlock",function(){return r.DistanceBlock}),o.d(t,"LengthBlock",function(){return r.LengthBlock}),o.d(t,"NegateBlock",function(){return r.NegateBlock}),o.d(t,"PowBlock",function(){return r.PowBlock}),o.d(t,"RandomNumberBlock",function(){return r.RandomNumberBlock}),o.d(t,"ArcTan2Block",function(){return r.ArcTan2Block}),o.d(t,"SmoothStepBlock",function(){return r.SmoothStepBlock}),o.d(t,"ReciprocalBlock",function(){return r.ReciprocalBlock}),o.d(t,"ReplaceColorBlock",function(){return r.ReplaceColorBlock}),o.d(t,"PosterizeBlock",function(){return r.PosterizeBlock}),o.d(t,"WaveBlockKind",function(){return r.WaveBlockKind}),o.d(t,"WaveBlock",function(){return r.WaveBlock}),o.d(t,"GradientBlockColorStep",function(){return r.GradientBlockColorStep}),o.d(t,"GradientBlock",function(){return r.GradientBlock}),o.d(t,"NLerpBlock",function(){return r.NLerpBlock}),o.d(t,"WorleyNoise3DBlock",function(){return r.WorleyNoise3DBlock}),o.d(t,"SimplexPerlin3DBlock",function(){return r.SimplexPerlin3DBlock}),o.d(t,"NormalBlendBlock",function(){return r.NormalBlendBlock}),o.d(t,"Rotate2dBlock",function(){return r.Rotate2dBlock}),o.d(t,"ReflectBlock",function(){return r.ReflectBlock}),o.d(t,"RefractBlock",function(){return r.RefractBlock}),o.d(t,"DesaturateBlock",function(){return r.DesaturateBlock}),o.d(t,"NodeMaterialOptimizer",function(){return r.NodeMaterialOptimizer}),o.d(t,"DefaultRenderingPipeline",function(){return r.DefaultRenderingPipeline}),o.d(t,"LensRenderingPipeline",function(){return r.LensRenderingPipeline}),o.d(t,"SSAO2RenderingPipeline",function(){return r.SSAO2RenderingPipeline}),o.d(t,"SSAORenderingPipeline",function(){return r.SSAORenderingPipeline}),o.d(t,"StandardRenderingPipeline",function(){return r.StandardRenderingPipeline}),o.d(t,"VertexOutputBlock",function(){return r.VertexOutputBlock}),o.d(t,"BonesBlock",function(){return r.BonesBlock}),o.d(t,"InstancesBlock",function(){return r.InstancesBlock}),o.d(t,"MorphTargetsBlock",function(){return r.MorphTargetsBlock}),o.d(t,"LightInformationBlock",function(){return r.LightInformationBlock}),o.d(t,"FragmentOutputBlock",function(){return r.FragmentOutputBlock}),o.d(t,"ImageProcessingBlock",function(){return r.ImageProcessingBlock}),o.d(t,"PerturbNormalBlock",function(){return r.PerturbNormalBlock}),o.d(t,"DiscardBlock",function(){return r.DiscardBlock}),o.d(t,"FrontFacingBlock",function(){return r.FrontFacingBlock}),o.d(t,"DerivativeBlock",function(){return r.DerivativeBlock}),o.d(t,"FogBlock",function(){return r.FogBlock}),o.d(t,"LightBlock",function(){return r.LightBlock}),o.d(t,"TextureBlock",function(){return r.TextureBlock}),o.d(t,"ReflectionTextureBlock",function(){return r.ReflectionTextureBlock}),o.d(t,"InputBlock",function(){return r.InputBlock}),o.d(t,"AnimatedInputBlockTypes",function(){return r.AnimatedInputBlockTypes});var i=void 0!==R?R:"undefined"!=typeof window?window:void 0;if(void 0!==i){i.BABYLON=G,i.BABYLON=i.BABYLON||{};var G=i.BABYLON;G.Debug=G.Debug||{};var D=[];for(var E in I)G.Debug[E]=I[E],D.push(E);for(var E in r)G[E]=r[E]}var x={AxesViewer:I.AxesViewer,BoneAxesViewer:I.BoneAxesViewer,PhysicsViewer:I.PhysicsViewer,SkeletonViewer:I.SkeletonViewer}}.call(this,o(144))}])})},33(za,Ca){!function(Aa,fa){"object"==typeof za&&"object"==typeof Ca?Ca.exports=fa(k$(35)):"function"==typeof define&&define.amd?define("babylonjs-loaders",["babylonjs"],fa):"object"==typeof za?za["babylonjs-loaders"]=fa(k$(35)):Aa.LOADERS=fa(Aa.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:za,function(Aa){return function(fa){var G={};function w(h){if(G[h])return G[h].exports;var y=G[h]={i:h,l:!1,exports:{}};return fa[h].call(y.exports,y,y.exports,w),y.l=!0,y.exports}return w.m=fa,w.c=G,w.d=function(h,y,H){w.o(h,y)||Object.defineProperty(h,y,{enumerable:!0,get:H})},w.r=function(h){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})},w.t=function(h,y){if(1&y&&(h=w(h)),8&y)return h;if(4&y&&"object"==typeof h&&h&&h.__esModule)return h;var H=Object.create(null);if(w.r(H),Object.defineProperty(H,"default",{enumerable:!0,value:h}),2&y&&"string"!=typeof h)for(var B in h)w.d(H,B,function(m){return h[m]}.bind(null,B));return H},w.n=function(h){var y=h&&h.__esModule?function(){return h.default}:function(){return h};return w.d(y,"a",y),y},w.o=function(h,y){return Object.prototype.hasOwnProperty.call(h,y)},w.p="",w(w.s=19)}([function(fa,G){fa.exports=Aa},function(fa,G,w){"use strict";w.d(G,"a",function(){return H}),w.d(G,"b",function(){return B});var h=w(0),y=w(2),H=function(){function m(){}return m.Get=function(d,a,b){if(!a||null==b||!a[b])throw new Error(d+": Failed to find index ("+b+")");return a[b]},m.Assign=function(d){if(d)for(var a=0;a<d.length;a++)d[a].index=a},m}(),B=function(){function m(d){this._completePromises=new Array(),this._forAssetContainer=!1,this._babylonLights=[],this._disposed=!1,this._state=null,this._extensions=new Array(),this._defaultBabylonMaterialData={},this._requests=new Array(),this._parent=d}return m.RegisterExtension=function(d,a){m.UnregisterExtension(d)&&h.Logger.Warn("Extension with the name '"+d+"' already exists"),m._RegisteredExtensions[d]={factory:a}},m.UnregisterExtension=function(d){return!!m._RegisteredExtensions[d]&&(delete m._RegisteredExtensions[d],!0)},Object.defineProperty(m.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"gltf",{get:function(){return this._gltf},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"bin",{get:function(){return this._bin},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"babylonScene",{get:function(){return this._babylonScene},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!0,configurable:!0}),m.prototype.dispose=function(){if(!this._disposed){this._disposed=!0;for(var d=0,a=this._requests;d<a.length;d++)a[d].abort();for(var b in this._requests.length=0,this._completePromises.length=0,this._extensions){var f=this._extensions[b];f.dispose&&f.dispose(),delete this._extensions[b]}delete this._gltf,delete this._babylonScene,delete this._rootBabylonMesh,delete this._progressCallback,this._parent._clear()}},m.prototype.importMeshAsync=function(d,a,b,f,i,n,g){var p=this;return Promise.resolve().then(function(){p._babylonScene=a,p._rootUrl=i,p._fileName=g||"scene",p._progressCallback=n,p._forAssetContainer=b,p._loadData(f);var v=null;if(d){var z={};if(p._gltf.nodes)for(var A=0,F=p._gltf.nodes;A<F.length;A++){var J=F[A];J.name&&(z[J.name]=J.index)}v=(d instanceof Array?d:[d]).map(function(S){var R=z[S];if(void 0===R)throw new Error("Failed to find node '"+S+"'");return R})}return p._loadAsync(v,function(){return{meshes:p._getMeshes(),particleSystems:[],skeletons:p._getSkeletons(),animationGroups:p._getAnimationGroups(),lights:p._babylonLights,transformNodes:p._getTransformNodes()}})})},m.prototype.loadAsync=function(d,a,b,f,i){var n=this;return Promise.resolve().then(function(){return n._babylonScene=d,n._rootUrl=b,n._fileName=i||"scene",n._progressCallback=f,n._loadData(a),n._loadAsync(null,function(){})})},m.prototype._loadAsync=function(d,a){var b=this;return Promise.resolve().then(function(){b._uniqueRootUrl=-1===b._rootUrl.indexOf("file:")&&b._fileName?b._rootUrl:""+b._rootUrl+Date.now()+"/",b._loadExtensions(),b._checkExtensions();var f=y.GLTFLoaderState[y.GLTFLoaderState.LOADING]+" => "+y.GLTFLoaderState[y.GLTFLoaderState.READY],i=y.GLTFLoaderState[y.GLTFLoaderState.LOADING]+" => "+y.GLTFLoaderState[y.GLTFLoaderState.COMPLETE];b._parent._startPerformanceCounter(f),b._parent._startPerformanceCounter(i),b._setState(y.GLTFLoaderState.LOADING),b._extensionsOnLoading();var n=new Array(),g=b._babylonScene.blockMaterialDirtyMechanism;if(b._babylonScene.blockMaterialDirtyMechanism=!0,d)n.push(b.loadSceneAsync("/nodes",{nodes:d,index:-1}));else if(null!=b._gltf.scene||b._gltf.scenes&&b._gltf.scenes[0]){var p=H.Get("/scene",b._gltf.scenes,b._gltf.scene||0);n.push(b.loadSceneAsync("/scenes/"+p.index,p))}b._babylonScene.blockMaterialDirtyMechanism=g,b._parent.compileMaterials&&n.push(b._compileMaterialsAsync()),b._parent.compileShadowGenerators&&n.push(b._compileShadowGeneratorsAsync());var v=Promise.all(n).then(function(){return b._rootBabylonMesh&&b._rootBabylonMesh.setEnabled(!0),b._setState(y.GLTFLoaderState.READY),b._extensionsOnReady(),b._startAnimations(),a()});return v.then(function(){b._parent._endPerformanceCounter(f),h.Tools.SetImmediate(function(){b._disposed||Promise.all(b._completePromises).then(function(){b._parent._endPerformanceCounter(i),b._setState(y.GLTFLoaderState.COMPLETE),b._parent.onCompleteObservable.notifyObservers(void 0),b._parent.onCompleteObservable.clear(),b.dispose()},function(z){b._parent.onErrorObservable.notifyObservers(z),b._parent.onErrorObservable.clear(),b.dispose()})})}),v},function(f){throw b._disposed||(b._parent.onErrorObservable.notifyObservers(f),b._parent.onErrorObservable.clear(),b.dispose()),f})},m.prototype._loadData=function(d){if(this._gltf=d.json,this._setupData(),d.bin){var a=this._gltf.buffers;if(a&&a[0]&&!a[0].uri){var b=a[0];(b.byteLength<d.bin.byteLength-3||b.byteLength>d.bin.byteLength)&&h.Logger.Warn("Binary buffer length ("+b.byteLength+") from JSON does not match chunk length ("+d.bin.byteLength+")"),this._bin=d.bin}else h.Logger.Warn("Unexpected BIN chunk")}},m.prototype._setupData=function(){if(H.Assign(this._gltf.accessors),H.Assign(this._gltf.animations),H.Assign(this._gltf.buffers),H.Assign(this._gltf.bufferViews),H.Assign(this._gltf.cameras),H.Assign(this._gltf.images),H.Assign(this._gltf.materials),H.Assign(this._gltf.meshes),H.Assign(this._gltf.nodes),H.Assign(this._gltf.samplers),H.Assign(this._gltf.scenes),H.Assign(this._gltf.skins),H.Assign(this._gltf.textures),this._gltf.nodes){for(var d={},a=0,b=this._gltf.nodes;a<b.length;a++)if((v=b[a]).children)for(var f=0,i=v.children;f<i.length;f++)d[i[f]]=v.index;for(var n=this._createRootNode(),g=0,p=this._gltf.nodes;g<p.length;g++){var v,z=d[(v=p[g]).index];v.parent=void 0===z?n:this._gltf.nodes[z]}}},m.prototype._loadExtensions=function(){for(var d in m._RegisteredExtensions){var a=m._RegisteredExtensions[d].factory(this);a.name!==d&&h.Logger.Warn("The name of the glTF loader extension instance does not match the registered name: "+a.name+" !== "+d),this._extensions.push(a),this._parent.onExtensionLoadedObservable.notifyObservers(a)}this._extensions.sort(function(b,f){return(b.order||Number.MAX_VALUE)-(f.order||Number.MAX_VALUE)}),this._parent.onExtensionLoadedObservable.clear()},m.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var d=function(i){if(!a._extensions.some(function(n){return n.name===i&&n.enabled}))throw new Error("Require extension "+i+" is not available")},a=this,b=0,f=this._gltf.extensionsRequired;b<f.length;b++)d(f[b])},m.prototype._setState=function(d){this._state=d,this.log(y.GLTFLoaderState[this._state])},m.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=this._forAssetContainer,this._rootBabylonMesh=new h.Mesh("__root__",this._babylonScene),this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var d={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case y.GLTFLoaderCoordinateSystemMode.AUTO:this._babylonScene.useRightHandedSystem||(d.rotation=[0,1,0,0],d.scale=[1,1,-1],m._LoadTransform(d,this._rootBabylonMesh));break;case y.GLTFLoaderCoordinateSystemMode.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")")}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),d},m.prototype.loadSceneAsync=function(d,a){var b=this,f=this._extensionsLoadSceneAsync(d,a);if(f)return f;var i=new Array();if(this.logOpen(d+" "+(a.name||"")),a.nodes)for(var n=0,g=a.nodes;n<g.length;n++){var p=g[n],v=H.Get(d+"/nodes/"+p,this._gltf.nodes,p);i.push(this.loadNodeAsync("/nodes/"+v.index,v,function(S){S.parent=b._rootBabylonMesh}))}if(this._gltf.nodes){for(var z=0,A=this._gltf.nodes;z<A.length;z++)if((v=A[z])._babylonTransformNode&&v._babylonBones)for(var F=0,J=v._babylonBones;F<J.length;F++)J[F].linkTransformNode(v._babylonTransformNode)}return i.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(i).then(function(){})},m.prototype._forEachPrimitive=function(d,a){if(d._primitiveBabylonMeshes)for(var b=0,f=d._primitiveBabylonMeshes;b<f.length;b++)a(f[b])},m.prototype._getMeshes=function(){var d=new Array();d.push(this._rootBabylonMesh);var a=this._gltf.nodes;if(a)for(var b=0,f=a;b<f.length;b++){var i=f[b];this._forEachPrimitive(i,function(n){d.push(n)})}return d},m.prototype._getTransformNodes=function(){var d=new Array(),a=this._gltf.nodes;if(a)for(var b=0,f=a;b<f.length;b++){var i=f[b];i._babylonTransformNode&&"TransformNode"===i._babylonTransformNode.getClassName()&&d.push(i._babylonTransformNode)}return d},m.prototype._getSkeletons=function(){var d=new Array(),a=this._gltf.skins;if(a)for(var b=0,f=a;b<f.length;b++){var i=f[b];i._data&&d.push(i._data.babylonSkeleton)}return d},m.prototype._getAnimationGroups=function(){var d=new Array(),a=this._gltf.animations;if(a)for(var b=0,f=a;b<f.length;b++){var i=f[b];i._babylonAnimationGroup&&d.push(i._babylonAnimationGroup)}return d},m.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case y.GLTFLoaderAnimationStartMode.NONE:break;case y.GLTFLoaderAnimationStartMode.FIRST:0!==(d=this._getAnimationGroups()).length&&d[0].start(!0);break;case y.GLTFLoaderAnimationStartMode.ALL:for(var d,a=0,b=d=this._getAnimationGroups();a<b.length;a++)b[a].start(!0);break;default:return void h.Logger.Error("Invalid animation start mode ("+this._parent.animationStartMode+")")}},m.prototype.loadNodeAsync=function(d,a,b){var f=this;void 0===b&&(b=function(){});var i=this._extensionsLoadNodeAsync(d,a,b);if(i)return i;if(a._babylonTransformNode)throw new Error(d+": Invalid recursive node hierarchy");var n=new Array();this.logOpen(d+" "+(a.name||""));var g=function(z){if(m.AddPointerMetadata(z,d),m._LoadTransform(a,z),null!=a.camera){var A=H.Get(d+"/camera",f._gltf.cameras,a.camera);n.push(f.loadCameraAsync("/cameras/"+A.index,A,function(Z){Z.parent=z}))}if(a.children)for(var F=0,J=a.children;F<J.length;F++){var S=J[F],R=H.Get(d+"/children/"+S,f._gltf.nodes,S);n.push(f.loadNodeAsync("/nodes/"+R.index,R,function(Z){Z.parent=z}))}b(z)};if(null==a.mesh){var p=a.name||"node"+a.index;this._babylonScene._blockEntityCollection=this._forAssetContainer,a._babylonTransformNode=new h.TransformNode(p,this._babylonScene),this._babylonScene._blockEntityCollection=!1,g(a._babylonTransformNode)}else{var v=H.Get(d+"/mesh",this._gltf.meshes,a.mesh);n.push(this._loadMeshAsync("/meshes/"+v.index,a,v,g))}return this.logClose(),Promise.all(n).then(function(){return f._forEachPrimitive(a,function(z){z.refreshBoundingInfo(!0)}),a._babylonTransformNode})},m.prototype._loadMeshAsync=function(d,a,b,f){var i=b.primitives;if(!i||!i.length)throw new Error(d+": Primitives are missing");null==i[0].index&&H.Assign(i);var n=new Array();this.logOpen(d+" "+(b.name||""));var g=a.name||"node"+a.index;if(1===i.length){var p=b.primitives[0];n.push(this._loadMeshPrimitiveAsync(d+"/primitives/"+p.index,g,a,b,p,function(F){a._babylonTransformNode=F,a._primitiveBabylonMeshes=[F]}))}else{a._babylonTransformNode=new h.TransformNode(g,this._babylonScene),a._primitiveBabylonMeshes=[];for(var v=0,z=i;v<z.length;v++)p=z[v],n.push(this._loadMeshPrimitiveAsync(d+"/primitives/"+p.index,g+"_primitive"+p.index,a,b,p,function(F){F.parent=a._babylonTransformNode,a._primitiveBabylonMeshes.push(F)}))}if(null!=a.skin){var A=H.Get(d+"/skin",this._gltf.skins,a.skin);n.push(this._loadSkinAsync("/skins/"+A.index,a,A))}return f(a._babylonTransformNode),this.logClose(),Promise.all(n).then(function(){return a._babylonTransformNode})},m.prototype._loadMeshPrimitiveAsync=function(d,a,b,f,i,n){var g=this,p=this._extensionsLoadMeshPrimitiveAsync(d,a,b,f,i,n);if(p)return p;this.logOpen(""+d);var v,z,A=this._parent.createInstances&&null==b.skin&&!f.primitives[0].targets;if(A&&i._instanceData)v=i._instanceData.babylonSourceMesh.createInstance(a),z=i._instanceData.promise;else{var F=new Array();this._babylonScene._blockEntityCollection=this._forAssetContainer;var J=new h.Mesh(a,this._babylonScene);this._babylonScene._blockEntityCollection=!1,J.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?h.Material.CounterClockWiseSideOrientation:h.Material.ClockWiseSideOrientation,this._createMorphTargets(d,b,f,i,J),F.push(this._loadVertexDataAsync(d,i,J).then(function(_){return g._loadMorphTargetsAsync(d,i,J,_).then(function(){_.applyToMesh(J)})}));var S=m._GetDrawMode(d,i.mode);if(null==i.material){var R=this._defaultBabylonMaterialData[S];R||(R=this._createDefaultMaterial("__GLTFLoader._default",S),this._parent.onMaterialLoadedObservable.notifyObservers(R),this._defaultBabylonMaterialData[S]=R),J.material=R}else{var Z=H.Get(d+"/material",this._gltf.materials,i.material);F.push(this._loadMaterialAsync("/materials/"+Z.index,Z,J,S,function(_){J.material=_}))}z=Promise.all(F),A&&(i._instanceData={babylonSourceMesh:J,promise:z}),v=J}return m.AddPointerMetadata(v,d),this._parent.onMeshLoadedObservable.notifyObservers(v),n(v),this.logClose(),z.then(function(){return v})},m.prototype._loadVertexDataAsync=function(d,a,b){var f=this,i=this._extensionsLoadVertexDataAsync(d,a,b);if(i)return i;var n=a.attributes;if(!n)throw new Error(d+": Attributes are missing");var g=new Array(),p=new h.Geometry(b.name,this._babylonScene);if(null==a.indices)b.isUnIndexed=!0;else{var v=H.Get(d+"/indices",this._gltf.accessors,a.indices);g.push(this._loadIndicesAccessorAsync("/accessors/"+v.index,v).then(function(A){p.setIndices(A)}))}var z=function(A,F,J){if(null!=n[A]){b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(F)&&b._delayInfo.push(F);var S=H.Get(d+"/attributes/"+A,f._gltf.accessors,n[A]);g.push(f._loadVertexAccessorAsync("/accessors/"+S.index,S,F).then(function(R){p.setVerticesBuffer(R,S.count)})),F==h.VertexBuffer.MatricesIndicesExtraKind&&(b.numBoneInfluencers=8),J&&J(S)}};return z("POSITION",h.VertexBuffer.PositionKind),z("NORMAL",h.VertexBuffer.NormalKind),z("TANGENT",h.VertexBuffer.TangentKind),z("TEXCOORD_0",h.VertexBuffer.UVKind),z("TEXCOORD_1",h.VertexBuffer.UV2Kind),z("JOINTS_0",h.VertexBuffer.MatricesIndicesKind),z("WEIGHTS_0",h.VertexBuffer.MatricesWeightsKind),z("JOINTS_1",h.VertexBuffer.MatricesIndicesExtraKind),z("WEIGHTS_1",h.VertexBuffer.MatricesWeightsExtraKind),z("COLOR_0",h.VertexBuffer.ColorKind,function(A){"VEC4"===A.type&&(b.hasVertexAlpha=!0)}),Promise.all(g).then(function(){return p})},m.prototype._createMorphTargets=function(d,a,b,f,i){if(f.targets){if(null==a._numMorphTargets)a._numMorphTargets=f.targets.length;else if(f.targets.length!==a._numMorphTargets)throw new Error(d+": Primitives do not have the same number of targets");var n=b.extras?b.extras.targetNames:null;i.morphTargetManager=new h.MorphTargetManager(i.getScene());for(var g=0;g<f.targets.length;g++){var p=a.weights?a.weights[g]:b.weights?b.weights[g]:0,v=n?n[g]:"morphTarget"+g;i.morphTargetManager.addTarget(new h.MorphTarget(v,p,i.getScene()))}}},m.prototype._loadMorphTargetsAsync=function(d,a,b,f){if(!a.targets)return Promise.resolve();for(var i=new Array(),n=b.morphTargetManager,g=0;g<n.numTargets;g++){var p=n.getTarget(g);i.push(this._loadMorphTargetVertexDataAsync(d+"/targets/"+g,f,a.targets[g],p))}return Promise.all(i).then(function(){})},m.prototype._loadMorphTargetVertexDataAsync=function(d,a,b,f){var i=this,n=new Array(),g=function(p,v,z){if(null!=b[p]){var A=a.getVertexBuffer(v);if(A){var F=H.Get(d+"/"+p,i._gltf.accessors,b[p]);n.push(i._loadFloatAccessorAsync("/accessors/"+F.index,F).then(function(J){z(A,J)}))}}};return g("POSITION",h.VertexBuffer.PositionKind,function(p,v){var z=new Float32Array(v.length);p.forEach(v.length,function(A,F){z[F]=v[F]+A}),f.setPositions(z)}),g("NORMAL",h.VertexBuffer.NormalKind,function(p,v){var z=new Float32Array(v.length);p.forEach(z.length,function(A,F){z[F]=v[F]+A}),f.setNormals(z)}),g("TANGENT",h.VertexBuffer.TangentKind,function(p,v){var z=new Float32Array(v.length/3*4),A=0;p.forEach(v.length/3*4,function(F,J){(J+1)%4!=0&&(z[A]=v[A]+F,A++)}),f.setTangents(z)}),Promise.all(n).then(function(){})},m._LoadTransform=function(d,a){if(null==d.skin){var b=h.Vector3.Zero(),f=h.Quaternion.Identity(),i=h.Vector3.One();d.matrix?h.Matrix.FromArray(d.matrix).decompose(i,f,b):(d.translation&&(b=h.Vector3.FromArray(d.translation)),d.rotation&&(f=h.Quaternion.FromArray(d.rotation)),d.scale&&(i=h.Vector3.FromArray(d.scale))),a.position=b,a.rotationQuaternion=f,a.scaling=i}},m.prototype._loadSkinAsync=function(d,a,b){var f=this,i=this._extensionsLoadSkinAsync(d,a,b);if(i)return i;var n=function(z){f._forEachPrimitive(a,function(A){A.skeleton=z})};if(b._data)return n(b._data.babylonSkeleton),b._data.promise;var g="skeleton"+b.index;this._babylonScene._blockEntityCollection=this._forAssetContainer;var p=new h.Skeleton(b.name||g,g,this._babylonScene);this._babylonScene._blockEntityCollection=!1,p.overrideMesh=this._rootBabylonMesh,this._loadBones(d,b,p),n(p);var v=this._loadSkinInverseBindMatricesDataAsync(d,b).then(function(z){f._updateBoneMatrices(p,z)});return b._data={babylonSkeleton:p,promise:v},v},m.prototype._loadBones=function(d,a,b){for(var f={},i=0,n=a.joints;i<n.length;i++){var g=n[i],p=H.Get(d+"/joints/"+g,this._gltf.nodes,g);this._loadBone(p,a,b,f)}},m.prototype._loadBone=function(d,a,b,f){var i=f[d.index];if(i)return i;var n=null;d.parent&&d.parent._babylonTransformNode!==this._rootBabylonMesh&&(n=this._loadBone(d.parent,a,b,f));var g=a.joints.indexOf(d.index);return i=new h.Bone(d.name||"joint"+d.index,b,n,this._getNodeMatrix(d),null,null,g),f[d.index]=i,d._babylonBones=d._babylonBones||[],d._babylonBones.push(i),i},m.prototype._loadSkinInverseBindMatricesDataAsync=function(d,a){if(null==a.inverseBindMatrices)return Promise.resolve(null);var b=H.Get(d+"/inverseBindMatrices",this._gltf.accessors,a.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/"+b.index,b)},m.prototype._updateBoneMatrices=function(d,a){for(var b=0,f=d.bones;b<f.length;b++){var i=f[b],n=h.Matrix.Identity(),g=i._index;a&&-1!==g&&(h.Matrix.FromArrayToRef(a,16*g,n),n.invertToRef(n));var p=i.getParent();p&&n.multiplyToRef(p.getInvertedAbsoluteTransform(),n),i.updateMatrix(n,!1,!1),i._updateDifferenceMatrix(void 0,!1)}},m.prototype._getNodeMatrix=function(d){return d.matrix?h.Matrix.FromArray(d.matrix):h.Matrix.Compose(d.scale?h.Vector3.FromArray(d.scale):h.Vector3.One(),d.rotation?h.Quaternion.FromArray(d.rotation):h.Quaternion.Identity(),d.translation?h.Vector3.FromArray(d.translation):h.Vector3.Zero())},m.prototype.loadCameraAsync=function(d,a,b){void 0===b&&(b=function(){});var f=this._extensionsLoadCameraAsync(d,a,b);if(f)return f;var i=new Array();this.logOpen(d+" "+(a.name||"")),this._babylonScene._blockEntityCollection=this._forAssetContainer;var n=new h.FreeCamera(a.name||"camera"+a.index,h.Vector3.Zero(),this._babylonScene,!1);switch(this._babylonScene._blockEntityCollection=!1,n.rotation=new h.Vector3(0,Math.PI,0),a.type){case"perspective":var g=a.perspective;if(!g)throw new Error(d+": Camera perspective properties are missing");n.fov=g.yfov,n.minZ=g.znear,n.maxZ=g.zfar||Number.MAX_VALUE;break;case"orthographic":if(!a.orthographic)throw new Error(d+": Camera orthographic properties are missing");n.mode=h.Camera.ORTHOGRAPHIC_CAMERA,n.orthoLeft=-a.orthographic.xmag,n.orthoRight=a.orthographic.xmag,n.orthoBottom=-a.orthographic.ymag,n.orthoTop=a.orthographic.ymag,n.minZ=a.orthographic.znear,n.maxZ=a.orthographic.zfar;break;default:throw new Error(d+": Invalid camera type ("+a.type+")")}return m.AddPointerMetadata(n,d),this._parent.onCameraLoadedObservable.notifyObservers(n),b(n),Promise.all(i).then(function(){return n})},m.prototype._loadAnimationsAsync=function(){var d=this._gltf.animations;if(!d)return Promise.resolve();for(var a=new Array(),b=0;b<d.length;b++){var f=d[b];a.push(this.loadAnimationAsync("/animations/"+f.index,f))}return Promise.all(a).then(function(){})},m.prototype.loadAnimationAsync=function(d,a){var b=this._extensionsLoadAnimationAsync(d,a);if(b)return b;this._babylonScene._blockEntityCollection=this._forAssetContainer;var f=new h.AnimationGroup(a.name||"animation"+a.index,this._babylonScene);this._babylonScene._blockEntityCollection=!1,a._babylonAnimationGroup=f;var i=new Array();H.Assign(a.channels),H.Assign(a.samplers);for(var n=0,g=a.channels;n<g.length;n++){var p=g[n];i.push(this._loadAnimationChannelAsync(d+"/channels/"+p.index,d,a,p,f))}return Promise.all(i).then(function(){return f.normalize(0),f})},m.prototype._loadAnimationChannelAsync=function(d,a,b,f,i,n){var g=this;if(void 0===n&&(n=null),null==f.target.node)return Promise.resolve();var p=H.Get(d+"/target/node",this._gltf.nodes,f.target.node);if("weights"===f.target.path&&!p._numMorphTargets||"weights"!==f.target.path&&!p._babylonTransformNode)return Promise.resolve();var v=H.Get(d+"/sampler",b.samplers,f.sampler);return this._loadAnimationSamplerAsync(a+"/samplers/"+f.sampler,v).then(function(z){var A,F;switch(f.target.path){case"translation":A="position",F=h.Animation.ANIMATIONTYPE_VECTOR3;break;case"rotation":A="rotationQuaternion",F=h.Animation.ANIMATIONTYPE_QUATERNION;break;case"scale":A="scaling",F=h.Animation.ANIMATIONTYPE_VECTOR3;break;case"weights":A="influence",F=h.Animation.ANIMATIONTYPE_FLOAT;break;default:throw new Error(d+"/target/path: Invalid value ("+f.target.path+")")}var J,S,R=0;switch(A){case"position":J=function(){var X=h.Vector3.FromArray(z.output,R);return R+=3,X};break;case"rotationQuaternion":J=function(){var X=h.Quaternion.FromArray(z.output,R);return R+=4,X};break;case"scaling":J=function(){var X=h.Vector3.FromArray(z.output,R);return R+=3,X};break;case"influence":J=function(){for(var X=new Array(p._numMorphTargets),ba=0;ba<p._numMorphTargets;ba++)X[ba]=z.output[R++];return X}}switch(z.interpolation){case"STEP":S=function(X){return{frame:z.input[X],value:J(),interpolation:h.AnimationKeyInterpolation.STEP}};break;case"LINEAR":S=function(X){return{frame:z.input[X],value:J()}};break;case"CUBICSPLINE":S=function(X){return{frame:z.input[X],inTangent:J(),value:J(),outTangent:J()}}}for(var Z=new Array(z.input.length),_=0;_<z.input.length;_++)Z[_]=S(_);if("influence"===A)for(var ja=function(X){var ba=i.name+"_channel"+i.targetedAnimations.length,na=new h.Animation(ba,A,1,F);na.setKeys(Z.map(function(ga){return{frame:ga.frame,inTangent:ga.inTangent?ga.inTangent[X]:void 0,value:ga.value[X],outTangent:ga.outTangent?ga.outTangent[X]:void 0}})),g._forEachPrimitive(p,function(ga){var pa=ga.morphTargetManager.getTarget(X),oa=na.clone();pa.animations.push(oa),i.addTargetedAnimation(oa,pa)})},ha=0;ha<p._numMorphTargets;ha++)ja(ha);else{var ra=i.name+"_channel"+i.targetedAnimations.length,ka=new h.Animation(ra,A,1,F);ka.setKeys(Z),null!=n&&null!=n.animations?(n.animations.push(ka),i.addTargetedAnimation(ka,n)):(p._babylonTransformNode.animations.push(ka),i.addTargetedAnimation(ka,p._babylonTransformNode))}})},m.prototype._loadAnimationSamplerAsync=function(d,a){if(a._data)return a._data;var b=a.interpolation||"LINEAR";switch(b){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(d+"/interpolation: Invalid value ("+a.interpolation+")")}var f=H.Get(d+"/input",this._gltf.accessors,a.input),i=H.Get(d+"/output",this._gltf.accessors,a.output);return a._data=Promise.all([this._loadFloatAccessorAsync("/accessors/"+f.index,f),this._loadFloatAccessorAsync("/accessors/"+i.index,i)]).then(function(n){var g=n[0],p=n[1];return{input:g,interpolation:b,output:p}}),a._data},m.prototype._loadBufferAsync=function(d,a,b,f){var i=this._extensionsLoadBufferAsync(d,a,b,f);if(i)return i;if(!a._data)if(a.uri)a._data=this.loadUriAsync(d+"/uri",a,a.uri);else{if(!this._bin)throw new Error(d+": Uri is missing or the binary glTF is missing its binary chunk");a._data=this._bin.readAsync(0,a.byteLength)}return a._data.then(function(n){try{return new Uint8Array(n.buffer,n.byteOffset+b,f)}catch(g){throw new Error(d+": "+g.message)}})},m.prototype.loadBufferViewAsync=function(d,a){var b=this._extensionsLoadBufferViewAsync(d,a);if(b)return b;if(a._data)return a._data;var f=H.Get(d+"/buffer",this._gltf.buffers,a.buffer);return a._data=this._loadBufferAsync("/buffers/"+f.index,f,a.byteOffset||0,a.byteLength),a._data},m.prototype._loadAccessorAsync=function(d,a,b){var f=this;if(a._data)return a._data;var i=m._GetNumComponents(d,a.type),n=i*h.VertexBuffer.GetTypeByteLength(a.componentType),g=i*a.count;if(null==a.bufferView)a._data=Promise.resolve(new b(g));else{var p=H.Get(d+"/bufferView",this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync("/bufferViews/"+p.index,p).then(function(z){if(5126!==a.componentType||a.normalized){var A=new b(g);return h.VertexBuffer.ForEach(z,a.byteOffset||0,p.byteStride||n,i,a.componentType,A.length,a.normalized||!1,function(F,J){A[J]=F}),A}return m._GetTypedArray(d,a.componentType,z,a.byteOffset,g)})}if(a.sparse){var v=a.sparse;a._data=a._data.then(function(z){var A=z,F=H.Get(d+"/sparse/indices/bufferView",f._gltf.bufferViews,v.indices.bufferView),J=H.Get(d+"/sparse/values/bufferView",f._gltf.bufferViews,v.values.bufferView);return Promise.all([f.loadBufferViewAsync("/bufferViews/"+F.index,F),f.loadBufferViewAsync("/bufferViews/"+J.index,J)]).then(function(S){var R,Z=S[0],_=S[1],ja=m._GetTypedArray(d+"/sparse/indices",v.indices.componentType,Z,v.indices.byteOffset,v.count),ha=i*v.count;if(5126!==a.componentType||a.normalized){var ra=m._GetTypedArray(d+"/sparse/values",a.componentType,_,v.values.byteOffset,ha);R=new b(ha),h.VertexBuffer.ForEach(ra,0,n,i,a.componentType,R.length,a.normalized||!1,function(ga,pa){R[pa]=ga})}else R=m._GetTypedArray(d+"/sparse/values",a.componentType,_,v.values.byteOffset,ha);for(var ka=0,X=0;X<ja.length;X++)for(var ba=ja[X]*i,na=0;na<i;na++)A[ba++]=R[ka++];return A})})}return a._data},m.prototype._loadFloatAccessorAsync=function(d,a){return this._loadAccessorAsync(d,a,Float32Array)},m.prototype._loadIndicesAccessorAsync=function(d,a){if("SCALAR"!==a.type)throw new Error(d+"/type: Invalid value "+a.type);if(5121!==a.componentType&&5123!==a.componentType&&5125!==a.componentType)throw new Error(d+"/componentType: Invalid value "+a.componentType);if(a._data)return a._data;if(a.sparse){var b=m._GetTypedArrayConstructor(d+"/componentType",a.componentType);a._data=this._loadAccessorAsync(d,a,b)}else{var f=H.Get(d+"/bufferView",this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync("/bufferViews/"+f.index,f).then(function(i){return m._GetTypedArray(d,a.componentType,i,a.byteOffset,a.count)})}return a._data},m.prototype._loadVertexBufferViewAsync=function(d,a){var b=this;return d._babylonBuffer?d._babylonBuffer:(d._babylonBuffer=this.loadBufferViewAsync("/bufferViews/"+d.index,d).then(function(f){return new h.Buffer(b._babylonScene.getEngine(),f,!1)}),d._babylonBuffer)},m.prototype._loadVertexAccessorAsync=function(d,a,b){var f=this;if(a._babylonVertexBuffer)return a._babylonVertexBuffer;if(a.sparse)a._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+a.index,a).then(function(n){return new h.VertexBuffer(f._babylonScene.getEngine(),n,b,!1)});else if(a.byteOffset&&a.byteOffset%h.VertexBuffer.GetTypeByteLength(a.componentType)!=0)h.Logger.Warn("Accessor byte offset is not a multiple of component type byte length"),a._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+a.index,a).then(function(n){return new h.VertexBuffer(f._babylonScene.getEngine(),n,b,!1)});else if(b===h.VertexBuffer.MatricesIndicesKind||b===h.VertexBuffer.MatricesIndicesExtraKind)a._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+a.index,a).then(function(n){return new h.VertexBuffer(f._babylonScene.getEngine(),n,b,!1)});else{var i=H.Get(d+"/bufferView",this._gltf.bufferViews,a.bufferView);a._babylonVertexBuffer=this._loadVertexBufferViewAsync(i,b).then(function(n){var g=m._GetNumComponents(d,a.type);return new h.VertexBuffer(f._babylonScene.getEngine(),n,b,!1,!1,i.byteStride,!1,a.byteOffset,g,a.componentType,a.normalized,!0)})}return a._babylonVertexBuffer},m.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(d,a,b){if(!(b instanceof h.PBRMaterial))throw new Error(d+": Material type not supported");var f=new Array();return a&&(a.baseColorFactor?(b.albedoColor=h.Color3.FromArray(a.baseColorFactor),b.alpha=a.baseColorFactor[3]):b.albedoColor=h.Color3.White(),b.metallic=null==a.metallicFactor?1:a.metallicFactor,b.roughness=null==a.roughnessFactor?1:a.roughnessFactor,a.baseColorTexture&&f.push(this.loadTextureInfoAsync(d+"/baseColorTexture",a.baseColorTexture,function(i){i.name=b.name+" (Base Color)",b.albedoTexture=i})),a.metallicRoughnessTexture&&(f.push(this.loadTextureInfoAsync(d+"/metallicRoughnessTexture",a.metallicRoughnessTexture,function(i){i.name=b.name+" (Metallic Roughness)",b.metallicTexture=i})),b.useMetallnessFromMetallicTextureBlue=!0,b.useRoughnessFromMetallicTextureGreen=!0,b.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(f).then(function(){})},m.prototype._loadMaterialAsync=function(d,a,b,f,i){void 0===i&&(i=function(){});var n=this._extensionsLoadMaterialAsync(d,a,b,f,i);if(n)return n;a._data=a._data||{};var g=a._data[f];if(!g){this.logOpen(d+" "+(a.name||""));var p=this.createMaterial(d,a,f);g={babylonMaterial:p,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(d,a,p)},a._data[f]=g,m.AddPointerMetadata(p,d),this._parent.onMaterialLoadedObservable.notifyObservers(p),this.logClose()}return g.babylonMeshes.push(b),b.onDisposeObservable.addOnce(function(){var v=g.babylonMeshes.indexOf(b);-1!==v&&g.babylonMeshes.splice(v,1)}),i(g.babylonMaterial),g.promise.then(function(){return g.babylonMaterial})},m.prototype._createDefaultMaterial=function(d,a){this._babylonScene._blockEntityCollection=this._forAssetContainer;var b=new h.PBRMaterial(d,this._babylonScene);return this._babylonScene._blockEntityCollection=!1,b.fillMode=a,b.enableSpecularAntiAliasing=!0,b.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,b.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,b.transparencyMode=h.PBRMaterial.PBRMATERIAL_OPAQUE,b.metallic=1,b.roughness=1,b},m.prototype.createMaterial=function(d,a,b){var f=this._extensionsCreateMaterial(d,a,b);if(f)return f;var i=a.name||"material"+a.index;return this._createDefaultMaterial(i,b)},m.prototype.loadMaterialPropertiesAsync=function(d,a,b){var f=this._extensionsLoadMaterialPropertiesAsync(d,a,b);if(f)return f;var i=new Array();return i.push(this.loadMaterialBasePropertiesAsync(d,a,b)),a.pbrMetallicRoughness&&i.push(this._loadMaterialMetallicRoughnessPropertiesAsync(d+"/pbrMetallicRoughness",a.pbrMetallicRoughness,b)),this.loadMaterialAlphaProperties(d,a,b),Promise.all(i).then(function(){})},m.prototype.loadMaterialBasePropertiesAsync=function(d,a,b){if(!(b instanceof h.PBRMaterial))throw new Error(d+": Material type not supported");var f=new Array();return b.emissiveColor=a.emissiveFactor?h.Color3.FromArray(a.emissiveFactor):new h.Color3(0,0,0),a.doubleSided&&(b.backFaceCulling=!1,b.twoSidedLighting=!0),a.normalTexture&&(f.push(this.loadTextureInfoAsync(d+"/normalTexture",a.normalTexture,function(i){i.name=b.name+" (Normal)",b.bumpTexture=i})),b.invertNormalMapX=!this._babylonScene.useRightHandedSystem,b.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=a.normalTexture.scale&&(b.bumpTexture.level=a.normalTexture.scale),b.forceIrradianceInFragment=!0),a.occlusionTexture&&(f.push(this.loadTextureInfoAsync(d+"/occlusionTexture",a.occlusionTexture,function(i){i.name=b.name+" (Occlusion)",b.ambientTexture=i})),b.useAmbientInGrayScale=!0,null!=a.occlusionTexture.strength&&(b.ambientTextureStrength=a.occlusionTexture.strength)),a.emissiveTexture&&f.push(this.loadTextureInfoAsync(d+"/emissiveTexture",a.emissiveTexture,function(i){i.name=b.name+" (Emissive)",b.emissiveTexture=i})),Promise.all(f).then(function(){})},m.prototype.loadMaterialAlphaProperties=function(d,a,b){if(!(b instanceof h.PBRMaterial))throw new Error(d+": Material type not supported");switch(a.alphaMode||"OPAQUE"){case"OPAQUE":b.transparencyMode=h.PBRMaterial.PBRMATERIAL_OPAQUE;break;case"MASK":b.transparencyMode=h.PBRMaterial.PBRMATERIAL_ALPHATEST,b.alphaCutOff=null==a.alphaCutoff?.5:a.alphaCutoff,b.albedoTexture&&(b.albedoTexture.hasAlpha=!0);break;case"BLEND":b.transparencyMode=h.PBRMaterial.PBRMATERIAL_ALPHABLEND,b.albedoTexture&&(b.albedoTexture.hasAlpha=!0,b.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(d+"/alphaMode: Invalid value ("+a.alphaMode+")")}},m.prototype.loadTextureInfoAsync=function(d,a,b){var f=this;void 0===b&&(b=function(){});var i=this._extensionsLoadTextureInfoAsync(d,a,b);if(i)return i;if(this.logOpen(""+d),a.texCoord>=2)throw new Error(d+"/texCoord: Invalid value ("+a.texCoord+")");var n=H.Get(d+"/index",this._gltf.textures,a.index),g=this._loadTextureAsync("/textures/"+a.index,n,function(p){p.coordinatesIndex=a.texCoord||0,m.AddPointerMetadata(p,d),f._parent.onTextureLoadedObservable.notifyObservers(p),b(p)});return this.logClose(),g},m.prototype._loadTextureAsync=function(d,a,b){void 0===b&&(b=function(){});var f=this._extensionsLoadTextureAsync(d,a,b);if(f)return f;this.logOpen(d+" "+(a.name||""));var i=null==a.sampler?m.DefaultSampler:H.Get(d+"/sampler",this._gltf.samplers,a.sampler),n=H.Get(d+"/source",this._gltf.images,a.source),g=this._createTextureAsync(d,i,n,b);return this.logClose(),g},m.prototype._createTextureAsync=function(d,a,b,f){var i=this;void 0===f&&(f=function(){});var n=this._loadSampler("/samplers/"+a.index,a),g=new Array(),p=new h.Deferred();this._babylonScene._blockEntityCollection=this._forAssetContainer;var v=new h.Texture(null,this._babylonScene,n.noMipMaps,!1,n.samplingMode,function(){i._disposed||p.resolve()},function(z,A){i._disposed||p.reject(new Error(d+": "+(A&&A.message?A.message:z||"Failed to load texture")))},void 0,void 0,void 0,b.mimeType);return this._babylonScene._blockEntityCollection=!1,g.push(p.promise),g.push(this.loadImageAsync("/images/"+b.index,b).then(function(z){var A=b.uri||i._fileName+"#image"+b.index,F="data:"+i._uniqueRootUrl+A;v.updateURL(F,z)})),v.wrapU=n.wrapU,v.wrapV=n.wrapV,f(v),Promise.all(g).then(function(){return v})},m.prototype._loadSampler=function(d,a){return a._data||(a._data={noMipMaps:9728===a.minFilter||9729===a.minFilter,samplingMode:m._GetTextureSamplingMode(d,a),wrapU:m._GetTextureWrapMode(d+"/wrapS",a.wrapS),wrapV:m._GetTextureWrapMode(d+"/wrapT",a.wrapT)}),a._data},m.prototype.loadImageAsync=function(d,a){if(!a._data){if(this.logOpen(d+" "+(a.name||"")),a.uri)a._data=this.loadUriAsync(d+"/uri",a,a.uri);else{var b=H.Get(d+"/bufferView",this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync("/bufferViews/"+b.index,b)}this.logClose()}return a._data},m.prototype.loadUriAsync=function(d,a,b){var f=this,i=this._extensionsLoadUriAsync(d,a,b);if(i)return i;if(!m._ValidateUri(b))throw new Error(d+": '"+b+"' is invalid");if(h.Tools.IsBase64(b)){var n=new Uint8Array(h.Tools.DecodeBase64(b));return this.log("Decoded "+b.substr(0,64)+"... ("+n.length+" bytes)"),Promise.resolve(n)}return this.log("Loading "+b),this._parent.preprocessUrlAsync(this._rootUrl+b).then(function(g){return new Promise(function(p,v){if(!f._disposed){var z=h.Tools.LoadFile(g,function(A){if(!f._disposed){var F=new Uint8Array(A);f.log("Loaded "+b+" ("+F.length+" bytes)"),p(F)}},function(A){if(!f._disposed&&(z&&(z._lengthComputable=A.lengthComputable,z._loaded=A.loaded,z._total=A.total),f._state===y.GLTFLoaderState.LOADING))try{f._onProgress()}catch(F){v(F)}},f._babylonScene.offlineProvider,!0,function(A,F){f._disposed||v(new h.LoadFileError(d+": Failed to load '"+b+"'"+(A?": "+A.status+" "+A.statusText:""),A))});f._requests.push(z)}})})},m.prototype._onProgress=function(){if(this._progressCallback){for(var d=!0,a=0,b=0,f=0,i=this._requests;f<i.length;f++){var n=i[f];if(void 0===n._lengthComputable||void 0===n._loaded||void 0===n._total)return;d=d&&n._lengthComputable,a+=n._loaded,b+=n._total}this._progressCallback(new h.SceneLoaderProgressEvent(d,a,d?b:0))}},m.AddPointerMetadata=function(d,a){var b=d.metadata=d.metadata||{},f=b.gltf=b.gltf||{};(f.pointers=f.pointers||[]).push(a)},m._GetTextureWrapMode=function(d,a){switch(a=null==a?10497:a){case 33071:return h.Texture.CLAMP_ADDRESSMODE;case 33648:return h.Texture.MIRROR_ADDRESSMODE;case 10497:return h.Texture.WRAP_ADDRESSMODE;default:return h.Logger.Warn(d+": Invalid value ("+a+")"),h.Texture.WRAP_ADDRESSMODE}},m._GetTextureSamplingMode=function(d,a){var b=null==a.magFilter?9729:a.magFilter,f=null==a.minFilter?9987:a.minFilter;if(9729===b)switch(f){case 9728:return h.Texture.LINEAR_NEAREST;case 9729:return h.Texture.LINEAR_LINEAR;case 9984:return h.Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return h.Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return h.Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return h.Texture.LINEAR_LINEAR_MIPLINEAR;default:return h.Logger.Warn(d+"/minFilter: Invalid value ("+f+")"),h.Texture.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==b&&h.Logger.Warn(d+"/magFilter: Invalid value ("+b+")"),f){case 9728:return h.Texture.NEAREST_NEAREST;case 9729:return h.Texture.NEAREST_LINEAR;case 9984:return h.Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return h.Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return h.Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return h.Texture.NEAREST_LINEAR_MIPLINEAR;default:return h.Logger.Warn(d+"/minFilter: Invalid value ("+f+")"),h.Texture.NEAREST_NEAREST_MIPNEAREST}},m._GetTypedArrayConstructor=function(d,a){switch(a){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(d+": Invalid component type "+a)}},m._GetTypedArray=function(d,a,b,f,i){var n=b.buffer;f=b.byteOffset+(f||0);var g=m._GetTypedArrayConstructor(d+"/componentType",a);try{return new g(n,f,i)}catch(p){throw new Error(d+": "+p)}},m._GetNumComponents=function(d,a){switch(a){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(d+": Invalid type ("+a+")")},m._ValidateUri=function(d){return h.Tools.IsBase64(d)||-1===d.indexOf("..")},m._GetDrawMode=function(d,a){switch(null==a&&(a=4),a){case 0:return h.Material.PointListDrawMode;case 1:return h.Material.LineListDrawMode;case 2:return h.Material.LineLoopDrawMode;case 3:return h.Material.LineStripDrawMode;case 4:return h.Material.TriangleFillMode;case 5:return h.Material.TriangleStripDrawMode;case 6:return h.Material.TriangleFanDrawMode}throw new Error(d+": Invalid mesh primitive mode ("+a+")")},m.prototype._compileMaterialsAsync=function(){var d=this;this._parent._startPerformanceCounter("Compile materials");var a=new Array();if(this._gltf.materials)for(var b=0,f=this._gltf.materials;b<f.length;b++){var i=f[b];if(i._data)for(var n in i._data)for(var g=i._data[n],p=0,v=g.babylonMeshes;p<v.length;p++){var z=v[p];z.computeWorldMatrix(!0);var A=g.babylonMaterial;a.push(A.forceCompilationAsync(z)),a.push(A.forceCompilationAsync(z,{useInstances:!0})),this._parent.useClipPlane&&(a.push(A.forceCompilationAsync(z,{clipPlane:!0})),a.push(A.forceCompilationAsync(z,{clipPlane:!0,useInstances:!0})))}}return Promise.all(a).then(function(){d._parent._endPerformanceCounter("Compile materials")})},m.prototype._compileShadowGeneratorsAsync=function(){var d=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var a=new Array(),b=0,f=this._babylonScene.lights;b<f.length;b++){var i=f[b].getShadowGenerator();i&&a.push(i.forceCompilationAsync())}return Promise.all(a).then(function(){d._parent._endPerformanceCounter("Compile shadow generators")})},m.prototype._forEachExtensions=function(d){for(var a=0,b=this._extensions;a<b.length;a++){var f=b[a];f.enabled&&d(f)}},m.prototype._applyExtensions=function(d,a,b){for(var f=0,i=this._extensions;f<i.length;f++){var n=i[f];if(n.enabled){var g=n.name+"."+a,p=d;p._activeLoaderExtensionFunctions=p._activeLoaderExtensionFunctions||{};var v=p._activeLoaderExtensionFunctions;if(!v[g]){v[g]=!0;try{var z=b(n);if(z)return z}finally{delete v[g]}}}}return null},m.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(d){return d.onLoading&&d.onLoading()})},m.prototype._extensionsOnReady=function(){this._forEachExtensions(function(d){return d.onReady&&d.onReady()})},m.prototype._extensionsLoadSceneAsync=function(d,a){return this._applyExtensions(a,"loadScene",function(b){return b.loadSceneAsync&&b.loadSceneAsync(d,a)})},m.prototype._extensionsLoadNodeAsync=function(d,a,b){return this._applyExtensions(a,"loadNode",function(f){return f.loadNodeAsync&&f.loadNodeAsync(d,a,b)})},m.prototype._extensionsLoadCameraAsync=function(d,a,b){return this._applyExtensions(a,"loadCamera",function(f){return f.loadCameraAsync&&f.loadCameraAsync(d,a,b)})},m.prototype._extensionsLoadVertexDataAsync=function(d,a,b){return this._applyExtensions(a,"loadVertexData",function(f){return f._loadVertexDataAsync&&f._loadVertexDataAsync(d,a,b)})},m.prototype._extensionsLoadMeshPrimitiveAsync=function(d,a,b,f,i,n){return this._applyExtensions(i,"loadMeshPrimitive",function(g){return g._loadMeshPrimitiveAsync&&g._loadMeshPrimitiveAsync(d,a,b,f,i,n)})},m.prototype._extensionsLoadMaterialAsync=function(d,a,b,f,i){return this._applyExtensions(a,"loadMaterial",function(n){return n._loadMaterialAsync&&n._loadMaterialAsync(d,a,b,f,i)})},m.prototype._extensionsCreateMaterial=function(d,a,b){return this._applyExtensions(a,"createMaterial",function(f){return f.createMaterial&&f.createMaterial(d,a,b)})},m.prototype._extensionsLoadMaterialPropertiesAsync=function(d,a,b){return this._applyExtensions(a,"loadMaterialProperties",function(f){return f.loadMaterialPropertiesAsync&&f.loadMaterialPropertiesAsync(d,a,b)})},m.prototype._extensionsLoadTextureInfoAsync=function(d,a,b){return this._applyExtensions(a,"loadTextureInfo",function(f){return f.loadTextureInfoAsync&&f.loadTextureInfoAsync(d,a,b)})},m.prototype._extensionsLoadTextureAsync=function(d,a,b){return this._applyExtensions(a,"loadTexture",function(f){return f._loadTextureAsync&&f._loadTextureAsync(d,a,b)})},m.prototype._extensionsLoadAnimationAsync=function(d,a){return this._applyExtensions(a,"loadAnimation",function(b){return b.loadAnimationAsync&&b.loadAnimationAsync(d,a)})},m.prototype._extensionsLoadSkinAsync=function(d,a,b){return this._applyExtensions(b,"loadSkin",function(f){return f._loadSkinAsync&&f._loadSkinAsync(d,a,b)})},m.prototype._extensionsLoadUriAsync=function(d,a,b){return this._applyExtensions(a,"loadUri",function(f){return f._loadUriAsync&&f._loadUriAsync(d,a,b)})},m.prototype._extensionsLoadBufferViewAsync=function(d,a){return this._applyExtensions(a,"loadBufferView",function(b){return b.loadBufferViewAsync&&b.loadBufferViewAsync(d,a)})},m.prototype._extensionsLoadBufferAsync=function(d,a,b,f){return this._applyExtensions(a,"loadBuffer",function(i){return i.loadBufferAsync&&i.loadBufferAsync(d,a,b,f)})},m.LoadExtensionAsync=function(d,a,b,f){if(!a.extensions)return null;var i=a.extensions[b];return i?f(d+"/extensions/"+b,i):null},m.LoadExtraAsync=function(d,a,b,f){if(!a.extras)return null;var i=a.extras[b];return i?f(d+"/extras/"+b,i):null},m.prototype.isExtensionUsed=function(d){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(d)},m.prototype.logOpen=function(d){this._parent._logOpen(d)},m.prototype.logClose=function(){this._parent._logClose()},m.prototype.log=function(d){this._parent._log(d)},m.prototype.startPerformanceCounter=function(d){this._parent._startPerformanceCounter(d)},m.prototype.endPerformanceCounter=function(d){this._parent._endPerformanceCounter(d)},m._RegisteredExtensions={},m.DefaultSampler={index:-1},m}();y.GLTFFileLoader._CreateGLTF2Loader=function(m){return new B(m)}},function(fa,G,w){"use strict";w.r(G),w.d(G,"GLTFLoaderCoordinateSystemMode",function(){return h}),w.d(G,"GLTFLoaderAnimationStartMode",function(){return y}),w.d(G,"GLTFLoaderState",function(){return H}),w.d(G,"GLTFFileLoader",function(){return d});var h,y,H,B=w(0),m=w(3);!function(a){a[a.AUTO=0]="AUTO",a[a.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(h||(h={})),function(a){a[a.NONE=0]="NONE",a[a.FIRST=1]="FIRST",a[a.ALL=2]="ALL"}(y||(y={})),function(a){a[a.LOADING=0]="LOADING",a[a.READY=1]="READY",a[a.COMPLETE=2]="COMPLETE"}(H||(H={}));var d=function(){function a(){this.onParsedObservable=new B.Observable(),this.coordinateSystemMode=h.AUTO,this.animationStartMode=y.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.preprocessUrlAsync=function(b){return Promise.resolve(b)},this.onMeshLoadedObservable=new B.Observable(),this.onTextureLoadedObservable=new B.Observable(),this.onMaterialLoadedObservable=new B.Observable(),this.onCameraLoadedObservable=new B.Observable(),this.onCompleteObservable=new B.Observable(),this.onErrorObservable=new B.Observable(),this.onDisposeObservable=new B.Observable(),this.onExtensionLoadedObservable=new B.Observable(),this.validate=!1,this.onValidatedObservable=new B.Observable(),this._loader=null,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(a.prototype,"onParsed",{set:function(b){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onMeshLoaded",{set:function(b){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onTextureLoaded",{set:function(b){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onMaterialLoaded",{set:function(b){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onCameraLoaded",{set:function(b){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onComplete",{set:function(b){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onError",{set:function(b){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onExtensionLoaded",{set:function(b){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(b){this._loggingEnabled!==b&&(this._loggingEnabled=b,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(b){this._capturePerformanceCounters!==b&&(this._capturePerformanceCounters=b,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onValidated",{set:function(b){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(b)},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null),this._clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},a.prototype._clear=function(){this.preprocessUrlAsync=function(b){return Promise.resolve(b)},this.onMeshLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear()},a.prototype.requestFile=function(b,f,i,n,g,p){var v=this;if(g){if(this.useRangeRequests){this.validate&&B.Logger.Warn("glTF validation is not supported when range requests are enabled");var z=new Array(),A={abort:function(){return z.forEach(function(J){return J.abort()})},onCompleteObservable:new B.Observable()},F={readAsync:function(J,S){return new Promise(function(R,Z){z.push(b._requestFile(f,function(_,ja){var ha=ja.getResponseHeader("Content-Range");ha&&(F.byteLength=Number(ha.split("/")[1])),R(new Uint8Array(_))},n,!0,!0,function(_){Z(_)},function(_){_.setRequestHeader("Range","bytes="+J+"-"+(J+S-1))}))})},byteLength:0};return this._unpackBinaryAsync(new B.DataReader(F)).then(function(J){A.onCompleteObservable.notifyObservers(A),i(J)},p),A}return b._requestFile(f,function(J,S){var R=J;v._unpackBinaryAsync(new B.DataReader({readAsync:function(Z,_){return Promise.resolve(new Uint8Array(R,Z,_))},byteLength:R.byteLength})).then(function(Z){i(Z,S)},p)},n,!0,!0,p)}return b._requestFile(f,function(J,S){v._validate(b,J,B.Tools.GetFolderPath(f),B.Tools.GetFilename(f)),i({json:v._parseJson(J)},S)},n,!0,!1,p)},a.prototype.readFile=function(b,f,i,n,g,p){var v=this;return b._readFile(f,function(z){if(v._validate(b,z,"file:",f.name),g){var A=z;v._unpackBinaryAsync(new B.DataReader({readAsync:function(F,J){return Promise.resolve(new Uint8Array(A,F,J))},byteLength:A.byteLength})).then(i,p)}else i({json:v._parseJson(z)})},n,g,p)},a.prototype.importMeshAsync=function(b,f,i,n,g,p){var v=this;return Promise.resolve().then(function(){return v.onParsedObservable.notifyObservers(i),v.onParsedObservable.clear(),v._log("Loading "+(p||"")),v._loader=v._getLoader(i),v._loader.importMeshAsync(b,f,!1,i,n,g,p)})},a.prototype.loadAsync=function(b,f,i,n,g){var p=this;return Promise.resolve().then(function(){return p.onParsedObservable.notifyObservers(f),p.onParsedObservable.clear(),p._log("Loading "+(g||"")),p._loader=p._getLoader(f),p._loader.loadAsync(b,f,i,n,g)})},a.prototype.loadAssetContainerAsync=function(b,f,i,n,g){var p=this;return Promise.resolve().then(function(){p.onParsedObservable.notifyObservers(f),p.onParsedObservable.clear(),p._log("Loading "+(g||"")),p._loader=p._getLoader(f);var v=[];p.onMaterialLoadedObservable.add(function(A){v.push(A)});var z=[];return p.onTextureLoadedObservable.add(function(A){z.push(A)}),p._loader.importMeshAsync(null,b,!0,f,i,n,g).then(function(A){var F=new B.AssetContainer(b);return Array.prototype.push.apply(F.meshes,A.meshes),Array.prototype.push.apply(F.particleSystems,A.particleSystems),Array.prototype.push.apply(F.skeletons,A.skeletons),Array.prototype.push.apply(F.animationGroups,A.animationGroups),Array.prototype.push.apply(F.materials,v),Array.prototype.push.apply(F.textures,z),Array.prototype.push.apply(F.lights,A.lights),Array.prototype.push.apply(F.transformNodes,A.transformNodes),F})})},a.prototype.canDirectLoad=function(b){return-1!==b.indexOf("asset")&&-1!==b.indexOf("version")},a.prototype.directLoad=function(b,f){return this._validate(b,f),{json:this._parseJson(f)}},a.prototype.createPlugin=function(){return new a()},Object.defineProperty(a.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!0,configurable:!0}),a.prototype.whenCompleteAsync=function(){var b=this;return new Promise(function(f,i){b.onCompleteObservable.addOnce(function(){f()}),b.onErrorObservable.addOnce(function(n){i(n)})})},a.prototype._validate=function(b,f,i,n){var g=this;void 0===i&&(i=""),void 0===n&&(n=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),m.GLTFValidation.ValidateAsync(f,i,n,function(p){return g.preprocessUrlAsync(i+p).then(function(v){return b._loadFileAsync(v,void 0,!0,!0)})}).then(function(p){g._endPerformanceCounter("Validate JSON"),g.onValidatedObservable.notifyObservers(p),g.onValidatedObservable.clear()},function(p){g._endPerformanceCounter("Validate JSON"),B.Tools.Warn("Failed to validate: "+p.message),g.onValidatedObservable.clear()}))},a.prototype._getLoader=function(b){var f=b.json.asset||{};this._log("Asset version: "+f.version),f.minVersion&&this._log("Asset minimum version: "+f.minVersion),f.generator&&this._log("Asset generator: "+f.generator);var i=a._parseVersion(f.version);if(!i)throw new Error("Invalid version: "+f.version);if(void 0!==f.minVersion){var n=a._parseVersion(f.minVersion);if(!n)throw new Error("Invalid minimum version: "+f.minVersion);if(a._compareVersion(n,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+f.minVersion)}var g={1:a._CreateGLTF1Loader,2:a._CreateGLTF2Loader}[i.major];if(!g)throw new Error("Unsupported version: "+f.version);return g(this)},a.prototype._parseJson=function(b){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: "+b.length);var f=JSON.parse(b);return this._endPerformanceCounter("Parse JSON"),f},a.prototype._unpackBinaryAsync=function(b){var f=this;return this._startPerformanceCounter("Unpack Binary"),b.loadAsync(20).then(function(){var i=b.readUint32();if(1179937895!==i)throw new Error("Unexpected magic: "+i);var n=b.readUint32();f.loggingEnabled&&f._log("Binary version: "+n);var g,p=b.readUint32();if(0!=b.buffer.byteLength&&p!==b.buffer.byteLength)throw new Error("Length in header does not match actual data length: "+p+" != "+b.buffer.byteLength);switch(n){case 1:g=f._unpackBinaryV1Async(b,p);break;case 2:g=f._unpackBinaryV2Async(b,p);break;default:throw new Error("Unsupported version: "+n)}return f._endPerformanceCounter("Unpack Binary"),g})},a.prototype._unpackBinaryV1Async=function(b,f){var i=b.readUint32(),n=b.readUint32();if(0!==n)throw new Error("Unexpected content format: "+n);var g=f-b.byteOffset,p={json:this._parseJson(b.readString(i)),bin:null};if(0!==g){var v=b.byteOffset;p.bin={readAsync:function(z,A){return b.buffer.readAsync(v+z,A)},byteLength:g}}return Promise.resolve(p)},a.prototype._unpackBinaryV2Async=function(b,f){var i=this,n=1313821514,g=5130562,p=b.readUint32();if(b.readUint32()!==n)throw new Error("First chunk format is not JSON");return b.byteOffset+p===f?b.loadAsync(p).then(function(){return{json:i._parseJson(b.readString(p)),bin:null}}):b.loadAsync(p+8).then(function(){var v={json:i._parseJson(b.readString(p)),bin:null},z=function(){var A=b.readUint32();switch(b.readUint32()){case n:throw new Error("Unexpected JSON chunk");case g:var F=b.byteOffset;v.bin={readAsync:function(J,S){return b.buffer.readAsync(F+J,S)},byteLength:A},b.skipBytes(A);break;default:b.skipBytes(A)}return b.byteOffset!==f?b.loadAsync(8).then(z):Promise.resolve(v)};return z()})},a._parseVersion=function(b){if("1.0"===b||"1.0.1"===b)return{major:1,minor:0};var f=(b+"").match(/^(\d+)\.(\d+)/);return f?{major:parseInt(f[1]),minor:parseInt(f[2])}:null},a._compareVersion=function(b,f){return b.major>f.major?1:b.major<f.major?-1:b.minor>f.minor?1:b.minor<f.minor?-1:0},a.prototype._logOpen=function(b){this._log(b),this._logIndentLevel++},a.prototype._logClose=function(){--this._logIndentLevel},a.prototype._logEnabled=function(b){var f=a._logSpaces.substr(0,2*this._logIndentLevel);B.Logger.Log(""+f+b)},a.prototype._logDisabled=function(b){},a.prototype._startPerformanceCounterEnabled=function(b){B.Tools.StartPerformanceCounter(b)},a.prototype._startPerformanceCounterDisabled=function(b){},a.prototype._endPerformanceCounterEnabled=function(b){B.Tools.EndPerformanceCounter(b)},a.prototype._endPerformanceCounterDisabled=function(b){},a.IncrementalLoading=!0,a.HomogeneousCoordinates=!1,a._logSpaces="                                ",a}();B.SceneLoader&&B.SceneLoader.RegisterPlugin(new d())},function(fa,G,w){"use strict";w.r(G),w.d(G,"GLTFValidation",function(){return H});var h=w(0);function y(B,m,d,a){var b={externalResourceFunction:function(f){return a(f).then(function(i){return new Uint8Array(i)})}};return d&&(b.uri="file:"===m?d:m+d),B instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(B),b):GLTFValidator.validateString(B,b)}var H=function(){function B(){}return B.ValidateAsync=function(m,d,a,b){var f=this;return"function"==typeof Worker?new Promise(function(i,n){var g=y+"("+function(){var F=[];onmessage=function(J){var S=J.data;switch(S.id){case"init":importScripts(S.url);break;case"validate":y(S.data,S.rootUrl,S.fileName,function(R){return new Promise(function(Z,_){var ja=F.length;F.push({resolve:Z,reject:_}),postMessage({id:"getExternalResource",index:ja,uri:R})})}).then(function(R){postMessage({id:"validate.resolve",value:R})},function(R){postMessage({id:"validate.reject",reason:R})});break;case"getExternalResource.resolve":F[S.index].resolve(S.value);break;case"getExternalResource.reject":F[S.index].reject(S.reason)}}}+")()",p=URL.createObjectURL(new Blob([g],{type:"application/javascript"})),v=new Worker(p),z=function(F){v.removeEventListener("error",z),v.removeEventListener("message",A),n(F)},A=function(F){var J=F.data;switch(J.id){case"getExternalResource":b(J.uri).then(function(S){v.postMessage({id:"getExternalResource.resolve",index:J.index,value:S},[S])},function(S){v.postMessage({id:"getExternalResource.reject",index:J.index,reason:S})});break;case"validate.resolve":v.removeEventListener("error",z),v.removeEventListener("message",A),i(J.value);break;case"validate.reject":v.removeEventListener("error",z),v.removeEventListener("message",A),n(J.reason)}};v.addEventListener("error",z),v.addEventListener("message",A),v.postMessage({id:"init",url:h.Tools.GetAbsoluteUrl(f.Configuration.url)}),v.postMessage({id:"validate",data:m,rootUrl:d,fileName:a})}):(this._LoadScriptPromise||(this._LoadScriptPromise=h.Tools.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(function(){return y(m,d,a,b)}))},B.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"},B}()},function(fa,G){var w;w=function(){return this}();try{w=w||new Function("return this")()}catch(h){"object"==typeof window&&(w=window)}fa.exports=w},function(fa,G,w){"use strict";w.r(G);var h=w(0),y=w(1),H="EXT_lights_image_based",B=function(){function C(r){this.name=H,this._loader=r,this.enabled=this._loader.isExtensionUsed(H)}return C.prototype.dispose=function(){delete this._loader,delete this._lights},C.prototype.onLoading=function(){var r=this._loader.gltf.extensions;if(r&&r[this.name]){var o=r[this.name];this._lights=o.lights}},C.prototype.loadSceneAsync=function(r,o){var s=this;return y.b.LoadExtensionAsync(r,o,this.name,function(x,E){var c=new Array();c.push(s._loader.loadSceneAsync(r,o)),s._loader.logOpen(""+x);var e=y.a.Get(x+"/light",s._lights,E.light);return c.push(s._loadLightAsync("#/extensions/"+s.name+"/lights/"+E.light,e).then(function(k){s._loader.babylonScene.environmentTexture=k})),s._loader.logClose(),Promise.all(c).then(function(){})})},C.prototype._loadLightAsync=function(r,o){var s=this;if(!o._loaded){var x=new Array();this._loader.logOpen(""+r);for(var E=new Array(o.specularImages.length),c=function(l){var j=o.specularImages[l];E[l]=new Array(j.length);for(var q=function(t){var D=r+"/specularImages/"+l+"/"+t;e._loader.logOpen(""+D);var I=j[t],M=y.a.Get(D,e._loader.gltf.images,I);x.push(e._loader.loadImageAsync("#/images/"+I,M).then(function(N){E[l][t]=N})),e._loader.logClose()},u=0;u<j.length;u++)q(u)},e=this,k=0;k<o.specularImages.length;k++)c(k);this._loader.logClose(),o._loaded=Promise.all(x).then(function(){var l=new h.RawCubeTexture(s._loader.babylonScene,null,o.specularImageSize);if(o._babylonTexture=l,null!=o.intensity&&(l.level=o.intensity),o.rotation){var j=h.Quaternion.FromArray(o.rotation);s._loader.babylonScene.useRightHandedSystem||(j=h.Quaternion.Inverse(j)),h.Matrix.FromQuaternionToRef(j,l.getReflectionTextureMatrix())}var q=h.SphericalHarmonics.FromArray(o.irradianceCoefficients);q.scaleInPlace(o.intensity),q.convertIrradianceToLambertianRadiance();var u=h.SphericalPolynomial.FromHarmonics(q),t=(E.length-1)/h.Scalar.Log2(o.specularImageSize);return l.updateRGBDAsync(E,u,t)})}return o._loaded.then(function(){return o._babylonTexture})},C}();y.b.RegisterExtension(H,function(C){return new B(C)});var m="KHR_draco_mesh_compression",d=function(){function C(r){this.name=m,this._loader=r,this.enabled=h.DracoCompression.DecoderAvailable&&this._loader.isExtensionUsed(m)}return C.prototype.dispose=function(){delete this.dracoCompression,delete this._loader},C.prototype._loadVertexDataAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(E,c){if(null!=o.mode){if(5!==o.mode&&4!==o.mode)throw new Error(r+": Unsupported mode "+o.mode);if(5===o.mode)throw new Error(r+": Mode "+o.mode+" is not currently supported")}var e={},k=function(j,q){var u=c.attributes[j];null!=u&&(s._delayInfo=s._delayInfo||[],-1===s._delayInfo.indexOf(q)&&s._delayInfo.push(q),e[q]=u)};k("POSITION",h.VertexBuffer.PositionKind),k("NORMAL",h.VertexBuffer.NormalKind),k("TANGENT",h.VertexBuffer.TangentKind),k("TEXCOORD_0",h.VertexBuffer.UVKind),k("TEXCOORD_1",h.VertexBuffer.UV2Kind),k("JOINTS_0",h.VertexBuffer.MatricesIndicesKind),k("WEIGHTS_0",h.VertexBuffer.MatricesWeightsKind),k("COLOR_0",h.VertexBuffer.ColorKind);var l=y.a.Get(E,x._loader.gltf.bufferViews,c.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=x._loader.loadBufferViewAsync("#/bufferViews/"+l.index,l).then(function(j){return(x.dracoCompression||h.DracoCompression.Default).decodeMeshAsync(j,e).then(function(q){var u=new h.Geometry(s.name,x._loader.babylonScene);return q.applyToGeometry(u),u}).catch(function(q){throw new Error(r+": "+q.message)})})),l._dracoBabylonGeometry})},C}();y.b.RegisterExtension(m,function(C){return new d(C)});var a,b="KHR_lights_punctual";!function(C){C.DIRECTIONAL="directional",C.POINT="point",C.SPOT="spot"}(a||(a={}));var f=function(){function C(r){this.name=b,this._loader=r,this.enabled=this._loader.isExtensionUsed(b)}return C.prototype.dispose=function(){delete this._loader,delete this._lights},C.prototype.onLoading=function(){var r=this._loader.gltf.extensions;if(r&&r[this.name]){var o=r[this.name];this._lights=o.lights}},C.prototype.loadNodeAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(E,c){return x._loader.loadNodeAsync(r,o,function(e){var k,l=y.a.Get(E,x._lights,c.light),j=l.name||e.name;switch(x._loader.babylonScene._blockEntityCollection=x._loader._forAssetContainer,l.type){case a.DIRECTIONAL:k=new h.DirectionalLight(j,h.Vector3.Backward(),x._loader.babylonScene);break;case a.POINT:k=new h.PointLight(j,h.Vector3.Zero(),x._loader.babylonScene);break;case a.SPOT:var q=new h.SpotLight(j,h.Vector3.Zero(),h.Vector3.Backward(),0,1,x._loader.babylonScene);q.angle=2*(l.spot&&l.spot.outerConeAngle||Math.PI/4),q.innerAngle=2*(l.spot&&l.spot.innerConeAngle||0),k=q;break;default:throw x._loader.babylonScene._blockEntityCollection=!1,new Error(E+": Invalid light type ("+l.type+")")}x._loader.babylonScene._blockEntityCollection=!1,k.falloffType=h.Light.FALLOFF_GLTF,k.diffuse=l.color?h.Color3.FromArray(l.color):h.Color3.White(),k.intensity=null==l.intensity?1:l.intensity,k.range=null==l.range?Number.MAX_VALUE:l.range,k.parent=e,x._loader._babylonLights.push(k),y.b.AddPointerMetadata(k,E),s(e)})})},C}();y.b.RegisterExtension(b,function(C){return new f(C)});var i="KHR_materials_pbrSpecularGlossiness",n=function(){function C(r){this.name=i,this.order=200,this._loader=r,this.enabled=this._loader.isExtensionUsed(i)}return C.prototype.dispose=function(){delete this._loader},C.prototype.loadMaterialPropertiesAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(E,c){var e=new Array();return e.push(x._loader.loadMaterialBasePropertiesAsync(r,o,s)),e.push(x._loadSpecularGlossinessPropertiesAsync(E,o,c,s)),x._loader.loadMaterialAlphaProperties(r,o,s),Promise.all(e).then(function(){})})},C.prototype._loadSpecularGlossinessPropertiesAsync=function(r,o,s,x){if(!(x instanceof h.PBRMaterial))throw new Error(r+": Material type not supported");var E=new Array();return x.metallic=null,x.roughness=null,s.diffuseFactor?(x.albedoColor=h.Color3.FromArray(s.diffuseFactor),x.alpha=s.diffuseFactor[3]):x.albedoColor=h.Color3.White(),x.reflectivityColor=s.specularFactor?h.Color3.FromArray(s.specularFactor):h.Color3.White(),x.microSurface=null==s.glossinessFactor?1:s.glossinessFactor,s.diffuseTexture&&E.push(this._loader.loadTextureInfoAsync(r+"/diffuseTexture",s.diffuseTexture,function(c){c.name=x.name+" (Diffuse)",x.albedoTexture=c})),s.specularGlossinessTexture&&(E.push(this._loader.loadTextureInfoAsync(r+"/specularGlossinessTexture",s.specularGlossinessTexture,function(c){c.name=x.name+" (Specular Glossiness)",x.reflectivityTexture=c})),x.reflectivityTexture.hasAlpha=!0,x.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(E).then(function(){})},C}();y.b.RegisterExtension(i,function(C){return new n(C)});var g="KHR_materials_unlit",p=function(){function C(r){this.name=g,this.order=210,this._loader=r,this.enabled=this._loader.isExtensionUsed(g)}return C.prototype.dispose=function(){delete this._loader},C.prototype.loadMaterialPropertiesAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(){return x._loadUnlitPropertiesAsync(r,o,s)})},C.prototype._loadUnlitPropertiesAsync=function(r,o,s){if(!(s instanceof h.PBRMaterial))throw new Error(r+": Material type not supported");var x=new Array();s.unlit=!0;var E=o.pbrMetallicRoughness;return E&&(E.baseColorFactor?(s.albedoColor=h.Color3.FromArray(E.baseColorFactor),s.alpha=E.baseColorFactor[3]):s.albedoColor=h.Color3.White(),E.baseColorTexture&&x.push(this._loader.loadTextureInfoAsync(r+"/baseColorTexture",E.baseColorTexture,function(c){c.name=s.name+" (Base Color)",s.albedoTexture=c}))),o.doubleSided&&(s.backFaceCulling=!1,s.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(r,o,s),Promise.all(x).then(function(){})},C}();y.b.RegisterExtension(g,function(C){return new p(C)});var v="KHR_materials_clearcoat",z=function(){function C(r){this.name=v,this.order=190,this._loader=r,this.enabled=this._loader.isExtensionUsed(v)}return C.prototype.dispose=function(){delete this._loader},C.prototype.loadMaterialPropertiesAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(E,c){var e=new Array();return e.push(x._loader.loadMaterialPropertiesAsync(r,o,s)),e.push(x._loadClearCoatPropertiesAsync(E,c,s)),Promise.all(e).then(function(){})})},C.prototype._loadClearCoatPropertiesAsync=function(r,o,s){if(!(s instanceof h.PBRMaterial))throw new Error(r+": Material type not supported");var x=new Array();return s.clearCoat.isEnabled=!0,null!=o.clearcoatFactor?s.clearCoat.intensity=o.clearcoatFactor:s.clearCoat.intensity=0,o.clearcoatTexture&&x.push(this._loader.loadTextureInfoAsync(r+"/clearcoatTexture",o.clearcoatTexture,function(E){E.name=s.name+" (ClearCoat Intensity)",s.clearCoat.texture=E})),null!=o.clearcoatRoughnessFactor?s.clearCoat.roughness=o.clearcoatRoughnessFactor:s.clearCoat.roughness=0,o.clearcoatRoughnessTexture&&x.push(this._loader.loadTextureInfoAsync(r+"/clearcoatRoughnessTexture",o.clearcoatRoughnessTexture,function(E){E.name=s.name+" (ClearCoat Roughness)",s.clearCoat.texture=E})),o.clearcoatNormalTexture&&(x.push(this._loader.loadTextureInfoAsync(r+"/clearcoatNormalTexture",o.clearcoatNormalTexture,function(E){E.name=s.name+" (ClearCoat Normal)",s.clearCoat.bumpTexture=E})),s.invertNormalMapX=!s.getScene().useRightHandedSystem,s.invertNormalMapY=s.getScene().useRightHandedSystem,null!=o.clearcoatNormalTexture.scale&&(s.clearCoat.bumpTexture.level=o.clearcoatNormalTexture.scale)),Promise.all(x).then(function(){})},C}();y.b.RegisterExtension(v,function(C){return new z(C)});var A="KHR_materials_sheen",F=function(){function C(r){this.name=A,this.order=190,this._loader=r,this.enabled=this._loader.isExtensionUsed(A)}return C.prototype.dispose=function(){delete this._loader},C.prototype.loadMaterialPropertiesAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(E,c){var e=new Array();return e.push(x._loader.loadMaterialPropertiesAsync(r,o,s)),e.push(x._loadSheenPropertiesAsync(E,c,s)),Promise.all(e).then(function(){})})},C.prototype._loadSheenPropertiesAsync=function(r,o,s){if(!(s instanceof h.PBRMaterial))throw new Error(r+": Material type not supported");var x=new Array();return s.sheen.isEnabled=!0,null!=o.intensityFactor?s.sheen.intensity=o.intensityFactor:s.sheen.intensity=0,null!=o.colorFactor&&(s.sheen.color=h.Color3.FromArray(o.colorFactor)),o.colorIntensityTexture&&x.push(this._loader.loadTextureInfoAsync(r+"/sheenTexture",o.colorIntensityTexture,function(E){E.name=s.name+" (Sheen Intensity)",s.sheen.texture=E})),Promise.all(x).then(function(){})},C}();y.b.RegisterExtension(A,function(C){return new F(C)});var J="KHR_materials_specular",S=function(){function C(r){this.name=J,this.order=190,this._loader=r,this.enabled=this._loader.isExtensionUsed(J)}return C.prototype.dispose=function(){delete this._loader},C.prototype.loadMaterialPropertiesAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(E,c){var e=new Array();return e.push(x._loader.loadMaterialPropertiesAsync(r,o,s)),e.push(x._loadSpecularPropertiesAsync(E,c,s)),Promise.all(e).then(function(){})})},C.prototype._loadSpecularPropertiesAsync=function(r,o,s){if(!(s instanceof h.PBRMaterial))throw new Error(r+": Material type not supported");return void 0!==o.specularFactor&&(s.metallicF0Factor=o.specularFactor),o.specularTexture&&(s.useMetallicF0FactorFromMetallicTexture=!0),Promise.resolve()},C}();y.b.RegisterExtension(J,function(C){return new S(C)});var R="KHR_mesh_quantization",Z=function(){function C(r){this.name=R,this.enabled=r.isExtensionUsed(R)}return C.prototype.dispose=function(){},C}();y.b.RegisterExtension(R,function(C){return new Z(C)});var _="KHR_texture_basisu",ja=function(){function C(r){this.name=_,this._loader=r,this.enabled=r.isExtensionUsed(_)}return C.prototype.dispose=function(){delete this._loader},C.prototype._loadTextureAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(E,c){var e=null==o.sampler?y.b.DefaultSampler:y.a.Get(r+"/sampler",x._loader.gltf.samplers,o.sampler),k=y.a.Get(E+"/source",x._loader.gltf.images,c.source);return x._loader._createTextureAsync(r,e,k,function(l){l.gammaSpace=!1,s(l)})})},C}();y.b.RegisterExtension(_,function(C){return new ja(C)});var ha="KHR_texture_transform",ra=function(){function C(r){this.name=ha,this._loader=r,this.enabled=this._loader.isExtensionUsed(ha)}return C.prototype.dispose=function(){delete this._loader},C.prototype.loadTextureInfoAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(E,c){return x._loader.loadTextureInfoAsync(r,o,function(e){if(!(e instanceof h.Texture))throw new Error(E+": Texture type not supported");c.offset&&(e.uOffset=c.offset[0],e.vOffset=c.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,c.rotation&&(e.wAng=-c.rotation),c.scale&&(e.uScale=c.scale[0],e.vScale=c.scale[1]),null!=c.texCoord&&(e.coordinatesIndex=c.texCoord),s(e)})})},C}();y.b.RegisterExtension(ha,function(C){return new ra(C)});var ka="MSFT_audio_emitter",X=function(){function C(r){this.name=ka,this._loader=r,this.enabled=this._loader.isExtensionUsed(ka)}return C.prototype.dispose=function(){delete this._loader,delete this._clips,delete this._emitters},C.prototype.onLoading=function(){var r=this._loader.gltf.extensions;if(r&&r[this.name]){var o=r[this.name];this._clips=o.clips,this._emitters=o.emitters,y.a.Assign(this._clips),y.a.Assign(this._emitters)}},C.prototype.loadSceneAsync=function(r,o){var s=this;return y.b.LoadExtensionAsync(r,o,this.name,function(x,E){var c=new Array();c.push(s._loader.loadSceneAsync(r,o));for(var e=0,k=E.emitters;e<k.length;e++){var l=k[e],j=y.a.Get(x+"/emitters",s._emitters,l);if(null!=j.refDistance||null!=j.maxDistance||null!=j.rolloffFactor||null!=j.distanceModel||null!=j.innerAngle||null!=j.outerAngle)throw new Error(x+": Direction or Distance properties are not allowed on emitters attached to a scene");c.push(s._loadEmitterAsync(x+"/emitters/"+j.index,j))}return Promise.all(c).then(function(){})})},C.prototype.loadNodeAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(E,c){var e=new Array();return x._loader.loadNodeAsync(E,o,function(k){for(var l=function(u){var t=y.a.Get(E+"/emitters",x._emitters,u);e.push(x._loadEmitterAsync(E+"/emitters/"+t.index,t).then(function(){for(var D=0,I=t._babylonSounds;D<I.length;D++){var M=I[D];M.attachToMesh(k),null==t.innerAngle&&null==t.outerAngle||(M.setLocalDirectionToMesh(h.Vector3.Forward()),M.setDirectionalCone(2*h.Tools.ToDegrees(null==t.innerAngle?Math.PI:t.innerAngle),2*h.Tools.ToDegrees(null==t.outerAngle?Math.PI:t.outerAngle),0))}}))},j=0,q=c.emitters;j<q.length;j++)l(q[j]);s(k)}).then(function(k){return Promise.all(e).then(function(){return k})})})},C.prototype.loadAnimationAsync=function(r,o){var s=this;return y.b.LoadExtensionAsync(r,o,this.name,function(x,E){return s._loader.loadAnimationAsync(r,o).then(function(c){var e=new Array();y.a.Assign(E.events);for(var k=0,l=E.events;k<l.length;k++){var j=l[k];e.push(s._loadAnimationEventAsync(x+"/events/"+j.index,r,o,j,c))}return Promise.all(e).then(function(){return c})})})},C.prototype._loadClipAsync=function(r,o){if(o._objectURL)return o._objectURL;var s;if(o.uri)s=this._loader.loadUriAsync(r,o,o.uri);else{var x=y.a.Get(r+"/bufferView",this._loader.gltf.bufferViews,o.bufferView);s=this._loader.loadBufferViewAsync("#/bufferViews/"+x.index,x)}return o._objectURL=s.then(function(E){return URL.createObjectURL(new Blob([E],{type:o.mimeType}))}),o._objectURL},C.prototype._loadEmitterAsync=function(r,o){var s=this;if(o._babylonSounds=o._babylonSounds||[],!o._babylonData){for(var x=new Array(),E=o.name||"emitter"+o.index,c={loop:!1,autoplay:!1,volume:null==o.volume?1:o.volume},e=function(q){var u="#/extensions/"+k.name+"/clips",t=y.a.Get(u,k._clips,o.clips[q].clip);x.push(k._loadClipAsync(u+"/"+o.clips[q].clip,t).then(function(D){var I=o._babylonSounds[q]=new h.Sound(E,D,s._loader.babylonScene,null,c);I.refDistance=o.refDistance||1,I.maxDistance=o.maxDistance||256,I.rolloffFactor=o.rolloffFactor||1,I.distanceModel=o.distanceModel||"exponential",I._positionInEmitterSpace=!0}))},k=this,l=0;l<o.clips.length;l++)e(l);var j=Promise.all(x).then(function(){var q=o.clips.map(function(t){return t.weight||1}),u=new h.WeightedSound(o.loop||!1,o._babylonSounds,q);o.innerAngle&&(u.directionalConeInnerAngle=2*h.Tools.ToDegrees(o.innerAngle)),o.outerAngle&&(u.directionalConeOuterAngle=2*h.Tools.ToDegrees(o.outerAngle)),o.volume&&(u.volume=o.volume),o._babylonData.sound=u});o._babylonData={loaded:j}}return o._babylonData.loaded},C.prototype._getEventAction=function(r,o,s,x,E){switch(s){case"play":return function(c){var e=(E||0)+(c-x);o.play(e)};case"stop":return function(c){o.stop()};case"pause":return function(c){o.pause()};default:throw new Error(r+": Unsupported action "+s)}},C.prototype._loadAnimationEventAsync=function(r,o,s,x,E){var c=this;if(0==E.targetedAnimations.length)return Promise.resolve();var e=E.targetedAnimations[0],k=x.emitter,l=y.a.Get("#/extensions/"+this.name+"/emitters",this._emitters,k);return this._loadEmitterAsync(r,l).then(function(){var j=l._babylonData.sound;if(j){var q=new h.AnimationEvent(x.time,c._getEventAction(r,j,x.action,x.time,x.startOffset));e.animation.addEvent(q),E.onAnimationGroupEndObservable.add(function(){j.stop()}),E.onAnimationGroupPauseObservable.add(function(){j.pause()})}})},C}();y.b.RegisterExtension(ka,function(C){return new X(C)});var ba="MSFT_lod",na=function(){function C(r){this.name=ba,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new h.Observable(),this.onMaterialLODsLoadedObservable=new h.Observable(),this._nodeIndexLOD=null,this._nodeSignalLODs=new Array(),this._nodePromiseLODs=new Array(),this._materialIndexLOD=null,this._materialSignalLODs=new Array(),this._materialPromiseLODs=new Array(),this._indexLOD=null,this._bufferLODs=new Array(),this._loader=r,this.enabled=this._loader.isExtensionUsed(ba)}return C.prototype.dispose=function(){delete this._loader,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._indexLOD=null,this._bufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},C.prototype.onReady=function(){for(var r=this,o=function(e){var k=Promise.all(s._nodePromiseLODs[e]).then(function(){0!==e&&r._loader.endPerformanceCounter("Node LOD "+e),r._loader.log("Loaded node LOD "+e),r.onNodeLODsLoadedObservable.notifyObservers(e),e!==r._nodePromiseLODs.length-1&&(r._loader.startPerformanceCounter("Node LOD "+(e+1)),r._nodeSignalLODs[e]&&r._nodeSignalLODs[e].resolve())});s._loader._completePromises.push(k)},s=this,x=0;x<this._nodePromiseLODs.length;x++)o(x);var E=function(e){var k=Promise.all(c._materialPromiseLODs[e]).then(function(){0!==e&&r._loader.endPerformanceCounter("Material LOD "+e),r._loader.log("Loaded material LOD "+e),r.onMaterialLODsLoadedObservable.notifyObservers(e),e!==r._materialPromiseLODs.length-1&&(r._loader.startPerformanceCounter("Material LOD "+(e+1)),r._materialSignalLODs[e]&&r._materialSignalLODs[e].resolve())});c._loader._completePromises.push(k)},c=this;for(x=0;x<this._materialPromiseLODs.length;x++)E(x);for(x=1;x<this._bufferLODs.length;x++)this._loadBufferLOD(x)},C.prototype.loadSceneAsync=function(r,o){var s=this._loader.loadSceneAsync(r,o);return 0!==this._bufferLODs.length&&this._loadBufferLOD(0),s},C.prototype.loadNodeAsync=function(r,o,s){var x=this;return y.b.LoadExtensionAsync(r,o,this.name,function(E,c){var e,k=x._getLODs(E,o,x._loader.gltf.nodes,c.ids);x._loader.logOpen(""+E);for(var l=function(q){var u=k[q];x._indexLOD=q,0!==q&&(x._nodeIndexLOD=q,x._nodeSignalLODs[q]=x._nodeSignalLODs[q]||new h.Deferred());var t=x._loader.loadNodeAsync("#/nodes/"+u.index,u,function(D){D.setEnabled(!1)}).then(function(D){if(0!==q){var I=k[q-1];I._babylonTransformNode&&(x._disposeTransformNode(I._babylonTransformNode),delete I._babylonTransformNode)}return D.setEnabled(!0),D});0===q?e=t:x._nodeIndexLOD=null,x._indexLOD=null,x._nodePromiseLODs[q]=x._nodePromiseLODs[q]||[],x._nodePromiseLODs[q].push(t)},j=0;j<k.length;j++)l(j);return x._loader.logClose(),e})},C.prototype._loadMaterialAsync=function(r,o,s,x,E){var c=this;return this._indexLOD?null:y.b.LoadExtensionAsync(r,o,this.name,function(e,k){var l,j=c._getLODs(e,o,c._loader.gltf.materials,k.ids);c._loader.logOpen(""+e);for(var q=function(t){var D=j[t];c._indexLOD=t,0!==t&&(c._materialIndexLOD=t);var I=c._loader._loadMaterialAsync("#/materials/"+D.index,D,s,x,function(M){0===t&&E(M)}).then(function(M){if(0!==t){E(M);var N=j[t-1]._data;N[x]&&(c._disposeMaterials([N[x].babylonMaterial]),delete N[x])}return M});0===t?l=I:c._materialIndexLOD=null,c._indexLOD=null,c._materialPromiseLODs[t]=c._materialPromiseLODs[t]||[],c._materialPromiseLODs[t].push(I)},u=0;u<j.length;u++)q(u);return c._loader.logClose(),l})},C.prototype._loadUriAsync=function(r,o,s){var x=this;if(null!==this._materialIndexLOD){this._loader.log("deferred");var E=this._materialIndexLOD-1;return this._materialSignalLODs[E]=this._materialSignalLODs[E]||new h.Deferred(),this._materialSignalLODs[E].promise.then(function(){return x._loader.loadUriAsync(r,o,s)})}return null!==this._nodeIndexLOD?(this._loader.log("deferred"),E=this._nodeIndexLOD-1,this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new h.Deferred(),this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return x._loader.loadUriAsync(r,o,s)})):null},C.prototype.loadBufferAsync=function(r,o,s,x){if(this._loader.parent.useRangeRequests&&!o.uri){if(!this._loader.bin)throw new Error(r+": Uri is missing or the binary glTF is missing its binary chunk");var E=this._indexLOD||0,c=s,e=c+x-1,k=this._bufferLODs[E];return k?(k.start=Math.min(k.start,c),k.end=Math.max(k.end,e)):(k={start:c,end:e,loaded:new h.Deferred()},this._bufferLODs[E]=k),k.loaded.promise.then(function(l){return new Uint8Array(l.buffer,l.byteOffset+s-k.start,x)})}return null},C.prototype._loadBufferLOD=function(r){var o=this._bufferLODs[r];this._loader.bin.readAsync(o.start,o.end-o.start+1).then(function(s){o.loaded.resolve(s)},function(s){o.loaded.reject(s)})},C.prototype._getLODs=function(r,o,s,x){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var E=new Array(),c=x.length-1;c>=0;c--)if(E.push(y.a.Get(r+"/ids/"+x[c],s,x[c])),E.length===this.maxLODsToLoad)return E;return E.push(o),E},C.prototype._disposeTransformNode=function(r){var o=this,s=new Array(),x=r.material;x&&s.push(x);for(var E=0,c=r.getChildMeshes();E<c.length;E++){var e=c[E];e.material&&s.push(e.material)}r.dispose();var k=s.filter(function(l){return o._loader.babylonScene.meshes.every(function(j){return j.material!=l})});this._disposeMaterials(k)},C.prototype._disposeMaterials=function(r){for(var o={},s=0,x=r;s<x.length;s++){for(var E=0,c=(q=x[s]).getActiveTextures();E<c.length;E++){var e=c[E];o[e.uniqueId]=e}q.dispose()}for(var k in o)for(var l=0,j=this._loader.babylonScene.materials;l<j.length;l++){var q;(q=j[l]).hasTexture(o[k])&&delete o[k]}for(var k in o)o[k].dispose()},C}();y.b.RegisterExtension(ba,function(C){return new na(C)});var ga="MSFT_minecraftMesh",pa=function(){function C(r){this.name=ga,this._loader=r,this.enabled=this._loader.isExtensionUsed(ga)}return C.prototype.dispose=function(){delete this._loader},C.prototype.loadMaterialPropertiesAsync=function(r,o,s){var x=this;return y.b.LoadExtraAsync(r,o,this.name,function(E,c){if(c){if(!(s instanceof h.PBRMaterial))throw new Error(E+": Material type not supported");var e=x._loader.loadMaterialPropertiesAsync(r,o,s);return s.needAlphaBlending()&&(s.forceDepthWrite=!0,s.separateCullingPass=!0),s.backFaceCulling=s.forceDepthWrite,s.twoSidedLighting=!0,e}return null})},C}();y.b.RegisterExtension(ga,function(C){return new pa(C)});var oa="MSFT_sRGBFactors",ua=function(){function C(r){this.name=oa,this._loader=r,this.enabled=this._loader.isExtensionUsed(oa)}return C.prototype.dispose=function(){delete this._loader},C.prototype.loadMaterialPropertiesAsync=function(r,o,s){var x=this;return y.b.LoadExtraAsync(r,o,this.name,function(E,c){if(c){if(!(s instanceof h.PBRMaterial))throw new Error(E+": Material type not supported");var e=x._loader.loadMaterialPropertiesAsync(r,o,s);return s.albedoTexture||s.albedoColor.toLinearSpaceToRef(s.albedoColor),s.reflectivityTexture||s.reflectivityColor.toLinearSpaceToRef(s.reflectivityColor),e}return null})},C}();y.b.RegisterExtension(oa,function(C){return new ua(C)});var xa="ExtrasAsMetadata",ta=function(){function C(r){this.name=xa,this.enabled=!0,this._loader=r}return C.prototype._assignExtras=function(r,o){if(o.extras&&Object.keys(o.extras).length>0){var s=r.metadata=r.metadata||{};(s.gltf=s.gltf||{}).extras=o.extras}},C.prototype.dispose=function(){delete this._loader},C.prototype.loadNodeAsync=function(r,o,s){var x=this;return this._loader.loadNodeAsync(r,o,function(E){x._assignExtras(E,o),s(E)})},C.prototype.loadCameraAsync=function(r,o,s){var x=this;return this._loader.loadCameraAsync(r,o,function(E){x._assignExtras(E,o),s(E)})},C.prototype.createMaterial=function(r,o,s){var x=this._loader.createMaterial(r,o,s);return this._assignExtras(x,o),x},C}();y.b.RegisterExtension(xa,function(C){return new ta(C)}),w.d(G,"EXT_lights_image_based",function(){return B}),w.d(G,"KHR_draco_mesh_compression",function(){return d}),w.d(G,"KHR_lights",function(){return f}),w.d(G,"KHR_materials_pbrSpecularGlossiness",function(){return n}),w.d(G,"KHR_materials_unlit",function(){return p}),w.d(G,"KHR_materials_clearcoat",function(){return z}),w.d(G,"KHR_materials_sheen",function(){return F}),w.d(G,"KHR_materials_specular",function(){return S}),w.d(G,"KHR_mesh_quantization",function(){return Z}),w.d(G,"KHR_texture_basisu",function(){return ja}),w.d(G,"KHR_texture_transform",function(){return ra}),w.d(G,"MSFT_audio_emitter",function(){return X}),w.d(G,"MSFT_lod",function(){return na}),w.d(G,"MSFT_minecraftMesh",function(){return pa}),w.d(G,"MSFT_sRGBFactors",function(){return ua}),w.d(G,"ExtrasAsMetadata",function(){return ta})},function(fa,G,w){"use strict";w.r(G);var h=w(1);w.d(G,"ArrayItem",function(){return h.a}),w.d(G,"GLTFLoader",function(){return h.b});var y=w(5);w.d(G,"EXT_lights_image_based",function(){return y.EXT_lights_image_based}),w.d(G,"KHR_draco_mesh_compression",function(){return y.KHR_draco_mesh_compression}),w.d(G,"KHR_lights",function(){return y.KHR_lights}),w.d(G,"KHR_materials_pbrSpecularGlossiness",function(){return y.KHR_materials_pbrSpecularGlossiness}),w.d(G,"KHR_materials_unlit",function(){return y.KHR_materials_unlit}),w.d(G,"KHR_materials_clearcoat",function(){return y.KHR_materials_clearcoat}),w.d(G,"KHR_materials_sheen",function(){return y.KHR_materials_sheen}),w.d(G,"KHR_materials_specular",function(){return y.KHR_materials_specular}),w.d(G,"KHR_mesh_quantization",function(){return y.KHR_mesh_quantization}),w.d(G,"KHR_texture_basisu",function(){return y.KHR_texture_basisu}),w.d(G,"KHR_texture_transform",function(){return y.KHR_texture_transform}),w.d(G,"MSFT_audio_emitter",function(){return y.MSFT_audio_emitter}),w.d(G,"MSFT_lod",function(){return y.MSFT_lod}),w.d(G,"MSFT_minecraftMesh",function(){return y.MSFT_minecraftMesh}),w.d(G,"MSFT_sRGBFactors",function(){return y.MSFT_sRGBFactors}),w.d(G,"ExtrasAsMetadata",function(){return y.ExtrasAsMetadata})},function(fa,G,w){"use strict";w.r(G);var h=function(c,e){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,l){k.__proto__=l}||function(k,l){for(var j in l)l.hasOwnProperty(j)&&(k[j]=l[j])})(c,e)};function y(c,e){function k(){this.constructor=c}h(c,e),c.prototype=null===e?Object.create(e):(k.prototype=e.prototype,new k())}var H,B,m,d,a,b,f,i;!function(c){c[c.BYTE=5120]="BYTE",c[c.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",c[c.SHORT=5122]="SHORT",c[c.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",c[c.FLOAT=5126]="FLOAT"}(H||(H={})),function(c){c[c.FRAGMENT=35632]="FRAGMENT",c[c.VERTEX=35633]="VERTEX"}(B||(B={})),function(c){c[c.BYTE=5120]="BYTE",c[c.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",c[c.SHORT=5122]="SHORT",c[c.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",c[c.INT=5124]="INT",c[c.UNSIGNED_INT=5125]="UNSIGNED_INT",c[c.FLOAT=5126]="FLOAT",c[c.FLOAT_VEC2=35664]="FLOAT_VEC2",c[c.FLOAT_VEC3=35665]="FLOAT_VEC3",c[c.FLOAT_VEC4=35666]="FLOAT_VEC4",c[c.INT_VEC2=35667]="INT_VEC2",c[c.INT_VEC3=35668]="INT_VEC3",c[c.INT_VEC4=35669]="INT_VEC4",c[c.BOOL=35670]="BOOL",c[c.BOOL_VEC2=35671]="BOOL_VEC2",c[c.BOOL_VEC3=35672]="BOOL_VEC3",c[c.BOOL_VEC4=35673]="BOOL_VEC4",c[c.FLOAT_MAT2=35674]="FLOAT_MAT2",c[c.FLOAT_MAT3=35675]="FLOAT_MAT3",c[c.FLOAT_MAT4=35676]="FLOAT_MAT4",c[c.SAMPLER_2D=35678]="SAMPLER_2D"}(m||(m={})),function(c){c[c.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",c[c.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",c[c.REPEAT=10497]="REPEAT"}(d||(d={})),function(c){c[c.NEAREST=9728]="NEAREST",c[c.LINEAR=9728]="LINEAR",c[c.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",c[c.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",c[c.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",c[c.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(a||(a={})),function(c){c[c.ALPHA=6406]="ALPHA",c[c.RGB=6407]="RGB",c[c.RGBA=6408]="RGBA",c[c.LUMINANCE=6409]="LUMINANCE",c[c.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(b||(b={})),function(c){c[c.FRONT=1028]="FRONT",c[c.BACK=1029]="BACK",c[c.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(f||(f={})),function(c){c[c.ZERO=0]="ZERO",c[c.ONE=1]="ONE",c[c.SRC_COLOR=768]="SRC_COLOR",c[c.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",c[c.DST_COLOR=774]="DST_COLOR",c[c.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",c[c.SRC_ALPHA=770]="SRC_ALPHA",c[c.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",c[c.DST_ALPHA=772]="DST_ALPHA",c[c.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",c[c.CONSTANT_COLOR=32769]="CONSTANT_COLOR",c[c.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",c[c.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",c[c.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",c[c.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(i||(i={}));var n,g=w(0),p=function(){function c(){}return c.SetMatrix=function(e,k,l,j,q){var u=null;if("MODEL"===l.semantic?u=k.getWorldMatrix():"PROJECTION"===l.semantic?u=e.getProjectionMatrix():"VIEW"===l.semantic?u=e.getViewMatrix():"MODELVIEWINVERSETRANSPOSE"===l.semantic?u=g.Matrix.Transpose(k.getWorldMatrix().multiply(e.getViewMatrix()).invert()):"MODELVIEW"===l.semantic?u=k.getWorldMatrix().multiply(e.getViewMatrix()):"MODELVIEWPROJECTION"===l.semantic?u=k.getWorldMatrix().multiply(e.getTransformMatrix()):"MODELINVERSE"===l.semantic?u=k.getWorldMatrix().invert():"VIEWINVERSE"===l.semantic?u=e.getViewMatrix().invert():"PROJECTIONINVERSE"===l.semantic?u=e.getProjectionMatrix().invert():"MODELVIEWINVERSE"===l.semantic?u=k.getWorldMatrix().multiply(e.getViewMatrix()).invert():"MODELVIEWPROJECTIONINVERSE"===l.semantic?u=k.getWorldMatrix().multiply(e.getTransformMatrix()).invert():"MODELINVERSETRANSPOSE"===l.semantic&&(u=g.Matrix.Transpose(k.getWorldMatrix().invert())),u)switch(l.type){case m.FLOAT_MAT2:q.setMatrix2x2(j,g.Matrix.GetAsMatrix2x2(u));break;case m.FLOAT_MAT3:q.setMatrix3x3(j,g.Matrix.GetAsMatrix3x3(u));break;case m.FLOAT_MAT4:q.setMatrix(j,u)}},c.SetUniform=function(e,k,l,j){switch(j){case m.FLOAT:return e.setFloat(k,l),!0;case m.FLOAT_VEC2:return e.setVector2(k,g.Vector2.FromArray(l)),!0;case m.FLOAT_VEC3:return e.setVector3(k,g.Vector3.FromArray(l)),!0;case m.FLOAT_VEC4:return e.setVector4(k,g.Vector4.FromArray(l)),!0;default:return!1}},c.GetWrapMode=function(e){switch(e){case d.CLAMP_TO_EDGE:return g.Texture.CLAMP_ADDRESSMODE;case d.MIRRORED_REPEAT:return g.Texture.MIRROR_ADDRESSMODE;case d.REPEAT:default:return g.Texture.WRAP_ADDRESSMODE}},c.GetByteStrideFromType=function(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},c.GetTextureFilterMode=function(e){switch(e){case a.LINEAR:case a.LINEAR_MIPMAP_NEAREST:case a.LINEAR_MIPMAP_LINEAR:return g.Texture.TRILINEAR_SAMPLINGMODE;case a.NEAREST:case a.NEAREST_MIPMAP_NEAREST:return g.Texture.NEAREST_SAMPLINGMODE;default:return g.Texture.BILINEAR_SAMPLINGMODE}},c.GetBufferFromBufferView=function(e,k,l,j,q){l=k.byteOffset+l;var u=e.loadedBufferViews[k.buffer];if(l+j>u.byteLength)throw new Error("Buffer access is out of range");var t=u.buffer;switch(l+=u.byteOffset,q){case H.BYTE:return new Int8Array(t,l,j);case H.UNSIGNED_BYTE:return new Uint8Array(t,l,j);case H.SHORT:return new Int16Array(t,l,j);case H.UNSIGNED_SHORT:return new Uint16Array(t,l,j);default:return new Float32Array(t,l,j)}},c.GetBufferFromAccessor=function(e,k){var l=e.bufferViews[k.bufferView],j=k.count*c.GetByteStrideFromType(k);return c.GetBufferFromBufferView(e,l,k.byteOffset,j,k.componentType)},c.DecodeBufferToText=function(e){for(var k="",l=e.byteLength,j=0;j<l;++j)k+=String.fromCharCode(e[j]);return k},c.GetDefaultMaterial=function(e){if(!c._DefaultMaterial){g.Effect.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join(`
`),g.Effect.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join(`
`);var k={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array(),needAlphaBlending:!1};c._DefaultMaterial=new g.ShaderMaterial("GLTFDefaultMaterial",e,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},k),c._DefaultMaterial.setColor4("u_emission",new g.Color4(.5,.5,.5,1))}return c._DefaultMaterial},c._DefaultMaterial=null,c}(),v=w(2);!function(c){c[c.IDENTIFIER=1]="IDENTIFIER",c[c.UNKNOWN=2]="UNKNOWN",c[c.END_OF_INPUT=3]="END_OF_INPUT"}(n||(n={}));var z=function(){function c(e){this._pos=0,this.currentToken=n.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}return c.prototype.getNextToken=function(){if(this.isEnd())return n.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=n.UNKNOWN,"_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=n.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken},c.prototype.peek=function(){return this._toParse[this._pos]},c.prototype.read=function(){return this._toParse[this._pos++]},c.prototype.forward=function(){this._pos++},c.prototype.isEnd=function(){return this._pos>=this._maxPos},c}(),A=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],F=["world","view","projection","worldView","worldViewProjection","mBones"],J=["translation","rotation","scale"],S=["position","rotationQuaternion","scaling"],R=function(c,e,k){for(var l in c){var j=c[l];k[e][l]=j}},Z=function(c){if(c)for(var e=0;e<c.length/2;e++)c[2*e+1]=1-c[2*e+1]},_=function(c){if("NORMAL"===c.semantic)return"normal";if("POSITION"===c.semantic)return"position";if("JOINT"===c.semantic)return"matricesIndices";if("WEIGHT"===c.semantic)return"matricesWeights";if("COLOR"===c.semantic)return"color";if(c.semantic&&-1!==c.semantic.indexOf("TEXCOORD_")){var e=Number(c.semantic.split("_")[1]);return"uv"+(0===e?"":e+1)}return null},ja=function(c){var e=null;if(c.translation||c.rotation||c.scale){var k=g.Vector3.FromArray(c.scale||[1,1,1]),l=g.Quaternion.FromArray(c.rotation||[0,0,0,1]),j=g.Vector3.FromArray(c.translation||[0,0,0]);e=g.Matrix.Compose(k,l,j)}else e=g.Matrix.FromArray(c.matrix);return e},ha=function(c,e,k,l){for(var j=0;j<l.bones.length;j++)if(l.bones[j].name===k)return l.bones[j];var q=c.nodes;for(var u in q){var t=q[u];if(t.jointName){var D=t.children;for(j=0;j<D.length;j++){var I=c.nodes[D[j]];if(I.jointName&&I.jointName===k){var M=ja(t),N=new g.Bone(t.name||"",l,ha(c,e,t.jointName,l),M);return N.id=u,N}}}}return null},ra=function(c,e){for(var k=0;k<c.length;k++)for(var l=c[k],j=0;j<l.node.children.length;j++)if(l.node.children[j]===e)return l.bone;return null},ka=function(c,e){var k=c.nodes,l=k[e];if(l)return{node:l,id:e};for(var j in k)if((l=k[j]).jointName===e)return{node:l,id:j};return null},X=function(c,e){for(var k=0;k<c.jointNames.length;k++)if(c.jointNames[k]===e)return!0;return!1},ba=function(c,e,k,l,j){if(l||(l=new g.Skeleton(e.name||"","",c.scene)),!e.babylonSkeleton)return l;var q=[],u=[];!function(V,$,Y,ca){for(var aa in V.nodes){var ea=V.nodes[aa],qa=aa;if(ea.jointName&&!X(Y,ea.jointName)){var ia=ja(ea),la=new g.Bone(ea.name||"",$,null,ia);la.id=qa,ca.push({bone:la,node:ea,id:qa})}}for(var sa=0;sa<ca.length;sa++)for(var wa=ca[sa],ma=wa.node.children,va=0;va<ma.length;va++){for(var da=null,ya=0;ya<ca.length;ya++)if(ca[ya].id===ma[va]){da=ca[ya];break}da&&(da.bone._parent=wa.bone,wa.bone.children.push(da.bone))}}(c,l,e,q),l.bones=[];for(var t=0;t<e.jointNames.length;t++)if(P=ka(c,e.jointNames[t])){var D=P.node;if(D){j=P.id;var I=c.scene.getBoneByID(j);if(I)l.bones.push(I);else{for(var M=!1,N=null,U=0;U<t;U++){var W=ka(c,e.jointNames[U]);if(W){var K=W.node;if(K){var L=K.children;if(L){M=!1;for(var Q=0;Q<L.length;Q++)if(L[Q]===j){N=ha(c,e,e.jointNames[U],l),M=!0;break}if(M)break}}else g.Tools.Warn("Joint named "+e.jointNames[U]+" does not exist when looking for parent")}}var O=ja(D);!N&&q.length>0&&(N=ra(q,j))&&-1===u.indexOf(N)&&u.push(N),new g.Bone(D.jointName||"",l,N,O).id=j}}else g.Tools.Warn("Joint named "+e.jointNames[t]+" does not exist")}var T=l.bones;for(l.bones=[],t=0;t<e.jointNames.length;t++){var P;if(P=ka(c,e.jointNames[t])){for(U=0;U<T.length;U++)if(T[U].id===P.id){l.bones.push(T[U]);break}}}for(l.prepare(),t=0;t<u.length;t++)l.bones.push(u[t]);return l},na=function(c,e,k,l,j){if(j||(c.scene._blockEntityCollection=c.forAssetContainer,j=new g.Mesh(e.name||"",c.scene),c.scene._blockEntityCollection=!1,j.id=l),!e.babylonNode)return j;for(var q,u=[],t=null,D=new Array(),I=new Array(),M=new Array(),N=new Array(),U=0;U<k.length;U++){var W=k[U];if(la=c.meshes[W])for(var K=0;K<la.primitives.length;K++){var L=new g.VertexData(),Q=la.primitives[K];Q.mode;var O=Q.attributes,T=null,P=null;for(var V in O)if(T=c.accessors[O[V]],P=p.GetBufferFromAccessor(c,T),"NORMAL"===V)L.normals=new Float32Array(P.length),L.normals.set(P);else if("POSITION"===V){if(v.GLTFFileLoader.HomogeneousCoordinates){L.positions=new Float32Array(P.length-P.length/4);for(var $=0;$<P.length;$+=4)L.positions[$]=P[$],L.positions[$+1]=P[$+1],L.positions[$+2]=P[$+2]}else L.positions=new Float32Array(P.length),L.positions.set(P);I.push(L.positions.length)}else if(-1!==V.indexOf("TEXCOORD_")){var Y=Number(V.split("_")[1]),ca=g.VertexBuffer.UVKind+(0===Y?"":Y+1),aa=new Float32Array(P.length);aa.set(P),Z(aa),L.set(aa,ca)}else"JOINT"===V?(L.matricesIndices=new Float32Array(P.length),L.matricesIndices.set(P)):"WEIGHT"===V?(L.matricesWeights=new Float32Array(P.length),L.matricesWeights.set(P)):"COLOR"===V&&(L.colors=new Float32Array(P.length),L.colors.set(P));if(T=c.accessors[Q.indices])P=p.GetBufferFromAccessor(c,T),L.indices=new Int32Array(P.length),L.indices.set(P),N.push(L.indices.length);else{var ea=[];for($=0;$<L.positions.length/3;$++)ea.push($);L.indices=new Int32Array(ea),N.push(L.indices.length)}t?t.merge(L):t=L;var qa=c.scene.getMaterialByID(Q.material);u.push(null===qa?p.GetDefaultMaterial(c.scene):qa),D.push(0===D.length?0:D[D.length-1]+I[I.length-2]),M.push(0===M.length?0:M[M.length-1]+N[N.length-2])}}c.scene._blockEntityCollection=c.forAssetContainer,u.length>1?(q=new g.MultiMaterial("multimat"+l,c.scene)).subMaterials=u:q=new g.StandardMaterial("multimat"+l,c.scene),1===u.length&&(q=u[0]),j.material||(j.material=q),new g.Geometry(l,c.scene,t,!1,j),j.computeWorldMatrix(!0),c.scene._blockEntityCollection=!1,j.subMeshes=[];var ia=0;for(U=0;U<k.length;U++){var la;W=k[U];if(la=c.meshes[W])for(K=0;K<la.primitives.length;K++)la.primitives[K].mode,g.SubMesh.AddToMesh(ia,D[ia],I[ia],M[ia],N[ia],j,j,!0),ia++}return j},ga=function(c,e,k,l){c.position&&(c.position=e),(c.rotationQuaternion||c.rotation)&&(c.rotationQuaternion=k),c.scaling&&(c.scaling=l)},pa=function(c,e,k,l){var j=null;if(c.importOnlyMeshes&&(e.skin||e.meshes)&&c.importMeshesNames&&c.importMeshesNames.length>0&&-1===c.importMeshesNames.indexOf(e.name||""))return null;if(e.skin){if(e.meshes){var q=c.skins[e.skin];(u=na(c,e,e.meshes,k,e.babylonNode)).skeleton=c.scene.getLastSkeletonByID(e.skin),null===u.skeleton&&(u.skeleton=ba(c,q,0,q.babylonSkeleton,e.skin),q.babylonSkeleton||(q.babylonSkeleton=u.skeleton)),j=u}}else if(e.meshes){var u;j=u=na(c,e,e.mesh?[e.mesh]:e.meshes,k,e.babylonNode)}else if(!e.light||e.babylonNode||c.importOnlyMeshes){if(e.camera&&!e.babylonNode&&!c.importOnlyMeshes){var t=c.cameras[e.camera];if(t){if(c.scene._blockEntityCollection=c.forAssetContainer,"orthographic"===t.type){var D=new g.FreeCamera(e.camera,g.Vector3.Zero(),c.scene,!1);D.name=e.name||"",D.mode=g.Camera.ORTHOGRAPHIC_CAMERA,D.attachControl(c.scene.getEngine().getInputElement()),j=D}else if("perspective"===t.type){var I=t[t.type],M=new g.FreeCamera(e.camera,g.Vector3.Zero(),c.scene,!1);M.name=e.name||"",M.attachControl(c.scene.getEngine().getInputElement()),I.aspectRatio||(I.aspectRatio=c.scene.getEngine().getRenderWidth()/c.scene.getEngine().getRenderHeight()),I.znear&&I.zfar&&(M.maxZ=I.zfar,M.minZ=I.znear),j=M}c.scene._blockEntityCollection=!1}}}else{var N=c.lights[e.light];if(N){if("ambient"===N.type){var U=N[N.type],W=new g.HemisphericLight(e.light,g.Vector3.Zero(),c.scene);W.name=e.name||"",U.color&&(W.diffuse=g.Color3.FromArray(U.color)),j=W}else if("directional"===N.type){var K=N[N.type],L=new g.DirectionalLight(e.light,g.Vector3.Zero(),c.scene);L.name=e.name||"",K.color&&(L.diffuse=g.Color3.FromArray(K.color)),j=L}else if("point"===N.type){var Q=N[N.type],O=new g.PointLight(e.light,g.Vector3.Zero(),c.scene);O.name=e.name||"",Q.color&&(O.diffuse=g.Color3.FromArray(Q.color)),j=O}else if("spot"===N.type){var T=N[N.type],P=new g.SpotLight(e.light,g.Vector3.Zero(),g.Vector3.Zero(),0,0,c.scene);P.name=e.name||"",T.color&&(P.diffuse=g.Color3.FromArray(T.color)),T.fallOfAngle&&(P.angle=T.fallOfAngle),T.fallOffExponent&&(P.exponent=T.fallOffExponent),j=P}}}if(!e.jointName){if(e.babylonNode)return e.babylonNode;if(null===j){c.scene._blockEntityCollection=c.forAssetContainer;var V=new g.Mesh(e.name||"",c.scene);c.scene._blockEntityCollection=!1,e.babylonNode=V,j=V}}if(null!==j){if(e.matrix&&j instanceof g.Mesh)!function(aa,ea,qa){if(ea.matrix){var ia=new g.Vector3(0,0,0),la=new g.Quaternion(),sa=new g.Vector3(0,0,0);g.Matrix.FromArray(ea.matrix).decompose(sa,la,ia),ga(aa,ia,la,sa)}else ea.translation&&ea.rotation&&ea.scale&&ga(aa,g.Vector3.FromArray(ea.translation),g.Quaternion.FromArray(ea.rotation),g.Vector3.FromArray(ea.scale));aa.computeWorldMatrix(!0)}(j,e);else{var $=e.translation||[0,0,0],Y=e.rotation||[0,0,0,1],ca=e.scale||[1,1,1];ga(j,g.Vector3.FromArray($),g.Quaternion.FromArray(Y),g.Vector3.FromArray(ca))}j.updateCache(!0),e.babylonNode=j}return j},oa=function(c,e,k,l){void 0===l&&(l=!1);var j=c.nodes[e],q=null;if(l=!(c.importOnlyMeshes&&!l&&c.importMeshesNames)||(-1!==c.importMeshesNames.indexOf(j.name||"")||0===c.importMeshesNames.length),!j.jointName&&l&&null!==(q=pa(c,j,e))&&(q.id=e,q.parent=k),j.children)for(var u=0;u<j.children.length;u++)oa(c,j.children[u],q,l)},ua=function(c){var e=c.currentScene;if(e)for(var k=0;k<e.nodes.length;k++)oa(c,e.nodes[k],null);else for(var l in c.scenes)for(e=c.scenes[l],k=0;k<e.nodes.length;k++)oa(c,e.nodes[k],null);for(!function(q){for(var u in q.animations){var t=q.animations[u];if(t.channels&&t.samplers)for(var D=null,I=0;I<t.channels.length;I++){var M=t.channels[I],N=t.samplers[M.sampler];if(N){var U=null,W=null;t.parameters?(U=t.parameters[N.input],W=t.parameters[N.output]):(U=N.input,W=N.output);var K=p.GetBufferFromAccessor(q,q.accessors[U]),L=p.GetBufferFromAccessor(q,q.accessors[W]),Q=M.target.id,O=q.scene.getNodeByID(Q);if(null===O&&(O=q.scene.getNodeByName(Q)),null!==O){var T=O instanceof g.Bone,P=M.target.path,V=J.indexOf(P);-1!==V&&(P=S[V]);var $=g.Animation.ANIMATIONTYPE_MATRIX;T||("rotationQuaternion"===P?($=g.Animation.ANIMATIONTYPE_QUATERNION,O.rotationQuaternion=new g.Quaternion()):$=g.Animation.ANIMATIONTYPE_VECTOR3);var Y=null,ca=[],aa=0,ea=!1;T&&D&&D.getKeys().length===K.length&&(Y=D,ea=!0),ea||(q.scene._blockEntityCollection=q.forAssetContainer,Y=new g.Animation(u,T?"_matrix":P,1,$,g.Animation.ANIMATIONLOOPMODE_CYCLE),q.scene._blockEntityCollection=!1);for(var qa=0;qa<K.length;qa++){var ia=null;if("rotationQuaternion"===P?(ia=g.Quaternion.FromArray([L[aa],L[aa+1],L[aa+2],L[aa+3]]),aa+=4):(ia=g.Vector3.FromArray([L[aa],L[aa+1],L[aa+2]]),aa+=3),T){var la=O,sa=g.Vector3.Zero(),wa=new g.Quaternion(),ma=g.Vector3.Zero(),va=la.getBaseMatrix();ea&&D&&(va=D.getKeys()[qa].value),va.decompose(ma,wa,sa),"position"===P?sa=ia:"rotationQuaternion"===P?wa=ia:ma=ia,ia=g.Matrix.Compose(ma,wa,sa)}ea?D&&(D.getKeys()[qa].value=ia):ca.push({frame:K[qa],value:ia})}!ea&&Y&&(Y.setKeys(ca),O.animations.push(Y)),D=Y,q.scene.stopAnimation(O),q.scene.beginAnimation(O,0,K[K.length-1],!0,1)}else g.Tools.Warn("Creating animation named "+u+". But cannot find node named "+Q+" to attach to")}}}}(c),k=0;k<c.scene.skeletons.length;k++){var j=c.scene.skeletons[k];c.scene.beginAnimation(j,0,Number.MAX_VALUE,!0,1)}},xa=function(c,e,k,l,j,q){return function(u){!function(t,D,I,M,N){var U=M.values||I.parameters,W=I.uniforms;for(var K in N){var L=N[K],Q=L.type,O=U[W[K]];if(void 0===O&&(O=L.value),O){var T=function(P){return function(V){L.value&&P&&(D.setTexture(P,V),delete N[P])}};Q===m.SAMPLER_2D?s.LoadTextureAsync(t,M.values?O:L.value,T(K),function(){return T(null)}):L.value&&p.SetUniform(D,K,M.values?O:L.value,Q)&&delete N[K]}}}(c,e,k,l,j),e.onBind=function(t){!function(D,I,M,N,U,W,K){var L=W.values||U.parameters;for(var Q in M){var O=M[Q],T=O.type;if(T===m.FLOAT_MAT2||T===m.FLOAT_MAT3||T===m.FLOAT_MAT4)if(!O.semantic||O.source||O.node){if(O.semantic&&(O.source||O.node)){var P=I.scene.getNodeByName(O.source||O.node||"");if(null===P&&(P=I.scene.getNodeByID(O.source||O.node||"")),null===P)continue;p.SetMatrix(I.scene,P,O,Q,N.getEffect())}}else p.SetMatrix(I.scene,D,O,Q,N.getEffect());else{var V=L[U.uniforms[Q]];if(!V)continue;if(T===m.SAMPLER_2D){var $=I.textures[W.values?V:O.value].babylonTexture;if(null==$)continue;N.getEffect().setTexture(Q,$)}else p.SetUniform(N.getEffect(),Q,V,T)}}K(N)}(t,c,j,e,k,l,q)}}},ta=function(c,e,k){for(var l in e.uniforms){var j=e.uniforms[l],q=e.parameters[j];if(c.currentIdentifier===l&&q.semantic&&!q.source&&!q.node){var u=A.indexOf(q.semantic);if(-1!==u)return delete k[l],F[u]}}return c.currentIdentifier},C=function(c){for(var e in c.materials)s.LoadMaterialAsync(c,e,function(k){},function(){})},r=function(){function c(){}return c.CreateRuntime=function(e,k,l){var j={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:k,rootUrl:l,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],forAssetContainer:!1};return e.extensions&&R(e.extensions,"extensions",j),e.extensionsUsed&&R(e.extensionsUsed,"extensionsUsed",j),e.buffers&&function(q,u){for(var t in q){var D=q[t];u.buffers[t]=D,u.buffersCount++}}(e.buffers,j),e.bufferViews&&R(e.bufferViews,"bufferViews",j),e.accessors&&R(e.accessors,"accessors",j),e.meshes&&R(e.meshes,"meshes",j),e.lights&&R(e.lights,"lights",j),e.cameras&&R(e.cameras,"cameras",j),e.nodes&&R(e.nodes,"nodes",j),e.images&&R(e.images,"images",j),e.textures&&R(e.textures,"textures",j),e.shaders&&function(q,u){for(var t in q){var D=q[t];u.shaders[t]=D,u.shaderscount++}}(e.shaders,j),e.programs&&R(e.programs,"programs",j),e.samplers&&R(e.samplers,"samplers",j),e.techniques&&R(e.techniques,"techniques",j),e.materials&&R(e.materials,"materials",j),e.animations&&R(e.animations,"animations",j),e.skins&&R(e.skins,"skins",j),e.scenes&&(j.scenes=e.scenes),e.scene&&e.scenes&&(j.currentScene=e.scenes[e.scene]),j},c.LoadBufferAsync=function(e,k,l,j,q){var u=e.buffers[k];g.Tools.IsBase64(u.uri)?setTimeout(function(){return l(new Uint8Array(g.Tools.DecodeBase64(u.uri)))}):g.Tools.LoadFile(e.rootUrl+u.uri,function(t){return l(new Uint8Array(t))},q,void 0,!0,function(t){t&&j(t.status+" "+t.statusText)})},c.LoadTextureBufferAsync=function(e,k,l,j){var q=e.textures[k];if(q&&q.source)if(q.babylonTexture)l(null);else{var u=e.images[q.source];g.Tools.IsBase64(u.uri)?setTimeout(function(){return l(new Uint8Array(g.Tools.DecodeBase64(u.uri)))}):g.Tools.LoadFile(e.rootUrl+u.uri,function(t){return l(new Uint8Array(t))},void 0,void 0,!0,function(t){t&&j(t.status+" "+t.statusText)})}else j("")},c.CreateTextureAsync=function(e,k,l,j,q){var u=e.textures[k];if(u.babylonTexture)j(u.babylonTexture);else{var t=e.samplers[u.sampler],D=t.minFilter===a.NEAREST_MIPMAP_NEAREST||t.minFilter===a.NEAREST_MIPMAP_LINEAR||t.minFilter===a.LINEAR_MIPMAP_NEAREST||t.minFilter===a.LINEAR_MIPMAP_LINEAR,I=g.Texture.BILINEAR_SAMPLINGMODE,M=null==l?new Blob():new Blob([l]),N=URL.createObjectURL(M),U=function(){return URL.revokeObjectURL(N)},W=new g.Texture(N,e.scene,!D,!0,I,U,U);void 0!==t.wrapS&&(W.wrapU=p.GetWrapMode(t.wrapS)),void 0!==t.wrapT&&(W.wrapV=p.GetWrapMode(t.wrapT)),W.name=k,u.babylonTexture=W,j(W)}},c.LoadShaderStringAsync=function(e,k,l,j){var q=e.shaders[k];if(g.Tools.IsBase64(q.uri)){var u=atob(q.uri.split(",")[1]);l&&l(u)}else g.Tools.LoadFile(e.rootUrl+q.uri,l,void 0,void 0,!1,function(t){t&&j&&j(t.status+" "+t.statusText)})},c.LoadMaterialAsync=function(e,k,l,j){var q=e.materials[k];if(q.technique){var u=e.techniques[q.technique];if(!u){e.scene._blockEntityCollection=e.forAssetContainer;var t=new g.StandardMaterial(k,e.scene);return e.scene._blockEntityCollection=!1,t.diffuseColor=new g.Color3(.5,.5,.5),t.sideOrientation=g.Material.CounterClockWiseSideOrientation,void l(t)}var D=e.programs[u.program],I=u.states,M=g.Effect.ShadersStore[D.vertexShader+"VertexShader"],N=g.Effect.ShadersStore[D.fragmentShader+"PixelShader"],U="",W="",K=new z(M),L=new z(N),Q={},O=[],T=[],P=[];for(var V in u.uniforms){var $=u.uniforms[V],Y=u.parameters[$];if(Q[V]=Y,!Y.semantic||Y.node||Y.source)Y.type===m.SAMPLER_2D?P.push(V):O.push(V);else{var ca=A.indexOf(Y.semantic);-1!==ca?(O.push(F[ca]),delete Q[V]):O.push(V)}}for(var aa in u.attributes){var ea=u.attributes[aa];if((la=u.parameters[ea]).semantic){var qa=_(la);qa&&T.push(qa)}}for(;!K.isEnd()&&K.getNextToken();)if(K.currentToken===n.IDENTIFIER){var ia=!1;for(var aa in u.attributes){ea=u.attributes[aa];var la=u.parameters[ea];if(K.currentIdentifier===aa&&la.semantic){U+=_(la),ia=!0;break}}ia||(U+=ta(K,u,Q))}else U+=K.currentString;for(;!L.isEnd()&&L.getNextToken();)L.currentToken===n.IDENTIFIER?W+=ta(L,u,Q):W+=L.currentString;var sa={vertex:D.vertexShader+k,fragment:D.fragmentShader+k},wa={attributes:T,uniforms:O,samplers:P,needAlphaBlending:I&&I.enable&&-1!==I.enable.indexOf(3042)};g.Effect.ShadersStore[D.vertexShader+k+"VertexShader"]=U,g.Effect.ShadersStore[D.fragmentShader+k+"PixelShader"]=W;var ma=new g.ShaderMaterial(k,e.scene,sa,wa);if(ma.onError=function(ya,Da,Ea){return function(Ga,Fa){Da.dispose(!0),Ea("Cannot compile program named "+ya.name+". Error: "+Fa+". Default material will be applied")}}(D,ma,j),ma.onCompiled=xa(e,ma,u,q,Q,l),ma.sideOrientation=g.Material.CounterClockWiseSideOrientation,I&&I.functions){var va=I.functions;va.cullFace&&va.cullFace[0]!==f.BACK&&(ma.backFaceCulling=!1);var da=va.blendFuncSeparate;da&&(da[0]===i.SRC_ALPHA&&da[1]===i.ONE_MINUS_SRC_ALPHA&&da[2]===i.ONE&&da[3]===i.ONE?ma.alphaMode=g.Constants.ALPHA_COMBINE:da[0]===i.ONE&&da[1]===i.ONE&&da[2]===i.ZERO&&da[3]===i.ONE?ma.alphaMode=g.Constants.ALPHA_ONEONE:da[0]===i.SRC_ALPHA&&da[1]===i.ONE&&da[2]===i.ZERO&&da[3]===i.ONE?ma.alphaMode=g.Constants.ALPHA_ADD:da[0]===i.ZERO&&da[1]===i.ONE_MINUS_SRC_COLOR&&da[2]===i.ONE&&da[3]===i.ONE?ma.alphaMode=g.Constants.ALPHA_SUBTRACT:da[0]===i.DST_COLOR&&da[1]===i.ZERO&&da[2]===i.ONE&&da[3]===i.ONE?ma.alphaMode=g.Constants.ALPHA_MULTIPLY:da[0]===i.SRC_ALPHA&&da[1]===i.ONE_MINUS_SRC_COLOR&&da[2]===i.ONE&&da[3]===i.ONE&&(ma.alphaMode=g.Constants.ALPHA_MAXIMIZED))}}else j&&j("No technique found.")},c}(),o=function(){function c(){this.state=null}return c.RegisterExtension=function(e){c.Extensions[e.name]?g.Tools.Error('Tool with the same name "'+e.name+'" already exists'):c.Extensions[e.name]=e},c.prototype.dispose=function(){},c.prototype._importMeshAsync=function(e,k,l,j,q,u,t,D){var I=this;return k.useRightHandedSystem=!0,s.LoadRuntimeAsync(k,l,j,function(M){M.forAssetContainer=q,M.importOnlyMeshes=!0,""===e?M.importMeshesNames=[]:"string"==typeof e?M.importMeshesNames=[e]:!e||e instanceof Array?(M.importMeshesNames=[],g.Tools.Warn("Argument meshesNames must be of type string or string[]")):M.importMeshesNames=[e],I._createNodes(M);var N=new Array(),U=new Array();for(var W in M.nodes){var K=M.nodes[W];K.babylonNode instanceof g.AbstractMesh&&N.push(K.babylonNode)}for(var L in M.skins){var Q=M.skins[L];Q.babylonSkeleton instanceof g.Skeleton&&U.push(Q.babylonSkeleton)}I._loadBuffersAsync(M,function(){I._loadShadersAsync(M,function(){C(M),ua(M),!v.GLTFFileLoader.IncrementalLoading&&u&&u(N,U)})},t),v.GLTFFileLoader.IncrementalLoading&&u&&u(N,U)},D),!0},c.prototype.importMeshAsync=function(e,k,l,j,q,u){var t=this;return new Promise(function(D,I){t._importMeshAsync(e,k,j,q,l,function(M,N){D({meshes:M,particleSystems:[],skeletons:N,animationGroups:[],lights:[],transformNodes:[]})},u,function(M){I(new Error(M))})})},c.prototype._loadAsync=function(e,k,l,j,q,u,t){var D=this;e.useRightHandedSystem=!0,s.LoadRuntimeAsync(e,k,l,function(I){s.LoadRuntimeExtensionsAsync(I,function(){D._createNodes(I),D._loadBuffersAsync(I,function(){D._loadShadersAsync(I,function(){C(I),ua(I),v.GLTFFileLoader.IncrementalLoading||q()})}),v.GLTFFileLoader.IncrementalLoading&&q()},t)},t)},c.prototype.loadAsync=function(e,k,l,j){var q=this;return new Promise(function(u,t){q._loadAsync(e,k,l,!1,function(){u()},j,function(D){t(new Error(D))})})},c.prototype._loadShadersAsync=function(e,k){var l=!1,j=function(t,D){s.LoadShaderStringAsync(e,t,function(I){I instanceof ArrayBuffer||(e.loadedShaderCount++,I&&(g.Effect.ShadersStore[t+(D.type===B.VERTEX?"VertexShader":"PixelShader")]=I),e.loadedShaderCount===e.shaderscount&&k())},function(){g.Tools.Error("Error when loading shader program named "+t+" located at "+D.uri)})};for(var q in e.shaders){l=!0;var u=e.shaders[q];u?j.bind(this,q,u)():g.Tools.Error("No shader named: "+q)}l||k()},c.prototype._loadBuffersAsync=function(e,k,l){var j=!1,q=function(D,I){s.LoadBufferAsync(e,D,function(M){e.loadedBufferCount++,M&&(M.byteLength!=e.buffers[D].byteLength&&g.Tools.Error("Buffer named "+D+" is length "+M.byteLength+". Expected: "+I.byteLength),e.loadedBufferViews[D]=M),e.loadedBufferCount===e.buffersCount&&k()},function(){g.Tools.Error("Error when loading buffer named "+D+" located at "+I.uri)})};for(var u in e.buffers){j=!0;var t=e.buffers[u];t?q.bind(this,u,t)():g.Tools.Error("No buffer named: "+u)}j||k()},c.prototype._createNodes=function(e){var k=e.currentScene;if(k)for(var l=0;l<k.nodes.length;l++)oa(e,k.nodes[l],null);else for(var j in e.scenes)for(k=e.scenes[j],l=0;l<k.nodes.length;l++)oa(e,k.nodes[l],null)},c.Extensions={},c}(),s=function(){function c(e){this._name=e}return Object.defineProperty(c.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),c.prototype.loadRuntimeAsync=function(e,k,l,j,q){return!1},c.prototype.loadRuntimeExtensionsAsync=function(e,k,l){return!1},c.prototype.loadBufferAsync=function(e,k,l,j,q){return!1},c.prototype.loadTextureBufferAsync=function(e,k,l,j){return!1},c.prototype.createTextureAsync=function(e,k,l,j,q){return!1},c.prototype.loadShaderStringAsync=function(e,k,l,j){return!1},c.prototype.loadMaterialAsync=function(e,k,l,j){return!1},c.LoadRuntimeAsync=function(e,k,l,j,q){c.ApplyExtensions(function(u){return u.loadRuntimeAsync(e,k,l,j,q)},function(){setTimeout(function(){j&&j(r.CreateRuntime(k.json,e,l))})})},c.LoadRuntimeExtensionsAsync=function(e,k,l){c.ApplyExtensions(function(j){return j.loadRuntimeExtensionsAsync(e,k,l)},function(){setTimeout(function(){k()})})},c.LoadBufferAsync=function(e,k,l,j,q){c.ApplyExtensions(function(u){return u.loadBufferAsync(e,k,l,j,q)},function(){r.LoadBufferAsync(e,k,l,j,q)})},c.LoadTextureAsync=function(e,k,l,j){c.LoadTextureBufferAsync(e,k,function(q){q&&c.CreateTextureAsync(e,k,q,l,j)},j)},c.LoadShaderStringAsync=function(e,k,l,j){c.ApplyExtensions(function(q){return q.loadShaderStringAsync(e,k,l,j)},function(){r.LoadShaderStringAsync(e,k,l,j)})},c.LoadMaterialAsync=function(e,k,l,j){c.ApplyExtensions(function(q){return q.loadMaterialAsync(e,k,l,j)},function(){r.LoadMaterialAsync(e,k,l,j)})},c.LoadTextureBufferAsync=function(e,k,l,j){c.ApplyExtensions(function(q){return q.loadTextureBufferAsync(e,k,l,j)},function(){r.LoadTextureBufferAsync(e,k,l,j)})},c.CreateTextureAsync=function(e,k,l,j,q){c.ApplyExtensions(function(u){return u.createTextureAsync(e,k,l,j,q)},function(){r.CreateTextureAsync(e,k,l,j,q)})},c.ApplyExtensions=function(e,k){for(var l in o.Extensions)if(e(o.Extensions[l]))return;k()},c}();v.GLTFFileLoader._CreateGLTF1Loader=function(){return new o()};var x=function(c){function e(){return c.call(this,"KHR_binary_glTF")||this}return y(e,c),e.prototype.loadRuntimeAsync=function(k,l,j,q,u){var t=l.json.extensionsUsed;return!(!t||-1===t.indexOf(this.name)||!l.bin)&&(this._bin=l.bin,q(r.CreateRuntime(l.json,k,j)),!0)},e.prototype.loadBufferAsync=function(k,l,j,q){return-1!==k.extensionsUsed.indexOf(this.name)&&("binary_glTF"===l&&(this._bin.readAsync(0,this._bin.byteLength).then(j,function(u){return q(u.message)}),!0))},e.prototype.loadTextureBufferAsync=function(k,l,j,q){var u=k.textures[l],t=k.images[u.source];if(!(t.extensions&&this.name in t.extensions))return!1;var D=t.extensions[this.name],I=k.bufferViews[D.bufferView];return j(p.GetBufferFromBufferView(k,I,0,I.byteLength,H.UNSIGNED_BYTE)),!0},e.prototype.loadShaderStringAsync=function(k,l,j,q){var u=k.shaders[l];if(!(u.extensions&&this.name in u.extensions))return!1;var t=u.extensions[this.name],D=k.bufferViews[t.bufferView],I=p.GetBufferFromBufferView(k,D,0,D.byteLength,H.UNSIGNED_BYTE);return setTimeout(function(){var M=p.DecodeBufferToText(I);j(M)}),!0},e}(s);o.RegisterExtension(new x());var E=function(c){function e(){return c.call(this,"KHR_materials_common")||this}return y(e,c),e.prototype.loadRuntimeExtensionsAsync=function(k,l,j){if(!k.extensions)return!1;var q=k.extensions[this.name];if(!q)return!1;var u=q.lights;if(u)for(var t in u){var D=u[t];switch(D.type){case"ambient":var I=new g.HemisphericLight(D.name,new g.Vector3(0,1,0),k.scene),M=D.ambient;M&&(I.diffuse=g.Color3.FromArray(M.color||[1,1,1]));break;case"point":var N=new g.PointLight(D.name,new g.Vector3(10,10,10),k.scene),U=D.point;U&&(N.diffuse=g.Color3.FromArray(U.color||[1,1,1]));break;case"directional":var W=new g.DirectionalLight(D.name,new g.Vector3(0,-1,0),k.scene),K=D.directional;K&&(W.diffuse=g.Color3.FromArray(K.color||[1,1,1]));break;case"spot":var L=D.spot;L&&(new g.SpotLight(D.name,new g.Vector3(0,10,0),new g.Vector3(0,-1,0),L.fallOffAngle||Math.PI,L.fallOffExponent||0,k.scene).diffuse=g.Color3.FromArray(L.color||[1,1,1]));break;default:g.Tools.Warn('GLTF Material Common extension: light type "'+D.type+"” not supported")}}return!1},e.prototype.loadMaterialAsync=function(k,l,j,q){var u=k.materials[l];if(!u||!u.extensions)return!1;var t=u.extensions[this.name];if(!t)return!1;var D=new g.StandardMaterial(l,k.scene);return D.sideOrientation=g.Material.CounterClockWiseSideOrientation,"CONSTANT"===t.technique&&(D.disableLighting=!0),D.backFaceCulling=void 0!==t.doubleSided&&!t.doubleSided,D.alpha=void 0===t.values.transparency?1:t.values.transparency,D.specularPower=void 0===t.values.shininess?0:t.values.shininess,"string"==typeof t.values.ambient?this._loadTexture(k,t.values.ambient,D,"ambientTexture",q):D.ambientColor=g.Color3.FromArray(t.values.ambient||[0,0,0]),"string"==typeof t.values.diffuse?this._loadTexture(k,t.values.diffuse,D,"diffuseTexture",q):D.diffuseColor=g.Color3.FromArray(t.values.diffuse||[0,0,0]),"string"==typeof t.values.emission?this._loadTexture(k,t.values.emission,D,"emissiveTexture",q):D.emissiveColor=g.Color3.FromArray(t.values.emission||[0,0,0]),"string"==typeof t.values.specular?this._loadTexture(k,t.values.specular,D,"specularTexture",q):D.specularColor=g.Color3.FromArray(t.values.specular||[0,0,0]),!0},e.prototype._loadTexture=function(k,l,j,q,u){r.LoadTextureBufferAsync(k,l,function(t){r.CreateTextureAsync(k,l,t,function(D){return j[q]=D},u)},u)},e}(s);o.RegisterExtension(new E()),w.d(G,"GLTFBinaryExtension",function(){return x}),w.d(G,"GLTFLoaderBase",function(){return r}),w.d(G,"GLTFLoader",function(){return o}),w.d(G,"GLTFLoaderExtension",function(){return s}),w.d(G,"EComponentType",function(){return H}),w.d(G,"EShaderType",function(){return B}),w.d(G,"EParameterType",function(){return m}),w.d(G,"ETextureWrapMode",function(){return d}),w.d(G,"ETextureFilterType",function(){return a}),w.d(G,"ETextureFormat",function(){return b}),w.d(G,"ECullingType",function(){return f}),w.d(G,"EBlendingFunction",function(){return i}),w.d(G,"GLTFUtils",function(){return p}),w.d(G,"GLTFMaterialsCommonExtension",function(){return E})},function(fa,G,w){"use strict";w.r(G);var h=w(0),y=function(){function B(){this.materials=[]}return B.prototype.parseMTL=function(m,d,a,b){if(!(d instanceof ArrayBuffer)){for(var f,i=d.split(`
`),n=/\s+/,g=null,p=0;p<i.length;p++){var v=i[p].trim();if(0!==v.length&&"#"!==v.charAt(0)){var z=v.indexOf(" "),A=z>=0?v.substring(0,z):v;A=A.toLowerCase();var F=z>=0?v.substring(z+1).trim():"";"newmtl"===A?(g&&this.materials.push(g),m._blockEntityCollection=b,g=new h.StandardMaterial(F,m),m._blockEntityCollection=!1):"kd"===A&&g?(f=F.split(n,3).map(parseFloat),g.diffuseColor=h.Color3.FromArray(f)):"ka"===A&&g?(f=F.split(n,3).map(parseFloat),g.ambientColor=h.Color3.FromArray(f)):"ks"===A&&g?(f=F.split(n,3).map(parseFloat),g.specularColor=h.Color3.FromArray(f)):"ke"===A&&g?(f=F.split(n,3).map(parseFloat),g.emissiveColor=h.Color3.FromArray(f)):"ns"===A&&g?g.specularPower=parseFloat(F):"d"===A&&g?g.alpha=parseFloat(F):"map_ka"===A&&g?g.ambientTexture=B._getTexture(a,F,m):"map_kd"===A&&g?g.diffuseTexture=B._getTexture(a,F,m):"map_ks"===A&&g?g.specularTexture=B._getTexture(a,F,m):"map_ns"===A||("map_bump"===A&&g?g.bumpTexture=B._getTexture(a,F,m):"map_d"===A&&g&&(g.opacityTexture=B._getTexture(a,F,m)))}}g&&this.materials.push(g)}},B._getTexture=function(m,d,a){if(!d)return null;var b=m;if("file:"===m){var f=d.lastIndexOf("\\");-1===f&&(f=d.lastIndexOf("/")),b+=f>-1?d.substr(f+1):d}else b+=d;return new h.Texture(b,a,!1,B.INVERT_TEXTURE_Y)},B.INVERT_TEXTURE_Y=!0,B}(),H=function(){function B(m){this.name="obj",this.extensions=".obj",this.obj=/^o/,this.group=/^g/,this.mtllib=/^mtllib /,this.usemtl=/^usemtl /,this.smooth=/^s /,this.vertexPattern=/v( +[\d|\.|\+|\-|e|E]+){3,7}/,this.normalPattern=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.uvPattern=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.facePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,this.facePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,this.facePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,this._forAssetContainer=!1,this._meshLoadOptions=m||B.currentMeshLoadOptions}return Object.defineProperty(B,"INVERT_TEXTURE_Y",{get:function(){return y.INVERT_TEXTURE_Y},set:function(m){y.INVERT_TEXTURE_Y=m},enumerable:!0,configurable:!0}),Object.defineProperty(B,"currentMeshLoadOptions",{get:function(){return{ComputeNormals:B.COMPUTE_NORMALS,ImportVertexColors:B.IMPORT_VERTEX_COLORS,InvertY:B.INVERT_Y,InvertTextureY:B.INVERT_TEXTURE_Y,UVScaling:B.UV_SCALING,MaterialLoadingFailsSilently:B.MATERIAL_LOADING_FAILS_SILENTLY,OptimizeWithUV:B.OPTIMIZE_WITH_UV,SkipMaterials:B.SKIP_MATERIALS}},enumerable:!0,configurable:!0}),B.prototype._loadMTL=function(m,d,a,b){var f=h.Tools.BaseUrl+d+m;h.Tools.LoadFile(f,a,void 0,void 0,!1,function(i,n){b(f,n)})},B.prototype.createPlugin=function(){return new B(B.currentMeshLoadOptions)},B.prototype.canDirectLoad=function(m){return!1},B.prototype.importMeshAsync=function(m,d,a,b,f,i){return this._parseSolid(m,d,a,b).then(function(n){return{meshes:n,particleSystems:[],skeletons:[],animationGroups:[]}})},B.prototype.loadAsync=function(m,d,a,b,f){return this.importMeshAsync(null,m,d,a,b).then(function(){})},B.prototype.loadAssetContainerAsync=function(m,d,a,b,f){var i=this;return this._forAssetContainer=!0,this.importMeshAsync(null,m,d,a).then(function(n){var g=new h.AssetContainer(m);return n.meshes.forEach(function(p){return g.meshes.push(p)}),n.meshes.forEach(function(p){var v=p.material;v&&(-1==g.materials.indexOf(v)&&(g.materials.push(v),v.getActiveTextures().forEach(function(z){-1==g.textures.indexOf(z)&&g.textures.push(z)})))}),i._forAssetContainer=!1,g}).catch(function(n){throw i._forAssetContainer=!1,n})},B.prototype._parseSolid=function(m,d,a,b){for(var f,i=this,n=[],g=[],p=[],v=[],z=[],A=[],F=[],J=[],S=[],R=[],Z=[],_=0,ja=!1,ha=[],ra=[],ka=[],X=[],ba=[],na="",ga="",pa=new y(),oa=1,ua=!0,xa=new h.Color4(.5,.5,.5,1),ta=function(K,L,Q,O,T,P,V){var $;-1===($=i._meshLoadOptions.OptimizeWithUV?function(Y,ca){Y[ca[0]]||(Y[ca[0]]={normals:[],idx:[],uv:[]});var aa=Y[ca[0]].normals.indexOf(ca[1]);return 1!=aa&&ca[2]===Y[ca[0]].uv[aa]?Y[ca[0]].idx[aa]:-1}(Z,[K,Q,L]):function(Y,ca){Y[ca[0]]||(Y[ca[0]]={normals:[],idx:[]});var aa=Y[ca[0]].normals.indexOf(ca[1]);return-1===aa?-1:Y[ca[0]].idx[aa]}(Z,[K,Q]))?(A.push(F.length),F.push(O),J.push(T),R.push(P),void 0!==V&&S.push(V),Z[K].normals.push(Q),Z[K].idx.push(_++),i._meshLoadOptions.OptimizeWithUV&&Z[K].uv.push(L)):A.push($)},C=function(){for(var K=0;K<F.length;K++)ha.push(F[K].x,F[K].y,F[K].z),ka.push(R[K].x,R[K].y,R[K].z),X.push(J[K].x,J[K].y);!0===i._meshLoadOptions.ImportVertexColors&&ra.push(S[K].r,S[K].g,S[K].b,S[K].a),F=[],R=[],J=[],S=[],Z=[],_=0},r=function(K,L){for(var Q=L;Q<K.length-1;Q++)ba.push(K[0],K[Q],K[Q+1])},o=function(K,L){r(K,L);for(var Q=0;Q<ba.length;Q++){var O=parseInt(ba[Q])-1;ta(O,0,0,n[O],h.Vector2.Zero(),h.Vector3.Up(),!0===i._meshLoadOptions.ImportVertexColors?v[O]:void 0)}ba=[]},s=function(K,L){r(K,L);for(var Q=0;Q<ba.length;Q++){var O=ba[Q].split("/"),T=parseInt(O[0])-1,P=parseInt(O[1])-1;ta(T,P,0,n[T],p[P],h.Vector3.Up(),!0===i._meshLoadOptions.ImportVertexColors?v[T]:void 0)}ba=[]},x=function(K,L){r(K,L);for(var Q=0;Q<ba.length;Q++){var O=ba[Q].split("/"),T=parseInt(O[0])-1,P=parseInt(O[1])-1,V=parseInt(O[2])-1;ta(T,P,V,n[T],p[P],g[V])}ba=[]},E=function(K,L){r(K,L);for(var Q=0;Q<ba.length;Q++){var O=ba[Q].split("//"),T=parseInt(O[0])-1,P=parseInt(O[1])-1;ta(T,1,P,n[T],h.Vector2.Zero(),g[P],!0===i._meshLoadOptions.ImportVertexColors?v[T]:void 0)}ba=[]},c=function(K,L){r(K,L);for(var Q=0;Q<ba.length;Q++){var O=ba[Q].split("/"),T=n.length+parseInt(O[0]),P=p.length+parseInt(O[1]),V=g.length+parseInt(O[2]);ta(T,P,V,n[T],p[P],g[V],!0===i._meshLoadOptions.ImportVertexColors?v[T]:void 0)}ba=[]},e=function(){z.length>0&&(f=z[z.length-1],C(),A.reverse(),f.indices=A.slice(),f.positions=ha.slice(),f.normals=ka.slice(),f.uvs=X.slice(),!0===i._meshLoadOptions.ImportVertexColors&&(f.colors=ra.slice()),A=[],ha=[],ra=[],ka=[],X=[])},k=a.split(`
`),l=0;l<k.length;l++){var j,q=k[l].trim().replace(/\s\s/g," ");if(0!==q.length&&"#"!==q.charAt(0))if(this.vertexPattern.test(q))j=q.match(/[^ ]+/g),n.push(new h.Vector3(parseFloat(j[1]),parseFloat(j[2]),parseFloat(j[3]))),!0===this._meshLoadOptions.ImportVertexColors&&(j.length>=7?v.push(new h.Color4(parseFloat(j[4]),parseFloat(j[5]),parseFloat(j[6]),7===j.length||void 0===j[7]?1:parseFloat(j[7]))):v.push(xa));else if(null!==(j=this.normalPattern.exec(q)))g.push(new h.Vector3(parseFloat(j[1]),parseFloat(j[2]),parseFloat(j[3])));else if(null!==(j=this.uvPattern.exec(q)))p.push(new h.Vector2(parseFloat(j[1])*B.UV_SCALING.x,parseFloat(j[2])*B.UV_SCALING.y));else if(null!==(j=this.facePattern3.exec(q)))x(j[1].trim().split(" "),1);else if(null!==(j=this.facePattern4.exec(q)))E(j[1].trim().split(" "),1);else if(null!==(j=this.facePattern5.exec(q)))c(j[1].trim().split(" "),1);else if(null!==(j=this.facePattern2.exec(q)))s(j[1].trim().split(" "),1);else if(null!==(j=this.facePattern1.exec(q)))o(j[1].trim().split(" "),1);else if(this.group.test(q)||this.obj.test(q)){var u={name:q.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:""};e(),z.push(u),ja=!0,ua=!0,oa=1}else this.usemtl.test(q)?((na=q.substring(7).trim(),!ua||!ja)&&(e(),u={name:"mesh_mm"+oa.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:na},oa++,z.push(u),ja=!0),ja&&ua&&(z[z.length-1].materialName=na,ua=!1)):this.mtllib.test(q)?ga=q.substring(7).trim():this.smooth.test(q)||console.log("Unhandled expression at line : "+q)}ja&&(f=z[z.length-1],A.reverse(),C(),f.indices=A,f.positions=ha,f.normals=ka,f.uvs=X,!0===this._meshLoadOptions.ImportVertexColors&&(f.colors=ra)),ja||(A.reverse(),C(),z.push({name:h.Geometry.RandomId(),indices:A,positions:ha,colors:ra,normals:ka,uvs:X,materialName:na}));for(var t=[],D=new Array(),I=0;I<z.length;I++){if(m&&z[I].name){if(m instanceof Array){if(-1===m.indexOf(z[I].name))continue}else if(z[I].name!==m)continue}f=z[I],d._blockEntityCollection=this._forAssetContainer;var M=new h.Mesh(z[I].name,d);d._blockEntityCollection=!1,D.push(z[I].materialName);var N=new h.VertexData();if(N.uvs=f.uvs,N.indices=f.indices,N.positions=f.positions,!0===this._meshLoadOptions.ComputeNormals){var U=new Array();h.VertexData.ComputeNormals(f.positions,f.indices,U),N.normals=U}else N.normals=f.normals;!0===this._meshLoadOptions.ImportVertexColors&&(N.colors=f.colors),N.applyToMesh(M),this._meshLoadOptions.InvertY&&(M.scaling.y*=-1),t.push(M)}var W=[];return""!==ga&&!1===this._meshLoadOptions.SkipMaterials&&W.push(new Promise(function(K,L){i._loadMTL(ga,b,function(Q){try{pa.parseMTL(d,Q,b,i._forAssetContainer);for(var O=0;O<pa.materials.length;O++){for(var T,P=0,V=[];(T=D.indexOf(pa.materials[O].name,P))>-1;)V.push(T),P=T+1;if(-1===T&&0===V.length)pa.materials[O].dispose();else for(var $=0;$<V.length;$++)t[V[$]].material=pa.materials[O]}K()}catch(Y){h.Tools.Warn("Error processing MTL file: '"+ga+"'"),i._meshLoadOptions.MaterialLoadingFailsSilently?K():L(Y)}},function(Q,O){h.Tools.Warn("Error downloading MTL file: '"+ga+"'"),i._meshLoadOptions.MaterialLoadingFailsSilently?K():L(O)})})),Promise.all(W).then(function(){return t})},B.OPTIMIZE_WITH_UV=!0,B.INVERT_Y=!1,B.IMPORT_VERTEX_COLORS=!1,B.COMPUTE_NORMALS=!1,B.UV_SCALING=new h.Vector2(1,1),B.SKIP_MATERIALS=!1,B.MATERIAL_LOADING_FAILS_SILENTLY=!0,B}();h.SceneLoader&&h.SceneLoader.RegisterPlugin(new H()),w.d(G,"MTLFileLoader",function(){return y}),w.d(G,"OBJFileLoader",function(){return H})},function(fa,G,w){"use strict";w.r(G);var h=w(0),y=function(){function H(){this.solidPattern=/solid (\S*)([\S\s]*)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.name="stl",this.extensions={".stl":{isBinary:!0}}}return H.prototype.importMesh=function(B,m,d,a,b,f,i){var n;if("string"!=typeof d){if(this._isBinary(d)){var g=new h.Mesh("stlmesh",m);return this._parseBinary(g,d),b&&b.push(g),!0}for(var p=new Uint8Array(d),v="",z=0;z<d.byteLength;z++)v+=String.fromCharCode(p[z]);d=v}for(;n=this.solidPattern.exec(d);){var A=n[1];if(A!=n[3])return h.Tools.Error("Error in STL, solid name != endsolid name"),!1;if(B&&A){if(B instanceof Array){if(!B.indexOf(A))continue}else if(A!==B)continue}A=A||"stlmesh",g=new h.Mesh(A,m),this._parseASCII(g,n[2]),b&&b.push(g)}return!0},H.prototype.load=function(B,m,d){return this.importMesh(null,B,m,d,null,null,null)},H.prototype.loadAssetContainer=function(B,m,d,a){var b=new h.AssetContainer(B);return B._blockEntityCollection=!0,this.importMesh(null,B,m,d,b.meshes,null,null),B._blockEntityCollection=!1,b},H.prototype._isBinary=function(B){var m;if(50,84+50*(m=new DataView(B)).getUint32(80,!0)===m.byteLength)return!0;for(var d=m.byteLength,a=0;a<d;a++)if(m.getUint8(a)>127)return!0;return!1},H.prototype._parseBinary=function(B,m){for(var d=new DataView(m),a=d.getUint32(80,!0),b=0,f=new Float32Array(3*a*3),i=new Float32Array(3*a*3),n=new Uint32Array(3*a),g=0,p=0;p<a;p++){for(var v=84+50*p,z=d.getFloat32(v,!0),A=d.getFloat32(v+4,!0),F=d.getFloat32(v+8,!0),J=1;J<=3;J++){var S=v+12*J;f[b]=d.getFloat32(S,!0),f[b+2]=d.getFloat32(S+4,!0),f[b+1]=d.getFloat32(S+8,!0),i[b]=z,i[b+2]=A,i[b+1]=F,b+=3}n[g]=g++,n[g]=g++,n[g]=g++}B.setVerticesData(h.VertexBuffer.PositionKind,f),B.setVerticesData(h.VertexBuffer.NormalKind,i),B.setIndices(n),B.computeWorldMatrix(!0)},H.prototype._parseASCII=function(B,m){for(var d,a=[],b=[],f=[],i=0;d=this.facetsPattern.exec(m);){var n=d[1],g=this.normalPattern.exec(n);if(this.normalPattern.lastIndex=0,g){for(var p,v=[Number(g[1]),Number(g[5]),Number(g[3])];p=this.vertexPattern.exec(n);)a.push(Number(p[1]),Number(p[5]),Number(p[3])),b.push(v[0],v[1],v[2]);f.push(i++,i++,i++),this.vertexPattern.lastIndex=0}}this.facetsPattern.lastIndex=0,B.setVerticesData(h.VertexBuffer.PositionKind,a),B.setVerticesData(h.VertexBuffer.NormalKind,b),B.setIndices(f),B.computeWorldMatrix(!0)},H}();h.SceneLoader&&h.SceneLoader.RegisterPlugin(new y()),w.d(G,"STLFileLoader",function(){return y})},function(fa,G,w){"use strict";(function(h){var y=w(2),H=w(3);w.d(G,"a",function(){return y.GLTFFileLoader}),w.d(G,"b",function(){return y.GLTFLoaderAnimationStartMode}),w.d(G,"c",function(){return y.GLTFLoaderCoordinateSystemMode}),w.d(G,"d",function(){return y.GLTFLoaderState}),w.d(G,"e",function(){return H.GLTFValidation});var B=void 0!==h?h:"undefined"!=typeof window?window:void 0;if(void 0!==B){for(var m in B.BABYLON=B.BABYLON||{},y)B.BABYLON[m]=y[m];for(var m in H)B.BABYLON[m]=H[m]}}).call(this,w(4))},function(fa,G){},function(fa,G,w){"use strict";(function(h){var y=w(7);w.d(G,"a",function(){return y});var H=void 0!==h?h:"undefined"!=typeof window?window:void 0;if(void 0!==H)for(var B in H.BABYLON=H.BABYLON||{},H.BABYLON.GLTF1=H.BABYLON.GLTF1||{},y)H.BABYLON.GLTF1[B]=y[B]}).call(this,w(4))},function(fa,G,w){"use strict";(function(h){var y=w(5),H=w(11),B=w(6);w.d(G,"a",function(){return B});var m=void 0!==h?h:"undefined"!=typeof window?window:void 0;if(void 0!==m){m.BABYLON=m.BABYLON||{};var d=m.BABYLON;d.GLTF2=d.GLTF2||{},d.GLTF2.Loader=d.GLTF2.Loader||{},d.GLTF2.Loader.Extensions=d.GLTF2.Loader.Extensions||{};var a=[];for(var b in y)d.GLTF2.Loader.Extensions[b]=y[b],a.push(b);for(var b in H)d.GLTF2.Loader[b]=H[b],a.push(b);for(var b in B)a.indexOf(b)>-1||(d.GLTF2[b]=B[b])}}).call(this,w(4))},function(fa,G,w){"use strict";w.r(G),function(h){var y=w(8);w.d(G,"MTLFileLoader",function(){return y.MTLFileLoader}),w.d(G,"OBJFileLoader",function(){return y.OBJFileLoader});var H=void 0!==h?h:"undefined"!=typeof window?window:void 0;if(void 0!==H)for(var B in y)H.BABYLON[B]=y[B]}.call(this,w(4))},function(fa,G,w){"use strict";w.r(G),function(h){var y=w(9);w.d(G,"STLFileLoader",function(){return y.STLFileLoader});var H=void 0!==h?h:"undefined"!=typeof window?window:void 0;if(void 0!==H)for(var B in y)H.BABYLON[B]=y[B]}.call(this,w(4))},,,,function(fa,G,w){"use strict";w.r(G),w(2),w(3),w(7),w(6),w(8),w(9);var h=w(10),y=w(12),H=w(13),B=w(14),m=w(15);w.d(G,"GLTFLoaderCoordinateSystemMode",function(){return h.c}),w.d(G,"GLTFLoaderAnimationStartMode",function(){return h.b}),w.d(G,"GLTFLoaderState",function(){return h.d}),w.d(G,"GLTFFileLoader",function(){return h.a}),w.d(G,"GLTFValidation",function(){return h.e}),w.d(G,"GLTF1",function(){return y.a}),w.d(G,"GLTF2",function(){return H.a}),w.d(G,"MTLFileLoader",function(){return B.MTLFileLoader}),w.d(G,"OBJFileLoader",function(){return B.OBJFileLoader}),w.d(G,"STLFileLoader",function(){return m.STLFileLoader})}])})},34(A,D){!function(B,w){"object"==typeof A&&"object"==typeof D?D.exports=w(k$(35)):"function"==typeof define&&define.amd?define("babylonjs-materials",["babylonjs"],w):"object"==typeof A?A["babylonjs-materials"]=w(k$(35)):B.MATERIALS=w(B.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:A,function(B){return function(w){var m={};function i(g){if(m[g])return m[g].exports;var b=m[g]={i:g,l:!1,exports:{}};return w[g].call(b.exports,b,b.exports,i),b.l=!0,b.exports}return i.m=w,i.c=m,i.d=function(g,b,t){i.o(g,b)||Object.defineProperty(g,b,{enumerable:!0,get:t})},i.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},i.t=function(g,b){if(1&b&&(g=i(g)),8&b)return g;if(4&b&&"object"==typeof g&&g&&g.__esModule)return g;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:g}),2&b&&"string"!=typeof g)for(var p in g)i.d(t,p,function(q){return g[q]}.bind(null,p));return t},i.n=function(g){var b=g&&g.__esModule?function(){return g.default}:function(){return g};return i.d(b,"a",b),b},i.o=function(g,b){return Object.prototype.hasOwnProperty.call(g,b)},i.p="",i(i.s=19)}([function(w,m){w.exports=B},function(w,m,i){"use strict";i.d(m,"b",function(){return b}),i.d(m,"a",function(){return t});var g=function(p,q){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,j){o.__proto__=j}||function(o,j){for(var d in j)j.hasOwnProperty(d)&&(o[d]=j[d])})(p,q)};function b(p,q){function o(){this.constructor=p}g(p,q),p.prototype=null===q?Object.create(q):(o.prototype=q.prototype,new o())}function t(p,q,o,j){var d,a=arguments.length,e=a<3?q:null===j?j=Object.getOwnPropertyDescriptor(q,o):j;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)e=Reflect.decorate(p,q,o,j);else for(var f=p.length-1;f>=0;f--)(d=p[f])&&(e=(a<3?d(e):a>3?d(q,o,e):d(q,o))||e);return a>3&&e&&Object.defineProperty(q,o,e),e}},function(w,m){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(g){"object"==typeof window&&(i=window)}w.exports=i},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef BUMP
varying vec2 vNormalUV;
varying vec2 vNormalUV2;
uniform sampler2D normalSampler;
uniform vec2 vNormalInfos;
#endif
uniform sampler2D refractionSampler;
uniform sampler2D reflectionSampler;

const float LOG2=1.442695;
uniform vec3 cameraPosition;
uniform vec4 waterColor;
uniform float colorBlendFactor;
uniform vec4 waterColor2;
uniform float colorBlendFactor2;
uniform float bumpHeight;
uniform float time;

varying vec3 vRefractionMapTexCoord;
varying vec3 vReflectionMapTexCoord;
varying vec3 vPosition;
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>

#include<fogFragmentDeclaration>
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef BUMP
#ifdef BUMPSUPERIMPOSE
baseColor=0.6*texture2D(normalSampler,vNormalUV)+0.4*texture2D(normalSampler,vec2(vNormalUV2.x,vNormalUV2.y));
#else
baseColor=texture2D(normalSampler,vNormalUV);
#endif
vec3 bumpColor=baseColor.rgb;
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
baseColor.rgb*=vNormalInfos.y;
#else
vec3 bumpColor=vec3(1.0);
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec2 perturbation=bumpHeight*(baseColor.rg-0.5);
#ifdef BUMPAFFECTSREFLECTION
vec3 normalW=normalize(vNormalW+vec3(perturbation.x*8.0,0.0,perturbation.y*8.0));
if (normalW.y<0.0) {
normalW.y=-normalW.y;
}
#else
vec3 normalW=normalize(vNormalW);
#endif
#else
vec3 normalW=vec3(1.0,1.0,1.0);
vec2 perturbation=bumpHeight*(vec2(1.0,1.0)-0.5);
#endif
#ifdef FRESNELSEPARATE
#ifdef REFLECTION

vec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation*0.5,0.0,1.0);
vec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);
#ifdef IS_REFRACTION_LINEAR
refractiveColor.rgb=toGammaSpace(refractiveColor.rgb);
#endif
vec2 projectedReflectionTexCoords=clamp(vec2(
vReflectionMapTexCoord.x/vReflectionMapTexCoord.z+perturbation.x*0.3,
vReflectionMapTexCoord.y/vReflectionMapTexCoord.z+perturbation.y
),0.0,1.0);
vec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);
#ifdef IS_REFLECTION_LINEAR
reflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);
#endif
vec3 upVector=vec3(0.0,1.0,0.0);
float fresnelTerm=clamp(abs(pow(dot(viewDirectionW,upVector),3.0)),0.05,0.65);
float IfresnelTerm=1.0-fresnelTerm;
refractiveColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*refractiveColor;
reflectiveColor=IfresnelTerm*colorBlendFactor2*waterColor+(1.0-colorBlendFactor2*IfresnelTerm)*reflectiveColor;
vec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*IfresnelTerm;
baseColor=combinedColor;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularBase=vec3(0.,0.,0.);
vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
#include<lightFragment>[0..maxSimultaneousLights]
vec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
#else
#ifdef REFLECTION

vec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation,0.0,1.0);
vec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);
#ifdef IS_REFRACTION_LINEAR
refractiveColor.rgb=toGammaSpace(refractiveColor.rgb);
#endif
vec2 projectedReflectionTexCoords=clamp(vReflectionMapTexCoord.xy/vReflectionMapTexCoord.z+perturbation,0.0,1.0);
vec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);
#ifdef IS_REFLECTION_LINEAR
reflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);
#endif
vec3 upVector=vec3(0.0,1.0,0.0);
float fresnelTerm=max(dot(viewDirectionW,upVector),0.0);
vec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*(1.0-fresnelTerm);
baseColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*combinedColor;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularBase=vec3(0.,0.,0.);
vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
#include<lightFragment>[0..maxSimultaneousLights]
vec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
#endif

vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<logDepthFragment>
#include<fogFragment>


#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#elif defined(IMAGEPROCESSING)
color.rgb=toLinearSpace(color.rgb);
color=applyImageProcessing(color);
#endif
gl_FragColor=color;
}
`;b.Effect.ShadersStore.waterPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef BUMP
varying vec2 vNormalUV;
#ifdef BUMPSUPERIMPOSE
varying vec2 vNormalUV2;
#endif
uniform mat4 normalMatrix;
uniform vec2 vNormalInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<logDepthDeclaration>

uniform mat4 worldReflectionViewProjection;
uniform vec2 windDirection;
uniform float waveLength;
uniform float time;
uniform float windForce;
uniform float waveHeight;
uniform float waveSpeed;

varying vec3 vPosition;
varying vec3 vRefractionMapTexCoord;
varying vec3 vReflectionMapTexCoord;
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef BUMP
if (vNormalInfos.x == 0.)
{
vNormalUV=vec2(normalMatrix*vec4((uv*1.0)/waveLength+time*windForce*windDirection,1.0,0.0));
#ifdef BUMPSUPERIMPOSE
vNormalUV2=vec2(normalMatrix*vec4((uv*0.721)/waveLength+time*1.2*windForce*windDirection,1.0,0.0));
#endif
}
else
{
vNormalUV=vec2(normalMatrix*vec4((uv2*1.0)/waveLength+time*windForce*windDirection ,1.0,0.0));
#ifdef BUMPSUPERIMPOSE
vNormalUV2=vec2(normalMatrix*vec4((uv2*0.721)/waveLength+time*1.2*windForce*windDirection ,1.0,0.0));
#endif
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
vec3 p=position;
float newY=(sin(((p.x/0.05)+time*waveSpeed))*waveHeight*windDirection.x*5.0)
+(cos(((p.z/0.05)+time*waveSpeed))*waveHeight*windDirection.y*5.0);
p.y+=abs(newY);
gl_Position=viewProjection*finalWorld*vec4(p,1.0);
#ifdef REFLECTION
worldPos=viewProjection*finalWorld*vec4(p,1.0);

vPosition=position;
vRefractionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);
vRefractionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);
vRefractionMapTexCoord.z=worldPos.w;
worldPos=worldReflectionViewProjection*vec4(position,1.0);
vReflectionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);
vReflectionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);
vReflectionMapTexCoord.z=worldPos.w;
#endif
#include<logDepthVertex>
}
`;b.Effect.ShadersStore.waterVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.BUMP=!1,a.REFLECTION=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.SPECULARTERM=!1,a.LOGARITHMICDEPTH=!1,a.FRESNELSEPARATE=!1,a.BUMPSUPERIMPOSE=!1,a.BUMPAFFECTSREFLECTION=!1,a.IMAGEPROCESSING=!1,a.VIGNETTE=!1,a.VIGNETTEBLENDMODEMULTIPLY=!1,a.VIGNETTEBLENDMODEOPAQUE=!1,a.TONEMAPPING=!1,a.TONEMAPPING_ACES=!1,a.CONTRAST=!1,a.EXPOSURE=!1,a.COLORCURVES=!1,a.COLORGRADING=!1,a.COLORGRADING3D=!1,a.SAMPLER3DGREENDEPTH=!1,a.SAMPLER3DBGRMAP=!1,a.IMAGEPROCESSINGPOSTPROCESS=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e,f){void 0===f&&(f=new b.Vector2(512,512));var c=j.call(this,a,e)||this;return c.renderTargetSize=f,c.diffuseColor=new b.Color3(1,1,1),c.specularColor=new b.Color3(0,0,0),c.specularPower=64,c._disableLighting=!1,c._maxSimultaneousLights=4,c.windForce=6,c.windDirection=new b.Vector2(0,1),c.waveHeight=.4,c.bumpHeight=.4,c._bumpSuperimpose=!1,c._fresnelSeparate=!1,c._bumpAffectsReflection=!1,c.waterColor=new b.Color3(.1,.1,.6),c.colorBlendFactor=.2,c.waterColor2=new b.Color3(.1,.1,.6),c.colorBlendFactor2=.2,c.waveLength=.1,c.waveSpeed=1,c.disableClipPlane=!1,c._renderTargets=new b.SmartArray(16),c._mesh=null,c._reflectionTransform=b.Matrix.Zero(),c._lastTime=0,c._lastDeltaTime=0,c._createRenderTargets(e,f),c.getRenderTargetTextures=function(){return c._renderTargets.reset(),c._renderTargets.push(c._reflectionRTT),c._renderTargets.push(c._refractionRTT),c._renderTargets},c._imageProcessingConfiguration=c.getScene().imageProcessingConfiguration,c._imageProcessingConfiguration&&(c._imageProcessingObserver=c._imageProcessingConfiguration.onUpdateParameters.add(function(){c._markAllSubMeshesAsImageProcessingDirty()})),c}return Object(g.b)(d,j),Object.defineProperty(d.prototype,"hasRenderTargetTextures",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(a){this._useLogarithmicDepth=a&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"refractionTexture",{get:function(){return this._refractionRTT},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"reflectionTexture",{get:function(){return this._reflectionRTT},enumerable:!0,configurable:!0}),d.prototype.addToRenderList=function(a){this._refractionRTT&&this._refractionRTT.renderList&&this._refractionRTT.renderList.push(a),this._reflectionRTT&&this._reflectionRTT.renderList&&this._reflectionRTT.renderList.push(a)},d.prototype.enableRenderTargets=function(a){var e=a?1:0;this._refractionRTT&&(this._refractionRTT.refreshRate=e),this._reflectionRTT&&(this._reflectionRTT.refreshRate=e)},d.prototype.getRenderList=function(){return this._refractionRTT?this._refractionRTT.renderList:[]},Object.defineProperty(d.prototype,"renderTargetsEnabled",{get:function(){return!(this._refractionRTT&&0===this._refractionRTT.refreshRate)},enumerable:!0,configurable:!0}),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled)){if(this.bumpTexture&&b.MaterialFlags.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;c._needUVs=!0,c.BUMP=!0}b.MaterialFlags.ReflectionTextureEnabled&&(c.REFLECTION=!0)}if(b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForMisc(a,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._areMiscDirty&&(this._fresnelSeparate&&(c.FRESNELSEPARATE=!0),this._bumpSuperimpose&&(c.BUMPSUPERIMPOSE=!0),this._bumpAffectsReflection&&(c.BUMPAFFECTSREFLECTION=!0)),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!0,this._maxSimultaneousLights,this._disableLighting),c._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(c),c.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,c.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),this._mesh=a,this._waitingRenderList){for(var n=0;n<this._waitingRenderList.length;n++)this.addToRenderList(h.getNodeByID(this._waitingRenderList[n]));this._waitingRenderList=null}if(c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var l=new b.EffectFallbacks();c.FOG&&l.addFallback(1,"FOG"),c.LOGARITHMICDEPTH&&l.addFallback(0,"LOGARITHMICDEPTH"),b.MaterialHelper.HandleFallbacksForShadows(c,l,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,a);var r=[b.VertexBuffer.PositionKind];c.NORMAL&&r.push(b.VertexBuffer.NormalKind),c.UV1&&r.push(b.VertexBuffer.UVKind),c.UV2&&r.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&r.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(r,a,c,l),b.MaterialHelper.PrepareAttributesForInstances(r,c);var u=c.toString(),s=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vNormalInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","normalMatrix","logarithmicDepthConstant","worldReflectionViewProjection","windDirection","waveLength","time","windForce","cameraPosition","bumpHeight","waveHeight","waterColor","waterColor2","colorBlendFactor","colorBlendFactor2","waveSpeed"],v=["normalSampler","refractionSampler","reflectionSampler"],x=new Array();b.ImageProcessingConfiguration&&(b.ImageProcessingConfiguration.PrepareUniforms(s,c),b.ImageProcessingConfiguration.PrepareSamplers(v,c)),b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:s,uniformBuffersNames:x,samplers:v,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("water",{attributes:r,uniformsNames:s,uniformBuffersNames:x,samplers:v,defines:u,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;if(k&&this._mesh){this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this.bumpTexture&&b.MaterialFlags.BumpTextureEnabled&&(this._activeEffect.setTexture("normalSampler",this.bumpTexture),this._activeEffect.setFloat2("vNormalInfos",this.bumpTexture.coordinatesIndex,this.bumpTexture.level),this._activeEffect.setMatrix("normalMatrix",this.bumpTexture.getTextureMatrix())),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),h.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),b.MaterialHelper.BindLogDepth(h,this._activeEffect,c),b.MaterialFlags.ReflectionTextureEnabled&&(this._activeEffect.setTexture("refractionSampler",this._refractionRTT),this._activeEffect.setTexture("reflectionSampler",this._reflectionRTT));var n=this._mesh.getWorldMatrix().multiply(this._reflectionTransform).multiply(c.getProjectionMatrix()),l=c.getEngine().getDeltaTime();l!==this._lastDeltaTime&&(this._lastDeltaTime=l,this._lastTime+=this._lastDeltaTime),this._activeEffect.setMatrix("worldReflectionViewProjection",n),this._activeEffect.setVector2("windDirection",this.windDirection),this._activeEffect.setFloat("waveLength",this.waveLength),this._activeEffect.setFloat("time",this._lastTime/100000),this._activeEffect.setFloat("windForce",this.windForce),this._activeEffect.setFloat("waveHeight",this.waveHeight),this._activeEffect.setFloat("bumpHeight",this.bumpHeight),this._activeEffect.setColor4("waterColor",this.waterColor,1),this._activeEffect.setFloat("colorBlendFactor",this.colorBlendFactor),this._activeEffect.setColor4("waterColor2",this.waterColor2,1),this._activeEffect.setFloat("colorBlendFactor2",this.colorBlendFactor2),this._activeEffect.setFloat("waveSpeed",this.waveSpeed),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect),this._afterBind(e,this._activeEffect)}}},d.prototype._createRenderTargets=function(a,e){var f,c=this;this._refractionRTT=new b.RenderTargetTexture(name+"_refraction",{width:e.x,height:e.y},a,!1,!0),this._refractionRTT.wrapU=b.Constants.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.wrapV=b.Constants.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.ignoreCameraViewport=!0,this._reflectionRTT=new b.RenderTargetTexture(name+"_reflection",{width:e.x,height:e.y},a,!1,!0),this._reflectionRTT.wrapU=b.Constants.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.wrapV=b.Constants.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.ignoreCameraViewport=!0;var h,k=null,n=b.Matrix.Zero();this._refractionRTT.onBeforeRender=function(){if(c._mesh&&(f=c._mesh.isVisible,c._mesh.isVisible=!1),!c.disableClipPlane){k=a.clipPlane;var l=c._mesh?c._mesh.position.y:0;a.clipPlane=b.Plane.FromPositionAndNormal(new b.Vector3(0,l+.05,0),new b.Vector3(0,1,0))}},this._refractionRTT.onAfterRender=function(){c._mesh&&(c._mesh.isVisible=f),c.disableClipPlane||(a.clipPlane=k)},this._reflectionRTT.onBeforeRender=function(){if(c._mesh&&(f=c._mesh.isVisible,c._mesh.isVisible=!1),!c.disableClipPlane){k=a.clipPlane;var l=c._mesh?c._mesh.position.y:0;a.clipPlane=b.Plane.FromPositionAndNormal(new b.Vector3(0,l-.05,0),new b.Vector3(0,-1,0)),b.Matrix.ReflectionToRef(a.clipPlane,n)}h=a.getViewMatrix(),n.multiplyToRef(h,c._reflectionTransform),a.setTransformMatrix(c._reflectionTransform,a.getProjectionMatrix()),a.getEngine().cullBackFaces=!1,a._mirroredCameraPosition=b.Vector3.TransformCoordinates(a.activeCamera.position,n)},this._reflectionRTT.onAfterRender=function(){c._mesh&&(c._mesh.isVisible=f),a.clipPlane=k,a.setTransformMatrix(h,a.getProjectionMatrix()),a.getEngine().cullBackFaces=!0,a._mirroredCameraPosition=null}},d.prototype.getAnimatables=function(){var a=[];return this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&a.push(this.bumpTexture),this._reflectionRTT&&this._reflectionRTT.animations&&this._reflectionRTT.animations.length>0&&a.push(this._reflectionRTT),this._refractionRTT&&this._refractionRTT.animations&&this._refractionRTT.animations.length>0&&a.push(this._refractionRTT),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._bumpTexture&&a.push(this._bumpTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||this._bumpTexture===a},d.prototype.dispose=function(a){this.bumpTexture&&this.bumpTexture.dispose();var e=this.getScene().customRenderTargets.indexOf(this._refractionRTT);-1!=e&&this.getScene().customRenderTargets.splice(e,1),e=-1,-1!=(e=this.getScene().customRenderTargets.indexOf(this._reflectionRTT))&&this.getScene().customRenderTargets.splice(e,1),this._reflectionRTT&&this._reflectionRTT.dispose(),this._refractionRTT&&this._refractionRTT.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);if(a.customType="BABYLON.WaterMaterial",a.renderList=[],this._refractionRTT&&this._refractionRTT.renderList)for(var e=0;e<this._refractionRTT.renderList.length;e++)a.renderList.push(this._refractionRTT.renderList[e].id);return a},d.prototype.getClassName=function(){return"WaterMaterial"},d.Parse=function(a,e,f){var c=b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f);return c._waitingRenderList=a.renderList,c},d.CreateDefaultMesh=function(a,e){return b.Mesh.CreateGround(a,512,512,32,e,!1)},Object(g.a)([Object(b.serializeAsTexture)("bumpTexture")],d.prototype,"_bumpTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"specularColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"specularPower",void 0),Object(g.a)([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),Object(g.a)([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"windForce",void 0),Object(g.a)([Object(b.serializeAsVector2)()],d.prototype,"windDirection",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"waveHeight",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"bumpHeight",void 0),Object(g.a)([Object(b.serialize)("bumpSuperimpose")],d.prototype,"_bumpSuperimpose",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsMiscDirty")],d.prototype,"bumpSuperimpose",void 0),Object(g.a)([Object(b.serialize)("fresnelSeparate")],d.prototype,"_fresnelSeparate",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsMiscDirty")],d.prototype,"fresnelSeparate",void 0),Object(g.a)([Object(b.serialize)("bumpAffectsReflection")],d.prototype,"_bumpAffectsReflection",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsMiscDirty")],d.prototype,"bumpAffectsReflection",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"waterColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"colorBlendFactor",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"waterColor2",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"colorBlendFactor2",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"waveLength",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"waveSpeed",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"disableClipPlane",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"useLogarithmicDepth",null),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.WaterMaterial"]=o,i.d(m,"WaterMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneFragmentDeclaration>

uniform vec3 cameraPosition;
uniform vec3 cameraOffset;
uniform float luminance;
uniform float turbidity;
uniform float rayleigh;
uniform float mieCoefficient;
uniform float mieDirectionalG;
uniform vec3 sunPosition;

#include<fogFragmentDeclaration>

const float e=2.71828182845904523536028747135266249775724709369995957;
const float pi=3.141592653589793238462643383279502884197169;
const float n=1.0003;
const float N=2.545E25;
const float pn=0.035;
const vec3 lambda=vec3(680E-9,550E-9,450E-9);
const vec3 K=vec3(0.686,0.678,0.666);
const float v=4.0;
const float rayleighZenithLength=8.4E3;
const float mieZenithLength=1.25E3;
const vec3 up=vec3(0.0,1.0,0.0);
const float EE=1000.0;
const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;
const float cutoffAngle=pi/1.95;
const float steepness=1.5;
vec3 totalRayleigh(vec3 lambda)
{
return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));
}
vec3 simplifiedRayleigh()
{
return 0.0005/vec3(94,40,18);
}
float rayleighPhase(float cosTheta)
{
return (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));
}
vec3 totalMie(vec3 lambda,vec3 K,float T)
{
float c=(0.2*T )*10E-18;
return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;
}
float hgPhase(float cosTheta,float g)
{
return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));
}
float sunIntensity(float zenithAngleCos)
{
return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));
}
float A=0.15;
float B=0.50;
float C=0.10;
float D=0.20;
float EEE=0.02;
float F=0.30;
float W=1000.0;
vec3 Uncharted2Tonemap(vec3 x)
{
return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;
}
void main(void) {

#include<clipPlaneFragment>

float sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);
float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));
vec3 sunDirection=normalize(sunPosition);
float sunE=sunIntensity(dot(sunDirection,up));
vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;
vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;
float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));
float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));
float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));
vec3 Fex=exp(-(betaR*sR+betaM*sM));
float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);
float rPhase=rayleighPhase(cosTheta*0.5+0.5);
vec3 betaRTheta=betaR*rPhase;
float mPhase=hgPhase(cosTheta,mieDirectionalG);
vec3 betaMTheta=betaM*mPhase;
vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));
Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));
vec3 direction=normalize(vPositionW-cameraPosition);
float theta=acos(direction.y);
float phi=atan(direction.z,direction.x);
vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);
vec3 L0=vec3(0.1)*Fex;
float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);
L0+=(sunE*19000.0*Fex)*sundisk;
vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));
vec3 texColor=(Lin+L0);
texColor*=0.04 ;
texColor+=vec3(0.0,0.001,0.0025)*0.3;
float g_fMaxLuminance=1.0;
float fLumScaled=0.1/luminance;
float fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled);
float ExposureBias=fLumCompressed;
vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);



vec3 retColor=curr*whiteScale;


float alpha=1.0;
#ifdef VERTEXCOLOR
retColor.rgb*=vColor.rgb;
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif

vec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);

#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.skyPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif

uniform mat4 world;
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
void main(void) {
gl_Position=viewProjection*world*vec4(position,1.0);
vec4 worldPos=world*vec4(position,1.0);
vPositionW=vec3(worldPos);

#include<clipPlaneVertex>

#include<fogVertex>

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.skyVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.POINTSIZE=!1,a.FOG=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.luminance=1,f.turbidity=10,f.rayleigh=2,f.mieCoefficient=.005,f.mieDirectionalG=.8,f.distance=500,f.inclination=.49,f.azimuth=.25,f.sunPosition=new b.Vector3(0,100,0),f.useSunPosition=!1,f.cameraOffset=b.Vector3.Zero(),f._cameraPosition=b.Vector3.Zero(),f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,!1,c),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!1),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var k=new b.EffectFallbacks();c.FOG&&k.addFallback(1,"FOG");var n=[b.VertexBuffer.PositionKind];c.VERTEXCOLOR&&n.push(b.VertexBuffer.ColorKind);var l=c.toString();e.setEffect(h.getEngine().createEffect("sky",n,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset"],[],l,k,this.onCompiled,this.onError),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene();if(f._materialDefines){var h=f.effect;if(h){this._activeEffect=h,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),this._mustRebind(c,h)&&(b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect);var k=c.activeCamera;if(k){var n=k.getWorldMatrix();this._cameraPosition.x=n.m[12],this._cameraPosition.y=n.m[13],this._cameraPosition.z=n.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){var l=Math.PI*(this.inclination-.5),r=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(r),this.sunPosition.y=this.distance*Math.sin(r)*Math.sin(l),this.sunPosition.z=this.distance*Math.sin(r)*Math.cos(l)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(e,this._activeEffect)}}},d.prototype.getAnimatables=function(){return[]},d.prototype.dispose=function(a){j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.SkyMaterial",a},d.prototype.getClassName=function(){return"SkyMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},Object(g.a)([Object(b.serialize)()],d.prototype,"luminance",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"turbidity",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"rayleigh",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"mieCoefficient",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"mieDirectionalG",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"distance",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"inclination",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"azimuth",void 0),Object(g.a)([Object(b.serializeAsVector3)()],d.prototype,"sunPosition",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"useSunPosition",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"cameraOffset",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.SkyMaterial"]=o,i.d(m,"SkyMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;

varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif

uniform sampler2D distortionSampler;
uniform sampler2D opacitySampler;
#ifdef DIFFUSE
varying vec2 vDistortionCoords1;
varying vec2 vDistortionCoords2;
varying vec2 vDistortionCoords3;
#endif
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
vec4 bx2(vec4 x)
{
return vec4(2.0)*x-vec4(1.0);
}
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);

float alpha=1.0;
#ifdef DIFFUSE

const float distortionAmount0=0.092;
const float distortionAmount1=0.092;
const float distortionAmount2=0.092;
vec2 heightAttenuation=vec2(0.3,0.39);
vec4 noise0=texture2D(distortionSampler,vDistortionCoords1);
vec4 noise1=texture2D(distortionSampler,vDistortionCoords2);
vec4 noise2=texture2D(distortionSampler,vDistortionCoords3);
vec4 noiseSum=bx2(noise0)*distortionAmount0+bx2(noise1)*distortionAmount1+bx2(noise2)*distortionAmount2;
vec4 perturbedBaseCoords=vec4(vDiffuseUV,0.0,1.0)+noiseSum*(vDiffuseUV.y*heightAttenuation.x+heightAttenuation.y);
vec4 opacityColor=texture2D(opacitySampler,perturbedBaseCoords.xy);
#ifdef ALPHATEST
if (opacityColor.r<0.1)
discard;
#endif
#include<depthPrePass>
baseColor=texture2D(diffuseSampler,perturbedBaseCoords.xy)*2.0;
baseColor*=opacityColor;
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

vec3 diffuseBase=vec3(1.0,1.0,1.0);
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif

vec4 color=vec4(baseColor.rgb,alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.firePixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>

uniform float time;
uniform float speed;
#ifdef DIFFUSE
varying vec2 vDistortionCoords1;
varying vec2 vDistortionCoords2;
varying vec2 vDistortionCoords3;
#endif
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
gl_Position=viewProjection*worldPos;
vPositionW=vec3(worldPos);

#ifdef DIFFUSE
vDiffuseUV=uv;
vDiffuseUV.y-=0.2;
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
#ifdef DIFFUSE

vec3 layerSpeed=vec3(-0.2,-0.52,-0.1)*speed;
vDistortionCoords1.x=uv.x;
vDistortionCoords1.y=uv.y+layerSpeed.x*time/1000.0;
vDistortionCoords2.x=uv.x;
vDistortionCoords2.y=uv.y+layerSpeed.y*time/1000.0;
vDistortionCoords3.x=uv.x;
vDistortionCoords3.y=uv.y+layerSpeed.z*time/1000.0;
#endif
}
`;b.Effect.ShadersStore.fireVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.UV1=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.BonesPerMesh=0,a.NUM_BONE_INFLUENCERS=0,a.INSTANCES=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f.speed=1,f._scaledDiffuse=new b.Color3(),f._lastTime=0,f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return!1},d.prototype.needAlphaTesting=function(){return!0},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(c.ALPHATEST=!!this._opacityTexture,c._areMiscDirty&&(c.POINTSIZE=this.pointsCloud||h.forcePointsCloud,c.FOG=h.fogEnabled&&a.applyFog&&h.fogMode!==b.Scene.FOGMODE_NONE&&this.fogEnabled),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!1,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.UV1&&l.push(b.VertexBuffer.UVKind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString();e.setEffect(h.getEngine().createEffect("fire",{attributes:l,uniformsNames:["world","view","viewProjection","vEyePosition","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","time","speed"],uniformBuffersNames:[],samplers:["diffuseSampler","distortionSampler","opacitySampler"],defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:null,maxSimultaneousLights:4,transformFeedbackVaryings:null},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene();if(f._materialDefines){var h=f.effect;h&&(this._activeEffect=h,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,h)&&(this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix()),this._activeEffect.setTexture("distortionSampler",this._distortionTexture),this._activeEffect.setTexture("opacitySampler",this._opacityTexture)),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(h,c)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*e.visibility),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._lastTime+=c.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime),this._activeEffect.setFloat("speed",this.speed),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&a.push(this._diffuseTexture),this._distortionTexture&&this._distortionTexture.animations&&this._distortionTexture.animations.length>0&&a.push(this._distortionTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&a.push(this._opacityTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),this._distortionTexture&&a.push(this._distortionTexture),this._opacityTexture&&a.push(this._opacityTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||(this._diffuseTexture===a||(this._distortionTexture===a||this._opacityTexture===a))},d.prototype.getClassName=function(){return"FireMaterial"},d.prototype.dispose=function(a){this._diffuseTexture&&this._diffuseTexture.dispose(),this._distortionTexture&&this._distortionTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=j.prototype.serialize.call(this);return a.customType="BABYLON.FireMaterial",a.diffuseColor=this.diffuseColor.asArray(),a.speed=this.speed,this._diffuseTexture&&(a._diffuseTexture=this._diffuseTexture.serialize()),this._distortionTexture&&(a._distortionTexture=this._distortionTexture.serialize()),this._opacityTexture&&(a._opacityTexture=this._opacityTexture.serialize()),a},d.Parse=function(a,e,f){var c=new d(a.name,e);return c.diffuseColor=b.Color3.FromArray(a.diffuseColor),c.speed=a.speed,c.alpha=a.alpha,c.id=a.id,b.Tags.AddTagsTo(c,a.tags),c.backFaceCulling=a.backFaceCulling,c.wireframe=a.wireframe,a._diffuseTexture&&(c._diffuseTexture=b.Texture.Parse(a._diffuseTexture,e,f)),a._distortionTexture&&(c._distortionTexture=b.Texture.Parse(a._distortionTexture,e,f)),a._opacityTexture&&(c._opacityTexture=b.Texture.Parse(a._opacityTexture,e,f)),c},Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),Object(g.a)([Object(b.serializeAsTexture)("distortionTexture")],d.prototype,"_distortionTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"distortionTexture",void 0),Object(g.a)([Object(b.serializeAsTexture)("opacityTexture")],d.prototype,"_opacityTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"opacityTexture",void 0),Object(g.a)([Object(b.serializeAsColor3)("diffuse")],d.prototype,"diffuseColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"speed",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.FireMaterial"]=o,i.d(m,"FireMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif

varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]

#ifdef DIFFUSEX
varying vec2 vTextureUVX;
uniform sampler2D diffuseSamplerX;
#ifdef BUMPX
uniform sampler2D normalSamplerX;
#endif
#endif
#ifdef DIFFUSEY
varying vec2 vTextureUVY;
uniform sampler2D diffuseSamplerY;
#ifdef BUMPY
uniform sampler2D normalSamplerY;
#endif
#endif
#ifdef DIFFUSEZ
varying vec2 vTextureUVZ;
uniform sampler2D diffuseSamplerZ;
#ifdef BUMPZ
uniform sampler2D normalSamplerZ;
#endif
#endif
#ifdef NORMAL
varying mat3 tangentSpace;
#endif
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<fogFragmentDeclaration>
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(0.,0.,0.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=tangentSpace[2];
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
vec4 baseNormal=vec4(0.0,0.0,0.0,1.0);
normalW*=normalW;
#ifdef DIFFUSEX
baseColor+=texture2D(diffuseSamplerX,vTextureUVX)*normalW.x;
#ifdef BUMPX
baseNormal+=texture2D(normalSamplerX,vTextureUVX)*normalW.x;
#endif
#endif
#ifdef DIFFUSEY
baseColor+=texture2D(diffuseSamplerY,vTextureUVY)*normalW.y;
#ifdef BUMPY
baseNormal+=texture2D(normalSamplerY,vTextureUVY)*normalW.y;
#endif
#endif
#ifdef DIFFUSEZ
baseColor+=texture2D(diffuseSamplerZ,vTextureUVZ)*normalW.z;
#ifdef BUMPZ
baseNormal+=texture2D(normalSamplerZ,vTextureUVZ)*normalW.z;
#endif
#endif
#ifdef NORMAL
normalW=normalize((2.0*baseNormal.xyz-1.0)*tangentSpace);
#endif
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularBase=vec3(0.,0.,0.);
vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;

vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.triplanarPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSEX
varying vec2 vTextureUVX;
#endif
#ifdef DIFFUSEY
varying vec2 vTextureUVY;
#endif
#ifdef DIFFUSEZ
varying vec2 vTextureUVZ;
#endif
uniform float tileSize;
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying mat3 tangentSpace;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void)
{
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
gl_Position=viewProjection*worldPos;
vPositionW=vec3(worldPos);
#ifdef DIFFUSEX
vTextureUVX=worldPos.zy/tileSize;
#endif
#ifdef DIFFUSEY
vTextureUVY=worldPos.xz/tileSize;
#endif
#ifdef DIFFUSEZ
vTextureUVZ=worldPos.xy/tileSize;
#endif
#ifdef NORMAL

vec3 xtan=vec3(0,0,1);
vec3 xbin=vec3(0,1,0);
vec3 ytan=vec3(1,0,0);
vec3 ybin=vec3(0,0,1);
vec3 ztan=vec3(1,0,0);
vec3 zbin=vec3(0,1,0);
vec3 normalizedNormal=normalize(normal);
normalizedNormal*=normalizedNormal;
vec3 worldBinormal=normalize(xbin*normalizedNormal.x+ybin*normalizedNormal.y+zbin*normalizedNormal.z);
vec3 worldTangent=normalize(xtan*normalizedNormal.x+ytan*normalizedNormal.y+ztan*normalizedNormal.z);
worldTangent=(world*vec4(worldTangent,1.0)).xyz;
worldBinormal=(world*vec4(worldBinormal,1.0)).xyz;
vec3 worldNormal=normalize(cross(worldTangent,worldBinormal));
tangentSpace[0]=worldTangent;
tangentSpace[1]=worldBinormal;
tangentSpace[2]=worldNormal;
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.triplanarVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSEX=!1,a.DIFFUSEY=!1,a.DIFFUSEZ=!1,a.BUMPX=!1,a.BUMPY=!1,a.BUMPZ=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.SPECULARTERM=!1,a.NORMAL=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.tileSize=1,f.diffuseColor=new b.Color3(1,1,1),f.specularColor=new b.Color3(.2,.2,.2),f.specularPower=64,f._disableLighting=!1,f._maxSimultaneousLights=4,f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&h.texturesEnabled){if(b.MaterialFlags.DiffuseTextureEnabled){for(var n=[this.diffuseTextureX,this.diffuseTextureY,this.diffuseTextureZ],l=["DIFFUSEX","DIFFUSEY","DIFFUSEZ"],r=0;r<n.length;r++)if(n[r]){if(!n[r].isReady())return!1;c[l[r]]=!0}}if(b.MaterialFlags.BumpTextureEnabled){for(n=[this.normalTextureX,this.normalTextureY,this.normalTextureZ],l=["BUMPX","BUMPY","BUMPZ"],r=0;r<n.length;r++)if(n[r]){if(!n[r].isReady())return!1;c[l[r]]=!0}}}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var u=new b.EffectFallbacks();c.FOG&&u.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,u,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&u.addCPUSkinningFallback(0,a);var s=[b.VertexBuffer.PositionKind];c.NORMAL&&s.push(b.VertexBuffer.NormalKind),c.VERTEXCOLOR&&s.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(s,a,c,u),b.MaterialHelper.PrepareAttributesForInstances(s,c);var v=c.toString(),x=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","tileSize"],y=["diffuseSamplerX","diffuseSamplerY","diffuseSamplerZ","normalSamplerX","normalSamplerY","normalSamplerZ"],z=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:x,uniformBuffersNames:z,samplers:y,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("triplanar",{attributes:s,uniformsNames:x,uniformBuffersNames:z,samplers:y,defines:v,fallbacks:u,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._activeEffect.setFloat("tileSize",this.tileSize),c.getCachedMaterial()!==this&&(this.diffuseTextureX&&this._activeEffect.setTexture("diffuseSamplerX",this.diffuseTextureX),this.diffuseTextureY&&this._activeEffect.setTexture("diffuseSamplerY",this.diffuseTextureY),this.diffuseTextureZ&&this._activeEffect.setTexture("diffuseSamplerZ",this.diffuseTextureZ),this.normalTextureX&&this._activeEffect.setTexture("normalSamplerX",this.normalTextureX),this.normalTextureY&&this._activeEffect.setTexture("normalSamplerY",this.normalTextureY),this.normalTextureZ&&this._activeEffect.setTexture("normalSamplerZ",this.normalTextureZ),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),h.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&a.push(this.mixTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTextureX&&a.push(this._diffuseTextureX),this._diffuseTextureY&&a.push(this._diffuseTextureY),this._diffuseTextureZ&&a.push(this._diffuseTextureZ),this._normalTextureX&&a.push(this._normalTextureX),this._normalTextureY&&a.push(this._normalTextureY),this._normalTextureZ&&a.push(this._normalTextureZ),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||(this._diffuseTextureX===a||(this._diffuseTextureY===a||(this._diffuseTextureZ===a||(this._normalTextureX===a||(this._normalTextureY===a||this._normalTextureZ===a)))))},d.prototype.dispose=function(a){this.mixTexture&&this.mixTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.TriPlanarMaterial",a},d.prototype.getClassName=function(){return"TriPlanarMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},Object(g.a)([Object(b.serializeAsTexture)()],d.prototype,"mixTexture",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTextureX")],d.prototype,"_diffuseTextureX",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTextureX",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexturY")],d.prototype,"_diffuseTextureY",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTextureY",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTextureZ")],d.prototype,"_diffuseTextureZ",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTextureZ",void 0),Object(g.a)([Object(b.serializeAsTexture)("normalTextureX")],d.prototype,"_normalTextureX",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"normalTextureX",void 0),Object(g.a)([Object(b.serializeAsTexture)("normalTextureY")],d.prototype,"_normalTextureY",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"normalTextureY",void 0),Object(g.a)([Object(b.serializeAsTexture)("normalTextureZ")],d.prototype,"_normalTextureZ",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"normalTextureZ",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"tileSize",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"specularColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"specularPower",void 0),Object(g.a)([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),Object(g.a)([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.TriPlanarMaterial"]=o,i.d(m,"TriPlanarMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;

uniform vec4 furColor;
uniform float furLength;
varying vec3 vPositionW;
varying float vfur_length;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif

#ifdef HIGHLEVEL
uniform float furOffset;
uniform float furOcclusion;
uniform sampler2D furTexture;
varying vec2 vFurUV;
#endif
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<fogFragmentDeclaration>
#include<clipPlaneFragmentDeclaration>
float Rand(vec3 rv) {
float x=dot(rv,vec3(12.9898,78.233,24.65487));
return fract(sin(x)*43758.5453);
}
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=furColor;
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor*=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef HIGHLEVEL

vec4 furTextureColor=texture2D(furTexture,vec2(vFurUV.x,vFurUV.y));
if (furTextureColor.a<=0.0 || furTextureColor.g<furOffset) {
discard;
}
float occlusion=mix(0.0,furTextureColor.b*1.2,furOffset);
baseColor=vec4(baseColor.xyz*max(occlusion,furOcclusion),1.1-furOffset);
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase.rgb*baseColor.rgb,0.0,1.0);

#ifdef HIGHLEVEL
vec4 color=vec4(finalDiffuse,alpha);
#else
float r=vfur_length/furLength*0.5;
vec4 color=vec4(finalDiffuse*(0.5+r),alpha);
#endif
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.furPixelShader=t;var p=`precision highp float;

attribute vec3 position;
attribute vec3 normal;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

uniform float furLength;
uniform float furAngle;
#ifdef HIGHLEVEL
uniform float furOffset;
uniform vec3 furGravity;
uniform float furTime;
uniform float furSpacing;
uniform float furDensity;
#endif
#ifdef HEIGHTMAP
uniform sampler2D heightTexture;
#endif
#ifdef HIGHLEVEL
varying vec2 vFurUV;
#endif
#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
varying float vfur_length;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
float Rand(vec3 rv) {
float x=dot(rv,vec3(12.9898,78.233,24.65487));
return fract(sin(x)*43758.5453);
}
void main(void) {
#include<instancesVertex>
#include<bonesVertex>

float r=Rand(position);
#ifdef HEIGHTMAP
#if __VERSION__>100
vfur_length=furLength*texture(heightTexture,uv).x;
#else
vfur_length=furLength*texture2D(heightTexture,uv).r;
#endif
#else
vfur_length=(furLength*r);
#endif
vec3 tangent1=vec3(normal.y,-normal.x,0);
vec3 tangent2=vec3(-normal.z,0,normal.x);
r=Rand(tangent1*r);
float J=(2.0+4.0*r);
r=Rand(tangent2*r);
float K=(2.0+2.0*r);
tangent1=tangent1*J+tangent2*K;
tangent1=normalize(tangent1);
vec3 newPosition=position+normal*vfur_length*cos(furAngle)+tangent1*vfur_length*sin(furAngle);
#ifdef HIGHLEVEL

vec3 forceDirection=vec3(0.0,0.0,0.0);
forceDirection.x=sin(furTime+position.x*0.05)*0.2;
forceDirection.y=cos(furTime*0.7+position.y*0.04)*0.2;
forceDirection.z=sin(furTime*0.7+position.z*0.04)*0.2;
vec3 displacement=vec3(0.0,0.0,0.0);
displacement=furGravity+forceDirection;
float displacementFactor=pow(furOffset,3.0);
vec3 aNormal=normal;
aNormal.xyz+=displacement*displacementFactor;
newPosition=vec3(newPosition.x,newPosition.y,newPosition.z)+(normalize(aNormal)*furOffset*furSpacing);
#endif
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

gl_Position=viewProjection*finalWorld*vec4(newPosition,1.0);
vec4 worldPos=finalWorld*vec4(newPosition,1.0);
vPositionW=vec3(worldPos);

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#ifdef HIGHLEVEL
vFurUV=vDiffuseUV*furDensity;
#endif
#else
#ifdef HIGHLEVEL
vFurUV=uv*furDensity;
#endif
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.furVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.HEIGHTMAP=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.HIGHLEVEL=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f.furLength=1,f.furAngle=0,f.furColor=new b.Color3(.44,.21,.02),f.furOffset=0,f.furSpacing=12,f.furGravity=new b.Vector3(0,0,0),f.furSpeed=100,f.furDensity=20,f.furOcclusion=0,f._disableLighting=!1,f._maxSimultaneousLights=4,f.highLevelFur=!0,f._furTime=0,f}return Object(g.b)(d,j),Object.defineProperty(d.prototype,"furTime",{get:function(){return this._furTime},set:function(a){this._furTime=a},enumerable:!0,configurable:!0}),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.updateFur=function(){for(var a=1;a<this._meshes.length;a++){var e=this._meshes[a].material;e.furLength=this.furLength,e.furAngle=this.furAngle,e.furGravity=this.furGravity,e.furSpacing=this.furSpacing,e.furSpeed=this.furSpeed,e.furColor=this.furColor,e.diffuseTexture=this.diffuseTexture,e.furTexture=this.furTexture,e.highLevelFur=this.highLevelFur,e.furTime=this.furTime,e.furDensity=this.furDensity}},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&h.texturesEnabled){if(this.diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(this.heightTexture&&k.getCaps().maxVertexTextureImageUnits){if(!this.heightTexture.isReady())return!1;c._needUVs=!0,c.HEIGHTMAP=!0}}if(this.highLevelFur!==c.HIGHLEVEL&&(c.HIGHLEVEL=!0,c.markAsUnprocessed()),b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","furLength","furAngle","furColor","furOffset","furGravity","furTime","furSpacing","furDensity","furOcclusion"],s=["diffuseSampler","heightTexture","furTexture"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("fur",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),c.getCachedMaterial()!==this&&(this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),this._heightTexture&&this._activeEffect.setTexture("heightTexture",this._heightTexture),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._activeEffect.setFloat("furLength",this.furLength),this._activeEffect.setFloat("furAngle",this.furAngle),this._activeEffect.setColor4("furColor",this.furColor,1),this.highLevelFur&&(this._activeEffect.setVector3("furGravity",this.furGravity),this._activeEffect.setFloat("furOffset",this.furOffset),this._activeEffect.setFloat("furSpacing",this.furSpacing),this._activeEffect.setFloat("furDensity",this.furDensity),this._activeEffect.setFloat("furOcclusion",this.furOcclusion),this._furTime+=this.getScene().getEngine().getDeltaTime()/this.furSpeed,this._activeEffect.setFloat("furTime",this._furTime),this._activeEffect.setTexture("furTexture",this.furTexture)),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&a.push(this.diffuseTexture),this.heightTexture&&this.heightTexture.animations&&this.heightTexture.animations.length>0&&a.push(this.heightTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),this._heightTexture&&a.push(this._heightTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||(this.diffuseTexture===a||this._heightTexture===a)},d.prototype.dispose=function(a){if(this.diffuseTexture&&this.diffuseTexture.dispose(),this._meshes)for(var e=1;e<this._meshes.length;e++){var f=this._meshes[e].material;f&&f.dispose(a),this._meshes[e].dispose()}j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.FurMaterial",this._meshes&&(a.sourceMeshName=this._meshes[0].name,a.quality=this._meshes.length),a},d.prototype.getClassName=function(){return"FurMaterial"},d.Parse=function(a,e,f){var c=b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f);return a.sourceMeshName&&c.highLevelFur&&e.executeWhenReady(function(){var h=e.getMeshByName(a.sourceMeshName);if(h){var k=d.GenerateTexture("Fur Texture",e);c.furTexture=k,d.FurifyMesh(h,a.quality)}}),c},d.GenerateTexture=function(a,e){for(var f=new b.DynamicTexture("FurTexture "+a,256,e,!0),c=f.getContext(),h=0;h<20000;++h)c.fillStyle="rgba(255, "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", 1)",c.fillRect(Math.random()*f.getSize().width,Math.random()*f.getSize().height,2,2);return f.update(!1),f.wrapU=b.Texture.WRAP_ADDRESSMODE,f.wrapV=b.Texture.WRAP_ADDRESSMODE,f},d.FurifyMesh=function(a,e){var f,c=[a],h=a.material;if(!(h instanceof d))throw"The material of the source mesh must be a Fur Material";for(f=1;f<e;f++){var k=new d(h.name+f,a.getScene());a.getScene().materials.pop(),b.Tags.EnableFor(k),b.Tags.AddTagsTo(k,"furShellMaterial"),k.furLength=h.furLength,k.furAngle=h.furAngle,k.furGravity=h.furGravity,k.furSpacing=h.furSpacing,k.furSpeed=h.furSpeed,k.furColor=h.furColor,k.diffuseTexture=h.diffuseTexture,k.furOffset=f/e,k.furTexture=h.furTexture,k.highLevelFur=h.highLevelFur,k.furTime=h.furTime,k.furDensity=h.furDensity;var n=a.clone(a.name+f);n.material=k,n.skeleton=a.skeleton,n.position=b.Vector3.Zero(),c.push(n)}for(f=1;f<c.length;f++)c[f].parent=a;return a.material._meshes=c,c},Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),Object(g.a)([Object(b.serializeAsTexture)("heightTexture")],d.prototype,"_heightTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"heightTexture",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"furLength",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"furAngle",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"furColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"furOffset",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"furSpacing",void 0),Object(g.a)([Object(b.serializeAsVector3)()],d.prototype,"furGravity",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"furSpeed",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"furDensity",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"furOcclusion",void 0),Object(g.a)([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),Object(g.a)([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"highLevelFur",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"furTime",null),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.FurMaterial"]=o,i.d(m,"FurMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]

#ifdef DIFFUSE
varying vec2 vTextureUV;
uniform sampler2D textureSampler;
uniform vec2 vTextureInfos;
uniform sampler2D diffuse1Sampler;
uniform sampler2D diffuse2Sampler;
uniform sampler2D diffuse3Sampler;
uniform vec2 diffuse1Infos;
uniform vec2 diffuse2Infos;
uniform vec2 diffuse3Infos;
#endif
#ifdef BUMP
uniform sampler2D bump1Sampler;
uniform sampler2D bump2Sampler;
uniform sampler2D bump3Sampler;
#endif

#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>

#ifdef BUMP
#extension GL_OES_standard_derivatives : enable

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{

vec3 dp1=dFdx(p);
vec3 dp2=dFdy(p);
vec2 duv1=dFdx(uv);
vec2 duv2=dFdy(uv);

vec3 dp2perp=cross(dp2,normal);
vec3 dp1perp=cross(normal,dp1);
vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;
vec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;

float invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));
return mat3(tangent*invmax,binormal*invmax,normal);
}
vec3 perturbNormal(vec3 viewDir,vec3 mixColor)
{
vec3 bump1Color=texture2D(bump1Sampler,vTextureUV*diffuse1Infos).xyz;
vec3 bump2Color=texture2D(bump2Sampler,vTextureUV*diffuse2Infos).xyz;
vec3 bump3Color=texture2D(bump3Sampler,vTextureUV*diffuse3Infos).xyz;
bump1Color.rgb*=mixColor.r;
bump2Color.rgb=mix(bump1Color.rgb,bump2Color.rgb,mixColor.g);
vec3 map=mix(bump2Color.rgb,bump3Color.rgb,mixColor.b);
map=map*255./127.-128./127.;
mat3 TBN=cotangent_frame(vNormalW*vTextureInfos.y,-viewDir,vTextureUV);
return normalize(TBN*map);
}
#endif
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef DIFFUSE
baseColor=texture2D(textureSampler,vTextureUV);
#if defined(BUMP) && defined(DIFFUSE)
normalW=perturbNormal(viewDirectionW,baseColor.rgb);
#endif
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vTextureInfos.y;
vec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);
vec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);
vec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);
diffuse1Color.rgb*=baseColor.r;
diffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,baseColor.g);
baseColor.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,baseColor.b);
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor*baseColor.rgb,0.0,1.0);

vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.terrainPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vTextureUV;
uniform mat4 textureMatrix;
uniform vec2 vTextureInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
gl_Position=viewProjection*worldPos;
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vTextureInfos.x == 0.)
{
vTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));
}
else
{
vTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.terrainVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.BUMP=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.SPECULARTERM=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f.specularColor=new b.Color3(0,0,0),f.specularPower=64,f._disableLighting=!1,f._maxSimultaneousLights=4,f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(h.texturesEnabled){if(!this.mixTexture||!this.mixTexture.isReady())return!1;if(c._needUVs=!0,b.MaterialFlags.DiffuseTextureEnabled){if(!this.diffuseTexture1||!this.diffuseTexture1.isReady())return!1;if(!this.diffuseTexture2||!this.diffuseTexture2.isReady())return!1;if(!this.diffuseTexture3||!this.diffuseTexture3.isReady())return!1;c.DIFFUSE=!0}if(this.bumpTexture1&&this.bumpTexture2&&this.bumpTexture3&&b.MaterialFlags.BumpTextureEnabled){if(!this.bumpTexture1.isReady())return!1;if(!this.bumpTexture2.isReady())return!1;if(!this.bumpTexture3.isReady())return!1;c._needNormals=!0,c.BUMP=!0}}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos"],s=["textureSampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","bump1Sampler","bump2Sampler","bump3Sampler"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("terrain",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this.mixTexture&&(this._activeEffect.setTexture("textureSampler",this._mixTexture),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture.coordinatesIndex,this._mixTexture.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture.getTextureMatrix()),b.MaterialFlags.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale))),b.MaterialFlags.BumpTextureEnabled&&c.getEngine().getCaps().standardDerivatives&&(this._bumpTexture1&&this._activeEffect.setTexture("bump1Sampler",this._bumpTexture1),this._bumpTexture2&&this._activeEffect.setTexture("bump2Sampler",this._bumpTexture2),this._bumpTexture3&&this._activeEffect.setTexture("bump3Sampler",this._bumpTexture3))),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),h.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&a.push(this.mixTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._mixTexture&&a.push(this._mixTexture),this._diffuseTexture1&&a.push(this._diffuseTexture1),this._diffuseTexture2&&a.push(this._diffuseTexture2),this._diffuseTexture3&&a.push(this._diffuseTexture3),this._bumpTexture1&&a.push(this._bumpTexture1),this._bumpTexture2&&a.push(this._bumpTexture2),this._bumpTexture3&&a.push(this._bumpTexture3),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||(this._mixTexture===a||(this._diffuseTexture1===a||(this._diffuseTexture2===a||(this._diffuseTexture3===a||(this._bumpTexture1===a||(this._bumpTexture2===a||this._bumpTexture3===a))))))},d.prototype.dispose=function(a){this.mixTexture&&this.mixTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.TerrainMaterial",a},d.prototype.getClassName=function(){return"TerrainMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},Object(g.a)([Object(b.serializeAsTexture)("mixTexture")],d.prototype,"_mixTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"mixTexture",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture1")],d.prototype,"_diffuseTexture1",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture1",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture2")],d.prototype,"_diffuseTexture2",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture2",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture3")],d.prototype,"_diffuseTexture3",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture3",void 0),Object(g.a)([Object(b.serializeAsTexture)("bumpTexture1")],d.prototype,"_bumpTexture1",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture1",void 0),Object(g.a)([Object(b.serializeAsTexture)("bumpTexture2")],d.prototype,"_bumpTexture2",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture2",void 0),Object(g.a)([Object(b.serializeAsTexture)("bumpTexture3")],d.prototype,"_bumpTexture3",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture3",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"specularColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"specularPower",void 0),Object(g.a)([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),Object(g.a)([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.TerrainMaterial"]=o,i.d(m,"TerrainMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;

uniform vec4 topColor;
uniform vec4 bottomColor;
uniform float offset;
uniform float scale;
uniform float smoothness;

varying vec3 vPositionW;
varying vec3 vPosition;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0]
#include<__decl__lightFragment>[1]
#include<__decl__lightFragment>[2]
#include<__decl__lightFragment>[3]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);
float h=vPosition.y*scale+offset;
float mysmoothness=clamp(smoothness,0.01,max(smoothness,10.));
vec4 baseColor=mix(bottomColor,topColor,max(pow(max(h,0.0),mysmoothness),0.0));

vec3 diffuseColor=baseColor.rgb;

float alpha=baseColor.a;
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif

#ifdef EMISSIVE
vec3 diffuseBase=baseColor.rgb;
#else
vec3 diffuseBase=vec3(0.,0.,0.);
#endif
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;

vec4 color=vec4(finalDiffuse,alpha);
#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.gradientPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
varying vec3 vPosition;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
gl_Position=viewProjection*worldPos;
vPositionW=vec3(worldPos);
vPosition=position;
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.gradientVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.EMISSIVE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f._maxSimultaneousLights=4,f.topColor=new b.Color3(1,0,0),f.topColorAlpha=1,f.bottomColor=new b.Color3(0,0,1),f.bottomColorAlpha=1,f.offset=0,f.scale=1,f.smoothness=1,f._disableLighting=!1,f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1||this.topColorAlpha<1||this.bottomColorAlpha<1},d.prototype.needAlphaTesting=function(){return!0},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),c.EMISSIVE=this._disableLighting,b.MaterialHelper.PrepareDefinesForAttributes(a,c,!1,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","topColor","bottomColor","offset","smoothness","scale"],s=[],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:4}),e.setEffect(h.getEngine().createEffect("gradient",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,k),this._mustRebind(c,k)&&(b.MaterialHelper.BindClipPlane(k,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._activeEffect.setColor4("topColor",this.topColor,this.topColorAlpha),this._activeEffect.setColor4("bottomColor",this.bottomColor,this.bottomColorAlpha),this._activeEffect.setFloat("offset",this.offset),this._activeEffect.setFloat("scale",this.scale),this._activeEffect.setFloat("smoothness",this.smoothness),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){return[]},d.prototype.dispose=function(a){j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.GradientMaterial",a},d.prototype.getClassName=function(){return"GradientMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},Object(g.a)([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"topColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"topColorAlpha",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"bottomColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"bottomColorAlpha",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"offset",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"scale",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"smoothness",void 0),Object(g.a)([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.GradientMaterial"]=o,i.d(m,"GradientMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>

vec3 computeCustomDiffuseLighting(lightingInfo info,vec3 diffuseBase,float shadow)
{
diffuseBase=info.diffuse*shadow;
#ifdef CELLBASIC
float level=1.0;
if (info.ndl<0.5)
level=0.5;
diffuseBase.rgb*vec3(level,level,level);
#else
float ToonThresholds[4];
ToonThresholds[0]=0.95;
ToonThresholds[1]=0.5;
ToonThresholds[2]=0.2;
ToonThresholds[3]=0.03;
float ToonBrightnessLevels[5];
ToonBrightnessLevels[0]=1.0;
ToonBrightnessLevels[1]=0.8;
ToonBrightnessLevels[2]=0.6;
ToonBrightnessLevels[3]=0.35;
ToonBrightnessLevels[4]=0.2;
if (info.ndl>ToonThresholds[0])
{
diffuseBase.rgb*=ToonBrightnessLevels[0];
}
else if (info.ndl>ToonThresholds[1])
{
diffuseBase.rgb*=ToonBrightnessLevels[1];
}
else if (info.ndl>ToonThresholds[2])
{
diffuseBase.rgb*=ToonBrightnessLevels[2];
}
else if (info.ndl>ToonThresholds[3])
{
diffuseBase.rgb*=ToonBrightnessLevels[3];
}
else
{
diffuseBase.rgb*=ToonBrightnessLevels[4];
}
#endif
return max(diffuseBase,vec3(0.2));
}
void main(void)
{
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif

lightingInfo info;
vec3 diffuseBase=vec3(0.,0.,0.);
float shadow=1.;
float glossiness=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;

vec4 color=vec4(finalDiffuse,alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.cellPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
gl_Position=viewProjection*worldPos;
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.cellVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.NDOTL=!0,a.CUSTOMUSERLIGHTING=!0,a.CELLBASIC=!0,a.DEPTHPREPASS=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f._computeHighLevel=!1,f._disableLighting=!1,f._maxSimultaneousLights=4,f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled&&this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(c.CELLBASIC=!this.computeHighLevel,b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],s=["diffuseSampler"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("cell",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights-1}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this._maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&a.push(this._diffuseTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||this._diffuseTexture===a},d.prototype.dispose=function(a){this._diffuseTexture&&this._diffuseTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.getClassName=function(){return"CellMaterial"},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.CellMaterial",a},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),Object(g.a)([Object(b.serializeAsColor3)("diffuse")],d.prototype,"diffuseColor",void 0),Object(g.a)([Object(b.serialize)("computeHighLevel")],d.prototype,"_computeHighLevel",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"computeHighLevel",void 0),Object(g.a)([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),Object(g.a)([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.CellMaterial"]=o,i.d(m,"CellMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`#extension GL_OES_standard_derivatives : enable
#define SQRT2 1.41421356
#define PI 3.14159
precision highp float;
uniform vec3 mainColor;
uniform vec3 lineColor;
uniform vec4 gridControl;
uniform vec3 gridOffset;

varying vec3 vPosition;
varying vec3 vNormal;
#include<fogFragmentDeclaration>

#ifdef OPACITY
varying vec2 vOpacityUV;
uniform sampler2D opacitySampler;
uniform vec2 vOpacityInfos;
#endif
float getVisibility(float position) {

float majorGridFrequency=gridControl.y;
if (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)
{
return 1.0;
}
return gridControl.z;
}
float getAnisotropicAttenuation(float differentialLength) {
const float maxNumberOfLines=10.0;
return clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);
}
float isPointOnLine(float position,float differentialLength) {
float fractionPartOfPosition=position-floor(position+0.5);
fractionPartOfPosition/=differentialLength;
fractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);
float result=0.5+0.5*cos(fractionPartOfPosition*PI);
return result;
}
float contributionOnAxis(float position) {
float differentialLength=length(vec2(dFdx(position),dFdy(position)));
differentialLength*=SQRT2;

float result=isPointOnLine(position,differentialLength);

float visibility=getVisibility(position);
result*=visibility;

float anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);
result*=anisotropicAttenuation;
return result;
}
float normalImpactOnAxis(float x) {
float normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);
return normalImpact;
}
void main(void) {

float gridRatio=gridControl.x;
vec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;

float x=contributionOnAxis(gridPos.x);
float y=contributionOnAxis(gridPos.y);
float z=contributionOnAxis(gridPos.z);

vec3 normal=normalize(vNormal);
x*=normalImpactOnAxis(normal.x);
y*=normalImpactOnAxis(normal.y);
z*=normalImpactOnAxis(normal.z);

float grid=clamp(x+y+z,0.,1.);

vec3 color=mix(mainColor,lineColor,grid);
#ifdef FOG
#include<fogFragment>
#endif
float opacity=1.0;
#ifdef TRANSPARENT
opacity=clamp(grid,0.08,gridControl.w*grid);
#endif
#ifdef OPACITY
opacity*=texture2D(opacitySampler,vOpacityUV).a;
#endif

gl_FragColor=vec4(color.rgb,opacity);
#ifdef TRANSPARENT
#ifdef PREMULTIPLYALPHA
gl_FragColor.rgb*=opacity;
#endif
#else
#endif
}`;b.Effect.ShadersStore.gridPixelShader=t;var p=`precision highp float;

attribute vec3 position;
attribute vec3 normal;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#include<instancesDeclaration>

uniform mat4 projection;
uniform mat4 view;

varying vec3 vPosition;
varying vec3 vNormal;
#include<fogVertexDeclaration>
#ifdef OPACITY
varying vec2 vOpacityUV;
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
void main(void) {
#include<instancesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
#include<fogVertex>
vec4 cameraSpacePosition=view*worldPos;
gl_Position=projection*cameraSpacePosition;
#ifdef OPACITY
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
vPosition=position;
vNormal=normal;
}`;b.Effect.ShadersStore.gridVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.OPACITY=!1,a.TRANSPARENT=!1,a.FOG=!1,a.PREMULTIPLYALPHA=!1,a.UV1=!1,a.UV2=!1,a.INSTANCES=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.mainColor=b.Color3.Black(),f.lineColor=b.Color3.Teal(),f.gridRatio=1,f.gridOffset=b.Vector3.Zero(),f.majorUnitFrequency=10,f.minorUnitVisibility=.33,f.opacity=1,f.preMultiplyAlpha=!1,f._gridControl=new b.Vector4(f.gridRatio,f.majorUnitFrequency,f.minorUnitVisibility,f.opacity),f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return this.opacity<1||this._opacityTexture&&this._opacityTexture.isReady()},d.prototype.needAlphaBlendingForMesh=function(a){return this.needAlphaBlending()},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;if(c.TRANSPARENT!==this.opacity<1&&(c.TRANSPARENT=!c.TRANSPARENT,c.markAsUnprocessed()),c.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(c.PREMULTIPLYALPHA=!c.PREMULTIPLYALPHA,c.markAsUnprocessed()),c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled&&this._opacityTexture&&b.MaterialFlags.OpacityTextureEnabled)){if(!this._opacityTexture.isReady())return!1;c._needUVs=!0,c.OPACITY=!0}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,!1,this.fogEnabled,!1,c),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,h.getEngine(),c,!!f),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial(),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!1,!1);var k=[b.VertexBuffer.PositionKind,b.VertexBuffer.NormalKind];c.UV1&&k.push(b.VertexBuffer.UVKind),c.UV2&&k.push(b.VertexBuffer.UV2Kind),b.MaterialHelper.PrepareAttributesForInstances(k,c);var n=c.toString();e.setEffect(h.getEngine().createEffect("grid",k,["projection","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view","opacityMatrix","vOpacityInfos"],["opacitySampler"],n,void 0,this.onCompiled,this.onError),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,h.INSTANCES||this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("view",c.getViewMatrix()),this._activeEffect.setMatrix("projection",c.getProjectionMatrix()),this._mustRebind(c,k)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl),this._opacityTexture&&b.MaterialFlags.OpacityTextureEnabled&&(this._activeEffect.setTexture("opacitySampler",this._opacityTexture),this._activeEffect.setFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._activeEffect.setMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix()))),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.dispose=function(a){j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.GridMaterial",a},d.prototype.getClassName=function(){return"GridMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"mainColor",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"lineColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"gridRatio",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"gridOffset",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"majorUnitFrequency",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"minorUnitVisibility",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"opacity",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"preMultiplyAlpha",void 0),Object(g.a)([Object(b.serializeAsTexture)("opacityTexture")],d.prototype,"_opacityTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"opacityTexture",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.GridMaterial"]=o,i.d(m,"GridMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;

vec4 color=vec4(finalDiffuse,alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.simplePixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
gl_Position=viewProjection*worldPos;
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.simpleVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f._disableLighting=!1,f._maxSimultaneousLights=4,f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled&&this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],s=["diffuseSampler"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("simple",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights-1}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&a.push(this._diffuseTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||this.diffuseTexture===a},d.prototype.dispose=function(a){this._diffuseTexture&&this._diffuseTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.SimpleMaterial",a},d.prototype.getClassName=function(){return"SimpleMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),Object(g.a)([Object(b.serializeAsColor3)("diffuse")],d.prototype,"diffuseColor",void 0),Object(g.a)([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),Object(g.a)([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.SimpleMaterial"]=o,i.d(m,"SimpleMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;

varying vec3 vPositionW;

uniform float time;
uniform float speed;
uniform float movingSpeed;
uniform vec3 fogColor;
uniform sampler2D noiseTexture;
uniform float fogDensity;

varying float noise;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0]
#include<__decl__lightFragment>[1]
#include<__decl__lightFragment>[2]
#include<__decl__lightFragment>[3]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
float random( vec3 scale,float seed ){
return fract( sin( dot( gl_FragCoord.xyz+seed,scale ) )*43758.5453+seed ) ;
}
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef DIFFUSE

vec4 noiseTex=texture2D( noiseTexture,vDiffuseUV );
vec2 T1=vDiffuseUV+vec2( 1.5,-1.5 )*time*0.02;
vec2 T2=vDiffuseUV+vec2( -0.5,2.0 )*time*0.01*speed;
T1.x+=noiseTex.x*2.0;
T1.y+=noiseTex.y*2.0;
T2.x-=noiseTex.y*0.2+time*0.001*movingSpeed;
T2.y+=noiseTex.z*0.2+time*0.002*movingSpeed;
float p=texture2D( noiseTexture,T1*3.0 ).a;
vec4 lavaColor=texture2D( diffuseSampler,T2*4.0);
vec4 temp=lavaColor*( vec4( p,p,p,p )*2. )+( lavaColor*lavaColor-0.1 );
baseColor=temp;
float depth=gl_FragCoord.z*4.0;
const float LOG2=1.442695;
float fogFactor=exp2(-fogDensity*fogDensity*depth*depth*LOG2 );
fogFactor=1.0-clamp( fogFactor,0.0,1.0 );
baseColor=mix( baseColor,vec4( fogColor,baseColor.w ),fogFactor );
diffuseColor=baseColor.rgb;


#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef UNLIT
vec3 diffuseBase=vec3(1.,1.,1.);
#else

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#include<lightFragment>[0]
#include<lightFragment>[1]
#include<lightFragment>[2]
#include<lightFragment>[3]
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;

vec4 color=vec4(finalDiffuse,alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.lavaPixelShader=t;var p=`precision highp float;

uniform float time;
uniform float lowFrequencySpeed;

varying float noise;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]



vec3 mod289(vec3 x)
{
return x-floor(x*(1.0/289.0))*289.0;
}
vec4 mod289(vec4 x)
{
return x-floor(x*(1.0/289.0))*289.0;
}
vec4 permute(vec4 x)
{
return mod289(((x*34.0)+1.0)*x);
}
vec4 taylorInvSqrt(vec4 r)
{
return 1.79284291400159-0.85373472095314*r;
}
vec3 fade(vec3 t) {
return t*t*t*(t*(t*6.0-15.0)+10.0);
}

float pnoise(vec3 P,vec3 rep)
{
vec3 Pi0=mod(floor(P),rep);
vec3 Pi1=mod(Pi0+vec3(1.0),rep);
Pi0=mod289(Pi0);
Pi1=mod289(Pi1);
vec3 Pf0=fract(P);
vec3 Pf1=Pf0-vec3(1.0);
vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);
vec4 iy=vec4(Pi0.yy,Pi1.yy);
vec4 iz0=Pi0.zzzz;
vec4 iz1=Pi1.zzzz;
vec4 ixy=permute(permute(ix)+iy);
vec4 ixy0=permute(ixy+iz0);
vec4 ixy1=permute(ixy+iz1);
vec4 gx0=ixy0*(1.0/7.0);
vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;
gx0=fract(gx0);
vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);
vec4 sz0=step(gz0,vec4(0.0));
gx0-=sz0*(step(0.0,gx0)-0.5);
gy0-=sz0*(step(0.0,gy0)-0.5);
vec4 gx1=ixy1*(1.0/7.0);
vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;
gx1=fract(gx1);
vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);
vec4 sz1=step(gz1,vec4(0.0));
gx1-=sz1*(step(0.0,gx1)-0.5);
gy1-=sz1*(step(0.0,gy1)-0.5);
vec3 g000=vec3(gx0.x,gy0.x,gz0.x);
vec3 g100=vec3(gx0.y,gy0.y,gz0.y);
vec3 g010=vec3(gx0.z,gy0.z,gz0.z);
vec3 g110=vec3(gx0.w,gy0.w,gz0.w);
vec3 g001=vec3(gx1.x,gy1.x,gz1.x);
vec3 g101=vec3(gx1.y,gy1.y,gz1.y);
vec3 g011=vec3(gx1.z,gy1.z,gz1.z);
vec3 g111=vec3(gx1.w,gy1.w,gz1.w);
vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));
g000*=norm0.x;
g010*=norm0.y;
g100*=norm0.z;
g110*=norm0.w;
vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));
g001*=norm1.x;
g011*=norm1.y;
g101*=norm1.z;
g111*=norm1.w;
float n000=dot(g000,Pf0);
float n100=dot(g100,vec3(Pf1.x,Pf0.yz));
float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));
float n110=dot(g110,vec3(Pf1.xy,Pf0.z));
float n001=dot(g001,vec3(Pf0.xy,Pf1.z));
float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));
float n011=dot(g011,vec3(Pf0.x,Pf1.yz));
float n111=dot(g111,Pf1);
vec3 fade_xyz=fade(Pf0);
vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);
vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);
float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);
return 2.2*n_xyz;
}

float turbulence( vec3 p ) {
float w=100.0;
float t=-.5;
for (float f=1.0 ; f<=10.0 ; f++ ){
float power=pow( 2.0,f );
t+=abs( pnoise( vec3( power*p ),vec3( 10.0,10.0,10.0 ) )/power );
}
return t;
}
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
#ifdef NORMAL

noise=10.0*-.10*turbulence( .5*normal+time*1.15 );

float b=lowFrequencySpeed*5.0*pnoise( 0.05*position +vec3(time*1.025),vec3( 100.0 ) );

float displacement =-1.5*noise+b;

vec3 newPosition=position+normal*displacement;
gl_Position=viewProjection*finalWorld*vec4( newPosition,1.0 );
vec4 worldPos=finalWorld*vec4(newPosition,1.0);
vPositionW=vec3(worldPos);
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}`;b.Effect.ShadersStore.lavaVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.LIGHT0=!1,a.LIGHT1=!1,a.LIGHT2=!1,a.LIGHT3=!1,a.SPOTLIGHT0=!1,a.SPOTLIGHT1=!1,a.SPOTLIGHT2=!1,a.SPOTLIGHT3=!1,a.HEMILIGHT0=!1,a.HEMILIGHT1=!1,a.HEMILIGHT2=!1,a.HEMILIGHT3=!1,a.DIRLIGHT0=!1,a.DIRLIGHT1=!1,a.DIRLIGHT2=!1,a.DIRLIGHT3=!1,a.POINTLIGHT0=!1,a.POINTLIGHT1=!1,a.POINTLIGHT2=!1,a.POINTLIGHT3=!1,a.SHADOW0=!1,a.SHADOW1=!1,a.SHADOW2=!1,a.SHADOW3=!1,a.SHADOWS=!1,a.SHADOWESM0=!1,a.SHADOWESM1=!1,a.SHADOWESM2=!1,a.SHADOWESM3=!1,a.SHADOWPOISSON0=!1,a.SHADOWPOISSON1=!1,a.SHADOWPOISSON2=!1,a.SHADOWPOISSON3=!1,a.SHADOWPCF0=!1,a.SHADOWPCF1=!1,a.SHADOWPCF2=!1,a.SHADOWPCF3=!1,a.SHADOWPCSS0=!1,a.SHADOWPCSS1=!1,a.SHADOWPCSS2=!1,a.SHADOWPCSS3=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.UNLIT=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.speed=1,f.movingSpeed=1,f.lowFrequencySpeed=1,f.fogDensity=.15,f._lastTime=0,f.diffuseColor=new b.Color3(1,1,1),f._disableLighting=!1,f._unlit=!1,f._maxSimultaneousLights=4,f._scaledDiffuse=new b.Color3(),f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled&&this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=!0,b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","time","speed","movingSpeed","fogColor","fogDensity","lowFrequencySpeed"],s=["diffuseSampler","noiseTexture"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("lava",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,h.UNLIT=this._unlit,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this.diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.noiseTexture&&this._activeEffect.setTexture("noiseTexture",this.noiseTexture),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*e.visibility),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._lastTime+=c.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime*this.speed/1000),this.fogColor||(this.fogColor=b.Color3.Black()),this._activeEffect.setColor3("fogColor",this.fogColor),this._activeEffect.setFloat("fogDensity",this.fogDensity),this._activeEffect.setFloat("lowFrequencySpeed",this.lowFrequencySpeed),this._activeEffect.setFloat("movingSpeed",this.movingSpeed),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&a.push(this.diffuseTexture),this.noiseTexture&&this.noiseTexture.animations&&this.noiseTexture.animations.length>0&&a.push(this.noiseTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||this.diffuseTexture===a},d.prototype.dispose=function(a){this.diffuseTexture&&this.diffuseTexture.dispose(),this.noiseTexture&&this.noiseTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.LavaMaterial",a},d.prototype.getClassName=function(){return"LavaMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),Object(g.a)([Object(b.serializeAsTexture)()],d.prototype,"noiseTexture",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"fogColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"speed",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"movingSpeed",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"lowFrequencySpeed",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"fogDensity",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),Object(g.a)([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),Object(g.a)([Object(b.serialize)("unlit")],d.prototype,"_unlit",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"unlit",void 0),Object(g.a)([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.LavaMaterial"]=o,i.d(m,"LavaMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform float alpha;
uniform vec3 shadowColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#include<lightFragment>[0..1]

vec4 color=vec4(shadowColor,(1.0-clamp(shadow,0.,1.))*alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.shadowOnlyPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
gl_Position=viewProjection*worldPos;
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.shadowOnlyVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.shadowColor=b.Color3.Black(),f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return!0},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},Object.defineProperty(d.prototype,"activeLight",{get:function(){return this._activeLight},set:function(a){this._activeLight=a},enumerable:!0,configurable:!0}),d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(this._activeLight)for(var n=0,l=a.lightSources;n<l.length;n++){var r=l[n];if(r.shadowEnabled){if(this._activeLight===r)break;var u=a.lightSources.indexOf(this._activeLight);-1!==u&&(a.lightSources.splice(u,1),a.lightSources.splice(0,0,this._activeLight));break}}if(b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,1),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!1,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var s=new b.EffectFallbacks();c.FOG&&s.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,s,1),c.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,a);var v=[b.VertexBuffer.PositionKind];c.NORMAL&&v.push(b.VertexBuffer.NormalKind),b.MaterialHelper.PrepareAttributesForBones(v,a,c,s),b.MaterialHelper.PrepareAttributesForInstances(v,c);var x=c.toString(),y=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","alpha","shadowColor","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6"],z=new Array(),E=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:y,uniformBuffersNames:E,samplers:z,defines:c,maxSimultaneousLights:1}),e.setEffect(h.getEngine().createEffect("shadowOnly",{attributes:v,uniformsNames:y,uniformBuffersNames:E,samplers:z,defines:x,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:1}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._activeEffect.setFloat("alpha",this.alpha),this._activeEffect.setColor3("shadowColor",this.shadowColor),b.MaterialHelper.BindEyePosition(k,c)),c.lightsEnabled&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,1),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.ShadowOnlyMaterial",a},d.prototype.getClassName=function(){return"ShadowOnlyMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.ShadowOnlyMaterial"]=o,i.d(m,"ShadowOnlyMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]

#ifdef DIFFUSE
varying vec2 vTextureUV;
uniform sampler2D mixMap1Sampler;
uniform vec2 vTextureInfos;
#ifdef MIXMAP2
uniform sampler2D mixMap2Sampler;
#endif
uniform sampler2D diffuse1Sampler;
uniform sampler2D diffuse2Sampler;
uniform sampler2D diffuse3Sampler;
uniform sampler2D diffuse4Sampler;
uniform vec2 diffuse1Infos;
uniform vec2 diffuse2Infos;
uniform vec2 diffuse3Infos;
uniform vec2 diffuse4Infos;
#ifdef MIXMAP2
uniform sampler2D diffuse5Sampler;
uniform sampler2D diffuse6Sampler;
uniform sampler2D diffuse7Sampler;
uniform sampler2D diffuse8Sampler;
uniform vec2 diffuse5Infos;
uniform vec2 diffuse6Infos;
uniform vec2 diffuse7Infos;
uniform vec2 diffuse8Infos;
#endif
#endif

#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 finalMixColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;
#ifdef MIXMAP2
vec4 mixColor2=vec4(1.,1.,1.,1.);
#endif
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef DIFFUSE
vec4 mixColor=texture2D(mixMap1Sampler,vTextureUV);
#include<depthPrePass>
mixColor.rgb*=vTextureInfos.y;
vec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);
vec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);
vec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);
vec4 diffuse4Color=texture2D(diffuse4Sampler,vTextureUV*diffuse4Infos);
diffuse1Color.rgb*=mixColor.r;
diffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,mixColor.g);
diffuse3Color.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,mixColor.b);
finalMixColor.rgb=mix(diffuse3Color.rgb,diffuse4Color.rgb,1.0-mixColor.a);
#ifdef MIXMAP2
mixColor=texture2D(mixMap2Sampler,vTextureUV);
mixColor.rgb*=vTextureInfos.y;
vec4 diffuse5Color=texture2D(diffuse5Sampler,vTextureUV*diffuse5Infos);
vec4 diffuse6Color=texture2D(diffuse6Sampler,vTextureUV*diffuse6Infos);
vec4 diffuse7Color=texture2D(diffuse7Sampler,vTextureUV*diffuse7Infos);
vec4 diffuse8Color=texture2D(diffuse8Sampler,vTextureUV*diffuse8Infos);
diffuse5Color.rgb=mix(finalMixColor.rgb,diffuse5Color.rgb,mixColor.r);
diffuse6Color.rgb=mix(diffuse5Color.rgb,diffuse6Color.rgb,mixColor.g);
diffuse7Color.rgb=mix(diffuse6Color.rgb,diffuse7Color.rgb,mixColor.b);
finalMixColor.rgb=mix(diffuse7Color.rgb,diffuse8Color.rgb,1.0-mixColor.a);
#endif
#endif
#ifdef VERTEXCOLOR
finalMixColor.rgb*=vColor.rgb;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor*finalMixColor.rgb,0.0,1.0);

vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.mixPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vTextureUV;
uniform mat4 textureMatrix;
uniform vec2 vTextureInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
gl_Position=viewProjection*worldPos;
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vTextureInfos.x == 0.)
{
vTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));
}
else
{
vTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.mixVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.SPECULARTERM=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.MIXMAP2=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f.specularColor=new b.Color3(0,0,0),f.specularPower=64,f._disableLighting=!1,f._maxSimultaneousLights=4,f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(h.texturesEnabled){if(!this._mixTexture1||!this._mixTexture1.isReady())return!1;if(c._needUVs=!0,b.MaterialFlags.DiffuseTextureEnabled){if(!this._diffuseTexture1||!this._diffuseTexture1.isReady())return!1;if(c.DIFFUSE=!0,!this._diffuseTexture2||!this._diffuseTexture2.isReady())return!1;if(!this._diffuseTexture3||!this._diffuseTexture3.isReady())return!1;if(!this._diffuseTexture4||!this._diffuseTexture4.isReady())return!1;if(this._mixTexture2){if(!this._mixTexture2.isReady())return!1;if(c.MIXMAP2=!0,!this._diffuseTexture5||!this._diffuseTexture5.isReady())return!1;if(!this._diffuseTexture6||!this._diffuseTexture6.isReady())return!1;if(!this._diffuseTexture7||!this._diffuseTexture7.isReady())return!1;if(!this._diffuseTexture8||!this._diffuseTexture8.isReady())return!1}}}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos","diffuse4Infos","diffuse5Infos","diffuse6Infos","diffuse7Infos","diffuse8Infos"],s=["mixMap1Sampler","mixMap2Sampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","diffuse4Sampler","diffuse5Sampler","diffuse6Sampler","diffuse7Sampler","diffuse8Sampler"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("mix",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this._mixTexture1&&(this._activeEffect.setTexture("mixMap1Sampler",this._mixTexture1),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture1.coordinatesIndex,this._mixTexture1.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture1.getTextureMatrix()),b.MaterialFlags.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale)),this._diffuseTexture4&&(this._activeEffect.setTexture("diffuse4Sampler",this._diffuseTexture4),this._activeEffect.setFloat2("diffuse4Infos",this._diffuseTexture4.uScale,this._diffuseTexture4.vScale)))),this._mixTexture2&&(this._activeEffect.setTexture("mixMap2Sampler",this._mixTexture2),b.MaterialFlags.DiffuseTextureEnabled&&(this._diffuseTexture5&&(this._activeEffect.setTexture("diffuse5Sampler",this._diffuseTexture5),this._activeEffect.setFloat2("diffuse5Infos",this._diffuseTexture5.uScale,this._diffuseTexture5.vScale)),this._diffuseTexture6&&(this._activeEffect.setTexture("diffuse6Sampler",this._diffuseTexture6),this._activeEffect.setFloat2("diffuse6Infos",this._diffuseTexture6.uScale,this._diffuseTexture6.vScale)),this._diffuseTexture7&&(this._activeEffect.setTexture("diffuse7Sampler",this._diffuseTexture7),this._activeEffect.setFloat2("diffuse7Infos",this._diffuseTexture7.uScale,this._diffuseTexture7.vScale)),this._diffuseTexture8&&(this._activeEffect.setTexture("diffuse8Sampler",this._diffuseTexture8),this._activeEffect.setFloat2("diffuse8Infos",this._diffuseTexture8.uScale,this._diffuseTexture8.vScale)))),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),h.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this._mixTexture1&&this._mixTexture1.animations&&this._mixTexture1.animations.length>0&&a.push(this._mixTexture1),this._mixTexture2&&this._mixTexture2.animations&&this._mixTexture2.animations.length>0&&a.push(this._mixTexture2),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._mixTexture1&&a.push(this._mixTexture1),this._diffuseTexture1&&a.push(this._diffuseTexture1),this._diffuseTexture2&&a.push(this._diffuseTexture2),this._diffuseTexture3&&a.push(this._diffuseTexture3),this._diffuseTexture4&&a.push(this._diffuseTexture4),this._mixTexture2&&a.push(this._mixTexture2),this._diffuseTexture5&&a.push(this._diffuseTexture5),this._diffuseTexture6&&a.push(this._diffuseTexture6),this._diffuseTexture7&&a.push(this._diffuseTexture7),this._diffuseTexture8&&a.push(this._diffuseTexture8),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||(this._mixTexture1===a||(this._diffuseTexture1===a||(this._diffuseTexture2===a||(this._diffuseTexture3===a||(this._diffuseTexture4===a||(this._mixTexture2===a||(this._diffuseTexture5===a||(this._diffuseTexture6===a||(this._diffuseTexture7===a||this._diffuseTexture8===a)))))))))},d.prototype.dispose=function(a){this._mixTexture1&&this._mixTexture1.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.MixMaterial",a},d.prototype.getClassName=function(){return"MixMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},Object(g.a)([Object(b.serializeAsTexture)("mixTexture1")],d.prototype,"_mixTexture1",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"mixTexture1",void 0),Object(g.a)([Object(b.serializeAsTexture)("mixTexture2")],d.prototype,"_mixTexture2",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"mixTexture2",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture1")],d.prototype,"_diffuseTexture1",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture1",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture2")],d.prototype,"_diffuseTexture2",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture2",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture3")],d.prototype,"_diffuseTexture3",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture3",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture4")],d.prototype,"_diffuseTexture4",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture4",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture1")],d.prototype,"_diffuseTexture5",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture5",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture2")],d.prototype,"_diffuseTexture6",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture6",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture3")],d.prototype,"_diffuseTexture7",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture7",void 0),Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture4")],d.prototype,"_diffuseTexture8",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture8",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"specularColor",void 0),Object(g.a)([Object(b.serialize)()],d.prototype,"specularPower",void 0),Object(g.a)([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),Object(g.a)([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.MixMaterial"]=o,i.d(m,"MixMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef LIGHTING

#include<helperFunctions>

#include<__decl__lightFragment>[0]
#include<__decl__lightFragment>[1]
#include<__decl__lightFragment>[2]
#include<__decl__lightFragment>[3]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#endif

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef NORMAL
baseColor=mix(baseColor,vec4(vNormalW,1.0),0.5);
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif

#ifdef LIGHTING
vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#include<lightFragment>[0]
#include<lightFragment>[1]
#include<lightFragment>[2]
#include<lightFragment>[3]
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=baseColor.rgb;
#endif

vec4 color=vec4(finalDiffuse,alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.normalPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
gl_Position=viewProjection*worldPos;
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.normalVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.CLIPPLANE5=!1,a.CLIPPLANE6=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.LIGHT0=!1,a.LIGHT1=!1,a.LIGHT2=!1,a.LIGHT3=!1,a.SPOTLIGHT0=!1,a.SPOTLIGHT1=!1,a.SPOTLIGHT2=!1,a.SPOTLIGHT3=!1,a.HEMILIGHT0=!1,a.HEMILIGHT1=!1,a.HEMILIGHT2=!1,a.HEMILIGHT3=!1,a.DIRLIGHT0=!1,a.DIRLIGHT1=!1,a.DIRLIGHT2=!1,a.DIRLIGHT3=!1,a.POINTLIGHT0=!1,a.POINTLIGHT1=!1,a.POINTLIGHT2=!1,a.POINTLIGHT3=!1,a.SHADOW0=!1,a.SHADOW1=!1,a.SHADOW2=!1,a.SHADOW3=!1,a.SHADOWS=!1,a.SHADOWESM0=!1,a.SHADOWESM1=!1,a.SHADOWESM2=!1,a.SHADOWESM3=!1,a.SHADOWPOISSON0=!1,a.SHADOWPOISSON1=!1,a.SHADOWPOISSON2=!1,a.SHADOWPOISSON3=!1,a.SHADOWPCF0=!1,a.SHADOWPCF1=!1,a.SHADOWPCF2=!1,a.SHADOWPCF3=!1,a.SHADOWPCSS0=!1,a.SHADOWPCSS1=!1,a.SHADOWPCSS2=!1,a.SHADOWPCSS3=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.LIGHTING=!1,a.rebuild(),a}return Object(g.b)(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f._disableLighting=!1,f._maxSimultaneousLights=4,f}return Object(g.b)(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaBlendingForMesh=function(a){return this.needAlphaBlending()||a.visibility<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled&&this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=!0,b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),c.LIGHTING=!this._disableLighting,b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],s=["diffuseSampler"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:4}),e.setEffect(h.getEngine().createEffect("normal",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this.diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&a.push(this.diffuseTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||this.diffuseTexture===a},d.prototype.dispose=function(a){this.diffuseTexture&&this.diffuseTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.NormalMaterial",a},d.prototype.getClassName=function(){return"NormalMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},Object(g.a)([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),Object(g.a)([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),Object(g.a)([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),Object(g.a)([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),Object(g.a)([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.NormalMaterial"]=o,i.d(m,"NormalMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=function(){},p=function(){},q=function(d){function a(e,f){var c=d.call(this,e,f)||this;return c.CustomParts=new p(),c.customShaderNameResolve=c.Builder,c.FragmentShader=b.Effect.ShadersStore.defaultPixelShader,c.VertexShader=b.Effect.ShadersStore.defaultVertexShader,c}return Object(g.b)(a,d),a.prototype.AttachAfterBind=function(e,f){for(var c in this._newUniformInstances)"vec2"==(h=c.toString().split("-"))[0]?f.setVector2(h[1],this._newUniformInstances[c]):"vec3"==h[0]?f.setVector3(h[1],this._newUniformInstances[c]):"vec4"==h[0]?f.setVector4(h[1],this._newUniformInstances[c]):"mat4"==h[0]?f.setMatrix(h[1],this._newUniformInstances[c]):"float"==h[0]&&f.setFloat(h[1],this._newUniformInstances[c]);for(var c in this._newSamplerInstances){var h;"sampler2D"==(h=c.toString().split("-"))[0]&&this._newSamplerInstances[c].isReady&&this._newSamplerInstances[c].isReady()&&f.setTexture(h[1],this._newSamplerInstances[c])}},a.prototype.ReviewUniform=function(e,f){if("uniform"==e)for(var c in this._newUniforms)-1==this._customUniform[c].indexOf("sampler")&&f.push(this._newUniforms[c]);if("sampler"==e)for(var c in this._newUniforms)-1!=this._customUniform[c].indexOf("sampler")&&f.push(this._newUniforms[c]);return f},a.prototype.Builder=function(e,f,c,h,k){var n=this;if(this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,a.ShaderIndexer++;var l="custom_"+a.ShaderIndexer;this.ReviewUniform("uniform",f),this.ReviewUniform("sampler",h);var r=this._afterBind.bind(this);return this._afterBind=function(u,s){if(s){n.AttachAfterBind(u,s);try{r(u,s)}catch(v){}}},b.Effect.ShadersStore[l+"VertexShader"]=this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",(this._customUniform?this._customUniform.join(`
`):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.CustomParts.Vertex_MainEnd?this.CustomParts.Vertex_MainEnd:""),b.Effect.ShadersStore[l+"PixelShader"]=this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",(this._customUniform?this._customUniform.join(`
`):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE",this.CustomParts.Fragment_Custom_Diffuse?this.CustomParts.Fragment_Custom_Diffuse:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.CustomParts.Fragment_Before_Lights?this.CustomParts.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.CustomParts.Fragment_Before_Fog?this.CustomParts.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:""),this._isCreatedShader=!0,this._createdShaderName=l,l},a.prototype.AddUniform=function(e,f,c){return this._customUniform||(this._customUniform=new Array(),this._newUniforms=new Array(),this._newSamplerInstances=new Array(),this._newUniformInstances=new Array()),c&&(f.indexOf("sampler"),this._newUniformInstances[f+"-"+e]=c),this._customUniform.push("uniform "+f+" "+e+";"),this._newUniforms.push(e),this},a.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},a.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},a.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},a.prototype.Fragment_Custom_Diffuse=function(e){return this.CustomParts.Fragment_Custom_Diffuse=e.replace("result","diffuseColor"),this},a.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},a.prototype.Fragment_Before_Lights=function(e){return this.CustomParts.Fragment_Before_Lights=e,this},a.prototype.Fragment_Before_Fog=function(e){return this.CustomParts.Fragment_Before_Fog=e,this},a.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},a.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},a.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},a.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},a.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},a.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},a.prototype.Vertex_MainEnd=function(e){return this.CustomParts.Vertex_MainEnd=e,this},a.ShaderIndexer=1,a}(b.StandardMaterial);b._TypeStore.RegisteredTypes["BABYLON.CustomMaterial"]=q;var o=function(){},j=function(d){function a(e,f){var c=d.call(this,e,f)||this;return c.CustomParts=new o(),c.customShaderNameResolve=c.Builder,c.FragmentShader=b.Effect.ShadersStore.pbrPixelShader,c.VertexShader=b.Effect.ShadersStore.pbrVertexShader,c}return Object(g.b)(a,d),a.prototype.AttachAfterBind=function(e,f){for(var c in this._newUniformInstances)"vec2"==(h=c.toString().split("-"))[0]?f.setVector2(h[1],this._newUniformInstances[c]):"vec3"==h[0]?f.setVector3(h[1],this._newUniformInstances[c]):"vec4"==h[0]?f.setVector4(h[1],this._newUniformInstances[c]):"mat4"==h[0]?f.setMatrix(h[1],this._newUniformInstances[c]):"float"==h[0]&&f.setFloat(h[1],this._newUniformInstances[c]);for(var c in this._newSamplerInstances){var h;"sampler2D"==(h=c.toString().split("-"))[0]&&this._newSamplerInstances[c].isReady&&this._newSamplerInstances[c].isReady()&&f.setTexture(h[1],this._newSamplerInstances[c])}},a.prototype.ReviewUniform=function(e,f){if("uniform"==e)for(var c in this._newUniforms)-1==this._customUniform[c].indexOf("sampler")&&f.push(this._newUniforms[c]);if("sampler"==e)for(var c in this._newUniforms)-1!=this._customUniform[c].indexOf("sampler")&&f.push(this._newUniforms[c]);return f},a.prototype.Builder=function(e,f,c,h,k){var n=this;if(this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,a.ShaderIndexer++;var l="custom_"+a.ShaderIndexer;this.ReviewUniform("uniform",f),this.ReviewUniform("sampler",h);var r=this._afterBind.bind(this);return this._afterBind=function(u,s){if(s){n.AttachAfterBind(u,s);try{r(u,s)}catch(v){}}},b.Effect.ShadersStore[l+"VertexShader"]=this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",(this._customUniform?this._customUniform.join(`
`):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.CustomParts.Vertex_MainEnd?this.CustomParts.Vertex_MainEnd:""),b.Effect.ShadersStore[l+"PixelShader"]=this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",(this._customUniform?this._customUniform.join(`
`):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.CustomParts.Fragment_Custom_Albedo?this.CustomParts.Fragment_Custom_Albedo:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.CustomParts.Fragment_Before_Lights?this.CustomParts.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.CustomParts.Fragment_Custom_MetallicRoughness?this.CustomParts.Fragment_Custom_MetallicRoughness:"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.CustomParts.Fragment_Custom_MicroSurface?this.CustomParts.Fragment_Custom_MicroSurface:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.CustomParts.Fragment_Before_Fog?this.CustomParts.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:""),this._isCreatedShader=!0,this._createdShaderName=l,l},a.prototype.AddUniform=function(e,f,c){return this._customUniform||(this._customUniform=new Array(),this._newUniforms=new Array(),this._newSamplerInstances=new Array(),this._newUniformInstances=new Array()),c&&(f.indexOf("sampler"),this._newUniformInstances[f+"-"+e]=c),this._customUniform.push("uniform "+f+" "+e+";"),this._newUniforms.push(e),this},a.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},a.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},a.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},a.prototype.Fragment_Custom_Albedo=function(e){return this.CustomParts.Fragment_Custom_Albedo=e.replace("result","surfaceAlbedo"),this},a.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},a.prototype.Fragment_Before_Lights=function(e){return this.CustomParts.Fragment_Before_Lights=e,this},a.prototype.Fragment_Custom_MetallicRoughness=function(e){return this.CustomParts.Fragment_Custom_MetallicRoughness=e,this},a.prototype.Fragment_Custom_MicroSurface=function(e){return this.CustomParts.Fragment_Custom_MicroSurface=e,this},a.prototype.Fragment_Before_Fog=function(e){return this.CustomParts.Fragment_Before_Fog=e,this},a.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},a.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},a.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},a.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},a.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},a.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},a.prototype.Vertex_MainEnd=function(e){return this.CustomParts.Vertex_MainEnd=e,this},a.ShaderIndexer=1,a}(b.PBRMaterial);b._TypeStore.RegisteredTypes["BABYLON.PBRCustomMaterial"]=j,i.d(m,"CustomShaderStructure",function(){return t}),i.d(m,"ShaderSpecialParts",function(){return p}),i.d(m,"CustomMaterial",function(){return q}),i.d(m,"ShaderAlebdoParts",function(){return o}),i.d(m,"PBRCustomMaterial",function(){return j})},function(w,m,i){"use strict";i.r(m);var g=i(10);i.d(m,"CellMaterial",function(){return g.CellMaterial});var b=i(17);i.d(m,"CustomShaderStructure",function(){return b.CustomShaderStructure}),i.d(m,"ShaderSpecialParts",function(){return b.ShaderSpecialParts}),i.d(m,"CustomMaterial",function(){return b.CustomMaterial}),i.d(m,"ShaderAlebdoParts",function(){return b.ShaderAlebdoParts}),i.d(m,"PBRCustomMaterial",function(){return b.PBRCustomMaterial});var t=i(5);i.d(m,"FireMaterial",function(){return t.FireMaterial});var p=i(7);i.d(m,"FurMaterial",function(){return p.FurMaterial});var q=i(9);i.d(m,"GradientMaterial",function(){return q.GradientMaterial});var o=i(11);i.d(m,"GridMaterial",function(){return o.GridMaterial});var j=i(13);i.d(m,"LavaMaterial",function(){return j.LavaMaterial});var d=i(15);i.d(m,"MixMaterial",function(){return d.MixMaterial});var a=i(16);i.d(m,"NormalMaterial",function(){return a.NormalMaterial});var e=i(14);i.d(m,"ShadowOnlyMaterial",function(){return e.ShadowOnlyMaterial});var f=i(12);i.d(m,"SimpleMaterial",function(){return f.SimpleMaterial});var c=i(4);i.d(m,"SkyMaterial",function(){return c.SkyMaterial});var h=i(8);i.d(m,"TerrainMaterial",function(){return h.TerrainMaterial});var k=i(6);i.d(m,"TriPlanarMaterial",function(){return k.TriPlanarMaterial});var n=i(3);i.d(m,"WaterMaterial",function(){return n.WaterMaterial})},function(w,m,i){"use strict";i.r(m),function(g){var b=i(18);i.d(m,"CellMaterial",function(){return b.CellMaterial}),i.d(m,"CustomShaderStructure",function(){return b.CustomShaderStructure}),i.d(m,"ShaderSpecialParts",function(){return b.ShaderSpecialParts}),i.d(m,"CustomMaterial",function(){return b.CustomMaterial}),i.d(m,"ShaderAlebdoParts",function(){return b.ShaderAlebdoParts}),i.d(m,"PBRCustomMaterial",function(){return b.PBRCustomMaterial}),i.d(m,"FireMaterial",function(){return b.FireMaterial}),i.d(m,"FurMaterial",function(){return b.FurMaterial}),i.d(m,"GradientMaterial",function(){return b.GradientMaterial}),i.d(m,"GridMaterial",function(){return b.GridMaterial}),i.d(m,"LavaMaterial",function(){return b.LavaMaterial}),i.d(m,"MixMaterial",function(){return b.MixMaterial}),i.d(m,"NormalMaterial",function(){return b.NormalMaterial}),i.d(m,"ShadowOnlyMaterial",function(){return b.ShadowOnlyMaterial}),i.d(m,"SimpleMaterial",function(){return b.SimpleMaterial}),i.d(m,"SkyMaterial",function(){return b.SkyMaterial}),i.d(m,"TerrainMaterial",function(){return b.TerrainMaterial}),i.d(m,"TriPlanarMaterial",function(){return b.TriPlanarMaterial}),i.d(m,"WaterMaterial",function(){return b.WaterMaterial});var t=void 0!==g?g:"undefined"!=typeof window?window:void 0;if(void 0!==t)for(var p in t.BABYLON=t.BABYLON||{},b)t.BABYLON[p]=b[p]}.call(this,i(2))}])})}};return k$(5)})();
