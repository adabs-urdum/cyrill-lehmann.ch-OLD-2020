(()=>{let f$=Object.hasOwnProperty,h$={},j$,k$=a$=>{let b$=h$[a$];return b$||(b$=h$[a$]={exports:{}},j$[a$](b$.exports,b$)),b$.exports},l$=a$=>{if(a$&&a$.__esModule)return a$;let b$={};for(let c$ in a$)f$.call(a$,c$)&&(b$[c$]=a$[c$]);return b$.default=a$,b$},p$=a$=>l$(k$(a$));j$={76(c,a){var b=a.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=b)},77(e,a){var b={}.hasOwnProperty;a.exports=function(c,d){return b.call(c,d)}},70(c,a){a.exports=function(b){try{return!!b()}catch(e){return!0}}},64(c,b){b.exports=!k$(70)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},58(c,a){var b=a.exports={version:"2.6.10"};typeof __e=="number"&&(__e=b)},87(c,b){b.exports=function(a){return typeof a==="object"?a!==null:typeof a==="function"}},42(e,c){var d=k$(87);c.exports=function(a){if(!d(a))throw TypeError(a+" is not an object!");return a}},65(g,d){var c=k$(87),a=k$(76).document,e=c(a)&&c(a.createElement);d.exports=function(f){return e?a.createElement(f):{}}},80(c,b){b.exports=!k$(64)&&!k$(70)(function(){return Object.defineProperty(k$(65)("div"),"a",{get:function(){return 7}}).a!=7})},155(h,g){var d=k$(87);g.exports=function(a,e){if(!d(a))return a;var b,c;if(e&&typeof(b=a.toString)=="function"&&!d(c=b.call(a)))return c;if(typeof(b=a.valueOf)=="function"&&!d(c=b.call(a)))return c;if(!e&&typeof(b=a.toString)=="function"&&!d(c=b.call(a)))return c;throw TypeError("Can't convert object to primitive value")}},107(f){var e=k$(42),g=k$(80),h=k$(155),i=Object.defineProperty;f.f=k$(64)?Object.defineProperty:function k(c,d,a){e(c),d=h(d,!0),e(a);if(g)try{return i(c,d,a)}catch(l){}if("get"in a||"set"in a)throw TypeError("Accessors not supported!");return"value"in a&&(c[d]=a.value),c}},125(d,b){b.exports=function(a,c){return{enumerable:!(a&1),configurable:!(a&2),writable:!(a&4),value:c}}},78(h,e){var f=k$(107),g=k$(125);e.exports=k$(64)?function(a,c,d){return f.f(a,c,g(1,d))}:function(a,c,d){return a[c]=d,a}},159(e,b){var c=0,d=Math.random();b.exports=function(a){return"Symbol(".concat(a===void 0?"":a,")_",(++c+d).toString(36))}},95(b,a){a.exports=!1},138(i,g){var h=k$(58),b=k$(76),c="__core-js_shared__",d=b[c]||(b[c]={});(g.exports=function(e,f){return d[e]||(d[e]=f!==void 0?f:{})})("versions",[]).push({version:h.version,mode:k$(95)?"pure":"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})},75(c,b){b.exports=k$(138)("native-function-to-string",Function.toString)},127(o,k){var l=k$(76),e=k$(78),h=k$(77),f=k$(159)("src"),g=k$(75),i="toString",m=(""+g).split(i);k$(58).inspectSource=function(a){return g.call(a)},(k.exports=function(a,b,c,n){var j=typeof c=="function";j&&(h(c,"name")||e(c,"name",b));if(a[b]===c)return;j&&(h(c,f)||e(c,f,a[b]?""+a[b]:m.join(String(b)))),a===l?a[b]=c:n?a[b]?a[b]=c:e(a,b,c):(delete a[b],e(a,b,c))})(Function.prototype,i,function a(){return typeof this=="function"&&this[f]||g.call(this)})},37(c,b){b.exports=function(a){if(typeof a!="function")throw TypeError(a+" is not a function!");return a}},60(j,f){var g=k$(37);f.exports=function(a,b,h){g(a);if(b===void 0)return a;switch(h){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,i){return a.call(b,c,d,i)}}return function(){return a.apply(b,arguments)}}},68(y,s){var d=k$(76),i=k$(58),t=k$(78),u=k$(127),o=k$(60),k="prototype",a=function(e,f,l){var v=e&a.F,m=e&a.G,w=e&a.S,p=e&a.P,x=e&a.B,h=m?d:w?d[f]||(d[f]={}):(d[f]||{})[k],j=m?i:i[f]||(i[f]={}),q=j[k]||(j[k]={}),c,n,b,r;m&&(l=f);for(c in l)n=!v&&h&&h[c]!==void 0,b=(n?h:l)[c],r=x&&n?o(b,d):p&&typeof b=="function"?o(Function.call,b):b,h&&u(h,c,b,e&a.U),j[c]!=b&&t(j,c,r),p&&q[c]!=b&&(q[c]=b)};d.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,s.exports=a},101(q,h){var b=k$(159)("meta"),i=k$(87),e=k$(77),j=k$(107).f,k=0,d=Object.isExtensible||function(){return!0},l=!k$(70)(function(){return d(Object.preventExtensions({}))}),f=function(a){j(a,b,{value:{i:"O"+ ++k,w:{}}})},m=function(a,g){if(!i(a))return typeof a=="symbol"?a:(typeof a=="string"?"S":"P")+a;if(!e(a,b)){if(!d(a))return"F";if(!g)return"E";f(a)}return a[b].i},n=function(a,g){if(!e(a,b)){if(!d(a))return!0;if(!g)return!1;f(a)}return a[b].w},o=function(a){return l&&p.NEED&&d(a)&&!e(a,b)&&f(a),a},p=h.exports={KEY:b,NEED:!1,fastKey:m,getWeak:n,onFreeze:o}},164(i,f){var c=k$(138)("wks"),g=k$(159),d=k$(76).Symbol,e=typeof d=="function",h=f.exports=function(a){return c[a]||(c[a]=e&&d[a]||(e?d:g)("Symbol."+a))};h.store=c},136(i,d){var e=k$(107).f,f=k$(77),c=k$(164)("toStringTag");d.exports=function(a,g,h){a&&!f(a=h?a:a.prototype,c)&&e(a,c,{configurable:!0,value:g})}},163(a){a.f=k$(164)},162(j,e){var f=k$(76),c=k$(58),g=k$(95),h=k$(163),i=k$(107).f;e.exports=function(b){var d=c.Symbol||(c.Symbol=g?{}:f.Symbol||{});b.charAt(0)!="_"&&!(b in d)&&i(d,b,{value:h.f(b)})}},53(d,a){var b={}.toString;a.exports=function(c){return b.call(c).slice(8,-1)}},83(e,c){var d=k$(53);c.exports=Object("z").propertyIsEnumerable(0)?Object:function(a){return d(a)=="String"?a.split(""):Object(a)}},63(c,b){b.exports=function(a){if(a==void 0)throw TypeError("Can't call method on  "+a);return a}},152(f,b){var c=k$(83),d=k$(63);b.exports=function(e){return c(d(e))}},151(e,b){var c=Math.ceil,d=Math.floor;b.exports=function(a){return isNaN(a=+a)?0:(a>0?d:c)(a)}},153(f,c){var d=k$(151),e=Math.min;c.exports=function(a){return a>0?e(d(a),9007199254740991):0}},149(h,d){var e=k$(151),f=Math.max,g=Math.min;d.exports=function(a,b){return a=e(a),a<0?f(a+b,0):g(a,b)}},46(n,h){var i=k$(152),j=k$(153),k=k$(149);h.exports=function(b){return function(l,e,m){var c=i(l),f=j(c.length),a=k(m,f),g;if(b&&e!=e)for(;f>a;){g=c[a++];if(g!=g)return!0}else for(;f>a;a++)if(b||a in c){if(c[a]===e)return b||a||0}return!b&&-1}}},137(f,d){var c=k$(138)("keys"),e=k$(159);d.exports=function(a){return c[a]||(c[a]=e(a))}},115(m,h){var e=k$(77),i=k$(152),j=k$(46)(!1),k=k$(137)("IE_PROTO");h.exports=function(l,f){var d=i(l),g=0,c=[],a;for(a in d)a!=k&&(e(d,a)&&c.push(a));for(;f.length>g;)e(d,a=f[g++])&&(~j(c,a)||c.push(a));return c}},66(b,a){a.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},116(f,b){var c=k$(115),d=k$(66);b.exports=Object.keys||function g(e){return c(e,d)}},113(a){a.f=Object.getOwnPropertySymbols},117(a){a.f={}.propertyIsEnumerable},67(m,h){var i=k$(116),j=k$(113),k=k$(117);h.exports=function(b){var c=i(b),d=j.f;if(d)for(var e=d(b),l=k.f,f=0,g;e.length>f;)l.call(b,g=e[f++])&&c.push(g);return c}},85(e,b){var c=k$(53);b.exports=Array.isArray||function f(d){return c(d)=="Array"}},154(e,b){var c=k$(63);b.exports=function(d){return Object(c(d))}},108(l,g){var h=k$(107),i=k$(42),j=k$(116);g.exports=k$(64)?Object.defineProperties:function m(b,c){i(b);for(var d=j(c),k=d.length,e=0,f;k>e;)h.f(b,f=d[e++],c[f]);return b}},79(d,c){var a=k$(76).document;c.exports=a&&a.documentElement},106(o,k){var l=k$(42),m=k$(108),j=k$(66),n=k$(137)("IE_PROTO"),h=function(){},i="prototype",g=function(){var d=k$(65)("iframe"),c=j.length,e="<",a=">",f;for(d.style.display="none",k$(79).appendChild(d),d.src="javascript:",f=d.contentWindow.document,f.open(),f.write(e+"script"+a+"document.F=Object"+e+"/script"+a),f.close(),g=f.F;c--;)delete g[i][j[c]];return g()};k.exports=Object.create||function d(c,e){var a;return c!==null?(h[i]=l(c),a=new h(),h[i]=null,a[n]=c):a=g(),e===void 0?a:m(a,e)}},112(b){var c=k$(115),d=k$(66).concat("length","prototype");b.f=Object.getOwnPropertyNames||function g(e){return c(e,d)}},111(j,f){var g=k$(152),c=k$(112).f,h={}.toString,d=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],i=function(e){try{return c(e)}catch(a){return d.slice()}};f.exports.f=function e(a){return d&&h.call(a)=="[object Window]"?i(a):c(g(a))}},110(e){var f=k$(117),g=k$(125),h=k$(152),i=k$(155),j=k$(77),k=k$(80),d=Object.getOwnPropertyDescriptor;e.f=k$(64)?d:function m(b,c){b=h(b),c=i(c,!0);if(k)try{return d(b,c)}catch(n){}if(j(b,c))return g(!f.f.call(b,c),b[c])}},291(){"use strict";var v=k$(76),f=k$(77),C=k$(64),g=k$(68),N=k$(127),ca=k$(101).KEY,D=k$(70),E=k$(138),F=k$(136),da=k$(159),r=k$(164),ea=k$(163),fa=k$(162),ga=k$(67),ha=k$(85),G=k$(42),ia=k$(87),ja=k$(154),w=k$(152),H=k$(155),I=k$(125),s=k$(106),O=k$(111),P=k$(110),x=k$(113),Q=k$(107),ka=k$(116),R=P.f,p=Q.f,S=O.f,h=v.Symbol,y=v.JSON,z=y&&y.stringify,n="prototype",i=r("_hidden"),T=r("toPrimitive"),la={}.propertyIsEnumerable,t=E("symbol-registry"),m=E("symbols"),u=E("op-symbols"),l=Object[n],q=typeof h=="function"&&!!x.f,J=v.QObject,K=!J||!J[n]||!J[n].findChild,L=C&&D(function(){return s(p({},"a",{get:function(){return p(this,"a",{value:7}).a}})).a!=7})?function(c,a,b){var e=R(l,a);e&&delete l[a],p(c,a,b),e&&c!==l&&p(l,a,e)}:p,U=function(c){var a=m[c]=s(h[n]);return a._k=c,a},M=q&&typeof h.iterator=="symbol"?function(c){return typeof c=="symbol"}:function(c){return c instanceof h},A=function c(a,b,e){return a===l&&A(u,b,e),G(a),b=H(b,!0),G(e),f(m,b)?(e.enumerable?(f(a,i)&&a[i][b]&&(a[i][b]=!1),e=s(e,{enumerable:I(0,!1)})):(f(a,i)||p(a,i,I(1,{})),a[i][b]=!0),L(a,b,e)):p(a,b,e)},V=function c(a,b){G(a);for(var e=ga(b=w(b)),j=0,k=e.length,o;k>j;)A(a,o=e[j++],b[o]);return a},ma=function c(a,b){return b===void 0?s(a):V(s(a),b)},W=function c(a){var b=la.call(this,a=H(a,!0));return this===l&&f(m,a)&&!f(u,a)?!1:b||!f(this,a)||!f(m,a)||f(this,i)&&this[i][a]?b:!0},X=function c(a,b){a=w(a),b=H(b,!0);if(a===l&&f(m,b)&&!f(u,b))return;var e=R(a,b);return e&&f(m,b)&&!(f(a,i)&&a[i][b])&&(e.enumerable=!0),e},Y=function c(a){for(var b=S(w(a)),e=[],j=0,k;b.length>j;)!f(m,k=b[j++])&&k!=i&&k!=ca&&e.push(k);return e},Z=function c(a){for(var b=a===l,e=S(b?u:w(a)),j=[],k=0,o;e.length>k;)f(m,o=e[k++])&&(b?f(l,o):!0)&&j.push(m[o]);return j};q||(h=function c(){if(this instanceof h)throw TypeError("Symbol is not a constructor!");var a=da(arguments.length>0?arguments[0]:void 0),b=function(e){this===l&&b.call(u,e),f(this,i)&&f(this[i],a)&&(this[i][a]=!1),L(this,a,I(1,e))};return C&&K&&L(l,a,{configurable:!0,set:b}),U(a)},N(h[n],"toString",function c(){return this._k}),P.f=X,Q.f=A,k$(112).f=O.f=Y,k$(117).f=W,x.f=Z,C&&!k$(95)&&N(l,"propertyIsEnumerable",W,!0),ea.f=function(c){return U(r(c))}),g(g.G+g.W+g.F*!q,{Symbol:h});for(var _="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),$=0;_.length>$;)r(_[$++]);for(var aa=ka(r.store),ba=0;aa.length>ba;)fa(aa[ba++]);g(g.S+g.F*!q,"Symbol",{for:function(c){return f(t,c+="")?t[c]:t[c]=h(c)},keyFor:function c(a){if(!M(a))throw TypeError(a+" is not a symbol!");for(var b in t)if(t[b]===a)return b},useSetter:function(){K=!0},useSimple:function(){K=!1}}),g(g.S+g.F*!q,"Object",{create:ma,defineProperty:A,defineProperties:V,getOwnPropertyDescriptor:X,getOwnPropertyNames:Y,getOwnPropertySymbols:Z});var na=D(function(){x.f(1)});g(g.S+g.F*na,"Object",{getOwnPropertySymbols:function c(a){return x.f(ja(a))}}),y&&g(g.S+g.F*(!q||D(function(){var c=h();return z([c])!="[null]"||z({a:c})!="{}"||z(Object(c))!="{}"})),"JSON",{stringify:function c(a){for(var b=[a],e=1,j,k;arguments.length>e;)b.push(arguments[e++]);return k=j=b[1],!ia(j)&&a===void 0||M(a)?void 0:(ha(j)||(j=function(o,B){typeof k=="function"&&(B=k.call(this,o,B));if(!M(B))return B}),b[1]=j,z.apply(y,b))}}),h[n][T]||k$(78)(h[n],T,h[n].valueOf),F(h,"Symbol"),F(Math,"Math",!0),F(v.JSON,"JSON",!0)},227(){var b=k$(68);b(b.S,"Object",{create:k$(106)})},229(){var b=k$(68);b(b.S+b.F*!k$(64),"Object",{defineProperty:k$(107).f})},228(){var b=k$(68);b(b.S+b.F*!k$(64),"Object",{defineProperties:k$(108)})},118(j,f){var b=k$(68),g=k$(58),h=k$(70);f.exports=function(c,i){var d=(g.Object||{})[c]||Object[c],e={};e[c]=i(d),b(b.S+b.F*h(function(){d(1)}),"Object",e)}},231(){var b=k$(152),c=k$(110).f;k$(118)("getOwnPropertyDescriptor",function(){return function h(d,e){return c(b(d),e)}})},114(h,d){var e=k$(77),f=k$(154),c=k$(137)("IE_PROTO"),g=Object.prototype;d.exports=Object.getPrototypeOf||function(a){return a=f(a),e(a,c)?a[c]:typeof a.constructor=="function"&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?g:null}},233(){var b=k$(154),c=k$(114);k$(118)("getPrototypeOf",function(){return function g(d){return c(b(d))}})},238(){var b=k$(154),c=k$(116);k$(118)("keys",function(){return function g(d){return c(b(d))}})},232(){k$(118)("getOwnPropertyNames",function(){return k$(111).f})},230(){var d=k$(87),e=k$(101).onFreeze;k$(118)("freeze",function(c){return function h(b){return c&&d(b)?c(e(b)):b}})},240(){var d=k$(87),e=k$(101).onFreeze;k$(118)("seal",function(c){return function h(b){return c&&d(b)?c(e(b)):b}})},239(){var d=k$(87),e=k$(101).onFreeze;k$(118)("preventExtensions",function(c){return function h(b){return c&&d(b)?c(e(b)):b}})},235(){var d=k$(87);k$(118)("isFrozen",function(b){return function g(c){return d(c)?b?b(c):!1:!0}})},236(){var d=k$(87);k$(118)("isSealed",function(b){return function g(c){return d(c)?b?b(c):!1:!0}})},234(){var d=k$(87);k$(118)("isExtensible",function(b){return function g(c){return d(c)?b?b(c):!0:!1}})},105(w,o){"use strict";var p=k$(64),j=k$(116),q=k$(113),r=k$(117),s=k$(154),t=k$(83),d=Object.assign;o.exports=!d||k$(70)(function(){var h={},e={},i=Symbol(),b="abcdefghijklmnopqrst";return h[i]=7,b.split("").forEach(function(f){e[f]=f}),d({},h)[i]!=7||Object.keys(d({},e)).join("")!=b})?function h(e,i){for(var b=s(e),f=arguments.length,k=1,l=q.f,u=r.f;f>k;)for(var c=t(arguments[k++]),m=l?j(c).concat(l(c)):j(c),v=m.length,n=0,g;v>n;)g=m[n++],(!p||u.call(c,g))&&(b[g]=c[g]);return b}:d},226(){var a=k$(68);a(a.S+a.F,"Object",{assign:k$(105)})},131(d,c){c.exports=Object.is||function f(a,b){return a===b?a!==0||1/a===1/b:a!=a&&b!=b}},237(){var b=k$(68);b(b.S,"Object",{is:k$(131)})},134(l,h){var i=k$(87),j=k$(42),g=function(c,a){j(c);if(!i(a)&&a!==null)throw TypeError(a+": can't set as prototype!")};h.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(c,a,e){try{e=k$(60)(Function.call,k$(110).f(Object.prototype,"__proto__").set,2),e(c,[]),a=!(c instanceof Array)}catch(k){a=!0}return function k(d,f){return g(d,f),a?d.__proto__=f:e(d,f),d}}({},!1):void 0),check:g}},241(){var b=k$(68);b(b.S,"Object",{setPrototypeOf:k$(134).set})},52(k,g){var c=k$(53),h=k$(164)("toStringTag"),i=c(function(){return arguments}())=="Arguments",j=function(b,a){try{return b[a]}catch(d){}};g.exports=function(b){var a,d,f;return b===void 0?"Undefined":b===null?"Null":typeof(d=j(a=Object(b),h))=="string"?d:i?c(a):(f=c(a))=="Object"&&typeof a.callee=="function"?"Arguments":f}},242(){"use strict";var c=k$(52),b={};b[k$(164)("toStringTag")]="z",b+""!="[object z]"&&k$(127)(Object.prototype,"toString",function f(){return"[object "+c(this)+"]"},!0)},82(f,e){e.exports=function(b,a,c){var d=c===void 0;switch(a.length){case 0:return d?b():b.call(c);case 1:return d?b(a[0]):b.call(c,a[0]);case 2:return d?b(a[0],a[1]):b.call(c,a[0],a[1]);case 3:return d?b(a[0],a[1],a[2]):b.call(c,a[0],a[1],a[2]);case 4:return d?b(a[0],a[1],a[2],a[3]):b.call(c,a[0],a[1],a[2],a[3])}return b.apply(c,a)}},51(o,j){"use strict";var k=k$(37),l=k$(87),m=k$(82),h=[].slice,f={},n=function(i,b,c){if(!(b in f)){for(var d=[],a=0;a<b;a++)d[a]="a["+a+"]";f[b]=Function("F,a","return new F("+d.join(",")+")")}return f[b](i,c)};j.exports=Function.bind||function i(b){var c=k(this),d=h.call(arguments,1),a=function(){var g=d.concat(h.call(arguments));return this instanceof a?n(c,g.length,g):m(c,g,b)};return l(c.prototype)&&(a.prototype=c.prototype),a}},193(){var b=k$(68);b(b.P,"Function",{bind:k$(51)})},195(){var d=k$(107).f,b=Function.prototype,e=/^\s*function ([^ (]*)/,c="name";c in b||k$(64)&&d(b,c,{configurable:!0,get:function(){try{return(""+this).match(e)[1]}catch(h){return""}}})},194(){"use strict";var c=k$(87),f=k$(114),d=k$(164)("hasInstance"),e=Function.prototype;d in e||k$(107).f(e,d,{value:function(a){if(typeof this!="function"||!c(a))return!1;if(!c(this.prototype))return a instanceof this;for(;a=f(a);)if(this.prototype===a)return!0;return!1}})},147(b,a){a.exports=`	
\v\f\r Â áá ââââââââââââ¯âã\u2028\u2029ï»¿`},146(s,l){var e=k$(68),m=k$(63),n=k$(70),f=k$(147),c="["+f+"]",h="âÂ",o=RegExp("^"+c+c+"*"),p=RegExp(c+c+"*$"),i=function(a,d,j){var g={},k=n(function(){return!!f[a]()||h[a]()!=h}),r=g[a]=k?d(q):f[a];j&&(g[j]=r),e(e.P+e.F*k,"String",g)},q=i.trim=function(a,d){return a=String(m(a)),d&1&&(a=a.replace(o,"")),d&2&&(a=a.replace(p,"")),a};l.exports=i},122(j,e){var a=k$(76).parseInt,f=k$(146).trim,c=k$(147),g=/^[-+]?0[xX]/;e.exports=a(c+"08")!==8||a(c+"0x16")!==22?function k(h,i){var d=f(String(h),3);return a(d,i>>>0||(g.test(d)?16:10))}:a},244(){var a=k$(68),c=k$(122);a(a.G+a.F*(parseInt!=c),{parseInt:c})},121(h,e){var b=k$(76).parseFloat,f=k$(146).trim;e.exports=1/b(k$(147)+"-0")!==-Infinity?function i(g){var c=f(String(g),3),d=b(c);return d===0&&c.charAt(0)=="-"?-0:d}:b},243(){var a=k$(68),c=k$(121);a(a.G+a.F*(parseFloat!=c),{parseFloat:c})},81(j,g){var h=k$(87),d=k$(134).set;g.exports=function(e,i,f){var a=i.constructor,b;return a!==f&&typeof a=="function"&&(b=a.prototype)!==f.prototype&&h(b)&&d&&d(e,b),e}},214(){"use strict";var p=k$(76),q=k$(77),r=k$(53),v=k$(81),w=k$(155),x=k$(70),y=k$(112).f,z=k$(110).f,A=k$(107).f,B=k$(146).trim,f="Number",b=p[f],g=b,h=b.prototype,C=r(k$(106)(h))==f,D="trim"in String.prototype,s=function(u){var c=w(u,!1);if(typeof c=="string"&&c.length>2){c=D?c.trim():B(c,3);var e=c.charCodeAt(0),d,k,l;if(e===43||e===45){d=c.charCodeAt(2);if(d===88||d===120)return NaN}else if(e===48){switch(c.charCodeAt(1)){case 66:case 98:k=2,l=49;break;case 79:case 111:k=8,l=55;break;default:return+c}for(var m=c.slice(2),n=0,E=m.length,o;n<E;n++){o=m.charCodeAt(n);if(o<48||o>l)return NaN}return parseInt(m,k)}}return+c};if(!b(" 0o1")||!b("0b1")||b("+0x1")){b=function u(c){var e=arguments.length<1?0:c,d=this;return d instanceof b&&(C?x(function(){h.valueOf.call(d)}):r(d)!=f)?v(new g(s(e)),d,b):s(e)};for(var t=k$(64)?y(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),j=0,i;t.length>j;j++)q(g,i=t[j])&&!q(b,i)&&A(b,i,z(g,i));b.prototype=h,h.constructor=b,k$(127)(p,f,b)}},38(f,c){var d=k$(53);c.exports=function(a,e){if(typeof a!="number"&&d(a)!="Number")throw TypeError(e);return+a}},145(i,e){"use strict";var f=k$(151),g=k$(63);e.exports=function j(h){var b=String(g(this)),d="",a=f(h);if(a<0||a==Infinity)throw RangeError("Count can't be negative");for(;a>0;(a>>>=1)&&(b+=b))a&1&&(d+=b);return d}},224(){"use strict";var o=k$(68),w=k$(151),x=k$(38),p=k$(145),s=1 .toFixed,t=Math.floor,h=[0,0,0,0,0,0],u="Number.toFixed: incorrect invocation!",m="0",i=function(c,b){for(var a=-1,d=b;++a<6;)d+=c*h[a],h[a]=d%1e07,d=t(d/1e07)},q=function(c){for(var b=6,a=0;--b>=0;)a+=h[b],h[b]=t(a/c),a=a%c*1e07},v=function(){for(var c=6,b="";--c>=0;)if(b!==""||c===0||h[c]!==0){var a=String(h[c]);b=b===""?a:b+p.call(m,7-a.length)+a}return b},j=function(c,b,a){return b===0?a:b%2===1?j(c,b-1,a*c):j(c*c,b/2,a)},y=function(c){for(var b=0,a=c;a>=4096;)b+=12,a/=4096;for(;a>=2;)b+=1,a/=2;return b};o(o.P+o.F*(!!s&&(8e-05 .toFixed(3)!=="0.000"||.9 .toFixed(0)!=="1"||1.255 .toFixed(2)!=="1.25"||1000000000000000128 .toFixed(0)!=="1000000000000000128")||!k$(70)(function(){s.call({})})),"Number",{toFixed:function c(b){var a=x(this,u),d=w(b),r="",e=m,f,n,g,l;if(d<0||d>20)throw RangeError(u);if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return String(a);a<0&&(r="-",a=-a);if(a>1e-21){f=y(a*j(2,69,1))-69,n=f<0?a*j(2,-f,1):a/j(2,f,1),n*=4503599627370496,f=52-f;if(f>0){for(i(0,n),g=d;g>=7;)i(1e07,0),g-=7;for(i(j(10,g,1),0),g=f-1;g>=23;)q(1<<23),g-=23;q(1<<g),i(1,1),q(2),e=v()}else i(0,n),i(1<<-f,0),e=v()+p.call(m,d)}return d>0?(l=e.length,e=r+(l<=d?"0."+p.call(m,d-l)+e:e.slice(0,l-d)+"."+e.slice(l-d))):e=r+e,e}})},225(){"use strict";var c=k$(68),d=k$(70),g=k$(38),a=1 .toPrecision;c(c.P+c.F*(d(function(){return a.call(1,void 0)!=="1"})||!d(function(){a.call({})})),"Number",{toPrecision:function j(e){var f=g(this,"Number#toPrecision: incorrect invocation!");return e===void 0?a.call(f):a.call(f,e)}})},215(){var a=k$(68);a(a.S,"Number",{EPSILON:Math.pow(2,-52)})},216(){var b=k$(68),d=k$(76).isFinite;b(b.S,"Number",{isFinite:function g(c){return typeof c=="number"&&d(c)}})},86(f,c){var d=k$(87),e=Math.floor;c.exports=function g(a){return!d(a)&&isFinite(a)&&e(a)===a}},217(){var b=k$(68);b(b.S,"Number",{isInteger:k$(86)})},218(){var a=k$(68);a(a.S,"Number",{isNaN:function f(b){return b!=b}})},219(){var b=k$(68),d=k$(86),e=Math.abs;b(b.S,"Number",{isSafeInteger:function h(c){return d(c)&&e(c)<=9007199254740991}})},220(){var a=k$(68);a(a.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},221(){var a=k$(68);a(a.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},222(){var a=k$(68),c=k$(121);a(a.S+a.F*(Number.parseFloat!=c),"Number",{parseFloat:c})},223(){var a=k$(68),c=k$(122);a(a.S+a.F*(Number.parseInt!=c),"Number",{parseInt:c})},98(c,b){b.exports=Math.log1p||function e(a){return(a=+a)>-1e-08&&a<1e-08?a-a*a/2:Math.log(1+a)}},197(){var b=k$(68),f=k$(98),e=Math.sqrt,c=Math.acosh;b(b.S+b.F*!(c&&Math.floor(c(Number.MAX_VALUE))==710&&c(Infinity)==Infinity),"Math",{acosh:function i(a){return(a=+a)<1?NaN:a>9.490626562425156e07?Math.log(a)+Math.LN2:f(a-1+e(a-1)*e(a+1))}})},198(){var b=k$(68),c=Math.asinh;function d(a){return!isFinite(a=+a)||a==0?a:a<0?-d(-a):Math.log(a+Math.sqrt(a*a+1))}b(b.S+b.F*!(c&&1/c(0)>0),"Math",{asinh:d})},199(){var b=k$(68),c=Math.atanh;b(b.S+b.F*!(c&&1/c(-0)<0),"Math",{atanh:function g(a){return(a=+a)==0?a:Math.log((1+a)/(1-a))/2}})},100(c,b){b.exports=Math.sign||function e(a){return(a=+a)==0||a!=a?a:a<0?-1:1}},200(){var c=k$(68),d=k$(100);c(c.S,"Math",{cbrt:function g(a){return d(a=+a)*Math.pow(Math.abs(a),1/3)}})},201(){var a=k$(68);a(a.S,"Math",{clz32:function f(b){return(b>>>=0)?31-Math.floor(Math.log(b+.5)*Math.LOG2E):32}})},202(){var b=k$(68),c=Math.exp;b(b.S,"Math",{cosh:function g(a){return(c(a=+a)+c(-a))/2}})},96(d,c){var b=Math.expm1;c.exports=!b||b(10)>22025.465794806718||b(10)<22025.465794806718||b(-2e-17)!=-2e-17?function f(a){return(a=+a)==0?a:a>-1e-06&&a<1e-06?a+a*a/2:Math.exp(a)-1}:b},203(){var a=k$(68),c=k$(96);a(a.S+a.F*(c!=Math.expm1),"Math",{expm1:c})},97(p,l){var m=k$(100),b=Math.pow,e=b(2,-52),c=b(2,-23),n=b(2,127)*(2-c),f=b(2,-126),o=function(i){return i+1/e-1/e};l.exports=Math.fround||function i(j){var d=Math.abs(j),g=m(j),h,a;return d<f?g*o(d/f/c)*f*c:(h=(1+c/e)*d,a=h-(h-d),a>n||a!=a?g*Infinity:g*a)}},204(){var b=k$(68);b(b.S,"Math",{fround:k$(97)})},205(){var e=k$(68),h=Math.abs;e(e.S,"Math",{hypot:function l(m,n){for(var d=0,f=0,i=arguments.length,b=0,a,c;f<i;)a=h(arguments[f++]),b<a?(c=b/a,d=d*c*c+1,b=a):a>0?(c=a/b,d+=c*c):d+=a;return b===Infinity?Infinity:b*Math.sqrt(d)}})},206(){var b=k$(68),d=Math.imul;b(b.S+b.F*k$(70)(function(){return d(4294967295,5)!=-5||d.length!=2}),"Math",{imul:function m(i,j){var a=65535,e=+i,f=+j,g=a&e,h=a&f;return 0|g*h+((a&e>>>16)*h+g*(a&f>>>16)<<16>>>0)}})},207(){var a=k$(68);a(a.S,"Math",{log10:function f(c){return Math.log(c)*Math.LOG10E}})},208(){var b=k$(68);b(b.S,"Math",{log1p:k$(98)})},209(){var a=k$(68);a(a.S,"Math",{log2:function f(c){return Math.log(c)/Math.LN2}})},210(){var b=k$(68);b(b.S,"Math",{sign:k$(100)})},211(){var c=k$(68),d=k$(96),e=Math.exp;c(c.S+c.F*k$(70)(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function h(a){return Math.abs(a=+a)<1?(d(a)-d(-a))/2:(e(a-1)-e(-a-1))*(Math.E/2)}})},212(){var c=k$(68),d=k$(96),e=Math.exp;c(c.S,"Math",{tanh:function j(a){var f=d(a=+a),g=d(-a);return f==Infinity?1:g==Infinity?-1:(f-g)/(e(a)+e(-a))}})},213(){var a=k$(68);a(a.S,"Math",{trunc:function f(b){return(b>0?Math.floor:Math.ceil)(b)}})},278(){var b=k$(68),h=k$(149),d=String.fromCharCode,e=String.fromCodePoint;b(b.S+b.F*(!!e&&e.length!=1),"String",{fromCodePoint:function l(m){for(var f=[],i=arguments.length,g=0,a;i>g;){a=+arguments[g++];if(h(a,1114111)!==a)throw RangeError(a+" is not a valid code point");f.push(a<65536?d(a):d(((a-=65536)>>10)+55296,a%1024+56320))}return f.join("")}})},283(){var d=k$(68),f=k$(152),g=k$(153);d(d.S,"String",{raw:function m(h){for(var e=f(h.raw),i=g(e.length),j=arguments.length,c=[],a=0;i>a;)c.push(String(e[a++])),a<j&&c.push(String(arguments[a]));return c.join("")}})},290(){"use strict";k$(146)("trim",function(b){return function e(){return b(this,3)}})},141(m,h){var i=k$(151),j=k$(63);h.exports=function(d){return function(k,l){var b=String(j(k)),a=i(l),g=b.length,c,e;return a<0||a>=g?d?"":void 0:(c=b.charCodeAt(a),c<55296||c>56319||a+1===g||(e=b.charCodeAt(a+1))<56320||e>57343?d?b.charAt(a):c:d?b.slice(a,a+2):(c-55296<<10)+(e-56320)+65536)}}},94(b,a){a.exports={}},90(j,d){"use strict";var e=k$(106),f=k$(125),g=k$(136),b={};k$(78)(b,k$(164)("iterator"),function(){return this}),d.exports=function(c,h,i){c.prototype=e(b,{next:f(1,i)}),g(c,h+" Iterator")}},91(L,C){"use strict";var s=k$(95),o=k$(68),D=k$(127),t=k$(78),u=k$(94),E=k$(90),F=k$(136),G=k$(114),h=k$(164)("iterator"),p=!([].keys&&"next"in[].keys()),H="@@iterator",v="keys",k="values",w=function(){return this};C.exports=function(x,i,l,I,d,J,y){E(l,i,I);var m=function(c){if(!p&&c in a)return a[c];switch(c){case v:return function B(){return new l(this,c)};case k:return function B(){return new l(this,c)}}return function B(){return new l(this,c)}},z=i+" Iterator",q=d==k,r=!1,a=x.prototype,e=a[h]||a[H]||d&&a[d],f=e||m(d),K=d?q?m("entries"):f:void 0,A=i=="Array"?a.entries||e:e,j,n,g;A&&(g=G(A.call(new x())),g!==Object.prototype&&g.next&&(F(g,z,!0),!s&&typeof g[h]!="function"&&t(g,h,w))),q&&e&&e.name!==k&&(r=!0,f=function c(){return e.call(this)}),(!s||y)&&(p||r||!a[h])&&t(a,h,f),u[i]=f,u[z]=w;if(d){j={values:q?f:m(k),keys:J?f:m(v),entries:K};if(y)for(n in j)n in a||D(a,n,j[n]);else o(o.P+o.F*(p||r),i,j)}return j}},281(){"use strict";var e=k$(141)(!0);k$(91)(String,"String",function(a){this._t=String(a),this._i=0},function(){var a=this._t,d=this._i,b;return d>=a.length?{value:void 0,done:!0}:(b=e(a,d),this._i+=b.length,{value:b,done:!1})})},273(){"use strict";var b=k$(68),c=k$(141)(!1);b(b.P,"String",{codePointAt:function g(d){return c(this,d)}})},88(h,d){var e=k$(87),f=k$(53),g=k$(164)("match");d.exports=function(b){var c;return e(b)&&((c=b[g])!==void 0?!!c:f(b)=="RegExp")}},142(h,b){var c=k$(88),d=k$(63);b.exports=function(e,f,g){if(c(f))throw TypeError("String#"+g+" doesn't accept regex!");return String(d(e))}},69(f,d){var e=k$(164)("match");d.exports=function(b){var a=/./;try{"/./"[b](a)}catch(g){try{return a[e]=!1,!"/./"[b](a)}catch(h){}}return!0}},274(){"use strict";var b=k$(68),g=k$(153),l=k$(142),c="endsWith",h=""[c];b(b.P+b.F*k$(69)(c),"String",{endsWith:function o(i){var d=l(this,i,c),j=arguments.length>1?arguments[1]:void 0,k=g(d.length),e=j===void 0?k:Math.min(g(j),k),f=String(i);return h?h.call(d,f,e):d.slice(e-f.length,e)===f}})},279(){"use strict";var b=k$(68),e=k$(142),c="includes";b(b.P+b.F*k$(69)(c),"String",{includes:function h(d){return!!~e(this,d,c).indexOf(d,arguments.length>1?arguments[1]:void 0)}})},284(){var b=k$(68);b(b.P,"String",{repeat:k$(145)})},286(){"use strict";var b=k$(68),i=k$(153),j=k$(142),c="startsWith",g=""[c];b(b.P+b.F*k$(69)(c),"String",{startsWith:function m(h){var d=j(this,h,c),e=i(Math.min(arguments.length>1?arguments[1]:void 0,d.length)),f=String(h);return g?g.call(d,f,e):d.slice(e,e+f.length)===f}})},143(n,h){var f=k$(68),i=k$(70),j=k$(63),k=/"/g,l=function(c,d,a,b){var m=String(j(c)),g="<"+d;return a!==""&&(g+=" "+a+'="'+String(b).replace(k,"&quot;")+'"'),g+">"+m+"</"+d+">"};h.exports=function(c,d){var a={};a[c]=d(l),f(f.P+f.F*i(function(){var b=""[c]('"');return b!==b.toLowerCase()||b.split('"').length>3}),"String",a)}},269(){"use strict";k$(143)("anchor",function(b){return function f(c){return b(this,"a","name",c)}})},270(){"use strict";k$(143)("big",function(b){return function e(){return b(this,"big","","")}})},271(){"use strict";k$(143)("blink",function(b){return function e(){return b(this,"blink","","")}})},272(){"use strict";k$(143)("bold",function(b){return function e(){return b(this,"b","","")}})},275(){"use strict";k$(143)("fixed",function(b){return function e(){return b(this,"tt","","")}})},276(){"use strict";k$(143)("fontcolor",function(b){return function f(c){return b(this,"font","color",c)}})},277(){"use strict";k$(143)("fontsize",function(b){return function f(c){return b(this,"font","size",c)}})},280(){"use strict";k$(143)("italics",function(b){return function e(){return b(this,"i","","")}})},282(){"use strict";k$(143)("link",function(b){return function f(c){return b(this,"a","href",c)}})},285(){"use strict";k$(143)("small",function(b){return function e(){return b(this,"small","","")}})},287(){"use strict";k$(143)("strike",function(b){return function e(){return b(this,"strike","","")}})},288(){"use strict";k$(143)("sub",function(b){return function e(){return b(this,"sub","","")}})},289(){"use strict";k$(143)("sup",function(b){return function e(){return b(this,"sup","","")}})},188(){var a=k$(68);a(a.S,"Date",{now:function(){return new Date().getTime()}})},190(){"use strict";var b=k$(68),e=k$(154),f=k$(155);b(b.P+b.F*k$(70)(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1}),"Date",{toJSON:function i(j){var c=e(this),d=f(c);return typeof d=="number"&&!isFinite(d)?null:c.toISOString()}})},61(l,j){"use strict";var g=k$(70),k=Date.prototype.getTime,d=Date.prototype.toISOString,b=function(c){return c>9?c:"0"+c};j.exports=g(function(){return d.call(new Date(-5e13-1))!="0385-07-25T07:06:39.999Z"})||!g(function(){d.call(new Date(NaN))})?function c(){if(!isFinite(k.call(this)))throw RangeError("Invalid time value");var a=this,e=a.getUTCFullYear(),f=a.getUTCMilliseconds(),h=e<0?"-":e>9999?"+":"";return h+("00000"+Math.abs(e)).slice(h?-6:-4)+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"."+(f>99?f:"0"+b(f))+"Z"}:d},189(){var a=k$(68),c=k$(61);a(a.P+a.F*(Date.prototype.toISOString!==c),"Date",{toISOString:c})},192(){var a=Date.prototype,b="Invalid Date",c="toString",f=a[c],g=a.getTime;new Date(NaN)+""!=b&&k$(127)(a,c,function j(){var d=g.call(this);return d===d?f.call(this):b})},62(g,d){"use strict";var e=k$(42),f=k$(155),c="number";d.exports=function(a){if(a!=="string"&&a!==c&&a!=="default")throw TypeError("Incorrect hint");return f(e(this),a!=c)}},191(){var b=k$(164)("toPrimitive"),c=Date.prototype;b in c||k$(78)(c,b,k$(62))},176(){var b=k$(68);b(b.S,"Array",{isArray:k$(85)})},89(j,g){var b=k$(42);g.exports=function(c,d,a,h){try{return h?d(b(a)[0],a[1]):d(a)}catch(i){var e=c.return;throw e!==void 0&&b(e.call(c)),i}}},84(g,c){var d=k$(94),e=k$(164)("iterator"),f=Array.prototype;c.exports=function(a){return a!==void 0&&(d.Array===a||f[e]===a)}},59(h,e){"use strict";var f=k$(107),g=k$(125);e.exports=function(a,b,d){b in a?f.f(a,b,g(0,d)):a[b]=d}},165(g,c){var d=k$(52),e=k$(164)("iterator"),f=k$(94);c.exports=k$(58).getIteratorMethod=function(b){if(b!=void 0)return b[e]||b["@@iterator"]||f[d(b)]}},92(k,i){var a=k$(164)("iterator"),c=!1;try{var d=[7][a]();d.return=function(){c=!0},Array.from(d,function(){throw 2})}catch(e){}i.exports=function(e,j){if(!j&&!c)return!1;var f=!1;try{var b=[7],g=b[a]();g.next=function(){return{done:f=!0}},b[a]=function(){return g},e(b)}catch(l){}return f}},174(){"use strict";var p=k$(60),f=k$(68),q=k$(154),r=k$(89),s=k$(84),t=k$(153),m=k$(59),u=k$(165);f(f.S+f.F*!k$(92)(function(n){Array.from(n)}),"Array",{from:function n(v){var d=q(v),g=typeof this=="function"?this:Array,o=arguments.length,e=o>1?arguments[1]:void 0,h=e!==void 0,a=0,i=u(d),j,c,k,l;h&&(e=p(e,o>2?arguments[2]:void 0,2));if(i!=void 0&&!(g==Array&&s(i)))for(l=i.call(d),c=new g();!(k=l.next()).done;a++)m(c,a,h?r(l,e,[k.value,a],!0):k.value);else for(j=t(d.length),c=new g(j);j>a;a++)m(c,a,h?e(d[a],a):d[a]);return c.length=a,c}})},181(){"use strict";var b=k$(68),g=k$(59);b(b.S+b.F*k$(70)(function(){function c(){}return!(Array.of.call(c)instanceof c)}),"Array",{of:function c(){for(var d=0,e=arguments.length,f=new(typeof this=="function"?this:Array)(e);e>d;)g(f,d,arguments[d++]);return f.length=e,f}})},140(f,c){"use strict";var d=k$(70);c.exports=function(a,e){return!!a&&d(function(){e?a.call(null,function(){},1):a.call(null)})}},178(){"use strict";var b=k$(68),e=k$(152),c=[].join;b(b.P+b.F*(k$(83)!=Object||!k$(140)(c)),"Array",{join:function h(d){return c.call(e(this),d===void 0?",":d)}})},184(){"use strict";var d=k$(68),g=k$(79),o=k$(53),h=k$(149),i=k$(153),j=[].slice;d(d.P+d.F*k$(70)(function(){g&&j.call(g)}),"Array",{slice:function s(k,b){var e=i(this.length),l=o(this);b=b===void 0?e:b;if(l=="Array")return j.call(this,k,b);for(var f=h(k,e),p=h(b,e),m=i(p-f),n=new Array(m),c=0;c<m;c++)n[c]=l=="String"?this.charAt(f+c):this[f+c];return n}})},186(){"use strict";var b=k$(68),h=k$(37),d=k$(154),e=k$(70),c=[].sort,f=[1,2,3];b(b.P+b.F*(e(function(){f.sort(void 0)})||!e(function(){f.sort(null)})||!k$(140)(c)),"Array",{sort:function k(g){return g===void 0?c.call(d(this)):c.call(d(this),h(g))}})},49(h,e){var f=k$(87),c=k$(85),g=k$(164)("species");e.exports=function(d){var a;return c(d)&&(a=d.constructor,typeof a=="function"&&(a===Array||c(a.prototype))&&(a=void 0),f(a)&&(a=a[g],a===null&&(a=void 0))),a===void 0?Array:a}},50(f,b){var c=k$(49);b.exports=function(d,e){return new(c(d))(e)}},47(B,o){var p=k$(60),q=k$(83),r=k$(154),s=k$(153),t=k$(50);o.exports=function(a,u){var j=a==1,v=a==2,w=a==3,e=a==4,k=a==6,x=a==5||k,l=u||t;return function(f,y,z){for(var m=r(f),g=q(m),A=p(y,z,3),n=s(g.length),b=0,h=j?l(f,n):v?l(f,0):void 0,d,i;n>b;b++)if(x||b in g){d=g[b],i=A(d,b,m);if(a){if(j)h[b]=i;else if(i)switch(a){case 3:return!0;case 5:return d;case 6:return b;case 2:h.push(d)}else if(e)return!1}}return k?-1:w||e?e:h}}},173(){"use strict";var b=k$(68),c=k$(47)(0),d=k$(140)([].forEach,!0);b(b.P+b.F*!d,"Array",{forEach:function h(e){return c(this,e,arguments[1])}})},180(){"use strict";var b=k$(68),c=k$(47)(1);b(b.P+b.F*!k$(140)([].map,!0),"Array",{map:function g(d){return c(this,d,arguments[1])}})},170(){"use strict";var b=k$(68),c=k$(47)(2);b(b.P+b.F*!k$(140)([].filter,!0),"Array",{filter:function g(d){return c(this,d,arguments[1])}})},185(){"use strict";var b=k$(68),c=k$(47)(3);b(b.P+b.F*!k$(140)([].some,!0),"Array",{some:function g(d){return c(this,d,arguments[1])}})},168(){"use strict";var b=k$(68),c=k$(47)(4);b(b.P+b.F*!k$(140)([].every,!0),"Array",{every:function g(d){return c(this,d,arguments[1])}})},48(q,j){var k=k$(37),l=k$(154),m=k$(83),n=k$(153);j.exports=function(o,i,p,c,d){k(i);var f=l(o),e=m(f),g=n(f.length),a=d?g-1:0,h=d?-1:1;if(p<2)for(;;){if(a in e){c=e[a],a+=h;break}a+=h;if(d?a<0:g<=a)throw TypeError("Reduce of empty array with no initial value")}for(;d?a>=0:g>a;a+=h)a in e&&(c=i(c,e[a],a,f));return c}},183(){"use strict";var b=k$(68),c=k$(48);b(b.P+b.F*!k$(140)([].reduce,!0),"Array",{reduce:function g(d){return c(this,d,arguments.length,arguments[1],!1)}})},182(){"use strict";var b=k$(68),c=k$(48);b(b.P+b.F*!k$(140)([].reduceRight,!0),"Array",{reduceRight:function g(d){return c(this,d,arguments.length,arguments[1],!0)}})},175(){"use strict";var b=k$(68),e=k$(46)(!1),c=[].indexOf,d=!!c&&1/[1].indexOf(1,-0)<0;b(b.P+b.F*(d||!k$(140)(c)),"Array",{indexOf:function i(f){return d?c.apply(this,arguments)||0:e(this,f,arguments[1])}})},179(){"use strict";var c=k$(68),h=k$(152),i=k$(151),j=k$(153),d=[].lastIndexOf,f=!!d&&1/[1].lastIndexOf(1,-0)<0;c(c.P+c.F*(f||!k$(140)(d)),"Array",{lastIndexOf:function n(k){if(f)return d.apply(this,arguments)||0;var e=h(this),g=j(e.length),a=g-1;for(arguments.length>1&&(a=Math.min(a,i(arguments[1]))),a<0&&(a=g+a);a>=0;a--)if(a in e){if(e[a]===k)return a||0}return-1}})},43(o,j){"use strict";var k=k$(154),g=k$(149),l=k$(153);j.exports=[].copyWithin||function p(m,n){var c=k(this),d=l(c.length),a=g(m,d),b=g(n,d),i=arguments.length>2?arguments[2]:void 0,e=Math.min((i===void 0?d:g(i,d))-b,d-a),h=1;for(b<a&&a<b+e&&(h=-1,b+=e-1,a+=e-1);e-- >0;)b in c?c[a]=c[b]:delete c[a],a+=h,b+=h;return c}},39(f,d){var a=k$(164)("unscopables"),b=Array.prototype;b[a]==void 0&&k$(78)(b,a,{}),d.exports=function(e){b[a][e]=!0}},167(){var b=k$(68);b(b.P,"Array",{copyWithin:k$(43)}),k$(39)("copyWithin")},44(m,h){"use strict";var i=k$(154),d=k$(149),j=k$(153);h.exports=function n(k){for(var b=i(this),c=j(b.length),e=arguments.length,f=d(e>1?arguments[1]:void 0,c),g=e>2?arguments[2]:void 0,l=g===void 0?c:d(g,c);l>f;)b[f++]=k;return b}},169(){var b=k$(68);b(b.P,"Array",{fill:k$(44)}),k$(39)("fill")},172(){"use strict";var b=k$(68),e=k$(47)(5),c="find",d=!0;c in[]&&Array(1)[c](function(){d=!1}),b(b.P+b.F*d,"Array",{find:function i(f){return e(this,f,arguments.length>1?arguments[1]:void 0)}}),k$(39)(c)},171(){"use strict";var b=k$(68),e=k$(47)(6),c="findIndex",d=!0;c in[]&&Array(1)[c](function(){d=!1}),b(b.P+b.F*d,"Array",{findIndex:function i(f){return e(this,f,arguments.length>1?arguments[1]:void 0)}}),k$(39)(c)},135(i,d){"use strict";var e=k$(76),f=k$(107),g=k$(64),c=k$(164)("species");d.exports=function(h){var b=e[h];g&&b&&!b[c]&&f.f(b,c,{configurable:!0,get:function(){return this}})}},187(){k$(135)("Array")},93(d,a){a.exports=function(b,c){return{value:c,done:!!b}}},177(j,h){"use strict";var f=k$(39),d=k$(93),g=k$(94),i=k$(152);h.exports=k$(91)(Array,"Array",function(a,e){this._t=i(a),this._i=0,this._k=e},function(){var a=this._t,e=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,d(1)):e=="keys"?d(0,c):e=="values"?d(0,a[c]):d(0,[c,a[c]])},"values"),g.Arguments=g.Array,f("keys"),f("values"),f("entries")},72(f,d){"use strict";var e=k$(42);d.exports=function(){var b=e(this),a="";return b.global&&(a+="g"),b.ignoreCase&&(a+="i"),b.multiline&&(a+="m"),b.unicode&&(a+="u"),b.sticky&&(a+="y"),a}},260(){var l=k$(76),q=k$(81),r=k$(107).f,s=k$(112).f,t=k$(88),u=k$(72),a=l.RegExp,d=a,h=a.prototype,e=/a/g,i=/a/g,m=new a(e)!==e;if(k$(64)&&(!m||k$(70)(function(){return i[k$(164)("match")]=!1,a(e)!=e||a(i)==i||a(e,"i")!="/a/i"}))){a=function f(c,j){var p=this instanceof a,g=t(c),k=j===void 0;return!p&&g&&c.constructor===a&&k?c:q(m?new d(g&&!k?c.source:c,j):d((g=c instanceof a)?c.source:c,g&&k?u.call(c):j),p?this:h,a)};for(var v=function(f){f in a||r(a,f,{configurable:!0,get:function(){return d[f]},set:function(c){d[f]=c}})},n=s(d),o=0;n.length>o;)v(n[o++]);h.constructor=a,a.prototype=h,k$(127)(l,"RegExp",a)}k$(135)("RegExp")},129(r,n){"use strict";var o=k$(72),d=RegExp.prototype.exec,p=String.prototype.replace,j=d,e="lastIndex",g=function(){var i=/a/,f=/b*/g;return d.call(i,"a"),d.call(f,"a"),i[e]!==0||f[e]!==0}(),h=/()??/.exec("")[1]!==void 0,q=g||h;q&&(j=function i(f){var b=this,k,l,a,c;return h&&(l=new RegExp("^"+b.source+"$(?!\\s)",o.call(b))),g&&(k=b[e]),a=d.call(b,f),g&&a&&(b[e]=b.global?a.index+a[0].length:k),h&&a&&a.length>1&&p.call(a[0],l,function(){for(c=1;c<arguments.length-2;c++)arguments[c]===void 0&&(a[c]=void 0)}),a}),n.exports=j},261(){"use strict";var b=k$(129);k$(68)({target:"RegExp",proto:!0,forced:b!==/./.exec},{exec:b})},262(){k$(64)&&/./g.flags!="g"&&k$(107).f(RegExp.prototype,"flags",{configurable:!0,get:k$(72)})},267(){"use strict";k$(262);var g=k$(42),h=k$(72),i=k$(64),c="toString",d=/./[c],f=function(e){k$(127)(RegExp.prototype,c,e,!0)};k$(70)(function(){return d.call({source:"a",flags:"b"})!="/a/b"})?f(function e(){var b=g(this);return"/".concat(b.source,"/","flags"in b?b.flags:!i&&b instanceof RegExp?h.call(b):void 0)}):d.name!=c&&f(function e(){return d.call(this)})},40(g,c){"use strict";var d=k$(141)(!0);c.exports=function(e,a,f){return a+(f?d(e,a).length:1)}},128(i,f){"use strict";var g=k$(52),h=RegExp.prototype.exec;f.exports=function(a,b){var c=a.exec;if(typeof c==="function"){var d=c.call(a,b);if(typeof d!=="object")throw new TypeError("RegExp exec method returned something other than an Object or null");return d}if(g(a)!=="RegExp")throw new TypeError("RegExp#exec called on incompatible receiver");return h.call(a,b)}},71(B,p){"use strict";k$(261);var q=k$(127),r=k$(78),h=k$(70),s=k$(63),k=k$(164),t=k$(129),u=k("species"),v=!h(function(){var a=/./;return a.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(a,"$<a>")!=="7"}),w=function(){var a=/(?:)/,e=a.exec;a.exec=function(){return e.apply(this,arguments)};var f="ab".split(a);return f.length===2&&f[0]==="a"&&f[1]==="b"}();p.exports=function(a,e,f){var g=k(a),i=!h(function(){var b={};return b[g]=function(){return 7},""[a](b)!=7}),x=i?!h(function(){var b=!1,c=/a/;return c.exec=function(){return b=!0,null},a==="split"&&(c.constructor={},c.constructor[u]=function(){return c}),c[g](""),!b}):void 0;if(!i||!x||a==="replace"&&!v||a==="split"&&!w){var y=/./[g],l=f(s,g,""[a],function b(c,j,n,o,A){return j.exec===t?i&&!A?{done:!0,value:y.call(j,n,o)}:{done:!0,value:c.call(n,j,o)}:{done:!1}}),z=l[0],m=l[1];q(String.prototype,a,z),r(RegExp.prototype,g,e==2?function(b,c){return m.call(b,this,c)}:function(b){return m.call(b,this)})}}},263(){"use strict";var l=k$(42),m=k$(153),n=k$(40),g=k$(128);k$(71)("match",1,function(o,h,p,q){return[function e(b){var a=o(this),c=b==void 0?void 0:b[h];return c!==void 0?c.call(b,a):new RegExp(b)[h](String(a))},function(e){var b=q(p,e,this);if(b.done)return b.value;var a=l(e),c=String(this);if(!a.global)return g(a,c);var r=a.unicode;a.lastIndex=0;for(var i=[],f=0,j;(j=g(a,c))!==null;){var k=String(j[0]);i[f]=k,k===""&&(a.lastIndex=n(c,m(a.lastIndex),r)),f++}return f===0?null:i}]})},264(){"use strict";var y=k$(42),z=k$(154),A=k$(153),B=k$(151),C=k$(40),D=k$(128),E=Math.max,F=Math.min,G=Math.floor,H=/\$([$&`']|\d\d?|<[^>]*>)/g,I=/\$([$&`']|\d\d?)/g,J=function(m){return m===void 0?m:String(m)};k$(71)("replace",2,function(m,K,r,L){return[function k(b,f){var c=m(this),a=b==void 0?void 0:b[K];return a!==void 0?a.call(b,c,f):r.call(String(c),b,f)},function(k,b){var f=L(r,k,this,b);if(f.done)return f.value;var c=y(k),a=String(this),o=typeof b==="function";o||(b=String(b));var p=c.global;if(p){var q=c.unicode;c.lastIndex=0}for(var l=[];;){var d=D(c,a);if(d===null)break;l.push(d);if(!p)break;var i=String(d[0]);i===""&&(c.lastIndex=C(a,A(c.lastIndex),q))}for(var j="",e=0,g=0;g<l.length;g++){d=l[g];for(var s=String(d[0]),n=E(F(B(d.index),a.length),0),t=[],u=1;u<d.length;u++)t.push(J(d[u]));var v=d.groups;if(o){var w=[s].concat(t,n,a);v!==void 0&&w.push(v);var x=String(b.apply(void 0,w))}else x=M(s,a,n,t,v,b);n>=e&&(j+=a.slice(e,n)+x,e=n+s.length)}return j+a.slice(e)}];function M(k,b,f,c,a,o){var p=f+k.length,q=c.length,l=I;return a!==void 0&&(a=z(a),l=H),r.call(o,l,function(d,i){var j;switch(i.charAt(0)){case"$":return"$";case"&":return k;case"`":return b.slice(0,f);case"'":return b.slice(p);case"<":j=a[i.slice(1,-1)];break;default:var e=+i;if(e===0)return d;if(e>q){var g=G(e/10);return g===0?d:g<=q?c[g-1]===void 0?i.charAt(1):c[g-1]+i.charAt(1):d}j=c[e-1]}return j===void 0?"":j})}})},265(){"use strict";var j=k$(42),g=k$(131),k=k$(128);k$(71)("search",1,function(l,h,m,n){return[function e(b){var a=l(this),d=b==void 0?void 0:b[h];return d!==void 0?d.call(b,a):new RegExp(b)[h](String(a))},function(e){var b=n(m,e,this);if(b.done)return b.value;var a=j(e),d=String(this),f=a.lastIndex;g(f,0)||(a.lastIndex=0);var i=k(a,d);return g(a.lastIndex,f)||(a.lastIndex=f),i===null?-1:i.index}]})},139(j,e){var b=k$(42),f=k$(37),g=k$(164)("species");e.exports=function(h,i){var c=b(h).constructor,d;return c===void 0||(d=b(c)[g])==void 0?i:f(d)}},266(){"use strict";var z=k$(88),A=k$(42),B=k$(139),C=k$(40),D=k$(153),x=k$(128),E=k$(129),F=k$(70),G=Math.min,H=[].push,k="split",e="length",t="lastIndex",u=4294967295,q=!F(function(){RegExp(u,"y")});k$(71)("split",2,function(I,J,s,K){var p;return"abbc"[k](/(b)*/)[1]=="c"||"test"[k](/(?:)/,-1)[e]!=4||"ab"[k](/(?:ab)*/)[e]!=2||"."[k](/(.?)(.?)/)[e]!=4||"."[k](/()()/)[e]>1||""[k](/.?/)[e]?p=function(c,b){var f=String(this);if(c===void 0&&b===0)return[];if(!z(c))return s.call(f,c,b);for(var a=[],d=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(c.sticky?"y":""),l=0,r=b===void 0?u:b>>>0,m=new RegExp(c.source,d+"g"),g,n,o;g=E.call(m,f);){n=m[t];if(n>l){a.push(f.slice(l,g.index)),g[e]>1&&g.index<f[e]&&H.apply(a,g.slice(1)),o=g[0][e],l=n;if(a[e]>=r)break}m[t]===g.index&&m[t]++}return l===f[e]?(o||!m.test(""))&&a.push(""):a.push(f.slice(l)),a[e]>r?a.slice(0,r):a}:"0"[k](void 0,0)[e]?p=function(c,b){return c===void 0&&b===0?[]:s.call(this,c,b)}:p=s,[function c(b,f){var a=I(this),d=b==void 0?void 0:b[J];return d!==void 0?d.call(b,a,f):p.call(String(a),b,f)},function(c,b){var f=K(p,c,this,b,p!==s);if(f.done)return f.value;var a=A(c),d=String(this),l=B(a,RegExp),r=a.unicode,m=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(q?"y":"g"),g=new l(q?a:"^(?:"+a.source+")",m),n=b===void 0?u:b>>>0;if(n===0)return[];if(d.length===0)return x(g,d)===null?[d]:[];for(var o=0,i=0,j=[];i<d.length;){g.lastIndex=q?i:0;var v=x(g,q?d:d.slice(i)),y;if(v===null||(y=G(D(g.lastIndex+(q?0:i)),d.length))===o)i=C(d,i,r);else{j.push(d.slice(o,i));if(j.length===n)return j;for(var w=1;w<=v.length-1;w++){j.push(v[w]);if(j.length===n)return j}i=o=y}}return j.push(d.slice(o)),j}]})},41(f,c){c.exports=function(a,d,e,b){if(!(a instanceof d)||b!==void 0&&b in a)throw TypeError(e+": incorrect invocation!");return a}},74(l,n){var o=k$(60),p=k$(89),q=k$(84),r=k$(42),s=k$(153),t=k$(165),f={},g={},l=n.exports=function(b,h,u,v,w){var i=w?function(){return b}:t(b),j=o(u,v,h?2:1),d=0,m,e,k,a;if(typeof i!="function")throw TypeError(b+" is not iterable!");if(q(i))for(m=s(b.length);m>d;d++){a=h?j(r(e=b[d])[0],e[1]):j(b[d]);if(a===f||a===g)return a}else for(k=i.call(b);!(e=k.next()).done;){a=p(k,j,e.value,h);if(a===f||a===g)return a}};l.BREAK=f,l.RETURN=g},148(y,w){var h=k$(60),x=k$(82),o=k$(79),p=k$(65),b=k$(76),q=b.process,i=b.setImmediate,j=b.clearImmediate,r=b.MessageChannel,k=b.Dispatch,l=0,f={},s="onreadystatechange",c,m,n,g=function(){var a=+this;if(f.hasOwnProperty(a)){var d=f[a];delete f[a],d()}},t=function(a){g.call(a.data)};(!i||!j)&&(i=function a(d){for(var u=[],v=1;arguments.length>v;)u.push(arguments[v++]);return f[++l]=function(){x(typeof d=="function"?d:Function(d),u)},c(l),l},j=function a(d){delete f[d]},k$(53)(q)=="process"?c=function(a){q.nextTick(h(g,a,1))}:k&&k.now?c=function(a){k.now(h(g,a,1))}:r?(m=new r(),n=m.port2,m.port1.onmessage=t,c=h(n.postMessage,n,1)):b.addEventListener&&typeof postMessage=="function"&&!b.importScripts?(c=function(a){b.postMessage(a+"","*")},b.addEventListener("message",t,!1)):s in p("script")?c=function(a){o.appendChild(p("script"))[s]=function(){o.removeChild(this),g.call(a)}}:c=function(a){setTimeout(h(g,a,1),0)}),w.exports={set:i,clear:j}},103(s,o){var a=k$(76),p=k$(148).set,k=a.MutationObserver||a.WebKitMutationObserver,i=a.process,j=a.Promise,l=k$(53)(i)=="process";o.exports=function(){var b,f,c,g=function(){var d,e;for(l&&(d=i.domain)&&d.exit();b;){e=b.fn,b=b.next;try{e()}catch(r){throw b?c():f=void 0,r}}f=void 0,d&&d.enter()};if(l)c=function(){i.nextTick(g)};else if(k&&!(a.navigator&&a.navigator.standalone)){var m=!0,n=document.createTextNode("");new k(g).observe(n,{characterData:!0}),c=function(){n.data=m=!m}}else if(j&&j.resolve){var q=j.resolve(void 0);c=function(){q.then(g)}}else c=function(){p.call(a,g)};return function(d){var e={fn:d,next:void 0};f&&(f.next=e),b||(b=e,c()),f=e}}},104(j,f){"use strict";var d=k$(37);function g(a){var b,c;this.promise=new a(function(h,i){if(b!==void 0||c!==void 0)throw TypeError("Bad Promise constructor");b=h,c=i}),this.resolve=d(b),this.reject=d(c)}f.exports.f=function(a){return new g(a)}},123(d,a){a.exports=function(b){try{return{e:!1,v:b()}}catch(c){return{e:!0,v:c}}}},160(e,c){var d=k$(76),a=d.navigator;c.exports=a&&a.userAgent||""},124(j,e){var f=k$(42),g=k$(87),h=k$(104);e.exports=function(c,a){f(c);if(g(a)&&a.constructor===c)return a;var d=h.f(c),i=d.resolve;return i(a),d.promise}},126(h,e){var f=k$(127);e.exports=function(a,b,g){for(var c in b)f(a,c,b[c],g);return a}},245(){"use strict";var F=k$(95),l=k$(76),o=k$(60),R=k$(52),f=k$(68),S=k$(87),T=k$(37),U=k$(41),G=k$(74),V=k$(139),H=k$(148).set,I=k$(103)(),J=k$(104),B=k$(123),W=k$(160),X=k$(124),m="Promise",K=l.TypeError,p=l.process,L=p&&p.versions,Y=L&&L.v8||"",j=l[m],u=R(p)=="process",y=function(){},z,M,N,C,v=M=J.f,w=!!function(){try{var a=j.resolve(1),b=(a.constructor={})[k$(164)("species")]=function(d){d(y,y)};return(u||typeof PromiseRejectionEvent=="function")&&a.then(y)instanceof b&&Y.indexOf("6.6")!==0&&W.indexOf("Chrome/66")===-1}catch(d){}}(),O=function(a){var b;return S(a)&&typeof(b=a.then)=="function"?b:!1},D=function(a,b){if(a._n)return;a._n=!0;var d=a._c;I(function(){for(var c=a._v,g=a._s==1,h=0,r=function(i){var x=g?i.ok:i.fail,s=i.resolve,t=i.reject,n=i.domain,k,A,Q;try{x?(g||(a._h==2&&_(a),a._h=1),x===!0?k=c:(n&&n.enter(),k=x(c),n&&(n.exit(),Q=!0)),k===i.promise?t(K("Promise-chain cycle")):(A=O(k))?A.call(k,s,t):s(k)):t(c)}catch($){n&&!Q&&n.exit(),t($)}};d.length>h;)r(d[h++]);a._c=[],a._n=!1,b&&!a._h&&Z(a)})},Z=function(a){H.call(l,function(){var b=a._v,d=P(a),c,g,h;d&&(c=B(function(){u?p.emit("unhandledRejection",b,a):(g=l.onunhandledrejection)?g({promise:a,reason:b}):(h=l.console)&&h.error&&h.error("Unhandled promise rejection",b)}),a._h=u||P(a)?2:1),a._a=void 0;if(d&&c.e)throw c.v})},P=function(a){return a._h!==1&&(a._a||a._c).length===0},_=function(a){H.call(l,function(){var b;u?p.emit("rejectionHandled",a):(b=l.onrejectionhandled)&&b({promise:a,reason:a._v})})},q=function(a){var b=this;if(b._d)return;b._d=!0,b=b._w||b,b._v=a,b._s=2,b._a||(b._a=b._c.slice()),D(b,!0)},E=function(a){var b=this,d;if(b._d)return;b._d=!0,b=b._w||b;try{if(b===a)throw K("Promise can't be resolved itself");(d=O(a))?I(function(){var c={_w:b,_d:!1};try{d.call(a,o(E,c,1),o(q,c,1))}catch(g){q.call(c,g)}}):(b._v=a,b._s=1,D(b,!1))}catch(c){q.call({_w:b,_d:!1},c)}};w||(j=function a(b){U(this,j,m,"_h"),T(b),z.call(this);try{b(o(E,this,1),o(q,this,1))}catch(d){q.call(this,d)}},z=function a(b){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},z.prototype=k$(126)(j.prototype,{then:function a(b,d){var c=v(V(this,j));return c.ok=typeof b=="function"?b:!0,c.fail=typeof d=="function"&&d,c.domain=u?p.domain:void 0,this._c.push(c),this._a&&this._a.push(c),this._s&&D(this,!1),c.promise},catch:function(a){return this.then(void 0,a)}}),N=function(){var a=new z();this.promise=a,this.resolve=o(E,a,1),this.reject=o(q,a,1)},J.f=v=function(a){return a===j||a===C?new N(a):M(a)}),f(f.G+f.W+f.F*!w,{Promise:j}),k$(136)(j,m),k$(135)(m),C=k$(58)[m],f(f.S+f.F*!w,m,{reject:function a(b){var d=v(this),c=d.reject;return c(b),d.promise}}),f(f.S+f.F*(F||!w),m,{resolve:function a(b){return X(F&&this===C?j:this,b)}}),f(f.S+f.F*!(w&&k$(92)(function(a){j.all(a).catch(y)})),m,{all:function a(b){var d=this,c=v(d),g=c.resolve,h=c.reject,r=B(function(){var i=[],x=0,s=1;G(b,!1,function(t){var n=x++,k=!1;i.push(void 0),s++,d.resolve(t).then(function(A){if(k)return;k=!0,i[n]=A,--s||g(i)},h)}),--s||g(i)});return r.e&&h(r.v),c.promise},race:function a(b){var d=this,c=v(d),g=c.reject,h=B(function(){G(b,!1,function(r){d.resolve(r).then(c.resolve,g)})});return h.e&&g(h.v),c.promise}})},161(f,d){var e=k$(87);d.exports=function(a,b){if(!e(a)||a._t!==b)throw TypeError("Incompatible receiver, "+b+" required!");return a}},54(A,r){"use strict";var s=k$(107).f,t=k$(106),u=k$(126),v=k$(60),w=k$(41),x=k$(74),y=k$(91),m=k$(93),z=k$(135),p=k$(64),q=k$(101).fastKey,k=k$(161),l=p?"_s":"size",n=function(f,e){var j=q(e),b;if(j!=="F")return f._i[j];for(b=f._f;b;b=b.n)if(b.k==e)return b};r.exports={getConstructor:function(f,e,j,b){var g=f(function(a,d){w(a,g,e,"_i"),a._t=e,a._i=t(null),a._f=void 0,a._l=void 0,a[l]=0,d!=void 0&&x(d,j,a[b],a)});return u(g.prototype,{clear:function a(){for(var d=k(this,e),i=d._i,c=d._f;c;c=c.n)c.r=!0,c.p&&(c.p=c.p.n=void 0),delete i[c.i];d._f=d._l=void 0,d[l]=0},delete:function(a){var d=k(this,e),i=n(d,a);if(i){var c=i.n,o=i.p;delete d._i[i.i],i.r=!0,o&&(o.n=c),c&&(c.p=o),d._f==i&&(d._f=c),d._l==i&&(d._l=o),d[l]--}return!!i},forEach:function a(d){k(this,e);for(var i=v(d,arguments.length>1?arguments[1]:void 0,3),c;c=c?c.n:this._f;)for(i(c.v,c.k,this);c&&c.r;)c=c.p},has:function a(d){return!!n(k(this,e),d)}}),p&&s(g.prototype,"size",{get:function(){return k(this,e)[l]}}),g},def:function(f,e,j){var b=n(f,e),g,a;return b?b.v=j:(f._l=b={i:a=q(e,!0),k:e,v:j,p:g=f._l,n:void 0,r:!1},f._f||(f._f=b),g&&(g.n=b),f[l]++,a!=="F"&&(f._i[a]=b)),f},getEntry:n,setStrong:function(f,e,j){y(f,e,function(b,g){this._t=k(b,e),this._k=g,this._l=void 0},function(){for(var b=this,g=b._k,a=b._l;a&&a.r;)a=a.p;return!b._t||!(b._l=a=a?a.n:b._t._f)?(b._t=void 0,m(1)):g=="keys"?m(0,a.k):g=="values"?m(0,a.v):m(0,[a.k,a.v])},j?"entries":"values",!j,!0),z(e)}}},57(K,v){"use strict";var w=k$(76),l=k$(68),x=k$(127),y=k$(126),z=k$(101),A=k$(74),B=k$(41),n=k$(87),o=k$(70),C=k$(92),D=k$(136),E=k$(81);v.exports=function(i,r,F,s,j,g){var p=w[i],a=p,k=j?"set":"add",h=a&&a.prototype,t={},m=function(b){var e=h[b];x(h,b,b=="delete"?function(f){return g&&!n(f)?!1:e.call(this,f===0?0:f)}:b=="has"?function f(c){return g&&!n(c)?!1:e.call(this,c===0?0:c)}:b=="get"?function f(c){return g&&!n(c)?void 0:e.call(this,c===0?0:c)}:b=="add"?function f(c){return e.call(this,c===0?0:c),this}:function f(c,J){return e.call(this,c===0?0:c,J),this})};if(typeof a!="function"||!(g||h.forEach&&!o(function(){new a().entries().next()})))a=s.getConstructor(r,i,j,k),y(a.prototype,F),z.NEED=!0;else{var q=new a(),G=q[k](g?{}:-0,1)!=q,H=o(function(){q.has(1)}),I=C(function(b){new a(b)}),u=!g&&o(function(){for(var b=new a(),e=5;e--;)b[k](e,e);return!b.has(-0)});I||(a=r(function(b,e){B(b,a,i);var f=E(new p(),b,a);return e!=void 0&&A(e,j,f[k],f),f}),a.prototype=h,h.constructor=a),(H||u)&&(m("delete"),m("has"),j&&m("get")),(u||G)&&m(k),g&&h.clear&&delete h.clear}return D(a,i),t[i]=a,l(l.G+l.W+l.F*(a!=p),t),g||s.setStrong(a,i,j),a}},196(i,h){"use strict";var d=k$(54),g=k$(161),e="Map";h.exports=k$(57)(e,function(f){return function a(){return f(this,arguments.length>0?arguments[0]:void 0)}},{get:function f(a){var b=d.getEntry(g(this,e),a);return b&&b.v},set:function f(a,b){return d.def(g(this,e),a===0?0:a,b)}},d,!0)},268(h,f){"use strict";var c=k$(54),g=k$(161),d="Set";f.exports=k$(57)(d,function(e){return function a(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function e(a){return c.def(g(this,d),a=a===0?0:a,a)}},c)},56(z,r){"use strict";var s=k$(126),i=k$(101).getWeak,t=k$(42),m=k$(87),u=k$(41),v=k$(74),n=k$(47),o=k$(77),p=k$(161),w=n(5),x=n(6),y=0,g=function(a){return a._l||(a._l=new q())},q=function(){this.a=[]},j=function(a,b){return w(a.a,function(c){return c[0]===b})};q.prototype={get:function(a){var b=j(this,a);if(b)return b[1]},has:function(a){return!!j(this,a)},set:function(a,b){var c=j(this,a);c?c[1]=b:this.a.push([a,b])},delete:function(a){var b=x(this.a,function(c){return c[0]===a});return~b&&this.a.splice(b,1),!!~b}},r.exports={getConstructor:function(a,b,c,h){var k=a(function(d,e){u(d,k,b,"_i"),d._t=b,d._i=y++,d._l=void 0,e!=void 0&&v(e,c,d[h],d)});return s(k.prototype,{delete:function(d){if(!m(d))return!1;var e=i(d);return e===!0?g(p(this,b)).delete(d):e&&o(e,this._i)&&delete e[this._i]},has:function d(e){if(!m(e))return!1;var l=i(e);return l===!0?g(p(this,b)).has(e):l&&o(l,this._i)}}),k},def:function(a,b,c){var h=i(t(b),!0);return h===!0?g(a).set(b,c):h[a._i]=c,a},ufstore:g}},303(A,p){"use strict";var i=k$(76),q=k$(47)(0),r=k$(127),j=k$(101),s=k$(105),e=k$(56),k=k$(87),l=k$(161),t=k$(161),u=!i.ActiveXObject&&"ActiveXObject"in i,f="WeakMap",v=j.getWeak,w=Object.isExtensible,x=e.ufstore,h,m=function(c){return function b(){return c(this,arguments.length>0?arguments[0]:void 0)}},n={get:function c(b){if(k(b)){var d=v(b);return d===!0?x(l(this,f)).get(b):d?d[this._i]:void 0}},set:function c(b,d){return e.def(l(this,f),b,d)}},y=p.exports=k$(57)(f,m,n,e,!0,!0);t&&u&&(h=e.getConstructor(m,f),s(h.prototype,n),j.NEED=!0,q(["delete","has","get","set"],function(c){var b=y.prototype,d=b[c];r(b,c,function(g,o){if(k(g)&&!w(g)){this._f||(this._f=new h());var z=this._f[c](g,o);return c=="set"?this:z}return d.call(this,g,o)})}))},304(){"use strict";var b=k$(56),f=k$(161),c="WeakSet";k$(57)(c,function(d){return function e(){return d(this,arguments.length>0?arguments[0]:void 0)}},{add:function d(e){return b.def(f(this,c),e,!0)}},b,!1,!0)},158(n,k){for(var b=k$(76),d=k$(78),e=k$(159),f=e("typed_array"),g=e("view"),h=!!(b.ArrayBuffer&&b.DataView),i=h,j=0,l=9,c,m="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");j<l;)(c=b[m[j++]])?(d(c.prototype,f,!0),d(c.prototype,g,!0)):i=!1;k.exports={ABV:h,CONSTR:i,TYPED:f,VIEW:g}},150(h,e){var f=k$(151),g=k$(153);e.exports=function(b){if(b===void 0)return 0;var c=f(b),d=g(c);if(c!==d)throw RangeError("Wrong length!");return d}},157(M){"use strict";var u=k$(76),z=k$(64),ba=k$(95),N=k$(158),O=k$(78),P=k$(126),G=k$(70),A=k$(41),ca=k$(151),da=k$(153),B=k$(150),ea=k$(112).f,fa=k$(107).f,ga=k$(44),Q=k$(136),v="ArrayBuffer",w="DataView",s="prototype",ha="Wrong length!",R="Wrong index!",e=u[v],o=u[w],x=u.Math,C=u.RangeError,H=u.Infinity,D=e,ia=x.abs,p=x.pow,ja=x.floor,ka=x.log,la=x.LN2,S="buffer",I="byteLength",T="byteOffset",J=z?"_b":S,y=z?"_l":I,K=z?"_o":T;function U(a,b,c){var h=new Array(c),j=c*8-b-1,f=(1<<j)-1,g=f>>1,k=b===23?p(2,-24)-p(2,-77):0,m=0,l=a<0||a===0&&1/a<0?1:0,d,n,t;for(a=ia(a),a!=a||a===H?(n=a!=a?1:0,d=f):(d=ja(ka(a)/la),a*(t=p(2,-d))<1&&(d--,t*=2),d+g>=1?a+=k/t:a+=k*p(2,1-g),a*t>=2&&(d++,t/=2),d+g>=f?(n=0,d=f):d+g>=1?(n=(a*t-1)*p(2,b),d=d+g):(n=a*p(2,g-1)*p(2,b),d=0));b>=8;h[m++]=n&255,n/=256,b-=8);for(d=d<<b|n,j+=b;j>0;h[m++]=d&255,d/=256,j-=8);return h[--m]|=l*128,h}function V(a,b,c){var h=c*8-b-1,j=(1<<h)-1,f=j>>1,g=h-7,k=c-1,m=a[k--],l=m&127,d;for(m>>=7;g>0;l=l*256+a[k],k--,g-=8);for(d=l&(1<<-g)-1,l>>=-g,g+=b;g>0;d=d*256+a[k],k--,g-=8);if(l===0)l=1-f;else{if(l===j)return d?NaN:m?-H:H;d=d+p(2,b),l=l-f}return(m?-1:1)*d*p(2,l-b)}function W(a){return a[3]<<24|a[2]<<16|a[1]<<8|a[0]}function X(a){return[a&255]}function Y(a){return[a&255,a>>8&255]}function Z(a){return[a&255,a>>8&255,a>>16&255,a>>24&255]}function ma(a){return U(a,52,8)}function na(a){return U(a,23,4)}function E(a,b,c){fa(a[s],b,{get:function(){return this[c]}})}function q(a,b,c,h){var j=+c,f=B(j);if(f+b>a[y])throw C(R);var g=a[J]._b,k=f+a[K],m=g.slice(k,k+b);return h?m:m.reverse()}function r(a,b,c,h,j,f){var g=+c,k=B(g);if(k+b>a[y])throw C(R);for(var m=a[J]._b,l=k+a[K],d=h(+j),n=0;n<b;n++)m[l+n]=d[f?n:b-n-1]}if(!N.ABV)e=function a(b){A(this,e,v);var c=B(b);this._b=ga.call(new Array(c),0),this[y]=c},o=function a(b,c,h){A(this,o,w),A(b,e,w);var j=b[y],f=ca(c);if(f<0||f>j)throw C("Wrong offset!");h=h===void 0?j-f:da(h);if(f+h>j)throw C(ha);this[J]=b,this[K]=f,this[y]=h},z&&(E(e,I,"_l"),E(o,S,"_b"),E(o,I,"_l"),E(o,T,"_o")),P(o[s],{getInt8:function a(b){return q(this,1,b)[0]<<24>>24},getUint8:function a(b){return q(this,1,b)[0]},getInt16:function a(b){var c=q(this,2,b,arguments[1]);return(c[1]<<8|c[0])<<16>>16},getUint16:function a(b){var c=q(this,2,b,arguments[1]);return c[1]<<8|c[0]},getInt32:function a(b){return W(q(this,4,b,arguments[1]))},getUint32:function a(b){return W(q(this,4,b,arguments[1]))>>>0},getFloat32:function a(b){return V(q(this,4,b,arguments[1]),23,4)},getFloat64:function a(b){return V(q(this,8,b,arguments[1]),52,8)},setInt8:function a(b,c){r(this,1,b,X,c)},setUint8:function a(b,c){r(this,1,b,X,c)},setInt16:function a(b,c){r(this,2,b,Y,c,arguments[2])},setUint16:function a(b,c){r(this,2,b,Y,c,arguments[2])},setInt32:function a(b,c){r(this,4,b,Z,c,arguments[2])},setUint32:function a(b,c){r(this,4,b,Z,c,arguments[2])},setFloat32:function a(b,c){r(this,4,b,na,c,arguments[2])},setFloat64:function a(b,c){r(this,8,b,ma,c,arguments[2])}});else{if(!G(function(){e(1)})||!G(function(){new e(-1)})||G(function(){return new e(),new e(1.5),new e(NaN),e.name!=v})){e=function a(b){return A(this,e),new D(B(b))};for(var oa=e[s]=D[s],_=ea(D),$=0,L;_.length>$;)(L=_[$++])in e||O(e,L,D[L]);ba||(oa.constructor=e)}var F=new o(new e(2)),aa=o[s].setInt8;F.setInt8(0,2147483648),F.setInt8(1,2147483649),(F.getInt8(0)||!F.getInt8(1))&&P(o[s],{setInt8:function a(b,c){aa.call(this,b,c<<24>>24)},setUint8:function a(b,c){aa.call(this,b,c<<24>>24)}},!0)}Q(e,v),Q(o,w),O(o[s],N.VIEW,!0),M[v]=e,M[w]=o},292(){"use strict";var b=k$(68),e=k$(158),j=k$(157),k=k$(42),l=k$(149),s=k$(153),t=k$(87),m=k$(76).ArrayBuffer,u=k$(139),d=j.ArrayBuffer,n=j.DataView,o=e.ABV&&m.isView,p=d.prototype.slice,v=e.VIEW,f="ArrayBuffer";b(b.G+b.W+b.F*(m!==d),{ArrayBuffer:d}),b(b.S+b.F*!e.CONSTR,f,{isView:function w(c){return o&&o(c)||t(c)&&v in c}}),b(b.P+b.U+b.F*k$(70)(function(){return!new d(2).slice(1,void 0).byteLength}),f,{slice:function w(c,g){if(p!==void 0&&g===void 0)return p.call(k(this),c);for(var h=k(this).byteLength,i=l(c,h),q=l(g===void 0?h:g,h),r=new(u(this,d))(s(q-i)),x=new n(this),y=new n(r),z=0;i<q;)y.setUint8(z++,x.getUint8(i++));return r}}),k$(135)(f)},293(){var a=k$(68);a(a.G+a.W+a.F*!k$(158).ABV,{DataView:k$(157).DataView})},156(wb,ia){"use strict";if(k$(64)){var X=k$(95),K=k$(76),p=k$(70),i=k$(68),L=k$(158),ja=k$(157),Oa=k$(60),ka=k$(41),Pa=k$(125),q=k$(78),Y=k$(126),Qa=k$(151),M=k$(153),la=k$(150),ma=k$(149),na=k$(155),B=k$(77),oa=k$(52),x=k$(87),pa=k$(154),Ra=k$(84),Sa=k$(106),Ta=k$(114),Z=k$(112).f,Ua=k$(165),qa=k$(159),ra=k$(164),w=k$(47),sa=k$(46),_=k$(139),$=k$(177),Va=k$(94),Wa=k$(92),Xa=k$(135),Ya=k$(44),Za=k$(43),ta=k$(107),ua=k$(110),C=ta.f,_a=ua.f,D=K.RangeError,va=K.TypeError,y=K.Uint8Array,aa="ArrayBuffer",wa="Shared"+aa,xa="BYTES_PER_ELEMENT",E="prototype",t=Array[E],ba=ja.ArrayBuffer,$a=ja.DataView,ya=w(0),ab=w(2),bb=w(3),cb=w(4),db=w(5),eb=w(6),fb=sa(!0),gb=sa(!1),hb=$.values,ib=$.keys,jb=$.entries,kb=t.lastIndexOf,lb=t.reduce,mb=t.reduceRight,za=t.join,nb=t.sort,Aa=t.slice,F=t.toString,ca=t.toLocaleString,da=ra("iterator"),N=ra("toStringTag"),Ba=qa("typed_constructor"),O=qa("def_constructor"),Ca=L.CONSTR,z=L.TYPED,ob=L.VIEW,P="Wrong length!",pb=w(1,function(b,a){return R(_(b,b[O]),a)}),Da=p(function(){return new y(new Uint16Array([1]).buffer)[0]===1}),qb=!!y&&!!y[E].set&&p(function(){new y(1).set({})}),Q=function(b,a){var c=Qa(b);if(c<0||c%a)throw D("Wrong offset!");return c},j=function(b){if(x(b)&&z in b)return b;throw va(b+" is not a typed array!")},R=function(b,a){if(!(x(b)&&Ba in b))throw va("It is not a typed array constructor!");return new b(a)},Ea=function(b,a){return ea(_(b,b[O]),a)},ea=function(b,a){for(var c=0,f=a.length,g=R(b,f);f>c;)g[c]=a[c++];return g},S=function(b,a,c){C(b,a,{get:function(){return this._d[c]}})},fa=function b(a){var c=pa(a),f=arguments.length,g=f>1?arguments[1]:void 0,n=g!==void 0,s=Ua(c),d,o,A,G,H,k;if(s!=void 0&&!Ra(s)){for(k=s.call(c),A=[],d=0;!(H=k.next()).done;d++)A.push(H.value);c=A}for(n&&f>2&&(g=Oa(g,arguments[2],2)),d=0,o=M(c.length),G=R(this,o);o>d;d++)G[d]=n?g(c[d],d):c[d];return G},rb=function b(){for(var a=0,c=arguments.length,f=R(this,c);c>a;)f[a]=arguments[a++];return f},sb=!!y&&p(function(){ca.call(new y(1))}),Fa=function b(){return ca.apply(sb?Aa.call(j(this)):j(this),arguments)},Ga={copyWithin:function b(a,c){return Za.call(j(this),a,c,arguments.length>2?arguments[2]:void 0)},every:function b(a){return cb(j(this),a,arguments.length>1?arguments[1]:void 0)},fill:function b(a){return Ya.apply(j(this),arguments)},filter:function b(a){return Ea(this,ab(j(this),a,arguments.length>1?arguments[1]:void 0))},find:function b(a){return db(j(this),a,arguments.length>1?arguments[1]:void 0)},findIndex:function b(a){return eb(j(this),a,arguments.length>1?arguments[1]:void 0)},forEach:function b(a){ya(j(this),a,arguments.length>1?arguments[1]:void 0)},indexOf:function b(a){return gb(j(this),a,arguments.length>1?arguments[1]:void 0)},includes:function b(a){return fb(j(this),a,arguments.length>1?arguments[1]:void 0)},join:function b(a){return za.apply(j(this),arguments)},lastIndexOf:function b(a){return kb.apply(j(this),arguments)},map:function b(a){return pb(j(this),a,arguments.length>1?arguments[1]:void 0)},reduce:function b(a){return lb.apply(j(this),arguments)},reduceRight:function b(a){return mb.apply(j(this),arguments)},reverse:function b(){for(var a=this,c=j(a).length,f=Math.floor(c/2),g=0,n;g<f;)n=a[g],a[g++]=a[--c],a[c]=n;return a},some:function b(a){return bb(j(this),a,arguments.length>1?arguments[1]:void 0)},sort:function b(a){return nb.call(j(this),a)},subarray:function b(a,c){var f=j(this),g=f.length,n=ma(a,g);return new(_(f,f[O]))(f.buffer,f.byteOffset+n*f.BYTES_PER_ELEMENT,M((c===void 0?g:ma(c,g))-n))}},Ha=function b(a,c){return Ea(this,Aa.call(j(this),a,c))},Ia=function b(a){j(this);var c=Q(arguments[1],1),f=this.length,g=pa(a),n=M(g.length),s=0;if(n+c>f)throw D(P);for(;s<n;)this[c+s]=g[s++]},T={entries:function b(){return jb.call(j(this))},keys:function b(){return ib.call(j(this))},values:function b(){return hb.call(j(this))}},Ja=function(b,a){return x(b)&&b[z]&&typeof a!="symbol"&&a in b&&String(+a)==String(a)},Ka=function b(a,c){return Ja(a,c=na(c,!0))?Pa(2,a[c]):_a(a,c)},La=function b(a,c,f){return Ja(a,c=na(c,!0))&&x(f)&&B(f,"value")&&!B(f,"get")&&!B(f,"set")&&!f.configurable&&(!B(f,"writable")||f.writable)&&(!B(f,"enumerable")||f.enumerable)?(a[c]=f.value,a):C(a,c,f)};Ca||(ua.f=Ka,ta.f=La),i(i.S+i.F*!Ca,"Object",{getOwnPropertyDescriptor:Ka,defineProperty:La}),p(function(){F.call({})})&&(F=ca=function b(){return za.call(this)});var r=Y({},Ga);Y(r,T),q(r,da,T.values),Y(r,{slice:Ha,set:Ia,constructor:function(){},toString:F,toLocaleString:Fa}),S(r,"buffer","b"),S(r,"byteOffset","o"),S(r,"byteLength","l"),S(r,"length","e"),C(r,N,{get:function(){return this[z]}}),ia.exports=function(b,a,c,f){f=!!f;var g=b+(f?"Clamped":"")+"Array",n="get"+b,s="set"+b,d=K[g],o=d||{},A=d&&Ta(d),G=!d||!L.ABV,H={},k=d&&d[E],tb=function(l,h){var m=l._d;return m.v[n](h*a+m.o,Da)},ub=function(l,h,m){var u=l._d;f&&(m=(m=Math.round(m))<0?0:m>255?255:m&255),u.v[s](h*a+u.o,m,Da)},vb=function(l,h){C(l,h,{get:function(){return tb(this,h)},set:function(m){return ub(this,h,m)},enumerable:!0})};G?(d=c(function(l,h,m,u){ka(l,d,g,"_d");var I=0,V=0,W,v,J,Na;if(!x(h))J=la(h),v=J*a,W=new ba(v);else if(h instanceof ba||(Na=oa(h))==aa||Na==wa){W=h,V=Q(m,a);var ha=h.byteLength;if(u===void 0){if(ha%a)throw D(P);v=ha-V;if(v<0)throw D(P)}else{v=M(u)*a;if(v+V>ha)throw D(P)}J=v/a}else return z in h?ea(d,h):fa.call(d,h);for(q(l,"_d",{b:W,o:V,l:v,e:J,v:new $a(W)});I<J;)vb(l,I++)}),k=d[E]=Sa(r),q(k,"constructor",d)):(!p(function(){d(1)})||!p(function(){new d(-1)})||!Wa(function(l){new d(),new d(null),new d(1.5),new d(l)},!0))&&(d=c(function(l,h,m,u){ka(l,d,g);var I;return x(h)?h instanceof ba||(I=oa(h))==aa||I==wa?u!==void 0?new o(h,Q(m,a),u):m!==void 0?new o(h,Q(m,a)):new o(h):z in h?ea(d,h):fa.call(d,h):new o(la(h))}),ya(A!==Function.prototype?Z(o).concat(Z(A)):Z(o),function(l){l in d||q(d,l,o[l])}),d[E]=k,X||(k.constructor=d));var U=k[da],ga=!!U&&(U.name=="values"||U.name==void 0),Ma=T.values;q(d,Ba,!0),q(k,z,g),q(k,ob,!0),q(k,O,d),(f?new d(1)[N]!=g:!(N in k))&&C(k,N,{get:function(){return g}}),H[g]=d,i(i.G+i.W+i.F*(d!=o),H),i(i.S,g,{BYTES_PER_ELEMENT:a}),i(i.S+i.F*p(function(){o.of.call(d,1)}),g,{from:fa,of:rb}),xa in k||q(k,xa,a),i(i.P,g,Ga),Xa(g),i(i.P+i.F*qb,g,{set:Ia}),i(i.P+i.F*!ga,g,T),!X&&k.toString!=F&&(k.toString=F),i(i.P+i.F*p(function(){new d(1).slice()}),g,{slice:Ha}),i(i.P+i.F*(p(function(){return[1,2].toLocaleString()!=new d([1,2]).toLocaleString()})||!p(function(){k.toLocaleString.call([1,2])})),g,{toLocaleString:Fa}),Va[g]=ga?U:Ma,!X&&!ga&&q(k,da,Ma)}}else ia.exports=function(){}},298(){k$(156)("Int8",1,function(b){return function h(c,d,e){return b(this,c,d,e)}})},301(){k$(156)("Uint8",1,function(b){return function h(c,d,e){return b(this,c,d,e)}})},302(){k$(156)("Uint8",1,function(b){return function h(c,d,e){return b(this,c,d,e)}},!0)},296(){k$(156)("Int16",2,function(b){return function h(c,d,e){return b(this,c,d,e)}})},299(){k$(156)("Uint16",2,function(b){return function h(c,d,e){return b(this,c,d,e)}})},297(){k$(156)("Int32",4,function(b){return function h(c,d,e){return b(this,c,d,e)}})},300(){k$(156)("Uint32",4,function(b){return function h(c,d,e){return b(this,c,d,e)}})},294(){k$(156)("Float32",4,function(b){return function h(c,d,e){return b(this,c,d,e)}})},295(){k$(156)("Float64",8,function(b){return function h(c,d,e){return b(this,c,d,e)}})},246(){var b=k$(68),g=k$(37),h=k$(42),c=(k$(76).Reflect||{}).apply,i=Function.apply;b(b.S+b.F*!k$(70)(function(){c(function(){})}),"Reflect",{apply:function n(j,d,k){var e=g(j),f=h(k);return c?c(e,d,f):i.call(e,d,f)}})},247(){var d=k$(68),q=k$(106),i=k$(37),r=k$(42),j=k$(87),k=k$(70),s=k$(51),e=(k$(76).Reflect||{}).construct,l=k(function(){function f(){}return!(e(function(){},[],f)instanceof f)}),m=!k(function(){e(function(){})});d(d.S+d.F*(l||m),"Reflect",{construct:function f(b,a){i(b),r(a);var g=arguments.length<3?b:i(arguments[2]);if(m&&!l)return e(b,a,g);if(b==g){switch(a.length){case 0:return new b();case 1:return new b(a[0]);case 2:return new b(a[0],a[1]);case 3:return new b(a[0],a[1],a[2]);case 4:return new b(a[0],a[1],a[2],a[3])}var h=[null];return h.push.apply(h,a),new(s.apply(b,h))()}var n=g.prototype,o=q(j(n)?n:Object.prototype),p=Function.apply.call(b,o,a);return j(p)?p:o}})},248(){var d=k$(107),b=k$(68),e=k$(42),h=k$(155);b(b.S+b.F*k$(70)(function(){Reflect.defineProperty(d.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function k(f,c,g){e(f),c=h(c,!0),e(g);try{return d.f(f,c,g),!0}catch(l){return!1}}})},249(){var b=k$(68),f=k$(110).f,g=k$(42);b(b.S,"Reflect",{deleteProperty:function j(c,d){var e=f(g(c),d);return e&&!e.configurable?!1:delete c[d]}})},250(){"use strict";var e=k$(68),g=k$(42),f=function(a){this._t=g(a),this._i=0;var b=this._k=[],c;for(c in a)b.push(c)};k$(90)(f,"Object",function(){var a=this,b=a._k,c;do if(a._i>=b.length)return{value:void 0,done:!0};while(!((c=b[a._i++])in a._t));return{value:c,done:!1}}),e(e.S,"Reflect",{enumerate:function a(b){return new f(b)}})},253(){var i=k$(110),j=k$(114),k=k$(77),f=k$(68),l=k$(87),m=k$(42);function g(b,d){var e=arguments.length<3?b:arguments[2],c,h;if(m(b)===e)return b[d];if(c=i.f(b,d))return k(c,"value")?c.value:c.get!==void 0?c.get.call(e):void 0;if(l(h=j(b)))return g(h,d,e)}f(f.S,"Reflect",{get:g})},251(){var c=k$(110),b=k$(68),d=k$(42);b(b.S,"Reflect",{getOwnPropertyDescriptor:function i(e,f){return c.f(d(e),f)}})},252(){var b=k$(68),c=k$(114),d=k$(42);b(b.S,"Reflect",{getPrototypeOf:function h(e){return c(d(e))}})},254(){var a=k$(68);a(a.S,"Reflect",{has:function g(c,d){return d in c}})},255(){var b=k$(68),e=k$(42),c=Object.isExtensible;b(b.S,"Reflect",{isExtensible:function h(d){return e(d),c?c(d):!0}})},120(j,f){var g=k$(112),h=k$(113),i=k$(42),b=k$(76).Reflect;f.exports=b&&b.ownKeys||function k(c){var d=g.f(i(c)),e=h.f;return e?d.concat(e(c)):d}},256(){var b=k$(68);b(b.S,"Reflect",{ownKeys:k$(120)})},257(){var b=k$(68),e=k$(42),c=Object.preventExtensions;b(b.S,"Reflect",{preventExtensions:function h(d){e(d);try{return c&&c(d),!0}catch(i){return!1}}})},259(){var h=k$(107),i=k$(110),o=k$(114),p=k$(77),j=k$(68),k=k$(125),q=k$(42),l=k$(87);function m(g,e,f){var b=arguments.length<4?g:arguments[3],c=i.f(q(g),e),d,n;if(!c){if(l(n=o(g)))return m(n,e,f,b);c=k(0)}if(p(c,"value")){if(c.writable===!1||!l(b))return!1;if(d=i.f(b,e)){if(d.get||d.set||d.writable===!1)return!1;d.value=f,h.f(b,e,d)}else h.f(b,e,k(0,f));return!0}return c.set===void 0?!1:(c.set.call(b,f),!0)}j(j.S,"Reflect",{set:m})},258(){var c=k$(68),a=k$(134);a&&c(c.S,"Reflect",{setPrototypeOf:function h(d,e){a.check(d,e);try{return a.set(d,e),!0}catch(i){return!1}}})},307(){"use strict";var b=k$(68),c=k$(46)(!0);b(b.P,"Array",{includes:function g(d){return c(this,d,arguments.length>1?arguments[1]:void 0)}}),k$(39)("includes")},73(v,m){"use strict";var n=k$(85),o=k$(87),p=k$(153),q=k$(60),r=k$(164)("isConcatSpreadable");function g(h,i,f,s,t,j,k,u){for(var b=t,c=0,l=k?q(k,u,3):!1,a,d;c<s;){if(c in f){a=l?l(f[c],c,i):f[c],d=!1,o(a)&&(d=a[r],d=d!==void 0?!!d:n(a));if(d&&j>0)b=g(h,i,a,p(a.length),b,j-1)-1;else{if(b>=9007199254740991)throw TypeError();h[b]=a}b++}c++}return b}m.exports=g},305(){"use strict";var d=k$(68),g=k$(73),h=k$(154),i=k$(153),j=k$(37),k=k$(50);d(d.P,"Array",{flatMap:function n(e){var b=h(this),f,c;return j(e),f=i(b.length),c=k(b,0),g(c,b,b,f,0,1,e,arguments[1]),c}}),k$(39)("flatMap")},306(){"use strict";var c=k$(68),f=k$(73),g=k$(154),h=k$(153),i=k$(151),j=k$(50);c(c.P,"Array",{flatten:function n(){var d=arguments[0],b=g(this),k=h(b.length),e=j(b,0);return f(e,b,b,k,0,d===void 0?1:i(d)),e}}),k$(39)("flatten")},348(){"use strict";var b=k$(68),c=k$(141)(!0);b(b.P,"String",{at:function g(d){return c(this,d)}})},144(p,i){var j=k$(153),k=k$(145),l=k$(63);i.exports=function(m,n,f,o){var b=String(l(m)),g=b.length,d=f===void 0?" ":String(f),h=j(n);if(h<=g||d=="")return b;var e=h-g,a=k.call(d,Math.ceil(e/d.length));return a.length>e&&(a=a.slice(0,e)),o?a+b:b+a}},351(){"use strict";var b=k$(68),c=k$(144),d=k$(160),e=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(d);b(b.P+b.F*e,"String",{padStart:function i(f){return c(this,f,arguments.length>1?arguments[1]:void 0,!0)}})},350(){"use strict";var b=k$(68),c=k$(144),d=k$(160),e=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(d);b(b.P+b.F*e,"String",{padEnd:function i(f){return c(this,f,arguments.length>1?arguments[1]:void 0,!1)}})},352(){"use strict";k$(146)("trimLeft",function(b){return function e(){return b(this,1)}},"trimStart")},353(){"use strict";k$(146)("trimRight",function(b){return function e(){return b(this,2)}},"trimEnd")},349(){"use strict";var e=k$(68),h=k$(63),i=k$(153),j=k$(88),k=k$(72),l=RegExp.prototype,f=function(c,a){this._r=c,this._s=a};k$(90)(f,"RegExp String",function c(){var a=this._r.exec(this._s);return{value:a,done:a===null}}),e(e.P,"String",{matchAll:function c(a){h(this);if(!j(a))throw TypeError(a+" is not a regexp!");var m=String(this),d="flags"in l?String(a.flags):k.call(a),g=new RegExp(a.source,~d.indexOf("g")?d:"g"+d);return g.lastIndex=i(a.lastIndex),new f(g,m)}})},354(){k$(162)("asyncIterator")},355(){k$(162)("observable")},329(){var c=k$(68),i=k$(120),j=k$(152),k=k$(110),l=k$(59);c(c.S,"Object",{getOwnPropertyDescriptors:function q(m){for(var d=j(m),n=k.f,e=i(d),f={},g=0,h,b;e.length>g;)b=n(d,h=e[g++]),b!==void 0&&l(f,h,b);return f}})},119(o,g){var h=k$(64),i=k$(116),j=k$(152),k=k$(117).f;g.exports=function(l){return function(m){for(var c=j(m),d=i(c),n=d.length,e=0,f=[],a;n>e;)a=d[e++],(!h||k.call(c,a))&&f.push(l?[a,c[a]]:c[a]);return f}}},332(){var b=k$(68),c=k$(119)(!1);b(b.S,"Object",{values:function g(d){return c(d)}})},328(){var b=k$(68),c=k$(119)(!0);b(b.S,"Object",{entries:function g(d){return c(d)}})},109(d,c){"use strict";c.exports=k$(95)||!k$(70)(function(){var b=Math.random();__defineSetter__.call(null,b,function(){}),delete k$(76)[b]})},326(){"use strict";var b=k$(68),c=k$(154),d=k$(37),e=k$(107);k$(64)&&b(b.P+k$(109),"Object",{__defineGetter__:function j(f,g){e.f(c(this),f,{get:d(g),enumerable:!0,configurable:!0})}})},327(){"use strict";var b=k$(68),c=k$(154),d=k$(37),e=k$(107);k$(64)&&b(b.P+k$(109),"Object",{__defineSetter__:function j(f,g){e.f(c(this),f,{set:d(g),enumerable:!0,configurable:!0})}})},330(){"use strict";var c=k$(68),e=k$(154),f=k$(155),g=k$(114),h=k$(110).f;k$(64)&&c(c.P+k$(109),"Object",{__lookupGetter__:function m(i){var b=e(this),j=f(i,!0),d;do if(d=h(b,j))return d.get;while(b=g(b))}})},331(){"use strict";var c=k$(68),e=k$(154),f=k$(155),g=k$(114),h=k$(110).f;k$(64)&&c(c.P+k$(109),"Object",{__lookupSetter__:function m(i){var b=e(this),j=f(i,!0),d;do if(d=h(b,j))return d.set;while(b=g(b))}})},45(g,c){var d=k$(74);c.exports=function(e,f){var a=[];return d(e,!1,a.push,a,f),a}},55(f,c){var d=k$(52),e=k$(45);c.exports=function(b){return function g(){if(d(this)!=b)throw TypeError(b+"#toJSON isn't generic");return e(this)}}},313(){var a=k$(68);a(a.P+a.R,"Map",{toJSON:k$(55)("Map")})},347(){var a=k$(68);a(a.P+a.R,"Set",{toJSON:k$(55)("Set")})},133(g,e){"use strict";var b=k$(68);e.exports=function(f){b(b.S,f,{of:function h(){for(var a=arguments.length,c=new Array(a);a--;)c[a]=arguments[a];return new this(c)}})}},312(){k$(133)("Map")},346(){k$(133)("Set")},358(){k$(133)("WeakMap")},360(){k$(133)("WeakSet")},132(o,k){"use strict";var f=k$(68),g=k$(37),l=k$(60),h=k$(74);k.exports=function(m){f(f.S,m,{from:function p(c){var d=arguments[1],e,a,i,j;return g(this),e=d!==void 0,e&&g(d),c==void 0?new this():(a=[],e?(i=0,j=l(d,arguments[2],2),h(c,!1,function(n){a.push(j(n,i++))})):h(c,!1,a.push,a),new this(a))}})}},311(){k$(132)("Map")},345(){k$(132)("Set")},357(){k$(132)("WeakMap")},359(){k$(132)("WeakSet")},310(){var b=k$(68);b(b.G,{global:k$(76)})},356(){var b=k$(68);b(b.S,"System",{global:k$(76)})},309(){var b=k$(68),c=k$(53);b(b.S,"Error",{isError:function g(d){return c(d)==="Error"}})},314(){var a=k$(68);a(a.S,"Math",{clamp:function h(c,d,e){return Math.min(e,Math.max(d,c))}})},315(){var a=k$(68);a(a.S,"Math",{DEG_PER_RAD:Math.PI/180})},316(){var a=k$(68),c=180/Math.PI;a(a.S,"Math",{degrees:function g(d){return d*c}})},99(g,f){f.exports=Math.scale||function i(a,b,d,c,e){return arguments.length===0||a!=a||b!=b||d!=d||c!=c||e!=e?NaN:a===Infinity||a===-Infinity?a:(a-b)*(e-c)/(d-b)+c}},317(){var b=k$(68),c=k$(99),d=k$(97);b(b.S,"Math",{fscale:function l(e,f,g,h,i){return d(c(e,f,g,h,i))}})},318(){var c=k$(68);c(c.S,"Math",{iaddh:function l(e,f,g,h){var a=e>>>0,i=f>>>0,b=g>>>0;return i+(h>>>0)+((a&b|(a|b)&~(a+b>>>0))>>>31)|0}})},320(){var c=k$(68);c(c.S,"Math",{isubh:function l(e,f,g,h){var a=e>>>0,i=f>>>0,b=g>>>0;return i-(h>>>0)-((~a&b|~(a^b)&a-b>>>0)>>>31)|0}})},319(){var b=k$(68);b(b.S,"Math",{imulh:function o(k,l){var a=65535,c=+k,d=+l,e=c&a,f=d&a,g=c>>16,h=d>>16,i=(g*f>>>0)+(e*f>>>16);return g*h+(i>>16)+((e*h>>>0)+(i&a)>>16)}})},321(){var a=k$(68);a(a.S,"Math",{RAD_PER_DEG:180/Math.PI})},322(){var a=k$(68),c=Math.PI/180;a(a.S,"Math",{radians:function g(d){return d*c}})},323(){var b=k$(68);b(b.S,"Math",{scale:k$(99)})},325(){var b=k$(68);b(b.S,"Math",{umulh:function o(k,l){var a=65535,c=+k,d=+l,e=c&a,f=d&a,g=c>>>16,h=d>>>16,i=(g*f>>>0)+(e*f>>>16);return g*h+(i>>>16)+((e*h>>>0)+(i&a)>>>16)}})},324(){var b=k$(68);b(b.S,"Math",{signbit:function f(a){return(a=+a)!=a?a:a==0?1/a==Infinity:a>0}})},334(){"use strict";var c=k$(68),h=k$(58),i=k$(76),j=k$(139),e=k$(124);c(c.P+c.R,"Promise",{finally:function(b){var f=j(this,h.Promise||i.Promise),g=typeof b=="function";return this.then(g?function(d){return e(f,b()).then(function(){return d})}:b,g?function(d){return e(f,b()).then(function(){throw d})}:b)}})},335(){"use strict";var c=k$(68),e=k$(104),f=k$(123);c(c.S,"Promise",{try:function(g){var b=e.f(this),d=f(g);return(d.e?b.reject:b.resolve)(d.v),b.promise}})},102(t,l){var i=k$(196),j=k$(68),k=k$(138)("metadata"),h=k.store||(k.store=new(k$(303))()),e=function(a,d,c){var b=h.get(a);if(!b){if(!c)return;h.set(a,b=new i())}var g=b.get(d);if(!g){if(!c)return;b.set(d,g=new i())}return g},m=function(a,d,c){var b=e(d,c,!1);return b===void 0?!1:b.has(a)},n=function(a,d,c){var b=e(d,c,!1);return b===void 0?void 0:b.get(a)},o=function(a,d,c,b){e(c,b,!0).set(a,d)},p=function(a,d){var c=e(a,d,!1),b=[];return c&&c.forEach(function(g,s){b.push(s)}),b},q=function(a){return a===void 0||typeof a=="symbol"?a:String(a)},r=function(a){j(j.S,"Reflect",a)};l.exports={store:h,map:e,has:m,get:n,set:o,keys:p,key:q,exp:r}},336(){var a=k$(102),c=k$(42),d=a.key,e=a.set;a.exp({defineMetadata:function l(f,g,h,i){e(f,g,c(h),d(i))}})},337(){var a=k$(102),h=k$(42),i=a.key,j=a.map,e=a.store;a.exp({deleteMetadata:function n(k,b){var f=arguments.length<3?void 0:i(arguments[2]),c=j(h(b),f,!1);if(c===void 0||!c.delete(k))return!1;if(c.size)return!0;var g=e.get(b);return g.delete(f),!!g.size||e.delete(b)}})},339(){var c=k$(102),h=k$(42),i=k$(114),j=c.has,k=c.get,l=c.key,f=function(d,a,b){var m=j(d,a,b);if(m)return k(d,a,b);var g=i(a);return g!==null?f(d,g,b):void 0};c.exp({getMetadata:function d(a,b){return f(a,h(b),arguments.length<3?void 0:l(arguments[2]))}})},338(){var i=k$(268),j=k$(45),d=k$(102),k=k$(42),l=k$(114),m=d.keys,n=d.key,g=function(e,b){var c=m(e,b),h=l(e);if(h===null)return c;var f=g(h,b);return f.length?c.length?j(new i(c.concat(f))):f:c};d.exp({getMetadataKeys:function e(b){return g(k(b),arguments.length<2?void 0:n(arguments[1]))}})},341(){var a=k$(102),c=k$(42),d=a.get,e=a.key;a.exp({getOwnMetadata:function j(f,g){return d(f,c(g),arguments.length<3?void 0:e(arguments[2]))}})},340(){var a=k$(102),c=k$(42),d=a.keys,e=a.key;a.exp({getOwnMetadataKeys:function i(f){return d(c(f),arguments.length<2?void 0:e(arguments[1]))}})},342(){var d=k$(102),h=k$(42),i=k$(114),j=d.has,k=d.key,f=function(e,a,b){var l=j(e,a,b);if(l)return!0;var g=i(a);return g!==null?f(e,g,b):!1};d.exp({hasMetadata:function e(a,b){return f(a,h(b),arguments.length<3?void 0:k(arguments[2]))}})},343(){var a=k$(102),c=k$(42),d=a.has,e=a.key;a.exp({hasOwnMetadata:function j(f,g){return d(f,c(g),arguments.length<3?void 0:e(arguments[2]))}})},344(){var b=k$(102),d=k$(42),e=k$(37),f=b.key,g=b.set;b.exp({metadata:function m(h,i){return function n(j,c){g(h,i,(c!==void 0?d:e)(j),f(c))}}})},308(){var b=k$(68),f=k$(103)(),c=k$(76).process,g=k$(53)(c)=="process";b(b.G,{asap:function j(d){var e=g&&c.domain;f(e?e.bind(d):d)}})},333(){"use strict";var q=k$(68),y=k$(76),z=k$(58),r=k$(103)(),s=k$(164)("observable"),m=k$(37),p=k$(42),A=k$(41),n=k$(126),B=k$(78),t=k$(74),u=t.RETURN,o=function(c){return c==null?void 0:m(c)},j=function(c){var a=c._c;a&&(c._c=void 0,a())},l=function(c){return c._o===void 0},v=function(c){l(c)||(c._o=void 0,j(c))},w=function(c,a){p(c),this._c=void 0,this._o=c,c=new x(this);try{var b=a(c),e=b;b!=null&&(typeof b.unsubscribe==="function"?b=function(){e.unsubscribe()}:m(b),this._c=b)}catch(d){c.error(d);return}l(this)&&j(this)};w.prototype=n({},{unsubscribe:function c(){v(this)}});var x=function(c){this._s=c};x.prototype=n({},{next:function c(a){var b=this._s;if(!l(b)){var e=b._o;try{var d=o(e.next);if(d)return d.call(e,a)}catch(f){try{v(b)}finally{throw f}}}},error:function c(a){var b=this._s;if(l(b))throw a;var e=b._o;b._o=void 0;try{var d=o(e.error);if(!d)throw a;a=d.call(e,a)}catch(f){try{j(b)}finally{throw f}}return j(b),a},complete:function c(a){var b=this._s;if(!l(b)){var e=b._o;b._o=void 0;try{var d=o(e.complete);a=d?d.call(e,a):void 0}catch(f){try{j(b)}finally{throw f}}return j(b),a}}});var i=function c(a){A(this,i,"Observable","_f")._f=m(a)};n(i.prototype,{subscribe:function c(a){return new w(a,this._f)},forEach:function c(a){var b=this;return new(z.Promise||y.Promise)(function(e,d){m(a);var f=b.subscribe({next:function(h){try{return a(h)}catch(k){d(k),f.unsubscribe()}},error:d,complete:e})})}}),n(i,{from:function c(a){var b=typeof this==="function"?this:i,e=o(p(a)[s]);if(e){var d=p(e.call(a));return d.constructor===b?d:new b(function(f){return d.subscribe(f)})}return new b(function(f){var h=!1;return r(function(){if(!h){try{if(t(a,!1,function(k){f.next(k);if(h)return u})===u)return}catch(k){if(h)throw k;f.error(k);return}f.complete()}}),function(){h=!0}})},of:function c(){for(var a=0,b=arguments.length,e=new Array(b);a<b;)e[a]=arguments[a++];return new(typeof this==="function"?this:i)(function(d){var f=!1;return r(function(){if(!f){for(var h=0;h<e.length;++h){d.next(e[h]);if(f)return}d.complete()}}),function(){f=!0}})}}),B(i.prototype,s,function(){return this}),q(q.G,{Observable:i}),k$(135)("Observable")},363(){var d=k$(76),a=k$(68),g=k$(160),h=[].slice,i=/MSIE .\./.test(g),e=function(j){return function(b,k){var f=arguments.length>2,l=f?h.call(arguments,2):!1;return j(f?function(){(typeof b=="function"?b:Function(b)).apply(this,l)}:b,k)}};a(a.G+a.B+a.F*i,{setTimeout:e(d.setTimeout),setInterval:e(d.setInterval)})},362(){var a=k$(68),c=k$(148);a(a.G+a.B,{setImmediate:c.set,clearImmediate:c.clear})},361(){for(var f=k$(177),p=k$(116),q=k$(127),r=k$(76),g=k$(78),h=k$(94),i=k$(164),j=i("iterator"),k=i("toStringTag"),l=h.Array,m={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},n=p(m),e=0;e<n.length;e++){var c=n[e],s=m[c],o=r[c],b=o&&o.prototype,d;if(b){b[j]||g(b,j,l),b[k]||g(b,k,c),h[c]=l;if(s)for(d in f)b[d]||q(b,d,f[d],!0)}}},364(c,b){k$(291),k$(227),k$(229),k$(228),k$(231),k$(233),k$(238),k$(232),k$(230),k$(240),k$(239),k$(235),k$(236),k$(234),k$(226),k$(237),k$(241),k$(242),k$(193),k$(195),k$(194),k$(244),k$(243),k$(214),k$(224),k$(225),k$(215),k$(216),k$(217),k$(218),k$(219),k$(220),k$(221),k$(222),k$(223),k$(197),k$(198),k$(199),k$(200),k$(201),k$(202),k$(203),k$(204),k$(205),k$(206),k$(207),k$(208),k$(209),k$(210),k$(211),k$(212),k$(213),k$(278),k$(283),k$(290),k$(281),k$(273),k$(274),k$(279),k$(284),k$(286),k$(269),k$(270),k$(271),k$(272),k$(275),k$(276),k$(277),k$(280),k$(282),k$(285),k$(287),k$(288),k$(289),k$(188),k$(190),k$(189),k$(192),k$(191),k$(176),k$(174),k$(181),k$(178),k$(184),k$(186),k$(173),k$(180),k$(170),k$(185),k$(168),k$(183),k$(182),k$(175),k$(179),k$(167),k$(169),k$(172),k$(171),k$(187),k$(177),k$(260),k$(261),k$(267),k$(262),k$(263),k$(264),k$(265),k$(266),k$(245),k$(196),k$(268),k$(303),k$(304),k$(292),k$(293),k$(298),k$(301),k$(302),k$(296),k$(299),k$(297),k$(300),k$(294),k$(295),k$(246),k$(247),k$(248),k$(249),k$(250),k$(253),k$(251),k$(252),k$(254),k$(255),k$(256),k$(257),k$(259),k$(258),k$(307),k$(305),k$(306),k$(348),k$(351),k$(350),k$(352),k$(353),k$(349),k$(354),k$(355),k$(329),k$(332),k$(328),k$(326),k$(327),k$(330),k$(331),k$(313),k$(347),k$(312),k$(346),k$(358),k$(360),k$(311),k$(345),k$(357),k$(359),k$(310),k$(356),k$(309),k$(314),k$(315),k$(316),k$(317),k$(318),k$(320),k$(319),k$(321),k$(322),k$(323),k$(325),k$(324),k$(334),k$(335),k$(336),k$(337),k$(339),k$(338),k$(341),k$(340),k$(342),k$(343),k$(344),k$(308),k$(333),k$(363),k$(362),k$(361),b.exports=k$(58)},387(Q,z){!function(q){"use strict";var I=Object.prototype,n=I.hasOwnProperty,m,A=typeof Symbol==="function"?Symbol:{},t=A.iterator||"@@iterator",R=A.asyncIterator||"@@asyncIterator",u=A.toStringTag||"@@toStringTag",J=typeof z==="object",h=q.regeneratorRuntime;if(h){J&&(z.exports=h);return}h=q.regeneratorRuntime=J?z.exports:{};function K(b,a,c,e){var d=a&&a.prototype instanceof C?a:C,f=Object.create(d.prototype),g=new G(e||[]);return f._invoke=T(b,c,g),f}h.wrap=K;function B(b,a,c){try{return{type:"normal",arg:b.call(a,c)}}catch(e){return{type:"throw",arg:e}}}var L="suspendedStart",S="suspendedYield",M="executing",v="completed",k={};function C(){}function w(){}function o(){}var D={};D[t]=function(){return this};var E=Object.getPrototypeOf,x=E&&E(E(H([])));x&&x!==I&&n.call(x,t)&&(D=x);var p=o.prototype=C.prototype=Object.create(D);w.prototype=p.constructor=o,o.constructor=w,o[u]=w.displayName="GeneratorFunction";function N(b){["next","throw","return"].forEach(function(a){b[a]=function(c){return this._invoke(a,c)}})}h.isGeneratorFunction=function(b){var a=typeof b==="function"&&b.constructor;return a?a===w||(a.displayName||a.name)==="GeneratorFunction":!1},h.mark=function(b){return Object.setPrototypeOf?Object.setPrototypeOf(b,o):(b.__proto__=o,u in b||(b[u]="GeneratorFunction")),b.prototype=Object.create(p),b},h.awrap=function(b){return{__await:b}};function y(b){function a(d,f,g,i){var l=B(b[d],b,f);if(l.type==="throw")i(l.arg);else{var j=l.arg,r=j.value;return r&&typeof r==="object"&&n.call(r,"__await")?Promise.resolve(r.__await).then(function(s){a("next",s,g,i)},function(s){a("throw",s,g,i)}):Promise.resolve(r).then(function(s){j.value=s,g(j)},i)}}typeof q.process==="object"&&q.process.domain&&(a=q.process.domain.bind(a));var c;function e(d,f){function g(){return new Promise(function(i,l){a(d,f,i,l)})}return c=c?c.then(g,g):g()}this._invoke=e}N(y.prototype),y.prototype[R]=function(){return this},h.AsyncIterator=y,h.async=function(b,a,c,e){var d=new y(K(b,a,c,e));return h.isGeneratorFunction(a)?d:d.next().then(function(f){return f.done?f.value:d.next()})};function T(b,a,c){var e=L;return function d(f,g){if(e===M)throw new Error("Generator is already running");if(e===v){if(f==="throw")throw g;return P()}for(c.method=f,c.arg=g;;){var i=c.delegate;if(i){var l=O(i,c);if(l){if(l===k)continue;return l}}if(c.method==="next")c.sent=c._sent=c.arg;else if(c.method==="throw"){if(e===L)throw e=v,c.arg;c.dispatchException(c.arg)}else c.method==="return"&&c.abrupt("return",c.arg);e=M;var j=B(b,a,c);if(j.type==="normal"){e=c.done?v:S;if(j.arg===k)continue;return{value:j.arg,done:c.done}}else j.type==="throw"&&(e=v,c.method="throw",c.arg=j.arg)}}}function O(b,a){var c=b.iterator[a.method];if(c===m){a.delegate=null;if(a.method==="throw"){if(b.iterator.return){a.method="return",a.arg=m,O(b,a);if(a.method==="throw")return k}a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return k}var e=B(c,b.iterator,a.arg);if(e.type==="throw")return a.method="throw",a.arg=e.arg,a.delegate=null,k;var d=e.arg;if(!d)return a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,k;if(d.done)a[b.resultName]=d.value,a.next=b.nextLoc,a.method!=="return"&&(a.method="next",a.arg=m);else return d;return a.delegate=null,k}N(p),p[u]="Generator",p[t]=function(){return this},p.toString=function(){return"[object Generator]"};function U(b){var a={tryLoc:b[0]};1 in b&&(a.catchLoc=b[1]),2 in b&&(a.finallyLoc=b[2],a.afterLoc=b[3]),this.tryEntries.push(a)}function F(b){var a=b.completion||{};a.type="normal",delete a.arg,b.completion=a}function G(b){this.tryEntries=[{tryLoc:"root"}],b.forEach(U,this),this.reset(!0)}h.keys=function(b){var a=[];for(var c in b)a.push(c);return a.reverse(),function e(){for(;a.length;){var d=a.pop();if(d in b)return e.value=d,e.done=!1,e}return e.done=!0,e}};function H(b){if(b){var a=b[t];if(a)return a.call(b);if(typeof b.next==="function")return b;if(!isNaN(b.length)){var c=-1,e=function d(){for(;++c<b.length;)if(n.call(b,c))return d.value=b[c],d.done=!1,d;return d.value=m,d.done=!0,d};return e.next=e}}return{next:P}}h.values=H;function P(){return{value:m,done:!0}}G.prototype={constructor:G,reset:function(b){this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(F);if(!b)for(var a in this)a.charAt(0)==="t"&&n.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=m)},stop:function(){this.done=!0;var b=this.tryEntries[0],a=b.completion;if(a.type==="throw")throw a.arg;return this.rval},dispatchException:function(b){if(this.done)throw b;var a=this;function c(l,j){return f.type="throw",f.arg=b,a.next=l,j&&(a.method="next",a.arg=m),!!j}for(var e=this.tryEntries.length-1;e>=0;--e){var d=this.tryEntries[e],f=d.completion;if(d.tryLoc==="root")return c("end");if(d.tryLoc<=this.prev){var g=n.call(d,"catchLoc"),i=n.call(d,"finallyLoc");if(g&&i){if(this.prev<d.catchLoc)return c(d.catchLoc,!0);if(this.prev<d.finallyLoc)return c(d.finallyLoc)}else if(g){if(this.prev<d.catchLoc)return c(d.catchLoc,!0)}else if(i){if(this.prev<d.finallyLoc)return c(d.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(b,a){for(var c=this.tryEntries.length-1;c>=0;--c){var e=this.tryEntries[c];if(e.tryLoc<=this.prev&&n.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var d=e;break}}d&&(b==="break"||b==="continue")&&d.tryLoc<=a&&a<=d.finallyLoc&&(d=null);var f=d?d.completion:{};return f.type=b,f.arg=a,d?(this.method="next",this.next=d.finallyLoc,k):this.complete(f)},complete:function(b,a){if(b.type==="throw")throw b.arg;return b.type==="break"||b.type==="continue"?this.next=b.arg:b.type==="return"?(this.rval=this.arg=b.arg,this.method="return",this.next="end"):b.type==="normal"&&a&&(this.next=a),k},finish:function(b){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.finallyLoc===b)return this.complete(c.completion,c.afterLoc),F(c),k}},catch:function(b){for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a];if(c.tryLoc===b){var e=c.completion;if(e.type==="throw"){var d=e.arg;F(c)}return d}}throw new Error("illegal catch attempt")},delegateYield:function(b,a,c){return this.delegate={iterator:H(b),resultName:a,nextLoc:c},this.method==="next"&&(this.arg=m),k}}}(typeof global==="object"?global:typeof window==="object"?window:typeof self==="object"?self:Q)},130(f,c){c.exports=function(d,a){var e=a===Object(a)?function(b){return a[b]}:a;return function(b){return String(b).replace(d,e)}}},166(){var b=k$(68),c=k$(130)(/[\\^$*+?.()|[\]{}]/g,"\\$&");b(b.S,"RegExp",{escape:function g(d){return c(d)}})},36(c,b){k$(166),b.exports=k$(58).RegExp.escape},5(){"use strict";k$(364),k$(387),k$(36);if(global._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");global._babelPolyfill=!0;var va="defineProperty";function I(a,d,c){a[d]||Object[va](a,d,{writable:!0,configurable:!0,value:c})}I(String.prototype,"padLeft","".padStart),I(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(a){[][a]&&I(Array,a,Function.call.bind([][a]))});const za=p$(386),Aa=p$(33),Ba=p$(34),Ca=p$(35);class Q extends za.Component{constructor(a){super(a);this.bindEvents=()=>{this.state.hasGyroscope?window.addEventListener("click",this.getGyroscope):window.addEventListener("mousemove",this.getMousePosition),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",a=>{this.getDevicePosition(Math.abs(a.beta),a.gamma)},!0):window.DeviceMotionEvent&&window.addEventListener("devicemotion",a=>{this.getDevicePosition(a.acceleration.x*2,a.acceleration.y*2)},!0),window.addEventListener("resize",this.onWindowResize)};this.onWindowResize=a=>{const d=window.innerWidth;d<768?this.state.camera.position.z=700:this.state.camera.position.z=500};this.getDevicePosition=(a,d)=>{if(this.state.gyroscopeActive){let c=100/180*(a-30)*2.6;c<=0?c=0:null,c>=100?c=100:null;let f=100/180*(d+45)*2.6;f<=0?f=0:null,f>=100?f=100:null,this.turnHead(f,c)}};this.getGyroscope=()=>{let a;DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission?a=DeviceOrientationEvent.requestPermission():a=!0;const d=!this.gyroscopeActive;this.setState({gyroscopeActive:d,orientationPermission:a})};this.getMousePosition=a=>{const d=window.innerWidth,c=window.innerHeight,f=100/d*a.clientX,k=100/c*a.clientY;!this.state.gyroscopeActive&&this.head&&this.turnHead(f,k)};this.turnHead=(a,d)=>{const c=this.head;let f,k;f=(c.rangeRotationX/100*a+c.minRotationX)*-1,k=c.rangeRotationY/100*d+c.minRotationY,c.rotation.x=k,c.rotation.y=f;const b=150,n=5,g=new Ca.Animation("headMoveAnimation","position.z",60,Ca.Animation.ANIMATIONTYPE_FLOAT,Ca.Animation.ANIMATIONLOOPMODE_CONSTANT),i=[{frame:0,value:0},{frame:n,value:b}];g.setKeys(i),c.animations.push(g);const q=-.5,u=-1,v=-1.2,j=-1.8,o=this.pivotEyeLeft;let r=(o.rangeRotationX/100*a+o.minRotationX)*-1,s=o.rangeRotationY/100*d+o.minRotationY,y=r,z=s;this.webcamActive?y=r*q:null,this.webcamActive?z=s*q:null,this.state.stare?y=r*j:null,this.state.stare?z=s*j:null,this.webcamMobile?y=r*u:null,this.webcamMobile?z=s*v:null,o.rotation.x=z,o.rotation.y=y;const w=this.pivotEyeRight;let A=(w.rangeRotationX/100*a+w.minRotationX)*-1,B=w.rangeRotationY/100*d+w.minRotationY,C=A,D=B;this.webcamActive?C=A*q:null,this.webcamActive?D=B*q:null,this.state.stare?C=A*j:null,this.state.stare?D=B*j:null,this.webcamMobile?C=A*u:null,this.webcamMobile?D=B*v:null,w.rotation.x=D,w.rotation.y=C};this.loadObjects=()=>{const a=this,d=new Ca.AssetsManager(this.state.scene);d.useDefaultLoadingScreen=!1;const c=d.addMeshTask("mesh task","","../dist/obj/","head3d.obj");c.onSuccess=function(b){b.loadedMeshes[1].material.diffuseColor=new Ca.Color3(.54,.5,.54),b.loadedMeshes[1].material.specularColor=new Ca.Color3(.1,.1,.1),b.loadedMeshes[2].material.diffuseColor=new Ca.Color3(0,0),b.loadedMeshes[2].material.specularColor=new Ca.Color3(0,0,0);const n=b.loadedMeshes[3];n.material.diffuseColor=new Ca.Color3(1/255*45,1/255*22.5,0),n.material.specularColor=new Ca.Color3(0,0,0),b.loadedMeshes[4].material.alpha=.2,b.loadedMeshes[4].material.diffuseColor=new Ca.Color3(1,1,1),b.loadedMeshes[4].material.specularColor=new Ca.Color3(1,1,1);const g=b.loadedMeshes[0];g.material.emissiveColor=new Ca.Color3(0,0,0),g.material.specularColor=new Ca.Color3(0,0,0),g.material.diffuseTexture.hasAlpha=!0,g.material.backFaceCulling=!1,g.maxRotationX=Math.PI/180*30,g.minRotationX=Math.PI/180*-30,g.rangeRotationX=Math.PI/180*60,g.maxRotationY=Math.PI/180*45,g.minRotationY=Math.PI/180*-45,g.rangeRotationY=Math.PI/180*90;const i=new Ca.TransformNode("pivotEyeRight");i.position=new Ca.Vector3(29.4,27,72.2),i.parent=g,i.maxRotationY=Math.PI/180*5,i.minRotationY=Math.PI/180*-5,i.rangeRotationY=Math.PI/180*10,i.maxRotationX=Math.PI/180*12.5,i.minRotationX=Math.PI/180*-12.5,i.rangeRotationX=Math.PI/180*25;const q=new Ca.MeshBuilder.CreateSphere("pupilRight",{diameter:8,diameterY:2,slice:.5},a.scene);q.parent=i,q.position.z=13,q.position.y=-3.5,q.position.x=2,q.rotation.x=Math.PI/2;const u=new Ca.StandardMaterial("pupilRightMaterial",a.scene);u.diffuseColor=new Ca.Color3(0,0,0),u.specularColor=new Ca.Color3(.1,.1,.1),u.backFaceCulling=!1,q.material=u,b.loadedMeshes[1].parent=i,b.loadedMeshes[2].parent=i,b.loadedMeshes[3].parent=i,b.loadedMeshes[4].parent=i;const v=new Ca.Vector3(-29.4,-27,-72.2);b.loadedMeshes[1].position=v,b.loadedMeshes[2].position=v,b.loadedMeshes[3].position=v,b.loadedMeshes[4].position=v;const j=new Ca.TransformNode("pivotEyeLeft");j.position=new Ca.Vector3(-29.4,27,72.2),j.parent=g,j.maxRotationY=Math.PI/180*10,j.minRotationY=Math.PI/180*-10,j.rangeRotationY=Math.PI/180*20,j.maxRotationX=Math.PI/180*12.5,j.minRotationX=Math.PI/180*-12.5,j.rangeRotationX=Math.PI/180*25;const o=new Ca.MeshBuilder.CreateSphere("pupilLeft",{diameter:8,diameterY:2,slice:.5},a.scene);o.parent=j,o.position.z=13,o.position.y=-3.5,o.position.x=0,o.rotation.x=Math.PI/2;const r=new Ca.StandardMaterial("pupilLeftMaterial",a.scene);r.diffuseColor=new Ca.Color3(0,0,0),r.specularColor=new Ca.Color3(.1,.1,.1),r.backFaceCulling=!1,o.material=r,b.loadedMeshes[5].parent=j,b.loadedMeshes[6].parent=j,b.loadedMeshes[7].parent=j,b.loadedMeshes[8].parent=j;const s=new Ca.Vector3(29.4,-27,-72.2);b.loadedMeshes[5].position=s,b.loadedMeshes[6].position=s,b.loadedMeshes[7].position=s,b.loadedMeshes[8].position=s,g.actionManager=new Ca.ActionManager(a.state.scene),g.actionManager.registerAction(new Ca.ExecuteCodeAction({trigger:Ca.ActionManager.OnPickTrigger},()=>{a.props.setPsychoMode(),g.material.diffuseTexture=a.props.psychoMode?a.psychoTexture:a.normalTexture,n.material.diffuseColor=a.props.psychoMode?new Ca.Color3(1/255*250,1/255*10,1/255*255):new Ca.Color3(1/255*45,1/255*22.5,0),a.setState({stare:!a.state.stare})})),a.head=g,a.pivotEyeRight=i,a.pivotEyeLeft=j,a.setState({headLoaded:!0})},c.onError=function(b,n,g){console.log("error")};const f=d.addTextureTask("face normal","../dist/obj/head3d.png");f.onSuccess=function(b){a.normalTexture=b.texture};const k=d.addTextureTask("face psycho","../dist/obj/head3d_psycho.png");k.onSuccess=function(b){a.psychoTexture=b.texture},d.onFinish=b=>{a.state.engine.runRenderLoop(()=>{a.state.scene.render()})},window.setTimeout(()=>{d.load()},1000)};this.state={currentRoot:window.location.pathname.substr(1),engine:null,scene:null,camera:null,gyroscopeActive:!1,orientationPermission:!1,stare:!1,headLoaded:!1,hasGyroscope:typeof DeviceOrientationEvent!=="undefined"&&DeviceOrientationEvent.requestPermission||navigator.userAgent.match("CriOS")||navigator.userAgent.match("iPhone")}}componentDidMount(){const a=new Ca.Engine(document.getElementById("head"),!0),d=new Ca.Scene(a);d.clearColor=new Ca.Color4(0,0,0,0);const c=new Ca.UniversalCamera("camera",new Ca.Vector3(0,0,500),d);c.setTarget(Ca.Vector3.Zero()),c.lowerRadiusLimit=400,c.upperRadiusLimit=400;const f=new Ca.HemisphericLight("hemisphericLight",new Ca.Vector3(0,200,0),d);f.diffuse=new Ca.Color3(1,1,1);const k=1,b=new Ca.SpotLight("spotLightFront",new Ca.Vector3(0,0,400),new Ca.Vector3(0,0,0),Math.PI*2,0,d);b.intensity=k;const n=new Ca.SpotLight("spotLightLeft",new Ca.Vector3(400,-200,100),new Ca.Vector3(0,0,0),Math.PI*2,0,d);n.intensity=k;const g=new Ca.SpotLight("spotLightRight",new Ca.Vector3(-400,-200,100),new Ca.Vector3(0,0,0),Math.PI*2,0,d);g.intensity=k;const i=new Ca.SpotLight("spotLightLower",new Ca.Vector3(0,-200,200),new Ca.Vector3(0,0,0),Math.PI*2,0,d);i.intensity=k,this.state.hasGyroscope&&(f.intensity=2,b.position.z=300,n.position.x=300,g.position.x=-300),this.setState({engine:a,scene:d,camera:c,hemisphericLight:f,spotLightFront:b,spotLightLeft:n,spotLightRight:g,spotLightLower:i},()=>{this.loadObjects(),this.bindEvents(),this.state.engine.runRenderLoop(()=>{this.state.scene.render()})})}render(){const a=this.state.currentRoot.length===0&&!this.state.headLoaded;return za.default.createElement(za.Fragment,null,za.default.createElement("canvas",{id:"head",width:"1500",height:"1500"}),a?za.default.createElement("div",{className:"head__loader"}):null)}}const R=Q;const Ga=p$(386),Ha=p$(380);class $ extends Ga.Component{componentDidMount(){this.props.setCurrentRoot(this.props.location.pathname)}render(){return Ga.default.createElement("section",{className:"home"},Ga.default.createElement("div",{className:"home__text"},Ga.default.createElement("h1",{className:"home__name"},"Cyrill Lehmann"),Ga.default.createElement("h2",{className:"home__position"},"Web Developer")),Ga.default.createElement(Ha.Link,{to:"/who",className:"button home__anchorWho",onClick:a=>this.props.gace(a,"who")},"who"),Ga.default.createElement("a",{target:"__blank",rel:"noopener",href:"https://cyrill-lehmann.ch/tutorials",className:"button home__anchorTutorials",onClick:a=>this.props.gace(a,"tutorials")},"tutorials"),Ga.default.createElement(Ha.Link,{to:"/what",className:"button home__anchorWhat",onClick:a=>this.props.gace(a,"what")},"what"))}}const aa=Ha.withRouter($);const ab=p$(386),bb=p$(380);class ka extends ab.Component{componentDidMount(){this.props.setCurrentRoot(this.props.location.pathname)}render(){return ab.default.createElement("section",{className:"who"},ab.default.createElement(bb.Link,{to:"/",className:"button who__anchorBack",onClick:a=>this.props.gace(a,"home")},"back"),ab.default.createElement("ul",{className:"who__list"},ab.default.createElement("li",{className:"who__listEntry"},"based in chur, switzerland"),ab.default.createElement("li",{className:"who__listEntry"},"spending most of my days at"," ",ab.default.createElement("a",{href:"https://clus.ch",rel:"noopener",target:"__blank",onClick:a=>this.props.gace(a,"clus.ch")},"clus.ch")),ab.default.createElement("li",{className:"who__listEntry"},"doing my own thing under Lehmann Webentwicklung"),ab.default.createElement("li",{className:"who__listEntry"},"been having fun with django, laravel, css, react, babylon, raspberrypi,",ab.default.createElement("br",null),"wordpress, processwire, codeigniter, three and other stuff"),ab.default.createElement("li",{className:"who__listEntry"},"interested in skis, salad, cheese, aquaponics and even more"),ab.default.createElement("li",{className:"who__listEntry"},"fluent in (swiss-)german, english and mandarin"),ab.default.createElement("li",{className:"who__listEntry"},"feel free to reach out")),ab.default.createElement("ul",{className:"home__contactList"},ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://github.com/adabs-urdum",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"github")},"github")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://codepen.io/adabs-urdum",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"codepen")},"codepen")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"mailto:cyrill@adabs.ch",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"mail")},"email")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://www.instagram.com/adabs_urdum/",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"instagram")},"instagram")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://www.linkedin.com/in/adabs-urdum",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"linkedin")},"linkedin")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://www.patreon.com/user/creators?u=5977648",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"patreon")},"patreon")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://www.udemy.com/user/cyrill-lehmann/",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"udemy")},"udemy")),ab.default.createElement("li",{className:"home__contactEntry"},ab.default.createElement("a",{href:"https://cssbattle.dev/player/adabs",target:"__blank",rel:"noopener",className:"home__contactAnchor",onClick:a=>this.props.gace(a,"cssbattle")},"cssbattle"))))}}const la=bb.withRouter(ka);const Ra=p$(386),Sa=p$(380);class ea extends Ra.Component{constructor(a){super(a);this.onFilterChange=a=>{this.setState({currentFilter:a.currentTarget.value})};this.state={ready:!1,projects:a.projects,tags:a.tags,currentFilter:"all"}}componentDidMount(){this.props.setCurrentRoot(this.props.location.pathname)}componentDidUpdate(){this.props.projects&&!this.state.ready&&window.setTimeout(()=>{this.setState({ready:!0})},200)}render(){const a=this.props.tags?this.props.tags.map(c=>Ra.default.createElement("label",{className:"what__tagListLabel",key:c,onClick:f=>this.props.gace(f,`filter ${c}`)},Ra.default.createElement("input",{className:"what__tagListInput",type:"radio",name:"tagListFilter",value:c,onChange:this.onFilterChange}),Ra.default.createElement("span",{className:"button what__tagListFilter"},c))):null;a&&a.unshift(Ra.default.createElement("label",{className:"what__tagListLabel",key:"all",onClick:c=>this.props.gace(c,"filter all")},Ra.default.createElement("input",{className:"what__tagListInput",type:"radio",name:"tagListFilter",value:"all",onChange:this.onFilterChange,defaultChecked:!0}),Ra.default.createElement("span",{className:"button what__tagListFilter"},"All")));const d=this.props.projects?this.props.projects.map(c=>{const f=c.tags.map(k=>Ra.default.createElement("li",{className:"what__tagListEntry",key:k.replace(" ","")},k));if(this.state.currentFilter=="all"||c.tags.includes(this.state.currentFilter))return Ra.default.createElement("li",{className:"what__listEntry",key:c.name.replace(" ","")},Ra.default.createElement("canvas",{className:"what__canvas",width:"16",height:"9"}),Ra.default.createElement("a",{className:"what__project",target:"__blank",rel:"noopener",href:c.link,onClick:k=>this.props.gace(k,c.name)},Ra.default.createElement("img",{className:"what__projectImage",src:c.imageSrc,srcSet:c.imageSrcset,sizes:"(max-width: 500px) 80vw, 70vw"}),Ra.default.createElement("div",{className:"what__projectContent"},Ra.default.createElement("h2",{className:"what__projectName"},c.name),Ra.default.createElement("p",{className:"what__projectDescription"},c.description),Ra.default.createElement("ul",{className:"what__tagList"},f))))}):null;return Ra.default.createElement("section",{className:"what"},Ra.default.createElement(Sa.Link,{to:"/",className:"button what__anchorBack",onClick:c=>this.props.gace(c,"home")},"back"),Ra.default.createElement("ul",{className:this.state.ready?"what__list ready":"what__list"},Ra.default.createElement("li",{className:"what__listEntry what__listEntry--filter"},a),d))}}const fa=Sa.withRouter(ea);const lb=p$(6),mb=p$(386),nb=p$(380);class ra extends mb.Component{constructor(a){super(a);this.setCurrentRoot=a=>{a=a.replace("/",""),this.setState({currentRoot:a},()=>{this.state.body.classList=this.state.currentRoot})};this.setPsychoMode=()=>{this.setState({psychoMode:!this.state.psychoMode},()=>{const a=this.state.psychoMode?"psycho":"";this.state.html.classList=a})};this.gace=(a,d)=>{ga("send","event","link","click",d,d)};this.state={currentRoot:"",psychoMode:!1,body:document.getElementById("body"),html:document.getElementById("html"),isIeEdge:document.documentMode||/Edge\//.test(navigator.userAgent),projects:null,projectsReady:!1}}componentDidMount(){const a=window.location.hostname=="localhost"?"https://api.adabs.ch.test":"https://api.adabs.ch";lb.default.get(a+"/projects/").then(d=>{const c=d.data.projects,f=[];c.forEach(b=>{f.push({name:b.title,tags:b.tags,description:b.description,link:b.linkout,imageSrc:b.image.url,imageSrcset:b.image.srcset})});const k=f.length?[...new Set(f.map(b=>b.tags).flat())].sort((b,n)=>b>n?1:n>b?-1:0):null;this.setState({projects:f,projectTags:k,projectsReady:!0})})}render(){const a=mb.default.createElement("h3",{className:"internetExplorerWarning"},"why don't you use a good browser. like chrome or something.");return mb.default.createElement(mb.Fragment,null,this.state.isIeEdge?a:null,mb.default.createElement(nb.BrowserRouter,null,mb.default.createElement(nb.Switch,null,mb.default.createElement(nb.Route,{path:"/who",render:()=>mb.default.createElement(la,{setCurrentRoot:this.setCurrentRoot,gace:this.gace})}),mb.default.createElement(nb.Route,{path:"/what",render:()=>mb.default.createElement(fa,{setCurrentRoot:this.setCurrentRoot,projects:this.state.projects,tags:this.state.projectTags,ready:this.state.projectsReady,gace:this.gace})}),mb.default.createElement(nb.Route,{path:"/",render:()=>mb.default.createElement(aa,{setCurrentRoot:this.setCurrentRoot,gace:this.gace})}))),mb.default.createElement(R,{psychoMode:this.state.psychoMode,setPsychoMode:this.setPsychoMode}))}}const sa=ra;const Bb=p$(386),Cb=p$(376);"use strict";Array.prototype.getRandomValue=a=>a[Math.floor(Math.random()*a.length)],document.addEventListener("DOMContentLoaded",function(){Cb.default.render(Bb.default.createElement(sa,null),document.getElementById("root"))})},371(o,j){"use strict";var i=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;function m(c){if(c===null||c===void 0)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(c)}function n(){try{if(!Object.assign)return!1;var c=new String("abc");c[5]="de";if(Object.getOwnPropertyNames(c)[0]==="5")return!1;for(var g={},a=0;a<10;a++)g["_"+String.fromCharCode(a)]=a;var e=Object.getOwnPropertyNames(g).map(function(b){return g[b]});if(e.join("")!=="0123456789")return!1;var d={};return"abcdefghijklmnopqrst".split("").forEach(function(b){d[b]=b}),Object.keys(Object.assign({},d)).join("")!=="abcdefghijklmnopqrst"?!1:!0}catch(b){return!1}}j.exports=n()?Object.assign:function(c,g){for(var a,e=m(c),d,b=1;b<arguments.length;b++){a=Object(arguments[b]);for(var h in a)k.call(a,h)&&(e[h]=a[h]);if(i){d=i(a);for(var f=0;f<d.length;f++)l.call(a,d[f])&&(e[d[f]]=a[d[f]])}}return e}},385(ba,O){"use strict";var q=k$(371),h="function"===typeof Symbol&&Symbol.for,n=h?Symbol.for("react.element"):60103,P=h?Symbol.for("react.portal"):60106,Q=h?Symbol.for("react.fragment"):60107,R=h?Symbol.for("react.strict_mode"):60108,S=h?Symbol.for("react.profiler"):60114,T=h?Symbol.for("react.provider"):60109,U=h?Symbol.for("react.context"):60110,V=h?Symbol.for("react.forward_ref"):60112,W=h?Symbol.for("react.suspense"):60113;h&&Symbol.for("react.suspense_list");var X=h?Symbol.for("react.memo"):60115,Y=h?Symbol.for("react.lazy"):60116;h&&Symbol.for("react.fundamental"),h&&Symbol.for("react.responder"),h&&Symbol.for("react.scope");var z="function"===typeof Symbol&&Symbol.iterator;function o(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},B={};function m(a,b,c){this.props=a,this.context=b,this.refs=B,this.updater=c||A}m.prototype.isReactComponent={},m.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(o(85));this.updater.enqueueSetState(this,a,b,"setState")},m.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};function C(){}C.prototype=m.prototype;function r(a,b,c){this.props=a,this.context=b,this.refs=B,this.updater=c||A}var s=r.prototype=new C();s.constructor=r,q(s,m.prototype),s.isPureReactComponent=!0;var D={current:null},t={current:null},E=Object.prototype.hasOwnProperty,F={key:!0,ref:!0,__self:!0,__source:!0};function G(a,b,c){var e,d={},g=null,j=null;if(null!=b)for(e in void 0!==b.ref&&(j=b.ref),void 0!==b.key&&(g=""+b.key),b)E.call(b,e)&&!F.hasOwnProperty(e)&&(d[e]=b[e]);var f=arguments.length-2;if(1===f)d.children=c;else if(1<f){for(var i=Array(f),l=0;l<f;l++)i[l]=arguments[l+2];d.children=i}if(a&&a.defaultProps)for(e in f=a.defaultProps,f)void 0===d[e]&&(d[e]=f[e]);return{$$typeof:n,type:a,key:g,ref:j,props:d,_owner:t.current}}function Z(a,b){return{$$typeof:n,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function u(a){return"object"===typeof a&&null!==a&&a.$$typeof===n}function _(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(c){return b[c]})}var H=/\/+/g,p=[];function I(a,b,c,e){if(p.length){var d=p.pop();return d.result=a,d.keyPrefix=b,d.func=c,d.context=e,d.count=0,d}return{result:a,keyPrefix:b,func:c,context:e,count:0}}function J(a){a.result=null,a.keyPrefix=null,a.func=null,a.context=null,a.count=0,10>p.length&&p.push(a)}function v(a,b,c,e){var d=typeof a;("undefined"===d||"boolean"===d)&&(a=null);var g=!1;if(null===a)g=!0;else switch(d){case"string":case"number":g=!0;break;case"object":switch(a.$$typeof){case n:case P:g=!0}}if(g)return c(e,a,""===b?"."+x(a,0):b),1;g=0,b=""===b?".":b+":";if(Array.isArray(a))for(var j=0;j<a.length;j++){d=a[j];var f=b+x(d,j);g+=v(d,f,c,e)}else if(null===a||"object"!==typeof a?f=null:(f=z&&a[z]||a["@@iterator"],f="function"===typeof f?f:null),"function"===typeof f)for(a=f.call(a),j=0;!(d=a.next()).done;)d=d.value,f=b+x(d,j++),g+=v(d,f,c,e);else if("object"===d)throw c=""+a,Error(o(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return g}function w(a,b,c){return null==a?0:v(a,"",b,c)}function x(a,b){return"object"===typeof a&&null!==a&&null!=a.key?_(a.key):b.toString(36)}function $(a,b){a.func.call(a.context,b,a.count++)}function aa(a,b,c){var e=a.result,d=a.keyPrefix;a=a.func.call(a.context,b,a.count++),Array.isArray(a)?y(a,e,c,function(g){return g}):null!=a&&(u(a)&&(a=Z(a,d+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(H,"$&/")+"/")+c)),e.push(a))}function y(a,b,c,e,d){var g="";null!=c&&(g=(""+c).replace(H,"$&/")+"/"),b=I(b,g,e,d),w(a,aa,b),J(b)}function k(){var a=D.current;if(null===a)throw Error(o(321));return a}var K={Children:{map:function(a,b,c){if(null==a)return a;var e=[];return y(a,e,null,b,c),e},forEach:function(a,b,c){if(null==a)return a;b=I(null,null,b,c),w(a,$,b),J(b)},count:function(a){return w(a,function(){return null},null)},toArray:function(a){var b=[];return y(a,b,null,function(c){return c}),b},only:function(a){if(!u(a))throw Error(o(143));return a}},createRef:function(){return{current:null}},Component:m,PureComponent:r,createContext:function(a,b){return void 0===b&&(b=null),a={$$typeof:U,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null},a.Provider={$$typeof:T,_context:a},a.Consumer=a},forwardRef:function(a){return{$$typeof:V,render:a}},lazy:function(a){return{$$typeof:Y,_ctor:a,_status:-1,_result:null}},memo:function(a,b){return{$$typeof:X,type:a,compare:void 0===b?null:b}},useCallback:function(a,b){return k().useCallback(a,b)},useContext:function(a,b){return k().useContext(a,b)},useEffect:function(a,b){return k().useEffect(a,b)},useImperativeHandle:function(a,b,c){return k().useImperativeHandle(a,b,c)},useDebugValue:function(){},useLayoutEffect:function(a,b){return k().useLayoutEffect(a,b)},useMemo:function(a,b){return k().useMemo(a,b)},useReducer:function(a,b,c){return k().useReducer(a,b,c)},useRef:function(a){return k().useRef(a)},useState:function(a){return k().useState(a)},Fragment:Q,Profiler:S,StrictMode:R,Suspense:W,createElement:G,cloneElement:function(a,b,c){if(null===a||void 0===a)throw Error(o(267,a));var e=q({},a.props),d=a.key,g=a.ref,j=a._owner;if(null!=b){void 0!==b.ref&&(g=b.ref,j=t.current),void 0!==b.key&&(d=""+b.key);if(a.type&&a.type.defaultProps)var f=a.type.defaultProps;for(i in b)E.call(b,i)&&!F.hasOwnProperty(i)&&(e[i]=void 0===b[i]&&void 0!==f?f[i]:b[i])}var i=arguments.length-2;if(1===i)e.children=c;else if(1<i){f=Array(i);for(var l=0;l<i;l++)f[l]=arguments[l+2];e.children=f}return{$$typeof:n,type:a.type,key:d,ref:g,props:e,_owner:j}},createFactory:function(a){var b=G.bind(null,a);return b.type=a,b},isValidElement:u,version:"16.11.0",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:D,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:t,IsSomeRendererActing:{current:!1},assign:q}},L={default:K},M=L&&K||L;O.exports=M.default||M},386(c,b){"use strict";b.exports=k$(385)},390(c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var o,q,u,v,C;if("undefined"===typeof window||"function"!==typeof MessageChannel){var r=null,J=null,K=function(){if(null!==r)try{var a=c.unstable_now();r(!0,a),r=null}catch(b){throw setTimeout(K,0),b}},Q=Date.now();c.unstable_now=function(){return Date.now()-Q},o=function(a){null!==r?setTimeout(o,0,a):(r=a,setTimeout(K,0))},q=function(a,b){J=setTimeout(a,b)},u=function(){clearTimeout(J)},v=function(){return!1},C=c.unstable_forceFrameRate=function(){}}else{var D=window.performance,L=window.Date,R=window.setTimeout,S=window.clearTimeout,T=window.requestAnimationFrame,U=window.cancelAnimationFrame;"undefined"!==typeof console&&("function"!==typeof T&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof U&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof D&&"function"===typeof D.now)c.unstable_now=function(){return D.now()};else{var V=L.now();c.unstable_now=function(){return L.now()-V}}var w=!1,x=null,E=-1,M=5,N=0;v=function(){return c.unstable_now()>=N},C=function(){},c.unstable_forceFrameRate=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):M=0<a?Math.floor(1000/a):33.33};var O=new MessageChannel(),F=O.port2;O.port1.onmessage=function(){if(null!==x){var a=c.unstable_now();N=a+M;try{x(!0,a)?F.postMessage(null):(w=!1,x=null)}catch(b){throw F.postMessage(null),b}}else w=!1},o=function(a){x=a,w||(w=!0,F.postMessage(null))},q=function(a,b){E=R(function(){a(c.unstable_now())},b)},u=function(){S(E),E=-1}}function G(a,b){var d=a.length;a.push(b);c:for(;;){var e=Math.floor((d-1)/2),f=a[e];if(void 0!==f&&0<z(f,b))a[e]=b,a[d]=f,d=e;else break c}}function i(a){return a=a[0],void 0===a?null:a}function y(a){var b=a[0];if(void 0!==b){var d=a.pop();if(d!==b){a[0]=d;c:for(var e=0,f=a.length;e<f;){var m=2*(e+1)-1,n=a[m],t=m+1,p=a[t];if(void 0!==n&&0>z(n,d))void 0!==p&&0>z(p,n)?(a[e]=p,a[t]=d,e=t):(a[e]=n,a[m]=d,e=m);else if(void 0!==p&&0>z(p,d))a[e]=p,a[t]=d,e=t;else break c}}return b}return null}function z(a,b){var d=a.sortIndex-b.sortIndex;return 0!==d?d:a.id-b.id}var j=[],k=[],W=1,h=null,g=3,A=!1,l=!1,s=!1;function B(a){for(var b=i(k);null!==b;){if(null===b.callback)y(k);else if(b.startTime<=a)y(k),b.sortIndex=b.expirationTime,G(j,b);else break;b=i(k)}}function H(a){s=!1,B(a);if(!l)if(null!==i(j))l=!0,o(I);else{var b=i(k);null!==b&&q(H,b.startTime-a)}}function I(a,b){l=!1,s&&(s=!1,u()),A=!0;var d=g;try{for(B(b),h=i(j);null!==h&&(!(h.expirationTime>b)||a&&!v());){var e=h.callback;if(null!==e){h.callback=null,g=h.priorityLevel;var f=e(h.expirationTime<=b);b=c.unstable_now(),"function"===typeof f?h.callback=f:h===i(j)&&y(j),B(b)}else y(j);h=i(j)}if(null!==h)var m=!0;else{var n=i(k);null!==n&&q(H,n.startTime-b),m=!1}return m}finally{h=null,g=d,A=!1}}function P(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 10000;default:return 5000}}var X=C;c.unstable_ImmediatePriority=1,c.unstable_UserBlockingPriority=2,c.unstable_NormalPriority=3,c.unstable_IdlePriority=5,c.unstable_LowPriority=4,c.unstable_runWithPriority=function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var d=g;g=a;try{return b()}finally{g=d}},c.unstable_next=function(a){switch(g){case 1:case 2:case 3:var b=3;break;default:b=g}var d=g;g=b;try{return a()}finally{g=d}},c.unstable_scheduleCallback=function(a,b,d){var e=c.unstable_now();if("object"===typeof d&&null!==d){var f=d.delay;f="number"===typeof f&&0<f?e+f:e,d="number"===typeof d.timeout?d.timeout:P(a)}else d=P(a),f=e;return d=f+d,a={id:W++,callback:b,priorityLevel:a,startTime:f,expirationTime:d,sortIndex:-1},f>e?(a.sortIndex=f,G(k,a),null===i(j)&&a===i(k)&&(s?u():s=!0,q(H,f-e))):(a.sortIndex=d,G(j,a),l||A||(l=!0,o(I))),a},c.unstable_cancelCallback=function(a){a.callback=null},c.unstable_wrapCallback=function(a){var b=g;return function(){var d=g;g=b;try{return a.apply(this,arguments)}finally{g=d}}},c.unstable_getCurrentPriorityLevel=function(){return g},c.unstable_shouldYield=function(){var a=c.unstable_now();B(a);var b=i(j);return b!==h&&null!==h&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<h.expirationTime||v()},c.unstable_requestPaint=X,c.unstable_continueExecution=function(){l||A||(l=!0,o(I))},c.unstable_pauseExecution=function(){},c.unstable_getFirstCallbackNode=function(){return i(j)},c.unstable_Profiling=null},391(c,b){"use strict";b.exports=k$(390)},375(s,Bi){"use strict";var oc=k$(386),O=k$(371),E=k$(391);function p(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!oc)throw Error(p(227));var pc=null,db={};function uf(){if(pc)for(var a in db){var b=db[a],c=pc.indexOf(a);if(!(-1<c))throw Error(p(96,a));if(!qc[c]){if(!b.extractEvents)throw Error(p(97,a));qc[c]=b,c=b.eventTypes;for(var d in c){var e,f=c[d],g=b,h=d;if(vd.hasOwnProperty(h))throw Error(p(99,h));vd[h]=f;var i=f.phasedRegistrationNames;if(i){for(e in i)i.hasOwnProperty(e)&&vf(i[e],g,h);e=!0}else f.registrationName?(vf(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(p(98,d,a))}}}}function vf(a,b,c){if(eb[a])throw Error(p(100,a));eb[a]=b,wd[a]=b.eventTypes[c].dependencies}var qc=[],vd={},eb={},wd={};function Ci(a,b,c,d,e,f,g,h,i){var k=Array.prototype.slice.call(arguments,3);try{b.apply(c,k)}catch(q){this.onError(q)}}var Db=!1,rc=null,sc=!1,xd=null,Di={onError:function(a){Db=!0,rc=a}};function Ei(a,b,c,d,e,f,g,h,i){Db=!1,rc=null,Ci.apply(Di,arguments)}function Fi(a,b,c,d,e,f,g,h,i){Ei.apply(this,arguments);if(Db){if(Db){var k=rc;Db=!1,rc=null}else throw Error(p(198));sc||(sc=!0,xd=k)}}var yd=null,wf=null,xf=null;function yf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=xf(c),Fi(d,b,void 0,a),a.currentTarget=null}function fb(a,b){if(null==b)throw Error(p(30));return null==a?b:Array.isArray(a)?Array.isArray(b)?(a.push.apply(a,b),a):(a.push(b),a):Array.isArray(b)?[a].concat(b):[a,b]}function zd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}var Eb=null;function Gi(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)yf(a,b[d],c[d]);else b&&yf(a,b,c);a._dispatchListeners=null,a._dispatchInstances=null,a.isPersistent()||a.constructor.release(a)}}function tc(a){null!==a&&(Eb=fb(Eb,a)),a=Eb,Eb=null;if(a){zd(a,Gi);if(Eb)throw Error(p(95));if(sc)throw a=xd,sc=!1,xd=null,a}}var Ad={injectEventPluginOrder:function(a){if(pc)throw Error(p(101));pc=Array.prototype.slice.call(a),uf()},injectEventPluginsByName:function(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!db.hasOwnProperty(c)||db[c]!==d){if(db[c])throw Error(p(102,c));db[c]=d,b=!0}}b&&uf()}};function zf(a,b){var c=a.stateNode;if(!c)return null;var d=yd(c);if(!d)return null;c=d[b];s:switch(b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":(d=!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a)),a=!d;break s;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(p(231,b,typeof c));return c}var aa=oc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;aa.hasOwnProperty("ReactCurrentDispatcher")||(aa.ReactCurrentDispatcher={current:null}),aa.hasOwnProperty("ReactCurrentBatchConfig")||(aa.ReactCurrentBatchConfig={suspense:null});var Hi=/^(.*)[\\\/]/,M="function"===typeof Symbol&&Symbol.for,uc=M?Symbol.for("react.element"):60103,gb=M?Symbol.for("react.portal"):60106,ya=M?Symbol.for("react.fragment"):60107,Af=M?Symbol.for("react.strict_mode"):60108,vc=M?Symbol.for("react.profiler"):60114,Bf=M?Symbol.for("react.provider"):60109,Cf=M?Symbol.for("react.context"):60110,Ii=M?Symbol.for("react.concurrent_mode"):60111,Bd=M?Symbol.for("react.forward_ref"):60112,wc=M?Symbol.for("react.suspense"):60113,Cd=M?Symbol.for("react.suspense_list"):60120,Dd=M?Symbol.for("react.memo"):60115,Df=M?Symbol.for("react.lazy"):60116;M&&Symbol.for("react.fundamental"),M&&Symbol.for("react.responder"),M&&Symbol.for("react.scope");var Ef="function"===typeof Symbol&&Symbol.iterator;function Fb(a){return null===a||"object"!==typeof a?null:(a=Ef&&a[Ef]||a["@@iterator"],"function"===typeof a?a:null)}function Ji(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b(),a._result=b,b.then(function(c){0===a._status&&(c=c.default,a._status=1,a._result=c)},function(c){0===a._status&&(a._status=2,a._result=c)})}}function za(a){if(null==a)return null;if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case ya:return"Fragment";case gb:return"Portal";case vc:return"Profiler";case Af:return"StrictMode";case wc:return"Suspense";case Cd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Cf:return"Context.Consumer";case Bf:return"Context.Provider";case Bd:var b=a.render;return b=b.displayName||b.name||"",a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Dd:return za(a.type);case Df:if(a=1===a._status?a._result:null)return za(a)}return null}function Ed(a){var b="";do{s:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break s;default:var d=a._debugOwner,e=a._debugSource,f=za(a.type);c=null,d&&(c=za(d.type)),d=f,f="",e?f=" (at "+e.fileName.replace(Hi,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")"),c=`
    in `+(d||"Unknown")+f}b+=c,a=a.return}while(a);return b}var Aa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Fd=null,hb=null,ib=null;function Ff(a){if(a=wf(a)){if("function"!==typeof Fd)throw Error(p(280));var b=yd(a.stateNode);Fd(a.stateNode,a.type,b)}}function Gf(a){hb?ib?ib.push(a):ib=[a]:hb=a}function Hf(){if(hb){var a=hb,b=ib;ib=hb=null,Ff(a);if(b)for(a=0;a<b.length;a++)Ff(b[a])}}function Gd(a,b){return a(b)}function If(a,b,c,d){return a(b,c,d)}function Hd(){}var Jf=Gd,Ra=!1,Id=!1;function Jd(){(null!==hb||null!==ib)&&(Hd(),Hf())}new Map();var Ki=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Kf=Object.prototype.hasOwnProperty,Lf={},Mf={};function Li(a){return Kf.call(Mf,a)?!0:Kf.call(Lf,a)?!1:Ki.test(a)?Mf[a]=!0:(Lf[a]=!0,!1)}function Mi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case"function":case"symbol":return!0;case"boolean":return d?!1:null!==c?!c.acceptsBooleans:(a=a.toLowerCase().slice(0,5),"data-"!==a&&"aria-"!==a);default:return!1}}function Ni(a,b,c,d){if(null===b||"undefined"===typeof b||Mi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function P(a,b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b,this.attributeName=d,this.attributeNamespace=e,this.mustUseProperty=c,this.propertyName=a,this.type=b,this.sanitizeURL=f}var L={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){L[a]=new P(a,0,!1,a,null,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];L[b]=new P(b,1,!1,a[1],null,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){L[a]=new P(a,2,!1,a.toLowerCase(),null,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){L[a]=new P(a,2,!1,a,null,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){L[a]=new P(a,3,!1,a.toLowerCase(),null,!1)}),["checked","multiple","muted","selected"].forEach(function(a){L[a]=new P(a,3,!0,a,null,!1)}),["capture","download"].forEach(function(a){L[a]=new P(a,4,!1,a,null,!1)}),["cols","rows","size","span"].forEach(function(a){L[a]=new P(a,6,!1,a,null,!1)}),["rowSpan","start"].forEach(function(a){L[a]=new P(a,5,!1,a.toLowerCase(),null,!1)});var Kd=/[\-:]([a-z])/g;function Ld(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=a.replace(Kd,Ld);L[b]=new P(b,1,!1,a,null,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(Kd,Ld);L[b]=new P(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(Kd,Ld);L[b]=new P(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)}),["tabIndex","crossOrigin"].forEach(function(a){L[a]=new P(a,1,!1,a.toLowerCase(),null,!1)}),L.xlinkHref=new P("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach(function(a){L[a]=new P(a,1,!1,a.toLowerCase(),null,!0)});function Ba(a){switch(typeof a){case"boolean":case"number":case"object":case"string":case"undefined":return a;default:return""}}function Md(a,b,c,d){var e=L.hasOwnProperty(b)?L[b]:null,f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(Ni(b,c,e,d)&&(c=null),d||null===e?Li(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function Nf(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function Oi(a){var b=Nf(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;return Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(g){d=""+g,f.call(this,g)}}),Object.defineProperty(a,b,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(g){d=""+g},stopTracking:function(){a._valueTracker=null,delete a[b]}}}}function xc(a){a._valueTracker||(a._valueTracker=Oi(a))}function Of(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue(),d="";return a&&(d=Nf(a)?a.checked?"true":"false":a.value),a=d,a!==c?(b.setValue(a),!0):!1}function Nd(a,b){var c=b.checked;return O({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=c?c:a._wrapperState.initialChecked})}function Pf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=Ba(null!=b.value?b.value:c),a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function Qf(a,b){b=b.checked,null!=b&&Md(a,"checked",b,!1)}function Od(a,b){Qf(a,b);var c=Ba(b.value),d=b.type;if(null!=c)"number"===d?(0===c&&""===a.value||a.value!=c)&&(a.value=""+c):a.value!==""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Pd(a,b.type,c):b.hasOwnProperty("defaultValue")&&Pd(a,b.type,Ba(b.defaultValue)),null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Rf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue,c||b===a.value||(a.value=b),a.defaultValue=b}c=a.name,""!==c&&(a.name=""),a.defaultChecked=!a.defaultChecked,a.defaultChecked=!!a._wrapperState.initialChecked,""!==c&&(a.name=c)}function Pd(a,b,c){("number"!==b||a.ownerDocument.activeElement!==a)&&(null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c))}function Pi(a){var b="";return oc.Children.forEach(a,function(c){null!=c&&(b+=c)}),b}function Qd(a,b){return a=O({children:void 0},b),(b=Pi(b.children))&&(a.children=b),a}function jb(a,b,c,d){a=a.options;if(b){b={};for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{for(c=""+Ba(c),b=null,e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0,d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Rd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(p(91));return O({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Sf(a,b){var c=b.value;if(null==c){c=b.defaultValue,b=b.children;if(null!=b){if(null!=c)throw Error(p(92));if(Array.isArray(b)){if(!(1>=b.length))throw Error(p(93));b=b[0]}c=b}null==c&&(c="")}a._wrapperState={initialValue:Ba(c)}}function Tf(a,b){var c=Ba(b.value),d=Ba(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c)),null!=d&&(a.defaultValue=""+d)}function Uf(a){var b=a.textContent;b===a._wrapperState.initialValue&&""!==b&&null!==b&&(a.value=b)}var Sd={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function Vf(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Td(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Vf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}var yc,Wf=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if(a.namespaceURI!==Sd.svg||"innerHTML"in a)a.innerHTML=b;else{for(yc=yc||document.createElement("div"),yc.innerHTML="<svg>"+b.valueOf().toString()+"</svg>",b=yc.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}});function Gb(a,b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b}function zc(a,b){var c={};return c[a.toLowerCase()]=b.toLowerCase(),c["Webkit"+a]="webkit"+b,c["Moz"+a]="moz"+b,c}var kb={animationend:zc("Animation","AnimationEnd"),animationiteration:zc("Animation","AnimationIteration"),animationstart:zc("Animation","AnimationStart"),transitionend:zc("Transition","TransitionEnd")},Ud={},Xf={};Aa&&(Xf=document.createElement("div").style,"AnimationEvent"in window||(delete kb.animationend.animation,delete kb.animationiteration.animation,delete kb.animationstart.animation),"TransitionEvent"in window||delete kb.transitionend.transition);function Ac(a){if(Ud[a])return Ud[a];if(!kb[a])return a;var b=kb[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Xf)return Ud[a]=b[c];return a}var Yf=Ac("animationend"),Zf=Ac("animationiteration"),_f=Ac("animationstart"),$f=Ac("transitionend"),Hb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" ");function Sa(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function ag(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function bg(a){if(Sa(a)!==a)throw Error(p(188))}function Qi(a){var b=a.alternate;if(!b){b=Sa(a);if(null===b)throw Error(p(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return bg(e),a;if(f===d)return bg(e),b;f=f.sibling}throw Error(p(188))}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0,c=e,d=f;break}if(h===d){g=!0,d=e,c=f;break}h=h.sibling}if(!g){for(h=f.child;h;){if(h===c){g=!0,c=f,d=e;break}if(h===d){g=!0,d=f,c=e;break}h=h.sibling}if(!g)throw Error(p(189))}}if(c.alternate!==d)throw Error(p(190))}if(3!==c.tag)throw Error(p(188));return c.stateNode.current===c?a:b}function cg(a){a=Qi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}}return null}var dg,Vd,eg,Wd=!1,ga=[],Ca=null,Da=null,Ea=null,Ib=new Map(),Jb=new Map(),Kb=[],Xd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Ri="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Si(a){var b=fe(a);Xd.forEach(function(c){ge(c,a,b)}),Ri.forEach(function(c){ge(c,a,b)})}function Yd(a,b,c,d){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:d}}function fg(a,b){switch(a){case"focus":case"blur":Ca=null;break;case"dragenter":case"dragleave":Da=null;break;case"mouseover":case"mouseout":Ea=null;break;case"pointerover":case"pointerout":Ib.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jb.delete(b.pointerId)}}function Lb(a,b,c,d,e){return null===a||a.nativeEvent!==e?(a=Yd(b,c,d,e),null!==b&&(b=Sb(b),null!==b&&Vd(b)),a):(a.eventSystemFlags|=d,a)}function Ti(a,b,c,d){switch(b){case"focus":return Ca=Lb(Ca,a,b,c,d),!0;case"dragenter":return Da=Lb(Da,a,b,c,d),!0;case"mouseover":return Ea=Lb(Ea,a,b,c,d),!0;case"pointerover":var e=d.pointerId;return Ib.set(e,Lb(Ib.get(e)||null,a,b,c,d)),!0;case"gotpointercapture":return e=d.pointerId,Jb.set(e,Lb(Jb.get(e)||null,a,b,c,d)),!0}return!1}function Ui(a){var b=Rb(a.target);if(null!==b){var c=Sa(b);if(null!==c){if(b=c.tag,13===b){if(b=ag(c),null!==b){a.blockedOn=b,E.unstable_runWithPriority(a.priority,function(){eg(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=3===c.tag?c.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Bc(a){if(null!==a.blockedOn)return!1;var b=ee(a.topLevelType,a.eventSystemFlags,a.nativeEvent);if(null!==b){var c=Sb(b);return null!==c&&Vd(c),a.blockedOn=b,!1}return!0}function gg(a,b,c){Bc(a)&&c.delete(b)}function Vi(){for(Wd=!1;0<ga.length;){var a=ga[0];if(null!==a.blockedOn){a=Sb(a.blockedOn),null!==a&&dg(a);break}var b=ee(a.topLevelType,a.eventSystemFlags,a.nativeEvent);null!==b?a.blockedOn=b:ga.shift()}null!==Ca&&Bc(Ca)&&(Ca=null),null!==Da&&Bc(Da)&&(Da=null),null!==Ea&&Bc(Ea)&&(Ea=null),Ib.forEach(gg),Jb.forEach(gg)}function Mb(a,b){a.blockedOn===b&&(a.blockedOn=null,Wd||(Wd=!0,E.unstable_scheduleCallback(E.unstable_NormalPriority,Vi)))}function hg(a){function b(e){return Mb(e,a)}if(0<ga.length){Mb(ga[0],a);for(var c=1;c<ga.length;c++){var d=ga[c];d.blockedOn===a&&(d.blockedOn=null)}}for(null!==Ca&&Mb(Ca,a),null!==Da&&Mb(Da,a),null!==Ea&&Mb(Ea,a),Ib.forEach(b),Jb.forEach(b),c=0;c<Kb.length;c++)d=Kb[c],d.blockedOn===a&&(d.blockedOn=null);for(;0<Kb.length&&(c=Kb[0],null===c.blockedOn);)Ui(c),null===c.blockedOn&&Kb.shift()}function Zd(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),3===a.nodeType?a.parentNode:a}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function ig(a,b,c){(b=zf(a,c.dispatchConfig.phasedRegistrationNames[b]))&&(c._dispatchListeners=fb(c._dispatchListeners,b),c._dispatchInstances=fb(c._dispatchInstances,a))}function Wi(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)ig(c[b],"captured",a);for(b=0;b<c.length;b++)ig(c[b],"bubbled",a)}}function _d(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=zf(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=fb(c._dispatchListeners,b),c._dispatchInstances=fb(c._dispatchInstances,a))}function Xi(a){a&&a.dispatchConfig.registrationName&&_d(a._targetInst,null,a)}function lb(a){zd(a,Wi)}function Cc(){return!0}function Dc(){return!1}function U(a,b,c,d){this.dispatchConfig=a,this._targetInst=b,this.nativeEvent=c,a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);return this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?Cc:Dc,this.isPropagationStopped=Dc,this}O(U.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=Cc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=Cc)},persist:function(){this.isPersistent=Cc},isPersistent:Dc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Dc,this._dispatchInstances=this._dispatchListeners=null}}),U.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},U.extend=function(a){function b(){}function c(){return d.apply(this,arguments)}var d=this;b.prototype=d.prototype;var e=new b();return O(e,c.prototype),c.prototype=e,c.prototype.constructor=c,c.Interface=O({},d.Interface,a),c.extend=d.extend,jg(c),c},jg(U);function Yi(a,b,c,d){if(this.eventPool.length){var e=this.eventPool.pop();return this.call(e,a,b,c,d),e}return new this(a,b,c,d)}function Zi(a){if(!(a instanceof this))throw Error(p(279));a.destructor(),10>this.eventPool.length&&this.eventPool.push(a)}function jg(a){a.eventPool=[],a.getPooled=Yi,a.release=Zi}var _i=U.extend({animationName:null,elapsedTime:null,pseudoElement:null}),$i=U.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Nb=U.extend({view:null,detail:null}),aj=Nb.extend({relatedTarget:null});function Ec(a){var b=a.keyCode;return"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b,10===a&&(a=13),32<=a||13===a?a:0}var bj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ej(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=dj[a])?!!b[a]:!1}function $d(){return ej}for(var fj=Nb.extend({key:function(a){if(a.key){var b=bj[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ec(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?cj[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:$d,charCode:function(a){return"keypress"===a.type?Ec(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===a.type?Ec(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),kg=0,lg=0,mg=!1,ng=!1,Ob=Nb.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:$d,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=kg;return kg=a.screenX,mg?"mousemove"===a.type?a.screenX-b:0:(mg=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=lg;return lg=a.screenY,ng?"mousemove"===a.type?a.screenY-b:0:(ng=!0,0)}}),og=Ob.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),gj=Ob.extend({dataTransfer:null}),hj=Nb.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:$d}),ij=U.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),jj=Ob.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:null,deltaMode:null}),pg=[["blur","blur",0],["cancel","cancel",0],["click","click",0],["close","close",0],["contextmenu","contextMenu",0],["copy","copy",0],["cut","cut",0],["auxclick","auxClick",0],["dblclick","doubleClick",0],["dragend","dragEnd",0],["dragstart","dragStart",0],["drop","drop",0],["focus","focus",0],["input","input",0],["invalid","invalid",0],["keydown","keyDown",0],["keypress","keyPress",0],["keyup","keyUp",0],["mousedown","mouseDown",0],["mouseup","mouseUp",0],["paste","paste",0],["pause","pause",0],["play","play",0],["pointercancel","pointerCancel",0],["pointerdown","pointerDown",0],["pointerup","pointerUp",0],["ratechange","rateChange",0],["reset","reset",0],["seeked","seeked",0],["submit","submit",0],["touchcancel","touchCancel",0],["touchend","touchEnd",0],["touchstart","touchStart",0],["volumechange","volumeChange",0],["drag","drag",1],["dragenter","dragEnter",1],["dragexit","dragExit",1],["dragleave","dragLeave",1],["dragover","dragOver",1],["mousemove","mouseMove",1],["mouseout","mouseOut",1],["mouseover","mouseOver",1],["pointermove","pointerMove",1],["pointerout","pointerOut",1],["pointerover","pointerOver",1],["scroll","scroll",1],["toggle","toggle",1],["touchmove","touchMove",1],["wheel","wheel",1],["abort","abort",2],[Yf,"animationEnd",2],[Zf,"animationIteration",2],[_f,"animationStart",2],["canplay","canPlay",2],["canplaythrough","canPlayThrough",2],["durationchange","durationChange",2],["emptied","emptied",2],["encrypted","encrypted",2],["ended","ended",2],["error","error",2],["gotpointercapture","gotPointerCapture",2],["load","load",2],["loadeddata","loadedData",2],["loadedmetadata","loadedMetadata",2],["loadstart","loadStart",2],["lostpointercapture","lostPointerCapture",2],["playing","playing",2],["progress","progress",2],["seeking","seeking",2],["stalled","stalled",2],["suspend","suspend",2],["timeupdate","timeUpdate",2],[$f,"transitionEnd",2],["waiting","waiting",2]],qg={},ae={},be=0;be<pg.length;be++){var ce=pg[be],rg=ce[0],de=ce[1],kj=ce[2],sg="on"+(de[0].toUpperCase()+de.slice(1)),tg={phasedRegistrationNames:{bubbled:sg,captured:sg+"Capture"},dependencies:[rg],eventPriority:kj};qg[de]=tg,ae[rg]=tg}var ug={eventTypes:qg,getEventPriority:function(a){return a=ae[a],void 0!==a?a.eventPriority:2},extractEvents:function(a,b,c,d){var e=ae[a];if(!e)return null;switch(a){case"keypress":if(0===Ec(c))return null;case"keydown":case"keyup":a=fj;break;case"blur":case"focus":a=aj;break;case"click":if(2===c.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":a=Ob;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":a=gj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":a=hj;break;case Yf:case Zf:case _f:a=_i;break;case $f:a=ij;break;case"scroll":a=Nb;break;case"wheel":a=jj;break;case"copy":case"cut":case"paste":a=$i;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":a=og;break;default:a=U}return b=a.getPooled(e,b,c,d),lb(b),b}},lj=E.unstable_UserBlockingPriority,mj=E.unstable_runWithPriority,nj=ug.getEventPriority,oj=10,Fc=[];function pj(a){var b=a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag,5!==b&&6!==b||a.ancestors.push(c),c=Rb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Zd(a.nativeEvent);d=a.topLevelType;for(var f=a.nativeEvent,g=a.eventSystemFlags,h=null,i=0;i<qc.length;i++){var k=qc[i];k&&(k=k.extractEvents(d,b,f,e,g))&&(h=fb(h,k))}tc(h)}}var Gc=!0;function A(a,b){Pb(b,a,!1)}function Pb(a,b,c){switch(nj(b)){case 0:var d=qj.bind(null,b,1);break;case 1:d=rj.bind(null,b,1);break;default:d=Hc.bind(null,b,1)}c?a.addEventListener(b,d,!0):a.addEventListener(b,d,!1)}function qj(a,b,c){Ra||Hd();var d=Hc,e=Ra;Ra=!0;try{If(d,a,b,c)}finally{(Ra=e)||Jd()}}function rj(a,b,c){mj(lj,Hc.bind(null,a,b,c))}function vg(a,b,c,d){if(Fc.length){var e=Fc.pop();e.topLevelType=a,e.eventSystemFlags=b,e.nativeEvent=c,e.targetInst=d,a=e}else a={topLevelType:a,eventSystemFlags:b,nativeEvent:c,targetInst:d,ancestors:[]};try{if(b=pj,c=a,Id)b(c,void 0);else{Id=!0;try{Jf(b,c,void 0)}finally{Id=!1,Jd()}}}finally{a.topLevelType=null,a.nativeEvent=null,a.targetInst=null,a.ancestors.length=0,Fc.length<oj&&Fc.push(a)}}function Hc(a,b,c){if(Gc)if(0<ga.length&&-1<Xd.indexOf(a))a=Yd(null,a,b,c),ga.push(a);else{var d=ee(a,b,c);null===d?fg(a,c):-1<Xd.indexOf(a)?(a=Yd(d,a,b,c),ga.push(a)):Ti(d,a,b,c)||(fg(a,c),vg(a,b,c,null))}}function ee(a,b,c){var d=Zd(c);d=Rb(d);if(null!==d){var e=Sa(d);if(null===e)d=null;else{var f=e.tag;if(13===f){d=ag(e);if(null!==d)return d;d=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;d=null}else e!==d&&(d=null)}}return vg(a,b,c,d),null}function wg(a){if(!Aa)return!1;a="on"+a;var b=a in document;return b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]),b}var xg=new("function"===typeof WeakMap?WeakMap:Map)();function fe(a){var b=xg.get(a);return void 0===b&&(b=new Set(),xg.set(a,b)),b}function ge(a,b,c){if(!c.has(a)){switch(a){case"scroll":Pb(b,"scroll",!0);break;case"focus":case"blur":Pb(b,"focus",!0),Pb(b,"blur",!0),c.add("blur"),c.add("focus");break;case"cancel":case"close":wg(a)&&Pb(b,a,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Hb.indexOf(a)&&A(a,b)}c.add(a)}}var Qb={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sj=["Webkit","ms","Moz","O"];Object.keys(Qb).forEach(function(a){sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1),Qb[b]=Qb[a]})});function yg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Qb.hasOwnProperty(a)&&Qb[a]?(""+b).trim():b+"px"}function zg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=yg(c,b[c],d);"float"===c&&(c="cssFloat"),d?a.setProperty(c,e):a[c]=e}}var tj=O({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function he(a,b){if(b){if(tj[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(p(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(p(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(p(61))}if(null!=b.style&&"object"!==typeof b.style)throw Error(p(62,""))}}function ie(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function qa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=fe(a);b=wd[b];for(var d=0;d<b.length;d++)ge(b[d],a,c)}function Ic(){}function je(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function Ag(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Bg(a,b){var c=Ag(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,offset:b-a};a=d}s:{for(;c;){if(c.nextSibling){c=c.nextSibling;break s}c=c.parentNode}c=void 0}c=Ag(c)}}function Cg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?Cg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function Dg(){for(var a=window,b=je();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=je(a.document)}return b}function ke(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}var Eg="$",Fg="/$",le="$?",me="$!",ne=null,oe=null;function Gg(a,b){switch(a){case"button":case"input":case"select":case"textarea":return!!b.autoFocus}return!1}function pe(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}var qe="function"===typeof setTimeout?setTimeout:void 0,uj="function"===typeof clearTimeout?clearTimeout:void 0;function mb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function Hg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===Eg||c===me||c===le){if(0===b)return a;b--}else c===Fg&&b++}a=a.previousSibling}return null}var re=Math.random().toString(36).slice(2),Fa="__reactInternalInstance$"+re,Jc="__reactEventHandlers$"+re,se="__reactContainere$"+re;function Rb(a){var b=a[Fa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[se]||c[Fa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=Hg(a);null!==a;){if(c=a[Fa])return c;a=Hg(a)}return b}a=c,c=a.parentNode}return null}function Sb(a){return a=a[Fa]||a[se],!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Ta(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(p(33))}function te(a){return a[Jc]||null}var Ga=null,ue=null,Kc=null;function Ig(){if(Kc)return Kc;var a,b=ue,c=b.length,d,e="value"in Ga?Ga.value:Ga.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return Kc=e.slice(a,1<d?1-d:void 0)}var vj=U.extend({data:null}),wj=U.extend({data:null}),xj=[9,13,27,32],ve=Aa&&"CompositionEvent"in window,Tb=null;Aa&&"documentMode"in document&&(Tb=document.documentMode);var yj=Aa&&"TextEvent"in window&&!Tb,Jg=Aa&&(!ve||Tb&&8<Tb&&11>=Tb),Kg=String.fromCharCode(32),ra={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},Lg=!1;function Mg(a,b){switch(a){case"keyup":return-1!==xj.indexOf(b.keyCode);case"keydown":return 229!==b.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function Ng(a){return a=a.detail,"object"===typeof a&&"data"in a?a.data:null}var nb=!1;function zj(a,b){switch(a){case"compositionend":return Ng(b);case"keypress":return 32!==b.which?null:(Lg=!0,Kg);case"textInput":return a=b.data,a===Kg&&Lg?null:a;default:return null}}function Aj(a,b){if(nb)return"compositionend"===a||!ve&&Mg(a,b)?(a=Ig(),Kc=ue=Ga=null,nb=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return Jg&&"ko"!==b.locale?null:b.data;default:return null}}var Bj={eventTypes:ra,extractEvents:function(a,b,c,d){var e;if(ve)s:{switch(a){case"compositionstart":var f=ra.compositionStart;break s;case"compositionend":f=ra.compositionEnd;break s;case"compositionupdate":f=ra.compositionUpdate;break s}f=void 0}else nb?Mg(a,c)&&(f=ra.compositionEnd):"keydown"===a&&229===c.keyCode&&(f=ra.compositionStart);return f?(Jg&&"ko"!==c.locale&&(nb||f!==ra.compositionStart?f===ra.compositionEnd&&nb&&(e=Ig()):(Ga=d,ue="value"in Ga?Ga.value:Ga.textContent,nb=!0)),f=vj.getPooled(f,b,c,d),e?f.data=e:(e=Ng(c),null!==e&&(f.data=e)),lb(f),e=f):e=null,(a=yj?zj(a,c):Aj(a,c))?(b=wj.getPooled(ra.beforeInput,b,c,d),b.data=a,lb(b)):b=null,null===e?b:null===b?e:[e,b]}},Cj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Og(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Cj[a.type]:"textarea"===b?!0:!1}var Pg={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function Qg(a,b,c){return a=U.getPooled(Pg.change,a,b,c),a.type="change",Gf(c),lb(a),a}var Ub=null,Vb=null;function Dj(a){tc(a)}function Lc(a){var b=Ta(a);if(Of(b))return a}function Ej(a,b){if("change"===a)return b}var we=!1;Aa&&(we=wg("input")&&(!document.documentMode||9<document.documentMode));function Rg(){Ub&&(Ub.detachEvent("onpropertychange",Sg),Vb=Ub=null)}function Sg(a){if("value"===a.propertyName&&Lc(Vb))if(a=Qg(Vb,a,Zd(a)),Ra)tc(a);else{Ra=!0;try{Gd(Dj,a)}finally{Ra=!1,Jd()}}}function Fj(a,b,c){"focus"===a?(Rg(),Ub=b,Vb=c,Ub.attachEvent("onpropertychange",Sg)):"blur"===a&&Rg()}function Gj(a){if("selectionchange"===a||"keyup"===a||"keydown"===a)return Lc(Vb)}function Hj(a,b){if("click"===a)return Lc(b)}function Ij(a,b){if("input"===a||"change"===a)return Lc(b)}var Jj={eventTypes:Pg,_isInputEventSupported:we,extractEvents:function(a,b,c,d){var e=b?Ta(b):window,f=e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Ej;else if(Og(e))if(we)g=Ij;else{g=Gj;var h=Fj}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Hj);if(g&&(g=g(a,b)))return Qg(g,c,d);h&&h(a,e,b),"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Pd(e,"number",e.value)}},Wb={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},xe,Kj={eventTypes:Wb,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;e=d.window===d?d:(e=d.ownerDocument)?e.defaultView||e.parentWindow:window,g?(g=b,b=(b=c.relatedTarget||c.toElement)?Rb(b):null,null!==b&&(f=Sa(b),b!==f||5!==b.tag&&6!==b.tag))&&(b=null):g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a)var h=Ob,i=Wb.mouseLeave,k=Wb.mouseEnter,q="mouse";else("pointerout"===a||"pointerover"===a)&&(h=og,i=Wb.pointerLeave,k=Wb.pointerEnter,q="pointer");a=null==g?e:Ta(g),e=null==b?e:Ta(b),i=h.getPooled(i,g,c,d),i.type=q+"leave",i.target=a,i.relatedTarget=e,d=h.getPooled(k,b,c,d),d.type=q+"enter",d.target=e,d.relatedTarget=a,h=g,q=b;if(h&&q)s:{for(k=h,a=q,g=0,b=k;b;b=pa(b))g++;for(b=0,e=a;e;e=pa(e))b++;for(;0<g-b;)k=pa(k),g--;for(;0<b-g;)a=pa(a),b--;for(;g--;){if(k===a||k===a.alternate)break s;k=pa(k),a=pa(a)}k=null}else k=null;for(a=k,k=[];h&&h!==a;){g=h.alternate;if(null!==g&&g===a)break;k.push(h),h=pa(h)}for(h=[];q&&q!==a;){g=q.alternate;if(null!==g&&g===a)break;h.push(q),q=pa(q)}for(q=0;q<k.length;q++)_d(k[q],"bubbled",i);for(q=h.length;0<q--;)_d(h[q],"captured",d);return c===xe?(xe=null,[i]):(xe=c,[i,d])}};function Lj(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}var Ua="function"===typeof Object.is?Object.is:Lj,Mj=Object.prototype.hasOwnProperty;function Xb(a,b){if(Ua(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!Mj.call(b,c[d])||!Ua(a[c[d]],b[c[d]]))return!1;return!0}var Nj=Aa&&"documentMode"in document&&11>=document.documentMode,Tg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},ob=null,ye=null,Yb=null,ze=!1;function Ug(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;return ze||null==ob||ob!==je(c)?null:(c=ob,"selectionStart"in c&&ke(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Yb&&Xb(Yb,c)?null:(Yb=c,a=U.getPooled(Tg.select,ye,a,b),a.type="select",a.target=ob,lb(a),a))}var Oj={eventTypes:Tg,extractEvents:function(a,b,c,d){var e=d.window===d?d.document:9===d.nodeType?d:d.ownerDocument,f;if(!(f=!e)){s:{e=fe(e),f=wd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break s}e=!0}f=!e}if(f)return null;e=b?Ta(b):window;switch(a){case"focus":(Og(e)||"true"===e.contentEditable)&&(ob=e,ye=b,Yb=null);break;case"blur":Yb=ye=ob=null;break;case"mousedown":ze=!0;break;case"contextmenu":case"mouseup":case"dragend":return ze=!1,Ug(c,d);case"selectionchange":if(Nj)break;case"keydown":case"keyup":return Ug(c,d)}return null}};Ad.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));var Pj=Sb;yd=te,wf=Pj,xf=Ta,Ad.injectEventPluginsByName({SimpleEventPlugin:ug,EnterLeaveEventPlugin:Kj,ChangeEventPlugin:Jj,SelectEventPlugin:Oj,BeforeInputEventPlugin:Bj}),new Set();var Ae=[],pb=-1;function G(a){0>pb||(a.current=Ae[pb],Ae[pb]=null,pb--)}function H(a,b){pb++,Ae[pb]=a.current,a.current=b}var Ha={},R={current:Ha},Z={current:!1},Va=Ha;function qb(a,b){var c=a.type.contextTypes;if(!c)return Ha;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];return d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e),e}function S(a){return a=a.childContextTypes,null!==a&&void 0!==a}function Mc(a){G(Z,a),G(R,a)}function Be(a){G(Z,a),G(R,a)}function Vg(a,b,c){if(R.current!==Ha)throw Error(p(168));H(R,b,a),H(Z,c,a)}function Wg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(p(108,za(b)||"Unknown",e));return O({},c,{},d)}function Nc(a){var b=a.stateNode;return b=b&&b.__reactInternalMemoizedMergedChildContext||Ha,Va=R.current,H(R,b,a),H(Z,Z.current,a),!0}function Xg(a,b,c){var d=a.stateNode;if(!d)throw Error(p(169));c?(b=Wg(a,b,Va),d.__reactInternalMemoizedMergedChildContext=b,G(Z,a),G(R,a),H(R,b,a)):G(Z,a),H(Z,c,a)}var Qj=E.unstable_runWithPriority,Ce=E.unstable_scheduleCallback,Yg=E.unstable_cancelCallback,Rj=E.unstable_shouldYield,Zg=E.unstable_requestPaint,De=E.unstable_now,Sj=E.unstable_getCurrentPriorityLevel,Oc=E.unstable_ImmediatePriority,_g=E.unstable_UserBlockingPriority,$g=E.unstable_NormalPriority,ah=E.unstable_LowPriority,bh=E.unstable_IdlePriority,ch={},Tj=void 0!==Zg?Zg:function(){},sa=null,Pc=null,Ee=!1,dh=De(),ba=10000>dh?De:function(){return De()-dh};function Fe(){switch(Sj()){case Oc:return 99;case _g:return 98;case $g:return 97;case ah:return 96;case bh:return 95;default:throw Error(p(332))}}function eh(a){switch(a){case 99:return Oc;case 98:return _g;case 97:return $g;case 96:return ah;case 95:return bh;default:throw Error(p(332))}}function rb(a,b){return a=eh(a),Qj(a,b)}function fh(a,b,c){return a=eh(a),Ce(a,b,c)}function gh(a){return null===sa?(sa=[a],Pc=Ce(Oc,hh)):sa.push(a),ch}function ha(){if(null!==Pc){var a=Pc;Pc=null,Yg(a)}hh()}function hh(){if(!Ee&&null!==sa){Ee=!0;var a=0;try{var b=sa;rb(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}}),sa=null}catch(c){throw null!==sa&&(sa=sa.slice(a+1)),Ce(Oc,ha),c}finally{Ee=!1}}}var Uj=3;function Qc(a,b,c){return c/=10,1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function ca(a,b){if(a&&a.defaultProps){b=O({},b),a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}var Ge={current:null},Rc=null,sb=null,Sc=null;function He(){Sc=sb=Rc=null}function ih(a,b){var c=a.type._context;H(Ge,c._currentValue,a),c._currentValue=b}function Ie(a){var b=Ge.current;G(Ge,a),a.type._context._currentValue=b}function jh(a,b){for(;null!==a;){var c=a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function tb(a,b){Rc=a,Sc=sb=null,a=a.dependencies,null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ma=!0),a.firstContext=null)}function ia(a,b){if(Sc!==a&&!1!==b&&0!==b){("number"!==typeof b||1073741823===b)&&(Sc=a,b=1073741823),b={context:a,observedBits:b,next:null};if(null===sb){if(null===Rc)throw Error(p(308));sb=b,Rc.dependencies={expirationTime:0,firstContext:b,responders:null}}else sb=sb.next=b}return a._currentValue}var Ia=!1;function Tc(a){return{baseState:a,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Je(a){return{baseState:a.baseState,firstUpdate:a.firstUpdate,lastUpdate:a.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function Ja(a,b){return{expirationTime:a,suspenseConfig:b,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function Uc(a,b){null===a.lastUpdate?a.firstUpdate=a.lastUpdate=b:(a.lastUpdate.next=b,a.lastUpdate=b)}function Ka(a,b){var c=a.alternate;if(null===c){var d=a.updateQueue,e=null;null===d&&(d=a.updateQueue=Tc(a.memoizedState))}else d=a.updateQueue,e=c.updateQueue,null===d?null===e?(d=a.updateQueue=Tc(a.memoizedState),e=c.updateQueue=Tc(c.memoizedState)):d=a.updateQueue=Je(e):null===e&&(e=c.updateQueue=Je(d));null===e||d===e?Uc(d,b):null===d.lastUpdate||null===e.lastUpdate?(Uc(d,b),Uc(e,b)):(Uc(d,b),e.lastUpdate=b)}function kh(a,b){var c=a.updateQueue;c=null===c?a.updateQueue=Tc(a.memoizedState):lh(a,c),null===c.lastCapturedUpdate?c.firstCapturedUpdate=c.lastCapturedUpdate=b:(c.lastCapturedUpdate.next=b,c.lastCapturedUpdate=b)}function lh(a,b){var c=a.alternate;return null!==c&&b===c.updateQueue&&(b=a.updateQueue=Je(b)),b}function mh(a,b,c,d,e,f){switch(c.tag){case 1:return a=c.payload,"function"===typeof a?a.call(f,d,e):a;case 3:a.effectTag=a.effectTag&-4097|64;case 0:a=c.payload,e="function"===typeof a?a.call(f,d,e):a;if(null===e||void 0===e)break;return O({},d,e);case 2:Ia=!0}return d}function Zb(a,b,c,d,e){Ia=!1,b=lh(a,b);for(var f=b.baseState,g=null,h=0,i=b.firstUpdate,k=f;null!==i;){var q=i.expirationTime;q<e?(null===g&&(g=i,f=k),h<q&&(h=q)):(li(q,i.suspenseConfig),k=mh(a,b,i,k,c,d),null!==i.callback&&(a.effectTag|=32,i.nextEffect=null,null===b.lastEffect?b.firstEffect=b.lastEffect=i:(b.lastEffect.nextEffect=i,b.lastEffect=i))),i=i.next}for(q=null,i=b.firstCapturedUpdate;null!==i;){var D=i.expirationTime;D<e?(null===q&&(q=i,null===g&&(f=k)),h<D&&(h=D)):(k=mh(a,b,i,k,c,d),null!==i.callback&&(a.effectTag|=32,i.nextEffect=null,null===b.lastCapturedEffect?b.firstCapturedEffect=b.lastCapturedEffect=i:(b.lastCapturedEffect.nextEffect=i,b.lastCapturedEffect=i))),i=i.next}null===g&&(b.lastUpdate=null),null===q?b.lastCapturedUpdate=null:a.effectTag|=32,null===g&&null===q&&(f=k),b.baseState=f,b.firstUpdate=g,b.firstCapturedUpdate=q,pd(h),a.expirationTime=h,a.memoizedState=k}function nh(a,b,c){null!==b.firstCapturedUpdate&&(null!==b.lastUpdate&&(b.lastUpdate.next=b.firstCapturedUpdate,b.lastUpdate=b.lastCapturedUpdate),b.firstCapturedUpdate=b.lastCapturedUpdate=null),oh(b.firstEffect,c),b.firstEffect=b.lastEffect=null,oh(b.firstCapturedEffect,c),b.firstCapturedEffect=b.lastCapturedEffect=null}function oh(a,b){for(;null!==a;){var c=a.callback;if(null!==c){a.callback=null;var d=b;if("function"!==typeof c)throw Error(p(191,c));c.call(d)}a=a.nextEffect}}var _b=aa.ReactCurrentBatchConfig,ph=new oc.Component().refs;function Vc(a,b,c,d){b=a.memoizedState,c=c(d,b),c=null===c||void 0===c?b:O({},b,c),a.memoizedState=c,d=a.updateQueue,null!==d&&0===a.expirationTime&&(d.baseState=c)}var Wc={isMounted:function(a){return(a=a._reactInternalFiber)?Sa(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ea(),e=_b.suspense;d=_a(d,a,e),e=Ja(d,e),e.payload=b,void 0!==c&&null!==c&&(e.callback=c),Ka(a,e),Oa(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ea(),e=_b.suspense;d=_a(d,a,e),e=Ja(d,e),e.tag=1,e.payload=b,void 0!==c&&null!==c&&(e.callback=c),Ka(a,e),Oa(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ea(),d=_b.suspense;c=_a(c,a,d),d=Ja(c,d),d.tag=2,void 0!==b&&null!==b&&(d.callback=b),Ka(a,d),Oa(a,c)}};function qh(a,b,c,d,e,f,g){return a=a.stateNode,"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,f,g):b.prototype&&b.prototype.isPureReactComponent?!Xb(c,d)||!Xb(e,f):!0}function rh(a,b,c){var d=!1,e=Ha,f=b.contextType;return"object"===typeof f&&null!==f?f=ia(f):(e=S(b)?Va:R.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?qb(a,e):Ha),b=new b(c,f),a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null,b.updater=Wc,a.stateNode=b,b._reactInternalFiber=a,d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f),b}function sh(a,b,c,d){a=b.state,"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d),"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d),b.state!==a&&Wc.enqueueReplaceState(b,b.state,null)}function Ke(a,b,c,d){var e=a.stateNode;e.props=c,e.state=a.memoizedState,e.refs=ph;var f=b.contextType;"object"===typeof f&&null!==f?e.context=ia(f):(f=S(b)?Va:R.current,e.context=qb(a,f)),f=a.updateQueue,null!==f&&(Zb(a,f,c,e,d),e.state=a.memoizedState),f=b.getDerivedStateFromProps,"function"===typeof f&&(Vc(a,b,f,c),e.state=a.memoizedState),"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Wc.enqueueReplaceState(e,e.state,null),f=a.updateQueue,null!==f&&(Zb(a,f,c,e,d),e.state=a.memoizedState)),"function"===typeof e.componentDidMount&&(a.effectTag|=4)}var Xc=Array.isArray;function $b(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(p(309));var d=c.stateNode}if(!d)throw Error(p(147,a));var e=""+a;return null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e?b.ref:(b=function(f){var g=d.refs;g===ph&&(g=d.refs={}),null===f?delete g[e]:g[e]=f},b._stringRef=e,b)}if("string"!==typeof a)throw Error(p(284));if(!c._owner)throw Error(p(290,a))}return a}function Yc(a,b){if("textarea"!==a.type)throw Error(p(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""))}function th(a){function b(l,j){if(a){var m=l.lastEffect;null!==m?(m.nextEffect=j,l.lastEffect=j):l.firstEffect=l.lastEffect=j,j.nextEffect=null,j.effectTag=8}}function c(l,j){if(!a)return null;for(;null!==j;)b(l,j),j=j.sibling;return null}function d(l,j){for(l=new Map();null!==j;)null!==j.key?l.set(j.key,j):l.set(j.index,j),j=j.sibling;return l}function e(l,j,m){return l=bb(l,j,m),l.index=0,l.sibling=null,l}function f(l,j,m){return l.index=m,a?(m=l.alternate,null!==m?(m=m.index,m<j?(l.effectTag=2,j):m):(l.effectTag=2,j)):j}function g(l){return a&&null===l.alternate&&(l.effectTag=2),l}function h(l,j,m,n){return null===j||6!==j.tag?(j=of(m,l.mode,n),j.return=l,j):(j=e(j,m,n),j.return=l,j)}function i(l,j,m,n){return null!==j&&j.elementType===m.type?(n=e(j,m.props,n),n.ref=$b(l,j,m),n.return=l,n):(n=qd(m.type,m.key,m.props,null,l.mode,n),n.ref=$b(l,j,m),n.return=l,n)}function k(l,j,m,n){return null===j||4!==j.tag||j.stateNode.containerInfo!==m.containerInfo||j.stateNode.implementation!==m.implementation?(j=pf(m,l.mode,n),j.return=l,j):(j=e(j,m.children||[],n),j.return=l,j)}function q(l,j,m,n,o){return null===j||7!==j.tag?(j=Qa(m,l.mode,n,o),j.return=l,j):(j=e(j,m,n),j.return=l,j)}function D(l,j,m){if("string"===typeof j||"number"===typeof j)return j=of(""+j,l.mode,m),j.return=l,j;if("object"===typeof j&&null!==j){switch(j.$$typeof){case uc:return m=qd(j.type,j.key,j.props,null,l.mode,m),m.ref=$b(l,null,j),m.return=l,m;case gb:return j=pf(j,l.mode,m),j.return=l,j}if(Xc(j)||Fb(j))return j=Qa(j,l.mode,m,null),j.return=l,j;Yc(l,j)}return null}function z(l,j,m,n){var o=null!==j?j.key:null;if("string"===typeof m||"number"===typeof m)return null!==o?null:h(l,j,""+m,n);if("object"===typeof m&&null!==m){switch(m.$$typeof){case uc:return m.key===o?m.type===ya?q(l,j,m.props.children,n,o):i(l,j,m,n):null;case gb:return m.key===o?k(l,j,m,n):null}if(Xc(m)||Fb(m))return null!==o?null:q(l,j,m,n,null);Yc(l,m)}return null}function I(l,j,m,n,o){if("string"===typeof n||"number"===typeof n)return l=l.get(m)||null,h(j,l,""+n,o);if("object"===typeof n&&null!==n){switch(n.$$typeof){case uc:return l=l.get(null===n.key?m:n.key)||null,n.type===ya?q(j,l,n.props.children,o,n.key):i(j,l,n,o);case gb:return l=l.get(null===n.key?m:n.key)||null,k(j,l,n,o)}if(Xc(n)||Fb(n))return l=l.get(m)||null,q(j,l,n,o,null);Yc(j,n)}return null}function F(l,j,m,n){for(var o=null,r=null,u=j,y=j=0,B=null;null!==u&&y<m.length;y++){u.index>y?(B=u,u=null):B=u.sibling;var x=z(l,u,m[y],n);if(null===x){null===u&&(u=B);break}a&&u&&null===x.alternate&&b(l,u),j=f(x,j,y),null===r?o=x:r.sibling=x,r=x,u=B}if(y===m.length)return c(l,u),o;if(null===u){for(;y<m.length;y++)u=D(l,m[y],n),null!==u&&(j=f(u,j,y),null===r?o=u:r.sibling=u,r=u);return o}for(u=d(l,u);y<m.length;y++)B=I(u,l,y,m[y],n),null!==B&&(a&&null!==B.alternate&&u.delete(null===B.key?y:B.key),j=f(B,j,y),null===r?o=B:r.sibling=B,r=B);return a&&u.forEach(function(fa){return b(l,fa)}),o}function xa(l,j,m,n){var o=Fb(m);if("function"!==typeof o)throw Error(p(150));m=o.call(m);if(null==m)throw Error(p(151));for(var r=o=null,u=j,y=j=0,B=null,x=m.next();null!==u&&!x.done;y++,x=m.next()){u.index>y?(B=u,u=null):B=u.sibling;var fa=z(l,u,x.value,n);if(null===fa){null===u&&(u=B);break}a&&u&&null===fa.alternate&&b(l,u),j=f(fa,j,y),null===r?o=fa:r.sibling=fa,r=fa,u=B}if(x.done)return c(l,u),o;if(null===u){for(;!x.done;y++,x=m.next())x=D(l,x.value,n),null!==x&&(j=f(x,j,y),null===r?o=x:r.sibling=x,r=x);return o}for(u=d(l,u);!x.done;y++,x=m.next())x=I(u,l,y,x.value,n),null!==x&&(a&&null!==x.alternate&&u.delete(null===x.key?y:x.key),j=f(x,j,y),null===r?o=x:r.sibling=x,r=x);return a&&u.forEach(function(td){return b(l,td)}),o}return function(l,j,m,n){var o="object"===typeof m&&null!==m&&m.type===ya&&null===m.key;o&&(m=m.props.children);var r="object"===typeof m&&null!==m;if(r)switch(m.$$typeof){case uc:s:{for(r=m.key,o=j;null!==o;){if(o.key===r)if(7===o.tag?m.type===ya:o.elementType===m.type){c(l,o.sibling),j=e(o,m.type===ya?m.props.children:m.props,n),j.ref=$b(l,o,m),j.return=l,l=j;break s}else{c(l,o);break}else b(l,o);o=o.sibling}m.type===ya?(j=Qa(m.props.children,l.mode,n,m.key),j.return=l,l=j):(n=qd(m.type,m.key,m.props,null,l.mode,n),n.ref=$b(l,j,m),n.return=l,l=n)}return g(l);case gb:s:{for(o=m.key;null!==j;){if(j.key===o)if(4===j.tag&&j.stateNode.containerInfo===m.containerInfo&&j.stateNode.implementation===m.implementation){c(l,j.sibling),j=e(j,m.children||[],n),j.return=l,l=j;break s}else{c(l,j);break}else b(l,j);j=j.sibling}j=pf(m,l.mode,n),j.return=l,l=j}return g(l)}if("string"===typeof m||"number"===typeof m)return m=""+m,null!==j&&6===j.tag?(c(l,j.sibling),j=e(j,m,n),j.return=l,l=j):(c(l,j),j=of(m,l.mode,n),j.return=l,l=j),g(l);if(Xc(m))return F(l,j,m,n);if(Fb(m))return xa(l,j,m,n);r&&Yc(l,m);if("undefined"===typeof m&&!o)switch(l.tag){case 1:case 0:throw l=l.type,Error(p(152,l.displayName||l.name||"Component"))}return c(l,j)}}var ub=th(!0),Le=th(!1),ac={},ja={current:ac},bc={current:ac},cc={current:ac};function Wa(a){if(a===ac)throw Error(p(174));return a}function Me(a,b){H(cc,b,a),H(bc,a,a),H(ja,ac,a);var c=b.nodeType;switch(c){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Td(null,"");break;default:c=8===c?b.parentNode:b,b=c.namespaceURI||null,c=c.tagName,b=Td(b,c)}G(ja,a),H(ja,b,a)}function vb(a){G(ja,a),G(bc,a),G(cc,a)}function uh(a){Wa(cc.current);var b=Wa(ja.current),c=Td(b,a.type);b!==c&&(H(bc,a,a),H(ja,c,a))}function Ne(a){bc.current===a&&(G(ja,a),G(bc,a))}var C={current:0};function Zc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===le||c.data===me))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b,b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}function vh(a,b){return{responder:a,props:b}}var _c=aa.ReactCurrentDispatcher,_=aa.ReactCurrentBatchConfig,dc=0,La=null,N=null,ka=null,wb=null,T=null,xb=null,yb=0,la=null,ec=0,fc=!1,ta=null,gc=0;function V(){throw Error(p(321))}function Oe(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Ua(a[c],b[c]))return!1;return!0}function Pe(a,b,c,d,e,f){dc=f,La=b,ka=null!==a?a.memoizedState:null,_c.current=null===ka?Vj:Gh,b=c(d,e);if(fc){do fc=!1,gc+=1,ka=null!==a?a.memoizedState:null,xb=wb,la=T=N=null,_c.current=Gh,b=c(d,e);while(fc);ta=null,gc=0}_c.current=$c,a=La,a.memoizedState=wb,a.expirationTime=yb,a.updateQueue=la,a.effectTag|=ec,a=null!==N&&null!==N.next,dc=0,xb=T=wb=ka=N=La=null,yb=0,la=null,ec=0;if(a)throw Error(p(300));return b}function wh(){_c.current=$c,dc=0,xb=T=wb=ka=N=La=null,yb=0,la=null,ec=0,fc=!1,ta=null,gc=0}function zb(){var a={memoizedState:null,baseState:null,queue:null,baseUpdate:null,next:null};return null===T?wb=T=a:T=T.next=a,T}function hc(){if(null!==xb)T=xb,xb=T.next,N=ka,ka=null!==N?N.next:null;else{if(null===ka)throw Error(p(310));N=ka;var a={memoizedState:N.memoizedState,baseState:N.baseState,queue:N.queue,baseUpdate:N.baseUpdate,next:null};T=null===T?wb=a:T.next=a,ka=N.next}return T}function xh(a,b){return"function"===typeof b?b(a):b}function yh(a){var b=hc(),c=b.queue;if(null===c)throw Error(p(311));c.lastRenderedReducer=a;if(0<gc){var d=c.dispatch;if(null!==ta){var e=ta.get(c);if(void 0!==e){ta.delete(c);var f=b.memoizedState;do f=a(f,e.action),e=e.next;while(null!==e);return Ua(f,b.memoizedState)||(ma=!0),b.memoizedState=f,b.baseUpdate===c.last&&(b.baseState=f),c.lastRenderedState=f,[f,d]}}return[b.memoizedState,d]}d=c.last;var g=b.baseUpdate;f=b.baseState,null!==g?(null!==d&&(d.next=null),d=g.next):d=null!==d?d.next:null;if(null!==d){var h=e=null,i=d,k=!1;do{var q=i.expirationTime;q<dc?(k||(k=!0,h=g,e=f),q>yb&&(yb=q,pd(yb))):(li(q,i.suspenseConfig),f=i.eagerReducer===a?i.eagerState:a(f,i.action)),g=i,i=i.next}while(null!==i&&i!==d);k||(h=g,e=f),Ua(f,b.memoizedState)||(ma=!0),b.memoizedState=f,b.baseUpdate=h,b.baseState=e,c.lastRenderedState=f}return[b.memoizedState,c.dispatch]}function Qe(a){var b=zb();return"function"===typeof a&&(a=a()),b.memoizedState=b.baseState=a,a=b.queue={last:null,dispatch:null,lastRenderedReducer:xh,lastRenderedState:a},a=a.dispatch=Fh.bind(null,La,a),[b.memoizedState,a]}function Re(a){return yh(xh,a)}function Se(a,b,c,d){return a={tag:a,create:b,destroy:c,deps:d,next:null},null===la?(la={lastEffect:null},la.lastEffect=a.next=a):(b=la.lastEffect,null===b?la.lastEffect=a.next=a:(c=b.next,b.next=a,a.next=c,la.lastEffect=a)),a}function Te(a,b,c,d){var e=zb();ec|=a,e.memoizedState=Se(b,c,void 0,void 0===d?null:d)}function Ue(a,b,c,d){var e=hc();d=void 0===d?null:d;var f;if(null!==N){var g=N.memoizedState;f=g.destroy;if(null!==d&&Oe(d,g.deps)){Se(0,c,f,d);return}}ec|=a,e.memoizedState=Se(b,c,f,d)}function zh(a,b){return Te(516,192,a,b)}function Ah(a,b){return Ue(516,192,a,b)}function Bh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function Ch(){}function Dh(a,b){return zb().memoizedState=[a,void 0===b?null:b],a}function Eh(a,b){var c=hc();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&Oe(b,d[1])?d[0]:(c.memoizedState=[a,b],a)}function Fh(a,b,c){if(!(25>gc))throw Error(p(301));var d=a.alternate;if(a===La||null!==d&&d===La)if(fc=!0,a={expirationTime:dc,suspenseConfig:null,action:c,eagerReducer:null,eagerState:null,next:null},null===ta&&(ta=new Map()),c=ta.get(b),void 0===c)ta.set(b,a);else{for(b=c;null!==b.next;)b=b.next;b.next=a}else{var e=ea(),f=_b.suspense;e=_a(e,a,f),f={expirationTime:e,suspenseConfig:f,action:c,eagerReducer:null,eagerState:null,next:null};var g=b.last;if(null===g)f.next=f;else{var h=g.next;null!==h&&(f.next=h),g.next=f}b.last=f;if(0===a.expirationTime&&(null===d||0===d.expirationTime)&&(d=b.lastRenderedReducer,null!==d))try{var i=b.lastRenderedState,k=d(i,c);f.eagerReducer=d,f.eagerState=k;if(Ua(k,i))return}catch(q){}finally{}Oa(a,e)}}var $c={readContext:ia,useCallback:V,useContext:V,useEffect:V,useImperativeHandle:V,useLayoutEffect:V,useMemo:V,useReducer:V,useRef:V,useState:V,useDebugValue:V,useResponder:V,useDeferredValue:V,useTransition:V},Vj={readContext:ia,useCallback:Dh,useContext:ia,useEffect:zh,useImperativeHandle:function(a,b,c){return c=null!==c&&void 0!==c?c.concat([a]):null,Te(4,36,Bh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return Te(4,36,a,b)},useMemo:function(a,b){var c=zb();return b=void 0===b?null:b,a=a(),c.memoizedState=[a,b],a},useReducer:function(a,b,c){var d=zb();return b=void 0!==c?c(b):b,d.memoizedState=d.baseState=b,a=d.queue={last:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b},a=a.dispatch=Fh.bind(null,La,a),[d.memoizedState,a]},useRef:function(a){var b=zb();return a={current:a},b.memoizedState=a},useState:Qe,useDebugValue:Ch,useResponder:vh,useDeferredValue:function(a,b){var c=Qe(a),d=c[0],e=c[1];return zh(function(){E.unstable_next(function(){var f=_.suspense;_.suspense=void 0===b?null:b;try{e(a)}finally{_.suspense=f}})},[a,b]),d},useTransition:function(a){var b=Qe(!1),c=b[0],d=b[1];return[Dh(function(e){d(!0),E.unstable_next(function(){var f=_.suspense;_.suspense=void 0===a?null:a;try{d(!1),e()}finally{_.suspense=f}})},[a,c]),c]}},Gh={readContext:ia,useCallback:Eh,useContext:ia,useEffect:Ah,useImperativeHandle:function(a,b,c){return c=null!==c&&void 0!==c?c.concat([a]):null,Ue(4,36,Bh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return Ue(4,36,a,b)},useMemo:function(a,b){var c=hc();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&Oe(b,d[1])?d[0]:(a=a(),c.memoizedState=[a,b],a)},useReducer:yh,useRef:function(){return hc().memoizedState},useState:Re,useDebugValue:Ch,useResponder:vh,useDeferredValue:function(a,b){var c=Re(a),d=c[0],e=c[1];return Ah(function(){E.unstable_next(function(){var f=_.suspense;_.suspense=void 0===b?null:b;try{e(a)}finally{_.suspense=f}})},[a,b]),d},useTransition:function(a){var b=Re(!1),c=b[0],d=b[1];return[Eh(function(e){d(!0),E.unstable_next(function(){var f=_.suspense;_.suspense=void 0===a?null:a;try{d(!1),e()}finally{_.suspense=f}})},[a,c]),c]}},ua=null,Ma=null,Xa=!1;function Hh(a,b){var c=oa(5,null,null,0);c.elementType="DELETED",c.type="DELETED",c.stateNode=b,c.return=a,c.effectTag=8,null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function Ih(a,b){switch(a.tag){case 5:var c=a.type;return b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b,null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function Ve(a){if(Xa){var b=Ma;if(b){var c=b;if(!Ih(a,b)){b=mb(c.nextSibling);if(!b||!Ih(a,b)){a.effectTag=a.effectTag&-1025|2,Xa=!1,ua=a;return}Hh(ua,c)}ua=a,Ma=mb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Xa=!1,ua=a}}function Jh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ua=a}function ad(a){if(a!==ua)return!1;if(!Xa)return Jh(a),Xa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==b&&!pe(b,a.memoizedProps))for(b=Ma;b;)Hh(a,b),b=mb(b.nextSibling);Jh(a);if(13===a.tag){a=a.memoizedState,a=null!==a?a.dehydrated:null;if(!a)throw Error(p(317));s:{for(a=a.nextSibling,b=0;a;){if(8===a.nodeType){var c=a.data;if(c===Fg){if(0===b){Ma=mb(a.nextSibling);break s}b--}else c!==Eg&&c!==me&&c!==le||b++}a=a.nextSibling}Ma=null}}else Ma=ua?mb(a.stateNode.nextSibling):null;return!0}function We(){Ma=ua=null,Xa=!1}var Wj=aa.ReactCurrentOwner,ma=!1;function W(a,b,c,d){b.child=null===a?Le(b,null,c,d):ub(b,a.child,c,d)}function Kh(a,b,c,d,e){c=c.render;var f=b.ref;return tb(b,e),d=Pe(a,b,c,d,f,e),null!==a&&!ma?(b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),va(a,b,e)):(b.effectTag|=1,W(a,b,d,e),b.child)}function Lh(a,b,c,d,e,f){if(null===a){var g=c.type;return"function"===typeof g&&!nf(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps?(b.tag=15,b.type=g,Mh(a,b,g,d,e,f)):(a=qd(c.type,null,d,null,b.mode,f),a.ref=b.ref,a.return=b,b.child=a)}return g=a.child,e<f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Xb,c(e,d)&&a.ref===b.ref)?va(a,b,f):(b.effectTag|=1,a=bb(g,d,f),a.ref=b.ref,a.return=b,b.child=a)}function Mh(a,b,c,d,e,f){return null!==a&&Xb(a.memoizedProps,d)&&a.ref===b.ref&&(ma=!1,e<f)?va(a,b,f):Xe(a,b,c,d,f)}function Nh(a,b){var c=b.ref;(null===a&&null!==c||null!==a&&a.ref!==c)&&(b.effectTag|=128)}function Xe(a,b,c,d,e){var f=S(c)?Va:R.current;return f=qb(b,f),tb(b,e),c=Pe(a,b,c,d,f,e),null!==a&&!ma?(b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),va(a,b,e)):(b.effectTag|=1,W(a,b,c,e),b.child)}function Oh(a,b,c,d,e){if(S(c)){var f=!0;Nc(b)}else f=!1;tb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),rh(b,c,d,e),Ke(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var i=g.context,k=c.contextType;"object"===typeof k&&null!==k?k=ia(k):(k=S(c)?Va:R.current,k=qb(b,k));var q=c.getDerivedStateFromProps,D="function"===typeof q||"function"===typeof g.getSnapshotBeforeUpdate;D||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||i!==k)&&sh(b,g,d,k),Ia=!1;var z=b.memoizedState;i=g.state=z;var I=b.updateQueue;null!==I&&(Zb(b,I,d,g,e),i=b.memoizedState),h!==d||z!==i||Z.current||Ia?("function"===typeof q&&(Vc(b,c,q,d),i=b.memoizedState),(h=Ia||qh(b,c,h,d,z,i,k))?(D||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=i),g.props=d,g.state=i,g.context=k,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,h=b.memoizedProps,g.props=b.type===b.elementType?h:ca(b.type,h),i=g.context,k=c.contextType,"object"===typeof k&&null!==k?k=ia(k):(k=S(c)?Va:R.current,k=qb(b,k)),q=c.getDerivedStateFromProps,(D="function"===typeof q||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||i!==k)&&sh(b,g,d,k),Ia=!1,i=b.memoizedState,z=g.state=i,I=b.updateQueue,null!==I&&(Zb(b,I,d,g,e),z=b.memoizedState),h!==d||i!==z||Z.current||Ia?("function"===typeof q&&(Vc(b,c,q,d),z=b.memoizedState),(q=Ia||qh(b,c,h,d,i,z,k))?(D||"function"!==typeof g.UNSAFE_componentWillUpdate&&"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,z,k),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,z,k)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&i===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&i===a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=z),g.props=d,g.state=z,g.context=k,d=q):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&i===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&i===a.memoizedState||(b.effectTag|=256),d=!1);return Ye(a,b,c,d,f,e)}function Ye(a,b,c,d,e,f){Nh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Xg(b,c,!1),va(a,b,f);d=b.stateNode,Wj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?null:d.render();return b.effectTag|=1,null!==a&&g?(b.child=ub(b,a.child,null,f),b.child=ub(b,null,h,f)):W(a,b,h,f),b.memoizedState=d.state,e&&Xg(b,c,!0),b.child}function Ph(a){var b=a.stateNode;b.pendingContext?Vg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Vg(a,b.context,!1),Me(a,b.containerInfo)}var Ze={dehydrated:null,retryTime:0};function Qh(a,b,c){var d=b.mode,e=b.pendingProps,f=C.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState)),h?(g=!0,b.effectTag&=-65):null!==a&&null===a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1),H(C,f&1,b);if(null===a){void 0!==e.fallback&&Ve(b);if(g){g=e.fallback,e=Qa(null,d,0,null),e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;return c=Qa(g,d,c,null),c.return=b,e.sibling=c,b.memoizedState=Ze,b.child=e,c}return d=e.children,b.memoizedState=null,b.child=Le(b,null,d,c)}if(null!==a.memoizedState){a=a.child,d=a.sibling;if(g){e=e.fallback,c=bb(a,a.pendingProps,0),c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;return d=bb(d,e,d.expirationTime),d.return=b,c.sibling=d,c.childExpirationTime=0,b.memoizedState=Ze,b.child=c,d}return c=ub(b,a.child,e.children,c),b.memoizedState=null,b.child=c}a=a.child;if(g){g=e.fallback,e=Qa(null,d,0,null),e.return=b,e.child=a,null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;return c=Qa(g,d,c,null),c.return=b,e.sibling=c,c.effectTag|=2,e.childExpirationTime=0,b.memoizedState=Ze,b.child=e,c}return b.memoizedState=null,b.child=ub(b,a,e.children,c)}function Rh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b),jh(a.return,b)}function _e(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,last:d,tail:c,tailExpiration:0,tailMode:e,lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function Sh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;W(a,b,d.children,c),d=C.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))s:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&Rh(a,c);else if(19===a.tag)Rh(a,c);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===b)break s;for(;null===a.sibling;){if(null===a.return||a.return===b)break s;a=a.return}a.sibling.return=a.return,a=a.sibling}d&=1}H(C,d,b);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case"forwards":for(c=b.child,e=null;null!==c;)a=c.alternate,null!==a&&null===Zc(a)&&(e=c),c=c.sibling;c=e,null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null),_e(b,!1,e,c,f,b.lastEffect);break;case"backwards":for(c=null,e=b.child,b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Zc(a)){b.child=e;break}a=e.sibling,e.sibling=c,c=e,e=a}_e(b,!0,c,null,f,b.lastEffect);break;case"together":_e(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function va(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&pd(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(p(153));if(null!==b.child){for(a=b.child,c=bb(a,a.pendingProps,a.expirationTime),b.child=c,c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=bb(a,a.pendingProps,a.expirationTime),c.return=b;c.sibling=null}return b.child}function Ab(a){a.effectTag|=4}var Th,$e,Uh,Vh;Th=function(a,b){for(var c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c,c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},$e=function(){},Uh=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Wa(ja.current),a=null;switch(c){case"input":f=Nd(g,f),d=Nd(g,d),a=[];break;case"option":f=Qd(g,f),d=Qd(g,d),a=[];break;case"select":f=O({},f,{value:void 0}),d=O({},d,{value:void 0}),a=[];break;case"textarea":f=Rd(g,f),d=Rd(g,d),a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=Ic)}he(c,d);var h,i;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(i in g=f[h],g)g.hasOwnProperty(i)&&(c||(c={}),c[i]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(eb.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(i in g)!g.hasOwnProperty(i)||k&&k.hasOwnProperty(i)||(c||(c={}),c[i]="");for(i in k)k.hasOwnProperty(i)&&g[i]!==k[i]&&(c||(c={}),c[i]=k[i])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||[]).push(h,""+k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(eb.hasOwnProperty(h)?(null!=k&&qa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c),e=a,(b.updateQueue=e)&&Ab(b)}},Vh=function(a,b,c,d){c!==d&&Ab(b)};function bd(a,b){switch(a.tailMode){case"hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function Xj(a){switch(a.tag){case 1:S(a.type)&&Mc(a);var b=a.effectTag;return b&4096?(a.effectTag=b&-4097|64,a):null;case 3:vb(a),Be(a),b=a.effectTag;if(0!==(b&64))throw Error(p(285));return a.effectTag=b&-4097|64,a;case 5:return Ne(a),null;case 13:return G(C,a),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return G(C,a),null;case 4:return vb(a),null;case 10:return Ie(a),null;default:return null}}function af(a,b){return{value:a,source:b,stack:Ed(b)}}var Yj="function"===typeof WeakSet?WeakSet:Set;function bf(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Ed(c)),null!==c&&za(c.type),b=b.value,null!==a&&1===a.tag&&za(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e})}}function Zj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){ab(a,c)}}function Wh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){ab(a,c)}else b.current=null}function _j(a,b){switch(b.tag){case 0:case 11:case 15:ic(2,0,b);break;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode,b=a.getSnapshotBeforeUpdate(b.elementType===b.type?c:ca(b.type,c),d),a.__reactInternalSnapshotBeforeUpdate=b}break;case 3:case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}function ic(a,b,c){c=c.updateQueue,c=null!==c?c.lastEffect:null;if(null!==c){var d=c=c.next;do{if(0!==(d.tag&a)){var e=d.destroy;d.destroy=void 0,void 0!==e&&e()}0!==(d.tag&b)&&(e=d.create,d.destroy=e()),d=d.next}while(d!==c)}}function Xh(a,b,c){"function"===typeof mf&&mf(b);switch(b.tag){case 0:case 11:case 14:case 15:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;rb(97<c?97:c,function(){var e=d;do{var f=e.destroy;if(void 0!==f){var g=b;try{f()}catch(h){ab(g,h)}}e=e.next}while(e!==d)})}break;case 1:Wh(b),c=b.stateNode,"function"===typeof c.componentWillUnmount&&Zj(b,c);break;case 5:Wh(b);break;case 4:$h(a,b,c)}}function Yh(a){var b=a.alternate;a.return=null,a.child=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.alternate=null,a.firstEffect=null,a.lastEffect=null,a.pendingProps=null,a.memoizedProps=null,null!==b&&Yh(b)}function Zh(a){return 5===a.tag||3===a.tag||4===a.tag}function _h(a){s:{for(var b=a.return;null!==b;){if(Zh(b)){var c=b;break s}b=b.return}throw Error(p(160))}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo,d=!0;break;case 4:b=b.containerInfo,d=!0;break;default:throw Error(p(161))}c.effectTag&16&&(Gb(b,""),c.effectTag&=-17);s:$:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Zh(c.return)){c=null;break s}c=c.return}for(c.sibling.return=c.return,c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue $;if(null===c.child||4===c.tag)continue $;c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break s}}for(var e=a;;){var f=5===e.tag||6===e.tag;if(f){var g=f?e.stateNode:e.stateNode.instance;if(c)if(d){f=b;var h=g;g=c,8===f.nodeType?f.parentNode.insertBefore(h,g):f.insertBefore(h,g)}else b.insertBefore(g,c);else d?(h=b,8===h.nodeType?(f=h.parentNode,f.insertBefore(g,h)):(f=h,f.appendChild(g)),h=h._reactRootContainer,null!==h&&void 0!==h||null!==f.onclick||(f.onclick=Ic)):b.appendChild(g)}else if(4!==e.tag&&null!==e.child){e.child.return=e,e=e.child;continue}if(e===a)break;for(;null===e.sibling;){if(null===e.return||e.return===a)return;e=e.return}e.sibling.return=e.return,e=e.sibling}}function $h(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;s:for(;;){if(null===e)throw Error(p(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break s;case 3:f=f.containerInfo,g=!0;break s;case 4:f=f.containerInfo,g=!0;break s}e=e.return}e=!0}if(5===d.tag||6===d.tag){s:for(var h=a,i=d,k=c,q=i;;)if(Xh(h,q,k),null!==q.child&&4!==q.tag)q.child.return=q,q=q.child;else{if(q===i)break;for(;null===q.sibling;){if(null===q.return||q.return===i)break s;q=q.return}q.sibling.return=q.return,q=q.sibling}g?(h=f,i=d.stateNode,8===h.nodeType?h.parentNode.removeChild(i):h.removeChild(i)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo,g=!0,d.child.return=d,d=d.child;continue}}else if(Xh(a,d,c),null!==d.child){d.child.return=d,d=d.child;continue}if(d===b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return,4===d.tag&&(e=!1)}d.sibling.return=d.return,d=d.sibling}}function cf(a,b){switch(b.tag){case 0:case 11:case 14:case 15:ic(4,8,b);break;case 1:break;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){for(c[Jc]=d,"input"===a&&"radio"===d.type&&null!=d.name&&Qf(c,d),ie(a,e),b=ie(a,d),e=0;e<f.length;e+=2){var g=f[e],h=f[e+1];"style"===g?zg(c,h):"dangerouslySetInnerHTML"===g?Wf(c,h):"children"===g?Gb(c,h):Md(c,g,h,b)}switch(a){case"input":Od(c,d);break;case"textarea":Tf(c,d);break;case"select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?jb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?jb(c,!!d.multiple,d.defaultValue,!0):jb(c,!!d.multiple,d.multiple?[]:"",!1))}}}break;case 6:if(null===b.stateNode)throw Error(p(162));b.stateNode.nodeValue=b.memoizedProps;break;case 3:b=b.stateNode,b.hydrate&&(b.hydrate=!1,hg(b.containerInfo));break;case 12:break;case 13:c=b,null===b.memoizedState?d=!1:(d=!0,c=b.child,ff=ba());if(null!==c)s:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=yg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling,f.return=a,a=f;continue}else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===c)break s;for(;null===a.sibling;){if(null===a.return||a.return===c)break s;a=a.return}a.sibling.return=a.return,a=a.sibling}ai(b);break;case 19:ai(b);break;case 17:break;case 20:break;case 21:break;default:throw Error(p(163))}}function ai(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=new Yj()),b.forEach(function(d){var e=ik.bind(null,a,d);c.has(d)||(c.add(d),d.then(e,e))})}}var $j="function"===typeof WeakMap?WeakMap:Map;function bi(a,b,c){c=Ja(c,null),c.tag=3,c.payload={element:null};var d=b.value;return c.callback=function(){jd||(jd=!0,gf=d),bf(a,b)},c}function ci(a,b,c){c=Ja(c,null),c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){return bf(a,b),d(e)}}var f=a.stateNode;return null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&(null===Na?Na=new Set([this]):Na.add(this),bf(a,b));var g=b.stack;this.componentDidCatch(b.value,{componentStack:null!==g?g:""})}),c}var ak=Math.ceil,cd=aa.ReactCurrentDispatcher,di=aa.ReactCurrentOwner,J=0,df=8,da=16,na=32,Ya=0,dd=1,ei=2,ed=3,fd=4,ef=5,v=J,X=null,w=null,Q=0,K=Ya,gd=null,wa=1073741823,jc=1073741823,hd=null,kc=0,id=!1,ff=0,fi=500,t=null,jd=!1,gf=null,Na=null,kd=!1,ld=null,lc=90,Za=null,mc=0,hf=null,md=0;function ea(){return(v&(da|na))!==J?1073741821-(ba()/10|0):0!==md?md:md=1073741821-(ba()/10|0)}function _a(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Fe();if(0===(b&4))return 99===d?1073741823:1073741822;if((v&da)!==J)return Q;if(null!==c)a=Qc(a,c.timeoutMs|0||5000,250);else switch(d){case 99:a=1073741823;break;case 98:a=Qc(a,150,100);break;case 97:case 96:a=Qc(a,5000,250);break;case 95:a=2;break;default:throw Error(p(326))}return null!==X&&a===Q&&--a,a}function Oa(a,b){if(50<mc)throw mc=0,hf=null,Error(p(185));a=nd(a,b);if(null!==a){var c=Fe();1073741823===b?(v&df)!==J&&(v&(da|na))===J?jf(a):(Y(a),v===J&&ha()):Y(a),(v&4)===J||98!==c&&99!==c||(null===Za?Za=new Map([[a,b]]):(c=Za.get(a),(void 0===c||c>b)&&Za.set(a,b)))}}function nd(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate,d.childExpirationTime<b&&(d.childExpirationTime=b),null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}return null!==e&&(X===e&&(pd(b),K===fd&&cb(e,Q)),ri(e,b)),e}function od(a){var b=a.lastExpiredTime;return 0!==b?b:(b=a.firstPendingTime,qi(a,b)?(b=a.lastPingedTime,a=a.nextKnownPendingLevel,b>a?b:a):b)}function Y(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=gh(jf.bind(null,a));else{var b=od(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ea();1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==ch&&Yg(c)}a.callbackExpirationTime=b,a.callbackPriority=d,b=1073741823===b?gh(jf.bind(null,a)):fh(d,gi.bind(null,a),{timeout:10*(1073741821-b)-ba()}),a.callbackNode=b}}}function gi(a,b){md=0;if(b)return b=ea(),qf(a,b),Y(a),null;var c=od(a);if(0!==c){b=a.callbackNode;if((v&(da|na))!==J)throw Error(p(327));Bb(),a===X&&c===Q||$a(a,c);if(null!==w){var d=v;v|=da;var e=ki(a);do try{dk();break}catch(h){ji(a,h)}while(1);He(),v=d,cd.current=e;if(K===dd)throw b=gd,$a(a,c),cb(a,c),Y(a),b;if(null===w)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=K,X=null,d){case Ya:case dd:throw Error(p(345));case ei:qf(a,2<c?2:c);break;case ed:cb(a,c),d=a.lastSuspendedTime,c===d&&(a.nextKnownPendingLevel=kf(e));if(1073741823===wa&&(e=ff+fi-ba(),10<e)){if(id){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=c,$a(a,c);break}}f=od(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=qe(Pa.bind(null,a),e);break}Pa(a);break;case fd:cb(a,c),d=a.lastSuspendedTime,c===d&&(a.nextKnownPendingLevel=kf(e));if(id&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c,$a(a,c);break}e=od(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==jc?d=10*(1073741821-jc)-ba():1073741823===wa?d=0:(d=10*(1073741821-wa)-5000,e=ba(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3000>d?3000:4320>d?4320:1960*ak(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=qe(Pa.bind(null,a),d);break}Pa(a);break;case ef:if(1073741823!==wa&&null!==hd){f=wa;var g=hd;d=g.busyMinDurationMs|0,0>=d?d=0:(e=g.busyDelayMs|0,f=ba()-(10*(1073741821-f)-(g.timeoutMs|0||5000)),d=f<=e?0:e+d-f);if(10<d){cb(a,c),a.timeoutHandle=qe(Pa.bind(null,a),d);break}}Pa(a);break;default:throw Error(p(329))}Y(a);if(a.callbackNode===b)return gi.bind(null,a)}}return null}function jf(a){var b=a.lastExpiredTime;b=0!==b?b:1073741823;if(a.finishedExpirationTime===b)Pa(a);else{if((v&(da|na))!==J)throw Error(p(327));Bb(),a===X&&b===Q||$a(a,b);if(null!==w){var c=v;v|=da;var d=ki(a);do try{ck();break}catch(e){ji(a,e)}while(1);He(),v=c,cd.current=d;if(K===dd)throw c=gd,$a(a,b),cb(a,b),Y(a),c;if(null!==w)throw Error(p(261));a.finishedWork=a.current.alternate,a.finishedExpirationTime=b,X=null,Pa(a),Y(a)}}return null}function bk(){if(null!==Za){var a=Za;Za=null,a.forEach(function(b,c){qf(c,b),Y(c)}),ha()}}function hi(a,b){var c=v;v|=1;try{return a(b)}finally{v=c,v===J&&ha()}}function ii(a,b){var c=v;v&=-2,v|=df;try{return a(b)}finally{v=c,v===J&&ha()}}function $a(a,b){a.finishedWork=null,a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,uj(c));if(null!==w)for(c=w.return;null!==c;){var d=c;switch(d.tag){case 1:var e=d.type.childContextTypes;null!==e&&void 0!==e&&Mc(d);break;case 3:vb(d),Be(d);break;case 5:Ne(d);break;case 4:vb(d);break;case 13:G(C,d);break;case 19:G(C,d);break;case 10:Ie(d)}c=c.return}X=a,w=bb(a.current,null,b),Q=b,K=Ya,gd=null,jc=wa=1073741823,hd=null,kc=0,id=!1}function ji(a,b){do{try{He(),wh();if(null===w||null===w.return)return K=dd,gd=b,null;s:{var c=a,d=w.return,e=w,f=b;b=Q,e.effectTag|=2048,e.firstEffect=e.lastEffect=null;if(null!==f&&"object"===typeof f&&"function"===typeof f.then){var g=f,h=0!==(C.current&1),i=d;do{var k;if(k=13===i.tag){var q=i.memoizedState;if(null!==q)k=null!==q.dehydrated?!0:!1;else{var D=i.memoizedProps;k=void 0===D.fallback?!1:!0!==D.unstable_avoidThisFallback?!0:h?!1:!0}}if(k){var z=i.updateQueue;if(null===z){var I=new Set();I.add(g),i.updateQueue=I}else z.add(g);if(0===(i.mode&2)){i.effectTag|=64,e.effectTag&=-2981;if(1===e.tag)if(null===e.alternate)e.tag=17;else{var F=Ja(1073741823,null);F.tag=2,Ka(e,F)}e.expirationTime=1073741823;break s}f=void 0,e=b;var xa=c.pingCache;null===xa?(xa=c.pingCache=new $j(),f=new Set(),xa.set(g,f)):(f=xa.get(g),void 0===f&&(f=new Set(),xa.set(g,f)));if(!f.has(e)){f.add(e);var l=hk.bind(null,c,g,e);g.then(l,l)}i.effectTag|=4096,i.expirationTime=b;break s}i=i.return}while(null!==i);f=Error((za(e.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`+Ed(e))}K!==ef&&(K=ei),f=af(f,e),i=d;do{switch(i.tag){case 3:g=f,i.effectTag|=4096,i.expirationTime=b;var j=bi(i,g,b);kh(i,j);break s;case 1:g=f;var m=i.type,n=i.stateNode;if(0===(i.effectTag&64)&&("function"===typeof m.getDerivedStateFromError||null!==n&&"function"===typeof n.componentDidCatch&&(null===Na||!Na.has(n)))){i.effectTag|=4096,i.expirationTime=b;var o=ci(i,g,b);kh(i,o);break s}}i=i.return}while(null!==i)}w=ni(w)}catch(r){b=r;continue}break}while(1)}function ki(){var a=cd.current;return cd.current=$c,null===a?$c:a}function li(a,b){a<wa&&2<a&&(wa=a),null!==b&&a<jc&&2<a&&(jc=a,hd=b)}function pd(a){a>kc&&(kc=a)}function ck(){for(;null!==w;)w=mi(w)}function dk(){for(;null!==w&&!Rj();)w=mi(w)}function mi(a){var b=pi(a.alternate,a,Q);return a.memoizedProps=a.pendingProps,null===b&&(b=ni(a)),di.current=null,b}function ni(a){w=a;do{var b=w.alternate;a=w.return;if(0===(w.effectTag&2048)){s:{var c=b;b=w;var d=Q,e=b.pendingProps;switch(b.tag){case 2:break;case 16:break;case 15:case 0:break;case 1:S(b.type)&&Mc(b);break;case 3:vb(b),Be(b),e=b.stateNode,e.pendingContext&&(e.context=e.pendingContext,e.pendingContext=null),(null===c||null===c.child)&&ad(b)&&Ab(b),$e(b);break;case 5:Ne(b),d=Wa(cc.current);var f=b.type;if(null!==c&&null!=b.stateNode)Uh(c,b,f,e,d),c.ref!==b.ref&&(b.effectTag|=128);else if(e){var g=Wa(ja.current);if(ad(b)){e=b;var h=e.stateNode;c=e.type;var i=e.memoizedProps,k=d;h[Fa]=e,h[Jc]=i,f=void 0,d=h;switch(c){case"iframe":case"object":case"embed":A("load",d);break;case"video":case"audio":for(h=0;h<Hb.length;h++)A(Hb[h],d);break;case"source":A("error",d);break;case"img":case"image":case"link":A("error",d),A("load",d);break;case"form":A("reset",d),A("submit",d);break;case"details":A("toggle",d);break;case"input":Pf(d,i),A("invalid",d),qa(k,"onChange");break;case"select":d._wrapperState={wasMultiple:!!i.multiple},A("invalid",d),qa(k,"onChange");break;case"textarea":Sf(d,i),A("invalid",d),qa(k,"onChange")}he(c,i),h=null;for(f in i)i.hasOwnProperty(f)&&(g=i[f],"children"===f?"string"===typeof g?d.textContent!==g&&(h=["children",g]):"number"===typeof g&&d.textContent!==""+g&&(h=["children",""+g]):eb.hasOwnProperty(f)&&null!=g&&qa(k,f));switch(c){case"input":xc(d),Rf(d,i,!0);break;case"textarea":xc(d),Uf(d,i);break;case"select":case"option":break;default:"function"===typeof i.onClick&&(d.onclick=Ic)}f=h,e.updateQueue=f,e=null!==f?!0:!1,e&&Ab(b)}else{c=b,k=f,i=e,h=9===d.nodeType?d:d.ownerDocument,g===Sd.html&&(g=Vf(k)),g===Sd.html?"script"===k?(i=h.createElement("div"),i.innerHTML="<script></script>",h=i.removeChild(i.firstChild)):"string"===typeof i.is?h=h.createElement(k,{is:i.is}):(h=h.createElement(k),"select"===k&&(k=h,i.multiple?k.multiple=!0:i.size&&(k.size=i.size))):h=h.createElementNS(g,k),i=h,i[Fa]=c,i[Jc]=e,Th(i,b,!1,!1),b.stateNode=i,k=f,c=e;var q=d,D=ie(k,c);switch(k){case"iframe":case"object":case"embed":A("load",i),d=c;break;case"video":case"audio":for(d=0;d<Hb.length;d++)A(Hb[d],i);d=c;break;case"source":A("error",i),d=c;break;case"img":case"image":case"link":A("error",i),A("load",i),d=c;break;case"form":A("reset",i),A("submit",i),d=c;break;case"details":A("toggle",i),d=c;break;case"input":Pf(i,c),d=Nd(i,c),A("invalid",i),qa(q,"onChange");break;case"option":d=Qd(i,c);break;case"select":i._wrapperState={wasMultiple:!!c.multiple},d=O({},c,{value:void 0}),A("invalid",i),qa(q,"onChange");break;case"textarea":Sf(i,c),d=Rd(i,c),A("invalid",i),qa(q,"onChange");break;default:d=c}he(k,d),h=void 0,g=k;var z=i,I=d;for(h in I)if(I.hasOwnProperty(h)){var F=I[h];"style"===h?zg(z,F):"dangerouslySetInnerHTML"===h?(F=F?F.__html:void 0,null!=F&&Wf(z,F)):"children"===h?"string"===typeof F?("textarea"!==g||""!==F)&&Gb(z,F):"number"===typeof F&&Gb(z,""+F):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(eb.hasOwnProperty(h)?null!=F&&qa(q,h):null!=F&&Md(z,h,F,D))}switch(k){case"input":xc(i),Rf(i,c,!1);break;case"textarea":xc(i),Uf(i,c);break;case"option":null!=c.value&&i.setAttribute("value",""+Ba(c.value));break;case"select":d=i,d.multiple=!!c.multiple,i=c.value,null!=i?jb(d,!!c.multiple,i,!1):null!=c.defaultValue&&jb(d,!!c.multiple,c.defaultValue,!0);break;default:"function"===typeof d.onClick&&(i.onclick=Ic)}(e=Gg(f,e))&&Ab(b)}null!==b.ref&&(b.effectTag|=128)}else if(null===b.stateNode)throw Error(p(166));break;case 6:if(c&&null!=b.stateNode)Vh(c,b,c.memoizedProps,e);else{if("string"!==typeof e&&null===b.stateNode)throw Error(p(166));d=Wa(cc.current),Wa(ja.current),ad(b)?(e=b,f=e.stateNode,d=e.memoizedProps,f[Fa]=e,(e=f.nodeValue!==d)&&Ab(b)):(f=b,e=(9===d.nodeType?d:d.ownerDocument).createTextNode(e),e[Fa]=f,b.stateNode=e)}break;case 11:break;case 13:G(C,b),e=b.memoizedState;if(0!==(b.effectTag&64)){b.expirationTime=d;break s}e=null!==e,f=!1,null===c?void 0!==b.memoizedProps.fallback&&ad(b):(d=c.memoizedState,f=null!==d,e||null===d||(d=c.child.sibling,null!==d&&(i=b.firstEffect,null!==i?(b.firstEffect=d,d.nextEffect=i):(b.firstEffect=b.lastEffect=d,d.nextEffect=null),d.effectTag=8))),e&&!f&&0!==(b.mode&2)&&(null===c&&!0!==b.memoizedProps.unstable_avoidThisFallback||0!==(C.current&1)?K===Ya&&(K=ed):((K===Ya||K===ed)&&(K=fd),0!==kc&&null!==X&&(cb(X,Q),ri(X,kc)))),(e||f)&&(b.effectTag|=4);break;case 7:break;case 8:break;case 12:break;case 4:vb(b),$e(b);break;case 10:Ie(b);break;case 9:break;case 14:break;case 17:S(b.type)&&Mc(b);break;case 19:G(C,b),e=b.memoizedState;if(null===e)break;f=0!==(b.effectTag&64),i=e.rendering;if(null===i){if(f)bd(e,!1);else if(K!==Ya||null!==c&&0!==(c.effectTag&64))for(c=b.child;null!==c;){i=Zc(c);if(null!==i){for(b.effectTag|=64,bd(e,!1),f=i.updateQueue,null!==f&&(b.updateQueue=f,b.effectTag|=4),null===e.lastEffect&&(b.firstEffect=null),b.lastEffect=e.lastEffect,e=d,f=b.child;null!==f;)d=f,c=e,d.effectTag&=2,d.nextEffect=null,d.firstEffect=null,d.lastEffect=null,i=d.alternate,null===i?(d.childExpirationTime=0,d.expirationTime=c,d.child=null,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null):(d.childExpirationTime=i.childExpirationTime,d.expirationTime=i.expirationTime,d.child=i.child,d.memoizedProps=i.memoizedProps,d.memoizedState=i.memoizedState,d.updateQueue=i.updateQueue,c=i.dependencies,d.dependencies=null===c?null:{expirationTime:c.expirationTime,firstContext:c.firstContext,responders:c.responders}),f=f.sibling;H(C,C.current&1|2,b),b=b.child;break s}c=c.sibling}}else{if(!f)if(c=Zc(i),null!==c){if(b.effectTag|=64,f=!0,d=c.updateQueue,null!==d&&(b.updateQueue=d,b.effectTag|=4),bd(e,!0),null===e.tail&&"hidden"===e.tailMode){b=b.lastEffect=e.lastEffect,null!==b&&(b.nextEffect=null);break}}else ba()>e.tailExpiration&&1<d&&(b.effectTag|=64,f=!0,bd(e,!1),b.expirationTime=b.childExpirationTime=d-1);e.isBackwards?(i.sibling=b.child,b.child=i):(d=e.last,null!==d?d.sibling=i:b.child=i,e.last=i)}if(null!==e.tail){0===e.tailExpiration&&(e.tailExpiration=ba()+500),d=e.tail,e.rendering=d,e.tail=d.sibling,e.lastEffect=b.lastEffect,d.sibling=null,e=C.current,e=f?e&1|2:e&1,H(C,e,b),b=d;break s}break;case 20:break;case 21:break;default:throw Error(p(156,b.tag))}b=null}e=w;if(1===Q||1!==e.childExpirationTime){for(f=0,d=e.child;null!==d;)c=d.expirationTime,i=d.childExpirationTime,c>f&&(f=c),i>f&&(f=i),d=d.sibling;e.childExpirationTime=f}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=w.firstEffect),null!==w.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=w.firstEffect),a.lastEffect=w.lastEffect),1<w.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=w:a.firstEffect=w,a.lastEffect=w))}else{b=Xj(w,Q);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=2048)}b=w.sibling;if(null!==b)return b;w=a}while(null!==w);return K===Ya&&(K=ef),null}function kf(a){var b=a.expirationTime;return a=a.childExpirationTime,b>a?b:a}function Pa(a){var b=Fe();return rb(99,ek.bind(null,a,b)),null}function ek(a,b){Bb();if((v&(da|na))!==J)throw Error(p(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null,a.finishedExpirationTime=0;if(c===a.current)throw Error(p(177));a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90,a.nextKnownPendingLevel=0;var e=kf(c);a.firstPendingTime=e,d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1),d<=a.lastPingedTime&&(a.lastPingedTime=0),d<=a.lastExpiredTime&&(a.lastExpiredTime=0),a===X&&(w=X=null,Q=0),1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=v;v|=na,di.current=null,ne=Gc;var g=Dg();if(ke(g)){if("selectionStart"in g)var h={start:g.selectionStart,end:g.selectionEnd};else s:{h=(h=g.ownerDocument)&&h.defaultView||window;var i=h.getSelection&&h.getSelection();if(i&&0!==i.rangeCount){h=i.anchorNode;var k=i.anchorOffset,q=i.focusNode;i=i.focusOffset;try{h.nodeType,q.nodeType}catch(Cb){h=null;break s}var D=0,z=-1,I=-1,F=0,xa=0,l=g,j=null;$:for(;;){for(var m;;){l!==h||0!==k&&3!==l.nodeType||(z=D+k),l!==q||0!==i&&3!==l.nodeType||(I=D+i),3===l.nodeType&&(D+=l.nodeValue.length);if(null===(m=l.firstChild))break;j=l,l=m}for(;;){if(l===g)break $;j===h&&++F===k&&(z=D),j===q&&++xa===i&&(I=D);if(null!==(m=l.nextSibling))break;l=j,j=l.parentNode}l=m}h=-1===z||-1===I?null:{start:z,end:I}}else h=null}h=h||{start:0,end:0}}else h=null;oe={focusedElem:g,selectionRange:h},Gc=!1,t=e;do try{fk()}catch(Cb){if(null===t)throw Error(p(330));ab(t,Cb),t=t.nextEffect}while(null!==t);t=e;do try{for(g=a,h=b;null!==t;){var n=t.effectTag;n&16&&Gb(t.stateNode,"");if(n&128){var o=t.alternate;if(null!==o){var r=o.ref;null!==r&&("function"===typeof r?r(null):r.current=null)}}switch(n&1038){case 2:_h(t),t.effectTag&=-3;break;case 6:_h(t),t.effectTag&=-3,cf(t.alternate,t);break;case 1024:t.effectTag&=-1025;break;case 1028:t.effectTag&=-1025,cf(t.alternate,t);break;case 4:cf(t.alternate,t);break;case 8:k=t,$h(g,k,h),Yh(k)}t=t.nextEffect}}catch(Cb){if(null===t)throw Error(p(330));ab(t,Cb),t=t.nextEffect}while(null!==t);r=oe,o=Dg(),n=r.focusedElem,h=r.selectionRange;if(o!==n&&n&&n.ownerDocument&&Cg(n.ownerDocument.documentElement,n)){for(null!==h&&ke(n)&&(o=h.start,r=h.end,void 0===r&&(r=o),"selectionStart"in n?(n.selectionStart=o,n.selectionEnd=Math.min(r,n.value.length)):(r=(o=n.ownerDocument||document)&&o.defaultView||window,r.getSelection&&(r=r.getSelection(),k=n.textContent.length,g=Math.min(h.start,k),h=void 0===h.end?g:Math.min(h.end,k),!r.extend&&g>h&&(k=h,h=g,g=k),k=Bg(n,g),q=Bg(n,h),k&&q&&(1!==r.rangeCount||r.anchorNode!==k.node||r.anchorOffset!==k.offset||r.focusNode!==q.node||r.focusOffset!==q.offset)&&(o=o.createRange(),o.setStart(k.node,k.offset),r.removeAllRanges(),g>h?(r.addRange(o),r.extend(q.node,q.offset)):(o.setEnd(q.node,q.offset),r.addRange(o)))))),o=[],r=n;r=r.parentNode;)1===r.nodeType&&o.push({element:r,left:r.scrollLeft,top:r.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<o.length;n++)r=o[n],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}oe=null,Gc=!!ne,ne=null,a.current=c,t=e;do try{for(n=d;null!==t;){var u=t.effectTag;if(u&36){var y=t.alternate;o=t,r=n;switch(o.tag){case 0:case 11:case 15:ic(16,32,o);break;case 1:var B=o.stateNode;if(o.effectTag&4)if(null===y)B.componentDidMount();else{var x=o.elementType===o.type?y.memoizedProps:ca(o.type,y.memoizedProps);B.componentDidUpdate(x,y.memoizedState,B.__reactInternalSnapshotBeforeUpdate)}var fa=o.updateQueue;null!==fa&&nh(o,fa,B,r);break;case 3:var td=o.updateQueue;if(null!==td){g=null;if(null!==o.child)switch(o.child.tag){case 5:g=o.child.stateNode;break;case 1:g=o.child.stateNode}nh(o,td,g,r)}break;case 5:var pk=o.stateNode;null===y&&o.effectTag&4&&Gg(o.type,o.memoizedProps)&&pk.focus();break;case 6:break;case 4:break;case 12:break;case 13:if(null===o.memoizedState){var xi=o.alternate;if(null!==xi){var yi=xi.memoizedState;if(null!==yi){var zi=yi.dehydrated;null!==zi&&hg(zi)}}}break;case 19:case 17:case 20:case 21:break;default:throw Error(p(163))}}if(u&128){o=void 0;var ud=t.ref;if(null!==ud){var Ai=t.stateNode;switch(t.tag){case 5:o=Ai;break;default:o=Ai}"function"===typeof ud?ud(o):ud.current=o}}t=t.nextEffect}}catch(Cb){if(null===t)throw Error(p(330));ab(t,Cb),t=t.nextEffect}while(null!==t);t=null,Tj(),v=f}else a.current=c;if(kd)kd=!1,ld=a,lc=b;else for(t=e;null!==t;)b=t.nextEffect,t.nextEffect=null,t=b;b=a.firstPendingTime,0===b&&(Na=null),1073741823===b?a===hf?mc++:(mc=0,hf=a):mc=0,"function"===typeof lf&&lf(c.stateNode,d),Y(a);if(jd)throw jd=!1,a=gf,gf=null,a;return(v&df)!==J?null:(ha(),null)}function fk(){for(;null!==t;){var a=t.effectTag;0!==(a&256)&&_j(t.alternate,t),0===(a&512)||kd||(kd=!0,fh(97,function(){return Bb(),null})),t=t.nextEffect}}function Bb(){if(90!==lc){var a=97<lc?97:lc;return lc=90,rb(a,gk)}}function gk(){if(null===ld)return!1;var a=ld;ld=null;if((v&(da|na))!==J)throw Error(p(331));var b=v;for(v|=na,a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:ic(128,0,c),ic(0,64,c)}}catch(d){if(null===a)throw Error(p(330));ab(a,d)}c=a.nextEffect,a.nextEffect=null,a=c}return v=b,ha(),!0}function oi(a,b,c){b=af(c,b),b=bi(a,b,1073741823),Ka(a,b),a=nd(a,1073741823),null!==a&&Y(a)}function ab(a,b){if(3===a.tag)oi(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){oi(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===Na||!Na.has(d))){a=af(b,a),a=ci(c,a,1073741823),Ka(c,a),c=nd(c,1073741823),null!==c&&Y(c);break}}c=c.return}}function hk(a,b,c){var d=a.pingCache;null!==d&&d.delete(b),X===a&&Q===c?K===fd||K===ed&&1073741823===wa&&ba()-ff<fi?$a(a,Q):id=!0:qi(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,a.finishedExpirationTime===c&&(a.finishedExpirationTime=0,a.finishedWork=null),Y(a)))}function ik(a,b){var c=a.stateNode;null!==c&&c.delete(b),b=0,0===b&&(b=ea(),b=_a(b,a,null)),a=nd(a,b),null!==a&&Y(a)}var pi;pi=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||Z.current)ma=!0;else{if(d<c){ma=!1;switch(b.tag){case 3:Ph(b),We();break;case 5:uh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:S(b.type)&&Nc(b);break;case 4:Me(b,b.stateNode.containerInfo);break;case 10:ih(b,b.memoizedProps.value);break;case 13:if(null!==b.memoizedState)return d=b.child.childExpirationTime,0!==d&&d>=c?Qh(a,b,c):(H(C,C.current&1,b),b=va(a,b,c),null!==b?b.sibling:null);H(C,C.current&1,b);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return Sh(a,b,c);b.effectTag|=64}e=b.memoizedState,null!==e&&(e.rendering=null,e.tail=null),H(C,C.current,b);if(!d)return null}return va(a,b,c)}ma=!1}}else ma=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type,null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),a=b.pendingProps,e=qb(b,R.current),tb(b,c),e=Pe(null,b,d,a,e,c),b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1,wh();if(S(d)){var f=!0;Nc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;var g=d.getDerivedStateFromProps;"function"===typeof g&&Vc(b,d,g,a),e.updater=Wc,b.stateNode=e,e._reactInternalFiber=b,Ke(b,d,a,c),b=Ye(null,b,d,!0,f,c)}else b.tag=0,W(null,b,e,c),b=b.child;return b;case 16:e=b.elementType,null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),a=b.pendingProps,Ji(e);if(1!==e._status)throw e._result;e=e._result,b.type=e,f=b.tag=lk(e),a=ca(e,a);switch(f){case 0:b=Xe(null,b,e,a,c);break;case 1:b=Oh(null,b,e,a,c);break;case 11:b=Kh(null,b,e,a,c);break;case 14:b=Lh(null,b,e,ca(e.type,a),d,c);break;default:throw Error(p(306,e,""))}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ca(d,e),Xe(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ca(d,e),Oh(a,b,d,e,c);case 3:Ph(b),d=b.updateQueue;if(null===d)throw Error(p(282));e=b.memoizedState,e=null!==e?e.element:null,Zb(b,d,b.pendingProps,null,c),d=b.memoizedState.element;if(d===e)We(),b=va(a,b,c);else{(e=b.stateNode.hydrate)&&(Ma=mb(b.stateNode.containerInfo.firstChild),ua=b,e=Xa=!0);if(e)for(c=Le(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else W(a,b,d,c),We();b=b.child}return b;case 5:return uh(b),null===a&&Ve(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:null,g=e.children,pe(d,e)?g=null:null!==f&&pe(d,f)&&(b.effectTag|=16),Nh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(W(a,b,g,c),b=b.child),b;case 6:return null===a&&Ve(b),null;case 13:return Qh(a,b,c);case 4:return Me(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=ub(b,null,d,c):W(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ca(d,e),Kh(a,b,d,e,c);case 7:return W(a,b,b.pendingProps,c),b.child;case 8:return W(a,b,b.pendingProps.children,c),b.child;case 12:return W(a,b,b.pendingProps.children,c),b.child;case 10:s:{d=b.type._context,e=b.pendingProps,g=b.memoizedProps,f=e.value,ih(b,f);if(null!==g){var h=g.value;f=Ua(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0;if(0===f){if(g.children===e.children&&!Z.current){b=va(a,b,c);break s}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var i=h.dependencies;if(null!==i){g=h.child;for(var k=i.firstContext;null!==k;){if(k.context===d&&0!==(k.observedBits&f)){1===h.tag&&(k=Ja(c,null),k.tag=2,Ka(h,k)),h.expirationTime<c&&(h.expirationTime=c),k=h.alternate,null!==k&&k.expirationTime<c&&(k.expirationTime=c),jh(h.return,c),i.expirationTime<c&&(i.expirationTime=c);break}k=k.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return,g=h;break}g=g.return}h=g}}W(a,b,e.children,c),b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,tb(b,c),e=ia(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,W(a,b,d,c),b.child;case 14:return e=b.type,f=ca(e,b.pendingProps),f=ca(e.type,f),Lh(a,b,e,f,d,c);case 15:return Mh(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ca(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,S(d)?(a=!0,Nc(b)):a=!1,tb(b,c),rh(b,d,e,c),Ke(b,d,e,c),Ye(null,b,d,!0,a,c);case 19:return Sh(a,b,c)}throw Error(p(156,b.tag))};var lf=null,mf=null;function jk(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=b.inject(a);lf=function(d){try{b.onCommitFiberRoot(c,d,void 0,64===(d.current.effectTag&64))}catch(e){}},mf=function(d){try{b.onCommitFiberUnmount(c,d)}catch(e){}}}catch(d){}return!0}function kk(a,b,c,d){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function oa(a,b,c,d){return new kk(a,b,c,d)}function nf(a){return a=a.prototype,!(!a||!a.isReactComponent)}function lk(a){if("function"===typeof a)return nf(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===Bd)return 11;if(a===Dd)return 14}return 2}function bb(a,b){var c=a.alternate;return null===c?(c=oa(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=null,c.lastEffect=null),c.childExpirationTime=a.childExpirationTime,c.expirationTime=a.expirationTime,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,b=a.dependencies,c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c}function qd(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)nf(a)&&(g=1);else if("string"===typeof a)g=5;else s:switch(a){case ya:return Qa(c.children,e,f,b);case Ii:g=8,e|=7;break;case Af:g=8,e|=1;break;case vc:return a=oa(12,c,b,e|8),a.elementType=vc,a.type=vc,a.expirationTime=f,a;case wc:return a=oa(13,c,b,e),a.type=wc,a.elementType=wc,a.expirationTime=f,a;case Cd:return a=oa(19,c,b,e),a.elementType=Cd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Bf:g=10;break s;case Cf:g=9;break s;case Bd:g=11;break s;case Dd:g=14;break s;case Df:g=16,d=null;break s}throw Error(p(130,null==a?a:typeof a,""))}return b=oa(g,c,b,e),b.elementType=a,b.type=d,b.expirationTime=f,b}function Qa(a,b,c,d){return a=oa(7,a,d,b),a.expirationTime=c,a}function of(a,b,c){return a=oa(6,a,null,b),a.expirationTime=c,a}function pf(a,b,c){return b=oa(4,null!==a.children?a.children:[],a.key,b),b.expirationTime=c,b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},b}function mk(a,b,c){this.tag=b,this.current=null,this.containerInfo=a,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=c,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function qi(a,b){var c=a.firstSuspendedTime;return a=a.lastSuspendedTime,0!==c&&c>=b&&a<=b}function cb(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;c<b&&(a.firstSuspendedTime=b),(d>b||0===c)&&(a.lastSuspendedTime=b),b<=a.lastPingedTime&&(a.lastPingedTime=0),b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function ri(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function qf(a,b){var c=a.lastExpiredTime;(0===c||c>b)&&(a.lastExpiredTime=b)}function rd(a,b,c,d){var e=b.current,f=ea(),g=_b.suspense;f=_a(f,e,g);s:if(c){c=c._reactInternalFiber;$:{if(Sa(c)!==c||1!==c.tag)throw Error(p(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break $;case 1:if(S(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break $}}h=h.return}while(null!==h);throw Error(p(171))}if(1===c.tag){var i=c.type;if(S(i)){c=Wg(c,i,h);break s}}c=h}else c=Ha;return null===b.context?b.context=c:b.pendingContext=c,b=Ja(f,g),b.payload={element:a},d=void 0===d?null:d,null!==d&&(b.callback=d),Ka(e,b),Oa(e,f),f}function rf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function si(a,b){a=a.memoizedState,null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function sf(a,b){si(a,b),(a=a.alternate)&&si(a,b)}function nk(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}dg=function(a){if(13===a.tag){var b=Qc(ea(),150,100);Oa(a,b),sf(a,b)}},Vd=function(a){if(13===a.tag){ea();var b=Uj++;Oa(a,b),sf(a,b)}},eg=function(a){if(13===a.tag){var b=ea();b=_a(b,a,null),Oa(a,b),sf(a,b)}},Fd=function(a,b,c){switch(b){case"input":Od(a,c),b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]'),b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=te(d);if(!e)throw Error(p(90));Of(d),Od(d,e)}}}break;case"textarea":Tf(a,c);break;case"select":b=c.value,null!=b&&jb(a,!!c.multiple,b,!1)}};function tf(a,b,c){c=null!=c&&!0===c.hydrate;var d=new mk(a,b,c),e=oa(3,null,null,2===b?7:1===b?3:0);d.current=e,e.stateNode=d,a[se]=d.current,c&&0!==b&&Si(9===a.nodeType?a:a.ownerDocument),this._internalRoot=d}tf.prototype.render=function(a,b){var c=this._internalRoot;rd(a,c,null,void 0===b?null:b)},tf.prototype.unmount=function(a){var b=this._internalRoot;rd(null,b,null,void 0===a?null:a)};function nc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}Gd=hi,If=function(a,b,c,d){var e=v;v|=4;try{return rb(98,a.bind(null,b,c,d))}finally{v=e,v===J&&ha()}},Hd=function(){(v&(1|da|na))===J&&(bk(),Bb())},Jf=function(a,b){var c=v;v|=2;try{return a(b)}finally{v=c,v===J&&ha()}};function ok(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new tf(a,0,b?{hydrate:!0}:void 0)}function sd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;if("function"===typeof e){var h=e;e=function(){var k=rf(g);h.call(k)}}rd(b,g,a,e)}else{f=c._reactRootContainer=ok(c,d),g=f._internalRoot;if("function"===typeof e){var i=e;e=function(){var k=rf(g);i.call(k)}}ii(function(){rd(b,g,a,e)})}return rf(g)}function ti(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nc(b))throw Error(p(200));return nk(a,b,null,c)}var ui={createPortal:ti,findDOMNode:function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===b)throw"function"===typeof a.render?Error(p(188)):Error(p(268,Object.keys(a)));return a=cg(b),a=null===a?null:a.stateNode,a},hydrate:function(a,b,c){if(!nc(b))throw Error(p(200));return sd(null,a,b,!0,c)},render:function(a,b,c){if(!nc(b))throw Error(p(200));return sd(null,a,b,!1,c)},unstable_renderSubtreeIntoContainer:function(a,b,c,d){if(!nc(c))throw Error(p(200));if(null==a||void 0===a._reactInternalFiber)throw Error(p(38));return sd(a,b,c,!1,d)},unmountComponentAtNode:function(a){if(!nc(a))throw Error(p(40));return a._reactRootContainer?(ii(function(){sd(null,null,a,!1,function(){a._reactRootContainer=null})}),!0):!1},unstable_createPortal:function(){return ti.apply(void 0,arguments)},unstable_batchedUpdates:hi,flushSync:function(a,b){if((v&(da|na))!==J)throw Error(p(187));var c=v;v|=1;try{return rb(99,a.bind(null,b))}finally{v=c,ha()}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[Sb,Ta,te,Ad.injectEventPluginsByName,vd,lb,function(a){zd(a,Xi)},Gf,Hf,Hc,tc,Bb,{current:!1}]}};(function(a){var b=a.findFiberByHostInstance;return jk(O({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:aa.ReactCurrentDispatcher,findHostInstanceByFiber:function(c){return c=cg(c),null===c?null:c.stateNode},findFiberByHostInstance:function(c){return b?b(c):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Rb,bundleType:0,version:"16.11.0",rendererPackageName:"react-dom"});var vi={default:ui},wi=vi&&ui||vi;Bi.exports=wi.default||wi},376(e,c){"use strict";function a(){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__==="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!=="function")return;try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(d){console.error(d)}}a(),c.exports=k$(375)},21(f,c){"use strict";c.exports=function h(d,e){return function i(){for(var b=new Array(arguments.length),a=0;a<b.length;a++)b[a]=arguments[a];return d.apply(e,b)}}},31(c,b){b.exports=function e(a){return a!=null&&a.constructor!=null&&typeof a.constructor.isBuffer==="function"&&a.constructor.isBuffer(a)}},30(F,o){"use strict";var p=k$(21),q=k$(31),f=Object.prototype.toString;function k(a){return f.call(a)==="[object Array]"}function r(a){return f.call(a)==="[object ArrayBuffer]"}function s(a){return typeof FormData!=="undefined"&&a instanceof FormData}function t(a){var e;return typeof ArrayBuffer!=="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(a):e=a&&a.buffer&&a.buffer instanceof ArrayBuffer,e}function u(a){return typeof a==="string"}function v(a){return typeof a==="number"}function w(a){return typeof a==="undefined"}function l(a){return a!==null&&typeof a==="object"}function x(a){return f.call(a)==="[object Date]"}function y(a){return f.call(a)==="[object File]"}function z(a){return f.call(a)==="[object Blob]"}function m(a){return f.call(a)==="[object Function]"}function A(a){return l(a)&&m(a.pipe)}function B(a){return typeof URLSearchParams!=="undefined"&&a instanceof URLSearchParams}function C(a){return a.replace(/^\s*/,"").replace(/\s*$/,"")}function D(){return typeof navigator!=="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!=="undefined"&&typeof document!=="undefined"}function h(a,e){if(a===null||typeof a==="undefined")return;typeof a!=="object"&&(a=[a]);if(k(a))for(var c=0,g=a.length;c<g;c++)e.call(null,a[c],c,a);else for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&e.call(null,a[b],b,a)}function n(){var a={};function e(b,d){typeof a[d]==="object"&&typeof b==="object"?a[d]=n(a[d],b):a[d]=b}for(var c=0,g=arguments.length;c<g;c++)h(arguments[c],e);return a}function i(){var a={};function e(b,d){typeof a[d]==="object"&&typeof b==="object"?a[d]=i(a[d],b):typeof b==="object"?a[d]=i({},b):a[d]=b}for(var c=0,g=arguments.length;c<g;c++)h(arguments[c],e);return a}function E(a,e,c){return h(e,function g(b,d){c&&typeof b==="function"?a[d]=p(b,c):a[d]=b}),a}o.exports={isArray:k,isArrayBuffer:r,isBuffer:q,isFormData:s,isArrayBufferView:t,isString:u,isNumber:v,isObject:l,isUndefined:w,isDate:x,isFile:y,isBlob:z,isFunction:m,isStream:A,isURLSearchParams:B,isStandardBrowserEnv:D,forEach:h,merge:n,deepMerge:i,extend:E,trim:C}},22(o,n){"use strict";var c=k$(30);function h(i){return encodeURIComponent(i).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}n.exports=function i(a,e,j){if(!e)return a;var f;if(j)f=j(e);else if(c.isURLSearchParams(e))f=e.toString();else{var k=[];c.forEach(e,function p(d,g){if(d===null||typeof d==="undefined")return;c.isArray(d)?g=g+"[]":d=[d],c.forEach(d,function q(b){c.isDate(b)?b=b.toISOString():c.isObject(b)&&(b=JSON.stringify(b)),k.push(h(g)+"="+h(b))})}),f=k.join("&")}if(f){var l=a.indexOf("#");l!==-1&&(a=a.slice(0,l)),a+=(a.indexOf("?")===-1?"?":"&")+f}return a}},13(i,g){"use strict";var h=k$(30);function b(){this.handlers=[]}b.prototype.use=function c(a,d){return this.handlers.push({fulfilled:a,rejected:d}),this.handlers.length-1},b.prototype.eject=function c(a){this.handlers[a]&&(this.handlers[a]=null)},b.prototype.forEach=function c(a){h.forEach(this.handlers,function d(e){e!==null&&a(e)})},g.exports=b},19(h,c){"use strict";var d=k$(30);c.exports=function i(a,e,f){return d.forEach(f,function j(g){a=g(a,e)}),a}},11(c,b){"use strict";b.exports=function e(a){return!!(a&&a.__CANCEL__)}},27(h,e){"use strict";var f=k$(30);e.exports=function i(a,b){f.forEach(a,function j(g,c){c!==b&&c.toUpperCase()===b.toUpperCase()&&(a[b]=g,delete a[c])})}},16(g,c){"use strict";c.exports=function i(a,d,b,e,f){return a.config=d,b&&(a.code=b),a.request=e,a.response=f,a.isAxiosError=!0,a.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},a}},14(j,b){"use strict";var c=k$(16);b.exports=function k(d,e,f,g,h){var i=new Error(d);return c(i,e,f,g,h)}},18(h,d){"use strict";var e=k$(14);d.exports=function i(f,g,a){var b=a.config.validateStatus;!b||b(a.status)?f(a):g(e("Request failed with status code "+a.status,a.config,null,a.request,a))}},28(k,i){"use strict";var d=k$(30),j=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];i.exports=function l(g){var b={},a,c,e;return g?(d.forEach(g.split(`
`),function m(f){e=f.indexOf(":"),a=d.trim(f.substr(0,e)).toLowerCase(),c=d.trim(f.substr(e+1));if(a){if(b[a]&&j.indexOf(a)>=0)return;a==="set-cookie"?b[a]=(b[a]?b[a]:[]).concat([c]):b[a]=b[a]?b[a]+", "+c:c}}),b):b}},26(l,j){"use strict";var d=k$(30);j.exports=d.isStandardBrowserEnv()?function k(){var e=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a"),c;function f(g){var b=g;return e&&(a.setAttribute("href",b),b=a.href),a.setAttribute("href",b),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return c=f(window.location.href),function g(b){var h=d.isString(b)?f(b):b;return h.protocol===c.protocol&&h.host===c.host}}():function k(){return function e(){return!0}}()},24(m,j){"use strict";var d=k$(30);j.exports=d.isStandardBrowserEnv()?function k(){return{write:function b(c,e,f,g,h,l){var a=[];a.push(c+"="+encodeURIComponent(e)),d.isNumber(f)&&a.push("expires="+new Date(f).toGMTString()),d.isString(g)&&a.push("path="+g),d.isString(h)&&a.push("domain="+h),l===!0&&a.push("secure"),document.cookie=a.join("; ")},read:function b(c){var e=document.cookie.match(new RegExp("(^|;\\s*)("+c+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function b(c){this.write(c,"",Date.now()-8.64e07)}}}():function k(){return{write:function b(){},read:function b(){return null},remove:function b(){}}}()},7(w,m){"use strict";var j=k$(30),n=k$(18),o=k$(22),p=k$(28),q=k$(26),k=k$(14);m.exports=function x(b){return new Promise(function y(r,e){var f=b.data,g=b.headers;j.isFormData(f)&&delete g["Content-Type"];var a=new XMLHttpRequest();if(b.auth){var s=b.auth.username||"",t=b.auth.password||"";g.Authorization="Basic "+btoa(s+":"+t)}a.open(b.method.toUpperCase(),o(b.url,b.params,b.paramsSerializer),!0),a.timeout=b.timeout,a.onreadystatechange=function d(){if(!a||a.readyState!==4)return;if(a.status===0&&!(a.responseURL&&a.responseURL.indexOf("file:")===0))return;var h="getAllResponseHeaders"in a?p(a.getAllResponseHeaders()):null,i=!b.responseType||b.responseType==="text"?a.responseText:a.response,v={data:i,status:a.status,statusText:a.statusText,headers:h,config:b,request:a};n(r,e,v),a=null},a.onabort=function d(){if(!a)return;e(k("Request aborted",b,"ECONNABORTED",a)),a=null},a.onerror=function d(){e(k("Network Error",b,null,a)),a=null},a.ontimeout=function d(){e(k("timeout of "+b.timeout+"ms exceeded",b,"ECONNABORTED",a)),a=null};if(j.isStandardBrowserEnv()){var u=k$(24),l=(b.withCredentials||q(b.url))&&b.xsrfCookieName?u.read(b.xsrfCookieName):void 0;l&&(g[b.xsrfHeaderName]=l)}"setRequestHeader"in a&&j.forEach(g,function d(h,i){typeof f==="undefined"&&i.toLowerCase()==="content-type"?delete g[i]:a.setRequestHeader(i,h)}),b.withCredentials&&(a.withCredentials=!0);if(b.responseType)try{a.responseType=b.responseType}catch(d){if(b.responseType!=="json")throw d}typeof b.onDownloadProgress==="function"&&a.addEventListener("progress",b.onDownloadProgress),typeof b.onUploadProgress==="function"&&a.upload&&a.upload.addEventListener("progress",b.onUploadProgress),b.cancelToken&&b.cancelToken.promise.then(function d(h){if(!a)return;a.abort(),e(h),a=null}),f===void 0&&(f=null),a.send(f)})}},20(l,i){"use strict";var b=k$(30),g=k$(27),j={"Content-Type":"application/x-www-form-urlencoded"};function h(c,a){!b.isUndefined(c)&&b.isUndefined(c["Content-Type"])&&(c["Content-Type"]=a)}function k(){var c;return typeof process!=="undefined"&&Object.prototype.toString.call(process)==="[object process]"?c=k$(7):typeof XMLHttpRequest!=="undefined"&&(c=k$(7)),c}var f={adapter:k(),transformRequest:[function c(a,d){return g(d,"Accept"),g(d,"Content-Type"),b.isFormData(a)||b.isArrayBuffer(a)||b.isBuffer(a)||b.isStream(a)||b.isFile(a)||b.isBlob(a)?a:b.isArrayBufferView(a)?a.buffer:b.isURLSearchParams(a)?(h(d,"application/x-www-form-urlencoded;charset=utf-8"),a.toString()):b.isObject(a)?(h(d,"application/json;charset=utf-8"),JSON.stringify(a)):a}],transformResponse:[function c(a){if(typeof a==="string")try{a=JSON.parse(a)}catch(d){}return a}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function c(a){return a>=200&&a<300}};f.headers={common:{Accept:"application/json, text/plain, */*"}},b.forEach(["delete","get","head"],function c(a){f.headers[a]={}}),b.forEach(["post","put","patch"],function c(a){f.headers[a]=b.merge(j)}),i.exports=f},25(c,a){"use strict";a.exports=function e(b){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(b)}},23(d,c){"use strict";c.exports=function f(a,b){return b?a.replace(/\/+$/,"")+"/"+b.replace(/^\/+/,""):a}},15(o,i){"use strict";var g=k$(30),d=k$(19),j=k$(11),k=k$(20),l=k$(25),m=k$(23);function e(f){f.cancelToken&&f.cancelToken.throwIfRequested()}i.exports=function f(a){e(a),a.baseURL&&!l(a.url)&&(a.url=m(a.baseURL,a.url)),a.headers=a.headers||{},a.data=d(a.data,a.headers,a.transformRequest),a.headers=g.merge(a.headers.common||{},a.headers[a.method]||{},a.headers||{}),g.forEach(["delete","get","head","post","put","patch","common"],function h(b){delete a.headers[b]});var n=a.adapter||k.adapter;return n(a).then(function h(b){return e(a),b.data=d(b.data,b.headers,a.transformResponse),b},function h(b){return j(b)||(e(a),b&&b.response&&(b.response.data=d(b.response.data,b.response.headers,a.transformResponse))),Promise.reject(b)})}},17(i,h){"use strict";var d=k$(30);h.exports=function j(e,b){b=b||{};var c={};return d.forEach(["url","method","params","data"],function f(a){typeof b[a]!=="undefined"&&(c[a]=b[a])}),d.forEach(["headers","auth","proxy"],function f(a){d.isObject(b[a])?c[a]=d.deepMerge(e[a],b[a]):typeof b[a]!=="undefined"?c[a]=b[a]:d.isObject(e[a])?c[a]=d.deepMerge(e[a]):typeof e[a]!=="undefined"&&(c[a]=e[a])}),d.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],function f(a){typeof b[a]!=="undefined"?c[a]=b[a]:typeof e[a]!=="undefined"&&(c[a]=e[a])}),c}},12(o,l){"use strict";var h=k$(30),m=k$(22),j=k$(13),n=k$(15),k=k$(17);function e(f){this.defaults=f,this.interceptors={request:new j(),response:new j()}}e.prototype.request=function f(a){typeof a==="string"?(a=arguments[1]||{},a.url=arguments[0]):a=a||{},a=k(this.defaults,a),a.method=a.method?a.method.toLowerCase():"get";var b=[n,void 0],c=Promise.resolve(a);for(this.interceptors.request.forEach(function i(g){b.unshift(g.fulfilled,g.rejected)}),this.interceptors.response.forEach(function i(g){b.push(g.fulfilled,g.rejected)});b.length;)c=c.then(b.shift(),b.shift());return c},e.prototype.getUri=function f(a){return a=k(this.defaults,a),m(a.url,a.params,a.paramsSerializer).replace(/^\?/,"")},h.forEach(["delete","get","head","options"],function f(a){e.prototype[a]=function(b,c){return this.request(h.merge(c||{},{method:a,url:b}))}}),h.forEach(["post","put","patch"],function f(a){e.prototype[a]=function(b,c,i){return this.request(h.merge(i||{},{method:a,url:b,data:c}))}}),l.exports=e},9(d,c){"use strict";function a(b){this.message=b}a.prototype.toString=function b(){return"Cancel"+(this.message?": "+this.message:"")},a.prototype.__CANCEL__=!0,c.exports=a},10(j,h){"use strict";var i=k$(9);function d(e){if(typeof e!=="function")throw new TypeError("executor must be a function.");var a;this.promise=new Promise(function f(c){a=c});var b=this;e(function f(c){if(b.reason)return;b.reason=new i(c),a(b.reason)})}d.prototype.throwIfRequested=function e(){if(this.reason)throw this.reason},d.source=function e(){var a,b=new d(function f(c){a=c});return{token:b,cancel:a}},h.exports=d},29(d,a){"use strict";a.exports=function f(b){return function g(c){return b.apply(null,c)}}},8(m,g){"use strict";var h=k$(30),j=k$(21),d=k$(12),k=k$(17),l=k$(20);function i(e){var c=new d(e),f=j(d.prototype.request,c);return h.extend(f,d.prototype,c),h.extend(f,c),f}var a=i(l);a.Axios=d,a.create=function e(c){return i(k(a.defaults,c))},a.Cancel=k$(9),a.CancelToken=k$(10),a.isCancel=k$(11),a.all=function e(c){return Promise.all(c)},a.spread=k$(29),g.exports=a,g.exports.default=a},6(c,b){b.exports=k$(8)},374(c,a){"use strict";var b="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";a.exports=b},372(k,h){"use strict";var i=k$(374);function d(){}function e(){}e.resetWarningCache=d,h.exports=function(){function a(l,m,n,o,p,j){if(j===i)return;var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}a.isRequired=a;function b(){return a}var c={array:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:b,element:a,elementType:a,instanceOf:b,node:a,objectOf:b,oneOf:b,oneOfType:b,shape:b,exact:b,checkPropTypes:e,resetWarningCache:d};return c.PropTypes=c,c}},373(c,b){if(!1)var d,e;else b.exports=k$(372)()},388(r,n){"use strict";function h(b){return"/"===b.charAt(0)}function i(b,c){for(var d=c,e=d+1,a=b.length;e<a;d+=1,e+=1)b[d]=b[e];b.pop()}function o(b,c){void 0===c&&(c="");var d,e=b&&b.split("/")||[],a=c&&c.split("/")||[],p=b&&h(b),q=c&&h(c),l=p||q;if(b&&h(b)?a=e:e.length&&(a.pop(),a=a.concat(e)),!a.length)return"/";if(a.length){var j=a[a.length-1];d="."===j||".."===j||""===j}else d=!1;for(var g=0,f=a.length;0<=f;f--){var m=a[f];"."===m?i(a,f):".."===m?(i(a,f),g++):g&&(i(a,f),g--)}if(!l)for(;g--;g)a.unshift("..");!l||""===a[0]||a[0]&&h(a[0])||a.unshift("");var k=a.join("/");return d&&"/"!==k.substr(-1)&&(k+="/"),k}n.exports=o},389(c,b){"use strict";b.exports=k$(388)},394(j,h){"use strict";function e(a){return a.valueOf?a.valueOf():Object.prototype.valueOf.call(a)}function c(a,b){if(a===b)return!0;if(null==a||null==b)return!1;if(Array.isArray(a))return Array.isArray(b)&&a.length===b.length&&a.every(function(d,i){return c(d,b[i])});if("object"!=typeof a&&"object"!=typeof b)return!1;var f=e(a),g=e(b);return f!==a||g!==b?c(f,g):Object.keys(Object.assign({},a,b)).every(function(d){return c(a[d],b[d])})}h.exports=c},395(c,b){"use strict";b.exports=k$(394)},393(g,b){"use strict";var c=!0;function d(e,f){if(!c){if(e)return;var a="Warning: "+f;typeof console!=="undefined"&&console.warn(a);try{throw Error(a)}catch(i){}}}b.exports=d},392(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c=!0,b="Invariant failed";function d(e,f){if(e)return;throw c?new Error(b):new Error(b+": "+(f||""))}a.default=d},366(I){"use strict";function S(a){return a&&"object"==typeof a&&"default"in a?a.default:a}Object.defineProperty(I,"__esModule",{value:!0});var ga=S(k$(389)),ha=S(k$(395));k$(393);var V=S(k$(392));function O(){return(O=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var e=arguments[b];for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(a[f]=e[f])}return a}).apply(this,arguments)}function P(a){return"/"===a.charAt(0)?a:"/"+a}function W(a){return"/"===a.charAt(0)?a.substr(1):a}function ia(a,b){return 0===a.toLowerCase().indexOf(b.toLowerCase())&&-1!=="/?#".indexOf(a.charAt(b.length))}function X(a,b){return ia(a,b)?a.substr(b.length):a}function Y(a){return"/"===a.charAt(a.length-1)?a.slice(0,-1):a}function Z(a){var b=a||"/",e="",f="",c=b.indexOf("#");-1!==c&&(f=b.substr(c),b=b.substr(0,c));var k=b.indexOf("?");return-1!==k&&(e=b.substr(k),b=b.substr(0,k)),{pathname:b,search:"?"===e?"":e,hash:"#"===f?"":f}}function z(a){var b=a.pathname,e=a.search,f=a.hash,c=b||"/";return e&&"?"!==e&&(c+="?"===e.charAt(0)?e:"?"+e),f&&"#"!==f&&(c+="#"===f.charAt(0)?f:"#"+f),c}function E(a,b,e,f){var c;"string"==typeof a?(c=Z(a)).state=b:(void 0===(c=O({},a)).pathname&&(c.pathname=""),c.search?"?"!==c.search.charAt(0)&&(c.search="?"+c.search):c.search="",c.hash?"#"!==c.hash.charAt(0)&&(c.hash="#"+c.hash):c.hash="",void 0!==b&&void 0===c.state&&(c.state=b));try{c.pathname=decodeURI(c.pathname)}catch(k){throw k instanceof URIError?new URIError('Pathname "'+c.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):k}return e&&(c.key=e),f?c.pathname?"/"!==c.pathname.charAt(0)&&(c.pathname=ga(c.pathname,f.pathname)):c.pathname=f.pathname:c.pathname||(c.pathname="/"),c}function ja(a,b){return a.pathname===b.pathname&&a.search===b.search&&a.hash===b.hash&&a.key===b.key&&ha(a.state,b.state)}function T(){var a=null,b=[];return{setPrompt:function(e){return a=e,function(){a===e&&(a=null)}},confirmTransitionTo:function(e,f,c,k){if(null!=a){var F="function"==typeof a?a(e,f):a;"string"==typeof F?"function"==typeof c?c(F,k):k(!0):k(!1!==F)}else k(!0)},appendListener:function(e){var f=!0;function c(){f&&e.apply(void 0,arguments)}return b.push(c),function(){f=!1,b=b.filter(function(k){return k!==c})}},notifyListeners:function(){for(var e=arguments.length,f=new Array(e),c=0;c<e;c++)f[c]=arguments[c];b.forEach(function(k){return k.apply(void 0,f)})}}}var _=!("undefined"==typeof window||!window.document||!window.document.createElement);function $(a,b){b(window.confirm(a))}function ka(){var a=window.navigator.userAgent;return(-1===a.indexOf("Android 2.")&&-1===a.indexOf("Android 4.0")||-1===a.indexOf("Mobile Safari")||-1!==a.indexOf("Chrome")||-1!==a.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}function la(){return-1===window.navigator.userAgent.indexOf("Trident")}function ma(){return-1===window.navigator.userAgent.indexOf("Firefox")}function na(a){return void 0===a.state&&-1===navigator.userAgent.indexOf("CriOS")}var aa="popstate",ba="hashchange";function ca(){try{return window.history.state||{}}catch(a){return{}}}function oa(a){void 0===a&&(a={}),_||V(!1);var b=window.history,e=ka(),f=!la(),c=a,k=c.forceRefresh,F=void 0!==k&&k,C=c.getUserConfirmation,J=void 0===C?$:C,v=c.keyLength,K=void 0===v?6:v,D=a.basename?Y(P(a.basename)):"";function w(d){var o=d||{},h=o.key,j=o.state,p=window.location,n=p.pathname+p.search+p.hash;return D&&(n=X(n,D)),E(n,j,h)}function A(){return Math.random().toString(36).substr(2,K)}var x=T();function y(d){O(m,d),m.length=b.length,x.notifyListeners(m.location,m.action)}function l(d){na(d)||t(w(d.state))}function i(){t(w(ca()))}var s=!1;function t(d){s?(s=!1,y()):x.confirmTransitionTo(d,"POP",J,function(o){o?y({action:"POP",location:d}):function(h){var j=m.location,p=q.indexOf(j.key);-1===p&&(p=0);var n=q.indexOf(h.key);-1===n&&(n=0);var G=p-n;G&&(s=!0,H(G))}(d)})}var r=w(ca()),q=[r.key];function B(d){return D+z(d)}function H(d){b.go(d)}var M=0;function u(d){1===(M+=d)&&1===d?(window.addEventListener(aa,l),f&&window.addEventListener(ba,i)):0===M&&(window.removeEventListener(aa,l),f&&window.removeEventListener(ba,i))}var g=!1,m={length:b.length,action:"POP",location:r,createHref:B,push:function(d,o){var h=E(d,o,A(),m.location);x.confirmTransitionTo(h,"PUSH",J,function(j){if(j){var p=B(h),n=h.key,G=h.state;if(e)if(b.pushState({key:n,state:G},null,p),F)window.location.href=p;else{var N=q.indexOf(m.location.key),L=q.slice(0,N+1);L.push(h.key),q=L,y({action:"PUSH",location:h})}else window.location.href=p}})},replace:function(d,o){var h="REPLACE",j=E(d,o,A(),m.location);x.confirmTransitionTo(j,h,J,function(p){if(p){var n=B(j),G=j.key,N=j.state;if(e)if(b.replaceState({key:G,state:N},null,n),F)window.location.replace(n);else{var L=q.indexOf(m.location.key);-1!==L&&(q[L]=j.key),y({action:h,location:j})}else window.location.replace(n)}})},go:H,goBack:function(){H(-1)},goForward:function(){H(1)},block:function(d){void 0===d&&(d=!1);var o=x.setPrompt(d);return g||(u(1),g=!0),function(){return g&&(g=!1,u(-1)),o()}},listen:function(d){var o=x.appendListener(d);return u(1),function(){u(-1),o()}}};return m}var da="hashchange",pa={hashbang:{encodePath:function(a){return"!"===a.charAt(0)?a:"!/"+W(a)},decodePath:function(a){return"!"===a.charAt(0)?a.substr(1):a}},noslash:{encodePath:W,decodePath:P},slash:{encodePath:P,decodePath:P}};function ea(a){var b=a.indexOf("#");return-1===b?a:a.slice(0,b)}function Q(){var a=window.location.href,b=a.indexOf("#");return-1===b?"":a.substring(b+1)}function qa(a){window.location.hash=a}function U(a){window.location.replace(ea(window.location.href)+"#"+a)}function ra(a){void 0===a&&(a={}),_||V(!1);var b=window.history,e=(ma(),a),f=e.getUserConfirmation,c=void 0===f?$:f,k=e.hashType,F=void 0===k?"slash":k,C=a.basename?Y(P(a.basename)):"",J=pa[F],v=J.encodePath,K=J.decodePath;function D(){var g=K(Q());return C&&(g=X(g,C)),E(g)}var w=T();function A(g){O(u,g),u.length=b.length,w.notifyListeners(u.location,u.action)}var x=!1,y=null;function l(){var g=Q(),m=v(g);if(g!==m)U(m);else{var d=D(),o=u.location;if(!x&&function(h,j){return h.pathname===j.pathname&&h.search===j.search&&h.hash===j.hash}(o,d))return;if(y===z(d))return;y=null,function(h){x?(x=!1,A()):w.confirmTransitionTo(h,"POP",c,function(j){j?A({action:"POP",location:h}):function(p){var n=u.location,G=r.lastIndexOf(z(n));-1===G&&(G=0);var N=r.lastIndexOf(z(p));-1===N&&(N=0);var L=G-N;L&&(x=!0,q(L))}(h)})}(d)}}var i=Q(),s=v(i);i!==s&&U(s);var t=D(),r=[z(t)];function q(g){b.go(g)}var B=0;function H(g){1===(B+=g)&&1===g?window.addEventListener(da,l):0===B&&window.removeEventListener(da,l)}var M=!1,u={length:b.length,action:"POP",location:t,createHref:function(g){var m=document.querySelector("base"),d="";return m&&m.getAttribute("href")&&(d=ea(window.location.href)),d+"#"+v(C+z(g))},push:function(g,m){var d=E(g,void 0,void 0,u.location);w.confirmTransitionTo(d,"PUSH",c,function(o){if(o){var h=z(d),j=v(C+h);if(Q()!==j){y=h,qa(j);var p=r.lastIndexOf(z(u.location)),n=r.slice(0,p+1);n.push(h),r=n,A({action:"PUSH",location:d})}else A()}})},replace:function(g,m){var d="REPLACE",o=E(g,void 0,void 0,u.location);w.confirmTransitionTo(o,d,c,function(h){if(h){var j=z(o),p=v(C+j);Q()!==p&&(y=j,U(p));var n=r.indexOf(z(u.location));-1!==n&&(r[n]=j),A({action:d,location:o})}})},go:q,goBack:function(){q(-1)},goForward:function(){q(1)},block:function(g){void 0===g&&(g=!1);var m=w.setPrompt(g);return M||(H(1),M=!0),function(){return M&&(M=!1,H(-1)),m()}},listen:function(g){var m=w.appendListener(g);return H(1),function(){H(-1),m()}}};return u}function fa(a,b,e){return Math.min(Math.max(a,b),e)}function sa(a){void 0===a&&(a={});var b=a,e=b.getUserConfirmation,f=b.initialEntries,c=void 0===f?["/"]:f,k=b.initialIndex,F=void 0===k?0:k,C=b.keyLength,J=void 0===C?6:C,v=T();function K(i){O(l,i),l.length=l.entries.length,v.notifyListeners(l.location,l.action)}function D(){return Math.random().toString(36).substr(2,J)}var w=fa(F,0,c.length-1),A=c.map(function(i){return E(i,void 0,"string"==typeof i?D():i.key||D())}),x=z;function y(i){var s=fa(l.index+i,0,l.entries.length-1),t=l.entries[s];v.confirmTransitionTo(t,"POP",e,function(r){r?K({action:"POP",location:t,index:s}):K()})}var l={length:A.length,action:"POP",location:A[w],index:w,entries:A,createHref:x,push:function(i,s){var t=E(i,s,D(),l.location);v.confirmTransitionTo(t,"PUSH",e,function(r){if(r){var q=l.index+1,B=l.entries.slice(0);B.length>q?B.splice(q,B.length-q,t):B.push(t),K({action:"PUSH",location:t,index:q,entries:B})}})},replace:function(i,s){var t="REPLACE",r=E(i,s,D(),l.location);v.confirmTransitionTo(r,t,e,function(q){q&&(l.entries[l.index]=r,K({action:t,location:r}))})},go:y,goBack:function(){y(-1)},goForward:function(){y(1)},canGo:function(i){var s=l.index+i;return 0<=s&&s<l.entries.length},block:function(i){return void 0===i&&(i=!1),v.setPrompt(i)},listen:function(i){return v.appendListener(i)}};return l}I.createBrowserHistory=oa,I.createHashHistory=ra,I.createMemoryHistory=sa,I.createLocation=E,I.locationsAreEqual=ja,I.parsePath=Z,I.createPath=z},367(c,b){"use strict";b.exports=k$(366)},370(e,c){function d(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}c.exports=d},365(c,b){"use strict";var a="__global_unique_id__";b.exports=function(){return global[a]=(global[a]||0)+1}},369(D,v){"use strict";function l(a){return a&&typeof a==="object"&&"default"in a?a.default:a}var q=k$(386),w=l(q),s=l(k$(370)),t=l(k$(373)),x=l(k$(365)),E=l(k$(393)),r=1073741823;function y(a,e){return a===e?a!==0||1/a===1/e:a!==a&&e!==e}function z(a){var e=[];return{on:function i(f){e.push(f)},off:function i(f){e=e.filter(function(d){return d!==f})},get:function i(){return a},set:function i(f,d){a=f,e.forEach(function(o){return o(a,d)})}}}function A(a){return Array.isArray(a)?a[0]:a}function B(a,e){var i,f,d="__create-react-context-"+x()+"__",o=function(m){s(j,m);function j(){var b;return b=m.apply(this,arguments)||this,b.emitter=z(b.props.value),b}var g=j.prototype;return g.getChildContext=function b(){var c;return c={},c[d]=this.emitter,c},g.componentWillReceiveProps=function b(c){if(this.props.value!==c.value){var h=this.props.value,p=c.value,n;y(h,p)?n=0:(n=typeof e==="function"?e(h,p):r,n|=0,n!==0&&this.emitter.set(c.value,n))}},g.render=function b(){return this.props.children},j}(q.Component);o.childContextTypes=(i={},i[d]=t.object.isRequired,i);var u=function(m){s(j,m);function j(){var b;return b=m.apply(this,arguments)||this,b.state={value:b.getValue()},b.onUpdate=function(c,h){var p=b.observedBits|0;(p&h)!==0&&b.setState({value:b.getValue()})},b}var g=j.prototype;return g.componentWillReceiveProps=function b(c){var h=c.observedBits;this.observedBits=h===void 0||h===null?r:h},g.componentDidMount=function b(){this.context[d]&&this.context[d].on(this.onUpdate);var c=this.props.observedBits;this.observedBits=c===void 0||c===null?r:c},g.componentWillUnmount=function b(){this.context[d]&&this.context[d].off(this.onUpdate)},g.getValue=function b(){return this.context[d]?this.context[d].get():a},g.render=function b(){return A(this.props.children)(this.state.value)},j}(q.Component);return u.contextTypes=(f={},f[d]=t.object,f),{Provider:o,Consumer:u}}var C=w.createContext||B;v.exports=C},383(c,a){a.exports=Array.isArray||function(b){return Object.prototype.toString.call(b)=="[object Array]"}},384(P,p){var q=k$(383);p.exports=y,p.exports.parse=t,p.exports.compile=E,p.exports.tokensToFunction=w,p.exports.tokensToRegExp=x;var D=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function t(a,b){for(var c=[],g=0,j=0,e="",l=b&&b.delimiter||"/",f;(f=D.exec(a))!=null;){var n=f[0],h=f[1],i=f.index;e+=a.slice(j,i),j=i+n.length;if(h){e+=h[1];continue}var d=a[j],k=f[2],m=f[3],o=f[4],L=f[5],s=f[6],z=f[7];e&&(c.push(e),e="");var M=k!=null&&d!=null&&d!==k,N=s==="+"||s==="*",O=s==="?"||s==="*",A=f[2]||l,B=o||L;c.push({name:m||g++,prefix:k||"",delimiter:A,optional:O,repeat:N,partial:M,asterisk:!!z,pattern:B?H(B):z?".*":"[^"+r(A)+"]+?"})}return j<a.length&&(e+=a.substr(j)),e&&c.push(e),c}function E(a,b){return w(t(a,b),b)}function F(a){return encodeURI(a).replace(/[\/?#]/g,function(b){return"%"+b.charCodeAt(0).toString(16).toUpperCase()})}function G(a){return encodeURI(a).replace(/[?#]/g,function(b){return"%"+b.charCodeAt(0).toString(16).toUpperCase()})}function w(a,b){for(var c=new Array(a.length),g=0;g<a.length;g++)typeof a[g]==="object"&&(c[g]=new RegExp("^(?:"+a[g].pattern+")$",v(b)));return function(j,e){for(var l="",f=j||{},n=e||{},h=n.pretty?F:encodeURIComponent,i=0;i<a.length;i++){var d=a[i];if(typeof d==="string"){l+=d;continue}var k=f[d.name],m;if(k==null)if(d.optional){d.partial&&(l+=d.prefix);continue}else throw new TypeError('Expected "'+d.name+'" to be defined');if(q(k)){if(!d.repeat)throw new TypeError('Expected "'+d.name+'" to not repeat, but received `'+JSON.stringify(k)+"`");if(k.length===0){if(d.optional)continue;throw new TypeError('Expected "'+d.name+'" to not be empty')}for(var o=0;o<k.length;o++){m=h(k[o]);if(!c[i].test(m))throw new TypeError('Expected all "'+d.name+'" to match "'+d.pattern+'", but received `'+JSON.stringify(m)+"`");l+=(o===0?d.prefix:d.delimiter)+m}continue}m=d.asterisk?G(k):h(k);if(!c[i].test(m))throw new TypeError('Expected "'+d.name+'" to match "'+d.pattern+'", but received "'+m+'"');l+=d.prefix+m}return l}}function r(a){return a.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function H(a){return a.replace(/([=!:$\/()])/g,"\\$1")}function u(a,b){return a.keys=b,a}function v(a){return a&&a.sensitive?"":"i"}function I(a,b){var c=a.source.match(/\((?!\?)/g);if(c)for(var g=0;g<c.length;g++)b.push({name:g,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return u(a,b)}function J(a,b,c){for(var g=[],j=0;j<a.length;j++)g.push(y(a[j],b,c).source);var e=new RegExp("(?:"+g.join("|")+")",v(c));return u(e,b)}function K(a,b,c){return x(t(a,c),b,c)}function x(a,b,c){q(b)||(c=b||c,b=[]),c=c||{};for(var g=c.strict,j=c.end!==!1,e="",l=0;l<a.length;l++){var f=a[l];if(typeof f==="string")e+=r(f);else{var n=r(f.prefix),h="(?:"+f.pattern+")";b.push(f),f.repeat&&(h+="(?:"+n+h+")*"),f.optional?f.partial?h=n+"("+h+")?":h="(?:"+n+"("+h+"))?":h=n+"("+h+")",e+=h}}var i=r(c.delimiter||"/"),d=e.slice(-i.length)===i;return g||(e=(d?e.slice(0,-i.length):e)+"(?:"+i+"(?=$))?"),j?e+="$":e+=g&&d?"":"(?="+i+"|$)",u(new RegExp("^"+e,v(c)),b)}function y(a,b,c){return q(b)||(c=b||c,b=[]),c=c||{},a instanceof RegExp?I(a,b):q(a)?J(a,b,c):K(a,b,c)}},377(b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c="function"===typeof Symbol&&Symbol.for,o=c?Symbol.for("react.element"):60103,p=c?Symbol.for("react.portal"):60106,e=c?Symbol.for("react.fragment"):60107,f=c?Symbol.for("react.strict_mode"):60108,g=c?Symbol.for("react.profiler"):60114,h=c?Symbol.for("react.provider"):60109,i=c?Symbol.for("react.context"):60110,q=c?Symbol.for("react.async_mode"):60111,j=c?Symbol.for("react.concurrent_mode"):60111,k=c?Symbol.for("react.forward_ref"):60112,l=c?Symbol.for("react.suspense"):60113,t=c?Symbol.for("react.suspense_list"):60120,m=c?Symbol.for("react.memo"):60115,n=c?Symbol.for("react.lazy"):60116,u=c?Symbol.for("react.fundamental"):60117,v=c?Symbol.for("react.responder"):60118,w=c?Symbol.for("react.scope"):60119;function d(a){if("object"===typeof a&&null!==a){var r=a.$$typeof;switch(r){case o:switch(a=a.type,a){case q:case j:case e:case g:case f:case l:return a;default:switch(a=a&&a.$$typeof,a){case i:case k:case h:return a;default:return r}}case n:case m:case p:return r}}}function s(a){return d(a)===j}b.typeOf=d,b.AsyncMode=q,b.ConcurrentMode=j,b.ContextConsumer=i,b.ContextProvider=h,b.Element=o,b.ForwardRef=k,b.Fragment=e,b.Lazy=n,b.Memo=m,b.Portal=p,b.Profiler=g,b.StrictMode=f,b.Suspense=l,b.isValidElementType=function(a){return"string"===typeof a||"function"===typeof a||a===e||a===j||a===g||a===f||a===l||a===t||"object"===typeof a&&null!==a&&(a.$$typeof===n||a.$$typeof===m||a.$$typeof===h||a.$$typeof===i||a.$$typeof===k||a.$$typeof===u||a.$$typeof===v||a.$$typeof===w)},b.isAsyncMode=function(a){return s(a)||d(a)===q},b.isConcurrentMode=s,b.isContextConsumer=function(a){return d(a)===i},b.isContextProvider=function(a){return d(a)===h},b.isElement=function(a){return"object"===typeof a&&null!==a&&a.$$typeof===o},b.isForwardRef=function(a){return d(a)===k},b.isFragment=function(a){return d(a)===e},b.isLazy=function(a){return d(a)===n},b.isMemo=function(a){return d(a)===m},b.isPortal=function(a){return d(a)===p},b.isProfiler=function(a){return d(a)===g},b.isStrictMode=function(a){return d(a)===f},b.isSuspense=function(a){return d(a)===l}},378(c,b){"use strict";b.exports=k$(377)},368(A,r){"use strict";var e=k$(378),s={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},t={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},u={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},j={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},f={};f[e.ForwardRef]=u,f[e.Memo]=j;function k(a){return e.isMemo(a)?j:f[a.$$typeof]||s}var v=Object.defineProperty,w=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,x=Object.getOwnPropertyDescriptor,y=Object.getPrototypeOf,m=Object.prototype;function n(a,b,g){if(typeof b!=="string"){if(m){var h=y(b);h&&h!==m&&n(a,h,g)}var d=w(b);l&&(d=d.concat(l(b)));for(var o=k(a),p=k(b),i=0;i<d.length;++i){var c=d[i];if(!t[c]&&!(g&&g[c])&&!(p&&p[c])&&!(o&&o[c])){var z=x(b,c);try{v(a,c,z)}catch(B){}}}}return a}r.exports=n},381(k){"use strict";function u(a){return a&&"object"==typeof a&&"default"in a?a.default:a}Object.defineProperty(k,"__esModule",{value:!0});var i=u(k$(386));k$(373);var q=k$(367);k$(393);var Q=u(k$(369)),s=u(k$(392)),F=u(k$(384));k$(378);var R=u(k$(368));function o(){return(o=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var d=arguments[b];for(var c in d)Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}return a}).apply(this,arguments)}function t(a,b){a.prototype=Object.create(b.prototype),(a.prototype.constructor=a).__proto__=b}function G(a,b){if(null==a)return{};var d,c,f={},e=Object.keys(a);for(c=0;c<e.length;c++)d=e[c],0<=b.indexOf(d)||(f[d]=a[d]);return f}var S=function(a){var b=Q();return b.displayName=a,b},m=S("Router"),y=function(a){function b(c){var f;return(f=a.call(this,c)||this).state={location:c.history.location},f._isMounted=!1,f._pendingLocation=null,c.staticContext||(f.unlisten=c.history.listen(function(e){f._isMounted?f.setState({location:e}):f._pendingLocation=e})),f}t(b,a),b.computeRootMatch=function(c){return{path:"/",url:"/",params:{},isExact:"/"===c}};var d=b.prototype;return d.componentDidMount=function(){this._isMounted=!0,this._pendingLocation&&this.setState({location:this._pendingLocation})},d.componentWillUnmount=function(){this.unlisten&&this.unlisten()},d.render=function(){return i.createElement(m.Provider,{children:this.props.children||null,value:{history:this.props.history,location:this.state.location,match:b.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}})},b}(i.Component),T=function(a){function b(){for(var d,c=arguments.length,f=new Array(c),e=0;e<c;e++)f[e]=arguments[e];return(d=a.call.apply(a,[this].concat(f))||this).history=q.createMemoryHistory(d.props),d}return t(b,a),b.prototype.render=function(){return i.createElement(y,{history:this.history,children:this.props.children})},b}(i.Component),H=function(a){function b(){return a.apply(this,arguments)||this}t(b,a);var d=b.prototype;return d.componentDidMount=function(){this.props.onMount&&this.props.onMount.call(this,this)},d.componentDidUpdate=function(c){this.props.onUpdate&&this.props.onUpdate.call(this,this,c)},d.componentWillUnmount=function(){this.props.onUnmount&&this.props.onUnmount.call(this,this)},d.render=function(){return null},b}(i.Component);function U(a){var b=a.message,d=a.when,c=void 0===d||d;return i.createElement(m.Consumer,null,function(f){if(f||s(!1),!c||f.staticContext)return null;var e=f.history.block;return i.createElement(H,{onMount:function(g){g.release=e(b)},onUpdate:function(g,h){h.message!==b&&(g.release(),g.release=e(b))},onUnmount:function(g){g.release()},message:b})})}var z={},V=10000,I=0;function W(a){if(z[a])return z[a];var b=F.compile(a);return I<V&&(z[a]=b,I++),b}function A(a,b){return void 0===a&&(a="/"),void 0===b&&(b={}),"/"===a?a:W(a)(b,{pretty:!0})}function X(a){var b=a.computedMatch,d=a.to,c=a.push,f=void 0!==c&&c;return i.createElement(m.Consumer,null,function(e){e||s(!1);var g=e.history,h=e.staticContext,j=f?g.push:g.replace,l=q.createLocation(b?"string"==typeof d?A(d,b.params):o({},d,{pathname:A(d.pathname,b.params)}):d);return h?(j(l),null):i.createElement(H,{onMount:function(){j(l)},onUpdate:function(v,p){var r=q.createLocation(p.to);q.locationsAreEqual(r,o({},l,{key:r.key}))||j(l)},to:d})})}var J={},Y=10000,K=0;function Z(a,b){var d=""+b.end+b.strict+b.sensitive,c=J[d]||(J[d]={});if(c[a])return c[a];var f=[],e={regexp:F(a,f,b),keys:f};return K<Y&&(c[a]=e,K++),e}function w(a,b){void 0===b&&(b={}),"string"!=typeof b&&!Array.isArray(b)||(b={path:b});var d=b,c=d.path,f=d.exact,e=void 0!==f&&f,g=d.strict,h=void 0!==g&&g,j=d.sensitive,l=void 0!==j&&j;return[].concat(c).reduce(function(v,p){if(!p&&""!==p)return null;if(v)return v;var r=Z(p,{end:e,strict:h,sensitive:l}),ha=r.regexp,ia=r.keys,D=ha.exec(a);if(!D)return null;var E=D[0],ja=D.slice(1),O=a===E;return e&&!O?null:{path:p,url:"/"===p&&""===E?"/":E,isExact:O,params:ia.reduce(function(P,ka,la){return P[ka.name]=ja[la],P},{})}},null)}var _=function(a){function b(){return a.apply(this,arguments)||this}return t(b,a),b.prototype.render=function(){var d=this;return i.createElement(m.Consumer,null,function(c){c||s(!1);var f=d.props.location||c.location,e=o({},c,{location:f,match:d.props.computedMatch?d.props.computedMatch:d.props.path?w(f.pathname,d.props):c.match}),g=d.props,h=g.children,j=g.component,l=g.render;return Array.isArray(h)&&0===h.length&&(h=null),i.createElement(m.Provider,{value:e},e.match?h?"function"==typeof h?h(e):h:j?i.createElement(j,e):l?l(e):null:"function"==typeof h?h(e):null)})},b}(i.Component);function B(a){return"/"===a.charAt(0)?a:"/"+a}function $(a,b){return a?o({},b,{pathname:B(a)+b.pathname}):b}function aa(a,b){if(!a)return b;var d=B(a);return 0!==b.pathname.indexOf(d)?b:o({},b,{pathname:b.pathname.substr(d.length)})}function L(a){return"string"==typeof a?a:q.createPath(a)}function C(a){return function(){s(!1)}}function M(){}var ba=function(a){function b(){for(var c,f=arguments.length,e=new Array(f),g=0;g<f;g++)e[g]=arguments[g];return(c=a.call.apply(a,[this].concat(e))||this).handlePush=function(h){return c.navigateTo(h,"PUSH")},c.handleReplace=function(h){return c.navigateTo(h,"REPLACE")},c.handleListen=function(){return M},c.handleBlock=function(){return M},c}t(b,a);var d=b.prototype;return d.navigateTo=function(c,f){var e=this.props,g=e.basename,h=void 0===g?"":g,j=e.context,l=void 0===j?{}:j;l.action=f,l.location=$(h,q.createLocation(c)),l.url=L(l.location)},d.render=function(){var c=this.props,f=c.basename,e=void 0===f?"":f,g=c.context,h=void 0===g?{}:g,j=c.location,l=void 0===j?"/":j,v=G(c,["basename","context","location"]),p={createHref:function(r){return B(e+L(r))},action:"POP",location:aa(e,q.createLocation(l)),push:this.handlePush,replace:this.handleReplace,go:C(),goBack:C(),goForward:C(),listen:this.handleListen,block:this.handleBlock};return i.createElement(y,o({},v,{history:p,staticContext:h}))},b}(i.Component),ca=function(a){function b(){return a.apply(this,arguments)||this}return t(b,a),b.prototype.render=function(){var d=this;return i.createElement(m.Consumer,null,function(c){c||s(!1);var f,e,g=d.props.location||c.location;return i.Children.forEach(d.props.children,function(h){if(null==e&&i.isValidElement(h)){var j=(f=h).props.path||h.props.from;e=j?w(g.pathname,o({},h.props,{path:j})):c.match}}),e?i.cloneElement(f,{location:g,computedMatch:e}):null})},b}(i.Component);function da(a){function b(c){var f=c.wrappedComponentRef,e=G(c,["wrappedComponentRef"]);return i.createElement(m.Consumer,null,function(g){return g||s(!1),i.createElement(a,o({},e,g,{ref:f}))})}var d="withRouter("+(a.displayName||a.name)+")";return b.displayName=d,b.WrappedComponent=a,R(b,a)}var x=i.useContext;function ea(){return x(m).history}function N(){return x(m).location}function fa(){var a=x(m).match;return a?a.params:{}}function ga(a){return a?w(N().pathname,a):x(m).match}k.MemoryRouter=T,k.Prompt=U,k.Redirect=X,k.Route=_,k.Router=y,k.StaticRouter=ba,k.Switch=ca,k.__RouterContext=m,k.generatePath=A,k.matchPath=w,k.useHistory=ea,k.useLocation=N,k.useParams=fa,k.useRouteMatch=ga,k.withRouter=da},382(c,b){"use strict";b.exports=k$(381)},379(m){"use strict";function C(a){return a&&"object"==typeof a&&"default"in a?a.default:a}Object.defineProperty(m,"__esModule",{value:!0});var j=k$(382),h=C(k$(386)),u=k$(367);k$(373),k$(393);var D=C(k$(392));function q(){return(q=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}).apply(this,arguments)}function E(a,b){a.prototype=Object.create(b.prototype),(a.prototype.constructor=a).__proto__=b}function v(a,b){if(null==a)return{};var c,d,f={},e=Object.keys(a);for(d=0;d<e.length;d++)c=e[d],0<=b.indexOf(c)||(f[c]=a[c]);return f}var O=function(a){function b(){for(var c,d=arguments.length,f=new Array(d),e=0;e<d;e++)f[e]=arguments[e];return(c=a.call.apply(a,[this].concat(f))||this).history=u.createBrowserHistory(c.props),c}return E(b,a),b.prototype.render=function(){return h.createElement(j.Router,{history:this.history,children:this.props.children})},b}(h.Component),P=function(a){function b(){for(var c,d=arguments.length,f=new Array(d),e=0;e<d;e++)f[e]=arguments[e];return(c=a.call.apply(a,[this].concat(f))||this).history=u.createHashHistory(c.props),c}return E(b,a),b.prototype.render=function(){return h.createElement(j.Router,{history:this.history,children:this.props.children})},b}(h.Component),w=function(a,b){return"function"==typeof a?a(b):a},F=function(a,b){return"string"==typeof a?u.createLocation(a,null,null,b):a},x=function(a){return a},o=h.forwardRef;function Q(a){return!!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)}void 0===o&&(o=x);var R=o(function(a,b){var c=a.innerRef,d=a.navigate,f=a.onClick,e=v(a,["innerRef","navigate","onClick"]),k=e.target,l=q({},e,{onClick:function(g){try{f&&f(g)}catch(i){throw g.preventDefault(),i}g.defaultPrevented||0!==g.button||k&&"_self"!==k||Q(g)||(g.preventDefault(),d())}});return l.ref=x!==o&&b||c,h.createElement("a",l)}),G=o(function(a,b){var c=a.component,d=void 0===c?R:c,f=a.replace,e=a.to,k=a.innerRef,l=v(a,["component","replace","to","innerRef"]);return h.createElement(j.__RouterContext.Consumer,null,function(g){g||D(!1);var i=g.history,s=F(w(e,g.location),g.location),y=s?i.createHref(s):"",p=q({},l,{href:y,navigate:function(){var z=w(e,g.location);(f?i.replace:i.push)(z)}});return x!==o?p.ref=b||k:p.innerRef=k,h.createElement(d,p)})}),H=function(a){return a},r=h.forwardRef;function S(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return b.filter(function(d){return d}).join(" ")}void 0===r&&(r=H);var T=r(function(a,b){var c=a["aria-current"],d=void 0===c?"page":c,f=a.activeClassName,e=void 0===f?"active":f,k=a.activeStyle,l=a.className,g=a.exact,i=a.isActive,s=a.location,y=a.strict,p=a.style,z=a.to,I=a.innerRef,U=v(a,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","strict","style","to","innerRef"]);return h.createElement(j.__RouterContext.Consumer,null,function(J){J||D(!1);var t=s||J.location,K=F(w(z,t),t),L=K.pathname,M=L&&L.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),N=M?j.matchPath(t.pathname,{path:M,exact:g,strict:y}):null,A=!!(i?i(N,t):N),V=A?S(l,e):l,W=A?q({},p,{},k):p,B=q({"aria-current":A&&d||null,className:V,style:W,to:K},U);return H!==r?B.ref=b||I:B.innerRef=I,h.createElement(G,B)})});Object.keys(j).forEach(function(a){"default"!==a&&Object.defineProperty(m,a,{enumerable:!0,get:function(){return j[a]}})}),m.BrowserRouter=O,m.HashRouter=P,m.Link=G,m.NavLink=T},380(c,b){"use strict";b.exports=k$(379)},35(ud,bg){!function(Aa,x){"object"==typeof ud&&"object"==typeof bg?bg.exports=x():"function"==typeof define&&define.amd?define("babylonjs",[],x):"object"==typeof ud?ud.babylonjs=x():Aa.BABYLON=x()}("undefined"!=typeof self?self:"undefined"!=typeof global?global:ud,function(){return function(Aa){var x={};function l(O){if(x[O])return x[O].exports;var q=x[O]={i:O,l:!1,exports:{}};return Aa[O].call(q.exports,q,q.exports,l),q.l=!0,q.exports}return l.m=Aa,l.c=x,l.d=function(O,q,j){l.o(O,q)||Object.defineProperty(O,q,{enumerable:!0,get:j})},l.r=function(O){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})},l.t=function(O,q){if(1&q&&(O=l(O)),8&q)return O;if(4&q&&"object"==typeof O&&O&&O.__esModule)return O;var j=Object.create(null);if(l.r(j),Object.defineProperty(j,"default",{enumerable:!0,value:O}),2&q&&"string"!=typeof O)for(var I in O)l.d(j,I,function(H){return O[H]}.bind(null,I));return j},l.n=function(O){var q=O&&O.__esModule?function(){return O.default}:function(){return O};return l.d(q,"a",q),q},l.o=function(O,q){return Object.prototype.hasOwnProperty.call(O,q)},l.p="",l(l.s=129)}([function(Aa,x,l){"use strict";l.d(x,"u",function(){return I}),l.d(x,"v",function(){return H}),l.d(x,"h",function(){return A}),l.d(x,"e",function(){return v}),l.d(x,"f",function(){return z}),l.d(x,"w",function(){return u}),l.d(x,"x",function(){return w}),l.d(x,"y",function(){return y}),l.d(x,"r",function(){return r}),l.d(x,"q",function(){return o}),l.d(x,"j",function(){return G}),l.d(x,"n",function(){return M}),l.d(x,"z",function(){return R}),l.d(x,"i",function(){return W}),l.d(x,"s",function(){return O}),l.d(x,"c",function(){return X}),l.d(x,"d",function(){return ea}),l.d(x,"k",function(){return Y}),l.d(x,"a",function(){return ca}),l.d(x,"b",function(){return oa}),l.d(x,"l",function(){return Z}),l.d(x,"m",function(){return T}),l.d(x,"g",function(){return V}),l.d(x,"p",function(){return D}),l.d(x,"o",function(){return F}),l.d(x,"t",function(){return L});var O,q=l(34),j=l(12),I=1/2.2,H=2.2,A=.001,v=function(){function p(g,n,s){void 0===g&&(g=0),void 0===n&&(n=0),void 0===s&&(s=0),this.r=g,this.g=n,this.b=s}return p.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},p.prototype.getClassName=function(){return"Color3"},p.prototype.getHashCode=function(){var g=this.r||0;return g=397*(g=397*g^(this.g||0))^(this.b||0)},p.prototype.toArray=function(g,n){return void 0===n&&(n=0),g[n]=this.r,g[n+1]=this.g,g[n+2]=this.b,this},p.prototype.toColor4=function(g){return void 0===g&&(g=1),new z(this.r,this.g,this.b,g)},p.prototype.asArray=function(){var g=new Array();return this.toArray(g,0),g},p.prototype.toLuminance=function(){return .3*this.r+.59*this.g+.11*this.b},p.prototype.multiply=function(g){return new p(this.r*g.r,this.g*g.g,this.b*g.b)},p.prototype.multiplyToRef=function(g,n){return n.r=this.r*g.r,n.g=this.g*g.g,n.b=this.b*g.b,this},p.prototype.equals=function(g){return g&&this.r===g.r&&this.g===g.g&&this.b===g.b},p.prototype.equalsFloats=function(g,n,s){return this.r===g&&this.g===n&&this.b===s},p.prototype.scale=function(g){return new p(this.r*g,this.g*g,this.b*g)},p.prototype.scaleToRef=function(g,n){return n.r=this.r*g,n.g=this.g*g,n.b=this.b*g,this},p.prototype.scaleAndAddToRef=function(g,n){return n.r+=this.r*g,n.g+=this.g*g,n.b+=this.b*g,this},p.prototype.clampToRef=function(g,n,s){return void 0===g&&(g=0),void 0===n&&(n=1),s.r=j.a.Clamp(this.r,g,n),s.g=j.a.Clamp(this.g,g,n),s.b=j.a.Clamp(this.b,g,n),this},p.prototype.add=function(g){return new p(this.r+g.r,this.g+g.g,this.b+g.b)},p.prototype.addToRef=function(g,n){return n.r=this.r+g.r,n.g=this.g+g.g,n.b=this.b+g.b,this},p.prototype.subtract=function(g){return new p(this.r-g.r,this.g-g.g,this.b-g.b)},p.prototype.subtractToRef=function(g,n){return n.r=this.r-g.r,n.g=this.g-g.g,n.b=this.b-g.b,this},p.prototype.clone=function(){return new p(this.r,this.g,this.b)},p.prototype.copyFrom=function(g){return this.r=g.r,this.g=g.g,this.b=g.b,this},p.prototype.copyFromFloats=function(g,n,s){return this.r=g,this.g=n,this.b=s,this},p.prototype.set=function(g,n,s){return this.copyFromFloats(g,n,s)},p.prototype.toHexString=function(){var g=255*this.r|0,n=255*this.g|0,s=255*this.b|0;return"#"+j.a.ToHex(g)+j.a.ToHex(n)+j.a.ToHex(s)},p.prototype.toLinearSpace=function(){var g=new p();return this.toLinearSpaceToRef(g),g},p.prototype.toLinearSpaceToRef=function(g){return g.r=Math.pow(this.r,H),g.g=Math.pow(this.g,H),g.b=Math.pow(this.b,H),this},p.prototype.toGammaSpace=function(){var g=new p();return this.toGammaSpaceToRef(g),g},p.prototype.toGammaSpaceToRef=function(g){return g.r=Math.pow(this.r,I),g.g=Math.pow(this.g,I),g.b=Math.pow(this.b,I),this},p.FromHexString=function(g){if("#"!==g.substring(0,1)||7!==g.length)return new p(0,0,0);var n=parseInt(g.substring(1,3),16),s=parseInt(g.substring(3,5),16),t=parseInt(g.substring(5,7),16);return p.FromInts(n,s,t)},p.FromArray=function(g,n){return void 0===n&&(n=0),new p(g[n],g[n+1],g[n+2])},p.FromInts=function(g,n,s){return new p(g/255,n/255,s/255)},p.Lerp=function(g,n,s){var t=new p(0,0,0);return p.LerpToRef(g,n,s,t),t},p.LerpToRef=function(g,n,s,t){t.r=g.r+(n.r-g.r)*s,t.g=g.g+(n.g-g.g)*s,t.b=g.b+(n.b-g.b)*s},p.Red=function(){return new p(1,0,0)},p.Green=function(){return new p(0,1,0)},p.Blue=function(){return new p(0,0,1)},p.Black=function(){return new p(0,0,0)},Object.defineProperty(p,"BlackReadOnly",{get:function(){return p._BlackReadOnly},enumerable:!0,configurable:!0}),p.White=function(){return new p(1,1,1)},p.Purple=function(){return new p(.5,0,.5)},p.Magenta=function(){return new p(1,0,1)},p.Yellow=function(){return new p(1,1,0)},p.Gray=function(){return new p(.5,.5,.5)},p.Teal=function(){return new p(0,1,1)},p.Random=function(){return new p(Math.random(),Math.random(),Math.random())},p._BlackReadOnly=p.Black(),p}(),z=function(){function p(g,n,s,t){void 0===g&&(g=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===t&&(t=1),this.r=g,this.g=n,this.b=s,this.a=t}return p.prototype.addInPlace=function(g){return this.r+=g.r,this.g+=g.g,this.b+=g.b,this.a+=g.a,this},p.prototype.asArray=function(){var g=new Array();return this.toArray(g,0),g},p.prototype.toArray=function(g,n){return void 0===n&&(n=0),g[n]=this.r,g[n+1]=this.g,g[n+2]=this.b,g[n+3]=this.a,this},p.prototype.equals=function(g){return g&&this.r===g.r&&this.g===g.g&&this.b===g.b&&this.a===g.a},p.prototype.add=function(g){return new p(this.r+g.r,this.g+g.g,this.b+g.b,this.a+g.a)},p.prototype.subtract=function(g){return new p(this.r-g.r,this.g-g.g,this.b-g.b,this.a-g.a)},p.prototype.subtractToRef=function(g,n){return n.r=this.r-g.r,n.g=this.g-g.g,n.b=this.b-g.b,n.a=this.a-g.a,this},p.prototype.scale=function(g){return new p(this.r*g,this.g*g,this.b*g,this.a*g)},p.prototype.scaleToRef=function(g,n){return n.r=this.r*g,n.g=this.g*g,n.b=this.b*g,n.a=this.a*g,this},p.prototype.scaleAndAddToRef=function(g,n){return n.r+=this.r*g,n.g+=this.g*g,n.b+=this.b*g,n.a+=this.a*g,this},p.prototype.clampToRef=function(g,n,s){return void 0===g&&(g=0),void 0===n&&(n=1),s.r=j.a.Clamp(this.r,g,n),s.g=j.a.Clamp(this.g,g,n),s.b=j.a.Clamp(this.b,g,n),s.a=j.a.Clamp(this.a,g,n),this},p.prototype.multiply=function(g){return new p(this.r*g.r,this.g*g.g,this.b*g.b,this.a*g.a)},p.prototype.multiplyToRef=function(g,n){return n.r=this.r*g.r,n.g=this.g*g.g,n.b=this.b*g.b,n.a=this.a*g.a,n},p.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},p.prototype.getClassName=function(){return"Color4"},p.prototype.getHashCode=function(){var g=this.r||0;return g=397*(g=397*(g=397*g^(this.g||0))^(this.b||0))^(this.a||0)},p.prototype.clone=function(){return new p(this.r,this.g,this.b,this.a)},p.prototype.copyFrom=function(g){return this.r=g.r,this.g=g.g,this.b=g.b,this.a=g.a,this},p.prototype.copyFromFloats=function(g,n,s,t){return this.r=g,this.g=n,this.b=s,this.a=t,this},p.prototype.set=function(g,n,s,t){return this.copyFromFloats(g,n,s,t)},p.prototype.toHexString=function(){var g=255*this.r|0,n=255*this.g|0,s=255*this.b|0,t=255*this.a|0;return"#"+j.a.ToHex(g)+j.a.ToHex(n)+j.a.ToHex(s)+j.a.ToHex(t)},p.prototype.toLinearSpace=function(){var g=new p();return this.toLinearSpaceToRef(g),g},p.prototype.toLinearSpaceToRef=function(g){return g.r=Math.pow(this.r,H),g.g=Math.pow(this.g,H),g.b=Math.pow(this.b,H),g.a=this.a,this},p.prototype.toGammaSpace=function(){var g=new p();return this.toGammaSpaceToRef(g),g},p.prototype.toGammaSpaceToRef=function(g){return g.r=Math.pow(this.r,I),g.g=Math.pow(this.g,I),g.b=Math.pow(this.b,I),g.a=this.a,this},p.FromHexString=function(g){if("#"!==g.substring(0,1)||9!==g.length)return new p(0,0,0,0);var n=parseInt(g.substring(1,3),16),s=parseInt(g.substring(3,5),16),t=parseInt(g.substring(5,7),16),C=parseInt(g.substring(7,9),16);return p.FromInts(n,s,t,C)},p.Lerp=function(g,n,s){var t=new p(0,0,0,0);return p.LerpToRef(g,n,s,t),t},p.LerpToRef=function(g,n,s,t){t.r=g.r+(n.r-g.r)*s,t.g=g.g+(n.g-g.g)*s,t.b=g.b+(n.b-g.b)*s,t.a=g.a+(n.a-g.a)*s},p.FromColor3=function(g,n){return void 0===n&&(n=1),new p(g.r,g.g,g.b,n)},p.FromArray=function(g,n){return void 0===n&&(n=0),new p(g[n],g[n+1],g[n+2],g[n+3])},p.FromInts=function(g,n,s,t){return new p(g/255,n/255,s/255,t/255)},p.CheckColors4=function(g,n){if(g.length===3*n){for(var s=[],t=0;t<g.length;t+=3){var C=t/3*4;s[C]=g[t],s[C+1]=g[t+1],s[C+2]=g[t+2],s[C+3]=1}return s}return g},p}(),u=function(){function p(g,n){void 0===g&&(g=0),void 0===n&&(n=0),this.x=g,this.y=n}return p.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},p.prototype.getClassName=function(){return"Vector2"},p.prototype.getHashCode=function(){var g=this.x||0;return g=397*g^(this.y||0)},p.prototype.toArray=function(g,n){return void 0===n&&(n=0),g[n]=this.x,g[n+1]=this.y,this},p.prototype.asArray=function(){var g=new Array();return this.toArray(g,0),g},p.prototype.copyFrom=function(g){return this.x=g.x,this.y=g.y,this},p.prototype.copyFromFloats=function(g,n){return this.x=g,this.y=n,this},p.prototype.set=function(g,n){return this.copyFromFloats(g,n)},p.prototype.add=function(g){return new p(this.x+g.x,this.y+g.y)},p.prototype.addToRef=function(g,n){return n.x=this.x+g.x,n.y=this.y+g.y,this},p.prototype.addInPlace=function(g){return this.x+=g.x,this.y+=g.y,this},p.prototype.addVector3=function(g){return new p(this.x+g.x,this.y+g.y)},p.prototype.subtract=function(g){return new p(this.x-g.x,this.y-g.y)},p.prototype.subtractToRef=function(g,n){return n.x=this.x-g.x,n.y=this.y-g.y,this},p.prototype.subtractInPlace=function(g){return this.x-=g.x,this.y-=g.y,this},p.prototype.multiplyInPlace=function(g){return this.x*=g.x,this.y*=g.y,this},p.prototype.multiply=function(g){return new p(this.x*g.x,this.y*g.y)},p.prototype.multiplyToRef=function(g,n){return n.x=this.x*g.x,n.y=this.y*g.y,this},p.prototype.multiplyByFloats=function(g,n){return new p(this.x*g,this.y*n)},p.prototype.divide=function(g){return new p(this.x/g.x,this.y/g.y)},p.prototype.divideToRef=function(g,n){return n.x=this.x/g.x,n.y=this.y/g.y,this},p.prototype.divideInPlace=function(g){return this.divideToRef(g,this)},p.prototype.negate=function(){return new p(-this.x,-this.y)},p.prototype.scaleInPlace=function(g){return this.x*=g,this.y*=g,this},p.prototype.scale=function(g){var n=new p(0,0);return this.scaleToRef(g,n),n},p.prototype.scaleToRef=function(g,n){return n.x=this.x*g,n.y=this.y*g,this},p.prototype.scaleAndAddToRef=function(g,n){return n.x+=this.x*g,n.y+=this.y*g,this},p.prototype.equals=function(g){return g&&this.x===g.x&&this.y===g.y},p.prototype.equalsWithEpsilon=function(g,n){return void 0===n&&(n=A),g&&j.a.WithinEpsilon(this.x,g.x,n)&&j.a.WithinEpsilon(this.y,g.y,n)},p.prototype.floor=function(){return new p(Math.floor(this.x),Math.floor(this.y))},p.prototype.fract=function(){return new p(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},p.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},p.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},p.prototype.normalize=function(){var g=this.length();if(0===g)return this;var n=1/g;return this.x*=n,this.y*=n,this},p.prototype.clone=function(){return new p(this.x,this.y)},p.Zero=function(){return new p(0,0)},p.One=function(){return new p(1,1)},p.FromArray=function(g,n){return void 0===n&&(n=0),new p(g[n],g[n+1])},p.FromArrayToRef=function(g,n,s){s.x=g[n],s.y=g[n+1]},p.CatmullRom=function(g,n,s,t,C){var J=C*C,Q=C*J;return new p(.5*(2*n.x+(-g.x+s.x)*C+(2*g.x-5*n.x+4*s.x-t.x)*J+(-g.x+3*n.x-3*s.x+t.x)*Q),.5*(2*n.y+(-g.y+s.y)*C+(2*g.y-5*n.y+4*s.y-t.y)*J+(-g.y+3*n.y-3*s.y+t.y)*Q))},p.Clamp=function(g,n,s){var t=g.x;t=(t=t>s.x?s.x:t)<n.x?n.x:t;var C=g.y;return new p(t,C=(C=C>s.y?s.y:C)<n.y?n.y:C)},p.Hermite=function(g,n,s,t,C){var J=C*C,Q=C*J,$=2*Q-3*J+1,aa=-2*Q+3*J,ba=Q-2*J+C,ia=Q-J;return new p(g.x*$+s.x*aa+n.x*ba+t.x*ia,g.y*$+s.y*aa+n.y*ba+t.y*ia)},p.Lerp=function(g,n,s){return new p(g.x+(n.x-g.x)*s,g.y+(n.y-g.y)*s)},p.Dot=function(g,n){return g.x*n.x+g.y*n.y},p.Normalize=function(g){var n=g.clone();return n.normalize(),n},p.Minimize=function(g,n){return new p(g.x<n.x?g.x:n.x,g.y<n.y?g.y:n.y)},p.Maximize=function(g,n){return new p(g.x>n.x?g.x:n.x,g.y>n.y?g.y:n.y)},p.Transform=function(g,n){var s=p.Zero();return p.TransformToRef(g,n,s),s},p.TransformToRef=function(g,n,s){var t=n.m,C=g.x*t[0]+g.y*t[4]+t[12],J=g.x*t[1]+g.y*t[5]+t[13];s.x=C,s.y=J},p.PointInTriangle=function(g,n,s,t){var C=.5*(-s.y*t.x+n.y*(-s.x+t.x)+n.x*(s.y-t.y)+s.x*t.y),J=C<0?-1:1,Q=(n.y*t.x-n.x*t.y+(t.y-n.y)*g.x+(n.x-t.x)*g.y)*J,$=(n.x*s.y-n.y*s.x+(n.y-s.y)*g.x+(s.x-n.x)*g.y)*J;return Q>0&&$>0&&Q+$<2*C*J},p.Distance=function(g,n){return Math.sqrt(p.DistanceSquared(g,n))},p.DistanceSquared=function(g,n){var s=g.x-n.x,t=g.y-n.y;return s*s+t*t},p.Center=function(g,n){var s=g.add(n);return s.scaleInPlace(.5),s},p.DistanceOfPointFromSegment=function(g,n,s){var t=p.DistanceSquared(n,s);if(0===t)return p.Distance(g,n);var C=s.subtract(n),J=Math.max(0,Math.min(1,p.Dot(g.subtract(n),C)/t)),Q=n.add(C.multiplyByFloats(J,J));return p.Distance(g,Q)},p}(),w=function(){function p(g,n,s){void 0===g&&(g=0),void 0===n&&(n=0),void 0===s&&(s=0),this.x=g,this.y=n,this.z=s}return p.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},p.prototype.getClassName=function(){return"Vector3"},p.prototype.getHashCode=function(){var g=this.x||0;return g=397*(g=397*g^(this.y||0))^(this.z||0)},p.prototype.asArray=function(){var g=[];return this.toArray(g,0),g},p.prototype.toArray=function(g,n){return void 0===n&&(n=0),g[n]=this.x,g[n+1]=this.y,g[n+2]=this.z,this},p.prototype.toQuaternion=function(){return o.RotationYawPitchRoll(this.y,this.x,this.z)},p.prototype.addInPlace=function(g){return this.addInPlaceFromFloats(g.x,g.y,g.z)},p.prototype.addInPlaceFromFloats=function(g,n,s){return this.x+=g,this.y+=n,this.z+=s,this},p.prototype.add=function(g){return new p(this.x+g.x,this.y+g.y,this.z+g.z)},p.prototype.addToRef=function(g,n){return n.copyFromFloats(this.x+g.x,this.y+g.y,this.z+g.z)},p.prototype.subtractInPlace=function(g){return this.x-=g.x,this.y-=g.y,this.z-=g.z,this},p.prototype.subtract=function(g){return new p(this.x-g.x,this.y-g.y,this.z-g.z)},p.prototype.subtractToRef=function(g,n){return this.subtractFromFloatsToRef(g.x,g.y,g.z,n)},p.prototype.subtractFromFloats=function(g,n,s){return new p(this.x-g,this.y-n,this.z-s)},p.prototype.subtractFromFloatsToRef=function(g,n,s,t){return t.copyFromFloats(this.x-g,this.y-n,this.z-s)},p.prototype.negate=function(){return new p(-this.x,-this.y,-this.z)},p.prototype.scaleInPlace=function(g){return this.x*=g,this.y*=g,this.z*=g,this},p.prototype.scale=function(g){return new p(this.x*g,this.y*g,this.z*g)},p.prototype.scaleToRef=function(g,n){return n.copyFromFloats(this.x*g,this.y*g,this.z*g)},p.prototype.scaleAndAddToRef=function(g,n){return n.addInPlaceFromFloats(this.x*g,this.y*g,this.z*g)},p.prototype.equals=function(g){return g&&this.x===g.x&&this.y===g.y&&this.z===g.z},p.prototype.equalsWithEpsilon=function(g,n){return void 0===n&&(n=A),g&&j.a.WithinEpsilon(this.x,g.x,n)&&j.a.WithinEpsilon(this.y,g.y,n)&&j.a.WithinEpsilon(this.z,g.z,n)},p.prototype.equalsToFloats=function(g,n,s){return this.x===g&&this.y===n&&this.z===s},p.prototype.multiplyInPlace=function(g){return this.x*=g.x,this.y*=g.y,this.z*=g.z,this},p.prototype.multiply=function(g){return this.multiplyByFloats(g.x,g.y,g.z)},p.prototype.multiplyToRef=function(g,n){return n.copyFromFloats(this.x*g.x,this.y*g.y,this.z*g.z)},p.prototype.multiplyByFloats=function(g,n,s){return new p(this.x*g,this.y*n,this.z*s)},p.prototype.divide=function(g){return new p(this.x/g.x,this.y/g.y,this.z/g.z)},p.prototype.divideToRef=function(g,n){return n.copyFromFloats(this.x/g.x,this.y/g.y,this.z/g.z)},p.prototype.divideInPlace=function(g){return this.divideToRef(g,this)},p.prototype.minimizeInPlace=function(g){return this.minimizeInPlaceFromFloats(g.x,g.y,g.z)},p.prototype.maximizeInPlace=function(g){return this.maximizeInPlaceFromFloats(g.x,g.y,g.z)},p.prototype.minimizeInPlaceFromFloats=function(g,n,s){return g<this.x&&(this.x=g),n<this.y&&(this.y=n),s<this.z&&(this.z=s),this},p.prototype.maximizeInPlaceFromFloats=function(g,n,s){return g>this.x&&(this.x=g),n>this.y&&(this.y=n),s>this.z&&(this.z=s),this},p.prototype.isNonUniformWithinEpsilon=function(g){var n=Math.abs(this.x),s=Math.abs(this.y);if(!j.a.WithinEpsilon(n,s,g))return!0;var t=Math.abs(this.z);return!j.a.WithinEpsilon(n,t,g)||!j.a.WithinEpsilon(s,t,g)},Object.defineProperty(p.prototype,"isNonUniform",{get:function(){var g=Math.abs(this.x),n=Math.abs(this.y);if(g!==n)return!0;var s=Math.abs(this.z);return g!==s||n!==s},enumerable:!0,configurable:!0}),p.prototype.floor=function(){return new p(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},p.prototype.fract=function(){return new p(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},p.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},p.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},p.prototype.normalize=function(){return this.normalizeFromLength(this.length())},p.prototype.reorderInPlace=function(g){var n=this;return"xyz"===(g=g.toLowerCase())?this:(N.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(s,t){n[s]=N.Vector3[0][g[t]]}),this)},p.prototype.rotateByQuaternionToRef=function(g,n){return g.toRotationMatrix(N.Matrix[0]),p.TransformCoordinatesToRef(this,N.Matrix[0],n),n},p.prototype.rotateByQuaternionAroundPointToRef=function(g,n,s){return this.subtractToRef(n,N.Vector3[0]),N.Vector3[0].rotateByQuaternionToRef(g,N.Vector3[0]),n.addToRef(N.Vector3[0],s),s},p.prototype.normalizeFromLength=function(g){return 0===g||1===g?this:this.scaleInPlace(1/g)},p.prototype.normalizeToNew=function(){var g=new p(0,0,0);return this.normalizeToRef(g),g},p.prototype.normalizeToRef=function(g){var n=this.length();return 0===n||1===n?g.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/n,g)},p.prototype.clone=function(){return new p(this.x,this.y,this.z)},p.prototype.copyFrom=function(g){return this.copyFromFloats(g.x,g.y,g.z)},p.prototype.copyFromFloats=function(g,n,s){return this.x=g,this.y=n,this.z=s,this},p.prototype.set=function(g,n,s){return this.copyFromFloats(g,n,s)},p.prototype.setAll=function(g){return this.x=this.y=this.z=g,this},p.GetClipFactor=function(g,n,s,t){var C=p.Dot(g,s)-t;return C/(C-(p.Dot(n,s)-t))},p.GetAngleBetweenVectors=function(g,n,s){var t=g.normalizeToRef(N.Vector3[1]),C=n.normalizeToRef(N.Vector3[2]),J=p.Dot(t,C),Q=N.Vector3[3];return p.CrossToRef(t,C,Q),p.Dot(Q,s)>0?Math.acos(J):-Math.acos(J)},p.FromArray=function(g,n){return void 0===n&&(n=0),new p(g[n],g[n+1],g[n+2])},p.FromFloatArray=function(g,n){return p.FromArray(g,n)},p.FromArrayToRef=function(g,n,s){s.x=g[n],s.y=g[n+1],s.z=g[n+2]},p.FromFloatArrayToRef=function(g,n,s){return p.FromArrayToRef(g,n,s)},p.FromFloatsToRef=function(g,n,s,t){t.copyFromFloats(g,n,s)},p.Zero=function(){return new p(0,0,0)},p.One=function(){return new p(1,1,1)},p.Up=function(){return new p(0,1,0)},Object.defineProperty(p,"UpReadOnly",{get:function(){return p._UpReadOnly},enumerable:!0,configurable:!0}),p.Down=function(){return new p(0,-1,0)},p.Forward=function(){return new p(0,0,1)},p.Backward=function(){return new p(0,0,-1)},p.Right=function(){return new p(1,0,0)},p.Left=function(){return new p(-1,0,0)},p.TransformCoordinates=function(g,n){var s=p.Zero();return p.TransformCoordinatesToRef(g,n,s),s},p.TransformCoordinatesToRef=function(g,n,s){p.TransformCoordinatesFromFloatsToRef(g.x,g.y,g.z,n,s)},p.TransformCoordinatesFromFloatsToRef=function(g,n,s,t,C){var J=t.m,Q=g*J[0]+n*J[4]+s*J[8]+J[12],$=g*J[1]+n*J[5]+s*J[9]+J[13],aa=g*J[2]+n*J[6]+s*J[10]+J[14],ba=1/(g*J[3]+n*J[7]+s*J[11]+J[15]);C.x=Q*ba,C.y=$*ba,C.z=aa*ba},p.TransformNormal=function(g,n){var s=p.Zero();return p.TransformNormalToRef(g,n,s),s},p.TransformNormalToRef=function(g,n,s){this.TransformNormalFromFloatsToRef(g.x,g.y,g.z,n,s)},p.TransformNormalFromFloatsToRef=function(g,n,s,t,C){var J=t.m;C.x=g*J[0]+n*J[4]+s*J[8],C.y=g*J[1]+n*J[5]+s*J[9],C.z=g*J[2]+n*J[6]+s*J[10]},p.CatmullRom=function(g,n,s,t,C){var J=C*C,Q=C*J;return new p(.5*(2*n.x+(-g.x+s.x)*C+(2*g.x-5*n.x+4*s.x-t.x)*J+(-g.x+3*n.x-3*s.x+t.x)*Q),.5*(2*n.y+(-g.y+s.y)*C+(2*g.y-5*n.y+4*s.y-t.y)*J+(-g.y+3*n.y-3*s.y+t.y)*Q),.5*(2*n.z+(-g.z+s.z)*C+(2*g.z-5*n.z+4*s.z-t.z)*J+(-g.z+3*n.z-3*s.z+t.z)*Q))},p.Clamp=function(g,n,s){var t=new p();return p.ClampToRef(g,n,s,t),t},p.ClampToRef=function(g,n,s,t){var C=g.x;C=(C=C>s.x?s.x:C)<n.x?n.x:C;var J=g.y;J=(J=J>s.y?s.y:J)<n.y?n.y:J;var Q=g.z;Q=(Q=Q>s.z?s.z:Q)<n.z?n.z:Q,t.copyFromFloats(C,J,Q)},p.Hermite=function(g,n,s,t,C){var J=C*C,Q=C*J,$=2*Q-3*J+1,aa=-2*Q+3*J,ba=Q-2*J+C,ia=Q-J;return new p(g.x*$+s.x*aa+n.x*ba+t.x*ia,g.y*$+s.y*aa+n.y*ba+t.y*ia,g.z*$+s.z*aa+n.z*ba+t.z*ia)},p.Lerp=function(g,n,s){var t=new p(0,0,0);return p.LerpToRef(g,n,s,t),t},p.LerpToRef=function(g,n,s,t){t.x=g.x+(n.x-g.x)*s,t.y=g.y+(n.y-g.y)*s,t.z=g.z+(n.z-g.z)*s},p.Dot=function(g,n){return g.x*n.x+g.y*n.y+g.z*n.z},p.Cross=function(g,n){var s=p.Zero();return p.CrossToRef(g,n,s),s},p.CrossToRef=function(g,n,s){var t=g.y*n.z-g.z*n.y,C=g.z*n.x-g.x*n.z,J=g.x*n.y-g.y*n.x;s.copyFromFloats(t,C,J)},p.Normalize=function(g){var n=p.Zero();return p.NormalizeToRef(g,n),n},p.NormalizeToRef=function(g,n){g.normalizeToRef(n)},p.Project=function(g,n,s,t){var C=t.width,J=t.height,Q=t.x,$=t.y,aa=N.Matrix[1];G.FromValuesToRef(C/2,0,0,0,0,-J/2,0,0,0,0,.5,0,Q+C/2,J/2+$,.5,1,aa);var ba=N.Matrix[0];return n.multiplyToRef(s,ba),ba.multiplyToRef(aa,ba),p.TransformCoordinates(g,ba)},p._UnprojectFromInvertedMatrixToRef=function(g,n,s){p.TransformCoordinatesToRef(g,n,s);var t=n.m,C=g.x*t[3]+g.y*t[7]+g.z*t[11]+t[15];j.a.WithinEpsilon(C,1)&&s.scaleInPlace(1/C)},p.UnprojectFromTransform=function(g,n,s,t,C){var J=N.Matrix[0];t.multiplyToRef(C,J),J.invert(),g.x=g.x/n*2-1,g.y=-(g.y/s*2-1);var Q=new p();return p._UnprojectFromInvertedMatrixToRef(g,J,Q),Q},p.Unproject=function(g,n,s,t,C,J){var Q=p.Zero();return p.UnprojectToRef(g,n,s,t,C,J,Q),Q},p.UnprojectToRef=function(g,n,s,t,C,J,Q){p.UnprojectFloatsToRef(g.x,g.y,g.z,n,s,t,C,J,Q)},p.UnprojectFloatsToRef=function(g,n,s,t,C,J,Q,$,aa){var ba=N.Matrix[0];J.multiplyToRef(Q,ba),ba.multiplyToRef($,ba),ba.invert();var ia=N.Vector3[0];ia.x=g/t*2-1,ia.y=-(n/C*2-1),ia.z=2*s-1,p._UnprojectFromInvertedMatrixToRef(ia,ba,aa)},p.Minimize=function(g,n){var s=g.clone();return s.minimizeInPlace(n),s},p.Maximize=function(g,n){var s=g.clone();return s.maximizeInPlace(n),s},p.Distance=function(g,n){return Math.sqrt(p.DistanceSquared(g,n))},p.DistanceSquared=function(g,n){var s=g.x-n.x,t=g.y-n.y,C=g.z-n.z;return s*s+t*t+C*C},p.Center=function(g,n){var s=g.add(n);return s.scaleInPlace(.5),s},p.RotationFromAxis=function(g,n,s){var t=p.Zero();return p.RotationFromAxisToRef(g,n,s,t),t},p.RotationFromAxisToRef=function(g,n,s,t){var C=N.Quaternion[0];o.RotationQuaternionFromAxisToRef(g,n,s,C),C.toEulerAnglesToRef(t)},p._UpReadOnly=p.Up(),p}(),y=function(){function p(g,n,s,t){this.x=g,this.y=n,this.z=s,this.w=t}return p.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},p.prototype.getClassName=function(){return"Vector4"},p.prototype.getHashCode=function(){var g=this.x||0;return g=397*(g=397*(g=397*g^(this.y||0))^(this.z||0))^(this.w||0)},p.prototype.asArray=function(){var g=new Array();return this.toArray(g,0),g},p.prototype.toArray=function(g,n){return void 0===n&&(n=0),g[n]=this.x,g[n+1]=this.y,g[n+2]=this.z,g[n+3]=this.w,this},p.prototype.addInPlace=function(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this.w+=g.w,this},p.prototype.add=function(g){return new p(this.x+g.x,this.y+g.y,this.z+g.z,this.w+g.w)},p.prototype.addToRef=function(g,n){return n.x=this.x+g.x,n.y=this.y+g.y,n.z=this.z+g.z,n.w=this.w+g.w,this},p.prototype.subtractInPlace=function(g){return this.x-=g.x,this.y-=g.y,this.z-=g.z,this.w-=g.w,this},p.prototype.subtract=function(g){return new p(this.x-g.x,this.y-g.y,this.z-g.z,this.w-g.w)},p.prototype.subtractToRef=function(g,n){return n.x=this.x-g.x,n.y=this.y-g.y,n.z=this.z-g.z,n.w=this.w-g.w,this},p.prototype.subtractFromFloats=function(g,n,s,t){return new p(this.x-g,this.y-n,this.z-s,this.w-t)},p.prototype.subtractFromFloatsToRef=function(g,n,s,t,C){return C.x=this.x-g,C.y=this.y-n,C.z=this.z-s,C.w=this.w-t,this},p.prototype.negate=function(){return new p(-this.x,-this.y,-this.z,-this.w)},p.prototype.scaleInPlace=function(g){return this.x*=g,this.y*=g,this.z*=g,this.w*=g,this},p.prototype.scale=function(g){return new p(this.x*g,this.y*g,this.z*g,this.w*g)},p.prototype.scaleToRef=function(g,n){return n.x=this.x*g,n.y=this.y*g,n.z=this.z*g,n.w=this.w*g,this},p.prototype.scaleAndAddToRef=function(g,n){return n.x+=this.x*g,n.y+=this.y*g,n.z+=this.z*g,n.w+=this.w*g,this},p.prototype.equals=function(g){return g&&this.x===g.x&&this.y===g.y&&this.z===g.z&&this.w===g.w},p.prototype.equalsWithEpsilon=function(g,n){return void 0===n&&(n=A),g&&j.a.WithinEpsilon(this.x,g.x,n)&&j.a.WithinEpsilon(this.y,g.y,n)&&j.a.WithinEpsilon(this.z,g.z,n)&&j.a.WithinEpsilon(this.w,g.w,n)},p.prototype.equalsToFloats=function(g,n,s,t){return this.x===g&&this.y===n&&this.z===s&&this.w===t},p.prototype.multiplyInPlace=function(g){return this.x*=g.x,this.y*=g.y,this.z*=g.z,this.w*=g.w,this},p.prototype.multiply=function(g){return new p(this.x*g.x,this.y*g.y,this.z*g.z,this.w*g.w)},p.prototype.multiplyToRef=function(g,n){return n.x=this.x*g.x,n.y=this.y*g.y,n.z=this.z*g.z,n.w=this.w*g.w,this},p.prototype.multiplyByFloats=function(g,n,s,t){return new p(this.x*g,this.y*n,this.z*s,this.w*t)},p.prototype.divide=function(g){return new p(this.x/g.x,this.y/g.y,this.z/g.z,this.w/g.w)},p.prototype.divideToRef=function(g,n){return n.x=this.x/g.x,n.y=this.y/g.y,n.z=this.z/g.z,n.w=this.w/g.w,this},p.prototype.divideInPlace=function(g){return this.divideToRef(g,this)},p.prototype.minimizeInPlace=function(g){return g.x<this.x&&(this.x=g.x),g.y<this.y&&(this.y=g.y),g.z<this.z&&(this.z=g.z),g.w<this.w&&(this.w=g.w),this},p.prototype.maximizeInPlace=function(g){return g.x>this.x&&(this.x=g.x),g.y>this.y&&(this.y=g.y),g.z>this.z&&(this.z=g.z),g.w>this.w&&(this.w=g.w),this},p.prototype.floor=function(){return new p(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},p.prototype.fract=function(){return new p(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},p.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},p.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},p.prototype.normalize=function(){var g=this.length();return 0===g?this:this.scaleInPlace(1/g)},p.prototype.toVector3=function(){return new w(this.x,this.y,this.z)},p.prototype.clone=function(){return new p(this.x,this.y,this.z,this.w)},p.prototype.copyFrom=function(g){return this.x=g.x,this.y=g.y,this.z=g.z,this.w=g.w,this},p.prototype.copyFromFloats=function(g,n,s,t){return this.x=g,this.y=n,this.z=s,this.w=t,this},p.prototype.set=function(g,n,s,t){return this.copyFromFloats(g,n,s,t)},p.prototype.setAll=function(g){return this.x=this.y=this.z=this.w=g,this},p.FromArray=function(g,n){return n||(n=0),new p(g[n],g[n+1],g[n+2],g[n+3])},p.FromArrayToRef=function(g,n,s){s.x=g[n],s.y=g[n+1],s.z=g[n+2],s.w=g[n+3]},p.FromFloatArrayToRef=function(g,n,s){p.FromArrayToRef(g,n,s)},p.FromFloatsToRef=function(g,n,s,t,C){C.x=g,C.y=n,C.z=s,C.w=t},p.Zero=function(){return new p(0,0,0,0)},p.One=function(){return new p(1,1,1,1)},p.Normalize=function(g){var n=p.Zero();return p.NormalizeToRef(g,n),n},p.NormalizeToRef=function(g,n){n.copyFrom(g),n.normalize()},p.Minimize=function(g,n){var s=g.clone();return s.minimizeInPlace(n),s},p.Maximize=function(g,n){var s=g.clone();return s.maximizeInPlace(n),s},p.Distance=function(g,n){return Math.sqrt(p.DistanceSquared(g,n))},p.DistanceSquared=function(g,n){var s=g.x-n.x,t=g.y-n.y,C=g.z-n.z,J=g.w-n.w;return s*s+t*t+C*C+J*J},p.Center=function(g,n){var s=g.add(n);return s.scaleInPlace(.5),s},p.TransformNormal=function(g,n){var s=p.Zero();return p.TransformNormalToRef(g,n,s),s},p.TransformNormalToRef=function(g,n,s){var t=n.m,C=g.x*t[0]+g.y*t[4]+g.z*t[8],J=g.x*t[1]+g.y*t[5]+g.z*t[9],Q=g.x*t[2]+g.y*t[6]+g.z*t[10];s.x=C,s.y=J,s.z=Q,s.w=g.w},p.TransformNormalFromFloatsToRef=function(g,n,s,t,C,J){var Q=C.m;J.x=g*Q[0]+n*Q[4]+s*Q[8],J.y=g*Q[1]+n*Q[5]+s*Q[9],J.z=g*Q[2]+n*Q[6]+s*Q[10],J.w=t},p.FromVector3=function(g,n){return void 0===n&&(n=0),new p(g.x,g.y,g.z,n)},p}(),r=function(){function p(g,n){this.width=g,this.height=n}return p.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},p.prototype.getClassName=function(){return"Size"},p.prototype.getHashCode=function(){var g=this.width||0;return g=397*g^(this.height||0)},p.prototype.copyFrom=function(g){this.width=g.width,this.height=g.height},p.prototype.copyFromFloats=function(g,n){return this.width=g,this.height=n,this},p.prototype.set=function(g,n){return this.copyFromFloats(g,n)},p.prototype.multiplyByFloats=function(g,n){return new p(this.width*g,this.height*n)},p.prototype.clone=function(){return new p(this.width,this.height)},p.prototype.equals=function(g){return!!g&&(this.width===g.width&&this.height===g.height)},Object.defineProperty(p.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),p.Zero=function(){return new p(0,0)},p.prototype.add=function(g){return new p(this.width+g.width,this.height+g.height)},p.prototype.subtract=function(g){return new p(this.width-g.width,this.height-g.height)},p.Lerp=function(g,n,s){return new p(g.width+(n.width-g.width)*s,g.height+(n.height-g.height)*s)},p}(),o=function(){function p(g,n,s,t){void 0===g&&(g=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===t&&(t=1),this.x=g,this.y=n,this.z=s,this.w=t}return p.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},p.prototype.getClassName=function(){return"Quaternion"},p.prototype.getHashCode=function(){var g=this.x||0;return g=397*(g=397*(g=397*g^(this.y||0))^(this.z||0))^(this.w||0)},p.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},p.prototype.equals=function(g){return g&&this.x===g.x&&this.y===g.y&&this.z===g.z&&this.w===g.w},p.prototype.clone=function(){return new p(this.x,this.y,this.z,this.w)},p.prototype.copyFrom=function(g){return this.x=g.x,this.y=g.y,this.z=g.z,this.w=g.w,this},p.prototype.copyFromFloats=function(g,n,s,t){return this.x=g,this.y=n,this.z=s,this.w=t,this},p.prototype.set=function(g,n,s,t){return this.copyFromFloats(g,n,s,t)},p.prototype.add=function(g){return new p(this.x+g.x,this.y+g.y,this.z+g.z,this.w+g.w)},p.prototype.addInPlace=function(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this.w+=g.w,this},p.prototype.subtract=function(g){return new p(this.x-g.x,this.y-g.y,this.z-g.z,this.w-g.w)},p.prototype.scale=function(g){return new p(this.x*g,this.y*g,this.z*g,this.w*g)},p.prototype.scaleToRef=function(g,n){return n.x=this.x*g,n.y=this.y*g,n.z=this.z*g,n.w=this.w*g,this},p.prototype.scaleInPlace=function(g){return this.x*=g,this.y*=g,this.z*=g,this.w*=g,this},p.prototype.scaleAndAddToRef=function(g,n){return n.x+=this.x*g,n.y+=this.y*g,n.z+=this.z*g,n.w+=this.w*g,this},p.prototype.multiply=function(g){var n=new p(0,0,0,1);return this.multiplyToRef(g,n),n},p.prototype.multiplyToRef=function(g,n){var s=this.x*g.w+this.y*g.z-this.z*g.y+this.w*g.x,t=-this.x*g.z+this.y*g.w+this.z*g.x+this.w*g.y,C=this.x*g.y-this.y*g.x+this.z*g.w+this.w*g.z,J=-this.x*g.x-this.y*g.y-this.z*g.z+this.w*g.w;return n.copyFromFloats(s,t,C,J),this},p.prototype.multiplyInPlace=function(g){return this.multiplyToRef(g,this),this},p.prototype.conjugateToRef=function(g){return g.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},p.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},p.prototype.conjugate=function(){return new p(-this.x,-this.y,-this.z,this.w)},p.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},p.prototype.normalize=function(){var g=this.length();if(0===g)return this;var n=1/g;return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this},p.prototype.toEulerAngles=function(g){void 0===g&&(g="YZX");var n=w.Zero();return this.toEulerAnglesToRef(n),n},p.prototype.toEulerAnglesToRef=function(g){var n=this.z,s=this.x,t=this.y,C=this.w,J=C*C,Q=n*n,$=s*s,aa=t*t,ba=t*n-s*C;return ba<-.4999999?(g.y=2*Math.atan2(t,C),g.x=Math.PI/2,g.z=0):ba>.4999999?(g.y=2*Math.atan2(t,C),g.x=-Math.PI/2,g.z=0):(g.z=Math.atan2(2*(s*t+n*C),-Q-$+aa+J),g.x=Math.asin(-2*(n*t-s*C)),g.y=Math.atan2(2*(n*s+t*C),Q-$-aa+J)),this},p.prototype.toRotationMatrix=function(g){return G.FromQuaternionToRef(this,g),this},p.prototype.fromRotationMatrix=function(g){return p.FromRotationMatrixToRef(g,this),this},p.FromRotationMatrix=function(g){var n=new p();return p.FromRotationMatrixToRef(g,n),n},p.FromRotationMatrixToRef=function(g,n){var s,t=g.m,C=t[0],J=t[4],Q=t[8],$=t[1],aa=t[5],ba=t[9],ia=t[2],qa=t[6],ja=t[10],sa=C+aa+ja;sa>0?(s=.5/Math.sqrt(sa+1),n.w=.25/s,n.x=(qa-ba)*s,n.y=(Q-ia)*s,n.z=($-J)*s):C>aa&&C>ja?(s=2*Math.sqrt(1+C-aa-ja),n.w=(qa-ba)/s,n.x=.25*s,n.y=(J+$)/s,n.z=(Q+ia)/s):aa>ja?(s=2*Math.sqrt(1+aa-C-ja),n.w=(Q-ia)/s,n.x=(J+$)/s,n.y=.25*s,n.z=(ba+qa)/s):(s=2*Math.sqrt(1+ja-C-aa),n.w=($-J)/s,n.x=(Q+ia)/s,n.y=(ba+qa)/s,n.z=.25*s)},p.Dot=function(g,n){return g.x*n.x+g.y*n.y+g.z*n.z+g.w*n.w},p.AreClose=function(g,n){return p.Dot(g,n)>=0},p.Zero=function(){return new p(0,0,0,0)},p.Inverse=function(g){return new p(-g.x,-g.y,-g.z,g.w)},p.InverseToRef=function(g,n){return n.set(-g.x,-g.y,-g.z,g.w),n},p.Identity=function(){return new p(0,0,0,1)},p.IsIdentity=function(g){return g&&0===g.x&&0===g.y&&0===g.z&&1===g.w},p.RotationAxis=function(g,n){return p.RotationAxisToRef(g,n,new p())},p.RotationAxisToRef=function(g,n,s){var t=Math.sin(n/2);return g.normalize(),s.w=Math.cos(n/2),s.x=g.x*t,s.y=g.y*t,s.z=g.z*t,s},p.FromArray=function(g,n){return n||(n=0),new p(g[n],g[n+1],g[n+2],g[n+3])},p.FromEulerAngles=function(g,n,s){var t=new p();return p.RotationYawPitchRollToRef(n,g,s,t),t},p.FromEulerAnglesToRef=function(g,n,s,t){return p.RotationYawPitchRollToRef(n,g,s,t),t},p.FromEulerVector=function(g){var n=new p();return p.RotationYawPitchRollToRef(g.y,g.x,g.z,n),n},p.FromEulerVectorToRef=function(g,n){return p.RotationYawPitchRollToRef(g.y,g.x,g.z,n),n},p.RotationYawPitchRoll=function(g,n,s){var t=new p();return p.RotationYawPitchRollToRef(g,n,s,t),t},p.RotationYawPitchRollToRef=function(g,n,s,t){var C=.5*s,J=.5*n,Q=.5*g,$=Math.sin(C),aa=Math.cos(C),ba=Math.sin(J),ia=Math.cos(J),qa=Math.sin(Q),ja=Math.cos(Q);t.x=ja*ba*aa+qa*ia*$,t.y=qa*ia*aa-ja*ba*$,t.z=ja*ia*$-qa*ba*aa,t.w=ja*ia*aa+qa*ba*$},p.RotationAlphaBetaGamma=function(g,n,s){var t=new p();return p.RotationAlphaBetaGammaToRef(g,n,s,t),t},p.RotationAlphaBetaGammaToRef=function(g,n,s,t){var C=.5*(s+g),J=.5*(s-g),Q=.5*n;t.x=Math.cos(J)*Math.sin(Q),t.y=Math.sin(J)*Math.sin(Q),t.z=Math.sin(C)*Math.cos(Q),t.w=Math.cos(C)*Math.cos(Q)},p.RotationQuaternionFromAxis=function(g,n,s){var t=new p(0,0,0,0);return p.RotationQuaternionFromAxisToRef(g,n,s,t),t},p.RotationQuaternionFromAxisToRef=function(g,n,s,t){var C=N.Matrix[0];G.FromXYZAxesToRef(g.normalize(),n.normalize(),s.normalize(),C),p.FromRotationMatrixToRef(C,t)},p.Slerp=function(g,n,s){var t=p.Identity();return p.SlerpToRef(g,n,s,t),t},p.SlerpToRef=function(g,n,s,t){var C,J,Q=g.x*n.x+g.y*n.y+g.z*n.z+g.w*n.w,$=!1;if(Q<0&&($=!0,Q=-Q),Q>.999999)J=1-s,C=$?-s:s;else{var aa=Math.acos(Q),ba=1/Math.sin(aa);J=Math.sin((1-s)*aa)*ba,C=$?-Math.sin(s*aa)*ba:Math.sin(s*aa)*ba}t.x=J*g.x+C*n.x,t.y=J*g.y+C*n.y,t.z=J*g.z+C*n.z,t.w=J*g.w+C*n.w},p.Hermite=function(g,n,s,t,C){var J=C*C,Q=C*J,$=2*Q-3*J+1,aa=-2*Q+3*J,ba=Q-2*J+C,ia=Q-J;return new p(g.x*$+s.x*aa+n.x*ba+t.x*ia,g.y*$+s.y*aa+n.y*ba+t.y*ia,g.z*$+s.z*aa+n.z*ba+t.z*ia,g.w*$+s.w*aa+n.w*ba+t.w*ia)},p}(),G=function(){function p(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,this._m=new Float32Array(16),this._updateIdentityStatus(!1)}return Object.defineProperty(p.prototype,"m",{get:function(){return this._m},enumerable:!0,configurable:!0}),p.prototype._markAsUpdated=function(){this.updateFlag=p._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},p.prototype._updateIdentityStatus=function(g,n,s,t){void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===t&&(t=!0),this.updateFlag=p._updateFlagSeed++,this._isIdentity=g,this._isIdentity3x2=g||s,this._isIdentityDirty=!this._isIdentity&&n,this._isIdentity3x2Dirty=!this._isIdentity3x2&&t},p.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var g=this._m;this._isIdentity=1===g[0]&&0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&1===g[5]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&1===g[10]&&0===g[11]&&0===g[12]&&0===g[13]&&0===g[14]&&1===g[15]}return this._isIdentity},p.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]?this._isIdentity3x2=!1:0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},p.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var g=this._m,n=g[0],s=g[1],t=g[2],C=g[3],J=g[4],Q=g[5],$=g[6],aa=g[7],ba=g[8],ia=g[9],qa=g[10],ja=g[11],sa=g[12],za=g[13],Fa=g[14],Ea=g[15],Ba=qa*Ea-Fa*ja,Sa=ia*Ea-za*ja,Xa=ia*Fa-za*qa,Ka=ba*Ea-sa*ja,Ga=ba*Fa-qa*sa,nb=ba*za-sa*ia;return n*+(Q*Ba-$*Sa+aa*Xa)+s*-(J*Ba-$*Ka+aa*Ga)+t*+(J*Sa-Q*Ka+aa*nb)+C*-(J*Xa-Q*Ga+$*nb)},p.prototype.toArray=function(){return this._m},p.prototype.asArray=function(){return this._m},p.prototype.invert=function(){return this.invertToRef(this),this},p.prototype.reset=function(){return p.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},p.prototype.add=function(g){var n=new p();return this.addToRef(g,n),n},p.prototype.addToRef=function(g,n){for(var s=this._m,t=n._m,C=g.m,J=0;J<16;J++)t[J]=s[J]+C[J];return n._markAsUpdated(),this},p.prototype.addToSelf=function(g){for(var n=this._m,s=g.m,t=0;t<16;t++)n[t]+=s[t];return this._markAsUpdated(),this},p.prototype.invertToRef=function(g){if(!0===this._isIdentity)return p.IdentityToRef(g),this;var n=this._m,s=n[0],t=n[1],C=n[2],J=n[3],Q=n[4],$=n[5],aa=n[6],ba=n[7],ia=n[8],qa=n[9],ja=n[10],sa=n[11],za=n[12],Fa=n[13],Ea=n[14],Ba=n[15],Sa=ja*Ba-Ea*sa,Xa=qa*Ba-Fa*sa,Ka=qa*Ea-Fa*ja,Ga=ia*Ba-za*sa,nb=ia*Ea-ja*za,jb=ia*Fa-za*qa,bb=+($*Sa-aa*Xa+ba*Ka),fb=-(Q*Sa-aa*Ga+ba*nb),ob=+(Q*Xa-$*Ga+ba*jb),Cb=-(Q*Ka-$*nb+aa*jb),gb=s*bb+t*fb+C*ob+J*Cb;if(0===gb)return g.copyFrom(this),this;var qb=1/gb,yb=aa*Ba-Ea*ba,Lb=$*Ba-Fa*ba,Mb=$*Ea-Fa*aa,gc=Q*Ba-za*ba,Ca=Q*Ea-za*aa,cc=Q*Fa-za*$,dc=aa*sa-ja*ba,va=$*sa-qa*ba,vd=$*ja-qa*aa,Xc=Q*sa-ia*ba,xa=Q*ja-ia*aa,Zb=Q*qa-ia*$,yc=-(t*Sa-C*Xa+J*Ka),wd=+(s*Sa-C*Ga+J*nb),Pa=-(s*Xa-t*Ga+J*jb),hc=+(s*Ka-t*nb+C*jb),ie=+(t*yb-C*Lb+J*Mb),hb=-(s*yb-C*gc+J*Ca),xd=+(s*Lb-t*gc+J*cc),yd=-(s*Mb-t*Ca+C*cc),zd=-(t*dc-C*va+J*vd),oc=+(s*dc-C*Xc+J*xa),je=-(s*va-t*Xc+J*Zb),ke=+(s*vd-t*xa+C*Zb);return p.FromValuesToRef(bb*qb,yc*qb,ie*qb,zd*qb,fb*qb,wd*qb,hb*qb,oc*qb,ob*qb,Pa*qb,xd*qb,je*qb,Cb*qb,hc*qb,yd*qb,ke*qb,g),this},p.prototype.addAtIndex=function(g,n){return this._m[g]+=n,this._markAsUpdated(),this},p.prototype.multiplyAtIndex=function(g,n){return this._m[g]*=n,this._markAsUpdated(),this},p.prototype.setTranslationFromFloats=function(g,n,s){return this._m[12]=g,this._m[13]=n,this._m[14]=s,this._markAsUpdated(),this},p.prototype.addTranslationFromFloats=function(g,n,s){return this._m[12]+=g,this._m[13]+=n,this._m[14]+=s,this._markAsUpdated(),this},p.prototype.setTranslation=function(g){return this.setTranslationFromFloats(g.x,g.y,g.z)},p.prototype.getTranslation=function(){return new w(this._m[12],this._m[13],this._m[14])},p.prototype.getTranslationToRef=function(g){return g.x=this._m[12],g.y=this._m[13],g.z=this._m[14],this},p.prototype.removeRotationAndScaling=function(){var g=this.m;return p.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,g[12],g[13],g[14],g[15],this),this._updateIdentityStatus(0===g[12]&&0===g[13]&&0===g[14]&&1===g[15]),this},p.prototype.multiply=function(g){var n=new p();return this.multiplyToRef(g,n),n},p.prototype.copyFrom=function(g){g.copyToArray(this._m);var n=g;return this._updateIdentityStatus(n._isIdentity,n._isIdentityDirty,n._isIdentity3x2,n._isIdentity3x2Dirty),this},p.prototype.copyToArray=function(g,n){void 0===n&&(n=0);for(var s=0;s<16;s++)g[n+s]=this._m[s];return this},p.prototype.multiplyToRef=function(g,n){return this._isIdentity?(n.copyFrom(g),this):g._isIdentity?(n.copyFrom(this),this):(this.multiplyToArray(g,n._m,0),n._markAsUpdated(),this)},p.prototype.multiplyToArray=function(g,n,s){var t=this._m,C=g.m,J=t[0],Q=t[1],$=t[2],aa=t[3],ba=t[4],ia=t[5],qa=t[6],ja=t[7],sa=t[8],za=t[9],Fa=t[10],Ea=t[11],Ba=t[12],Sa=t[13],Xa=t[14],Ka=t[15],Ga=C[0],nb=C[1],jb=C[2],bb=C[3],fb=C[4],ob=C[5],Cb=C[6],gb=C[7],qb=C[8],yb=C[9],Lb=C[10],Mb=C[11],gc=C[12],Ca=C[13],cc=C[14],dc=C[15];return n[s]=J*Ga+Q*fb+$*qb+aa*gc,n[s+1]=J*nb+Q*ob+$*yb+aa*Ca,n[s+2]=J*jb+Q*Cb+$*Lb+aa*cc,n[s+3]=J*bb+Q*gb+$*Mb+aa*dc,n[s+4]=ba*Ga+ia*fb+qa*qb+ja*gc,n[s+5]=ba*nb+ia*ob+qa*yb+ja*Ca,n[s+6]=ba*jb+ia*Cb+qa*Lb+ja*cc,n[s+7]=ba*bb+ia*gb+qa*Mb+ja*dc,n[s+8]=sa*Ga+za*fb+Fa*qb+Ea*gc,n[s+9]=sa*nb+za*ob+Fa*yb+Ea*Ca,n[s+10]=sa*jb+za*Cb+Fa*Lb+Ea*cc,n[s+11]=sa*bb+za*gb+Fa*Mb+Ea*dc,n[s+12]=Ba*Ga+Sa*fb+Xa*qb+Ka*gc,n[s+13]=Ba*nb+Sa*ob+Xa*yb+Ka*Ca,n[s+14]=Ba*jb+Sa*Cb+Xa*Lb+Ka*cc,n[s+15]=Ba*bb+Sa*gb+Xa*Mb+Ka*dc,this},p.prototype.equals=function(g){var n=g;if(!n)return!1;if((this._isIdentity||n._isIdentity)&&!this._isIdentityDirty&&!n._isIdentityDirty)return this._isIdentity&&n._isIdentity;var s=this.m,t=n.m;return s[0]===t[0]&&s[1]===t[1]&&s[2]===t[2]&&s[3]===t[3]&&s[4]===t[4]&&s[5]===t[5]&&s[6]===t[6]&&s[7]===t[7]&&s[8]===t[8]&&s[9]===t[9]&&s[10]===t[10]&&s[11]===t[11]&&s[12]===t[12]&&s[13]===t[13]&&s[14]===t[14]&&s[15]===t[15]},p.prototype.clone=function(){var g=new p();return g.copyFrom(this),g},p.prototype.getClassName=function(){return"Matrix"},p.prototype.getHashCode=function(){for(var g=this._m[0]||0,n=1;n<16;n++)g=397*g^(this._m[n]||0);return g},p.prototype.decompose=function(g,n,s){if(this._isIdentity)return s&&s.setAll(0),g&&g.setAll(1),n&&n.copyFromFloats(0,0,0,1),!0;var t=this._m;if(s&&s.copyFromFloats(t[12],t[13],t[14]),(g=g||N.Vector3[0]).x=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),g.y=Math.sqrt(t[4]*t[4]+t[5]*t[5]+t[6]*t[6]),g.z=Math.sqrt(t[8]*t[8]+t[9]*t[9]+t[10]*t[10]),this.determinant()<=0&&(g.y*=-1),0===g.x||0===g.y||0===g.z)return n&&n.copyFromFloats(0,0,0,1),!1;if(n){var C=1/g.x,J=1/g.y,Q=1/g.z;p.FromValuesToRef(t[0]*C,t[1]*C,t[2]*C,0,t[4]*J,t[5]*J,t[6]*J,0,t[8]*Q,t[9]*Q,t[10]*Q,0,0,0,0,1,N.Matrix[0]),o.FromRotationMatrixToRef(N.Matrix[0],n)}return!0},p.prototype.getRow=function(g){if(g<0||g>3)return null;var n=4*g;return new y(this._m[n+0],this._m[n+1],this._m[n+2],this._m[n+3])},p.prototype.setRow=function(g,n){return this.setRowFromFloats(g,n.x,n.y,n.z,n.w)},p.prototype.transpose=function(){return p.Transpose(this)},p.prototype.transposeToRef=function(g){return p.TransposeToRef(this,g),this},p.prototype.setRowFromFloats=function(g,n,s,t,C){if(g<0||g>3)return this;var J=4*g;return this._m[J+0]=n,this._m[J+1]=s,this._m[J+2]=t,this._m[J+3]=C,this._markAsUpdated(),this},p.prototype.scale=function(g){var n=new p();return this.scaleToRef(g,n),n},p.prototype.scaleToRef=function(g,n){for(var s=0;s<16;s++)n._m[s]=this._m[s]*g;return n._markAsUpdated(),this},p.prototype.scaleAndAddToRef=function(g,n){for(var s=0;s<16;s++)n._m[s]+=this._m[s]*g;return n._markAsUpdated(),this},p.prototype.toNormalMatrix=function(g){var n=N.Matrix[0];this.invertToRef(n),n.transposeToRef(g);var s=g._m;p.FromValuesToRef(s[0],s[1],s[2],0,s[4],s[5],s[6],0,s[8],s[9],s[10],0,0,0,0,1,g)},p.prototype.getRotationMatrix=function(){var g=new p();return this.getRotationMatrixToRef(g),g},p.prototype.getRotationMatrixToRef=function(g){var n=N.Vector3[0];if(!this.decompose(n))return p.IdentityToRef(g),this;var s=this._m,t=1/n.x,C=1/n.y,J=1/n.z;return p.FromValuesToRef(s[0]*t,s[1]*t,s[2]*t,0,s[4]*C,s[5]*C,s[6]*C,0,s[8]*J,s[9]*J,s[10]*J,0,0,0,0,1,g),this},p.prototype.toggleModelMatrixHandInPlace=function(){var g=this._m;g[2]*=-1,g[6]*=-1,g[8]*=-1,g[9]*=-1,g[14]*=-1,this._markAsUpdated()},p.prototype.toggleProjectionMatrixHandInPlace=function(){var g=this._m;g[8]*=-1,g[9]*=-1,g[10]*=-1,g[11]*=-1,this._markAsUpdated()},p.FromArray=function(g,n){void 0===n&&(n=0);var s=new p();return p.FromArrayToRef(g,n,s),s},p.FromArrayToRef=function(g,n,s){for(var t=0;t<16;t++)s._m[t]=g[t+n];s._markAsUpdated()},p.FromFloat32ArrayToRefScaled=function(g,n,s,t){for(var C=0;C<16;C++)t._m[C]=g[C+n]*s;t._markAsUpdated()},Object.defineProperty(p,"IdentityReadOnly",{get:function(){return p._identityReadOnly},enumerable:!0,configurable:!0}),p.FromValuesToRef=function(g,n,s,t,C,J,Q,$,aa,ba,ia,qa,ja,sa,za,Fa,Ea){var Ba=Ea._m;Ba[0]=g,Ba[1]=n,Ba[2]=s,Ba[3]=t,Ba[4]=C,Ba[5]=J,Ba[6]=Q,Ba[7]=$,Ba[8]=aa,Ba[9]=ba,Ba[10]=ia,Ba[11]=qa,Ba[12]=ja,Ba[13]=sa,Ba[14]=za,Ba[15]=Fa,Ea._markAsUpdated()},p.FromValues=function(g,n,s,t,C,J,Q,$,aa,ba,ia,qa,ja,sa,za,Fa){var Ea=new p(),Ba=Ea._m;return Ba[0]=g,Ba[1]=n,Ba[2]=s,Ba[3]=t,Ba[4]=C,Ba[5]=J,Ba[6]=Q,Ba[7]=$,Ba[8]=aa,Ba[9]=ba,Ba[10]=ia,Ba[11]=qa,Ba[12]=ja,Ba[13]=sa,Ba[14]=za,Ba[15]=Fa,Ea._markAsUpdated(),Ea},p.Compose=function(g,n,s){var t=new p();return p.ComposeToRef(g,n,s,t),t},p.ComposeToRef=function(g,n,s,t){var C=t._m,J=n.x,Q=n.y,$=n.z,aa=n.w,ba=J+J,ia=Q+Q,qa=$+$,ja=J*ba,sa=J*ia,za=J*qa,Fa=Q*ia,Ea=Q*qa,Ba=$*qa,Sa=aa*ba,Xa=aa*ia,Ka=aa*qa,Ga=g.x,nb=g.y,jb=g.z;C[0]=(1-(Fa+Ba))*Ga,C[1]=(sa+Ka)*Ga,C[2]=(za-Xa)*Ga,C[3]=0,C[4]=(sa-Ka)*nb,C[5]=(1-(ja+Ba))*nb,C[6]=(Ea+Sa)*nb,C[7]=0,C[8]=(za+Xa)*jb,C[9]=(Ea-Sa)*jb,C[10]=(1-(ja+Fa))*jb,C[11]=0,C[12]=s.x,C[13]=s.y,C[14]=s.z,C[15]=1,t._markAsUpdated()},p.Identity=function(){var g=p.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return g._updateIdentityStatus(!0),g},p.IdentityToRef=function(g){p.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,g),g._updateIdentityStatus(!0)},p.Zero=function(){var g=p.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return g._updateIdentityStatus(!1),g},p.RotationX=function(g){var n=new p();return p.RotationXToRef(g,n),n},p.Invert=function(g){var n=new p();return g.invertToRef(n),n},p.RotationXToRef=function(g,n){var s=Math.sin(g),t=Math.cos(g);p.FromValuesToRef(1,0,0,0,0,t,s,0,0,-s,t,0,0,0,0,1,n),n._updateIdentityStatus(1===t&&0===s)},p.RotationY=function(g){var n=new p();return p.RotationYToRef(g,n),n},p.RotationYToRef=function(g,n){var s=Math.sin(g),t=Math.cos(g);p.FromValuesToRef(t,0,-s,0,0,1,0,0,s,0,t,0,0,0,0,1,n),n._updateIdentityStatus(1===t&&0===s)},p.RotationZ=function(g){var n=new p();return p.RotationZToRef(g,n),n},p.RotationZToRef=function(g,n){var s=Math.sin(g),t=Math.cos(g);p.FromValuesToRef(t,s,0,0,-s,t,0,0,0,0,1,0,0,0,0,1,n),n._updateIdentityStatus(1===t&&0===s)},p.RotationAxis=function(g,n){var s=new p();return p.RotationAxisToRef(g,n,s),s},p.RotationAxisToRef=function(g,n,s){var t=Math.sin(-n),C=Math.cos(-n),J=1-C;g.normalize();var Q=s._m;Q[0]=g.x*g.x*J+C,Q[1]=g.x*g.y*J-g.z*t,Q[2]=g.x*g.z*J+g.y*t,Q[3]=0,Q[4]=g.y*g.x*J+g.z*t,Q[5]=g.y*g.y*J+C,Q[6]=g.y*g.z*J-g.x*t,Q[7]=0,Q[8]=g.z*g.x*J-g.y*t,Q[9]=g.z*g.y*J+g.x*t,Q[10]=g.z*g.z*J+C,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,s._markAsUpdated()},p.RotationAlignToRef=function(g,n,s){var t=w.Cross(n,g),C=w.Dot(n,g),J=1/(1+C),Q=s._m;Q[0]=t.x*t.x*J+C,Q[1]=t.y*t.x*J-t.z,Q[2]=t.z*t.x*J+t.y,Q[3]=0,Q[4]=t.x*t.y*J+t.z,Q[5]=t.y*t.y*J+C,Q[6]=t.z*t.y*J-t.x,Q[7]=0,Q[8]=t.x*t.z*J-t.y,Q[9]=t.y*t.z*J+t.x,Q[10]=t.z*t.z*J+C,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,s._markAsUpdated()},p.RotationYawPitchRoll=function(g,n,s){var t=new p();return p.RotationYawPitchRollToRef(g,n,s,t),t},p.RotationYawPitchRollToRef=function(g,n,s,t){o.RotationYawPitchRollToRef(g,n,s,N.Quaternion[0]),N.Quaternion[0].toRotationMatrix(t)},p.Scaling=function(g,n,s){var t=new p();return p.ScalingToRef(g,n,s,t),t},p.ScalingToRef=function(g,n,s,t){p.FromValuesToRef(g,0,0,0,0,n,0,0,0,0,s,0,0,0,0,1,t),t._updateIdentityStatus(1===g&&1===n&&1===s)},p.Translation=function(g,n,s){var t=new p();return p.TranslationToRef(g,n,s,t),t},p.TranslationToRef=function(g,n,s,t){p.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,g,n,s,1,t),t._updateIdentityStatus(0===g&&0===n&&0===s)},p.Lerp=function(g,n,s){var t=new p();return p.LerpToRef(g,n,s,t),t},p.LerpToRef=function(g,n,s,t){for(var C=t._m,J=g.m,Q=n.m,$=0;$<16;$++)C[$]=J[$]*(1-s)+Q[$]*s;t._markAsUpdated()},p.DecomposeLerp=function(g,n,s){var t=new p();return p.DecomposeLerpToRef(g,n,s,t),t},p.DecomposeLerpToRef=function(g,n,s,t){var C=N.Vector3[0],J=N.Quaternion[0],Q=N.Vector3[1];g.decompose(C,J,Q);var $=N.Vector3[2],aa=N.Quaternion[1],ba=N.Vector3[3];n.decompose($,aa,ba);var ia=N.Vector3[4];w.LerpToRef(C,$,s,ia);var qa=N.Quaternion[2];o.SlerpToRef(J,aa,s,qa);var ja=N.Vector3[5];w.LerpToRef(Q,ba,s,ja),p.ComposeToRef(ia,qa,ja,t)},p.LookAtLH=function(g,n,s){var t=new p();return p.LookAtLHToRef(g,n,s,t),t},p.LookAtLHToRef=function(g,n,s,t){var C=N.Vector3[0],J=N.Vector3[1],Q=N.Vector3[2];n.subtractToRef(g,Q),Q.normalize(),w.CrossToRef(s,Q,C);var $=C.lengthSquared();0===$?C.x=1:C.normalizeFromLength(Math.sqrt($)),w.CrossToRef(Q,C,J),J.normalize();var aa=-w.Dot(C,g),ba=-w.Dot(J,g),ia=-w.Dot(Q,g);p.FromValuesToRef(C.x,J.x,Q.x,0,C.y,J.y,Q.y,0,C.z,J.z,Q.z,0,aa,ba,ia,1,t)},p.LookAtRH=function(g,n,s){var t=new p();return p.LookAtRHToRef(g,n,s,t),t},p.LookAtRHToRef=function(g,n,s,t){var C=N.Vector3[0],J=N.Vector3[1],Q=N.Vector3[2];g.subtractToRef(n,Q),Q.normalize(),w.CrossToRef(s,Q,C);var $=C.lengthSquared();0===$?C.x=1:C.normalizeFromLength(Math.sqrt($)),w.CrossToRef(Q,C,J),J.normalize();var aa=-w.Dot(C,g),ba=-w.Dot(J,g),ia=-w.Dot(Q,g);p.FromValuesToRef(C.x,J.x,Q.x,0,C.y,J.y,Q.y,0,C.z,J.z,Q.z,0,aa,ba,ia,1,t)},p.OrthoLH=function(g,n,s,t){var C=new p();return p.OrthoLHToRef(g,n,s,t,C),C},p.OrthoLHToRef=function(g,n,s,t,C){var J=2/g,Q=2/n,$=2/(t-s),aa=-(t+s)/(t-s);p.FromValuesToRef(J,0,0,0,0,Q,0,0,0,0,$,0,0,0,aa,1,C),C._updateIdentityStatus(1===J&&1===Q&&1===$&&0===aa)},p.OrthoOffCenterLH=function(g,n,s,t,C,J){var Q=new p();return p.OrthoOffCenterLHToRef(g,n,s,t,C,J,Q),Q},p.OrthoOffCenterLHToRef=function(g,n,s,t,C,J,Q){var $=2/(n-g),aa=2/(t-s),ba=2/(J-C),ia=-(J+C)/(J-C),qa=(g+n)/(g-n),ja=(t+s)/(s-t);p.FromValuesToRef($,0,0,0,0,aa,0,0,0,0,ba,0,qa,ja,ia,1,Q),Q._markAsUpdated()},p.OrthoOffCenterRH=function(g,n,s,t,C,J){var Q=new p();return p.OrthoOffCenterRHToRef(g,n,s,t,C,J,Q),Q},p.OrthoOffCenterRHToRef=function(g,n,s,t,C,J,Q){p.OrthoOffCenterLHToRef(g,n,s,t,C,J,Q),Q._m[10]*=-1},p.PerspectiveLH=function(g,n,s,t){var C=new p(),J=2*s/g,Q=2*s/n,$=(t+s)/(t-s),aa=-2*t*s/(t-s);return p.FromValuesToRef(J,0,0,0,0,Q,0,0,0,0,$,1,0,0,aa,0,C),C._updateIdentityStatus(!1),C},p.PerspectiveFovLH=function(g,n,s,t){var C=new p();return p.PerspectiveFovLHToRef(g,n,s,t,C),C},p.PerspectiveFovLHToRef=function(g,n,s,t,C,J){void 0===J&&(J=!0);var Q=s,$=t,aa=1/Math.tan(.5*g),ba=J?aa/n:aa,ia=J?aa:aa*n,qa=($+Q)/($-Q),ja=-2*$*Q/($-Q);p.FromValuesToRef(ba,0,0,0,0,ia,0,0,0,0,qa,1,0,0,ja,0,C),C._updateIdentityStatus(!1)},p.PerspectiveFovRH=function(g,n,s,t){var C=new p();return p.PerspectiveFovRHToRef(g,n,s,t,C),C},p.PerspectiveFovRHToRef=function(g,n,s,t,C,J){void 0===J&&(J=!0);var Q=s,$=t,aa=1/Math.tan(.5*g),ba=J?aa/n:aa,ia=J?aa:aa*n,qa=-($+Q)/($-Q),ja=-2*$*Q/($-Q);p.FromValuesToRef(ba,0,0,0,0,ia,0,0,0,0,qa,-1,0,0,ja,0,C),C._updateIdentityStatus(!1)},p.PerspectiveFovWebVRToRef=function(g,n,s,t,C){void 0===C&&(C=!1);var J=C?-1:1,Q=Math.tan(g.upDegrees*Math.PI/180),$=Math.tan(g.downDegrees*Math.PI/180),aa=Math.tan(g.leftDegrees*Math.PI/180),ba=Math.tan(g.rightDegrees*Math.PI/180),ia=2/(aa+ba),qa=2/(Q+$),ja=t._m;ja[0]=ia,ja[1]=ja[2]=ja[3]=ja[4]=0,ja[5]=qa,ja[6]=ja[7]=0,ja[8]=(aa-ba)*ia*.5,ja[9]=-(Q-$)*qa*.5,ja[10]=-s/(n-s),ja[11]=1*J,ja[12]=ja[13]=ja[15]=0,ja[14]=-2*s*n/(s-n),t._markAsUpdated()},p.GetFinalMatrix=function(g,n,s,t,C,J){var Q=g.width,$=g.height,aa=g.x,ba=g.y,ia=p.FromValues(Q/2,0,0,0,0,-$/2,0,0,0,0,J-C,0,aa+Q/2,$/2+ba,C,1),qa=N.Matrix[0];return n.multiplyToRef(s,qa),qa.multiplyToRef(t,qa),qa.multiply(ia)},p.GetAsMatrix2x2=function(g){var n=g.m;return new Float32Array([n[0],n[1],n[4],n[5]])},p.GetAsMatrix3x3=function(g){var n=g.m;return new Float32Array([n[0],n[1],n[2],n[4],n[5],n[6],n[8],n[9],n[10]])},p.Transpose=function(g){var n=new p();return p.TransposeToRef(g,n),n},p.TransposeToRef=function(g,n){var s=n._m,t=g.m;s[0]=t[0],s[1]=t[4],s[2]=t[8],s[3]=t[12],s[4]=t[1],s[5]=t[5],s[6]=t[9],s[7]=t[13],s[8]=t[2],s[9]=t[6],s[10]=t[10],s[11]=t[14],s[12]=t[3],s[13]=t[7],s[14]=t[11],s[15]=t[15],n._updateIdentityStatus(g._isIdentity,g._isIdentityDirty)},p.Reflection=function(g){var n=new p();return p.ReflectionToRef(g,n),n},p.ReflectionToRef=function(g,n){g.normalize();var s=g.normal.x,t=g.normal.y,C=g.normal.z,J=-2*s,Q=-2*t,$=-2*C;p.FromValuesToRef(J*s+1,Q*s,$*s,0,J*t,Q*t+1,$*t,0,J*C,Q*C,$*C+1,0,J*g.d,Q*g.d,$*g.d,1,n)},p.FromXYZAxesToRef=function(g,n,s,t){p.FromValuesToRef(g.x,g.y,g.z,0,n.x,n.y,n.z,0,s.x,s.y,s.z,0,0,0,0,1,t)},p.FromQuaternionToRef=function(g,n){var s=g.x*g.x,t=g.y*g.y,C=g.z*g.z,J=g.x*g.y,Q=g.z*g.w,$=g.z*g.x,aa=g.y*g.w,ba=g.y*g.z,ia=g.x*g.w;n._m[0]=1-2*(t+C),n._m[1]=2*(J+Q),n._m[2]=2*($-aa),n._m[3]=0,n._m[4]=2*(J-Q),n._m[5]=1-2*(C+s),n._m[6]=2*(ba+ia),n._m[7]=0,n._m[8]=2*($+aa),n._m[9]=2*(ba-ia),n._m[10]=1-2*(t+s),n._m[11]=0,n._m[12]=0,n._m[13]=0,n._m[14]=0,n._m[15]=1,n._markAsUpdated()},p._updateFlagSeed=0,p._identityReadOnly=p.Identity(),p}(),M=function(){function p(g,n,s,t){this.normal=new w(g,n,s),this.d=t}return p.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},p.prototype.clone=function(){return new p(this.normal.x,this.normal.y,this.normal.z,this.d)},p.prototype.getClassName=function(){return"Plane"},p.prototype.getHashCode=function(){var g=this.normal.getHashCode();return g=397*g^(this.d||0)},p.prototype.normalize=function(){var g=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),n=0;return 0!==g&&(n=1/g),this.normal.x*=n,this.normal.y*=n,this.normal.z*=n,this.d*=n,this},p.prototype.transform=function(g){var n=N.Matrix[0];G.TransposeToRef(g,n);var s=n.m,t=this.normal.x,C=this.normal.y,J=this.normal.z,Q=this.d;return new p(t*s[0]+C*s[1]+J*s[2]+Q*s[3],t*s[4]+C*s[5]+J*s[6]+Q*s[7],t*s[8]+C*s[9]+J*s[10]+Q*s[11],t*s[12]+C*s[13]+J*s[14]+Q*s[15])},p.prototype.dotCoordinate=function(g){return this.normal.x*g.x+this.normal.y*g.y+this.normal.z*g.z+this.d},p.prototype.copyFromPoints=function(g,n,s){var t,C=n.x-g.x,J=n.y-g.y,Q=n.z-g.z,$=s.x-g.x,aa=s.y-g.y,ba=s.z-g.z,ia=J*ba-Q*aa,qa=Q*$-C*ba,ja=C*aa-J*$,sa=Math.sqrt(ia*ia+qa*qa+ja*ja);return t=0!==sa?1/sa:0,this.normal.x=ia*t,this.normal.y=qa*t,this.normal.z=ja*t,this.d=-(this.normal.x*g.x+this.normal.y*g.y+this.normal.z*g.z),this},p.prototype.isFrontFacingTo=function(g,n){return w.Dot(this.normal,g)<=n},p.prototype.signedDistanceTo=function(g){return w.Dot(g,this.normal)+this.d},p.FromArray=function(g){return new p(g[0],g[1],g[2],g[3])},p.FromPoints=function(g,n,s){var t=new p(0,0,0,0);return t.copyFromPoints(g,n,s),t},p.FromPositionAndNormal=function(g,n){var s=new p(0,0,0,0);return n.normalize(),s.normal=n,s.d=-(n.x*g.x+n.y*g.y+n.z*g.z),s},p.SignedDistanceToPlaneFromPositionAndNormal=function(g,n,s){var t=-(n.x*g.x+n.y*g.y+n.z*g.z);return w.Dot(s,n)+t},p}(),R=function(){function p(g,n,s,t){this.x=g,this.y=n,this.width=s,this.height=t}return p.prototype.toGlobal=function(g,n){return new p(this.x*g,this.y*n,this.width*g,this.height*n)},p.prototype.toGlobalToRef=function(g,n,s){return s.x=this.x*g,s.y=this.y*n,s.width=this.width*g,s.height=this.height*n,this},p.prototype.clone=function(){return new p(this.x,this.y,this.width,this.height)},p}(),W=function(){function p(){}return p.GetPlanes=function(g){for(var n=[],s=0;s<6;s++)n.push(new M(0,0,0,0));return p.GetPlanesToRef(g,n),n},p.GetNearPlaneToRef=function(g,n){var s=g.m;n.normal.x=s[3]+s[2],n.normal.y=s[7]+s[6],n.normal.z=s[11]+s[10],n.d=s[15]+s[14],n.normalize()},p.GetFarPlaneToRef=function(g,n){var s=g.m;n.normal.x=s[3]-s[2],n.normal.y=s[7]-s[6],n.normal.z=s[11]-s[10],n.d=s[15]-s[14],n.normalize()},p.GetLeftPlaneToRef=function(g,n){var s=g.m;n.normal.x=s[3]+s[0],n.normal.y=s[7]+s[4],n.normal.z=s[11]+s[8],n.d=s[15]+s[12],n.normalize()},p.GetRightPlaneToRef=function(g,n){var s=g.m;n.normal.x=s[3]-s[0],n.normal.y=s[7]-s[4],n.normal.z=s[11]-s[8],n.d=s[15]-s[12],n.normalize()},p.GetTopPlaneToRef=function(g,n){var s=g.m;n.normal.x=s[3]-s[1],n.normal.y=s[7]-s[5],n.normal.z=s[11]-s[9],n.d=s[15]-s[13],n.normalize()},p.GetBottomPlaneToRef=function(g,n){var s=g.m;n.normal.x=s[3]+s[1],n.normal.y=s[7]+s[5],n.normal.z=s[11]+s[9],n.d=s[15]+s[13],n.normalize()},p.GetPlanesToRef=function(g,n){p.GetNearPlaneToRef(g,n[0]),p.GetFarPlaneToRef(g,n[1]),p.GetLeftPlaneToRef(g,n[2]),p.GetRightPlaneToRef(g,n[3]),p.GetTopPlaneToRef(g,n[4]),p.GetBottomPlaneToRef(g,n[5])},p}();!function(p){p[p.LOCAL=0]="LOCAL",p[p.WORLD=1]="WORLD",p[p.BONE=2]="BONE"}(O||(O={}));var Y,X=function(){function p(){}return p.X=new w(1,0,0),p.Y=new w(0,1,0),p.Z=new w(0,0,1),p}(),ea=function(){function p(){}return p.Interpolate=function(g,n,s,t,C){for(var J=1-3*t+3*n,Q=3*t-6*n,$=3*n,aa=g,ba=0;ba<5;ba++){var ia=aa*aa;aa-=(J*(ia*aa)+Q*ia+$*aa-g)*(1/(3*J*ia+2*Q*aa+$)),aa=Math.min(1,Math.max(0,aa))}return 3*Math.pow(1-aa,2)*aa*s+3*(1-aa)*Math.pow(aa,2)*C+Math.pow(aa,3)},p}();!function(p){p[p.CW=0]="CW",p[p.CCW=1]="CCW"}(Y||(Y={}));var ca=function(){function p(g){this._radians=g,this._radians<0&&(this._radians+=2*Math.PI)}return p.prototype.degrees=function(){return 180*this._radians/Math.PI},p.prototype.radians=function(){return this._radians},p.BetweenTwoPoints=function(g,n){var s=n.subtract(g);return new p(Math.atan2(s.y,s.x))},p.FromRadians=function(g){return new p(g)},p.FromDegrees=function(g){return new p(g*Math.PI/180)},p}(),oa=function(){return function(p,g,n){this.startPoint=p,this.midPoint=g,this.endPoint=n;var s=Math.pow(g.x,2)+Math.pow(g.y,2),t=(Math.pow(p.x,2)+Math.pow(p.y,2)-s)/2,C=(s-Math.pow(n.x,2)-Math.pow(n.y,2))/2,J=(p.x-g.x)*(g.y-n.y)-(g.x-n.x)*(p.y-g.y);this.centerPoint=new u((t*(g.y-n.y)-C*(p.y-g.y))/J,((p.x-g.x)*C-(g.x-n.x)*t)/J),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=ca.BetweenTwoPoints(this.centerPoint,this.startPoint);var Q=this.startAngle.degrees(),$=ca.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),aa=ca.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();$-Q>180&&($-=360),$-Q<-180&&($+=360),aa-$>180&&(aa-=360),aa-$<-180&&(aa+=360),this.orientation=$-Q<0?Y.CW:Y.CCW,this.angle=ca.FromDegrees(this.orientation===Y.CW?Q-aa:aa-Q)}}(),Z=function(){function p(g,n){this._points=new Array(),this._length=0,this.closed=!1,this._points.push(new u(g,n))}return p.prototype.addLineTo=function(g,n){if(this.closed)return this;var s=new u(g,n),t=this._points[this._points.length-1];return this._points.push(s),this._length+=s.subtract(t).length(),this},p.prototype.addArcTo=function(g,n,s,t,C){if(void 0===C&&(C=36),this.closed)return this;var J=this._points[this._points.length-1],Q=new u(g,n),$=new u(s,t),aa=new oa(J,Q,$),ba=aa.angle.radians()/C;aa.orientation===Y.CW&&(ba*=-1);for(var ia=aa.startAngle.radians()+ba,qa=0;qa<C;qa++){var ja=Math.cos(ia)*aa.radius+aa.centerPoint.x,sa=Math.sin(ia)*aa.radius+aa.centerPoint.y;this.addLineTo(ja,sa),ia+=ba}return this},p.prototype.close=function(){return this.closed=!0,this},p.prototype.length=function(){var g=this._length;if(!this.closed){var n=this._points[this._points.length-1];g+=this._points[0].subtract(n).length()}return g},p.prototype.getPoints=function(){return this._points},p.prototype.getPointAtLengthPosition=function(g){if(g<0||g>1)return u.Zero();for(var n=g*this.length(),s=0,t=0;t<this._points.length;t++){var C=(t+1)%this._points.length,J=this._points[t],Q=this._points[C].subtract(J),$=Q.length()+s;if(n>=s&&n<=$){var aa=Q.normalize(),ba=n-s;return new u(J.x+aa.x*ba,J.y+aa.y*ba)}s=$}return u.Zero()},p.StartingAt=function(g,n){return new p(g,n)},p}(),T=function(){function p(g,n,s){void 0===n&&(n=null),this.path=g,this._curve=new Array(),this._distances=new Array(),this._tangents=new Array(),this._normals=new Array(),this._binormals=new Array();for(var t=0;t<g.length;t++)this._curve[t]=g[t].clone();this._raw=s||!1,this._compute(n)}return p.prototype.getCurve=function(){return this._curve},p.prototype.getTangents=function(){return this._tangents},p.prototype.getNormals=function(){return this._normals},p.prototype.getBinormals=function(){return this._binormals},p.prototype.getDistances=function(){return this._distances},p.prototype.update=function(g,n){void 0===n&&(n=null);for(var s=0;s<g.length;s++)this._curve[s].x=g[s].x,this._curve[s].y=g[s].y,this._curve[s].z=g[s].z;return this._compute(n),this},p.prototype._compute=function(g){var n=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[n-1]=this._curve[n-1].subtract(this._curve[n-2]),this._raw||this._tangents[n-1].normalize();var s,t,C,J,Q=this._tangents[0],$=this._normalVector(Q,g);this._normals[0]=$,this._raw||this._normals[0].normalize(),this._binormals[0]=w.Cross(Q,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var aa=1;aa<n;aa++)s=this._getLastNonNullVector(aa),aa<n-1&&(t=this._getFirstNonNullVector(aa),this._tangents[aa]=s.add(t),this._tangents[aa].normalize()),this._distances[aa]=this._distances[aa-1]+s.length(),C=this._tangents[aa],J=this._binormals[aa-1],this._normals[aa]=w.Cross(J,C),this._raw||this._normals[aa].normalize(),this._binormals[aa]=w.Cross(C,this._normals[aa]),this._raw||this._binormals[aa].normalize()},p.prototype._getFirstNonNullVector=function(g){for(var n=1,s=this._curve[g+n].subtract(this._curve[g]);0===s.length()&&g+n+1<this._curve.length;)n++,s=this._curve[g+n].subtract(this._curve[g]);return s},p.prototype._getLastNonNullVector=function(g){for(var n=1,s=this._curve[g].subtract(this._curve[g-n]);0===s.length()&&g>n+1;)n++,s=this._curve[g].subtract(this._curve[g-n]);return s},p.prototype._normalVector=function(g,n){var s,t,C=g.length();return(0===C&&(C=1),null==n)?(t=j.a.WithinEpsilon(Math.abs(g.y)/C,1,A)?j.a.WithinEpsilon(Math.abs(g.x)/C,1,A)?j.a.WithinEpsilon(Math.abs(g.z)/C,1,A)?w.Zero():new w(0,0,1):new w(1,0,0):new w(0,-1,0),s=w.Cross(g,t)):(s=w.Cross(g,n),w.CrossToRef(s,g,s)),s.normalize(),s},p}(),V=function(){function p(g){this._length=0,this._points=g,this._length=this._computeLength(g)}return p.CreateQuadraticBezier=function(g,n,s,t){t=t>2?t:3;for(var C=new Array(),J=function($,aa,ba,ia){return(1-$)*(1-$)*aa+2*$*(1-$)*ba+$*$*ia},Q=0;Q<=t;Q++)C.push(new w(J(Q/t,g.x,n.x,s.x),J(Q/t,g.y,n.y,s.y),J(Q/t,g.z,n.z,s.z)));return new p(C)},p.CreateCubicBezier=function(g,n,s,t,C){C=C>3?C:4;for(var J=new Array(),Q=function(aa,ba,ia,qa,ja){return(1-aa)*(1-aa)*(1-aa)*ba+3*aa*(1-aa)*(1-aa)*ia+3*aa*aa*(1-aa)*qa+aa*aa*aa*ja},$=0;$<=C;$++)J.push(new w(Q($/C,g.x,n.x,s.x,t.x),Q($/C,g.y,n.y,s.y,t.y),Q($/C,g.z,n.z,s.z,t.z)));return new p(J)},p.CreateHermiteSpline=function(g,n,s,t,C){for(var J=new Array(),Q=1/C,$=0;$<=C;$++)J.push(w.Hermite(g,n,s,t,$*Q));return new p(J)},p.CreateCatmullRomSpline=function(g,n,s){var t=new Array(),C=1/n,J=0;if(s){for(var Q=g.length,$=0;$<Q;$++){J=0;for(var aa=0;aa<n;aa++)t.push(w.CatmullRom(g[$%Q],g[($+1)%Q],g[($+2)%Q],g[($+3)%Q],J)),J+=C}t.push(t[0])}else{var ba=new Array();for(ba.push(g[0].clone()),Array.prototype.push.apply(ba,g),ba.push(g[g.length-1].clone()),$=0;$<ba.length-3;$++)for(J=0,aa=0;aa<n;aa++)t.push(w.CatmullRom(ba[$],ba[$+1],ba[$+2],ba[$+3],J)),J+=C;$--,t.push(w.CatmullRom(ba[$],ba[$+1],ba[$+2],ba[$+3],J))}return new p(t)},p.prototype.getPoints=function(){return this._points},p.prototype.length=function(){return this._length},p.prototype.continue=function(g){for(var n=this._points[this._points.length-1],s=this._points.slice(),t=g.getPoints(),C=1;C<t.length;C++)s.push(t[C].subtract(t[0]).add(n));return new p(s)},p.prototype._computeLength=function(g){for(var n=0,s=1;s<g.length;s++)n+=g[s].subtract(g[s-1]).length();return n},p}(),D=function(){function p(g,n){void 0===g&&(g=w.Zero()),void 0===n&&(n=w.Up()),this.position=g,this.normal=n}return p.prototype.clone=function(){return new p(this.position.clone(),this.normal.clone())},p}(),F=function(){function p(g,n,s){void 0===g&&(g=w.Zero()),void 0===n&&(n=w.Up()),void 0===s&&(s=u.Zero()),this.position=g,this.normal=n,this.uv=s}return p.prototype.clone=function(){return new p(this.position.clone(),this.normal.clone(),this.uv.clone())},p}(),L=function(){function p(){}return p.Color3=q.a.BuildArray(3,v.Black),p.Color4=q.a.BuildArray(3,function(){return new z(0,0,0,0)}),p.Vector2=q.a.BuildArray(3,u.Zero),p.Vector3=q.a.BuildArray(13,w.Zero),p.Vector4=q.a.BuildArray(3,y.Zero),p.Quaternion=q.a.BuildArray(2,o.Zero),p.Matrix=q.a.BuildArray(8,G.Identity),p}(),N=function(){function p(){}return p.Vector3=q.a.BuildArray(6,w.Zero),p.Matrix=q.a.BuildArray(2,G.Identity),p.Quaternion=q.a.BuildArray(3,o.Zero),p}()},function(Aa,x,l){"use strict";l.d(x,"d",function(){return q}),l.d(x,"a",function(){return j}),l.d(x,"c",function(){return I}),l.d(x,"b",function(){return H}),l.d(x,"e",function(){return A});var O=function(v,z){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,w){u.__proto__=w}||function(u,w){for(var y in w)w.hasOwnProperty(y)&&(u[y]=w[y])})(v,z)};function q(v,z){function u(){this.constructor=v}O(v,z),v.prototype=null===z?Object.create(z):(u.prototype=z.prototype,new u())}var j=function(){return(j=Object.assign||function(v){for(var z,u=1,w=arguments.length;u<w;u++)for(var y in z=arguments[u])Object.prototype.hasOwnProperty.call(z,y)&&(v[y]=z[y]);return v}).apply(this,arguments)};function I(v,z,u,w){var y,r=arguments.length,o=r<3?z:null===w?w=Object.getOwnPropertyDescriptor(z,u):w;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(v,z,u,w);else for(var G=v.length-1;G>=0;G--)(y=v[G])&&(o=(r<3?y(o):r>3?y(z,u,o):y(z,u))||o);return r>3&&o&&Object.defineProperty(z,u,o),o}function H(v,z,u,w){return new(u||(u=Promise))(function(y,r){function o(R){try{M(w.next(R))}catch(W){r(W)}}function G(R){try{M(w.throw(R))}catch(W){r(W)}}function M(R){R.done?y(R.value):new u(function(W){W(R.value)}).then(o,G)}M((w=w.apply(v,z||[])).next())})}function A(v,z){var u,w,y,r,o={label:0,sent:function(){if(1&y[0])throw y[1];return y[1]},trys:[],ops:[]};return r={next:G(0),throw:G(1),return:G(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function G(M){return function(R){return function(W){if(u)throw new TypeError("Generator is already executing.");for(;o;)try{if(u=1,w&&(y=2&W[0]?w.return:W[0]?w.throw||((y=w.return)&&y.call(w),0):w.next)&&!(y=y.call(w,W[1])).done)return y;switch(w=0,y&&(W=[2&W[0],y.value]),W[0]){case 0:case 1:y=W;break;case 4:return o.label++,{value:W[1],done:!1};case 5:o.label++,w=W[1],W=[0];continue;case 7:W=o.ops.pop(),o.trys.pop();continue;default:if(!(y=(y=o.trys).length>0&&y[y.length-1])&&(6===W[0]||2===W[0])){o=0;continue}if(3===W[0]&&(!y||W[1]>y[0]&&W[1]<y[3])){o.label=W[1];break}if(6===W[0]&&o.label<y[1]){o.label=y[1],y=W;break}if(y&&o.label<y[2]){o.label=y[2],o.ops.push(W);break}y[2]&&o.ops.pop(),o.trys.pop();continue}W=z.call(v,o)}catch(Y){W=[6,Y],w=0}finally{u=y=0}if(5&W[0])throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}([M,R])}}}},function(Aa,x,l){"use strict";l.d(x,"b",function(){return u}),l.d(x,"c",function(){return w}),l.d(x,"m",function(){return y}),l.d(x,"e",function(){return r}),l.d(x,"h",function(){return o}),l.d(x,"n",function(){return G}),l.d(x,"o",function(){return M}),l.d(x,"k",function(){return R}),l.d(x,"g",function(){return W}),l.d(x,"f",function(){return Y}),l.d(x,"i",function(){return X}),l.d(x,"l",function(){return ea}),l.d(x,"j",function(){return ca}),l.d(x,"d",function(){return oa}),l.d(x,"a",function(){return Z});var O=l(29),q=l(0),j=l(19),I={},H={},A=function(T,V,D){var F=T();O.a&&O.a.AddTagsTo(F,V.tags);var L=v(F);for(var N in L){var p=L[N],g=V[N],n=p.type;if(null!=g&&"uniqueId"!==N)switch(n){case 0:case 6:case 11:F[N]=g;break;case 1:F[N]=D||g.isRenderTarget?g:g.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:F[N]=D?g:g.clone()}}return F};function v(T){var V=T.getClassName();if(H[V])return H[V];H[V]={};for(var D=H[V],F=T,L=V;L;){var N=I[L];for(var p in N)D[p]=N[p];var g,n=!1;do{if(!(g=Object.getPrototypeOf(F)).getClassName){n=!0;break}if(g.getClassName()!==L)break;F=g}while(g);if(n)break;L=g.getClassName(),F=g}return D}function z(T,V){return function(D,F){var L=function(N){var p=N.getClassName();return I[p]||(I[p]={}),I[p]}(D);L[F]||(L[F]={type:T,sourceName:V})}}function u(T,V){return void 0===V&&(V=null),function(D,F){return void 0===F&&(F=null),function(L,N){var p=F||"_"+N;Object.defineProperty(L,N,{get:function(){return this[p]},set:function(g){this[p]!==g&&(this[p]=g,L[D].apply(this))},enumerable:!0,configurable:!0})}}(T,V)}function w(T){return z(0,T)}function y(T){return z(1,T)}function r(T){return z(2,T)}function o(T){return z(3,T)}function G(T){return z(4,T)}function M(T){return z(5,T)}function R(T){return z(6,T)}function W(T){return z(7,T)}function Y(T){return z(8,T)}function X(T){return z(9,T)}function ea(T){return z(10,T)}function ca(T){return z(12,T)}function oa(T){return z(11,T)}var Z=function(){function T(){}return T.AppendSerializedAnimations=function(V,D){if(V.animations){D.animations=[];for(var F=0;F<V.animations.length;F++){var L=V.animations[F];D.animations.push(L.serialize())}}},T.Serialize=function(V,D){D||(D={}),O.a&&(D.tags=O.a.GetTags(V));var F=v(V);for(var L in F){var N=F[L],p=N.sourceName||L,g=N.type,n=V[L];if(null!=n)switch(g){case 0:D[p]=n;break;case 1:D[p]=n.serialize();break;case 2:D[p]=n.asArray();break;case 3:D[p]=n.serialize();break;case 4:case 5:D[p]=n.asArray();break;case 6:D[p]=n.id;break;case 7:D[p]=n.serialize();break;case 8:D[p]=n.asArray();break;case 9:D[p]=n.serialize();break;case 10:D[p]=n.asArray();break;case 11:D[p]=n.id;case 12:D[p]=n.asArray()}}return D},T.Parse=function(V,D,F,L){void 0===L&&(L=null);var N=V();L||(L=""),O.a&&O.a.AddTagsTo(N,D.tags);var p=v(N);for(var g in p){var n=p[g],s=D[n.sourceName||g],t=n.type;if(null!=s){var C=N;switch(t){case 0:C[g]=s;break;case 1:F&&(C[g]=T._TextureParser(s,F,L));break;case 2:C[g]=q.e.FromArray(s);break;case 3:C[g]=T._FresnelParametersParser(s);break;case 4:C[g]=q.w.FromArray(s);break;case 5:C[g]=q.x.FromArray(s);break;case 6:F&&(C[g]=F.getLastMeshByID(s));break;case 7:C[g]=T._ColorCurvesParser(s);break;case 8:C[g]=q.f.FromArray(s);break;case 9:C[g]=T._ImageProcessingConfigurationParser(s);break;case 10:C[g]=q.q.FromArray(s);break;case 11:F&&(C[g]=F.getCameraByID(s));case 12:C[g]=q.j.FromArray(s)}}}return N},T.Clone=function(V,D){return A(V,D,!1)},T.Instanciate=function(V,D){return A(V,D,!0)},T._ImageProcessingConfigurationParser=function(V){throw j.a.WarnImport("ImageProcessingConfiguration")},T._FresnelParametersParser=function(V){throw j.a.WarnImport("FresnelParameters")},T._ColorCurvesParser=function(V){throw j.a.WarnImport("ColorCurves")},T._TextureParser=function(V,D,F){throw j.a.WarnImport("Texture")},T}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return q.ALPHA_DISABLE=0,q.ALPHA_ADD=1,q.ALPHA_COMBINE=2,q.ALPHA_SUBTRACT=3,q.ALPHA_MULTIPLY=4,q.ALPHA_MAXIMIZED=5,q.ALPHA_ONEONE=6,q.ALPHA_PREMULTIPLIED=7,q.ALPHA_PREMULTIPLIED_PORTERDUFF=8,q.ALPHA_INTERPOLATE=9,q.ALPHA_SCREENMODE=10,q.DELAYLOADSTATE_NONE=0,q.DELAYLOADSTATE_LOADED=1,q.DELAYLOADSTATE_LOADING=2,q.DELAYLOADSTATE_NOTLOADED=4,q.NEVER=512,q.ALWAYS=519,q.LESS=513,q.EQUAL=514,q.LEQUAL=515,q.GREATER=516,q.GEQUAL=518,q.NOTEQUAL=517,q.KEEP=7680,q.REPLACE=7681,q.INCR=7682,q.DECR=7683,q.INVERT=5386,q.INCR_WRAP=34055,q.DECR_WRAP=34056,q.TEXTURE_CLAMP_ADDRESSMODE=0,q.TEXTURE_WRAP_ADDRESSMODE=1,q.TEXTURE_MIRROR_ADDRESSMODE=2,q.TEXTUREFORMAT_ALPHA=0,q.TEXTUREFORMAT_LUMINANCE=1,q.TEXTUREFORMAT_LUMINANCE_ALPHA=2,q.TEXTUREFORMAT_RGB=4,q.TEXTUREFORMAT_RGBA=5,q.TEXTUREFORMAT_RED=6,q.TEXTUREFORMAT_R=6,q.TEXTUREFORMAT_RG=7,q.TEXTUREFORMAT_RED_INTEGER=8,q.TEXTUREFORMAT_R_INTEGER=8,q.TEXTUREFORMAT_RG_INTEGER=9,q.TEXTUREFORMAT_RGB_INTEGER=10,q.TEXTUREFORMAT_RGBA_INTEGER=11,q.TEXTURETYPE_UNSIGNED_BYTE=0,q.TEXTURETYPE_UNSIGNED_INT=0,q.TEXTURETYPE_FLOAT=1,q.TEXTURETYPE_HALF_FLOAT=2,q.TEXTURETYPE_BYTE=3,q.TEXTURETYPE_SHORT=4,q.TEXTURETYPE_UNSIGNED_SHORT=5,q.TEXTURETYPE_INT=6,q.TEXTURETYPE_UNSIGNED_INTEGER=7,q.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,q.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,q.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,q.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,q.TEXTURETYPE_UNSIGNED_INT_24_8=12,q.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,q.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,q.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,q.TEXTURE_NEAREST_SAMPLINGMODE=1,q.TEXTURE_BILINEAR_SAMPLINGMODE=2,q.TEXTURE_TRILINEAR_SAMPLINGMODE=3,q.TEXTURE_NEAREST_NEAREST_MIPLINEAR=1,q.TEXTURE_LINEAR_LINEAR_MIPNEAREST=2,q.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,q.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,q.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,q.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,q.TEXTURE_NEAREST_LINEAR=7,q.TEXTURE_NEAREST_NEAREST=8,q.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,q.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,q.TEXTURE_LINEAR_LINEAR=11,q.TEXTURE_LINEAR_NEAREST=12,q.TEXTURE_EXPLICIT_MODE=0,q.TEXTURE_SPHERICAL_MODE=1,q.TEXTURE_PLANAR_MODE=2,q.TEXTURE_CUBIC_MODE=3,q.TEXTURE_PROJECTION_MODE=4,q.TEXTURE_SKYBOX_MODE=5,q.TEXTURE_INVCUBIC_MODE=6,q.TEXTURE_EQUIRECTANGULAR_MODE=7,q.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,q.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,q.SCALEMODE_FLOOR=1,q.SCALEMODE_NEAREST=2,q.SCALEMODE_CEILING=3,q.MATERIAL_TextureDirtyFlag=1,q.MATERIAL_LightDirtyFlag=2,q.MATERIAL_FresnelDirtyFlag=4,q.MATERIAL_AttributesDirtyFlag=8,q.MATERIAL_MiscDirtyFlag=16,q.MATERIAL_AllDirtyFlag=31,q.MATERIAL_TriangleFillMode=0,q.MATERIAL_WireFrameFillMode=1,q.MATERIAL_PointFillMode=2,q.MATERIAL_PointListDrawMode=3,q.MATERIAL_LineListDrawMode=4,q.MATERIAL_LineLoopDrawMode=5,q.MATERIAL_LineStripDrawMode=6,q.MATERIAL_TriangleStripDrawMode=7,q.MATERIAL_TriangleFanDrawMode=8,q.MATERIAL_ClockWiseSideOrientation=0,q.MATERIAL_CounterClockWiseSideOrientation=1,q.ACTION_NothingTrigger=0,q.ACTION_OnPickTrigger=1,q.ACTION_OnLeftPickTrigger=2,q.ACTION_OnRightPickTrigger=3,q.ACTION_OnCenterPickTrigger=4,q.ACTION_OnPickDownTrigger=5,q.ACTION_OnDoublePickTrigger=6,q.ACTION_OnPickUpTrigger=7,q.ACTION_OnPickOutTrigger=16,q.ACTION_OnLongPressTrigger=8,q.ACTION_OnPointerOverTrigger=9,q.ACTION_OnPointerOutTrigger=10,q.ACTION_OnEveryFrameTrigger=11,q.ACTION_OnIntersectionEnterTrigger=12,q.ACTION_OnIntersectionExitTrigger=13,q.ACTION_OnKeyDownTrigger=14,q.ACTION_OnKeyUpTrigger=15,q.PARTICLES_BILLBOARDMODE_Y=2,q.PARTICLES_BILLBOARDMODE_ALL=7,q.PARTICLES_BILLBOARDMODE_STRETCHED=8,q.PARTICLES_BaseAssetsUrl="https://assets.babylonjs.com/particles",q.MESHES_CULLINGSTRATEGY_STANDARD=0,q.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,q.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,q.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,q.SCENELOADER_NO_LOGGING=0,q.SCENELOADER_MINIMAL_LOGGING=1,q.SCENELOADER_SUMMARY_LOGGING=2,q.SCENELOADER_DETAILED_LOGGING=3,q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O}),l.d(x,"b",function(){return q});var O=function(){function j(I,H,A,v,z,u,w){void 0===v&&(v=0),void 0===z&&(z=!1),void 0===u&&(u=!1),void 0===w&&(w=!1),I.getScene?this._engine=I.getScene().getEngine():this._engine=I,this._updatable=A,this._instanced=u,this._data=H,this.byteStride=w?v:v*Float32Array.BYTES_PER_ELEMENT,z||this.create()}return j.prototype.createVertexBuffer=function(I,H,A,v,z,u){void 0===u&&(u=!1);var w=u?H:H*Float32Array.BYTES_PER_ELEMENT,y=v?u?v:v*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new q(this._engine,this,I,this._updatable,!0,y,void 0===z?this._instanced:z,w,A,void 0,void 0,!0)},j.prototype.isUpdatable=function(){return this._updatable},j.prototype.getData=function(){return this._data},j.prototype.getBuffer=function(){return this._buffer},j.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},j.prototype.create=function(I){void 0===I&&(I=null),!I&&this._buffer||(I=I||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,I),this._data=I):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(I),this._data=I):this._buffer=this._engine.createVertexBuffer(I))},j.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},j.prototype.update=function(I){this.create(I)},j.prototype.updateDirectly=function(I,H,A,v){void 0===v&&(v=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,I,v?H:H*Float32Array.BYTES_PER_ELEMENT,A?A*this.byteStride:void 0),this._data=null)},j.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},j}(),q=function(){function j(I,H,A,v,z,u,w,y,r,o,G,M){if(void 0===G&&(G=!1),void 0===M&&(M=!1),H instanceof O?(this._buffer=H,this._ownsBuffer=!1):(this._buffer=new O(I,H,v,u,z,w,M),this._ownsBuffer=!0),this._kind=A,null==o){var R=this.getData();this.type=j.FLOAT,R instanceof Int8Array?this.type=j.BYTE:R instanceof Uint8Array?this.type=j.UNSIGNED_BYTE:R instanceof Int16Array?this.type=j.SHORT:R instanceof Uint16Array?this.type=j.UNSIGNED_SHORT:R instanceof Int32Array?this.type=j.INT:R instanceof Uint32Array&&(this.type=j.UNSIGNED_INT)}else this.type=o;var W=j.GetTypeByteLength(this.type);M?(this._size=r||(u?u/W:j.DeduceStride(A)),this.byteStride=u||this._buffer.byteStride||this._size*W,this.byteOffset=y||0):(this._size=r||u||j.DeduceStride(A),this.byteStride=u?u*W:this._buffer.byteStride||this._size*W,this.byteOffset=(y||0)*W),this.normalized=G,this._instanced=void 0!==w&&w,this._instanceDivisor=w?1:0}return Object.defineProperty(j.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(I){this._instanceDivisor=I,this._instanced=0!=I},enumerable:!0,configurable:!0}),j.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},j.prototype.getKind=function(){return this._kind},j.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},j.prototype.getData=function(){return this._buffer.getData()},j.prototype.getBuffer=function(){return this._buffer.getBuffer()},j.prototype.getStrideSize=function(){return this.byteStride/j.GetTypeByteLength(this.type)},j.prototype.getOffset=function(){return this.byteOffset/j.GetTypeByteLength(this.type)},j.prototype.getSize=function(){return this._size},j.prototype.getIsInstanced=function(){return this._instanced},j.prototype.getInstanceDivisor=function(){return this._instanceDivisor},j.prototype.create=function(I){this._buffer.create(I)},j.prototype.update=function(I){this._buffer.update(I)},j.prototype.updateDirectly=function(I,H,A){void 0===A&&(A=!1),this._buffer.updateDirectly(I,H,void 0,A)},j.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},j.prototype.forEach=function(I,H){j.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,I,this.normalized,H)},j.DeduceStride=function(I){switch(I){case j.UVKind:case j.UV2Kind:case j.UV3Kind:case j.UV4Kind:case j.UV5Kind:case j.UV6Kind:return 2;case j.NormalKind:case j.PositionKind:return 3;case j.ColorKind:case j.MatricesIndicesKind:case j.MatricesIndicesExtraKind:case j.MatricesWeightsKind:case j.MatricesWeightsExtraKind:case j.TangentKind:return 4;default:throw new Error("Invalid kind '"+I+"'")}},j.GetTypeByteLength=function(I){switch(I){case j.BYTE:case j.UNSIGNED_BYTE:return 1;case j.SHORT:case j.UNSIGNED_SHORT:return 2;case j.INT:case j.FLOAT:return 4;default:throw new Error("Invalid type '"+I+"'")}},j.ForEach=function(I,H,A,v,z,u,w,y){if(I instanceof Array)for(var r=H/4,o=A/4,G=0;G<u;G+=v){for(var M=0;M<v;M++)y(I[r+M],G+M);r+=o}else{var R=I instanceof ArrayBuffer?new DataView(I):new DataView(I.buffer,I.byteOffset,I.byteLength),W=j.GetTypeByteLength(z);for(G=0;G<u;G+=v){var Y=H;for(M=0;M<v;M++)y(j._GetFloatValue(R,z,Y,w),G+M),Y+=W;H+=A}}},j._GetFloatValue=function(I,H,A,v){switch(H){case j.BYTE:var z=I.getInt8(A);return v&&(z=Math.max(z/127,-1)),z;case j.UNSIGNED_BYTE:return z=I.getUint8(A),v&&(z/=255),z;case j.SHORT:return z=I.getInt16(A,!0),v&&(z=Math.max(z/16383,-1)),z;case j.UNSIGNED_SHORT:return z=I.getUint16(A,!0),v&&(z/=65535),z;case j.FLOAT:return I.getFloat32(A,!0);default:throw new Error("Invalid component type "+H)}},j.BYTE=5120,j.UNSIGNED_BYTE=5121,j.SHORT=5122,j.UNSIGNED_SHORT=5123,j.INT=5124,j.UNSIGNED_INT=5125,j.FLOAT=5126,j.PositionKind="position",j.NormalKind="normal",j.TangentKind="tangent",j.UVKind="uv",j.UV2Kind="uv2",j.UV3Kind="uv3",j.UV4Kind="uv4",j.UV5Kind="uv5",j.UV6Kind="uv6",j.ColorKind="color",j.MatricesIndicesKind="matricesIndices",j.MatricesWeightsKind="matricesWeights",j.MatricesIndicesExtraKind="matricesIndicesExtra",j.MatricesWeightsExtraKind="matricesWeightsExtra",j}()},function(Aa,x,l){"use strict";l.d(x,"c",function(){return H}),l.d(x,"b",function(){return A}),l.d(x,"a",function(){return v});var O=l(8),q=l(3),j=l(35),I=l(6),H=function(){function z(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return z.prototype.unBindMesh=function(){this._mesh=null},z.prototype.addFallback=function(u,w){this._defines[u]||(u<this._currentRank&&(this._currentRank=u),u>this._maxRank&&(this._maxRank=u),this._defines[u]=new Array()),this._defines[u].push(w)},z.prototype.addCPUSkinningFallback=function(u,w){this._mesh=w,u<this._currentRank&&(this._currentRank=u),u>this._maxRank&&(this._maxRank=u)},Object.defineProperty(z.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),z.prototype.reduce=function(u,w){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0&&this._mesh.material){this._mesh.computeBonesUsingShaders=!1,u=u.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),w._bonesComputationForcedToCPU=!0;for(var y=this._mesh.getScene(),r=0;r<y.meshes.length;r++){var o=y.meshes[r];if(o.material&&(o.computeBonesUsingShaders&&0!==o.numBoneInfluencers)){if(o.material.getEffect()===w)o.computeBonesUsingShaders=!1;else if(o.subMeshes){for(var G=0,M=o.subMeshes;G<M.length;G++)if(M[G].effect===w){o.computeBonesUsingShaders=!1;break}}}}}else{var R=this._defines[this._currentRank];if(R)for(r=0;r<R.length;r++)u=u.replace("#define "+R[r],"");this._currentRank++}return u},z}(),A=function(){return function(){}}(),v=function(){function z(u,w,y,r,o,G,M,R,W,Y){var X,ea,ca=this;if(void 0===r&&(r=null),void 0===G&&(G=null),void 0===M&&(M=null),void 0===R&&(R=null),void 0===W&&(W=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new O.c(),this.onErrorObservable=new O.c(),this._onBindObservable=null,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._valueCache={},this.name=u,w.attributes){var oa=w;if(this._engine=y,this._attributesNames=oa.attributes,this._uniformsNames=oa.uniformsNames.concat(oa.samplers),this._samplerList=oa.samplers.slice(),this.defines=oa.defines,this.onError=oa.onError,this.onCompiled=oa.onCompiled,this._fallbacks=oa.fallbacks,this._indexParameters=oa.indexParameters,this._transformFeedbackVaryings=oa.transformFeedbackVaryings,oa.uniformBuffersNames)for(var Z=0;Z<oa.uniformBuffersNames.length;Z++)this._uniformBuffersNames[oa.uniformBuffersNames[Z]]=Z}else this._engine=o,this.defines=null==G?"":G,this._uniformsNames=y.concat(r),this._samplerList=r?r.slice():[],this._attributesNames=w,this.onError=W,this.onCompiled=R,this._indexParameters=Y,this._fallbacks=M;this.uniqueId=z._uniqueIdSeed++,u.vertexElement?(X=document.getElementById(u.vertexElement))||(X=u.vertexElement):X=u.vertex||u,u.fragmentElement?(ea=document.getElementById(u.fragmentElement))||(ea=u.fragmentElement):ea=u.fragment||u,this._loadVertexShader(X,function(T){ca._processIncludes(T,function(V){ca._processShaderConversion(V,!1,function(D){ca._loadFragmentShader(ea,function(F){ca._processIncludes(F,function(L){ca._processShaderConversion(L,!0,function(N){if(u){var p=u.vertexElement||u.vertex||u,g=u.fragmentElement||u.fragment||u;ca._vertexSourceCode="#define SHADER_NAME vertex:"+p+`
`+D,ca._fragmentSourceCode="#define SHADER_NAME fragment:"+g+`
`+N}else ca._vertexSourceCode=D,ca._fragmentSourceCode=N;ca._prepareEffect()})})})})})})}return Object.defineProperty(z.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new O.c()),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),z.prototype.isReady=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},z.prototype.getEngine=function(){return this._engine},z.prototype.getPipelineContext=function(){return this._pipelineContext},z.prototype.getAttributesNames=function(){return this._attributesNames},z.prototype.getAttributeLocation=function(u){return this._attributes[u]},z.prototype.getAttributeLocationByName=function(u){var w=this._attributesNames.indexOf(u);return this._attributes[w]},z.prototype.getAttributesCount=function(){return this._attributes.length},z.prototype.getUniformIndex=function(u){return this._uniformsNames.indexOf(u)},z.prototype.getUniform=function(u){return this._uniforms[u]},z.prototype.getSamplers=function(){return this._samplerList},z.prototype.getCompilationError=function(){return this._compilationError},z.prototype.executeWhenCompiled=function(u){var w=this;this.isReady()?u(this):(this.onCompileObservable.add(function(y){u(y)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){w._checkIsReady()},16))},z.prototype._checkIsReady=function(){var u=this;this.isReady()||setTimeout(function(){u._checkIsReady()},16)},z.prototype._loadVertexShader=function(u,w){var y;if(j.a.IsWindowObjectExist()&&u instanceof HTMLElement)return void w(j.a.GetDOMTextContent(u));"base64:"!==u.substr(0,7)?z.ShadersStore[u+"VertexShader"]?w(z.ShadersStore[u+"VertexShader"]):(y="."===u[0]||"/"===u[0]||u.indexOf("http")>-1?u:z.ShadersRepository+u,this._engine._loadFile(y+".vertex.fx",w)):w(window.atob(u.substr(7)))},z.prototype._loadFragmentShader=function(u,w){var y;if(j.a.IsWindowObjectExist()&&u instanceof HTMLElement)return void w(j.a.GetDOMTextContent(u));"base64:"!==u.substr(0,7)?z.ShadersStore[u+"PixelShader"]?w(z.ShadersStore[u+"PixelShader"]):z.ShadersStore[u+"FragmentShader"]?w(z.ShadersStore[u+"FragmentShader"]):(y="."===u[0]||"/"===u[0]||u.indexOf("http")>-1?u:z.ShadersRepository+u,this._engine._loadFile(y+".fragment.fx",w)):w(window.atob(u.substr(7)))},z.prototype._dumpShadersSource=function(u,w,y){var r=(this._engine.webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"")+(y?y+`
`:"");w=r+w;var o=2,G=/\n/gm,M=`
1	`+(u=r+u).replace(G,function(){return`
`+o+++"	"});o=2;var R=`
1	`+w.replace(G,function(){return`
`+o+++"	"});this.name.vertexElement?(I.a.Error("Vertex shader: "+this.name.vertexElement+M),I.a.Error("Fragment shader: "+this.name.fragmentElement+R)):this.name.vertex?(I.a.Error("Vertex shader: "+this.name.vertex+M),I.a.Error("Fragment shader: "+this.name.fragment+R)):(I.a.Error("Vertex shader: "+this.name+M),I.a.Error("Fragment shader: "+this.name+R))},z.prototype._processShaderConversion=function(u,w,y){var r=this._processPrecision(u);if(1!=this._engine.webGLVersion)if(-1===r.indexOf("#version 3")){var o=-1!==r.search(/#extension.+GL_EXT_draw_buffers.+require/),G=r.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"");G=(G=(G=(G=G.replace(/varying(?![\n\r])\s/g,w?"in ":"out ")).replace(/attribute[ \t]/g,"in ")).replace(/[ \t]attribute/g," in")).replace(/texture2D\s*\(/g,"texture("),w&&(G=(G=(G=(G=(G=(G=(G=G.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(o?"":`out vec4 glFragColor;
`)+"void main(")),-1!==this.defines.indexOf(`#define MULTIVIEW
`)&&!w&&(G=`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+G),y(G)}else y(r.replace("#version 300 es",""));else y(r)},z.prototype._processIncludes=function(u,w){for(var y=this,r=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=r.exec(u),G=new String(u);null!=o;){var M=o[1];if(-1!==M.indexOf("__decl__")&&(M=M.replace(/__decl__/,""),this._engine.supportsUniformBuffers&&(M=(M=M.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),M+="Declaration"),!z.IncludesShadersStore[M]){var R=z.ShadersRepository+"ShadersInclude/"+M+".fx";return void this._engine._loadFile(R,function(L){z.IncludesShadersStore[M]=L,y._processIncludes(G,w)})}var W=z.IncludesShadersStore[M];if(o[2])for(var Y=o[3].split(","),X=0;X<Y.length;X+=2){var ea=new RegExp(Y[X],"g"),ca=Y[X+1];W=W.replace(ea,ca)}if(o[4]){var oa=o[5];if(-1!==oa.indexOf("..")){var Z=oa.split(".."),T=parseInt(Z[0]),V=parseInt(Z[1]),D=W.slice(0);W="",isNaN(V)&&(V=this._indexParameters[Z[1]]);for(var F=T;F<V;F++)this._engine.supportsUniformBuffers||(D=D.replace(/light\{X\}.(\w*)/g,function(L,N){return N+"{X}"})),W+=D.replace(/\{X\}/g,F.toString())+`
`}else this._engine.supportsUniformBuffers||(W=W.replace(/light\{X\}.(\w*)/g,function(L,N){return N+"{X}"})),W=W.replace(/\{X\}/g,oa)}G=G.replace(o[0],W),o=r.exec(u)}w(G)},z.prototype._processPrecision=function(u){var w=this._engine._shouldUseHighPrecisionShader;return-1===u.indexOf("precision highp float")?u=w?`precision highp float;
`+u:`precision mediump float;
`+u:w||(u=u.replace("precision highp float","precision mediump float")),u},z.prototype._rebuildProgram=function(u,w,y,r){var o=this;this._isReady=!1,this._vertexSourceCodeOverride=u,this._fragmentSourceCodeOverride=w,this.onError=function(G,M){r&&r(M)},this.onCompiled=function(){for(var G=o.getEngine().scenes,M=0;M<G.length;M++)G[M].markAllMaterialsAsDirty(q.a.MATERIAL_AllDirtyFlag);o._pipelineContext._handlesSpectorRebuildCallback(y)},this._fallbacks=null,this._prepareEffect()},z.prototype._prepareEffect=function(){var u=this,w=this._attributesNames,y=this.defines,r=this._fallbacks;this._valueCache={};var o=this._pipelineContext;try{var G=this._engine;this._pipelineContext=G.createPipelineContext();var M=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?G._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,M,null,this._transformFeedbackVaryings):G._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,M,y,this._transformFeedbackVaryings),G._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(G.supportsUniformBuffers)for(var R in u._uniformBuffersNames)u.bindUniformBlock(R,u._uniformBuffersNames[R]);var W;for(G.getUniforms(u._pipelineContext,u._uniformsNames).forEach(function(Y,X){u._uniforms[u._uniformsNames[X]]=Y}),u._attributes=G.getAttributes(u._pipelineContext,w),W=0;W<u._samplerList.length;W++)null==u.getUniform(u._samplerList[W])&&(u._samplerList.splice(W,1),W--);u._samplerList.forEach(function(Y,X){u._samplers[Y]=X}),G.bindSamplers(u),u._compilationError="",u._isReady=!0,u.onCompiled&&u.onCompiled(u),u.onCompileObservable.notifyObservers(u),u.onCompileObservable.clear(),u._fallbacks&&u._fallbacks.unBindMesh(),o&&u.getEngine()._deletePipelineContext(o)}),this._pipelineContext.isAsync&&this._checkIsReady()}catch(R){this._compilationError=R.message,I.a.Error("Unable to compile effect:"),I.a.Error("Uniforms: "+this._uniformsNames.map(function(W){return" "+W})),I.a.Error("Attributes: "+w.map(function(W){return" "+W})),I.a.Error("Error: "+this._compilationError),o&&(this._pipelineContext=o,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),r&&r.isMoreFallbacks?(I.a.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())}},Object.defineProperty(z.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),z.prototype._bindTexture=function(u,w){this._engine._bindTexture(this._samplers[u],w)},z.prototype.setTexture=function(u,w){this._engine.setTexture(this._samplers[u],this._uniforms[u],w)},z.prototype.setDepthStencilTexture=function(u,w){this._engine.setDepthStencilTexture(this._samplers[u],this._uniforms[u],w)},z.prototype.setTextureArray=function(u,w){var y=u+"Ex";if(-1===this._samplerList.indexOf(y))for(var r=this._samplers[u],o=1;o<w.length;o++)this._samplerList.splice(r+o,0,y),this._samplers[y]=r+o;this._engine.setTextureArray(this._samplers[u],this._uniforms[u],w)},z.prototype.setTextureFromPostProcess=function(u,w){this._engine.setTextureFromPostProcess(this._samplers[u],w)},z.prototype.setTextureFromPostProcessOutput=function(u,w){this._engine.setTextureFromPostProcessOutput(this._samplers[u],w)},z.prototype._cacheMatrix=function(u,w){var y=this._valueCache[u],r=w.updateFlag;return(void 0===y||y!==r)&&(this._valueCache[u]=r,!0)},z.prototype._cacheFloat2=function(u,w,y){var r=this._valueCache[u];if(!r)return r=[w,y],this._valueCache[u]=r,!0;var o=!1;return r[0]!==w&&(r[0]=w,o=!0),r[1]!==y&&(r[1]=y,o=!0),o},z.prototype._cacheFloat3=function(u,w,y,r){var o=this._valueCache[u];if(!o)return o=[w,y,r],this._valueCache[u]=o,!0;var G=!1;return o[0]!==w&&(o[0]=w,G=!0),o[1]!==y&&(o[1]=y,G=!0),o[2]!==r&&(o[2]=r,G=!0),G},z.prototype._cacheFloat4=function(u,w,y,r,o){var G=this._valueCache[u];if(!G)return G=[w,y,r,o],this._valueCache[u]=G,!0;var M=!1;return G[0]!==w&&(G[0]=w,M=!0),G[1]!==y&&(G[1]=y,M=!0),G[2]!==r&&(G[2]=r,M=!0),G[3]!==o&&(G[3]=o,M=!0),M},z.prototype.bindUniformBuffer=function(u,w){var y=this._uniformBuffersNames[w];void 0!==y&&z._baseCache[y]!==u&&(z._baseCache[y]=u,this._engine.bindUniformBufferBase(u,y))},z.prototype.bindUniformBlock=function(u,w){this._engine.bindUniformBlock(this._pipelineContext,u,w)},z.prototype.setInt=function(u,w){var y=this._valueCache[u];return void 0!==y&&y===w?this:(this._valueCache[u]=w,this._engine.setInt(this._uniforms[u],w),this)},z.prototype.setIntArray=function(u,w){return this._valueCache[u]=null,this._engine.setIntArray(this._uniforms[u],w),this},z.prototype.setIntArray2=function(u,w){return this._valueCache[u]=null,this._engine.setIntArray2(this._uniforms[u],w),this},z.prototype.setIntArray3=function(u,w){return this._valueCache[u]=null,this._engine.setIntArray3(this._uniforms[u],w),this},z.prototype.setIntArray4=function(u,w){return this._valueCache[u]=null,this._engine.setIntArray4(this._uniforms[u],w),this},z.prototype.setFloatArray=function(u,w){return this._valueCache[u]=null,this._engine.setFloatArray(this._uniforms[u],w),this},z.prototype.setFloatArray2=function(u,w){return this._valueCache[u]=null,this._engine.setFloatArray2(this._uniforms[u],w),this},z.prototype.setFloatArray3=function(u,w){return this._valueCache[u]=null,this._engine.setFloatArray3(this._uniforms[u],w),this},z.prototype.setFloatArray4=function(u,w){return this._valueCache[u]=null,this._engine.setFloatArray4(this._uniforms[u],w),this},z.prototype.setArray=function(u,w){return this._valueCache[u]=null,this._engine.setArray(this._uniforms[u],w),this},z.prototype.setArray2=function(u,w){return this._valueCache[u]=null,this._engine.setArray2(this._uniforms[u],w),this},z.prototype.setArray3=function(u,w){return this._valueCache[u]=null,this._engine.setArray3(this._uniforms[u],w),this},z.prototype.setArray4=function(u,w){return this._valueCache[u]=null,this._engine.setArray4(this._uniforms[u],w),this},z.prototype.setMatrices=function(u,w){return w?(this._valueCache[u]=null,this._engine.setMatrices(this._uniforms[u],w),this):this},z.prototype.setMatrix=function(u,w){return this._cacheMatrix(u,w)&&this._engine.setMatrix(this._uniforms[u],w),this},z.prototype.setMatrix3x3=function(u,w){return this._valueCache[u]=null,this._engine.setMatrix3x3(this._uniforms[u],w),this},z.prototype.setMatrix2x2=function(u,w){return this._valueCache[u]=null,this._engine.setMatrix2x2(this._uniforms[u],w),this},z.prototype.setFloat=function(u,w){var y=this._valueCache[u];return void 0!==y&&y===w?this:(this._valueCache[u]=w,this._engine.setFloat(this._uniforms[u],w),this)},z.prototype.setBool=function(u,w){var y=this._valueCache[u];return void 0!==y&&y===w?this:(this._valueCache[u]=w,this._engine.setBool(this._uniforms[u],w?1:0),this)},z.prototype.setVector2=function(u,w){return this._cacheFloat2(u,w.x,w.y)&&this._engine.setFloat2(this._uniforms[u],w.x,w.y),this},z.prototype.setFloat2=function(u,w,y){return this._cacheFloat2(u,w,y)&&this._engine.setFloat2(this._uniforms[u],w,y),this},z.prototype.setVector3=function(u,w){return this._cacheFloat3(u,w.x,w.y,w.z)&&this._engine.setFloat3(this._uniforms[u],w.x,w.y,w.z),this},z.prototype.setFloat3=function(u,w,y,r){return this._cacheFloat3(u,w,y,r)&&this._engine.setFloat3(this._uniforms[u],w,y,r),this},z.prototype.setVector4=function(u,w){return this._cacheFloat4(u,w.x,w.y,w.z,w.w)&&this._engine.setFloat4(this._uniforms[u],w.x,w.y,w.z,w.w),this},z.prototype.setFloat4=function(u,w,y,r,o){return this._cacheFloat4(u,w,y,r,o)&&this._engine.setFloat4(this._uniforms[u],w,y,r,o),this},z.prototype.setColor3=function(u,w){return this._cacheFloat3(u,w.r,w.g,w.b)&&this._engine.setColor3(this._uniforms[u],w),this},z.prototype.setColor4=function(u,w,y){return this._cacheFloat4(u,w.r,w.g,w.b,y)&&this._engine.setColor4(this._uniforms[u],w,y),this},z.prototype.setDirectColor4=function(u,w){return this._cacheFloat4(u,w.r,w.g,w.b,w.a)&&this._engine.setDirectColor4(this._uniforms[u],w),this},z.prototype.dispose=function(){this._engine._releaseEffect(this)},z.RegisterShader=function(u,w,y){w&&(z.ShadersStore[u+"PixelShader"]=w),y&&(z.ShadersStore[u+"VertexShader"]=y)},z.ResetCache=function(){z._baseCache={}},z.ShadersRepository="src/Shaders/",z._uniqueIdSeed=0,z._baseCache={},z.ShadersStore={},z.IncludesShadersStore={},z}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return q._AddLogEntry=function(j){q._LogCache=j+q._LogCache,q.OnNewCacheEntry&&q.OnNewCacheEntry(j)},q._FormatMessage=function(j){var I=function(A){return A<10?"0"+A:""+A},H=new Date();return"["+I(H.getHours())+":"+I(H.getMinutes())+":"+I(H.getSeconds())+"]: "+j},q._LogDisabled=function(j){},q._LogEnabled=function(j){var I=q._FormatMessage(j);console.log("BJS - "+I);var H="<div style='color:white'>"+I+"</div><br>";q._AddLogEntry(H)},q._WarnDisabled=function(j){},q._WarnEnabled=function(j){var I=q._FormatMessage(j);console.warn("BJS - "+I);var H="<div style='color:orange'>"+I+"</div><br>";q._AddLogEntry(H)},q._ErrorDisabled=function(j){},q._ErrorEnabled=function(j){q.errorsCount++;var I=q._FormatMessage(j);console.error("BJS - "+I);var H="<div style='color:red'>"+I+"</div><br>";q._AddLogEntry(H)},Object.defineProperty(q,"LogCache",{get:function(){return q._LogCache},enumerable:!0,configurable:!0}),q.ClearLogCache=function(){q._LogCache="",q.errorsCount=0},Object.defineProperty(q,"LogLevels",{set:function(j){(j&q.MessageLogLevel)===q.MessageLogLevel?q.Log=q._LogEnabled:q.Log=q._LogDisabled,(j&q.WarningLogLevel)===q.WarningLogLevel?q.Warn=q._WarnEnabled:q.Warn=q._WarnDisabled,(j&q.ErrorLogLevel)===q.ErrorLogLevel?q.Error=q._ErrorEnabled:q.Error=q._ErrorDisabled},enumerable:!0,configurable:!0}),q.NoneLogLevel=0,q.MessageLogLevel=1,q.WarningLogLevel=2,q.ErrorLogLevel=4,q.AllLogLevel=7,q._LogCache="",q.errorsCount=0,q.Log=q._LogEnabled,q.Warn=q._WarnEnabled,q.Error=q._ErrorEnabled,q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return w});var O=l(1),q=l(2),j=l(8),I=l(9),H=l(0),A=l(44),v=l(3),z=l(22),u=l(19),w=function(y){function r(o,G,M,R,W,Y,X,ea,ca,oa){void 0===M&&(M=!1),void 0===R&&(R=!0),void 0===W&&(W=r.TRILINEAR_SAMPLINGMODE),void 0===Y&&(Y=null),void 0===X&&(X=null),void 0===ea&&(ea=null),void 0===ca&&(ca=!1);var Z=y.call(this,G)||this;if(Z.url=null,Z.uOffset=0,Z.vOffset=0,Z.uScale=1,Z.vScale=1,Z.uAng=0,Z.vAng=0,Z.wAng=0,Z.uRotationCenter=.5,Z.vRotationCenter=.5,Z.wRotationCenter=.5,Z.inspectableCustomProperties=null,Z._noMipmap=!1,Z._invertY=!1,Z._rowGenerationMatrix=null,Z._cachedTextureMatrix=null,Z._projectionModeMatrix=null,Z._t0=null,Z._t1=null,Z._t2=null,Z._cachedUOffset=-1,Z._cachedVOffset=-1,Z._cachedUScale=0,Z._cachedVScale=0,Z._cachedUAng=-1,Z._cachedVAng=-1,Z._cachedWAng=-1,Z._cachedProjectionMatrixId=-1,Z._cachedCoordinatesMode=-1,Z._initialSamplingMode=r.BILINEAR_SAMPLINGMODE,Z._buffer=null,Z._deleteBuffer=!1,Z._format=null,Z._delayedOnLoad=null,Z._delayedOnError=null,Z.onLoadObservable=new j.c(),Z._isBlocking=!0,Z.name=o||"",Z.url=o,Z._noMipmap=M,Z._invertY=R,Z._initialSamplingMode=W,Z._buffer=ea,Z._deleteBuffer=ca,oa&&(Z._format=oa),!(G=Z.getScene()))return Z;G.getEngine().onBeforeTextureInitObservable.notifyObservers(Z);var T=function(){Z._texture&&Z._texture._invertVScale&&(Z.vScale=-1),Z.onLoadObservable.hasObservers()&&Z.onLoadObservable.notifyObservers(Z),Y&&Y(),!Z.isBlocking&&G&&G.resetCachedMaterial()};return Z.url?(Z._texture=Z._getFromCache(Z.url,M,W,R),Z._texture?Z._texture.isReady?I.h.SetImmediate(function(){return T()}):Z._texture.onLoadedObservable.add(T):G.useDelayedTextureLoading?(Z.delayLoadState=v.a.DELAYLOADSTATE_NOTLOADED,Z._delayedOnLoad=T,Z._delayedOnError=X):(Z._texture=G.getEngine().createTexture(Z.url,M,R,G,W,T,X,Z._buffer,void 0,Z._format),ca&&delete Z._buffer),Z):(Z._delayedOnLoad=T,Z._delayedOnError=X,Z)}return O.d(r,y),Object.defineProperty(r.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(o){this._isBlocking=o},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"invertY",{get:function(){return this._invertY},enumerable:!0,configurable:!0}),r.prototype.updateURL=function(o,G,M){void 0===G&&(G=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(v.a.MATERIAL_TextureDirtyFlag)),this.url=o,this._buffer=G,this.delayLoadState=v.a.DELAYLOADSTATE_NOTLOADED,M&&(this._delayedOnLoad=M),this.delayLoad()},r.prototype.delayLoad=function(){if(this.delayLoadState===v.a.DELAYLOADSTATE_NOTLOADED){var o=this.getScene();o&&(this.delayLoadState=v.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?I.h.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=o.getEngine().createTexture(this.url,this._noMipmap,this._invertY,o,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},r.prototype._prepareRowForTextureGeneration=function(o,G,M,R){o*=this.uScale,G*=this.vScale,o-=this.uRotationCenter*this.uScale,G-=this.vRotationCenter*this.vScale,M-=this.wRotationCenter,H.x.TransformCoordinatesFromFloatsToRef(o,G,M,this._rowGenerationMatrix,R),R.x+=this.uRotationCenter*this.uScale+this.uOffset,R.y+=this.vRotationCenter*this.vScale+this.vOffset,R.z+=this.wRotationCenter},r.prototype.getTextureMatrix=function(){var o=this;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=H.j.Zero(),this._rowGenerationMatrix=new H.j(),this._t0=H.x.Zero(),this._t1=H.x.Zero(),this._t2=H.x.Zero()),H.j.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),H.j.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);var G=this.getScene();return G?(G.markAllMaterialsAsDirty(v.a.MATERIAL_TextureDirtyFlag,function(M){return M.hasTexture(o)}),this._cachedTextureMatrix):this._cachedTextureMatrix},r.prototype.getReflectionTextureMatrix=function(){var o=this,G=this.getScene();if(!G)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==r.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===G.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=H.j.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=H.j.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case r.PLANAR_MODE:H.j.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case r.PROJECTION_MODE:H.j.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var M=G.getProjectionMatrix();this._cachedProjectionMatrixId=M.updateFlag,M.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:H.j.IdentityToRef(this._cachedTextureMatrix)}return G.markAllMaterialsAsDirty(v.a.MATERIAL_TextureDirtyFlag,function(R){return-1!==R.getActiveTextures().indexOf(o)}),this._cachedTextureMatrix},r.prototype.clone=function(){var o=this;return q.a.Clone(function(){return new r(o._texture?o._texture.url:null,o.getScene(),o._noMipmap,o._invertY,o.samplingMode,void 0,void 0,o._texture?o._texture._buffer:void 0)},this)},r.prototype.serialize=function(){var o=y.prototype.serialize.call(this);return"string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)&&(o.base64String=this._buffer,o.name=o.name.replace("data:","")),o.invertY=this._invertY,o.samplingMode=this.samplingMode,o},r.prototype.getClassName=function(){return"Texture"},r.prototype.dispose=function(){y.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},r.Parse=function(o,G,M){if(o.customType){var R=I.h.Instantiate(o.customType).Parse(o,G,M);return o.samplingMode&&R.updateSamplingMode&&R._samplingMode&&R._samplingMode!==o.samplingMode&&R.updateSamplingMode(o.samplingMode),R}if(o.isCube&&!o.isRenderTarget)return r._CubeTextureParser(o,G,M);if(!o.name&&!o.isRenderTarget)return null;var W=q.a.Parse(function(){var oa,Z=!0;if(o.noMipmap&&(Z=!1),o.mirrorPlane){var T=r._CreateMirror(o.name,o.renderTargetSize,G,Z);return T._waitingRenderList=o.renderList,T.mirrorPlane=H.n.FromArray(o.mirrorPlane),T}if(o.isRenderTarget){var V=null;if(o.isCube){if(G.reflectionProbes)for(var D=0;D<G.reflectionProbes.length;D++){var F=G.reflectionProbes[D];if(F.name===o.name)return F.cubeTexture}}else(V=r._CreateRenderTargetTexture(o.name,o.renderTargetSize,G,Z))._waitingRenderList=o.renderList;return V}if(o.base64String)oa=r.CreateFromBase64String(o.base64String,o.name,G,!Z);else{var L=M+o.name;r.UseSerializedUrlIfAny&&o.url&&(L=o.url),oa=new r(L,G,!Z,o.invertY)}return oa},o,G);if(o.samplingMode){var Y=o.samplingMode;W&&W.samplingMode!==Y&&W.updateSamplingMode(Y)}if(W&&o.animations)for(var X=0;X<o.animations.length;X++){var ea=o.animations[X],ca=z.a.GetClass("BABYLON.Animation");ca&&W.animations.push(ca.Parse(ea))}return W},r.CreateFromBase64String=function(o,G,M,R,W,Y,X,ea,ca){return void 0===Y&&(Y=r.TRILINEAR_SAMPLINGMODE),void 0===X&&(X=null),void 0===ea&&(ea=null),void 0===ca&&(ca=v.a.TEXTUREFORMAT_RGBA),new r("data:"+G,M,R,W,Y,X,ea,o,!1,ca)},r.LoadFromDataString=function(o,G,M,R,W,Y,X,ea,ca,oa){return void 0===R&&(R=!1),void 0===W&&(W=!1),void 0===Y&&(Y=!0),void 0===X&&(X=r.TRILINEAR_SAMPLINGMODE),void 0===ea&&(ea=null),void 0===ca&&(ca=null),void 0===oa&&(oa=v.a.TEXTUREFORMAT_RGBA),"data:"!==o.substr(0,5)&&(o="data:"+o),new r(o,M,W,Y,X,ea,ca,G,R,oa)},r._CubeTextureParser=function(o,G,M){throw u.a.WarnImport("CubeTexture")},r._CreateMirror=function(o,G,M,R){throw u.a.WarnImport("MirrorTexture")},r._CreateRenderTargetTexture=function(o,G,M,R){throw u.a.WarnImport("RenderTargetTexture")},r.NEAREST_SAMPLINGMODE=v.a.TEXTURE_NEAREST_SAMPLINGMODE,r.NEAREST_NEAREST_MIPLINEAR=v.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,r.BILINEAR_SAMPLINGMODE=v.a.TEXTURE_BILINEAR_SAMPLINGMODE,r.LINEAR_LINEAR_MIPNEAREST=v.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,r.TRILINEAR_SAMPLINGMODE=v.a.TEXTURE_TRILINEAR_SAMPLINGMODE,r.LINEAR_LINEAR_MIPLINEAR=v.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,r.NEAREST_NEAREST_MIPNEAREST=v.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,r.NEAREST_LINEAR_MIPNEAREST=v.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,r.NEAREST_LINEAR_MIPLINEAR=v.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,r.NEAREST_LINEAR=v.a.TEXTURE_NEAREST_LINEAR,r.NEAREST_NEAREST=v.a.TEXTURE_NEAREST_NEAREST,r.LINEAR_NEAREST_MIPNEAREST=v.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,r.LINEAR_NEAREST_MIPLINEAR=v.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,r.LINEAR_LINEAR=v.a.TEXTURE_LINEAR_LINEAR,r.LINEAR_NEAREST=v.a.TEXTURE_LINEAR_NEAREST,r.EXPLICIT_MODE=v.a.TEXTURE_EXPLICIT_MODE,r.SPHERICAL_MODE=v.a.TEXTURE_SPHERICAL_MODE,r.PLANAR_MODE=v.a.TEXTURE_PLANAR_MODE,r.CUBIC_MODE=v.a.TEXTURE_CUBIC_MODE,r.PROJECTION_MODE=v.a.TEXTURE_PROJECTION_MODE,r.SKYBOX_MODE=v.a.TEXTURE_SKYBOX_MODE,r.INVCUBIC_MODE=v.a.TEXTURE_INVCUBIC_MODE,r.EQUIRECTANGULAR_MODE=v.a.TEXTURE_EQUIRECTANGULAR_MODE,r.FIXED_EQUIRECTANGULAR_MODE=v.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,r.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=v.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,r.CLAMP_ADDRESSMODE=v.a.TEXTURE_CLAMP_ADDRESSMODE,r.WRAP_ADDRESSMODE=v.a.TEXTURE_WRAP_ADDRESSMODE,r.MIRROR_ADDRESSMODE=v.a.TEXTURE_MIRROR_ADDRESSMODE,r.UseSerializedUrlIfAny=!1,O.c([Object(q.c)()],r.prototype,"url",void 0),O.c([Object(q.c)()],r.prototype,"uOffset",void 0),O.c([Object(q.c)()],r.prototype,"vOffset",void 0),O.c([Object(q.c)()],r.prototype,"uScale",void 0),O.c([Object(q.c)()],r.prototype,"vScale",void 0),O.c([Object(q.c)()],r.prototype,"uAng",void 0),O.c([Object(q.c)()],r.prototype,"vAng",void 0),O.c([Object(q.c)()],r.prototype,"wAng",void 0),O.c([Object(q.c)()],r.prototype,"uRotationCenter",void 0),O.c([Object(q.c)()],r.prototype,"vRotationCenter",void 0),O.c([Object(q.c)()],r.prototype,"wRotationCenter",void 0),O.c([Object(q.c)()],r.prototype,"isBlocking",null),r}(A.a);q.a._TextureParser=w.Parse},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O}),l.d(x,"d",function(){return q}),l.d(x,"b",function(){return j}),l.d(x,"c",function(){return I});var O=function(){function H(A,v,z,u){void 0===v&&(v=!1),this.initalize(A,v,z,u)}return H.prototype.initalize=function(A,v,z,u){return void 0===v&&(v=!1),this.mask=A,this.skipNextObservers=v,this.target=z,this.currentTarget=u,this},H}(),q=function(){return function(H,A,v){void 0===v&&(v=null),this.callback=H,this.mask=A,this.scope=v,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1}}(),j=function(){function H(){}return H.prototype.dispose=function(){if(this._observers&&this._observables)for(var A=0;A<this._observers.length;A++)this._observables[A].remove(this._observers[A]);this._observers=null,this._observables=null},H.Watch=function(A,v,z,u){void 0===z&&(z=-1),void 0===u&&(u=null);var w=new H();w._observers=new Array(),w._observables=A;for(var y=0,r=A;y<r.length;y++){var o=r[y].add(v,z,!1,u);o&&w._observers.push(o)}return w},H}(),I=function(){function H(A){this._observers=new Array(),this._eventState=new O(0),A&&(this._onObserverAdded=A)}return H.prototype.add=function(A,v,z,u,w){if(void 0===v&&(v=-1),void 0===z&&(z=!1),void 0===u&&(u=null),void 0===w&&(w=!1),!A)return null;var y=new q(A,v,u);return y.unregisterOnNextCall=w,z?this._observers.unshift(y):this._observers.push(y),this._onObserverAdded&&this._onObserverAdded(y),y},H.prototype.addOnce=function(A){return this.add(A,void 0,void 0,void 0,!0)},H.prototype.remove=function(A){return!!A&&(-1!==this._observers.indexOf(A)&&(this._deferUnregister(A),!0))},H.prototype.removeCallback=function(A,v){for(var z=0;z<this._observers.length;z++)if(this._observers[z].callback===A&&(!v||v===this._observers[z].scope))return this._deferUnregister(this._observers[z]),!0;return!1},H.prototype._deferUnregister=function(A){var v=this;A.unregisterOnNextCall=!1,A._willBeUnregistered=!0,setTimeout(function(){v._remove(A)},0)},H.prototype._remove=function(A){if(!A)return!1;var v=this._observers.indexOf(A);return-1!==v&&(this._observers.splice(v,1),!0)},H.prototype.makeObserverTopPriority=function(A){this._remove(A),this._observers.unshift(A)},H.prototype.makeObserverBottomPriority=function(A){this._remove(A),this._observers.push(A)},H.prototype.notifyObservers=function(A,v,z,u){if(void 0===v&&(v=-1),!this._observers.length)return!0;var w=this._eventState;w.mask=v,w.target=z,w.currentTarget=u,w.skipNextObservers=!1,w.lastReturnValue=A;for(var y=0,r=this._observers;y<r.length;y++){var o=r[y];if(!o._willBeUnregistered&&(o.mask&v&&(o.scope?w.lastReturnValue=o.callback.apply(o.scope,[A,w]):w.lastReturnValue=o.callback(A,w),o.unregisterOnNextCall&&this._deferUnregister(o)),w.skipNextObservers))return!1}return!0},H.prototype.notifyObserversWithPromise=function(A,v,z,u){var w=this;void 0===v&&(v=-1);var y=Promise.resolve(A);if(!this._observers.length)return y;var r=this._eventState;return r.mask=v,r.target=z,r.currentTarget=u,r.skipNextObservers=!1,this._observers.forEach(function(o){r.skipNextObservers||o._willBeUnregistered||o.mask&v&&(y=o.scope?y.then(function(G){return r.lastReturnValue=G,o.callback.apply(o.scope,[A,r])}):y.then(function(G){return r.lastReturnValue=G,o.callback(A,r)}),o.unregisterOnNextCall&&w._deferUnregister(o))}),y.then(function(){return A})},H.prototype.notifyObserver=function(A,v,z){void 0===z&&(z=-1);var u=this._eventState;u.mask=z,u.skipNextObservers=!1,A.callback(v,u)},H.prototype.hasObservers=function(){return this._observers.length>0},H.prototype.clear=function(){this._observers=new Array(),this._onObserverAdded=null},H.prototype.clone=function(){var A=new H();return A._observers=this._observers.slice(0),A},H.prototype.hasSpecificMask=function(A){void 0===A&&(A=-1);for(var v=0,z=this._observers;v<z.length;v++){var u=z[v];if(u.mask&A||u.mask===A)return!0}return!1},H}()},function(Aa,x,l){"use strict";l.d(x,"c",function(){return G}),l.d(x,"b",function(){return M}),l.d(x,"d",function(){return R}),l.d(x,"e",function(){return W}),l.d(x,"g",function(){return Y}),l.d(x,"h",function(){return X}),l.d(x,"f",function(){return ea}),l.d(x,"i",function(){return ca}),l.d(x,"a",function(){return oa});var O=l(1),q=l(0),j=l(12),I=l(8),H=l(59),A=l(3),v=l(35),z=l(6),u=l(22),w=l(32),y=l(47),r=l(19),o=l(60),G=function(){function Z(){}return Z.prototype.getColorToRef=function(T){this.color2?q.f.LerpToRef(this.color1,this.color2,Math.random(),T):T.copyFrom(this.color1)},Z}(),M=function(){return function(){}}(),R=function(){function Z(){}return Z.prototype.getFactor=function(){return void 0===this.factor2?this.factor1:j.a.Lerp(this.factor1,this.factor2,Math.random())},Z}(),W=function(Z){function T(V,D){var F=Z.call(this,V)||this;return F.request=D,F.name="LoadFileError",T._setPrototypeOf(F,T.prototype),F}return O.d(T,Z),T._setPrototypeOf=Object.setPrototypeOf||function(V,D){return V.__proto__=D,V},T}(Error),Y=function(){function Z(){}return Z.ExponentialBackoff=function(T,V){return void 0===T&&(T=3),void 0===V&&(V=500),function(D,F,L){return 0!==F.status||L>=T||-1!==D.indexOf("file:")?-1:Math.pow(2,L)*V}},Z}(),X=function(){function Z(){}return Z.FetchToRef=function(T,V,D,F,L,N){var p=4*((Math.abs(T)*D%D|0)+(Math.abs(V)*F%F|0)*D);N.r=L[p]/255,N.g=L[p+1]/255,N.b=L[p+2]/255,N.a=L[p+3]/255},Z.Mix=function(T,V,D){return T*(1-D)+V*D},Z.Instantiate=function(T){if(Z.RegisteredExternalClasses&&Z.RegisteredExternalClasses[T])return Z.RegisteredExternalClasses[T];var V=u.a.GetClass(T);if(V)return V;z.a.Warn(T+" not found, you may have missed an import.");for(var D=T.split("."),F=window||this,L=0,N=D.length;L<N;L++)F=F[D[L]];return"function"!=typeof F?null:F},Z.Slice=function(T,V,D){return T.slice?T.slice(V,D):Array.prototype.slice.call(T,V,D)},Z.SetImmediate=function(T){v.a.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(T):setTimeout(T,1)},Z.IsExponentOfTwo=function(T){var V=1;do V*=2;while(V<T);return V===T},Z.FloatRound=function(T){return Math.fround?Math.fround(T):Z._tmpFloatArray[0]=T},Z.CeilingPOT=function(T){return T--,T|=T>>1,T|=T>>2,T|=T>>4,T|=T>>8,T|=T>>16,++T},Z.FloorPOT=function(T){return T|=T>>1,T|=T>>2,T|=T>>4,T|=T>>8,(T|=T>>16)-(T>>1)},Z.NearestPOT=function(T){var V=Z.CeilingPOT(T),D=Z.FloorPOT(T);return V-T>T-D?D:V},Z.GetExponentOfTwo=function(T,V,D){var F;switch(void 0===D&&(D=A.a.SCALEMODE_NEAREST),D){case A.a.SCALEMODE_FLOOR:F=Z.FloorPOT(T);break;case A.a.SCALEMODE_NEAREST:F=Z.NearestPOT(T);break;case A.a.SCALEMODE_CEILING:default:F=Z.CeilingPOT(T)}return Math.min(F,V)},Z.GetFilename=function(T){var V=T.lastIndexOf("/");return V<0?T:T.substring(V+1)},Z.GetFolderPath=function(T,V){void 0===V&&(V=!1);var D=T.lastIndexOf("/");return D<0?V?T:"":T.substring(0,D+1)},Z.ToDegrees=function(T){return 180*T/Math.PI},Z.ToRadians=function(T){return T*Math.PI/180},Z.EncodeArrayBufferTobase64=function(T){for(var V,D,F,L,N,p,g,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="",t=0,C=new Uint8Array(T);t<C.length;)L=(V=C[t++])>>2,N=(3&V)<<4|(D=t<C.length?C[t++]:Number.NaN)>>4,p=(15&D)<<2|(F=t<C.length?C[t++]:Number.NaN)>>6,g=63&F,isNaN(D)?p=g=64:isNaN(F)&&(g=64),s+=n.charAt(L)+n.charAt(N)+n.charAt(p)+n.charAt(g);return"data:image/png;base64,"+s},Z.ExtractMinAndMaxIndexed=function(T,V,D,F,L){void 0===L&&(L=null);for(var N=new q.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new q.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),g=D;g<D+F;g++){var n=3*V[g],s=T[n],t=T[n+1],C=T[n+2];N.minimizeInPlaceFromFloats(s,t,C),p.maximizeInPlaceFromFloats(s,t,C)}return L&&(N.x-=N.x*L.x+L.y,N.y-=N.y*L.x+L.y,N.z-=N.z*L.x+L.y,p.x+=p.x*L.x+L.y,p.y+=p.y*L.x+L.y,p.z+=p.z*L.x+L.y),{minimum:N,maximum:p}},Z.ExtractMinAndMax=function(T,V,D,F,L){void 0===F&&(F=null);var N=new q.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new q.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);L||(L=3);for(var g=V,n=V*L;g<V+D;g++,n+=L){var s=T[n],t=T[n+1],C=T[n+2];N.minimizeInPlaceFromFloats(s,t,C),p.maximizeInPlaceFromFloats(s,t,C)}return F&&(N.x-=N.x*F.x+F.y,N.y-=N.y*F.x+F.y,N.z-=N.z*F.x+F.y,p.x+=p.x*F.x+F.y,p.y+=p.y*F.x+F.y,p.z+=p.z*F.x+F.y),{minimum:N,maximum:p}},Z.MakeArray=function(T,V){return!0===V||void 0!==T&&null!=T?Array.isArray(T)?T:[T]:null},Z.GetPointerPrefix=function(){var T="pointer";return!v.a.IsWindowObjectExist()||window.PointerEvent||navigator.pointerEnabled||(T="mouse"),T},Z.QueueNewFrame=function(T,V){return v.a.IsWindowObjectExist()?(V||(V=window),V.requestAnimationFrame?V.requestAnimationFrame(T):V.msRequestAnimationFrame?V.msRequestAnimationFrame(T):V.webkitRequestAnimationFrame?V.webkitRequestAnimationFrame(T):V.mozRequestAnimationFrame?V.mozRequestAnimationFrame(T):V.oRequestAnimationFrame?V.oRequestAnimationFrame(T):window.setTimeout(T,16)):setTimeout(T,16)},Z.RequestFullscreen=function(T){var V=T.requestFullscreen||T.msRequestFullscreen||T.webkitRequestFullscreen||T.mozRequestFullScreen;V&&V.call(T)},Z.ExitFullscreen=function(){var T=document;document.exitFullscreen?document.exitFullscreen():T.mozCancelFullScreen?T.mozCancelFullScreen():T.webkitCancelFullScreen?T.webkitCancelFullScreen():T.msCancelFullScreen&&T.msCancelFullScreen()},Z.SetCorsBehavior=function(T,V){if((!T||0!==T.indexOf("data:"))&&Z.CorsBehavior)if("string"==typeof Z.CorsBehavior||Z.CorsBehavior instanceof String)V.crossOrigin=Z.CorsBehavior;else{var D=Z.CorsBehavior(T);D&&(V.crossOrigin=D)}},Z.CleanUrl=function(T){return T=T.replace(/#/gm,"%23")},Z.LoadImage=function(T,V,D,F){var L,N=!1;T instanceof ArrayBuffer?(L=URL.createObjectURL(new Blob([T])),N=!0):T instanceof Blob?(L=URL.createObjectURL(T),N=!0):(L=Z.CleanUrl(T),L=Z.PreprocessUrl(T));var p=new Image();Z.SetCorsBehavior(L,p);var g=function(){p.removeEventListener("load",g),p.removeEventListener("error",n),V(p),N&&p.src&&URL.revokeObjectURL(p.src)},n=function(J){p.removeEventListener("load",g),p.removeEventListener("error",n),z.a.Error("Error while trying to load image: "+T),D&&D("Error while trying to load image: "+T,J),N&&p.src&&URL.revokeObjectURL(p.src)};p.addEventListener("load",g),p.addEventListener("error",n);var s=function(){p.src=L};if("data:"!==L.substr(0,5)&&F&&F.enableTexturesOffline)F.open(function(){F&&F.loadImage(L,p)},s);else{if(-1!==L.indexOf("file:")){var t=decodeURIComponent(L.substring(5).toLowerCase());if(H.a.FilesToLoad[t]){try{var C;try{C=URL.createObjectURL(H.a.FilesToLoad[t])}catch(J){C=URL.createObjectURL(H.a.FilesToLoad[t])}p.src=C,N=!0}catch(J){p.src=""}return p}}s()}return p},Z.LoadFile=function(T,V,D,F,L,N){if(T=Z.CleanUrl(T),-1!==(T=Z.PreprocessUrl(T)).indexOf("file:")){var p=decodeURIComponent(T.substring(5).toLowerCase());if(H.a.FilesToLoad[p])return Z.ReadFile(H.a.FilesToLoad[p],V,D,L)}var g=Z.BaseUrl+T,n=!1,s={onCompleteObservable:new I.c(),abort:function(){return n=!0}},t=function(){var J=new o.a(),Q=null;s.abort=function(){n=!0,J.readyState!==(XMLHttpRequest.DONE||4)&&J.abort(),null!==Q&&(clearTimeout(Q),Q=null)};var $=function(aa){J.open("GET",g),L&&(J.responseType="arraybuffer"),D&&J.addEventListener("progress",D);var ba=function(){J.removeEventListener("loadend",ba),s.onCompleteObservable.notifyObservers(s),s.onCompleteObservable.clear()};J.addEventListener("loadend",ba);var ia=function(){if(!n&&J.readyState===(XMLHttpRequest.DONE||4)){if(J.removeEventListener("readystatechange",ia),J.status>=200&&J.status<300||0===J.status&&(!v.a.IsWindowObjectExist()||Z.IsFileURL()))return void V(L?J.response:J.responseText,J.responseURL);var qa=Z.DefaultRetryStrategy;if(qa){var ja=qa(g,J,aa);if(-1!==ja)return J.removeEventListener("loadend",ba),J=new o.a(),void(Q=setTimeout(function(){return $(aa+1)},ja))}var sa=new W("Error status: "+J.status+" "+J.statusText+" - Unable to load "+g,J);if(!N)throw sa;N(J,sa)}};J.addEventListener("readystatechange",ia),J.send()};$(0)};if(F&&F.enableSceneOffline){var C=function(J){J&&J.status>400?N&&N(J):n||t()};F.open(function(){n||F&&F.loadFile(T,function(J){n||V(J),s.onCompleteObservable.notifyObservers(s)},D?function(J){n||D(J)}:void 0,C,L)},C)}else t();return s},Z.LoadScript=function(T,V,D,F){if(v.a.IsWindowObjectExist()){var L=document.getElementsByTagName("head")[0],N=document.createElement("script");N.setAttribute("type","text/javascript"),N.setAttribute("src",T),F&&(N.id=F),N.onload=function(){V&&V()},N.onerror=function(p){D&&D("Unable to load script '"+T+"'",p)},L.appendChild(N)}},Z.LoadScriptAsync=function(T,V){return new Promise(function(D,F){if(v.a.IsWindowObjectExist()){var L=document.getElementsByTagName("head")[0],N=document.createElement("script");N.setAttribute("type","text/javascript"),N.setAttribute("src",T),V&&(N.id=V),N.onload=function(){D(!0)},N.onerror=function(p){D(!1)},L.appendChild(N)}else D(!1)})},Z.ReadFileAsDataURL=function(T,V,D){var F=new FileReader(),L={onCompleteObservable:new I.c(),abort:function(){return F.abort()}};return F.onloadend=function(N){L.onCompleteObservable.notifyObservers(L)},F.onload=function(N){V(N.target.result)},F.onprogress=D,F.readAsDataURL(T),L},Z.ReadFile=function(T,V,D,F){var L=new FileReader(),N={onCompleteObservable:new I.c(),abort:function(){return L.abort()}};return L.onloadend=function(p){return N.onCompleteObservable.notifyObservers(N)},L.onerror=function(p){z.a.Log("Error while reading file: "+T.name),V(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},L.onload=function(p){V(p.target.result)},D&&(L.onprogress=D),F?L.readAsArrayBuffer(T):L.readAsText(T),N},Z.FileAsURL=function(T){var V=new Blob([T]);return(window.URL||window.webkitURL).createObjectURL(V)},Z.Format=function(T,V){return void 0===V&&(V=2),T.toFixed(V)},Z.CheckExtends=function(T,V,D){V.minimizeInPlace(T),D.maximizeInPlace(T)},Z.DeepCopy=function(T,V,D,F){w.a.DeepCopy(T,V,D,F)},Z.IsEmpty=function(T){for(var V in T)if(T.hasOwnProperty(V))return!1;return!0},Z.EndsWith=function(T,V){return-1!==T.indexOf(V,T.length-V.length)},Z.RegisterTopRootEvents=function(T){for(var V=0;V<T.length;V++){var D=T[V];window.addEventListener(D.name,D.handler,!1);try{window.parent&&window.parent.addEventListener(D.name,D.handler,!1)}catch(F){}}},Z.UnregisterTopRootEvents=function(T){for(var V=0;V<T.length;V++){var D=T[V];window.removeEventListener(D.name,D.handler);try{window.parent&&window.parent.removeEventListener(D.name,D.handler)}catch(F){}}},Z.DumpFramebuffer=function(T,V,D,F,L,N){void 0===L&&(L="image/png");for(var p=4*T,g=V/2,n=D.readPixels(0,0,T,V),s=0;s<g;s++)for(var t=0;t<p;t++){var C=t+s*p,J=t+(V-s-1)*p,Q=n[C];n[C]=n[J],n[J]=Q}Z._ScreenshotCanvas||(Z._ScreenshotCanvas=document.createElement("canvas")),Z._ScreenshotCanvas.width=T,Z._ScreenshotCanvas.height=V;var $=Z._ScreenshotCanvas.getContext("2d");if($){var aa=$.createImageData(T,V);aa.data.set(n),$.putImageData(aa,0,0),Z.EncodeScreenshotCanvasData(F,L,N)}},Z.ToBlob=function(T,V,D){void 0===D&&(D="image/png"),T.toBlob||(T.toBlob=function(F,L,N){var p=this;setTimeout(function(){for(var g=atob(p.toDataURL(L,N).split(",")[1]),n=g.length,s=new Uint8Array(n),t=0;t<n;t++)s[t]=g.charCodeAt(t);F(new Blob([s]))})}),T.toBlob(function(F){V(F)},D)},Z.EncodeScreenshotCanvasData=function(T,V,D){(void 0===V&&(V="image/png"),T)?T(Z._ScreenshotCanvas.toDataURL(V)):this.ToBlob(Z._ScreenshotCanvas,function(F){if("download"in document.createElement("a")){if(!D){var L=new Date(),N=(L.getFullYear()+"-"+(L.getMonth()+1)).slice(2)+"-"+L.getDate()+"_"+L.getHours()+"-"+("0"+L.getMinutes()).slice(-2);D="screenshot_"+N+".png"}Z.Download(F,D)}else{var p=URL.createObjectURL(F),g=window.open("");if(!g)return;var n=g.document.createElement("img");n.onload=function(){URL.revokeObjectURL(p)},n.src=p,g.document.body.appendChild(n)}},V)},Z.Download=function(T,V){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(T,V);else{var D=window.URL.createObjectURL(T),F=document.createElement("a");document.body.appendChild(F),F.style.display="none",F.href=D,F.download=V,F.addEventListener("click",function(){F.parentElement&&F.parentElement.removeChild(F)}),F.click(),window.URL.revokeObjectURL(D)}},Z.CreateScreenshot=function(T,V,D,F,L){throw void 0===L&&(L="image/png"),r.a.WarnImport("ScreenshotTools")},Z.CreateScreenshotUsingRenderTarget=function(T,V,D,F,L,N,p,g){throw void 0===L&&(L="image/png"),void 0===N&&(N=1),void 0===p&&(p=!1),r.a.WarnImport("ScreenshotTools")},Z.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(T){var V=16*Math.random()|0;return("x"===T?V:3&V|8).toString(16)})},Z.IsBase64=function(T){return!(T.length<5)&&"data:"===T.substr(0,5)},Z.DecodeBase64=function(T){for(var V=atob(T.split(",")[1]),D=V.length,F=new Uint8Array(new ArrayBuffer(D)),L=0;L<D;L++)F[L]=V.charCodeAt(L);return F.buffer},Z.GetAbsoluteUrl=function(T){var V=document.createElement("a");return V.href=T,V.href},Object.defineProperty(Z,"errorsCount",{get:function(){return z.a.errorsCount},enumerable:!0,configurable:!0}),Z.Log=function(T){z.a.Log(T)},Z.Warn=function(T){z.a.Warn(T)},Z.Error=function(T){z.a.Error(T)},Object.defineProperty(Z,"LogCache",{get:function(){return z.a.LogCache},enumerable:!0,configurable:!0}),Z.ClearLogCache=function(){z.a.ClearLogCache()},Object.defineProperty(Z,"LogLevels",{set:function(T){z.a.LogLevels=T},enumerable:!0,configurable:!0}),Z.IsFileURL=function(){return"file:"===location.protocol},Object.defineProperty(Z,"PerformanceLogLevel",{set:function(T){return(T&Z.PerformanceUserMarkLogLevel)===Z.PerformanceUserMarkLogLevel?(Z.StartPerformanceCounter=Z._StartUserMark,void(Z.EndPerformanceCounter=Z._EndUserMark)):(T&Z.PerformanceConsoleLogLevel)===Z.PerformanceConsoleLogLevel?(Z.StartPerformanceCounter=Z._StartPerformanceConsole,void(Z.EndPerformanceCounter=Z._EndPerformanceConsole)):(Z.StartPerformanceCounter=Z._StartPerformanceCounterDisabled,void(Z.EndPerformanceCounter=Z._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),Z._StartPerformanceCounterDisabled=function(T,V){},Z._EndPerformanceCounterDisabled=function(T,V){},Z._StartUserMark=function(T,V){if(void 0===V&&(V=!0),!Z._performance){if(!v.a.IsWindowObjectExist())return;Z._performance=window.performance}V&&Z._performance.mark&&Z._performance.mark(T+"-Begin")},Z._EndUserMark=function(T,V){void 0===V&&(V=!0),V&&Z._performance.mark&&(Z._performance.mark(T+"-End"),Z._performance.measure(T,T+"-Begin",T+"-End"))},Z._StartPerformanceConsole=function(T,V){void 0===V&&(V=!0),V&&(Z._StartUserMark(T,V),console.time&&console.time(T))},Z._EndPerformanceConsole=function(T,V){void 0===V&&(V=!0),V&&(Z._EndUserMark(T,V),console.time&&console.timeEnd(T))},Object.defineProperty(Z,"Now",{get:function(){return y.a.Now},enumerable:!0,configurable:!0}),Z.GetClassName=function(T,V){void 0===V&&(V=!1);var D=null;return!V&&T.getClassName?D=T.getClassName():(T instanceof Object&&(D=(V?T:Object.getPrototypeOf(T)).constructor.__bjsclassName__),D||(D=typeof T)),D},Z.First=function(T,V){for(var D=0,F=T;D<F.length;D++){var L=F[D];if(V(L))return L}return null},Z.getFullClassName=function(T,V){void 0===V&&(V=!1);var D=null,F=null;if(!V&&T.getClassName)D=T.getClassName();else{if(T instanceof Object){var L=V?T:Object.getPrototypeOf(T);D=L.constructor.__bjsclassName__,F=L.constructor.__bjsmoduleName__}D||(D=typeof T)}return D?(null!=F?F+".":"")+D:null},Z.DelayAsync=function(T){return new Promise(function(V){setTimeout(function(){V()},T)})},Z.GetCurrentGradient=function(T,V,D){for(var F=0;F<V.length-1;F++){var L=V[F],N=V[F+1];if(T>=L.gradient&&T<=N.gradient)return void D(L,N,(T-L.gradient)/(N.gradient-L.gradient))}var p=V.length-1;D(V[p],V[p],1)},Z.BaseUrl="",Z.UseCustomRequestHeaders=!1,Z.CustomRequestHeaders=o.a.CustomRequestHeaders,Z.DefaultRetryStrategy=Y.ExponentialBackoff(),Z.CorsBehavior="anonymous",Z.UseFallbackTexture=!0,Z.RegisteredExternalClasses={},Z.fallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",Z._tmpFloatArray=new Float32Array(1),Z.GetDOMTextContent=v.a.GetDOMTextContent,Z.PreprocessUrl=function(T){return T},Z.NoneLogLevel=z.a.NoneLogLevel,Z.MessageLogLevel=z.a.MessageLogLevel,Z.WarningLogLevel=z.a.WarningLogLevel,Z.ErrorLogLevel=z.a.ErrorLogLevel,Z.AllLogLevel=z.a.AllLogLevel,Z.IsWindowObjectExist=v.a.IsWindowObjectExist,Z.PerformanceNoneLogLevel=0,Z.PerformanceUserMarkLogLevel=1,Z.PerformanceConsoleLogLevel=2,Z.StartPerformanceCounter=Z._StartPerformanceCounterDisabled,Z.EndPerformanceCounter=Z._EndPerformanceCounterDisabled,Z}(),ea=function(){function Z(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(Z.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),Z.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},Z.prototype.addCount=function(T,V){Z.Enabled&&(this._current+=T,V&&this._fetchResult())},Z.prototype.beginMonitoring=function(){Z.Enabled&&(this._startMonitoringTime=y.a.Now)},Z.prototype.endMonitoring=function(T){if(void 0===T&&(T=!0),Z.Enabled){T&&this.fetchNewFrame();var V=y.a.Now;this._current=V-this._startMonitoringTime,T&&this._fetchResult()}},Z.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var T=y.a.Now;T-this._lastSecTime>1000&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=T,this._lastSecAccumulated=0,this._lastSecValueCount=0)},Z.Enabled=!0,Z}();function ca(Z,T){return function(V){V.__bjsclassName__=Z,V.__bjsmoduleName__=null!=T?T:null}}var oa=function(){function Z(T,V,D,F){void 0===F&&(F=0),this.iterations=T,this.index=F-1,this._done=!1,this._fn=V,this._successCallback=D}return Z.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},Z.prototype.breakLoop=function(){this._done=!0,this._successCallback()},Z.Run=function(T,V,D,F){void 0===F&&(F=0);var L=new Z(T,V,D,F);return L.executeNext(),L},Z.SyncAsyncForLoop=function(T,V,D,F,L,N){return void 0===N&&(N=0),Z.Run(Math.ceil(T/V),function(p){L&&L()?p.breakLoop():setTimeout(function(){for(var g=0;g<V;++g){var n=p.index*V+g;if(n>=T)break;if(D(n),L&&L()){p.breakLoop();break}}p.executeNext()},N)},F)},Z}()},function(Aa,x,l){"use strict";l.d(x,"d",function(){return oa}),l.d(x,"a",function(){return Z}),l.d(x,"c",function(){return T}),l.d(x,"b",function(){return V});var O=l(1),q=l(8),j=l(105),I=l(61),H=l(106),A=l(9),v=l(0),z=l(12),u=l(5),w=l(20),y=l(26),r=l(94),o=l(3),G=l(35),M=l(6),R=l(23),W=l(92),Y=l(19),X=l(107),ea=l(73),ca=function(){return function(){}}(),oa=function(){return function(){}}(),Z=function(){return function(){}}(),T=function(){return function(){}}(),V=function(){function D(F,L,N,p){var g=this;void 0===p&&(p=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.scenes=new Array(),this.onNewSceneAddedObservable=new q.c(),this.postProcesses=new Array(),this.validateShaderPrograms=!1,this.onResizeObservable=new q.c(),this.onCanvasBlurObservable=new q.c(),this.onCanvasFocusObservable=new q.c(),this.onCanvasPointerOutObservable=new q.c(),this.onBeforeTextureInitObservable=new q.c(),this.disableUniformBuffers=!1,this._uniformBuffers=new Array(),this.onBeginFrameObservable=new q.c(),this.customAnimationFrameRequester=null,this.onEndFrameObservable=new q.c(),this.onBeforeShaderCompilationObservable=new q.c(),this.onAfterShaderCompilationObservable=new q.c(),this._windowIsBackground=!1,this._webGLVersion=1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._colorWrite=!0,this._drawCalls=new A.f(),this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array(),this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this.onContextLostObservable=new q.c(),this.onContextRestoredObservable=new q.c(),this._contextWasLost=!1,this._doNotHandleContextLost=!1,this._performanceMonitor=new j.a(),this._fps=60,this._deltaTime=0,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._depthCullingState=new r.b(),this._stencilState=new r.c(),this._alphaState=new r.a(),this._alphaMode=D.ALPHA_DISABLE,this._internalTexturesCache=new Array(),this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array(),this._currentFramebuffer=null,this._currentBufferPointers=new Array(),this._currentInstanceLocations=new Array(),this._currentInstanceBuffers=new Array(),this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array(),this._maxSimultaneousTextures=0,this._activeRequests=new Array(),this._texturesSupported=new Array(),this.premultipliedAlpha=!0,this._viewportCached=new v.y(0,0,0,0),this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},H.a.Apply();var n=null;if(D.Instances.push(this),F){if(N=N||{},F.getContext){if(n=F,this._renderingCanvas=n,null!=L&&(N.antialias=L),void 0===N.deterministicLockstep&&(N.deterministicLockstep=!1),void 0===N.lockstepMaxSteps&&(N.lockstepMaxSteps=4),void 0===N.preserveDrawingBuffer&&(N.preserveDrawingBuffer=!1),void 0===N.audioEngine&&(N.audioEngine=!0),void 0===N.stencil&&(N.stencil=!0),!1===N.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._deterministicLockstep=N.deterministicLockstep,this._lockstepMaxSteps=N.lockstepMaxSteps,this._doNotHandleContextLost=!!N.doNotHandleContextLost,navigator&&navigator.userAgent)for(var s=navigator.userAgent,t=0,C=D.ExceptionList;t<C.length;t++){var J=C[t],Q=J.key,$=J.targets;if(new RegExp(Q).test(s)){if(J.capture&&J.captureConstraint){var aa=J.capture,ba=J.captureConstraint,ia=new RegExp(aa).exec(s);if(ia&&ia.length>0){if(parseInt(ia[ia.length-1])>=ba)continue}}for(var qa=0,ja=$;qa<ja.length;qa++)switch(ja[qa]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}if(!N.disableWebGL2Support)try{this._gl=n.getContext("webgl2",N)||n.getContext("experimental-webgl2",N),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(Sa){}if(!this._gl){if(!n)throw new Error("The provided canvas is null or undefined.");try{this._gl=n.getContext("webgl",N)||n.getContext("experimental-webgl",N)}catch(Sa){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported");this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._onCanvasFocus=function(){g.onCanvasFocusObservable.notifyObservers(g)},this._onCanvasBlur=function(){g.onCanvasBlurObservable.notifyObservers(g)},n.addEventListener("focus",this._onCanvasFocus),n.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){g.disablePerformanceMonitorInBackground&&g._performanceMonitor.disable(),g._windowIsBackground=!0},this._onFocus=function(){g.disablePerformanceMonitorInBackground&&g._performanceMonitor.enable(),g._windowIsBackground=!1},this._onCanvasPointerOut=function(Sa){g.onCanvasPointerOutObservable.notifyObservers(Sa)},G.a.IsWindowObjectExist()&&(window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus)),n.addEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._onContextLost=function(Sa){Sa.preventDefault(),g._contextWasLost=!0,M.a.Warn("WebGL context lost."),g.onContextLostObservable.notifyObservers(g)},this._onContextRestored=function(){setTimeout(function(){g._initGLContext(),g._rebuildEffects(),g._rebuildInternalTextures(),g._rebuildBuffers(),g.wipeCaches(!0),M.a.Warn("WebGL context successfully restored."),g.onContextRestoredObservable.notifyObservers(g),g._contextWasLost=!1},0)},n.addEventListener("webglcontextlost",this._onContextLost,!1),n.addEventListener("webglcontextrestored",this._onContextRestored,!1)),N.doNotHandleTouchAction||this._disableTouchAction()}else{this._gl=F,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var sa=this._gl.getContextAttributes();sa&&(N.stencil=sa.stencil)}void 0!==N.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=N.useHighPrecisionFloats);var za=G.a.IsWindowObjectExist()&&window.devicePixelRatio||1,Fa=N.limitDeviceRatio||za;if(this._hardwareScalingLevel=p?1/Math.min(Fa,za):1,this.resize(),this._isStencilEnable=!!N.stencil,this._initGLContext(),n){var Ea=document;this._onFullscreenChange=function(){void 0!==Ea.fullscreen?g.isFullscreen=Ea.fullscreen:void 0!==Ea.mozFullScreen?g.isFullscreen=Ea.mozFullScreen:void 0!==Ea.webkitIsFullScreen?g.isFullscreen=Ea.webkitIsFullScreen:void 0!==Ea.msIsFullScreen&&(g.isFullscreen=Ea.msIsFullScreen),g.isFullscreen&&g._pointerLockRequested&&n&&(n.requestPointerLock=n.requestPointerLock||n.msRequestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock,n.requestPointerLock&&n.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){g.isPointerLock=Ea.mozPointerLockElement===n||Ea.webkitPointerLockElement===n||Ea.msPointerLockElement===n||Ea.pointerLockElement===n},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),this._connectVREvents(n,Ea)}!D.audioEngine&&N.audioEngine&&D.AudioEngineFactory&&(D.audioEngine=D.AudioEngineFactory(this.getRenderingCanvas()));for(var Ba=0;Ba<this._caps.maxVertexAttribs;Ba++)this._currentBufferPointers[Ba]=new ca();this._prepareVRComponent(),N.autoEnableWebVR&&this.initWebVR(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),console.log("Babylon.js v"+D.Version+" - "+this.description),this.enableOfflineSupport=void 0!==D.OfflineProviderFactory}}return Object.defineProperty(D,"Instances",{get:function(){return R.a.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(D,"LastCreatedEngine",{get:function(){return R.a.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(D,"LastCreatedScene",{get:function(){return R.a.LastCreatedScene},enumerable:!0,configurable:!0}),D.MarkAllMaterialsAsDirty=function(F,L){for(var N=0;N<D.Instances.length;N++)for(var p=D.Instances[N],g=0;g<p.scenes.length;g++)p.scenes[g].markAllMaterialsAsDirty(F,L)},Object.defineProperty(D,"NpmPackage",{get:function(){return"babylonjs@4.0.3"},enumerable:!0,configurable:!0}),Object.defineProperty(D,"Version",{get:function(){return"4.0.3"},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"description",{get:function(){var F="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(F+=" - Parallel shader compilation"),F},enumerable:!0,configurable:!0}),Object.defineProperty(D,"ShadersRepository",{get:function(){return u.a.ShadersRepository},set:function(F){u.a.ShadersRepository=F},enumerable:!0,configurable:!0}),D.DefaultLoadingScreenFactory=function(F){throw Y.a.WarnImport("LoadingScreen")},Object.defineProperty(D.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"_shouldUseHighPrecisionShader",{get:function(){return this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(F){this._doNotHandleContextLost=F},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,D.TEXTUREFORMAT_RGBA,!1,!1,D.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,D.TEXTUREFORMAT_RGBA,!1,!1,D.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var F=new Uint8Array(4),L=[F,F,F,F,F,F];this._emptyCubeTexture=this.createRawCubeTexture(L,1,D.TEXTUREFORMAT_RGBA,D.TEXTURETYPE_UNSIGNED_INT,!1,!1,D.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),D.prototype.initWebVR=function(){throw Y.a.WarnImport("WebVRCamera")},D.prototype._prepareVRComponent=function(){},D.prototype._connectVREvents=function(F,L){},D.prototype._submitVRFrame=function(){},D.prototype.disableVR=function(){},D.prototype.isVRPresenting=function(){return!1},D.prototype._requestVRFrame=function(){},D.prototype._disableTouchAction=function(){this._renderingCanvas&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},D.prototype._rebuildInternalTextures=function(){for(var F=0,L=this._internalTexturesCache.slice();F<L.length;F++)L[F]._rebuild()},D.prototype._rebuildEffects=function(){for(var F in this._compiledEffects)this._compiledEffects[F]._prepareEffect();u.a.ResetCache()},D.prototype.areAllEffectsReady=function(){for(var F in this._compiledEffects)if(!this._compiledEffects[F].isReady())return!1;return!0},D.prototype._rebuildBuffers=function(){for(var F=0,L=this.scenes;F<L.length;F++){var N=L[F];N.resetCachedMaterial(),N._rebuildGeometries(),N._rebuildTextures()}for(var p=0,g=this._uniformBuffers;p<g.length;p++)g[p]._rebuild()},D.prototype._initGLContext=function(){this._caps=new T(),this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxCombinedTexturesImageUnits=this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureImageUnits=this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.maxVertexAttribs=this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),this._caps.maxVaryingVectors=this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),this._caps.maxFragmentUniformVectors=this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxVertexUniformVectors=this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),this._glVersion=this._gl.getParameter(this._gl.VERSION);var F=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=F&&(this._glRenderer=this._gl.getParameter(F.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(F.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.standardDerivatives=this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.astc=this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._caps.pvrtc=this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this._caps.etc1=this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),this._caps.etc2=this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.uintIndices=this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!1,this._caps.timerQuery=this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.colorBufferFloat=this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),this._caps.textureFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._caps.textureLOD=!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),this._caps.multiview=this._gl.getExtension("OVR_multiview2"),this._webGLVersion>1)this._caps.drawBuffersExtension=!0;else{var L=this._gl.getExtension("WEBGL_draw_buffers");if(null!==L){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=L.drawBuffersWEBGL.bind(L),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var N=0;N<16;N++)this._gl["COLOR_ATTACHMENT"+N+"_WEBGL"]=L["COLOR_ATTACHMENT"+N+"_WEBGL"]}else this._caps.drawBuffersExtension=!1}if(this._caps.parallelShaderCompile=this._gl.getExtension("KHR_parallel_shader_compile"),this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var p=this._gl.getExtension("WEBGL_depth_texture");null!=p&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=p.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var g=this._gl.getExtension("OES_vertex_array_object");null!=g?(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=g.createVertexArrayOES.bind(g),this._gl.bindVertexArray=g.bindVertexArrayOES.bind(g),this._gl.deleteVertexArray=g.deleteVertexArrayOES.bind(g)):this._caps.vertexArrayObject=!1}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var n=this._gl.getExtension("ANGLE_instanced_arrays");null!=n?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=n.drawArraysInstancedANGLE.bind(n),this._gl.drawElementsInstanced=n.drawElementsInstancedANGLE.bind(n),this._gl.vertexAttribDivisor=n.vertexAttribDivisorANGLE.bind(n)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var s=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),t=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);s&&t&&(this._caps.highPrecisionShaderSupported=0!==s.precision&&0!==t.precision)}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var C=0;C<this._maxSimultaneousTextures;C++)this._nextFreeTextureSlots.push(C)},Object.defineProperty(D.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),D.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=document.createElement("canvas");var F=this._workingCanvas.getContext("2d");F&&(this._workingContext=F)}},D.prototype.resetTextureCache=function(){for(var F in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(F)&&(this._boundTexturesCache[F]=null);this._currentTextureChannel=-1},D.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},D.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},D.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},D.prototype.getAspectRatio=function(F,L){void 0===L&&(L=!1);var N=F.viewport;return this.getRenderWidth(L)*N.width/(this.getRenderHeight(L)*N.height)},D.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},D.prototype.getRenderWidth=function(F){return void 0===F&&(F=!1),!F&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},D.prototype.getRenderHeight=function(F){return void 0===F&&(F=!1),!F&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},D.prototype.getRenderingCanvas=function(){return this._renderingCanvas},D.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},D.prototype.setHardwareScalingLevel=function(F){this._hardwareScalingLevel=F,this.resize()},D.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},D.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},D.prototype.getCaps=function(){return this._caps},D.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},D.prototype.setDepthFunction=function(F){this._depthCullingState.depthFunc=F},D.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},D.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},D.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},D.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},D.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},D.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},D.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},D.prototype.setStencilBuffer=function(F){this._stencilState.stencilTest=F},D.prototype.getStencilMask=function(){return this._stencilState.stencilMask},D.prototype.setStencilMask=function(F){this._stencilState.stencilMask=F},D.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},D.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},D.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},D.prototype.setStencilFunction=function(F){this._stencilState.stencilFunc=F},D.prototype.setStencilFunctionReference=function(F){this._stencilState.stencilFuncRef=F},D.prototype.setStencilFunctionMask=function(F){this._stencilState.stencilFuncMask=F},D.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},D.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},D.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},D.prototype.setStencilOperationFail=function(F){this._stencilState.stencilOpStencilFail=F},D.prototype.setStencilOperationDepthFail=function(F){this._stencilState.stencilOpDepthFail=F},D.prototype.setStencilOperationPass=function(F){this._stencilState.stencilOpStencilDepthPass=F},D.prototype.setDitheringState=function(F){F?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},D.prototype.setRasterizerState=function(F){F?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},D.prototype.stopRenderLoop=function(F){if(F){var L=this._activeRenderLoops.indexOf(F);L>=0&&this._activeRenderLoops.splice(L,1)}else this._activeRenderLoops=[]},D.prototype._renderLoop=function(){if(!this._contextWasLost){var F=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(F=!1),F){this.beginFrame();for(var L=0;L<this._activeRenderLoops.length;L++)(0,this._activeRenderLoops[L])();this.endFrame()}}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=A.h.QueueNewFrame(this.customAnimationFrameRequester.renderFunction||this._bindedRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=A.h.QueueNewFrame(this._bindedRenderFunction):this._renderingQueueLaunched=!1},D.prototype.runRenderLoop=function(F){-1===this._activeRenderLoops.indexOf(F)&&(this._activeRenderLoops.push(F),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),this._frameHandler=A.h.QueueNewFrame(this._bindedRenderFunction)))},D.prototype.switchFullscreen=function(F){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(F)},D.prototype.enterFullscreen=function(F){this.isFullscreen||(this._pointerLockRequested=F,this._renderingCanvas&&A.h.RequestFullscreen(this._renderingCanvas))},D.prototype.exitFullscreen=function(){this.isFullscreen&&A.h.ExitFullscreen()},D.prototype.clear=function(F,L,N,p){void 0===p&&(p=!1),this.applyStates();var g=0;L&&F&&(this._gl.clearColor(F.r,F.g,F.b,void 0!==F.a?F.a:1),g|=this._gl.COLOR_BUFFER_BIT),N&&(this._gl.clearDepth(1),g|=this._gl.DEPTH_BUFFER_BIT),p&&(this._gl.clearStencil(0),g|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(g)},D.prototype.scissorClear=function(F,L,N,p,g){this.enableScissor(F,L,N,p),this.clear(g,!0,!0,!0),this.disableScissor()},D.prototype.enableScissor=function(F,L,N,p){var g=this._gl;g.enable(g.SCISSOR_TEST),g.scissor(F,L,N,p)},D.prototype.disableScissor=function(){var F=this._gl;F.disable(F.SCISSOR_TEST)},D.prototype._viewport=function(F,L,N,p){F===this._viewportCached.x&&L===this._viewportCached.y&&N===this._viewportCached.z&&p===this._viewportCached.w||(this._viewportCached.x=F,this._viewportCached.y=L,this._viewportCached.z=N,this._viewportCached.w=p,this._gl.viewport(F,L,N,p))},D.prototype.setViewport=function(F,L,N){var p=L||this.getRenderWidth(),g=N||this.getRenderHeight(),n=F.x||0,s=F.y||0;this._cachedViewport=F,this._viewport(n*p,s*g,p*F.width,g*F.height)},D.prototype.setDirectViewport=function(F,L,N,p){var g=this._cachedViewport;return this._cachedViewport=null,this._viewport(F,L,N,p),g},D.prototype.beginFrame=function(){this.onBeginFrameObservable.notifyObservers(this),this._measureFps()},D.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},D.prototype.resize=function(){if(!this.isVRPresenting()){var F=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,L=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight;this.setSize(F/this._hardwareScalingLevel,L/this._hardwareScalingLevel)}},D.prototype.setSize=function(F,L){if(this._renderingCanvas&&(this._renderingCanvas.width!==F||this._renderingCanvas.height!==L)){this._renderingCanvas.width=F,this._renderingCanvas.height=L;for(var N=0;N<this.scenes.length;N++)for(var p=this.scenes[N],g=0;g<p.cameras.length;g++)p.cameras[g]._currentRenderId=0;this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},D.prototype.bindFramebuffer=function(F,L,N,p,g,n,s){void 0===s&&(s=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=F,this._bindUnboundFramebuffer(F._MSAAFramebuffer?F._MSAAFramebuffer:F._framebuffer);var t=this._gl;F.isCube&&(void 0===L&&(L=0),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+L,F._webGLTexture,s),n&&(n._generateStencilBuffer?t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_CUBE_MAP_POSITIVE_X+L,n._webGLTexture,s):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_CUBE_MAP_POSITIVE_X+L,n._webGLTexture,s))),this._cachedViewport&&!g?this.setViewport(this._cachedViewport,N,p):(N||(N=F.width,s&&(N/=Math.pow(2,s))),p||(p=F.height,s&&(p/=Math.pow(2,s))),this._viewport(0,0,N,p)),this.wipeCaches()},D.prototype._bindUnboundFramebuffer=function(F){this._currentFramebuffer!==F&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,F),this._currentFramebuffer=F)},D.prototype.unBindFramebuffer=function(F,L,N){void 0===L&&(L=!1),this._currentRenderTarget=null;var p=this._gl;F._MSAAFramebuffer&&(p.bindFramebuffer(p.READ_FRAMEBUFFER,F._MSAAFramebuffer),p.bindFramebuffer(p.DRAW_FRAMEBUFFER,F._framebuffer),p.blitFramebuffer(0,0,F.width,F.height,0,0,F.width,F.height,p.COLOR_BUFFER_BIT,p.NEAREST)),!F.generateMipMaps||L||F.isCube||(this._bindTextureDirectly(p.TEXTURE_2D,F,!0),p.generateMipmap(p.TEXTURE_2D),this._bindTextureDirectly(p.TEXTURE_2D,null)),N&&(F._MSAAFramebuffer&&this._bindUnboundFramebuffer(F._framebuffer),N()),this._bindUnboundFramebuffer(null)},D.prototype.generateMipMapsForCubemap=function(F){if(F.generateMipMaps){var L=this._gl;this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,F,!0),L.generateMipmap(L.TEXTURE_CUBE_MAP),this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,null)}},D.prototype.flushFramebuffer=function(){this._gl.flush()},D.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},D.prototype.createUniformBuffer=function(F){var L=this._gl.createBuffer();if(!L)throw new Error("Unable to create uniform buffer");var N=new ea.a(L);return this.bindUniformBuffer(N),F instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,F,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(F),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),N.references=1,N},D.prototype.createDynamicUniformBuffer=function(F){var L=this._gl.createBuffer();if(!L)throw new Error("Unable to create dynamic uniform buffer");var N=new ea.a(L);return this.bindUniformBuffer(N),F instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,F,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(F),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),N.references=1,N},D.prototype.updateUniformBuffer=function(F,L,N,p){this.bindUniformBuffer(F),void 0===N&&(N=0),void 0===p?L instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,N,L):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,N,new Float32Array(L)):L instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,L.subarray(N,N+p)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(L).subarray(N,N+p)),this.bindUniformBuffer(null)},D.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},D.prototype.createVertexBuffer=function(F){var L=this._gl.createBuffer();if(!L)throw new Error("Unable to create vertex buffer");var N=new ea.a(L);return this.bindArrayBuffer(N),F instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(F),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,F,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),N.references=1,N},D.prototype.createDynamicVertexBuffer=function(F){var L=this._gl.createBuffer();if(!L)throw new Error("Unable to create dynamic vertex buffer");var N=new ea.a(L);return this.bindArrayBuffer(N),F instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(F),this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,F,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),N.references=1,N},D.prototype.updateDynamicIndexBuffer=function(F,L,N){var p;void 0===N&&(N=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(F),p=L instanceof Uint16Array||L instanceof Uint32Array?L:F.is32Bits?new Uint32Array(L):new Uint16Array(L),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,p,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},D.prototype.updateDynamicVertexBuffer=function(F,L,N,p){this.bindArrayBuffer(F),void 0===N&&(N=0),void 0===p?L instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,N,new Float32Array(L)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,N,L):L instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(L).subarray(N,N+p)):(L=L instanceof ArrayBuffer?new Uint8Array(L,N,p):new Uint8Array(L.buffer,L.byteOffset+N,p),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,L)),this._resetVertexBufferBinding()},D.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},D.prototype.createIndexBuffer=function(F,L){var N,p=this._gl.createBuffer(),g=new ea.a(p);if(!p)throw new Error("Unable to create index buffer");this.bindIndexBuffer(g);var n=!1;if(F instanceof Uint16Array)N=F;else if(this._caps.uintIndices)if(F instanceof Uint32Array)N=F,n=!0;else{for(var s=0;s<F.length;s++)if(F[s]>65535){n=!0;break}N=n?new Uint32Array(F):new Uint16Array(F)}else N=new Uint16Array(F);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,N,L?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),g.references=1,g.is32Bits=n,g},D.prototype.bindArrayBuffer=function(F){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(F,this._gl.ARRAY_BUFFER)},D.prototype.bindUniformBuffer=function(F){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,F?F.underlyingResource:null)},D.prototype.bindUniformBufferBase=function(F,L){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,L,F?F.underlyingResource:null)},D.prototype.bindUniformBlock=function(F,L,N){var p=F.program,g=this._gl.getUniformBlockIndex(p,L);this._gl.uniformBlockBinding(p,g,N)},D.prototype.bindIndexBuffer=function(F){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(F,this._gl.ELEMENT_ARRAY_BUFFER)},D.prototype.bindBuffer=function(F,L){(this._vaoRecordInProgress||this._currentBoundBuffer[L]!==F)&&(this._gl.bindBuffer(L,F?F.underlyingResource:null),this._currentBoundBuffer[L]=F)},D.prototype.updateArrayBuffer=function(F){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,F)},D.prototype._vertexAttribPointer=function(F,L,N,p,g,n,s){var t=this._currentBufferPointers[L],C=!1;t.active?(t.buffer!==F&&(t.buffer=F,C=!0),t.size!==N&&(t.size=N,C=!0),t.type!==p&&(t.type=p,C=!0),t.normalized!==g&&(t.normalized=g,C=!0),t.stride!==n&&(t.stride=n,C=!0),t.offset!==s&&(t.offset=s,C=!0)):(C=!0,t.active=!0,t.index=L,t.size=N,t.type=p,t.normalized=g,t.stride=n,t.offset=s,t.buffer=F),(C||this._vaoRecordInProgress)&&(this.bindArrayBuffer(F),this._gl.vertexAttribPointer(L,N,p,g,n,s))},D.prototype._bindIndexBufferWithCache=function(F){null!=F&&this._cachedIndexBuffer!==F&&(this._cachedIndexBuffer=F,this.bindIndexBuffer(F),this._uintIndicesCurrentlySet=F.is32Bits)},D.prototype._bindVertexBuffersAttributes=function(F,L){var N=L.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var p=0;p<N.length;p++){var g=L.getAttributeLocation(p);if(g>=0){var n=F[N[p]];if(!n)continue;this._gl.enableVertexAttribArray(g),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[g]=!0);var s=n.getBuffer();s&&(this._vertexAttribPointer(s,g,n.getSize(),n.type,n.normalized,n.byteStride,n.byteOffset),n.getIsInstanced()&&(this._gl.vertexAttribDivisor(g,n.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(g),this._currentInstanceBuffers.push(s))))}}},D.prototype.recordVertexArrayObject=function(F,L,N){var p=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(p),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(F,N),this.bindIndexBuffer(L),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),p},D.prototype.bindVertexArrayObject=function(F,L){this._cachedVertexArrayObject!==F&&(this._cachedVertexArrayObject=F,this._gl.bindVertexArray(F),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=L&&L.is32Bits,this._mustWipeVertexAttributes=!0)},D.prototype.bindBuffersDirectly=function(F,L,N,p,g){if(this._cachedVertexBuffers!==F||this._cachedEffectForVertexBuffers!==g){this._cachedVertexBuffers=F,this._cachedEffectForVertexBuffers=g;var n=g.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var s=0,t=0;t<n;t++)if(t<N.length){var C=g.getAttributeLocation(t);C>=0&&(this._gl.enableVertexAttribArray(C),this._vertexAttribArraysEnabled[C]=!0,this._vertexAttribPointer(F,C,N[t],this._gl.FLOAT,!1,p,s)),s+=4*N[t]}}this._bindIndexBufferWithCache(L)},D.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},D.prototype.bindBuffers=function(F,L,N){this._cachedVertexBuffers===F&&this._cachedEffectForVertexBuffers===N||(this._cachedVertexBuffers=F,this._cachedEffectForVertexBuffers=N,this._bindVertexBuffersAttributes(F,N)),this._bindIndexBufferWithCache(L)},D.prototype.unbindInstanceAttributes=function(){for(var F,L=0,N=this._currentInstanceLocations.length;L<N;L++){var p=this._currentInstanceBuffers[L];F!=p&&p.references&&(F=p,this.bindArrayBuffer(p));var g=this._currentInstanceLocations[L];this._gl.vertexAttribDivisor(g,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},D.prototype.releaseVertexArrayObject=function(F){this._gl.deleteVertexArray(F)},D.prototype._releaseBuffer=function(F){return F.references--,0===F.references&&(this._gl.deleteBuffer(F.underlyingResource),!0)},D.prototype.createInstancesBuffer=function(F){var L=this._gl.createBuffer();if(!L)throw new Error("Unable to create instance buffer");var N=new ea.a(L);return N.capacity=F,this.bindArrayBuffer(N),this._gl.bufferData(this._gl.ARRAY_BUFFER,F,this._gl.DYNAMIC_DRAW),N},D.prototype.deleteInstancesBuffer=function(F){this._gl.deleteBuffer(F)},D.prototype.updateAndBindInstancesBuffer=function(F,L,N){if(this.bindArrayBuffer(F),L&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,L),void 0!==N[0].index){for(var p=0,g=0;g<N.length;g++)p+=4*(n=N[g]).attributeSize;for(g=0;g<N.length;g++){var n=N[g];this._vertexAttribArraysEnabled[n.index]||(this._gl.enableVertexAttribArray(n.index),this._vertexAttribArraysEnabled[n.index]=!0),this._vertexAttribPointer(F,n.index,n.attributeSize,n.attribyteType||this._gl.FLOAT,n.normalized||!1,p,n.offset),this._gl.vertexAttribDivisor(n.index,1),this._currentInstanceLocations.push(n.index),this._currentInstanceBuffers.push(F)}}else for(var s=0;s<4;s++){var t=N[s];this._vertexAttribArraysEnabled[t]||(this._gl.enableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!0),this._vertexAttribPointer(F,t,4,this._gl.FLOAT,!1,64,16*s),this._gl.vertexAttribDivisor(t,1),this._currentInstanceLocations.push(t),this._currentInstanceBuffers.push(F)}},D.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl)},D.prototype.draw=function(F,L,N,p){this.drawElementsType(F?w.a.TriangleFillMode:w.a.WireFrameFillMode,L,N,p)},D.prototype.drawPointClouds=function(F,L,N){this.drawArraysType(w.a.PointFillMode,F,L,N)},D.prototype.drawUnIndexed=function(F,L,N,p){this.drawArraysType(F?w.a.TriangleFillMode:w.a.WireFrameFillMode,L,N,p)},D.prototype.drawElementsType=function(F,L,N,p){this.applyStates(),this._drawCalls.addCount(1,!1);var g=this._drawMode(F),n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,s=this._uintIndicesCurrentlySet?4:2;p?this._gl.drawElementsInstanced(g,N,n,L*s,p):this._gl.drawElements(g,N,n,L*s)},D.prototype.drawArraysType=function(F,L,N,p){this.applyStates(),this._drawCalls.addCount(1,!1);var g=this._drawMode(F);p?this._gl.drawArraysInstanced(g,L,N,p):this._gl.drawArrays(g,L,N)},D.prototype._drawMode=function(F){switch(F){case w.a.TriangleFillMode:return this._gl.TRIANGLES;case w.a.PointFillMode:return this._gl.POINTS;case w.a.WireFrameFillMode:return this._gl.LINES;case w.a.PointListDrawMode:return this._gl.POINTS;case w.a.LineListDrawMode:return this._gl.LINES;case w.a.LineLoopDrawMode:return this._gl.LINE_LOOP;case w.a.LineStripDrawMode:return this._gl.LINE_STRIP;case w.a.TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case w.a.TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},D.prototype._releaseEffect=function(F){this._compiledEffects[F._key]&&(delete this._compiledEffects[F._key],this._deletePipelineContext(F.getPipelineContext()))},D.prototype._deletePipelineContext=function(F){var L=F;L&&L.program&&(L.program.__SPECTOR_rebuildProgram=null,L.transformFeedback&&(this.deleteTransformFeedback(L.transformFeedback),L.transformFeedback=null),this._gl.deleteProgram(L.program))},D.prototype.createEffect=function(F,L,N,p,g,n,s,t,C){var J=(F.vertexElement||F.vertex||F)+"+"+(F.fragmentElement||F.fragment||F)+"@"+(g||L.defines);if(this._compiledEffects[J]){var Q=this._compiledEffects[J];return s&&Q.isReady()&&s(Q),Q}var $=new u.a(F,L,N,p,this,g,n,s,t,C);return $._key=J,this._compiledEffects[J]=$,$},D.prototype._compileShader=function(F,L,N,p){return this._compileRawShader(p+(N?N+`
`:"")+F,L)},D.prototype._compileRawShader=function(F,L){var N=this._gl,p=N.createShader("vertex"===L?N.VERTEX_SHADER:N.FRAGMENT_SHADER);if(!p)throw new Error("Something went wrong while compile the shader.");return N.shaderSource(p,F),N.compileShader(p),p},D.prototype.createRawShaderProgram=function(F,L,N,p,g){void 0===g&&(g=null),p=p||this._gl;var n=this._compileRawShader(L,"vertex"),s=this._compileRawShader(N,"fragment");return this._createShaderProgram(F,n,s,p,g)},D.prototype.createShaderProgram=function(F,L,N,p,g,n){void 0===n&&(n=null),g=g||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var s=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",t=this._compileShader(L,"vertex",p,s),C=this._compileShader(N,"fragment",p,s),J=this._createShaderProgram(F,t,C,g,n);return this.onAfterShaderCompilationObservable.notifyObservers(this),J},D.prototype.createPipelineContext=function(){var F=new X.a();return F.engine=this,this._caps.parallelShaderCompile&&(F.isParallelCompiled=!0),F},D.prototype._createShaderProgram=function(F,L,N,p,g){void 0===g&&(g=null);var n=p.createProgram();if(F.program=n,!n)throw new Error("Unable to create program");if(p.attachShader(n,L),p.attachShader(n,N),this.webGLVersion>1&&g){var s=this.createTransformFeedback();this.bindTransformFeedback(s),this.setTranformFeedbackVaryings(n,g),F.transformFeedback=s}return p.linkProgram(n),this.webGLVersion>1&&g&&this.bindTransformFeedback(null),F.context=p,F.vertexShader=L,F.fragmentShader=N,F.isParallelCompiled||this._finalizePipelineContext(F),n},D.prototype._finalizePipelineContext=function(F){var L=F.context,N=F.vertexShader,p=F.fragmentShader,g=F.program;if(!L.getProgramParameter(g,L.LINK_STATUS)){var n,s;if(!this._gl.getShaderParameter(N,this._gl.COMPILE_STATUS)){if(n=this._gl.getShaderInfoLog(N))throw new Error(n)}if(!this._gl.getShaderParameter(p,this._gl.COMPILE_STATUS)){if(n=this._gl.getShaderInfoLog(p))throw new Error(n)}if(s=L.getProgramInfoLog(g))throw new Error(s)}if(this.validateShaderPrograms&&(L.validateProgram(g),!L.getProgramParameter(g,L.VALIDATE_STATUS)&&(s=L.getProgramInfoLog(g))))throw new Error(s);L.deleteShader(N),L.deleteShader(p),F.vertexShader=void 0,F.fragmentShader=void 0,F.onCompiled&&(F.onCompiled(),F.onCompiled=void 0)},D.prototype._preparePipelineContext=function(F,L,N,p,g,n,s){var t=F;t.program=p?this.createRawShaderProgram(t,L,N,void 0,s):this.createShaderProgram(t,L,N,n,void 0,s),t.program.__SPECTOR_rebuildProgram=g},D.prototype._isRenderingStateCompiled=function(F){var L=F;return!!this._gl.getProgramParameter(L.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(L),!0)},D.prototype._executeWhenRenderingStateIsCompiled=function(F,L){var N=F;N.isParallelCompiled?N.onCompiled=L:L()},D.prototype.getUniforms=function(F,L){for(var N=new Array(),p=F,g=0;g<L.length;g++)N.push(this._gl.getUniformLocation(p.program,L[g]));return N},D.prototype.getAttributes=function(F,L){for(var N=[],p=F,g=0;g<L.length;g++)try{N.push(this._gl.getAttribLocation(p.program,L[g]))}catch(n){N.push(-1)}return N},D.prototype.enableEffect=function(F){F&&F!==this._currentEffect&&(this.bindSamplers(F),this._currentEffect=F,F.onBind&&F.onBind(F),F._onBindObservable&&F._onBindObservable.notifyObservers(F))},D.prototype.setIntArray=function(F,L){F&&this._gl.uniform1iv(F,L)},D.prototype.setIntArray2=function(F,L){F&&L.length%2==0&&this._gl.uniform2iv(F,L)},D.prototype.setIntArray3=function(F,L){F&&L.length%3==0&&this._gl.uniform3iv(F,L)},D.prototype.setIntArray4=function(F,L){F&&L.length%4==0&&this._gl.uniform4iv(F,L)},D.prototype.setFloatArray=function(F,L){F&&this._gl.uniform1fv(F,L)},D.prototype.setFloatArray2=function(F,L){F&&L.length%2==0&&this._gl.uniform2fv(F,L)},D.prototype.setFloatArray3=function(F,L){F&&L.length%3==0&&this._gl.uniform3fv(F,L)},D.prototype.setFloatArray4=function(F,L){F&&L.length%4==0&&this._gl.uniform4fv(F,L)},D.prototype.setArray=function(F,L){F&&this._gl.uniform1fv(F,L)},D.prototype.setArray2=function(F,L){F&&L.length%2==0&&this._gl.uniform2fv(F,L)},D.prototype.setArray3=function(F,L){F&&L.length%3==0&&this._gl.uniform3fv(F,L)},D.prototype.setArray4=function(F,L){F&&L.length%4==0&&this._gl.uniform4fv(F,L)},D.prototype.setMatrices=function(F,L){F&&this._gl.uniformMatrix4fv(F,!1,L)},D.prototype.setMatrix=function(F,L){F&&this._gl.uniformMatrix4fv(F,!1,L.toArray())},D.prototype.setMatrix3x3=function(F,L){F&&this._gl.uniformMatrix3fv(F,!1,L)},D.prototype.setMatrix2x2=function(F,L){F&&this._gl.uniformMatrix2fv(F,!1,L)},D.prototype.setInt=function(F,L){F&&this._gl.uniform1i(F,L)},D.prototype.setFloat=function(F,L){F&&this._gl.uniform1f(F,L)},D.prototype.setFloat2=function(F,L,N){F&&this._gl.uniform2f(F,L,N)},D.prototype.setFloat3=function(F,L,N,p){F&&this._gl.uniform3f(F,L,N,p)},D.prototype.setBool=function(F,L){F&&this._gl.uniform1i(F,L)},D.prototype.setFloat4=function(F,L,N,p,g){F&&this._gl.uniform4f(F,L,N,p,g)},D.prototype.setColor3=function(F,L){F&&this._gl.uniform3f(F,L.r,L.g,L.b)},D.prototype.setColor4=function(F,L,N){F&&this._gl.uniform4f(F,L.r,L.g,L.b,N)},D.prototype.setDirectColor4=function(F,L){F&&this._gl.uniform4f(F,L.r,L.g,L.b,L.a)},D.prototype.setState=function(F,L,N,p){void 0===L&&(L=0),void 0===p&&(p=!1),(this._depthCullingState.cull!==F||N)&&(this._depthCullingState.cull=F);var g=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==g||N)&&(this._depthCullingState.cullFace=g),this.setZOffset(L);var n=p?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==n||N)&&(this._depthCullingState.frontFace=n)},D.prototype.setZOffset=function(F){this._depthCullingState.zOffset=F},D.prototype.getZOffset=function(){return this._depthCullingState.zOffset},D.prototype.setDepthBuffer=function(F){this._depthCullingState.depthTest=F},D.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},D.prototype.setDepthWrite=function(F){this._depthCullingState.depthMask=F},D.prototype.setColorWrite=function(F){this._gl.colorMask(F,F,F,F),this._colorWrite=F},D.prototype.getColorWrite=function(){return this._colorWrite},D.prototype.setAlphaConstants=function(F,L,N,p){this._alphaState.setAlphaBlendConstants(F,L,N,p)},D.prototype.setAlphaMode=function(F,L){if(void 0===L&&(L=!1),this._alphaMode!==F){switch(F){case D.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case D.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case D.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case D.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case D.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case D.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case D.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case D.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case D.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case D.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case D.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}L||this.setDepthWrite(F===D.ALPHA_DISABLE),this._alphaMode=F}},D.prototype.getAlphaMode=function(){return this._alphaMode},D.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},D.prototype.wipeCaches=function(F){this.preventCacheWipeBetweenFrames&&!F||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,F&&(this.resetTextureCache(),this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset(),this._unpackFlipYCached=null),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this._unbindVertexArrayObject(),this.bindIndexBuffer(null))},D.prototype.setTextureFormatToUse=function(F){for(var L=0,N=this.texturesSupported.length;L<N;L++)for(var p=0,g=F.length;p<g;p++)if(this._texturesSupported[L]===F[p].toLowerCase())return this._textureFormatInUse=this._texturesSupported[L];return this._textureFormatInUse=null,null},D.prototype._getSamplingParameters=function(F,L){var N=this._gl,p=N.NEAREST,g=N.NEAREST;switch(F){case D.TEXTURE_BILINEAR_SAMPLINGMODE:p=N.LINEAR,g=L?N.LINEAR_MIPMAP_NEAREST:N.LINEAR;break;case D.TEXTURE_TRILINEAR_SAMPLINGMODE:p=N.LINEAR,g=L?N.LINEAR_MIPMAP_LINEAR:N.LINEAR;break;case D.TEXTURE_NEAREST_SAMPLINGMODE:p=N.NEAREST,g=L?N.NEAREST_MIPMAP_LINEAR:N.NEAREST;break;case D.TEXTURE_NEAREST_NEAREST_MIPNEAREST:p=N.NEAREST,g=L?N.NEAREST_MIPMAP_NEAREST:N.NEAREST;break;case D.TEXTURE_NEAREST_LINEAR_MIPNEAREST:p=N.NEAREST,g=L?N.LINEAR_MIPMAP_NEAREST:N.LINEAR;break;case D.TEXTURE_NEAREST_LINEAR_MIPLINEAR:p=N.NEAREST,g=L?N.LINEAR_MIPMAP_LINEAR:N.LINEAR;break;case D.TEXTURE_NEAREST_LINEAR:p=N.NEAREST,g=N.LINEAR;break;case D.TEXTURE_NEAREST_NEAREST:p=N.NEAREST,g=N.NEAREST;break;case D.TEXTURE_LINEAR_NEAREST_MIPNEAREST:p=N.LINEAR,g=L?N.NEAREST_MIPMAP_NEAREST:N.NEAREST;break;case D.TEXTURE_LINEAR_NEAREST_MIPLINEAR:p=N.LINEAR,g=L?N.NEAREST_MIPMAP_LINEAR:N.NEAREST;break;case D.TEXTURE_LINEAR_LINEAR:p=N.LINEAR,g=N.LINEAR;break;case D.TEXTURE_LINEAR_NEAREST:p=N.LINEAR,g=N.NEAREST}return{min:g,mag:p}},D.prototype._createTexture=function(){var F=this._gl.createTexture();if(!F)throw new Error("Unable to create texture");return F},D.prototype.createTexture=function(F,L,N,p,g,n,s,t,C,J,Q,$){var aa=this;void 0===g&&(g=D.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===n&&(n=null),void 0===s&&(s=null),void 0===t&&(t=null),void 0===C&&(C=null),void 0===J&&(J=null),void 0===Q&&(Q=null),void 0===$&&($=[]);for(var ba=String(F),ia="data:"===ba.substr(0,5),qa="blob:"===ba.substr(0,5),ja=ia&&-1!==ba.indexOf(";base64,"),sa=C||new y.a(this,y.a.DATASOURCE_URL),za=ba.lastIndexOf("."),Fa=Q||(za>-1?ba.substring(za).toLowerCase():""),Ea=null,Ba=0,Sa=D._TextureLoaders;Ba<Sa.length;Ba++){var Xa=Sa[Ba];if(-1===$.indexOf(Xa)&&Xa.canLoad(Fa,this._textureFormatInUse,C,ja,!!t)){Ea=Xa;break}}Ea&&(ba=Ea.transformUrl(ba,this._textureFormatInUse)),p&&p._addPendingData(sa),sa.url=ba,sa.generateMipMaps=!L,sa.samplingMode=g,sa.invertY=N,this._doNotHandleContextLost||(sa._buffer=t);var Ka=null;n&&!C&&(Ka=sa.onLoadedObservable.add(n)),C||this._internalTexturesCache.push(sa);var Ga=function(bb,fb){p&&p._removePendingData(sa);var ob=!1;Ea&&(Ea.getFallbackTextureUrl(ba,aa._textureFormatInUse)&&(ob=!0,$.push(Ea),A.h.Warn(Ea.constructor.name+" failed when trying to load "+sa.url+", falling back to the next supported loader"),aa.createTexture(F,L,sa.invertY,p,g,null,null,t,sa,void 0,void 0,$))),ob||(Ka&&sa.onLoadedObservable.remove(Ka),A.h.UseFallbackTexture&&aa.createTexture(A.h.fallbackTexture,L,sa.invertY,p,g,null,null,t,sa)),s&&s(bb||"Unknown error",fb)};if(Ea){var nb=function(bb){Ea.loadData(bb,sa,function(fb,ob,Cb,gb,qb,yb){yb?Ga("TextureLoader failed to load data"):aa._prepareWebGLTexture(sa,p,fb,ob,sa.invertY,!Cb,gb,function(){return qb(),!1},g)})};t?nb(t):this._loadFile(ba,nb,void 0,p?p.offlineProvider:void 0,!0,function(bb,fb){Ga("Unable to load "+(bb&&bb.responseURL,fb))})}else{var jb=function(bb){qa&&!aa._doNotHandleContextLost&&(sa._buffer=bb),aa._prepareWebGLTexture(sa,p,bb.width,bb.height,sa.invertY,L,!1,function(fb,ob,Cb){var gb=aa._gl,qb=bb.width===fb&&bb.height===ob,yb=J?aa._getInternalFormat(J):".jpg"===Fa?gb.RGB:gb.RGBA;if(qb)return gb.texImage2D(gb.TEXTURE_2D,0,yb,yb,gb.UNSIGNED_BYTE,bb),!1;var Lb=aa._caps.maxTextureSize;if(bb.width>Lb||bb.height>Lb||null===D._RescalePostProcessFactory)return aa._prepareWorkingCanvas(),!(!aa._workingCanvas||!aa._workingContext)&&(aa._workingCanvas.width=fb,aa._workingCanvas.height=ob,aa._workingContext.drawImage(bb,0,0,bb.width,bb.height,0,0,fb,ob),gb.texImage2D(gb.TEXTURE_2D,0,yb,yb,gb.UNSIGNED_BYTE,aa._workingCanvas),sa.width=fb,sa.height=ob,!1);var Mb=new y.a(aa,y.a.DATASOURCE_TEMP);return aa._bindTextureDirectly(gb.TEXTURE_2D,Mb,!0),gb.texImage2D(gb.TEXTURE_2D,0,yb,yb,gb.UNSIGNED_BYTE,bb),gb.texParameteri(gb.TEXTURE_2D,gb.TEXTURE_MAG_FILTER,gb.LINEAR),gb.texParameteri(gb.TEXTURE_2D,gb.TEXTURE_MIN_FILTER,gb.LINEAR),gb.texParameteri(gb.TEXTURE_2D,gb.TEXTURE_WRAP_S,gb.CLAMP_TO_EDGE),gb.texParameteri(gb.TEXTURE_2D,gb.TEXTURE_WRAP_T,gb.CLAMP_TO_EDGE),aa._rescaleTexture(Mb,sa,p,yb,function(){aa._releaseTexture(Mb),aa._bindTextureDirectly(gb.TEXTURE_2D,sa,!0),Cb()}),!0},g)};!ia||ja?t instanceof HTMLImageElement?jb(t):A.h.LoadImage(ba,jb,Ga,p?p.offlineProvider:null):"string"==typeof t||t instanceof ArrayBuffer||t instanceof Blob?A.h.LoadImage(t,jb,Ga,p?p.offlineProvider:null):jb(t)}return sa},D.prototype._rescaleTexture=function(F,L,N,p,g){var n=this,s=this.createRenderTargetTexture({width:L.width,height:L.height},{generateMipMaps:!1,type:D.TEXTURETYPE_UNSIGNED_INT,samplingMode:D.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&D._RescalePostProcessFactory&&(this._rescalePostProcess=D._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){n._rescalePostProcess.onApply=function(C){C._bindTexture("textureSampler",F)};var t=N;t||(t=n.scenes[n.scenes.length-1]),t.postProcessManager.directRender([n._rescalePostProcess],s,!0),n._bindTextureDirectly(n._gl.TEXTURE_2D,L,!0),n._gl.copyTexImage2D(n._gl.TEXTURE_2D,0,p,0,0,L.width,L.height,0),n.unBindFramebuffer(s),n._releaseTexture(s),g&&g()})},D.prototype.createRawTexture=function(F,L,N,p,g,n,s,t,C){throw void 0===t&&(t=null),void 0===C&&(C=D.TEXTURETYPE_UNSIGNED_INT),Y.a.WarnImport("Engine.RawTexture")},D.prototype._unpackFlipY=function(F){this._unpackFlipYCached!==F&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,F?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=F))},D.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},D.prototype.createDynamicTexture=function(F,L,N,p){var g=new y.a(this,y.a.DATASOURCE_DYNAMIC);return g.baseWidth=F,g.baseHeight=L,N&&(F=this.needPOTTextures?A.h.GetExponentOfTwo(F,this._caps.maxTextureSize):F,L=this.needPOTTextures?A.h.GetExponentOfTwo(L,this._caps.maxTextureSize):L),g.width=F,g.height=L,g.isReady=!1,g.generateMipMaps=N,g.samplingMode=p,this.updateTextureSamplingMode(p,g),this._internalTexturesCache.push(g),g},D.prototype.updateTextureSamplingMode=function(F,L){var N=this._getSamplingParameters(F,L.generateMipMaps);L.isCube?(this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,N.mag,L),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,N.min),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):L.is3D?(this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,N.mag,L),this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,N.min),this._bindTextureDirectly(this._gl.TEXTURE_3D,null)):(this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,N.mag,L),this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,N.min),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),L.samplingMode=F},D.prototype.updateDynamicTexture=function(F,L,N,p,g,n){if(void 0===p&&(p=!1),void 0===n&&(n=!1),F){this._bindTextureDirectly(this._gl.TEXTURE_2D,F,!0,n),this._unpackFlipY(N),p&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var s=g?this._getInternalFormat(g):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,s,s,this._gl.UNSIGNED_BYTE,L),F.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),p&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),F.isReady=!0}},D.prototype.updateVideoTexture=function(F,L,N){if(F&&!F._isDisabled){var p=this._bindTextureDirectly(this._gl.TEXTURE_2D,F,!0);this._unpackFlipY(!N);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,L),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,L);else{if(!F._workingCanvas){F._workingCanvas=document.createElement("canvas");var g=F._workingCanvas.getContext("2d");if(!g)throw new Error("Unable to get 2d context");F._workingContext=g,F._workingCanvas.width=F.width,F._workingCanvas.height=F.height}F._workingContext.drawImage(L,0,0,L.videoWidth,L.videoHeight,0,0,F.width,F.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,F._workingCanvas)}F.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),p||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),F.isReady=!0}catch(n){F._isDisabled=!0}}},D.prototype.updateTextureComparisonFunction=function(F,L){if(1!==this.webGLVersion){var N=this._gl;F.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,F,!0),0===L?(N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_COMPARE_FUNC,D.LEQUAL),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_COMPARE_MODE,N.NONE)):(N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_COMPARE_FUNC,L),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_COMPARE_MODE,N.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,F,!0),0===L?(N.texParameteri(N.TEXTURE_2D,N.TEXTURE_COMPARE_FUNC,D.LEQUAL),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_COMPARE_MODE,N.NONE)):(N.texParameteri(N.TEXTURE_2D,N.TEXTURE_COMPARE_FUNC,L),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_COMPARE_MODE,N.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),F._comparisonFunction=L}else M.a.Error("WebGL 1 does not support texture comparison.")},D.prototype._setupDepthStencilTexture=function(F,L,N,p,g){var n=L.width||L,s=L.height||L;F.baseWidth=n,F.baseHeight=s,F.width=n,F.height=s,F.isReady=!0,F.samples=1,F.generateMipMaps=!1,F._generateDepthBuffer=!0,F._generateStencilBuffer=N,F.samplingMode=p?D.TEXTURE_BILINEAR_SAMPLINGMODE:D.TEXTURE_NEAREST_SAMPLINGMODE,F.type=D.TEXTURETYPE_UNSIGNED_INT,F._comparisonFunction=g;var t=this._gl,C=F.isCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,J=this._getSamplingParameters(F.samplingMode,!1);t.texParameteri(C,t.TEXTURE_MAG_FILTER,J.mag),t.texParameteri(C,t.TEXTURE_MIN_FILTER,J.min),t.texParameteri(C,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(C,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),0===g?(t.texParameteri(C,t.TEXTURE_COMPARE_FUNC,D.LEQUAL),t.texParameteri(C,t.TEXTURE_COMPARE_MODE,t.NONE)):(t.texParameteri(C,t.TEXTURE_COMPARE_FUNC,g),t.texParameteri(C,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE))},D.prototype.createDepthStencilTexture=function(F,L){if(L.isCube){var N=F.width||F;return this._createDepthStencilCubeTexture(N,L)}return this._createDepthStencilTexture(F,L)},D.prototype._createDepthStencilTexture=function(F,L){var N=new y.a(this,y.a.DATASOURCE_DEPTHTEXTURE);if(!this._caps.depthTextureExtension)return M.a.Error("Depth texture is not supported by your browser or hardware."),N;var p=O.a({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},L),g=this._gl;return this._bindTextureDirectly(g.TEXTURE_2D,N,!0),this._setupDepthStencilTexture(N,F,p.generateStencil,p.bilinearFiltering,p.comparisonFunction),this.webGLVersion>1?p.generateStencil?g.texImage2D(g.TEXTURE_2D,0,g.DEPTH24_STENCIL8,N.width,N.height,0,g.DEPTH_STENCIL,g.UNSIGNED_INT_24_8,null):g.texImage2D(g.TEXTURE_2D,0,g.DEPTH_COMPONENT24,N.width,N.height,0,g.DEPTH_COMPONENT,g.UNSIGNED_INT,null):p.generateStencil?g.texImage2D(g.TEXTURE_2D,0,g.DEPTH_STENCIL,N.width,N.height,0,g.DEPTH_STENCIL,g.UNSIGNED_INT_24_8,null):g.texImage2D(g.TEXTURE_2D,0,g.DEPTH_COMPONENT,N.width,N.height,0,g.DEPTH_COMPONENT,g.UNSIGNED_INT,null),this._bindTextureDirectly(g.TEXTURE_2D,null),N},D.prototype.setFrameBufferDepthStencilTexture=function(F){var L=F.getInternalTexture();if(L&&L._framebuffer&&F.depthStencilTexture){var N=this._gl,p=F.depthStencilTexture;this._bindUnboundFramebuffer(L._framebuffer),p.isCube?p._generateStencilBuffer?N.framebufferTexture2D(N.FRAMEBUFFER,N.DEPTH_STENCIL_ATTACHMENT,N.TEXTURE_CUBE_MAP_POSITIVE_X,p._webGLTexture,0):N.framebufferTexture2D(N.FRAMEBUFFER,N.DEPTH_ATTACHMENT,N.TEXTURE_CUBE_MAP_POSITIVE_X,p._webGLTexture,0):p._generateStencilBuffer?N.framebufferTexture2D(N.FRAMEBUFFER,N.DEPTH_STENCIL_ATTACHMENT,N.TEXTURE_2D,p._webGLTexture,0):N.framebufferTexture2D(N.FRAMEBUFFER,N.DEPTH_ATTACHMENT,N.TEXTURE_2D,p._webGLTexture,0),this._bindUnboundFramebuffer(null)}},D.prototype.createRenderTargetTexture=function(F,L){var N=new W.a();void 0!==L&&"object"==typeof L?(N.generateMipMaps=L.generateMipMaps,N.generateDepthBuffer=void 0===L.generateDepthBuffer||L.generateDepthBuffer,N.generateStencilBuffer=N.generateDepthBuffer&&L.generateStencilBuffer,N.type=void 0===L.type?D.TEXTURETYPE_UNSIGNED_INT:L.type,N.samplingMode=void 0===L.samplingMode?D.TEXTURE_TRILINEAR_SAMPLINGMODE:L.samplingMode,N.format=void 0===L.format?D.TEXTUREFORMAT_RGBA:L.format):(N.generateMipMaps=L,N.generateDepthBuffer=!0,N.generateStencilBuffer=!1,N.type=D.TEXTURETYPE_UNSIGNED_INT,N.samplingMode=D.TEXTURE_TRILINEAR_SAMPLINGMODE,N.format=D.TEXTUREFORMAT_RGBA),(N.type!==D.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(N.type!==D.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(N.samplingMode=D.TEXTURE_NEAREST_SAMPLINGMODE);var p=this._gl,g=new y.a(this,y.a.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(p.TEXTURE_2D,g,!0);var n=F.width||F,s=F.height||F,t=this._getSamplingParameters(N.samplingMode,!!N.generateMipMaps);N.type!==D.TEXTURETYPE_FLOAT||this._caps.textureFloat||(N.type=D.TEXTURETYPE_UNSIGNED_INT,M.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t.mag),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,t.min),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texImage2D(p.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(N.type,N.format),n,s,0,this._getInternalFormat(N.format),this._getWebGLTextureType(N.type),null);var C=this._currentFramebuffer,J=p.createFramebuffer();return this._bindUnboundFramebuffer(J),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,g._webGLTexture,0),g._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!N.generateStencilBuffer,N.generateDepthBuffer,n,s),N.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(p.TEXTURE_2D,null),p.bindRenderbuffer(p.RENDERBUFFER,null),this._bindUnboundFramebuffer(C),g._framebuffer=J,g.baseWidth=n,g.baseHeight=s,g.width=n,g.height=s,g.isReady=!0,g.samples=1,g.generateMipMaps=!!N.generateMipMaps,g.samplingMode=N.samplingMode,g.type=N.type,g.format=N.format,g._generateDepthBuffer=N.generateDepthBuffer,g._generateStencilBuffer=!!N.generateStencilBuffer,this._internalTexturesCache.push(g),g},D.prototype._setupFramebufferDepthAttachments=function(F,L,N,p,g){void 0===g&&(g=1);var n=null,s=this._gl;return F?(n=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,n),g>1?s.renderbufferStorageMultisample(s.RENDERBUFFER,g,s.DEPTH24_STENCIL8,N,p):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,N,p),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,n)):L&&(n=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,n),g>1?s.renderbufferStorageMultisample(s.RENDERBUFFER,g,s.DEPTH_COMPONENT16,N,p):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,N,p),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,n)),n},D.prototype.updateRenderTargetTextureSampleCount=function(F,L){if(this.webGLVersion<2||!F)return 1;if(F.samples===L)return L;var N=this._gl;if(L=Math.min(L,N.getParameter(N.MAX_SAMPLES)),F._depthStencilBuffer&&(N.deleteRenderbuffer(F._depthStencilBuffer),F._depthStencilBuffer=null),F._MSAAFramebuffer&&(N.deleteFramebuffer(F._MSAAFramebuffer),F._MSAAFramebuffer=null),F._MSAARenderBuffer&&(N.deleteRenderbuffer(F._MSAARenderBuffer),F._MSAARenderBuffer=null),L>1){var p=N.createFramebuffer();if(!p)throw new Error("Unable to create multi sampled framebuffer");F._MSAAFramebuffer=p,this._bindUnboundFramebuffer(F._MSAAFramebuffer);var g=N.createRenderbuffer();if(!g)throw new Error("Unable to create multi sampled framebuffer");N.bindRenderbuffer(N.RENDERBUFFER,g),N.renderbufferStorageMultisample(N.RENDERBUFFER,L,this._getRGBAMultiSampleBufferFormat(F.type),F.width,F.height),N.framebufferRenderbuffer(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.RENDERBUFFER,g),F._MSAARenderBuffer=g}else this._bindUnboundFramebuffer(F._framebuffer);return F.samples=L,F._depthStencilBuffer=this._setupFramebufferDepthAttachments(F._generateStencilBuffer,F._generateDepthBuffer,F.width,F.height,L),N.bindRenderbuffer(N.RENDERBUFFER,null),this._bindUnboundFramebuffer(null),L},D.prototype._uploadCompressedDataToTextureDirectly=function(F,L,N,p,g,n,s){void 0===n&&(n=0),void 0===s&&(s=0);var t=this._gl,C=t.TEXTURE_2D;F.isCube&&(C=t.TEXTURE_CUBE_MAP_POSITIVE_X+n),this._gl.compressedTexImage2D(C,s,L,N,p,0,g)},D.prototype._uploadDataToTextureDirectly=function(F,L,N,p){void 0===N&&(N=0),void 0===p&&(p=0);var g=this._gl,n=this._getWebGLTextureType(F.type),s=this._getInternalFormat(F.format),t=this._getRGBABufferInternalSizedFormat(F.type,s);this._unpackFlipY(F.invertY);var C=g.TEXTURE_2D;F.isCube&&(C=g.TEXTURE_CUBE_MAP_POSITIVE_X+N);var J=Math.round(z.a.Log2(F.width)),Q=Math.round(z.a.Log2(F.height)),$=Math.pow(2,Math.max(J-p,0)),aa=Math.pow(2,Math.max(Q-p,0));g.texImage2D(C,p,t,$,aa,0,s,n,L)},D.prototype._uploadArrayBufferViewToTexture=function(F,L,N,p){void 0===N&&(N=0),void 0===p&&(p=0);var g=this._gl,n=F.isCube?g.TEXTURE_CUBE_MAP:g.TEXTURE_2D;this._bindTextureDirectly(n,F,!0),this._uploadDataToTextureDirectly(F,L,N,p),this._bindTextureDirectly(n,null,!0)},D.prototype._uploadImageToTexture=function(F,L,N,p){void 0===N&&(N=0),void 0===p&&(p=0);var g=this._gl,n=this._getWebGLTextureType(F.type),s=this._getInternalFormat(F.format),t=this._getRGBABufferInternalSizedFormat(F.type,s),C=F.isCube?g.TEXTURE_CUBE_MAP:g.TEXTURE_2D;this._bindTextureDirectly(C,F,!0),this._unpackFlipY(F.invertY);var J=g.TEXTURE_2D;F.isCube&&(J=g.TEXTURE_CUBE_MAP_POSITIVE_X+N),g.texImage2D(J,p,t,s,n,L),this._bindTextureDirectly(C,null,!0)},D.prototype._setCubeMapTextureParams=function(F){var L=this._gl;L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_MAG_FILTER,L.LINEAR),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_MIN_FILTER,F?L.LINEAR_MIPMAP_LINEAR:L.LINEAR),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,null)},D.prototype.createRawCubeTexture=function(F,L,N,p,g,n,s,t){throw void 0===t&&(t=null),Y.a.WarnImport("Engine.RawTexture")},D.prototype.createRawTexture3D=function(F,L,N,p,g,n,s,t,C,J){throw void 0===C&&(C=null),void 0===J&&(J=D.TEXTURETYPE_UNSIGNED_INT),Y.a.WarnImport("Engine.RawTexture")},D.prototype._prepareWebGLTextureContinuation=function(F,L,N,p,g){var n=this._gl;if(n){var s=this._getSamplingParameters(g,!N);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,s.mag),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,s.min),N||p||n.generateMipmap(n.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null),L&&L._removePendingData(F),F.onLoadedObservable.notifyObservers(F),F.onLoadedObservable.clear()}},D.prototype._prepareWebGLTexture=function(F,L,N,p,g,n,s,t,C){var J=this;void 0===C&&(C=D.TEXTURE_TRILINEAR_SAMPLINGMODE);var Q=this.getCaps().maxTextureSize,$=Math.min(Q,this.needPOTTextures?A.h.GetExponentOfTwo(N,Q):N),aa=Math.min(Q,this.needPOTTextures?A.h.GetExponentOfTwo(p,Q):p),ba=this._gl;ba&&(F._webGLTexture?(this._bindTextureDirectly(ba.TEXTURE_2D,F,!0),this._unpackFlipY(void 0===g||!!g),F.baseWidth=N,F.baseHeight=p,F.width=$,F.height=aa,F.isReady=!0,t($,aa,function(){J._prepareWebGLTextureContinuation(F,L,n,s,C)})||this._prepareWebGLTextureContinuation(F,L,n,s,C)):L&&L._removePendingData(F))},D.prototype._convertRGBtoRGBATextureData=function(F,L,N,p){var g;g=p===D.TEXTURETYPE_FLOAT?new Float32Array(L*N*4):new Uint32Array(L*N*4);for(var n=0;n<L;n++)for(var s=0;s<N;s++){var t=3*(s*L+n),C=4*(s*L+n);g[C+0]=F[t+0],g[C+1]=F[t+1],g[C+2]=F[t+2],g[C+3]=1}return g},D.prototype._releaseFramebufferObjects=function(F){var L=this._gl;F._framebuffer&&(L.deleteFramebuffer(F._framebuffer),F._framebuffer=null),F._depthStencilBuffer&&(L.deleteRenderbuffer(F._depthStencilBuffer),F._depthStencilBuffer=null),F._MSAAFramebuffer&&(L.deleteFramebuffer(F._MSAAFramebuffer),F._MSAAFramebuffer=null),F._MSAARenderBuffer&&(L.deleteRenderbuffer(F._MSAARenderBuffer),F._MSAARenderBuffer=null)},D.prototype._releaseTexture=function(F){var L=this._gl;this._releaseFramebufferObjects(F),L.deleteTexture(F._webGLTexture),this.unbindAllTextures();var N=this._internalTexturesCache.indexOf(F);-1!==N&&this._internalTexturesCache.splice(N,1),F._lodTextureHigh&&F._lodTextureHigh.dispose(),F._lodTextureMid&&F._lodTextureMid.dispose(),F._lodTextureLow&&F._lodTextureLow.dispose(),this.scenes.forEach(function(p){p.postProcesses.forEach(function(g){g._outputTexture==F&&(g._outputTexture=null)}),p.cameras.forEach(function(g){g._postProcesses.forEach(function(n){n&&n._outputTexture==F&&(n._outputTexture=null)})})})},D.prototype.setProgram=function(F){this._currentProgram!==F&&(this._gl.useProgram(F),this._currentProgram=F)},D.prototype.bindSamplers=function(F){var L=F.getPipelineContext();this.setProgram(L.program);for(var N=F.getSamplers(),p=0;p<N.length;p++){var g=F.getUniform(N[p]);g&&(this._boundUniforms[p]=g)}this._currentEffect=null},D.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},D.prototype._bindTextureDirectly=function(F,L,N,p){void 0===N&&(N=!1),void 0===p&&(p=!1);var g=!1,n=L&&L._associatedChannel>-1;return N&&n&&(this._activeChannel=L._associatedChannel),this._boundTexturesCache[this._activeChannel]!==L||p?(this._activateCurrentTexture(),L&&L.isMultiview?this._gl.bindTexture(F,L?L._colorTextureArray:null):this._gl.bindTexture(F,L?L._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=L,L&&(L._associatedChannel=this._activeChannel)):N&&(g=!0,this._activateCurrentTexture()),n&&!N&&this._bindSamplerUniformToChannel(L._associatedChannel,this._activeChannel),g},D.prototype._bindTexture=function(F,L){void 0!==F&&(L&&(L._associatedChannel=F),this._activeChannel=F,this._bindTextureDirectly(this._gl.TEXTURE_2D,L))},D.prototype.setTextureFromPostProcess=function(F,L){this._bindTexture(F,L?L._textures.data[L._currentRenderTextureInd]:null)},D.prototype.setTextureFromPostProcessOutput=function(F,L){this._bindTexture(F,L?L._outputTexture:null)},D.prototype.unbindAllTextures=function(){for(var F=0;F<this._maxSimultaneousTextures;F++)this._activeChannel=F,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)},D.prototype.setTexture=function(F,L,N){void 0!==F&&(L&&(this._boundUniforms[F]=L),this._setTexture(F,N))},D.prototype.setDepthStencilTexture=function(F,L,N){void 0!==F&&(L&&(this._boundUniforms[F]=L),N&&N.depthStencilTexture?this._setTexture(F,N,!1,!0):this._setTexture(F,null))},D.prototype._bindSamplerUniformToChannel=function(F,L){var N=this._boundUniforms[F];N._currentState!==L&&(this._gl.uniform1i(N,L),N._currentState=L)},D.prototype._getTextureWrapMode=function(F){switch(F){case D.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case D.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case D.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},D.prototype._setTexture=function(F,L,N,p){if(void 0===N&&(N=!1),void 0===p&&(p=!1),!L)return null!=this._boundTexturesCache[F]&&(this._activeChannel=F,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)),!1;if(L.video)this._activeChannel=F,L.update();else if(L.delayLoadState===D.DELAYLOADSTATE_NOTLOADED)return L.delayLoad(),!1;var g;g=p?L.depthStencilTexture:L.isReady()?L.getInternalTexture():L.isCube?this.emptyCubeTexture:L.is3D?this.emptyTexture3D:this.emptyTexture,!N&&g&&(g._associatedChannel=F);var n=!0;if(this._boundTexturesCache[F]===g&&(N||this._bindSamplerUniformToChannel(g._associatedChannel,F),n=!1),this._activeChannel=F,g&&g.isMultiview)n&&this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,g,N);else if(g&&g.is3D)n&&this._bindTextureDirectly(this._gl.TEXTURE_3D,g,N),g&&g._cachedWrapU!==L.wrapU&&(g._cachedWrapU=L.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(L.wrapU),g)),g&&g._cachedWrapV!==L.wrapV&&(g._cachedWrapV=L.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(L.wrapV),g)),g&&g._cachedWrapR!==L.wrapR&&(g._cachedWrapR=L.wrapR,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(L.wrapR),g)),this._setAnisotropicLevel(this._gl.TEXTURE_3D,L);else if(g&&g.isCube){if(n&&this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,g,N),g._cachedCoordinatesMode!==L.coordinatesMode){g._cachedCoordinatesMode=L.coordinatesMode;var s=L.coordinatesMode!==D.TEXTURE_CUBIC_MODE&&L.coordinatesMode!==D.TEXTURE_SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,s,g),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,s)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,L)}else n&&this._bindTextureDirectly(this._gl.TEXTURE_2D,g,N),g&&g._cachedWrapU!==L.wrapU&&(g._cachedWrapU=L.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(L.wrapU),g)),g&&g._cachedWrapV!==L.wrapV&&(g._cachedWrapV=L.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(L.wrapV),g)),this._setAnisotropicLevel(this._gl.TEXTURE_2D,L);return!0},D.prototype.setTextureArray=function(F,L,N){if(void 0!==F&&L){this._textureUnits&&this._textureUnits.length===N.length||(this._textureUnits=new Int32Array(N.length));for(var p=0;p<N.length;p++){var g=N[p].getInternalTexture();g?(this._textureUnits[F+p]=F+p,g._associatedChannel=F+p):this._textureUnits[F+p]=-1}this._gl.uniform1iv(L,this._textureUnits);for(var n=0;n<N.length;n++)this._setTexture(this._textureUnits[n],N[n],!0)}},D.prototype._setAnisotropicLevel=function(F,L){var N=L.getInternalTexture();if(N){var p=this._caps.textureAnisotropicFilterExtension,g=L.anisotropicFilteringLevel;N.samplingMode!==D.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&N.samplingMode!==D.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&N.samplingMode!==D.TEXTURE_LINEAR_LINEAR&&(g=1),p&&N._cachedAnisotropicFilteringLevel!==g&&(this._setTextureParameterFloat(F,p.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(g,this._caps.maxAnisotropy),N),N._cachedAnisotropicFilteringLevel=g)}},D.prototype._setTextureParameterFloat=function(F,L,N,p){this._bindTextureDirectly(F,p,!0,!0),this._gl.texParameterf(F,L,N)},D.prototype._setTextureParameterInteger=function(F,L,N,p){p&&this._bindTextureDirectly(F,p,!0,!0),this._gl.texParameteri(F,L,N)},D.prototype.readPixels=function(F,L,N,p){var g=new Uint8Array(p*N*4);return this._gl.readPixels(F,L,N,p,this._gl.RGBA,this._gl.UNSIGNED_BYTE,g),g},D.prototype.addExternalData=function(F,L){return this._externalData||(this._externalData=new I.a()),this._externalData.add(F,L)},D.prototype.getExternalData=function(F){return this._externalData||(this._externalData=new I.a()),this._externalData.get(F)},D.prototype.getOrAddExternalDataWithFactory=function(F,L){return this._externalData||(this._externalData=new I.a()),this._externalData.getOrAddWithFactory(F,L)},D.prototype.removeExternalData=function(F){return this._externalData||(this._externalData=new I.a()),this._externalData.remove(F)},D.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var F=0;F<this._caps.maxVertexAttribs;F++)this._gl.disableVertexAttribArray(F),this._vertexAttribArraysEnabled[F]=!1,this._currentBufferPointers[F].active=!1}else{F=0;for(var L=this._vertexAttribArraysEnabled.length;F<L;F++)F>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[F]||(this._gl.disableVertexAttribArray(F),this._vertexAttribArraysEnabled[F]=!1,this._currentBufferPointers[F].active=!1)}},D.prototype.releaseEffects=function(){for(var F in this._compiledEffects){var L=this._compiledEffects[F].getPipelineContext();this._deletePipelineContext(L)}this._compiledEffects={}},D.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===D.Instances.length&&D.audioEngine&&D.audioEngine.dispose(),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),G.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange));var F=D.Instances.indexOf(this);F>=0&&D.Instances.splice(F,1),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._bindedRenderFunction=null,this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear(),u.a.ResetCache();for(var L=0,N=this._activeRequests;L<N.length;L++)N[L].abort()},D.prototype.displayLoadingUI=function(){if(G.a.IsWindowObjectExist()){var F=this.loadingScreen;F&&F.displayLoadingUI()}},D.prototype.hideLoadingUI=function(){if(G.a.IsWindowObjectExist()){var F=this._loadingScreen;F&&F.hideLoadingUI()}},Object.defineProperty(D.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=D.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(F){this._loadingScreen=F},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"loadingUIText",{set:function(F){this.loadingScreen.loadingUIText=F},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"loadingUIBackgroundColor",{set:function(F){this.loadingScreen.loadingUIBackgroundColor=F},enumerable:!0,configurable:!0}),D.prototype.attachContextLostEvent=function(F){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",F,!1)},D.prototype.attachContextRestoredEvent=function(F){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",F,!1)},D.prototype.getVertexShaderSource=function(F){var L=this._gl.getAttachedShaders(F);return L?this._gl.getShaderSource(L[0]):null},D.prototype.getFragmentShaderSource=function(F){var L=this._gl.getAttachedShaders(F);return L?this._gl.getShaderSource(L[1]):null},D.prototype.getError=function(){return this._gl.getError()},D.prototype.getFps=function(){return this._fps},D.prototype.getDeltaTime=function(){return this._deltaTime},D.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},D.prototype._readTexturePixels=function(F,L,N,p,g,n){void 0===p&&(p=-1),void 0===g&&(g=0),void 0===n&&(n=null);var s=this._gl;if(!this._dummyFramebuffer){var t=s.createFramebuffer();if(!t)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=t}s.bindFramebuffer(s.FRAMEBUFFER,this._dummyFramebuffer),p>-1?s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+p,F._webGLTexture,g):s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,F._webGLTexture,g);var C=void 0!==F.type?this._getWebGLTextureType(F.type):s.UNSIGNED_BYTE;switch(C){case s.UNSIGNED_BYTE:n||(n=new Uint8Array(4*L*N)),C=s.UNSIGNED_BYTE;break;default:n||(n=new Float32Array(4*L*N)),C=s.FLOAT}return s.readPixels(0,0,L,N,s.RGBA,C,n),s.bindFramebuffer(s.FRAMEBUFFER,this._currentFramebuffer),n},D.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(D.TEXTURETYPE_FLOAT)},D.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(D.TEXTURETYPE_HALF_FLOAT)},D.prototype._canRenderToFramebuffer=function(F){for(var L=this._gl;L.getError()!==L.NO_ERROR;);var N=!0,p=L.createTexture();L.bindTexture(L.TEXTURE_2D,p),L.texImage2D(L.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(F),1,1,0,L.RGBA,this._getWebGLTextureType(F),null),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.NEAREST),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.NEAREST);var g=L.createFramebuffer();L.bindFramebuffer(L.FRAMEBUFFER,g),L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,p,0);var n=L.checkFramebufferStatus(L.FRAMEBUFFER);if((N=(N=N&&n===L.FRAMEBUFFER_COMPLETE)&&L.getError()===L.NO_ERROR)&&(L.clear(L.COLOR_BUFFER_BIT),N=N&&L.getError()===L.NO_ERROR),N){L.bindFramebuffer(L.FRAMEBUFFER,null);var s=L.RGBA,t=L.UNSIGNED_BYTE,C=new Uint8Array(4);L.readPixels(0,0,1,1,s,t,C),N=N&&L.getError()===L.NO_ERROR}for(L.deleteTexture(p),L.deleteFramebuffer(g),L.bindFramebuffer(L.FRAMEBUFFER,null);!N&&L.getError()!==L.NO_ERROR;);return N},D.prototype._getWebGLTextureType=function(F){if(1===this._webGLVersion){switch(F){case D.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case D.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case D.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE}return this._gl.UNSIGNED_BYTE}switch(F){case D.TEXTURETYPE_BYTE:return this._gl.BYTE;case D.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case D.TEXTURETYPE_SHORT:return this._gl.SHORT;case D.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case D.TEXTURETYPE_INT:return this._gl.INT;case D.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case D.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case D.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case D.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case D.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case D.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case D.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case D.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case D.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case D.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case D.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},D.prototype._getInternalFormat=function(F){var L=this._gl.RGBA;switch(F){case D.TEXTUREFORMAT_ALPHA:L=this._gl.ALPHA;break;case D.TEXTUREFORMAT_LUMINANCE:L=this._gl.LUMINANCE;break;case D.TEXTUREFORMAT_LUMINANCE_ALPHA:L=this._gl.LUMINANCE_ALPHA;break;case D.TEXTUREFORMAT_RED:L=this._gl.RED;break;case D.TEXTUREFORMAT_RG:L=this._gl.RG;break;case D.TEXTUREFORMAT_RGB:L=this._gl.RGB;break;case D.TEXTUREFORMAT_RGBA:L=this._gl.RGBA}if(this._webGLVersion>1)switch(F){case D.TEXTUREFORMAT_RED_INTEGER:L=this._gl.RED_INTEGER;break;case D.TEXTUREFORMAT_RG_INTEGER:L=this._gl.RG_INTEGER;break;case D.TEXTUREFORMAT_RGB_INTEGER:L=this._gl.RGB_INTEGER;break;case D.TEXTUREFORMAT_RGBA_INTEGER:L=this._gl.RGBA_INTEGER}return L},D.prototype._getRGBABufferInternalSizedFormat=function(F,L){if(1===this._webGLVersion){if(void 0!==L)switch(L){case D.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case D.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case D.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA}return this._gl.RGBA}switch(F){case D.TEXTURETYPE_BYTE:switch(L){case D.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case D.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case D.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case D.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case D.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case D.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case D.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case D.TEXTURETYPE_UNSIGNED_BYTE:switch(L){case D.TEXTUREFORMAT_RED:return this._gl.R8;case D.TEXTUREFORMAT_RG:return this._gl.RG8;case D.TEXTUREFORMAT_RGB:return this._gl.RGB8;case D.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case D.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case D.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case D.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case D.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case D.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case D.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case D.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case D.TEXTURETYPE_SHORT:switch(L){case D.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case D.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case D.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case D.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case D.TEXTURETYPE_UNSIGNED_SHORT:switch(L){case D.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case D.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case D.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case D.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case D.TEXTURETYPE_INT:switch(L){case D.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case D.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case D.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case D.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case D.TEXTURETYPE_UNSIGNED_INTEGER:switch(L){case D.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case D.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case D.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case D.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case D.TEXTURETYPE_FLOAT:switch(L){case D.TEXTUREFORMAT_RED:return this._gl.R32F;case D.TEXTUREFORMAT_RG:return this._gl.RG32F;case D.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case D.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case D.TEXTURETYPE_HALF_FLOAT:switch(L){case D.TEXTUREFORMAT_RED:return this._gl.R16F;case D.TEXTUREFORMAT_RG:return this._gl.RG16F;case D.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case D.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case D.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case D.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case D.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case D.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case D.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case D.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(L){case D.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case D.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},D.prototype._getRGBAMultiSampleBufferFormat=function(F){return F===D.TEXTURETYPE_FLOAT?this._gl.RGBA32F:F===D.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},D.prototype._loadFile=function(F,L,N,p,g,n){var s=this,t=A.h.LoadFile(F,L,N,p,g,n);return this._activeRequests.push(t),t.onCompleteObservable.add(function(C){s._activeRequests.splice(s._activeRequests.indexOf(C),1)}),t},D.prototype._loadFileAsync=function(F,L,N){var p=this;return new Promise(function(g,n){p._loadFile(F,function(s){g(s)},void 0,L,N,function(s,t){n(t)})})},D.isSupported=function(){try{var F=document.createElement("canvas");return null!=(F.getContext("webgl")||F.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(L){return!1}},D.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],D._TextureLoaders=[],D.ALPHA_DISABLE=o.a.ALPHA_DISABLE,D.ALPHA_ADD=o.a.ALPHA_ADD,D.ALPHA_COMBINE=o.a.ALPHA_COMBINE,D.ALPHA_SUBTRACT=o.a.ALPHA_SUBTRACT,D.ALPHA_MULTIPLY=o.a.ALPHA_MULTIPLY,D.ALPHA_MAXIMIZED=o.a.ALPHA_MAXIMIZED,D.ALPHA_ONEONE=o.a.ALPHA_ONEONE,D.ALPHA_PREMULTIPLIED=o.a.ALPHA_PREMULTIPLIED,D.ALPHA_PREMULTIPLIED_PORTERDUFF=o.a.ALPHA_PREMULTIPLIED_PORTERDUFF,D.ALPHA_INTERPOLATE=o.a.ALPHA_INTERPOLATE,D.ALPHA_SCREENMODE=o.a.ALPHA_SCREENMODE,D.DELAYLOADSTATE_NONE=o.a.DELAYLOADSTATE_NONE,D.DELAYLOADSTATE_LOADED=o.a.DELAYLOADSTATE_LOADED,D.DELAYLOADSTATE_LOADING=o.a.DELAYLOADSTATE_LOADING,D.DELAYLOADSTATE_NOTLOADED=o.a.DELAYLOADSTATE_NOTLOADED,D.NEVER=o.a.NEVER,D.ALWAYS=o.a.ALWAYS,D.LESS=o.a.LESS,D.EQUAL=o.a.EQUAL,D.LEQUAL=o.a.LEQUAL,D.GREATER=o.a.GREATER,D.GEQUAL=o.a.GEQUAL,D.NOTEQUAL=o.a.NOTEQUAL,D.KEEP=o.a.KEEP,D.REPLACE=o.a.REPLACE,D.INCR=o.a.INCR,D.DECR=o.a.DECR,D.INVERT=o.a.INVERT,D.INCR_WRAP=o.a.INCR_WRAP,D.DECR_WRAP=o.a.DECR_WRAP,D.TEXTURE_CLAMP_ADDRESSMODE=o.a.TEXTURE_CLAMP_ADDRESSMODE,D.TEXTURE_WRAP_ADDRESSMODE=o.a.TEXTURE_WRAP_ADDRESSMODE,D.TEXTURE_MIRROR_ADDRESSMODE=o.a.TEXTURE_MIRROR_ADDRESSMODE,D.TEXTUREFORMAT_ALPHA=o.a.TEXTUREFORMAT_ALPHA,D.TEXTUREFORMAT_LUMINANCE=o.a.TEXTUREFORMAT_LUMINANCE,D.TEXTUREFORMAT_LUMINANCE_ALPHA=o.a.TEXTUREFORMAT_LUMINANCE_ALPHA,D.TEXTUREFORMAT_RGB=o.a.TEXTUREFORMAT_RGB,D.TEXTUREFORMAT_RGBA=o.a.TEXTUREFORMAT_RGBA,D.TEXTUREFORMAT_RED=o.a.TEXTUREFORMAT_RED,D.TEXTUREFORMAT_R=o.a.TEXTUREFORMAT_R,D.TEXTUREFORMAT_RG=o.a.TEXTUREFORMAT_RG,D.TEXTUREFORMAT_RED_INTEGER=o.a.TEXTUREFORMAT_RED_INTEGER,D.TEXTUREFORMAT_R_INTEGER=o.a.TEXTUREFORMAT_R_INTEGER,D.TEXTUREFORMAT_RG_INTEGER=o.a.TEXTUREFORMAT_RG_INTEGER,D.TEXTUREFORMAT_RGB_INTEGER=o.a.TEXTUREFORMAT_RGB_INTEGER,D.TEXTUREFORMAT_RGBA_INTEGER=o.a.TEXTUREFORMAT_RGBA_INTEGER,D.TEXTURETYPE_UNSIGNED_BYTE=o.a.TEXTURETYPE_UNSIGNED_BYTE,D.TEXTURETYPE_UNSIGNED_INT=o.a.TEXTURETYPE_UNSIGNED_INT,D.TEXTURETYPE_FLOAT=o.a.TEXTURETYPE_FLOAT,D.TEXTURETYPE_HALF_FLOAT=o.a.TEXTURETYPE_HALF_FLOAT,D.TEXTURETYPE_BYTE=o.a.TEXTURETYPE_BYTE,D.TEXTURETYPE_SHORT=o.a.TEXTURETYPE_SHORT,D.TEXTURETYPE_UNSIGNED_SHORT=o.a.TEXTURETYPE_UNSIGNED_SHORT,D.TEXTURETYPE_INT=o.a.TEXTURETYPE_INT,D.TEXTURETYPE_UNSIGNED_INTEGER=o.a.TEXTURETYPE_UNSIGNED_INTEGER,D.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=o.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,D.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=o.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,D.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=o.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,D.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=o.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,D.TEXTURETYPE_UNSIGNED_INT_24_8=o.a.TEXTURETYPE_UNSIGNED_INT_24_8,D.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=o.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,D.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=o.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,D.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=o.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,D.TEXTURE_NEAREST_SAMPLINGMODE=o.a.TEXTURE_NEAREST_SAMPLINGMODE,D.TEXTURE_BILINEAR_SAMPLINGMODE=o.a.TEXTURE_BILINEAR_SAMPLINGMODE,D.TEXTURE_TRILINEAR_SAMPLINGMODE=o.a.TEXTURE_TRILINEAR_SAMPLINGMODE,D.TEXTURE_NEAREST_NEAREST_MIPLINEAR=o.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,D.TEXTURE_LINEAR_LINEAR_MIPNEAREST=o.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,D.TEXTURE_LINEAR_LINEAR_MIPLINEAR=o.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,D.TEXTURE_NEAREST_NEAREST_MIPNEAREST=o.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,D.TEXTURE_NEAREST_LINEAR_MIPNEAREST=o.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,D.TEXTURE_NEAREST_LINEAR_MIPLINEAR=o.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,D.TEXTURE_NEAREST_LINEAR=o.a.TEXTURE_NEAREST_LINEAR,D.TEXTURE_NEAREST_NEAREST=o.a.TEXTURE_NEAREST_NEAREST,D.TEXTURE_LINEAR_NEAREST_MIPNEAREST=o.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,D.TEXTURE_LINEAR_NEAREST_MIPLINEAR=o.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,D.TEXTURE_LINEAR_LINEAR=o.a.TEXTURE_LINEAR_LINEAR,D.TEXTURE_LINEAR_NEAREST=o.a.TEXTURE_LINEAR_NEAREST,D.TEXTURE_EXPLICIT_MODE=o.a.TEXTURE_EXPLICIT_MODE,D.TEXTURE_SPHERICAL_MODE=o.a.TEXTURE_SPHERICAL_MODE,D.TEXTURE_PLANAR_MODE=o.a.TEXTURE_PLANAR_MODE,D.TEXTURE_CUBIC_MODE=o.a.TEXTURE_CUBIC_MODE,D.TEXTURE_PROJECTION_MODE=o.a.TEXTURE_PROJECTION_MODE,D.TEXTURE_SKYBOX_MODE=o.a.TEXTURE_SKYBOX_MODE,D.TEXTURE_INVCUBIC_MODE=o.a.TEXTURE_INVCUBIC_MODE,D.TEXTURE_EQUIRECTANGULAR_MODE=o.a.TEXTURE_EQUIRECTANGULAR_MODE,D.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=o.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,D.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=o.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,D.SCALEMODE_FLOOR=o.a.SCALEMODE_FLOOR,D.SCALEMODE_NEAREST=o.a.SCALEMODE_NEAREST,D.SCALEMODE_CEILING=o.a.SCALEMODE_CEILING,D.CollisionsEpsilon=.001,D._RescalePostProcessFactory=null,D}()},function(Aa,x,l){"use strict";l.d(x,"b",function(){return T}),l.d(x,"c",function(){return D}),l.d(x,"a",function(){return L});var O=l(1),q=l(8),j=l(9),I=l(32),H=l(29),A=l(0),v=l(25),z=l(4),u=l(13),w=l(57),y=l(24),r=l(49),o=l(43),G=l(20),M=l(66),R=l(55),W=l(3),Y=l(2),X=l(6),ea=l(22),ca=l(19),oa=l(14),Z=l(110),T=function(){return function(){}}(),V=function(){return function(){this.visibleInstances={},this.batchCache=new D(),this.instancesBufferSize=2048}}(),D=function(){return function(){this.mustReturn=!1,this.visibleInstances=new Array(),this.renderSelf=new Array(),this.hardwareInstancedRendering=new Array()}}(),F=function(){return function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array(),this._morphTargetManager=null}}(),L=function(N){function p(g,n,s,t,C,J){void 0===n&&(n=null),void 0===s&&(s=null),void 0===t&&(t=null),void 0===J&&(J=!0);var Q=N.call(this,g,n)||this;if(Q._internalMeshDataInfo=new F(),Q.delayLoadState=W.a.DELAYLOADSTATE_NONE,Q.instances=new Array(),Q._creationDataStorage=null,Q._geometry=null,Q._instanceDataStorage=new V(),Q._effectiveMaterial=null,Q._shouldGenerateFlatShading=!1,Q._originalBuilderSideOrientation=p.DEFAULTSIDE,Q.overrideMaterialSideOrientation=null,n=Q.getScene(),t){if(t._geometry&&t._geometry.applyToMesh(Q),I.a.DeepCopy(t,Q,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable"],["_poseMatrix"]),Q._internalMeshDataInfo._source=t,n.useClonedMeshhMap&&(t._internalMeshDataInfo.meshMap||(t._internalMeshDataInfo.meshMap={}),t._internalMeshDataInfo.meshMap[Q.uniqueId]=Q),Q._originalBuilderSideOrientation=t._originalBuilderSideOrientation,Q._creationDataStorage=t._creationDataStorage,t._ranges){var $=t._ranges;for(var g in $)$.hasOwnProperty(g)&&$[g]&&Q.createAnimationRange(g,$[g].from,$[g].to)}var aa;if(t.metadata&&t.metadata.clone?Q.metadata=t.metadata.clone():Q.metadata=t.metadata,H.a&&H.a.HasTags(t)&&H.a.AddTagsTo(Q,H.a.GetTags(t,!0)),Q.parent=t.parent,Q.setPivotMatrix(t.getPivotMatrix()),Q.id=g+"."+t.id,Q.material=t.material,!C)for(var ba=t.getDescendants(!0),ia=0;ia<ba.length;ia++){var qa=ba[ia];qa.clone&&qa.clone(g+"."+qa.name,Q)}if(n.getPhysicsEngine){var ja=n.getPhysicsEngine();if(J&&ja){var sa=ja.getImpostorForPhysicsObject(t);sa&&(Q.physicsImpostor=sa.clone(Q))}}for(aa=0;aa<n.particleSystems.length;aa++){var za=n.particleSystems[aa];za.emitter===t&&za.clone(za.name,Q)}Q.refreshBoundingInfo(),Q.computeWorldMatrix(!0)}return null!==s&&(Q.parent=s),Q._instanceDataStorage.hardwareInstancedRendering=Q.getEngine().getCaps().instancedArrays,Q}return O.d(p,N),p._GetDefaultSideOrientation=function(g){return g||p.FRONTSIDE},Object.defineProperty(p.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new q.c()),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new q.c()),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new q.c()),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new q.c()),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"onBeforeDraw",{set:function(g){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(g)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(g){this._internalMeshDataInfo._morphTargetManager!==g&&(this._internalMeshDataInfo._morphTargetManager=g,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(g){this._unIndexed!==g&&(this._unIndexed=g,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),p.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(p.prototype,"_isMesh",{get:function(){return!0},enumerable:!0,configurable:!0}),p.prototype.toString=function(g){var n=N.prototype.toString.call(this,g);if(n+=", n vertices: "+this.getTotalVertices(),n+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var s=0;s<this.animations.length;s++)n+=", animation[0]: "+this.animations[s].toString(g);if(g)if(this._geometry){var t=this.getIndices(),C=this.getVerticesData(z.b.PositionKind);C&&t&&(n+=", flat shading: "+(C.length/3===t.length?"YES":"NO"))}else n+=", flat shading: UNKNOWN";return n},p.prototype._unBindEffect=function(){N.prototype._unBindEffect.call(this);for(var g=0,n=this.instances;g<n.length;g++)n[g]._unBindEffect()},Object.defineProperty(p.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!0,configurable:!0}),p.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},p.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(g,n){return g.distance<n.distance?1:g.distance>n.distance?-1:0})},p.prototype.addLODLevel=function(g,n){if(n&&n._masterMesh)return X.a.Warn("You cannot use a mesh as LOD level twice"),this;var s=new Z.a(g,n);return this._internalMeshDataInfo._LODLevels.push(s),n&&(n._masterMesh=this),this._sortLODLevels(),this},p.prototype.getLODLevelAtDistance=function(g){for(var n=this._internalMeshDataInfo,s=0;s<n._LODLevels.length;s++){var t=n._LODLevels[s];if(t.distance===g)return t.mesh}return null},p.prototype.removeLODLevel=function(g){for(var n=this._internalMeshDataInfo,s=0;s<n._LODLevels.length;s++)n._LODLevels[s].mesh===g&&(n._LODLevels.splice(s,1),g&&(g._masterMesh=null));return this._sortLODLevels(),this},p.prototype.getLOD=function(g,n){var s,t=this._internalMeshDataInfo;if(!t._LODLevels||0===t._LODLevels.length)return this;n?s=n:s=this.getBoundingInfo().boundingSphere;var C=s.centerWorld.subtract(g.globalPosition).length();if(t._LODLevels[t._LODLevels.length-1].distance>C)return this.onLODLevelSelection&&this.onLODLevelSelection(C,this,t._LODLevels[t._LODLevels.length-1].mesh),this;for(var J=0;J<t._LODLevels.length;J++){var Q=t._LODLevels[J];if(Q.distance<C)return Q.mesh&&(Q.mesh._preActivate(),Q.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(C,this,Q.mesh),Q.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(C,this,this),this},Object.defineProperty(p.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),p.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},p.prototype.getVerticesData=function(g,n,s){return this._geometry?this._geometry.getVerticesData(g,n,s):null},p.prototype.getVertexBuffer=function(g){return this._geometry?this._geometry.getVertexBuffer(g):null},p.prototype.isVerticesDataPresent=function(g){return this._geometry?this._geometry.isVerticesDataPresent(g):!!this._delayInfo&&-1!==this._delayInfo.indexOf(g)},p.prototype.isVertexBufferUpdatable=function(g){return this._geometry?this._geometry.isVertexBufferUpdatable(g):!!this._delayInfo&&-1!==this._delayInfo.indexOf(g)},p.prototype.getVerticesDataKinds=function(){if(!this._geometry){var g=new Array();return this._delayInfo&&this._delayInfo.forEach(function(n){g.push(n)}),g}return this._geometry.getVerticesDataKinds()},p.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},p.prototype.getIndices=function(g,n){return this._geometry?this._geometry.getIndices(g,n):[]},Object.defineProperty(p.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),p.prototype.isReady=function(g,n){if(void 0===g&&(g=!1),void 0===n&&(n=!1),this.delayLoadState===W.a.DELAYLOADSTATE_LOADING)return!1;if(!N.prototype.isReady.call(this,g))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!g)return!0;var s=this.getEngine(),t=this.getScene(),C=n||s.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var J=this.material||t.defaultMaterial;if(J){if(J._storeEffectOnSubMeshes)for(var Q=0,$=this.subMeshes;Q<$.length;Q++){var aa=(za=$[Q]).getMaterial();if(aa){if(aa._storeEffectOnSubMeshes){if(!aa.isReadyForSubMesh(this,za,C))return!1}else if(!aa.isReady(this,C))return!1}}else if(!J.isReady(this,C))return!1}for(var ba=0,ia=this.lightSources;ba<ia.length;ba++){var qa=ia[ba].getShadowGenerator();if(qa)for(var ja=0,sa=this.subMeshes;ja<sa.length;ja++){var za=sa[ja];if(!qa.isReady(za,C))return!1}}for(var Fa=0,Ea=this._internalMeshDataInfo._LODLevels;Fa<Ea.length;Fa++){var Ba=Ea[Fa];if(Ba.mesh&&!Ba.mesh.isReady(C))return!1}return!0},Object.defineProperty(p.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!0,configurable:!0}),p.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},p.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(p.prototype,"overridenInstanceCount",{set:function(g){this._instanceDataStorage.overridenInstanceCount=g},enumerable:!0,configurable:!0}),p.prototype._preActivate=function(){var g=this._internalMeshDataInfo,n=this.getScene().getRenderId();return g._preActivateId===n?this:(g._preActivateId=n,this._instanceDataStorage.visibleInstances=null,this)},p.prototype._preActivateForIntermediateRendering=function(g){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=g),this},p.prototype._registerInstanceForRenderId=function(g,n){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:n,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[n]||(this._instanceDataStorage.visibleInstances[n]=new Array()),this._instanceDataStorage.visibleInstances[n].push(g),this},p.prototype.refreshBoundingInfo=function(g){if(void 0===g&&(g=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var n=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(g),n),this},p.prototype._createGlobalSubMesh=function(g){var n=this.getTotalVertices();if(!n||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var s=this.getIndices();if(!s)return null;var t=s.length,C=!1;if(g)C=!0;else for(var J=0,Q=this.subMeshes;J<Q.length;J++){var $=Q[J];if($.indexStart+$.indexCount>=t){C=!0;break}if($.verticesStart+$.verticesCount>=n){C=!0;break}}if(!C)return this.subMeshes[0]}return this.releaseSubMeshes(),new r.b(0,0,n,0,this.getTotalIndices(),this)},p.prototype.subdivide=function(g){if(!(g<1)){for(var n=this.getTotalIndices(),s=n/g|0,t=0;s%3!=0;)s++;this.releaseSubMeshes();for(var C=0;C<g&&!(t>=n);C++)r.b.CreateFromIndices(0,t,Math.min(s,n-t),this),t+=s;this.synchronizeInstances()}},p.prototype.setVerticesData=function(g,n,s,t){if(void 0===s&&(s=!1),this._geometry)this._geometry.setVerticesData(g,n,s,t);else{var C=new u.a();C.set(n,g);var J=this.getScene();new w.a(w.a.RandomId(),J,C,s,this)}return this},p.prototype.markVerticesDataAsUpdatable=function(g,n){void 0===n&&(n=!0);var s=this.getVertexBuffer(g);s&&s.isUpdatable()!==n&&this.setVerticesData(g,this.getVerticesData(g),n)},p.prototype.setVerticesBuffer=function(g){return this._geometry||(this._geometry=w.a.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(g),this},p.prototype.updateVerticesData=function(g,n,s,t){return this._geometry?(t?(this.makeGeometryUnique(),this.updateVerticesData(g,n,s,!1)):this._geometry.updateVerticesData(g,n,s),this):this},p.prototype.updateMeshPositions=function(g,n){void 0===n&&(n=!0);var s=this.getVerticesData(z.b.PositionKind);if(!s)return this;if(g(s),this.updateVerticesData(z.b.PositionKind,s,!1,!1),n){var t=this.getIndices(),C=this.getVerticesData(z.b.NormalKind);if(!C)return this;u.a.ComputeNormals(s,t,C),this.updateVerticesData(z.b.NormalKind,C,!1,!1)}return this},p.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var g=this._geometry,n=this._geometry.copy(w.a.RandomId());return g.releaseForMesh(this,!0),n.applyToMesh(this),this},p.prototype.setIndices=function(g,n,s){if(void 0===n&&(n=null),void 0===s&&(s=!1),this._geometry)this._geometry.setIndices(g,n,s);else{var t=new u.a();t.indices=g;var C=this.getScene();new w.a(w.a.RandomId(),C,t,s,this)}return this},p.prototype.updateIndices=function(g,n,s){return void 0===s&&(s=!1),this._geometry?(this._geometry.updateIndices(g,n,s),this):this},p.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},p.prototype._bind=function(g,n,s){if(!this._geometry)return this;var t,C=this.getScene().getEngine();if(this._unIndexed)t=null;else switch(s){case G.a.PointFillMode:t=null;break;case G.a.WireFrameFillMode:t=g._getLinesIndexBuffer(this.getIndices(),C);break;default:case G.a.TriangleFillMode:t=this._geometry.getIndexBuffer()}return this._geometry._bind(n,t),this},p.prototype._draw=function(g,n,s){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var t=this.getScene().getEngine();return this._unIndexed||n==G.a.PointFillMode?t.drawArraysType(n,g.verticesStart,g.verticesCount,s):n==G.a.WireFrameFillMode?t.drawElementsType(n,0,g._linesIndexCount,s):t.drawElementsType(n,g.indexStart,g.indexCount,s),this},p.prototype.registerBeforeRender=function(g){return this.onBeforeRenderObservable.add(g),this},p.prototype.unregisterBeforeRender=function(g){return this.onBeforeRenderObservable.removeCallback(g),this},p.prototype.registerAfterRender=function(g){return this.onAfterRenderObservable.add(g),this},p.prototype.unregisterAfterRender=function(g){return this.onAfterRenderObservable.removeCallback(g),this},p.prototype._getInstancesRenderList=function(g){if(this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var n=this.getScene(),s=n._isInIntermediateRendering(),t=s?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,C=this._instanceDataStorage.batchCache;if(C.mustReturn=!1,C.renderSelf[g]=!t&&this.isEnabled()&&this.isVisible,C.visibleInstances[g]=null,this._instanceDataStorage.visibleInstances){var J=this._instanceDataStorage.visibleInstances,Q=n.getRenderId(),$=s?J.intermediateDefaultRenderId:J.defaultRenderId;C.visibleInstances[g]=J[Q],!C.visibleInstances[g]&&$&&(C.visibleInstances[g]=J[$])}return C.hardwareInstancedRendering[g]=this._instanceDataStorage.hardwareInstancedRendering&&null!==C.visibleInstances[g]&&void 0!==C.visibleInstances[g],this._instanceDataStorage.previousBatch=C,C},p.prototype._renderWithInstances=function(g,n,s,t,C){var J=s.visibleInstances[g._id];if(!J)return this;for(var Q=this._instanceDataStorage,$=Q.instancesBufferSize,aa=Q.instancesBuffer,ba=16*(J.length+1)*4;Q.instancesBufferSize<ba;)Q.instancesBufferSize*=2;Q.instancesData&&$==Q.instancesBufferSize||(Q.instancesData=new Float32Array(Q.instancesBufferSize/4));var ia=0,qa=0,ja=this._effectiveMesh.getWorldMatrix();if(s.renderSelf[g._id]&&(ja.copyToArray(Q.instancesData,ia),ia+=16,qa++),J)for(var sa=0;sa<J.length;sa++)J[sa].getWorldMatrix().copyToArray(Q.instancesData,ia),ia+=16,qa++;return aa&&$==Q.instancesBufferSize?aa.updateDirectly(Q.instancesData,0,qa):(aa&&aa.dispose(),aa=new z.a(C,Q.instancesData,!0,16,!1,!0),Q.instancesBuffer=aa,this.setVerticesBuffer(aa.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(aa.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(aa.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(aa.createVertexBuffer("world3",12,4))),this._bind(g,t,n),this._draw(g,n,qa),C.unbindInstanceAttributes(),this},p.prototype._processRendering=function(g,n,s,t,C,J,Q){var $=this.getScene().getEngine();if(C)this._renderWithInstances(g,s,t,n,$);else{t.renderSelf[g._id]&&(J&&J(!1,this._effectiveMesh.getWorldMatrix(),Q),this._draw(g,s,this._instanceDataStorage.overridenInstanceCount));var aa=t.visibleInstances[g._id];if(aa)for(var ba=0;ba<aa.length;ba++){var ia=aa[ba].getWorldMatrix();J&&J(!0,ia,Q),this._draw(g,s)}}return this},p.prototype._freeze=function(){if(this._instanceDataStorage.isFrozen=!0,this.subMeshes)for(var g=0;g<this.subMeshes.length;g++)this._getInstancesRenderList(g)},p.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1},p.prototype.render=function(g,n){var s=this.getScene();if(s._isInIntermediateRendering()?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var t=this._getInstancesRenderList(g._id);if(t.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var C,J=s.getEngine(),Q=t.hardwareInstancedRendering[g._id],$=this._instanceDataStorage,aa=g.getMaterial();if(!aa)return this;if(!$.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==aa){if(this._effectiveMaterial=aa,this._effectiveMaterial._storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,g,Q))return this}else if(!this._effectiveMaterial.isReady(this,Q))return this}n&&J.setAlphaMode(this._effectiveMaterial.alphaMode);for(var ba=0,ia=s._beforeRenderingMeshStage;ba<ia.length;ba++)ia[ba].action(this,g,t);if(!(C=this._effectiveMaterial._storeEffectOnSubMeshes?g.effect:this._effectiveMaterial.getEffect()))return this;var qa,ja=this._effectiveMesh;$.isFrozen?qa=$.sideOrientation:(null==(qa=this.overrideMaterialSideOrientation)&&(qa=this._effectiveMaterial.sideOrientation,ja._getWorldMatrixDeterminant()<0&&(qa=qa===G.a.ClockWiseSideOrientation?G.a.CounterClockWiseSideOrientation:G.a.ClockWiseSideOrientation)),$.sideOrientation=qa);var sa=this._effectiveMaterial._preBind(C,qa);this._effectiveMaterial.forceDepthWrite&&J.setDepthWrite(!0);var za=s.forcePointsCloud?G.a.PointFillMode:s.forceWireframe?G.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),Q||this._bind(g,C,za);var Fa=ja.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(Fa,this,g):this._effectiveMaterial.bind(Fa,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(J.setState(!0,this._effectiveMaterial.zOffset,!1,!sa),this._processRendering(g,C,za,t,Q,this._onBeforeDraw,this._effectiveMaterial),J.setState(!0,this._effectiveMaterial.zOffset,!1,sa)),this._processRendering(g,C,za,t,Q,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var Ea=0,Ba=s._afterRenderingMeshStage;Ea<Ba.length;Ea++)Ba[Ea].action(this,g,t);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},p.prototype._onBeforeDraw=function(g,n,s){g&&s&&s.bindOnlyWorldMatrix(n)},p.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(z.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(z.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},p.prototype.normalizeSkinFourWeights=function(){for(var g=this.getVerticesData(z.b.MatricesWeightsKind),n=g.length,s=0;s<n;s+=4){var t=g[s]+g[s+1]+g[s+2]+g[s+3];if(0===t)g[s]=1;else{var C=1/t;g[s]*=C,g[s+1]*=C,g[s+2]*=C,g[s+3]*=C}}this.setVerticesData(z.b.MatricesWeightsKind,g)},p.prototype.normalizeSkinWeightsAndExtra=function(){for(var g=this.getVerticesData(z.b.MatricesWeightsExtraKind),n=this.getVerticesData(z.b.MatricesWeightsKind),s=n.length,t=0;t<s;t+=4){var C=n[t]+n[t+1]+n[t+2]+n[t+3];if(0===(C+=g[t]+g[t+1]+g[t+2]+g[t+3]))n[t]=1;else{var J=1/C;n[t]*=J,n[t+1]*=J,n[t+2]*=J,n[t+3]*=J,g[t]*=J,g[t+1]*=J,g[t+2]*=J,g[t+3]*=J}}this.setVerticesData(z.b.MatricesWeightsKind,n),this.setVerticesData(z.b.MatricesWeightsKind,g)},p.prototype.validateSkinning=function(){var g=this.getVerticesData(z.b.MatricesWeightsExtraKind),n=this.getVerticesData(z.b.MatricesWeightsKind);if(null===n||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var s=n.length,t=0,C=0,J=0,Q=0,$=null===g?4:8,aa=new Array(),ba=0;ba<=$;ba++)aa[ba]=0;for(ba=0;ba<s;ba+=4){for(var ia=n[ba],qa=ia,ja=0===qa?0:1,sa=1;sa<$;sa++){var za=sa<4?n[ba+sa]:g[ba+sa-4];za>ia&&t++,0!==za&&ja++,qa+=za,ia=za}if(aa[ja]++,ja>J&&(J=ja),0===qa)C++;else{var Fa=1/qa,Ea=0;for(sa=0;sa<$;sa++)Ea+=sa<4?Math.abs(n[ba+sa]-n[ba+sa]*Fa):Math.abs(g[ba+sa-4]-g[ba+sa-4]*Fa);Ea>.001&&Q++}}var Ba=this.skeleton.bones.length,Sa=this.getVerticesData(z.b.MatricesIndicesKind),Xa=this.getVerticesData(z.b.MatricesIndicesExtraKind),Ka=0;for(ba=0;ba<s;ba++)for(sa=0;sa<$;sa++){var Ga=sa<4?Sa[sa]:Xa[sa-4];(Ga>=Ba||Ga<0)&&Ka++}return{skinned:!0,valid:0===C&&0===Q&&0===Ka,report:"Number of Weights = "+s/4+`
Maximum influences = `+J+`
Missing Weights = `+C+`
Not Sorted = `+t+`
Not Normalized = `+Q+`
WeightCounts = [`+aa+`]
Number of bones = `+Ba+`
Bad Bone Indices = `+Ka}},p.prototype._checkDelayState=function(){var g=this.getScene();return this._geometry?this._geometry.load(g):this.delayLoadState===W.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=W.a.DELAYLOADSTATE_LOADING,this._queueLoad(g)),this},p.prototype._queueLoad=function(g){var n=this;g._addPendingData(this);var s=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return j.h.LoadFile(this.delayLoadingFile,function(t){t instanceof ArrayBuffer?n._delayLoadingFunction(t,n):n._delayLoadingFunction(JSON.parse(t),n),n.instances.forEach(function(C){C.refreshBoundingInfo(),C._syncSubMeshes()}),n.delayLoadState=W.a.DELAYLOADSTATE_LOADED,g._removePendingData(n)},function(){},g.offlineProvider,s),this},p.prototype.isInFrustum=function(g){return this.delayLoadState!==W.a.DELAYLOADSTATE_LOADING&&(!!N.prototype.isInFrustum.call(this,g)&&(this._checkDelayState(),!0))},p.prototype.setMaterialByID=function(g){var n,s=this.getScene().materials;for(n=s.length-1;n>-1;n--)if(s[n].id===g)return this.material=s[n],this;var t=this.getScene().multiMaterials;for(n=t.length-1;n>-1;n--)if(t[n].id===g)return this.material=t[n],this;return this},p.prototype.getAnimatables=function(){var g=new Array();return this.material&&g.push(this.material),this.skeleton&&g.push(this.skeleton),g},p.prototype.bakeTransformIntoVertices=function(g){if(!this.isVerticesDataPresent(z.b.PositionKind))return this;var n=this.subMeshes.splice(0);this._resetPointsArrayCache();var s,t=this.getVerticesData(z.b.PositionKind),C=new Array();for(s=0;s<t.length;s+=3)A.x.TransformCoordinates(A.x.FromArray(t,s),g).toArray(C,s);if(this.setVerticesData(z.b.PositionKind,C,this.getVertexBuffer(z.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(z.b.NormalKind)){for(t=this.getVerticesData(z.b.NormalKind),C=[],s=0;s<t.length;s+=3)A.x.TransformNormal(A.x.FromArray(t,s),g).normalize().toArray(C,s);this.setVerticesData(z.b.NormalKind,C,this.getVertexBuffer(z.b.NormalKind).isUpdatable())}return g.m[0]*g.m[5]*g.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=n,this},p.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=A.q.Identity()),this._worldMatrix=A.j.Identity(),this},Object.defineProperty(p.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),p.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},p.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},p.prototype.clone=function(g,n,s,t){return void 0===g&&(g=""),void 0===t&&(t=!0),new p(g,this.getScene(),n,this,s,t)},p.prototype.dispose=function(g,n){void 0===n&&(n=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var s=this._internalMeshDataInfo;if(s._onBeforeDrawObservable&&s._onBeforeDrawObservable.clear(),s._onBeforeBindObservable&&s._onBeforeBindObservable.clear(),s._onBeforeRenderObservable&&s._onBeforeRenderObservable.clear(),s._onAfterRenderObservable&&s._onAfterRenderObservable.clear(),this._scene.useClonedMeshhMap){if(s.meshMap)for(var t in s.meshMap)(Q=s.meshMap[t])&&(Q._internalMeshDataInfo._source=null,s.meshMap[t]=void 0);s._source&&s._source._internalMeshDataInfo.meshMap&&(s._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var C=0,J=this.getScene().meshes;C<J.length;C++){var Q;(Q=J[C])._internalMeshDataInfo&&Q._internalMeshDataInfo._source&&Q._internalMeshDataInfo._source===this&&(Q._internalMeshDataInfo._source=null)}for(s._source=null,this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();N.prototype.dispose.call(this,g,n)},p.prototype.applyDisplacementMap=function(g,n,s,t,C,J,Q){var $=this;void 0===Q&&(Q=!1);var aa=this.getScene();return j.h.LoadImage(g,function(ba){var ia=document.createElement("canvas"),qa=ia.getContext("2d"),ja=ba.width,sa=ba.height;ia.width=ja,ia.height=sa,qa.drawImage(ba,0,0);var za=qa.getImageData(0,0,ja,sa).data;$.applyDisplacementMapFromBuffer(za,ja,sa,n,s,C,J,Q),t&&t($)},function(){},aa.offlineProvider),this},p.prototype.applyDisplacementMapFromBuffer=function(g,n,s,t,C,J,Q,$){if(void 0===$&&($=!1),!this.isVerticesDataPresent(z.b.PositionKind)||!this.isVerticesDataPresent(z.b.NormalKind)||!this.isVerticesDataPresent(z.b.UVKind))return X.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var aa=this.getVerticesData(z.b.PositionKind,!0,!0),ba=this.getVerticesData(z.b.NormalKind),ia=this.getVerticesData(z.b.UVKind),qa=A.x.Zero(),ja=A.x.Zero(),sa=A.w.Zero();J=J||A.w.Zero(),Q=Q||new A.w(1,1);for(var za=0;za<aa.length;za+=3){A.x.FromArrayToRef(aa,za,qa),A.x.FromArrayToRef(ba,za,ja),A.w.FromArrayToRef(ia,za/3*2,sa);var Fa=4*((Math.abs(sa.x*Q.x+J.x)*n%n|0)+(Math.abs(sa.y*Q.y+J.y)*s%s|0)*n),Ea=.3*(g[Fa]/255)+.59*(g[Fa+1]/255)+.11*(g[Fa+2]/255);ja.normalize(),ja.scaleInPlace(t+(C-t)*Ea),(qa=qa.add(ja)).toArray(aa,za)}return u.a.ComputeNormals(aa,this.getIndices(),ba),$?(this.setVerticesData(z.b.PositionKind,aa),this.setVerticesData(z.b.NormalKind,ba)):(this.updateVerticesData(z.b.PositionKind,aa),this.updateVerticesData(z.b.NormalKind,ba)),this},p.prototype.convertToFlatShadedMesh=function(){var g,n,s=this.getVerticesDataKinds(),t={},C={},J={},Q=!1;for(g=0;g<s.length;g++){n=s[g];var $=this.getVertexBuffer(n);n!==z.b.NormalKind?(t[n]=$,C[n]=t[n].getData(),J[n]=[]):(Q=$.isUpdatable(),s.splice(g,1),g--)}var aa,ba=this.subMeshes.slice(0),ia=this.getIndices(),qa=this.getTotalIndices();for(aa=0;aa<qa;aa++){var ja=ia[aa];for(g=0;g<s.length;g++)for(var sa=t[n=s[g]].getStrideSize(),za=0;za<sa;za++)J[n].push(C[n][ja*sa+za])}var Fa=[],Ea=J[z.b.PositionKind];for(aa=0;aa<qa;aa+=3){ia[aa]=aa,ia[aa+1]=aa+1,ia[aa+2]=aa+2;for(var Ba=A.x.FromArray(Ea,3*aa),Sa=A.x.FromArray(Ea,3*(aa+1)),Xa=A.x.FromArray(Ea,3*(aa+2)),Ka=Ba.subtract(Sa),Ga=Xa.subtract(Sa),nb=A.x.Normalize(A.x.Cross(Ka,Ga)),jb=0;jb<3;jb++)Fa.push(nb.x),Fa.push(nb.y),Fa.push(nb.z)}for(this.setIndices(ia),this.setVerticesData(z.b.NormalKind,Fa,Q),g=0;g<s.length;g++)n=s[g],this.setVerticesData(n,J[n],t[n].isUpdatable());this.releaseSubMeshes();for(var bb=0;bb<ba.length;bb++){var fb=ba[bb];r.b.AddToMesh(fb.materialIndex,fb.indexStart,fb.indexCount,fb.indexStart,fb.indexCount,this)}return this.synchronizeInstances(),this},p.prototype.convertToUnIndexedMesh=function(){var g,n,s=this.getVerticesDataKinds(),t={},C={},J={};for(g=0;g<s.length;g++){n=s[g];var Q=this.getVertexBuffer(n);t[n]=Q,C[n]=t[n].getData(),J[n]=[]}var $,aa=this.subMeshes.slice(0),ba=this.getIndices(),ia=this.getTotalIndices();for($=0;$<ia;$++){var qa=ba[$];for(g=0;g<s.length;g++)for(var ja=t[n=s[g]].getStrideSize(),sa=0;sa<ja;sa++)J[n].push(C[n][qa*ja+sa])}for($=0;$<ia;$+=3)ba[$]=$,ba[$+1]=$+1,ba[$+2]=$+2;for(this.setIndices(ba),g=0;g<s.length;g++)n=s[g],this.setVerticesData(n,J[n],t[n].isUpdatable());this.releaseSubMeshes();for(var za=0;za<aa.length;za++){var Fa=aa[za];r.b.AddToMesh(Fa.materialIndex,Fa.indexStart,Fa.indexCount,Fa.indexStart,Fa.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},p.prototype.flipFaces=function(g){void 0===g&&(g=!1);var n,s,t=u.a.ExtractFromMesh(this);if(g&&this.isVerticesDataPresent(z.b.NormalKind)&&t.normals)for(n=0;n<t.normals.length;n++)t.normals[n]*=-1;if(t.indices)for(n=0;n<t.indices.length;n+=3)s=t.indices[n+1],t.indices[n+1]=t.indices[n+2],t.indices[n+2]=s;return t.applyToMesh(this),this},p.prototype.increaseVertices=function(g){var n=u.a.ExtractFromMesh(this),s=n.uvs,t=n.indices,C=n.positions,J=n.normals;if(null===t||null===C||null===J||null===s)X.a.Warn("VertexData contains null entries");else{for(var Q,$,aa=g+1,ba=new Array(),ia=0;ia<aa+1;ia++)ba[ia]=new Array();var qa,ja=new A.x(0,0,0),sa=new A.x(0,0,0),za=new A.w(0,0),Fa=new Array(),Ea=new Array(),Ba=new Array(),Sa=C.length,Xa=s.length;for(ia=0;ia<t.length;ia+=3){Ea[0]=t[ia],Ea[1]=t[ia+1],Ea[2]=t[ia+2];for(var Ka=0;Ka<3;Ka++)if(Q=Ea[Ka],$=Ea[(Ka+1)%3],void 0===Ba[Q]&&void 0===Ba[$]?(Ba[Q]=new Array(),Ba[$]=new Array()):(void 0===Ba[Q]&&(Ba[Q]=new Array()),void 0===Ba[$]&&(Ba[$]=new Array())),void 0===Ba[Q][$]&&void 0===Ba[$][Q]){Ba[Q][$]=[],ja.x=(C[3*$]-C[3*Q])/aa,ja.y=(C[3*$+1]-C[3*Q+1])/aa,ja.z=(C[3*$+2]-C[3*Q+2])/aa,sa.x=(J[3*$]-J[3*Q])/aa,sa.y=(J[3*$+1]-J[3*Q+1])/aa,sa.z=(J[3*$+2]-J[3*Q+2])/aa,za.x=(s[2*$]-s[2*Q])/aa,za.y=(s[2*$+1]-s[2*Q+1])/aa,Ba[Q][$].push(Q);for(var Ga=1;Ga<aa;Ga++)Ba[Q][$].push(C.length/3),C[Sa]=C[3*Q]+Ga*ja.x,J[Sa++]=J[3*Q]+Ga*sa.x,C[Sa]=C[3*Q+1]+Ga*ja.y,J[Sa++]=J[3*Q+1]+Ga*sa.y,C[Sa]=C[3*Q+2]+Ga*ja.z,J[Sa++]=J[3*Q+2]+Ga*sa.z,s[Xa++]=s[2*Q]+Ga*za.x,s[Xa++]=s[2*Q+1]+Ga*za.y;Ba[Q][$].push($),Ba[$][Q]=new Array(),qa=Ba[Q][$].length;for(var nb=0;nb<qa;nb++)Ba[$][Q][nb]=Ba[Q][$][qa-1-nb]}for(ba[0][0]=t[ia],ba[1][0]=Ba[t[ia]][t[ia+1]][1],ba[1][1]=Ba[t[ia]][t[ia+2]][1],Ga=2;Ga<aa;Ga++)for(ba[Ga][0]=Ba[t[ia]][t[ia+1]][Ga],ba[Ga][Ga]=Ba[t[ia]][t[ia+2]][Ga],ja.x=(C[3*ba[Ga][Ga]]-C[3*ba[Ga][0]])/Ga,ja.y=(C[3*ba[Ga][Ga]+1]-C[3*ba[Ga][0]+1])/Ga,ja.z=(C[3*ba[Ga][Ga]+2]-C[3*ba[Ga][0]+2])/Ga,sa.x=(J[3*ba[Ga][Ga]]-J[3*ba[Ga][0]])/Ga,sa.y=(J[3*ba[Ga][Ga]+1]-J[3*ba[Ga][0]+1])/Ga,sa.z=(J[3*ba[Ga][Ga]+2]-J[3*ba[Ga][0]+2])/Ga,za.x=(s[2*ba[Ga][Ga]]-s[2*ba[Ga][0]])/Ga,za.y=(s[2*ba[Ga][Ga]+1]-s[2*ba[Ga][0]+1])/Ga,Ka=1;Ka<Ga;Ka++)ba[Ga][Ka]=C.length/3,C[Sa]=C[3*ba[Ga][0]]+Ka*ja.x,J[Sa++]=J[3*ba[Ga][0]]+Ka*sa.x,C[Sa]=C[3*ba[Ga][0]+1]+Ka*ja.y,J[Sa++]=J[3*ba[Ga][0]+1]+Ka*sa.y,C[Sa]=C[3*ba[Ga][0]+2]+Ka*ja.z,J[Sa++]=J[3*ba[Ga][0]+2]+Ka*sa.z,s[Xa++]=s[2*ba[Ga][0]]+Ka*za.x,s[Xa++]=s[2*ba[Ga][0]+1]+Ka*za.y;for(ba[aa]=Ba[t[ia+1]][t[ia+2]],Fa.push(ba[0][0],ba[1][0],ba[1][1]),Ga=1;Ga<aa;Ga++){for(Ka=0;Ka<Ga;Ka++)Fa.push(ba[Ga][Ka],ba[Ga+1][Ka],ba[Ga+1][Ka+1]),Fa.push(ba[Ga][Ka],ba[Ga+1][Ka+1],ba[Ga][Ka+1]);Fa.push(ba[Ga][Ka],ba[Ga+1][Ka],ba[Ga+1][Ka+1])}}n.indices=Fa,n.applyToMesh(this)}},p.prototype.forceSharedVertices=function(){var g=u.a.ExtractFromMesh(this),n=g.uvs,s=g.indices,t=g.positions,C=g.normals;if(null===s||null===t||null===C||null===n)X.a.Warn("VertexData contains null entries");else{for(var J,Q,$=new Array(),aa=new Array(),ba=new Array(),ia=new Array(),qa=0,ja=new Array(),sa=0;sa<s.length;sa+=3){Q=[s[sa],s[sa+1],s[sa+2]],ia=new Array();for(var za=0;za<3;za++){ia[za]="";for(var Fa=0;Fa<3;Fa++)Math.abs(t[3*Q[za]+Fa])<1e-08&&(t[3*Q[za]+Fa]=0),ia[za]+=t[3*Q[za]+Fa]+"|";ia[za]=ia[za].slice(0,-1)}if(ia[0]!=ia[1]&&ia[0]!=ia[2]&&ia[1]!=ia[2])for(za=0;za<3;za++){if((J=ja.indexOf(ia[za]))<0){for(ja.push(ia[za]),J=qa++,Fa=0;Fa<3;Fa++)$.push(t[3*Q[za]+Fa]);for(Fa=0;Fa<2;Fa++)ba.push(n[2*Q[za]+Fa])}aa.push(J)}}var Ea=new Array();u.a.ComputeNormals($,aa,Ea),g.positions=$,g.indices=aa,g.normals=Ea,g.uvs=ba,g.applyToMesh(this)}},p._instancedMeshFactory=function(g,n){throw ca.a.WarnImport("InstancedMesh")},p._PhysicsImpostorParser=function(g,n,s){throw ca.a.WarnImport("PhysicsImpostor")},p.prototype.createInstance=function(g){return p._instancedMeshFactory(g,this)},p.prototype.synchronizeInstances=function(){for(var g=0;g<this.instances.length;g++)this.instances[g]._syncSubMeshes();return this},p.prototype.optimizeIndices=function(g){var n=this,s=this.getIndices(),t=this.getVerticesData(z.b.PositionKind);if(!t||!s)return this;for(var C=new Array(),J=0;J<t.length;J+=3)C.push(A.x.FromArray(t,J));var Q=new Array();return j.a.SyncAsyncForLoop(C.length,40,function($){for(var aa=C.length-1-$,ba=C[aa],ia=0;ia<aa;++ia){var qa=C[ia];if(ba.equals(qa)){Q[aa]=ia;break}}},function(){for(var $=0;$<s.length;++$)s[$]=Q[s[$]]||s[$];var aa=n.subMeshes.slice(0);n.setIndices(s),n.subMeshes=aa,g&&g(n)}),this},p.prototype.serialize=function(g){g.name=this.name,g.id=this.id,g.type=this.getClassName(),H.a&&H.a.HasTags(this)&&(g.tags=H.a.GetTags(this)),g.position=this.position.asArray(),this.rotationQuaternion?g.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(g.rotation=this.rotation.asArray()),g.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?g.pivotMatrix=this.getPivotMatrix().asArray():g.localMatrix=this.getPivotMatrix().asArray(),g.isEnabled=this.isEnabled(!1),g.isVisible=this.isVisible,g.infiniteDistance=this.infiniteDistance,g.pickable=this.isPickable,g.receiveShadows=this.receiveShadows,g.billboardMode=this.billboardMode,g.visibility=this.visibility,g.checkCollisions=this.checkCollisions,g.isBlocker=this.isBlocker,this.parent&&(g.parentId=this.parent.id),g.isUnIndexed=this.isUnIndexed;var n=this._geometry;if(n){var s=n.id;g.geometryId=s,g.subMeshes=[];for(var t=0;t<this.subMeshes.length;t++){var C=this.subMeshes[t];g.subMeshes.push({materialIndex:C.materialIndex,verticesStart:C.verticesStart,verticesCount:C.verticesCount,indexStart:C.indexStart,indexCount:C.indexCount})}}if(this.material?g.materialId=this.material.id:this.material=null,this.morphTargetManager&&(g.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(g.skeletonId=this.skeleton.id),this.getScene()._getComponent(oa.a.NAME_PHYSICSENGINE)){var J=this.getPhysicsImpostor();J&&(g.physicsMass=J.getParam("mass"),g.physicsFriction=J.getParam("friction"),g.physicsRestitution=J.getParam("mass"),g.physicsImpostor=J.type)}this.metadata&&(g.metadata=this.metadata),g.instances=[];for(var Q=0;Q<this.instances.length;Q++){var $=this.instances[Q];if(!$.doNotSerialize){var aa={name:$.name,id:$.id,position:$.position.asArray(),scaling:$.scaling.asArray()};$.parent&&(aa.parentId=$.parent.id),$.rotationQuaternion?aa.rotationQuaternion=$.rotationQuaternion.asArray():$.rotation&&(aa.rotation=$.rotation.asArray()),g.instances.push(aa),Y.a.AppendSerializedAnimations($,aa),aa.ranges=$.serializeAnimationRanges()}}Y.a.AppendSerializedAnimations(this,g),g.ranges=this.serializeAnimationRanges(),g.layerMask=this.layerMask,g.alphaIndex=this.alphaIndex,g.hasVertexAlpha=this.hasVertexAlpha,g.overlayAlpha=this.overlayAlpha,g.overlayColor=this.overlayColor.asArray(),g.renderOverlay=this.renderOverlay,g.applyFog=this.applyFog,this.actionManager&&(g.actions=this.actionManager.serialize(this.name))},p.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var g=this._internalMeshDataInfo._morphTargetManager;if(g&&g.vertexCount){if(g.vertexCount!==this.getTotalVertices())return X.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var n=0;n<g.numInfluencers;n++){var s=g.getActiveTarget(n),t=s.getPositions();if(!t)return void X.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(z.b.PositionKind+n,t,!1,3);var C=s.getNormals();C&&this.geometry.setVerticesData(z.b.NormalKind+n,C,!1,3);var J=s.getTangents();J&&this.geometry.setVerticesData(z.b.TangentKind+n,J,!1,3)}}else for(n=0;this.geometry.isVerticesDataPresent(z.b.PositionKind+n);)this.geometry.removeVerticesData(z.b.PositionKind+n),this.geometry.isVerticesDataPresent(z.b.NormalKind+n)&&this.geometry.removeVerticesData(z.b.NormalKind+n),this.geometry.isVerticesDataPresent(z.b.TangentKind+n)&&this.geometry.removeVerticesData(z.b.TangentKind+n),n++}},p.Parse=function(g,n,s){var t;if((t=g.type&&"GroundMesh"===g.type?p._GroundMeshParser(g,n):new p(g.name,n)).id=g.id,H.a&&H.a.AddTagsTo(t,g.tags),t.position=A.x.FromArray(g.position),void 0!==g.metadata&&(t.metadata=g.metadata),g.rotationQuaternion?t.rotationQuaternion=A.q.FromArray(g.rotationQuaternion):g.rotation&&(t.rotation=A.x.FromArray(g.rotation)),t.scaling=A.x.FromArray(g.scaling),g.localMatrix?t.setPreTransformMatrix(A.j.FromArray(g.localMatrix)):g.pivotMatrix&&t.setPivotMatrix(A.j.FromArray(g.pivotMatrix)),t.setEnabled(g.isEnabled),t.isVisible=g.isVisible,t.infiniteDistance=g.infiniteDistance,t.showBoundingBox=g.showBoundingBox,t.showSubMeshesBoundingBox=g.showSubMeshesBoundingBox,void 0!==g.applyFog&&(t.applyFog=g.applyFog),void 0!==g.pickable&&(t.isPickable=g.pickable),void 0!==g.alphaIndex&&(t.alphaIndex=g.alphaIndex),t.receiveShadows=g.receiveShadows,t.billboardMode=g.billboardMode,void 0!==g.visibility&&(t.visibility=g.visibility),t.checkCollisions=g.checkCollisions,void 0!==g.isBlocker&&(t.isBlocker=g.isBlocker),t._shouldGenerateFlatShading=g.useFlatShading,g.freezeWorldMatrix&&(t._waitingData.freezeWorldMatrix=g.freezeWorldMatrix),g.parentId&&(t._waitingParentId=g.parentId),void 0!==g.actions&&(t._waitingData.actions=g.actions),void 0!==g.overlayAlpha&&(t.overlayAlpha=g.overlayAlpha),void 0!==g.overlayColor&&(t.overlayColor=A.e.FromArray(g.overlayColor)),void 0!==g.renderOverlay&&(t.renderOverlay=g.renderOverlay),t.isUnIndexed=!!g.isUnIndexed,t.hasVertexAlpha=g.hasVertexAlpha,g.delayLoadingFile?(t.delayLoadState=W.a.DELAYLOADSTATE_NOTLOADED,t.delayLoadingFile=s+g.delayLoadingFile,t._boundingInfo=new o.a(A.x.FromArray(g.boundingBoxMinimum),A.x.FromArray(g.boundingBoxMaximum)),g._binaryInfo&&(t._binaryInfo=g._binaryInfo),t._delayInfo=[],g.hasUVs&&t._delayInfo.push(z.b.UVKind),g.hasUVs2&&t._delayInfo.push(z.b.UV2Kind),g.hasUVs3&&t._delayInfo.push(z.b.UV3Kind),g.hasUVs4&&t._delayInfo.push(z.b.UV4Kind),g.hasUVs5&&t._delayInfo.push(z.b.UV5Kind),g.hasUVs6&&t._delayInfo.push(z.b.UV6Kind),g.hasColors&&t._delayInfo.push(z.b.ColorKind),g.hasMatricesIndices&&t._delayInfo.push(z.b.MatricesIndicesKind),g.hasMatricesWeights&&t._delayInfo.push(z.b.MatricesWeightsKind),t._delayLoadingFunction=w.a._ImportGeometry,R.a.ForceFullSceneLoadingForIncremental&&t._checkDelayState()):w.a._ImportGeometry(g,t),g.materialId?t.setMaterialByID(g.materialId):t.material=null,g.morphTargetManagerId>-1&&(t.morphTargetManager=n.getMorphTargetManagerById(g.morphTargetManagerId)),g.skeletonId>-1&&(t.skeleton=n.getLastSkeletonByID(g.skeletonId),g.numBoneInfluencers&&(t.numBoneInfluencers=g.numBoneInfluencers)),g.animations){for(var C=0;C<g.animations.length;C++){var J=g.animations[C];(ba=ea.a.GetClass("BABYLON.Animation"))&&t.animations.push(ba.Parse(J))}v.a.ParseAnimationRanges(t,g,n)}if(g.autoAnimate&&n.beginAnimation(t,g.autoAnimateFrom,g.autoAnimateTo,g.autoAnimateLoop,g.autoAnimateSpeed||1),g.layerMask&&!isNaN(g.layerMask)?t.layerMask=Math.abs(parseInt(g.layerMask)):t.layerMask=268435455,g.physicsImpostor&&p._PhysicsImpostorParser(n,t,g),g.lodMeshIds&&(t._waitingData.lods={ids:g.lodMeshIds,distances:g.lodDistances?g.lodDistances:null,coverages:g.lodCoverages?g.lodCoverages:null}),g.instances)for(var Q=0;Q<g.instances.length;Q++){var $=g.instances[Q],aa=t.createInstance($.name);if($.id&&(aa.id=$.id),H.a&&($.tags?H.a.AddTagsTo(aa,$.tags):H.a.AddTagsTo(aa,g.tags)),aa.position=A.x.FromArray($.position),void 0!==$.metadata&&(aa.metadata=$.metadata),$.parentId&&(aa._waitingParentId=$.parentId),$.rotationQuaternion?aa.rotationQuaternion=A.q.FromArray($.rotationQuaternion):$.rotation&&(aa.rotation=A.x.FromArray($.rotation)),aa.scaling=A.x.FromArray($.scaling),null!=$.checkCollisions&&null!=$.checkCollisions&&(aa.checkCollisions=$.checkCollisions),null!=$.pickable&&null!=$.pickable&&(aa.isPickable=$.pickable),null!=$.showBoundingBox&&null!=$.showBoundingBox&&(aa.showBoundingBox=$.showBoundingBox),null!=$.showSubMeshesBoundingBox&&null!=$.showSubMeshesBoundingBox&&(aa.showSubMeshesBoundingBox=$.showSubMeshesBoundingBox),null!=$.alphaIndex&&null!=$.showSubMeshesBoundingBox&&(aa.alphaIndex=$.alphaIndex),$.physicsImpostor&&p._PhysicsImpostorParser(n,aa,$),$.animations){for(C=0;C<$.animations.length;C++){var ba;J=$.animations[C],(ba=ea.a.GetClass("BABYLON.Animation"))&&aa.animations.push(ba.Parse(J))}v.a.ParseAnimationRanges(aa,$,n),$.autoAnimate&&n.beginAnimation(aa,$.autoAnimateFrom,$.autoAnimateTo,$.autoAnimateLoop,$.autoAnimateSpeed||1)}}return t},p.CreateRibbon=function(g,n,s,t,C,J,Q,$,aa){throw ca.a.WarnImport("MeshBuilder")},p.CreateDisc=function(g,n,s,t,C,J){throw void 0===t&&(t=null),ca.a.WarnImport("MeshBuilder")},p.CreateBox=function(g,n,s,t,C){throw void 0===s&&(s=null),ca.a.WarnImport("MeshBuilder")},p.CreateSphere=function(g,n,s,t,C,J){throw ca.a.WarnImport("MeshBuilder")},p.CreateHemisphere=function(g,n,s,t){throw ca.a.WarnImport("MeshBuilder")},p.CreateCylinder=function(g,n,s,t,C,J,Q,$,aa){throw ca.a.WarnImport("MeshBuilder")},p.CreateTorus=function(g,n,s,t,C,J,Q){throw ca.a.WarnImport("MeshBuilder")},p.CreateTorusKnot=function(g,n,s,t,C,J,Q,$,aa,ba){throw ca.a.WarnImport("MeshBuilder")},p.CreateLines=function(g,n,s,t,C){throw void 0===s&&(s=null),void 0===t&&(t=!1),void 0===C&&(C=null),ca.a.WarnImport("MeshBuilder")},p.CreateDashedLines=function(g,n,s,t,C,J,Q,$){throw void 0===J&&(J=null),ca.a.WarnImport("MeshBuilder")},p.CreatePolygon=function(g,n,s,t,C,J,Q){throw void 0===Q&&(Q=earcut),ca.a.WarnImport("MeshBuilder")},p.ExtrudePolygon=function(g,n,s,t,C,J,Q,$){throw void 0===$&&($=earcut),ca.a.WarnImport("MeshBuilder")},p.ExtrudeShape=function(g,n,s,t,C,J,Q,$,aa,ba){throw void 0===Q&&(Q=null),ca.a.WarnImport("MeshBuilder")},p.ExtrudeShapeCustom=function(g,n,s,t,C,J,Q,$,aa,ba,ia,qa){throw ca.a.WarnImport("MeshBuilder")},p.CreateLathe=function(g,n,s,t,C,J,Q){throw ca.a.WarnImport("MeshBuilder")},p.CreatePlane=function(g,n,s,t,C){throw ca.a.WarnImport("MeshBuilder")},p.CreateGround=function(g,n,s,t,C,J){throw ca.a.WarnImport("MeshBuilder")},p.CreateTiledGround=function(g,n,s,t,C,J,Q,$,aa){throw ca.a.WarnImport("MeshBuilder")},p.CreateGroundFromHeightMap=function(g,n,s,t,C,J,Q,$,aa,ba,ia){throw ca.a.WarnImport("MeshBuilder")},p.CreateTube=function(g,n,s,t,C,J,Q,$,aa,ba){throw ca.a.WarnImport("MeshBuilder")},p.CreatePolyhedron=function(g,n,s){throw ca.a.WarnImport("MeshBuilder")},p.CreateIcoSphere=function(g,n,s){throw ca.a.WarnImport("MeshBuilder")},p.CreateDecal=function(g,n,s,t,C,J){throw ca.a.WarnImport("MeshBuilder")},p.prototype.setPositionsForCPUSkinning=function(){var g=this._internalMeshDataInfo;if(!g._sourcePositions){var n=this.getVerticesData(z.b.PositionKind);if(!n)return g._sourcePositions;g._sourcePositions=new Float32Array(n),this.isVertexBufferUpdatable(z.b.PositionKind)||this.setVerticesData(z.b.PositionKind,n,!0)}return g._sourcePositions},p.prototype.setNormalsForCPUSkinning=function(){var g=this._internalMeshDataInfo;if(!g._sourceNormals){var n=this.getVerticesData(z.b.NormalKind);if(!n)return g._sourceNormals;g._sourceNormals=new Float32Array(n),this.isVertexBufferUpdatable(z.b.NormalKind)||this.setVerticesData(z.b.NormalKind,n,!0)}return g._sourceNormals},p.prototype.applySkeleton=function(g){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(z.b.PositionKind))return this;if(!this.isVerticesDataPresent(z.b.NormalKind))return this;if(!this.isVerticesDataPresent(z.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(z.b.MatricesWeightsKind))return this;var n=this._internalMeshDataInfo;if(!n._sourcePositions){var s=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=s}n._sourceNormals||this.setNormalsForCPUSkinning();var t=this.getVerticesData(z.b.PositionKind);if(!t)return this;t instanceof Float32Array||(t=new Float32Array(t));var C=this.getVerticesData(z.b.NormalKind);if(!C)return this;C instanceof Float32Array||(C=new Float32Array(C));var J=this.getVerticesData(z.b.MatricesIndicesKind),Q=this.getVerticesData(z.b.MatricesWeightsKind);if(!Q||!J)return this;for(var $,aa=this.numBoneInfluencers>4,ba=aa?this.getVerticesData(z.b.MatricesIndicesExtraKind):null,ia=aa?this.getVerticesData(z.b.MatricesWeightsExtraKind):null,qa=g.getTransformMatrices(this),ja=A.x.Zero(),sa=new A.j(),za=new A.j(),Fa=0,Ea=0;Ea<t.length;Ea+=3,Fa+=4){var Ba;for($=0;$<4;$++)(Ba=Q[Fa+$])>0&&(A.j.FromFloat32ArrayToRefScaled(qa,Math.floor(16*J[Fa+$]),Ba,za),sa.addToSelf(za));if(aa)for($=0;$<4;$++)(Ba=ia[Fa+$])>0&&(A.j.FromFloat32ArrayToRefScaled(qa,Math.floor(16*ba[Fa+$]),Ba,za),sa.addToSelf(za));A.x.TransformCoordinatesFromFloatsToRef(n._sourcePositions[Ea],n._sourcePositions[Ea+1],n._sourcePositions[Ea+2],sa,ja),ja.toArray(t,Ea),A.x.TransformNormalFromFloatsToRef(n._sourceNormals[Ea],n._sourceNormals[Ea+1],n._sourceNormals[Ea+2],sa,ja),ja.toArray(C,Ea),sa.reset()}return this.updateVerticesData(z.b.PositionKind,t),this.updateVerticesData(z.b.NormalKind,C),this},p.MinMax=function(g){var n=null,s=null;return g.forEach(function(t){var C=t.getBoundingInfo().boundingBox;n&&s?(n.minimizeInPlace(C.minimumWorld),s.maximizeInPlace(C.maximumWorld)):(n=C.minimumWorld,s=C.maximumWorld)}),n&&s?{min:n,max:s}:{min:A.x.Zero(),max:A.x.Zero()}},p.Center=function(g){var n=g instanceof Array?p.MinMax(g):g;return A.x.Center(n.min,n.max)},p.MergeMeshes=function(g,n,s,t,C,J){var Q;if(void 0===n&&(n=!0),!s){var $=0;for(Q=0;Q<g.length;Q++)if(g[Q]&&($+=g[Q].getTotalVertices())>65536)return X.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(J){var aa,ba,ia=null;C=!1}var qa,ja=new Array(),sa=new Array(),za=null,Fa=new Array(),Ea=null;for(Q=0;Q<g.length;Q++)if(g[Q]){var Ba=g[Q];if(Ba.isAnInstance)return X.a.Warn("Cannot merge instance meshes."),null;var Sa=Ba.computeWorldMatrix(!0);if((qa=u.a.ExtractFromMesh(Ba,!0,!0)).transform(Sa),za?za.merge(qa,s):(za=qa,Ea=Ba),C&&Fa.push(Ba.getTotalIndices()),J)if(Ba.material){var Xa=Ba.material;if(Xa instanceof M.a){for(ba=0;ba<Xa.subMaterials.length;ba++)ja.indexOf(Xa.subMaterials[ba])<0&&ja.push(Xa.subMaterials[ba]);for(aa=0;aa<Ba.subMeshes.length;aa++)sa.push(ja.indexOf(Xa.subMaterials[Ba.subMeshes[aa].materialIndex])),Fa.push(Ba.subMeshes[aa].indexCount)}else for(ja.indexOf(Xa)<0&&ja.push(Xa),aa=0;aa<Ba.subMeshes.length;aa++)sa.push(ja.indexOf(Xa)),Fa.push(Ba.subMeshes[aa].indexCount)}else for(aa=0;aa<Ba.subMeshes.length;aa++)sa.push(0),Fa.push(Ba.subMeshes[aa].indexCount)}if(Ea=Ea,t||(t=new p(Ea.name+"_merged",Ea.getScene())),za.applyToMesh(t),t.checkCollisions=Ea.checkCollisions,n)for(Q=0;Q<g.length;Q++)g[Q]&&g[Q].dispose();if(C||J){t.releaseSubMeshes(),Q=0;for(var Ka=0;Q<Fa.length;)r.b.CreateFromIndices(0,Ka,Fa[Q],t),Ka+=Fa[Q],Q++}if(J){for((ia=new M.a(Ea.name+"_merged",Ea.getScene())).subMaterials=ja,aa=0;aa<t.subMeshes.length;aa++)t.subMeshes[aa].materialIndex=sa[aa];t.material=ia}else t.material=Ea.material;return t},p.prototype.addInstance=function(g){g._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(g)},p.prototype.removeInstance=function(g){var n=g._indexInSourceMeshInstanceArray;if(-1!=n){if(n!==this.instances.length-1){var s=this.instances[this.instances.length-1];this.instances[n]=s,s._indexInSourceMeshInstanceArray=n}g._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},p.FRONTSIDE=u.a.FRONTSIDE,p.BACKSIDE=u.a.BACKSIDE,p.DOUBLESIDE=u.a.DOUBLESIDE,p.DEFAULTSIDE=u.a.DEFAULTSIDE,p.NO_CAP=0,p.CAP_START=1,p.CAP_END=2,p.CAP_ALL=3,p._GroundMeshParser=function(g,n){throw ca.a.WarnImport("GroundMesh")},p}(y.a)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return q.WithinEpsilon=function(j,I,H){void 0===H&&(H=1.401298e-45);var A=j-I;return-H<=A&&A<=H},q.ToHex=function(j){var I=j.toString(16);return j<=15?("0"+I).toUpperCase():I.toUpperCase()},q.Sign=function(j){return 0===(j=+j)||isNaN(j)?j:j>0?1:-1},q.Clamp=function(j,I,H){return void 0===I&&(I=0),void 0===H&&(H=1),Math.min(H,Math.max(I,j))},q.Log2=function(j){return Math.log(j)*Math.LOG2E},q.Repeat=function(j,I){return j-Math.floor(j/I)*I},q.Normalize=function(j,I,H){return(j-I)/(H-I)},q.Denormalize=function(j,I,H){return j*(H-I)+I},q.DeltaAngle=function(j,I){var H=q.Repeat(I-j,360);return H>180&&(H-=360),H},q.PingPong=function(j,I){var H=q.Repeat(j,2*I);return I-Math.abs(H-I)},q.SmoothStep=function(j,I,H){var A=q.Clamp(H);return I*(A=-2*A*A*A+3*A*A)+j*(1-A)},q.MoveTowards=function(j,I,H){return Math.abs(I-j)<=H?I:j+q.Sign(I-j)*H},q.MoveTowardsAngle=function(j,I,H){var A=q.DeltaAngle(j,I),v=0;return-H<A&&A<H?v=I:(I=j+A,v=q.MoveTowards(j,I,H)),v},q.Lerp=function(j,I,H){return j+(I-j)*H},q.LerpAngle=function(j,I,H){var A=q.Repeat(I-j,360);return A>180&&(A-=360),j+A*q.Clamp(H)},q.InverseLerp=function(j,I,H){return j!=I?q.Clamp((H-j)/(I-j)):0},q.Hermite=function(j,I,H,A,v){var z=v*v,u=v*z;return j*(2*u-3*z+1)+H*(-2*u+3*z)+I*(u-2*z+v)+A*(u-z)},q.RandomRange=function(j,I){return j===I?j:Math.random()*(I-j)+j},q.RangeToPercent=function(j,I,H){return(j-I)/(H-I)},q.PercentToRange=function(j,I,H){return(H-I)*j+I},q.NormalizeRadians=function(j){return j-=q.TwoPi*Math.floor((j+Math.PI)/q.TwoPi)},q.TwoPi=2*Math.PI,q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return I});var O=l(0),q=l(4),j=l(19),I=function(){function H(){}return H.prototype.set=function(A,v){switch(v){case q.b.PositionKind:this.positions=A;break;case q.b.NormalKind:this.normals=A;break;case q.b.TangentKind:this.tangents=A;break;case q.b.UVKind:this.uvs=A;break;case q.b.UV2Kind:this.uvs2=A;break;case q.b.UV3Kind:this.uvs3=A;break;case q.b.UV4Kind:this.uvs4=A;break;case q.b.UV5Kind:this.uvs5=A;break;case q.b.UV6Kind:this.uvs6=A;break;case q.b.ColorKind:this.colors=A;break;case q.b.MatricesIndicesKind:this.matricesIndices=A;break;case q.b.MatricesWeightsKind:this.matricesWeights=A;break;case q.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=A;break;case q.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=A}},H.prototype.applyToMesh=function(A,v){return this._applyTo(A,v),this},H.prototype.applyToGeometry=function(A,v){return this._applyTo(A,v),this},H.prototype.updateMesh=function(A){return this._update(A),this},H.prototype.updateGeometry=function(A){return this._update(A),this},H.prototype._applyTo=function(A,v){return void 0===v&&(v=!1),this.positions&&A.setVerticesData(q.b.PositionKind,this.positions,v),this.normals&&A.setVerticesData(q.b.NormalKind,this.normals,v),this.tangents&&A.setVerticesData(q.b.TangentKind,this.tangents,v),this.uvs&&A.setVerticesData(q.b.UVKind,this.uvs,v),this.uvs2&&A.setVerticesData(q.b.UV2Kind,this.uvs2,v),this.uvs3&&A.setVerticesData(q.b.UV3Kind,this.uvs3,v),this.uvs4&&A.setVerticesData(q.b.UV4Kind,this.uvs4,v),this.uvs5&&A.setVerticesData(q.b.UV5Kind,this.uvs5,v),this.uvs6&&A.setVerticesData(q.b.UV6Kind,this.uvs6,v),this.colors&&A.setVerticesData(q.b.ColorKind,this.colors,v),this.matricesIndices&&A.setVerticesData(q.b.MatricesIndicesKind,this.matricesIndices,v),this.matricesWeights&&A.setVerticesData(q.b.MatricesWeightsKind,this.matricesWeights,v),this.matricesIndicesExtra&&A.setVerticesData(q.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,v),this.matricesWeightsExtra&&A.setVerticesData(q.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,v),this.indices?A.setIndices(this.indices,null,v):A.setIndices([],null),this},H.prototype._update=function(A,v,z){return this.positions&&A.updateVerticesData(q.b.PositionKind,this.positions,v,z),this.normals&&A.updateVerticesData(q.b.NormalKind,this.normals,v,z),this.tangents&&A.updateVerticesData(q.b.TangentKind,this.tangents,v,z),this.uvs&&A.updateVerticesData(q.b.UVKind,this.uvs,v,z),this.uvs2&&A.updateVerticesData(q.b.UV2Kind,this.uvs2,v,z),this.uvs3&&A.updateVerticesData(q.b.UV3Kind,this.uvs3,v,z),this.uvs4&&A.updateVerticesData(q.b.UV4Kind,this.uvs4,v,z),this.uvs5&&A.updateVerticesData(q.b.UV5Kind,this.uvs5,v,z),this.uvs6&&A.updateVerticesData(q.b.UV6Kind,this.uvs6,v,z),this.colors&&A.updateVerticesData(q.b.ColorKind,this.colors,v,z),this.matricesIndices&&A.updateVerticesData(q.b.MatricesIndicesKind,this.matricesIndices,v,z),this.matricesWeights&&A.updateVerticesData(q.b.MatricesWeightsKind,this.matricesWeights,v,z),this.matricesIndicesExtra&&A.updateVerticesData(q.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,v,z),this.matricesWeightsExtra&&A.updateVerticesData(q.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,v,z),this.indices&&A.setIndices(this.indices,null),this},H.prototype.transform=function(A){var v,z=A.m[0]*A.m[5]*A.m[10]<0,u=O.x.Zero();if(this.positions){var w=O.x.Zero();for(v=0;v<this.positions.length;v+=3)O.x.FromArrayToRef(this.positions,v,w),O.x.TransformCoordinatesToRef(w,A,u),this.positions[v]=u.x,this.positions[v+1]=u.y,this.positions[v+2]=u.z}if(this.normals){var y=O.x.Zero();for(v=0;v<this.normals.length;v+=3)O.x.FromArrayToRef(this.normals,v,y),O.x.TransformNormalToRef(y,A,u),this.normals[v]=u.x,this.normals[v+1]=u.y,this.normals[v+2]=u.z}if(this.tangents){var r=O.y.Zero(),o=O.y.Zero();for(v=0;v<this.tangents.length;v+=4)O.y.FromArrayToRef(this.tangents,v,r),O.y.TransformNormalToRef(r,A,o),this.tangents[v]=o.x,this.tangents[v+1]=o.y,this.tangents[v+2]=o.z,this.tangents[v+3]=o.w}if(z&&this.indices)for(v=0;v<this.indices.length;v+=3){var G=this.indices[v+1];this.indices[v+1]=this.indices[v+2],this.indices[v+2]=G}return this},H.prototype.merge=function(A,v){if(void 0===v&&(v=!1),this._validate(),A._validate(),!this.normals!=!A.normals||!this.tangents!=!A.tangents||!this.uvs!=!A.uvs||!this.uvs2!=!A.uvs2||!this.uvs3!=!A.uvs3||!this.uvs4!=!A.uvs4||!this.uvs5!=!A.uvs5||!this.uvs6!=!A.uvs6||!this.colors!=!A.colors||!this.matricesIndices!=!A.matricesIndices||!this.matricesWeights!=!A.matricesWeights||!this.matricesIndicesExtra!=!A.matricesIndicesExtra||!this.matricesWeightsExtra!=!A.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(A.indices){this.indices||(this.indices=[]);var z=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var u=this.indices.length+A.indices.length,w=v||this.indices instanceof Uint32Array?new Uint32Array(u):new Uint16Array(u);w.set(this.indices);for(var y=this.indices.length,r=0;r<A.indices.length;r++)w[y+r]=A.indices[r]+z;this.indices=w}else for(r=0;r<A.indices.length;r++)this.indices.push(A.indices[r]+z)}return this.positions=this._mergeElement(this.positions,A.positions),this.normals=this._mergeElement(this.normals,A.normals),this.tangents=this._mergeElement(this.tangents,A.tangents),this.uvs=this._mergeElement(this.uvs,A.uvs),this.uvs2=this._mergeElement(this.uvs2,A.uvs2),this.uvs3=this._mergeElement(this.uvs3,A.uvs3),this.uvs4=this._mergeElement(this.uvs4,A.uvs4),this.uvs5=this._mergeElement(this.uvs5,A.uvs5),this.uvs6=this._mergeElement(this.uvs6,A.uvs6),this.colors=this._mergeElement(this.colors,A.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,A.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,A.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,A.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,A.matricesWeightsExtra),this},H.prototype._mergeElement=function(A,v){if(!A)return v;if(!v)return A;var z=v.length+A.length,u=A instanceof Float32Array,w=v instanceof Float32Array;if(u){var y=new Float32Array(z);return y.set(A),y.set(v,A.length),y}if(w){var r=A.slice(0),o=0;for(z=v.length;o<z;o++)r.push(v[o]);return r}return A.concat(v)},H.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var A=function(u,w){var y=q.b.DeduceStride(u);if(w.length%y!=0)throw new Error("The "+u+"s array count must be a multiple of "+y);return w.length/y},v=A(q.b.PositionKind,this.positions),z=function(u,w){var y=A(u,w);if(y!==v)throw new Error("The "+u+"s element count ("+y+") does not match the positions count ("+v+")")};this.normals&&z(q.b.NormalKind,this.normals),this.tangents&&z(q.b.TangentKind,this.tangents),this.uvs&&z(q.b.UVKind,this.uvs),this.uvs2&&z(q.b.UV2Kind,this.uvs2),this.uvs3&&z(q.b.UV3Kind,this.uvs3),this.uvs4&&z(q.b.UV4Kind,this.uvs4),this.uvs5&&z(q.b.UV5Kind,this.uvs5),this.uvs6&&z(q.b.UV6Kind,this.uvs6),this.colors&&z(q.b.ColorKind,this.colors),this.matricesIndices&&z(q.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&z(q.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&z(q.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&z(q.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},H.prototype.serialize=function(){var A=this.serialize();return this.positions&&(A.positions=this.positions),this.normals&&(A.normals=this.normals),this.tangents&&(A.tangents=this.tangents),this.uvs&&(A.uvs=this.uvs),this.uvs2&&(A.uvs2=this.uvs2),this.uvs3&&(A.uvs3=this.uvs3),this.uvs4&&(A.uvs4=this.uvs4),this.uvs5&&(A.uvs5=this.uvs5),this.uvs6&&(A.uvs6=this.uvs6),this.colors&&(A.colors=this.colors),this.matricesIndices&&(A.matricesIndices=this.matricesIndices,A.matricesIndices._isExpanded=!0),this.matricesWeights&&(A.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(A.matricesIndicesExtra=this.matricesIndicesExtra,A.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(A.matricesWeightsExtra=this.matricesWeightsExtra),A.indices=this.indices,A},H.ExtractFromMesh=function(A,v,z){return H._ExtractFrom(A,v,z)},H.ExtractFromGeometry=function(A,v,z){return H._ExtractFrom(A,v,z)},H._ExtractFrom=function(A,v,z){var u=new H();return A.isVerticesDataPresent(q.b.PositionKind)&&(u.positions=A.getVerticesData(q.b.PositionKind,v,z)),A.isVerticesDataPresent(q.b.NormalKind)&&(u.normals=A.getVerticesData(q.b.NormalKind,v,z)),A.isVerticesDataPresent(q.b.TangentKind)&&(u.tangents=A.getVerticesData(q.b.TangentKind,v,z)),A.isVerticesDataPresent(q.b.UVKind)&&(u.uvs=A.getVerticesData(q.b.UVKind,v,z)),A.isVerticesDataPresent(q.b.UV2Kind)&&(u.uvs2=A.getVerticesData(q.b.UV2Kind,v,z)),A.isVerticesDataPresent(q.b.UV3Kind)&&(u.uvs3=A.getVerticesData(q.b.UV3Kind,v,z)),A.isVerticesDataPresent(q.b.UV4Kind)&&(u.uvs4=A.getVerticesData(q.b.UV4Kind,v,z)),A.isVerticesDataPresent(q.b.UV5Kind)&&(u.uvs5=A.getVerticesData(q.b.UV5Kind,v,z)),A.isVerticesDataPresent(q.b.UV6Kind)&&(u.uvs6=A.getVerticesData(q.b.UV6Kind,v,z)),A.isVerticesDataPresent(q.b.ColorKind)&&(u.colors=A.getVerticesData(q.b.ColorKind,v,z)),A.isVerticesDataPresent(q.b.MatricesIndicesKind)&&(u.matricesIndices=A.getVerticesData(q.b.MatricesIndicesKind,v,z)),A.isVerticesDataPresent(q.b.MatricesWeightsKind)&&(u.matricesWeights=A.getVerticesData(q.b.MatricesWeightsKind,v,z)),A.isVerticesDataPresent(q.b.MatricesIndicesExtraKind)&&(u.matricesIndicesExtra=A.getVerticesData(q.b.MatricesIndicesExtraKind,v,z)),A.isVerticesDataPresent(q.b.MatricesWeightsExtraKind)&&(u.matricesWeightsExtra=A.getVerticesData(q.b.MatricesWeightsExtraKind,v,z)),u.indices=A.getIndices(v,z),u},H.CreateRibbon=function(A){throw j.a.WarnImport("ribbonBuilder")},H.CreateBox=function(A){throw j.a.WarnImport("boxBuilder")},H.CreateSphere=function(A){throw j.a.WarnImport("sphereBuilder")},H.CreateCylinder=function(A){throw j.a.WarnImport("cylinderBuilder")},H.CreateTorus=function(A){throw j.a.WarnImport("torusBuilder")},H.CreateLineSystem=function(A){throw j.a.WarnImport("linesBuilder")},H.CreateDashedLines=function(A){throw j.a.WarnImport("linesBuilder")},H.CreateGround=function(A){throw j.a.WarnImport("groundBuilder")},H.CreateTiledGround=function(A){throw j.a.WarnImport("groundBuilder")},H.CreateGroundFromHeightMap=function(A){throw j.a.WarnImport("groundBuilder")},H.CreatePlane=function(A){throw j.a.WarnImport("planeBuilder")},H.CreateDisc=function(A){throw j.a.WarnImport("discBuilder")},H.CreatePolygon=function(A,v,z,u,w,y){throw j.a.WarnImport("polygonBuilder")},H.CreateIcoSphere=function(A){throw j.a.WarnImport("icoSphereBuilder")},H.CreatePolyhedron=function(A){throw j.a.WarnImport("polyhedronBuilder")},H.CreateTorusKnot=function(A){throw j.a.WarnImport("torusKnotBuilder")},H.ComputeNormals=function(A,v,z,u){var w=0,y=0,r=0,o=0,G=0,M=0,R=0,W=0,Y=0,X=0,ea=0,ca=0,oa=0,Z=0,T=0,V=0,D=0,F=0,L=0,N=0,p=!1,g=!1,n=!1,s=!1,t=1,C=0,J=null;if(u&&(p=!!u.facetNormals,g=!!u.facetPositions,n=!!u.facetPartitioning,t=!0===u.useRightHandedSystem?-1:1,C=u.ratio||0,s=!!u.depthSort,J=u.distanceTo,s)){void 0===J&&(J=O.x.Zero());var Q=u.depthSortedFacets}var $=0,aa=0,ba=0,ia=0;if(n&&u&&u.bbSize){var qa=0,ja=0,sa=0,za=0,Fa=0,Ea=0,Ba=0,Sa=0,Xa=0,Ka=0,Ga=0,nb=0,jb=0,bb=0,fb=0,ob=0,Cb=u.bbSize.x>u.bbSize.y?u.bbSize.x:u.bbSize.y;Cb=Cb>u.bbSize.z?Cb:u.bbSize.z,$=u.subDiv.X*C/u.bbSize.x,aa=u.subDiv.Y*C/u.bbSize.y,ba=u.subDiv.Z*C/u.bbSize.z,ia=u.subDiv.max*u.subDiv.max,u.facetPartitioning.length=0}for(w=0;w<A.length;w++)z[w]=0;var gb=v.length/3|0;for(w=0;w<gb;w++){if(oa=(ca=3*v[3*w])+1,Z=ca+2,V=(T=3*v[3*w+1])+1,D=T+2,L=(F=3*v[3*w+2])+1,N=F+2,y=A[ca]-A[T],r=A[oa]-A[V],o=A[Z]-A[D],G=A[F]-A[T],M=A[L]-A[V],W=t*(r*(R=A[N]-A[D])-o*M),Y=t*(o*G-y*R),X=t*(y*M-r*G),W/=ea=0===(ea=Math.sqrt(W*W+Y*Y+X*X))?1:ea,Y/=ea,X/=ea,p&&u&&(u.facetNormals[w].x=W,u.facetNormals[w].y=Y,u.facetNormals[w].z=X),g&&u&&(u.facetPositions[w].x=(A[ca]+A[T]+A[F])/3,u.facetPositions[w].y=(A[oa]+A[V]+A[L])/3,u.facetPositions[w].z=(A[Z]+A[D]+A[N])/3),n&&u&&(qa=Math.floor((u.facetPositions[w].x-u.bInfo.minimum.x*C)*$),ja=Math.floor((u.facetPositions[w].y-u.bInfo.minimum.y*C)*aa),sa=Math.floor((u.facetPositions[w].z-u.bInfo.minimum.z*C)*ba),za=Math.floor((A[ca]-u.bInfo.minimum.x*C)*$),Fa=Math.floor((A[oa]-u.bInfo.minimum.y*C)*aa),Ea=Math.floor((A[Z]-u.bInfo.minimum.z*C)*ba),Ba=Math.floor((A[T]-u.bInfo.minimum.x*C)*$),Sa=Math.floor((A[V]-u.bInfo.minimum.y*C)*aa),Xa=Math.floor((A[D]-u.bInfo.minimum.z*C)*ba),Ka=Math.floor((A[F]-u.bInfo.minimum.x*C)*$),Ga=Math.floor((A[L]-u.bInfo.minimum.y*C)*aa),nb=Math.floor((A[N]-u.bInfo.minimum.z*C)*ba),bb=za+u.subDiv.max*Fa+ia*Ea,fb=Ba+u.subDiv.max*Sa+ia*Xa,ob=Ka+u.subDiv.max*Ga+ia*nb,jb=qa+u.subDiv.max*ja+ia*sa,u.facetPartitioning[jb]=u.facetPartitioning[jb]?u.facetPartitioning[jb]:new Array(),u.facetPartitioning[bb]=u.facetPartitioning[bb]?u.facetPartitioning[bb]:new Array(),u.facetPartitioning[fb]=u.facetPartitioning[fb]?u.facetPartitioning[fb]:new Array(),u.facetPartitioning[ob]=u.facetPartitioning[ob]?u.facetPartitioning[ob]:new Array(),u.facetPartitioning[bb].push(w),fb!=bb&&u.facetPartitioning[fb].push(w),ob!=fb&&ob!=bb&&u.facetPartitioning[ob].push(w),jb!=bb&&jb!=fb&&jb!=ob&&u.facetPartitioning[jb].push(w)),s&&u&&u.facetPositions){var qb=Q[w];qb.ind=3*w,qb.sqDistance=O.x.DistanceSquared(u.facetPositions[w],J)}z[ca]+=W,z[oa]+=Y,z[Z]+=X,z[T]+=W,z[V]+=Y,z[D]+=X,z[F]+=W,z[L]+=Y,z[N]+=X}for(w=0;w<z.length/3;w++)W=z[3*w],Y=z[3*w+1],X=z[3*w+2],W/=ea=0===(ea=Math.sqrt(W*W+Y*Y+X*X))?1:ea,Y/=ea,X/=ea,z[3*w]=W,z[3*w+1]=Y,z[3*w+2]=X},H._ComputeSides=function(A,v,z,u,w,y,r){var o,G,M=z.length,R=u.length;switch(A=A||H.DEFAULTSIDE){case H.FRONTSIDE:break;case H.BACKSIDE:var W;for(o=0;o<M;o+=3)W=z[o],z[o]=z[o+2],z[o+2]=W;for(G=0;G<R;G++)u[G]=-u[G];break;case H.DOUBLESIDE:for(var Y=v.length,X=Y/3,ea=0;ea<Y;ea++)v[Y+ea]=v[ea];for(o=0;o<M;o+=3)z[o+M]=z[o+2]+X,z[o+1+M]=z[o+1]+X,z[o+2+M]=z[o]+X;for(G=0;G<R;G++)u[R+G]=-u[G];var ca=w.length,oa=0;for(oa=0;oa<ca;oa++)w[oa+ca]=w[oa];for(y=y||new O.y(0,0,1,1),r=r||new O.y(0,0,1,1),oa=0,o=0;o<ca/2;o++)w[oa]=y.x+(y.z-y.x)*w[oa],w[oa+1]=y.y+(y.w-y.y)*w[oa+1],w[oa+ca]=r.x+(r.z-r.x)*w[oa+ca],w[oa+ca+1]=r.y+(r.w-r.y)*w[oa+ca+1],oa+=2}},H.ImportVertexData=function(A,v){var z=new H(),u=A.positions;u&&z.set(u,q.b.PositionKind);var w=A.normals;w&&z.set(w,q.b.NormalKind);var y=A.tangents;y&&z.set(y,q.b.TangentKind);var r=A.uvs;r&&z.set(r,q.b.UVKind);var o=A.uv2s;o&&z.set(o,q.b.UV2Kind);var G=A.uv3s;G&&z.set(G,q.b.UV3Kind);var M=A.uv4s;M&&z.set(M,q.b.UV4Kind);var R=A.uv5s;R&&z.set(R,q.b.UV5Kind);var W=A.uv6s;W&&z.set(W,q.b.UV6Kind);var Y=A.colors;Y&&z.set(O.f.CheckColors4(Y,u.length/3),q.b.ColorKind);var X=A.matricesIndices;X&&z.set(X,q.b.MatricesIndicesKind);var ea=A.matricesWeights;ea&&z.set(ea,q.b.MatricesWeightsKind);var ca=A.indices;ca&&(z.indices=ca),v.setAllVerticesData(z,A.updatable)},H.FRONTSIDE=0,H.BACKSIDE=1,H.DOUBLESIDE=2,H.DEFAULTSIDE=0,H}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q}),l.d(x,"b",function(){return j});var O=l(1),q=function(){function I(){}return I.NAME_EFFECTLAYER="EffectLayer",I.NAME_LAYER="Layer",I.NAME_LENSFLARESYSTEM="LensFlareSystem",I.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",I.NAME_PARTICLESYSTEM="ParticleSystem",I.NAME_GAMEPAD="Gamepad",I.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",I.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",I.NAME_DEPTHRENDERER="DepthRenderer",I.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",I.NAME_SPRITE="Sprite",I.NAME_OUTLINERENDERER="Outline",I.NAME_PROCEDURALTEXTURE="ProceduralTexture",I.NAME_SHADOWGENERATOR="ShadowGenerator",I.NAME_OCTREE="Octree",I.NAME_PHYSICSENGINE="PhysicsEngine",I.NAME_AUDIO="Audio",I.STEP_ISREADYFORMESH_EFFECTLAYER=0,I.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,I.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,I.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,I.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,I.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,I.STEP_BEFORECAMERADRAW_LAYER=1,I.STEP_BEFORERENDERTARGETDRAW_LAYER=0,I.STEP_BEFORERENDERINGMESH_OUTLINE=0,I.STEP_AFTERRENDERINGMESH_OUTLINE=0,I.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,I.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,I.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,I.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,I.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,I.STEP_AFTERRENDERTARGETDRAW_LAYER=0,I.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,I.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,I.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,I.STEP_AFTERCAMERADRAW_LAYER=3,I.STEP_AFTERRENDER_AUDIO=0,I.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=0,I.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,I.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=2,I.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,I.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,I.STEP_POINTERMOVE_SPRITE=0,I.STEP_POINTERDOWN_SPRITE=0,I.STEP_POINTERUP_SPRITE=0,I}(),j=function(I){function H(A){return I.apply(this,A)||this}return O.d(H,I),H.Create=function(){return Object.create(H.prototype)},H.prototype.registerStep=function(A,v,z){var u=0;for(Number.MAX_VALUE;u<this.length;u++)if(A<this[u].index)break;this.splice(u,0,{index:A,component:v,action:z.bind(v)})},H.prototype.clear=function(){this.length=0},H}(Array)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return v});var O=l(6),q=l(16),j=l(0),I=l(23),H=l(4),A=l(38),v=function(){function z(){}return z.BindEyePosition=function(u,w){if(w._forcedViewPosition)u.setVector3("vEyePosition",w._forcedViewPosition);else{var y=w.activeCamera.globalPosition;y||(y=w.activeCamera.devicePosition),u.setVector3("vEyePosition",w._mirroredCameraPosition?w._mirroredCameraPosition:y)}},z.PrepareDefinesForMergedUV=function(u,w,y){w._needUVs=!0,w[y]=!0,u.getTextureMatrix().isIdentityAs3x2()?(w[y+"DIRECTUV"]=u.coordinatesIndex+1,0===u.coordinatesIndex?w.MAINUV1=!0:w.MAINUV2=!0):w[y+"DIRECTUV"]=0},z.BindTextureMatrix=function(u,w,y){var r=u.getTextureMatrix();r.isIdentityAs3x2()||w.updateMatrix(y+"Matrix",r)},z.PrepareDefinesForMisc=function(u,w,y,r,o,G,M){M._areMiscDirty&&(M.LOGARITHMICDEPTH=y,M.POINTSIZE=r,M.FOG=w.fogEnabled&&u.applyFog&&w.fogMode!==q.a.FOGMODE_NONE&&o,M.NONUNIFORMSCALING=u.nonUniformScaling,M.ALPHATEST=G)},z.PrepareDefinesForFrameBoundValues=function(u,w,y,r,o){void 0===o&&(o=null);var G,M,R,W,Y=!1;G=null==o?void 0!==u.clipPlane&&null!==u.clipPlane:o,M=null==o?void 0!==u.clipPlane2&&null!==u.clipPlane2:o,R=null==o?void 0!==u.clipPlane3&&null!==u.clipPlane3:o,W=null==o?void 0!==u.clipPlane4&&null!==u.clipPlane4:o,y.CLIPPLANE!==G&&(y.CLIPPLANE=G,Y=!0),y.CLIPPLANE2!==M&&(y.CLIPPLANE2=M,Y=!0),y.CLIPPLANE3!==R&&(y.CLIPPLANE3=R,Y=!0),y.CLIPPLANE4!==W&&(y.CLIPPLANE4=W,Y=!0),y.DEPTHPREPASS!==!w.getColorWrite()&&(y.DEPTHPREPASS=!y.DEPTHPREPASS,Y=!0),y.INSTANCES!==r&&(y.INSTANCES=r,Y=!0),Y&&y.markAsUnprocessed()},z.PrepareDefinesForAttributes=function(u,w,y,r,o,G){if(void 0===o&&(o=!1),void 0===G&&(G=!0),!w._areAttributesDirty&&w._needNormals===w._normals&&w._needUVs===w._uvs)return!1;if(w._normals=w._needNormals,w._uvs=w._needUVs,w.NORMAL=w._needNormals&&u.isVerticesDataPresent(H.b.NormalKind),w._needNormals&&u.isVerticesDataPresent(H.b.TangentKind)&&(w.TANGENT=!0),w._needUVs?(w.UV1=u.isVerticesDataPresent(H.b.UVKind),w.UV2=u.isVerticesDataPresent(H.b.UV2Kind)):(w.UV1=!1,w.UV2=!1),y){var M=u.useVertexColors&&u.isVerticesDataPresent(H.b.ColorKind);w.VERTEXCOLOR=M,w.VERTEXALPHA=u.hasVertexAlpha&&M&&G}if(r)if(u.useBones&&u.computeBonesUsingShaders&&u.skeleton){w.NUM_BONE_INFLUENCERS=u.numBoneInfluencers;var R=void 0!==w.BONETEXTURE;u.skeleton.isUsingTextureForMatrices&&R?w.BONETEXTURE=!0:(w.BonesPerMesh=u.skeleton.bones.length+1,w.BONETEXTURE=!R&&void 0)}else w.NUM_BONE_INFLUENCERS=0,w.BonesPerMesh=0;if(o){var W=u.morphTargetManager;W?(w.MORPHTARGETS_TANGENT=W.supportsTangents&&w.TANGENT,w.MORPHTARGETS_NORMAL=W.supportsNormals&&w.NORMAL,w.MORPHTARGETS=W.numInfluencers>0,w.NUM_MORPH_INFLUENCERS=W.numInfluencers):(w.MORPHTARGETS_TANGENT=!1,w.MORPHTARGETS_NORMAL=!1,w.MORPHTARGETS=!1,w.NUM_MORPH_INFLUENCERS=0)}return!0},z.PrepareDefinesForMultiview=function(u,w){if(u.activeCamera){var y=w.MULTIVIEW;w.MULTIVIEW=null!==u.activeCamera.outputRenderTarget&&u.activeCamera.outputRenderTarget.getViewCount()>1,w.MULTIVIEW!=y&&w.markAsUnprocessed()}},z.PrepareDefinesForLights=function(u,w,y,r,o,G){if(void 0===o&&(o=4),void 0===G&&(G=!1),!y._areLightsDirty)return y._needNormals;var M=0,R=!1,W=!1,Y=!1,X=!1,ea=!1;if(u.lightsEnabled&&!G)for(var ca=0,oa=w.lightSources;ca<oa.length;ca++){var Z=oa[ca];switch(R=!0,void 0===y["LIGHT"+M]&&(W=!0),y["LIGHT"+M]=!0,y["SPOTLIGHT"+M]=!1,y["HEMILIGHT"+M]=!1,y["POINTLIGHT"+M]=!1,y["DIRLIGHT"+M]=!1,Z.prepareLightSpecificDefines(y,M),y["LIGHT_FALLOFF_PHYSICAL"+M]=!1,y["LIGHT_FALLOFF_GLTF"+M]=!1,y["LIGHT_FALLOFF_STANDARD"+M]=!1,Z.falloffType){case A.a.FALLOFF_GLTF:y["LIGHT_FALLOFF_GLTF"+M]=!0;break;case A.a.FALLOFF_PHYSICAL:y["LIGHT_FALLOFF_PHYSICAL"+M]=!0;break;case A.a.FALLOFF_STANDARD:y["LIGHT_FALLOFF_STANDARD"+M]=!0}if(r&&!Z.specular.equalsFloats(0,0,0)&&(ea=!0),y["SHADOW"+M]=!1,y["SHADOWPCF"+M]=!1,y["SHADOWPCSS"+M]=!1,y["SHADOWPOISSON"+M]=!1,y["SHADOWESM"+M]=!1,y["SHADOWCUBE"+M]=!1,y["SHADOWLOWQUALITY"+M]=!1,y["SHADOWMEDIUMQUALITY"+M]=!1,w&&w.receiveShadows&&u.shadowsEnabled&&Z.shadowEnabled){var T=Z.getShadowGenerator();if(T){var V=T.getShadowMap();V&&V.renderList&&V.renderList.length>0&&(X=!0,T.prepareDefines(y,M))}}if(Z.lightmapMode!=A.a.LIGHTMAP_DEFAULT?(Y=!0,y["LIGHTMAPEXCLUDED"+M]=!0,y["LIGHTMAPNOSPECULAR"+M]=Z.lightmapMode==A.a.LIGHTMAP_SHADOWSONLY):(y["LIGHTMAPEXCLUDED"+M]=!1,y["LIGHTMAPNOSPECULAR"+M]=!1),++M===o)break}y.SPECULARTERM=ea,y.SHADOWS=X;for(var D=M;D<o;D++)void 0!==y["LIGHT"+D]&&(y["LIGHT"+D]=!1,y["HEMILIGHT"+D]=!1,y["POINTLIGHT"+D]=!1,y["DIRLIGHT"+D]=!1,y["SPOTLIGHT"+D]=!1,y["SHADOW"+D]=!1,y["SHADOWPCF"+D]=!1,y["SHADOWPCSS"+D]=!1,y["SHADOWPOISSON"+D]=!1,y["SHADOWESM"+D]=!1,y["SHADOWCUBE"+D]=!1,y["SHADOWLOWQUALITY"+D]=!1,y["SHADOWMEDIUMQUALITY"+D]=!1);var F=u.getEngine().getCaps();return void 0===y.SHADOWFLOAT&&(W=!0),y.SHADOWFLOAT=X&&(F.textureFloatRender&&F.textureFloatLinearFiltering||F.textureHalfFloatRender&&F.textureHalfFloatLinearFiltering),y.LIGHTMAPEXCLUDED=Y,W&&y.rebuild(),R},z.PrepareUniformsAndSamplersList=function(u,w,y,r){var o;void 0===r&&(r=4);var G=null;if(u.uniformsNames){var M=u;o=M.uniformsNames,G=M.uniformBuffersNames,w=M.samplers,y=M.defines,r=M.maxSimultaneousLights}else o=u,w||(w=[]);for(var R=0;R<r&&y["LIGHT"+R];R++)o.push("vLightData"+R,"vLightDiffuse"+R,"vLightSpecular"+R,"vLightDirection"+R,"vLightFalloff"+R,"vLightGround"+R,"lightMatrix"+R,"shadowsInfo"+R,"depthValues"+R),G&&G.push("Light"+R),w.push("shadowSampler"+R),w.push("depthSampler"+R),y["PROJECTEDLIGHTTEXTURE"+R]&&(w.push("projectionLightSampler"+R),o.push("textureProjectionMatrix"+R));y.NUM_MORPH_INFLUENCERS&&o.push("morphTargetInfluences")},z.HandleFallbacksForShadows=function(u,w,y,r){void 0===y&&(y=4),void 0===r&&(r=0);for(var o=0,G=0;G<y&&u["LIGHT"+G];G++)G>0&&(o=r+G,w.addFallback(o,"LIGHT"+G)),u.SHADOWS||(u["SHADOW"+G]&&w.addFallback(r,"SHADOW"+G),u["SHADOWPCF"+G]&&w.addFallback(r,"SHADOWPCF"+G),u["SHADOWPCSS"+G]&&w.addFallback(r,"SHADOWPCSS"+G),u["SHADOWPOISSON"+G]&&w.addFallback(r,"SHADOWPOISSON"+G),u["SHADOWESM"+G]&&w.addFallback(r,"SHADOWESM"+G));return o++},z.PrepareAttributesForMorphTargets=function(u,w,y){var r=y.NUM_MORPH_INFLUENCERS;if(r>0&&I.a.LastCreatedEngine)for(var o=I.a.LastCreatedEngine.getCaps().maxVertexAttribs,G=w.morphTargetManager,M=G&&G.supportsNormals&&y.NORMAL,R=G&&G.supportsTangents&&y.TANGENT,W=0;W<r;W++)u.push(H.b.PositionKind+W),M&&u.push(H.b.NormalKind+W),R&&u.push(H.b.TangentKind+W),u.length>o&&O.a.Error("Cannot add more vertex attributes for mesh "+w.name)},z.PrepareAttributesForBones=function(u,w,y,r){y.NUM_BONE_INFLUENCERS>0&&(r.addCPUSkinningFallback(0,w),u.push(H.b.MatricesIndicesKind),u.push(H.b.MatricesWeightsKind),y.NUM_BONE_INFLUENCERS>4&&(u.push(H.b.MatricesIndicesExtraKind),u.push(H.b.MatricesWeightsExtraKind)))},z.PrepareAttributesForInstances=function(u,w){w.INSTANCES&&(u.push("world0"),u.push("world1"),u.push("world2"),u.push("world3"))},z.BindLightShadow=function(u,w,y,r){if(u.shadowEnabled&&w.receiveShadows){var o=u.getShadowGenerator();o&&o.bindShadowLight(y,r)}},z.BindLightProperties=function(u,w,y){u.transferToEffect(w,y+"")},z.BindLights=function(u,w,y,r,o,G){void 0===o&&(o=4),void 0===G&&(G=!1);for(var M=Math.min(w.lightSources.length,o),R=0;R<M;R++){var W=w.lightSources[R],Y=R.toString(),X=W.getScaledIntensity();W._uniformBuffer.bindToEffect(y,"Light"+R),z.BindLightProperties(W,y,R),W.diffuse.scaleToRef(X,j.t.Color3[0]),W._uniformBuffer.updateColor4("vLightDiffuse",j.t.Color3[0],G?W.radius:W.range,Y),r.SPECULARTERM&&(W.specular.scaleToRef(X,j.t.Color3[1]),W._uniformBuffer.updateColor3("vLightSpecular",j.t.Color3[1],Y)),u.shadowsEnabled&&this.BindLightShadow(W,w,Y,y),W._uniformBuffer.update()}},z.BindFogParameters=function(u,w,y,r){void 0===r&&(r=!1),u.fogEnabled&&w.applyFog&&u.fogMode!==q.a.FOGMODE_NONE&&(y.setFloat4("vFogInfos",u.fogMode,u.fogStart,u.fogEnd,u.fogDensity),r?(u.fogColor.toLinearSpaceToRef(this._tempFogColor),y.setColor3("vFogColor",this._tempFogColor)):y.setColor3("vFogColor",u.fogColor))},z.BindBonesParameters=function(u,w){if(w&&u&&(u.computeBonesUsingShaders&&w._bonesComputationForcedToCPU&&(u.computeBonesUsingShaders=!1),u.useBones&&u.computeBonesUsingShaders&&u.skeleton)){var y=u.skeleton;if(y.isUsingTextureForMatrices&&w.getUniformIndex("boneTextureWidth")>-1){var r=y.getTransformMatrixTexture();w.setTexture("boneSampler",r),w.setFloat("boneTextureWidth",4*(y.bones.length+1))}else{var o=y.getTransformMatrices(u);o&&w.setMatrices("mBones",o)}}},z.BindMorphTargetParameters=function(u,w){var y=u.morphTargetManager;u&&y&&w.setFloatArray("morphTargetInfluences",y.influences)},z.BindLogDepth=function(u,w,y){u.LOGARITHMICDEPTH&&w.setFloat("logarithmicDepthConstant",2/(Math.log(y.activeCamera.maxZ+1)/Math.LN2))},z.BindClipPlane=function(u,w){if(w.clipPlane){var y=w.clipPlane;u.setFloat4("vClipPlane",y.normal.x,y.normal.y,y.normal.z,y.d)}w.clipPlane2&&(y=w.clipPlane2,u.setFloat4("vClipPlane2",y.normal.x,y.normal.y,y.normal.z,y.d)),w.clipPlane3&&(y=w.clipPlane3,u.setFloat4("vClipPlane3",y.normal.x,y.normal.y,y.normal.z,y.d)),w.clipPlane4&&(y=w.clipPlane4,u.setFloat4("vClipPlane4",y.normal.x,y.normal.y,y.normal.z,y.d))},z._tempFogColor=j.e.Black(),z}()},function(Aa,x,l){"use strict";var O=l(1),q=l(9),j=l(47),I=l(8),H=l(28),A=l(61),v=l(29),z=l(0),u=l(42),w=l(24),y=l(21),r=l(30),o=l(31),G=l(63),M=l(38),R=l(50),W=l(36),Y=l(83),X=l(91),ea=l(14),ca=l(3),oa=l(35),Z=l(6),T=l(23),V=l(19),D=l(17),F=l(79),L=l(51),N=function(){function n(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(n.prototype,"singleClick",{get:function(){return this._singleClick},set:function(s){this._singleClick=s},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(s){this._doubleClick=s},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(s){this._hasSwiped=s},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ignore",{get:function(){return this._ignore},set:function(s){this._ignore=s},enumerable:!0,configurable:!0}),n}(),p=function(){function n(s){this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new z.w(0,0),this._previousStartingPointerPosition=new z.w(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._scene=s}return Object.defineProperty(n.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"unTranslatedPointer",{get:function(){return new z.w(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pointerX",{get:function(){return this._pointerX},set:function(s){this._pointerX=s},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pointerY",{get:function(){return this._pointerY},set:function(s){this._pointerY=s},enumerable:!0,configurable:!0}),n.prototype._updatePointerPosition=function(s){var t=this._scene.getEngine().getRenderingCanvasClientRect();t&&(this._pointerX=s.clientX-t.left,this._pointerY=s.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},n.prototype._processPointerMove=function(s,t){var C=this._scene,J=C.getEngine().getRenderingCanvas();if(J){J.tabIndex=1,J.style.cursor=C.defaultCursor;var Q=!!(s&&s.hit&&s.pickedMesh);Q?(C.setPointerOverMesh(s.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(this._pointerOverMesh.actionManager.hoverCursor?J.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:J.style.cursor=C.hoverCursor)):C.setPointerOverMesh(null);for(var $=0,aa=C._pointerMoveStage;$<aa.length;$++)s=aa[$].action(this._unTranslatedPointerX,this._unTranslatedPointerY,s,Q,J);if(s){var ba=t.type===this._wheelEventName?D.a.POINTERWHEEL:D.a.POINTERMOVE;if(C.onPointerMove&&C.onPointerMove(t,s,ba),C.onPointerObservable.hasObservers()){var ia=new D.b(ba,t,s);this._setRayOnPointerInfo(ia),C.onPointerObservable.notifyObservers(ia,ba)}}}},n.prototype._setRayOnPointerInfo=function(s){var t=this._scene;s.pickInfo&&!s.pickInfo._pickingUnavailable&&(s.pickInfo.ray||(s.pickInfo.ray=t.createPickingRay(s.event.offsetX,s.event.offsetY,z.j.Identity(),t.activeCamera)))},n.prototype._checkPrePointerObservable=function(s,t,C){var J=this._scene,Q=new D.d(C,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return s&&(Q.ray=s.ray),J.onPrePointerObservable.notifyObservers(Q,C),!!Q.skipOnPointerObservable},n.prototype.simulatePointerMove=function(s,t){var C=new PointerEvent("pointermove",t);this._checkPrePointerObservable(s,C,D.a.POINTERMOVE)||this._processPointerMove(s,C)},n.prototype.simulatePointerDown=function(s,t){var C=new PointerEvent("pointerdown",t);this._checkPrePointerObservable(s,C,D.a.POINTERDOWN)||this._processPointerDown(s,C)},n.prototype._processPointerDown=function(s,t){var C=this,J=this._scene;if(s&&s.hit&&s.pickedMesh){this._pickedDownMesh=s.pickedMesh;var Q=s.pickedMesh.actionManager;if(Q){if(Q.hasPickTriggers)switch(Q.processTrigger(ca.a.ACTION_OnPickDownTrigger,W.a.CreateNew(s.pickedMesh,t)),t.button){case 0:Q.processTrigger(ca.a.ACTION_OnLeftPickTrigger,W.a.CreateNew(s.pickedMesh,t));break;case 1:Q.processTrigger(ca.a.ACTION_OnCenterPickTrigger,W.a.CreateNew(s.pickedMesh,t));break;case 2:Q.processTrigger(ca.a.ACTION_OnRightPickTrigger,W.a.CreateNew(s.pickedMesh,t))}Q.hasSpecificTrigger(ca.a.ACTION_OnLongPressTrigger)&&window.setTimeout(function(){var qa=J.pick(C._unTranslatedPointerX,C._unTranslatedPointerY,function(ja){return ja.isPickable&&ja.isVisible&&ja.isReady()&&ja.actionManager&&ja.actionManager.hasSpecificTrigger(ca.a.ACTION_OnLongPressTrigger)&&ja==C._pickedDownMesh},!1,J.cameraToUseForPointers);qa&&qa.hit&&qa.pickedMesh&&Q&&0!==C._totalPointersPressed&&Date.now()-C._startingPointerTime>n.LongPressDelay&&!C._isPointerSwiping()&&(C._startingPointerTime=0,Q.processTrigger(ca.a.ACTION_OnLongPressTrigger,W.a.CreateNew(qa.pickedMesh,t)))},n.LongPressDelay)}}else for(var $=0,aa=J._pointerDownStage;$<aa.length;$++)s=aa[$].action(this._unTranslatedPointerX,this._unTranslatedPointerY,s,t);if(s){var ba=D.a.POINTERDOWN;if(J.onPointerDown&&J.onPointerDown(t,s,ba),J.onPointerObservable.hasObservers()){var ia=new D.b(ba,t,s);this._setRayOnPointerInfo(ia),J.onPointerObservable.notifyObservers(ia,ba)}}},n.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>n.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>n.DragMovementThreshold},n.prototype.simulatePointerUp=function(s,t,C){var J=new PointerEvent("pointerup",t),Q=new N();C?Q.doubleClick=!0:Q.singleClick=!0,this._checkPrePointerObservable(s,J,D.a.POINTERUP)||this._processPointerUp(s,J,Q)},n.prototype._processPointerUp=function(s,t,C){var J=this._scene;if(s&&s&&s.pickedMesh){if(this._pickedUpMesh=s.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(J.onPointerPick&&J.onPointerPick(t,s),C.singleClick&&!C.ignore&&J.onPointerObservable.hasObservers())){var Q=D.a.POINTERPICK,$=new D.b(Q,t,s);this._setRayOnPointerInfo($),J.onPointerObservable.notifyObservers($,Q)}var aa=s.pickedMesh._getActionManagerForTrigger();if(aa&&!C.ignore){aa.processTrigger(ca.a.ACTION_OnPickUpTrigger,W.a.CreateNew(s.pickedMesh,t)),!C.hasSwiped&&C.singleClick&&aa.processTrigger(ca.a.ACTION_OnPickTrigger,W.a.CreateNew(s.pickedMesh,t));var ba=s.pickedMesh._getActionManagerForTrigger(ca.a.ACTION_OnDoublePickTrigger);C.doubleClick&&ba&&ba.processTrigger(ca.a.ACTION_OnDoublePickTrigger,W.a.CreateNew(s.pickedMesh,t))}}else if(!C.ignore)for(var ia=0,qa=J._pointerUpStage;ia<qa.length;ia++)s=qa[ia].action(this._unTranslatedPointerX,this._unTranslatedPointerY,s,t);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var ja=this._pickedDownMesh._getActionManagerForTrigger(ca.a.ACTION_OnPickOutTrigger);ja&&ja.processTrigger(ca.a.ACTION_OnPickOutTrigger,W.a.CreateNew(this._pickedDownMesh,t))}var sa=0;J.onPointerObservable.hasObservers()&&(!C.ignore&&!C.hasSwiped&&(C.singleClick&&J.onPointerObservable.hasSpecificMask(D.a.POINTERTAP)?sa=D.a.POINTERTAP:C.doubleClick&&J.onPointerObservable.hasSpecificMask(D.a.POINTERDOUBLETAP)&&(sa=D.a.POINTERDOUBLETAP),sa)&&($=new D.b(sa,t,s),this._setRayOnPointerInfo($),J.onPointerObservable.notifyObservers($,sa)),C.ignore||(sa=D.a.POINTERUP,$=new D.b(sa,t,s),this._setRayOnPointerInfo($),J.onPointerObservable.notifyObservers($,sa))),J.onPointerUp&&!C.ignore&&J.onPointerUp(t,s,sa)},n.prototype.isPointerCaptured=function(s){return void 0===s&&(s=0),this._pointerCaptures[s]},n.prototype.attachControl=function(s,t,C){var J=this;void 0===s&&(s=!0),void 0===t&&(t=!0),void 0===C&&(C=!0);var Q=this._scene,$=Q.getEngine().getRenderingCanvas();if($){var aa=Q.getEngine();this._initActionManager=function(ia,qa){if(!J._meshPickProceed){var ja=Q.pick(J._unTranslatedPointerX,J._unTranslatedPointerY,Q.pointerDownPredicate,!1,Q.cameraToUseForPointers);J._currentPickResult=ja,ja&&(ia=ja.hit&&ja.pickedMesh?ja.pickedMesh._getActionManagerForTrigger():null),J._meshPickProceed=!0}return ia},this._delayedSimpleClick=function(ia,qa,ja){(Date.now()-J._previousStartingPointerTime>n.DoubleClickDelay&&!J._doubleClickOccured||ia!==J._previousButtonPressed)&&(J._doubleClickOccured=!1,qa.singleClick=!0,qa.ignore=!1,ja(qa,J._currentPickResult))},this._initClickEvent=function(ia,qa,ja,sa){var za=new N();J._currentPickResult=null;var Fa=null,Ea=ia.hasSpecificMask(D.a.POINTERPICK)||qa.hasSpecificMask(D.a.POINTERPICK)||ia.hasSpecificMask(D.a.POINTERTAP)||qa.hasSpecificMask(D.a.POINTERTAP)||ia.hasSpecificMask(D.a.POINTERDOUBLETAP)||qa.hasSpecificMask(D.a.POINTERDOUBLETAP);!Ea&&F.a&&(Fa=J._initActionManager(Fa,za))&&(Ea=Fa.hasPickTriggers);var Ba=!1;if(Ea){var Sa=ja.button;if(za.hasSwiped=J._isPointerSwiping(),!za.hasSwiped){var Xa=!n.ExclusiveDoubleClickMode;Xa||(Xa=!ia.hasSpecificMask(D.a.POINTERDOUBLETAP)&&!qa.hasSpecificMask(D.a.POINTERDOUBLETAP))&&!F.a.HasSpecificTrigger(ca.a.ACTION_OnDoublePickTrigger)&&(Fa=J._initActionManager(Fa,za))&&(Xa=!Fa.hasSpecificTrigger(ca.a.ACTION_OnDoublePickTrigger)),Xa?(Date.now()-J._previousStartingPointerTime>n.DoubleClickDelay||Sa!==J._previousButtonPressed)&&(za.singleClick=!0,sa(za,J._currentPickResult),Ba=!0):(J._previousDelayedSimpleClickTimeout=J._delayedSimpleClickTimeout,J._delayedSimpleClickTimeout=window.setTimeout(J._delayedSimpleClick.bind(J,Sa,za,sa),n.DoubleClickDelay));var Ka=ia.hasSpecificMask(D.a.POINTERDOUBLETAP)||qa.hasSpecificMask(D.a.POINTERDOUBLETAP);!Ka&&F.a.HasSpecificTrigger(ca.a.ACTION_OnDoublePickTrigger)&&(Fa=J._initActionManager(Fa,za))&&(Ka=Fa.hasSpecificTrigger(ca.a.ACTION_OnDoublePickTrigger)),Ka&&(Sa===J._previousButtonPressed&&Date.now()-J._previousStartingPointerTime<n.DoubleClickDelay&&!J._doubleClickOccured?(za.hasSwiped||J._isPointerSwiping()?(J._doubleClickOccured=!1,J._previousStartingPointerTime=J._startingPointerTime,J._previousStartingPointerPosition.x=J._startingPointerPosition.x,J._previousStartingPointerPosition.y=J._startingPointerPosition.y,J._previousButtonPressed=Sa,n.ExclusiveDoubleClickMode?(J._previousDelayedSimpleClickTimeout&&clearTimeout(J._previousDelayedSimpleClickTimeout),J._previousDelayedSimpleClickTimeout=J._delayedSimpleClickTimeout,sa(za,J._previousPickResult)):sa(za,J._currentPickResult)):(J._previousStartingPointerTime=0,J._doubleClickOccured=!0,za.doubleClick=!0,za.ignore=!1,n.ExclusiveDoubleClickMode&&J._previousDelayedSimpleClickTimeout&&clearTimeout(J._previousDelayedSimpleClickTimeout),J._previousDelayedSimpleClickTimeout=J._delayedSimpleClickTimeout,sa(za,J._currentPickResult)),Ba=!0):(J._doubleClickOccured=!1,J._previousStartingPointerTime=J._startingPointerTime,J._previousStartingPointerPosition.x=J._startingPointerPosition.x,J._previousStartingPointerPosition.y=J._startingPointerPosition.y,J._previousButtonPressed=Sa))}}Ba||sa(za,J._currentPickResult)},this._onPointerMove=function(ia){if(J._updatePointerPosition(ia),!J._checkPrePointerObservable(null,ia,ia.type===J._wheelEventName?D.a.POINTERWHEEL:D.a.POINTERMOVE)&&(Q.cameraToUseForPointers||Q.activeCamera)){Q.pointerMovePredicate||(Q.pointerMovePredicate=function(ja){return ja.isPickable&&ja.isVisible&&ja.isReady()&&ja.isEnabled()&&(ja.enablePointerMoveEvents||Q.constantlyUpdateMeshUnderPointer||null!==ja.actionManager&&void 0!==ja.actionManager)&&(!Q.cameraToUseForPointers||0!=(Q.cameraToUseForPointers.layerMask&ja.layerMask))});var qa=Q.pick(J._unTranslatedPointerX,J._unTranslatedPointerY,Q.pointerMovePredicate,!1,Q.cameraToUseForPointers);J._processPointerMove(qa,ia)}},this._onPointerDown=function(ia){if(J._totalPointersPressed++,J._pickedDownMesh=null,J._meshPickProceed=!1,J._updatePointerPosition(ia),Q.preventDefaultOnPointerDown&&$&&(ia.preventDefault(),$.focus()),J._startingPointerPosition.x=J._pointerX,J._startingPointerPosition.y=J._pointerY,J._startingPointerTime=Date.now(),!J._checkPrePointerObservable(null,ia,D.a.POINTERDOWN)&&(Q.cameraToUseForPointers||Q.activeCamera)){J._pointerCaptures[ia.pointerId]=!0,Q.pointerDownPredicate||(Q.pointerDownPredicate=function(ja){return ja.isPickable&&ja.isVisible&&ja.isReady()&&ja.isEnabled()&&(!Q.cameraToUseForPointers||0!=(Q.cameraToUseForPointers.layerMask&ja.layerMask))}),J._pickedDownMesh=null;var qa=Q.pick(J._unTranslatedPointerX,J._unTranslatedPointerY,Q.pointerDownPredicate,!1,Q.cameraToUseForPointers);J._processPointerDown(qa,ia)}},this._onPointerUp=function(ia){0!==J._totalPointersPressed&&(J._totalPointersPressed--,J._pickedUpMesh=null,J._meshPickProceed=!1,J._updatePointerPosition(ia),Q.preventDefaultOnPointerUp&&$&&(ia.preventDefault(),$.focus()),J._initClickEvent(Q.onPrePointerObservable,Q.onPointerObservable,ia,function(qa,ja){if(Q.onPrePointerObservable.hasObservers()&&!qa.ignore){if(!qa.hasSwiped){if(qa.singleClick&&Q.onPrePointerObservable.hasSpecificMask(D.a.POINTERTAP)&&J._checkPrePointerObservable(null,ia,D.a.POINTERTAP))return;if(qa.doubleClick&&Q.onPrePointerObservable.hasSpecificMask(D.a.POINTERDOUBLETAP)&&J._checkPrePointerObservable(null,ia,D.a.POINTERDOUBLETAP))return}if(J._checkPrePointerObservable(null,ia,D.a.POINTERUP))return}J._pointerCaptures[ia.pointerId]&&(J._pointerCaptures[ia.pointerId]=!1,(Q.cameraToUseForPointers||Q.activeCamera)&&(Q.pointerUpPredicate||(Q.pointerUpPredicate=function(sa){return sa.isPickable&&sa.isVisible&&sa.isReady()&&sa.isEnabled()&&(!Q.cameraToUseForPointers||0!=(Q.cameraToUseForPointers.layerMask&sa.layerMask))}),!J._meshPickProceed&&(F.a&&F.a.HasTriggers||Q.onPointerObservable.hasObservers())&&J._initActionManager(null,qa),ja||(ja=J._currentPickResult),J._processPointerUp(ja,ia,qa),J._previousPickResult=J._currentPickResult))}))},this._onKeyDown=function(ia){var qa=L.a.KEYDOWN;if(Q.onPreKeyboardObservable.hasObservers()){var ja=new L.c(qa,ia);if(Q.onPreKeyboardObservable.notifyObservers(ja,qa),ja.skipOnPointerObservable)return}Q.onKeyboardObservable.hasObservers()&&(ja=new L.b(qa,ia),Q.onKeyboardObservable.notifyObservers(ja,qa)),Q.actionManager&&Q.actionManager.processTrigger(ca.a.ACTION_OnKeyDownTrigger,W.a.CreateNewFromScene(Q,ia))},this._onKeyUp=function(ia){var qa=L.a.KEYUP;if(Q.onPreKeyboardObservable.hasObservers()){var ja=new L.c(qa,ia);if(Q.onPreKeyboardObservable.notifyObservers(ja,qa),ja.skipOnPointerObservable)return}Q.onKeyboardObservable.hasObservers()&&(ja=new L.b(qa,ia),Q.onKeyboardObservable.notifyObservers(ja,qa)),Q.actionManager&&Q.actionManager.processTrigger(ca.a.ACTION_OnKeyUpTrigger,W.a.CreateNewFromScene(Q,ia))},this._onCanvasFocusObserver=aa.onCanvasFocusObservable.add(function(){$&&($.addEventListener("keydown",J._onKeyDown,!1),$.addEventListener("keyup",J._onKeyUp,!1))}),this._onCanvasBlurObserver=aa.onCanvasBlurObservable.add(function(){$&&($.removeEventListener("keydown",J._onKeyDown),$.removeEventListener("keyup",J._onKeyUp))});var ba=q.h.GetPointerPrefix();C&&($.addEventListener(ba+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",$.addEventListener(this._wheelEventName,this._onPointerMove,!1)),t&&$.addEventListener(ba+"down",this._onPointerDown,!1),s&&window.addEventListener(ba+"up",this._onPointerUp,!1)}},n.prototype.detachControl=function(){var s=q.h.GetPointerPrefix(),t=this._scene.getEngine().getRenderingCanvas(),C=this._scene.getEngine();t&&(t.removeEventListener(s+"move",this._onPointerMove),t.removeEventListener(s+"down",this._onPointerDown),window.removeEventListener(s+"up",this._onPointerUp),this._onCanvasBlurObserver&&C.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&C.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),t.removeEventListener("keydown",this._onKeyDown),t.removeEventListener("keyup",this._onKeyUp),t.style.cursor=this._scene.defaultCursor)},n.prototype.setPointerOverMesh=function(s){var t;this._pointerOverMesh!==s&&(this._pointerOverMesh&&(t=this._pointerOverMesh._getActionManagerForTrigger(ca.a.ACTION_OnPointerOutTrigger))&&t.processTrigger(ca.a.ACTION_OnPointerOutTrigger,W.a.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=s,this._pointerOverMesh&&(t=this._pointerOverMesh._getActionManagerForTrigger(ca.a.ACTION_OnPointerOverTrigger))&&t.processTrigger(ca.a.ACTION_OnPointerOverTrigger,W.a.CreateNew(this._pointerOverMesh)))},n.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},n.DragMovementThreshold=10,n.LongPressDelay=500,n.DoubleClickDelay=300,n.ExclusiveDoubleClickMode=!1,n}();l.d(x,"a",function(){return g});var g=function(n){function s(t,C){var J=n.call(this)||this;return J._inputManager=new p(J),J.cameraToUseForPointers=null,J._isScene=!0,J.autoClear=!0,J.autoClearDepthAndStencil=!0,J.clearColor=new z.f(.2,.2,.3,1),J.ambientColor=new z.e(0,0,0),J._forceWireframe=!1,J._forcePointsCloud=!1,J.animationsEnabled=!0,J._animationPropertiesOverride=null,J.useConstantAnimationDeltaTime=!1,J.constantlyUpdateMeshUnderPointer=!1,J.hoverCursor="pointer",J.defaultCursor="",J.preventDefaultOnPointerDown=!0,J.preventDefaultOnPointerUp=!0,J.metadata=null,J.reservedDataStore=null,J.disableOfflineSupportExceptionRules=new Array(),J.onDisposeObservable=new I.c(),J._onDisposeObserver=null,J.onBeforeRenderObservable=new I.c(),J._onBeforeRenderObserver=null,J.onAfterRenderObservable=new I.c(),J._onAfterRenderObserver=null,J.onBeforeAnimationsObservable=new I.c(),J.onAfterAnimationsObservable=new I.c(),J.onBeforeDrawPhaseObservable=new I.c(),J.onAfterDrawPhaseObservable=new I.c(),J.onReadyObservable=new I.c(),J.onBeforeCameraRenderObservable=new I.c(),J._onBeforeCameraRenderObserver=null,J.onAfterCameraRenderObservable=new I.c(),J._onAfterCameraRenderObserver=null,J.onBeforeActiveMeshesEvaluationObservable=new I.c(),J.onAfterActiveMeshesEvaluationObservable=new I.c(),J.onBeforeParticlesRenderingObservable=new I.c(),J.onAfterParticlesRenderingObservable=new I.c(),J.onDataLoadedObservable=new I.c(),J.onNewCameraAddedObservable=new I.c(),J.onCameraRemovedObservable=new I.c(),J.onNewLightAddedObservable=new I.c(),J.onLightRemovedObservable=new I.c(),J.onNewGeometryAddedObservable=new I.c(),J.onGeometryRemovedObservable=new I.c(),J.onNewTransformNodeAddedObservable=new I.c(),J.onTransformNodeRemovedObservable=new I.c(),J.onNewMeshAddedObservable=new I.c(),J.onMeshRemovedObservable=new I.c(),J.onNewSkeletonAddedObservable=new I.c(),J.onSkeletonRemovedObservable=new I.c(),J.onNewMaterialAddedObservable=new I.c(),J.onMaterialRemovedObservable=new I.c(),J.onNewTextureAddedObservable=new I.c(),J.onTextureRemovedObservable=new I.c(),J.onBeforeRenderTargetsRenderObservable=new I.c(),J.onAfterRenderTargetsRenderObservable=new I.c(),J.onBeforeStepObservable=new I.c(),J.onAfterStepObservable=new I.c(),J.onActiveCameraChanged=new I.c(),J.onBeforeRenderingGroupObservable=new I.c(),J.onAfterRenderingGroupObservable=new I.c(),J.onMeshImportedObservable=new I.c(),J._registeredForLateAnimationBindings=new H.b(256),J.onPrePointerObservable=new I.c(),J.onPointerObservable=new I.c(),J.onPreKeyboardObservable=new I.c(),J.onKeyboardObservable=new I.c(),J._useRightHandedSystem=!1,J._timeAccumulator=0,J._currentStepId=0,J._currentInternalStep=0,J._fogEnabled=!0,J._fogMode=s.FOGMODE_NONE,J.fogColor=new z.e(.2,.2,.3),J.fogDensity=.1,J.fogStart=0,J.fogEnd=1000,J._shadowsEnabled=!0,J._lightsEnabled=!0,J.activeCameras=new Array(),J._texturesEnabled=!0,J.particlesEnabled=!0,J.spritesEnabled=!0,J._skeletonsEnabled=!0,J.lensFlaresEnabled=!0,J.collisionsEnabled=!0,J.gravity=new z.x(0,-9.807,0),J.postProcessesEnabled=!0,J.postProcesses=new Array(),J.renderTargetsEnabled=!0,J.dumpNextRenderTargets=!1,J.customRenderTargets=new Array(),J.importedMeshesFiles=new Array(),J.probesEnabled=!0,J._meshesForIntersections=new H.b(256),J.proceduralTexturesEnabled=!0,J._totalVertices=new q.f(),J._activeIndices=new q.f(),J._activeParticles=new q.f(),J._activeBones=new q.f(),J._animationTime=0,J.animationTimeScale=1,J._renderId=0,J._frameId=0,J._executeWhenReadyTimeoutId=-1,J._intermediateRendering=!1,J._viewUpdateFlag=-1,J._projectionUpdateFlag=-1,J._toBeDisposed=new Array(256),J._activeRequests=new Array(),J._pendingData=new Array(),J._isDisposed=!1,J.dispatchAllSubMeshesOfActiveMeshes=!1,J._activeMeshes=new H.a(256),J._processedMaterials=new H.a(256),J._renderTargets=new H.b(256),J._activeParticleSystems=new H.a(256),J._activeSkeletons=new H.b(32),J._softwareSkinnedMeshes=new H.b(32),J._activeAnimatables=new Array(),J._transformMatrix=z.j.Zero(),J.requireLightSorting=!1,J._components=[],J._serializableComponents=[],J._transientComponents=[],J._beforeCameraUpdateStage=ea.b.Create(),J._beforeClearStage=ea.b.Create(),J._gatherRenderTargetsStage=ea.b.Create(),J._gatherActiveCameraRenderTargetsStage=ea.b.Create(),J._isReadyForMeshStage=ea.b.Create(),J._beforeEvaluateActiveMeshStage=ea.b.Create(),J._evaluateSubMeshStage=ea.b.Create(),J._activeMeshStage=ea.b.Create(),J._cameraDrawRenderTargetStage=ea.b.Create(),J._beforeCameraDrawStage=ea.b.Create(),J._beforeRenderTargetDrawStage=ea.b.Create(),J._beforeRenderingGroupDrawStage=ea.b.Create(),J._beforeRenderingMeshStage=ea.b.Create(),J._afterRenderingMeshStage=ea.b.Create(),J._afterRenderingGroupDrawStage=ea.b.Create(),J._afterCameraDrawStage=ea.b.Create(),J._afterRenderTargetDrawStage=ea.b.Create(),J._afterRenderStage=ea.b.Create(),J._pointerMoveStage=ea.b.Create(),J._pointerDownStage=ea.b.Create(),J._pointerUpStage=ea.b.Create(),J.geometriesByUniqueId=null,J._defaultMeshCandidates={data:[],length:0},J._defaultSubMeshCandidates={data:[],length:0},J._preventFreeActiveMeshesAndRenderingGroups=!1,J._activeMeshesFrozen=!1,J._allowPostProcessClearColor=!0,J.getDeterministicFrameTime=function(){return 1000/60},J._blockMaterialDirtyMechanism=!1,J._engine=t||T.a.LastCreatedEngine,C&&C.virtual||(T.a._LastCreatedScene=J,J._engine.scenes.push(J)),J._uid=null,J._renderingManager=new X.b(J),Y.a&&(J.postProcessManager=new Y.a(J)),oa.a.IsWindowObjectExist()&&J.attachControl(),J._createUbo(),o.a&&(J._imageProcessingConfiguration=new o.a()),J.setDefaultCandidateProviders(),C&&!0===C.useGeometryUniqueIdsMap&&(J.geometriesByUniqueId={}),J.useMaterialMeshMap=C&&C.useGeometryUniqueIdsMap||!1,J.useClonedMeshhMap=C&&C.useClonedMeshhMap||!1,C&&C.virtual||J._engine.onNewSceneAddedObservable.notifyObservers(J),J}return O.d(s,n),s.DefaultMaterialFactory=function(t){throw V.a.WarnImport("StandardMaterial")},s.CollisionCoordinatorFactory=function(){throw V.a.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(s.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(t){this._environmentTexture!==t&&(this._environmentTexture=t,this.markAllMaterialsAsDirty(ca.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(t){this._forceWireframe!==t&&(this._forceWireframe=t,this.markAllMaterialsAsDirty(ca.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(t){this._forcePointsCloud!==t&&(this._forcePointsCloud=t,this.markAllMaterialsAsDirty(ca.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"beforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),t&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"afterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),t&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(t))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"beforeCameraRender",{set:function(t){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"afterCameraRender",{set:function(t){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!0,configurable:!0}),Object.defineProperty(s,"DragMovementThreshold",{get:function(){return p.DragMovementThreshold},set:function(t){p.DragMovementThreshold=t},enumerable:!0,configurable:!0}),Object.defineProperty(s,"LongPressDelay",{get:function(){return p.LongPressDelay},set:function(t){p.LongPressDelay=t},enumerable:!0,configurable:!0}),Object.defineProperty(s,"DoubleClickDelay",{get:function(){return p.DoubleClickDelay},set:function(t){p.DoubleClickDelay=t},enumerable:!0,configurable:!0}),Object.defineProperty(s,"ExclusiveDoubleClickMode",{get:function(){return p.ExclusiveDoubleClickMode},set:function(t){p.ExclusiveDoubleClickMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(t){this._useRightHandedSystem!==t&&(this._useRightHandedSystem=t,this.markAllMaterialsAsDirty(ca.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),s.prototype.setStepId=function(t){this._currentStepId=t},s.prototype.getStepId=function(){return this._currentStepId},s.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(s.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAllMaterialsAsDirty(ca.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"fogMode",{get:function(){return this._fogMode},set:function(t){this._fogMode!==t&&(this._fogMode=t,this.markAllMaterialsAsDirty(ca.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(t){this._shadowsEnabled!==t&&(this._shadowsEnabled=t,this.markAllMaterialsAsDirty(ca.a.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(t){this._lightsEnabled!==t&&(this._lightsEnabled=t,this.markAllMaterialsAsDirty(ca.a.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(t){t!==this._activeCamera&&(this._activeCamera=t,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=s.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(t){this._defaultMaterial=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(t){this._texturesEnabled!==t&&(this._texturesEnabled=t,this.markAllMaterialsAsDirty(ca.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(t){this._skeletonsEnabled!==t&&(this._skeletonsEnabled=t,this.markAllMaterialsAsDirty(ca.a.MATERIAL_AttributesDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=s.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),s.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var t=0,C=this._transientComponents;t<C.length;t++)C[t].register();this._transientComponents=[]}},s.prototype._addComponent=function(t){this._components.push(t),this._transientComponents.push(t);var C=t;C.addFromContainer&&this._serializableComponents.push(C)},s.prototype._getComponent=function(t){for(var C=0,J=this._components;C<J.length;C++){var Q=J[C];if(Q.name===t)return Q}return null},s.prototype.getClassName=function(){return"Scene"},s.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},s.prototype._getDefaultSubMeshCandidates=function(t){return this._defaultSubMeshCandidates.data=t.subMeshes,this._defaultSubMeshCandidates.length=t.subMeshes.length,this._defaultSubMeshCandidates},s.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(s.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(t){this._inputManager.pointerX=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(t){this._inputManager.pointerY=t},enumerable:!0,configurable:!0}),s.prototype.getCachedMaterial=function(){return this._cachedMaterial},s.prototype.getCachedEffect=function(){return this._cachedEffect},s.prototype.getCachedVisibility=function(){return this._cachedVisibility},s.prototype.isCachedMaterialInvalid=function(t,C,J){return void 0===J&&(J=1),this._cachedEffect!==C||this._cachedMaterial!==t||this._cachedVisibility!==J},s.prototype.getEngine=function(){return this._engine},s.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(s.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),s.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(s.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),s.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(s.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),s.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(s.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),s.prototype.getActiveMeshes=function(){return this._activeMeshes},s.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},s.prototype.getRenderId=function(){return this._renderId},s.prototype.getFrameId=function(){return this._frameId},s.prototype.incrementRenderId=function(){this._renderId++},s.prototype._createUbo=function(){this._sceneUbo=new G.a(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},s.prototype.simulatePointerMove=function(t,C){return this._inputManager.simulatePointerMove(t,C),this},s.prototype.simulatePointerDown=function(t,C){return this._inputManager.simulatePointerDown(t,C),this},s.prototype.simulatePointerUp=function(t,C,J){return this._inputManager.simulatePointerUp(t,C,J),this},s.prototype.isPointerCaptured=function(t){return void 0===t&&(t=0),this._inputManager.isPointerCaptured(t)},s.prototype.attachControl=function(t,C,J){void 0===t&&(t=!0),void 0===C&&(C=!0),void 0===J&&(J=!0),this._inputManager.attachControl(t,C,J)},s.prototype.detachControl=function(){this._inputManager.detachControl()},s.prototype.isReady=function(){if(this._isDisposed)return!1;var t,C=this.getEngine();if(!C.areAllEffectsReady())return!1;if(this._pendingData.length>0)return!1;for(t=0;t<this.meshes.length;t++){var J=this.meshes[t];if(J.isEnabled()&&(J.subMeshes&&0!==J.subMeshes.length)){if(!J.isReady(!0))return!1;for(var Q="InstancedMesh"===J.getClassName()||"InstancedLinesMesh"===J.getClassName()||C.getCaps().instancedArrays&&J.instances.length>0,$=0,aa=this._isReadyForMeshStage;$<aa.length;$++)if(!aa[$].action(J,Q))return!1}}for(t=0;t<this.geometries.length;t++)if(this.geometries[t].delayLoadState===ca.a.DELAYLOADSTATE_LOADING)return!1;if(this.activeCameras&&this.activeCameras.length>0){for(var ba=0,ia=this.activeCameras;ba<ia.length;ba++)if(!ia[ba].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var qa=0,ja=this.particleSystems;qa<ja.length;qa++)if(!ja[qa].isReady())return!1;return!0},s.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},s.prototype.registerBeforeRender=function(t){this.onBeforeRenderObservable.add(t)},s.prototype.unregisterBeforeRender=function(t){this.onBeforeRenderObservable.removeCallback(t)},s.prototype.registerAfterRender=function(t){this.onAfterRenderObservable.add(t)},s.prototype.unregisterAfterRender=function(t){this.onAfterRenderObservable.removeCallback(t)},s.prototype._executeOnceBeforeRender=function(t){var C=this,J=function(){t(),setTimeout(function(){C.unregisterBeforeRender(J)})};this.registerBeforeRender(J)},s.prototype.executeOnceBeforeRender=function(t,C){var J=this;void 0!==C?setTimeout(function(){J._executeOnceBeforeRender(t)},C):this._executeOnceBeforeRender(t)},s.prototype._addPendingData=function(t){this._pendingData.push(t)},s.prototype._removePendingData=function(t){var C=this.isLoading,J=this._pendingData.indexOf(t);-1!==J&&this._pendingData.splice(J,1),C&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},s.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(s.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),s.prototype.executeWhenReady=function(t){var C=this;this.onReadyObservable.add(t),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){C._checkIsReady()},150))},s.prototype.whenReadyAsync=function(){var t=this;return new Promise(function(C){t.executeWhenReady(function(){C()})})},s.prototype._checkIsReady=function(){var t=this;if(this._registerTransientComponents(),this.isReady())return this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1);this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150)},Object.defineProperty(s.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),s.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=j.a.Now},s.prototype.getViewMatrix=function(){return this._viewMatrix},s.prototype.getProjectionMatrix=function(){return this._projectionMatrix},s.prototype.getTransformMatrix=function(){return this._transformMatrix},s.prototype.setTransformMatrix=function(t,C,J,Q){this._viewUpdateFlag===t.updateFlag&&this._projectionUpdateFlag===C.updateFlag||(this._viewUpdateFlag=t.updateFlag,this._projectionUpdateFlag=C.updateFlag,this._viewMatrix=t,this._projectionMatrix=C,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?z.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=z.i.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(J,Q):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},s.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},s.prototype.getUniqueId=function(){var t=s._uniqueIdCounter;return s._uniqueIdCounter++,t},s.prototype.addMesh=function(t,C){var J=this;void 0===C&&(C=!1),this.meshes.push(t),t._resyncLightSources(),this.onNewMeshAddedObservable.notifyObservers(t),C&&t.getChildMeshes().forEach(function(Q){J.addMesh(Q)})},s.prototype.removeMesh=function(t,C){var J=this;void 0===C&&(C=!1);var Q=this.meshes.indexOf(t);return-1!==Q&&(this.meshes[Q]=this.meshes[this.meshes.length-1],this.meshes.pop()),this.onMeshRemovedObservable.notifyObservers(t),C&&t.getChildMeshes().forEach(function($){J.removeMesh($)}),Q},s.prototype.addTransformNode=function(t){t._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(t),this.onNewTransformNodeAddedObservable.notifyObservers(t)},s.prototype.removeTransformNode=function(t){var C=t._indexInSceneTransformNodesArray;if(-1!==C){if(C!==this.transformNodes.length-1){var J=this.transformNodes[this.transformNodes.length-1];this.transformNodes[C]=J,J._indexInSceneTransformNodesArray=C}t._indexInSceneTransformNodesArray=-1,this.transformNodes.pop()}return this.onTransformNodeRemovedObservable.notifyObservers(t),C},s.prototype.removeSkeleton=function(t){var C=this.skeletons.indexOf(t);return-1!==C&&(this.skeletons.splice(C,1),this.onSkeletonRemovedObservable.notifyObservers(t)),C},s.prototype.removeMorphTargetManager=function(t){var C=this.morphTargetManagers.indexOf(t);return-1!==C&&this.morphTargetManagers.splice(C,1),C},s.prototype.removeLight=function(t){var C=this.lights.indexOf(t);if(-1!==C){for(var J=0,Q=this.meshes;J<Q.length;J++)Q[J]._removeLightSource(t);this.lights.splice(C,1),this.sortLightsByPriority()}return this.onLightRemovedObservable.notifyObservers(t),C},s.prototype.removeCamera=function(t){var C=this.cameras.indexOf(t);-1!==C&&this.cameras.splice(C,1);var J=this.activeCameras.indexOf(t);return-1!==J&&this.activeCameras.splice(J,1),this.activeCamera===t&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(t),C},s.prototype.removeParticleSystem=function(t){var C=this.particleSystems.indexOf(t);return-1!==C&&this.particleSystems.splice(C,1),C},s.prototype.removeAnimation=function(t){var C=this.animations.indexOf(t);return-1!==C&&this.animations.splice(C,1),C},s.prototype.stopAnimation=function(t,C,J){},s.prototype.removeAnimationGroup=function(t){var C=this.animationGroups.indexOf(t);return-1!==C&&this.animationGroups.splice(C,1),C},s.prototype.removeMultiMaterial=function(t){var C=this.multiMaterials.indexOf(t);return-1!==C&&this.multiMaterials.splice(C,1),C},s.prototype.removeMaterial=function(t){var C=t._indexInSceneMaterialArray;if(-1!==C&&C<this.materials.length){if(C!==this.materials.length-1){var J=this.materials[this.materials.length-1];this.materials[C]=J,J._indexInSceneMaterialArray=C}t._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(t),C},s.prototype.removeActionManager=function(t){var C=this.actionManagers.indexOf(t);return-1!==C&&this.actionManagers.splice(C,1),C},s.prototype.removeTexture=function(t){var C=this.textures.indexOf(t);return-1!==C&&this.textures.splice(C,1),this.onTextureRemovedObservable.notifyObservers(t),C},s.prototype.addLight=function(t){this.lights.push(t),this.sortLightsByPriority();for(var C=0,J=this.meshes;C<J.length;C++){var Q=J[C];-1===Q.lightSources.indexOf(t)&&(Q.lightSources.push(t),Q._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(t)},s.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(M.a.CompareLightsPriority)},s.prototype.addCamera=function(t){this.cameras.push(t),this.onNewCameraAddedObservable.notifyObservers(t)},s.prototype.addSkeleton=function(t){this.skeletons.push(t),this.onNewSkeletonAddedObservable.notifyObservers(t)},s.prototype.addParticleSystem=function(t){this.particleSystems.push(t)},s.prototype.addAnimation=function(t){this.animations.push(t)},s.prototype.addAnimationGroup=function(t){this.animationGroups.push(t)},s.prototype.addMultiMaterial=function(t){this.multiMaterials.push(t)},s.prototype.addMaterial=function(t){t._indexInSceneMaterialArray=this.materials.length,this.materials.push(t),this.onNewMaterialAddedObservable.notifyObservers(t)},s.prototype.addMorphTargetManager=function(t){this.morphTargetManagers.push(t)},s.prototype.addGeometry=function(t){this.geometriesByUniqueId&&(this.geometriesByUniqueId[t.uniqueId]=this.geometries.length),this.geometries.push(t)},s.prototype.addActionManager=function(t){this.actionManagers.push(t)},s.prototype.addTexture=function(t){this.textures.push(t),this.onNewTextureAddedObservable.notifyObservers(t)},s.prototype.switchActiveCamera=function(t,C){void 0===C&&(C=!0);var J=this._engine.getRenderingCanvas();J&&(this.activeCamera&&this.activeCamera.detachControl(J),this.activeCamera=t,C&&t.attachControl(J))},s.prototype.setActiveCameraByID=function(t){var C=this.getCameraByID(t);return C?(this.activeCamera=C,C):null},s.prototype.setActiveCameraByName=function(t){var C=this.getCameraByName(t);return C?(this.activeCamera=C,C):null},s.prototype.getAnimationGroupByName=function(t){for(var C=0;C<this.animationGroups.length;C++)if(this.animationGroups[C].name===t)return this.animationGroups[C];return null},s.prototype.getMaterialByUniqueID=function(t){for(var C=0;C<this.materials.length;C++)if(this.materials[C].uniqueId===t)return this.materials[C];return null},s.prototype.getMaterialByID=function(t){for(var C=0;C<this.materials.length;C++)if(this.materials[C].id===t)return this.materials[C];return null},s.prototype.getMaterialByName=function(t){for(var C=0;C<this.materials.length;C++)if(this.materials[C].name===t)return this.materials[C];return null},s.prototype.getCameraByID=function(t){for(var C=0;C<this.cameras.length;C++)if(this.cameras[C].id===t)return this.cameras[C];return null},s.prototype.getCameraByUniqueID=function(t){for(var C=0;C<this.cameras.length;C++)if(this.cameras[C].uniqueId===t)return this.cameras[C];return null},s.prototype.getCameraByName=function(t){for(var C=0;C<this.cameras.length;C++)if(this.cameras[C].name===t)return this.cameras[C];return null},s.prototype.getBoneByID=function(t){for(var C=0;C<this.skeletons.length;C++)for(var J=this.skeletons[C],Q=0;Q<J.bones.length;Q++)if(J.bones[Q].id===t)return J.bones[Q];return null},s.prototype.getBoneByName=function(t){for(var C=0;C<this.skeletons.length;C++)for(var J=this.skeletons[C],Q=0;Q<J.bones.length;Q++)if(J.bones[Q].name===t)return J.bones[Q];return null},s.prototype.getLightByName=function(t){for(var C=0;C<this.lights.length;C++)if(this.lights[C].name===t)return this.lights[C];return null},s.prototype.getLightByID=function(t){for(var C=0;C<this.lights.length;C++)if(this.lights[C].id===t)return this.lights[C];return null},s.prototype.getLightByUniqueID=function(t){for(var C=0;C<this.lights.length;C++)if(this.lights[C].uniqueId===t)return this.lights[C];return null},s.prototype.getParticleSystemByID=function(t){for(var C=0;C<this.particleSystems.length;C++)if(this.particleSystems[C].id===t)return this.particleSystems[C];return null},s.prototype.getGeometryByID=function(t){for(var C=0;C<this.geometries.length;C++)if(this.geometries[C].id===t)return this.geometries[C];return null},s.prototype._getGeometryByUniqueID=function(t){if(this.geometriesByUniqueId){var C=this.geometriesByUniqueId[t];if(void 0!==C)return this.geometries[C]}else for(var J=0;J<this.geometries.length;J++)if(this.geometries[J].uniqueId===t)return this.geometries[J];return null},s.prototype.pushGeometry=function(t,C){return!(!C&&this._getGeometryByUniqueID(t.uniqueId))&&(this.addGeometry(t),this.onNewGeometryAddedObservable.notifyObservers(t),!0)},s.prototype.removeGeometry=function(t){var C;if(this.geometriesByUniqueId){if(void 0===(C=this.geometriesByUniqueId[t.uniqueId]))return!1}else if((C=this.geometries.indexOf(t))<0)return!1;if(C!==this.geometries.length-1){var J=this.geometries[this.geometries.length-1];this.geometries[C]=J,this.geometriesByUniqueId&&(this.geometriesByUniqueId[J.uniqueId]=C,this.geometriesByUniqueId[t.uniqueId]=void 0)}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(t),!0},s.prototype.getGeometries=function(){return this.geometries},s.prototype.getMeshByID=function(t){for(var C=0;C<this.meshes.length;C++)if(this.meshes[C].id===t)return this.meshes[C];return null},s.prototype.getMeshesByID=function(t){return this.meshes.filter(function(C){return C.id===t})},s.prototype.getTransformNodeByID=function(t){for(var C=0;C<this.transformNodes.length;C++)if(this.transformNodes[C].id===t)return this.transformNodes[C];return null},s.prototype.getTransformNodeByUniqueID=function(t){for(var C=0;C<this.transformNodes.length;C++)if(this.transformNodes[C].uniqueId===t)return this.transformNodes[C];return null},s.prototype.getTransformNodesByID=function(t){return this.transformNodes.filter(function(C){return C.id===t})},s.prototype.getMeshByUniqueID=function(t){for(var C=0;C<this.meshes.length;C++)if(this.meshes[C].uniqueId===t)return this.meshes[C];return null},s.prototype.getLastMeshByID=function(t){for(var C=this.meshes.length-1;C>=0;C--)if(this.meshes[C].id===t)return this.meshes[C];return null},s.prototype.getLastEntryByID=function(t){var C;for(C=this.meshes.length-1;C>=0;C--)if(this.meshes[C].id===t)return this.meshes[C];for(C=this.transformNodes.length-1;C>=0;C--)if(this.transformNodes[C].id===t)return this.transformNodes[C];for(C=this.cameras.length-1;C>=0;C--)if(this.cameras[C].id===t)return this.cameras[C];for(C=this.lights.length-1;C>=0;C--)if(this.lights[C].id===t)return this.lights[C];return null},s.prototype.getNodeByID=function(t){var C=this.getMeshByID(t);if(C)return C;var J=this.getTransformNodeByID(t);if(J)return J;var Q=this.getLightByID(t);if(Q)return Q;var $=this.getCameraByID(t);if($)return $;var aa=this.getBoneByID(t);return aa||null},s.prototype.getNodeByName=function(t){var C=this.getMeshByName(t);if(C)return C;var J=this.getTransformNodeByName(t);if(J)return J;var Q=this.getLightByName(t);if(Q)return Q;var $=this.getCameraByName(t);if($)return $;var aa=this.getBoneByName(t);return aa||null},s.prototype.getMeshByName=function(t){for(var C=0;C<this.meshes.length;C++)if(this.meshes[C].name===t)return this.meshes[C];return null},s.prototype.getTransformNodeByName=function(t){for(var C=0;C<this.transformNodes.length;C++)if(this.transformNodes[C].name===t)return this.transformNodes[C];return null},s.prototype.getLastSkeletonByID=function(t){for(var C=this.skeletons.length-1;C>=0;C--)if(this.skeletons[C].id===t)return this.skeletons[C];return null},s.prototype.getSkeletonByUniqueId=function(t){for(var C=0;C<this.skeletons.length;C++)if(this.skeletons[C].uniqueId===t)return this.skeletons[C];return null},s.prototype.getSkeletonById=function(t){for(var C=0;C<this.skeletons.length;C++)if(this.skeletons[C].id===t)return this.skeletons[C];return null},s.prototype.getSkeletonByName=function(t){for(var C=0;C<this.skeletons.length;C++)if(this.skeletons[C].name===t)return this.skeletons[C];return null},s.prototype.getMorphTargetManagerById=function(t){for(var C=0;C<this.morphTargetManagers.length;C++)if(this.morphTargetManagers[C].uniqueId===t)return this.morphTargetManagers[C];return null},s.prototype.getMorphTargetById=function(t){for(var C=0;C<this.morphTargetManagers.length;++C)for(var J=this.morphTargetManagers[C],Q=0;Q<J.numTargets;++Q){var $=J.getTarget(Q);if($.id===t)return $}return null},s.prototype.isActiveMesh=function(t){return-1!==this._activeMeshes.indexOf(t)},Object.defineProperty(s.prototype,"uid",{get:function(){return this._uid||(this._uid=q.h.RandomId()),this._uid},enumerable:!0,configurable:!0}),s.prototype.addExternalData=function(t,C){return this._externalData||(this._externalData=new A.a()),this._externalData.add(t,C)},s.prototype.getExternalData=function(t){return this._externalData?this._externalData.get(t):null},s.prototype.getOrAddExternalDataWithFactory=function(t,C){return this._externalData||(this._externalData=new A.a()),this._externalData.getOrAddWithFactory(t,C)},s.prototype.removeExternalData=function(t){return this._externalData.remove(t)},s.prototype._evaluateSubMesh=function(t,C,J){if(J.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||C.alwaysSelectAsActiveMesh||1===C.subMeshes.length||t.isInFrustum(this._frustumPlanes)){for(var Q=0,$=this._evaluateSubMeshStage;Q<$.length;Q++)$[Q].action(C,t);var aa=t.getMaterial();null!=aa&&(aa.hasRenderTargetTextures&&null!=aa.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(aa)&&(this._processedMaterials.push(aa),this._renderTargets.concatWithNoDuplicate(aa.getRenderTargetTextures())),this._activeIndices.addCount(t.indexCount,!1),this._renderingManager.dispatch(t,C,aa))}},s.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(s.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(t){this._preventFreeActiveMeshesAndRenderingGroups!==t&&(t&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=t)},enumerable:!0,configurable:!0}),s.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var t=0;t<this.activeCameras.length;t++){var C=this.activeCameras[t];C&&C._activeMeshes&&C._activeMeshes.dispose()}},s.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var t=0;t<this.textures.length;t++){var C=this.textures[t];C&&C.renderList&&C.freeRenderingGroups()}},s.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},s.prototype.freezeActiveMeshes=function(){if(!this.activeCamera)return this;this._frustumPlanes||this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0;for(var t=0;t<this._activeMeshes.length;t++)this._activeMeshes.data[t]._freeze();return this},s.prototype.unfreezeActiveMeshes=function(){for(var t=0;t<this._activeMeshes.length;t++)this._activeMeshes.data[t]._unFreeze();return this._activeMeshesFrozen=!1,this},s.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length)for(var t=this._activeMeshes.length,C=0;C<t;C++)(ba=this._activeMeshes.data[C]).computeWorldMatrix();else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var J=0,Q=this._beforeEvaluateActiveMeshStage;J<Q.length;J++)Q[J].action();var $=this.getActiveMeshCandidates(),aa=$.length;for(C=0;C<aa;C++){var ba;if(!(ba=$.data[C]).isBlocked&&(this._totalVertices.addCount(ba.getTotalVertices(),!1),ba.isReady()&&ba.isEnabled()&&0!==ba.scaling.lengthSquared())){ba.computeWorldMatrix(),ba.actionManager&&ba.actionManager.hasSpecificTriggers2(ca.a.ACTION_OnIntersectionEnterTrigger,ca.a.ACTION_OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(ba);var ia=this.customLODSelector?this.customLODSelector(ba,this.activeCamera):ba.getLOD(this.activeCamera);null!=ia&&(ia!==ba&&ia.billboardMode!==u.a.BILLBOARDMODE_NONE&&ia.computeWorldMatrix(),ba._preActivate(),ba.isVisible&&ba.visibility>0&&0!=(ba.layerMask&this.activeCamera.layerMask)&&(ba.alwaysSelectAsActiveMesh||ba.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(ba),this.activeCamera._activeMeshes.push(ba),ia!==ba&&ia._activate(this._renderId,!1),ba._activate(this._renderId,!1)&&(ba.isAnInstance||(ia._internalAbstractMeshDataInfo._onlyForInstances=!1),ia._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(ba,ia)),ba._postActivate()))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var qa=0;qa<this.particleSystems.length;qa++){var ja=this.particleSystems[qa];if(ja.isStarted()&&ja.emitter){var sa=ja.emitter;sa.position&&!sa.isEnabled()||(this._activeParticleSystems.push(ja),ja.animate(),this._renderingManager.dispatchParticles(ja))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},s.prototype._activeMesh=function(t,C){this._skeletonsEnabled&&null!==C.skeleton&&void 0!==C.skeleton&&(this._activeSkeletons.pushNoDuplicate(C.skeleton)&&C.skeleton.prepare(),C.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(C));for(var J=0,Q=this._activeMeshStage;J<Q.length;J++)Q[J].action(t,C);if(null!=C&&void 0!==C.subMeshes&&null!==C.subMeshes&&C.subMeshes.length>0)for(var $=this.getActiveSubMeshCandidates(C),aa=$.length,ba=0;ba<aa;ba++){var ia=$.data[ba];this._evaluateSubMesh(ia,C,t)}},s.prototype.updateTransformMatrix=function(t){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(t))},s.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget)if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var t=this.activeCamera.outputRenderTarget.getInternalTexture();t?this.getEngine().bindFramebuffer(t):Z.a.Error("Camera contains invalid customDefaultRenderTarget")}else this.getEngine().restoreDefaultFramebuffer()},s.prototype._renderForCamera=function(t,C){if(!t||!t._skipRendering){var J=this._engine;if(this._activeCamera=t,!this.activeCamera)throw new Error("Active camera not set");J.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&t.outputRenderTarget&&t.outputRenderTarget.getViewCount()>1?this.setTransformMatrix(t._rigCameras[0].getViewMatrix(),t._rigCameras[0].getProjectionMatrix(),t._rigCameras[1].getViewMatrix(),t._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var Q=0;Q<this._softwareSkinnedMeshes.length;Q++){var $=this._softwareSkinnedMeshes.data[Q];$.applySkeleton($.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),C&&C.customRenderTargets&&C.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(C.customRenderTargets);for(var aa=0,ba=this._gatherActiveCameraRenderTargetsStage;aa<ba.length;aa++)ba[aa].action(this._renderTargets);if(this.renderTargetsEnabled){this._intermediateRendering=!0;var ia=!1;if(this._renderTargets.length>0){q.h.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var qa=0;qa<this._renderTargets.length;qa++){var ja=this._renderTargets.data[qa];if(ja._shouldRender()){this._renderId++;var sa=ja.activeCamera&&ja.activeCamera!==this.activeCamera;ja.render(sa,this.dumpNextRenderTargets),ia=!0}}q.h.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var za=0,Fa=this._cameraDrawRenderTargetStage;za<Fa.length;za++)ia=Fa[za].action(this.activeCamera)||ia;this._intermediateRendering=!1,ia&&this._bindFrameBuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!t._multiviewTexture&&this.postProcessManager._prepareFrame();for(var Ea=0,Ba=this._beforeCameraDrawStage;Ea<Ba.length;Ea++)Ba[Ea].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var Sa=0,Xa=this._afterCameraDrawStage;Sa<Xa.length;Sa++)Xa[Sa].action(this.activeCamera);this.postProcessManager&&!t._multiviewTexture&&this.postProcessManager._finalizeFrame(t.isIntermediate),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},s.prototype._processSubCameras=function(t){if(t.cameraRigMode===y.a.RIG_MODE_NONE||t.outputRenderTarget&&t.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview)this._renderForCamera(t);else{if(t._useMultiviewToSingleView)this._renderMultiviewToSingleView(t);else for(var C=0;C<t._rigCameras.length;C++)this._renderForCamera(t._rigCameras[C],t);this._activeCamera=t,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix())}},s.prototype._checkIntersections=function(){for(var t=0;t<this._meshesForIntersections.length;t++){var C=this._meshesForIntersections.data[t];if(C.actionManager)for(var J=0;C.actionManager&&J<C.actionManager.actions.length;J++){var Q=C.actionManager.actions[J];if(Q.trigger===ca.a.ACTION_OnIntersectionEnterTrigger||Q.trigger===ca.a.ACTION_OnIntersectionExitTrigger){var $=Q.getTriggerParameter(),aa=$ instanceof w.a?$:$.mesh,ba=aa.intersectsMesh(C,$.usePreciseIntersection),ia=C._intersectionsInProgress.indexOf(aa);ba&&-1===ia?Q.trigger===ca.a.ACTION_OnIntersectionEnterTrigger?(Q._executeCurrent(W.a.CreateNew(C,void 0,aa)),C._intersectionsInProgress.push(aa)):Q.trigger===ca.a.ACTION_OnIntersectionExitTrigger&&C._intersectionsInProgress.push(aa):!ba&&ia>-1&&(Q.trigger===ca.a.ACTION_OnIntersectionExitTrigger&&Q._executeCurrent(W.a.CreateNew(C,void 0,aa)),C.actionManager.hasSpecificTrigger(ca.a.ACTION_OnIntersectionExitTrigger,function(qa){var ja=qa instanceof w.a?qa:qa.mesh;return aa===ja})&&Q.trigger!==ca.a.ACTION_OnIntersectionExitTrigger||C._intersectionsInProgress.splice(ia,1))}}}},s.prototype._advancePhysicsEngineStep=function(t){},s.prototype._animate=function(){},s.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var t=Math.max(s.MinDeltaTime,Math.min(this._engine.getDeltaTime(),s.MaxDeltaTime))+this._timeAccumulator,C=this.getDeterministicFrameTime(),J=0,Q=this._engine.getLockstepMaxSteps(),$=Math.floor(t/60);$=Math.min($,Q);do this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=.06*C,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(C),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,J++,t-=C;while(t>0&&J<$);this._timeAccumulator=t<0?0:t}else t=this.useConstantAnimationDeltaTime?16:Math.max(s.MinDeltaTime,Math.min(this._engine.getDeltaTime(),s.MaxDeltaTime)),this._animationRatio=.06*t,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(t)},s.prototype.render=function(t,C){if(void 0===t&&(t=!0),void 0===C&&(C=!1),!this.isDisposed){this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(ca.a.ACTION_OnEveryFrameTrigger),C||this.animate();for(var J=0,Q=this._beforeCameraUpdateStage;J<Q.length;J++)Q[J].action();if(t){if(this.activeCameras.length>0)for(var $=0;$<this.activeCameras.length;$++){var aa=this.activeCameras[$];if(aa.update(),aa.cameraRigMode!==y.a.RIG_MODE_NONE)for(var ba=0;ba<aa._rigCameras.length;ba++)aa._rigCameras[ba].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==y.a.RIG_MODE_NONE))for(ba=0;ba<this.activeCamera._rigCameras.length;ba++)this.activeCamera._rigCameras[ba].update()}this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var ia=this.getEngine(),qa=this.activeCamera;if(this.renderTargetsEnabled){q.h.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var ja=0;ja<this.customRenderTargets.length;ja++){var sa=this.customRenderTargets[ja];if(sa._shouldRender()){if(this._renderId++,this.activeCamera=sa.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");ia.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),sa.render(qa!==this.activeCamera,this.dumpNextRenderTargets)}}q.h.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=qa,this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var za=0,Fa=this._beforeClearStage;za<Fa.length;za++)Fa[za].action();(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var Ea=0,Ba=this._gatherRenderTargetsStage;Ea<Ba.length;Ea++)Ba[Ea].action(this._renderTargets);if(this.activeCameras.length>0)for($=0;$<this.activeCameras.length;$++)$>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[$]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var Sa=0,Xa=this._afterRenderStage;Sa<Xa.length;Sa++)Xa[Sa].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(ba=0;ba<this._toBeDisposed.length;ba++){var Ka=this._toBeDisposed[ba];Ka&&Ka.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},s.prototype.freezeMaterials=function(){for(var t=0;t<this.materials.length;t++)this.materials[t].freeze()},s.prototype.unfreezeMaterials=function(){for(var t=0;t<this.materials.length;t++)this.materials[t].unfreeze()},s.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var t=0,C=this._components;t<C.length;t++)C[t].dispose();this.importedMeshesFiles=new Array(),this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var J=0,Q=this._activeRequests;J<Q.length;J++)Q[J].abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var $,aa=this._engine.getRenderingCanvas();if(aa)for($=0;$<this.cameras.length;$++)this.cameras[$].detachControl(aa);for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),($=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice($,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(s.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),s.prototype.clearCachedVertexData=function(){for(var t=0;t<this.meshes.length;t++){var C=this.meshes[t].geometry;if(C)for(var J in C._indices=[],C._vertexBuffers)C._vertexBuffers.hasOwnProperty(J)&&(C._vertexBuffers[J]._buffer._data=null)}},s.prototype.cleanCachedTextureBuffer=function(){for(var t=0,C=this.textures;t<C.length;t++){var J=C[t];J._buffer&&(J._buffer=null)}},s.prototype.getWorldExtends=function(t){var C=new z.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),J=new z.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return t=t||function(){return!0},this.meshes.filter(t).forEach(function(Q){if(Q.computeWorldMatrix(!0),Q.subMeshes&&0!==Q.subMeshes.length&&!Q.infiniteDistance){var $=Q.getBoundingInfo(),aa=$.boundingBox.minimumWorld,ba=$.boundingBox.maximumWorld;q.h.CheckExtends(aa,C,J),q.h.CheckExtends(ba,C,J)}}),{min:C,max:J}},s.prototype.createPickingRay=function(t,C,J,Q,$){throw void 0===$&&($=!1),V.a.WarnImport("Ray")},s.prototype.createPickingRayToRef=function(t,C,J,Q,$,aa){throw void 0===aa&&(aa=!1),V.a.WarnImport("Ray")},s.prototype.createPickingRayInCameraSpace=function(t,C,J){throw V.a.WarnImport("Ray")},s.prototype.createPickingRayInCameraSpaceToRef=function(t,C,J,Q){throw V.a.WarnImport("Ray")},s.prototype.pick=function(t,C,J,Q,$,aa){var ba=new R.a();return ba._pickingUnavailable=!0,ba},s.prototype.pickWithRay=function(t,C,J,Q){throw V.a.WarnImport("Ray")},s.prototype.multiPick=function(t,C,J,Q,$){throw V.a.WarnImport("Ray")},s.prototype.multiPickWithRay=function(t,C,J){throw V.a.WarnImport("Ray")},s.prototype.setPointerOverMesh=function(t){this._inputManager.setPointerOverMesh(t)},s.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},s.prototype._rebuildGeometries=function(){for(var t=0,C=this.geometries;t<C.length;t++)C[t]._rebuild();for(var J=0,Q=this.meshes;J<Q.length;J++)Q[J]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var $=0,aa=this._components;$<aa.length;$++)aa[$].rebuild();for(var ba=0,ia=this.particleSystems;ba<ia.length;ba++)ia[ba].rebuild()},s.prototype._rebuildTextures=function(){for(var t=0,C=this.textures;t<C.length;t++)C[t]._rebuild();this.markAllMaterialsAsDirty(ca.a.MATERIAL_TextureDirtyFlag)},s.prototype._getByTags=function(t,C,J){if(void 0===C)return t;var Q=[];for(var $ in J=J||function(ba){},t){var aa=t[$];v.a&&v.a.MatchesQuery(aa,C)&&(Q.push(aa),J(aa))}return Q},s.prototype.getMeshesByTags=function(t,C){return this._getByTags(this.meshes,t,C)},s.prototype.getCamerasByTags=function(t,C){return this._getByTags(this.cameras,t,C)},s.prototype.getLightsByTags=function(t,C){return this._getByTags(this.lights,t,C)},s.prototype.getMaterialByTags=function(t,C){return this._getByTags(this.materials,t,C).concat(this._getByTags(this.multiMaterials,t,C))},s.prototype.setRenderingOrder=function(t,C,J,Q){void 0===C&&(C=null),void 0===J&&(J=null),void 0===Q&&(Q=null),this._renderingManager.setRenderingOrder(t,C,J,Q)},s.prototype.setRenderingAutoClearDepthStencil=function(t,C,J,Q){void 0===J&&(J=!0),void 0===Q&&(Q=!0),this._renderingManager.setRenderingAutoClearDepthStencil(t,C,J,Q)},s.prototype.getAutoClearDepthStencilSetup=function(t){return this._renderingManager.getAutoClearDepthStencilSetup(t)},Object.defineProperty(s.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(t){this._blockMaterialDirtyMechanism!==t&&(this._blockMaterialDirtyMechanism=t,t||this.markAllMaterialsAsDirty(ca.a.MATERIAL_AllDirtyFlag))},enumerable:!0,configurable:!0}),s.prototype.markAllMaterialsAsDirty=function(t,C){if(!this._blockMaterialDirtyMechanism)for(var J=0,Q=this.materials;J<Q.length;J++){var $=Q[J];C&&!C($)||$.markAsDirty(t)}},s.prototype._loadFile=function(t,C,J,Q,$,aa){var ba=this,ia=q.h.LoadFile(t,C,J,Q?this.offlineProvider:void 0,$,aa);return this._activeRequests.push(ia),ia.onCompleteObservable.add(function(qa){ba._activeRequests.splice(ba._activeRequests.indexOf(qa),1)}),ia},s.prototype._loadFileAsync=function(t,C,J){var Q=this;return new Promise(function($,aa){Q._loadFile(t,function(ba){$(ba)},void 0,C,J,function(ba,ia){aa(ia)})})},s._uniqueIdCounter=0,s.FOGMODE_NONE=0,s.FOGMODE_EXP=1,s.FOGMODE_EXP2=2,s.FOGMODE_LINEAR=3,s.MinDeltaTime=1,s.MaxDeltaTime=1000,s}(r.a)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return j}),l.d(x,"c",function(){return I}),l.d(x,"d",function(){return H}),l.d(x,"b",function(){return A});var O=l(1),q=l(0),j=function(){function v(){}return v.POINTERDOWN=1,v.POINTERUP=2,v.POINTERMOVE=4,v.POINTERWHEEL=8,v.POINTERPICK=16,v.POINTERTAP=32,v.POINTERDOUBLETAP=64,v}(),I=function(){return function(v,z){this.type=v,this.event=z}}(),H=function(v){function z(u,w,y,r){var o=v.call(this,u,w)||this;return o.ray=null,o.skipOnPointerObservable=!1,o.localPosition=new q.w(y,r),o}return O.d(z,v),z}(I),A=function(v){function z(u,w,y){var r=v.call(this,u,w)||this;return r.pickInfo=y,r}return O.d(z,v),z}(I)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return j});var O=l(10),q=l(3),j=function(){function I(){}return Object.defineProperty(I,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(H){this._DiffuseTextureEnabled!==H&&(this._DiffuseTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(H){this._AmbientTextureEnabled!==H&&(this._AmbientTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(H){this._OpacityTextureEnabled!==H&&(this._OpacityTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(H){this._ReflectionTextureEnabled!==H&&(this._ReflectionTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(H){this._EmissiveTextureEnabled!==H&&(this._EmissiveTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(H){this._SpecularTextureEnabled!==H&&(this._SpecularTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(H){this._BumpTextureEnabled!==H&&(this._BumpTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(H){this._LightmapTextureEnabled!==H&&(this._LightmapTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(H){this._RefractionTextureEnabled!==H&&(this._RefractionTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(H){this._ColorGradingTextureEnabled!==H&&(this._ColorGradingTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(H){this._FresnelEnabled!==H&&(this._FresnelEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_FresnelDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(H){this._ClearCoatTextureEnabled!==H&&(this._ClearCoatTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(H){this._ClearCoatBumpTextureEnabled!==H&&(this._ClearCoatBumpTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(H){this._ClearCoatTintTextureEnabled!==H&&(this._ClearCoatTintTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(H){this._SheenTextureEnabled!==H&&(this._SheenTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(H){this._AnisotropicTextureEnabled!==H&&(this._AnisotropicTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(I,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(H){this._ThicknessTextureEnabled!==H&&(this._ThicknessTextureEnabled=H,O.b.MarkAllMaterialsAsDirty(q.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),I._DiffuseTextureEnabled=!0,I._AmbientTextureEnabled=!0,I._OpacityTextureEnabled=!0,I._ReflectionTextureEnabled=!0,I._EmissiveTextureEnabled=!0,I._SpecularTextureEnabled=!0,I._BumpTextureEnabled=!0,I._LightmapTextureEnabled=!0,I._RefractionTextureEnabled=!0,I._ColorGradingTextureEnabled=!0,I._FresnelEnabled=!0,I._ClearCoatTextureEnabled=!0,I._ClearCoatBumpTextureEnabled=!0,I._ClearCoatTintTextureEnabled=!0,I._SheenTextureEnabled=!0,I._AnisotropicTextureEnabled=!0,I._ThicknessTextureEnabled=!0,I}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return q.WarnImport=function(j){return j+" needs to be imported before as it contains a side-effect required by your code."},q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return y});var O=l(1),q=l(2),j=l(9),I=l(8),H=l(0),A=l(23),v=l(49),z=l(63),u=l(3),w=l(6),y=function(){function r(o,G,M){this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new I.c(),this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=u.a.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._wasPreviouslyReady=!1,this._useUBO=!1,this._fillMode=r.TriangleFillMode,this._cachedDepthWriteState=!1,this._indexInSceneMaterialArray=-1,this.meshMap=null,this.name=o,this.id=o||j.h.RandomId(),this._scene=G||A.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=r.ClockWiseSideOrientation:this.sideOrientation=r.CounterClockWiseSideOrientation,this._uniformBuffer=new z.a(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,M||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(r.prototype,"alpha",{get:function(){return this._alpha},set:function(o){this._alpha!==o&&(this._alpha=o,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(o){this._backFaceCulling!==o&&(this._backFaceCulling=o,this.markAsDirty(r.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onDispose",{set:function(o){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(o)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new I.c()),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onBind",{set:function(o){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(o)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new I.c()),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(o){this._alphaMode!==o&&(this._alphaMode=o,this.markAsDirty(r.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(o){this._needDepthPrePass!==o&&(this._needDepthPrePass=o,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(o){this._fogEnabled!==o&&(this._fogEnabled=o,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wireframe",{get:function(){switch(this._fillMode){case r.WireFrameFillMode:case r.LineListDrawMode:case r.LineLoopDrawMode:case r.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(o){this.fillMode=o?r.WireFrameFillMode:r.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case r.PointFillMode:case r.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(o){this.fillMode=o?r.PointFillMode:r.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fillMode",{get:function(){return this._fillMode},set:function(o){this._fillMode!==o&&(this._fillMode=o,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!0,configurable:!0}),r.prototype.toString=function(o){return"Name: "+this.name},r.prototype.getClassName=function(){return"Material"},Object.defineProperty(r.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),r.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},r.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},r.prototype.isReady=function(o,G){return!0},r.prototype.isReadyForSubMesh=function(o,G,M){return!1},r.prototype.getEffect=function(){return this._effect},r.prototype.getScene=function(){return this._scene},r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaBlendingForMesh=function(o){return this.needAlphaBlending()||o.visibility<1||o.hasVertexAlpha},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.markDirty=function(){this._wasPreviouslyReady=!1},r.prototype._preBind=function(o,G){void 0===G&&(G=null);var M=this._scene.getEngine(),R=(null==G?this.sideOrientation:G)===r.ClockWiseSideOrientation;return M.enableEffect(o||this._effect),M.setState(this.backFaceCulling,this.zOffset,!1,R),R},r.prototype.bind=function(o,G){},r.prototype.bindForSubMesh=function(o,G,M){},r.prototype.bindOnlyWorldMatrix=function(o){},r.prototype.bindSceneUniformBuffer=function(o,G){G.bindToEffect(o,"Scene")},r.prototype.bindView=function(o){this._useUBO?this.bindSceneUniformBuffer(o,this.getScene().getSceneUniformBuffer()):o.setMatrix("view",this.getScene().getViewMatrix())},r.prototype.bindViewProjection=function(o){this._useUBO?this.bindSceneUniformBuffer(o,this.getScene().getSceneUniformBuffer()):o.setMatrix("viewProjection",this.getScene().getTransformMatrix())},r.prototype._shouldTurnAlphaTestOn=function(o){return!this.needAlphaBlendingForMesh(o)&&this.needAlphaTesting()},r.prototype._afterBind=function(o){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=o?o.visibility:1,this._onBindObservable&&o&&this._onBindObservable.notifyObservers(o),this.disableDepthWrite){var G=this._scene.getEngine();this._cachedDepthWriteState=G.getDepthWrite(),G.setDepthWrite(!1)}},r.prototype.unbind=function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.disableDepthWrite)&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},r.prototype.getActiveTextures=function(){return[]},r.prototype.hasTexture=function(o){return!1},r.prototype.clone=function(o){return null},r.prototype.getBindedMeshes=function(){var o=this;if(this.meshMap){var G=new Array();for(var M in this.meshMap){var R=this.meshMap[M];R&&G.push(R)}return G}return this._scene.meshes.filter(function(W){return W.material===o})},r.prototype.forceCompilation=function(o,G,M){var R=this,W=O.a({clipPlane:!1},M),Y=new v.a(),X=this.getScene(),ea=function(){if(R._scene&&R._scene.getEngine()){Y._materialDefines&&(Y._materialDefines._renderId=-1);var ca=X.clipPlane;W.clipPlane&&(X.clipPlane=new H.n(0,0,0,1)),R._storeEffectOnSubMeshes?R.isReadyForSubMesh(o,Y)?G&&G(R):setTimeout(ea,16):R.isReady()?G&&G(R):setTimeout(ea,16),W.clipPlane&&(X.clipPlane=ca)}};ea()},r.prototype.forceCompilationAsync=function(o,G){var M=this;return new Promise(function(R){M.forceCompilation(o,function(){R()},G)})},r.prototype.markAsDirty=function(o){this.getScene().blockMaterialDirtyMechanism||(r._DirtyCallbackArray.length=0,o&r.TextureDirtyFlag&&r._DirtyCallbackArray.push(r._TextureDirtyCallBack),o&r.LightDirtyFlag&&r._DirtyCallbackArray.push(r._LightsDirtyCallBack),o&r.FresnelDirtyFlag&&r._DirtyCallbackArray.push(r._FresnelDirtyCallBack),o&r.AttributesDirtyFlag&&r._DirtyCallbackArray.push(r._AttributeDirtyCallBack),o&r.MiscDirtyFlag&&r._DirtyCallbackArray.push(r._MiscDirtyCallBack),r._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(r._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},r.prototype._markAllSubMeshesAsDirty=function(o){if(!this.getScene().blockMaterialDirtyMechanism)for(var G=0,M=this.getScene().meshes;G<M.length;G++){var R=M[G];if(R.subMeshes)for(var W=0,Y=R.subMeshes;W<Y.length;W++){var X=Y[W];X.getMaterial()===this&&(X._materialDefines&&o(X._materialDefines))}}},r.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(r._ImageProcessingDirtyCallBack)},r.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(r._TextureDirtyCallBack)},r.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(r._FresnelDirtyCallBack)},r.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(r._FresnelAndMiscDirtyCallBack)},r.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(r._LightsDirtyCallBack)},r.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(r._AttributeDirtyCallBack)},r.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(r._MiscDirtyCallBack)},r.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(r._TextureAndMiscDirtyCallBack)},r.prototype.dispose=function(o,G,M){var R=this.getScene();if(R.stopAnimation(this),R.freeProcessedMaterials(),R.removeMaterial(this),!0!==M)if(this.meshMap)for(var W in this.meshMap)(ea=this.meshMap[W])&&(ea.material=null,this.releaseVertexArrayObject(ea,o));else for(var Y=0,X=R.meshes;Y<X.length;Y++){var ea;(ea=X[Y]).material!==this||ea.sourceMesh||(ea.material=null,this.releaseVertexArrayObject(ea,o))}this._uniformBuffer.dispose(),o&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},r.prototype.releaseVertexArrayObject=function(o,G){if(o.geometry){var M=o.geometry;if(this._storeEffectOnSubMeshes)for(var R=0,W=o.subMeshes;R<W.length;R++){var Y=W[R];M._releaseVertexArrayObject(Y._materialEffect),G&&Y._materialEffect&&Y._materialEffect.dispose()}else M._releaseVertexArrayObject(this._effect)}},r.prototype.serialize=function(){return q.a.Serialize(this)},r.Parse=function(o,G,M){if(o.customType){if("BABYLON.PBRMaterial"===o.customType&&o.overloadedAlbedo&&(o.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return w.a.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else o.customType="BABYLON.StandardMaterial";return j.h.Instantiate(o.customType).Parse(o,G,M)},r.TriangleFillMode=u.a.MATERIAL_TriangleFillMode,r.WireFrameFillMode=u.a.MATERIAL_WireFrameFillMode,r.PointFillMode=u.a.MATERIAL_PointFillMode,r.PointListDrawMode=u.a.MATERIAL_PointListDrawMode,r.LineListDrawMode=u.a.MATERIAL_LineListDrawMode,r.LineLoopDrawMode=u.a.MATERIAL_LineLoopDrawMode,r.LineStripDrawMode=u.a.MATERIAL_LineStripDrawMode,r.TriangleStripDrawMode=u.a.MATERIAL_TriangleStripDrawMode,r.TriangleFanDrawMode=u.a.MATERIAL_TriangleFanDrawMode,r.ClockWiseSideOrientation=u.a.MATERIAL_ClockWiseSideOrientation,r.CounterClockWiseSideOrientation=u.a.MATERIAL_CounterClockWiseSideOrientation,r.TextureDirtyFlag=u.a.MATERIAL_TextureDirtyFlag,r.LightDirtyFlag=u.a.MATERIAL_LightDirtyFlag,r.FresnelDirtyFlag=u.a.MATERIAL_FresnelDirtyFlag,r.AttributesDirtyFlag=u.a.MATERIAL_AttributesDirtyFlag,r.MiscDirtyFlag=u.a.MATERIAL_MiscDirtyFlag,r.AllDirtyFlag=u.a.MATERIAL_AllDirtyFlag,r._ImageProcessingDirtyCallBack=function(o){return o.markAsImageProcessingDirty()},r._TextureDirtyCallBack=function(o){return o.markAsTexturesDirty()},r._FresnelDirtyCallBack=function(o){return o.markAsFresnelDirty()},r._MiscDirtyCallBack=function(o){return o.markAsMiscDirty()},r._LightsDirtyCallBack=function(o){return o.markAsLightDirty()},r._AttributeDirtyCallBack=function(o){return o.markAsAttributesDirty()},r._FresnelAndMiscDirtyCallBack=function(o){r._FresnelDirtyCallBack(o),r._MiscDirtyCallBack(o)},r._TextureAndMiscDirtyCallBack=function(o){r._TextureDirtyCallBack(o),r._MiscDirtyCallBack(o)},r._DirtyCallbackArray=[],r._RunDirtyCallBacks=function(o){for(var G=0,M=r._DirtyCallbackArray;G<M.length;G++)(0,M[G])(o)},O.c([Object(q.c)()],r.prototype,"id",void 0),O.c([Object(q.c)()],r.prototype,"uniqueId",void 0),O.c([Object(q.c)()],r.prototype,"name",void 0),O.c([Object(q.c)()],r.prototype,"checkReadyOnEveryCall",void 0),O.c([Object(q.c)()],r.prototype,"checkReadyOnlyOnce",void 0),O.c([Object(q.c)()],r.prototype,"state",void 0),O.c([Object(q.c)("alpha")],r.prototype,"_alpha",void 0),O.c([Object(q.c)("backFaceCulling")],r.prototype,"_backFaceCulling",void 0),O.c([Object(q.c)()],r.prototype,"sideOrientation",void 0),O.c([Object(q.c)("alphaMode")],r.prototype,"_alphaMode",void 0),O.c([Object(q.c)()],r.prototype,"_needDepthPrePass",void 0),O.c([Object(q.c)()],r.prototype,"disableDepthWrite",void 0),O.c([Object(q.c)()],r.prototype,"forceDepthWrite",void 0),O.c([Object(q.c)()],r.prototype,"separateCullingPass",void 0),O.c([Object(q.c)("fogEnabled")],r.prototype,"_fogEnabled",void 0),O.c([Object(q.c)()],r.prototype,"pointSize",void 0),O.c([Object(q.c)()],r.prototype,"zOffset",void 0),O.c([Object(q.c)()],r.prototype,"wireframe",null),O.c([Object(q.c)()],r.prototype,"pointsCloud",null),O.c([Object(q.c)()],r.prototype,"fillMode",null),r}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return y});var O=l(1),q=l(2),j=l(28),I=l(9),H=l(8),A=l(0),v=l(25),z=l(6),u=l(22),w=l(19),y=function(r){function o(G,M,R,W){void 0===W&&(W=!0);var Y=r.call(this,G,R)||this;return Y._position=A.x.Zero(),Y.upVector=A.x.Up(),Y.orthoLeft=null,Y.orthoRight=null,Y.orthoBottom=null,Y.orthoTop=null,Y.fov=.8,Y.minZ=1,Y.maxZ=10000,Y.inertia=.9,Y.mode=o.PERSPECTIVE_CAMERA,Y.isIntermediate=!1,Y.viewport=new A.z(0,0,1,1),Y.layerMask=268435455,Y.fovMode=o.FOVMODE_VERTICAL_FIXED,Y.cameraRigMode=o.RIG_MODE_NONE,Y.customRenderTargets=new Array(),Y.outputRenderTarget=null,Y.onViewMatrixChangedObservable=new H.c(),Y.onProjectionMatrixChangedObservable=new H.c(),Y.onAfterCheckInputsObservable=new H.c(),Y.onRestoreStateObservable=new H.c(),Y._rigCameras=new Array(),Y._webvrViewMatrix=A.j.Identity(),Y._skipRendering=!1,Y._projectionMatrix=new A.j(),Y._postProcesses=new Array(),Y._activeMeshes=new j.a(256),Y._globalPosition=A.x.Zero(),Y._computedViewMatrix=A.j.Identity(),Y._doNotComputeProjectionMatrix=!1,Y._transformMatrix=A.j.Zero(),Y._refreshFrustumPlanes=!0,Y._isCamera=!0,Y._isLeftCamera=!1,Y._isRightCamera=!0,Y.getScene().addCamera(Y),W&&!Y.getScene().activeCamera&&(Y.getScene().activeCamera=Y),Y.position=M,Y}return O.d(o,r),Object.defineProperty(o.prototype,"position",{get:function(){return this._position},set:function(G){this._position=G},enumerable:!0,configurable:!0}),o.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},o.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},o.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},o.prototype.getClassName=function(){return"Camera"},o.prototype.toString=function(G){var M="Name: "+this.name;if(M+=", type: "+this.getClassName(),this.animations)for(var R=0;R<this.animations.length;R++)M+=", animation[0]: "+this.animations[R].toString(G);return M},Object.defineProperty(o.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),o.prototype.getActiveMeshes=function(){return this._activeMeshes},o.prototype.isActiveMesh=function(G){return-1!==this._activeMeshes.indexOf(G)},o.prototype.isReady=function(G){if(void 0===G&&(G=!1),G)for(var M=0,R=this._postProcesses;M<R.length;M++){var W=R[M];if(W&&!W.isReady())return!1}return r.prototype.isReady.call(this,G)},o.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache.position=new A.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new A.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},o.prototype._updateCache=function(G){G||r.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},o.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},o.prototype._isSynchronizedViewMatrix=function(){return!!r.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},o.prototype._isSynchronizedProjectionMatrix=function(){var G=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!G)return!1;var M=this.getEngine();return G=this.mode===o.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===M.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===M.getRenderWidth()&&this._cache.renderHeight===M.getRenderHeight()},o.prototype.attachControl=function(G,M){},o.prototype.detachControl=function(G){},o.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==o.RIG_MODE_NONE&&this._updateRigCameras()},o.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(o.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),o.prototype._getFirstPostProcess=function(){for(var G=0;G<this._postProcesses.length;G++)if(null!==this._postProcesses[G])return this._postProcesses[G];return null},o.prototype._cascadePostProcessesToRigCams=function(){var G=this._getFirstPostProcess();G&&G.markTextureDirty();for(var M=0,R=this._rigCameras.length;M<R;M++){var W=this._rigCameras[M],Y=W._rigPostProcess;Y?("pass"===Y.getEffectName()&&(W.isIntermediate=0===this._postProcesses.length),W._postProcesses=this._postProcesses.slice(0).concat(Y),Y.markTextureDirty()):W._postProcesses=this._postProcesses.slice(0)}},o.prototype.attachPostProcess=function(G,M){return void 0===M&&(M=null),!G.isReusable()&&this._postProcesses.indexOf(G)>-1?(z.a.Error("You're trying to reuse a post process not defined as reusable."),0):(null==M||M<0?this._postProcesses.push(G):null===this._postProcesses[M]?this._postProcesses[M]=G:this._postProcesses.splice(M,0,G),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(G))},o.prototype.detachPostProcess=function(G){var M=this._postProcesses.indexOf(G);-1!==M&&(this._postProcesses[M]=null),this._cascadePostProcessesToRigCams()},o.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},o.prototype._getViewMatrix=function(){return A.j.Identity()},o.prototype.getViewMatrix=function(G){return!G&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},o.prototype.freezeProjectionMatrix=function(G){this._doNotComputeProjectionMatrix=!0,void 0!==G&&(this._projectionMatrix=G)},o.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},o.prototype.getProjectionMatrix=function(G){if(this._doNotComputeProjectionMatrix||!G&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var M=this.getEngine(),R=this.getScene();if(this.mode===o.PERSPECTIVE_CAMERA)this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=M.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1),R.useRightHandedSystem?A.j.PerspectiveFovRHToRef(this.fov,M.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===o.FOVMODE_VERTICAL_FIXED):A.j.PerspectiveFovLHToRef(this.fov,M.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===o.FOVMODE_VERTICAL_FIXED);else{var W=M.getRenderWidth()/2,Y=M.getRenderHeight()/2;R.useRightHandedSystem?A.j.OrthoOffCenterRHToRef(this.orthoLeft||-W,this.orthoRight||W,this.orthoBottom||-Y,this.orthoTop||Y,this.minZ,this.maxZ,this._projectionMatrix):A.j.OrthoOffCenterLHToRef(this.orthoLeft||-W,this.orthoRight||W,this.orthoBottom||-Y,this.orthoTop||Y,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=M.getRenderWidth(),this._cache.renderHeight=M.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},o.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},o.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?A.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=A.i.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},o.prototype.isInFrustum=function(G,M){if(void 0===M&&(M=!1),this._updateFrustumPlanes(),M&&this.rigCameras.length>0){var R=!1;return this.rigCameras.forEach(function(W){W._updateFrustumPlanes(),R=R||G.isInFrustum(W._frustumPlanes)}),R}return G.isInFrustum(this._frustumPlanes)},o.prototype.isCompletelyInFrustum=function(G){return this._updateFrustumPlanes(),G.isCompletelyInFrustum(this._frustumPlanes)},o.prototype.getForwardRay=function(G,M,R){throw void 0===G&&(G=100),w.a.WarnImport("Ray")},o.prototype.dispose=function(G,M){for(void 0===M&&(M=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var R=this._rigCameras.pop();R&&R.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==o.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var W=this._postProcesses.length;--W>=0;){var Y=this._postProcesses[W];Y&&Y.dispose(this)}for(W=this.customRenderTargets.length;--W>=0;)this.customRenderTargets[W].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),r.prototype.dispose.call(this,G,M)},Object.defineProperty(o.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),o.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},o.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},o.prototype.setCameraRigMode=function(G,M){if(this.cameraRigMode!==G){for(;this._rigCameras.length>0;){var R=this._rigCameras.pop();R&&R.dispose()}if(this.cameraRigMode=G,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=M.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=I.h.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==o.RIG_MODE_NONE){var W=this.createRigCamera(this.name+"_L",0);W&&(W._isLeftCamera=!0);var Y=this.createRigCamera(this.name+"_R",1);Y&&(Y._isRightCamera=!0),W&&Y&&(this._rigCameras.push(W),this._rigCameras.push(Y))}switch(this.cameraRigMode){case o.RIG_MODE_STEREOSCOPIC_ANAGLYPH:o._setStereoscopicAnaglyphRigMode(this);break;case o.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case o.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case o.RIG_MODE_STEREOSCOPIC_OVERUNDER:o._setStereoscopicRigMode(this);break;case o.RIG_MODE_VR:o._setVRRigMode(this,M);break;case o.RIG_MODE_WEBVR:o._setWebVRRigMode(this,M)}this._cascadePostProcessesToRigCams(),this.update()}},o._setStereoscopicRigMode=function(G){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},o._setStereoscopicAnaglyphRigMode=function(G){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},o._setVRRigMode=function(G,M){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},o._setWebVRRigMode=function(G,M){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},o.prototype._getVRProjectionMatrix=function(){return A.j.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},o.prototype._updateCameraRotationMatrix=function(){},o.prototype._updateWebVRCameraRotationMatrix=function(){},o.prototype._getWebVRProjectionMatrix=function(){return A.j.Identity()},o.prototype._getWebVRViewMatrix=function(){return A.j.Identity()},o.prototype.setCameraRigParameter=function(G,M){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[G]=M,"interaxialDistance"===G&&(this._cameraRigParams.stereoHalfAngle=I.h.ToRadians(M/.0637))},o.prototype.createRigCamera=function(G,M){return null},o.prototype._updateRigCameras=function(){for(var G=0;G<this._rigCameras.length;G++)this._rigCameras[G].minZ=this.minZ,this._rigCameras[G].maxZ=this.maxZ,this._rigCameras[G].fov=this.fov,this._rigCameras[G].upVector.copyFrom(this.upVector);this.cameraRigMode===o.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},o.prototype._setupInputs=function(){},o.prototype.serialize=function(){var G=q.a.Serialize(this);return G.type=this.getClassName(),this.parent&&(G.parentId=this.parent.id),this.inputs&&this.inputs.serialize(G),q.a.AppendSerializedAnimations(this,G),G.ranges=this.serializeAnimationRanges(),G},o.prototype.clone=function(G){return q.a.Clone(o.GetConstructorFromName(this.getClassName(),G,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},o.prototype.getDirection=function(G){var M=A.x.Zero();return this.getDirectionToRef(G,M),M},o.prototype.getDirectionToRef=function(G,M){A.x.TransformNormalToRef(G,this.getWorldMatrix(),M)},o.GetConstructorFromName=function(G,M,R,W,Y){void 0===W&&(W=0),void 0===Y&&(Y=!0);var X=v.a.Construct(G,M,R,{interaxial_distance:W,isStereoscopicSideBySide:Y});return X||function(){return o._createDefaultParsedCamera(M,R)}},o.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},o.Parse=function(G,M){var R=G.type,W=o.GetConstructorFromName(R,G.name,M,G.interaxial_distance,G.isStereoscopicSideBySide),Y=q.a.Parse(W,G,M);if(G.parentId&&(Y._waitingParentId=G.parentId),Y.inputs&&(Y.inputs.parse(G),Y._setupInputs()),Y.setPosition&&(Y.position.copyFromFloats(0,0,0),Y.setPosition(A.x.FromArray(G.position))),G.target&&Y.setTarget&&Y.setTarget(A.x.FromArray(G.target)),G.cameraRigMode){var X=G.interaxial_distance?{interaxialDistance:G.interaxial_distance}:{};Y.setCameraRigMode(G.cameraRigMode,X)}if(G.animations){for(var ea=0;ea<G.animations.length;ea++){var ca=G.animations[ea],oa=u.a.GetClass("BABYLON.Animation");oa&&Y.animations.push(oa.Parse(ca))}v.a.ParseAnimationRanges(Y,G,M)}return G.autoAnimate&&M.beginAnimation(Y,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),Y},o._createDefaultParsedCamera=function(G,M){throw w.a.WarnImport("UniversalCamera")},o.PERSPECTIVE_CAMERA=0,o.ORTHOGRAPHIC_CAMERA=1,o.FOVMODE_VERTICAL_FIXED=0,o.FOVMODE_HORIZONTAL_FIXED=1,o.RIG_MODE_NONE=0,o.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,o.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,o.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,o.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,o.RIG_MODE_VR=20,o.RIG_MODE_WEBVR=21,o.RIG_MODE_CUSTOM=22,o.ForceAttachControlToAlwaysPreventDefault=!1,O.c([Object(q.o)("position")],o.prototype,"_position",void 0),O.c([Object(q.o)()],o.prototype,"upVector",void 0),O.c([Object(q.c)()],o.prototype,"orthoLeft",void 0),O.c([Object(q.c)()],o.prototype,"orthoRight",void 0),O.c([Object(q.c)()],o.prototype,"orthoBottom",void 0),O.c([Object(q.c)()],o.prototype,"orthoTop",void 0),O.c([Object(q.c)()],o.prototype,"fov",void 0),O.c([Object(q.c)()],o.prototype,"minZ",void 0),O.c([Object(q.c)()],o.prototype,"maxZ",void 0),O.c([Object(q.c)()],o.prototype,"inertia",void 0),O.c([Object(q.c)()],o.prototype,"mode",void 0),O.c([Object(q.c)()],o.prototype,"layerMask",void 0),O.c([Object(q.c)()],o.prototype,"fovMode",void 0),O.c([Object(q.c)()],o.prototype,"cameraRigMode",void 0),O.c([Object(q.c)()],o.prototype,"interaxialDistance",void 0),O.c([Object(q.c)()],o.prototype,"isStereoscopicSideBySide",void 0),o}(v.a)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return q.GetClass=function(j){return this.RegisteredTypes&&this.RegisteredTypes[j]?this.RegisteredTypes[j]:null},q.RegisteredTypes={},q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return Object.defineProperty(q,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(q,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!0,configurable:!0}),q.Instances=new Array(),q._LastCreatedScene=null,q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return R});var O=l(1),q=l(9),j=l(8),I=l(0),H=l(10),A=l(4),v=l(13),z=l(42),u=l(50),w=l(43),y=l(3),r=l(108),o=l(19),G=function(){return function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=I.x.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}(),M=function(){return function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new G(),this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1}}(),R=function(W){function Y(X,ea){void 0===ea&&(ea=null);var ca=W.call(this,X,ea,!1)||this;return ca._internalAbstractMeshDataInfo=new M(),ca.cullingStrategy=Y.CULLINGSTRATEGY_STANDARD,ca.onCollideObservable=new j.c(),ca.onCollisionPositionChangeObservable=new j.c(),ca.onMaterialChangedObservable=new j.c(),ca.definedFacingForward=!0,ca._occlusionQuery=null,ca._renderingGroup=null,ca.alphaIndex=Number.MAX_VALUE,ca.isVisible=!0,ca.isPickable=!0,ca.showSubMeshesBoundingBox=!1,ca.isBlocker=!1,ca.enablePointerMoveEvents=!1,ca.renderingGroupId=0,ca._material=null,ca.outlineColor=I.e.Red(),ca.outlineWidth=.02,ca.overlayColor=I.e.Red(),ca.overlayAlpha=.5,ca.useOctreeForRenderingSelection=!0,ca.useOctreeForPicking=!0,ca.useOctreeForCollisions=!0,ca.alwaysSelectAsActiveMesh=!1,ca.doNotSyncBoundingInfo=!1,ca.actionManager=null,ca._meshCollisionData=new r.a(),ca.ellipsoid=new I.x(.5,1,.5),ca.ellipsoidOffset=new I.x(0,0,0),ca.edgesWidth=1,ca.edgesColor=new I.f(1,0,0,1),ca._edgesRenderer=null,ca._masterMesh=null,ca._boundingInfo=null,ca._renderId=0,ca._intersectionsInProgress=new Array(),ca._unIndexed=!1,ca._lightSources=new Array(),ca._waitingData={lods:null,actions:null,freezeWorldMatrix:null},ca._bonesTransformMatrices=null,ca.onRebuildObservable=new j.c(),ca._onCollisionPositionChange=function(oa,Z,T){void 0===T&&(T=null),Z.subtractToRef(ca._meshCollisionData._oldPositionForCollisions,ca._meshCollisionData._diffPositionForCollisions),ca._meshCollisionData._diffPositionForCollisions.length()>H.b.CollisionsEpsilon&&ca.position.addInPlace(ca._meshCollisionData._diffPositionForCollisions),T&&ca.onCollideObservable.notifyObservers(T),ca.onCollisionPositionChangeObservable.notifyObservers(ca.position)},ca.getScene().addMesh(ca),ca._resyncLightSources(),ca}return O.d(Y,W),Object.defineProperty(Y,"BILLBOARDMODE_NONE",{get:function(){return z.a.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_X",{get:function(){return z.a.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_Y",{get:function(){return z.a.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_Z",{get:function(){return z.a.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_ALL",{get:function(){return z.a.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(X){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=X},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(X){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=X},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(X){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=X},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(X){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=X},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),Y.prototype._updateNonUniformScalingState=function(X){return!!W.prototype._updateNonUniformScalingState.call(this,X)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(Y.prototype,"onCollide",{set:function(X){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(X)},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"onCollisionPositionChange",{set:function(X){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(X)},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(X){this._internalAbstractMeshDataInfo._visibility!==X&&(this._internalAbstractMeshDataInfo._visibility=X,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"material",{get:function(){return this._material},set:function(X){this._material!==X&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=X,X&&X.meshMap&&(X.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(X){this._internalAbstractMeshDataInfo._receiveShadows!==X&&(this._internalAbstractMeshDataInfo._receiveShadows=X,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(X){this._internalAbstractMeshDataInfo._hasVertexAlpha!==X&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=X,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(X){this._internalAbstractMeshDataInfo._useVertexColors!==X&&(this._internalAbstractMeshDataInfo._useVertexColors=X,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(X){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==X&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=X,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(X){this._internalAbstractMeshDataInfo._numBoneInfluencers!==X&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=X,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(X){this._internalAbstractMeshDataInfo._applyFog!==X&&(this._internalAbstractMeshDataInfo._applyFog=X,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(X){X!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=X,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(X){this._meshCollisionData._collisionMask=isNaN(X)?-1:X},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(X){this._meshCollisionData._collisionGroup=isNaN(X)?-1:X},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(X){var ea=this._internalAbstractMeshDataInfo._skeleton;ea&&ea.needInitialSkinMatrix&&ea._unregisterMeshWithPoseMatrix(this),X&&X.needInitialSkinMatrix&&X._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=X,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),Y.prototype.getClassName=function(){return"AbstractMesh"},Y.prototype.toString=function(X){var ea="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");ea+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var ca=this._internalAbstractMeshDataInfo._skeleton;return ca&&(ea+=", skeleton: "+ca.name),X&&(ea+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],ea+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),ea},Y.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==z.a.BILLBOARDMODE_NONE?this._masterMesh:W.prototype._getEffectiveParent.call(this)},Y.prototype._getActionManagerForTrigger=function(X,ea){if(void 0===ea&&(ea=!0),this.actionManager&&(ea||this.actionManager.isRecursive)){if(!X)return this.actionManager;if(this.actionManager.hasSpecificTrigger(X))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(X,!1):null},Y.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var X=0,ea=this.subMeshes;X<ea.length;X++)ea[X]._rebuild()},Y.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var X=0,ea=this.getScene().lights;X<ea.length;X++){var ca=ea[X];ca.isEnabled()&&(ca.canAffectMesh(this)&&this._lightSources.push(ca))}this._markSubMeshesAsLightDirty()},Y.prototype._resyncLighSource=function(X){var ea=X.isEnabled()&&X.canAffectMesh(this),ca=this._lightSources.indexOf(X);if(-1===ca){if(!ea)return;this._lightSources.push(X)}else{if(ea)return;this._lightSources.splice(ca,1)}this._markSubMeshesAsLightDirty()},Y.prototype._unBindEffect=function(){for(var X=0,ea=this.subMeshes;X<ea.length;X++)ea[X].setEffect(null)},Y.prototype._removeLightSource=function(X){var ea=this._lightSources.indexOf(X);-1!==ea&&(this._lightSources.splice(ea,1),this._markSubMeshesAsLightDirty())},Y.prototype._markSubMeshesAsDirty=function(X){if(this.subMeshes)for(var ea=0,ca=this.subMeshes;ea<ca.length;ea++){var oa=ca[ea];oa._materialDefines&&X(oa._materialDefines)}},Y.prototype._markSubMeshesAsLightDirty=function(){this._markSubMeshesAsDirty(function(X){return X.markAsLightDirty()})},Y.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(X){return X.markAsAttributesDirty()})},Y.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var X=0,ea=this.subMeshes;X<ea.length;X++){var ca=ea[X].getMaterial();ca&&ca.markAsDirty(y.a.MATERIAL_MiscDirtyFlag)}},Object.defineProperty(Y.prototype,"scaling",{get:function(){return this._scaling},set:function(X){this._scaling=X,this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),Y.prototype.getLOD=function(X){return this},Y.prototype.getTotalVertices=function(){return 0},Y.prototype.getTotalIndices=function(){return 0},Y.prototype.getIndices=function(){return null},Y.prototype.getVerticesData=function(X){return null},Y.prototype.setVerticesData=function(X,ea,ca,oa){return this},Y.prototype.updateVerticesData=function(X,ea,ca,oa){return this},Y.prototype.setIndices=function(X,ea){return this},Y.prototype.isVerticesDataPresent=function(X){return!1},Y.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Y.prototype.normalizeToUnitCube=function(X,ea){void 0===X&&(X=!0),void 0===ea&&(ea=!1);var ca=null,oa=null;ea&&(this.rotationQuaternion?(oa=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(ca=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var Z=this.getHierarchyBoundingVectors(X),T=Z.max.subtract(Z.min),V=Math.max(T.x,T.y,T.z);if(0===V)return this;var D=1/V;return this.scaling.scaleInPlace(D),ea&&(this.rotationQuaternion&&oa?this.rotationQuaternion.copyFrom(oa):this.rotation&&ca&&this.rotation.copyFrom(ca)),this},Y.prototype.setBoundingInfo=function(X){return this._boundingInfo=X,this},Object.defineProperty(Y.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(A.b.MatricesIndicesKind)&&this.isVerticesDataPresent(A.b.MatricesWeightsKind)},enumerable:!0,configurable:!0}),Y.prototype._preActivate=function(){},Y.prototype._preActivateForIntermediateRendering=function(X){},Y.prototype._activate=function(X,ea){return this._renderId=X,!0},Y.prototype._postActivate=function(){},Y.prototype._freeze=function(){},Y.prototype._unFreeze=function(){},Y.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===z.a.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():W.prototype.getWorldMatrix.call(this)},Y.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():W.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(Y.prototype,"isAnInstance",{get:function(){return!1},enumerable:!0,configurable:!0}),Y.prototype.movePOV=function(X,ea,ca){return this.position.addInPlace(this.calcMovePOV(X,ea,ca)),this},Y.prototype.calcMovePOV=function(X,ea,ca){var oa=new I.j();(this.rotationQuaternion?this.rotationQuaternion:I.q.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(oa);var Z=I.x.Zero(),T=this.definedFacingForward?-1:1;return I.x.TransformCoordinatesFromFloatsToRef(X*T,ea,ca*T,oa,Z),Z},Y.prototype.rotatePOV=function(X,ea,ca){return this.rotation.addInPlace(this.calcRotatePOV(X,ea,ca)),this},Y.prototype.calcRotatePOV=function(X,ea,ca){var oa=this.definedFacingForward?1:-1;return new I.x(X*oa,ea,ca*oa)},Y.prototype.refreshBoundingInfo=function(X){return void 0===X&&(X=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(X),null),this)},Y.prototype._refreshBoundingInfo=function(X,ea){if(X){var ca=q.h.ExtractMinAndMax(X,0,this.getTotalVertices(),ea);this._boundingInfo?this._boundingInfo.reConstruct(ca.minimum,ca.maximum):this._boundingInfo=new w.a(ca.minimum,ca.maximum)}if(this.subMeshes)for(var oa=0;oa<this.subMeshes.length;oa++)this.subMeshes[oa].refreshBoundingInfo(X);this._updateBoundingInfo()},Y.prototype._getPositionData=function(X){var ea=this.getVerticesData(A.b.PositionKind);if(ea&&X&&this.skeleton){ea=q.h.Slice(ea),this._generatePointsArray();var ca=this.getVerticesData(A.b.MatricesIndicesKind),oa=this.getVerticesData(A.b.MatricesWeightsKind);if(oa&&ca){var Z=this.numBoneInfluencers>4,T=Z?this.getVerticesData(A.b.MatricesIndicesExtraKind):null,V=Z?this.getVerticesData(A.b.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var D=this.skeleton.getTransformMatrices(this),F=I.t.Vector3[0],L=I.t.Matrix[0],N=I.t.Matrix[1],p=0,g=0;g<ea.length;g+=3,p+=4){var n,s;for(L.reset(),n=0;n<4;n++)(s=oa[p+n])>0&&(I.j.FromFloat32ArrayToRefScaled(D,Math.floor(16*ca[p+n]),s,N),L.addToSelf(N));if(Z)for(n=0;n<4;n++)(s=V[p+n])>0&&(I.j.FromFloat32ArrayToRefScaled(D,Math.floor(16*T[p+n]),s,N),L.addToSelf(N));I.x.TransformCoordinatesFromFloatsToRef(ea[g],ea[g+1],ea[g+2],L,F),F.toArray(ea,g),this._positions&&this._positions[g/3].copyFrom(F)}}}return ea},Y.prototype._updateBoundingInfo=function(){var X=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(X.worldMatrixFromCache):this._boundingInfo=new w.a(this.absolutePosition,this.absolutePosition,X.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(X.worldMatrixFromCache),this},Y.prototype._updateSubMeshesBoundingInfo=function(X){if(!this.subMeshes)return this;for(var ea=this.subMeshes.length,ca=0;ca<ea;ca++){var oa=this.subMeshes[ca];(ea>1||!oa.IsGlobal)&&oa.updateBoundingInfo(X)}return this},Y.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(Y.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!0,configurable:!0}),Y.prototype.isInFrustum=function(X){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(X,this.cullingStrategy)},Y.prototype.isCompletelyInFrustum=function(X){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(X)},Y.prototype.intersectsMesh=function(X,ea,ca){if(void 0===ea&&(ea=!1),!this._boundingInfo||!X._boundingInfo)return!1;if(this._boundingInfo.intersects(X._boundingInfo,ea))return!0;if(ca){for(var oa=0,Z=this.getChildMeshes();oa<Z.length;oa++)if(Z[oa].intersectsMesh(X,ea,!0))return!0}return!1},Y.prototype.intersectsPoint=function(X){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(X)},Object.defineProperty(Y.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(X){this._meshCollisionData._checkCollisions=X},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!0,configurable:!0}),Y.prototype.moveWithCollisions=function(X){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var ea=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=ea.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,ea.getNewPosition(this._meshCollisionData._oldPositionForCollisions,X,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},Y.prototype._collideForSubMesh=function(X,ea,ca){if(this._generatePointsArray(),!this._positions)return this;if(!X._lastColliderWorldVertices||!X._lastColliderTransformMatrix.equals(ea)){X._lastColliderTransformMatrix=ea.clone(),X._lastColliderWorldVertices=[],X._trianglePlanes=[];for(var oa=X.verticesStart,Z=X.verticesStart+X.verticesCount,T=oa;T<Z;T++)X._lastColliderWorldVertices.push(I.x.TransformCoordinates(this._positions[T],ea))}return ca._collide(X._trianglePlanes,X._lastColliderWorldVertices,this.getIndices(),X.indexStart,X.indexStart+X.indexCount,X.verticesStart,!!X.getMaterial()),ca.collisionFound&&(ca.collidedMesh=this),this},Y.prototype._processCollisionsForSubMeshes=function(X,ea){for(var ca=this._scene.getCollidingSubMeshCandidates(this,X),oa=ca.length,Z=0;Z<oa;Z++){var T=ca.data[Z];oa>1&&!T._checkCollision(X)||this._collideForSubMesh(T,ea,X)}return this},Y.prototype._checkCollision=function(X){if(!this._boundingInfo||!this._boundingInfo._checkCollision(X))return this;var ea=I.t.Matrix[0],ca=I.t.Matrix[1];return I.j.ScalingToRef(1/X._radius.x,1/X._radius.y,1/X._radius.z,ea),this.worldMatrixFromCache.multiplyToRef(ea,ca),this._processCollisionsForSubMeshes(X,ca),this},Y.prototype._generatePointsArray=function(){return!1},Y.prototype.intersects=function(X,ea,ca){var oa=new u.a(),Z="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,T=this._boundingInfo;if(!(this.subMeshes&&T&&X.intersectsSphere(T.boundingSphere,Z)&&X.intersectsBox(T.boundingBox,Z)))return oa;if(!this._generatePointsArray())return oa;for(var V=null,D=this._scene.getIntersectingSubMeshCandidates(this,X),F=D.length,L=0;L<F;L++){var N=D.data[L];if(!(F>1)||N.canIntersects(X)){var p=N.intersects(X,this._positions,this.getIndices(),ea,ca);if(p&&(ea||!V||p.distance<V.distance)&&((V=p).subMeshId=L,ea))break}}if(V){var g=this.getWorldMatrix(),n=I.t.Vector3[0],s=I.t.Vector3[1];I.x.TransformCoordinatesToRef(X.origin,g,n),X.direction.scaleToRef(V.distance,s);var t=I.x.TransformNormal(s,g).addInPlace(n);return oa.hit=!0,oa.distance=I.x.Distance(n,t),oa.pickedPoint=t,oa.pickedMesh=this,oa.bu=V.bu||0,oa.bv=V.bv||0,oa.faceId=V.faceId,oa.subMeshId=V.subMeshId,oa}return oa},Y.prototype.clone=function(X,ea,ca){return null},Y.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array();return this},Y.prototype.dispose=function(X,ea){var ca,oa=this;for(void 0===ea&&(ea=!1),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,ca=0;ca<this._intersectionsInProgress.length;ca++){var Z=this._intersectionsInProgress[ca],T=Z._intersectionsInProgress.indexOf(this);Z._intersectionsInProgress.splice(T,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(D){var F=D.includedOnlyMeshes.indexOf(oa);-1!==F&&D.includedOnlyMeshes.splice(F,1),-1!==(F=D.excludedMeshes.indexOf(oa))&&D.excludedMeshes.splice(F,1);var L=D.getShadowGenerator();if(L){var N=L.getShadowMap();N&&N.renderList&&-1!==(F=N.renderList.indexOf(oa))&&N.renderList.splice(F,1)}}),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var V=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,V.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),V.wipeCaches(),this.getScene().removeMesh(this),ea&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!X)for(ca=0;ca<this.getScene().particleSystems.length;ca++)this.getScene().particleSystems[ca].emitter===this&&(this.getScene().particleSystems[ca].dispose(),ca--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),W.prototype.dispose.call(this,X,ea)},Y.prototype.addChild=function(X){return X.setParent(this),this},Y.prototype.removeChild=function(X){return X.setParent(null),this},Y.prototype._initFacetData=function(){var X=this._internalAbstractMeshDataInfo._facetData;X.facetNormals||(X.facetNormals=new Array()),X.facetPositions||(X.facetPositions=new Array()),X.facetPartitioning||(X.facetPartitioning=new Array()),X.facetNb=this.getIndices().length/3|0,X.partitioningSubdivisions=X.partitioningSubdivisions?X.partitioningSubdivisions:10,X.partitioningBBoxRatio=X.partitioningBBoxRatio?X.partitioningBBoxRatio:1.01;for(var ea=0;ea<X.facetNb;ea++)X.facetNormals[ea]=I.x.Zero(),X.facetPositions[ea]=I.x.Zero();return X.facetDataEnabled=!0,this},Y.prototype.updateFacetData=function(){var X=this._internalAbstractMeshDataInfo._facetData;X.facetDataEnabled||this._initFacetData();var ea=this.getVerticesData(A.b.PositionKind),ca=this.getIndices(),oa=this.getVerticesData(A.b.NormalKind),Z=this.getBoundingInfo();if(X.facetDepthSort&&!X.facetDepthSortEnabled){if(X.facetDepthSortEnabled=!0,ca instanceof Uint16Array)X.depthSortedIndices=new Uint16Array(ca);else if(ca instanceof Uint32Array)X.depthSortedIndices=new Uint32Array(ca);else{for(var T=!1,V=0;V<ca.length;V++)if(ca[V]>65535){T=!0;break}X.depthSortedIndices=T?new Uint32Array(ca):new Uint16Array(ca)}if(X.facetDepthSortFunction=function(n,s){return s.sqDistance-n.sqDistance},!X.facetDepthSortFrom){var D=this.getScene().activeCamera;X.facetDepthSortFrom=D?D.position:I.x.Zero()}X.depthSortedFacets=[];for(var F=0;F<X.facetNb;F++){var L={ind:3*F,sqDistance:0};X.depthSortedFacets.push(L)}X.invertedMatrix=I.j.Identity(),X.facetDepthSortOrigin=I.x.Zero()}X.bbSize.x=Z.maximum.x-Z.minimum.x>I.h?Z.maximum.x-Z.minimum.x:I.h,X.bbSize.y=Z.maximum.y-Z.minimum.y>I.h?Z.maximum.y-Z.minimum.y:I.h,X.bbSize.z=Z.maximum.z-Z.minimum.z>I.h?Z.maximum.z-Z.minimum.z:I.h;var N=X.bbSize.x>X.bbSize.y?X.bbSize.x:X.bbSize.y;if(N=N>X.bbSize.z?N:X.bbSize.z,X.subDiv.max=X.partitioningSubdivisions,X.subDiv.X=Math.floor(X.subDiv.max*X.bbSize.x/N),X.subDiv.Y=Math.floor(X.subDiv.max*X.bbSize.y/N),X.subDiv.Z=Math.floor(X.subDiv.max*X.bbSize.z/N),X.subDiv.X=X.subDiv.X<1?1:X.subDiv.X,X.subDiv.Y=X.subDiv.Y<1?1:X.subDiv.Y,X.subDiv.Z=X.subDiv.Z<1?1:X.subDiv.Z,X.facetParameters.facetNormals=this.getFacetLocalNormals(),X.facetParameters.facetPositions=this.getFacetLocalPositions(),X.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),X.facetParameters.bInfo=Z,X.facetParameters.bbSize=X.bbSize,X.facetParameters.subDiv=X.subDiv,X.facetParameters.ratio=this.partitioningBBoxRatio,X.facetParameters.depthSort=X.facetDepthSort,X.facetDepthSort&&X.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(X.invertedMatrix),I.x.TransformCoordinatesToRef(X.facetDepthSortFrom,X.invertedMatrix,X.facetDepthSortOrigin),X.facetParameters.distanceTo=X.facetDepthSortOrigin),X.facetParameters.depthSortedFacets=X.depthSortedFacets,v.a.ComputeNormals(ea,ca,oa,X.facetParameters),X.facetDepthSort&&X.facetDepthSortEnabled){X.depthSortedFacets.sort(X.facetDepthSortFunction);var p=X.depthSortedIndices.length/3|0;for(F=0;F<p;F++){var g=X.depthSortedFacets[F].ind;X.depthSortedIndices[3*F]=ca[g],X.depthSortedIndices[3*F+1]=ca[g+1],X.depthSortedIndices[3*F+2]=ca[g+2]}this.updateIndices(X.depthSortedIndices,void 0,!0)}return this},Y.prototype.getFacetLocalNormals=function(){var X=this._internalAbstractMeshDataInfo._facetData;return X.facetNormals||this.updateFacetData(),X.facetNormals},Y.prototype.getFacetLocalPositions=function(){var X=this._internalAbstractMeshDataInfo._facetData;return X.facetPositions||this.updateFacetData(),X.facetPositions},Y.prototype.getFacetLocalPartitioning=function(){var X=this._internalAbstractMeshDataInfo._facetData;return X.facetPartitioning||this.updateFacetData(),X.facetPartitioning},Y.prototype.getFacetPosition=function(X){var ea=I.x.Zero();return this.getFacetPositionToRef(X,ea),ea},Y.prototype.getFacetPositionToRef=function(X,ea){var ca=this.getFacetLocalPositions()[X],oa=this.getWorldMatrix();return I.x.TransformCoordinatesToRef(ca,oa,ea),this},Y.prototype.getFacetNormal=function(X){var ea=I.x.Zero();return this.getFacetNormalToRef(X,ea),ea},Y.prototype.getFacetNormalToRef=function(X,ea){var ca=this.getFacetLocalNormals()[X];return I.x.TransformNormalToRef(ca,this.getWorldMatrix(),ea),this},Y.prototype.getFacetsAtLocalCoordinates=function(X,ea,ca){var oa=this.getBoundingInfo(),Z=this._internalAbstractMeshDataInfo._facetData,T=Math.floor((X-oa.minimum.x*Z.partitioningBBoxRatio)*Z.subDiv.X*Z.partitioningBBoxRatio/Z.bbSize.x),V=Math.floor((ea-oa.minimum.y*Z.partitioningBBoxRatio)*Z.subDiv.Y*Z.partitioningBBoxRatio/Z.bbSize.y),D=Math.floor((ca-oa.minimum.z*Z.partitioningBBoxRatio)*Z.subDiv.Z*Z.partitioningBBoxRatio/Z.bbSize.z);return T<0||T>Z.subDiv.max||V<0||V>Z.subDiv.max||D<0||D>Z.subDiv.max?null:Z.facetPartitioning[T+Z.subDiv.max*V+Z.subDiv.max*Z.subDiv.max*D]},Y.prototype.getClosestFacetAtCoordinates=function(X,ea,ca,oa,Z,T){void 0===Z&&(Z=!1),void 0===T&&(T=!0);var V=this.getWorldMatrix(),D=I.t.Matrix[5];V.invertToRef(D);var F=I.t.Vector3[8];I.x.TransformCoordinatesFromFloatsToRef(X,ea,ca,D,F);var L=this.getClosestFacetAtLocalCoordinates(F.x,F.y,F.z,oa,Z,T);return oa&&I.x.TransformCoordinatesFromFloatsToRef(oa.x,oa.y,oa.z,V,oa),L},Y.prototype.getClosestFacetAtLocalCoordinates=function(X,ea,ca,oa,Z,T){void 0===Z&&(Z=!1),void 0===T&&(T=!0);var V=null,D=0,F=0,L=0,N=0,p=0,g=0,n=0,s=0,t=this.getFacetLocalPositions(),C=this.getFacetLocalNormals(),J=this.getFacetsAtLocalCoordinates(X,ea,ca);if(!J)return null;for(var Q,$,aa,ba=Number.MAX_VALUE,ia=ba,qa=0;qa<J.length;qa++)$=C[Q=J[qa]],N=(X-(aa=t[Q]).x)*$.x+(ea-aa.y)*$.y+(ca-aa.z)*$.z,(!Z||Z&&T&&N>=0||Z&&!T&&N<=0)&&(N=$.x*aa.x+$.y*aa.y+$.z*aa.z,p=-($.x*X+$.y*ea+$.z*ca-N)/($.x*$.x+$.y*$.y+$.z*$.z),(ia=(D=(g=X+$.x*p)-X)*D+(F=(n=ea+$.y*p)-ea)*F+(L=(s=ca+$.z*p)-ca)*L)<ba&&(ba=ia,V=Q,oa&&(oa.x=g,oa.y=n,oa.z=s)));return V},Y.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},Y.prototype.disableFacetData=function(){var X=this._internalAbstractMeshDataInfo._facetData;return X.facetDataEnabled&&(X.facetDataEnabled=!1,X.facetPositions=new Array(),X.facetNormals=new Array(),X.facetPartitioning=new Array(),X.facetParameters=null,X.depthSortedIndices=new Uint32Array(0)),this},Y.prototype.updateIndices=function(X,ea,ca){return void 0===ca&&(ca=!1),this},Y.prototype.createNormals=function(X){var ea,ca=this.getVerticesData(A.b.PositionKind),oa=this.getIndices();return ea=this.isVerticesDataPresent(A.b.NormalKind)?this.getVerticesData(A.b.NormalKind):[],v.a.ComputeNormals(ca,oa,ea,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(A.b.NormalKind,ea,X),this},Y.prototype.alignWithNormal=function(X,ea){ea||(ea=I.c.Y);var ca=I.t.Vector3[0],oa=I.t.Vector3[1];return I.x.CrossToRef(ea,X,oa),I.x.CrossToRef(X,oa,ca),this.rotationQuaternion?I.q.RotationQuaternionFromAxisToRef(ca,X,oa,this.rotationQuaternion):I.x.RotationFromAxisToRef(ca,X,oa,this.rotation),this},Y.prototype._checkOcclusionQuery=function(){return!1},Y.prototype.disableEdgesRendering=function(){throw o.a.WarnImport("EdgesRenderer")},Y.prototype.enableEdgesRendering=function(X,ea){throw o.a.WarnImport("EdgesRenderer")},Y.OCCLUSION_TYPE_NONE=0,Y.OCCLUSION_TYPE_OPTIMISTIC=1,Y.OCCLUSION_TYPE_STRICT=2,Y.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,Y.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,Y.CULLINGSTRATEGY_STANDARD=y.a.MESHES_CULLINGSTRATEGY_STANDARD,Y.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=y.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,Y.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=y.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,Y.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=y.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY,Y}(z.a)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return z});var O=l(1),q=l(0),j=l(2),I=l(8),H=l(23),A=l(19),v=l(9),z=function(){function u(w,y,r){void 0===y&&(y=null),void 0===r&&(r=!0),this.state="",this.metadata=null,this.reservedDataStore=null,this.doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array(),this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=q.j.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new I.c(),this._onDisposeObserver=null,this._behaviors=new Array(),this.name=w,this.id=w,this._scene=y||H.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),r&&this.addToSceneRootNodes()}return u.AddNodeConstructor=function(w,y){this._NodeConstructors[w]=y},u.Construct=function(w,y,r,o){var G=this._NodeConstructors[w];return G?G(y,r,o):null},u.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(u.prototype,"parent",{get:function(){return this._parentNode},set:function(w){if(this._parentNode!==w){var y=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var r=this._parentNode._children.indexOf(this);-1!==r&&this._parentNode._children.splice(r,1),w||this._isDisposed||this.addToSceneRootNodes()}this._parentNode=w,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array()),this._parentNode._children.push(this),y||this.removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!0,configurable:!0}),u.prototype.addToSceneRootNodes=function(){-1===this._sceneRootNodesIndex&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},u.prototype.removeFromSceneRootNodes=function(){if(-1!==this._sceneRootNodesIndex){var w=this._scene.rootNodes,y=w.length-1;w[this._sceneRootNodesIndex]=w[y],w[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(u.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(w){this._animationPropertiesOverride=w},enumerable:!0,configurable:!0}),u.prototype.getClassName=function(){return"Node"},Object.defineProperty(u.prototype,"onDispose",{set:function(w){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(w)},enumerable:!0,configurable:!0}),u.prototype.getScene=function(){return this._scene},u.prototype.getEngine=function(){return this._scene.getEngine()},u.prototype.addBehavior=function(w,y){var r=this;return void 0===y&&(y=!1),-1!==this._behaviors.indexOf(w)?this:(w.init(),this._scene.isLoading&&!y?this._scene.onDataLoadedObservable.addOnce(function(){w.attach(r)}):w.attach(this),this._behaviors.push(w),this)},u.prototype.removeBehavior=function(w){var y=this._behaviors.indexOf(w);return-1===y?this:(this._behaviors[y].detach(),this._behaviors.splice(y,1),this)},Object.defineProperty(u.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),u.prototype.getBehaviorByName=function(w){for(var y=0,r=this._behaviors;y<r.length;y++){var o=r[y];if(o.name===w)return o}return null},u.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},u.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(u.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),u.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},u.prototype.updateCache=function(w){!w&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},u.prototype._getActionManagerForTrigger=function(w,y){return void 0===y&&(y=!0),this.parent?this.parent._getActionManagerForTrigger(w,!1):null},u.prototype._updateCache=function(w){},u.prototype._isSynchronized=function(){return!0},u.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},u.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},u.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},u.prototype.isReady=function(w){return void 0===w&&(w=!1),this._isReady},u.prototype.isEnabled=function(w){return void 0===w&&(w=!0),!1===w?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},u.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(w){w._syncParentEnabledState()})},u.prototype.setEnabled=function(w){this._isEnabled=w,this._syncParentEnabledState()},u.prototype.isDescendantOf=function(w){return!!this.parent&&(this.parent===w||this.parent.isDescendantOf(w))},u.prototype._getDescendants=function(w,y,r){if(void 0===y&&(y=!1),this._children)for(var o=0;o<this._children.length;o++){var G=this._children[o];r&&!r(G)||w.push(G),y||G._getDescendants(w,!1,r)}},u.prototype.getDescendants=function(w,y){var r=new Array();return this._getDescendants(r,w,y),r},u.prototype.getChildMeshes=function(w,y){var r=[];return this._getDescendants(r,w,function(o){return(!y||y(o))&&void 0!==o.cullingStrategy}),r},u.prototype.getChildren=function(w,y){return void 0===y&&(y=!0),this.getDescendants(y,w)},u.prototype._setReady=function(w){w!==this._isReady&&(w?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},u.prototype.getAnimationByName=function(w){for(var y=0;y<this.animations.length;y++){var r=this.animations[y];if(r.name===w)return r}return null},u.prototype.createAnimationRange=function(w,y,r){if(!this._ranges[w]){this._ranges[w]=u._AnimationRangeFactory(w,y,r);for(var o=0,G=this.animations.length;o<G;o++)this.animations[o]&&this.animations[o].createRange(w,y,r)}},u.prototype.deleteAnimationRange=function(w,y){void 0===y&&(y=!0);for(var r=0,o=this.animations.length;r<o;r++)this.animations[r]&&this.animations[r].deleteRange(w,y);this._ranges[w]=null},u.prototype.getAnimationRange=function(w){return this._ranges[w]},u.prototype.getAnimationRanges=function(){var w,y=[];for(w in this._ranges)y.push(this._ranges[w]);return y},u.prototype.beginAnimation=function(w,y,r,o){var G=this.getAnimationRange(w);return G?this._scene.beginAnimation(this,G.from,G.to,y,r,o):null},u.prototype.serializeAnimationRanges=function(){var w=[];for(var y in this._ranges){var r=this._ranges[y];if(r){var o={};o.name=y,o.from=r.from,o.to=r.to,w.push(o)}}return w},u.prototype.computeWorldMatrix=function(w){return this._worldMatrix||(this._worldMatrix=q.j.Identity()),this._worldMatrix},u.prototype.dispose=function(w,y){if(void 0===y&&(y=!1),this._isDisposed=!0,!w)for(var r=0,o=this.getDescendants(!0);r<o.length;r++)o[r].dispose(w,y);this.parent?this.parent=null:this.removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var G=0,M=this._behaviors;G<M.length;G++)M[G].detach();this._behaviors=[]},u.ParseAnimationRanges=function(w,y,r){if(y.ranges)for(var o=0;o<y.ranges.length;o++){var G=y.ranges[o];w.createAnimationRange(G.name,G.from,G.to)}},u.prototype.getHierarchyBoundingVectors=function(w,y){var r,o;void 0===w&&(w=!0),void 0===y&&(y=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);if(this.getBoundingInfo&&this.subMeshes){var G=this.getBoundingInfo();r=G.boundingBox.minimumWorld,o=G.boundingBox.maximumWorld}else r=new q.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new q.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(w)for(var M=0,R=this.getDescendants(!1);M<R.length;M++){var W=R[M];if(W.computeWorldMatrix(!0),(!y||y(W))&&W.getBoundingInfo&&0!==W.getTotalVertices()){var Y=W.getBoundingInfo().boundingBox,X=Y.minimumWorld,ea=Y.maximumWorld;v.h.CheckExtends(X,r,o),v.h.CheckExtends(ea,r,o)}}return{min:r,max:o}},u._AnimationRangeFactory=function(w,y,r){throw A.a.WarnImport("AnimationRange")},u._NodeConstructors={},O.c([Object(j.c)()],u.prototype,"name",void 0),O.c([Object(j.c)()],u.prototype,"id",void 0),O.c([Object(j.c)()],u.prototype,"uniqueId",void 0),O.c([Object(j.c)()],u.prototype,"state",void 0),O.c([Object(j.c)()],u.prototype,"metadata",void 0),u}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return H});var O=l(8),q=l(92),j=l(3),I=l(19),H=function(){function A(v,z,u){void 0===u&&(u=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new O.c(),this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._dataSource=A.DATASOURCE_UNKNOWN,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._webGLTexture=null,this._references=1,this._engine=v,this._dataSource=z,u||(this._webGLTexture=v._createTexture())}return A.prototype.getEngine=function(){return this._engine},Object.defineProperty(A.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!0,configurable:!0}),A.prototype.incrementReferences=function(){this._references++},A.prototype.updateSize=function(v,z,u){void 0===u&&(u=1),this.width=v,this.height=z,this.depth=u,this.baseWidth=v,this.baseHeight=z,this.baseDepth=u,this._size=v*z*u},A.prototype._rebuild=function(){var v,z=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this._dataSource){case A.DATASOURCE_TEMP:return;case A.DATASOURCE_URL:return void(v=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){v._swapAndDie(z),z.isReady=!0},null,this._buffer,void 0,this.format));case A.DATASOURCE_RAW:return(v=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case A.DATASOURCE_RAW3D:return(v=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case A.DATASOURCE_DYNAMIC:return(v=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case A.DATASOURCE_RENDERTARGET:var u=new q.a();if(u.generateDepthBuffer=this._generateDepthBuffer,u.generateMipMaps=this.generateMipMaps,u.generateStencilBuffer=this._generateStencilBuffer,u.samplingMode=this.samplingMode,u.type=this.type,this.isCube)v=this._engine.createRenderTargetCubeTexture(this.width,u);else{var w={width:this.width,height:this.height};v=this._engine.createRenderTargetTexture(w,u)}return v._swapAndDie(this),void(this.isReady=!0);case A.DATASOURCE_DEPTHTEXTURE:var y={bilinearFiltering:this.samplingMode!==j.a.TEXTURE_BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube};return(v=this._engine.createDepthStencilTexture({width:this.width,height:this.height},y))._swapAndDie(this),void(this.isReady=!0);case A.DATASOURCE_CUBE:return void(v=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){v._swapAndDie(z),z.isReady=!0},null,this.format,this._extension));case A.DATASOURCE_CUBERAW:return(v=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case A.DATASOURCE_CUBERAW_RGBD:return v=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void A._UpdateRGBDAsync(v,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){v._swapAndDie(z),z.isReady=!0});case A.DATASOURCE_CUBEPREFILTERED:return void((v=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(r){r&&r._swapAndDie(z),z.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},A.prototype._swapAndDie=function(v){v._webGLTexture=this._webGLTexture,v._isRGBD=this._isRGBD,this._framebuffer&&(v._framebuffer=this._framebuffer),this._depthStencilBuffer&&(v._depthStencilBuffer=this._depthStencilBuffer),this._lodTextureHigh&&(v._lodTextureHigh&&v._lodTextureHigh.dispose(),v._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(v._lodTextureMid&&v._lodTextureMid.dispose(),v._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(v._lodTextureLow&&v._lodTextureLow.dispose(),v._lodTextureLow=this._lodTextureLow);var z=this._engine.getLoadedTexturesCache(),u=z.indexOf(this);-1!==u&&z.splice(u,1)},A.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},A._UpdateRGBDAsync=function(v,z,u,w,y){throw I.a.WarnImport("environmentTextureTools")},A.DATASOURCE_UNKNOWN=0,A.DATASOURCE_URL=1,A.DATASOURCE_TEMP=2,A.DATASOURCE_RAW=3,A.DATASOURCE_DYNAMIC=4,A.DATASOURCE_RENDERTARGET=5,A.DATASOURCE_MULTIRENDERTARGET=6,A.DATASOURCE_CUBE=7,A.DATASOURCE_CUBERAW=8,A.DATASOURCE_CUBEPREFILTERED=9,A.DATASOURCE_RAW3D=10,A.DATASOURCE_DEPTHTEXTURE=11,A.DATASOURCE_CUBERAW_RGBD=12,A}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return v});var O=l(6),q=l(34),j=l(0),I=l(24),H=l(11),A=l(37);H.a._PhysicsImpostorParser=function(z,u,w){return new v(u,w.physicsImpostor,{mass:w.physicsMass,friction:w.physicsFriction,restitution:w.physicsRestitution},z)};var v=function(){function z(u,w,y,r){var o=this;void 0===y&&(y={mass:0}),this.object=u,this.type=w,this._options=y,this._scene=r,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array(),this._onAfterPhysicsStepCallbacks=new Array(),this._onPhysicsCollideCallbacks=[],this._deltaPosition=j.x.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new j.q(),this._tmpQuat2=new j.q(),this.beforeStep=function(){o._physicsEngine&&(o.object.translate(o._deltaPosition,-1),o._deltaRotationConjugated&&o.object.rotationQuaternion&&o.object.rotationQuaternion.multiplyToRef(o._deltaRotationConjugated,o.object.rotationQuaternion),o.object.computeWorldMatrix(!1),o.object.parent&&o.object.rotationQuaternion?(o.getParentsRotation(),o._tmpQuat.multiplyToRef(o.object.rotationQuaternion,o._tmpQuat)):o._tmpQuat.copyFrom(o.object.rotationQuaternion||new j.q()),o._options.disableBidirectionalTransformation||o.object.rotationQuaternion&&o._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(o,o.object.getAbsolutePosition(),o._tmpQuat),o._onBeforePhysicsStepCallbacks.forEach(function(G){G(o)}))},this.afterStep=function(){o._physicsEngine&&(o._onAfterPhysicsStepCallbacks.forEach(function(G){G(o)}),o._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(o),o.object.parent&&o.object.rotationQuaternion&&(o.getParentsRotation(),o._tmpQuat.conjugateInPlace(),o._tmpQuat.multiplyToRef(o.object.rotationQuaternion,o.object.rotationQuaternion)),o.object.setAbsolutePosition(o.object.position),o._deltaRotation&&o.object.rotationQuaternion&&o.object.rotationQuaternion.multiplyToRef(o._deltaRotation,o.object.rotationQuaternion),o.object.translate(o._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(G){if((o._onPhysicsCollideCallbacks.length||o.onCollideEvent)&&o._physicsEngine){var M=o._physicsEngine.getImpostorWithPhysicsBody(G.body);M&&(o.onCollideEvent&&o.onCollideEvent(o,M),o._onPhysicsCollideCallbacks.filter(function(R){return-1!==R.otherImpostors.indexOf(M)}).forEach(function(R){R.callback(o,M)}))}},this.object?(!this._scene&&u.getScene&&(this._scene=u.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=j.q.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new j.q()),this._options.mass=void 0===y.mass?0:y.mass,this._options.friction=void 0===y.friction?.2:y.friction,this._options.restitution=void 0===y.restitution?.2:y.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===y.pressure?200:y.pressure,this._options.stiffness=void 0===y.stiffness?1:y.stiffness,this._options.velocityIterations=void 0===y.velocityIterations?20:y.velocityIterations,this._options.positionIterations=void 0===y.positionIterations?20:y.positionIterations,this._options.fixedPoints=void 0===y.fixedPoints?0:y.fixedPoints,this._options.margin=void 0===y.margin?0:y.margin,this._options.damping=void 0===y.damping?0:y.damping,this._options.path=void 0===y.path?null:y.path,this._options.shape=void 0===y.shape?null:y.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&O.a.Warn("You must affect impostors to children before affecting impostor to parent.")):O.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):O.a.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(z.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(u){this.setMass(u)},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(u){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,u)},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(u){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,u)},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var u=this._physicsEngine.getPhysicsPlugin();return u.setBodyPressure?u.getBodyPressure(this):0},set:function(u){if(this._physicsEngine){var w=this._physicsEngine.getPhysicsPlugin();w.setBodyPressure&&w.setBodyPressure(this,u)}},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var u=this._physicsEngine.getPhysicsPlugin();return u.getBodyStiffness?u.getBodyStiffness(this):0},set:function(u){if(this._physicsEngine){var w=this._physicsEngine.getPhysicsPlugin();w.setBodyStiffness&&w.setBodyStiffness(this,u)}},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var u=this._physicsEngine.getPhysicsPlugin();return u.getBodyVelocityIterations?u.getBodyVelocityIterations(this):0},set:function(u){if(this._physicsEngine){var w=this._physicsEngine.getPhysicsPlugin();w.setBodyVelocityIterations&&w.setBodyVelocityIterations(this,u)}},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var u=this._physicsEngine.getPhysicsPlugin();return u.getBodyPositionIterations?u.getBodyPositionIterations(this):0},set:function(u){if(this._physicsEngine){var w=this._physicsEngine.getPhysicsPlugin();w.setBodyPositionIterations&&w.setBodyPositionIterations(this,u)}},enumerable:!0,configurable:!0}),z.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},z.prototype._getPhysicsParent=function(){return this.object.parent instanceof I.a?this.object.parent.physicsImpostor:null},z.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},z.prototype.setScalingUpdated=function(){this.forceUpdate()},z.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(z.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(u){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=u,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(u){this._parent=u},enumerable:!0,configurable:!0}),z.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},z.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var u=this.object.rotationQuaternion;this.object.rotationQuaternion=z.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var w=this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=u,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),w}return z.DEFAULT_OBJECT_SIZE},z.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},z.prototype.getParam=function(u){return this._options[u]},z.prototype.setParam=function(u,w){this._options[u]=w,this._bodyUpdateRequired=!0},z.prototype.setMass=function(u){this.getParam("mass")!==u&&this.setParam("mass",u),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,u)},z.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):j.x.Zero()},z.prototype.setLinearVelocity=function(u){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,u)},z.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):j.x.Zero()},z.prototype.setAngularVelocity=function(u){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,u)},z.prototype.executeNativeFunction=function(u){this._physicsEngine&&u(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},z.prototype.registerBeforePhysicsStep=function(u){this._onBeforePhysicsStepCallbacks.push(u)},z.prototype.unregisterBeforePhysicsStep=function(u){var w=this._onBeforePhysicsStepCallbacks.indexOf(u);w>-1?this._onBeforePhysicsStepCallbacks.splice(w,1):O.a.Warn("Function to remove was not found")},z.prototype.registerAfterPhysicsStep=function(u){this._onAfterPhysicsStepCallbacks.push(u)},z.prototype.unregisterAfterPhysicsStep=function(u){var w=this._onAfterPhysicsStepCallbacks.indexOf(u);w>-1?this._onAfterPhysicsStepCallbacks.splice(w,1):O.a.Warn("Function to remove was not found")},z.prototype.registerOnPhysicsCollide=function(u,w){var y=u instanceof Array?u:[u];this._onPhysicsCollideCallbacks.push({callback:w,otherImpostors:y})},z.prototype.unregisterOnPhysicsCollide=function(u,w){var y=u instanceof Array?u:[u],r=-1;this._onPhysicsCollideCallbacks.some(function(o,G){if(o.callback===w&&o.otherImpostors.length===y.length){var M=o.otherImpostors.every(function(R){return y.indexOf(R)>-1});return M&&(r=G),M}return!1})?this._onPhysicsCollideCallbacks.splice(r,1):O.a.Warn("Function to remove was not found")},z.prototype.getParentsRotation=function(){var u=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);u;)u.rotationQuaternion?this._tmpQuat2.copyFrom(u.rotationQuaternion):j.q.RotationYawPitchRollToRef(u.rotation.y,u.rotation.x,u.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),u=u.parent;return this._tmpQuat},z.prototype.applyForce=function(u,w){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,u,w),this},z.prototype.applyImpulse=function(u,w){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,u,w),this},z.prototype.createJoint=function(u,w,y){var r=new A.e(w,y);return this.addJoint(u,r),this},z.prototype.addJoint=function(u,w){return this._joints.push({otherImpostor:u,joint:w}),this._physicsEngine&&this._physicsEngine.addJoint(this,u,w),this},z.prototype.addAnchor=function(u,w,y,r,o){if(!this._physicsEngine)return this;var G=this._physicsEngine.getPhysicsPlugin();return G.appendAnchor?(this._physicsEngine&&G.appendAnchor(this,u,w,y,r,o),this):this},z.prototype.addHook=function(u,w,y,r){if(!this._physicsEngine)return this;var o=this._physicsEngine.getPhysicsPlugin();return o.appendAnchor?(this._physicsEngine&&o.appendHook(this,u,w,y,r),this):this},z.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},z.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},z.prototype.clone=function(u){return u?new z(u,this.type,this._options,this._scene):null},z.prototype.dispose=function(){var u=this;this._physicsEngine&&(this._joints.forEach(function(w){u._physicsEngine&&u._physicsEngine.removeJoint(u,w.otherImpostor,w.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},z.prototype.setDeltaPosition=function(u){this._deltaPosition.copyFrom(u)},z.prototype.setDeltaRotation=function(u){this._deltaRotation||(this._deltaRotation=new j.q()),this._deltaRotation.copyFrom(u),this._deltaRotationConjugated=this._deltaRotation.conjugate()},z.prototype.getBoxSizeToRef=function(u){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,u),this},z.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},z.prototype.syncBoneWithImpostor=function(u,w,y,r,o){var G=z._tmpVecs[0],M=this.object;if(M.rotationQuaternion)if(o){var R=z._tmpQuat;M.rotationQuaternion.multiplyToRef(o,R),u.setRotationQuaternion(R,j.s.WORLD,w)}else u.setRotationQuaternion(M.rotationQuaternion,j.s.WORLD,w);G.x=0,G.y=0,G.z=0,y&&(G.x=y.x,G.y=y.y,G.z=y.z,u.getDirectionToRef(G,w,G),null==r&&(r=y.length()),G.x*=r,G.y*=r,G.z*=r),u.getParent()?(G.addInPlace(M.getAbsolutePosition()),u.setAbsolutePosition(G,w)):(w.setAbsolutePosition(M.getAbsolutePosition()),w.position.x-=G.x,w.position.y-=G.y,w.position.z-=G.z)},z.prototype.syncImpostorWithBone=function(u,w,y,r,o,G){var M=this.object;if(M.rotationQuaternion)if(o){var R=z._tmpQuat;u.getRotationQuaternionToRef(j.s.WORLD,w,R),R.multiplyToRef(o,M.rotationQuaternion)}else u.getRotationQuaternionToRef(j.s.WORLD,w,M.rotationQuaternion);var W=z._tmpVecs[0],Y=z._tmpVecs[1];G||((G=z._tmpVecs[2]).x=0,G.y=1,G.z=0),u.getDirectionToRef(G,w,Y),u.getAbsolutePositionToRef(w,W),null==r&&y&&(r=y.length()),null!=r&&(W.x+=Y.x*r,W.y+=Y.y*r,W.z+=Y.z*r),M.setAbsolutePosition(W)},z.DEFAULT_OBJECT_SIZE=new j.x(1,1,1),z.IDENTITY_QUATERNION=j.q.Identity(),z._tmpVecs=q.a.BuildArray(3,j.x.Zero),z._tmpQuat=j.q.Identity(),z.NoImpostor=0,z.SphereImpostor=1,z.BoxImpostor=2,z.PlaneImpostor=3,z.MeshImpostor=4,z.CylinderImpostor=7,z.ParticleImpostor=8,z.HeightmapImpostor=9,z.ConvexHullImpostor=10,z.RopeImpostor=101,z.ClothImpostor=102,z.SoftbodyImpostor=103,z}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q}),l.d(x,"b",function(){return j});var O=l(1),q=function(){function I(H){this.length=0,this.data=new Array(H),this._id=I._GlobalId++}return I.prototype.push=function(H){this.data[this.length++]=H,this.length>this.data.length&&(this.data.length*=2)},I.prototype.forEach=function(H){for(var A=0;A<this.length;A++)H(this.data[A])},I.prototype.sort=function(H){this.data.sort(H)},I.prototype.reset=function(){this.length=0},I.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},I.prototype.concat=function(H){if(0!==H.length){this.length+H.length>this.data.length&&(this.data.length=2*(this.length+H.length));for(var A=0;A<H.length;A++)this.data[this.length++]=(H.data||H)[A]}},I.prototype.indexOf=function(H){var A=this.data.indexOf(H);return A>=this.length?-1:A},I.prototype.contains=function(H){return-1!==this.indexOf(H)},I._GlobalId=0,I}(),j=function(I){function H(){var A=null!==I&&I.apply(this,arguments)||this;return A._duplicateId=0,A}return O.d(H,I),H.prototype.push=function(A){I.prototype.push.call(this,A),A.__smartArrayFlags||(A.__smartArrayFlags={}),A.__smartArrayFlags[this._id]=this._duplicateId},H.prototype.pushNoDuplicate=function(A){return(!A.__smartArrayFlags||A.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(A),!0)},H.prototype.reset=function(){I.prototype.reset.call(this),this._duplicateId++},H.prototype.concatWithNoDuplicate=function(A){if(0!==A.length){this.length+A.length>this.data.length&&(this.data.length=2*(this.length+A.length));for(var v=0;v<A.length;v++){var z=(A.data||A)[v];this.pushNoDuplicate(z)}}},H}(q)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return j});var O=l(9),q=l(104),j=function(){function I(){}return I.EnableFor=function(H){H._tags=H._tags||{},H.hasTags=function(){return I.HasTags(H)},H.addTags=function(A){return I.AddTagsTo(H,A)},H.removeTags=function(A){return I.RemoveTagsFrom(H,A)},H.matchesTagsQuery=function(A){return I.MatchesQuery(H,A)}},I.DisableFor=function(H){delete H._tags,delete H.hasTags,delete H.addTags,delete H.removeTags,delete H.matchesTagsQuery},I.HasTags=function(H){return!!H._tags&&!O.h.IsEmpty(H._tags)},I.GetTags=function(H,A){if(void 0===A&&(A=!0),!H._tags)return null;if(A){var v=[];for(var z in H._tags)H._tags.hasOwnProperty(z)&&!0===H._tags[z]&&v.push(z);return v.join(" ")}return H._tags},I.AddTagsTo=function(H,A){A&&("string"==typeof A&&A.split(" ").forEach(function(v,z,u){I._AddTagTo(H,v)}))},I._AddTagTo=function(H,A){""!==(A=A.trim())&&"true"!==A&&"false"!==A&&(A.match(/[\s]/)||A.match(/^([!]|([|]|[&]){2})/)||(I.EnableFor(H),H._tags[A]=!0))},I.RemoveTagsFrom=function(H,A){if(I.HasTags(H)){var v=A.split(" ");for(var z in v)I._RemoveTagFrom(H,v[z])}},I._RemoveTagFrom=function(H,A){delete H._tags[A]},I.MatchesQuery=function(H,A){return void 0===A||(""===A?I.HasTags(H):q.a.Eval(A,function(v){return I.HasTags(H)&&H._tags[v]}))},I}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){this.rootNodes=new Array(),this.cameras=new Array(),this.lights=new Array(),this.meshes=new Array(),this.skeletons=new Array(),this.particleSystems=new Array(),this.animations=[],this.animationGroups=new Array(),this.multiMaterials=new Array(),this.materials=new Array(),this.morphTargetManagers=new Array(),this.geometries=new Array(),this.transformNodes=new Array(),this.actionManagers=new Array(),this.textures=new Array(),this.environmentTexture=null}return q.AddParser=function(j,I){this._BabylonFileParsers[j]=I},q.GetParser=function(j){return this._BabylonFileParsers[j]?this._BabylonFileParsers[j]:null},q.AddIndividualParser=function(j,I){this._IndividualBabylonFileParsers[j]=I},q.GetIndividualParser=function(j){return this._IndividualBabylonFileParsers[j]?this._IndividualBabylonFileParsers[j]:null},q.Parse=function(j,I,H,A){for(var v in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(v)&&this._BabylonFileParsers[v](j,I,H,A)},q._BabylonFileParsers={},q._IndividualBabylonFileParsers={},q}()},function(Aa,x,l){"use strict";l.d(x,"b",function(){return z}),l.d(x,"a",function(){return u});var O=l(1),q=l(2),j=l(8),I=l(9),H=l(0),A=l(64),v=l(93),z=function(w){function y(){var r=w.call(this)||this;return r.IMAGEPROCESSING=!1,r.VIGNETTE=!1,r.VIGNETTEBLENDMODEMULTIPLY=!1,r.VIGNETTEBLENDMODEOPAQUE=!1,r.TONEMAPPING=!1,r.TONEMAPPING_ACES=!1,r.CONTRAST=!1,r.COLORCURVES=!1,r.COLORGRADING=!1,r.COLORGRADING3D=!1,r.SAMPLER3DGREENDEPTH=!1,r.SAMPLER3DBGRMAP=!1,r.IMAGEPROCESSINGPOSTPROCESS=!1,r.EXPOSURE=!1,r.rebuild(),r}return O.d(y,w),y}(A.a),u=function(){function w(){this.colorCurves=new v.a(),this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=w.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new H.f(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=w.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new j.c()}return Object.defineProperty(w.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(y){this._colorCurvesEnabled!==y&&(this._colorCurvesEnabled=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(y){this._colorGradingTexture!==y&&(this._colorGradingTexture=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(y){this._colorGradingEnabled!==y&&(this._colorGradingEnabled=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(y){this._colorGradingWithGreenDepth!==y&&(this._colorGradingWithGreenDepth=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(y){this._colorGradingBGR!==y&&(this._colorGradingBGR=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"exposure",{get:function(){return this._exposure},set:function(y){this._exposure!==y&&(this._exposure=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(y){this._toneMappingEnabled!==y&&(this._toneMappingEnabled=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(y){this._toneMappingType!==y&&(this._toneMappingType=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"contrast",{get:function(){return this._contrast},set:function(y){this._contrast!==y&&(this._contrast=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(y){this._vignetteBlendMode!==y&&(this._vignetteBlendMode=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(y){this._vignetteEnabled!==y&&(this._vignetteEnabled=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(y){this._applyByPostProcess!==y&&(this._applyByPostProcess=y,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(y){this._isEnabled!==y&&(this._isEnabled=y,this._updateParameters())},enumerable:!0,configurable:!0}),w.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},w.prototype.getClassName=function(){return"ImageProcessingConfiguration"},w.PrepareUniforms=function(y,r){r.EXPOSURE&&y.push("exposureLinear"),r.CONTRAST&&y.push("contrast"),r.COLORGRADING&&y.push("colorTransformSettings"),r.VIGNETTE&&(y.push("vInverseScreenSize"),y.push("vignetteSettings1"),y.push("vignetteSettings2")),r.COLORCURVES&&v.a.PrepareUniforms(y)},w.PrepareSamplers=function(y,r){r.COLORGRADING&&y.push("txColorTransform")},w.prototype.prepareDefines=function(y,r){if(void 0===r&&(r=!1),r!==this.applyByPostProcess||!this._isEnabled)return y.VIGNETTE=!1,y.TONEMAPPING=!1,y.TONEMAPPING_ACES=!1,y.CONTRAST=!1,y.EXPOSURE=!1,y.COLORCURVES=!1,y.COLORGRADING=!1,y.COLORGRADING3D=!1,y.IMAGEPROCESSING=!1,void(y.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(y.VIGNETTE=this.vignetteEnabled,y.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===w._VIGNETTEMODE_MULTIPLY,y.VIGNETTEBLENDMODEOPAQUE=!y.VIGNETTEBLENDMODEMULTIPLY,y.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case w.TONEMAPPING_ACES:y.TONEMAPPING_ACES=!0;break;default:y.TONEMAPPING_ACES=!1}y.CONTRAST=1!==this.contrast,y.EXPOSURE=1!==this.exposure,y.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,y.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,y.COLORGRADING?y.COLORGRADING3D=this.colorGradingTexture.is3D:y.COLORGRADING3D=!1,y.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,y.SAMPLER3DBGRMAP=this.colorGradingBGR,y.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,y.IMAGEPROCESSING=y.VIGNETTE||y.TONEMAPPING||y.CONTRAST||y.EXPOSURE||y.COLORCURVES||y.COLORGRADING},w.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},w.prototype.bind=function(y,r){if(void 0===r&&(r=1),this._colorCurvesEnabled&&this.colorCurves&&v.a.Bind(this.colorCurves,y),this._vignetteEnabled){var o=1/y.getEngine().getRenderWidth(),G=1/y.getEngine().getRenderHeight();y.setFloat2("vInverseScreenSize",o,G);var M=Math.tan(.5*this.vignetteCameraFov),R=M*r,W=Math.sqrt(R*M);R=I.h.Mix(R,W,this.vignetteStretch),M=I.h.Mix(M,W,this.vignetteStretch),y.setFloat4("vignetteSettings1",R,M,-R*this.vignetteCentreX,-M*this.vignetteCentreY);var Y=-2*this.vignetteWeight;y.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,Y)}if(y.setFloat("exposureLinear",this.exposure),y.setFloat("contrast",this.contrast),this.colorGradingTexture){y.setTexture("txColorTransform",this.colorGradingTexture);var X=this.colorGradingTexture.getSize().height;y.setFloat4("colorTransformSettings",(X-1)/X,.5/X,X,this.colorGradingTexture.level)}},w.prototype.clone=function(){return q.a.Clone(function(){return new w()},this)},w.prototype.serialize=function(){return q.a.Serialize(this)},w.Parse=function(y){return q.a.Parse(function(){return new w()},y,null,null)},Object.defineProperty(w,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(w,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),w.TONEMAPPING_STANDARD=0,w.TONEMAPPING_ACES=1,w._VIGNETTEMODE_MULTIPLY=0,w._VIGNETTEMODE_OPAQUE=1,O.c([Object(q.g)()],w.prototype,"colorCurves",void 0),O.c([Object(q.c)()],w.prototype,"_colorCurvesEnabled",void 0),O.c([Object(q.m)("colorGradingTexture")],w.prototype,"_colorGradingTexture",void 0),O.c([Object(q.c)()],w.prototype,"_colorGradingEnabled",void 0),O.c([Object(q.c)()],w.prototype,"_colorGradingWithGreenDepth",void 0),O.c([Object(q.c)()],w.prototype,"_colorGradingBGR",void 0),O.c([Object(q.c)()],w.prototype,"_exposure",void 0),O.c([Object(q.c)()],w.prototype,"_toneMappingEnabled",void 0),O.c([Object(q.c)()],w.prototype,"_toneMappingType",void 0),O.c([Object(q.c)()],w.prototype,"_contrast",void 0),O.c([Object(q.c)()],w.prototype,"vignetteStretch",void 0),O.c([Object(q.c)()],w.prototype,"vignetteCentreX",void 0),O.c([Object(q.c)()],w.prototype,"vignetteCentreY",void 0),O.c([Object(q.c)()],w.prototype,"vignetteWeight",void 0),O.c([Object(q.f)()],w.prototype,"vignetteColor",void 0),O.c([Object(q.c)()],w.prototype,"vignetteCameraFov",void 0),O.c([Object(q.c)()],w.prototype,"_vignetteBlendMode",void 0),O.c([Object(q.c)()],w.prototype,"_vignetteEnabled",void 0),O.c([Object(q.c)()],w.prototype,"_applyByPostProcess",void 0),O.c([Object(q.c)()],w.prototype,"_isEnabled",void 0),w}();q.a._ImageProcessingConfigurationParser=u.Parse},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q});var O=function(j,I){return j?j.getClassName&&"Mesh"===j.getClassName()?null:j.getClassName&&"SubMesh"===j.getClassName()?j.clone(I):j.clone?j.clone():null:null},q=function(){function j(){}return j.DeepCopy=function(I,H,A,v){for(var z in I)if(("_"!==z[0]||v&&-1!==v.indexOf(z))&&(!A||-1===A.indexOf(z))){var u=I[z],w=typeof u;if("function"!==w)try{if("object"===w)if(u instanceof Array){if(H[z]=[],u.length>0)if("object"==typeof u[0])for(var y=0;y<u.length;y++){var r=O(u[y],H);-1===H[z].indexOf(r)&&H[z].push(r)}else H[z]=u.slice(0)}else H[z]=O(u,H);else H[z]=u}catch(o){}}},j}()},function(Aa,x,l){"use strict";var O=l(1),q=l(2),j=l(28),I=l(16),H=l(0),A=l(4),v=l(31),z=l(5),u=l(64),w=l(75),y=l(15),r=l(7),o=l(22),G=l(18),M=`uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif
#ifdef REFRACTION
uniform vec4 vRefractionInfos;
#ifndef REFRACTIONMAP_3D
uniform mat4 refractionMatrix;
#endif
#ifdef REFRACTIONFRESNEL
uniform vec4 refractionLeftColor;
uniform vec4 refractionRightColor;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
#endif
#ifdef DIFFUSEFRESNEL
uniform vec4 diffuseLeftColor;
uniform vec4 diffuseRightColor;
#endif
#ifdef OPACITYFRESNEL
uniform vec4 opacityParts;
#endif
#ifdef EMISSIVEFRESNEL
uniform vec4 emissiveLeftColor;
uniform vec4 emissiveRightColor;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)
uniform mat4 reflectionMatrix;
#endif
#ifndef REFLECTIONMAP_SKYBOX
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 reflectionLeftColor;
uniform vec4 reflectionRightColor;
#endif
#endif`;z.a.IncludesShadersStore.defaultFragmentDeclaration=M;var R=`layout(std140,column_major) uniform;
uniform Material
{
vec4 diffuseLeftColor;
vec4 diffuseRightColor;
vec4 opacityParts;
vec4 reflectionLeftColor;
vec4 reflectionRightColor;
vec4 refractionLeftColor;
vec4 refractionRightColor;
vec4 emissiveLeftColor;
vec4 emissiveRightColor;
vec2 vDiffuseInfos;
vec2 vAmbientInfos;
vec2 vOpacityInfos;
vec2 vReflectionInfos;
vec3 vReflectionPosition;
vec3 vReflectionSize;
vec2 vEmissiveInfos;
vec2 vLightmapInfos;
vec2 vSpecularInfos;
vec3 vBumpInfos;
mat4 diffuseMatrix;
mat4 ambientMatrix;
mat4 opacityMatrix;
mat4 reflectionMatrix;
mat4 emissiveMatrix;
mat4 lightmapMatrix;
mat4 specularMatrix;
mat4 bumpMatrix;
vec2 vTangentSpaceParams;
float pointSize;
mat4 refractionMatrix;
vec4 vRefractionInfos;
vec4 vSpecularColor;
vec3 vEmissiveColor;
float visibility;
vec4 vDiffuseColor;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};
`;z.a.IncludesShadersStore.defaultUboDeclaration=R,l(56),l(84),l(85),l(120),l(112);var W=`#ifdef FRESNEL
float computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)
{
float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);
return clamp(fresnelTerm,0.,1.);
}
#endif`;z.a.IncludesShadersStore.fresnelFunction=W,l(113),l(86),l(87),l(121),l(95),l(88),l(98),l(89),l(122),l(123),l(114),l(115),l(99);var Y=`#include<__decl__defaultFragment>
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif

#define RECIPROCAL_PI2 0.15915494
uniform vec3 vEyePosition;
uniform vec3 vAmbientColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFRACTION
#ifdef REFRACTIONMAP_3D
uniform samplerCube refractionCubeSampler;
#else
uniform sampler2D refraction2DSampler;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
#if SPECULARDIRECTUV == 1
#define vSpecularUV vMainUV1
#elif SPECULARDIRECTUV == 2
#define vSpecularUV vMainUV2
#else
varying vec2 vSpecularUV;
#endif
uniform sampler2D specularSampler;
#endif
#ifdef ALPHATEST
uniform float alphaCutOff;
#endif

#include<fresnelFunction>

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
uniform samplerCube reflectionCubeSampler;
#else
uniform sampler2D reflection2DSampler;
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>
#include<bumpFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));
#endif
#include<bumpFragment>
#ifdef TWOSIDEDLIGHTING
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);
#ifdef ALPHATEST
if (baseColor.a<alphaCutOff)
discard;
#endif
#ifdef ALPHAFROMDIFFUSE
alpha*=baseColor.a;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
baseColor.rgb*=vDiffuseInfos.y;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE

vec3 baseAmbientColor=vec3(1.,1.,1.);
#ifdef AMBIENT
baseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#endif
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#ifdef SPECULAR
vec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);
specularColor=specularMapColor.rgb;
#ifdef GLOSSINESS
glossiness=glossiness*specularMapColor.a;
#endif
#endif
#else
float glossiness=0.;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
float shadow=1.;
#ifdef LIGHTMAP
vec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;
#endif
#include<lightFragment>[0..maxSimultaneousLights]

vec3 refractionColor=vec3(0.,0.,0.);
#ifdef REFRACTION
vec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));
#ifdef REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
if (dot(refractionVector,viewDirectionW)<1.0) {
refractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;
}
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
refractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;
#endif
#ifdef IS_REFRACTION_LINEAR
refractionColor=toGammaSpace(refractionColor);
#endif
refractionColor*=vRefractionInfos.x;
#endif

vec3 reflectionColor=vec3(0.,0.,0.);
#ifdef REFLECTION
vec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_3D
#ifdef ROUGHNESS
float bias=vReflectionInfos.y;
#ifdef SPECULARTERM
#ifdef SPECULAR
#ifdef GLOSSINESS
bias*=(1.0-specularMapColor.a);
#endif
#endif
#endif
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;
#else
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;
#endif
#else
vec2 coords=vReflectionUVW.xy;
#ifdef REFLECTIONMAP_PROJECTION
coords/=vReflectionUVW.z;
#endif
coords.y=1.0-coords.y;
reflectionColor=texture2D(reflection2DSampler,coords).rgb;
#endif
#ifdef IS_REFLECTION_LINEAR
reflectionColor=toGammaSpace(reflectionColor);
#endif
reflectionColor*=vReflectionInfos.x;
#ifdef REFLECTIONFRESNEL
float reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);
#ifdef REFLECTIONFRESNELFROMSPECULAR
#ifdef SPECULARTERM
reflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#else
reflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#else
reflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#endif
#endif
#ifdef REFRACTIONFRESNEL
float refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);
refractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);
alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;
#else
alpha*=opacityMap.a*vOpacityInfos.y;
#endif
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef OPACITYFRESNEL
float opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);
alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;
#endif

vec3 emissiveColor=vEmissiveColor;
#ifdef EMISSIVE
emissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;
#endif
#ifdef EMISSIVEFRESNEL
float emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);
emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;
#endif

#ifdef DIFFUSEFRESNEL
float diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);
diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;
#endif

#ifdef EMISSIVEASILLUMINATION
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
#ifdef LINKEMISSIVEWITHDIFFUSE
vec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#endif
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#ifdef SPECULAROVERALPHA
alpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);
#endif
#else
vec3 finalSpecular=vec3(0.0);
#endif
#ifdef REFLECTIONOVERALPHA
alpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);
#endif

#ifdef EMISSIVEASILLUMINATION
vec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);
#else
vec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);
#endif

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
color.rgb*=lightmapColor;
#else
color.rgb+=lightmapColor;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG
color.rgb=max(color.rgb,0.);
#include<logDepthFragment>
#include<fogFragment>


#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#else
#ifdef IMAGEPROCESSING
color.rgb=toLinearSpace(color.rgb);
color=applyImageProcessing(color);
#endif
#endif
color.a*=visibility;
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
gl_FragColor=color;
}
`;z.a.ShadersStore.defaultPixelShader=Y;var X=`
uniform mat4 viewProjection;
uniform mat4 view;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
uniform mat4 specularMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef REFLECTION
uniform mat4 reflectionMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
`;z.a.IncludesShadersStore.defaultVertexDeclaration=X,l(67),l(68),l(124),l(96),l(100),l(101),l(102),l(103),l(69),l(70),l(125),l(90),l(116),l(117),z.a.IncludesShadersStore.pointCloudVertex=`#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif`,l(118);var ea=`#include<__decl__defaultVertex>

#define CUSTOM_VERTEX_BEGIN
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
varying vec2 vSpecularUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED
vPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;
#else
vPositionUVW=position;
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#include<bonesVertex>
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
} else {
gl_Position=viewProjectionR*finalWorld*vec4(positionUpdated,1.0);
}
#else
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#endif
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uv;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
if (vSpecularInfos.x == 0.)
{
vSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));
}
else
{
vSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#include<bumpVertex>
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#ifdef VERTEXCOLOR

vColor=color;
#endif
#include<pointCloudVertex>
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;z.a.ShadersStore.defaultVertexShader=ea;var ca=l(3);l.d(x,"b",function(){return oa}),l.d(x,"a",function(){return Z});var oa=function(T){function V(){var D=T.call(this)||this;return D.MAINUV1=!1,D.MAINUV2=!1,D.DIFFUSE=!1,D.DIFFUSEDIRECTUV=0,D.AMBIENT=!1,D.AMBIENTDIRECTUV=0,D.OPACITY=!1,D.OPACITYDIRECTUV=0,D.OPACITYRGB=!1,D.REFLECTION=!1,D.EMISSIVE=!1,D.EMISSIVEDIRECTUV=0,D.SPECULAR=!1,D.SPECULARDIRECTUV=0,D.BUMP=!1,D.BUMPDIRECTUV=0,D.PARALLAX=!1,D.PARALLAXOCCLUSION=!1,D.SPECULAROVERALPHA=!1,D.CLIPPLANE=!1,D.CLIPPLANE2=!1,D.CLIPPLANE3=!1,D.CLIPPLANE4=!1,D.ALPHATEST=!1,D.DEPTHPREPASS=!1,D.ALPHAFROMDIFFUSE=!1,D.POINTSIZE=!1,D.FOG=!1,D.SPECULARTERM=!1,D.DIFFUSEFRESNEL=!1,D.OPACITYFRESNEL=!1,D.REFLECTIONFRESNEL=!1,D.REFRACTIONFRESNEL=!1,D.EMISSIVEFRESNEL=!1,D.FRESNEL=!1,D.NORMAL=!1,D.UV1=!1,D.UV2=!1,D.VERTEXCOLOR=!1,D.VERTEXALPHA=!1,D.NUM_BONE_INFLUENCERS=0,D.BonesPerMesh=0,D.BONETEXTURE=!1,D.INSTANCES=!1,D.GLOSSINESS=!1,D.ROUGHNESS=!1,D.EMISSIVEASILLUMINATION=!1,D.LINKEMISSIVEWITHDIFFUSE=!1,D.REFLECTIONFRESNELFROMSPECULAR=!1,D.LIGHTMAP=!1,D.LIGHTMAPDIRECTUV=0,D.OBJECTSPACE_NORMALMAP=!1,D.USELIGHTMAPASSHADOWMAP=!1,D.REFLECTIONMAP_3D=!1,D.REFLECTIONMAP_SPHERICAL=!1,D.REFLECTIONMAP_PLANAR=!1,D.REFLECTIONMAP_CUBIC=!1,D.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,D.REFLECTIONMAP_PROJECTION=!1,D.REFLECTIONMAP_SKYBOX=!1,D.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,D.REFLECTIONMAP_EXPLICIT=!1,D.REFLECTIONMAP_EQUIRECTANGULAR=!1,D.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,D.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,D.INVERTCUBICMAP=!1,D.LOGARITHMICDEPTH=!1,D.REFRACTION=!1,D.REFRACTIONMAP_3D=!1,D.REFLECTIONOVERALPHA=!1,D.TWOSIDEDLIGHTING=!1,D.SHADOWFLOAT=!1,D.MORPHTARGETS=!1,D.MORPHTARGETS_NORMAL=!1,D.MORPHTARGETS_TANGENT=!1,D.NUM_MORPH_INFLUENCERS=0,D.NONUNIFORMSCALING=!1,D.PREMULTIPLYALPHA=!1,D.IMAGEPROCESSING=!1,D.VIGNETTE=!1,D.VIGNETTEBLENDMODEMULTIPLY=!1,D.VIGNETTEBLENDMODEOPAQUE=!1,D.TONEMAPPING=!1,D.TONEMAPPING_ACES=!1,D.CONTRAST=!1,D.COLORCURVES=!1,D.COLORGRADING=!1,D.COLORGRADING3D=!1,D.SAMPLER3DGREENDEPTH=!1,D.SAMPLER3DBGRMAP=!1,D.IMAGEPROCESSINGPOSTPROCESS=!1,D.MULTIVIEW=!1,D.IS_REFLECTION_LINEAR=!1,D.IS_REFRACTION_LINEAR=!1,D.EXPOSURE=!1,D.rebuild(),D}return O.d(V,T),V.prototype.setReflectionMode=function(D){for(var F=0,L=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];F<L.length;F++){var N=L[F];this[N]=N===D}},V}(u.a),Z=function(T){function V(D,F){var L=T.call(this,D,F)||this;return L._diffuseTexture=null,L._ambientTexture=null,L._opacityTexture=null,L._reflectionTexture=null,L._emissiveTexture=null,L._specularTexture=null,L._bumpTexture=null,L._lightmapTexture=null,L._refractionTexture=null,L.ambientColor=new H.e(0,0,0),L.diffuseColor=new H.e(1,1,1),L.specularColor=new H.e(1,1,1),L.emissiveColor=new H.e(0,0,0),L.specularPower=64,L._useAlphaFromDiffuseTexture=!1,L._useEmissiveAsIllumination=!1,L._linkEmissiveWithDiffuse=!1,L._useSpecularOverAlpha=!1,L._useReflectionOverAlpha=!1,L._disableLighting=!1,L._useObjectSpaceNormalMap=!1,L._useParallax=!1,L._useParallaxOcclusion=!1,L.parallaxScaleBias=.05,L._roughness=0,L.indexOfRefraction=.98,L.invertRefractionY=!0,L.alphaCutOff=.4,L._useLightmapAsShadowmap=!1,L._useReflectionFresnelFromSpecular=!1,L._useGlossinessFromSpecularMapAlpha=!1,L._maxSimultaneousLights=4,L._invertNormalMapX=!1,L._invertNormalMapY=!1,L._twoSidedLighting=!1,L._renderTargets=new j.a(16),L._worldViewProjectionMatrix=H.j.Zero(),L._globalAmbientColor=new H.e(0,0,0),L._attachImageProcessingConfiguration(null),L.getRenderTargetTextures=function(){return L._renderTargets.reset(),V.ReflectionTextureEnabled&&L._reflectionTexture&&L._reflectionTexture.isRenderTarget&&L._renderTargets.push(L._reflectionTexture),V.RefractionTextureEnabled&&L._refractionTexture&&L._refractionTexture.isRenderTarget&&L._renderTargets.push(L._refractionTexture),L._renderTargets},L}return O.d(V,T),Object.defineProperty(V.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(D){this._attachImageProcessingConfiguration(D),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),V.prototype._attachImageProcessingConfiguration=function(D){var F=this;D!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=D||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){F._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(V.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(D){this.imageProcessingConfiguration.colorCurvesEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(D){this.imageProcessingConfiguration.colorGradingEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(D){this._imageProcessingConfiguration.toneMappingEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(D){this._imageProcessingConfiguration.exposure=D},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(D){this._imageProcessingConfiguration.contrast=D},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(D){this._imageProcessingConfiguration.colorGradingTexture=D},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(D){this._imageProcessingConfiguration.colorCurves=D},enumerable:!0,configurable:!0}),Object.defineProperty(V.prototype,"hasRenderTargetTextures",{get:function(){return!!(V.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(V.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),V.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(V.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(D){this._useLogarithmicDepth=D&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),V.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},V.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},V.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},V.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},V.prototype.isReadyForSubMesh=function(D,F,L){if(void 0===L&&(L=!1),F.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;F._materialDefines||(F._materialDefines=new oa());var N=this.getScene(),p=F._materialDefines;if(!this.checkReadyOnEveryCall&&F.effect&&p._renderId===N.getRenderId())return!0;var g=N.getEngine();if(p._needNormals=y.a.PrepareDefinesForLights(N,D,p,!0,this._maxSimultaneousLights,this._disableLighting),y.a.PrepareDefinesForMultiview(N,p),p._areTexturesDirty){if(p._needUVs=!1,p.MAINUV1=!1,p.MAINUV2=!1,N.texturesEnabled){if(this._diffuseTexture&&V.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._diffuseTexture,p,"DIFFUSE")}else p.DIFFUSE=!1;if(this._ambientTexture&&V.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._ambientTexture,p,"AMBIENT")}else p.AMBIENT=!1;if(this._opacityTexture&&V.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._opacityTexture,p,"OPACITY"),p.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else p.OPACITY=!1;if(this._reflectionTexture&&V.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(p._needNormals=!0,p.REFLECTION=!0,p.ROUGHNESS=this._roughness>0,p.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,p.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===r.a.INVCUBIC_MODE,p.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case r.a.EXPLICIT_MODE:p.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case r.a.PLANAR_MODE:p.setReflectionMode("REFLECTIONMAP_PLANAR");break;case r.a.PROJECTION_MODE:p.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case r.a.SKYBOX_MODE:p.setReflectionMode("REFLECTIONMAP_SKYBOX"),p.REFLECTIONMAP_SKYBOX_TRANSFORMED=!this._reflectionTexture.getReflectionTextureMatrix().isIdentity();break;case r.a.SPHERICAL_MODE:p.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case r.a.EQUIRECTANGULAR_MODE:p.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case r.a.FIXED_EQUIRECTANGULAR_MODE:p.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case r.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:p.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case r.a.CUBIC_MODE:case r.a.INVCUBIC_MODE:default:p.setReflectionMode("REFLECTIONMAP_CUBIC")}p.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else p.REFLECTION=!1;if(this._emissiveTexture&&V.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._emissiveTexture,p,"EMISSIVE")}else p.EMISSIVE=!1;if(this._lightmapTexture&&V.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._lightmapTexture,p,"LIGHTMAP"),p.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else p.LIGHTMAP=!1;if(this._specularTexture&&V.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._specularTexture,p,"SPECULAR"),p.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else p.SPECULAR=!1;if(N.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&V.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;y.a.PrepareDefinesForMergedUV(this._bumpTexture,p,"BUMP"),p.PARALLAX=this._useParallax,p.PARALLAXOCCLUSION=this._useParallaxOcclusion,p.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else p.BUMP=!1;if(this._refractionTexture&&V.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;p._needUVs=!0,p.REFRACTION=!0,p.REFRACTIONMAP_3D=this._refractionTexture.isCube}else p.REFRACTION=!1;p.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else p.DIFFUSE=!1,p.AMBIENT=!1,p.OPACITY=!1,p.REFLECTION=!1,p.EMISSIVE=!1,p.LIGHTMAP=!1,p.BUMP=!1,p.REFRACTION=!1;p.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),p.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,p.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,p.SPECULAROVERALPHA=this._useSpecularOverAlpha,p.PREMULTIPLYALPHA=this.alphaMode===ca.a.ALPHA_PREMULTIPLIED||this.alphaMode===ca.a.ALPHA_PREMULTIPLIED_PORTERDUFF}if(p._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(p),p.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,p.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(p._areFresnelDirty&&(V.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(p.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,p.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,p.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,p.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,p.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,p.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,p._needNormals=!0,p.FRESNEL=!0):p.FRESNEL=!1),y.a.PrepareDefinesForMisc(D,N,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(D),p),y.a.PrepareDefinesForAttributes(D,p,!0,!0,!0),y.a.PrepareDefinesForFrameBoundValues(N,g,p,L),p.isDirty){p.markAsProcessed();var n=new z.c();p.REFLECTION&&n.addFallback(0,"REFLECTION"),p.SPECULAR&&n.addFallback(0,"SPECULAR"),p.BUMP&&n.addFallback(0,"BUMP"),p.PARALLAX&&n.addFallback(1,"PARALLAX"),p.PARALLAXOCCLUSION&&n.addFallback(0,"PARALLAXOCCLUSION"),p.SPECULAROVERALPHA&&n.addFallback(0,"SPECULAROVERALPHA"),p.FOG&&n.addFallback(1,"FOG"),p.POINTSIZE&&n.addFallback(0,"POINTSIZE"),p.LOGARITHMICDEPTH&&n.addFallback(0,"LOGARITHMICDEPTH"),y.a.HandleFallbacksForShadows(p,n,this._maxSimultaneousLights),p.SPECULARTERM&&n.addFallback(0,"SPECULARTERM"),p.DIFFUSEFRESNEL&&n.addFallback(1,"DIFFUSEFRESNEL"),p.OPACITYFRESNEL&&n.addFallback(2,"OPACITYFRESNEL"),p.REFLECTIONFRESNEL&&n.addFallback(3,"REFLECTIONFRESNEL"),p.EMISSIVEFRESNEL&&n.addFallback(4,"EMISSIVEFRESNEL"),p.FRESNEL&&n.addFallback(4,"FRESNEL"),p.MULTIVIEW&&n.addFallback(0,"MULTIVIEW");var s=[A.b.PositionKind];p.NORMAL&&s.push(A.b.NormalKind),p.UV1&&s.push(A.b.UVKind),p.UV2&&s.push(A.b.UV2Kind),p.VERTEXCOLOR&&s.push(A.b.ColorKind),y.a.PrepareAttributesForBones(s,D,p,n),y.a.PrepareAttributesForInstances(s,p),y.a.PrepareAttributesForMorphTargets(s,D,p);var t="default",C=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],J=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],Q=["Material","Scene"];v.a&&(v.a.PrepareUniforms(C,p),v.a.PrepareSamplers(J,p)),y.a.PrepareUniformsAndSamplersList({uniformsNames:C,uniformBuffersNames:Q,samplers:J,defines:p,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(t=this.customShaderNameResolve(t,C,Q,J,p));var $=p.toString(),aa=F.effect,ba=N.getEngine().createEffect(t,{attributes:s,uniformsNames:C,uniformBuffersNames:Q,samplers:J,defines:$,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:p.NUM_MORPH_INFLUENCERS}},g);ba&&(this.allowShaderHotSwapping&&aa&&!ba.isReady()?(ba=aa,p.markAsUnprocessed()):(N.resetCachedMaterial(),F.setEffect(ba,p),this.buildUniformLayout()))}return!(!F.effect||!F.effect.isReady())&&(p._renderId=N.getRenderId(),this._wasPreviouslyReady=!0,!0)},V.prototype.buildUniformLayout=function(){var D=this._uniformBuffer;D.addUniform("diffuseLeftColor",4),D.addUniform("diffuseRightColor",4),D.addUniform("opacityParts",4),D.addUniform("reflectionLeftColor",4),D.addUniform("reflectionRightColor",4),D.addUniform("refractionLeftColor",4),D.addUniform("refractionRightColor",4),D.addUniform("emissiveLeftColor",4),D.addUniform("emissiveRightColor",4),D.addUniform("vDiffuseInfos",2),D.addUniform("vAmbientInfos",2),D.addUniform("vOpacityInfos",2),D.addUniform("vReflectionInfos",2),D.addUniform("vReflectionPosition",3),D.addUniform("vReflectionSize",3),D.addUniform("vEmissiveInfos",2),D.addUniform("vLightmapInfos",2),D.addUniform("vSpecularInfos",2),D.addUniform("vBumpInfos",3),D.addUniform("diffuseMatrix",16),D.addUniform("ambientMatrix",16),D.addUniform("opacityMatrix",16),D.addUniform("reflectionMatrix",16),D.addUniform("emissiveMatrix",16),D.addUniform("lightmapMatrix",16),D.addUniform("specularMatrix",16),D.addUniform("bumpMatrix",16),D.addUniform("vTangentSpaceParams",2),D.addUniform("pointSize",1),D.addUniform("refractionMatrix",16),D.addUniform("vRefractionInfos",4),D.addUniform("vSpecularColor",4),D.addUniform("vEmissiveColor",3),D.addUniform("visibility",1),D.addUniform("vDiffuseColor",4),D.create()},V.prototype.unbind=function(){if(this._activeEffect){var D=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),D=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),D=!0),D&&this._markAllSubMeshesAsTexturesDirty()}T.prototype.unbind.call(this)},V.prototype.bindForSubMesh=function(D,F,L){var N=this.getScene(),p=L._materialDefines;if(p){var g=L.effect;if(g){this._activeEffect=g,p.INSTANCES||this.bindOnlyWorldMatrix(D),p.OBJECTSPACE_NORMALMAP&&(D.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var n=this._mustRebind(N,g,F.visibility);y.a.BindBonesParameters(F,g);var s=this._uniformBuffer;if(n){if(s.bindToEffect(g,"Material"),this.bindViewProjection(g),!s.useUbo||!this.isFrozen||!s.isSync){if(V.FresnelEnabled&&p.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(s.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),s.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&s.updateColor4("opacityParts",new H.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(s.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),s.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(s.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),s.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(s.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),s.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),N.texturesEnabled){if(this._diffuseTexture&&V.DiffuseTextureEnabled&&(s.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),y.a.BindTextureMatrix(this._diffuseTexture,s,"diffuse"),this._diffuseTexture.hasAlpha&&g.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&V.AmbientTextureEnabled&&(s.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),y.a.BindTextureMatrix(this._ambientTexture,s,"ambient")),this._opacityTexture&&V.OpacityTextureEnabled&&(s.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),y.a.BindTextureMatrix(this._opacityTexture,s,"opacity")),this._reflectionTexture&&V.ReflectionTextureEnabled&&(s.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),s.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var t=this._reflectionTexture;s.updateVector3("vReflectionPosition",t.boundingBoxPosition),s.updateVector3("vReflectionSize",t.boundingBoxSize)}if(this._emissiveTexture&&V.EmissiveTextureEnabled&&(s.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),y.a.BindTextureMatrix(this._emissiveTexture,s,"emissive")),this._lightmapTexture&&V.LightmapTextureEnabled&&(s.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),y.a.BindTextureMatrix(this._lightmapTexture,s,"lightmap")),this._specularTexture&&V.SpecularTextureEnabled&&(s.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),y.a.BindTextureMatrix(this._specularTexture,s,"specular")),this._bumpTexture&&N.getEngine().getCaps().standardDerivatives&&V.BumpTextureEnabled&&(s.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),y.a.BindTextureMatrix(this._bumpTexture,s,"bump"),N._mirroredCameraPosition?s.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):s.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&V.RefractionTextureEnabled){var C=1;this._refractionTexture.isCube||(s.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(C=this._refractionTexture.depth)),s.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,C,this.invertRefractionY?-1:1)}}this.pointsCloud&&s.updateFloat("pointSize",this.pointSize),p.SPECULARTERM&&s.updateColor4("vSpecularColor",this.specularColor,this.specularPower),s.updateColor3("vEmissiveColor",V.EmissiveTextureEnabled?this.emissiveColor:H.e.BlackReadOnly),s.updateFloat("visibility",F.visibility),s.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}N.texturesEnabled&&(this._diffuseTexture&&V.DiffuseTextureEnabled&&g.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&V.AmbientTextureEnabled&&g.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&V.OpacityTextureEnabled&&g.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&V.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?g.setTexture("reflectionCubeSampler",this._reflectionTexture):g.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&V.EmissiveTextureEnabled&&g.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&V.LightmapTextureEnabled&&g.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&V.SpecularTextureEnabled&&g.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&N.getEngine().getCaps().standardDerivatives&&V.BumpTextureEnabled&&g.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&V.RefractionTextureEnabled)&&(C=1,this._refractionTexture.isCube?g.setTexture("refractionCubeSampler",this._refractionTexture):g.setTexture("refraction2DSampler",this._refractionTexture)),y.a.BindClipPlane(g,N),N.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),y.a.BindEyePosition(g,N),g.setColor3("vAmbientColor",this._globalAmbientColor)}!n&&this.isFrozen||(N.lightsEnabled&&!this._disableLighting&&y.a.BindLights(N,F,g,p,this._maxSimultaneousLights),(N.fogEnabled&&F.applyFog&&N.fogMode!==I.a.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(g),y.a.BindFogParameters(N,F,g),p.NUM_MORPH_INFLUENCERS&&y.a.BindMorphTargetParameters(F,g),y.a.BindLogDepth(p,g,N),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),s.update(),this._afterBind(F,this._activeEffect)}}},V.prototype.getAnimatables=function(){var D=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&D.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&D.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&D.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&D.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&D.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&D.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&D.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&D.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&D.push(this._refractionTexture),D},V.prototype.getActiveTextures=function(){var D=T.prototype.getActiveTextures.call(this);return this._diffuseTexture&&D.push(this._diffuseTexture),this._ambientTexture&&D.push(this._ambientTexture),this._opacityTexture&&D.push(this._opacityTexture),this._reflectionTexture&&D.push(this._reflectionTexture),this._emissiveTexture&&D.push(this._emissiveTexture),this._specularTexture&&D.push(this._specularTexture),this._bumpTexture&&D.push(this._bumpTexture),this._lightmapTexture&&D.push(this._lightmapTexture),this._refractionTexture&&D.push(this._refractionTexture),D},V.prototype.hasTexture=function(D){return!!T.prototype.hasTexture.call(this,D)||(this._diffuseTexture===D||(this._ambientTexture===D||(this._opacityTexture===D||(this._reflectionTexture===D||(this._emissiveTexture===D||(this._specularTexture===D||(this._bumpTexture===D||(this._lightmapTexture===D||this._refractionTexture===D))))))))},V.prototype.dispose=function(D,F){F&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),T.prototype.dispose.call(this,D,F)},V.prototype.clone=function(D){var F=this,L=q.a.Clone(function(){return new V(D,F.getScene())},this);return L.name=D,L.id=D,L},V.prototype.serialize=function(){return q.a.Serialize(this)},V.Parse=function(D,F,L){return q.a.Parse(function(){return new V(D.name,F)},D,F,L)},Object.defineProperty(V,"DiffuseTextureEnabled",{get:function(){return G.a.DiffuseTextureEnabled},set:function(D){G.a.DiffuseTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V,"AmbientTextureEnabled",{get:function(){return G.a.AmbientTextureEnabled},set:function(D){G.a.AmbientTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V,"OpacityTextureEnabled",{get:function(){return G.a.OpacityTextureEnabled},set:function(D){G.a.OpacityTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V,"ReflectionTextureEnabled",{get:function(){return G.a.ReflectionTextureEnabled},set:function(D){G.a.ReflectionTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V,"EmissiveTextureEnabled",{get:function(){return G.a.EmissiveTextureEnabled},set:function(D){G.a.EmissiveTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V,"SpecularTextureEnabled",{get:function(){return G.a.SpecularTextureEnabled},set:function(D){G.a.SpecularTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V,"BumpTextureEnabled",{get:function(){return G.a.BumpTextureEnabled},set:function(D){G.a.BumpTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V,"LightmapTextureEnabled",{get:function(){return G.a.LightmapTextureEnabled},set:function(D){G.a.LightmapTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V,"RefractionTextureEnabled",{get:function(){return G.a.RefractionTextureEnabled},set:function(D){G.a.RefractionTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V,"ColorGradingTextureEnabled",{get:function(){return G.a.ColorGradingTextureEnabled},set:function(D){G.a.ColorGradingTextureEnabled=D},enumerable:!0,configurable:!0}),Object.defineProperty(V,"FresnelEnabled",{get:function(){return G.a.FresnelEnabled},set:function(D){G.a.FresnelEnabled=D},enumerable:!0,configurable:!0}),O.c([Object(q.m)("diffuseTexture")],V.prototype,"_diffuseTexture",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],V.prototype,"diffuseTexture",void 0),O.c([Object(q.m)("ambientTexture")],V.prototype,"_ambientTexture",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"ambientTexture",void 0),O.c([Object(q.m)("opacityTexture")],V.prototype,"_opacityTexture",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],V.prototype,"opacityTexture",void 0),O.c([Object(q.m)("reflectionTexture")],V.prototype,"_reflectionTexture",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectionTexture",void 0),O.c([Object(q.m)("emissiveTexture")],V.prototype,"_emissiveTexture",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"emissiveTexture",void 0),O.c([Object(q.m)("specularTexture")],V.prototype,"_specularTexture",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"specularTexture",void 0),O.c([Object(q.m)("bumpTexture")],V.prototype,"_bumpTexture",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"bumpTexture",void 0),O.c([Object(q.m)("lightmapTexture")],V.prototype,"_lightmapTexture",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"lightmapTexture",void 0),O.c([Object(q.m)("refractionTexture")],V.prototype,"_refractionTexture",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"refractionTexture",void 0),O.c([Object(q.e)("ambient")],V.prototype,"ambientColor",void 0),O.c([Object(q.e)("diffuse")],V.prototype,"diffuseColor",void 0),O.c([Object(q.e)("specular")],V.prototype,"specularColor",void 0),O.c([Object(q.e)("emissive")],V.prototype,"emissiveColor",void 0),O.c([Object(q.c)()],V.prototype,"specularPower",void 0),O.c([Object(q.c)("useAlphaFromDiffuseTexture")],V.prototype,"_useAlphaFromDiffuseTexture",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useAlphaFromDiffuseTexture",void 0),O.c([Object(q.c)("useEmissiveAsIllumination")],V.prototype,"_useEmissiveAsIllumination",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useEmissiveAsIllumination",void 0),O.c([Object(q.c)("linkEmissiveWithDiffuse")],V.prototype,"_linkEmissiveWithDiffuse",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"linkEmissiveWithDiffuse",void 0),O.c([Object(q.c)("useSpecularOverAlpha")],V.prototype,"_useSpecularOverAlpha",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useSpecularOverAlpha",void 0),O.c([Object(q.c)("useReflectionOverAlpha")],V.prototype,"_useReflectionOverAlpha",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useReflectionOverAlpha",void 0),O.c([Object(q.c)("disableLighting")],V.prototype,"_disableLighting",void 0),O.c([Object(q.b)("_markAllSubMeshesAsLightsDirty")],V.prototype,"disableLighting",void 0),O.c([Object(q.c)("useObjectSpaceNormalMap")],V.prototype,"_useObjectSpaceNormalMap",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useObjectSpaceNormalMap",void 0),O.c([Object(q.c)("useParallax")],V.prototype,"_useParallax",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useParallax",void 0),O.c([Object(q.c)("useParallaxOcclusion")],V.prototype,"_useParallaxOcclusion",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useParallaxOcclusion",void 0),O.c([Object(q.c)()],V.prototype,"parallaxScaleBias",void 0),O.c([Object(q.c)("roughness")],V.prototype,"_roughness",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"roughness",void 0),O.c([Object(q.c)()],V.prototype,"indexOfRefraction",void 0),O.c([Object(q.c)()],V.prototype,"invertRefractionY",void 0),O.c([Object(q.c)()],V.prototype,"alphaCutOff",void 0),O.c([Object(q.c)("useLightmapAsShadowmap")],V.prototype,"_useLightmapAsShadowmap",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useLightmapAsShadowmap",void 0),O.c([Object(q.h)("diffuseFresnelParameters")],V.prototype,"_diffuseFresnelParameters",void 0),O.c([Object(q.b)("_markAllSubMeshesAsFresnelDirty")],V.prototype,"diffuseFresnelParameters",void 0),O.c([Object(q.h)("opacityFresnelParameters")],V.prototype,"_opacityFresnelParameters",void 0),O.c([Object(q.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],V.prototype,"opacityFresnelParameters",void 0),O.c([Object(q.h)("reflectionFresnelParameters")],V.prototype,"_reflectionFresnelParameters",void 0),O.c([Object(q.b)("_markAllSubMeshesAsFresnelDirty")],V.prototype,"reflectionFresnelParameters",void 0),O.c([Object(q.h)("refractionFresnelParameters")],V.prototype,"_refractionFresnelParameters",void 0),O.c([Object(q.b)("_markAllSubMeshesAsFresnelDirty")],V.prototype,"refractionFresnelParameters",void 0),O.c([Object(q.h)("emissiveFresnelParameters")],V.prototype,"_emissiveFresnelParameters",void 0),O.c([Object(q.b)("_markAllSubMeshesAsFresnelDirty")],V.prototype,"emissiveFresnelParameters",void 0),O.c([Object(q.c)("useReflectionFresnelFromSpecular")],V.prototype,"_useReflectionFresnelFromSpecular",void 0),O.c([Object(q.b)("_markAllSubMeshesAsFresnelDirty")],V.prototype,"useReflectionFresnelFromSpecular",void 0),O.c([Object(q.c)("useGlossinessFromSpecularMapAlpha")],V.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useGlossinessFromSpecularMapAlpha",void 0),O.c([Object(q.c)("maxSimultaneousLights")],V.prototype,"_maxSimultaneousLights",void 0),O.c([Object(q.b)("_markAllSubMeshesAsLightsDirty")],V.prototype,"maxSimultaneousLights",void 0),O.c([Object(q.c)("invertNormalMapX")],V.prototype,"_invertNormalMapX",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"invertNormalMapX",void 0),O.c([Object(q.c)("invertNormalMapY")],V.prototype,"_invertNormalMapY",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"invertNormalMapY",void 0),O.c([Object(q.c)("twoSidedLighting")],V.prototype,"_twoSidedLighting",void 0),O.c([Object(q.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"twoSidedLighting",void 0),O.c([Object(q.c)()],V.prototype,"useLogarithmicDepth",null),V}(w.a);o.a.RegisteredTypes["BABYLON.StandardMaterial"]=Z,I.a.DefaultMaterialFactory=function(T){return new Z("default material",T)}},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return q.BuildArray=function(j,I){for(var H=[],A=0;A<j;++A)H.push(I());return H},q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return q.IsWindowObjectExist=function(){return"undefined"!=typeof window},q.GetDOMTextContent=function(j){for(var I="",H=j.firstChild;H;)3===H.nodeType&&(I+=H.textContent),H=H.nextSibling;return I},q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(j,I,H,A,v,z){this.source=j,this.pointerX=I,this.pointerY=H,this.meshUnderPointer=A,this.sourceEvent=v,this.additionalData=z}return q.CreateNew=function(j,I,H){var A=j.getScene();return new q(j,A.pointerX,A.pointerY,A.meshUnderPointer||j,I,H)},q.CreateNewFromSprite=function(j,I,H,A){return new q(j,I.pointerX,I.pointerY,I.meshUnderPointer,H,A)},q.CreateNewFromScene=function(j,I){return new q(null,j.pointerX,j.pointerY,j.meshUnderPointer,I)},q.CreateNewFromPrimitive=function(j,I,H,A){return new q(j,I.x,I.y,null,H,A)},q}()},function(Aa,x,l){"use strict";l.d(x,"e",function(){return q}),l.d(x,"a",function(){return j}),l.d(x,"d",function(){return I}),l.d(x,"c",function(){return H}),l.d(x,"b",function(){return A});var O=l(1),q=function(){function v(z,u){this.type=z,this.jointData=u,u.nativeParams=u.nativeParams||{}}return Object.defineProperty(v.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(z){this._physicsJoint,this._physicsJoint=z},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"physicsPlugin",{set:function(z){this._physicsPlugin=z},enumerable:!0,configurable:!0}),v.prototype.executeNativeFunction=function(z){z(this._physicsPlugin.world,this._physicsJoint)},v.DistanceJoint=0,v.HingeJoint=1,v.BallAndSocketJoint=2,v.WheelJoint=3,v.SliderJoint=4,v.PrismaticJoint=5,v.UniversalJoint=6,v.Hinge2Joint=v.WheelJoint,v.PointToPointJoint=8,v.SpringJoint=9,v.LockJoint=10,v}(),j=function(v){function z(u){return v.call(this,q.DistanceJoint,u)||this}return O.d(z,v),z.prototype.updateDistance=function(u,w){this._physicsPlugin.updateDistanceJoint(this,u,w)},z}(q),I=function(v){function z(u,w){return v.call(this,u,w)||this}return O.d(z,v),z.prototype.setMotor=function(u,w){this._physicsPlugin.setMotor(this,u||0,w)},z.prototype.setLimit=function(u,w){this._physicsPlugin.setLimit(this,u,w)},z}(q),H=function(v){function z(u){return v.call(this,q.HingeJoint,u)||this}return O.d(z,v),z.prototype.setMotor=function(u,w){this._physicsPlugin.setMotor(this,u||0,w)},z.prototype.setLimit=function(u,w){this._physicsPlugin.setLimit(this,u,w)},z}(I),A=function(v){function z(u){return v.call(this,q.Hinge2Joint,u)||this}return O.d(z,v),z.prototype.setMotor=function(u,w,y){void 0===y&&(y=0),this._physicsPlugin.setMotor(this,u||0,w,y)},z.prototype.setLimit=function(u,w,y){void 0===y&&(y=0),this._physicsPlugin.setLimit(this,u,w,y)},z}(I)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return v});var O=l(1),q=l(2),j=l(0),I=l(25),H=l(63),A=l(22),v=function(z){function u(w,y){var r=z.call(this,w,y)||this;return r.diffuse=new j.e(1,1,1),r.specular=new j.e(1,1,1),r.falloffType=u.FALLOFF_DEFAULT,r.intensity=1,r._range=Number.MAX_VALUE,r._inverseSquaredRange=0,r._photometricScale=1,r._intensityMode=u.INTENSITYMODE_AUTOMATIC,r._radius=1e-05,r.renderPriority=0,r._shadowEnabled=!0,r._excludeWithLayerMask=0,r._includeOnlyWithLayerMask=0,r._lightmapMode=0,r._excludedMeshesIds=new Array(),r._includedOnlyMeshesIds=new Array(),r._isLight=!0,r.getScene().addLight(r),r._uniformBuffer=new H.a(r.getScene().getEngine()),r._buildUniformLayout(),r.includedOnlyMeshes=new Array(),r.excludedMeshes=new Array(),r._resyncMeshes(),r}return O.d(u,z),Object.defineProperty(u.prototype,"range",{get:function(){return this._range},set:function(w){this._range=w,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(w){this._intensityMode=w,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"radius",{get:function(){return this._radius},set:function(w){this._radius=w,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(w){this._shadowEnabled!==w&&(this._shadowEnabled=w,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(w){this._includedOnlyMeshes=w,this._hookArrayForIncludedOnly(w)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(w){this._excludedMeshes=w,this._hookArrayForExcluded(w)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(w){this._excludeWithLayerMask=w,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(w){this._includeOnlyWithLayerMask=w,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(w){this._lightmapMode!==w&&(this._lightmapMode=w,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),u.prototype.getClassName=function(){return"Light"},u.prototype.toString=function(w){var y="Name: "+this.name;if(y+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var r=0;r<this.animations.length;r++)y+=", animation[0]: "+this.animations[r].toString(w);return y},u.prototype._syncParentEnabledState=function(){z.prototype._syncParentEnabledState.call(this),this._resyncMeshes()},u.prototype.setEnabled=function(w){z.prototype.setEnabled.call(this,w),this._resyncMeshes()},u.prototype.getShadowGenerator=function(){return this._shadowGenerator},u.prototype.getAbsolutePosition=function(){return j.x.Zero()},u.prototype.canAffectMesh=function(w){return!w||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(w))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(w))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&w.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&w.layerMask)))},u.CompareLightsPriority=function(w,y){return w.shadowEnabled!==y.shadowEnabled?(y.shadowEnabled?1:0)-(w.shadowEnabled?1:0):y.renderPriority-w.renderPriority},u.prototype.dispose=function(w,y){void 0===y&&(y=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var r=0,o=this.getScene().meshes;r<o.length;r++)o[r]._removeLightSource(this);this._uniformBuffer.dispose(),this.getScene().removeLight(this),z.prototype.dispose.call(this,w,y)},u.prototype.getTypeID=function(){return 0},u.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},u.prototype.clone=function(w){var y=u.GetConstructorFromName(this.getTypeID(),w,this.getScene());return y?q.a.Clone(y,this):null},u.prototype.serialize=function(){var w=q.a.Serialize(this);return w.type=this.getTypeID(),this.parent&&(w.parentId=this.parent.id),this.excludedMeshes.length>0&&(w.excludedMeshesIds=[],this.excludedMeshes.forEach(function(y){w.excludedMeshesIds.push(y.id)})),this.includedOnlyMeshes.length>0&&(w.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(y){w.includedOnlyMeshesIds.push(y.id)})),q.a.AppendSerializedAnimations(this,w),w.ranges=this.serializeAnimationRanges(),w},u.GetConstructorFromName=function(w,y,r){var o=I.a.Construct("Light_Type_"+w,y,r);return o||null},u.Parse=function(w,y){var r=u.GetConstructorFromName(w.type,w.name,y);if(!r)return null;var o=q.a.Parse(r,w,y);if(w.excludedMeshesIds&&(o._excludedMeshesIds=w.excludedMeshesIds),w.includedOnlyMeshesIds&&(o._includedOnlyMeshesIds=w.includedOnlyMeshesIds),w.parentId&&(o._waitingParentId=w.parentId),void 0!==w.falloffType&&(o.falloffType=w.falloffType),void 0!==w.lightmapMode&&(o.lightmapMode=w.lightmapMode),w.animations){for(var G=0;G<w.animations.length;G++){var M=w.animations[G],R=A.a.GetClass("BABYLON.Animation");R&&o.animations.push(R.Parse(M))}I.a.ParseAnimationRanges(o,w,y)}return w.autoAnimate&&y.beginAnimation(o,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),o},u.prototype._hookArrayForExcluded=function(w){var y=this,r=w.push;w.push=function(){for(var R=[],W=0;W<arguments.length;W++)R[W]=arguments[W];for(var Y=r.apply(w,R),X=0,ea=R;X<ea.length;X++)ea[X]._resyncLighSource(y);return Y};var o=w.splice;w.splice=function(R,W){for(var Y=o.apply(w,[R,W]),X=0,ea=Y;X<ea.length;X++)ea[X]._resyncLighSource(y);return Y};for(var G=0,M=w;G<M.length;G++)M[G]._resyncLighSource(this)},u.prototype._hookArrayForIncludedOnly=function(w){var y=this,r=w.push;w.push=function(){for(var G=[],M=0;M<arguments.length;M++)G[M]=arguments[M];var R=r.apply(w,G);return y._resyncMeshes(),R};var o=w.splice;w.splice=function(G,M){var R=o.apply(w,[G,M]);return y._resyncMeshes(),R},this._resyncMeshes()},u.prototype._resyncMeshes=function(){for(var w=0,y=this.getScene().meshes;w<y.length;w++)y[w]._resyncLighSource(this)},u.prototype._markMeshesAsLightDirty=function(){for(var w=0,y=this.getScene().meshes;w<y.length;w++){var r=y[w];-1!==r.lightSources.indexOf(this)&&r._markSubMeshesAsLightDirty()}},u.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},u.prototype._getPhotometricScale=function(){var w=0,y=this.getTypeID(),r=this.intensityMode;switch(r===u.INTENSITYMODE_AUTOMATIC&&(r=y===u.LIGHTTYPEID_DIRECTIONALLIGHT?u.INTENSITYMODE_ILLUMINANCE:u.INTENSITYMODE_LUMINOUSINTENSITY),y){case u.LIGHTTYPEID_POINTLIGHT:case u.LIGHTTYPEID_SPOTLIGHT:switch(r){case u.INTENSITYMODE_LUMINOUSPOWER:w=1/(4*Math.PI);break;case u.INTENSITYMODE_LUMINOUSINTENSITY:w=1;break;case u.INTENSITYMODE_LUMINANCE:w=this.radius*this.radius}break;case u.LIGHTTYPEID_DIRECTIONALLIGHT:switch(r){case u.INTENSITYMODE_ILLUMINANCE:w=1;break;case u.INTENSITYMODE_LUMINANCE:var o=this.radius;o=Math.max(o,.001),w=2*Math.PI*(1-Math.cos(o))}break;case u.LIGHTTYPEID_HEMISPHERICLIGHT:w=1}return w},u.prototype._reorderLightsInScene=function(){var w=this.getScene();0!=this._renderPriority&&(w.requireLightSorting=!0),this.getScene().sortLightsByPriority()},u.FALLOFF_DEFAULT=0,u.FALLOFF_PHYSICAL=1,u.FALLOFF_GLTF=2,u.FALLOFF_STANDARD=3,u.LIGHTMAP_DEFAULT=0,u.LIGHTMAP_SPECULAR=1,u.LIGHTMAP_SHADOWSONLY=2,u.INTENSITYMODE_AUTOMATIC=0,u.INTENSITYMODE_LUMINOUSPOWER=1,u.INTENSITYMODE_LUMINOUSINTENSITY=2,u.INTENSITYMODE_ILLUMINANCE=3,u.INTENSITYMODE_LUMINANCE=4,u.LIGHTTYPEID_POINTLIGHT=0,u.LIGHTTYPEID_DIRECTIONALLIGHT=1,u.LIGHTTYPEID_SPOTLIGHT=2,u.LIGHTTYPEID_HEMISPHERICLIGHT=3,O.c([Object(q.e)()],u.prototype,"diffuse",void 0),O.c([Object(q.e)()],u.prototype,"specular",void 0),O.c([Object(q.c)()],u.prototype,"falloffType",void 0),O.c([Object(q.c)()],u.prototype,"intensity",void 0),O.c([Object(q.c)()],u.prototype,"range",null),O.c([Object(q.c)()],u.prototype,"intensityMode",null),O.c([Object(q.c)()],u.prototype,"radius",null),O.c([Object(q.c)()],u.prototype,"_renderPriority",void 0),O.c([Object(q.b)("_reorderLightsInScene")],u.prototype,"renderPriority",void 0),O.c([Object(q.c)("shadowEnabled")],u.prototype,"_shadowEnabled",void 0),O.c([Object(q.c)("excludeWithLayerMask")],u.prototype,"_excludeWithLayerMask",void 0),O.c([Object(q.c)("includeOnlyWithLayerMask")],u.prototype,"_includeOnlyWithLayerMask",void 0),O.c([Object(q.c)("lightmapMode")],u.prototype,"_lightmapMode",void 0),u}(I.a)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return v});var O=l(34),q=l(0),j=l(50),I=l(81),H=l(16),A=l(21),v=function(){function z(u,w,y){void 0===y&&(y=Number.MAX_VALUE),this.origin=u,this.direction=w,this.length=y}return z.prototype.intersectsBoxMinMax=function(u,w,y){void 0===y&&(y=0);var r,o,G,M,R=z.TmpVector3[0].copyFromFloats(u.x-y,u.y-y,u.z-y),W=z.TmpVector3[1].copyFromFloats(w.x+y,w.y+y,w.z+y),Y=0,X=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-07){if(this.origin.x<R.x||this.origin.x>W.x)return!1}else if(r=1/this.direction.x,o=(R.x-this.origin.x)*r,(G=(W.x-this.origin.x)*r)===-1/0&&(G=1/0),o>G&&(M=o,o=G,G=M),(Y=Math.max(o,Y))>(X=Math.min(G,X)))return!1;if(Math.abs(this.direction.y)<1e-07){if(this.origin.y<R.y||this.origin.y>W.y)return!1}else if(r=1/this.direction.y,o=(R.y-this.origin.y)*r,(G=(W.y-this.origin.y)*r)===-1/0&&(G=1/0),o>G&&(M=o,o=G,G=M),(Y=Math.max(o,Y))>(X=Math.min(G,X)))return!1;if(Math.abs(this.direction.z)<1e-07){if(this.origin.z<R.z||this.origin.z>W.z)return!1}else if(r=1/this.direction.z,o=(R.z-this.origin.z)*r,(G=(W.z-this.origin.z)*r)===-1/0&&(G=1/0),o>G&&(M=o,o=G,G=M),(Y=Math.max(o,Y))>(X=Math.min(G,X)))return!1;return!0},z.prototype.intersectsBox=function(u,w){return void 0===w&&(w=0),this.intersectsBoxMinMax(u.minimum,u.maximum,w)},z.prototype.intersectsSphere=function(u,w){void 0===w&&(w=0);var y=u.center.x-this.origin.x,r=u.center.y-this.origin.y,o=u.center.z-this.origin.z,G=y*y+r*r+o*o,M=u.radius+w,R=M*M;if(G<=R)return!0;var W=y*this.direction.x+r*this.direction.y+o*this.direction.z;return!(W<0)&&G-W*W<=R},z.prototype.intersectsTriangle=function(u,w,y){var r=z.TmpVector3[0],o=z.TmpVector3[1],G=z.TmpVector3[2],M=z.TmpVector3[3],R=z.TmpVector3[4];w.subtractToRef(u,r),y.subtractToRef(u,o),q.x.CrossToRef(this.direction,o,G);var W=q.x.Dot(r,G);if(0===W)return null;var Y=1/W;this.origin.subtractToRef(u,M);var X=q.x.Dot(M,G)*Y;if(X<0||X>1)return null;q.x.CrossToRef(M,r,R);var ea=q.x.Dot(this.direction,R)*Y;if(ea<0||X+ea>1)return null;var ca=q.x.Dot(o,R)*Y;return ca>this.length?null:new I.a(X,ea,ca)},z.prototype.intersectsPlane=function(u){var w,y=q.x.Dot(u.normal,this.direction);if(Math.abs(y)<9.99999997475243e-07)return null;var r=q.x.Dot(u.normal,this.origin);return(w=(-u.d-r)/y)<0?w<-9.99999997475243e-07?null:0:w},z.prototype.intersectsMesh=function(u,w){var y=q.t.Matrix[0];return u.getWorldMatrix().invertToRef(y),this._tmpRay?z.TransformToRef(this,y,this._tmpRay):this._tmpRay=z.Transform(this,y),u.intersects(this._tmpRay,w)},z.prototype.intersectsMeshes=function(u,w,y){y?y.length=0:y=[];for(var r=0;r<u.length;r++){var o=this.intersectsMesh(u[r],w);o.hit&&y.push(o)}return y.sort(this._comparePickingInfo),y},z.prototype._comparePickingInfo=function(u,w){return u.distance<w.distance?-1:u.distance>w.distance?1:0},z.prototype.intersectionSegment=function(u,w,y){var r=this.origin,o=q.t.Vector3[0],G=q.t.Vector3[1],M=q.t.Vector3[2],R=q.t.Vector3[3];w.subtractToRef(u,o),this.direction.scaleToRef(z.rayl,M),r.addToRef(M,G),u.subtractToRef(r,R);var W,Y,X,ea,ca=q.x.Dot(o,o),oa=q.x.Dot(o,M),Z=q.x.Dot(M,M),T=q.x.Dot(o,R),V=q.x.Dot(M,R),D=ca*Z-oa*oa,F=D,L=D;D<z.smallnum?(Y=0,F=1,ea=V,L=Z):(ea=ca*V-oa*T,(Y=oa*V-Z*T)<0?(Y=0,ea=V,L=Z):Y>F&&(Y=F,ea=V+oa,L=Z)),ea<0?(ea=0,-T<0?Y=0:-T>ca?Y=F:(Y=-T,F=ca)):ea>L&&(ea=L,-T+oa<0?Y=0:-T+oa>ca?Y=F:(Y=-T+oa,F=ca)),W=Math.abs(Y)<z.smallnum?0:Y/F,X=Math.abs(ea)<z.smallnum?0:ea/L;var N=q.t.Vector3[4];M.scaleToRef(X,N);var p=q.t.Vector3[5];o.scaleToRef(W,p),p.addInPlace(R);var g=q.t.Vector3[6];return p.subtractToRef(N,g),X>0&&X<=this.length&&g.lengthSquared()<y*y?p.length():-1},z.prototype.update=function(u,w,y,r,o,G,M){return this.unprojectRayToRef(u,w,y,r,o,G,M),this},z.Zero=function(){return new z(q.x.Zero(),q.x.Zero())},z.CreateNew=function(u,w,y,r,o,G,M){return z.Zero().update(u,w,y,r,o,G,M)},z.CreateNewFromTo=function(u,w,y){void 0===y&&(y=q.j.IdentityReadOnly);var r=w.subtract(u),o=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),z.Transform(new z(u,r,o),y)},z.Transform=function(u,w){var y=new z(new q.x(0,0,0),new q.x(0,0,0));return z.TransformToRef(u,w,y),y},z.TransformToRef=function(u,w,y){q.x.TransformCoordinatesToRef(u.origin,w,y.origin),q.x.TransformNormalToRef(u.direction,w,y.direction),y.length=u.length;var r=y.direction,o=r.length();if(0!==o&&1!==o){var G=1/o;r.x*=G,r.y*=G,r.z*=G,y.length*=o}},z.prototype.unprojectRayToRef=function(u,w,y,r,o,G,M){var R=q.t.Matrix[0];o.multiplyToRef(G,R),R.multiplyToRef(M,R),R.invert();var W=q.t.Vector3[0];W.x=u/y*2-1,W.y=-(w/r*2-1),W.z=-1;var Y=q.t.Vector3[1].copyFromFloats(W.x,W.y,1),X=q.t.Vector3[2],ea=q.t.Vector3[3];q.x._UnprojectFromInvertedMatrixToRef(W,R,X),q.x._UnprojectFromInvertedMatrixToRef(Y,R,ea),this.origin.copyFrom(X),ea.subtractToRef(X,this.direction),this.direction.normalize()},z.TmpVector3=O.a.BuildArray(6,q.x.Zero),z.smallnum=1e-08,z.rayl=1e09,z}();H.a.prototype.createPickingRay=function(z,u,w,y,r){void 0===r&&(r=!1);var o=v.Zero();return this.createPickingRayToRef(z,u,w,o,y,r),o},H.a.prototype.createPickingRayToRef=function(z,u,w,y,r,o){void 0===o&&(o=!1);var G=this.getEngine();if(!r){if(!this.activeCamera)throw new Error("Active camera not set");r=this.activeCamera}var M=r.viewport.toGlobal(G.getRenderWidth(),G.getRenderHeight());return z=z/G.getHardwareScalingLevel()-M.x,u=u/G.getHardwareScalingLevel()-(G.getRenderHeight()-M.y-M.height),y.update(z,u,M.width,M.height,w||q.j.IdentityReadOnly,o?q.j.IdentityReadOnly:r.getViewMatrix(),r.getProjectionMatrix()),this},H.a.prototype.createPickingRayInCameraSpace=function(z,u,w){var y=v.Zero();return this.createPickingRayInCameraSpaceToRef(z,u,y,w),y},H.a.prototype.createPickingRayInCameraSpaceToRef=function(z,u,w,y){if(!j.a)return this;var r=this.getEngine();if(!y){if(!this.activeCamera)throw new Error("Active camera not set");y=this.activeCamera}var o=y.viewport.toGlobal(r.getRenderWidth(),r.getRenderHeight()),G=q.j.Identity();return z=z/r.getHardwareScalingLevel()-o.x,u=u/r.getHardwareScalingLevel()-(r.getRenderHeight()-o.y-o.height),w.update(z,u,o.width,o.height,G,G,y.getProjectionMatrix()),this},H.a.prototype._internalPick=function(z,u,w,y){if(!j.a)return null;for(var r=null,o=0;o<this.meshes.length;o++){var G=this.meshes[o];if(u){if(!u(G))continue}else if(!G.isEnabled()||!G.isVisible||!G.isPickable)continue;var M=z(G.getWorldMatrix()),R=G.intersects(M,w,y);if(R&&R.hit&&((w||null==r||!(R.distance>=r.distance))&&(r=R,w)))break}return r||new j.a()},H.a.prototype._internalMultiPick=function(z,u,w){if(!j.a)return null;for(var y=new Array(),r=0;r<this.meshes.length;r++){var o=this.meshes[r];if(u){if(!u(o))continue}else if(!o.isEnabled()||!o.isVisible||!o.isPickable)continue;var G=z(o.getWorldMatrix()),M=o.intersects(G,!1,w);M&&M.hit&&y.push(M)}return y},H.a.prototype.pick=function(z,u,w,y,r,o){var G=this;if(!j.a)return null;var M=this._internalPick(function(R){return G._tempPickingRay||(G._tempPickingRay=v.Zero()),G.createPickingRayToRef(z,u,R,G._tempPickingRay,r||null),G._tempPickingRay},w,y,o);return M&&(M.ray=this.createPickingRay(z,u,q.j.Identity(),r||null)),M},H.a.prototype.pickWithRay=function(z,u,w,y){var r=this,o=this._internalPick(function(G){return r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=q.j.Identity()),G.invertToRef(r._pickWithRayInverseMatrix),r._cachedRayForTransform||(r._cachedRayForTransform=v.Zero()),v.TransformToRef(z,r._pickWithRayInverseMatrix,r._cachedRayForTransform),r._cachedRayForTransform},u,w,y);return o&&(o.ray=z),o},H.a.prototype.multiPick=function(z,u,w,y,r){var o=this;return this._internalMultiPick(function(G){return o.createPickingRay(z,u,G,y||null)},w,r)},H.a.prototype.multiPickWithRay=function(z,u,w){var y=this;return this._internalMultiPick(function(r){return y._pickWithRayInverseMatrix||(y._pickWithRayInverseMatrix=q.j.Identity()),r.invertToRef(y._pickWithRayInverseMatrix),y._cachedRayForTransform||(y._cachedRayForTransform=v.Zero()),v.TransformToRef(z,y._pickWithRayInverseMatrix,y._cachedRayForTransform),y._cachedRayForTransform},u,w)},A.a.prototype.getForwardRay=function(z,u,w){void 0===z&&(z=100),u||(u=this.getWorldMatrix()),w||(w=this.position);var y=this._scene.useRightHandedSystem?new q.x(0,0,-1):new q.x(0,0,1),r=q.x.TransformNormal(y,u),o=q.x.Normalize(r);return new v(w,o,z)}},function(Aa,x,l){"use strict";l.d(x,"a",function(){return A});var O=l(0),q=l(11),j=l(13),I=l(72),H=l(4);j.a.CreateLineSystem=function(v){for(var z=[],u=[],w=v.lines,y=v.colors,r=[],o=0,G=0;G<w.length;G++)for(var M=w[G],R=0;R<M.length;R++){if(u.push(M[R].x,M[R].y,M[R].z),y){var W=y[G];r.push(W[R].r,W[R].g,W[R].b,W[R].a)}R>0&&(z.push(o-1),z.push(o)),o++}var Y=new j.a();return Y.indices=z,Y.positions=u,y&&(Y.colors=r),Y},j.a.CreateDashedLines=function(v){var z,u,w=v.dashSize||3,y=v.gapSize||1,r=v.dashNb||200,o=v.points,G=new Array(),M=new Array(),R=O.x.Zero(),W=0,Y=0,X=0,ea=0,ca=0;for(ca=0;ca<o.length-1;ca++)o[ca+1].subtractToRef(o[ca],R),W+=R.length();for(u=w*(z=W/r)/(w+y),ca=0;ca<o.length-1;ca++){o[ca+1].subtractToRef(o[ca],R),Y=Math.floor(R.length()/z),R.normalize();for(var oa=0;oa<Y;oa++)X=z*oa,G.push(o[ca].x+X*R.x,o[ca].y+X*R.y,o[ca].z+X*R.z),G.push(o[ca].x+(X+u)*R.x,o[ca].y+(X+u)*R.y,o[ca].z+(X+u)*R.z),M.push(ea,ea+1),ea+=2}var Z=new j.a();return Z.positions=G,Z.indices=M,Z},q.a.CreateLines=function(v,z,u,w,y){void 0===u&&(u=null),void 0===w&&(w=!1),void 0===y&&(y=null);var r={points:z,updatable:w,instance:y};return A.CreateLines(v,r,u)},q.a.CreateDashedLines=function(v,z,u,w,y,r,o,G){void 0===r&&(r=null);var M={points:z,dashSize:u,gapSize:w,dashNb:y,updatable:o,instance:G};return A.CreateDashedLines(v,M,r)};var A=function(){function v(){}return v.CreateLineSystem=function(z,u,w){var y=u.instance,r=u.lines,o=u.colors;if(y){var G,M,R=y.getVerticesData(H.b.PositionKind);o&&(G=y.getVerticesData(H.b.ColorKind));for(var W=0,Y=0,X=0;X<r.length;X++)for(var ea=r[X],ca=0;ca<ea.length;ca++)R[W]=ea[ca].x,R[W+1]=ea[ca].y,R[W+2]=ea[ca].z,o&&G&&(M=o[X],G[Y]=M[ca].r,G[Y+1]=M[ca].g,G[Y+2]=M[ca].b,G[Y+3]=M[ca].a,Y+=4),W+=3;return y.updateVerticesData(H.b.PositionKind,R,!1,!1),o&&G&&y.updateVerticesData(H.b.ColorKind,G,!1,!1),y}var oa=!!o,Z=new I.b(z,w,null,void 0,void 0,oa,u.useVertexAlpha);return j.a.CreateLineSystem(u).applyToMesh(Z,u.updatable),Z},v.CreateLines=function(z,u,w){void 0===w&&(w=null);var y=u.colors?[u.colors]:null;return v.CreateLineSystem(z,{lines:[u.points],updatable:u.updatable,instance:u.instance,colors:y,useVertexAlpha:u.useVertexAlpha},w)},v.CreateDashedLines=function(z,u,w){void 0===w&&(w=null);var y=u.points,r=u.instance,o=u.gapSize||1,G=u.dashSize||3;if(r)return r.updateMeshPositions(function(R){var W,Y,X=O.x.Zero(),ea=R.length/6,ca=0,oa=0,Z=0,T=0,V=0,D=0;for(V=0;V<y.length-1;V++)y[V+1].subtractToRef(y[V],X),ca+=X.length();W=ca/ea;var F=r._creationDataStorage.dashSize;for(Y=F*W/(F+r._creationDataStorage.gapSize),V=0;V<y.length-1;V++)for(y[V+1].subtractToRef(y[V],X),oa=Math.floor(X.length()/W),X.normalize(),D=0;D<oa&&T<R.length;)Z=W*D,R[T]=y[V].x+Z*X.x,R[T+1]=y[V].y+Z*X.y,R[T+2]=y[V].z+Z*X.z,R[T+3]=y[V].x+(Z+Y)*X.x,R[T+4]=y[V].y+(Z+Y)*X.y,R[T+5]=y[V].z+(Z+Y)*X.z,T+=6,D++;for(;T<R.length;)R[T]=y[V].x,R[T+1]=y[V].y,R[T+2]=y[V].z,T+=3},!1),r;var M=new I.b(z,w);return j.a.CreateDashedLines(u).applyToMesh(M,u.updatable),M._creationDataStorage=new q.b(),M._creationDataStorage.dashSize=G,M._creationDataStorage.gapSize=o,M},v}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return v});var O=l(16),q=l(8),j=l(17),I=l(23),H=l(65),A=l(0),v=function(){function z(u,w){var y=this;void 0===w&&(w=!0),this.originalScene=u,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new q.c(),this.utilityLayerScene=new O.a(u.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=u.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.detachControl(),w&&(this._originalPointerObserver=u.onPrePointerObservable.add(function(r,o){if(y.utilityLayerScene.activeCamera&&(y.processAllEvents||r.type===j.a.POINTERMOVE||r.type===j.a.POINTERUP||r.type===j.a.POINTERDOWN)){y.utilityLayerScene.pointerX=u.pointerX,y.utilityLayerScene.pointerY=u.pointerY;var G=r.event;if(u.isPointerCaptured(G.pointerId))y._pointerCaptures[G.pointerId]=!1;else{var M=r.ray?y.utilityLayerScene.pickWithRay(r.ray):y.utilityLayerScene.pick(u.pointerX,u.pointerY);if(!r.ray&&M&&(r.ray=M.ray),y.utilityLayerScene.onPrePointerObservable.notifyObservers(r),y.onlyCheckPointerDownEvents&&r.type!=j.a.POINTERDOWN)return r.skipOnPointerObservable||y.utilityLayerScene.onPointerObservable.notifyObservers(new j.b(r.type,r.event,M)),void(r.type===j.a.POINTERUP&&y._pointerCaptures[G.pointerId]&&(y._pointerCaptures[G.pointerId]=!1));if(y.utilityLayerScene.autoClearDepthAndStencil||y.pickUtilitySceneFirst)M&&M.hit&&(r.skipOnPointerObservable||y.utilityLayerScene.onPointerObservable.notifyObservers(new j.b(r.type,r.event,M)),r.skipOnPointerObservable=!0);else{var R=r.ray?u.pickWithRay(r.ray):u.pick(u.pointerX,u.pointerY),W=r.event;R&&M&&(0===M.distance&&R.pickedMesh?y.mainSceneTrackerPredicate&&y.mainSceneTrackerPredicate(R.pickedMesh)?(y._notifyObservers(r,R,W),r.skipOnPointerObservable=!0):r.type===j.a.POINTERDOWN?y._pointerCaptures[W.pointerId]=!0:y._lastPointerEvents[W.pointerId]&&(y.onPointerOutObservable.notifyObservers(W.pointerId),delete y._lastPointerEvents[W.pointerId]):!y._pointerCaptures[W.pointerId]&&(M.distance<R.distance||0===R.distance)?(y._notifyObservers(r,M,W),r.skipOnPointerObservable||(r.skipOnPointerObservable=M.distance>0)):!y._pointerCaptures[W.pointerId]&&M.distance>R.distance&&(y.mainSceneTrackerPredicate&&y.mainSceneTrackerPredicate(R.pickedMesh)?(y._notifyObservers(r,R,W),r.skipOnPointerObservable=!0):y._lastPointerEvents[W.pointerId]&&(y.onPointerOutObservable.notifyObservers(W.pointerId),delete y._lastPointerEvents[W.pointerId])),r.type===j.a.POINTERUP&&y._pointerCaptures[W.pointerId]&&(y._pointerCaptures[W.pointerId]=!1))}}}}),this._originalPointerObserver&&u.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterRenderObservable.add(function(){y.shouldRender&&y.render()}),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add(function(){y.dispose()}),this._updateCamera()}return z.prototype._getSharedGizmoLight=function(){return this._sharedGizmoLight||(this._sharedGizmoLight=new H.a("shared gizmo light",new A.x(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=A.e.Gray()),this._sharedGizmoLight},Object.defineProperty(z,"DefaultUtilityLayer",{get:function(){return null==z._DefaultUtilityLayer&&(z._DefaultUtilityLayer=new z(I.a.LastCreatedScene),z._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){z._DefaultUtilityLayer=null})),z._DefaultUtilityLayer},enumerable:!0,configurable:!0}),Object.defineProperty(z,"DefaultKeepDepthUtilityLayer",{get:function(){return null==z._DefaultKeepDepthUtilityLayer&&(z._DefaultKeepDepthUtilityLayer=new z(I.a.LastCreatedScene),z._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,z._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){z._DefaultKeepDepthUtilityLayer=null})),z._DefaultKeepDepthUtilityLayer},enumerable:!0,configurable:!0}),z.prototype._notifyObservers=function(u,w,y){u.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new j.b(u.type,u.event,w)),this._lastPointerEvents[y.pointerId]=!0)},z.prototype.render=function(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){var u=this.utilityLayerScene.activeCamera.getScene(),w=this.utilityLayerScene.activeCamera;w._scene=this.utilityLayerScene,w.leftCamera&&(w.leftCamera._scene=this.utilityLayerScene),w.rightCamera&&(w.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),w._scene=u,w.leftCamera&&(w.leftCamera._scene=u),w.rightCamera&&(w.rightCamera._scene=u)}},z.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},z.prototype._updateCamera=function(){this.originalScene.activeCameras.length>1?this.utilityLayerScene.activeCamera=this.originalScene.activeCameras[this.originalScene.activeCameras.length-1]:this.utilityLayerScene.activeCamera=this.originalScene.activeCamera},z._DefaultUtilityLayer=null,z._DefaultKeepDepthUtilityLayer=null,z}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return H});var O=l(1),q=l(2),j=l(8),I=l(0),H=function(A){function v(z,u,w){void 0===u&&(u=null),void 0===w&&(w=!0);var y=A.call(this,z,u)||this;return y._forward=new I.x(0,0,1),y._forwardInverted=new I.x(0,0,-1),y._up=new I.x(0,1,0),y._right=new I.x(1,0,0),y._rightInverted=new I.x(-1,0,0),y._position=I.x.Zero(),y._rotation=I.x.Zero(),y._rotationQuaternion=null,y._scaling=I.x.One(),y._isDirty=!1,y._transformToBoneReferal=null,y._billboardMode=v.BILLBOARDMODE_NONE,y._preserveParentRotationForBillboard=!1,y.scalingDeterminant=1,y._infiniteDistance=!1,y.ignoreNonUniformScaling=!1,y.reIntegrateRotationIntoRotationQuaternion=!1,y._poseMatrix=null,y._localMatrix=I.j.Zero(),y._usePivotMatrix=!1,y._absolutePosition=I.x.Zero(),y._pivotMatrix=I.j.Identity(),y._postMultiplyPivotMatrix=!1,y._isWorldMatrixFrozen=!1,y._indexInSceneTransformNodesArray=-1,y.onAfterWorldMatrixUpdateObservable=new j.c(),y._nonUniformScaling=!1,w&&y.getScene().addTransformNode(y),y}return O.d(v,A),Object.defineProperty(v.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(z){this._billboardMode!==z&&(this._billboardMode=z)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(z){z!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=z)},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(z){this._infiniteDistance!==z&&(this._infiniteDistance=z)},enumerable:!0,configurable:!0}),v.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(v.prototype,"position",{get:function(){return this._position},set:function(z){this._position=z,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"rotation",{get:function(){return this._rotation},set:function(z){this._rotation=z,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"scaling",{get:function(){return this._scaling},set:function(z){this._scaling=z,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(z){this._rotationQuaternion=z,z&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"forward",{get:function(){return I.x.Normalize(I.x.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"up",{get:function(){return I.x.Normalize(I.x.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(v.prototype,"right",{get:function(){return I.x.Normalize(I.x.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),v.prototype.updatePoseMatrix=function(z){return this._poseMatrix?(this._poseMatrix.copyFrom(z),this):(this._poseMatrix=z.clone(),this)},v.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=I.j.Identity()),this._poseMatrix},v.prototype._isSynchronized=function(){var z=this._cache;if(this.billboardMode!==z.billboardMode||this.billboardMode!==v.BILLBOARDMODE_NONE)return!1;if(z.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!z.position.equals(this._position))return!1;if(this._rotationQuaternion){if(!z.rotationQuaternion.equals(this._rotationQuaternion))return!1}else if(!z.rotation.equals(this._rotation))return!1;return!!z.scaling.equals(this._scaling)},v.prototype._initCache=function(){A.prototype._initCache.call(this);var z=this._cache;z.localMatrixUpdated=!1,z.position=I.x.Zero(),z.scaling=I.x.Zero(),z.rotation=I.x.Zero(),z.rotationQuaternion=new I.q(0,0,0,0),z.billboardMode=-1,z.infiniteDistance=!1},v.prototype.markAsDirty=function(z){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(v.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),v.prototype.setPreTransformMatrix=function(z){return this.setPivotMatrix(z,!1)},v.prototype.setPivotMatrix=function(z,u){return void 0===u&&(u=!0),this._pivotMatrix.copyFrom(z),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=u,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=I.j.Invert(this._pivotMatrix)),this},v.prototype.getPivotMatrix=function(){return this._pivotMatrix},v.prototype.freezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0,this},v.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(v.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),v.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},v.prototype.setAbsolutePosition=function(z){if(!z)return this;var u,w,y;if(void 0===z.x){if(arguments.length<3)return this;u=arguments[0],w=arguments[1],y=arguments[2]}else u=z.x,w=z.y,y=z.z;if(this.parent){var r=I.t.Matrix[0];this.parent.getWorldMatrix().invertToRef(r),I.x.TransformCoordinatesFromFloatsToRef(u,w,y,r,this.position)}else this.position.x=u,this.position.y=w,this.position.z=y;return this},v.prototype.setPositionWithLocalVector=function(z){return this.computeWorldMatrix(),this.position=I.x.TransformNormal(z,this._localMatrix),this},v.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var z=I.t.Matrix[0];return this._localMatrix.invertToRef(z),I.x.TransformNormal(this.position,z)},v.prototype.locallyTranslate=function(z){return this.computeWorldMatrix(!0),this.position=I.x.TransformCoordinates(z,this._localMatrix),this},v.prototype.lookAt=function(z,u,w,y,r){void 0===u&&(u=0),void 0===w&&(w=0),void 0===y&&(y=0),void 0===r&&(r=I.s.LOCAL);var o=v._lookAtVectorCache,G=r===I.s.LOCAL?this.position:this.getAbsolutePosition();if(z.subtractToRef(G,o),this.setDirection(o,u,w,y),r===I.s.WORLD&&this.parent)if(this.rotationQuaternion){var M=I.t.Matrix[0];this.rotationQuaternion.toRotationMatrix(M);var R=I.t.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(R),R.invert(),M.multiplyToRef(R,M),this.rotationQuaternion.fromRotationMatrix(M)}else{var W=I.t.Quaternion[0];I.q.FromEulerVectorToRef(this.rotation,W),M=I.t.Matrix[0],W.toRotationMatrix(M),R=I.t.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(R),R.invert(),M.multiplyToRef(R,M),W.fromRotationMatrix(M),W.toEulerAnglesToRef(this.rotation)}return this},v.prototype.getDirection=function(z){var u=I.x.Zero();return this.getDirectionToRef(z,u),u},v.prototype.getDirectionToRef=function(z,u){return I.x.TransformNormalToRef(z,this.getWorldMatrix(),u),this},v.prototype.setDirection=function(z,u,w,y){void 0===u&&(u=0),void 0===w&&(w=0),void 0===y&&(y=0);var r=-Math.atan2(z.z,z.x)+Math.PI/2,o=Math.sqrt(z.x*z.x+z.z*z.z),G=-Math.atan2(z.y,o);return this.rotationQuaternion?I.q.RotationYawPitchRollToRef(r+u,G+w,y,this.rotationQuaternion):(this.rotation.x=G+w,this.rotation.y=r+u,this.rotation.z=y),this},v.prototype.setPivotPoint=function(z,u){void 0===u&&(u=I.s.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var w=this.getWorldMatrix();if(u==I.s.WORLD){var y=I.t.Matrix[0];w.invertToRef(y),z=I.x.TransformCoordinates(z,y)}return this.setPivotMatrix(I.j.Translation(-z.x,-z.y,-z.z),!0)},v.prototype.getPivotPoint=function(){var z=I.x.Zero();return this.getPivotPointToRef(z),z},v.prototype.getPivotPointToRef=function(z){return z.x=-this._pivotMatrix.m[12],z.y=-this._pivotMatrix.m[13],z.z=-this._pivotMatrix.m[14],this},v.prototype.getAbsolutePivotPoint=function(){var z=I.x.Zero();return this.getAbsolutePivotPointToRef(z),z},v.prototype.getAbsolutePivotPointToRef=function(z){return z.x=this._pivotMatrix.m[12],z.y=this._pivotMatrix.m[13],z.z=this._pivotMatrix.m[14],this.getPivotPointToRef(z),I.x.TransformCoordinatesToRef(z,this.getWorldMatrix(),z),this},v.prototype.setParent=function(z){if(!z&&!this.parent)return this;var u=I.t.Quaternion[0],w=I.t.Vector3[0],y=I.t.Vector3[1];if(z){var r=I.t.Matrix[0],o=I.t.Matrix[1];this.computeWorldMatrix(!0),z.computeWorldMatrix(!0),z.getWorldMatrix().invertToRef(o),this.getWorldMatrix().multiplyToRef(o,r),r.decompose(y,u,w)}else this.parent&&this.parent.computeWorldMatrix&&this.parent.computeWorldMatrix(!0),this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(y,u,w);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(u):u.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(y),this.position.copyFrom(w),this.parent=z,this},Object.defineProperty(v.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),v.prototype._updateNonUniformScalingState=function(z){return this._nonUniformScaling!==z&&(this._nonUniformScaling=z,!0)},v.prototype.attachToBone=function(z,u){return this._transformToBoneReferal=u,this.parent=z,z.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},v.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},v.prototype.rotate=function(z,u,w){var y;if(z.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),w&&w!==I.s.LOCAL){if(this.parent){var r=I.t.Matrix[0];this.parent.getWorldMatrix().invertToRef(r),z=I.x.TransformNormal(z,r)}(y=I.q.RotationAxisToRef(z,u,v._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else y=I.q.RotationAxisToRef(z,u,v._rotationAxisCache),this.rotationQuaternion.multiplyToRef(y,this.rotationQuaternion);return this},v.prototype.rotateAround=function(z,u,w){u.normalize(),this.rotationQuaternion||(this.rotationQuaternion=I.q.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var y=I.t.Vector3[0],r=I.t.Vector3[1],o=I.t.Vector3[2],G=I.t.Quaternion[0],M=I.t.Matrix[0],R=I.t.Matrix[1],W=I.t.Matrix[2],Y=I.t.Matrix[3];return z.subtractToRef(this.position,y),I.j.TranslationToRef(y.x,y.y,y.z,M),I.j.TranslationToRef(-y.x,-y.y,-y.z,R),I.j.RotationAxisToRef(u,w,W),R.multiplyToRef(W,Y),Y.multiplyToRef(M,Y),Y.decompose(r,G,o),this.position.addInPlace(o),G.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},v.prototype.translate=function(z,u,w){var y=z.scale(u);if(w&&w!==I.s.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(y));else{var r=this.getPositionExpressedInLocalSpace().add(y);this.setPositionWithLocalVector(r)}return this},v.prototype.addRotation=function(z,u,w){var y;this.rotationQuaternion?y=this.rotationQuaternion:(y=I.t.Quaternion[1],I.q.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,y));var r=I.t.Quaternion[0];return I.q.RotationYawPitchRollToRef(u,z,w,r),y.multiplyInPlace(r),this.rotationQuaternion||y.toEulerAnglesToRef(this.rotation),this},v.prototype._getEffectiveParent=function(){return this.parent},v.prototype.computeWorldMatrix=function(z){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var u=this.getScene().getRenderId();if(!this._isDirty&&!z&&this.isSynchronized())return this._currentRenderId=u,this._worldMatrix;this._updateCache();var w=this._cache;w.pivotMatrixUpdated=!1,w.billboardMode=this.billboardMode,w.infiniteDistance=this.infiniteDistance,this._currentRenderId=u,this._childUpdateId++,this._isDirty=!1;var y=this._getEffectiveParent(),r=this._billboardMode!==v.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard,o=this.getScene().activeCamera,G=w.scaling,M=w.position;if(this._infiniteDistance)if(!this.parent&&o){var R=o.getWorldMatrix(),W=new I.x(R.m[12],R.m[13],R.m[14]);M.copyFromFloats(this._position.x+W.x,this._position.y+W.y,this._position.z+W.z)}else M.copyFrom(this._position);else M.copyFrom(this._position);G.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var Y=w.rotationQuaternion;this._rotationQuaternion?(this.reIntegrateRotationIntoRotationQuaternion&&(this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(I.q.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))),Y.copyFrom(this._rotationQuaternion)):(I.q.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,Y),w.rotation.copyFrom(this._rotation));if(this._usePivotMatrix){var X=I.t.Matrix[1];I.j.ScalingToRef(G.x,G.y,G.z,X);var ea=I.t.Matrix[0];Y.toRotationMatrix(ea),this._pivotMatrix.multiplyToRef(X,I.t.Matrix[4]),I.t.Matrix[4].multiplyToRef(ea,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(M.x,M.y,M.z)}else I.j.ComposeToRef(G,Y,M,this._localMatrix);if(y&&y.getWorldMatrix){if(r){this._transformToBoneReferal?y.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),I.t.Matrix[7]):I.t.Matrix[7].copyFrom(y.getWorldMatrix());var ca=I.t.Vector3[5],oa=I.t.Vector3[6];I.t.Matrix[7].decompose(oa,void 0,ca),I.j.ScalingToRef(oa.x,oa.y,oa.z,I.t.Matrix[7]),I.t.Matrix[7].setTranslation(ca),this._localMatrix.multiplyToRef(I.t.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(y.getWorldMatrix(),I.t.Matrix[6]),I.t.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(y.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(r&&o){var Z=I.t.Vector3[0];if(this._worldMatrix.getTranslationToRef(Z),I.t.Matrix[1].copyFrom(o.getViewMatrix()),I.t.Matrix[1].setTranslationFromFloats(0,0,0),I.t.Matrix[1].invertToRef(I.t.Matrix[0]),(this.billboardMode&v.BILLBOARDMODE_ALL)!==v.BILLBOARDMODE_ALL){I.t.Matrix[0].decompose(void 0,I.t.Quaternion[0],void 0);var T=I.t.Vector3[1];I.t.Quaternion[0].toEulerAnglesToRef(T),(this.billboardMode&v.BILLBOARDMODE_X)!==v.BILLBOARDMODE_X&&(T.x=0),(this.billboardMode&v.BILLBOARDMODE_Y)!==v.BILLBOARDMODE_Y&&(T.y=0),(this.billboardMode&v.BILLBOARDMODE_Z)!==v.BILLBOARDMODE_Z&&(T.z=0),I.j.RotationYawPitchRollToRef(T.y,T.x,T.z,I.t.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(I.t.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(I.t.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniform?this._updateNonUniformScalingState(!0):y&&y._nonUniformScaling?this._updateNonUniformScalingState(y._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=I.j.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},v.prototype._afterComputeWorldMatrix=function(){},v.prototype.registerAfterWorldMatrixUpdate=function(z){return this.onAfterWorldMatrixUpdateObservable.add(z),this},v.prototype.unregisterAfterWorldMatrixUpdate=function(z){return this.onAfterWorldMatrixUpdateObservable.removeCallback(z),this},v.prototype.getPositionInCameraSpace=function(z){return void 0===z&&(z=null),z||(z=this.getScene().activeCamera),I.x.TransformCoordinates(this.absolutePosition,z.getViewMatrix())},v.prototype.getDistanceToCamera=function(z){return void 0===z&&(z=null),z||(z=this.getScene().activeCamera),this.absolutePosition.subtract(z.globalPosition).length()},v.prototype.clone=function(z,u,w){var y=this,r=q.a.Clone(function(){return new v(z,y.getScene())},this);if(r.name=z,r.id=z,u&&(r.parent=u),!w)for(var o=this.getDescendants(!0),G=0;G<o.length;G++){var M=o[G];M.clone&&M.clone(z+"."+M.name,r)}return r},v.prototype.serialize=function(z){var u=q.a.Serialize(this,z);return u.type=this.getClassName(),this.parent&&(u.parentId=this.parent.id),u.localMatrix=this.getPivotMatrix().asArray(),u.isEnabled=this.isEnabled(),this.parent&&(u.parentId=this.parent.id),u},v.Parse=function(z,u,w){var y=q.a.Parse(function(){return new v(z.name,u)},z,u,w);return z.localMatrix?y.setPreTransformMatrix(I.j.FromArray(z.localMatrix)):z.pivotMatrix&&y.setPivotMatrix(I.j.FromArray(z.pivotMatrix)),y.setEnabled(z.isEnabled),z.parentId&&(y._waitingParentId=z.parentId),y},v.prototype.getChildTransformNodes=function(z,u){var w=[];return this._getDescendants(w,z,function(y){return(!u||u(y))&&y instanceof v}),w},v.prototype.dispose=function(z,u){if(void 0===u&&(u=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),z)for(var w=0,y=this.getChildTransformNodes(!0);w<y.length;w++){var r=y[w];r.parent=null,r.computeWorldMatrix(!0)}A.prototype.dispose.call(this,z,u)},v.BILLBOARDMODE_NONE=0,v.BILLBOARDMODE_X=1,v.BILLBOARDMODE_Y=2,v.BILLBOARDMODE_Z=4,v.BILLBOARDMODE_ALL=7,v._lookAtVectorCache=new I.x(0,0,0),v._rotationAxisCache=new I.q(),O.c([Object(q.o)("position")],v.prototype,"_position",void 0),O.c([Object(q.o)("rotation")],v.prototype,"_rotation",void 0),O.c([Object(q.l)("rotationQuaternion")],v.prototype,"_rotationQuaternion",void 0),O.c([Object(q.o)("scaling")],v.prototype,"_scaling",void 0),O.c([Object(q.c)("billboardMode")],v.prototype,"_billboardMode",void 0),O.c([Object(q.c)()],v.prototype,"scalingDeterminant",void 0),O.c([Object(q.c)("infiniteDistance")],v.prototype,"_infiniteDistance",void 0),O.c([Object(q.c)()],v.prototype,"ignoreNonUniformScaling",void 0),O.c([Object(q.c)()],v.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),v}(l(25).a)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return w});var O=l(34),q=l(0),j=l(3),I=l(77),H=l(82),A={min:0,max:0},v={min:0,max:0},z=function(y,r,o){var G=q.x.Dot(r.centerWorld,y),M=Math.abs(q.x.Dot(r.directions[0],y))*r.extendSize.x+Math.abs(q.x.Dot(r.directions[1],y))*r.extendSize.y+Math.abs(q.x.Dot(r.directions[2],y))*r.extendSize.z;o.min=G-M,o.max=G+M},u=function(y,r,o){return z(y,r,A),z(y,o,v),!(A.min>v.max||v.min>A.max)},w=function(){function y(r,o,G){this._isLocked=!1,this.boundingBox=new I.a(r,o,G),this.boundingSphere=new H.a(r,o,G)}return y.prototype.reConstruct=function(r,o,G){this.boundingBox.reConstruct(r,o,G),this.boundingSphere.reConstruct(r,o,G)},Object.defineProperty(y.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"isLocked",{get:function(){return this._isLocked},set:function(r){this._isLocked=r},enumerable:!0,configurable:!0}),y.prototype.update=function(r){this._isLocked||(this.boundingBox._update(r),this.boundingSphere._update(r))},y.prototype.centerOn=function(r,o){var G=y.TmpVector3[0].copyFrom(r).subtractInPlace(o),M=y.TmpVector3[1].copyFrom(r).addInPlace(o);return this.boundingBox.reConstruct(G,M,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(G,M,this.boundingBox.getWorldMatrix()),this},y.prototype.scale=function(r){return this.boundingBox.scale(r),this.boundingSphere.scale(r),this},y.prototype.isInFrustum=function(r,o){return void 0===o&&(o=j.a.MESHES_CULLINGSTRATEGY_STANDARD),!(o!==j.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION&&o!==j.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY||!this.boundingSphere.isCenterInFrustum(r))||!!this.boundingSphere.isInFrustum(r)&&(!(o!==j.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY&&o!==j.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY)||this.boundingBox.isInFrustum(r))},Object.defineProperty(y.prototype,"diagonalLength",{get:function(){var r=this.boundingBox;return r.maximumWorld.subtractToRef(r.minimumWorld,y.TmpVector3[0]).length()},enumerable:!0,configurable:!0}),y.prototype.isCompletelyInFrustum=function(r){return this.boundingBox.isCompletelyInFrustum(r)},y.prototype._checkCollision=function(r){return r._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},y.prototype.intersectsPoint=function(r){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(r)&&!!this.boundingBox.intersectsPoint(r))},y.prototype.intersects=function(r,o){if(!H.a.Intersects(this.boundingSphere,r.boundingSphere))return!1;if(!I.a.Intersects(this.boundingBox,r.boundingBox))return!1;if(!o)return!0;var G=this.boundingBox,M=r.boundingBox;return!!u(G.directions[0],G,M)&&(!!u(G.directions[1],G,M)&&(!!u(G.directions[2],G,M)&&(!!u(M.directions[0],G,M)&&(!!u(M.directions[1],G,M)&&(!!u(M.directions[2],G,M)&&(!!u(q.x.Cross(G.directions[0],M.directions[0]),G,M)&&(!!u(q.x.Cross(G.directions[0],M.directions[1]),G,M)&&(!!u(q.x.Cross(G.directions[0],M.directions[2]),G,M)&&(!!u(q.x.Cross(G.directions[1],M.directions[0]),G,M)&&(!!u(q.x.Cross(G.directions[1],M.directions[1]),G,M)&&(!!u(q.x.Cross(G.directions[1],M.directions[2]),G,M)&&(!!u(q.x.Cross(G.directions[2],M.directions[0]),G,M)&&(!!u(q.x.Cross(G.directions[2],M.directions[1]),G,M)&&!!u(q.x.Cross(G.directions[2],M.directions[2]),G,M))))))))))))))},y.TmpVector3=O.a.BuildArray(2,q.x.Zero),y}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return u});var O=l(1),q=l(2),j=l(8),I=l(9),H=l(71),A=l(0),v=l(23),z=l(3),u=function(){function w(y){this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=z.a.TEXTURE_EXPLICIT_MODE,this.wrapU=z.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapV=z.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=z.a.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=w.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array(),this.onDisposeObservable=new j.c(),this._onDisposeObserver=null,this.delayLoadState=z.a.DELAYLOADSTATE_NONE,this._scene=null,this._texture=null,this._uid=null,this._cachedSize=A.r.Zero(),this._scene=y||v.a.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this)),this._uid=null}return Object.defineProperty(w.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(y){this._hasAlpha!==y&&(this._hasAlpha=y,this._scene&&this._scene.markAllMaterialsAsDirty(z.a.MATERIAL_TextureDirtyFlag|z.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(y){this._coordinatesMode!==y&&(this._coordinatesMode=y,this._scene&&this._scene.markAllMaterialsAsDirty(z.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(y){this._texture&&(this._texture.isCube=y)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(y){this._texture&&(this._texture.is3D=y)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"noMipmap",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(y){this._texture&&(this._texture._lodGenerationOffset=y)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(y){this._texture&&(this._texture._lodGenerationScale=y)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"uid",{get:function(){return this._uid||(this._uid=I.h.RandomId()),this._uid},enumerable:!0,configurable:!0}),w.prototype.toString=function(){return this.name},w.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(w.prototype,"onDispose",{set:function(y){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(y)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),w.prototype.getScene=function(){return this._scene},w.prototype.getTextureMatrix=function(){return A.j.IdentityReadOnly},w.prototype.getReflectionTextureMatrix=function(){return A.j.IdentityReadOnly},w.prototype.getInternalTexture=function(){return this._texture},w.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},w.prototype.isReady=function(){return this.delayLoadState===z.a.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},w.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},w.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new A.r(this._texture._size,this._texture._size):new A.r(this._texture.baseWidth,this._texture.baseHeight):A.r.Zero()},w.prototype.updateSamplingMode=function(y){if(this._texture){var r=this.getScene();r&&r.getEngine().updateTextureSamplingMode(y,this._texture)}},w.prototype.scale=function(y){},Object.defineProperty(w.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),w.prototype._getFromCache=function(y,r,o,G){if(!this._scene)return null;for(var M=this._scene.getEngine().getLoadedTexturesCache(),R=0;R<M.length;R++){var W=M[R];if(!(void 0!==G&&G!==W.invertY||W.url!==y||W.generateMipMaps!==!r||o&&o!==W.samplingMode))return W.incrementReferences(),W}return null},w.prototype._rebuild=function(){},w.prototype.delayLoad=function(){},w.prototype.clone=function(){return null},Object.defineProperty(w.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:z.a.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:z.a.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),w.prototype.readPixels=function(y,r,o){if(void 0===y&&(y=0),void 0===r&&(r=0),void 0===o&&(o=null),!this._texture)return null;var G=this.getSize(),M=G.width,R=G.height,W=this.getScene();if(!W)return null;var Y=W.getEngine();return 0!=r&&(M/=Math.pow(2,r),R/=Math.pow(2,r),M=Math.round(M),R=Math.round(R)),this._texture.isCube?Y._readTexturePixels(this._texture,M,R,y,r,o):Y._readTexturePixels(this._texture,M,R,-1,r,o)},w.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(w.prototype,"sphericalPolynomial",{get:function(){return this._texture&&H.a&&this.isReady()?(this._texture._sphericalPolynomial||(this._texture._sphericalPolynomial=H.a.ConvertCubeMapTextureToSphericalPolynomial(this)),this._texture._sphericalPolynomial):null},set:function(y){this._texture&&(this._texture._sphericalPolynomial=y)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),w.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var y=this._scene.textures.indexOf(this);y>=0&&this._scene.textures.splice(y,1),this._scene.onTextureRemovedObservable.notifyObservers(this),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())}},w.prototype.serialize=function(){if(!this.name)return null;var y=q.a.Serialize(this);return q.a.AppendSerializedAnimations(this,y),y},w.WhenAllReady=function(y,r){var o=y.length;if(0!==o)for(var G,M,R=function(){if((G=y[W]).isReady())0==--o&&r();else{M=G.onLoadObservable;var Y=function(){M.removeCallback(Y),0==--o&&r()};M.add(Y)}},W=0;W<y.length;W++)R();else r()},w.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,O.c([Object(q.c)()],w.prototype,"uniqueId",void 0),O.c([Object(q.c)()],w.prototype,"name",void 0),O.c([Object(q.c)()],w.prototype,"metadata",void 0),O.c([Object(q.c)("hasAlpha")],w.prototype,"_hasAlpha",void 0),O.c([Object(q.c)()],w.prototype,"getAlphaFromRGB",void 0),O.c([Object(q.c)()],w.prototype,"level",void 0),O.c([Object(q.c)()],w.prototype,"coordinatesIndex",void 0),O.c([Object(q.c)("coordinatesMode")],w.prototype,"_coordinatesMode",void 0),O.c([Object(q.c)()],w.prototype,"wrapU",void 0),O.c([Object(q.c)()],w.prototype,"wrapV",void 0),O.c([Object(q.c)()],w.prototype,"wrapR",void 0),O.c([Object(q.c)()],w.prototype,"anisotropicFilteringLevel",void 0),O.c([Object(q.c)()],w.prototype,"isCube",null),O.c([Object(q.c)()],w.prototype,"is3D",null),O.c([Object(q.c)()],w.prototype,"gammaSpace",void 0),O.c([Object(q.c)()],w.prototype,"invertZ",void 0),O.c([Object(q.c)()],w.prototype,"lodLevelInAlpha",void 0),O.c([Object(q.c)()],w.prototype,"lodGenerationOffset",null),O.c([Object(q.c)()],w.prototype,"lodGenerationScale",null),O.c([Object(q.c)()],w.prototype,"isRenderTarget",void 0),w}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q});var O=l(0),q=function(){function j(){}return j._RemoveAndStorePivotPoint=function(I){I&&0===j._PivotCached&&(I.getPivotPointToRef(j._OldPivotPoint),j._OldPivotPoint.equalsToFloats(0,0,0)||(I.setPivotMatrix(O.j.IdentityReadOnly),j._OldPivotPoint.subtractToRef(I.getPivotPoint(),j._PivotTranslation),j._PivotTmpVector.copyFromFloats(1,1,1),j._PivotTmpVector.subtractInPlace(I.scaling),j._PivotTmpVector.multiplyInPlace(j._PivotTranslation),I.position.addInPlace(j._PivotTmpVector))),j._PivotCached++},j._RestorePivotPoint=function(I){I&&!j._OldPivotPoint.equalsToFloats(0,0,0)&&1===j._PivotCached&&(I.setPivotPoint(j._OldPivotPoint),j._PivotTmpVector.copyFromFloats(1,1,1),j._PivotTmpVector.subtractInPlace(I.scaling),j._PivotTmpVector.multiplyInPlace(j._PivotTranslation),I.position.subtractInPlace(j._PivotTmpVector)),this._PivotCached--},j._PivotCached=0,j._OldPivotPoint=new O.x(),j._PivotTranslation=new O.x(),j._PivotTmpVector=new O.x(),j}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return I});var O=l(0),q=l(11),j=l(13);j.a.CreateSphere=function(H){for(var A=H.segments||32,v=H.diameterX||H.diameter||1,z=H.diameterY||H.diameter||1,u=H.diameterZ||H.diameter||1,w=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1,y=H.slice&&H.slice<=0?1:H.slice||1,r=0===H.sideOrientation?0:H.sideOrientation||j.a.DEFAULTSIDE,o=new O.x(v/2,z/2,u/2),G=2+A,M=2*G,R=[],W=[],Y=[],X=[],ea=0;ea<=G;ea++){for(var ca=ea/G,oa=ca*Math.PI*y,Z=0;Z<=M;Z++){var T=Z/M,V=T*Math.PI*2*w,D=O.j.RotationZ(-oa),F=O.j.RotationY(V),L=O.x.TransformCoordinates(O.x.Up(),D),N=O.x.TransformCoordinates(L,F),p=N.multiply(o),g=N.divide(o).normalize();W.push(p.x,p.y,p.z),Y.push(g.x,g.y,g.z),X.push(T,ca)}if(ea>0)for(var n=W.length/3,s=n-2*(M+1);s+M+2<n;s++)R.push(s),R.push(s+1),R.push(s+M+1),R.push(s+M+1),R.push(s+1),R.push(s+M+2)}j.a._ComputeSides(r,W,R,Y,X,H.frontUVs,H.backUVs);var t=new j.a();return t.indices=R,t.positions=W,t.normals=Y,t.uvs=X,t},q.a.CreateSphere=function(H,A,v,z,u,w){var y={segments:A,diameterX:v,diameterY:v,diameterZ:v,sideOrientation:w,updatable:u};return I.CreateSphere(H,y,z)};var I=function(){function H(){}return H.CreateSphere=function(A,v,z){var u=new q.a(A,z);return v.sideOrientation=q.a._GetDefaultSideOrientation(v.sideOrientation),u._originalBuilderSideOrientation=v.sideOrientation,j.a.CreateSphere(v).applyToMesh(u,v.updatable),u},H}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q});var O=l(35),q=function(){function j(){}return Object.defineProperty(j,"Now",{get:function(){return O.a.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),j}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return I});var O=l(0),q=l(11),j=l(41),I=function(){function H(A){var v=this;void 0===A&&(A=j.a.DefaultUtilityLayer),this.gizmoLayer=A,this._attachedMesh=null,this.scaleRatio=1,this._customMeshSet=!1,this.updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this._updateScale=!0,this._interactionsEnabled=!0,this._tempVector=new O.x(),this._rootMesh=new q.a("gizmoRootNode",A.utilityLayerScene),this._rootMesh.rotationQuaternion=O.q.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){v._update()})}return Object.defineProperty(H.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(A){this._attachedMesh=A,this._rootMesh.setEnabled(!!A),this._attachedMeshChanged(A)},enumerable:!0,configurable:!0}),H.prototype.setCustomMesh=function(A){if(A.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(v){v.dispose()}),A.parent=this._rootMesh,this._customMeshSet=!0},H.prototype._attachedMeshChanged=function(A){},H.prototype._update=function(){if(this.attachedMesh){var A=this.attachedMesh._effectiveMesh||this.attachedMesh;if(this.updateGizmoPositionToMatchAttachedMesh&&this._rootMesh.position.copyFrom(A.absolutePosition),this.updateGizmoRotationToMatchAttachedMesh?A.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion):this._rootMesh.rotationQuaternion.set(0,0,0,1),this._updateScale){var v=this.gizmoLayer.utilityLayerScene.activeCamera,z=v.globalPosition;v.devicePosition&&(z=v.devicePosition),this._rootMesh.position.subtractToRef(z,this._tempVector);var u=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(u,u,u),A._getWorldMatrixDeterminant()<0&&(this._rootMesh.scaling.y*=-1)}}},H.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},H}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return v}),l.d(x,"b",function(){return z});var O=l(1),q=l(9),j=l(4),I=l(81),H=l(43),A=l(3),v=function(){function u(){this._materialDefines=null,this._materialEffect=null}return Object.defineProperty(u.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),u.prototype.setEffect=function(w,y){void 0===y&&(y=null),this._materialEffect!==w?(this._materialDefines=y,this._materialEffect=w):w||(this._materialDefines=null)},u}(),z=function(u){function w(y,r,o,G,M,R,W,Y){void 0===Y&&(Y=!0);var X=u.call(this)||this;return X.materialIndex=y,X.verticesStart=r,X.verticesCount=o,X.indexStart=G,X.indexCount=M,X._linesIndexCount=0,X._linesIndexBuffer=null,X._lastColliderWorldVertices=null,X._lastColliderTransformMatrix=null,X._renderId=0,X._alphaIndex=0,X._distanceToCamera=0,X._currentMaterial=null,X._mesh=R,X._renderingMesh=W||R,R.subMeshes.push(X),X._trianglePlanes=[],X._id=R.subMeshes.length-1,Y&&(X.refreshBoundingInfo(),R.computeWorldMatrix(!0)),X}return O.d(w,u),w.AddToMesh=function(y,r,o,G,M,R,W,Y){return void 0===Y&&(Y=!0),new w(y,r,o,G,M,R,W,Y)},Object.defineProperty(w.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),w.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},w.prototype.setBoundingInfo=function(y){return this._boundingInfo=y,this},w.prototype.getMesh=function(){return this._mesh},w.prototype.getRenderingMesh=function(){return this._renderingMesh},w.prototype.getMaterial=function(){var y=this._renderingMesh.material;if(null==y)return this._mesh.getScene().defaultMaterial;if(y.getSubMaterial){var r=y.getSubMaterial(this.materialIndex);return this._currentMaterial!==r&&(this._currentMaterial=r,this._materialDefines=null),r}return y},w.prototype.refreshBoundingInfo=function(y){if(void 0===y&&(y=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(y||(y=this._renderingMesh.getVerticesData(j.b.PositionKind)),!y)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var r,o=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===o.length){var G=this._renderingMesh.getBoundingInfo();r={minimum:G.minimum.clone(),maximum:G.maximum.clone()}}else r=q.h.ExtractMinAndMaxIndexed(y,o,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(r.minimum,r.maximum):this._boundingInfo=new H.a(r.minimum,r.maximum),this},w.prototype._checkCollision=function(y){return this.getBoundingInfo()._checkCollision(y)},w.prototype.updateBoundingInfo=function(y){var r=this.getBoundingInfo();return r||(this.refreshBoundingInfo(),r=this.getBoundingInfo()),r.update(y),this},w.prototype.isInFrustum=function(y){var r=this.getBoundingInfo();return!!r&&r.isInFrustum(y,this._mesh.cullingStrategy)},w.prototype.isCompletelyInFrustum=function(y){var r=this.getBoundingInfo();return!!r&&r.isCompletelyInFrustum(y)},w.prototype.render=function(y){return this._renderingMesh.render(this,y),this},w.prototype._getLinesIndexBuffer=function(y,r){if(!this._linesIndexBuffer){for(var o=[],G=this.indexStart;G<this.indexStart+this.indexCount;G+=3)o.push(y[G],y[G+1],y[G+1],y[G+2],y[G+2],y[G]);this._linesIndexBuffer=r.createIndexBuffer(o),this._linesIndexCount=o.length}return this._linesIndexBuffer},w.prototype.canIntersects=function(y){var r=this.getBoundingInfo();return!!r&&y.intersectsBox(r.boundingBox)},w.prototype.intersects=function(y,r,o,G,M){var R=this.getMaterial();if(!R)return null;switch(R.fillMode){case A.a.MATERIAL_PointListDrawMode:case A.a.MATERIAL_LineListDrawMode:case A.a.MATERIAL_LineLoopDrawMode:case A.a.MATERIAL_LineStripDrawMode:case A.a.MATERIAL_TriangleFanDrawMode:case A.a.MATERIAL_TriangleStripDrawMode:return null}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?o.length?this._intersectLines(y,r,o,this._mesh.intersectionThreshold,G):this._intersectUnIndexedLines(y,r,o,this._mesh.intersectionThreshold,G):!o.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(y,r,o,G,M):this._intersectTriangles(y,r,o,G,M)},w.prototype._intersectLines=function(y,r,o,G,M){for(var R=null,W=this.indexStart;W<this.indexStart+this.indexCount;W+=2){var Y=r[o[W]],X=r[o[W+1]],ea=y.intersectionSegment(Y,X,G);if(!(ea<0)&&((M||!R||ea<R.distance)&&((R=new I.a(null,null,ea)).faceId=W/2,M)))break}return R},w.prototype._intersectUnIndexedLines=function(y,r,o,G,M){for(var R=null,W=this.verticesStart;W<this.verticesStart+this.verticesCount;W+=2){var Y=r[W],X=r[W+1],ea=y.intersectionSegment(Y,X,G);if(!(ea<0)&&((M||!R||ea<R.distance)&&((R=new I.a(null,null,ea)).faceId=W/2,M)))break}return R},w.prototype._intersectTriangles=function(y,r,o,G,M){for(var R=null,W=this.indexStart;W<this.indexStart+this.indexCount;W+=3){var Y=r[o[W]],X=r[o[W+1]],ea=r[o[W+2]];if(!M||M(Y,X,ea,y)){var ca=y.intersectsTriangle(Y,X,ea);if(ca){if(ca.distance<0)continue;if((G||!R||ca.distance<R.distance)&&((R=ca).faceId=W/3,G))break}}}return R},w.prototype._intersectUnIndexedTriangles=function(y,r,o,G,M){for(var R=null,W=this.verticesStart;W<this.verticesStart+this.verticesCount;W+=3){var Y=r[W],X=r[W+1],ea=r[W+2];if(!M||M(Y,X,ea,y)){var ca=y.intersectsTriangle(Y,X,ea);if(ca){if(ca.distance<0)continue;if((G||!R||ca.distance<R.distance)&&((R=ca).faceId=W/3,G))break}}}return R},w.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},w.prototype.clone=function(y,r){var o=new w(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,y,r,!1);if(!this.IsGlobal){var G=this.getBoundingInfo();if(!G)return o;o._boundingInfo=new H.a(G.minimum,G.maximum)}return o},w.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var y=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(y,1)},w.prototype.getClassName=function(){return"SubMesh"},w.CreateFromIndices=function(y,r,o,G,M){for(var R=Number.MAX_VALUE,W=-Number.MAX_VALUE,Y=(M||G).getIndices(),X=r;X<r+o;X++){var ea=Y[X];ea<R&&(R=ea),ea>W&&(W=ea)}return new w(y,R,W-R+1,r,o,G,M)},w}(v)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return j});var O=l(0),q=l(4),j=function(){function I(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return I.prototype.getNormal=function(H,A){if(void 0===H&&(H=!1),void 0===A&&(A=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(q.b.NormalKind))return null;var v,z=this.pickedMesh.getIndices();if(!z)return null;if(A){var u=this.pickedMesh.getVerticesData(q.b.NormalKind),w=O.x.FromArray(u,3*z[3*this.faceId]),y=O.x.FromArray(u,3*z[3*this.faceId+1]),r=O.x.FromArray(u,3*z[3*this.faceId+2]);w=w.scale(this.bu),y=y.scale(this.bv),r=r.scale(1-this.bu-this.bv),v=new O.x(w.x+y.x+r.x,w.y+y.y+r.y,w.z+y.z+r.z)}else{var o=this.pickedMesh.getVerticesData(q.b.PositionKind),G=O.x.FromArray(o,3*z[3*this.faceId]),M=O.x.FromArray(o,3*z[3*this.faceId+1]),R=O.x.FromArray(o,3*z[3*this.faceId+2]),W=G.subtract(M),Y=R.subtract(M);v=O.x.Cross(W,Y)}if(H){var X=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(O.t.Matrix[0].copyFrom(X),(X=O.t.Matrix[0]).setTranslationFromFloats(0,0,0),X.invert(),X.transposeToRef(O.t.Matrix[1]),X=O.t.Matrix[1]),v=O.x.TransformNormal(v,X)}return v.normalize(),v},I.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(q.b.UVKind))return null;var H=this.pickedMesh.getIndices();if(!H)return null;var A=this.pickedMesh.getVerticesData(q.b.UVKind);if(!A)return null;var v=O.w.FromArray(A,2*H[3*this.faceId]),z=O.w.FromArray(A,2*H[3*this.faceId+1]),u=O.w.FromArray(A,2*H[3*this.faceId+2]);return v=v.scale(1-this.bu-this.bv),z=z.scale(this.bu),u=u.scale(this.bv),new O.w(v.x+z.x+u.x,v.y+z.y+u.y)},I}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q}),l.d(x,"b",function(){return j}),l.d(x,"c",function(){return I});var O=l(1),q=function(){function H(){}return H.KEYDOWN=1,H.KEYUP=2,H}(),j=function(){return function(H,A){this.type=H,this.event=A}}(),I=function(H){function A(v,z){var u=H.call(this,v,z)||this;return u.type=v,u.event=z,u.skipOnPointerObservable=!1,u}return O.d(A,H),A}(j)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return I});var O=l(0),q=l(11),j=l(13);j.a.CreateBox=function(H){var A,v=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],z=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],u=[],w=H.width||H.size||1,y=H.height||H.size||1,r=H.depth||H.size||1,o=H.wrap||!1,G=void 0===H.topBaseAt?1:H.topBaseAt,M=void 0===H.bottomBaseAt?0:H.bottomBaseAt,R=[2,0,3,1][G=(G+4)%4],W=[2,0,1,3][M=(M+4)%4],Y=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(o){v=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],Y=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var X=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],ea=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],ca=[17,18,19,16],oa=[22,23,20,21];R>0;)X.unshift(X.pop()),ca.unshift(ca.pop()),R--;for(;W>0;)ea.unshift(ea.pop()),oa.unshift(oa.pop()),W--;X=X.flat(),ea=ea.flat(),Y=Y.concat(X).concat(ea),v.push(ca[0],ca[2],ca[3],ca[0],ca[1],ca[2]),v.push(oa[0],oa[2],oa[3],oa[0],oa[1],oa[2])}var Z=[w/2,y/2,r/2];A=Y.reduce(function(s,t,C){return s.concat(t*Z[C%3])},[]);for(var T=0===H.sideOrientation?0:H.sideOrientation||j.a.DEFAULTSIDE,V=H.faceUV||new Array(6),D=H.faceColors,F=[],L=0;L<6;L++)void 0===V[L]&&(V[L]=new O.y(0,0,1,1)),D&&void 0===D[L]&&(D[L]=new O.f(1,1,1,1));for(var N=0;N<6;N++)if(u.push(V[N].z,V[N].w),u.push(V[N].x,V[N].w),u.push(V[N].x,V[N].y),u.push(V[N].z,V[N].y),D)for(var p=0;p<4;p++)F.push(D[N].r,D[N].g,D[N].b,D[N].a);j.a._ComputeSides(T,A,v,z,u,H.frontUVs,H.backUVs);var g=new j.a();if(g.indices=v,g.positions=A,g.normals=z,g.uvs=u,D){var n=T===j.a.DOUBLESIDE?F.concat(F):F;g.colors=n}return g},q.a.CreateBox=function(H,A,v,z,u){void 0===v&&(v=null);var w={size:A,sideOrientation:u,updatable:z};return I.CreateBox(H,w,v)};var I=function(){function H(){}return H.CreateBox=function(A,v,z){void 0===z&&(z=null);var u=new q.a(A,z);return v.sideOrientation=q.a._GetDefaultSideOrientation(v.sideOrientation),u._originalBuilderSideOrientation=v.sideOrientation,j.a.CreateBox(v).applyToMesh(u,v.updatable),u},H}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return H});var O=l(0),q=l(11),j=l(13),I=l(16);j.a.CreateCylinder=function(A){var v,z=A.height||2,u=0===A.diameterTop?0:A.diameterTop||A.diameter||1,w=0===A.diameterBottom?0:A.diameterBottom||A.diameter||1,y=A.tessellation||24,r=A.subdivisions||1,o=!!A.hasRings,G=!!A.enclose,M=A.arc&&(A.arc<=0||A.arc>1)?1:A.arc||1,R=0===A.sideOrientation?0:A.sideOrientation||j.a.DEFAULTSIDE,W=A.faceUV||new Array(3),Y=A.faceColors,X=2+(1+(1!==M&&G?2:0))*(o?r:1);for(v=0;v<X;v++)Y&&void 0===Y[v]&&(Y[v]=new O.f(1,1,1,1));for(v=0;v<X;v++)W&&void 0===W[v]&&(W[v]=new O.y(0,0,1,1));var ea,ca,oa,Z,T,V,D=new Array(),F=new Array(),L=new Array(),N=new Array(),p=new Array(),g=2*Math.PI*M/y,n=(w-u)/2/z,s=O.x.Zero(),t=O.x.Zero(),C=O.x.Zero(),J=O.x.Zero(),Q=O.x.Zero(),$=O.c.Y,aa=1,ba=1,ia=0,qa=0;for(Z=0;Z<=r;Z++)for(oa=((ca=Z/r)*(u-w)+w)/2,aa=o&&0!==Z&&Z!==r?2:1,V=0;V<aa;V++){for(o&&(ba+=V),G&&(ba+=2*V),T=0;T<=y;T++)ea=T*g,s.x=Math.cos(-ea)*oa,s.y=-z/2+ca*z,s.z=Math.sin(-ea)*oa,0===u&&Z===r?(t.x=L[L.length-3*(y+1)],t.y=L[L.length-3*(y+1)+1],t.z=L[L.length-3*(y+1)+2]):(t.x=s.x,t.z=s.z,t.y=Math.sqrt(t.x*t.x+t.z*t.z)*n,t.normalize()),0===T&&(C.copyFrom(s),J.copyFrom(t)),F.push(s.x,s.y,s.z),L.push(t.x,t.y,t.z),qa=o?ia!==ba?W[ba].y:W[ba].w:W[ba].y+(W[ba].w-W[ba].y)*ca,N.push(W[ba].x+(W[ba].z-W[ba].x)*T/y,qa),Y&&p.push(Y[ba].r,Y[ba].g,Y[ba].b,Y[ba].a);1!==M&&G&&(F.push(s.x,s.y,s.z),F.push(0,s.y,0),F.push(0,s.y,0),F.push(C.x,C.y,C.z),O.x.CrossToRef($,t,Q),Q.normalize(),L.push(Q.x,Q.y,Q.z,Q.x,Q.y,Q.z),O.x.CrossToRef(J,$,Q),Q.normalize(),L.push(Q.x,Q.y,Q.z,Q.x,Q.y,Q.z),qa=o?ia!==ba?W[ba+1].y:W[ba+1].w:W[ba+1].y+(W[ba+1].w-W[ba+1].y)*ca,N.push(W[ba+1].x,qa),N.push(W[ba+1].z,qa),qa=o?ia!==ba?W[ba+2].y:W[ba+2].w:W[ba+2].y+(W[ba+2].w-W[ba+2].y)*ca,N.push(W[ba+2].x,qa),N.push(W[ba+2].z,qa),Y&&(p.push(Y[ba+1].r,Y[ba+1].g,Y[ba+1].b,Y[ba+1].a),p.push(Y[ba+1].r,Y[ba+1].g,Y[ba+1].b,Y[ba+1].a),p.push(Y[ba+2].r,Y[ba+2].g,Y[ba+2].b,Y[ba+2].a),p.push(Y[ba+2].r,Y[ba+2].g,Y[ba+2].b,Y[ba+2].a))),ia!==ba&&(ia=ba)}var ja=1!==M&&G?y+4:y;for(Z=0,ba=0;ba<r;ba++){var sa=0,za=0,Fa=0,Ea=0;for(T=0;T<y;T++)sa=Z*(ja+1)+T,za=(Z+1)*(ja+1)+T,Fa=Z*(ja+1)+(T+1),Ea=(Z+1)*(ja+1)+(T+1),D.push(sa,za,Fa),D.push(Ea,Fa,za);1!==M&&G&&(D.push(sa+2,za+2,Fa+2),D.push(Ea+2,Fa+2,za+2),D.push(sa+4,za+4,Fa+4),D.push(Ea+4,Fa+4,za+4)),Z=o?Z+2:Z+1}var Ba=function(Xa){var Ka=Xa?u/2:w/2;if(0!==Ka){var Ga,nb,jb,bb=Xa?W[X-1]:W[0],fb=null;Y&&(fb=Xa?Y[X-1]:Y[0]);var ob=F.length/3,Cb=Xa?z/2:-z/2,gb=new O.x(0,Cb,0);F.push(gb.x,gb.y,gb.z),L.push(0,Xa?1:-1,0),N.push(bb.x+.5*(bb.z-bb.x),bb.y+.5*(bb.w-bb.y)),fb&&p.push(fb.r,fb.g,fb.b,fb.a);var qb=new O.w(.5,.5);for(jb=0;jb<=y;jb++){Ga=2*Math.PI*jb*M/y;var yb=Math.cos(-Ga),Lb=Math.sin(-Ga);nb=new O.x(yb*Ka,Cb,Lb*Ka);var Mb=new O.w(yb*qb.x+.5,Lb*qb.y+.5);F.push(nb.x,nb.y,nb.z),L.push(0,Xa?1:-1,0),N.push(bb.x+(bb.z-bb.x)*Mb.x,bb.y+(bb.w-bb.y)*Mb.y),fb&&p.push(fb.r,fb.g,fb.b,fb.a)}for(jb=0;jb<y;jb++)Xa?(D.push(ob),D.push(ob+(jb+2)),D.push(ob+(jb+1))):(D.push(ob),D.push(ob+(jb+1)),D.push(ob+(jb+2)))}};Ba(!1),Ba(!0),j.a._ComputeSides(R,F,D,L,N,A.frontUVs,A.backUVs);var Sa=new j.a();return Sa.indices=D,Sa.positions=F,Sa.normals=L,Sa.uvs=N,Y&&(Sa.colors=p),Sa},q.a.CreateCylinder=function(A,v,z,u,w,y,r,o,G){void 0!==r&&r instanceof I.a||(void 0!==r&&(G=o||q.a.DEFAULTSIDE,o=r),r=y,y=1);var M={height:v,diameterTop:z,diameterBottom:u,tessellation:w,subdivisions:y,sideOrientation:G,updatable:o};return H.CreateCylinder(A,M,r)};var H=function(){function A(){}return A.CreateCylinder=function(v,z,u){var w=new q.a(v,u);return z.sideOrientation=q.a._GetDefaultSideOrientation(z.sideOrientation),w._originalBuilderSideOrientation=z.sideOrientation,j.a.CreateCylinder(z).applyToMesh(w,z.updatable),w},A}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return z});var O=l(11),q=l(16),j=l(8),I=l(0),H=l(17),A=l(39),v=l(45),z=(l(80),function(){function u(w){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new j.c(),this.onDragStartObservable=new j.c(),this.onDragEndObservable=new j.c(),this.moveAttached=!0,this.enabled=!0,this.detachCameraControls=!0,this.useObjectOrienationForDragging=!0,this.validateDrag=function(r){return!0},this._tmpVector=new I.x(0,0,0),this._alternatePickedPoint=new I.x(0,0,0),this._worldDragAxis=new I.x(0,0,0),this._targetPosition=new I.x(0,0,0),this._attachedElement=null,this._startDragRay=new A.a(new I.x(),new I.x()),this._lastPointerRay={},this._dragDelta=new I.x(),this._pointA=new I.x(0,0,0),this._pointB=new I.x(0,0,0),this._pointC=new I.x(0,0,0),this._lineA=new I.x(0,0,0),this._lineB=new I.x(0,0,0),this._localAxis=new I.x(0,0,0),this._lookAt=new I.x(0,0,0),this._options=w||{};var y=0;if(this._options.dragAxis&&y++,this._options.dragPlaneNormal&&y++,y>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(u.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!0,configurable:!0}),u.prototype.init=function(){},u.prototype.attach=function(w){var y=this;this._scene=w.getScene(),this._attachedNode=w,u._planeScene||(this._debugMode?u._planeScene=this._scene:(u._planeScene=new q.a(this._scene.getEngine(),{virtual:!0}),u._planeScene.detachControl(),this._scene.onDisposeObservable.addOnce(function(){u._planeScene.dispose(),u._planeScene=null}))),this._dragPlane=O.a.CreatePlane("pointerDragPlane",this._debugMode?1:10000,u._planeScene,!1,O.a.DOUBLESIDE),this.lastDragPosition=new I.x(0,0,0),this._pointerObserver=this._scene.onPointerObservable.add(function(r,o){var G;if(y.enabled){if(r.type==H.a.POINTERDOWN)!y.dragging&&r.pickInfo&&r.pickInfo.hit&&r.pickInfo.pickedMesh&&r.pickInfo.pickedPoint&&r.pickInfo.ray&&(G=r.pickInfo.pickedMesh,y._attachedNode==G||G.isDescendantOf(y._attachedNode))&&y._startDrag(r.event.pointerId,r.pickInfo.ray,r.pickInfo.pickedPoint);else if(r.type==H.a.POINTERUP)y.currentDraggingPointerID==r.event.pointerId&&y.releaseDrag();else if(r.type==H.a.POINTERMOVE){var M=r.event.pointerId;y.currentDraggingPointerID===u._AnyMouseID&&M!==u._AnyMouseID&&"mouse"==r.event.pointerType&&(y._lastPointerRay[y.currentDraggingPointerID]&&(y._lastPointerRay[M]=y._lastPointerRay[y.currentDraggingPointerID],delete y._lastPointerRay[y.currentDraggingPointerID]),y.currentDraggingPointerID=M),y._lastPointerRay[M]||(y._lastPointerRay[M]=new A.a(new I.x(),new I.x())),r.pickInfo&&r.pickInfo.ray&&(y._lastPointerRay[M].origin.copyFrom(r.pickInfo.ray.origin),y._lastPointerRay[M].direction.copyFrom(r.pickInfo.ray.direction),y.currentDraggingPointerID==M&&y.dragging&&y._moveDrag(r.pickInfo.ray))}}}),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){y._moving&&y.moveAttached&&(v.a._RemoveAndStorePivotPoint(y._attachedNode),y._targetPosition.subtractToRef(y._attachedNode.absolutePosition,y._tmpVector),y._tmpVector.scaleInPlace(y.dragDeltaRatio),y._attachedNode.getAbsolutePosition().addToRef(y._tmpVector,y._tmpVector),y.validateDrag(y._tmpVector)&&y._attachedNode.setAbsolutePosition(y._tmpVector),v.a._RestorePivotPoint(y._attachedNode))})},u.prototype.releaseDrag=function(){this.dragging=!1,this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID}),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&this._scene.activeCamera.attachControl(this._attachedElement,!0)},u.prototype.startDrag=function(w,y,r){void 0===w&&(w=u._AnyMouseID),this._startDrag(w,y,r);var o=this._lastPointerRay[w];w===u._AnyMouseID&&(o=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),o&&this._moveDrag(o)},u.prototype._startDrag=function(w,y,r){if(this._scene.activeCamera&&!this.dragging&&this._attachedNode){v.a._RemoveAndStorePivotPoint(this._attachedNode),y?(this._startDragRay.direction.copyFrom(y.direction),this._startDragRay.origin.copyFrom(y.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this._attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,r||this._tmpVector);var o=this._pickWithRayOnDragPlane(this._startDragRay);o&&(this.dragging=!0,this.currentDraggingPointerID=w,this.lastDragPosition.copyFrom(o),this.onDragStartObservable.notifyObservers({dragPlanePoint:o,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this._attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedElement?(this._attachedElement=this._scene.activeCamera.inputs.attachedElement,this._scene.activeCamera.detachControl(this._scene.activeCamera.inputs.attachedElement)):this._attachedElement=null)),v.a._RestorePivotPoint(this._attachedNode)}},u.prototype._moveDrag=function(w){this._moving=!0;var y=this._pickWithRayOnDragPlane(w);if(y){this.updateDragPlane&&this._updateDragPlanePosition(w,y);var r=0;this._options.dragAxis?(I.x.TransformCoordinatesToRef(this._options.dragAxis,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis),y.subtractToRef(this.lastDragPosition,this._tmpVector),r=I.x.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(r,this._dragDelta)):(r=this._dragDelta.length(),y.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:r,delta:this._dragDelta,dragPlanePoint:y,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(y)}},u.prototype._pickWithRayOnDragPlane=function(w){var y=this;if(!w)return null;var r=Math.acos(I.x.Dot(this._dragPlane.forward,w.direction));if(r>Math.PI/2&&(r=Math.PI-r),this.maxDragAngle>0&&r>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(w.direction),this._attachedNode.absolutePosition.subtractToRef(w.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*I.x.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var o=I.x.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-o,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this._attachedNode.absolutePosition),this._alternatePickedPoint}return null}var G=u._planeScene.pickWithRay(w,function(M){return M==y._dragPlane});return G&&G.hit&&G.pickedMesh&&G.pickedPoint?G.pickedPoint:null},u.prototype._updateDragPlanePosition=function(w,y){this._pointA.copyFrom(y),this._options.dragAxis?(this.useObjectOrienationForDragging?I.x.TransformCoordinatesToRef(this._options.dragAxis,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),this._pointA.addToRef(this._localAxis,this._pointB),w.origin.subtractToRef(this._pointA,this._pointC),this._pointA.addToRef(this._pointC.normalize(),this._pointC),this._pointB.subtractToRef(this._pointA,this._lineA),this._pointC.subtractToRef(this._pointA,this._lineB),I.x.CrossToRef(this._lineA,this._lineB,this._lookAt),I.x.CrossToRef(this._lineA,this._lookAt,this._lookAt),this._lookAt.normalize(),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrienationForDragging?I.x.TransformCoordinatesToRef(this._options.dragPlaneNormal,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(w.origin)),this._dragPlane.position.copyFrom(this._attachedNode.absolutePosition),this._dragPlane.computeWorldMatrix(!0)},u.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this.releaseDrag()},u._AnyMouseID=-2,u}())},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q});var O=l(3),q=function(){function j(){}return Object.defineProperty(j,"ForceFullSceneLoadingForIncremental",{get:function(){return j._ForceFullSceneLoadingForIncremental},set:function(I){j._ForceFullSceneLoadingForIncremental=I},enumerable:!0,configurable:!0}),Object.defineProperty(j,"ShowLoadingScreen",{get:function(){return j._ShowLoadingScreen},set:function(I){j._ShowLoadingScreen=I},enumerable:!0,configurable:!0}),Object.defineProperty(j,"loggingLevel",{get:function(){return j._loggingLevel},set:function(I){j._loggingLevel=I},enumerable:!0,configurable:!0}),Object.defineProperty(j,"CleanBoneMatrixWeights",{get:function(){return j._CleanBoneMatrixWeights},set:function(I){j._CleanBoneMatrixWeights=I},enumerable:!0,configurable:!0}),j._ForceFullSceneLoadingForIncremental=!1,j._ShowLoadingScreen=!0,j._CleanBoneMatrixWeights=!1,j._loggingLevel=O.a.SCENELOADER_NO_LOGGING,j}()},function(Aa,x,l){"use strict";var O="helperFunctions",q=`const float PI=3.1415926535897932384626433832795;
const float LinearEncodePowerApprox=2.2;
const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;
const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);
const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {
vec3 i0=inMatrix[0];
vec3 i1=inMatrix[1];
vec3 i2=inMatrix[2];
mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);
return outMatrix;
}

mat3 inverseMat3(mat3 inMatrix) {
float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];
float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];
float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];
float b01=a22*a11-a12*a21;
float b11=-a22*a10+a12*a20;
float b21=a21*a10-a11*a20;
float det=a00*b01+a01*b11+a02*b21;
return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;
}
vec3 toLinearSpace(vec3 color)
{
return pow(color,vec3(LinearEncodePowerApprox));
}
vec3 toGammaSpace(vec3 color)
{
return pow(color,vec3(GammaEncodePowerApprox));
}
float square(float value)
{
return value*value;
}
float pow5(float value) {
float sq=value*value;
return sq*sq*value;
}
float getLuminance(vec3 color)
{
return clamp(dot(color,LuminanceEncodeApprox),0.,1.);
}

float getRand(vec2 seed) {
return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);
}
float dither(vec2 seed,float varianceAmount) {
float rand=getRand(seed);
float dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);
return dither;
}

const float rgbdMaxRange=255.0;
vec4 toRGBD(vec3 color) {
float maxRGB=maxEps(max(color.r,max(color.g,color.b)));
float D=max(rgbdMaxRange/maxRGB,1.);
D=clamp(floor(D)/255.0,0.,1.);

vec3 rgb=color.rgb*D;

rgb=toGammaSpace(rgb);
return vec4(rgb,D);
}
vec3 fromRGBD(vec4 rgbd) {

rgbd.rgb=toLinearSpace(rgbd.rgb);

return rgbd.rgb/rgbd.a;
}`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";l.d(x,"a",function(){return w});var O=l(0),q=l(13),j=l(4),I=l(49),H=l(55),A=l(43),v=l(3),z=l(9),u=l(29),w=function(){function y(r,o,G,M,R){void 0===M&&(M=!1),void 0===R&&(R=null),this.delayLoadState=v.a.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=r,this.uniqueId=o.getUniqueId(),this._engine=o.getEngine(),this._meshes=[],this._scene=o,this._vertexBuffers={},this._indices=[],this._updatable=M,G?this.setAllVerticesData(G,M):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),R&&(this.applyToMesh(R),R.computeWorldMatrix(!0))}return Object.defineProperty(y.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(r){this._boundingBias?this._boundingBias.copyFrom(r):this._boundingBias=r.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),y.CreateGeometryForMesh=function(r){var o=new y(y.RandomId(),r.getScene());return o.applyToMesh(r),o},Object.defineProperty(y.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),y.prototype.getScene=function(){return this._scene},y.prototype.getEngine=function(){return this._engine},y.prototype.isReady=function(){return this.delayLoadState===v.a.DELAYLOADSTATE_LOADED||this.delayLoadState===v.a.DELAYLOADSTATE_NONE},Object.defineProperty(y.prototype,"doNotSerialize",{get:function(){for(var r=0;r<this._meshes.length;r++)if(!this._meshes[r].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),y.prototype._rebuild=function(){for(var r in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers)this._vertexBuffers[r]._rebuild()},y.prototype.setAllVerticesData=function(r,o){r.applyToGeometry(this,o),this.notifyUpdate()},y.prototype.setVerticesData=function(r,o,G,M){void 0===G&&(G=!1);var R=new j.b(this._engine,o,r,G,0===this._meshes.length,M);this.setVerticesBuffer(R)},y.prototype.removeVerticesData=function(r){this._vertexBuffers[r]&&(this._vertexBuffers[r].dispose(),delete this._vertexBuffers[r])},y.prototype.setVerticesBuffer=function(r,o){void 0===o&&(o=null);var G=r.getKind();if(this._vertexBuffers[G]&&this._vertexBuffers[G].dispose(),this._vertexBuffers[G]=r,G===j.b.PositionKind){var M=r.getData();null!=o?this._totalVertices=o:null!=M&&(this._totalVertices=M.length/(r.byteStride/4)),this._updateExtend(M),this._resetPointsArrayCache();for(var R=this._meshes,W=R.length,Y=0;Y<W;Y++){var X=R[Y];X._boundingInfo=new A.a(this._extend.minimum,this._extend.maximum),X._createGlobalSubMesh(!1),X.computeWorldMatrix(!0)}}this.notifyUpdate(G),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},y.prototype.updateVerticesDataDirectly=function(r,o,G,M){void 0===M&&(M=!1);var R=this.getVertexBuffer(r);R&&(R.updateDirectly(o,G,M),this.notifyUpdate(r))},y.prototype.updateVerticesData=function(r,o,G){void 0===G&&(G=!1);var M=this.getVertexBuffer(r);M&&(M.update(o),r===j.b.PositionKind&&this._updateBoundingInfo(G,o),this.notifyUpdate(r))},y.prototype._updateBoundingInfo=function(r,o){if(r&&this._updateExtend(o),this._resetPointsArrayCache(),r)for(var G=0,M=this._meshes;G<M.length;G++){var R=M[G];R._boundingInfo?R._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):R._boundingInfo=new A.a(this._extend.minimum,this._extend.maximum);for(var W=0,Y=R.subMeshes;W<Y.length;W++)Y[W].refreshBoundingInfo()}},y.prototype._bind=function(r,o){if(r){void 0===o&&(o=this._indexBuffer);var G=this.getVertexBuffers();G&&(o==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[r.key]||(this._vertexArrayObjects[r.key]=this._engine.recordVertexArrayObject(G,o,r)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[r.key],o)):this._engine.bindBuffers(G,o,r))}},y.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},y.prototype.getVerticesData=function(r,o,G){var M=this.getVertexBuffer(r);if(!M)return null;var R=M.getData();if(!R)return null;var W=M.getSize()*j.b.GetTypeByteLength(M.type),Y=this._totalVertices*M.getSize();if(M.type!==j.b.FLOAT||M.byteStride!==W){var X=[];return M.forEach(Y,function(Z){return X.push(Z)}),X}if(!(R instanceof Array||R instanceof Float32Array)||0!==M.byteOffset||R.length!==Y){if(R instanceof Array){var ea=M.byteOffset/4;return z.h.Slice(R,ea,ea+Y)}if(R instanceof ArrayBuffer)return new Float32Array(R,M.byteOffset,Y);ea=R.byteOffset+M.byteOffset;if(G||o&&1!==this._meshes.length){var ca=new Float32Array(Y),oa=new Float32Array(R.buffer,ea,Y);return ca.set(oa),ca}return new Float32Array(R.buffer,ea,Y)}return G||o&&1!==this._meshes.length?z.h.Slice(R):R},y.prototype.isVertexBufferUpdatable=function(r){var o=this._vertexBuffers[r];return!!o&&o.isUpdatable()},y.prototype.getVertexBuffer=function(r){return this.isReady()?this._vertexBuffers[r]:null},y.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},y.prototype.isVerticesDataPresent=function(r){return this._vertexBuffers?void 0!==this._vertexBuffers[r]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(r)},y.prototype.getVerticesDataKinds=function(){var r,o=[];if(!this._vertexBuffers&&this._delayInfo)for(r in this._delayInfo)o.push(r);else for(r in this._vertexBuffers)o.push(r);return o},y.prototype.updateIndices=function(r,o,G){if(void 0===G&&(G=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var M=r.length!==this._indices.length;if(G||(this._indices=r.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,r,o),M)for(var R=0,W=this._meshes;R<W.length;R++)W[R]._createGlobalSubMesh(!0)}else this.setIndices(r,null,!0)},y.prototype.setIndices=function(r,o,G){void 0===o&&(o=null),void 0===G&&(G=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=r,this._indexBufferIsUpdatable=G,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,G)),null!=o&&(this._totalVertices=o);for(var M=0,R=this._meshes;M<R.length;M++)R[M]._createGlobalSubMesh(!0);this.notifyUpdate()},y.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},y.prototype.getIndices=function(r,o){if(!this.isReady())return null;var G=this._indices;if(o||r&&1!==this._meshes.length){for(var M=G.length,R=[],W=0;W<M;W++)R.push(G[W]);return R}return G},y.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},y.prototype._releaseVertexArrayObject=function(r){void 0===r&&(r=null),r&&this._vertexArrayObjects&&this._vertexArrayObjects[r.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[r.key]),delete this._vertexArrayObjects[r.key])},y.prototype.releaseForMesh=function(r,o){var G=this._meshes,M=G.indexOf(r);-1!==M&&(G.splice(M,1),r._geometry=null,0===G.length&&o&&this.dispose())},y.prototype.applyToMesh=function(r){if(r._geometry!==this){var o=r._geometry;o&&o.releaseForMesh(r);var G=this._meshes;r._geometry=this,this._scene.pushGeometry(this),G.push(r),this.isReady()?this._applyToMesh(r):r._boundingInfo=this._boundingInfo}},y.prototype._updateExtend=function(r){void 0===r&&(r=null),r||(r=this.getVerticesData(j.b.PositionKind)),this._extend=z.h.ExtractMinAndMax(r,0,this._totalVertices,this.boundingBias,3)},y.prototype._applyToMesh=function(r){var o=this._meshes.length;for(var G in this._vertexBuffers){1===o&&this._vertexBuffers[G].create();var M=this._vertexBuffers[G].getBuffer();M&&(M.references=o),G===j.b.PositionKind&&(this._extend||this._updateExtend(),r._boundingInfo=new A.a(this._extend.minimum,this._extend.maximum),r._createGlobalSubMesh(!1),r._updateBoundingInfo())}1===o&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=o),r._syncGeometryWithMorphTargetManager(),r.synchronizeInstances()},y.prototype.notifyUpdate=function(r){this.onGeometryUpdated&&this.onGeometryUpdated(this,r);for(var o=0,G=this._meshes;o<G.length;o++)G[o]._markSubMeshesAsAttributesDirty()},y.prototype.load=function(r,o){this.delayLoadState!==v.a.DELAYLOADSTATE_LOADING&&(this.isReady()?o&&o():(this.delayLoadState=v.a.DELAYLOADSTATE_LOADING,this._queueLoad(r,o)))},y.prototype._queueLoad=function(r,o){var G=this;this.delayLoadingFile&&(r._addPendingData(this),r._loadFile(this.delayLoadingFile,function(M){if(G._delayLoadingFunction){G._delayLoadingFunction(JSON.parse(M),G),G.delayLoadState=v.a.DELAYLOADSTATE_LOADED,G._delayInfo=[],r._removePendingData(G);for(var R=G._meshes,W=R.length,Y=0;Y<W;Y++)G._applyToMesh(R[Y]);o&&o()}},void 0,!0))},y.prototype.toLeftHanded=function(){var r=this.getIndices(!1);if(null!=r&&r.length>0){for(var o=0;o<r.length;o+=3){var G=r[o+0];r[o+0]=r[o+2],r[o+2]=G}this.setIndices(r)}var M=this.getVerticesData(j.b.PositionKind,!1);if(null!=M&&M.length>0){for(o=0;o<M.length;o+=3)M[o+2]=-M[o+2];this.setVerticesData(j.b.PositionKind,M,!1)}var R=this.getVerticesData(j.b.NormalKind,!1);if(null!=R&&R.length>0){for(o=0;o<R.length;o+=3)R[o+2]=-R[o+2];this.setVerticesData(j.b.NormalKind,R,!1)}},y.prototype._resetPointsArrayCache=function(){this._positions=null},y.prototype._generatePointsArray=function(){if(this._positions)return!0;var r=this.getVerticesData(j.b.PositionKind);if(!r||0===r.length)return!1;this._positions=[];for(var o=0;o<r.length;o+=3)this._positions.push(O.x.FromArray(r,o));return!0},y.prototype.isDisposed=function(){return this._isDisposed},y.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var r in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[r]);this._vertexArrayObjects={}}},y.prototype.dispose=function(){var r,o=this._meshes,G=o.length;for(r=0;r<G;r++)this.releaseForMesh(o[r]);for(var M in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[M].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=v.a.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},y.prototype.copy=function(r){var o=new q.a();o.indices=[];var G=this.getIndices();if(G)for(var M=0;M<G.length;M++)o.indices.push(G[M]);var R,W=!1,Y=!1;for(R in this._vertexBuffers){var X=this.getVerticesData(R);if(X&&(X instanceof Float32Array?o.set(new Float32Array(X),R):o.set(X.slice(0),R),!Y)){var ea=this.getVertexBuffer(R);ea&&(Y=!(W=ea.isUpdatable()))}}var ca=new y(r,this._scene,o,W);for(R in ca.delayLoadState=this.delayLoadState,ca.delayLoadingFile=this.delayLoadingFile,ca._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)ca._delayInfo=ca._delayInfo||[],ca._delayInfo.push(R);return ca._boundingInfo=new A.a(this._extend.minimum,this._extend.maximum),ca},y.prototype.serialize=function(){var r={};return r.id=this.id,r.updatable=this._updatable,u.a&&u.a.HasTags(this)&&(r.tags=u.a.GetTags(this)),r},y.prototype.toNumberArray=function(r){return Array.isArray(r)?r:Array.prototype.slice.call(r)},y.prototype.serializeVerticeData=function(){var r=this.serialize();return this.isVerticesDataPresent(j.b.PositionKind)&&(r.positions=this.toNumberArray(this.getVerticesData(j.b.PositionKind)),this.isVertexBufferUpdatable(j.b.PositionKind)&&(r.positions._updatable=!0)),this.isVerticesDataPresent(j.b.NormalKind)&&(r.normals=this.toNumberArray(this.getVerticesData(j.b.NormalKind)),this.isVertexBufferUpdatable(j.b.NormalKind)&&(r.normals._updatable=!0)),this.isVerticesDataPresent(j.b.TangentKind)&&(r.tangets=this.toNumberArray(this.getVerticesData(j.b.TangentKind)),this.isVertexBufferUpdatable(j.b.TangentKind)&&(r.tangets._updatable=!0)),this.isVerticesDataPresent(j.b.UVKind)&&(r.uvs=this.toNumberArray(this.getVerticesData(j.b.UVKind)),this.isVertexBufferUpdatable(j.b.UVKind)&&(r.uvs._updatable=!0)),this.isVerticesDataPresent(j.b.UV2Kind)&&(r.uv2s=this.toNumberArray(this.getVerticesData(j.b.UV2Kind)),this.isVertexBufferUpdatable(j.b.UV2Kind)&&(r.uv2s._updatable=!0)),this.isVerticesDataPresent(j.b.UV3Kind)&&(r.uv3s=this.toNumberArray(this.getVerticesData(j.b.UV3Kind)),this.isVertexBufferUpdatable(j.b.UV3Kind)&&(r.uv3s._updatable=!0)),this.isVerticesDataPresent(j.b.UV4Kind)&&(r.uv4s=this.toNumberArray(this.getVerticesData(j.b.UV4Kind)),this.isVertexBufferUpdatable(j.b.UV4Kind)&&(r.uv4s._updatable=!0)),this.isVerticesDataPresent(j.b.UV5Kind)&&(r.uv5s=this.toNumberArray(this.getVerticesData(j.b.UV5Kind)),this.isVertexBufferUpdatable(j.b.UV5Kind)&&(r.uv5s._updatable=!0)),this.isVerticesDataPresent(j.b.UV6Kind)&&(r.uv6s=this.toNumberArray(this.getVerticesData(j.b.UV6Kind)),this.isVertexBufferUpdatable(j.b.UV6Kind)&&(r.uv6s._updatable=!0)),this.isVerticesDataPresent(j.b.ColorKind)&&(r.colors=this.toNumberArray(this.getVerticesData(j.b.ColorKind)),this.isVertexBufferUpdatable(j.b.ColorKind)&&(r.colors._updatable=!0)),this.isVerticesDataPresent(j.b.MatricesIndicesKind)&&(r.matricesIndices=this.toNumberArray(this.getVerticesData(j.b.MatricesIndicesKind)),r.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(j.b.MatricesIndicesKind)&&(r.matricesIndices._updatable=!0)),this.isVerticesDataPresent(j.b.MatricesWeightsKind)&&(r.matricesWeights=this.toNumberArray(this.getVerticesData(j.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(j.b.MatricesWeightsKind)&&(r.matricesWeights._updatable=!0)),r.indices=this.toNumberArray(this.getIndices()),r},y.ExtractFromMesh=function(r,o){var G=r._geometry;return G?G.copy(o):null},y.RandomId=function(){return z.h.RandomId()},y._ImportGeometry=function(r,o){var G=o.getScene(),M=r.geometryId;if(M){var R=G.getGeometryByID(M);R&&R.applyToMesh(o)}else if(r instanceof ArrayBuffer){var W=o._binaryInfo;if(W.positionsAttrDesc&&W.positionsAttrDesc.count>0){var Y=new Float32Array(r,W.positionsAttrDesc.offset,W.positionsAttrDesc.count);o.setVerticesData(j.b.PositionKind,Y,!1)}if(W.normalsAttrDesc&&W.normalsAttrDesc.count>0){var X=new Float32Array(r,W.normalsAttrDesc.offset,W.normalsAttrDesc.count);o.setVerticesData(j.b.NormalKind,X,!1)}if(W.tangetsAttrDesc&&W.tangetsAttrDesc.count>0){var ea=new Float32Array(r,W.tangetsAttrDesc.offset,W.tangetsAttrDesc.count);o.setVerticesData(j.b.TangentKind,ea,!1)}if(W.uvsAttrDesc&&W.uvsAttrDesc.count>0){var ca=new Float32Array(r,W.uvsAttrDesc.offset,W.uvsAttrDesc.count);o.setVerticesData(j.b.UVKind,ca,!1)}if(W.uvs2AttrDesc&&W.uvs2AttrDesc.count>0){var oa=new Float32Array(r,W.uvs2AttrDesc.offset,W.uvs2AttrDesc.count);o.setVerticesData(j.b.UV2Kind,oa,!1)}if(W.uvs3AttrDesc&&W.uvs3AttrDesc.count>0){var Z=new Float32Array(r,W.uvs3AttrDesc.offset,W.uvs3AttrDesc.count);o.setVerticesData(j.b.UV3Kind,Z,!1)}if(W.uvs4AttrDesc&&W.uvs4AttrDesc.count>0){var T=new Float32Array(r,W.uvs4AttrDesc.offset,W.uvs4AttrDesc.count);o.setVerticesData(j.b.UV4Kind,T,!1)}if(W.uvs5AttrDesc&&W.uvs5AttrDesc.count>0){var V=new Float32Array(r,W.uvs5AttrDesc.offset,W.uvs5AttrDesc.count);o.setVerticesData(j.b.UV5Kind,V,!1)}if(W.uvs6AttrDesc&&W.uvs6AttrDesc.count>0){var D=new Float32Array(r,W.uvs6AttrDesc.offset,W.uvs6AttrDesc.count);o.setVerticesData(j.b.UV6Kind,D,!1)}if(W.colorsAttrDesc&&W.colorsAttrDesc.count>0){var F=new Float32Array(r,W.colorsAttrDesc.offset,W.colorsAttrDesc.count);o.setVerticesData(j.b.ColorKind,F,!1,W.colorsAttrDesc.stride)}if(W.matricesIndicesAttrDesc&&W.matricesIndicesAttrDesc.count>0){for(var L=new Int32Array(r,W.matricesIndicesAttrDesc.offset,W.matricesIndicesAttrDesc.count),N=[],p=0;p<L.length;p++){var g=L[p];N.push(255&g),N.push((65280&g)>>8),N.push((16711680&g)>>16),N.push(g>>24)}o.setVerticesData(j.b.MatricesIndicesKind,N,!1)}if(W.matricesWeightsAttrDesc&&W.matricesWeightsAttrDesc.count>0){var n=new Float32Array(r,W.matricesWeightsAttrDesc.offset,W.matricesWeightsAttrDesc.count);o.setVerticesData(j.b.MatricesWeightsKind,n,!1)}if(W.indicesAttrDesc&&W.indicesAttrDesc.count>0){var s=new Int32Array(r,W.indicesAttrDesc.offset,W.indicesAttrDesc.count);o.setIndices(s,null)}if(W.subMeshesAttrDesc&&W.subMeshesAttrDesc.count>0){var t=new Int32Array(r,W.subMeshesAttrDesc.offset,5*W.subMeshesAttrDesc.count);for(o.subMeshes=[],p=0;p<W.subMeshesAttrDesc.count;p++){var C=t[5*p+0],J=t[5*p+1],Q=t[5*p+2],$=t[5*p+3],aa=t[5*p+4];I.b.AddToMesh(C,J,Q,$,aa,o)}}}else if(r.positions&&r.normals&&r.indices){if(o.setVerticesData(j.b.PositionKind,r.positions,r.positions._updatable),o.setVerticesData(j.b.NormalKind,r.normals,r.normals._updatable),r.tangents&&o.setVerticesData(j.b.TangentKind,r.tangents,r.tangents._updatable),r.uvs&&o.setVerticesData(j.b.UVKind,r.uvs,r.uvs._updatable),r.uvs2&&o.setVerticesData(j.b.UV2Kind,r.uvs2,r.uvs2._updatable),r.uvs3&&o.setVerticesData(j.b.UV3Kind,r.uvs3,r.uvs3._updatable),r.uvs4&&o.setVerticesData(j.b.UV4Kind,r.uvs4,r.uvs4._updatable),r.uvs5&&o.setVerticesData(j.b.UV5Kind,r.uvs5,r.uvs5._updatable),r.uvs6&&o.setVerticesData(j.b.UV6Kind,r.uvs6,r.uvs6._updatable),r.colors&&o.setVerticesData(j.b.ColorKind,O.f.CheckColors4(r.colors,r.positions.length/3),r.colors._updatable),r.matricesIndices)if(r.matricesIndices._isExpanded)delete r.matricesIndices._isExpanded,o.setVerticesData(j.b.MatricesIndicesKind,r.matricesIndices,r.matricesIndices._updatable);else{for(N=[],p=0;p<r.matricesIndices.length;p++){var ba=r.matricesIndices[p];N.push(255&ba),N.push((65280&ba)>>8),N.push((16711680&ba)>>16),N.push(ba>>24)}o.setVerticesData(j.b.MatricesIndicesKind,N,r.matricesIndices._updatable)}if(r.matricesIndicesExtra)if(r.matricesIndicesExtra._isExpanded)delete r.matricesIndices._isExpanded,o.setVerticesData(j.b.MatricesIndicesExtraKind,r.matricesIndicesExtra,r.matricesIndicesExtra._updatable);else{for(N=[],p=0;p<r.matricesIndicesExtra.length;p++)ba=r.matricesIndicesExtra[p],N.push(255&ba),N.push((65280&ba)>>8),N.push((16711680&ba)>>16),N.push(ba>>24);o.setVerticesData(j.b.MatricesIndicesExtraKind,N,r.matricesIndicesExtra._updatable)}r.matricesWeights&&(y._CleanMatricesWeights(r,o),o.setVerticesData(j.b.MatricesWeightsKind,r.matricesWeights,r.matricesWeights._updatable)),r.matricesWeightsExtra&&o.setVerticesData(j.b.MatricesWeightsExtraKind,r.matricesWeightsExtra,r.matricesWeights._updatable),o.setIndices(r.indices,null)}if(r.subMeshes){o.subMeshes=[];for(var ia=0;ia<r.subMeshes.length;ia++){var qa=r.subMeshes[ia];I.b.AddToMesh(qa.materialIndex,qa.verticesStart,qa.verticesCount,qa.indexStart,qa.indexCount,o)}}o._shouldGenerateFlatShading&&(o.convertToFlatShadedMesh(),delete o._shouldGenerateFlatShading),o.computeWorldMatrix(!0),G.onMeshImportedObservable.notifyObservers(o)},y._CleanMatricesWeights=function(r,o){if(H.a.CleanBoneMatrixWeights){var G=0;if(r.skeletonId>-1){var M=o.getScene().getLastSkeletonByID(r.skeletonId);if(M){G=M.bones.length;for(var R=o.getVerticesData(j.b.MatricesIndicesKind),W=o.getVerticesData(j.b.MatricesIndicesExtraKind),Y=r.matricesWeights,X=r.matricesWeightsExtra,ea=r.numBoneInfluencer,ca=Y.length,oa=0;oa<ca;oa+=4){for(var Z=0,T=-1,V=0;V<4;V++)Z+=D=Y[oa+V],D<.001&&T<0&&(T=V);if(X)for(V=0;V<4;V++){var D;Z+=D=X[oa+V],D<.001&&T<0&&(T=V+4)}if((T<0||T>ea-1)&&(T=ea-1),Z>.001){var F=1/Z;for(V=0;V<4;V++)Y[oa+V]*=F;if(X)for(V=0;V<4;V++)X[oa+V]*=F}else T>=4?(X[oa+T-4]=1-Z,W[oa+T-4]=G):(Y[oa+T]=1-Z,R[oa+T]=G)}o.setVerticesData(j.b.MatricesIndicesKind,R),r.matricesWeightsExtra&&o.setVerticesData(j.b.MatricesIndicesExtraKind,W)}}}},y.Parse=function(r,o,G){if(o.getGeometryByID(r.id))return null;var M=new y(r.id,o,void 0,r.updatable);return u.a&&u.a.AddTagsTo(M,r.tags),r.delayLoadingFile?(M.delayLoadState=v.a.DELAYLOADSTATE_NOTLOADED,M.delayLoadingFile=G+r.delayLoadingFile,M._boundingInfo=new A.a(O.x.FromArray(r.boundingBoxMinimum),O.x.FromArray(r.boundingBoxMaximum)),M._delayInfo=[],r.hasUVs&&M._delayInfo.push(j.b.UVKind),r.hasUVs2&&M._delayInfo.push(j.b.UV2Kind),r.hasUVs3&&M._delayInfo.push(j.b.UV3Kind),r.hasUVs4&&M._delayInfo.push(j.b.UV4Kind),r.hasUVs5&&M._delayInfo.push(j.b.UV5Kind),r.hasUVs6&&M._delayInfo.push(j.b.UV6Kind),r.hasColors&&M._delayInfo.push(j.b.ColorKind),r.hasMatricesIndices&&M._delayInfo.push(j.b.MatricesIndicesKind),r.hasMatricesWeights&&M._delayInfo.push(j.b.MatricesWeightsKind),M._delayLoadingFunction=q.a.ImportVertexData):q.a.ImportVertexData(r,M),o.pushGeometry(M,!0),M},y}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return w});var O=l(1),q=l(8),j=l(0),I=l(42),H=l(53),A=l(54),v=l(48),z=l(41),u=l(33),w=function(y){function r(o,G,M){void 0===G&&(G=j.e.Gray()),void 0===M&&(M=z.a.DefaultUtilityLayer);var R=y.call(this,M)||this;R._pointerObserver=null,R.snapDistance=0,R.onSnapObservable=new q.c();var W=new u.a("",M.utilityLayerScene);W.diffuseColor=G,W.specularColor=G.subtract(new j.e(.1,.1,.1));var Y=new u.a("",M.utilityLayerScene);Y.diffuseColor=G.add(new j.e(.3,.3,.3));var X=r._CreateArrow(M.utilityLayerScene,W);X.lookAt(R._rootMesh.position.add(o)),X.scaling.scaleInPlace(1/3),X.parent=R._rootMesh;var ea=0,ca=new j.x(),oa={snapDistance:0};R.dragBehavior=new A.a({dragAxis:o}),R.dragBehavior.moveAttached=!1,R._rootMesh.addBehavior(R.dragBehavior);var Z=new j.x(),T=new j.j();R.dragBehavior.onDragObservable.add(function(D){if(R.attachedMesh){if(R.attachedMesh.parent?(R.attachedMesh.parent.computeWorldMatrix().invertToRef(T),T.setTranslationFromFloats(0,0,0),j.x.TransformCoordinatesToRef(D.delta,T,Z)):Z.copyFrom(D.delta),0==R.snapDistance)R.attachedMesh.position.addInPlace(Z);else if(ea+=D.dragDistance,Math.abs(ea)>R.snapDistance){var F=Math.floor(Math.abs(ea)/R.snapDistance);ea%=R.snapDistance,Z.normalizeToRef(ca),ca.scaleInPlace(R.snapDistance*F),R.attachedMesh.position.addInPlace(ca),oa.snapDistance=R.snapDistance*F,R.onSnapObservable.notifyObservers(oa)}}}),R._pointerObserver=M.utilityLayerScene.onPointerObservable.add(function(D){if(!R._customMeshSet){var F=D.pickInfo&&-1!=R._rootMesh.getChildMeshes().indexOf(D.pickInfo.pickedMesh)?Y:W;R._rootMesh.getChildMeshes().forEach(function(L){L.material=F,L.color&&(L.color=F.diffuseColor)})}});var V=M._getSharedGizmoLight();return V.includedOnlyMeshes=V.includedOnlyMeshes.concat(R._rootMesh.getChildMeshes(!1)),R}return O.d(r,y),r._CreateArrow=function(o,G){var M=new I.a("arrow",o),R=H.a.CreateCylinder("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375,tessellation:96},o),W=H.a.CreateCylinder("cylinder",{diameterTop:.005,height:.275,diameterBottom:.005,tessellation:96},o);return W.material=G,R.parent=M,W.parent=M,R.material=G,R.rotation.x=Math.PI/2,R.position.z+=.3,W.position.z+=.1375,W.rotation.x=Math.PI/2,M},r._CreateArrowInstance=function(o,G){for(var M=new I.a("arrow",o),R=0,W=G.getChildMeshes();R<W.length;R++){var Y=W[R];Y.createInstance(Y.name).parent=M}return M},r.prototype._attachedMeshChanged=function(o){this.dragBehavior&&(this.dragBehavior.enabled=!!o)},r.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),y.prototype.dispose.call(this)},r}(v.a)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return q.FilesToLoad={},q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){this._xhr=new XMLHttpRequest()}return q.prototype._injectCustomRequestHeaders=function(){for(var j in q.CustomRequestHeaders){var I=q.CustomRequestHeaders[j];I&&this._xhr.setRequestHeader(j,I)}},Object.defineProperty(q.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(j){this._xhr.onprogress=j},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"status",{get:function(){return this._xhr.status},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"response",{get:function(){return this._xhr.response},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(j){this._xhr.responseType=j},enumerable:!0,configurable:!0}),q.prototype.addEventListener=function(j,I,H){this._xhr.addEventListener(j,I,H)},q.prototype.removeEventListener=function(j,I,H){this._xhr.removeEventListener(j,I,H)},q.prototype.abort=function(){this._xhr.abort()},q.prototype.send=function(j){q.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(j)},q.prototype.open=function(j,I){for(var H=0,A=q.CustomRequestModifiers;H<A.length;H++)(0,A[H])(this._xhr);return this._xhr.open(j,I,!0)},q.CustomRequestHeaders={},q.CustomRequestModifiers=new Array(),q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){this._count=0,this._data={}}return q.prototype.copyFrom=function(j){var I=this;this.clear(),j.forEach(function(H,A){return I.add(H,A)})},q.prototype.get=function(j){var I=this._data[j];if(void 0!==I)return I},q.prototype.getOrAddWithFactory=function(j,I){var H=this.get(j);return void 0!==H?H:((H=I(j))&&this.add(j,H),H)},q.prototype.getOrAdd=function(j,I){var H=this.get(j);return void 0!==H?H:(this.add(j,I),I)},q.prototype.contains=function(j){return void 0!==this._data[j]},q.prototype.add=function(j,I){return void 0===this._data[j]&&(this._data[j]=I,++this._count,!0)},q.prototype.set=function(j,I){return void 0!==this._data[j]&&(this._data[j]=I,!0)},q.prototype.getAndRemove=function(j){var I=this.get(j);return void 0!==I?(delete this._data[j],--this._count,I):null},q.prototype.remove=function(j){return!!this.contains(j)&&(delete this._data[j],--this._count,!0)},q.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(q.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),q.prototype.forEach=function(j){for(var I in this._data)j(I,this._data[I])},q.prototype.first=function(j){for(var I in this._data){var H=j(I,this._data[I]);if(H)return H}return null},q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return A}),l.d(x,"b",function(){return v});var O=l(0),q=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],j=[function(z){return 1},function(z){return z.y},function(z){return z.z},function(z){return z.x},function(z){return z.x*z.y},function(z){return z.y*z.z},function(z){return 3*z.z*z.z-1},function(z){return z.x*z.z},function(z){return z.x*z.x-z.y*z.y}],I=function(z,u){return q[z]*j[z](u)},H=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],A=function(){function z(){this.preScaled=!1,this.l00=O.x.Zero(),this.l1_1=O.x.Zero(),this.l10=O.x.Zero(),this.l11=O.x.Zero(),this.l2_2=O.x.Zero(),this.l2_1=O.x.Zero(),this.l20=O.x.Zero(),this.l21=O.x.Zero(),this.l22=O.x.Zero()}return z.prototype.addLight=function(u,w,y){var r=new O.x(w.r,w.g,w.b).scale(y);this.l00=this.l00.add(r.scale(I(0,u))),this.l1_1=this.l1_1.add(r.scale(I(1,u))),this.l10=this.l10.add(r.scale(I(2,u))),this.l11=this.l11.add(r.scale(I(3,u))),this.l2_2=this.l2_2.add(r.scale(I(4,u))),this.l2_1=this.l2_1.add(r.scale(I(5,u))),this.l20=this.l20.add(r.scale(I(6,u))),this.l21=this.l21.add(r.scale(I(7,u))),this.l22=this.l22.add(r.scale(I(8,u)))},z.prototype.scaleInPlace=function(u){this.l00.scaleInPlace(u),this.l1_1.scaleInPlace(u),this.l10.scaleInPlace(u),this.l11.scaleInPlace(u),this.l2_2.scaleInPlace(u),this.l2_1.scaleInPlace(u),this.l20.scaleInPlace(u),this.l21.scaleInPlace(u),this.l22.scaleInPlace(u)},z.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(H[0]),this.l1_1.scaleInPlace(H[1]),this.l10.scaleInPlace(H[2]),this.l11.scaleInPlace(H[3]),this.l2_2.scaleInPlace(H[4]),this.l2_1.scaleInPlace(H[5]),this.l20.scaleInPlace(H[6]),this.l21.scaleInPlace(H[7]),this.l22.scaleInPlace(H[8])},z.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},z.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(q[0]),this.l1_1.scaleInPlace(q[1]),this.l10.scaleInPlace(q[2]),this.l11.scaleInPlace(q[3]),this.l2_2.scaleInPlace(q[4]),this.l2_1.scaleInPlace(q[5]),this.l20.scaleInPlace(q[6]),this.l21.scaleInPlace(q[7]),this.l22.scaleInPlace(q[8])},z.FromArray=function(u){var w=new z();return O.x.FromArrayToRef(u[0],0,w.l00),O.x.FromArrayToRef(u[1],0,w.l1_1),O.x.FromArrayToRef(u[2],0,w.l10),O.x.FromArrayToRef(u[3],0,w.l11),O.x.FromArrayToRef(u[4],0,w.l2_2),O.x.FromArrayToRef(u[5],0,w.l2_1),O.x.FromArrayToRef(u[6],0,w.l20),O.x.FromArrayToRef(u[7],0,w.l21),O.x.FromArrayToRef(u[8],0,w.l22),w},z.FromPolynomial=function(u){var w=new z();return w.l00=u.xx.scale(.376127).add(u.yy.scale(.376127)).add(u.zz.scale(.376126)),w.l1_1=u.y.scale(.977204),w.l10=u.z.scale(.977204),w.l11=u.x.scale(.977204),w.l2_2=u.xy.scale(1.16538),w.l2_1=u.yz.scale(1.16538),w.l20=u.zz.scale(1.34567).subtract(u.xx.scale(.672834)).subtract(u.yy.scale(.672834)),w.l21=u.zx.scale(1.16538),w.l22=u.xx.scale(1.16538).subtract(u.yy.scale(1.16538)),w.l1_1.scaleInPlace(-1),w.l11.scaleInPlace(-1),w.l2_1.scaleInPlace(-1),w.l21.scaleInPlace(-1),w.scaleInPlace(Math.PI),w},z}(),v=function(){function z(){this.x=O.x.Zero(),this.y=O.x.Zero(),this.z=O.x.Zero(),this.xx=O.x.Zero(),this.yy=O.x.Zero(),this.zz=O.x.Zero(),this.xy=O.x.Zero(),this.yz=O.x.Zero(),this.zx=O.x.Zero()}return Object.defineProperty(z.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=A.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!0,configurable:!0}),z.prototype.addAmbient=function(u){var w=new O.x(u.r,u.g,u.b);this.xx=this.xx.add(w),this.yy=this.yy.add(w),this.zz=this.zz.add(w)},z.prototype.scaleInPlace=function(u){this.x.scaleInPlace(u),this.y.scaleInPlace(u),this.z.scaleInPlace(u),this.xx.scaleInPlace(u),this.yy.scaleInPlace(u),this.zz.scaleInPlace(u),this.yz.scaleInPlace(u),this.zx.scaleInPlace(u),this.xy.scaleInPlace(u)},z.FromHarmonics=function(u){var w=new z();return w._harmonics=u,w.x=u.l11.scale(1.02333).scale(-1),w.y=u.l1_1.scale(1.02333).scale(-1),w.z=u.l10.scale(1.02333),w.xx=u.l00.scale(.886277).subtract(u.l20.scale(.247708)).add(u.l22.scale(.429043)),w.yy=u.l00.scale(.886277).subtract(u.l20.scale(.247708)).subtract(u.l22.scale(.429043)),w.zz=u.l00.scale(.886277).add(u.l20.scale(.495417)),w.yz=u.l2_1.scale(.858086).scale(-1),w.zx=u.l21.scale(.858086).scale(-1),w.xy=u.l2_2.scale(.858086),w.scaleInPlace(1/Math.PI),w},z.FromArray=function(u){var w=new z();return O.x.FromArrayToRef(u[0],0,w.x),O.x.FromArrayToRef(u[1],0,w.y),O.x.FromArrayToRef(u[2],0,w.z),O.x.FromArrayToRef(u[3],0,w.xx),O.x.FromArrayToRef(u[4],0,w.yy),O.x.FromArrayToRef(u[5],0,w.zz),O.x.FromArrayToRef(u[6],0,w.yz),O.x.FromArrayToRef(u[7],0,w.zx),O.x.FromArrayToRef(u[8],0,w.xy),w},z}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q});var O=l(6),q=function(){function j(I,H,A){this._engine=I,this._noUBO=!I.supportsUniformBuffers,this._dynamic=A,this._data=H||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(j.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(j.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),j.prototype.isDynamic=function(){return void 0!==this._dynamic},j.prototype.getData=function(){return this._bufferData},j.prototype.getBuffer=function(){return this._buffer},j.prototype._fillAlignment=function(I){var H;if(H=I<=2?I:4,this._uniformLocationPointer%H!=0){var A=this._uniformLocationPointer;this._uniformLocationPointer+=H-this._uniformLocationPointer%H;for(var v=this._uniformLocationPointer-A,z=0;z<v;z++)this._data.push(0)}},j.prototype.addUniform=function(I,H){if(!this._noUBO&&void 0===this._uniformLocations[I]){var A;if(H instanceof Array)H=(A=H).length;else{H=H,A=[];for(var v=0;v<H;v++)A.push(0)}for(this._fillAlignment(H),this._uniformSizes[I]=H,this._uniformLocations[I]=this._uniformLocationPointer,this._uniformLocationPointer+=H,v=0;v<H;v++)this._data.push(A[v]);this._needSync=!0}},j.prototype.addMatrix=function(I,H){this.addUniform(I,Array.prototype.slice.call(H.toArray()))},j.prototype.addFloat2=function(I,H,A){var v=[H,A];this.addUniform(I,v)},j.prototype.addFloat3=function(I,H,A,v){var z=[H,A,v];this.addUniform(I,z)},j.prototype.addColor3=function(I,H){var A=new Array();H.toArray(A),this.addUniform(I,A)},j.prototype.addColor4=function(I,H,A){var v=new Array();H.toArray(v),v.push(A),this.addUniform(I,v)},j.prototype.addVector3=function(I,H){var A=new Array();H.toArray(A),this.addUniform(I,A)},j.prototype.addMatrix3x3=function(I){this.addUniform(I,12)},j.prototype.addMatrix2x2=function(I){this.addUniform(I,8)},j.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},j.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},j.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},j.prototype.updateUniform=function(I,H,A){var v=this._uniformLocations[I];if(void 0===v){if(this._buffer)return void O.a.Error("Cannot add an uniform after UBO has been created.");this.addUniform(I,A),v=this._uniformLocations[I]}if(this._buffer||this.create(),this._dynamic)for(u=0;u<A;u++)this._bufferData[v+u]=H[u];else{for(var z=!1,u=0;u<A;u++)this._bufferData[v+u]!==H[u]&&(z=!0,this._bufferData[v+u]=H[u]);this._needSync=this._needSync||z}},j.prototype._updateMatrix3x3ForUniform=function(I,H){for(var A=0;A<3;A++)j._tempBuffer[4*A]=H[3*A],j._tempBuffer[4*A+1]=H[3*A+1],j._tempBuffer[4*A+2]=H[3*A+2],j._tempBuffer[4*A+3]=0;this.updateUniform(I,j._tempBuffer,12)},j.prototype._updateMatrix3x3ForEffect=function(I,H){this._currentEffect.setMatrix3x3(I,H)},j.prototype._updateMatrix2x2ForEffect=function(I,H){this._currentEffect.setMatrix2x2(I,H)},j.prototype._updateMatrix2x2ForUniform=function(I,H){for(var A=0;A<2;A++)j._tempBuffer[4*A]=H[2*A],j._tempBuffer[4*A+1]=H[2*A+1],j._tempBuffer[4*A+2]=0,j._tempBuffer[4*A+3]=0;this.updateUniform(I,j._tempBuffer,8)},j.prototype._updateFloatForEffect=function(I,H){this._currentEffect.setFloat(I,H)},j.prototype._updateFloatForUniform=function(I,H){j._tempBuffer[0]=H,this.updateUniform(I,j._tempBuffer,1)},j.prototype._updateFloat2ForEffect=function(I,H,A,v){void 0===v&&(v=""),this._currentEffect.setFloat2(I+v,H,A)},j.prototype._updateFloat2ForUniform=function(I,H,A){j._tempBuffer[0]=H,j._tempBuffer[1]=A,this.updateUniform(I,j._tempBuffer,2)},j.prototype._updateFloat3ForEffect=function(I,H,A,v,z){void 0===z&&(z=""),this._currentEffect.setFloat3(I+z,H,A,v)},j.prototype._updateFloat3ForUniform=function(I,H,A,v){j._tempBuffer[0]=H,j._tempBuffer[1]=A,j._tempBuffer[2]=v,this.updateUniform(I,j._tempBuffer,3)},j.prototype._updateFloat4ForEffect=function(I,H,A,v,z,u){void 0===u&&(u=""),this._currentEffect.setFloat4(I+u,H,A,v,z)},j.prototype._updateFloat4ForUniform=function(I,H,A,v,z){j._tempBuffer[0]=H,j._tempBuffer[1]=A,j._tempBuffer[2]=v,j._tempBuffer[3]=z,this.updateUniform(I,j._tempBuffer,4)},j.prototype._updateMatrixForEffect=function(I,H){this._currentEffect.setMatrix(I,H)},j.prototype._updateMatrixForUniform=function(I,H){this.updateUniform(I,H.toArray(),16)},j.prototype._updateVector3ForEffect=function(I,H){this._currentEffect.setVector3(I,H)},j.prototype._updateVector3ForUniform=function(I,H){H.toArray(j._tempBuffer),this.updateUniform(I,j._tempBuffer,3)},j.prototype._updateVector4ForEffect=function(I,H){this._currentEffect.setVector4(I,H)},j.prototype._updateVector4ForUniform=function(I,H){H.toArray(j._tempBuffer),this.updateUniform(I,j._tempBuffer,4)},j.prototype._updateColor3ForEffect=function(I,H,A){void 0===A&&(A=""),this._currentEffect.setColor3(I+A,H)},j.prototype._updateColor3ForUniform=function(I,H){H.toArray(j._tempBuffer),this.updateUniform(I,j._tempBuffer,3)},j.prototype._updateColor4ForEffect=function(I,H,A,v){void 0===v&&(v=""),this._currentEffect.setColor4(I+v,H,A)},j.prototype._updateColor4ForUniform=function(I,H,A){H.toArray(j._tempBuffer),j._tempBuffer[3]=A,this.updateUniform(I,j._tempBuffer,4)},j.prototype.setTexture=function(I,H){this._currentEffect.setTexture(I,H)},j.prototype.updateUniformDirectly=function(I,H){this.updateUniform(I,H,H.length),this.update()},j.prototype.bindToEffect=function(I,H){this._currentEffect=I,!this._noUBO&&this._buffer&&I.bindUniformBuffer(this._buffer,H)},j.prototype.dispose=function(){if(!this._noUBO){var I=this._engine._uniformBuffers,H=I.indexOf(this);-1!==H&&(I[H]=I[I.length-1],I.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},j._MAX_UNIFORM_SIZE=256,j._tempBuffer=new Float32Array(j._MAX_UNIFORM_SIZE),j}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){this._isDirty=!0,this._areLightsDirty=!0,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(q.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),q.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},q.prototype.markAsUnprocessed=function(){this._isDirty=!0},q.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},q.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},q.prototype.markAsLightDirty=function(){this._areLightsDirty=!0,this._isDirty=!0},q.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},q.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},q.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},q.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},q.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var j=0,I=Object.keys(this);j<I.length;j++){var H=I[j];"_"!==H[0]&&this._keys.push(H)}},q.prototype.isEqual=function(j){if(this._keys.length!==j._keys.length)return!1;for(var I=0;I<this._keys.length;I++){var H=this._keys[I];if(this[H]!==j[H])return!1}return!0},q.prototype.cloneTo=function(j){this._keys.length!==j._keys.length&&(j._keys=this._keys.slice(0));for(var I=0;I<this._keys.length;I++){var H=this._keys[I];j[H]=this[H]}},q.prototype.reset=function(){for(var j=0;j<this._keys.length;j++){var I=this._keys[j];switch(typeof this[I]){case"number":this[I]=0;break;case"string":this[I]="";break;default:this[I]=!1}}},q.prototype.toString=function(){for(var j="",I=0;I<this._keys.length;I++){var H=this._keys[I],A=this[H];switch(typeof A){case"number":case"string":j+="#define "+H+" "+A+`
`;break;default:A&&(j+="#define "+H+`
`)}}return j},q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return A});var O=l(1),q=l(2),j=l(0),I=l(25),H=l(38);I.a.AddNodeConstructor("Light_Type_3",function(v,z){return function(){return new A(v,j.x.Zero(),z)}});var A=function(v){function z(u,w,y){var r=v.call(this,u,y)||this;return r.groundColor=new j.e(0,0,0),r.direction=w||j.x.Up(),r}return O.d(z,v),z.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},z.prototype.getClassName=function(){return"HemisphericLight"},z.prototype.setDirectionToTarget=function(u){return this.direction=j.x.Normalize(u.subtract(j.x.Zero())),this.direction},z.prototype.getShadowGenerator=function(){return null},z.prototype.transferToEffect=function(u,w){var y=j.x.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",y.x,y.y,y.z,0,w),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),w),this},z.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=j.j.Identity()),this._worldMatrix},z.prototype.getTypeID=function(){return H.a.LIGHTTYPEID_HEMISPHERICLIGHT},z.prototype.prepareLightSpecificDefines=function(u,w){u["HEMILIGHT"+w]=!0},O.c([Object(q.e)()],z.prototype,"groundColor",void 0),O.c([Object(q.o)()],z.prototype,"direction",void 0),z}(H.a)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return H});var O=l(1),q=l(20),j=l(29),I=l(22),H=function(A){function v(z,u){var w=A.call(this,z,u,!0)||this;return u.multiMaterials.push(w),w.subMaterials=new Array(),w._storeEffectOnSubMeshes=!0,w}return O.d(v,A),Object.defineProperty(v.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(z){this._subMaterials=z,this._hookArray(z)},enumerable:!0,configurable:!0}),v.prototype.getChildren=function(){return this.subMaterials},v.prototype._hookArray=function(z){var u=this,w=z.push;z.push=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var G=w.apply(z,r);return u._markAllSubMeshesAsTexturesDirty(),G};var y=z.splice;z.splice=function(r,o){var G=y.apply(z,[r,o]);return u._markAllSubMeshesAsTexturesDirty(),G}},v.prototype.getSubMaterial=function(z){return z<0||z>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[z]},v.prototype.getActiveTextures=function(){var z;return(z=A.prototype.getActiveTextures.call(this)).concat.apply(z,this.subMaterials.map(function(u){return u?u.getActiveTextures():[]}))},v.prototype.getClassName=function(){return"MultiMaterial"},v.prototype.isReadyForSubMesh=function(z,u,w){for(var y=0;y<this.subMaterials.length;y++){var r=this.subMaterials[y];if(r){if(r._storeEffectOnSubMeshes){if(!r.isReadyForSubMesh(z,u,w))return!1;continue}if(!r.isReady(z))return!1}}return!0},v.prototype.clone=function(z,u){for(var w=new v(z,this.getScene()),y=0;y<this.subMaterials.length;y++){var r=null,o=this.subMaterials[y];r=u&&o?o.clone(z+"-"+o.name):this.subMaterials[y],w.subMaterials.push(r)}return w},v.prototype.serialize=function(){var z={};z.name=this.name,z.id=this.id,j.a&&(z.tags=j.a.GetTags(this)),z.materials=[];for(var u=0;u<this.subMaterials.length;u++){var w=this.subMaterials[u];w?z.materials.push(w.id):z.materials.push(null)}return z},v.prototype.dispose=function(z,u,w){var y=this.getScene();if(y){if(w)for(var r=0;r<this.subMaterials.length;r++){var o=this.subMaterials[r];o&&o.dispose(z,u)}(r=y.multiMaterials.indexOf(this))>=0&&y.multiMaterials.splice(r,1),A.prototype.dispose.call(this,z,u)}},v.ParseMultiMaterial=function(z,u){var w=new v(z.name,u);w.id=z.id,j.a&&j.a.AddTagsTo(w,z.tags);for(var y=0;y<z.materials.length;y++){var r=z.materials[y];r?w.subMaterials.push(u.getMaterialByID(r)):w.subMaterials.push(null)}return w},v}(q.a);I.a.RegisteredTypes["BABYLON.MultiMaterial"]=H},function(Aa,x,l){"use strict";var O="bonesDeclaration",q=`#if NUM_BONE_INFLUENCERS>0
#ifdef BONETEXTURE
uniform sampler2D boneSampler;
uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#endif
attribute vec4 matricesIndices;
attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;
attribute vec4 matricesWeightsExtra;
#endif
#ifdef BONETEXTURE
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{
float offset=index*4.0;
float dx=1.0/boneTextureWidth;
vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));
vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));
vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));
vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));
return mat4(m0,m1,m2,m3);
}
#endif
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="instancesDeclaration",q=`#ifdef INSTANCES
attribute vec4 world0;
attribute vec4 world1;
attribute vec4 world2;
attribute vec4 world3;
#else
uniform mat4 world;
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="instancesVertex",q=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#else
mat4 finalWorld=world;
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O=`#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif`;l(5).a.IncludesShadersStore.bonesVertex=O},function(Aa,x,l){"use strict";l.d(x,"a",function(){return A});var O=l(0),q=l(12),j=l(62),I=l(3),H=function(){return function(v,z,u,w){this.name=v,this.worldAxisForNormal=z,this.worldAxisForFileX=u,this.worldAxisForFileY=w}}(),A=function(){function v(){}return v.ConvertCubeMapTextureToSphericalPolynomial=function(z){if(!z.isCube)return null;var u,w,y=z.getSize().width,r=z.readPixels(0),o=z.readPixels(1);z.isRenderTarget?(u=z.readPixels(3),w=z.readPixels(2)):(u=z.readPixels(2),w=z.readPixels(3));var G=z.readPixels(4),M=z.readPixels(5),R=z.gammaSpace,W=I.a.TEXTUREFORMAT_RGBA,Y=I.a.TEXTURETYPE_UNSIGNED_INT;z.textureType&&z.textureType!==I.a.TEXTURETYPE_UNSIGNED_INT&&(Y=I.a.TEXTURETYPE_FLOAT);var X={size:y,right:r,left:o,up:u,down:w,front:G,back:M,format:W,type:Y,gammaSpace:R};return this.ConvertCubeMapToSphericalPolynomial(X)},v.ConvertCubeMapToSphericalPolynomial=function(z){for(var u=new j.a(),w=0,y=2/z.size,r=y,o=.5*y-1,G=0;G<6;G++)for(var M=this.FileFaces[G],R=z[M.name],W=o,Y=z.format===I.a.TEXTUREFORMAT_RGBA?4:3,X=0;X<z.size;X++){for(var ea=o,ca=0;ca<z.size;ca++){var oa=M.worldAxisForFileX.scale(ea).add(M.worldAxisForFileY.scale(W)).add(M.worldAxisForNormal);oa.normalize();var Z=Math.pow(1+ea*ea+W*W,-1.5),T=R[X*z.size*Y+ca*Y+0],V=R[X*z.size*Y+ca*Y+1],D=R[X*z.size*Y+ca*Y+2];z.type===I.a.TEXTURETYPE_UNSIGNED_INT&&(T/=255,V/=255,D/=255),z.gammaSpace&&(T=Math.pow(q.a.Clamp(T),O.v),V=Math.pow(q.a.Clamp(V),O.v),D=Math.pow(q.a.Clamp(D),O.v));var F=new O.e(T,V,D);u.addLight(oa,F,Z),w+=Z,ea+=y}W+=r}var L=6*(4*Math.PI)/6/w;return u.scaleInPlace(L),u.convertIncidentRadianceToIrradiance(),u.convertIrradianceToLambertianRadiance(),j.b.FromHarmonics(u)},v.FileFaces=[new H("right",new O.x(1,0,0),new O.x(0,0,-1),new O.x(0,-1,0)),new H("left",new O.x(-1,0,0),new O.x(0,0,1),new O.x(0,-1,0)),new H("up",new O.x(0,1,0),new O.x(1,0,0),new O.x(0,0,1)),new H("down",new O.x(0,-1,0),new O.x(1,0,0),new O.x(0,0,-1)),new H("front",new O.x(0,0,1),new O.x(1,0,0),new O.x(0,-1,0)),new H("back",new O.x(0,0,-1),new O.x(-1,0,0),new O.x(0,-1,0))],v}()},function(Aa,x,l){"use strict";l.d(x,"b",function(){return u}),l.d(x,"a",function(){return w});var O=l(1),q=l(0),j=l(4),I=l(11),H=l(111),A=l(20),v=l(76),z=(l(126),l(127),l(15)),u=function(y){function r(o,G,M,R,W,Y,X){void 0===G&&(G=null),void 0===M&&(M=null);var ea=y.call(this,o,G,M,R,W)||this;ea.useVertexColor=Y,ea.useVertexAlpha=X,ea.color=new q.e(1,1,1),ea.alpha=1,R&&(ea.color=R.color.clone(),ea.alpha=R.alpha,ea.useVertexColor=R.useVertexColor,ea.useVertexAlpha=R.useVertexAlpha),ea.intersectionThreshold=.1;var ca={attributes:[j.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===X&&(ca.needAlphaBlending=!1),Y?(ca.defines.push("#define VERTEXCOLOR"),ca.attributes.push(j.b.ColorKind)):ca.uniforms.push("color"),ea._colorShader=new v.a("colorShader",ea.getScene(),"color",ca),ea}return O.d(r,y),r.prototype._addClipPlaneDefine=function(o){var G="#define "+o;-1===this._colorShader.options.defines.indexOf(G)&&this._colorShader.options.defines.push(G)},r.prototype._removeClipPlaneDefine=function(o){var G="#define "+o,M=this._colorShader.options.defines.indexOf(G);-1!==M&&this._colorShader.options.defines.splice(M,1)},r.prototype.isReady=function(){var o=this.getScene();return o.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),o.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),o.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),o.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),!!this._colorShader.isReady()&&y.prototype.isReady.call(this)},r.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(r.prototype,"material",{get:function(){return this._colorShader},set:function(o){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),r.prototype._bind=function(o,G,M){if(!this._geometry)return this;var R=this._colorShader.getEffect(),W=this.isUnIndexed?null:this._geometry.getIndexBuffer();return this._geometry._bind(R,W),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),z.a.BindClipPlane(R,this.getScene()),this},r.prototype._draw=function(o,G,M){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var R=this.getScene().getEngine();return this._unIndexed?R.drawArraysType(A.a.LineListDrawMode,o.verticesStart,o.verticesCount,M):R.drawElementsType(A.a.LineListDrawMode,o.indexStart,o.indexCount,M),this},r.prototype.dispose=function(o){this._colorShader.dispose(!1,!1,!0),y.prototype.dispose.call(this,o)},r.prototype.clone=function(o,G,M){return new r(o,this.getScene(),G,this,M)},r.prototype.createInstance=function(o){return new w(o,this)},r}(I.a),w=function(y){function r(o,G){var M=y.call(this,o,G)||this;return M.intersectionThreshold=G.intersectionThreshold,M}return O.d(r,y),r.prototype.getClassName=function(){return"InstancedLinesMesh"},r}(H.a)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q});var O=l(1),q=function(j){function I(H){var A=j.call(this)||this;return A._buffer=H,A}return O.d(I,j),Object.defineProperty(I.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),I}(l(78).a)},function(Aa,x,l){"use strict";l.r(x);var O=l(0),q=l(33),j=l(58),I=function(){function Z(T,V,D,F,L,N){if(void 0===V&&(V=1),void 0===D&&(D=2),this._scaleLinesFactor=4,this._instanced=!1,this.scaleLines=1,this.scaleLines=V,!F){var p=new q.a("",T);p.disableLighting=!0,p.emissiveColor=O.e.Red().scale(.5),F=j.a._CreateArrow(T,p)}if(!L){var g=new q.a("",T);g.disableLighting=!0,g.emissiveColor=O.e.Green().scale(.5),L=j.a._CreateArrow(T,g)}if(!N){var n=new q.a("",T);n.disableLighting=!0,n.emissiveColor=O.e.Blue().scale(.5),N=j.a._CreateArrow(T,n)}this._xAxis=F,this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis=L,this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis=N,this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),null!=D&&(Z._SetRenderingGroupId(this._xAxis,D),Z._SetRenderingGroupId(this._yAxis,D),Z._SetRenderingGroupId(this._zAxis,D)),this.scene=T,this.update(new O.x(),O.x.Right(),O.x.Up(),O.x.Forward())}return Object.defineProperty(Z.prototype,"xAxis",{get:function(){return this._xAxis},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"yAxis",{get:function(){return this._yAxis},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"zAxis",{get:function(){return this._zAxis},enumerable:!0,configurable:!0}),Z.prototype.update=function(T,V,D,F){this._xAxis.position.copyFrom(T),this._xAxis.setDirection(V),this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis.position.copyFrom(T),this._yAxis.setDirection(D),this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis.position.copyFrom(T),this._zAxis.setDirection(F),this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor)},Z.prototype.createInstance=function(){var T=j.a._CreateArrowInstance(this.scene,this._xAxis),V=j.a._CreateArrowInstance(this.scene,this._yAxis),D=j.a._CreateArrowInstance(this.scene,this._zAxis),F=new Z(this.scene,this.scaleLines,null,T,V,D);return F._instanced=!0,F},Z.prototype.dispose=function(){this._xAxis&&(this._xAxis.dispose(!1,!this._instanced),delete this._xAxis),this._yAxis&&(this._yAxis.dispose(!1,!this._instanced),delete this._yAxis),this._zAxis&&(this._zAxis.dispose(!1,!this._instanced),delete this._zAxis),delete this.scene},Z._SetRenderingGroupId=function(T,V){T.getChildMeshes().forEach(function(D){D.renderingGroupId=V})},Z}(),H=l(1),A=function(Z){function T(V,D,F,L){void 0===L&&(L=1);var N=Z.call(this,V,L)||this;return N.pos=O.x.Zero(),N.xaxis=O.x.Zero(),N.yaxis=O.x.Zero(),N.zaxis=O.x.Zero(),N.mesh=F,N.bone=D,N}return H.d(T,Z),T.prototype.update=function(){if(this.mesh&&this.bone){var V=this.bone;V.getAbsolutePositionToRef(this.mesh,this.pos),V.getDirectionToRef(O.c.X,this.mesh,this.xaxis),V.getDirectionToRef(O.c.Y,this.mesh,this.yaxis),V.getDirectionToRef(O.c.Z,this.mesh,this.zaxis),Z.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},T.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,Z.prototype.dispose.call(this))},T}(I),v=l(9),z=l(8),u=l(16),w=l(10);Object.defineProperty(u.a.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new y(this)),this._debugLayer},enumerable:!0,configurable:!0});var y=function(){function Z(T){var V=this;this.BJSINSPECTOR=this._getGlobalInspector(),this.onPropertyChangedObservable=new z.c(),this._scene=T,this._scene.onDisposeObservable.add(function(){V._scene._debugLayer&&V._scene._debugLayer.hide()})}return Z.prototype._createInspector=function(T){if(!this.isVisible()){var V=H.a({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},T);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,V)}},Z.prototype.select=function(T,V){this.BJSINSPECTOR&&(this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(V),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(T))},Z.prototype._getGlobalInspector=function(){return"undefined"!=typeof INSPECTOR?INSPECTOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.Inspector?BABYLON:void 0},Z.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},Z.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},Z.prototype.show=function(T){var V=this;return new Promise(function(D,F){if(void 0===V.BJSINSPECTOR){var L=T&&T.inspectorURL?T.inspectorURL:Z.InspectorURL;v.h.LoadScript(L,function(){V._createInspector(T),D(V)})}else V._createInspector(T),D(V)})},Z.InspectorURL="https://unpkg.com/babylonjs-inspector@"+w.b.Version+"/babylon.inspector.bundle.js",Z}(),r=l(11),o=l(52),G=l(46),M=l(23),R=l(27),W=l(41),Y=l(53),X=function(){function Z(T){this._impostors=[],this._meshes=[],this._numMeshes=0,this._debugMeshMeshes=new Array(),this._scene=T||M.a.LastCreatedScene;var V=this._scene.getPhysicsEngine();V&&(this._physicsEnginePlugin=V.getPhysicsPlugin()),this._utilityLayer=new W.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0}return Z.prototype._updateDebugMeshes=function(){for(var T=this._physicsEnginePlugin,V=0;V<this._numMeshes;V++){var D=this._impostors[V];if(D)if(D.isDisposed)this.hideImpostor(this._impostors[V--]);else{if(D.type===R.a.MeshImpostor)continue;var F=this._meshes[V];F&&T&&T.syncMeshWithImpostor(F,D)}}},Z.prototype.showImpostor=function(T,V){if(!this._scene)return null;for(var D=0;D<this._numMeshes;D++)if(this._impostors[D]==T)return null;var F=this._getDebugMesh(T,V);return F&&(this._impostors[this._numMeshes]=T,this._meshes[this._numMeshes]=F,0===this._numMeshes&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),F},Z.prototype.hideImpostor=function(T){if(T&&this._scene&&this._utilityLayer){for(var V=!1,D=this._utilityLayer.utilityLayerScene,F=0;F<this._numMeshes;F++)if(this._impostors[F]==T){var L=this._meshes[F];if(!L)continue;D.removeMesh(L),L.dispose();var N=this._debugMeshMeshes.indexOf(L);N>-1&&this._debugMeshMeshes.splice(N,1),this._numMeshes--,this._numMeshes>0?(this._meshes[F]=this._meshes[this._numMeshes],this._impostors[F]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),V=!0;break}V&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}},Z.prototype._getDebugMaterial=function(T){return this._debugMaterial||(this._debugMaterial=new q.a("",T),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=O.e.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial},Z.prototype._getDebugBoxMesh=function(T){return this._debugBoxMesh||(this._debugBoxMesh=o.a.CreateBox("physicsBodyBoxViewMesh",{size:1},T),this._debugBoxMesh.rotationQuaternion=O.q.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(T),this._debugBoxMesh.setEnabled(!1)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},Z.prototype._getDebugSphereMesh=function(T){return this._debugSphereMesh||(this._debugSphereMesh=G.a.CreateSphere("physicsBodySphereViewMesh",{diameter:1},T),this._debugSphereMesh.rotationQuaternion=O.q.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(T),this._debugSphereMesh.setEnabled(!1)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},Z.prototype._getDebugCylinderMesh=function(T){return this._debugCylinderMesh||(this._debugCylinderMesh=Y.a.CreateCylinder("physicsBodyCylinderViewMesh",{diameterTop:1,diameterBottom:1,height:1},T),this._debugCylinderMesh.rotationQuaternion=O.q.Identity(),this._debugCylinderMesh.material=this._getDebugMaterial(T),this._debugCylinderMesh.setEnabled(!1)),this._debugCylinderMesh.createInstance("physicsBodyBoxViewInstance")},Z.prototype._getDebugMeshMesh=function(T,V){var D=new r.a(T.name,V,null,T);return D.position=O.x.Zero(),D.setParent(T),D.material=this._getDebugMaterial(V),this._debugMeshMeshes.push(D),D},Z.prototype._getDebugMesh=function(T,V){var D=this;if(!this._utilityLayer)return null;if(V&&V.parent&&V.parent.physicsImpostor)return null;var F=null,L=this._utilityLayer.utilityLayerScene;switch(T.type){case R.a.BoxImpostor:F=this._getDebugBoxMesh(L),T.getBoxSizeToRef(F.scaling);break;case R.a.SphereImpostor:F=this._getDebugSphereMesh(L);var N=T.getRadius();F.scaling.x=2*N,F.scaling.y=2*N,F.scaling.z=2*N;break;case R.a.MeshImpostor:V&&(F=this._getDebugMeshMesh(V,L));break;case R.a.NoImpostor:V&&V.getChildMeshes().filter(function(g){return g.physicsImpostor?1:0}).forEach(function(g){D._getDebugBoxMesh(L).parent=g});break;case R.a.CylinderImpostor:F=this._getDebugCylinderMesh(L);var p=T.object.getBoundingInfo();F.scaling.x=p.boundingBox.maximum.x-p.boundingBox.minimum.x,F.scaling.y=p.boundingBox.maximum.y-p.boundingBox.minimum.y,F.scaling.z=p.boundingBox.maximum.z-p.boundingBox.minimum.z}return F},Z.prototype.dispose=function(){for(var T=this._numMeshes,V=0;V<T;V++)this.hideImpostor(this._impostors[0]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugCylinderMesh&&this._debugCylinderMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},Z}(),ea=l(40),ca=function(){function Z(T){this.ray=T}return Z.CreateAndShow=function(T,V,D){var F=new Z(T);return F.show(V,D),F},Z.prototype.show=function(T,V){if(!this._renderFunction&&this.ray){var D=this.ray;this._renderFunction=this._render.bind(this),this._scene=T,this._renderPoints=[D.origin,D.origin.add(D.direction.scale(D.length))],this._renderLine=r.a.CreateLines("ray",this._renderPoints,T,!0),this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}V&&this._renderLine&&this._renderLine.color.copyFrom(V)},Z.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},Z.prototype._render=function(){var T=this.ray;if(T){var V=this._renderPoints[1],D=Math.min(T.length,1e06);V.copyFrom(T.direction),V.scaleInPlace(D),V.addInPlace(T.origin),r.a.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},Z.prototype.attachToMesh=function(T,V,D,F){this._attachedToMesh=T;var L=this.ray;L&&(L.direction||(L.direction=O.x.Zero()),L.origin||(L.origin=O.x.Zero()),F&&(L.length=F),D||(D=O.x.Zero()),V||(V=new O.x(0,0,-1)),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(V),this._meshSpaceOrigin.copyFrom(D)):(this._meshSpaceDirection=V.clone(),this._meshSpaceOrigin=D.clone()),this._updateToMeshFunction||(this._updateToMeshFunction=this._updateToMesh.bind(this),this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),this._updateToMesh())},Z.prototype.detachFromMesh=function(){this._attachedToMesh&&(this._updateToMeshFunction&&this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),this._attachedToMesh=null,this._updateToMeshFunction=null)},Z.prototype._updateToMesh=function(){var T=this.ray;this._attachedToMesh&&T&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,T.direction),O.x.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),T.origin)))},Z.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},Z}(),oa=function(){function Z(T,V,D,F,L){void 0===F&&(F=!0),void 0===L&&(L=1),this.skeleton=T,this.mesh=V,this.autoUpdateBonesMatrices=F,this.renderingGroupId=L,this.color=O.e.White(),this._debugLines=new Array(),this._isEnabled=!1,this._scene=D,this._utilityLayer=new W.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(Z.prototype,"debugMesh",{get:function(){return this._debugMesh},enumerable:!0,configurable:!0}),Object.defineProperty(Z.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(T){this._isEnabled!==T&&(this._isEnabled=T,T?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),Z.prototype._getBonePosition=function(T,V,D,F,L,N){void 0===F&&(F=0),void 0===L&&(L=0),void 0===N&&(N=0);var p=O.t.Matrix[0],g=V.getParent();if(p.copyFrom(V.getLocalMatrix()),0!==F||0!==L||0!==N){var n=O.t.Matrix[1];O.j.IdentityToRef(n),n.setTranslationFromFloats(F,L,N),n.multiplyToRef(p,p)}g&&p.multiplyToRef(g.getAbsoluteTransform(),p),p.multiplyToRef(D,p),T.x=p.m[12],T.y=p.m[13],T.z=p.m[14]},Z.prototype._getLinesForBonesWithLength=function(T,V){for(var D=T.length,F=this.mesh._effectiveMesh.position,L=0;L<D;L++){var N=T[L],p=this._debugLines[L];p||(p=[O.x.Zero(),O.x.Zero()],this._debugLines[L]=p),this._getBonePosition(p[0],N,V),this._getBonePosition(p[1],N,V,0,N.length,0),p[0].subtractInPlace(F),p[1].subtractInPlace(F)}},Z.prototype._getLinesForBonesNoLength=function(T,V){for(var D=T.length,F=0,L=this.mesh._effectiveMesh,N=L.position,p=D-1;p>=0;p--){var g=T[p],n=g.getParent();if(n){var s=this._debugLines[F];s||(s=[O.x.Zero(),O.x.Zero()],this._debugLines[F]=s),g.getAbsolutePositionToRef(L,s[0]),n.getAbsolutePositionToRef(L,s[1]),s[0].subtractInPlace(N),s[1].subtractInPlace(N),F++}}},Z.prototype.update=function(){if(this._utilityLayer){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();var T=this.mesh._effectiveMesh;void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,T.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,T.getWorldMatrix());var V=this._utilityLayer.utilityLayerScene;this._debugMesh?ea.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},V):(this._debugMesh=ea.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},V),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color}},Z.prototype.dispose=function(){this.isEnabled=!1,this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null),this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},Z}();l.d(x,"AxesViewer",function(){return I}),l.d(x,"BoneAxesViewer",function(){return A}),l.d(x,"DebugLayer",function(){return y}),l.d(x,"PhysicsViewer",function(){return X}),l.d(x,"RayHelper",function(){return ca}),l.d(x,"SkeletonViewer",function(){return oa})},function(Aa,x,l){"use strict";l.d(x,"a",function(){return j});var O=l(1),q=l(0),j=function(I){function H(A,v){var z=I.call(this,A,v)||this;return z._normalMatrix=new q.j(),z.allowShaderHotSwapping=!0,z._storeEffectOnSubMeshes=!0,z}return O.d(H,I),H.prototype.getEffect=function(){return this._activeEffect},H.prototype.isReady=function(A,v){return!!A&&(!A.subMeshes||0===A.subMeshes.length||this.isReadyForSubMesh(A,A.subMeshes[0],v))},H.prototype.bindOnlyWorldMatrix=function(A){this._activeEffect.setMatrix("world",A)},H.prototype.bindOnlyNormalMatrix=function(A){this._activeEffect.setMatrix("normalMatrix",A)},H.prototype.bind=function(A,v){v&&this.bindForSubMesh(A,v,v.subMeshes[0])},H.prototype._afterBind=function(A,v){void 0===v&&(v=null),I.prototype._afterBind.call(this,A),this.getScene()._cachedEffect=v},H.prototype._mustRebind=function(A,v,z){return void 0===z&&(z=1),A.isCachedMaterialInvalid(this,v,z)},H}(l(20).a)},function(Aa,x,l){"use strict";l.d(x,"a",function(){return w});var O=l(1),q=l(2),j=l(0),I=l(4),H=l(7),A=l(15),v=l(5),z=l(20),u=l(22),w=function(y){function r(o,G,M,R){void 0===R&&(R={});var W=y.call(this,o,G)||this;return W._textures={},W._textureArrays={},W._floats={},W._ints={},W._floatsArrays={},W._colors3={},W._colors3Arrays={},W._colors4={},W._vectors2={},W._vectors3={},W._vectors4={},W._matrices={},W._matrices3x3={},W._matrices2x2={},W._vectors2Arrays={},W._vectors3Arrays={},W._cachedWorldViewMatrix=new j.j(),W._shaderPath=M,W._options=O.a({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},R),W}return O.d(r,y),Object.defineProperty(r.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"ShaderMaterial"},r.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},r.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},r.prototype._checkUniform=function(o){-1===this._options.uniforms.indexOf(o)&&this._options.uniforms.push(o)},r.prototype.setTexture=function(o,G){return-1===this._options.samplers.indexOf(o)&&this._options.samplers.push(o),this._textures[o]=G,this},r.prototype.setTextureArray=function(o,G){return-1===this._options.samplers.indexOf(o)&&this._options.samplers.push(o),this._checkUniform(o),this._textureArrays[o]=G,this},r.prototype.setFloat=function(o,G){return this._checkUniform(o),this._floats[o]=G,this},r.prototype.setInt=function(o,G){return this._checkUniform(o),this._ints[o]=G,this},r.prototype.setFloats=function(o,G){return this._checkUniform(o),this._floatsArrays[o]=G,this},r.prototype.setColor3=function(o,G){return this._checkUniform(o),this._colors3[o]=G,this},r.prototype.setColor3Array=function(o,G){return this._checkUniform(o),this._colors3Arrays[o]=G.reduce(function(M,R){return R.toArray(M,M.length),M},[]),this},r.prototype.setColor4=function(o,G){return this._checkUniform(o),this._colors4[o]=G,this},r.prototype.setVector2=function(o,G){return this._checkUniform(o),this._vectors2[o]=G,this},r.prototype.setVector3=function(o,G){return this._checkUniform(o),this._vectors3[o]=G,this},r.prototype.setVector4=function(o,G){return this._checkUniform(o),this._vectors4[o]=G,this},r.prototype.setMatrix=function(o,G){return this._checkUniform(o),this._matrices[o]=G,this},r.prototype.setMatrix3x3=function(o,G){return this._checkUniform(o),this._matrices3x3[o]=G,this},r.prototype.setMatrix2x2=function(o,G){return this._checkUniform(o),this._matrices2x2[o]=G,this},r.prototype.setArray2=function(o,G){return this._checkUniform(o),this._vectors2Arrays[o]=G,this},r.prototype.setArray3=function(o,G){return this._checkUniform(o),this._vectors3Arrays[o]=G,this},r.prototype._checkCache=function(o,G){return!o||(this._effect&&this._effect.defines.indexOf("#define INSTANCES"),!1)},r.prototype.isReadyForSubMesh=function(o,G,M){return this.isReady(o,M)},r.prototype.isReady=function(o,G){var M=this.getScene(),R=M.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===M.getRenderId()&&this._checkCache(o,G))return!0;for(var W=[],Y=[],X=new v.c(),ea=0;ea<this._options.defines.length;ea++)W.push(this._options.defines[ea]);for(ea=0;ea<this._options.attributes.length;ea++)Y.push(this._options.attributes[ea]);if(o&&o.isVerticesDataPresent(I.b.ColorKind)&&(Y.push(I.b.ColorKind),W.push("#define VERTEXCOLOR")),G&&(W.push("#define INSTANCES"),A.a.PrepareAttributesForInstances(Y,W)),o&&o.useBones&&o.computeBonesUsingShaders&&o.skeleton){Y.push(I.b.MatricesIndicesKind),Y.push(I.b.MatricesWeightsKind),o.numBoneInfluencers>4&&(Y.push(I.b.MatricesIndicesExtraKind),Y.push(I.b.MatricesWeightsExtraKind));var ca=o.skeleton;W.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),X.addCPUSkinningFallback(0,o),ca.isUsingTextureForMatrices?(W.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(W.push("#define BonesPerMesh "+(ca.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else W.push("#define NUM_BONE_INFLUENCERS 0");for(var oa in this._textures)if(!this._textures[oa].isReady())return!1;o&&this._shouldTurnAlphaTestOn(o)&&W.push("#define ALPHATEST");var Z=this._effect,T=W.join(`
`);return this._effect=R.createEffect(this._shaderPath,{attributes:Y,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:T,fallbacks:X,onCompiled:this.onCompiled,onError:this.onError},R),!!this._effect.isReady()&&(Z!==this._effect&&M.resetCachedMaterial(),this._renderId=M.getRenderId(),!0)},r.prototype.bindOnlyWorldMatrix=function(o){var G=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",o),-1!==this._options.uniforms.indexOf("worldView")&&(o.multiplyToRef(G.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",o.multiply(G.getTransformMatrix())))},r.prototype.bind=function(o,G){if(this.bindOnlyWorldMatrix(o),this._effect&&this.getScene().getCachedMaterial()!==this){var M;for(M in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),A.a.BindBonesParameters(G,this._effect),this._textures)this._effect.setTexture(M,this._textures[M]);for(M in this._textureArrays)this._effect.setTextureArray(M,this._textureArrays[M]);for(M in this._ints)this._effect.setInt(M,this._ints[M]);for(M in this._floats)this._effect.setFloat(M,this._floats[M]);for(M in this._floatsArrays)this._effect.setArray(M,this._floatsArrays[M]);for(M in this._colors3)this._effect.setColor3(M,this._colors3[M]);for(M in this._colors3Arrays)this._effect.setArray3(M,this._colors3Arrays[M]);for(M in this._colors4){var R=this._colors4[M];this._effect.setFloat4(M,R.r,R.g,R.b,R.a)}for(M in this._vectors2)this._effect.setVector2(M,this._vectors2[M]);for(M in this._vectors3)this._effect.setVector3(M,this._vectors3[M]);for(M in this._vectors4)this._effect.setVector4(M,this._vectors4[M]);for(M in this._matrices)this._effect.setMatrix(M,this._matrices[M]);for(M in this._matrices3x3)this._effect.setMatrix3x3(M,this._matrices3x3[M]);for(M in this._matrices2x2)this._effect.setMatrix2x2(M,this._matrices2x2[M]);for(M in this._vectors2Arrays)this._effect.setArray2(M,this._vectors2Arrays[M]);for(M in this._vectors3Arrays)this._effect.setArray3(M,this._vectors3Arrays[M])}this._afterBind(G)},r.prototype.getActiveTextures=function(){var o=y.prototype.getActiveTextures.call(this);for(var G in this._textures)o.push(this._textures[G]);for(var G in this._textureArrays)for(var M=this._textureArrays[G],R=0;R<M.length;R++)o.push(M[R]);return o},r.prototype.hasTexture=function(o){if(y.prototype.hasTexture.call(this,o))return!0;for(var G in this._textures)if(this._textures[G]===o)return!0;for(var G in this._textureArrays)for(var M=this._textureArrays[G],R=0;R<M.length;R++)if(M[R]===o)return!0;return!1},r.prototype.clone=function(o){return new r(o,this.getScene(),this._shaderPath,this._options)},r.prototype.dispose=function(o,G,M){if(G){var R;for(R in this._textures)this._textures[R].dispose();for(R in this._textureArrays)for(var W=this._textureArrays[R],Y=0;Y<W.length;Y++)W[Y].dispose()}this._textures={},y.prototype.dispose.call(this,o,G,M)},r.prototype.serialize=function(){var o,G=q.a.Serialize(this);for(o in G.customType="BABYLON.ShaderMaterial",G.options=this._options,G.shaderPath=this._shaderPath,G.textures={},this._textures)G.textures[o]=this._textures[o].serialize();for(o in G.textureArrays={},this._textureArrays){G.textureArrays[o]=[];for(var M=this._textureArrays[o],R=0;R<M.length;R++)G.textureArrays[o].push(M[R].serialize())}for(o in G.floats={},this._floats)G.floats[o]=this._floats[o];for(o in G.FloatArrays={},this._floatsArrays)G.FloatArrays[o]=this._floatsArrays[o];for(o in G.colors3={},this._colors3)G.colors3[o]=this._colors3[o].asArray();for(o in G.colors3Arrays={},this._colors3Arrays)G.colors3Arrays[o]=this._colors3Arrays[o];for(o in G.colors4={},this._colors4)G.colors4[o]=this._colors4[o].asArray();for(o in G.vectors2={},this._vectors2)G.vectors2[o]=this._vectors2[o].asArray();for(o in G.vectors3={},this._vectors3)G.vectors3[o]=this._vectors3[o].asArray();for(o in G.vectors4={},this._vectors4)G.vectors4[o]=this._vectors4[o].asArray();for(o in G.matrices={},this._matrices)G.matrices[o]=this._matrices[o].asArray();for(o in G.matrices3x3={},this._matrices3x3)G.matrices3x3[o]=this._matrices3x3[o];for(o in G.matrices2x2={},this._matrices2x2)G.matrices2x2[o]=this._matrices2x2[o];for(o in G.vectors2Arrays={},this._vectors2Arrays)G.vectors2Arrays[o]=this._vectors2Arrays[o];for(o in G.vectors3Arrays={},this._vectors3Arrays)G.vectors3Arrays[o]=this._vectors3Arrays[o];return G},r.Parse=function(o,G,M){var R,W=q.a.Parse(function(){return new r(o.name,G,o.shaderPath,o.options)},o,G,M);for(R in o.textures)W.setTexture(R,H.a.Parse(o.textures[R],G,M));for(R in o.textureArrays){for(var Y=o.textureArrays[R],X=new Array(),ea=0;ea<Y.length;ea++)X.push(H.a.Parse(Y[ea],G,M));W.setTextureArray(R,X)}for(R in o.floats)W.setFloat(R,o.floats[R]);for(R in o.floatsArrays)W.setFloats(R,o.floatsArrays[R]);for(R in o.colors3)W.setColor3(R,j.e.FromArray(o.colors3[R]));for(R in o.colors3Arrays){var ca=o.colors3Arrays[R].reduce(function(oa,Z,T){return T%3==0?oa.push([Z]):oa[oa.length-1].push(Z),oa},[]).map(function(oa){return j.e.FromArray(oa)});W.setColor3Array(R,ca)}for(R in o.colors4)W.setColor4(R,j.f.FromArray(o.colors4[R]));for(R in o.vectors2)W.setVector2(R,j.w.FromArray(o.vectors2[R]));for(R in o.vectors3)W.setVector3(R,j.x.FromArray(o.vectors3[R]));for(R in o.vectors4)W.setVector4(R,j.y.FromArray(o.vectors4[R]));for(R in o.matrices)W.setMatrix(R,j.j.FromArray(o.matrices[R]));for(R in o.matrices3x3)W.setMatrix3x3(R,o.matrices3x3[R]);for(R in o.matrices2x2)W.setMatrix2x2(R,o.matrices2x2[R]);for(R in o.vectors2Arrays)W.setArray2(R,o.vectors2Arrays[R]);for(R in o.vectors3Arrays)W.setArray3(R,o.vectors3Arrays[R]);return W},r}(z.a);u.a.RegisteredTypes["BABYLON.ShaderMaterial"]=w},function(Aa,x,l){"use strict";l.d(x,"a",function(){return j});var O=l(34),q=l(0),j=function(){function I(H,A,v){this.vectors=O.a.BuildArray(8,q.x.Zero),this.center=q.x.Zero(),this.centerWorld=q.x.Zero(),this.extendSize=q.x.Zero(),this.extendSizeWorld=q.x.Zero(),this.directions=O.a.BuildArray(3,q.x.Zero),this.vectorsWorld=O.a.BuildArray(8,q.x.Zero),this.minimumWorld=q.x.Zero(),this.maximumWorld=q.x.Zero(),this.minimum=q.x.Zero(),this.maximum=q.x.Zero(),this.reConstruct(H,A,v)}return I.prototype.reConstruct=function(H,A,v){var z=H.x,u=H.y,w=H.z,y=A.x,r=A.y,o=A.z,G=this.vectors;this.minimum.copyFromFloats(z,u,w),this.maximum.copyFromFloats(y,r,o),G[0].copyFromFloats(z,u,w),G[1].copyFromFloats(y,r,o),G[2].copyFromFloats(y,u,w),G[3].copyFromFloats(z,r,w),G[4].copyFromFloats(z,u,o),G[5].copyFromFloats(y,r,w),G[6].copyFromFloats(z,r,o),G[7].copyFromFloats(y,u,o),A.addToRef(H,this.center).scaleInPlace(.5),A.subtractToRef(H,this.extendSize).scaleInPlace(.5),this._worldMatrix=v||q.j.IdentityReadOnly,this._update(this._worldMatrix)},I.prototype.scale=function(H){var A=I.TmpVector3,v=this.maximum.subtractToRef(this.minimum,A[0]),z=v.length();v.normalizeFromLength(z);var u=z*H,w=v.scaleInPlace(.5*u),y=this.center.subtractToRef(w,A[1]),r=this.center.addToRef(w,A[2]);return this.reConstruct(y,r,this._worldMatrix),this},I.prototype.getWorldMatrix=function(){return this._worldMatrix},I.prototype._update=function(H){var A=this.minimumWorld,v=this.maximumWorld,z=this.directions,u=this.vectorsWorld,w=this.vectors;if(H.isIdentity()){for(A.copyFrom(this.minimum),v.copyFrom(this.maximum),y=0;y<8;++y)u[y].copyFrom(w[y]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{A.setAll(Number.MAX_VALUE),v.setAll(-Number.MAX_VALUE);for(var y=0;y<8;++y){var r=u[y];q.x.TransformCoordinatesToRef(w[y],H,r),A.minimizeInPlace(r),v.maximizeInPlace(r)}v.subtractToRef(A,this.extendSizeWorld).scaleInPlace(.5),v.addToRef(A,this.centerWorld).scaleInPlace(.5)}q.x.FromArrayToRef(H.m,0,z[0]),q.x.FromArrayToRef(H.m,4,z[1]),q.x.FromArrayToRef(H.m,8,z[2]),this._worldMatrix=H},I.prototype.isInFrustum=function(H){return I.IsInFrustum(this.vectorsWorld,H)},I.prototype.isCompletelyInFrustum=function(H){return I.IsCompletelyInFrustum(this.vectorsWorld,H)},I.prototype.intersectsPoint=function(H){var A=this.minimumWorld,v=this.maximumWorld,z=A.x,u=A.y,w=A.z,y=v.x,r=v.y,o=v.z,G=H.x,M=H.y,R=H.z,W=-q.h;return!(y-G<W||W>G-z)&&(!(r-M<W||W>M-u)&&!(o-R<W||W>R-w))},I.prototype.intersectsSphere=function(H){return I.IntersectsSphere(this.minimumWorld,this.maximumWorld,H.centerWorld,H.radiusWorld)},I.prototype.intersectsMinMax=function(H,A){var v=this.minimumWorld,z=this.maximumWorld,u=v.x,w=v.y,y=v.z,r=z.x,o=z.y,G=z.z,M=H.x,R=H.y,W=H.z,Y=A.x,X=A.y,ea=A.z;return!(r<M||u>Y)&&(!(o<R||w>X)&&!(G<W||y>ea))},I.Intersects=function(H,A){return H.intersectsMinMax(A.minimumWorld,A.maximumWorld)},I.IntersectsSphere=function(H,A,v,z){var u=I.TmpVector3[0];return q.x.ClampToRef(v,H,A,u),q.x.DistanceSquared(v,u)<=z*z},I.IsCompletelyInFrustum=function(H,A){for(var v=0;v<6;++v)for(var z=A[v],u=0;u<8;++u)if(z.dotCoordinate(H[u])<0)return!1;return!0},I.IsInFrustum=function(H,A){for(var v=0;v<6;++v){for(var z=!0,u=A[v],w=0;w<8;++w)if(u.dotCoordinate(H[w])>=0){z=!1;break}if(z)return!1}return!0},I.TmpVector3=O.a.BuildArray(3,q.x.Zero),I}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(q.prototype,"underlyingResource",{get:function(){return null},enumerable:!0,configurable:!0}),q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q});var O=l(3),q=function(){function j(){this.hoverCursor="",this.actions=new Array(),this.isRecursive=!1}return Object.defineProperty(j,"HasTriggers",{get:function(){for(var I in j.Triggers)if(j.Triggers.hasOwnProperty(I))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(j,"HasPickTriggers",{get:function(){for(var I in j.Triggers)if(j.Triggers.hasOwnProperty(I)){var H=parseInt(I);if(H>=O.a.ACTION_OnPickTrigger&&H<=O.a.ACTION_OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),j.HasSpecificTrigger=function(I){for(var H in j.Triggers)if(j.Triggers.hasOwnProperty(H)){if(parseInt(H)===I)return!0}return!1},j.Triggers={},j}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return j});var O=l(11),q=l(13);q.a.CreatePlane=function(I){var H=[],A=[],v=[],z=[],u=I.width||I.size||1,w=I.height||I.size||1,y=0===I.sideOrientation?0:I.sideOrientation||q.a.DEFAULTSIDE,r=u/2,o=w/2;A.push(-r,-o,0),v.push(0,0,-1),z.push(0,0),A.push(r,-o,0),v.push(0,0,-1),z.push(1,0),A.push(r,o,0),v.push(0,0,-1),z.push(1,1),A.push(-r,o,0),v.push(0,0,-1),z.push(0,1),H.push(0),H.push(1),H.push(2),H.push(0),H.push(2),H.push(3),q.a._ComputeSides(y,A,H,v,z,I.frontUVs,I.backUVs);var G=new q.a();return G.indices=H,G.positions=A,G.normals=v,G.uvs=z,G},O.a.CreatePlane=function(I,H,A,v,z){var u={size:H,width:H,height:H,sideOrientation:z,updatable:v};return j.CreatePlane(I,u,A)};var j=function(){function I(){}return I.CreatePlane=function(H,A,v){void 0===v&&(v=null);var z=new O.a(H,v);return A.sideOrientation=O.a._GetDefaultSideOrientation(A.sideOrientation),z._originalBuilderSideOrientation=A.sideOrientation,q.a.CreatePlane(A).applyToMesh(z,A.updatable),A.sourcePlane&&(z.translate(A.sourcePlane.normal,-A.sourcePlane.d),z.setDirection(A.sourcePlane.normal.scale(-1))),z},I}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){return function(q,j,I){this.bu=q,this.bv=j,this.distance=I,this.faceId=0,this.subMeshId=0}}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return j});var O=l(34),q=l(0),j=function(){function I(H,A,v){this.center=q.x.Zero(),this.centerWorld=q.x.Zero(),this.minimum=q.x.Zero(),this.maximum=q.x.Zero(),this.reConstruct(H,A,v)}return I.prototype.reConstruct=function(H,A,v){this.minimum.copyFrom(H),this.maximum.copyFrom(A);var z=q.x.Distance(H,A);A.addToRef(H,this.center).scaleInPlace(.5),this.radius=.5*z,this._update(v||q.j.IdentityReadOnly)},I.prototype.scale=function(H){var A=this.radius*H,v=I.TmpVector3,z=v[0].setAll(A),u=this.center.subtractToRef(z,v[1]),w=this.center.addToRef(z,v[2]);return this.reConstruct(u,w,this._worldMatrix),this},I.prototype.getWorldMatrix=function(){return this._worldMatrix},I.prototype._update=function(H){if(H.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{q.x.TransformCoordinatesToRef(this.center,H,this.centerWorld);var A=I.TmpVector3[0];q.x.TransformNormalFromFloatsToRef(1,1,1,H,A),this.radiusWorld=Math.max(Math.abs(A.x),Math.abs(A.y),Math.abs(A.z))*this.radius}},I.prototype.isInFrustum=function(H){for(var A=this.centerWorld,v=this.radiusWorld,z=0;z<6;z++)if(H[z].dotCoordinate(A)<=-v)return!1;return!0},I.prototype.isCenterInFrustum=function(H){for(var A=this.centerWorld,v=0;v<6;v++)if(H[v].dotCoordinate(A)<0)return!1;return!0},I.prototype.intersectsPoint=function(H){var A=q.x.DistanceSquared(this.centerWorld,H);return!(this.radiusWorld*this.radiusWorld<A)},I.Intersects=function(H,A){var v=q.x.DistanceSquared(H.centerWorld,A.centerWorld),z=H.radiusWorld+A.radiusWorld;return!(z*z<v)},I.TmpVector3=O.a.BuildArray(3,q.x.Zero),I}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return I});var O=l(20),q=l(4),j=l(3),I=function(){function H(A){this._vertexBuffers={},this._scene=A}return H.prototype._prepareBuffers=function(){if(!this._vertexBuffers[q.b.PositionKind]){var A=[];A.push(1,1),A.push(-1,1),A.push(-1,-1),A.push(1,-1),this._vertexBuffers[q.b.PositionKind]=new q.b(this._scene.getEngine(),A,q.b.PositionKind,!1,!1,2),this._buildIndexBuffer()}},H.prototype._buildIndexBuffer=function(){var A=[];A.push(0),A.push(1),A.push(2),A.push(0),A.push(2),A.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(A)},H.prototype._rebuild=function(){var A=this._vertexBuffers[q.b.PositionKind];A&&(A._rebuild(),this._buildIndexBuffer())},H.prototype._prepareFrame=function(A,v){void 0===A&&(A=null),void 0===v&&(v=null);var z=this._scene.activeCamera;return!!z&&(!(!(v=v||z._postProcesses.filter(function(u){return null!=u}))||0===v.length||!this._scene.postProcessesEnabled)&&(v[0].activate(z,A,null!=v),!0))},H.prototype.directRender=function(A,v,z,u,w){void 0===v&&(v=null),void 0===z&&(z=!1),void 0===u&&(u=0),void 0===w&&(w=0);for(var y=this._scene.getEngine(),r=0;r<A.length;r++){r<A.length-1?A[r+1].activate(this._scene.activeCamera,v):v?y.bindFramebuffer(v,u,void 0,void 0,z,void 0,w):y.restoreDefaultFramebuffer();var o=A[r],G=o.apply();G&&(o.onBeforeRenderObservable.notifyObservers(G),this._prepareBuffers(),y.bindBuffers(this._vertexBuffers,this._indexBuffer,G),y.drawElementsType(O.a.TriangleFillMode,0,6),o.onAfterRenderObservable.notifyObservers(G))}y.setDepthBuffer(!0),y.setDepthWrite(!0)},H.prototype._finalizeFrame=function(A,v,z,u,w){void 0===w&&(w=!1);var y=this._scene.activeCamera;if(y&&0!==(u=u||y._postProcesses.filter(function(W){return null!=W})).length&&this._scene.postProcessesEnabled){for(var r=this._scene.getEngine(),o=0,G=u.length;o<G;o++){var M=u[o];if(o<G-1?M._outputTexture=u[o+1].activate(y,v):v?(r.bindFramebuffer(v,z,void 0,void 0,w),M._outputTexture=v):(r.restoreDefaultFramebuffer(),M._outputTexture=null),A)break;var R=M.apply();R&&(M.onBeforeRenderObservable.notifyObservers(R),this._prepareBuffers(),r.bindBuffers(this._vertexBuffers,this._indexBuffer,R),r.drawElementsType(O.a.TriangleFillMode,0,6),M.onAfterRenderObservable.notifyObservers(R))}r.setDepthBuffer(!0),r.setDepthWrite(!0),r.setAlphaMode(j.a.ALPHA_DISABLE)}},H.prototype.dispose=function(){var A=this._vertexBuffers[q.b.PositionKind];A&&(A.dispose(),this._vertexBuffers[q.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},H}()},function(Aa,x,l){"use strict";var O="lightFragmentDeclaration",q=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};
uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec3 vLightSpecular{X};
#else
vec3 vLightSpecular{X}=vec3(0.);
#endif
#ifdef SHADOW{X}
#if defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};
uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};
uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="lightUboDeclaration",q=`#ifdef LIGHT{X}
uniform Light{X}
{
vec4 vLightData;
vec4 vLightDiffuse;
vec3 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;
vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;
vec2 depthValues;
} light{X};
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#ifdef SHADOW{X}
#if defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
#endif
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="imageProcessingDeclaration",q=`#ifdef EXPOSURE
uniform float exposureLinear;
#endif
#ifdef CONTRAST
uniform float contrast;
#endif
#ifdef VIGNETTE
uniform vec2 vInverseScreenSize;
uniform vec4 vignetteSettings1;
uniform vec4 vignetteSettings2;
#endif
#ifdef COLORCURVES
uniform vec4 vCameraColorCurveNegative;
uniform vec4 vCameraColorCurveNeutral;
uniform vec4 vCameraColorCurvePositive;
#endif
#ifdef COLORGRADING
#ifdef COLORGRADING3D
uniform highp sampler3D txColorTransform;
#else
uniform sampler2D txColorTransform;
#endif
uniform vec4 colorTransformSettings;
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="imageProcessingFunctions",q=`#if defined(COLORGRADING) && !defined(COLORGRADING3D)

vec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)
{
float sliceSize=2.0*sampler3dSetting.x;
#ifdef SAMPLER3DGREENDEPTH
float sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;
#else
float sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;
#endif
float sliceInteger=floor(sliceContinuous);


float sliceFraction=sliceContinuous-sliceInteger;
#ifdef SAMPLER3DGREENDEPTH
vec2 sliceUV=color.rb;
#else
vec2 sliceUV=color.rg;
#endif
sliceUV.x*=sliceSize;
sliceUV.x+=sliceInteger*sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice0Color=texture2D(colorTransform,sliceUV);
sliceUV.x+=sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice1Color=texture2D(colorTransform,sliceUV);
vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);
#ifdef SAMPLER3DBGRMAP
color.rgb=result.rgb;
#else
color.rgb=result.bgr;
#endif
return color;
}
#endif
#ifdef TONEMAPPING_ACES





const mat3 ACESInputMat=mat3(
vec3(0.59719,0.07600,0.02840),
vec3(0.35458,0.90834,0.13383),
vec3(0.04823,0.01566,0.83777)
);

const mat3 ACESOutputMat=mat3(
vec3( 1.60475,-0.10208,-0.00327),
vec3(-0.53108,1.10813,-0.07276),
vec3(-0.07367,-0.00605,1.07602)
);
vec3 RRTAndODTFit(vec3 v)
{
vec3 a=v*(v+0.0245786)-0.000090537;
vec3 b=v*(0.983729*v+0.4329510)+0.238081;
return a/b;
}
vec3 ACESFitted(vec3 color)
{
color=ACESInputMat*color;

color=RRTAndODTFit(color);
color=ACESOutputMat*color;

color=saturate(color);
return color;
}
#endif
vec4 applyImageProcessing(vec4 result) {
#ifdef EXPOSURE
result.rgb*=exposureLinear;
#endif
#ifdef VIGNETTE

vec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;
viewportXY=viewportXY*2.0-1.0;
vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);
float vignetteTerm=dot(vignetteXY1,vignetteXY1);
float vignette=pow(vignetteTerm,vignetteSettings2.w);

vec3 vignetteColor=vignetteSettings2.rgb;
#ifdef VIGNETTEBLENDMODEMULTIPLY
vec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);
result.rgb*=vignetteColorMultiplier;
#endif
#ifdef VIGNETTEBLENDMODEOPAQUE
result.rgb=mix(vignetteColor,result.rgb,vignette);
#endif
#endif
#ifdef TONEMAPPING
#ifdef TONEMAPPING_ACES
result.rgb=ACESFitted(result.rgb);
#else
const float tonemappingCalibration=1.590579;
result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);
#endif
#endif

result.rgb=toGammaSpace(result.rgb);
result.rgb=saturate(result.rgb);
#ifdef CONTRAST

vec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);
if (contrast<1.0) {

result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);
} else {

result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);
}
#endif

#ifdef COLORGRADING
vec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;
#ifdef COLORGRADING3D
vec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;
#else
vec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;
#endif
result.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);
#endif
#ifdef COLORCURVES

float luma=getLuminance(result.rgb);
vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));
vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;
result.rgb*=colorCurve.rgb;
result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);
#endif
return result;
}`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="logDepthDeclaration",q=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;
varying float vFragmentDepth;
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="clipPlaneFragment",q=`#ifdef CLIPPLANE
if (fClipDistance>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE2
if (fClipDistance2>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE3
if (fClipDistance3>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE4
if (fClipDistance4>0.0)
{
discard;
}
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="clipPlaneVertex",q=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q}),l.d(x,"b",function(){return j});var O=l(109),q=function(){return function(){}}(),j=function(){function I(H){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array(),this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new q(),this._scene=H;for(var A=I.MIN_RENDERINGGROUPS;A<I.MAX_RENDERINGGROUPS;A++)this._autoClearDepthStencil[A]={autoClear:!0,depth:!0,stencil:!0}}return I.prototype._clearDepthStencilBuffer=function(H,A){void 0===H&&(H=!0),void 0===A&&(A=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,H,A),this._depthStencilBufferAlreadyCleaned=!0)},I.prototype.render=function(H,A,v,z){var u=this._renderingGroupInfo;if(u.scene=this._scene,u.camera=this._scene.activeCamera,this._scene.spriteManagers&&z)for(var w=0;w<this._scene.spriteManagers.length;w++){var y=this._scene.spriteManagers[w];this.dispatchSprites(y)}for(w=I.MIN_RENDERINGGROUPS;w<I.MAX_RENDERINGGROUPS;w++){this._depthStencilBufferAlreadyCleaned=w===I.MIN_RENDERINGGROUPS;var r=this._renderingGroups[w];if(r){var o=Math.pow(2,w);if(u.renderingGroupId=w,this._scene.onBeforeRenderingGroupObservable.notifyObservers(u,o),I.AUTOCLEAR){var G=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(w):this._autoClearDepthStencil[w];G&&G.autoClear&&this._clearDepthStencilBuffer(G.depth,G.stencil)}for(var M=0,R=this._scene._beforeRenderingGroupDrawStage;M<R.length;M++)R[M].action(w);r.render(H,z,v,A);for(var W=0,Y=this._scene._afterRenderingGroupDrawStage;W<Y.length;W++)Y[W].action(w);this._scene.onAfterRenderingGroupObservable.notifyObservers(u,o)}}},I.prototype.reset=function(){for(var H=I.MIN_RENDERINGGROUPS;H<I.MAX_RENDERINGGROUPS;H++){var A=this._renderingGroups[H];A&&A.prepare()}},I.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},I.prototype.freeRenderingGroups=function(){for(var H=I.MIN_RENDERINGGROUPS;H<I.MAX_RENDERINGGROUPS;H++){var A=this._renderingGroups[H];A&&A.dispose()}},I.prototype._prepareRenderingGroup=function(H){void 0===this._renderingGroups[H]&&(this._renderingGroups[H]=new O.a(H,this._scene,this._customOpaqueSortCompareFn[H],this._customAlphaTestSortCompareFn[H],this._customTransparentSortCompareFn[H]))},I.prototype.dispatchSprites=function(H){var A=H.renderingGroupId||0;this._prepareRenderingGroup(A),this._renderingGroups[A].dispatchSprites(H)},I.prototype.dispatchParticles=function(H){var A=H.renderingGroupId||0;this._prepareRenderingGroup(A),this._renderingGroups[A].dispatchParticles(H)},I.prototype.dispatch=function(H,A,v){void 0===A&&(A=H.getMesh());var z=A.renderingGroupId||0;this._prepareRenderingGroup(z),this._renderingGroups[z].dispatch(H,A,v)},I.prototype.setRenderingOrder=function(H,A,v,z){if(void 0===A&&(A=null),void 0===v&&(v=null),void 0===z&&(z=null),this._customOpaqueSortCompareFn[H]=A,this._customAlphaTestSortCompareFn[H]=v,this._customTransparentSortCompareFn[H]=z,this._renderingGroups[H]){var u=this._renderingGroups[H];u.opaqueSortCompareFn=this._customOpaqueSortCompareFn[H],u.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[H],u.transparentSortCompareFn=this._customTransparentSortCompareFn[H]}},I.prototype.setRenderingAutoClearDepthStencil=function(H,A,v,z){void 0===v&&(v=!0),void 0===z&&(z=!0),this._autoClearDepthStencil[H]={autoClear:A,depth:v,stencil:z}},I.prototype.getAutoClearDepthStencilSetup=function(H){return this._autoClearDepthStencil[H]},I.MAX_RENDERINGGROUPS=4,I.MIN_RENDERINGGROUPS=0,I.AUTOCLEAR=!0,I}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){return function(){}}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return I});var O=l(1),q=l(2),j=l(0),I=function(){function H(){this._dirty=!0,this._tempColor=new j.f(0,0,0,0),this._globalCurve=new j.f(0,0,0,0),this._highlightsCurve=new j.f(0,0,0,0),this._midtonesCurve=new j.f(0,0,0,0),this._shadowsCurve=new j.f(0,0,0,0),this._positiveCurve=new j.f(0,0,0,0),this._negativeCurve=new j.f(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(H.prototype,"globalHue",{get:function(){return this._globalHue},set:function(A){this._globalHue=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(A){this._globalDensity=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(A){this._globalSaturation=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(A){this._globalExposure=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(A){this._highlightsHue=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(A){this._highlightsDensity=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(A){this._highlightsSaturation=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(A){this._highlightsExposure=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(A){this._midtonesHue=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(A){this._midtonesDensity=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(A){this._midtonesSaturation=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(A){this._midtonesExposure=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(A){this._shadowsHue=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(A){this._shadowsDensity=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(A){this._shadowsSaturation=A,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(A){this._shadowsExposure=A,this._dirty=!0},enumerable:!0,configurable:!0}),H.prototype.getClassName=function(){return"ColorCurves"},H.Bind=function(A,v,z,u,w){void 0===z&&(z="vCameraColorCurvePositive"),void 0===u&&(u="vCameraColorCurveNeutral"),void 0===w&&(w="vCameraColorCurveNegative"),A._dirty&&(A._dirty=!1,A.getColorGradingDataToRef(A._globalHue,A._globalDensity,A._globalSaturation,A._globalExposure,A._globalCurve),A.getColorGradingDataToRef(A._highlightsHue,A._highlightsDensity,A._highlightsSaturation,A._highlightsExposure,A._tempColor),A._tempColor.multiplyToRef(A._globalCurve,A._highlightsCurve),A.getColorGradingDataToRef(A._midtonesHue,A._midtonesDensity,A._midtonesSaturation,A._midtonesExposure,A._tempColor),A._tempColor.multiplyToRef(A._globalCurve,A._midtonesCurve),A.getColorGradingDataToRef(A._shadowsHue,A._shadowsDensity,A._shadowsSaturation,A._shadowsExposure,A._tempColor),A._tempColor.multiplyToRef(A._globalCurve,A._shadowsCurve),A._highlightsCurve.subtractToRef(A._midtonesCurve,A._positiveCurve),A._midtonesCurve.subtractToRef(A._shadowsCurve,A._negativeCurve)),v&&(v.setFloat4(z,A._positiveCurve.r,A._positiveCurve.g,A._positiveCurve.b,A._positiveCurve.a),v.setFloat4(u,A._midtonesCurve.r,A._midtonesCurve.g,A._midtonesCurve.b,A._midtonesCurve.a),v.setFloat4(w,A._negativeCurve.r,A._negativeCurve.g,A._negativeCurve.b,A._negativeCurve.a))},H.PrepareUniforms=function(A){A.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},H.prototype.getColorGradingDataToRef=function(A,v,z,u,w){null!=A&&(A=H.clamp(A,0,360),v=H.clamp(v,-100,100),z=H.clamp(z,-100,100),u=H.clamp(u,-100,100),v=H.applyColorGradingSliderNonlinear(v),v*=.5,u=H.applyColorGradingSliderNonlinear(u),v<0&&(v*=-1,A=(A+180)%360),H.fromHSBToRef(A,v,50+.25*u,w),w.scaleToRef(2,w),w.a=1+.01*z)},H.applyColorGradingSliderNonlinear=function(A){A/=100;var v=Math.abs(A);return v=Math.pow(v,2),A<0&&(v*=-1),v*=100},H.fromHSBToRef=function(A,v,z,u){var w=H.clamp(A,0,360),y=H.clamp(v/100,0,1),r=H.clamp(z/100,0,1);if(0===y)u.r=r,u.g=r,u.b=r;else{w/=60;var o=Math.floor(w),G=w-o,M=r*(1-y),R=r*(1-y*G),W=r*(1-y*(1-G));switch(o){case 0:u.r=r,u.g=W,u.b=M;break;case 1:u.r=R,u.g=r,u.b=M;break;case 2:u.r=M,u.g=r,u.b=W;break;case 3:u.r=M,u.g=R,u.b=r;break;case 4:u.r=W,u.g=M,u.b=r;break;default:u.r=r,u.g=M,u.b=R}}u.a=1},H.clamp=function(A,v,z){return Math.min(Math.max(A,v),z)},H.prototype.clone=function(){return q.a.Clone(function(){return new H()},this)},H.prototype.serialize=function(){return q.a.Serialize(this)},H.Parse=function(A){return q.a.Parse(function(){return new H()},A,null,null)},O.c([Object(q.c)()],H.prototype,"_globalHue",void 0),O.c([Object(q.c)()],H.prototype,"_globalDensity",void 0),O.c([Object(q.c)()],H.prototype,"_globalSaturation",void 0),O.c([Object(q.c)()],H.prototype,"_globalExposure",void 0),O.c([Object(q.c)()],H.prototype,"_highlightsHue",void 0),O.c([Object(q.c)()],H.prototype,"_highlightsDensity",void 0),O.c([Object(q.c)()],H.prototype,"_highlightsSaturation",void 0),O.c([Object(q.c)()],H.prototype,"_highlightsExposure",void 0),O.c([Object(q.c)()],H.prototype,"_midtonesHue",void 0),O.c([Object(q.c)()],H.prototype,"_midtonesDensity",void 0),O.c([Object(q.c)()],H.prototype,"_midtonesSaturation",void 0),O.c([Object(q.c)()],H.prototype,"_midtonesExposure",void 0),H}();q.a._ColorCurvesParser=I.Parse},function(Aa,x,l){"use strict";var O=function(){function H(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(H.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(A){this._alphaBlend!==A&&(this._alphaBlend=A,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),H.prototype.setAlphaBlendConstants=function(A,v,z,u){this._blendConstants[0]===A&&this._blendConstants[1]===v&&this._blendConstants[2]===z&&this._blendConstants[3]===u||(this._blendConstants[0]=A,this._blendConstants[1]=v,this._blendConstants[2]=z,this._blendConstants[3]=u,this._isBlendConstantsDirty=!0)},H.prototype.setAlphaBlendFunctionParameters=function(A,v,z,u){this._blendFunctionParameters[0]===A&&this._blendFunctionParameters[1]===v&&this._blendFunctionParameters[2]===z&&this._blendFunctionParameters[3]===u||(this._blendFunctionParameters[0]=A,this._blendFunctionParameters[1]=v,this._blendFunctionParameters[2]=z,this._blendFunctionParameters[3]=u,this._isBlendFunctionParametersDirty=!0)},H.prototype.setAlphaEquationParameters=function(A,v){this._blendEquationParameters[0]===A&&this._blendEquationParameters[1]===v||(this._blendEquationParameters[0]=A,this._blendEquationParameters[1]=v,this._isBlendEquationParametersDirty=!0)},H.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},H.prototype.apply=function(A){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?A.enable(A.BLEND):A.disable(A.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(A.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(A.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(A.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},H}(),q=function(){function H(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(H.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"zOffset",{get:function(){return this._zOffset},set:function(A){this._zOffset!==A&&(this._zOffset=A,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"cullFace",{get:function(){return this._cullFace},set:function(A){this._cullFace!==A&&(this._cullFace=A,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"cull",{get:function(){return this._cull},set:function(A){this._cull!==A&&(this._cull=A,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(A){this._depthFunc!==A&&(this._depthFunc=A,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"depthMask",{get:function(){return this._depthMask},set:function(A){this._depthMask!==A&&(this._depthMask=A,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"depthTest",{get:function(){return this._depthTest},set:function(A){this._depthTest!==A&&(this._depthTest=A,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"frontFace",{get:function(){return this._frontFace},set:function(A){this._frontFace!==A&&(this._frontFace=A,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),H.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},H.prototype.apply=function(A){this.isDirty&&(this._isCullDirty&&(this.cull?A.enable(A.CULL_FACE):A.disable(A.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(A.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(A.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?A.enable(A.DEPTH_TEST):A.disable(A.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(A.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(A.enable(A.POLYGON_OFFSET_FILL),A.polygonOffset(this.zOffset,0)):A.disable(A.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(A.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},H}(),j=l(3),I=function(){function H(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(H.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(A){this._stencilFunc!==A&&(this._stencilFunc=A,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(A){this._stencilFuncRef!==A&&(this._stencilFuncRef=A,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(A){this._stencilFuncMask!==A&&(this._stencilFuncMask=A,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(A){this._stencilOpStencilFail!==A&&(this._stencilOpStencilFail=A,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(A){this._stencilOpDepthFail!==A&&(this._stencilOpDepthFail=A,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(A){this._stencilOpStencilDepthPass!==A&&(this._stencilOpStencilDepthPass=A,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(A){this._stencilMask!==A&&(this._stencilMask=A,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(A){this._stencilTest!==A&&(this._stencilTest=A,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),H.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=H.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=H.KEEP,this._stencilOpDepthFail=H.KEEP,this._stencilOpStencilDepthPass=H.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},H.prototype.apply=function(A){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?A.enable(A.STENCIL_TEST):A.disable(A.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(A.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(A.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(A.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},H.ALWAYS=j.a.ALWAYS,H.KEEP=j.a.KEEP,H.REPLACE=j.a.REPLACE,H}();l.d(x,"a",function(){return O}),l.d(x,"b",function(){return q}),l.d(x,"c",function(){return I})},function(Aa,x,l){"use strict";var O="clipPlaneFragmentDeclaration",q=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="clipPlaneVertexDeclaration",q=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
varying float fClipDistance4;
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";l.r(x);var O=l(30),q=l(8),j=l(0),I=l(22),H=function(){function e(a,b){this.triggerOptions=a,this.onBeforeExecuteObservable=new q.c(),a.parameter?(this.trigger=a.trigger,this._triggerParameter=a.parameter):a.trigger?this.trigger=a.trigger:this.trigger=a,this._nextActiveAction=this,this._condition=b}return e.prototype._prepare=function(){},e.prototype.getTriggerParameter=function(){return this._triggerParameter},e.prototype._executeCurrent=function(a){if(this._nextActiveAction._condition){var b=this._nextActiveAction._condition,c=this._actionManager.getScene().getRenderId();if(b._evaluationId===c){if(!b._currentResult)return}else{if(b._evaluationId=c,!b.isValid())return void(b._currentResult=!1);b._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(a),this.skipToNextActiveAction()},e.prototype.execute=function(a){},e.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},e.prototype.then=function(a){return this._child=a,a._actionManager=this._actionManager,a._prepare(),a},e.prototype._getProperty=function(a){return this._actionManager._getProperty(a)},e.prototype._getEffectiveTarget=function(a,b){return this._actionManager._getEffectiveTarget(a,b)},e.prototype.serialize=function(a){},e.prototype._serialize=function(a,b){var c={type:1,children:[],name:a.name,properties:a.properties||[]};if(this._child&&this._child.serialize(c),this._condition){var d=this._condition.serialize();return d.children.push(c),b&&b.children.push(d),d}return b&&b.children.push(c),c},e._SerializeValueAsString=function(a){return"number"==typeof a?a.toString():"boolean"==typeof a?a?"true":"false":a instanceof j.w?a.x+", "+a.y:a instanceof j.x?a.x+", "+a.y+", "+a.z:a instanceof j.e?a.r+", "+a.g+", "+a.b:a instanceof j.f?a.r+", "+a.g+", "+a.b+", "+a.a:a},e._GetTargetProperty=function(a){return{name:"target",targetType:a._isMesh?"MeshProperties":a._isLight?"LightProperties":a._isCamera?"CameraProperties":"SceneProperties",value:a._isScene?"Scene":a.name}},e}();I.a.RegisteredTypes["BABYLON.Action"]=H;var A=l(36),v=l(1),z=function(){function e(a){this._actionManager=a}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(a){return this._actionManager._getProperty(a)},e.prototype._getEffectiveTarget=function(a,b){return this._actionManager._getEffectiveTarget(a,b)},e.prototype.serialize=function(){},e.prototype._serialize=function(a){return{type:2,children:[],name:a.name,properties:a.properties}},e}(),u=function(e){function a(b,c,d,f,h){void 0===h&&(h=a.IsEqual);var i=e.call(this,b)||this;return i.propertyPath=d,i.value=f,i.operator=h,i._target=c,i._effectiveTarget=i._getEffectiveTarget(c,i.propertyPath),i._property=i._getProperty(i.propertyPath),i}return v.d(a,e),Object.defineProperty(a,"IsEqual",{get:function(){return a._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(a,"IsDifferent",{get:function(){return a._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(a,"IsGreater",{get:function(){return a._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(a,"IsLesser",{get:function(){return a._IsLesser},enumerable:!0,configurable:!0}),a.prototype.isValid=function(){switch(this.operator){case a.IsGreater:return this._effectiveTarget[this._property]>this.value;case a.IsLesser:return this._effectiveTarget[this._property]<this.value;case a.IsEqual:case a.IsDifferent:var b;return b=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===a.IsEqual?b:!b}return!1},a.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[H._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:H._SerializeValueAsString(this.value)},{name:"operator",value:a.GetOperatorName(this.operator)}]})},a.GetOperatorName=function(b){switch(b){case a._IsEqual:return"IsEqual";case a._IsDifferent:return"IsDifferent";case a._IsGreater:return"IsGreater";case a._IsLesser:return"IsLesser";default:return""}},a._IsEqual=0,a._IsDifferent=1,a._IsGreater=2,a._IsLesser=3,a}(z),w=function(e){function a(b,c){var d=e.call(this,b)||this;return d.predicate=c,d}return v.d(a,e),a.prototype.isValid=function(){return this.predicate()},a}(z),y=function(e){function a(b,c,d){var f=e.call(this,b)||this;return f.value=d,f._target=c,f}return v.d(a,e),a.prototype.isValid=function(){return this._target.state===this.value},a.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[H._GetTargetProperty(this._target),{name:"value",value:this.value}]})},a}(z);I.a.RegisteredTypes["BABYLON.ValueCondition"]=u,I.a.RegisteredTypes["BABYLON.PredicateCondition"]=w,I.a.RegisteredTypes["BABYLON.StateCondition"]=y;var r=l(6),o=l(3),G=function(e){function a(b,c,d,f){var h=e.call(this,b,f)||this;return h.propertyPath=d,h._target=h._effectiveTarget=c,h}return v.d(a,e),a.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},a.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[H._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},b)},a}(H),M=function(e){function a(b,c,d,f){var h=e.call(this,b,f)||this;return h.value=d,h._target=c,h}return v.d(a,e),a.prototype.execute=function(){this._target.state=this.value},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"SetStateAction",properties:[H._GetTargetProperty(this._target),{name:"value",value:this.value}]},b)},a}(H),R=function(e){function a(b,c,d,f,h){var i=e.call(this,b,h)||this;return i.propertyPath=d,i.value=f,i._target=i._effectiveTarget=c,i}return v.d(a,e),a.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},a.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"SetValueAction",properties:[H._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:H._SerializeValueAsString(this.value)}]},b)},a}(H),W=function(e){function a(b,c,d,f,h){var i=e.call(this,b,h)||this;return i.propertyPath=d,i.value=f,i._target=i._effectiveTarget=c,i}return v.d(a,e),a.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&r.a.Warn("Warning: IncrementValueAction can only be used with number values")},a.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[H._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:H._SerializeValueAsString(this.value)}]},b)},a}(H),Y=function(e){function a(b,c,d,f,h,i){var k=e.call(this,b,i)||this;return k.from=d,k.to=f,k.loop=h,k._target=c,k}return v.d(a,e),a.prototype._prepare=function(){},a.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[H._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:H._SerializeValueAsString(this.loop)||!1}]},b)},a}(H),X=function(e){function a(b,c,d){var f=e.call(this,b,d)||this;return f._target=c,f}return v.d(a,e),a.prototype._prepare=function(){},a.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[H._GetTargetProperty(this._target)]},b)},a}(H),ea=function(e){function a(b,c){return void 0===b&&(b=o.a.ACTION_NothingTrigger),e.call(this,b,c)||this}return v.d(a,e),a.prototype.execute=function(){},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},b)},a}(H),ca=function(e){function a(b,c,d){var f=e.call(this,b,d)||this;return f.children=c,f}return v.d(a,e),a.prototype._prepare=function(){for(var b=0;b<this.children.length;b++)this.children[b]._actionManager=this._actionManager,this.children[b]._prepare()},a.prototype.execute=function(b){for(var c=0;c<this.children.length;c++)this.children[c].execute(b)},a.prototype.serialize=function(b){for(var c=e.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},b),d=0;d<this.children.length;d++)c.combine.push(this.children[d].serialize(null));return c},a}(H),oa=function(e){function a(b,c,d){var f=e.call(this,b,d)||this;return f.func=c,f}return v.d(a,e),a.prototype.execute=function(b){this.func(b)},a}(H),Z=function(e){function a(b,c,d,f){var h=e.call(this,b,f)||this;return h._target=c,h._parent=d,h}return v.d(a,e),a.prototype._prepare=function(){},a.prototype.execute=function(){if(this._target.parent!==this._parent){var b=this._parent.getWorldMatrix().clone();b.invert(),this._target.position=j.x.TransformCoordinates(this._target.position,b),this._target.parent=this._parent}},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"SetParentAction",properties:[H._GetTargetProperty(this._target),H._GetTargetProperty(this._parent)]},b)},a}(H);I.a.RegisteredTypes["BABYLON.SetParentAction"]=Z,I.a.RegisteredTypes["BABYLON.ExecuteCodeAction"]=oa,I.a.RegisteredTypes["BABYLON.DoNothingAction"]=ea,I.a.RegisteredTypes["BABYLON.StopAnimationAction"]=X,I.a.RegisteredTypes["BABYLON.PlayAnimationAction"]=Y,I.a.RegisteredTypes["BABYLON.IncrementValueAction"]=W,I.a.RegisteredTypes["BABYLON.SetValueAction"]=R,I.a.RegisteredTypes["BABYLON.SetStateAction"]=M,I.a.RegisteredTypes["BABYLON.SetParentAction"]=Z;var T=l(23),V=l(32),D=function(e){function a(b){var c=e.call(this)||this;return c._scene=b||T.a.LastCreatedScene,b.actionManagers.push(c),c}return v.d(a,e),a.prototype.dispose=function(){for(var b=this._scene.actionManagers.indexOf(this),c=0;c<this.actions.length;c++){var d=this.actions[c];a.Triggers[d.trigger]--,0===a.Triggers[d.trigger]&&delete a.Triggers[d.trigger]}b>-1&&this._scene.actionManagers.splice(b,1)},a.prototype.getScene=function(){return this._scene},a.prototype.hasSpecificTriggers=function(b){for(var c=0;c<this.actions.length;c++){var d=this.actions[c];if(b.indexOf(d.trigger)>-1)return!0}return!1},a.prototype.hasSpecificTriggers2=function(b,c){for(var d=0;d<this.actions.length;d++){var f=this.actions[d];if(b==f.trigger||c==f.trigger)return!0}return!1},a.prototype.hasSpecificTrigger=function(b,c){for(var d=0;d<this.actions.length;d++){var f=this.actions[d];if(f.trigger===b){if(!c)return!0;if(c(f.getTriggerParameter()))return!0}}return!1},Object.defineProperty(a.prototype,"hasPointerTriggers",{get:function(){for(var b=0;b<this.actions.length;b++){var c=this.actions[b];if(c.trigger>=a.OnPickTrigger&&c.trigger<=a.OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasPickTriggers",{get:function(){for(var b=0;b<this.actions.length;b++){var c=this.actions[b];if(c.trigger>=a.OnPickTrigger&&c.trigger<=a.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),a.prototype.registerAction=function(b){return b.trigger===a.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(r.a.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(b),a.Triggers[b.trigger]?a.Triggers[b.trigger]++:a.Triggers[b.trigger]=1,b._actionManager=this,b._prepare(),b)},a.prototype.unregisterAction=function(b){var c=this.actions.indexOf(b);return-1!==c&&(this.actions.splice(c,1),a.Triggers[b.trigger]-=1,0===a.Triggers[b.trigger]&&delete a.Triggers[b.trigger],delete b._actionManager,!0)},a.prototype.processTrigger=function(b,c){for(var d=0;d<this.actions.length;d++){var f=this.actions[d];if(f.trigger===b){if(c&&(b===a.OnKeyUpTrigger||b===a.OnKeyDownTrigger)){var h=f.getTriggerParameter();if(h&&h!==c.sourceEvent.keyCode){if(!h.toLowerCase)continue;var i=h.toLowerCase();if(i!==c.sourceEvent.key){var k=c.sourceEvent.charCode?c.sourceEvent.charCode:c.sourceEvent.keyCode;if(String.fromCharCode(k).toLowerCase()!==i)continue}}}f._executeCurrent(c)}}},a.prototype._getEffectiveTarget=function(b,c){for(var d=c.split("."),f=0;f<d.length-1;f++)b=b[d[f]];return b},a.prototype._getProperty=function(b){var c=b.split(".");return c[c.length-1]},a.prototype.serialize=function(b){for(var c={children:new Array(),name:b,type:3,properties:new Array()},d=0;d<this.actions.length;d++){var f={type:0,children:new Array(),name:a.GetTriggerName(this.actions[d].trigger),properties:new Array()},h=this.actions[d].triggerOptions;if(h&&"number"!=typeof h)if(h.parameter instanceof Node)f.properties.push(H._GetTargetProperty(h.parameter));else{var i={};V.a.DeepCopy(h.parameter,i,["mesh"]),h.parameter&&h.parameter.mesh&&(i._meshId=h.parameter.mesh.id),f.properties.push({name:"parameter",targetType:null,value:i})}this.actions[d].serialize(f),c.children.push(f)}return c},a.Parse=function(b,c,d){var f=new a(d);null===c?d.actionManager=f:c.actionManager=f;for(var h=function(S,U,_,da){if(null===da){var fa=parseFloat(U);return"true"===U||"false"===U?"true"===U:isNaN(fa)?U:fa}for(var ga=da.split("."),ha=U.split(","),ka=0;ka<ga.length;ka++)_=_[ga[ka]];if("boolean"==typeof _)return"true"===ha[0];if("string"==typeof _)return ha[0];var la=new Array();for(ka=0;ka<ha.length;ka++)la.push(parseFloat(ha[ka]));return _ instanceof j.x?j.x.FromArray(la):_ instanceof j.y?j.y.FromArray(la):_ instanceof j.e?j.e.FromArray(la):_ instanceof j.f?j.f.FromArray(la):parseFloat(ha[0])},i=function(S,U,_,da,fa){if(void 0===fa&&(fa=null),!S.detached){var ga=new Array(),ha=null,ka=null,la=S.combine&&S.combine.length>0;if(2===S.type?ga.push(f):ga.push(U),la){for(var ma=new Array(),ta=0;ta<S.combine.length;ta++)i(S.combine[ta],a.NothingTrigger,_,da,ma);ga.push(ma)}else for(var pa=0;pa<S.properties.length;pa++){var ua=S.properties[pa].value,wa=S.properties[pa].name,ya=S.properties[pa].targetType;"target"===wa?ua=ha=null!==ya&&"SceneProperties"===ya?d:d.getNodeByName(ua):"parent"===wa?ua=d.getNodeByName(ua):"sound"===wa?d.getSoundByName&&(ua=d.getSoundByName(ua)):"propertyPath"!==wa?ua=2===S.type&&"operator"===wa?u[ua]:h(0,ua,ha,"value"===wa?ka:null):ka=ua,ga.push(ua)}if(null===fa?ga.push(_):ga.push(null),"InterpolateValueAction"===S.name){var Da=ga[ga.length-2];ga[ga.length-1]=Da,ga[ga.length-2]=_}var Ja=function(Ma,Ha){var Qa=I.a.GetClass("BABYLON."+Ma);if(Qa){var cb=Object.create(Qa.prototype);return cb.constructor.apply(cb,Ha),cb}}(S.name,ga);if(Ja instanceof z&&null!==_){var Na=new ea(U,_);da?da.then(Na):f.registerAction(Na),da=Na}for(null===fa?Ja instanceof z?(_=Ja,Ja=da):(_=null,da?da.then(Ja):f.registerAction(Ja)):fa.push(Ja),pa=0;pa<S.children.length;pa++)i(S.children[pa],U,_,Ja,null)}},k=0;k<b.children.length;k++){var m,B=b.children[k];if(B.properties.length>0){var E=B.properties[0].value,K=null===B.properties[0].targetType?E:d.getMeshByName(E);K._meshId&&(K.mesh=d.getMeshByID(K._meshId)),m={trigger:a[B.name],parameter:K}}else m=a[B.name];for(var P=0;P<B.children.length;P++)B.detached||i(B.children[P],m,null,null)}},a.GetTriggerName=function(b){switch(b){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},a.NothingTrigger=o.a.ACTION_NothingTrigger,a.OnPickTrigger=o.a.ACTION_OnPickTrigger,a.OnLeftPickTrigger=o.a.ACTION_OnLeftPickTrigger,a.OnRightPickTrigger=o.a.ACTION_OnRightPickTrigger,a.OnCenterPickTrigger=o.a.ACTION_OnCenterPickTrigger,a.OnPickDownTrigger=o.a.ACTION_OnPickDownTrigger,a.OnDoublePickTrigger=o.a.ACTION_OnDoublePickTrigger,a.OnPickUpTrigger=o.a.ACTION_OnPickUpTrigger,a.OnPickOutTrigger=o.a.ACTION_OnPickOutTrigger,a.OnLongPressTrigger=o.a.ACTION_OnLongPressTrigger,a.OnPointerOverTrigger=o.a.ACTION_OnPointerOverTrigger,a.OnPointerOutTrigger=o.a.ACTION_OnPointerOutTrigger,a.OnEveryFrameTrigger=o.a.ACTION_OnEveryFrameTrigger,a.OnIntersectionEnterTrigger=o.a.ACTION_OnIntersectionEnterTrigger,a.OnIntersectionExitTrigger=o.a.ACTION_OnIntersectionExitTrigger,a.OnKeyDownTrigger=o.a.ACTION_OnKeyDownTrigger,a.OnKeyUpTrigger=15,a}(l(79).a),F=function(e){function a(b,c,d){var f=e.call(this,b,d)||this;return f._sound=c,f}return v.d(a,e),a.prototype._prepare=function(){},a.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},b)},a}(H),L=function(e){function a(b,c,d){var f=e.call(this,b,d)||this;return f._sound=c,f}return v.d(a,e),a.prototype._prepare=function(){},a.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},b)},a}(H);I.a.RegisteredTypes["BABYLON.PlaySoundAction"]=L,I.a.RegisteredTypes["BABYLON.StopSoundAction"]=L;var N,p=l(12),g=l(2);!function(e){e[e.STEP=1]="STEP"}(N||(N={}));var n=function(){function e(a,b,c){this.name=a,this.from=b,this.to=c}return e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e}(),s=l(25),t=function(){return function(){}}(),C=function(){function e(a,b,c,d,f,h){this.name=a,this.targetProperty=b,this.framePerSecond=c,this.dataType=d,this.loopMode=f,this.enableBlending=h,this._runtimeAnimations=new Array(),this._events=new Array(),this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=b.split("."),this.dataType=d,this.loopMode=void 0===f?e.ANIMATIONLOOPMODE_CYCLE:f}return e._PrepareAnimation=function(a,b,c,d,f,h,i,k){var m;if(!isNaN(parseFloat(f))&&isFinite(f)?m=e.ANIMATIONTYPE_FLOAT:f instanceof j.q?m=e.ANIMATIONTYPE_QUATERNION:f instanceof j.x?m=e.ANIMATIONTYPE_VECTOR3:f instanceof j.w?m=e.ANIMATIONTYPE_VECTOR2:f instanceof j.e?m=e.ANIMATIONTYPE_COLOR3:f instanceof j.r&&(m=e.ANIMATIONTYPE_SIZE),null==m)return null;var B=new e(a,b,c,m,i),E=[{frame:0,value:f},{frame:d,value:h}];return B.setKeys(E),void 0!==k&&B.setEasingFunction(k),B},e.CreateAnimation=function(a,b,c,d){var f=new e(a+"Animation",a,c,b,e.ANIMATIONLOOPMODE_CONSTANT);return f.setEasingFunction(d),f},e.CreateAndStartAnimation=function(a,b,c,d,f,h,i,k,m,B){var E=e._PrepareAnimation(a,c,d,f,h,i,k,m);return E?b.getScene().beginDirectAnimation(b,[E],0,f,1===E.loopMode,1,B):null},e.CreateAndStartHierarchyAnimation=function(a,b,c,d,f,h,i,k,m,B,E){var K=e._PrepareAnimation(a,d,f,h,i,k,m,B);return K?b.getScene().beginDirectHierarchyAnimation(b,c,[K],0,h,1===K.loopMode,1,E):null},e.CreateMergeAndStartAnimation=function(a,b,c,d,f,h,i,k,m,B){var E=e._PrepareAnimation(a,c,d,f,h,i,k,m);return E?(b.animations.push(E),b.getScene().beginAnimation(b,0,f,1===E.loopMode,1,B)):null},e.TransitionTo=function(a,b,c,d,f,h,i,k){if(void 0===k&&(k=null),i<=0)return c[a]=b,k&&k(),null;var m=f*(i/1000);h.setKeys([{frame:0,value:c[a].clone?c[a].clone():c[a]},{frame:m,value:b}]),c.animations||(c.animations=[]),c.animations.push(h);var B=d.beginAnimation(c,0,m,!1);return B.onAnimationEnd=k,B},Object.defineProperty(e.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var a=0,b=this._runtimeAnimations;a<b.length;a++)if(!b[a].isStopped)return!0;return!1},enumerable:!0,configurable:!0}),e.prototype.toString=function(a){var b="Name: "+this.name+", property: "+this.targetProperty;if(b+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],b+=", nKeys: "+(this._keys?this._keys.length:"none"),b+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),a){b+=", Ranges: {";var c=!0;for(var d in this._ranges)c&&(b+=", ",c=!1),b+=d;b+="}"}return b},e.prototype.addEvent=function(a){this._events.push(a)},e.prototype.removeEvents=function(a){for(var b=0;b<this._events.length;b++)this._events[b].frame===a&&(this._events.splice(b,1),b--)},e.prototype.getEvents=function(){return this._events},e.prototype.createRange=function(a,b,c){this._ranges[a]||(this._ranges[a]=new n(a,b,c))},e.prototype.deleteRange=function(a,b){void 0===b&&(b=!0);var c=this._ranges[a];if(c){if(b)for(var d=c.from,f=c.to,h=this._keys.length-1;h>=0;h--)this._keys[h].frame>=d&&this._keys[h].frame<=f&&this._keys.splice(h,1);this._ranges[a]=null}},e.prototype.getRange=function(a){return this._ranges[a]},e.prototype.getKeys=function(){return this._keys},e.prototype.getHighestFrame=function(){for(var a=0,b=0,c=this._keys.length;b<c;b++)a<this._keys[b].frame&&(a=this._keys[b].frame);return a},e.prototype.getEasingFunction=function(){return this._easingFunction},e.prototype.setEasingFunction=function(a){this._easingFunction=a},e.prototype.floatInterpolateFunction=function(a,b,c){return p.a.Lerp(a,b,c)},e.prototype.floatInterpolateFunctionWithTangents=function(a,b,c,d,f){return p.a.Hermite(a,b,c,d,f)},e.prototype.quaternionInterpolateFunction=function(a,b,c){return j.q.Slerp(a,b,c)},e.prototype.quaternionInterpolateFunctionWithTangents=function(a,b,c,d,f){return j.q.Hermite(a,b,c,d,f).normalize()},e.prototype.vector3InterpolateFunction=function(a,b,c){return j.x.Lerp(a,b,c)},e.prototype.vector3InterpolateFunctionWithTangents=function(a,b,c,d,f){return j.x.Hermite(a,b,c,d,f)},e.prototype.vector2InterpolateFunction=function(a,b,c){return j.w.Lerp(a,b,c)},e.prototype.vector2InterpolateFunctionWithTangents=function(a,b,c,d,f){return j.w.Hermite(a,b,c,d,f)},e.prototype.sizeInterpolateFunction=function(a,b,c){return j.r.Lerp(a,b,c)},e.prototype.color3InterpolateFunction=function(a,b,c){return j.e.Lerp(a,b,c)},e.prototype._getKeyValue=function(a){return"function"==typeof a?a():a},e.prototype._interpolate=function(a,b){if(b.loopMode===e.ANIMATIONLOOPMODE_CONSTANT&&b.repeatCount>0)return b.highLimitValue.clone?b.highLimitValue.clone():b.highLimitValue;var c=this._keys;if(1===c.length)return this._getKeyValue(c[0].value);var d=b.key;if(c[d].frame>=a)for(;d-1>=0&&c[d].frame>=a;)d--;for(var f=d;f<c.length;f++){var h=c[f+1];if(h.frame>=a){b.key=f;var i=c[f],k=this._getKeyValue(i.value);if(i.interpolation===N.STEP)return k;var m=this._getKeyValue(h.value),B=void 0!==i.outTangent&&void 0!==h.inTangent,E=h.frame-i.frame,K=(a-i.frame)/E,P=this.getEasingFunction();switch(null!=P&&(K=P.ease(K)),this.dataType){case e.ANIMATIONTYPE_FLOAT:var S=B?this.floatInterpolateFunctionWithTangents(k,i.outTangent*E,m,h.inTangent*E,K):this.floatInterpolateFunction(k,m,K);switch(b.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return S;case e.ANIMATIONLOOPMODE_RELATIVE:return b.offsetValue*b.repeatCount+S}break;case e.ANIMATIONTYPE_QUATERNION:var U=B?this.quaternionInterpolateFunctionWithTangents(k,i.outTangent.scale(E),m,h.inTangent.scale(E),K):this.quaternionInterpolateFunction(k,m,K);switch(b.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return U;case e.ANIMATIONLOOPMODE_RELATIVE:return U.addInPlace(b.offsetValue.scale(b.repeatCount))}return U;case e.ANIMATIONTYPE_VECTOR3:var _=B?this.vector3InterpolateFunctionWithTangents(k,i.outTangent.scale(E),m,h.inTangent.scale(E),K):this.vector3InterpolateFunction(k,m,K);switch(b.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return _;case e.ANIMATIONLOOPMODE_RELATIVE:return _.add(b.offsetValue.scale(b.repeatCount))}case e.ANIMATIONTYPE_VECTOR2:var da=B?this.vector2InterpolateFunctionWithTangents(k,i.outTangent.scale(E),m,h.inTangent.scale(E),K):this.vector2InterpolateFunction(k,m,K);switch(b.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return da;case e.ANIMATIONLOOPMODE_RELATIVE:return da.add(b.offsetValue.scale(b.repeatCount))}case e.ANIMATIONTYPE_SIZE:switch(b.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(k,m,K);case e.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(k,m,K).add(b.offsetValue.scale(b.repeatCount))}case e.ANIMATIONTYPE_COLOR3:switch(b.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(k,m,K);case e.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(k,m,K).add(b.offsetValue.scale(b.repeatCount))}case e.ANIMATIONTYPE_MATRIX:switch(b.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:if(e.AllowMatricesInterpolation)return this.matrixInterpolateFunction(k,m,K,b.workValue);case e.ANIMATIONLOOPMODE_RELATIVE:return k}}break}}return this._getKeyValue(c[c.length-1].value)},e.prototype.matrixInterpolateFunction=function(a,b,c,d){return e.AllowMatrixDecomposeForInterpolation?d?(j.j.DecomposeLerpToRef(a,b,c,d),d):j.j.DecomposeLerp(a,b,c):d?(j.j.LerpToRef(a,b,c,d),d):j.j.Lerp(a,b,c)},e.prototype.clone=function(){var a=new e(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(a.enableBlending=this.enableBlending,a.blendingSpeed=this.blendingSpeed,this._keys&&a.setKeys(this._keys),this._ranges)for(var b in a._ranges={},this._ranges){var c=this._ranges[b];c&&(a._ranges[b]=c.clone())}return a},e.prototype.setKeys=function(a){this._keys=a.slice(0)},e.prototype.serialize=function(){var a={};a.name=this.name,a.property=this.targetProperty,a.framePerSecond=this.framePerSecond,a.dataType=this.dataType,a.loopBehavior=this.loopMode,a.enableBlending=this.enableBlending,a.blendingSpeed=this.blendingSpeed;var b=this.dataType;a.keys=[];for(var c=this.getKeys(),d=0;d<c.length;d++){var f=c[d],h={};switch(h.frame=f.frame,b){case e.ANIMATIONTYPE_FLOAT:h.values=[f.value];break;case e.ANIMATIONTYPE_QUATERNION:case e.ANIMATIONTYPE_MATRIX:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:h.values=f.value.asArray()}a.keys.push(h)}for(var i in a.ranges=[],this._ranges){var k=this._ranges[i];if(k){var m={};m.name=i,m.from=k.from,m.to=k.to,a.ranges.push(m)}}return a},Object.defineProperty(e,"ANIMATIONTYPE_FLOAT",{get:function(){return e._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_VECTOR3",{get:function(){return e._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_VECTOR2",{get:function(){return e._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_SIZE",{get:function(){return e._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_QUATERNION",{get:function(){return e._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_MATRIX",{get:function(){return e._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_COLOR3",{get:function(){return e._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return e._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return e._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return e._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),e._UniversalLerp=function(a,b,c){var d=a.constructor;return d.Lerp?d.Lerp(a,b,c):d.Slerp?d.Slerp(a,b,c):a.toFixed?a*(1-c)+c*b:b},e.Parse=function(a){var b,c,d=new e(a.name,a.property,a.framePerSecond,a.dataType,a.loopBehavior),f=a.dataType,h=[];for(a.enableBlending&&(d.enableBlending=a.enableBlending),a.blendingSpeed&&(d.blendingSpeed=a.blendingSpeed),c=0;c<a.keys.length;c++){var i,k,m=a.keys[c];switch(f){case e.ANIMATIONTYPE_FLOAT:b=m.values[0],m.values.length>=1&&(i=m.values[1]),m.values.length>=2&&(k=m.values[2]);break;case e.ANIMATIONTYPE_QUATERNION:if(b=j.q.FromArray(m.values),m.values.length>=8){var B=j.q.FromArray(m.values.slice(4,8));B.equals(j.q.Zero())||(i=B)}if(m.values.length>=12){var E=j.q.FromArray(m.values.slice(8,12));E.equals(j.q.Zero())||(k=E)}break;case e.ANIMATIONTYPE_MATRIX:b=j.j.FromArray(m.values);break;case e.ANIMATIONTYPE_COLOR3:b=j.e.FromArray(m.values);break;case e.ANIMATIONTYPE_VECTOR3:default:b=j.x.FromArray(m.values)}var K={};K.frame=m.frame,K.value=b,null!=i&&(K.inTangent=i),null!=k&&(K.outTangent=k),h.push(K)}if(d.setKeys(h),a.ranges)for(c=0;c<a.ranges.length;c++)b=a.ranges[c],d.createRange(b.name,b.from,b.to);return d},e.AppendSerializedAnimations=function(a,b){g.a.AppendSerializedAnimations(a,b)},e.AllowMatricesInterpolation=!1,e.AllowMatrixDecomposeForInterpolation=!0,e._ANIMATIONTYPE_FLOAT=0,e._ANIMATIONTYPE_VECTOR3=1,e._ANIMATIONTYPE_QUATERNION=2,e._ANIMATIONTYPE_MATRIX=3,e._ANIMATIONTYPE_COLOR3=4,e._ANIMATIONTYPE_VECTOR2=5,e._ANIMATIONTYPE_SIZE=6,e._ANIMATIONLOOPMODE_RELATIVE=0,e._ANIMATIONLOOPMODE_CYCLE=1,e._ANIMATIONLOOPMODE_CONSTANT=2,e}();I.a.RegisteredTypes["BABYLON.Animation"]=C,s.a._AnimationRangeFactory=function(e,a,b){return new n(e,a,b)};var J=function(e){function a(b,c,d,f,h,i,k,m){void 0===h&&(h=1000);var B=e.call(this,b,i)||this;return B.duration=1000,B.onInterpolationDoneObservable=new q.c(),B.propertyPath=d,B.value=f,B.duration=h,B.stopOtherAnimations=k,B.onInterpolationDone=m,B._target=B._effectiveTarget=c,B}return v.d(a,e),a.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},a.prototype.execute=function(){var b,c=this,d=this._actionManager.getScene(),f=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)b=C.ANIMATIONTYPE_FLOAT;else if(this.value instanceof j.e)b=C.ANIMATIONTYPE_COLOR3;else if(this.value instanceof j.x)b=C.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof j.j)b=C.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof j.q))return void r.a.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");b=C.ANIMATIONTYPE_QUATERNION}var h=new C("InterpolateValueAction",this._property,1000/this.duration*100,b,C.ANIMATIONLOOPMODE_CONSTANT);h.setKeys(f),this.stopOtherAnimations&&d.stopAnimation(this._effectiveTarget),d.beginDirectAnimation(this._effectiveTarget,[h],0,100,!1,1,function(){c.onInterpolationDoneObservable.notifyObservers(c),c.onInterpolationDone&&c.onInterpolationDone()})},a.prototype.serialize=function(b){return e.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[H._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:H._SerializeValueAsString(this.value)},{name:"duration",value:H._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:H._SerializeValueAsString(this.stopOtherAnimations)||!1}]},b)},a}(H);I.a.RegisteredTypes["BABYLON.InterpolateValueAction"]=J;var Q=Object.freeze(new j.q(0,0,0,0)),$=Object.freeze(j.x.Zero()),aa=Object.freeze(j.w.Zero()),ba=Object.freeze(j.r.Zero()),ia=Object.freeze(j.e.Black()),qa=function(){function e(a,b,c,d){var f=this;if(this._events=new Array(),this._currentFrame=0,this._originalValue=new Array(),this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=b,this._target=a,this._scene=c,this._host=d,this._activeTargets=[],b._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===C.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=j.j.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){var h={frame:0,value:this._minValue};this._keys.splice(0,0,h)}if(this._target instanceof Array){for(var i=0,k=0,m=this._target;k<m.length;k++){var B=m[k];this._preparePath(B,i),this._getOriginalValues(i),i++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var E=b.getEvents();E&&E.length>0&&E.forEach(function(K){f._events.push(K._clone())}),this._enableBlending=a&&a.animationPropertiesOverride?a.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(e.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!0,configurable:!0}),e.prototype._preparePath=function(a,b){void 0===b&&(b=0);var c=this._animation.targetPropertyPath;if(c.length>1){for(var d=a[c[0]],f=1;f<c.length-1;f++)d=d[c[f]];this._targetPath=c[c.length-1],this._activeTargets[b]=d}else this._targetPath=c[0],this._activeTargets[b]=a},Object.defineProperty(e.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),e.prototype.reset=function(a){if(void 0===a&&(a=!1),a)if(this._target instanceof Array)for(var b=0,c=0,d=this._target;c<d.length;c++){var f=d[c];void 0!==this._originalValue[b]&&this._setValue(f,this._activeTargets[b],this._originalValue[b],-1,b),b++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);for(this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,b=0;b<this._events.length;b++)this._events[b].isDone=!1},e.prototype.isStopped=function(){return this._stopped},e.prototype.dispose=function(){var a=this._animation.runtimeAnimations.indexOf(this);a>-1&&this._animation.runtimeAnimations.splice(a,1)},e.prototype.setValue=function(a,b){if(this._targetIsArray)for(var c=0;c<this._target.length;c++){var d=this._target[c];this._setValue(d,this._activeTargets[c],a,b,c)}else this._setValue(this._target,this._directTarget,a,b,0)},e.prototype._getOriginalValues=function(a){var b;void 0===a&&(a=0);var c=this._activeTargets[a];(b=c.getRestPose&&"_matrix"===this._targetPath?c.getRestPose():c[this._targetPath])&&b.clone?this._originalValue[a]=b.clone():this._originalValue[a]=b},e.prototype._setValue=function(a,b,c,d,f){if(this._currentActiveTarget=b,this._weight=d,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var h=b[this._targetPath];h.clone?this._originalBlendValue=h.clone():this._originalBlendValue=h}this._originalBlendValue.m?C.AllowMatrixDecomposeForInterpolation?this._currentValue?j.j.DecomposeLerpToRef(this._originalBlendValue,c,this._blendingFactor,this._currentValue):this._currentValue=j.j.DecomposeLerp(this._originalBlendValue,c,this._blendingFactor):this._currentValue?j.j.LerpToRef(this._originalBlendValue,c,this._blendingFactor,this._currentValue):this._currentValue=j.j.Lerp(this._originalBlendValue,c,this._blendingFactor):this._currentValue=C._UniversalLerp(this._originalBlendValue,c,this._blendingFactor);var i=a&&a.animationPropertiesOverride?a.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=i}else this._currentValue=c;-1!==d?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[f]):b[this._targetPath]=this._currentValue,a.markAsDirty&&a.markAsDirty(this._animation.targetProperty)},e.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},e.prototype.goToFrame=function(a){var b=this._animation.getKeys();a<b[0].frame?a=b[0].frame:a>b[b.length-1].frame&&(a=b[b.length-1].frame),this._currentFrame=a;var c=this._animation._interpolate(a,this._animationState);this.setValue(c,-1)},e.prototype._prepareForSpeedRatioChange=function(a){var b=this._previousDelay*(this._animation.framePerSecond*a)/1000;this._ratioOffset=this._previousRatio-b},e.prototype.animate=function(a,b,c,d,f,h){void 0===h&&(h=-1);var i=this._animation,k=i.targetPropertyPath;if(!k||k.length<1)return this._stopped=!0,!1;var m=!0;(b<this._minFrame||b>this._maxFrame)&&(b=this._minFrame),(c<this._minFrame||c>this._maxFrame)&&(c=this._maxFrame);var B,E,K=c-b,P=a*(i.framePerSecond*f)/1000+this._ratioOffset,S=0;if(this._previousDelay=a,this._previousRatio=P,!d&&c>=b&&P>=K)m=!1,S=i._getKeyValue(this._maxValue);else if(!d&&b>=c&&P<=K)m=!1,S=i._getKeyValue(this._minValue);else if(this._animationState.loopMode!==C.ANIMATIONLOOPMODE_CYCLE){var U=c.toString()+b.toString();if(!this._offsetsCache[U]){this._animationState.repeatCount=0,this._animationState.loopMode=C.ANIMATIONLOOPMODE_CYCLE;var _=i._interpolate(b,this._animationState),da=i._interpolate(c,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),i.dataType){case C.ANIMATIONTYPE_FLOAT:this._offsetsCache[U]=da-_;break;case C.ANIMATIONTYPE_QUATERNION:this._offsetsCache[U]=da.subtract(_);break;case C.ANIMATIONTYPE_VECTOR3:this._offsetsCache[U]=da.subtract(_);case C.ANIMATIONTYPE_VECTOR2:this._offsetsCache[U]=da.subtract(_);case C.ANIMATIONTYPE_SIZE:this._offsetsCache[U]=da.subtract(_);case C.ANIMATIONTYPE_COLOR3:this._offsetsCache[U]=da.subtract(_)}this._highLimitsCache[U]=da}S=this._highLimitsCache[U],B=this._offsetsCache[U]}if(void 0===B)switch(i.dataType){case C.ANIMATIONTYPE_FLOAT:B=0;break;case C.ANIMATIONTYPE_QUATERNION:B=Q;break;case C.ANIMATIONTYPE_VECTOR3:B=$;break;case C.ANIMATIONTYPE_VECTOR2:B=aa;break;case C.ANIMATIONTYPE_SIZE:B=ba;break;case C.ANIMATIONTYPE_COLOR3:B=ia}if(this._host&&this._host.syncRoot){var fa=this._host.syncRoot;E=b+(c-b)*((fa.masterFrame-fa.fromFrame)/(fa.toFrame-fa.fromFrame))}else E=m&&0!==K?b+P%K:c;var ga=this._events;if((K>0&&this.currentFrame>E||K<0&&this.currentFrame<E)&&(this._onLoop(),ga.length))for(var ha=0;ha<ga.length;ha++)ga[ha].onlyOnce||(ga[ha].isDone=!1);this._currentFrame=E,this._animationState.repeatCount=0===K?0:P/K>>0,this._animationState.highLimitValue=S,this._animationState.offsetValue=B;var ka=i._interpolate(E,this._animationState);if(this.setValue(ka,h),ga.length){for(ha=0;ha<ga.length;ha++)if(K>0&&E>=ga[ha].frame&&ga[ha].frame>=b||K<0&&E<=ga[ha].frame&&ga[ha].frame<=b){var la=ga[ha];la.isDone||(la.onlyOnce&&(ga.splice(ha,1),ha--),la.isDone=!0,la.action(E))}}return m||(this._stopped=!0),m},e}(),ja=l(16),sa=l(47),za=l(34),Fa=function(e){function a(b,c,d,f,h,i,k){void 0===d&&(d=null),void 0===f&&(f=null),void 0===h&&(h=null),void 0===i&&(i=null),void 0===k&&(k=null);var m=e.call(this,b,c.getScene(),!1)||this;return m.name=b,m.children=new Array(),m.animations=new Array(),m._index=null,m._absoluteTransform=new j.j(),m._invertedAbsoluteTransform=new j.j(),m._scalingDeterminant=1,m._worldTransform=new j.j(),m._needToDecompose=!0,m._needToCompose=!1,m._linkedTransformNode=null,m._waitingTransformNodeId=null,m._skeleton=c,m._localMatrix=f?f.clone():j.j.Identity(),m._restPose=h||m._localMatrix.clone(),m._baseMatrix=i||m._localMatrix.clone(),m._index=k,c.bones.push(m),m.setParent(d,!1),(i||f)&&m._updateDifferenceMatrix(),m}return v.d(a,e),Object.defineProperty(a.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(b){this._localMatrix.copyFrom(b),this._needToDecompose=!0},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"Bone"},a.prototype.getSkeleton=function(){return this._skeleton},a.prototype.getParent=function(){return this._parent},a.prototype.getChildren=function(){return this.children},a.prototype.setParent=function(b,c){if(void 0===c&&(c=!0),this._parent!==b){if(this._parent){var d=this._parent.children.indexOf(this);-1!==d&&this._parent.children.splice(d,1)}this._parent=b,this._parent&&this._parent.children.push(this),c&&this._updateDifferenceMatrix(),this.markAsDirty()}},a.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},a.prototype.getBaseMatrix=function(){return this._baseMatrix},a.prototype.getRestPose=function(){return this._restPose},a.prototype.getWorldMatrix=function(){return this._worldTransform},a.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},a.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},a.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},a.prototype.linkTransformNode=function(b){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=b,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},Object.defineProperty(a.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(b){this._decompose(),this._localPosition.copyFrom(b),this._markAsDirtyAndCompose()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotation",{get:function(){return this.getRotation()},set:function(b){this.setRotation(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(b){this.setRotationQuaternion(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scaling",{get:function(){return this.getScale()},set:function(b){this.setScale(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!0,configurable:!0}),a.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=j.x.Zero(),this._localRotation=j.q.Zero(),this._localPosition=j.x.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},a.prototype._compose=function(){this._needToCompose&&(this._needToCompose=!1,j.j.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix))},a.prototype.updateMatrix=function(b,c,d){void 0===c&&(c=!0),void 0===d&&(d=!0),this._baseMatrix.copyFrom(b),c&&this._updateDifferenceMatrix(),d?(this._localMatrix.copyFrom(b),this._markAsDirtyAndDecompose()):this.markAsDirty()},a.prototype._updateDifferenceMatrix=function(b,c){if(void 0===c&&(c=!0),b||(b=this._baseMatrix),this._parent?b.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(b),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),c)for(var d=0;d<this.children.length;d++)this.children[d]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},a.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},a.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},a.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},a.prototype.translate=function(b,c,d){void 0===c&&(c=j.s.LOCAL);var f=this.getLocalMatrix();if(c==j.s.LOCAL)f.addAtIndex(12,b.x),f.addAtIndex(13,b.y),f.addAtIndex(14,b.z);else{var h=null;d&&(h=d.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var i=a._tmpMats[0],k=a._tmpVecs[0];this._parent&&(d&&h?(i.copyFrom(this._parent.getAbsoluteTransform()),i.multiplyToRef(h,i)):i.copyFrom(this._parent.getAbsoluteTransform())),i.setTranslationFromFloats(0,0,0),i.invert(),j.x.TransformCoordinatesToRef(b,i,k),f.addAtIndex(12,k.x),f.addAtIndex(13,k.y),f.addAtIndex(14,k.z)}this._markAsDirtyAndDecompose()},a.prototype.setPosition=function(b,c,d){void 0===c&&(c=j.s.LOCAL);var f=this.getLocalMatrix();if(c==j.s.LOCAL)f.setTranslationFromFloats(b.x,b.y,b.z);else{var h=null;d&&(h=d.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var i=a._tmpMats[0],k=a._tmpVecs[0];this._parent&&(d&&h?(i.copyFrom(this._parent.getAbsoluteTransform()),i.multiplyToRef(h,i)):i.copyFrom(this._parent.getAbsoluteTransform())),i.invert(),j.x.TransformCoordinatesToRef(b,i,k),f.setTranslationFromFloats(k.x,k.y,k.z)}this._markAsDirtyAndDecompose()},a.prototype.setAbsolutePosition=function(b,c){this.setPosition(b,j.s.WORLD,c)},a.prototype.scale=function(b,c,d,f){void 0===f&&(f=!1);var h=this.getLocalMatrix(),i=a._tmpMats[0];j.j.ScalingToRef(b,c,d,i),i.multiplyToRef(h,h),i.invert();for(var k=0,m=this.children;k<m.length;k++){var B=(P=m[k]).getLocalMatrix();B.multiplyToRef(i,B),B.multiplyAtIndex(12,b),B.multiplyAtIndex(13,c),B.multiplyAtIndex(14,d),P._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),f)for(var E=0,K=this.children;E<K.length;E++){var P;(P=K[E]).scale(b,c,d,f)}},a.prototype.setScale=function(b){this._decompose(),this._localScaling.copyFrom(b),this._markAsDirtyAndCompose()},a.prototype.getScale=function(){return this._decompose(),this._localScaling},a.prototype.getScaleToRef=function(b){this._decompose(),b.copyFrom(this._localScaling)},a.prototype.setYawPitchRoll=function(b,c,d,f,h){if(void 0===f&&(f=j.s.LOCAL),f===j.s.LOCAL){var i=a._tmpQuat;return j.q.RotationYawPitchRollToRef(b,c,d,i),void this.setRotationQuaternion(i,f,h)}var k=a._tmpMats[0];if(this._getNegativeRotationToRef(k,h)){var m=a._tmpMats[1];j.j.RotationYawPitchRollToRef(b,c,d,m),k.multiplyToRef(m,m),this._rotateWithMatrix(m,f,h)}},a.prototype.rotate=function(b,c,d,f){void 0===d&&(d=j.s.LOCAL);var h=a._tmpMats[0];h.setTranslationFromFloats(0,0,0),j.j.RotationAxisToRef(b,c,h),this._rotateWithMatrix(h,d,f)},a.prototype.setAxisAngle=function(b,c,d,f){if(void 0===d&&(d=j.s.LOCAL),d===j.s.LOCAL){var h=a._tmpQuat;return j.q.RotationAxisToRef(b,c,h),void this.setRotationQuaternion(h,d,f)}var i=a._tmpMats[0];if(this._getNegativeRotationToRef(i,f)){var k=a._tmpMats[1];j.j.RotationAxisToRef(b,c,k),i.multiplyToRef(k,k),this._rotateWithMatrix(k,d,f)}},a.prototype.setRotation=function(b,c,d){void 0===c&&(c=j.s.LOCAL),this.setYawPitchRoll(b.y,b.x,b.z,c,d)},a.prototype.setRotationQuaternion=function(b,c,d){if(void 0===c&&(c=j.s.LOCAL),c===j.s.LOCAL)return this._decompose(),this._localRotation.copyFrom(b),void this._markAsDirtyAndCompose();var f=a._tmpMats[0];if(this._getNegativeRotationToRef(f,d)){var h=a._tmpMats[1];j.j.FromQuaternionToRef(b,h),f.multiplyToRef(h,h),this._rotateWithMatrix(h,c,d)}},a.prototype.setRotationMatrix=function(b,c,d){if(void 0===c&&(c=j.s.LOCAL),c===j.s.LOCAL){var f=a._tmpQuat;return j.q.FromRotationMatrixToRef(b,f),void this.setRotationQuaternion(f,c,d)}var h=a._tmpMats[0];if(this._getNegativeRotationToRef(h,d)){var i=a._tmpMats[1];i.copyFrom(b),h.multiplyToRef(b,i),this._rotateWithMatrix(i,c,d)}},a.prototype._rotateWithMatrix=function(b,c,d){void 0===c&&(c=j.s.LOCAL);var f=this.getLocalMatrix(),h=f.m[12],i=f.m[13],k=f.m[14],m=this.getParent(),B=a._tmpMats[3],E=a._tmpMats[4];m&&c==j.s.WORLD?(d?(B.copyFrom(d.getWorldMatrix()),m.getAbsoluteTransform().multiplyToRef(B,B)):B.copyFrom(m.getAbsoluteTransform()),E.copyFrom(B),E.invert(),f.multiplyToRef(B,f),f.multiplyToRef(b,f),f.multiplyToRef(E,f)):c==j.s.WORLD&&d?(B.copyFrom(d.getWorldMatrix()),E.copyFrom(B),E.invert(),f.multiplyToRef(B,f),f.multiplyToRef(b,f),f.multiplyToRef(E,f)):f.multiplyToRef(b,f),f.setTranslationFromFloats(h,i,k),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},a.prototype._getNegativeRotationToRef=function(b,c){var d=a._tmpMats[2];return b.copyFrom(this.getAbsoluteTransform()),c&&(b.multiplyToRef(c.getWorldMatrix(),b),j.j.ScalingToRef(c.scaling.x,c.scaling.y,c.scaling.z,d)),b.invert(),!isNaN(b.m[0])&&(d.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyToRef(d,b),!0)},a.prototype.getPosition=function(b,c){void 0===b&&(b=j.s.LOCAL),void 0===c&&(c=null);var d=j.x.Zero();return this.getPositionToRef(b,c,d),d},a.prototype.getPositionToRef=function(b,c,d){if(void 0===b&&(b=j.s.LOCAL),b==j.s.LOCAL){var f=this.getLocalMatrix();d.x=f.m[12],d.y=f.m[13],d.z=f.m[14]}else{var h=null;c&&(h=c.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var i=a._tmpMats[0];c&&h?(i.copyFrom(this.getAbsoluteTransform()),i.multiplyToRef(h,i)):i=this.getAbsoluteTransform(),d.x=i.m[12],d.y=i.m[13],d.z=i.m[14]}},a.prototype.getAbsolutePosition=function(b){void 0===b&&(b=null);var c=j.x.Zero();return this.getPositionToRef(j.s.WORLD,b,c),c},a.prototype.getAbsolutePositionToRef=function(b,c){this.getPositionToRef(j.s.WORLD,b,c)},a.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var b=this._skeleton.getPoseMatrix();b&&this._absoluteTransform.multiplyToRef(b,this._absoluteTransform)}for(var c=this.children,d=c.length,f=0;f<d;f++)c[f].computeAbsoluteTransforms()},a.prototype.getDirection=function(b,c){void 0===c&&(c=null);var d=j.x.Zero();return this.getDirectionToRef(b,c,d),d},a.prototype.getDirectionToRef=function(b,c,d){void 0===c&&(c=null);var f=null;c&&(f=c.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=a._tmpMats[0];h.copyFrom(this.getAbsoluteTransform()),c&&f&&h.multiplyToRef(f,h),j.x.TransformNormalToRef(b,h,d),d.normalize()},a.prototype.getRotation=function(b,c){void 0===b&&(b=j.s.LOCAL),void 0===c&&(c=null);var d=j.x.Zero();return this.getRotationToRef(b,c,d),d},a.prototype.getRotationToRef=function(b,c,d){void 0===b&&(b=j.s.LOCAL),void 0===c&&(c=null);var f=a._tmpQuat;this.getRotationQuaternionToRef(b,c,f),f.toEulerAnglesToRef(d)},a.prototype.getRotationQuaternion=function(b,c){void 0===b&&(b=j.s.LOCAL),void 0===c&&(c=null);var d=j.q.Identity();return this.getRotationQuaternionToRef(b,c,d),d},a.prototype.getRotationQuaternionToRef=function(b,c,d){if(void 0===b&&(b=j.s.LOCAL),void 0===c&&(c=null),b==j.s.LOCAL)this._decompose(),d.copyFrom(this._localRotation);else{var f=a._tmpMats[0],h=this.getAbsoluteTransform();c?h.multiplyToRef(c.getWorldMatrix(),f):f.copyFrom(h),f.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyAtIndex(1,this._scalingDeterminant),f.multiplyAtIndex(2,this._scalingDeterminant),f.decompose(void 0,d,void 0)}},a.prototype.getRotationMatrix=function(b,c){void 0===b&&(b=j.s.LOCAL);var d=j.j.Identity();return this.getRotationMatrixToRef(b,c,d),d},a.prototype.getRotationMatrixToRef=function(b,c,d){if(void 0===b&&(b=j.s.LOCAL),b==j.s.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(d);else{var f=a._tmpMats[0],h=this.getAbsoluteTransform();c?h.multiplyToRef(c.getWorldMatrix(),f):f.copyFrom(h),f.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyAtIndex(1,this._scalingDeterminant),f.multiplyAtIndex(2,this._scalingDeterminant),f.getRotationMatrixToRef(d)}},a.prototype.getAbsolutePositionFromLocal=function(b,c){void 0===c&&(c=null);var d=j.x.Zero();return this.getAbsolutePositionFromLocalToRef(b,c,d),d},a.prototype.getAbsolutePositionFromLocalToRef=function(b,c,d){void 0===c&&(c=null);var f=null;c&&(f=c.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=a._tmpMats[0];c&&f?(h.copyFrom(this.getAbsoluteTransform()),h.multiplyToRef(f,h)):h=this.getAbsoluteTransform(),j.x.TransformCoordinatesToRef(b,h,d)},a.prototype.getLocalPositionFromAbsolute=function(b,c){void 0===c&&(c=null);var d=j.x.Zero();return this.getLocalPositionFromAbsoluteToRef(b,c,d),d},a.prototype.getLocalPositionFromAbsoluteToRef=function(b,c,d){void 0===c&&(c=null);var f=null;c&&(f=c.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=a._tmpMats[0];h.copyFrom(this.getAbsoluteTransform()),c&&f&&h.multiplyToRef(f,h),h.invert(),j.x.TransformCoordinatesToRef(b,h,d)},a._tmpVecs=za.a.BuildArray(2,j.x.Zero),a._tmpQuat=j.q.Identity(),a._tmpMats=za.a.BuildArray(5,j.j.Identity),a}(s.a),Ea=function(){function e(a,b,c,d,f,h,i,k,m){void 0===c&&(c=0),void 0===d&&(d=100),void 0===f&&(f=!1),void 0===h&&(h=1),this.target=b,this.fromFrame=c,this.toFrame=d,this.loopAnimation=f,this.onAnimationEnd=i,this.onAnimationLoop=m,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array(),this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new q.c(),this.onAnimationLoopObservable=new q.c(),this._scene=a,k&&this.appendAnimations(b,k),this._speedRatio=h,a._activeAnimatables.push(this)}return Object.defineProperty(e.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"masterFrame",{get:function(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},set:function(a){this._weight=-1!==a?Math.min(Math.max(a,0),1):-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(a){for(var b=0;b<this._runtimeAnimations.length;b++)this._runtimeAnimations[b]._prepareForSpeedRatioChange(a);this._speedRatio=a},enumerable:!0,configurable:!0}),e.prototype.syncWith=function(a){if(this._syncRoot=a,a){var b=this._scene._activeAnimatables.indexOf(this);b>-1&&(this._scene._activeAnimatables.splice(b,1),this._scene._activeAnimatables.push(this))}return this},e.prototype.getAnimations=function(){return this._runtimeAnimations},e.prototype.appendAnimations=function(a,b){for(var c=this,d=0;d<b.length;d++){var f=b[d],h=new qa(a,f,this._scene,this);h._onLoop=function(){c.onAnimationLoopObservable.notifyObservers(c),c.onAnimationLoop&&c.onAnimationLoop()},this._runtimeAnimations.push(h)}},e.prototype.getAnimationByTargetProperty=function(a){for(var b=this._runtimeAnimations,c=0;c<b.length;c++)if(b[c].animation.targetProperty===a)return b[c].animation;return null},e.prototype.getRuntimeAnimationByTargetProperty=function(a){for(var b=this._runtimeAnimations,c=0;c<b.length;c++)if(b[c].animation.targetProperty===a)return b[c];return null},e.prototype.reset=function(){for(var a=this._runtimeAnimations,b=0;b<a.length;b++)a[b].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},e.prototype.enableBlending=function(a){for(var b=this._runtimeAnimations,c=0;c<b.length;c++)b[c].animation.enableBlending=!0,b[c].animation.blendingSpeed=a},e.prototype.disableBlending=function(){for(var a=this._runtimeAnimations,b=0;b<a.length;b++)a[b].animation.enableBlending=!1},e.prototype.goToFrame=function(a){var b=this._runtimeAnimations;if(b[0]){var c=b[0].animation.framePerSecond,d=a-b[0].currentFrame,f=0!==this.speedRatio?1000*d/(c*this.speedRatio):0;null===this._localDelayOffset&&(this._localDelayOffset=0),this._localDelayOffset-=f}for(var h=0;h<b.length;h++)b[h].goToFrame(a)},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.restart=function(){this._paused=!1},e.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},e.prototype.stop=function(a,b){if(a||b){var c=this._scene._activeAnimatables.indexOf(this);if(c>-1){for(var d=(h=this._runtimeAnimations).length-1;d>=0;d--){var f=h[d];a&&f.animation.name!=a||(b&&!b(f.target)||(f.dispose(),h.splice(d,1)))}0==h.length&&(this._scene._activeAnimatables.splice(c,1),this._raiseOnAnimationEnd())}}else if((d=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(d,1);var h=this._runtimeAnimations;for(d=0;d<h.length;d++)h[d].dispose();this._raiseOnAnimationEnd()}},e.prototype.waitAsync=function(){var a=this;return new Promise(function(b,c){a.onAnimationEndObservable.add(function(){b(a)},void 0,void 0,a,!0)})},e.prototype._animate=function(a){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=a),!0;if(null===this._localDelayOffset?(this._localDelayOffset=a,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=a-this._pausedDelay,this._pausedDelay=null),0===this._weight)return!0;var b,c=!1,d=this._runtimeAnimations;for(b=0;b<d.length;b++){var f=d[b].animate(a-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);c=c||f}if(this.animationStarted=c,!c){if(this.disposeOnEnd)for(b=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(b,1),b=0;b<d.length;b++)d[b].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return c},e}();ja.a.prototype._animate=function(){if(this.animationsEnabled){var e=this._activeAnimatables;if(0!==e.length){var a=sa.a.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=a}var b=this.useConstantAnimationDeltaTime?16:(a-this._animationTimeLast)*this.animationTimeScale;this._animationTime+=b;var c=this._animationTime;this._animationTimeLast=a;for(var d=0;d<e.length;d++)e[d]._animate(c);this._processLateAnimationBindings()}}},ja.a.prototype.beginWeightedAnimation=function(e,a,b,c,d,f,h,i,k,m){void 0===c&&(c=1),void 0===f&&(f=1);var B=this.beginAnimation(e,a,b,d,f,h,i,!1,k,m);return B.weight=c,B},ja.a.prototype.beginAnimation=function(e,a,b,c,d,f,h,i,k,m){void 0===d&&(d=1),void 0===i&&(i=!0),a>b&&d>0&&(d*=-1),i&&this.stopAnimation(e,void 0,k),h||(h=new Ea(this,e,a,b,c,d,f,void 0,m));var B=!k||k(e);if(e.animations&&B&&h.appendAnimations(e,e.animations),e.getAnimatables)for(var E=e.getAnimatables(),K=0;K<E.length;K++)this.beginAnimation(E[K],a,b,c,d,f,h,i,k,m);return h.reset(),h},ja.a.prototype.beginHierarchyAnimation=function(e,a,b,c,d,f,h,i,k,m,B){void 0===f&&(f=1),void 0===k&&(k=!0);var E=e.getDescendants(a),K=[];K.push(this.beginAnimation(e,b,c,d,f,h,i,k,m));for(var P=0,S=E;P<S.length;P++){var U=S[P];K.push(this.beginAnimation(U,b,c,d,f,h,i,k,m))}return K},ja.a.prototype.beginDirectAnimation=function(e,a,b,c,d,f,h,i){return void 0===f&&(f=1),new Ea(this,e,b,c,d,f,h,a,i)},ja.a.prototype.beginDirectHierarchyAnimation=function(e,a,b,c,d,f,h,i,k){var m=e.getDescendants(a),B=[];B.push(this.beginDirectAnimation(e,b,c,d,f,h,i,k));for(var E=0,K=m;E<K.length;E++){var P=K[E];B.push(this.beginDirectAnimation(P,b,c,d,f,h,i,k))}return B},ja.a.prototype.getAnimatableByTarget=function(e){for(var a=0;a<this._activeAnimatables.length;a++)if(this._activeAnimatables[a].target===e)return this._activeAnimatables[a];return null},ja.a.prototype.getAllAnimatablesByTarget=function(e){for(var a=[],b=0;b<this._activeAnimatables.length;b++)this._activeAnimatables[b].target===e&&a.push(this._activeAnimatables[b]);return a},ja.a.prototype.stopAnimation=function(e,a,b){for(var c=0,d=this.getAllAnimatablesByTarget(e);c<d.length;c++)d[c].stop(a,b)},ja.a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop();this._activeAnimatables=[]}for(var a=0,b=this.animationGroups;a<b.length;a++)b[a].stop()},ja.a.prototype._registerTargetForLateAnimationBinding=function(e,a){var b=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(b),b._lateAnimationHolders||(b._lateAnimationHolders={}),b._lateAnimationHolders[e.targetPath]||(b._lateAnimationHolders[e.targetPath]={totalWeight:0,animations:[],originalValue:a}),b._lateAnimationHolders[e.targetPath].animations.push(e),b._lateAnimationHolders[e.targetPath].totalWeight+=e.weight},ja.a.prototype._processLateAnimationBindingsForMatrices=function(e){var a=1,b=j.t.Vector3[0],c=j.t.Vector3[1],d=j.t.Quaternion[0],f=0,h=e.animations[0],i=e.originalValue,k=1;if(e.totalWeight<1)i.decompose(c,d,b),k=1-e.totalWeight;else if(f=1,a=e.totalWeight,h.currentValue.decompose(c,d,b),1==(k=h.weight/a))return h.currentValue;c.scaleInPlace(k),b.scaleInPlace(k),d.scaleInPlace(k);for(var m=f;m<e.animations.length;m++){var B=e.animations[m],E=(k=B.weight/a,j.t.Vector3[2]),K=j.t.Vector3[3],P=j.t.Quaternion[1];B.currentValue.decompose(K,P,E),K.scaleAndAddToRef(k,c),P.scaleAndAddToRef(k,d),E.scaleAndAddToRef(k,b)}var S=h._animationState.workValue;return j.j.ComposeToRef(c,d,b,S),S},ja.a.prototype._processLateAnimationBindingsForQuaternions=function(e,a){var b=e.animations[0],c=e.originalValue;if(1===e.animations.length)return j.q.SlerpToRef(c,b.currentValue,Math.min(1,e.totalWeight),a),a;var d,f,h=1;if(e.totalWeight<1){var i=1-e.totalWeight;f=[],(d=[]).push(c),f.push(i)}else{if(2===e.animations.length)return j.q.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,a),a;d=[],f=[],h=e.totalWeight}for(var k=0;k<e.animations.length;k++){var m=e.animations[k];d.push(m.currentValue),f.push(m.weight/h)}for(var B=0,E=null,K=0;K<d.length;)E?(B+=f[K],j.q.SlerpToRef(E,d[K],f[K]/B,E),K++):(j.q.SlerpToRef(d[K],d[K+1],f[K+1]/(f[K]+f[K+1]),a),E=a,B=f[K]+f[K+1],K+=2);return E},ja.a.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var e=0;e<this._registeredForLateAnimationBindings.length;e++){var a=this._registeredForLateAnimationBindings.data[e];for(var b in a._lateAnimationHolders){var c=a._lateAnimationHolders[b],d=c.animations[0],f=c.originalValue,h=C.AllowMatrixDecomposeForInterpolation&&f.m,i=a[b];if(h)i=this._processLateAnimationBindingsForMatrices(c);else if(void 0!==f.w)i=this._processLateAnimationBindingsForQuaternions(c,i||j.q.Identity());else{var k=0,m=1;if(c.totalWeight<1)i=f.scale?f.scale(1-c.totalWeight):f*(1-c.totalWeight);else{m=c.totalWeight;var B=d.weight/m;i=1!==B?d.currentValue.scale?d.currentValue.scale(B):d.currentValue*B:d.currentValue,k=1}for(var E=k;E<c.animations.length;E++){var K=c.animations[E],P=K.weight/m;K.currentValue.scaleAndAddToRef?K.currentValue.scaleAndAddToRef(P,i):i+=K.currentValue*P}}a[b]=i}a._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},Fa.prototype.copyAnimationRange=function(e,a,b,c,d){void 0===c&&(c=!1),void 0===d&&(d=null),0===this.animations.length&&(this.animations.push(new C(this.name,"_matrix",e.animations[0].framePerSecond,C.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var f=e.animations[0].getRange(a);if(!f)return!1;for(var h,i,k,m=f.from,B=f.to,E=e.animations[0].getKeys(),K=e.length,P=e.getParent(),S=this.getParent(),U=c&&P&&K&&this.length&&K!==this.length,_=U&&S&&P?S.length/P.length:1,da=c&&!S&&d&&(1!==d.x||1!==d.y||1!==d.z),fa=this.animations[0].getKeys(),ga=0,ha=E.length;ga<ha;ga++)(h=E[ga]).frame>=m&&h.frame<=B&&(c?(k=h.value.clone(),U?(i=k.getTranslation(),k.setTranslation(i.scaleInPlace(_))):da&&d?(i=k.getTranslation(),k.setTranslation(i.multiplyInPlace(d))):k=h.value):k=h.value,fa.push({frame:h.frame+b,value:k}));return this.animations[0].createRange(a,m+b,B+b),!0};var Ba=function(){return function(){}}(),Sa=function(){function e(a,b){void 0===b&&(b=null),this.name=a,this._targetedAnimations=new Array(),this._animatables=new Array(),this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this.onAnimationEndObservable=new q.c(),this.onAnimationLoopObservable=new q.c(),this.onAnimationGroupEndObservable=new q.c(),this.onAnimationGroupPauseObservable=new q.c(),this.onAnimationGroupPlayObservable=new q.c(),this._scene=b||T.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.animationGroups.push(this)}return Object.defineProperty(e.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this._to},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(a){if(this._speedRatio!==a){this._speedRatio=a;for(var b=0;b<this._animatables.length;b++)this._animatables[b].speedRatio=this._speedRatio}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(a){if(this._loopAnimation!==a){this._loopAnimation=a;for(var b=0;b<this._animatables.length;b++)this._animatables[b].loopAnimation=this._loopAnimation}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animatables",{get:function(){return this._animatables},enumerable:!0,configurable:!0}),e.prototype.addTargetedAnimation=function(a,b){var c={animation:a,target:b},d=a.getKeys();return this._from>d[0].frame&&(this._from=d[0].frame),this._to<d[d.length-1].frame&&(this._to=d[d.length-1].frame),this._targetedAnimations.push(c),c},e.prototype.normalize=function(a,b){void 0===a&&(a=null),void 0===b&&(b=null),null==a&&(a=this._from),null==b&&(b=this._to);for(var c=0;c<this._targetedAnimations.length;c++){var d=this._targetedAnimations[c].animation.getKeys(),f=d[0],h=d[d.length-1];if(f.frame>a){var i={frame:a,value:f.value,inTangent:f.inTangent,outTangent:f.outTangent,interpolation:f.interpolation};d.splice(0,0,i)}h.frame<b&&(i={frame:b,value:h.value,inTangent:h.outTangent,outTangent:h.outTangent,interpolation:h.interpolation},d.push(i))}return this._from=a,this._to=b,this},e.prototype.start=function(a,b,c,d){var f=this;if(void 0===a&&(a=!1),void 0===b&&(b=1),this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=a;for(var h=function(E){var K=i._scene.beginDirectAnimation(E.target,[E.animation],void 0!==c?c:i._from,void 0!==d?d:i._to,a,b);K.onAnimationEnd=function(){f.onAnimationEndObservable.notifyObservers(E),f._checkAnimationGroupEnded(K)},K.onAnimationLoop=function(){f.onAnimationLoopObservable.notifyObservers(E)},i._animatables.push(K)},i=this,k=0,m=this._targetedAnimations;k<m.length;k++)h(m[k]);if(this._speedRatio=b,void 0!==c&&void 0!==d)if(c<d&&this._speedRatio<0){var B=d;d=c,c=B}else c>d&&this._speedRatio>0&&(this._speedRatio=-b);return this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var a=0;a<this._animatables.length;a++)this._animatables[a].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this},e.prototype.play=function(a){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(void 0!==a&&(this.loopAnimation=a),this.restart()):(this.stop(),this.start(a,this._speedRatio)),this._isPaused=!1,this},e.prototype.reset=function(){if(!this._isStarted)return this;for(var a=0;a<this._animatables.length;a++)this._animatables[a].reset();return this},e.prototype.restart=function(){if(!this._isStarted)return this;for(var a=0;a<this._animatables.length;a++)this._animatables[a].restart();return this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.stop=function(){if(!this._isStarted)return this;for(var a=this._animatables.slice(),b=0;b<a.length;b++)a[b].stop();return this._isStarted=!1,this},e.prototype.setWeightForAllAnimatables=function(a){for(var b=0;b<this._animatables.length;b++)this._animatables[b].weight=a;return this},e.prototype.syncAllAnimationsWith=function(a){for(var b=0;b<this._animatables.length;b++)this._animatables[b].syncWith(a);return this},e.prototype.goToFrame=function(a){if(!this._isStarted)return this;for(var b=0;b<this._animatables.length;b++)this._animatables[b].goToFrame(a);return this},e.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var a=this._scene.animationGroups.indexOf(this);a>-1&&this._scene.animationGroups.splice(a,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear()},e.prototype._checkAnimationGroupEnded=function(a){var b=this._animatables.indexOf(a);b>-1&&this._animatables.splice(b,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},e.prototype.clone=function(a,b){for(var c=new e(a||this.name,this._scene),d=0,f=this._targetedAnimations;d<f.length;d++){var h=f[d];c.addTargetedAnimation(h.animation.clone(),b?b(h.target):h.target)}return c},e.Parse=function(a,b){for(var c=new e(a.name,b),d=0;d<a.targetedAnimations.length;d++){var f=a.targetedAnimations[d],h=C.Parse(f.animation),i=f.targetId;if("influence"===f.animation.property){var k=b.getMorphTargetById(i);k&&c.addTargetedAnimation(h,k)}else{var m=b.getNodeByID(i);null!=m&&c.addTargetedAnimation(h,m)}}return null!==a.from&&null!==a.from&&c.normalize(a.from,a.to),c},e.prototype.getClassName=function(){return"AnimationGroup"},e.prototype.toString=function(a){var b="Name: "+this.name;return b+=", type: "+this.getClassName(),a&&(b+=", from: "+this._from,b+=", to: "+this._to,b+=", isStarted: "+this._isStarted,b+=", speedRatio: "+this._speedRatio,b+=", targetedAnimations length: "+this._targetedAnimations.length,b+=", animatables length: "+this._animatables),b},e}(),Xa=function(){return function(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=C.ANIMATIONLOOPMODE_CYCLE}}(),Ka=function(){function e(){this._easingMode=e.EASINGMODE_EASEIN}return e.prototype.setEasingMode=function(a){var b=Math.min(Math.max(a,0),2);this._easingMode=b},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(a){throw new Error("You must implement this method")},e.prototype.ease=function(a){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(a);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-a)}return a>=.5?.5*(1-this.easeInCore(2*(1-a)))+.5:.5*this.easeInCore(2*a)},e.EASINGMODE_EASEIN=0,e.EASINGMODE_EASEOUT=1,e.EASINGMODE_EASEINOUT=2,e}(),Ga=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.easeInCore=function(b){return b=Math.max(0,Math.min(1,b)),1-Math.sqrt(1-b*b)},a}(Ka),nb=function(e){function a(b){void 0===b&&(b=1);var c=e.call(this)||this;return c.amplitude=b,c}return v.d(a,e),a.prototype.easeInCore=function(b){var c=Math.max(0,this.amplitude);return Math.pow(b,3)-b*c*Math.sin(3.141592653589793*b)},a}(Ka),jb=function(e){function a(b,c){void 0===b&&(b=3),void 0===c&&(c=2);var d=e.call(this)||this;return d.bounces=b,d.bounciness=c,d}return v.d(a,e),a.prototype.easeInCore=function(b){var c=Math.max(0,this.bounces),d=this.bounciness;d<=1&&(d=1.001);var f=Math.pow(d,c),h=1-d,i=(1-f)/h+.5*f,k=b*i,m=Math.log(-k*(1-d)+1)/Math.log(d),B=Math.floor(m),E=B+1,K=(1-Math.pow(d,B))/(h*i),P=.5*(K+(1-Math.pow(d,E))/(h*i)),S=b-P,U=P-K;return-Math.pow(1/d,c-B)/(U*U)*(S-U)*(S+U)},a}(Ka),bb=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.easeInCore=function(b){return b*b*b},a}(Ka),fb=function(e){function a(b,c){void 0===b&&(b=3),void 0===c&&(c=3);var d=e.call(this)||this;return d.oscillations=b,d.springiness=c,d}return v.d(a,e),a.prototype.easeInCore=function(b){var c=Math.max(0,this.oscillations),d=Math.max(0,this.springiness);return(0==d?b:(Math.exp(d*b)-1)/(Math.exp(d)-1))*Math.sin((6.283185307179586*c+1.5707963267948966)*b)},a}(Ka),ob=function(e){function a(b){void 0===b&&(b=2);var c=e.call(this)||this;return c.exponent=b,c}return v.d(a,e),a.prototype.easeInCore=function(b){return this.exponent<=0?b:(Math.exp(this.exponent*b)-1)/(Math.exp(this.exponent)-1)},a}(Ka),Cb=function(e){function a(b){void 0===b&&(b=2);var c=e.call(this)||this;return c.power=b,c}return v.d(a,e),a.prototype.easeInCore=function(b){var c=Math.max(0,this.power);return Math.pow(b,c)},a}(Ka),gb=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.easeInCore=function(b){return b*b},a}(Ka),qb=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.easeInCore=function(b){return b*b*b*b},a}(Ka),yb=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.easeInCore=function(b){return b*b*b*b*b},a}(Ka),Lb=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.easeInCore=function(b){return 1-Math.sin(1.5707963267948966*(1-b))},a}(Ka),Mb=function(e){function a(b,c,d,f){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),void 0===f&&(f=1);var h=e.call(this)||this;return h.x1=b,h.y1=c,h.x2=d,h.y2=f,h}return v.d(a,e),a.prototype.easeInCore=function(b){return j.d.Interpolate(b,this.x1,this.y1,this.x2,this.y2)},a}(Ka),gc=function(){function e(a,b,c){this.frame=a,this.action=b,this.onlyOnce=c,this.isDone=!1}return e.prototype._clone=function(){return new e(this.frame,this.action,this.onlyOnce)},e}(),Ca=l(11),cc=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a}(O.a),dc=function(e){function a(b){var c=e.call(this)||this;return c.scene=b,c.sounds=[],c.effectLayers=[],c.layers=[],c.lensFlareSystems=[],c.proceduralTextures=[],c.reflectionProbes=[],c}return v.d(a,e),a.prototype.addAllToScene=function(){var b=this;this.cameras.forEach(function(f){b.scene.addCamera(f)}),this.lights.forEach(function(f){b.scene.addLight(f)}),this.meshes.forEach(function(f){b.scene.addMesh(f)}),this.skeletons.forEach(function(f){b.scene.addSkeleton(f)}),this.animations.forEach(function(f){b.scene.addAnimation(f)}),this.animationGroups.forEach(function(f){b.scene.addAnimationGroup(f)}),this.multiMaterials.forEach(function(f){b.scene.addMultiMaterial(f)}),this.materials.forEach(function(f){b.scene.addMaterial(f)}),this.morphTargetManagers.forEach(function(f){b.scene.addMorphTargetManager(f)}),this.geometries.forEach(function(f){b.scene.addGeometry(f)}),this.transformNodes.forEach(function(f){b.scene.addTransformNode(f)}),this.actionManagers.forEach(function(f){b.scene.addActionManager(f)}),this.textures.forEach(function(f){b.scene.addTexture(f)}),this.reflectionProbes.forEach(function(f){b.scene.addReflectionProbe(f)}),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var c=0,d=this.scene._serializableComponents;c<d.length;c++)d[c].addFromContainer(this)},a.prototype.removeAllFromScene=function(){var b=this;this.cameras.forEach(function(f){b.scene.removeCamera(f)}),this.lights.forEach(function(f){b.scene.removeLight(f)}),this.meshes.forEach(function(f){b.scene.removeMesh(f)}),this.skeletons.forEach(function(f){b.scene.removeSkeleton(f)}),this.animations.forEach(function(f){b.scene.removeAnimation(f)}),this.animationGroups.forEach(function(f){b.scene.removeAnimationGroup(f)}),this.multiMaterials.forEach(function(f){b.scene.removeMultiMaterial(f)}),this.materials.forEach(function(f){b.scene.removeMaterial(f)}),this.morphTargetManagers.forEach(function(f){b.scene.removeMorphTargetManager(f)}),this.geometries.forEach(function(f){b.scene.removeGeometry(f)}),this.transformNodes.forEach(function(f){b.scene.removeTransformNode(f)}),this.actionManagers.forEach(function(f){b.scene.removeActionManager(f)}),this.textures.forEach(function(f){b.scene.removeTexture(f)}),this.reflectionProbes.forEach(function(f){b.scene.removeReflectionProbe(f)}),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var c=0,d=this.scene._serializableComponents;c<d.length;c++)d[c].removeFromContainer(this)},a.prototype.dispose=function(){this.cameras.forEach(function(d){d.dispose()}),this.cameras=[],this.lights.forEach(function(d){d.dispose()}),this.lights=[],this.meshes.forEach(function(d){d.dispose()}),this.meshes=[],this.skeletons.forEach(function(d){d.dispose()}),this.skeletons=[],this.animationGroups.forEach(function(d){d.dispose()}),this.animationGroups=[],this.multiMaterials.forEach(function(d){d.dispose()}),this.multiMaterials=[],this.materials.forEach(function(d){d.dispose()}),this.materials=[],this.geometries.forEach(function(d){d.dispose()}),this.geometries=[],this.transformNodes.forEach(function(d){d.dispose()}),this.transformNodes=[],this.actionManagers.forEach(function(d){d.dispose()}),this.actionManagers=[],this.textures.forEach(function(d){d.dispose()}),this.textures=[],this.reflectionProbes.forEach(function(d){d.dispose()}),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var b=0,c=this.scene._serializableComponents;b<c.length;b++)c[b].removeFromContainer(this,!0)},a.prototype._moveAssets=function(b,c,d){if(b)for(var f=0,h=b;f<h.length;f++){var i=h[f],k=!0;if(d){for(var m=0,B=d;m<B.length;m++)if(i===B[m]){k=!1;break}}k&&c.push(i)}},a.prototype.moveAllFromScene=function(b){for(var c in void 0===b&&(b=new cc()),this)this.hasOwnProperty(c)&&(this[c]=this[c]||[],this._moveAssets(this.scene[c],this[c],b[c]));this.removeAllFromScene()},a.prototype.createRootMesh=function(){var b=new Ca.a("assetContainerRootMesh",this.scene);return this.meshes.forEach(function(c){c.parent||b.addChild(c)}),this.meshes.unshift(b),b},a}(O.a),va=l(10),vd=function(){function e(a){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=a,this._audioEngine=va.b.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return e.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},e.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},e.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},e.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},e.prototype.drawDebugCanvas=function(){var a=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){a.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var b=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var c=0;c<this.getFrequencyBinCount();c++){var d=b[c]/this.BARGRAPHAMPLITUDE,f=this.DEBUGCANVASSIZE.height*d,h=this.DEBUGCANVASSIZE.height-f-1,i=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),k=c/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+k+", 100%, 50%)",this._debugCanvasContext.fillRect(c*i,h,i,f)}}},e.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},e.prototype.connectAudioNodes=function(a,b){this._audioEngine.canUseWebAudio&&(a.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(b))},e.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},e}();va.b.AudioEngineFactory=function(e){return new Xc(e)};var Xc=function(){function e(a){var b=this;void 0===a&&(a=null),this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new q.c(),this.onAudioLockedObservable=new q.c(),this._tryToRun=!1,this._onResize=function(){b._moveButtonToTopLeft()},void 0===window.AudioContext&&void 0===window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var c=document.createElement("audio");this._hostElement=a;try{c&&c.canPlayType&&c.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")&&(this.isMP3supported=!0)}catch(d){}try{c&&c.canPlayType&&c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(d){}}return Object.defineProperty(e.prototype,"audioContext",{get:function(){return this._audioContextInitialized?this.unlocked||this._muteButton||this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),e.prototype.lock=function(){this._triggerSuspendedState()},e.prototype.unlock=function(){this._triggerRunningState()},e.prototype._resumeAudioContext=function(){var a;return this._audioContext.resume&&(a=this._audioContext.resume()),a||Promise.resolve()},e.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext(),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(a){this.canUseWebAudio=!1,r.a.Error("Web Audio: "+a.message)}},e.prototype._triggerRunningState=function(){var a=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(function(){a._tryToRun=!1,a._muteButton&&a._hideMuteButton()}).catch(function(){a._tryToRun=!1,a.unlocked=!1}),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))},e.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},e.prototype._displayMuteButton=function(){var a=this;if(!this.useCustomUnlockedButton&&!this._muteButton){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var b=document.createElement("style");b.appendChild(document.createTextNode(".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E);  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }")),document.getElementsByTagName("head")[0].appendChild(b),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",function(){a._triggerRunningState()},!0),this._muteButton.addEventListener("click",function(){a._triggerRunningState()},!0),window.addEventListener("resize",this._onResize)}},e.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},e.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},e.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},e.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},e.prototype.setGlobalVolume=function(a){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=a)},e.prototype.connectToAnalyser=function(a){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=a,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},e}(),xa=l(9),Zb=l(19),yc=function(){function e(a,b,c,d,f){var h=this;if(void 0===d&&(d=null),this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.onEndedObservable=new q.c(),this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=j.x.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new j.x(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=a,this._scene=c,e._SceneComponentInitialization(c),this._readyToPlayCallback=d,this._customAttenuationFunction=function(K,P,S,U,_){return P<S?K*(1-P/S):0},f&&(this.autoplay=f.autoplay||!1,this.loop=f.loop||!1,void 0!==f.volume&&(this._volume=f.volume),this.spatialSound=f.spatialSound||!1,this.maxDistance=f.maxDistance||100,this.useCustomAttenuation=f.useCustomAttenuation||!1,this.rolloffFactor=f.rolloffFactor||1,this.refDistance=f.refDistance||1,this.distanceModel=f.distanceModel||"linear",this._playbackRate=f.playbackRate||1,this._streaming=f.streaming||!1),va.b.audioEngine.canUseWebAudio&&va.b.audioEngine.audioContext){this._soundGain=va.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this);var i=!0;if(b)try{"string"==typeof b?this._urlType="String":b instanceof ArrayBuffer?this._urlType="ArrayBuffer":b instanceof MediaStream?this._urlType="MediaStream":Array.isArray(b)&&(this._urlType="Array");var k=[],m=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=va.b.audioEngine.audioContext.createMediaStreamSource(b),this.autoplay&&this.play(),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":b.byteLength>0&&(m=!0,this._soundLoaded(b));break;case"String":k.push(b);case"Array":0===k.length&&(k=b);for(var B=0;B<k.length;B++){var E=k[B];if(-1!==E.indexOf(".mp3",E.length-4)&&va.b.audioEngine.isMP3supported&&(m=!0),-1!==E.indexOf(".ogg",E.length-4)&&va.b.audioEngine.isOGGsupported&&(m=!0),-1!==E.indexOf(".wav",E.length-4)&&(m=!0),-1!==E.indexOf("blob:")&&(m=!0),m){this._streaming?(this._htmlAudioElement=new Audio(E),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,xa.h.SetCorsBehavior(E,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){h._isReadyToPlay=!0,h.autoplay&&h.play(),h._readyToPlayCallback&&h._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(E,function(K){h._soundLoaded(K)},void 0,!0,!0,function(K){K&&r.a.Error("XHR "+K.status+" error on: "+E+"."),r.a.Error("Sound creation aborted."),h._scene.mainSoundTrack.RemoveSound(h)});break}}break;default:i=!1}i?m||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){h._readyToPlayCallback&&h._readyToPlayCallback()},1000)):r.a.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(K){r.a.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.RemoveSound(this)}}else this._scene.mainSoundTrack.AddSound(this),va.b.audioEngine.WarnedWebAudioUnsupported||(r.a.Error("Web Audio is not supported by your browser."),va.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){h._readyToPlayCallback&&h._readyToPlayCallback()},1000)}return e.prototype.dispose=function(){va.b.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},e.prototype.isReady=function(){return this._isReadyToPlay},e.prototype._soundLoaded=function(a){var b=this;va.b.audioEngine.audioContext&&va.b.audioEngine.audioContext.decodeAudioData(a,function(c){b._audioBuffer=c,b._isReadyToPlay=!0,b.autoplay&&b.play(),b._readyToPlayCallback&&b._readyToPlayCallback()},function(c){r.a.Error("Error while decoding audio data for: "+b.name+" / Error: "+c)})},e.prototype.setAudioBuffer=function(a){va.b.audioEngine.canUseWebAudio&&(this._audioBuffer=a,this._isReadyToPlay=!0)},e.prototype.updateOptions=function(a){a&&(this.loop=a.loop||this.loop,this.maxDistance=a.maxDistance||this.maxDistance,this.useCustomAttenuation=a.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=a.rolloffFactor||this.rolloffFactor,this.refDistance=a.refDistance||this.refDistance,this.distanceModel=a.distanceModel||this.distanceModel,this._playbackRate=a.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate)))},e.prototype._createSpatialParameters=function(){va.b.audioEngine.canUseWebAudio&&va.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=va.b.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner)},e.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},e.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},e.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},e.prototype._switchPanningModel=function(){va.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},e.prototype.connectToSoundTrackAudioNode=function(a){va.b.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(a),this._isOutputConnected=!0)},e.prototype.setDirectionalCone=function(a,b,c){b<a?r.a.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=a,this._coneOuterAngle=b,this._coneOuterGain=c,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play()))},Object.defineProperty(e.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(a){if(a!=this._coneInnerAngle){if(this._coneOuterAngle<a)return void r.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=a,va.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(a){if(a!=this._coneOuterAngle){if(a<this._coneInnerAngle)return void r.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=a,va.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!0,configurable:!0}),e.prototype.setPosition=function(a){this._position=a,va.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},e.prototype.setLocalDirectionToMesh=function(a){this._localDirection=a,va.b.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},e.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var a=this._connectedTransformNode.getWorldMatrix(),b=j.x.TransformNormal(this._localDirection,a);b.normalize(),this._soundPanner.setOrientation(b.x,b.y,b.z)}},e.prototype.updateDistanceFromListener=function(){if(va.b.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var a=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,a,this.maxDistance,this.refDistance,this.rolloffFactor)}},e.prototype.setAttenuationFunction=function(a){this._customAttenuationFunction=a},e.prototype.play=function(a,b){var c=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&va.b.audioEngine.audioContext)try{this._startOffset<0&&(a=-this._startOffset,this._startOffset=0);var d=a?va.b.audioEngine.audioContext.currentTime+a:va.b.audioEngine.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming)(this._streamingSource||(this._streamingSource=va.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){c._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement)&&(f=function(){if(va.b.audioEngine.unlocked){var h=c._htmlAudioElement.play();void 0!==h&&h.catch(function(i){va.b.audioEngine.lock(),(c.loop||c.autoplay)&&va.b.audioEngine.onAudioUnlockedObservable.addOnce(function(){f()})})}else(c.loop||c.autoplay)&&va.b.audioEngine.onAudioUnlockedObservable.addOnce(function(){f()})})();else{var f=function(){va.b.audioEngine.audioContext&&(c._soundSource=va.b.audioEngine.audioContext.createBufferSource(),c._soundSource.buffer=c._audioBuffer,c._soundSource.connect(c._inputAudioNode),c._soundSource.loop=c.loop,c._soundSource.playbackRate.value=c._playbackRate,c._soundSource.onended=function(){c._onended()},d=a?va.b.audioEngine.audioContext.currentTime+a:va.b.audioEngine.audioContext.currentTime,c._soundSource.start(d,c.isPaused?c._startOffset%c._soundSource.buffer.duration:b||0))};"suspended"===va.b.audioEngine.audioContext.state?setTimeout(function(){"suspended"===va.b.audioEngine.audioContext.state?(va.b.audioEngine.lock(),(c.loop||c.autoplay)&&va.b.audioEngine.onAudioUnlockedObservable.addOnce(function(){f()})):f()},500):f()}this._startTime=d,this.isPlaying=!0,this.isPaused=!1}catch(h){r.a.Error("Error while trying to play audio: "+this.name+", "+h.message)}},e.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},e.prototype.stop=function(a){var b=this;if(this.isPlaying){if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if(va.b.audioEngine.audioContext&&this._soundSource){var c=a?va.b.audioEngine.audioContext.currentTime+a:va.b.audioEngine.audioContext.currentTime;this._soundSource.stop(c),this._soundSource.onended=function(){b.isPlaying=!1},this.isPaused||(this._startOffset=0)}}},e.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():va.b.audioEngine.audioContext&&(this.stop(0),this._startOffset+=va.b.audioEngine.audioContext.currentTime-this._startTime))},e.prototype.setVolume=function(a,b){va.b.audioEngine.canUseWebAudio&&this._soundGain&&(b&&va.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(va.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,va.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(a,va.b.audioEngine.audioContext.currentTime+b)):this._soundGain.gain.value=a),this._volume=a},e.prototype.setPlaybackRate=function(a){this._playbackRate=a,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},e.prototype.getVolume=function(){return this._volume},e.prototype.attachToMesh=function(a){var b=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=a,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(c){return b._onRegisterAfterWorldMatrixUpdate(c)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},e.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},e.prototype._onRegisterAfterWorldMatrixUpdate=function(a){if(a.getBoundingInfo){var b=a;if(this._positionInEmitterSpace)b.worldMatrixFromCache.invertToRef(j.t.Matrix[0]),this.setPosition(j.t.Matrix[0].getTranslation());else{var c=b.getBoundingInfo();this.setPosition(c.boundingSphere.centerWorld)}va.b.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}},e.prototype.clone=function(){var a=this;if(this._streaming)return null;var b=function(){a._isReadyToPlay?(d._audioBuffer=a.getAudioBuffer(),d._isReadyToPlay=!0,d.autoplay&&d.play()):window.setTimeout(b,300)},c={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},d=new e(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,c);return this.useCustomAttenuation&&d.setAttenuationFunction(this._customAttenuationFunction),d.setPosition(this._position),d.setPlaybackRate(this._playbackRate),b(),d},e.prototype.getAudioBuffer=function(){return this._audioBuffer},e.prototype.serialize=function(){var a={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId};return this.spatialSound&&(this._connectedTransformNode&&(a.connectedMeshId=this._connectedTransformNode.id),a.position=this._position.asArray(),a.refDistance=this.refDistance,a.distanceModel=this.distanceModel,a.isDirectional=this._isDirectional,a.localDirectionToMesh=this._localDirection.asArray(),a.coneInnerAngle=this._coneInnerAngle,a.coneOuterAngle=this._coneOuterAngle,a.coneOuterGain=this._coneOuterGain),a},e.Parse=function(a,b,c,d){var f,h=a.name;f=a.url?c+a.url:c+h;var i,k={autoplay:a.autoplay,loop:a.loop,volume:a.volume,spatialSound:a.spatialSound,maxDistance:a.maxDistance,rolloffFactor:a.rolloffFactor,refDistance:a.refDistance,distanceModel:a.distanceModel,playbackRate:a.playbackRate};if(d){var m=function(){d._isReadyToPlay?(i._audioBuffer=d.getAudioBuffer(),i._isReadyToPlay=!0,i.autoplay&&i.play()):window.setTimeout(m,300)};i=new e(h,new ArrayBuffer(0),b,null,k),m()}else i=new e(h,f,b,function(){b._removePendingData(i)},k),b._addPendingData(i);if(a.position){var B=j.x.FromArray(a.position);i.setPosition(B)}if(a.isDirectional&&(i.setDirectionalCone(a.coneInnerAngle||360,a.coneOuterAngle||360,a.coneOuterGain||0),a.localDirectionToMesh)){var E=j.x.FromArray(a.localDirectionToMesh);i.setLocalDirectionToMesh(E)}if(a.connectedMeshId){var K=b.getMeshByID(a.connectedMeshId);K&&i.attachToMesh(K)}return i},e._SceneComponentInitialization=function(a){throw Zb.a.WarnImport("AudioSceneComponent")},e}(),wd=function(){function e(a,b){void 0===b&&(b={}),this.id=-1,this._isMainTrack=!1,this._isInitialized=!1,this._scene=a,this.soundCollection=new Array(),this._options=b,!this._isMainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return e.prototype._initializeSoundTrackAudioGraph=function(){va.b.audioEngine.canUseWebAudio&&va.b.audioEngine.audioContext&&(this._outputAudioNode=va.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(va.b.audioEngine.masterGain),this._options&&(this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},e.prototype.dispose=function(){if(va.b.audioEngine&&va.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},e.prototype.AddSound=function(a){this._isInitialized||this._initializeSoundTrackAudioGraph(),va.b.audioEngine.canUseWebAudio&&this._outputAudioNode&&a.connectToSoundTrackAudioNode(this._outputAudioNode),a.soundTrackId&&(-1===a.soundTrackId?this._scene.mainSoundTrack.RemoveSound(a):this._scene.soundTracks&&this._scene.soundTracks[a.soundTrackId].RemoveSound(a)),this.soundCollection.push(a),a.soundTrackId=this.id},e.prototype.RemoveSound=function(a){var b=this.soundCollection.indexOf(a);-1!==b&&this.soundCollection.splice(b,1)},e.prototype.setVolume=function(a){va.b.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=a)},e.prototype.switchPanningModelToHRTF=function(){if(va.b.audioEngine.canUseWebAudio)for(var a=0;a<this.soundCollection.length;a++)this.soundCollection[a].switchPanningModelToHRTF()},e.prototype.switchPanningModelToEqualPower=function(){if(va.b.audioEngine.canUseWebAudio)for(var a=0;a<this.soundCollection.length;a++)this.soundCollection[a].switchPanningModelToEqualPower()},e.prototype.connectToAnalyser=function(a){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=a,va.b.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,va.b.audioEngine.masterGain))},e}(),Pa=l(14);O.a.AddParser(Pa.a.NAME_AUDIO,function(e,a,b,c){var d,f=[];if(b.sounds=b.sounds||[],void 0!==e.sounds&&null!==e.sounds)for(var h=0,i=e.sounds.length;h<i;h++){var k=e.sounds[h];va.b.audioEngine.canUseWebAudio?(k.url||(k.url=k.name),f[k.url]?b.sounds.push(yc.Parse(k,a,c,f[k.url])):(d=yc.Parse(k,a,c),f[k.url]=d,b.sounds.push(d))):b.sounds.push(new yc(k.name,null,a))}f=[]}),Object.defineProperty(ja.a.prototype,"mainSoundTrack",{get:function(){var e=this._getComponent(Pa.a.NAME_AUDIO);return e||(e=new hc(this),this._addComponent(e)),this._mainSoundTrack||(this._mainSoundTrack=new wd(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ja.a.prototype.getSoundByName=function(e){var a;for(a=0;a<this.mainSoundTrack.soundCollection.length;a++)if(this.mainSoundTrack.soundCollection[a].name===e)return this.mainSoundTrack.soundCollection[a];if(this.soundTracks){for(var b=0;b<this.soundTracks.length;b++)for(a=0;a<this.soundTracks[b].soundCollection.length;a++)if(this.soundTracks[b].soundCollection[a].name===e)return this.soundTracks[b].soundCollection[a]}return null},Object.defineProperty(ja.a.prototype,"audioEnabled",{get:function(){var e=this._getComponent(Pa.a.NAME_AUDIO);return e||(e=new hc(this),this._addComponent(e)),e.audioEnabled},set:function(e){var a=this._getComponent(Pa.a.NAME_AUDIO);a||(a=new hc(this),this._addComponent(a)),e?a.enableAudio():a.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ja.a.prototype,"headphone",{get:function(){var e=this._getComponent(Pa.a.NAME_AUDIO);return e||(e=new hc(this),this._addComponent(e)),e.headphone},set:function(e){var a=this._getComponent(Pa.a.NAME_AUDIO);a||(a=new hc(this),this._addComponent(a)),e?a.switchAudioModeForHeadphones():a.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0});var hc=function(){function e(a){this.name=Pa.a.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.scene=a,a.soundTracks=new Array(),a.sounds=new Array()}return Object.defineProperty(e.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headphone",{get:function(){return this._headphone},enumerable:!0,configurable:!0}),e.prototype.register=function(){this.scene._afterRenderStage.registerStep(Pa.a.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},e.prototype.rebuild=function(){},e.prototype.serialize=function(a){if(a.sounds=[],this.scene.soundTracks)for(var b=0;b<this.scene.soundTracks.length;b++)for(var c=this.scene.soundTracks[b],d=0;d<c.soundCollection.length;d++)a.sounds.push(c.soundCollection[d].serialize())},e.prototype.addFromContainer=function(a){var b=this;a.sounds&&a.sounds.forEach(function(c){c.play(),c.autoplay=!0,b.scene.mainSoundTrack.AddSound(c)})},e.prototype.removeFromContainer=function(a,b){var c=this;void 0===b&&(b=!1),a.sounds&&a.sounds.forEach(function(d){d.stop(),d.autoplay=!1,c.scene.mainSoundTrack.RemoveSound(d),b&&d.dispose()})},e.prototype.dispose=function(){var a=this.scene;if(a._mainSoundTrack&&a.mainSoundTrack.dispose(),a.soundTracks)for(var b=0;b<a.soundTracks.length;b++)a.soundTracks[b].dispose()},e.prototype.disableAudio=function(){var a,b=this.scene;for(this._audioEnabled=!1,a=0;a<b.mainSoundTrack.soundCollection.length;a++)b.mainSoundTrack.soundCollection[a].pause();if(b.soundTracks)for(a=0;a<b.soundTracks.length;a++)for(var c=0;c<b.soundTracks[a].soundCollection.length;c++)b.soundTracks[a].soundCollection[c].pause()},e.prototype.enableAudio=function(){var a,b=this.scene;for(this._audioEnabled=!0,a=0;a<b.mainSoundTrack.soundCollection.length;a++)b.mainSoundTrack.soundCollection[a].isPaused&&b.mainSoundTrack.soundCollection[a].play();if(b.soundTracks)for(a=0;a<b.soundTracks.length;a++)for(var c=0;c<b.soundTracks[a].soundCollection.length;c++)b.soundTracks[a].soundCollection[c].isPaused&&b.soundTracks[a].soundCollection[c].play()},e.prototype.switchAudioModeForHeadphones=function(){var a=this.scene;if(this._headphone=!0,a.mainSoundTrack.switchPanningModelToHRTF(),a.soundTracks)for(var b=0;b<a.soundTracks.length;b++)a.soundTracks[b].switchPanningModelToHRTF()},e.prototype.switchAudioModeForNormalSpeakers=function(){var a=this.scene;if(this._headphone=!1,a.mainSoundTrack.switchPanningModelToEqualPower(),a.soundTracks)for(var b=0;b<a.soundTracks.length;b++)a.soundTracks[b].switchPanningModelToEqualPower()},e.prototype._afterRender=function(){var a=this.scene;if(this._audioEnabled&&a._mainSoundTrack&&a.soundTracks&&(0!==a._mainSoundTrack.soundCollection.length||1!==a.soundTracks.length)){var b,c=va.b.audioEngine;if((b=a.activeCameras.length>0?a.activeCameras[0]:a.activeCamera)&&c.audioContext){c.audioContext.listener.setPosition(b.position.x,b.position.y,b.position.z),b.rigCameras&&b.rigCameras.length>0&&(b=b.rigCameras[0]);var d,f=j.j.Invert(b.getViewMatrix()),h=j.x.TransformNormal(new j.x(0,0,-1),f);for(h.normalize(),isNaN(h.x)||isNaN(h.y)||isNaN(h.z)||c.audioContext.listener.setOrientation(h.x,h.y,h.z,0,1,0),d=0;d<a.mainSoundTrack.soundCollection.length;d++){var i=a.mainSoundTrack.soundCollection[d];i.useCustomAttenuation&&i.updateDistanceFromListener()}if(a.soundTracks)for(d=0;d<a.soundTracks.length;d++)for(var k=0;k<a.soundTracks[d].soundCollection.length;k++)(i=a.soundTracks[d].soundCollection[k]).useCustomAttenuation&&i.updateDistanceFromListener()}}},e}();yc._SceneComponentInitialization=function(e){var a=e._getComponent(Pa.a.NAME_AUDIO);a||(a=new hc(e),e._addComponent(a))};var ie=function(){function e(a,b,c){var d=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],b.length!==c.length)throw new Error("Sounds length does not equal weights length");this.loop=a,this._weights=c;for(var f=0,h=0,i=c;h<i.length;h++)f+=i[h];for(var k=f>0?1/f:0,m=0;m<this._weights.length;m++)this._weights[m]*=k;this._sounds=b;for(var B=0,E=this._sounds;B<E.length;B++)E[B].onEndedObservable.add(function(){d._onended()})}return Object.defineProperty(e.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(a){if(a!==this._coneInnerAngle){if(this._coneOuterAngle<a)return void r.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=a;for(var b=0,c=this._sounds;b<c.length;b++)c[b].directionalConeInnerAngle=a}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(a){if(a!==this._coneOuterAngle){if(a<this._coneInnerAngle)return void r.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=a;for(var b=0,c=this._sounds;b<c.length;b++)c[b].directionalConeOuterAngle=a}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(a){if(a!==this._volume)for(var b=0,c=this._sounds;b<c.length;b++)c[b].setVolume(a)},enumerable:!0,configurable:!0}),e.prototype._onended=function(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},e.prototype.pause=function(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()},e.prototype.stop=function(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()},e.prototype.play=function(a){if(!this.isPaused){this.stop();for(var b=Math.random(),c=0,d=0;d<this._weights.length;d++)if(b<=(c+=this._weights[d])){this._currentIndex=d;break}}var f=this._sounds[this._currentIndex];f.isReady()?f.play(0,this.isPaused?void 0:a):f.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},e}(),hb=l(17),xd=function(){function e(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2000,this._idleRotationSpinupTime=2000,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(e.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(a){this._zoomStopsAnimation=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(a){this._idleRotationSpeed=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(a){this._idleRotationWaitTime=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(a){this._idleRotationSpinupTime=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(a){var b=this;this._attachedCamera=a;var c=this._attachedCamera.getScene();this._onPrePointerObservableObserver=c.onPrePointerObservable.add(function(d){d.type!==hb.a.POINTERDOWN?d.type===hb.a.POINTERUP&&(b._isPointerDown=!1):b._isPointerDown=!0}),this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add(function(){var d=sa.a.Now,f=0;null!=b._lastFrameTime&&(f=d-b._lastFrameTime),b._lastFrameTime=d,b._applyUserInteraction();var h=d-b._lastInteractionTime-b._idleRotationWaitTime,i=Math.max(Math.min(h/b._idleRotationSpinupTime,1),0);b._cameraRotationSpeed=b._idleRotationSpeed*i,b._attachedCamera&&(b._attachedCamera.alpha-=b._cameraRotationSpeed*(f/1000))})},e.prototype.detach=function(){if(this._attachedCamera){var a=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&a.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},e.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},e.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var a=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(a=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?a:this._userIsZooming()},e.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=sa.a.Now)},e.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},e}(),yd=function(){function e(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array()}return Object.defineProperty(e.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(a){var b=this;if(this._autoTransitionRange!==a){this._autoTransitionRange=a;var c=this._attachedCamera;c&&(a?this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add(function(d){if(d){d.computeWorldMatrix(!0);var f=d.getBoundingInfo().diagonalLength;b.lowerRadiusTransitionRange=.05*f,b.upperRadiusTransitionRange=.05*f}}):this._onMeshTargetChangedObserver&&c.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(a){var b=this;this._attachedCamera=a,this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add(function(){b._attachedCamera&&(b._isRadiusAtLimit(b._attachedCamera.lowerRadiusLimit)&&b._applyBoundRadiusAnimation(b.lowerRadiusTransitionRange),b._isRadiusAtLimit(b._attachedCamera.upperRadiusLimit)&&b._applyBoundRadiusAnimation(b.upperRadiusTransitionRange))})},e.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},e.prototype._isRadiusAtLimit=function(a){return!!this._attachedCamera&&(this._attachedCamera.radius===a&&!this._radiusIsAnimating)},e.prototype._applyBoundRadiusAnimation=function(a){var b=this;if(this._attachedCamera){this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=C.CreateAnimation("radius",C.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var c=C.TransitionTo("radius",this._attachedCamera.radius+a,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return b._clearAnimationLocks()});c&&this._animatables.push(c)}},e.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},e.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},e.EasingFunction=new nb(.3),e.EasingMode=Ka.EASINGMODE_EASEOUT,e}(),zd=function(){function e(){this._mode=e.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1000,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array(),this._betaIsAnimating=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(a){this._mode=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(a){this._radiusScale=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positionScale",{get:function(){return this._positionScale},set:function(a){this._positionScale=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(a){this._defaultElevation=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(a){this._elevationReturnTime=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(a){this._elevationReturnWaitTime=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(a){this._zoomStopsAnimation=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framingTime",{get:function(){return this._framingTime},set:function(a){this._framingTime=a},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(a){var b=this;this._attachedCamera=a;var c=this._attachedCamera.getScene();e.EasingFunction.setEasingMode(e.EasingMode),this._onPrePointerObservableObserver=c.onPrePointerObservable.add(function(d){d.type!==hb.a.POINTERDOWN?d.type===hb.a.POINTERUP&&(b._isPointerDown=!1):b._isPointerDown=!0}),this._onMeshTargetChangedObserver=a.onMeshTargetChangedObservable.add(function(d){d&&b.zoomOnMesh(d)}),this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add(function(){b._applyUserInteraction(),b._maintainCameraAboveGround()})},e.prototype.detach=function(){if(this._attachedCamera){var a=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&a.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},e.prototype.zoomOnMesh=function(a,b,c){void 0===b&&(b=!1),void 0===c&&(c=null),a.computeWorldMatrix(!0);var d=a.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(d.minimumWorld,d.maximumWorld,b,c)},e.prototype.zoomOnMeshHierarchy=function(a,b,c){void 0===b&&(b=!1),void 0===c&&(c=null),a.computeWorldMatrix(!0);var d=a.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(d.min,d.max,b,c)},e.prototype.zoomOnMeshesHierarchy=function(a,b,c){void 0===b&&(b=!1),void 0===c&&(c=null);for(var d=new j.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),f=new j.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),h=0;h<a.length;h++){var i=a[h].getHierarchyBoundingVectors(!0);xa.h.CheckExtends(i.min,d,f),xa.h.CheckExtends(i.max,d,f)}this.zoomOnBoundingInfo(d,f,b,c)},e.prototype.zoomOnBoundingInfo=function(a,b,c,d){var f,h=this;if(void 0===c&&(c=!1),void 0===d&&(d=null),this._attachedCamera){var i=a.y,k=i+(b.y-i)*this._positionScale,m=b.subtract(a).scale(.5);if(c)f=new j.x(0,k,0);else{var B=a.add(m);f=new j.x(B.x,k,B.z)}this._vectorTransition||(this._vectorTransition=C.CreateAnimation("target",C.ANIMATIONTYPE_VECTOR3,60,e.EasingFunction)),this._betaIsAnimating=!0;var E=C.TransitionTo("target",f,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);E&&this._animatables.push(E);var K=0;if(this._mode===e.FitFrustumSidesMode){var P=this._calculateLowerRadiusFromModelBoundingSphere(a,b);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=m.length()+this._attachedCamera.minZ),K=P}else this._mode===e.IgnoreBoundsSizeMode&&(K=this._calculateLowerRadiusFromModelBoundingSphere(a,b),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var S=b.subtract(a).length();this._attachedCamera.panningSensibility=5000/S,this._attachedCamera.wheelPrecision=100/K}this._radiusTransition||(this._radiusTransition=C.CreateAnimation("radius",C.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),(E=C.TransitionTo("radius",K,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){h.stopAllAnimations(),d&&d(),h._attachedCamera&&h._attachedCamera.useInputToRestoreState&&h._attachedCamera.storeState()}))&&this._animatables.push(E)}},e.prototype._calculateLowerRadiusFromModelBoundingSphere=function(a,b){var c=b.subtract(a).length(),d=this._getFrustumSlope(),f=.5*c*this._radiusScale,h=f*Math.sqrt(1+1/(d.x*d.x)),i=f*Math.sqrt(1+1/(d.y*d.y)),k=Math.max(h,i),m=this._attachedCamera;return m?(m.lowerRadiusLimit&&this._mode===e.IgnoreBoundsSizeMode&&(k=k<m.lowerRadiusLimit?m.lowerRadiusLimit:k),m.upperRadiusLimit&&(k=k>m.upperRadiusLimit?m.upperRadiusLimit:k),k):0},e.prototype._maintainCameraAboveGround=function(){var a=this;if(!(this._elevationReturnTime<0)){var b=sa.a.Now-this._lastInteractionTime,c=.5*Math.PI-this._defaultElevation,d=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>d&&b>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=C.CreateAnimation("beta",C.ANIMATIONTYPE_FLOAT,60,e.EasingFunction));var f=C.TransitionTo("beta",c,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){a._clearAnimationLocks(),a.stopAllAnimations()});f&&this._animatables.push(f)}}},e.prototype._getFrustumSlope=function(){var a=this._attachedCamera;if(!a)return j.w.Zero();var b=a.getScene().getEngine().getAspectRatio(a),c=Math.tan(a.fov/2),d=c*b;return new j.w(d,c)},e.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},e.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=sa.a.Now,this.stopAllAnimations(),this._clearAnimationLocks())},e.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(e.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),e.EasingFunction=new ob(),e.EasingMode=Ka.EASINGMODE_EASEINOUT,e.IgnoreBoundsSizeMode=0,e.FitFrustumSidesMode=1,e}(),oc=function(){return function(e,a,b,c){void 0===a&&(a=new j.x()),void 0===b&&(b=0),void 0===c&&(c=!1),this.direction=e,this.rotatedDirection=a,this.diff=b,this.ignore=c}}(),je=function(){function e(a){this.ui=a,this.name="AttachToBoxBehavior",this.distanceAwayFromFace=.15,this.distanceAwayFromBottomOfFace=.15,this._faceVectors=[new oc(j.x.Up()),new oc(j.x.Down()),new oc(j.x.Left()),new oc(j.x.Right()),new oc(j.x.Forward()),new oc(j.x.Forward().scaleInPlace(-1))],this._tmpMatrix=new j.j(),this._tmpVector=new j.x(),this._zeroVector=j.x.Zero(),this._lookAtTmpMatrix=new j.j()}return e.prototype.init=function(){},e.prototype._closestFace=function(a){var b=this;return this._faceVectors.forEach(function(c){b._target.rotationQuaternion||(b._target.rotationQuaternion=j.q.RotationYawPitchRoll(b._target.rotation.y,b._target.rotation.x,b._target.rotation.z)),b._target.rotationQuaternion.toRotationMatrix(b._tmpMatrix),j.x.TransformCoordinatesToRef(c.direction,b._tmpMatrix,c.rotatedDirection),c.diff=j.x.GetAngleBetweenVectors(c.rotatedDirection,a,j.x.Cross(c.rotatedDirection,a))}),this._faceVectors.reduce(function(c,d){return c.ignore?d:d.ignore?c:c.diff<d.diff?c:d},this._faceVectors[0])},e.prototype._lookAtToRef=function(a,b,c){void 0===b&&(b=new j.x(0,1,0)),j.j.LookAtLHToRef(this._zeroVector,a,b,this._lookAtTmpMatrix),this._lookAtTmpMatrix.invert(),j.q.FromRotationMatrixToRef(this._lookAtTmpMatrix,c)},e.prototype.attach=function(a){var b=this;this._target=a,this._scene=this._target.getScene(),this._onRenderObserver=this._scene.onBeforeRenderObservable.add(function(){if(b._scene.activeCamera){var c=b._scene.activeCamera.position;b._scene.activeCamera.devicePosition&&(c=b._scene.activeCamera.devicePosition);var d=b._closestFace(c.subtract(a.position));b._scene.activeCamera.leftCamera?b._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(b._tmpMatrix):b._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(b._tmpMatrix),j.x.TransformCoordinatesToRef(j.x.Up(),b._tmpMatrix,b._tmpVector),b._faceVectors.forEach(function(h){d.direction.x&&h.direction.x&&(h.ignore=!0),d.direction.y&&h.direction.y&&(h.ignore=!0),d.direction.z&&h.direction.z&&(h.ignore=!0)});var f=b._closestFace(b._tmpVector);b._faceVectors.forEach(function(h){h.ignore=!1}),b.ui.position.copyFrom(a.position),d.direction.x&&(d.rotatedDirection.scaleToRef(a.scaling.x/2+b.distanceAwayFromFace,b._tmpVector),b.ui.position.addInPlace(b._tmpVector)),d.direction.y&&(d.rotatedDirection.scaleToRef(a.scaling.y/2+b.distanceAwayFromFace,b._tmpVector),b.ui.position.addInPlace(b._tmpVector)),d.direction.z&&(d.rotatedDirection.scaleToRef(a.scaling.z/2+b.distanceAwayFromFace,b._tmpVector),b.ui.position.addInPlace(b._tmpVector)),b.ui.rotationQuaternion||(b.ui.rotationQuaternion=j.q.RotationYawPitchRoll(b.ui.rotation.y,b.ui.rotation.x,b.ui.rotation.z)),d.rotatedDirection.scaleToRef(-1,b._tmpVector),b._lookAtToRef(b._tmpVector,f.rotatedDirection,b.ui.rotationQuaternion),f.direction.x&&b.ui.up.scaleToRef(b.distanceAwayFromBottomOfFace-a.scaling.x/2,b._tmpVector),f.direction.y&&b.ui.up.scaleToRef(b.distanceAwayFromBottomOfFace-a.scaling.y/2,b._tmpVector),f.direction.z&&b.ui.up.scaleToRef(b.distanceAwayFromBottomOfFace-a.scaling.z/2,b._tmpVector),b.ui.position.addInPlace(b._tmpVector)}})},e.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)},e}(),ke=function(){function e(){var a=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=1000/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(a._ownerNode){if(a._hoverValue+=a._hovered?a._millisecondsPerFrame:-a._millisecondsPerFrame,a._setAllVisibility(a._ownerNode,(a._hoverValue-a.delay)/a.fadeInTime),a._ownerNode.visibility>1)return a._setAllVisibility(a._ownerNode,1),void(a._hoverValue=a.fadeInTime+a.delay);if(a._ownerNode.visibility<0&&(a._setAllVisibility(a._ownerNode,0),a._hoverValue<0))return void(a._hoverValue=0);setTimeout(a._update,a._millisecondsPerFrame)}}}return Object.defineProperty(e.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(a){this._ownerNode=a,this._setAllVisibility(this._ownerNode,0)},e.prototype.detach=function(){this._ownerNode=null},e.prototype.fadeIn=function(a){this._hovered=a,this._update()},e.prototype._setAllVisibility=function(a,b){var c=this;a.visibility=b,a.getChildMeshes().forEach(function(d){c._setAllVisibility(d,b)})},e}(),pc=l(54),Ei=function(){function e(){this._startDistance=0,this._initialScale=new j.x(0,0,0),this._targetScale=new j.x(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new pc.a({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new pc.a({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},e.prototype.attach=function(a){var b=this;this._ownerNode=a,this._dragBehaviorA.onDragStartObservable.add(function(c){b._dragBehaviorA.dragging&&b._dragBehaviorB.dragging&&(b._dragBehaviorA.currentDraggingPointerID==b._dragBehaviorB.currentDraggingPointerID?b._dragBehaviorA.releaseDrag():(b._initialScale.copyFrom(a.scaling),b._startDistance=b._getCurrentDistance()))}),this._dragBehaviorB.onDragStartObservable.add(function(c){b._dragBehaviorA.dragging&&b._dragBehaviorB.dragging&&(b._dragBehaviorA.currentDraggingPointerID==b._dragBehaviorB.currentDraggingPointerID?b._dragBehaviorB.releaseDrag():(b._initialScale.copyFrom(a.scaling),b._startDistance=b._getCurrentDistance()))}),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(c){c.onDragObservable.add(function(){if(b._dragBehaviorA.dragging&&b._dragBehaviorB.dragging){var d=b._getCurrentDistance()/b._startDistance;b._initialScale.scaleToRef(d,b._targetScale)}})}),a.addBehavior(this._dragBehaviorA),a.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=a.getScene().onBeforeRenderObservable.add(function(){if(b._dragBehaviorA.dragging&&b._dragBehaviorB.dragging){var c=b._targetScale.subtract(a.scaling).scaleInPlace(.1);c.length()>.01&&a.scaling.addInPlace(c)}})},e.prototype.detach=function(){var a=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(b){b.onDragStartObservable.clear(),b.onDragObservable.clear(),a._ownerNode.removeBehavior(b)})},e}(),kb=l(24),ab=l(21),Tb=l(45),cg=function(){function e(){this._sceneRenderObserver=null,this._targetPosition=new j.x(0,0,0),this._moving=!1,this._startingOrientation=new j.q(),this.zDragFactor=3,this.rotateDraggedObject=!0,this.dragging=!1,this.dragDeltaRatio=.2,this.currentDraggingPointerID=-1,this.detachCameraControls=!0,this.onDragStartObservable=new q.c(),this.onDragEndObservable=new q.c()}return Object.defineProperty(e.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(a){var b=this;this._ownerNode=a,this._scene=this._ownerNode.getScene(),e._virtualScene||(e._virtualScene=new ja.a(this._scene.getEngine()),e._virtualScene.detachControl(),this._scene.getEngine().scenes.pop());var c=null,d=new j.x(0,0,0);this._virtualOriginMesh=new kb.a("",e._virtualScene),this._virtualOriginMesh.rotationQuaternion=new j.q(),this._virtualDragMesh=new kb.a("",e._virtualScene),this._virtualDragMesh.rotationQuaternion=new j.q();var f=null;this._pointerObserver=this._scene.onPointerObservable.add(function(i,k){if(i.type==hb.a.POINTERDOWN){if(!b.dragging&&i.pickInfo&&i.pickInfo.hit&&i.pickInfo.pickedMesh&&i.pickInfo.ray&&(P=i.pickInfo.pickedMesh,b._ownerNode==P||P.isDescendantOf(b._ownerNode))){b._scene.activeCamera&&b._scene.activeCamera.cameraRigMode==ab.a.RIG_MODE_NONE&&i.pickInfo.ray.origin.copyFrom(b._scene.activeCamera.globalPosition),c=b._ownerNode,Tb.a._RemoveAndStorePivotPoint(c),d.copyFrom(i.pickInfo.ray.origin),b._virtualOriginMesh.position.copyFrom(i.pickInfo.ray.origin),b._virtualOriginMesh.lookAt(i.pickInfo.ray.origin.add(i.pickInfo.ray.direction)),b._virtualOriginMesh.removeChild(b._virtualDragMesh),c.computeWorldMatrix(),b._virtualDragMesh.position.copyFrom(c.absolutePosition),c.rotationQuaternion||(c.rotationQuaternion=j.q.RotationYawPitchRoll(c.rotation.y,c.rotation.x,c.rotation.z));var m=c.parent;c.setParent(null),b._virtualDragMesh.rotationQuaternion.copyFrom(c.rotationQuaternion),c.setParent(m),b._virtualOriginMesh.addChild(b._virtualDragMesh),b._targetPosition.copyFrom(b._virtualDragMesh.absolutePosition),b.dragging=!0,b.currentDraggingPointerID=i.event.pointerId,b.detachCameraControls&&b._scene.activeCamera&&!b._scene.activeCamera.leftCamera&&(b._scene.activeCamera.inputs.attachedElement?(f=b._scene.activeCamera.inputs.attachedElement,b._scene.activeCamera.detachControl(b._scene.activeCamera.inputs.attachedElement)):f=null),Tb.a._RestorePivotPoint(c),b.onDragStartObservable.notifyObservers({})}}else if(i.type==hb.a.POINTERUP)b.currentDraggingPointerID==i.event.pointerId&&(b.dragging=!1,b._moving=!1,b.currentDraggingPointerID=-1,c=null,b._virtualOriginMesh.removeChild(b._virtualDragMesh),b.detachCameraControls&&f&&b._scene.activeCamera&&!b._scene.activeCamera.leftCamera&&b._scene.activeCamera.attachControl(f,!0),b.onDragEndObservable.notifyObservers({}));else if(i.type==hb.a.POINTERMOVE&&b.currentDraggingPointerID==i.event.pointerId&&b.dragging&&i.pickInfo&&i.pickInfo.ray&&c){var B=b.zDragFactor;b._scene.activeCamera&&b._scene.activeCamera.cameraRigMode==ab.a.RIG_MODE_NONE&&(i.pickInfo.ray.origin.copyFrom(b._scene.activeCamera.globalPosition),B=0);var E=i.pickInfo.ray.origin.subtract(d);d.copyFrom(i.pickInfo.ray.origin);var K=-j.x.Dot(E,i.pickInfo.ray.direction);b._virtualOriginMesh.addChild(b._virtualDragMesh),b._virtualDragMesh.position.z-=b._virtualDragMesh.position.z<1?K*b.zDragFactor:K*B*b._virtualDragMesh.position.z,b._virtualDragMesh.position.z<0&&(b._virtualDragMesh.position.z=0),b._virtualOriginMesh.position.copyFrom(i.pickInfo.ray.origin),b._virtualOriginMesh.lookAt(i.pickInfo.ray.origin.add(i.pickInfo.ray.direction)),b._virtualOriginMesh.removeChild(b._virtualDragMesh),b._targetPosition.copyFrom(b._virtualDragMesh.absolutePosition),c.parent&&j.x.TransformCoordinatesToRef(b._targetPosition,j.j.Invert(c.parent.getWorldMatrix()),b._targetPosition),b._moving||b._startingOrientation.copyFrom(b._virtualDragMesh.rotationQuaternion),b._moving=!0}var P});var h=new j.q();this._sceneRenderObserver=a.getScene().onBeforeRenderObservable.add(function(){if(b.dragging&&b._moving&&c){if(Tb.a._RemoveAndStorePivotPoint(c),c.position.addInPlace(b._targetPosition.subtract(c.position).scale(b.dragDeltaRatio)),b.rotateDraggedObject){h.copyFrom(b._startingOrientation),h.x=-h.x,h.y=-h.y,h.z=-h.z,b._virtualDragMesh.rotationQuaternion.multiplyToRef(h,h),j.q.RotationYawPitchRollToRef(h.toEulerAngles("xyz").y,0,0,h),h.multiplyToRef(b._startingOrientation,h);var i=c.parent;(!i||i.scaling&&!i.scaling.isNonUniformWithinEpsilon(.001))&&(c.setParent(null),j.q.SlerpToRef(c.rotationQuaternion,h,b.dragDeltaRatio,c.rotationQuaternion),c.setParent(i))}Tb.a._RestorePivotPoint(c)}})},e.prototype.detach=function(){this._scene&&this._scene.onPointerObservable.remove(this._pointerObserver),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualOriginMesh&&this._virtualOriginMesh.dispose(),this._virtualDragMesh&&this._virtualDragMesh.dispose(),this.onDragEndObservable.clear(),this.onDragStartObservable.clear()},e}(),Fi=function(){function e(a,b,c){if(this.targetPosition=j.x.Zero(),this.poleTargetPosition=j.x.Zero(),this.poleTargetLocalOffset=j.x.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=j.q.Identity(),this._bone1Mat=j.j.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=j.x.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=b,this._bone1=b.getParent(),this._bone1){this.mesh=a;var d=b.getPosition();if(b.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,d.x>d.y&&d.x>d.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var f=this._bone1.getScale(),h=this._bone2.getScale();this._bone1Length=this._bone1.length*f.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*h.y*this.mesh.scaling.y}else if(this._bone1.children[0]){a.computeWorldMatrix(!0);var i=this._bone2.children[0].getAbsolutePosition(a),k=this._bone2.getAbsolutePosition(a),m=this._bone1.getAbsolutePosition(a);this._bone1Length=j.x.Distance(i,k),this._bone2Length=j.x.Distance(k,m)}this._bone1.getRotationMatrixToRef(j.s.WORLD,a,this._bone1Mat),this.maxAngle=Math.PI,c&&(c.targetMesh&&(this.targetMesh=c.targetMesh,this.targetMesh.computeWorldMatrix(!0)),c.poleTargetMesh?(this.poleTargetMesh=c.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):c.poleTargetBone?this.poleTargetBone=c.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),c.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(c.poleTargetLocalOffset),c.poleAngle&&(this.poleAngle=c.poleAngle),c.bendAxis&&this._bendAxis.copyFrom(c.bendAxis),c.maxAngle&&(this.maxAngle=c.maxAngle),c.slerpAmount&&(this.slerpAmount=c.slerpAmount))}}return Object.defineProperty(e.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(a){this._setMaxAngle(a)},enumerable:!0,configurable:!0}),e.prototype._setMaxAngle=function(a){a<0&&(a=0),(a>Math.PI||null==a)&&(a=Math.PI),this._maxAngle=a;var b=this._bone1Length,c=this._bone2Length;this._maxReach=Math.sqrt(b*b+c*c-2*b*c*Math.cos(a))},e.prototype.update=function(){var a=this._bone1;if(a){var b=this.targetPosition,c=this.poleTargetPosition,d=e._tmpMats[0],f=e._tmpMats[1];this.targetMesh&&b.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,c):this.poleTargetMesh&&j.x.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),c);var h=e._tmpVecs[0],i=e._tmpVecs[1],k=e._tmpVecs[2],m=e._tmpVecs[3],B=e._tmpVecs[4],E=e._tmpQuat;a.getAbsolutePositionToRef(this.mesh,h),c.subtractToRef(h,B),0==B.x&&0==B.y&&0==B.z?B.y=1:B.normalize(),b.subtractToRef(h,m),m.normalize(),j.x.CrossToRef(m,B,i),i.normalize(),j.x.CrossToRef(m,i,k),k.normalize(),j.j.FromXYZAxesToRef(k,m,i,d);var K=this._bone1Length,P=this._bone2Length,S=j.x.Distance(h,b);this._maxReach>0&&(S=Math.min(this._maxReach,S));var U=(P*P+S*S-K*K)/(2*P*S),_=(S*S+K*K-P*P)/(2*S*K);U>1&&(U=1),_>1&&(_=1),U<-1&&(U=-1),_<-1&&(_=-1);var da=Math.acos(U),fa=Math.acos(_),ga=-da-fa;if(this._rightHandedSystem)j.j.RotationYawPitchRollToRef(0,0,this._adjustRoll,f),f.multiplyToRef(d,d),j.j.RotationAxisToRef(this._bendAxis,fa,f),f.multiplyToRef(d,d);else{var ha=e._tmpVecs[5];ha.copyFrom(this._bendAxis),ha.x*=-1,j.j.RotationAxisToRef(ha,-fa,f),f.multiplyToRef(d,d)}this.poleAngle&&(j.j.RotationAxisToRef(m,this.poleAngle,f),d.multiplyToRef(f,d)),this._bone1&&(this.slerpAmount<1?(this._slerping||j.q.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),j.q.FromRotationMatrixToRef(d,E),j.q.SlerpToRef(this._bone1Quat,E,this.slerpAmount,this._bone1Quat),ga=this._bone2Ang*(1-this.slerpAmount)+ga*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,j.s.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(d,j.s.WORLD,this.mesh),this._bone1Mat.copyFrom(d),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,ga,j.s.LOCAL),this._bone2Ang=ga}},e._tmpVecs=[j.x.Zero(),j.x.Zero(),j.x.Zero(),j.x.Zero(),j.x.Zero(),j.x.Zero()],e._tmpQuat=j.q.Identity(),e._tmpMats=[j.j.Identity(),j.j.Identity()],e}(),Gi=function(){function e(a,b,c,d){if(this.upAxis=j.x.Up(),this.upAxisSpace=j.s.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=j.q.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=j.x.Forward(),this.mesh=a,this.bone=b,this.target=c,d&&(d.adjustYaw&&(this.adjustYaw=d.adjustYaw),d.adjustPitch&&(this.adjustPitch=d.adjustPitch),d.adjustRoll&&(this.adjustRoll=d.adjustRoll),null!=d.maxYaw?this.maxYaw=d.maxYaw:this.maxYaw=Math.PI,null!=d.minYaw?this.minYaw=d.minYaw:this.minYaw=-Math.PI,null!=d.maxPitch?this.maxPitch=d.maxPitch:this.maxPitch=Math.PI,null!=d.minPitch?this.minPitch=d.minPitch:this.minPitch=-Math.PI,null!=d.slerpAmount&&(this.slerpAmount=d.slerpAmount),null!=d.upAxis&&(this.upAxis=d.upAxis),null!=d.upAxisSpace&&(this.upAxisSpace=d.upAxisSpace),null!=d.yawAxis||null!=d.pitchAxis)){var f=j.c.Y,h=j.c.X;null!=d.yawAxis&&(f=d.yawAxis.clone()).normalize(),null!=d.pitchAxis&&(h=d.pitchAxis.clone()).normalize();var i=j.x.Cross(h,f);this._transformYawPitch=j.j.Identity(),j.j.FromXYZAxesToRef(h,f,i,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}b.getParent()||this.upAxisSpace!=j.s.BONE||(this.upAxisSpace=j.s.LOCAL)}return Object.defineProperty(e.prototype,"minYaw",{get:function(){return this._minYaw},set:function(a){this._minYaw=a,this._minYawSin=Math.sin(a),this._minYawCos=Math.cos(a),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(a){this._maxYaw=a,this._maxYawSin=Math.sin(a),this._maxYawCos=Math.cos(a),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPitch",{get:function(){return this._minPitch},set:function(a){this._minPitch=a,this._minPitchTan=Math.tan(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(a){this._maxPitch=a,this._maxPitchTan=Math.tan(a)},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var a=this.bone,b=e._tmpVecs[0];a.getAbsolutePositionToRef(this.mesh,b);var c=this.target,d=e._tmpMats[0],f=e._tmpMats[1],h=this.mesh,i=a.getParent(),k=e._tmpVecs[1];k.copyFrom(this.upAxis),this.upAxisSpace==j.s.BONE&&i?(this._transformYawPitch&&j.x.TransformCoordinatesToRef(k,this._transformYawPitchInv,k),i.getDirectionToRef(k,this.mesh,k)):this.upAxisSpace==j.s.LOCAL&&(h.getDirectionToRef(k,k),1==h.scaling.x&&1==h.scaling.y&&1==h.scaling.z||k.normalize());var m=!1,B=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(m=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(B=!0),m||B){var E=e._tmpMats[2],K=e._tmpMats[3];if(this.upAxisSpace==j.s.BONE&&1==k.y&&i)i.getRotationMatrixToRef(j.s.WORLD,this.mesh,E);else if(this.upAxisSpace!=j.s.LOCAL||1!=k.y||i){(S=e._tmpVecs[2]).copyFrom(this._fowardAxis),this._transformYawPitch&&j.x.TransformCoordinatesToRef(S,this._transformYawPitchInv,S),i?i.getDirectionToRef(S,this.mesh,S):h.getDirectionToRef(S,S);var P=j.x.Cross(k,S);P.normalize();var S=j.x.Cross(P,k);j.j.FromXYZAxesToRef(P,k,S,E)}else E.copyFrom(h.getWorldMatrix());E.invertToRef(K);var U=null;if(B){var _=e._tmpVecs[3];c.subtractToRef(b,_),j.x.TransformCoordinatesToRef(_,K,_),U=Math.sqrt(_.x*_.x+_.z*_.z);var da=Math.atan2(_.y,U),fa=da;da>this._maxPitch?(_.y=this._maxPitchTan*U,fa=this._maxPitch):da<this._minPitch&&(_.y=this._minPitchTan*U,fa=this._minPitch),da!=fa&&(j.x.TransformCoordinatesToRef(_,E,_),_.addInPlace(b),c=_)}if(m){_=e._tmpVecs[4],c.subtractToRef(b,_),j.x.TransformCoordinatesToRef(_,K,_);var ga=Math.atan2(_.x,_.z),ha=ga;if((ga>this._maxYaw||ga<this._minYaw)&&(null==U&&(U=Math.sqrt(_.x*_.x+_.z*_.z)),this._yawRange>Math.PI?this._isAngleBetween(ga,this._maxYaw,this._midYawConstraint)?(_.z=this._maxYawCos*U,_.x=this._maxYawSin*U,ha=this._maxYaw):this._isAngleBetween(ga,this._midYawConstraint,this._minYaw)&&(_.z=this._minYawCos*U,_.x=this._minYawSin*U,ha=this._minYaw):ga>this._maxYaw?(_.z=this._maxYawCos*U,_.x=this._maxYawSin*U,ha=this._maxYaw):ga<this._minYaw&&(_.z=this._minYawCos*U,_.x=this._minYawSin*U,ha=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var ka=e._tmpVecs[8];ka.copyFrom(j.c.Z),this._transformYawPitch&&j.x.TransformCoordinatesToRef(ka,this._transformYawPitchInv,ka);var la=e._tmpMats[4];this._boneQuat.toRotationMatrix(la),this.mesh.getWorldMatrix().multiplyToRef(la,la),j.x.TransformCoordinatesToRef(ka,la,ka),j.x.TransformCoordinatesToRef(ka,K,ka);var ma=Math.atan2(ka.x,ka.z);if(this._getAngleBetween(ma,ga)>this._getAngleBetween(ma,this._midYawConstraint)){null==U&&(U=Math.sqrt(_.x*_.x+_.z*_.z));var ta=this._getAngleBetween(ma,this._maxYaw);this._getAngleBetween(ma,this._minYaw)<ta?(ha=ma+.75*Math.PI,_.z=Math.cos(ha)*U,_.x=Math.sin(ha)*U):(ha=ma-.75*Math.PI,_.z=Math.cos(ha)*U,_.x=Math.sin(ha)*U)}}ga!=ha&&(j.x.TransformCoordinatesToRef(_,E,_),_.addInPlace(b),c=_)}}var pa=e._tmpVecs[5],ua=e._tmpVecs[6],wa=e._tmpVecs[7],ya=e._tmpQuat;c.subtractToRef(b,pa),pa.normalize(),j.x.CrossToRef(k,pa,ua),ua.normalize(),j.x.CrossToRef(pa,ua,wa),wa.normalize(),j.j.FromXYZAxesToRef(ua,wa,pa,d),0===ua.x&&0===ua.y&&0===ua.z||0===wa.x&&0===wa.y&&0===wa.z||0===pa.x&&0===pa.y&&0===pa.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(j.j.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,f),f.multiplyToRef(d,d)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(j.s.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(d,d),j.q.FromRotationMatrixToRef(d,ya),j.q.SlerpToRef(this._boneQuat,ya,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,j.s.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(d,d),this.bone.setRotationMatrix(d,j.s.WORLD,this.mesh),this._slerping=!1))}},e.prototype._getAngleDiff=function(a,b){var c=b-a;return(c%=2*Math.PI)>Math.PI?c-=2*Math.PI:c<-Math.PI&&(c+=2*Math.PI),c},e.prototype._getAngleBetween=function(a,b){var c=0;return(c=(a=(a%=2*Math.PI)<0?a+2*Math.PI:a)<(b=(b%=2*Math.PI)<0?b+2*Math.PI:b)?b-a:a-b)>Math.PI&&(c=2*Math.PI-c),c},e.prototype._isAngleBetween=function(a,b,c){if(a=(a%=2*Math.PI)<0?a+2*Math.PI:a,(b=(b%=2*Math.PI)<0?b+2*Math.PI:b)<(c=(c%=2*Math.PI)<0?c+2*Math.PI:c)){if(a>b&&a<c)return!0}else if(a>c&&a<b)return!0;return!1},e._tmpVecs=za.a.BuildArray(10,j.x.Zero),e._tmpQuat=j.q.Identity(),e._tmpMats=za.a.BuildArray(5,j.j.Identity),e}(),ra=l(7),sb=l(26);va.b.prototype.updateRawTexture=function(e,a,b,c,d,f){if(void 0===d&&(d=null),void 0===f&&(f=va.b.TEXTURETYPE_UNSIGNED_INT),e){var h=this._getRGBABufferInternalSizedFormat(f,b),i=this._getInternalFormat(b),k=this._getWebGLTextureType(f);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===c||!!c),this._doNotHandleContextLost||(e._bufferView=a,e.format=b,e.type=f,e.invertY=c,e._compression=d),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),d&&a?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[d],e.width,e.height,0,a):this._gl.texImage2D(this._gl.TEXTURE_2D,0,h,e.width,e.height,0,i,k,a),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}},va.b.prototype.createRawTexture=function(e,a,b,c,d,f,h,i,k){void 0===i&&(i=null),void 0===k&&(k=va.b.TEXTURETYPE_UNSIGNED_INT);var m=new sb.a(this,sb.a.DATASOURCE_RAW);m.baseWidth=a,m.baseHeight=b,m.width=a,m.height=b,m.format=c,m.generateMipMaps=d,m.samplingMode=h,m.invertY=f,m._compression=i,m.type=k,this._doNotHandleContextLost||(m._bufferView=e),this.updateRawTexture(m,e,c,f,i,k),this._bindTextureDirectly(this._gl.TEXTURE_2D,m,!0);var B=this._getSamplingParameters(h,d);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,B.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,B.min),d&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(m),m},va.b.prototype.createRawCubeTexture=function(e,a,b,c,d,f,h,i){void 0===i&&(i=null);var k=this._gl,m=new sb.a(this,sb.a.DATASOURCE_CUBERAW);m.isCube=!0,m.format=b,m.type=c,this._doNotHandleContextLost||(m._bufferViewArray=e);var B=this._getWebGLTextureType(c),E=this._getInternalFormat(b);E===k.RGB&&(E=k.RGBA),B!==k.FLOAT||this._caps.textureFloatLinearFiltering?B!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?B!==k.FLOAT||this._caps.textureFloatRender?B!==k.HALF_FLOAT||this._caps.colorBufferFloat||(d=!1,r.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(d=!1,r.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(d=!1,h=va.b.TEXTURE_NEAREST_SAMPLINGMODE,r.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(d=!1,h=va.b.TEXTURE_NEAREST_SAMPLINGMODE,r.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var K=a,P=K;m.width=K,m.height=P,!this.needPOTTextures||xa.h.IsExponentOfTwo(m.width)&&xa.h.IsExponentOfTwo(m.height)||(d=!1),e&&this.updateRawCubeTexture(m,e,b,c,f,i),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,m,!0),e&&d&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var S=this._getSamplingParameters(h,d);return k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MAG_FILTER,S.mag),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MIN_FILTER,S.min),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,null),m.generateMipMaps=d,m},va.b.prototype.updateRawCubeTexture=function(e,a,b,c,d,f,h){void 0===f&&(f=null),void 0===h&&(h=0),e._bufferViewArray=a,e.format=b,e.type=c,e.invertY=d,e._compression=f;var i=this._gl,k=this._getWebGLTextureType(c),m=this._getInternalFormat(b),B=this._getRGBABufferInternalSizedFormat(c),E=!1;m===i.RGB&&(m=i.RGBA,E=!0),this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===d||!!d),e.width%4!=0&&i.pixelStorei(i.UNPACK_ALIGNMENT,1);for(var K=0;K<6;K++){var P=a[K];f?i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+K,h,this.getCaps().s3tc[f],e.width,e.height,0,P):(E&&(P=this._convertRGBtoRGBATextureData(P,e.width,e.height,c)),i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+K,h,B,e.width,e.height,0,m,k,P))}(!this.needPOTTextures||xa.h.IsExponentOfTwo(e.width)&&xa.h.IsExponentOfTwo(e.height))&&e.generateMipMaps&&0===h&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},va.b.prototype.createRawCubeTextureFromUrl=function(e,a,b,c,d,f,h,i,k,m,B,E){var K=this;void 0===k&&(k=null),void 0===m&&(m=null),void 0===B&&(B=va.b.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===E&&(E=!1);var P=this._gl,S=this.createRawCubeTexture(null,b,c,d,!f,E,B);return a._addPendingData(S),S.url=e,this._internalTexturesCache.push(S),this._loadFile(e,function(U){!function(_){var da=S.width,fa=h(_);if(fa){if(i){var ga=K._getWebGLTextureType(d),ha=K._getInternalFormat(c),ka=K._getRGBABufferInternalSizedFormat(d),la=!1;ha===P.RGB&&(ha=P.RGBA,la=!0),K._bindTextureDirectly(P.TEXTURE_CUBE_MAP,S,!0),K._unpackFlipY(!1);for(var ma=i(fa),ta=0;ta<ma.length;ta++)for(var pa=da>>ta,ua=0;ua<6;ua++){var wa=ma[ta][ua];la&&(wa=K._convertRGBtoRGBATextureData(wa,pa,pa,d)),P.texImage2D(ua,ta,ka,pa,pa,0,ha,ga,wa)}K._bindTextureDirectly(P.TEXTURE_CUBE_MAP,null)}else K.updateRawCubeTexture(S,fa,c,d,E);S.isReady=!0,a._removePendingData(S),k&&k()}}(U)},void 0,a.offlineProvider,!0,function(U,_){a._removePendingData(S),m&&U&&m(U.status+" "+U.statusText,_)}),S},va.b.prototype.createRawTexture3D=function(e,a,b,c,d,f,h,i,k,m){void 0===k&&(k=null),void 0===m&&(m=va.b.TEXTURETYPE_UNSIGNED_INT);var B=new sb.a(this,sb.a.DATASOURCE_RAW3D);B.baseWidth=a,B.baseHeight=b,B.baseDepth=c,B.width=a,B.height=b,B.depth=c,B.format=d,B.type=m,B.generateMipMaps=f,B.samplingMode=i,B.is3D=!0,this._doNotHandleContextLost||(B._bufferView=e),this.updateRawTexture3D(B,e,d,h,k,m),this._bindTextureDirectly(this._gl.TEXTURE_3D,B,!0);var E=this._getSamplingParameters(i,f);return this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,E.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,E.min),f&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._internalTexturesCache.push(B),B},va.b.prototype.updateRawTexture3D=function(e,a,b,c,d,f){void 0===d&&(d=null),void 0===f&&(f=va.b.TEXTURETYPE_UNSIGNED_INT);var h=this._getWebGLTextureType(f),i=this._getInternalFormat(b),k=this._getRGBABufferInternalSizedFormat(f,b);this._bindTextureDirectly(this._gl.TEXTURE_3D,e,!0),this._unpackFlipY(void 0===c||!!c),this._doNotHandleContextLost||(e._bufferView=a,e.format=b,e.invertY=c,e._compression=d),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),d&&a?this._gl.compressedTexImage3D(this._gl.TEXTURE_3D,0,this.getCaps().s3tc[d],e.width,e.height,e.depth,0,a):this._gl.texImage3D(this._gl.TEXTURE_3D,0,k,e.width,e.height,e.depth,0,i,h,a),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),e.isReady=!0};var zc=function(e){function a(b,c,d,f,h,i,k,m,B){void 0===i&&(i=!0),void 0===k&&(k=!1),void 0===m&&(m=o.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===B&&(B=o.a.TEXTURETYPE_UNSIGNED_INT);var E=e.call(this,null,h,!i,k)||this;return E.format=f,E._engine=h.getEngine(),E._texture=h.getEngine().createRawTexture(b,c,d,f,i,k,m,null,B),E.wrapU=ra.a.CLAMP_ADDRESSMODE,E.wrapV=ra.a.CLAMP_ADDRESSMODE,E}return v.d(a,e),a.prototype.update=function(b){this._engine.updateRawTexture(this._texture,b,this._texture.format,this._texture.invertY,null,this._texture.type)},a.CreateLuminanceTexture=function(b,c,d,f,h,i,k){return void 0===h&&(h=!0),void 0===i&&(i=!1),void 0===k&&(k=o.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new a(b,c,d,o.a.TEXTUREFORMAT_LUMINANCE,f,h,i,k)},a.CreateLuminanceAlphaTexture=function(b,c,d,f,h,i,k){return void 0===h&&(h=!0),void 0===i&&(i=!1),void 0===k&&(k=o.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new a(b,c,d,o.a.TEXTUREFORMAT_LUMINANCE_ALPHA,f,h,i,k)},a.CreateAlphaTexture=function(b,c,d,f,h,i,k){return void 0===h&&(h=!0),void 0===i&&(i=!1),void 0===k&&(k=o.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new a(b,c,d,o.a.TEXTUREFORMAT_ALPHA,f,h,i,k)},a.CreateRGBTexture=function(b,c,d,f,h,i,k,m){return void 0===h&&(h=!0),void 0===i&&(i=!1),void 0===k&&(k=o.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===m&&(m=o.a.TEXTURETYPE_UNSIGNED_INT),new a(b,c,d,o.a.TEXTUREFORMAT_RGB,f,h,i,k,m)},a.CreateRGBATexture=function(b,c,d,f,h,i,k,m){return void 0===h&&(h=!0),void 0===i&&(i=!1),void 0===k&&(k=o.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===m&&(m=o.a.TEXTURETYPE_UNSIGNED_INT),new a(b,c,d,o.a.TEXTUREFORMAT_RGBA,f,h,i,k,m)},a.CreateRTexture=function(b,c,d,f,h,i,k,m){return void 0===h&&(h=!0),void 0===i&&(i=!1),void 0===k&&(k=ra.a.TRILINEAR_SAMPLINGMODE),void 0===m&&(m=o.a.TEXTURETYPE_FLOAT),new a(b,c,d,o.a.TEXTUREFORMAT_R,f,h,i,k,m)},a}(ra.a),le=function(){function e(a,b,c){this.name=a,this.id=b,this.bones=new Array(),this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array(),this._identity=j.j.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new q.c(),this.bones=[],this._scene=c||T.a.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var d=this._scene.getEngine().getCaps();this._canUseTextureForBones=d.textureFloat&&d.maxVertexTextureImageUnits>0}return Object.defineProperty(e.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(a){this._useTextureToStoreBoneMatrices=a,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(a){this._animationPropertiesOverride=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones&&!this.needInitialSkinMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"Skeleton"},e.prototype.getChildren=function(){return this.bones.filter(function(a){return!a.getParent()})},e.prototype.getTransformMatrices=function(a){return this.needInitialSkinMatrix&&a._bonesTransformMatrices?a._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},e.prototype.getTransformMatrixTexture=function(){return this._transformMatrixTexture},e.prototype.getScene=function(){return this._scene},e.prototype.toString=function(a){var b="Name: "+this.name+", nBones: "+this.bones.length;if(b+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),a){b+=", Ranges: {";var c=!0;for(var d in this._ranges)c&&(b+=", ",c=!1),b+=d;b+="}"}return b},e.prototype.getBoneIndexByName=function(a){for(var b=0,c=this.bones.length;b<c;b++)if(this.bones[b].name===a)return b;return-1},e.prototype.createAnimationRange=function(a,b,c){if(!this._ranges[a]){this._ranges[a]=new n(a,b,c);for(var d=0,f=this.bones.length;d<f;d++)this.bones[d].animations[0]&&this.bones[d].animations[0].createRange(a,b,c)}},e.prototype.deleteAnimationRange=function(a,b){void 0===b&&(b=!0);for(var c=0,d=this.bones.length;c<d;c++)this.bones[c].animations[0]&&this.bones[c].animations[0].deleteRange(a,b);this._ranges[a]=null},e.prototype.getAnimationRange=function(a){return this._ranges[a]},e.prototype.getAnimationRanges=function(){var a,b=[];for(a in this._ranges)b.push(this._ranges[a]);return b},e.prototype.copyAnimationRange=function(a,b,c){if(void 0===c&&(c=!1),this._ranges[b]||!a.getAnimationRange(b))return!1;var d,f,h=!0,i=this._getHighestAnimationFrame()+1,k={},m=a.bones;for(f=0,d=m.length;f<d;f++)k[m[f].name]=m[f];this.bones.length!==m.length&&(r.a.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+m.length),h=!1);var B=c&&this.dimensionsAtRest&&a.dimensionsAtRest?this.dimensionsAtRest.divide(a.dimensionsAtRest):null;for(f=0,d=this.bones.length;f<d;f++){var E=this.bones[f].name,K=k[E];K?h=h&&this.bones[f].copyAnimationRange(K,b,i,c,B):(r.a.Warn("copyAnimationRange: not same rig, missing source bone "+E),h=!1)}var P=a.getAnimationRange(b);return P&&(this._ranges[b]=new n(b,P.from+i,P.to+i)),h},e.prototype.returnToRest=function(){for(var a=0;a<this.bones.length;a++)this.bones[a].returnToRest()},e.prototype._getHighestAnimationFrame=function(){for(var a=0,b=0,c=this.bones.length;b<c;b++)if(this.bones[b].animations[0]){var d=this.bones[b].animations[0].getHighestFrame();a<d&&(a=d)}return a},e.prototype.beginAnimation=function(a,b,c,d){var f=this.getAnimationRange(a);return f?this._scene.beginAnimation(this,f.from,f.to,b,c,d):null},e.prototype._markAsDirty=function(){this._isDirty=!0},e.prototype._registerMeshWithPoseMatrix=function(a){this._meshesWithPoseMatrix.push(a)},e.prototype._unregisterMeshWithPoseMatrix=function(a){var b=this._meshesWithPoseMatrix.indexOf(a);b>-1&&this._meshesWithPoseMatrix.splice(b,1)},e.prototype._computeTransformMatrices=function(a,b){this.onBeforeComputeObservable.notifyObservers(this);for(var c=0;c<this.bones.length;c++){var d=this.bones[c];d._childUpdateId++;var f=d.getParent();if(f?d.getLocalMatrix().multiplyToRef(f.getWorldMatrix(),d.getWorldMatrix()):b?d.getLocalMatrix().multiplyToRef(b,d.getWorldMatrix()):d.getWorldMatrix().copyFrom(d.getLocalMatrix()),-1!==d._index){var h=null===d._index?c:d._index;d.getInvertedAbsoluteTransform().multiplyToArray(d.getWorldMatrix(),a,16*h)}}this._identity.copyToArray(a,16*this.bones.length)},e.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var a=0,b=this.bones;a<b.length;a++){var c=b[a];c._linkedTransformNode&&(c._linkedTransformNode.computeWorldMatrix(),c._matrix=c._linkedTransformNode._localMatrix,c.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var d=0;d<this._meshesWithPoseMatrix.length;d++){var f=this._meshesWithPoseMatrix[d],h=f.getPoseMatrix();if(f._bonesTransformMatrices&&f._bonesTransformMatrices.length===16*(this.bones.length+1)||(f._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==f){this._synchronizedWithMesh=f;for(var i=0;i<this.bones.length;i++){var k=this.bones[i];k.getParent()||(k.getBaseMatrix().multiplyToRef(h,j.t.Matrix[1]),k._updateDifferenceMatrix(j.t.Matrix[1]))}}this._computeTransformMatrices(f._bonesTransformMatrices,h)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=zc.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,o.a.TEXTURE_NEAREST_SAMPLINGMODE,o.a.TEXTURETYPE_FLOAT))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},e.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var a=0;a<this.bones.length;a++)this._animatables.push(this.bones[a])}return this._animatables},e.prototype.clone=function(a,b){var c=new e(a,b||a,this._scene);c.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var d=0;d<this.bones.length;d++){var f=this.bones[d],h=null,i=f.getParent();if(i){var k=this.bones.indexOf(i);h=c.bones[k]}var m=new Fa(f.name,c,h,f.getBaseMatrix().clone(),f.getRestPose().clone());V.a.DeepCopy(f.animations,m.animations)}if(this._ranges)for(var B in c._ranges={},this._ranges){var E=this._ranges[B];E&&(c._ranges[B]=E.clone())}return this._isDirty=!0,c},e.prototype.enableBlending=function(a){void 0===a&&(a=.01),this.bones.forEach(function(b){b.animations.forEach(function(c){c.enableBlending=!0,c.blendingSpeed=a})})},e.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},e.prototype.serialize=function(){var a={};a.name=this.name,a.id=this.id,this.dimensionsAtRest&&(a.dimensionsAtRest=this.dimensionsAtRest.asArray()),a.bones=[],a.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var b=0;b<this.bones.length;b++){var c=this.bones[b],d=c.getParent(),f={parentBoneIndex:d?this.bones.indexOf(d):-1,name:c.name,matrix:c.getBaseMatrix().toArray(),rest:c.getRestPose().toArray()};for(var h in a.bones.push(f),c.length&&(f.length=c.length),c.metadata&&(f.metadata=c.metadata),c.animations&&c.animations.length>0&&(f.animation=c.animations[0].serialize()),a.ranges=[],this._ranges){var i=this._ranges[h];if(i){var k={};k.name=h,k.from=i.from,k.to=i.to,a.ranges.push(k)}}}return a},e.Parse=function(a,b){var c,d=new e(a.name,a.id,b);for(a.dimensionsAtRest&&(d.dimensionsAtRest=j.x.FromArray(a.dimensionsAtRest)),d.needInitialSkinMatrix=a.needInitialSkinMatrix,c=0;c<a.bones.length;c++){var f=a.bones[c],h=null;f.parentBoneIndex>-1&&(h=d.bones[f.parentBoneIndex]);var i=f.rest?j.j.FromArray(f.rest):null,k=new Fa(f.name,d,h,j.j.FromArray(f.matrix),i);void 0!==f.id&&null!==f.id&&(k.id=f.id),f.length&&(k.length=f.length),f.metadata&&(k.metadata=f.metadata),f.animation&&k.animations.push(C.Parse(f.animation)),void 0!==f.linkedTransformNodeId&&null!==f.linkedTransformNodeId&&(d._hasWaitingData=!0,k._waitingTransformNodeId=f.linkedTransformNodeId)}if(a.ranges)for(c=0;c<a.ranges.length;c++){var m=a.ranges[c];d.createAnimationRange(m.name,m.from,m.to)}return d},e.prototype.computeAbsoluteTransforms=function(a){void 0===a&&(a=!1);var b=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=b||a)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=b)},e.prototype.getPoseMatrix=function(){var a=null;return this._meshesWithPoseMatrix.length>0&&(a=this._meshesWithPoseMatrix[0].getPoseMatrix()),a},e.prototype.sortBones=function(){for(var a=new Array(),b=new Array(this.bones.length),c=0;c<this.bones.length;c++)this._sortBones(c,a,b);this.bones=a},e.prototype._sortBones=function(a,b,c){if(!c[a]){c[a]=!0;var d=this.bones[a];void 0===d._index&&(d._index=a);var f=d.getParent();f&&this._sortBones(this.bones.indexOf(f),b,c),b.push(d)}},e}(),Db={},Yc=function(){function e(a){this.attached={},this.camera=a,this.checkInputs=function(){}}return e.prototype.add=function(a){var b=a.getSimpleName();this.attached[b]?r.a.Warn("camera input of type "+b+" already exists on camera"):(this.attached[b]=a,a.camera=this.camera,a.checkInputs&&(this.checkInputs=this._addCheckInputs(a.checkInputs.bind(a))),this.attachedElement&&a.attachControl(this.attachedElement))},e.prototype.remove=function(a){for(var b in this.attached){var c=this.attached[b];c===a&&(c.detachControl(this.attachedElement),c.camera=null,delete this.attached[b],this.rebuildInputCheck())}},e.prototype.removeByType=function(a){for(var b in this.attached){var c=this.attached[b];c.getClassName()===a&&(c.detachControl(this.attachedElement),c.camera=null,delete this.attached[b],this.rebuildInputCheck())}},e.prototype._addCheckInputs=function(a){var b=this.checkInputs;return function(){b(),a()}},e.prototype.attachInput=function(a){this.attachedElement&&a.attachControl(this.attachedElement,this.noPreventDefault)},e.prototype.attachElement=function(a,b){if(void 0===b&&(b=!1),!this.attachedElement)for(var c in b=!ab.a.ForceAttachControlToAlwaysPreventDefault&&b,this.attachedElement=a,this.noPreventDefault=b,this.attached)this.attached[c].attachControl(a,b)},e.prototype.detachElement=function(a,b){if(void 0===b&&(b=!1),this.attachedElement===a){for(var c in this.attached)this.attached[c].detachControl(a),b&&(this.attached[c].camera=null);this.attachedElement=null}},e.prototype.rebuildInputCheck=function(){for(var a in this.checkInputs=function(){},this.attached){var b=this.attached[a];b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b)))}},e.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},e.prototype.serialize=function(a){var b={};for(var c in this.attached){var d=this.attached[c],f=g.a.Serialize(d);b[d.getClassName()]=f}a.inputsmgr=b},e.prototype.parse=function(a){var b=a.inputsmgr;if(b){for(var c in this.clear(),b)if(h=Db[c]){var d=b[c],f=g.a.Parse(function(){return new h()},d,null);this.add(f)}}else for(var c in this.attached){var h;(h=Db[this.attached[c].getClassName()])&&(f=g.a.Parse(function(){return new h()},a,null),this.remove(this.attached[c]),this.add(f))}},e}(),Hi=function(){return function(e,a){this.x=e,this.y=a}}(),Hb=function(){function e(a,b,c,d,f,h,i){void 0===d&&(d=0),void 0===f&&(f=1),void 0===h&&(h=2),void 0===i&&(i=3),this.id=a,this.index=b,this.browserGamepad=c,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=e.GAMEPAD,this._leftStickAxisX=d,this._leftStickAxisY=f,this._rightStickAxisX=h,this._rightStickAxisY=i,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),e.prototype.onleftstickchanged=function(a){this._onleftstickchanged=a},e.prototype.onrightstickchanged=function(a){this._onrightstickchanged=a},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(a){!this._onleftstickchanged||this._leftStick.x===a.x&&this._leftStick.y===a.y||this._onleftstickchanged(a),this._leftStick=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(a){!this._onrightstickchanged||this._rightStick.x===a.x&&this._rightStick.y===a.y||this._onrightstickchanged(a),this._rightStick=a},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},e.prototype.dispose=function(){},e.GAMEPAD=0,e.GENERIC=1,e.XBOX=2,e.POSE_ENABLED=3,e}(),dg=function(e){function a(b,c,d){var f=e.call(this,b,c,d)||this;return f.onButtonDownObservable=new q.c(),f.onButtonUpObservable=new q.c(),f.type=Hb.GENERIC,f._buttons=new Array(d.buttons.length),f}return v.d(a,e),a.prototype.onbuttondown=function(b){this._onbuttondown=b},a.prototype.onbuttonup=function(b){this._onbuttonup=b},a.prototype._setButtonValue=function(b,c,d){return b!==c&&(1===b&&(this._onbuttondown&&this._onbuttondown(d),this.onButtonDownObservable.notifyObservers(d)),0===b&&(this._onbuttonup&&this._onbuttonup(d),this.onButtonUpObservable.notifyObservers(d))),b},a.prototype.update=function(){e.prototype.update.call(this);for(var b=0;b<this._buttons.length;b++)this._buttons[b]=this._setButtonValue(this.browserGamepad.buttons[b].value,this._buttons[b],b)},a.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},a}(Hb),me=function(){function e(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40}return e.prototype.attachControl=function(a,b){var c=this,d=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=d.onGamepadConnectedObservable.add(function(f){f.type!==Hb.POSE_ENABLED&&(c.gamepad&&f.type!==Hb.XBOX||(c.gamepad=f))}),this._onGamepadDisconnectedObserver=d.onGamepadDisconnectedObservable.add(function(f){c.gamepad===f&&(c.gamepad=null)}),this.gamepad=d.getGamepadByType(Hb.XBOX)},e.prototype.detachControl=function(a){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},e.prototype.checkInputs=function(){if(this.gamepad){var a=this.camera,b=this.gamepad.rightStick;if(b){if(0!=b.x){var c=b.x/this.gamepadRotationSensibility;0!=c&&Math.abs(c)>.005&&(a.inertialAlphaOffset+=c)}if(0!=b.y){var d=b.y/this.gamepadRotationSensibility;0!=d&&Math.abs(d)>.005&&(a.inertialBetaOffset+=d)}}var f=this.gamepad.leftStick;if(f&&0!=f.y){var h=f.y/this.gamepadMoveSensibility;0!=h&&Math.abs(h)>.005&&(this.camera.inertialRadiusOffset-=h)}}},e.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},e.prototype.getSimpleName=function(){return"gamepad"},v.c([Object(g.c)()],e.prototype,"gamepadRotationSensibility",void 0),v.c([Object(g.c)()],e.prototype,"gamepadMoveSensibility",void 0),e}();Db.ArcRotateCameraGamepadInput=me;var Ac=l(51),ne=function(){function e(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array()}return e.prototype.attachControl=function(a,b){var c=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){c._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(d){var f,h=d.event;h.metaKey||(d.type===Ac.a.KEYDOWN?(c._ctrlPressed=h.ctrlKey,c._altPressed=h.altKey,(-1!==c.keysUp.indexOf(h.keyCode)||-1!==c.keysDown.indexOf(h.keyCode)||-1!==c.keysLeft.indexOf(h.keyCode)||-1!==c.keysRight.indexOf(h.keyCode)||-1!==c.keysReset.indexOf(h.keyCode))&&(-1===(f=c._keys.indexOf(h.keyCode))&&c._keys.push(h.keyCode),h.preventDefault&&(b||h.preventDefault()))):-1===c.keysUp.indexOf(h.keyCode)&&-1===c.keysDown.indexOf(h.keyCode)&&-1===c.keysLeft.indexOf(h.keyCode)&&-1===c.keysRight.indexOf(h.keyCode)&&-1===c.keysReset.indexOf(h.keyCode)||((f=c._keys.indexOf(h.keyCode))>=0&&c._keys.splice(f,1),h.preventDefault&&(b||h.preventDefault())))}))},e.prototype.detachControl=function(a){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var a=this.camera,b=0;b<this._keys.length;b++){var c=this._keys[b];-1!==this.keysLeft.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningX-=1/this.panningSensibility:a.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?a.inertialRadiusOffset+=1/this.zoomingSensibility:a.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningX+=1/this.panningSensibility:a.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(c)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?a.inertialRadiusOffset-=1/this.zoomingSensibility:a.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(c)&&a.useInputToRestoreState&&a.restoreState()}},e.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},e.prototype.getSimpleName=function(){return"keyboard"},v.c([Object(g.c)()],e.prototype,"keysUp",void 0),v.c([Object(g.c)()],e.prototype,"keysDown",void 0),v.c([Object(g.c)()],e.prototype,"keysLeft",void 0),v.c([Object(g.c)()],e.prototype,"keysRight",void 0),v.c([Object(g.c)()],e.prototype,"keysReset",void 0),v.c([Object(g.c)()],e.prototype,"panningSensibility",void 0),v.c([Object(g.c)()],e.prototype,"zoomingSensibility",void 0),v.c([Object(g.c)()],e.prototype,"useAltToZoom",void 0),v.c([Object(g.c)()],e.prototype,"angularSpeed",void 0),e}();Db.ArcRotateCameraKeyboardMoveInput=ne;var oe=function(){function e(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return e.prototype.computeDeltaFromMouseWheelLegacyEvent=function(a,b){var c=.01*a.wheelDelta*this.wheelDeltaPercentage*b;return a.wheelDelta>0?c/(1+this.wheelDeltaPercentage):c*(1+this.wheelDeltaPercentage)},e.prototype.attachControl=function(a,b){var c=this;this._wheel=function(d,f){if(d.type===hb.a.POINTERWHEEL){var h=d.event,i=0,k=h;if(k.wheelDelta)if(c.wheelDeltaPercentage){if((i=c.computeDeltaFromMouseWheelLegacyEvent(k,c.camera.radius))>0){for(var m=c.camera.radius,B=c.camera.inertialRadiusOffset+i,E=0;E<20&&Math.abs(B)>.001;E++)m-=B,B*=c.camera.inertia;m=p.a.Clamp(m,0,Number.MAX_VALUE),i=c.computeDeltaFromMouseWheelLegacyEvent(k,m)}}else i=k.wheelDelta/(40*c.wheelPrecision);else i=-(h.deltaY||h.detail)/c.wheelPrecision;i&&(c.camera.inertialRadiusOffset+=i),h.preventDefault&&(b||h.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,hb.a.POINTERWHEEL)},e.prototype.detachControl=function(a){this._observer&&a&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},e.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},e.prototype.getSimpleName=function(){return"mousewheel"},v.c([Object(g.c)()],e.prototype,"wheelPrecision",void 0),v.c([Object(g.c)()],e.prototype,"wheelDeltaPercentage",void 0),e}();Db.ArcRotateCameraMouseWheelInput=oe;var eg=function(){function e(){this.buttons=[0,1,2]}return e.prototype.attachControl=function(a,b){var c=this,d=this.camera.getEngine(),f=0,h=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(i,k){var m=i.event,B="touch"===m.pointerType;if(!d.isInVRExclusivePointerMode&&(i.type===hb.a.POINTERMOVE||-1!==c.buttons.indexOf(m.button))){var E=m.srcElement||m.target;if(c._altKey=m.altKey,c._ctrlKey=m.ctrlKey,c._metaKey=m.metaKey,c._shiftKey=m.shiftKey,c._buttonsPressed=m.buttons,d.isPointerLock){var K=m.movementX||m.mozMovementX||m.webkitMovementX||m.msMovementX||0,P=m.movementY||m.mozMovementY||m.webkitMovementY||m.msMovementY||0;c.onTouch(null,K,P),c.pointA=null,c.pointB=null}else if(i.type===hb.a.POINTERDOWN&&E){try{E.setPointerCapture(m.pointerId)}catch(ga){}null===c.pointA?c.pointA={x:m.clientX,y:m.clientY,pointerId:m.pointerId,type:m.pointerType}:null===c.pointB&&(c.pointB={x:m.clientX,y:m.clientY,pointerId:m.pointerId,type:m.pointerType}),c.onButtonDown(m),b||(m.preventDefault(),a.focus())}else if(i.type===hb.a.POINTERDOUBLETAP)c.onDoubleTap(m.pointerType);else if(i.type===hb.a.POINTERUP&&E){try{E.releasePointerCapture(m.pointerId)}catch(ga){}B||(c.pointB=null),d._badOS?c.pointA=c.pointB=null:c.pointB&&c.pointA&&c.pointA.pointerId==m.pointerId?(c.pointA=c.pointB,c.pointB=null):c.pointA&&c.pointB&&c.pointB.pointerId==m.pointerId?c.pointB=null:c.pointA=c.pointB=null,(0!==f||h)&&(c.onMultiTouch(c.pointA,c.pointB,f,0,h,null),f=0,h=null),c.onButtonUp(m),b||m.preventDefault()}else if(i.type===hb.a.POINTERMOVE){if(b||m.preventDefault(),c.pointA&&null===c.pointB)K=m.clientX-c.pointA.x,P=m.clientY-c.pointA.y,c.onTouch(c.pointA,K,P),c.pointA.x=m.clientX,c.pointA.y=m.clientY;else if(c.pointA&&c.pointB){var S=c.pointA.pointerId===m.pointerId?c.pointA:c.pointB;S.x=m.clientX,S.y=m.clientY;var U=c.pointA.x-c.pointB.x,_=c.pointA.y-c.pointB.y,da=U*U+_*_,fa={x:(c.pointA.x+c.pointB.x)/2,y:(c.pointA.y+c.pointB.y)/2,pointerId:m.pointerId,type:i.type};c.onMultiTouch(c.pointA,c.pointB,f,da,h,fa),h=fa,f=da}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,hb.a.POINTERDOWN|hb.a.POINTERUP|hb.a.POINTERMOVE),this._onLostFocus=function(){c.pointA=c.pointB=null,f=0,h=null,c.onLostFocus()},a.addEventListener("contextmenu",this.onContextMenu.bind(this),!1),xa.h.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}])},e.prototype.detachControl=function(a){this._onLostFocus&&xa.h.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),a&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu&&a.removeEventListener("contextmenu",this.onContextMenu),this._onLostFocus=null),this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},e.prototype.getClassName=function(){return"BaseCameraPointersInput"},e.prototype.getSimpleName=function(){return"pointers"},e.prototype.onDoubleTap=function(a){},e.prototype.onTouch=function(a,b,c){},e.prototype.onMultiTouch=function(a,b,c,d,f,h){},e.prototype.onContextMenu=function(a){a.preventDefault()},e.prototype.onButtonDown=function(a){},e.prototype.onButtonUp=function(a){},e.prototype.onLostFocus=function(){},v.c([Object(g.c)()],e.prototype,"buttons",void 0),e}(),pe=function(e){function a(){var b=null!==e&&e.apply(this,arguments)||this;return b.buttons=[0,1,2],b.angularSensibilityX=1000,b.angularSensibilityY=1000,b.pinchPrecision=12,b.pinchDeltaPercentage=0,b.panningSensibility=1000,b.multiTouchPanning=!0,b.multiTouchPanAndZoom=!0,b.pinchInwards=!0,b._isPanClick=!1,b._twoFingerActivityCount=0,b._isPinching=!1,b}return v.d(a,e),a.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},a.prototype.onTouch=function(b,c,d){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-c/this.panningSensibility,this.camera.inertialPanningY+=d/this.panningSensibility):(this.camera.inertialAlphaOffset-=c/this.angularSensibilityX,this.camera.inertialBetaOffset-=d/this.angularSensibilityY)},a.prototype.onDoubleTap=function(b){this.camera.useInputToRestoreState&&this.camera.restoreState()},a.prototype.onMultiTouch=function(b,c,d,f,h,i){if(!(0===d&&null===h||0===f&&null===i)){var k=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(f-d)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(f-d)/(this.pinchPrecision*k*(this.angularSensibilityX+this.angularSensibilityY)/2),0!==this.panningSensibility&&h&&i){var m=i.x-h.x,B=i.y-h.y;this.camera.inertialPanningX+=-m/this.panningSensibility,this.camera.inertialPanningY+=B/this.panningSensibility}}else{this._twoFingerActivityCount++;var E=Math.sqrt(d),K=Math.sqrt(f);this._isPinching||this._twoFingerActivityCount<20&&Math.abs(K-E)>this.camera.pinchToPanMaxDistance?(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(f-d)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(f-d)/(this.pinchPrecision*k*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0):0!==this.panningSensibility&&this.multiTouchPanning&&i&&h&&(m=i.x-h.x,B=i.y-h.y,this.camera.inertialPanningX+=-m/this.panningSensibility,this.camera.inertialPanningY+=B/this.panningSensibility)}}},a.prototype.onButtonDown=function(b){this._isPanClick=b.button===this.camera._panningMouseButton},a.prototype.onButtonUp=function(b){this._twoFingerActivityCount=0,this._isPinching=!1},a.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},v.c([Object(g.c)()],a.prototype,"buttons",void 0),v.c([Object(g.c)()],a.prototype,"angularSensibilityX",void 0),v.c([Object(g.c)()],a.prototype,"angularSensibilityY",void 0),v.c([Object(g.c)()],a.prototype,"pinchPrecision",void 0),v.c([Object(g.c)()],a.prototype,"pinchDeltaPercentage",void 0),v.c([Object(g.c)()],a.prototype,"panningSensibility",void 0),v.c([Object(g.c)()],a.prototype,"multiTouchPanning",void 0),v.c([Object(g.c)()],a.prototype,"multiTouchPanAndZoom",void 0),a}(eg);Db.ArcRotateCameraPointersInput=pe;var Ad=function(e){function a(b){return e.call(this,b)||this}return v.d(a,e),a.prototype.addMouseWheel=function(){return this.add(new oe()),this},a.prototype.addPointers=function(){return this.add(new pe()),this},a.prototype.addKeyboard=function(){return this.add(new ne()),this},a}(Yc);Ad.prototype.addVRDeviceOrientation=function(){return this.add(new qe()),this};var qe=function(){function e(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return e.prototype.attachControl=function(a,b){this.camera.attachControl(a,b),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype._onOrientationEvent=function(a){null!==a.alpha&&(this._alpha=(0|+a.alpha)*this.alphaCorrection),null!==a.gamma&&(this._gamma=(0|+a.gamma)*this.gammaCorrection),this._dirty=!0},e.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},e.prototype.detachControl=function(a){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"VRDeviceOrientation"},e}();Db.ArcRotateCameraVRDeviceOrientationInput=qe;var re=function(){function e(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array()}return e.prototype.attachControl=function(a,b){var c=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){c._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(d){var f,h=d.event;d.type===Ac.a.KEYDOWN?-1===c.keysForward.indexOf(h.keyCode)&&-1===c.keysBackward.indexOf(h.keyCode)&&-1===c.keysUp.indexOf(h.keyCode)&&-1===c.keysDown.indexOf(h.keyCode)&&-1===c.keysLeft.indexOf(h.keyCode)&&-1===c.keysRight.indexOf(h.keyCode)||(-1===(f=c._keys.indexOf(h.keyCode))&&c._keys.push(h.keyCode),b||h.preventDefault()):-1===c.keysForward.indexOf(h.keyCode)&&-1===c.keysBackward.indexOf(h.keyCode)&&-1===c.keysUp.indexOf(h.keyCode)&&-1===c.keysDown.indexOf(h.keyCode)&&-1===c.keysLeft.indexOf(h.keyCode)&&-1===c.keysRight.indexOf(h.keyCode)||((f=c._keys.indexOf(h.keyCode))>=0&&c._keys.splice(f,1),b||h.preventDefault())}))},e.prototype.detachControl=function(a){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},e.prototype._onLostFocus=function(a){this._keys=[]},e.prototype.getSimpleName=function(){return"keyboard"},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var a=this.camera,b=0;b<this._keys.length;b++){var c=this._keys[b],d=a._computeLocalCameraSpeed();-1!==this.keysForward.indexOf(c)?a._localDirection.copyFromFloats(0,0,d):-1!==this.keysBackward.indexOf(c)?a._localDirection.copyFromFloats(0,0,-d):-1!==this.keysUp.indexOf(c)?a._localDirection.copyFromFloats(0,d,0):-1!==this.keysDown.indexOf(c)?a._localDirection.copyFromFloats(0,-d,0):-1!==this.keysRight.indexOf(c)?a._localDirection.copyFromFloats(d,0,0):-1!==this.keysLeft.indexOf(c)&&a._localDirection.copyFromFloats(-d,0,0),a.getScene().useRightHandedSystem&&(a._localDirection.z*=-1),a.getViewMatrix().invertToRef(a._cameraTransformMatrix),j.x.TransformNormalToRef(a._localDirection,a._cameraTransformMatrix,a._transformedDirection),a.cameraDirection.addInPlace(a._transformedDirection)}},v.c([Object(g.c)()],e.prototype,"keysForward",void 0),v.c([Object(g.c)()],e.prototype,"keysBackward",void 0),v.c([Object(g.c)()],e.prototype,"keysUp",void 0),v.c([Object(g.c)()],e.prototype,"keysDown",void 0),v.c([Object(g.c)()],e.prototype,"keysRight",void 0),v.c([Object(g.c)()],e.prototype,"keysLeft",void 0),e}();Db.FlyCameraKeyboardInput=re;var se=function(){function e(a){void 0===a&&(a=!0),this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1000,this.previousPosition=null}return e.prototype.attachControl=function(a,b){var c=this;this.element=a,this.noPreventDefault=b,this._observer=this.camera.getScene().onPointerObservable.add(function(d,f){c._pointerInput(d,f)},hb.a.POINTERDOWN|hb.a.POINTERUP|hb.a.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add(function(){c.camera.rollCorrect&&c.camera.restoreRoll(c.camera.rollCorrect)}),this._mousemoveCallback=function(d){c._onMouseMove(d)},a.addEventListener("mousemove",this._mousemoveCallback,!1)},e.prototype.detachControl=function(a){this._observer&&a&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._mousemoveCallback&&a.removeEventListener("mousemove",this._mousemoveCallback),this._observer=null,this._rollObserver=null,this.previousPosition=null,this.noPreventDefault=void 0)},e.prototype.getClassName=function(){return"FlyCameraMouseInput"},e.prototype.getSimpleName=function(){return"mouse"},e.prototype._pointerInput=function(a,b){var c=a.event,d=this.camera.getEngine();if(!d.isInVRExclusivePointerMode&&(this.touchEnabled||"touch"!==c.pointerType)&&(a.type===hb.a.POINTERMOVE||-1!==this.buttons.indexOf(c.button))){var f=c.srcElement||c.target;if(a.type===hb.a.POINTERDOWN&&f){try{f.setPointerCapture(c.pointerId)}catch(k){}this.previousPosition={x:c.clientX,y:c.clientY},this.activeButton=c.button,this.noPreventDefault||(c.preventDefault(),this.element.focus())}else if(a.type===hb.a.POINTERUP&&f){try{f.releasePointerCapture(c.pointerId)}catch(k){}this.activeButton=-1,this.previousPosition=null,this.noPreventDefault||c.preventDefault()}else if(a.type===hb.a.POINTERMOVE){if(!this.previousPosition||d.isPointerLock)return;var h=c.clientX-this.previousPosition.x,i=c.clientY-this.previousPosition.y;this.rotateCamera(h,i),this.previousPosition={x:c.clientX,y:c.clientY},this.noPreventDefault||c.preventDefault()}}},e.prototype._onMouseMove=function(a){var b=this.camera.getEngine();if(b.isPointerLock&&!b.isInVRExclusivePointerMode){var c=a.movementX||a.mozMovementX||a.webkitMovementX||a.msMovementX||0,d=a.movementY||a.mozMovementY||a.webkitMovementY||a.msMovementY||0;this.rotateCamera(c,d),this.previousPosition=null,this.noPreventDefault||a.preventDefault()}},e.prototype.rotateCamera=function(a,b){var c=this,d=this.camera;this.camera.getScene().useRightHandedSystem&&(a*=-1),d.parent&&d.parent._getWorldMatrixDeterminant()<0&&(a*=-1);var f,h=a/this.angularSensibility,i=b/this.angularSensibility,k=j.q.RotationYawPitchRoll(d.rotation.y,d.rotation.x,d.rotation.z);if(this.buttonsPitch.some(function(E){return E===c.activeButton})&&(f=j.q.RotationAxis(j.c.X,i),k.multiplyInPlace(f)),this.buttonsYaw.some(function(E){return E===c.activeButton})){f=j.q.RotationAxis(j.c.Y,h),k.multiplyInPlace(f);var m=d.bankedTurnLimit+d._trackRoll;if(d.bankedTurn&&-m<d.rotation.z&&d.rotation.z<m){var B=d.bankedTurnMultiplier*-h;f=j.q.RotationAxis(j.c.Z,B),k.multiplyInPlace(f)}}this.buttonsRoll.some(function(E){return E===c.activeButton})&&(f=j.q.RotationAxis(j.c.Z,-h),d._trackRoll-=h,k.multiplyInPlace(f)),k.toEulerAnglesToRef(d.rotation)},v.c([Object(g.c)()],e.prototype,"buttons",void 0),v.c([Object(g.c)()],e.prototype,"angularSensibility",void 0),e}();Db.FlyCameraMouseInput=se;var te=function(){function e(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array()}return e.prototype.attachControl=function(a,b){var c=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){c._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(d){var f,h=d.event;h.metaKey||(d.type===Ac.a.KEYDOWN?(c._ctrlPressed=h.ctrlKey,c._altPressed=h.altKey,c._shiftPressed=h.shiftKey,(-1!==c.keysHeightOffsetIncr.indexOf(h.keyCode)||-1!==c.keysHeightOffsetDecr.indexOf(h.keyCode)||-1!==c.keysRotationOffsetIncr.indexOf(h.keyCode)||-1!==c.keysRotationOffsetDecr.indexOf(h.keyCode)||-1!==c.keysRadiusIncr.indexOf(h.keyCode)||-1!==c.keysRadiusDecr.indexOf(h.keyCode))&&(-1===(f=c._keys.indexOf(h.keyCode))&&c._keys.push(h.keyCode),h.preventDefault&&(b||h.preventDefault()))):-1===c.keysHeightOffsetIncr.indexOf(h.keyCode)&&-1===c.keysHeightOffsetDecr.indexOf(h.keyCode)&&-1===c.keysRotationOffsetIncr.indexOf(h.keyCode)&&-1===c.keysRotationOffsetDecr.indexOf(h.keyCode)&&-1===c.keysRadiusIncr.indexOf(h.keyCode)&&-1===c.keysRadiusDecr.indexOf(h.keyCode)||((f=c._keys.indexOf(h.keyCode))>=0&&c._keys.splice(f,1),h.preventDefault&&(b||h.preventDefault())))}))},e.prototype.detachControl=function(a){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){var a=this;this._onKeyboardObserver&&this._keys.forEach(function(b){-1!==a.keysHeightOffsetIncr.indexOf(b)&&a._modifierHeightOffset()?a.camera.heightOffset+=a.heightSensibility:-1!==a.keysHeightOffsetDecr.indexOf(b)&&a._modifierHeightOffset()?a.camera.heightOffset-=a.heightSensibility:-1!==a.keysRotationOffsetIncr.indexOf(b)&&a._modifierRotationOffset()?(a.camera.rotationOffset+=a.rotationSensibility,a.camera.rotationOffset%=360):-1!==a.keysRotationOffsetDecr.indexOf(b)&&a._modifierRotationOffset()?(a.camera.rotationOffset-=a.rotationSensibility,a.camera.rotationOffset%=360):-1!==a.keysRadiusIncr.indexOf(b)&&a._modifierRadius()?a.camera.radius+=a.radiusSensibility:-1!==a.keysRadiusDecr.indexOf(b)&&a._modifierRadius()&&(a.camera.radius-=a.radiusSensibility)})},e.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},e.prototype.getSimpleName=function(){return"keyboard"},e.prototype._modifierHeightOffset=function(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed},e.prototype._modifierRotationOffset=function(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed},e.prototype._modifierRadius=function(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed},v.c([Object(g.c)()],e.prototype,"keysHeightOffsetIncr",void 0),v.c([Object(g.c)()],e.prototype,"keysHeightOffsetDecr",void 0),v.c([Object(g.c)()],e.prototype,"keysHeightOffsetModifierAlt",void 0),v.c([Object(g.c)()],e.prototype,"keysHeightOffsetModifierCtrl",void 0),v.c([Object(g.c)()],e.prototype,"keysHeightOffsetModifierShift",void 0),v.c([Object(g.c)()],e.prototype,"keysRotationOffsetIncr",void 0),v.c([Object(g.c)()],e.prototype,"keysRotationOffsetDecr",void 0),v.c([Object(g.c)()],e.prototype,"keysRotationOffsetModifierAlt",void 0),v.c([Object(g.c)()],e.prototype,"keysRotationOffsetModifierCtrl",void 0),v.c([Object(g.c)()],e.prototype,"keysRotationOffsetModifierShift",void 0),v.c([Object(g.c)()],e.prototype,"keysRadiusIncr",void 0),v.c([Object(g.c)()],e.prototype,"keysRadiusDecr",void 0),v.c([Object(g.c)()],e.prototype,"keysRadiusModifierAlt",void 0),v.c([Object(g.c)()],e.prototype,"keysRadiusModifierCtrl",void 0),v.c([Object(g.c)()],e.prototype,"keysRadiusModifierShift",void 0),v.c([Object(g.c)()],e.prototype,"heightSensibility",void 0),v.c([Object(g.c)()],e.prototype,"rotationSensibility",void 0),v.c([Object(g.c)()],e.prototype,"radiusSensibility",void 0),e}();Db.FollowCameraKeyboardMoveInput=te;var ue=function(){function e(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}return e.prototype.attachControl=function(a,b){var c=this;this._wheel=function(d,f){if(d.type===hb.a.POINTERWHEEL){var h=d.event,i=0,k=Math.max(-1,Math.min(1,h.deltaY||h.wheelDelta||-h.detail));c.wheelDeltaPercentage?(console.assert(c.axisControlRadius+c.axisControlHeight+c.axisControlRotation<=1,"wheelDeltaPercentage only usable when mouse wheel controlls ONE axis. Currently enabled: axisControlRadius: "+c.axisControlRadius+", axisControlHeightOffset: "+c.axisControlHeight+", axisControlRotationOffset: "+c.axisControlRotation),c.axisControlRadius?i=.01*k*c.wheelDeltaPercentage*c.camera.radius:c.axisControlHeight?i=.01*k*c.wheelDeltaPercentage*c.camera.heightOffset:c.axisControlRotation&&(i=.01*k*c.wheelDeltaPercentage*c.camera.rotationOffset)):i=k*c.wheelPrecision,i&&(c.axisControlRadius?c.camera.radius+=i:c.axisControlHeight?c.camera.heightOffset-=i:c.axisControlRotation&&(c.camera.rotationOffset-=i)),h.preventDefault&&(b||h.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,hb.a.POINTERWHEEL)},e.prototype.detachControl=function(a){this._observer&&a&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},e.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},e.prototype.getSimpleName=function(){return"mousewheel"},v.c([Object(g.c)()],e.prototype,"axisControlRadius",void 0),v.c([Object(g.c)()],e.prototype,"axisControlHeight",void 0),v.c([Object(g.c)()],e.prototype,"axisControlRotation",void 0),v.c([Object(g.c)()],e.prototype,"wheelPrecision",void 0),v.c([Object(g.c)()],e.prototype,"wheelDeltaPercentage",void 0),e}();Db.FollowCameraMouseWheelInput=ue;var ve=function(e){function a(){var b=null!==e&&e.apply(this,arguments)||this;return b.angularSensibilityX=1,b.angularSensibilityY=1,b.pinchPrecision=10000,b.pinchDeltaPercentage=0,b.axisXControlRadius=!1,b.axisXControlHeight=!1,b.axisXControlRotation=!0,b.axisYControlRadius=!1,b.axisYControlHeight=!0,b.axisYControlRotation=!1,b.axisPinchControlRadius=!0,b.axisPinchControlHeight=!1,b.axisPinchControlRotation=!1,b.warningEnable=!0,b._warningCounter=0,b}return v.d(a,e),a.prototype.getClassName=function(){return"FollowCameraPointersInput"},a.prototype.onTouch=function(b,c,d){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=c/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=d/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=c/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=d/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=c/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=d/this.angularSensibilityY)},a.prototype.onMultiTouch=function(b,c,d,f,h,i){if(!(0===d&&null===h||0===f&&null===i)){var k=(f-d)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(k*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=k*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=k*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=k*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=k),this.axisPinchControlHeight&&(this.camera.heightOffset+=k),this.axisPinchControlRadius&&(this.camera.radius-=k))}},a.prototype._warning=function(){if(this.warningEnable&&this._warningCounter++%100==0){var b="It probably only makes sense to control ONE camera property with each pointer axis. Set 'warningEnable = false' if you are sure. Currently enabled: ";console.assert(this.axisXControlRotation+this.axisXControlHeight+this.axisXControlRadius<=1,b+"axisXControlRotation: "+this.axisXControlRotation+", axisXControlHeight: "+this.axisXControlHeight+", axisXControlRadius: "+this.axisXControlRadius),console.assert(this.axisYControlRotation+this.axisYControlHeight+this.axisYControlRadius<=1,b+"axisYControlRotation: "+this.axisYControlRotation+", axisYControlHeight: "+this.axisYControlHeight+", axisYControlRadius: "+this.axisYControlRadius),console.assert(this.axisPinchControlRotation+this.axisPinchControlHeight+this.axisPinchControlRadius<=1,b+"axisPinchControlRotation: "+this.axisPinchControlRotation+", axisPinchControlHeight: "+this.axisPinchControlHeight+", axisPinchControlRadius: "+this.axisPinchControlRadius)}},v.c([Object(g.c)()],a.prototype,"angularSensibilityX",void 0),v.c([Object(g.c)()],a.prototype,"angularSensibilityY",void 0),v.c([Object(g.c)()],a.prototype,"pinchPrecision",void 0),v.c([Object(g.c)()],a.prototype,"pinchDeltaPercentage",void 0),v.c([Object(g.c)()],a.prototype,"axisXControlRadius",void 0),v.c([Object(g.c)()],a.prototype,"axisXControlHeight",void 0),v.c([Object(g.c)()],a.prototype,"axisXControlRotation",void 0),v.c([Object(g.c)()],a.prototype,"axisYControlRadius",void 0),v.c([Object(g.c)()],a.prototype,"axisYControlHeight",void 0),v.c([Object(g.c)()],a.prototype,"axisYControlRotation",void 0),v.c([Object(g.c)()],a.prototype,"axisPinchControlRadius",void 0),v.c([Object(g.c)()],a.prototype,"axisPinchControlHeight",void 0),v.c([Object(g.c)()],a.prototype,"axisPinchControlRotation",void 0),a}(eg);Db.FollowCameraPointersInput=ve;var we=function(){function e(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array()}return e.prototype.attachControl=function(a,b){var c=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){c._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(d){var f,h=d.event;h.metaKey||(d.type===Ac.a.KEYDOWN?-1===c.keysUp.indexOf(h.keyCode)&&-1===c.keysDown.indexOf(h.keyCode)&&-1===c.keysLeft.indexOf(h.keyCode)&&-1===c.keysRight.indexOf(h.keyCode)||(-1===(f=c._keys.indexOf(h.keyCode))&&c._keys.push(h.keyCode),b||h.preventDefault()):-1===c.keysUp.indexOf(h.keyCode)&&-1===c.keysDown.indexOf(h.keyCode)&&-1===c.keysLeft.indexOf(h.keyCode)&&-1===c.keysRight.indexOf(h.keyCode)||((f=c._keys.indexOf(h.keyCode))>=0&&c._keys.splice(f,1),b||h.preventDefault()))}))},e.prototype.detachControl=function(a){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var a=this.camera,b=0;b<this._keys.length;b++){var c=this._keys[b],d=a._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(c)?a._localDirection.copyFromFloats(-d,0,0):-1!==this.keysUp.indexOf(c)?a._localDirection.copyFromFloats(0,0,d):-1!==this.keysRight.indexOf(c)?a._localDirection.copyFromFloats(d,0,0):-1!==this.keysDown.indexOf(c)&&a._localDirection.copyFromFloats(0,0,-d),a.getScene().useRightHandedSystem&&(a._localDirection.z*=-1),a.getViewMatrix().invertToRef(a._cameraTransformMatrix),j.x.TransformNormalToRef(a._localDirection,a._cameraTransformMatrix,a._transformedDirection),a.cameraDirection.addInPlace(a._transformedDirection)}},e.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},e.prototype._onLostFocus=function(){this._keys=[]},e.prototype.getSimpleName=function(){return"keyboard"},v.c([Object(g.c)()],e.prototype,"keysUp",void 0),v.c([Object(g.c)()],e.prototype,"keysDown",void 0),v.c([Object(g.c)()],e.prototype,"keysLeft",void 0),v.c([Object(g.c)()],e.prototype,"keysRight",void 0),e}();Db.FreeCameraKeyboardMoveInput=we;var xe=function(){function e(a){void 0===a&&(a=!0),this.touchEnabled=a,this.buttons=[0,1,2],this.angularSensibility=2000,this.previousPosition=null,this.onPointerMovedObservable=new q.c(),this._allowCameraRotation=!0}return e.prototype.attachControl=function(a,b){var c=this,d=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(f){var h=f.event;if(!d.isInVRExclusivePointerMode&&(c.touchEnabled||"touch"!==h.pointerType)&&(f.type===hb.a.POINTERMOVE||-1!==c.buttons.indexOf(h.button))){var i=h.srcElement||h.target;if(f.type===hb.a.POINTERDOWN&&i){try{i.setPointerCapture(h.pointerId)}catch(B){}c.previousPosition={x:h.clientX,y:h.clientY},b||(h.preventDefault(),a.focus())}else if(f.type===hb.a.POINTERUP&&i){try{i.releasePointerCapture(h.pointerId)}catch(B){}c.previousPosition=null,b||h.preventDefault()}else if(f.type===hb.a.POINTERMOVE){if(!c.previousPosition||d.isPointerLock)return;var k=h.clientX-c.previousPosition.x,m=h.clientY-c.previousPosition.y;c.camera.getScene().useRightHandedSystem&&(k*=-1),c.camera.parent&&c.camera.parent._getWorldMatrixDeterminant()<0&&(k*=-1),c._allowCameraRotation&&(c.camera.cameraRotation.y+=k/c.angularSensibility,c.camera.cameraRotation.x+=m/c.angularSensibility),c.onPointerMovedObservable.notifyObservers({offsetX:k,offsetY:m}),c.previousPosition={x:h.clientX,y:h.clientY},b||h.preventDefault()}}}),this._onMouseMove=function(f){if(d.isPointerLock&&!d.isInVRExclusivePointerMode){var h=f.movementX||f.mozMovementX||f.webkitMovementX||f.msMovementX||0;c.camera.getScene().useRightHandedSystem&&(h*=-1),c.camera.parent&&c.camera.parent._getWorldMatrixDeterminant()<0&&(h*=-1),c.camera.cameraRotation.y+=h/c.angularSensibility;var i=f.movementY||f.mozMovementY||f.webkitMovementY||f.msMovementY||0;c.camera.cameraRotation.x+=i/c.angularSensibility,c.previousPosition=null,b||f.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,hb.a.POINTERDOWN|hb.a.POINTERUP|hb.a.POINTERMOVE),a.addEventListener("mousemove",this._onMouseMove,!1),a.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)},e.prototype.onContextMenu=function(a){a.preventDefault()},e.prototype.detachControl=function(a){this._observer&&a&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&a.removeEventListener("mousemove",this._onMouseMove),this.onContextMenu&&a.removeEventListener("contextmenu",this.onContextMenu),this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},e.prototype.getClassName=function(){return"FreeCameraMouseInput"},e.prototype.getSimpleName=function(){return"mouse"},v.c([Object(g.c)()],e.prototype,"buttons",void 0),v.c([Object(g.c)()],e.prototype,"angularSensibility",void 0),e}();Db.FreeCameraMouseInput=xe;var ye=function(){function e(){this.touchAngularSensibility=200000,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array()}return e.prototype.attachControl=function(a,b){var c=this,d=null;void 0===this._pointerInput&&(this._onLostFocus=function(){c._offsetX=null,c._offsetY=null},this._pointerInput=function(f){var h=f.event;if("mouse"!==h.pointerType){if(f.type===hb.a.POINTERDOWN){if(b||h.preventDefault(),c._pointerPressed.push(h.pointerId),1!==c._pointerPressed.length)return;d={x:h.clientX,y:h.clientY}}else if(f.type===hb.a.POINTERUP){if(b||h.preventDefault(),-1===(i=c._pointerPressed.indexOf(h.pointerId)))return;if(c._pointerPressed.splice(i,1),0!=i)return;d=null,c._offsetX=null,c._offsetY=null}else if(f.type===hb.a.POINTERMOVE){if(b||h.preventDefault(),!d)return;var i;if(0!=(i=c._pointerPressed.indexOf(h.pointerId)))return;c._offsetX=h.clientX-d.x,c._offsetY=-(h.clientY-d.y)}}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,hb.a.POINTERDOWN|hb.a.POINTERUP|hb.a.POINTERMOVE),this._onLostFocus&&a.addEventListener("blur",this._onLostFocus)},e.prototype.detachControl=function(a){this._pointerInput&&a&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(a.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},e.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var a=this.camera;if(a.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)a.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var b=a._computeLocalCameraSpeed(),c=new j.x(0,0,b*this._offsetY/this.touchMoveSensibility);j.j.RotationYawPitchRollToRef(a.rotation.y,a.rotation.x,0,a._cameraRotationMatrix),a.cameraDirection.addInPlace(j.x.TransformCoordinates(c,a._cameraRotationMatrix))}}},e.prototype.getClassName=function(){return"FreeCameraTouchInput"},e.prototype.getSimpleName=function(){return"touch"},v.c([Object(g.c)()],e.prototype,"touchAngularSensibility",void 0),v.c([Object(g.c)()],e.prototype,"touchMoveSensibility",void 0),e}();Db.FreeCameraTouchInput=ye;var Zc=function(e){function a(b){var c=e.call(this,b)||this;return c._mouseInput=null,c}return v.d(a,e),a.prototype.addKeyboard=function(){return this.add(new we()),this},a.prototype.addMouse=function(b){return void 0===b&&(b=!0),this._mouseInput||(this._mouseInput=new xe(b),this.add(this._mouseInput)),this},a.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},a.prototype.addTouch=function(){return this.add(new ye()),this},a.prototype.clear=function(){e.prototype.clear.call(this),this._mouseInput=null},a}(Yc);Zc.prototype.addDeviceOrientation=function(){return this._deviceOrientationInput||(this._deviceOrientationInput=new ze(),this.add(this._deviceOrientationInput)),this};var ze=function(){function e(){var a=this;this._screenOrientationAngle=0,this._screenQuaternion=new j.q(),this._alpha=0,this._beta=0,this._gamma=0,this._onDeviceOrientationChangedObservable=new q.c(),this._orientationChanged=function(){a._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,a._screenOrientationAngle=-xa.h.ToRadians(a._screenOrientationAngle/2),a._screenQuaternion.copyFromFloats(0,Math.sin(a._screenOrientationAngle),0,Math.cos(a._screenOrientationAngle))},this._deviceOrientation=function(b){a._alpha=null!==b.alpha?b.alpha:0,a._beta=null!==b.beta?b.beta:0,a._gamma=null!==b.gamma?b.gamma:0,null!==b.alpha&&a._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new j.q(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},set:function(a){var b=this;this._camera=a,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new j.q()),this._camera&&this._camera.onDisposeObservable.add(function(){b._onDeviceOrientationChangedObservable.clear()})},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(a,b){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()},e.prototype.detachControl=function(a){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0},e.prototype.checkInputs=function(){this._alpha&&(j.q.RotationYawPitchRollToRef(xa.h.ToRadians(this._alpha),xa.h.ToRadians(this._beta),-xa.h.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},e.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"deviceOrientation"},e}();Db.FreeCameraDeviceOrientationInput=ze;var Ae=function(){function e(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._cameraTransform=j.j.Identity(),this._deltaTransform=j.x.Zero(),this._vector3=j.x.Zero(),this._vector2=j.w.Zero()}return e.prototype.attachControl=function(a,b){var c=this,d=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=d.onGamepadConnectedObservable.add(function(f){f.type!==Hb.POSE_ENABLED&&(c.gamepad&&f.type!==Hb.XBOX||(c.gamepad=f))}),this._onGamepadDisconnectedObserver=d.onGamepadDisconnectedObservable.add(function(f){c.gamepad===f&&(c.gamepad=null)}),this.gamepad=d.getGamepadByType(Hb.XBOX)},e.prototype.detachControl=function(a){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},e.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var a=this.camera,b=this.gamepad.leftStick,c=b.x/this.gamepadMoveSensibility,d=b.y/this.gamepadMoveSensibility;b.x=Math.abs(c)>.005?0+c:0,b.y=Math.abs(d)>.005?0+d:0;var f=this.gamepad.rightStick;if(f){var h=f.x/this.gamepadAngularSensibility,i=f.y/this.gamepadAngularSensibility;f.x=Math.abs(h)>.001?0+h:0,f.y=Math.abs(i)>.001?0+i:0}else f={x:0,y:0};a.rotationQuaternion?a.rotationQuaternion.toRotationMatrix(this._cameraTransform):j.j.RotationYawPitchRollToRef(a.rotation.y,a.rotation.x,0,this._cameraTransform);var k=50*a._computeLocalCameraSpeed();this._vector3.copyFromFloats(b.x*k,0,-b.y*k),j.x.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),a.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(f.y,f.x),a.cameraRotation.addInPlace(this._vector2)}},e.prototype.getClassName=function(){return"FreeCameraGamepadInput"},e.prototype.getSimpleName=function(){return"gamepad"},v.c([Object(g.c)()],e.prototype,"gamepadAngularSensibility",void 0),v.c([Object(g.c)()],e.prototype,"gamepadMoveSensibility",void 0),e}();Db.FreeCameraGamepadInput=Ae;var wb,fg=l(61);!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(wb||(wb={}));var Be=function(){function e(a){var b=this;if(this._leftJoystick=!!a,e._globalJoystickIndex++,this._axisTargetedByLeftAndRight=wb.X,this._axisTargetedByUpAndDown=wb.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new fg.a(),this.deltaPosition=j.x.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1000),this._onResize=function(d){e.vjCanvasWidth=window.innerWidth,e.vjCanvasHeight=window.innerHeight,e.Canvas&&(e.Canvas.width=e.vjCanvasWidth,e.Canvas.height=e.vjCanvasHeight),e.halfWidth=e.vjCanvasWidth/2},!e.Canvas){window.addEventListener("resize",this._onResize,!1),e.Canvas=document.createElement("canvas"),e.vjCanvasWidth=window.innerWidth,e.vjCanvasHeight=window.innerHeight,e.Canvas.width=window.innerWidth,e.Canvas.height=window.innerHeight,e.Canvas.style.width="100%",e.Canvas.style.height="100%",e.Canvas.style.position="absolute",e.Canvas.style.backgroundColor="transparent",e.Canvas.style.top="0px",e.Canvas.style.left="0px",e.Canvas.style.zIndex="5",e.Canvas.style.msTouchAction="none",e.Canvas.setAttribute("touch-action","none");var c=e.Canvas.getContext("2d");if(!c)throw new Error("Unable to create canvas for virtual joystick");e.vjCanvasContext=c,e.vjCanvasContext.strokeStyle="#ffffff",e.vjCanvasContext.lineWidth=2,document.body.appendChild(e.Canvas)}e.halfWidth=e.Canvas.width/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new j.w(0,0),this._joystickPreviousPointerPos=new j.w(0,0),this._joystickPointerStartPos=new j.w(0,0),this._deltaJoystickVector=new j.w(0,0),this._onPointerDownHandlerRef=function(d){b._onPointerDown(d)},this._onPointerMoveHandlerRef=function(d){b._onPointerMove(d)},this._onPointerUpHandlerRef=function(d){b._onPointerUp(d)},e.Canvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),e.Canvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),e.Canvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),e.Canvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),e.Canvas.addEventListener("contextmenu",function(d){d.preventDefault()},!1),requestAnimationFrame(function(){b._drawVirtualJoystick()})}return e.prototype.setJoystickSensibility=function(a){this._joystickSensibility=a,this._inversedSensibility=1/(this._joystickSensibility/1000)},e.prototype._onPointerDown=function(a){a.preventDefault(),(!0===this._leftJoystick?a.clientX<e.halfWidth:a.clientX>e.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=a.pointerId,this._joystickPointerStartPos.x=a.clientX,this._joystickPointerStartPos.y=a.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(a.pointerId.toString(),a)):e._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(a.pointerId.toString(),{x:a.clientX,y:a.clientY,prevX:a.clientX,prevY:a.clientY}))},e.prototype._onPointerMove=function(a){if(this._joystickPointerID==a.pointerId){this._joystickPointerPos.x=a.clientX,this._joystickPointerPos.y=a.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var b=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case wb.X:this.deltaPosition.x=Math.min(1,Math.max(-1,b));break;case wb.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,b));break;case wb.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,b))}var c=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case wb.X:this.deltaPosition.x=Math.min(1,Math.max(-1,c));break;case wb.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,c));break;case wb.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,c))}}else{var d=this._touches.get(a.pointerId.toString());d&&(d.x=a.clientX,d.y=a.clientY)}},e.prototype._onPointerUp=function(a){if(this._joystickPointerID==a.pointerId)e.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-64,this._joystickPointerStartPos.y-64,128,128),e.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-42,this._joystickPreviousPointerPos.y-42,84,84),this._joystickPointerID=-1,this.pressed=!1;else{var b=this._touches.get(a.pointerId.toString());b&&e.vjCanvasContext.clearRect(b.prevX-44,b.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(a.pointerId.toString())},e.prototype.setJoystickColor=function(a){this._joystickColor=a},e.prototype.setActionOnTouch=function(a){this._action=a},e.prototype.setAxisForLeftRight=function(a){switch(a){case wb.X:case wb.Y:case wb.Z:this._axisTargetedByLeftAndRight=a;break;default:this._axisTargetedByLeftAndRight=wb.X}},e.prototype.setAxisForUpDown=function(a){switch(a){case wb.X:case wb.Y:case wb.Z:this._axisTargetedByUpAndDown=a;break;default:this._axisTargetedByUpAndDown=wb.Y}},e.prototype._drawVirtualJoystick=function(){var a=this;this.pressed&&this._touches.forEach(function(b,c){c.pointerId===a._joystickPointerID?(e.vjCanvasContext.clearRect(a._joystickPointerStartPos.x-64,a._joystickPointerStartPos.y-64,128,128),e.vjCanvasContext.clearRect(a._joystickPreviousPointerPos.x-42,a._joystickPreviousPointerPos.y-42,84,84),e.vjCanvasContext.beginPath(),e.vjCanvasContext.lineWidth=6,e.vjCanvasContext.strokeStyle=a._joystickColor,e.vjCanvasContext.arc(a._joystickPointerStartPos.x,a._joystickPointerStartPos.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle=a._joystickColor,e.vjCanvasContext.lineWidth=2,e.vjCanvasContext.arc(a._joystickPointerStartPos.x,a._joystickPointerStartPos.y,60,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle=a._joystickColor,e.vjCanvasContext.arc(a._joystickPointerPos.x,a._joystickPointerPos.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),a._joystickPreviousPointerPos=a._joystickPointerPos.clone()):(e.vjCanvasContext.clearRect(c.prevX-44,c.prevY-44,88,88),e.vjCanvasContext.beginPath(),e.vjCanvasContext.fillStyle="white",e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle="red",e.vjCanvasContext.lineWidth=6,e.vjCanvasContext.arc(c.x,c.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),c.prevX=c.x,c.prevY=c.y)}),requestAnimationFrame(function(){a._drawVirtualJoystick()})},e.prototype.releaseCanvas=function(){e.Canvas&&(e.Canvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),e.Canvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),e.Canvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),e.Canvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(e.Canvas),e.Canvas=null)},e._globalJoystickIndex=0,e}();Zc.prototype.addVirtualJoystick=function(){return this.add(new Ce()),this};var Ce=function(){function e(){}return e.prototype.getLeftJoystick=function(){return this._leftjoystick},e.prototype.getRightJoystick=function(){return this._rightjoystick},e.prototype.checkInputs=function(){if(this._leftjoystick){var a=this.camera,b=50*a._computeLocalCameraSpeed(),c=j.j.RotationYawPitchRoll(a.rotation.y,a.rotation.x,0),d=j.x.TransformCoordinates(new j.x(this._leftjoystick.deltaPosition.x*b,this._leftjoystick.deltaPosition.y*b,this._leftjoystick.deltaPosition.z*b),c);a.cameraDirection=a.cameraDirection.add(d),a.cameraRotation=a.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},e.prototype.attachControl=function(a,b){this._leftjoystick=new Be(!0),this._leftjoystick.setAxisForUpDown(wb.Z),this._leftjoystick.setAxisForLeftRight(wb.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new Be(!1),this._rightjoystick.setAxisForUpDown(wb.X),this._rightjoystick.setAxisForLeftRight(wb.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},e.prototype.detachControl=function(a){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},e.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},e.prototype.getSimpleName=function(){return"virtualJoystick"},e}();Db.FreeCameraVirtualJoystickInput=Ce;var qc=function(e){function a(b,c,d,f){void 0===f&&(f=!0);var h=e.call(this,b,c,d,f)||this;return h.cameraDirection=new j.x(0,0,0),h.cameraRotation=new j.w(0,0),h.updateUpVectorFromRotation=!1,h._tmpQuaternion=new j.q(),h.rotation=new j.x(0,0,0),h.speed=2,h.noRotationConstraint=!1,h.lockedTarget=null,h._currentTarget=j.x.Zero(),h._initialFocalDistance=1,h._viewMatrix=j.j.Zero(),h._camMatrix=j.j.Zero(),h._cameraTransformMatrix=j.j.Zero(),h._cameraRotationMatrix=j.j.Zero(),h._referencePoint=new j.x(0,0,1),h._transformedReferencePoint=j.x.Zero(),h._globalCurrentTarget=j.x.Zero(),h._globalCurrentUpVector=j.x.Zero(),h._defaultUp=j.x.Up(),h._cachedRotationZ=0,h._cachedQuaternionRotationZ=0,h}return v.d(a,e),a.prototype.getFrontPosition=function(b){this.getWorldMatrix();var c=this.getTarget().subtract(this.position);return c.normalize(),c.scaleInPlace(b),this.globalPosition.add(c)},a.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},a.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),e.prototype.storeState.call(this)},a.prototype._restoreStateValues=function(){return!!e.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},a.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.lockedTarget=new j.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new j.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new j.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a.prototype._updateCache=function(b){b||e.prototype._updateCache.call(this);var c=this._getLockedTargetPosition();c?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(c):this._cache.lockedTarget=c.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},a.prototype._isSynchronizedViewMatrix=function(){if(!e.prototype._isSynchronizedViewMatrix.call(this))return!1;var b=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(b):!b)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},a.prototype._computeLocalCameraSpeed=function(){var b=this.getEngine();return this.speed*Math.sqrt(b.getDeltaTime()/(100*b.getFps()))},a.prototype.setTarget=function(b){this.upVector.normalize(),this._initialFocalDistance=b.subtract(this.position).length(),this.position.z===b.z&&(this.position.z+=j.h),j.j.LookAtLHToRef(this.position,b,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var c=b.subtract(this.position);c.x>=0?this.rotation.y=-Math.atan(c.z/c.x)+Math.PI/2:this.rotation.y=-Math.atan(c.z/c.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&j.q.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},a.prototype.getTarget=function(){return this._currentTarget},a.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},a.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(j.t.Matrix[0]),j.x.TransformNormalToRef(this.cameraDirection,j.t.Matrix[0],j.t.Vector3[0]),void this.position.addInPlace(j.t.Vector3[0]);this.position.addInPlace(this.cameraDirection)},a.prototype._checkInputs=function(){var b=this._decideIfNeedsToMove(),c=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(b&&this._updatePosition(),c){(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion)&&(this.rotation.lengthSquared()&&j.q.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion));if(!this.noRotationConstraint){var d=Math.PI/2*.95;this.rotation.x>d&&(this.rotation.x=d),this.rotation.x<-d&&(this.rotation.x=-d)}}b&&(Math.abs(this.cameraDirection.x)<this.speed*j.h&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*j.h&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*j.h&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),c&&(Math.abs(this.cameraRotation.x)<this.speed*j.h&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*j.h&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),e.prototype._checkInputs.call(this)},a.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):j.j.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},a.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return j.x.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},a.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),j.x.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?j.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(j.q.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),j.c.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},a.prototype._computeViewMatrix=function(b,c,d){if(this.parent){var f=this.parent.getWorldMatrix();j.x.TransformCoordinatesToRef(b,f,this._globalPosition),j.x.TransformCoordinatesToRef(c,f,this._globalCurrentTarget),j.x.TransformNormalToRef(d,f,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(b),this._globalCurrentTarget.copyFrom(c),this._globalCurrentUpVector.copyFrom(d);this.getScene().useRightHandedSystem?j.j.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):j.j.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},a.prototype.createRigCamera=function(b,c){if(this.cameraRigMode!==ab.a.RIG_MODE_NONE){var d=new a(b,this.position.clone(),this.getScene());return this.cameraRigMode!==ab.a.RIG_MODE_VR&&this.cameraRigMode!==ab.a.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new j.q()),d._cameraRigParams={},d.rotationQuaternion=new j.q()),d}return null},a.prototype._updateRigCameras=function(){var b=this._rigCameras[0],c=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case ab.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case ab.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:var d=this.cameraRigMode===ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,f=this.cameraRigMode===ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*d,b),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*f,c);break;case ab.a.RIG_MODE_VR:b.rotationQuaternion?(b.rotationQuaternion.copyFrom(this.rotationQuaternion),c.rotationQuaternion.copyFrom(this.rotationQuaternion)):(b.rotation.copyFrom(this.rotation),c.rotation.copyFrom(this.rotation)),b.position.copyFrom(this.position),c.position.copyFrom(this.position)}e.prototype._updateRigCameras.call(this)},a.prototype._getRigCamPositionAndTarget=function(b,c){this.getTarget().subtractToRef(this.position,a._TargetFocalPoint),a._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var d=a._TargetFocalPoint.addInPlace(this.position);j.j.TranslationToRef(-d.x,-d.y,-d.z,a._TargetTransformMatrix),a._TargetTransformMatrix.multiplyToRef(j.j.RotationY(b),a._RigCamTransformMatrix),j.j.TranslationToRef(d.x,d.y,d.z,a._TargetTransformMatrix),a._RigCamTransformMatrix.multiplyToRef(a._TargetTransformMatrix,a._RigCamTransformMatrix),j.x.TransformCoordinatesToRef(this.position,a._RigCamTransformMatrix,c.position),c.setTarget(d)},a.prototype.getClassName=function(){return"TargetCamera"},a._RigCamTransformMatrix=new j.j(),a._TargetTransformMatrix=new j.j(),a._TargetFocalPoint=new j.x(),v.c([Object(g.o)()],a.prototype,"rotation",void 0),v.c([Object(g.c)()],a.prototype,"speed",void 0),v.c([Object(g.k)("lockedTargetId")],a.prototype,"lockedTarget",void 0),a}(ab.a),Wb=function(e){function a(b,c,d,f){void 0===f&&(f=!0);var h=e.call(this,b,c,d,f)||this;return h.ellipsoid=new j.x(.5,1,.5),h.ellipsoidOffset=new j.x(0,0,0),h.checkCollisions=!1,h.applyGravity=!1,h._needMoveForGravity=!1,h._oldPosition=j.x.Zero(),h._diffPosition=j.x.Zero(),h._newPosition=j.x.Zero(),h._collisionMask=-1,h._onCollisionPositionChange=function(i,k,m){void 0===m&&(m=null);var B;B=k,h._newPosition.copyFrom(B),h._newPosition.subtractToRef(h._oldPosition,h._diffPosition),h._diffPosition.length()>va.b.CollisionsEpsilon&&(h.position.addInPlace(h._diffPosition),h.onCollide&&m&&h.onCollide(m))},h.inputs=new Zc(h),h.inputs.addKeyboard().addMouse(),h}return v.d(a,e),Object.defineProperty(a.prototype,"angularSensibility",{get:function(){var b=this.inputs.attached.mouse;return b?b.angularSensibility:0},set:function(b){var c=this.inputs.attached.mouse;c&&(c.angularSensibility=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysUp",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysUp:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysUp=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysDown",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysDown:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysDown=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysLeft",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysLeft:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysLeft=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysRight",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysRight:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysRight=b)},enumerable:!0,configurable:!0}),a.prototype.attachControl=function(b,c){this.inputs.attachElement(b,c)},a.prototype.detachControl=function(b){this.inputs.detachElement(b),this.cameraDirection=new j.x(0,0,0),this.cameraRotation=new j.w(0,0)},Object.defineProperty(a.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(b){this._collisionMask=isNaN(b)?-1:b},enumerable:!0,configurable:!0}),a.prototype._collideWithWorld=function(b){(this.parent?j.x.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var c=this.getScene().collisionCoordinator;this._collider||(this._collider=c.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var d=b;this.applyGravity&&(d=b.add(this.getScene().gravity)),c.getNewPosition(this._oldPosition,d,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},a.prototype._checkInputs=function(){this._localDirection||(this._localDirection=j.x.Zero(),this._transformedDirection=j.x.Zero()),this.inputs.checkInputs(),e.prototype._checkInputs.call(this)},a.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},a.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):e.prototype._updatePosition.call(this)},a.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},a.prototype.getClassName=function(){return"FreeCamera"},v.c([Object(g.o)()],a.prototype,"ellipsoid",void 0),v.c([Object(g.o)()],a.prototype,"ellipsoidOffset",void 0),v.c([Object(g.c)()],a.prototype,"checkCollisions",void 0),v.c([Object(g.c)()],a.prototype,"applyGravity",void 0),a}(qc);s.a.AddNodeConstructor("TouchCamera",function(e,a){return function(){return new De(e,j.x.Zero(),a)}});var De=function(e){function a(b,c,d){var f=e.call(this,b,c,d)||this;return f.inputs.addTouch(),f._setupInputs(),f}return v.d(a,e),Object.defineProperty(a.prototype,"touchAngularSensibility",{get:function(){var b=this.inputs.attached.touch;return b?b.touchAngularSensibility:0},set:function(b){var c=this.inputs.attached.touch;c&&(c.touchAngularSensibility=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"touchMoveSensibility",{get:function(){var b=this.inputs.attached.touch;return b?b.touchMoveSensibility:0},set:function(b){var c=this.inputs.attached.touch;c&&(c.touchMoveSensibility=b)},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"TouchCamera"},a.prototype._setupInputs=function(){var b=this.inputs.attached.mouse;b&&(b.touchEnabled=!1)},a}(Wb);s.a.AddNodeConstructor("ArcRotateCamera",function(e,a){return function(){return new Bc(e,0,0,1,j.x.Zero(),a)}});var Bc=function(e){function a(b,c,d,f,h,i,k){void 0===k&&(k=!0);var m=e.call(this,b,j.x.Zero(),i,k)||this;return m._upVector=j.x.Up(),m.inertialAlphaOffset=0,m.inertialBetaOffset=0,m.inertialRadiusOffset=0,m.lowerAlphaLimit=null,m.upperAlphaLimit=null,m.lowerBetaLimit=.01,m.upperBetaLimit=Math.PI-.01,m.lowerRadiusLimit=null,m.upperRadiusLimit=null,m.inertialPanningX=0,m.inertialPanningY=0,m.pinchToPanMaxDistance=20,m.panningDistanceLimit=null,m.panningOriginTarget=j.x.Zero(),m.panningInertia=.9,m.zoomOnFactor=1,m.targetScreenOffset=j.w.Zero(),m.allowUpsideDown=!0,m.useInputToRestoreState=!0,m._viewMatrix=new j.j(),m.panningAxis=new j.x(1,1,0),m.onMeshTargetChangedObservable=new q.c(),m.checkCollisions=!1,m.collisionRadius=new j.x(.5,.5,.5),m._previousPosition=j.x.Zero(),m._collisionVelocity=j.x.Zero(),m._newPosition=j.x.Zero(),m._computationVector=j.x.Zero(),m._onCollisionPositionChange=function(B,E,K){void 0===K&&(K=null),K?(m.setPosition(E),m.onCollide&&m.onCollide(K)):m._previousPosition.copyFrom(m._position);var P=Math.cos(m.alpha),S=Math.sin(m.alpha),U=Math.cos(m.beta),_=Math.sin(m.beta);0===_&&(_=.0001);var da=m._getTargetPosition();m._computationVector.copyFromFloats(m.radius*P*_,m.radius*U,m.radius*S*_),da.addToRef(m._computationVector,m._newPosition),m._position.copyFrom(m._newPosition);var fa=m.upVector;m.allowUpsideDown&&m.beta<0&&(fa=(fa=fa.clone()).negate()),m._computeViewMatrix(m._position,da,fa),m._viewMatrix.addAtIndex(12,m.targetScreenOffset.x),m._viewMatrix.addAtIndex(13,m.targetScreenOffset.y),m._collisionTriggered=!1},m._target=j.x.Zero(),h&&m.setTarget(h),m.alpha=c,m.beta=d,m.radius=f,m.getViewMatrix(),m.inputs=new Ad(m),m.inputs.addKeyboard().addMouseWheel().addPointers(),m}return v.d(a,e),Object.defineProperty(a.prototype,"target",{get:function(){return this._target},set:function(b){this.setTarget(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"position",{get:function(){return this._position},set:function(b){this.setPosition(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"upVector",{get:function(){return this._upVector},set:function(b){this._upToYMatrix||(this._YToUpMatrix=new j.j(),this._upToYMatrix=new j.j(),this._upVector=j.x.Zero()),b.normalize(),this._upVector.copyFrom(b),this.setMatUp()},enumerable:!0,configurable:!0}),a.prototype.setMatUp=function(){j.j.RotationAlignToRef(j.x.UpReadOnly,this._upVector,this._YToUpMatrix),j.j.RotationAlignToRef(this._upVector,j.x.UpReadOnly,this._upToYMatrix)},Object.defineProperty(a.prototype,"angularSensibilityX",{get:function(){var b=this.inputs.attached.pointers;return b?b.angularSensibilityX:0},set:function(b){var c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"angularSensibilityY",{get:function(){var b=this.inputs.attached.pointers;return b?b.angularSensibilityY:0},set:function(b){var c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pinchPrecision",{get:function(){var b=this.inputs.attached.pointers;return b?b.pinchPrecision:0},set:function(b){var c=this.inputs.attached.pointers;c&&(c.pinchPrecision=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pinchDeltaPercentage",{get:function(){var b=this.inputs.attached.pointers;return b?b.pinchDeltaPercentage:0},set:function(b){var c=this.inputs.attached.pointers;c&&(c.pinchDeltaPercentage=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"panningSensibility",{get:function(){var b=this.inputs.attached.pointers;return b?b.panningSensibility:0},set:function(b){var c=this.inputs.attached.pointers;c&&(c.panningSensibility=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysUp",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysUp:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysUp=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysDown",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysDown:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysDown=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysLeft",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysLeft:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysLeft=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysRight",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysRight:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysRight=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"wheelPrecision",{get:function(){var b=this.inputs.attached.mousewheel;return b?b.wheelPrecision:0},set:function(b){var c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"wheelDeltaPercentage",{get:function(){var b=this.inputs.attached.mousewheel;return b?b.wheelDeltaPercentage:0},set:function(b){var c=this.inputs.attached.mousewheel;c&&(c.wheelDeltaPercentage=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(b){b!==this.useBouncingBehavior&&(b?(this._bouncingBehavior=new yd(),this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(b){b!==this.useFramingBehavior&&(b?(this._framingBehavior=new zd(),this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(b){b!==this.useAutoRotationBehavior&&(b?(this._autoRotationBehavior=new xd(),this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),a.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache._target=new j.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=j.w.Zero()},a.prototype._updateCache=function(b){b||e.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},a.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var b=this._targetHost.absolutePosition;this._targetBoundingCenter?b.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(b)}var c=this._getLockedTargetPosition();return c||this._target},a.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),e.prototype.storeState.call(this)},a.prototype._restoreStateValues=function(){return!!e.prototype._restoreStateValues.call(this)&&(this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.setTarget(this._storedTarget.clone()),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},a.prototype._isSynchronizedViewMatrix=function(){return!!e.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},a.prototype.attachControl=function(b,c,d,f){var h=this;void 0===d&&(d=!0),void 0===f&&(f=2),this._useCtrlForPanning=d,this._panningMouseButton=f,this.inputs.attachElement(b,c),this._reset=function(){h.inertialAlphaOffset=0,h.inertialBetaOffset=0,h.inertialRadiusOffset=0,h.inertialPanningX=0,h.inertialPanningY=0}},a.prototype.detachControl=function(b){this.inputs.detachElement(b),this._reset&&this._reset()},a.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var b=this.inertialAlphaOffset;this.beta<=0&&(b*=-1),this.getScene().useRightHandedSystem&&(b*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(b*=-1),this.alpha+=b,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<j.h&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<j.h&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*j.h&&(this.inertialRadiusOffset=0)}(0!==this.inertialPanningX||0!==this.inertialPanningY)&&((this._localDirection||(this._localDirection=j.x.Zero(),this._transformedDirection=j.x.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),j.x.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)&&(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),j.x.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*j.h&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*j.h&&(this.inertialPanningY=0)),this._checkLimits(),e.prototype._checkInputs.call(this)}},a.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},a.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||j.x.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=.0001),0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},a.prototype.setPosition=function(b){this._position.equals(b)||(this._position.copyFrom(b),this.rebuildAnglesAndRadius())},a.prototype.setTarget=function(b,c,d){if(void 0===c&&(c=!1),void 0===d&&(d=!1),b.getBoundingInfo)this._targetBoundingCenter=c?b.getBoundingInfo().boundingBox.centerWorld.clone():null,b.computeWorldMatrix(),this._targetHost=b,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var f=b,h=this._getTargetPosition();if(h&&!d&&h.equals(f))return;this._targetHost=null,this._target=f,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},a.prototype._getViewMatrix=function(){var b=Math.cos(this.alpha),c=Math.sin(this.alpha),d=Math.cos(this.beta),f=Math.sin(this.beta);0===f&&(f=.0001);var h=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*b*f,this.radius*d,this.radius*c*f),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||j.x.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),h.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var i=this.getScene().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,i.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var k=this.upVector;this.allowUpsideDown&&f<0&&(k=(k=k.clone()).negate()),this._computeViewMatrix(this._position,h,k),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=h,this._viewMatrix},a.prototype.zoomOn=function(b,c){void 0===c&&(c=!1),b=b||this.getScene().meshes;var d=Ca.a.MinMax(b),f=j.x.Distance(d.min,d.max);this.radius=f*this.zoomOnFactor,this.focusOn({min:d.min,max:d.max,distance:f},c)},a.prototype.focusOn=function(b,c){var d,f;if(void 0===c&&(c=!1),void 0===b.min){var h=b||this.getScene().meshes;d=Ca.a.MinMax(h),f=j.x.Distance(d.min,d.max)}else d=b,f=b.distance;this._target=Ca.a.Center(d),c||(this.maxZ=2*f)},a.prototype.createRigCamera=function(b,c){var d=0;switch(this.cameraRigMode){case ab.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case ab.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case ab.a.RIG_MODE_VR:d=this._cameraRigParams.stereoHalfAngle*(0===c?1:-1);break;case ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:d=this._cameraRigParams.stereoHalfAngle*(0===c?-1:1)}var f=new a(b,this.alpha+d,this.beta,this.radius,this._target,this.getScene());return f._cameraRigParams={},f},a.prototype._updateRigCameras=function(){var b=this._rigCameras[0],c=this._rigCameras[1];switch(b.beta=c.beta=this.beta,this.cameraRigMode){case ab.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case ab.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case ab.a.RIG_MODE_VR:b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}e.prototype._updateRigCameras.call(this)},a.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},a.prototype.getClassName=function(){return"ArcRotateCamera"},v.c([Object(g.c)()],a.prototype,"alpha",void 0),v.c([Object(g.c)()],a.prototype,"beta",void 0),v.c([Object(g.c)()],a.prototype,"radius",void 0),v.c([Object(g.o)("target")],a.prototype,"_target",void 0),v.c([Object(g.o)("upVector")],a.prototype,"_upVector",void 0),v.c([Object(g.c)()],a.prototype,"inertialAlphaOffset",void 0),v.c([Object(g.c)()],a.prototype,"inertialBetaOffset",void 0),v.c([Object(g.c)()],a.prototype,"inertialRadiusOffset",void 0),v.c([Object(g.c)()],a.prototype,"lowerAlphaLimit",void 0),v.c([Object(g.c)()],a.prototype,"upperAlphaLimit",void 0),v.c([Object(g.c)()],a.prototype,"lowerBetaLimit",void 0),v.c([Object(g.c)()],a.prototype,"upperBetaLimit",void 0),v.c([Object(g.c)()],a.prototype,"lowerRadiusLimit",void 0),v.c([Object(g.c)()],a.prototype,"upperRadiusLimit",void 0),v.c([Object(g.c)()],a.prototype,"inertialPanningX",void 0),v.c([Object(g.c)()],a.prototype,"inertialPanningY",void 0),v.c([Object(g.c)()],a.prototype,"pinchToPanMaxDistance",void 0),v.c([Object(g.c)()],a.prototype,"panningDistanceLimit",void 0),v.c([Object(g.o)()],a.prototype,"panningOriginTarget",void 0),v.c([Object(g.c)()],a.prototype,"panningInertia",void 0),v.c([Object(g.c)()],a.prototype,"zoomOnFactor",void 0),v.c([Object(g.c)()],a.prototype,"targetScreenOffset",void 0),v.c([Object(g.c)()],a.prototype,"allowUpsideDown",void 0),v.c([Object(g.c)()],a.prototype,"useInputToRestoreState",void 0),a}(qc);s.a.AddNodeConstructor("DeviceOrientationCamera",function(e,a){return function(){return new Bd(e,j.x.Zero(),a)}});var Bd=function(e){function a(b,c,d){var f=e.call(this,b,c,d)||this;return f._tmpDragQuaternion=new j.q(),f._disablePointerInputWhenUsingDeviceOrientation=!0,f._dragFactor=0,f._quaternionCache=new j.q(),f.inputs.addDeviceOrientation(),f.inputs._deviceOrientationInput&&f.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce(function(){f._disablePointerInputWhenUsingDeviceOrientation&&f.inputs._mouseInput&&(f.inputs._mouseInput._allowCameraRotation=!1,f.inputs._mouseInput.onPointerMovedObservable.add(function(h){0!=f._dragFactor&&(f._initialQuaternion||(f._initialQuaternion=new j.q()),j.q.FromEulerAnglesToRef(0,h.offsetX*f._dragFactor,0,f._tmpDragQuaternion),f._initialQuaternion.multiplyToRef(f._tmpDragQuaternion,f._initialQuaternion))}))}),f}return v.d(a,e),a.prototype.enableHorizontalDragging=function(b){void 0===b&&(b=1/300),this._dragFactor=b},a.prototype.getClassName=function(){return"DeviceOrientationCamera"},a.prototype._checkInputs=function(){e.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},a.prototype.resetToCurrentRotation=function(b){var c=this;void 0===b&&(b=j.c.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new j.q()),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(d){b[d]?c._initialQuaternion[d]*=-1:c._initialQuaternion[d]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},a}(Wb),gg=function(e){function a(b){return e.call(this,b)||this}return v.d(a,e),a.prototype.addKeyboard=function(){return this.add(new re()),this},a.prototype.addMouse=function(b){return void 0===b&&(b=!0),this.add(new se(b)),this},a}(Yc),Ii=function(e){function a(b,c,d,f){void 0===f&&(f=!0);var h=e.call(this,b,c,d,f)||this;return h.ellipsoid=new j.x(1,1,1),h.ellipsoidOffset=new j.x(0,0,0),h.checkCollisions=!1,h.applyGravity=!1,h.cameraDirection=j.x.Zero(),h._trackRoll=0,h.rollCorrect=100,h.bankedTurn=!1,h.bankedTurnLimit=Math.PI/2,h.bankedTurnMultiplier=1,h._needMoveForGravity=!1,h._oldPosition=j.x.Zero(),h._diffPosition=j.x.Zero(),h._newPosition=j.x.Zero(),h._collisionMask=-1,h._onCollisionPositionChange=function(i,k,m){void 0===m&&(m=null);var B;B=k,h._newPosition.copyFrom(B),h._newPosition.subtractToRef(h._oldPosition,h._diffPosition),h._diffPosition.length()>va.b.CollisionsEpsilon&&(h.position.addInPlace(h._diffPosition),h.onCollide&&m&&h.onCollide(m))},h.inputs=new gg(h),h.inputs.addKeyboard().addMouse(),h}return v.d(a,e),Object.defineProperty(a.prototype,"angularSensibility",{get:function(){var b=this.inputs.attached.mouse;return b?b.angularSensibility:0},set:function(b){var c=this.inputs.attached.mouse;c&&(c.angularSensibility=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysForward",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysForward:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysForward=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysBackward",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysBackward:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysBackward=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysUp",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysUp:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysUp=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysDown",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysDown:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysDown=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysLeft",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysLeft:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysLeft=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysRight",{get:function(){var b=this.inputs.attached.keyboard;return b?b.keysRight:[]},set:function(b){var c=this.inputs.attached.keyboard;c&&(c.keysRight=b)},enumerable:!0,configurable:!0}),a.prototype.attachControl=function(b,c){this.inputs.attachElement(b,c)},a.prototype.detachControl=function(b){this.inputs.detachElement(b),this.cameraDirection=new j.x(0,0,0)},Object.defineProperty(a.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(b){this._collisionMask=isNaN(b)?-1:b},enumerable:!0,configurable:!0}),a.prototype._collideWithWorld=function(b){(this.parent?j.x.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var c=this.getScene().collisionCoordinator;this._collider||(this._collider=c.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var d=b;this.applyGravity&&(d=b.add(this.getScene().gravity)),c.getNewPosition(this._oldPosition,d,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},a.prototype._checkInputs=function(){this._localDirection||(this._localDirection=j.x.Zero(),this._transformedDirection=j.x.Zero()),this.inputs.checkInputs(),e.prototype._checkInputs.call(this)},a.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},a.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):e.prototype._updatePosition.call(this)},a.prototype.restoreRoll=function(b){var c=this._trackRoll,d=c-this.rotation.z;Math.abs(d)>=.001&&(this.rotation.z+=d/b,Math.abs(c-this.rotation.z)<=.001&&(this.rotation.z=c))},a.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},a.prototype.getClassName=function(){return"FlyCamera"},v.c([Object(g.o)()],a.prototype,"ellipsoid",void 0),v.c([Object(g.o)()],a.prototype,"ellipsoidOffset",void 0),v.c([Object(g.c)()],a.prototype,"checkCollisions",void 0),v.c([Object(g.c)()],a.prototype,"applyGravity",void 0),a}(qc),Ji=function(e){function a(b){return e.call(this,b)||this}return v.d(a,e),a.prototype.addKeyboard=function(){return this.add(new te()),this},a.prototype.addMouseWheel=function(){return this.add(new ue()),this},a.prototype.addPointers=function(){return this.add(new ve()),this},a.prototype.addVRDeviceOrientation=function(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this},a}(Yc);s.a.AddNodeConstructor("FollowCamera",function(e,a){return function(){return new hg(e,j.x.Zero(),a)}}),s.a.AddNodeConstructor("ArcFollowCamera",function(e,a){return function(){return new ig(e,0,0,1,null,a)}});var _b,hg=function(e){function a(b,c,d,f){void 0===f&&(f=null);var h=e.call(this,b,c,d)||this;return h.radius=12,h.lowerRadiusLimit=null,h.upperRadiusLimit=null,h.rotationOffset=0,h.lowerRotationOffsetLimit=null,h.upperRotationOffsetLimit=null,h.heightOffset=4,h.lowerHeightOffsetLimit=null,h.upperHeightOffsetLimit=null,h.cameraAcceleration=.05,h.maxCameraSpeed=20,h.lockedTarget=f,h.inputs=new Ji(h),h.inputs.addKeyboard().addMouseWheel().addPointers(),h}return v.d(a,e),a.prototype._follow=function(b){if(b){var c;if(b.rotationQuaternion){var d=new j.j();b.rotationQuaternion.toRotationMatrix(d),c=Math.atan2(d.m[8],d.m[10])}else c=b.rotation.y;var f=xa.h.ToRadians(this.rotationOffset)+c,h=b.getAbsolutePosition(),i=h.x+Math.sin(f)*this.radius,k=h.z+Math.cos(f)*this.radius,m=i-this.position.x,B=h.y+this.heightOffset-this.position.y,E=k-this.position.z,K=m*this.cameraAcceleration*2,P=B*this.cameraAcceleration,S=E*this.cameraAcceleration*2;(K>this.maxCameraSpeed||K<-this.maxCameraSpeed)&&(K=K<1?-this.maxCameraSpeed:this.maxCameraSpeed),(P>this.maxCameraSpeed||P<-this.maxCameraSpeed)&&(P=P<1?-this.maxCameraSpeed:this.maxCameraSpeed),(S>this.maxCameraSpeed||S<-this.maxCameraSpeed)&&(S=S<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new j.x(this.position.x+K,this.position.y+P,this.position.z+S),this.setTarget(h)}},a.prototype.attachControl=function(b,c){this.inputs.attachElement(b,c),this._reset=function(){}},a.prototype.detachControl=function(b){this.inputs.detachElement(b),this._reset&&this._reset()},a.prototype._checkInputs=function(){this.inputs.checkInputs(),this._checkLimits(),e.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},a.prototype._checkLimits=function(){null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),null!==this.lowerHeightOffsetLimit&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),null!==this.upperHeightOffsetLimit&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),null!==this.lowerRotationOffsetLimit&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),null!==this.upperRotationOffsetLimit&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)},a.prototype.getClassName=function(){return"FollowCamera"},v.c([Object(g.c)()],a.prototype,"radius",void 0),v.c([Object(g.c)()],a.prototype,"lowerRadiusLimit",void 0),v.c([Object(g.c)()],a.prototype,"upperRadiusLimit",void 0),v.c([Object(g.c)()],a.prototype,"rotationOffset",void 0),v.c([Object(g.c)()],a.prototype,"lowerRotationOffsetLimit",void 0),v.c([Object(g.c)()],a.prototype,"upperRotationOffsetLimit",void 0),v.c([Object(g.c)()],a.prototype,"heightOffset",void 0),v.c([Object(g.c)()],a.prototype,"lowerHeightOffsetLimit",void 0),v.c([Object(g.c)()],a.prototype,"upperHeightOffsetLimit",void 0),v.c([Object(g.c)()],a.prototype,"cameraAcceleration",void 0),v.c([Object(g.c)()],a.prototype,"maxCameraSpeed",void 0),v.c([Object(g.k)("lockedTargetId")],a.prototype,"lockedTarget",void 0),a}(qc),ig=function(e){function a(b,c,d,f,h,i){var k=e.call(this,b,j.x.Zero(),i)||this;return k.alpha=c,k.beta=d,k.radius=f,k.target=h,k._cartesianCoordinates=j.x.Zero(),k._follow(),k}return v.d(a,e),a.prototype._follow=function(){if(this.target){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var b=this.target.getAbsolutePosition();this.position=b.add(this._cartesianCoordinates),this.setTarget(b)}},a.prototype._checkInputs=function(){e.prototype._checkInputs.call(this),this._follow()},a.prototype.getClassName=function(){return"ArcFollowCamera"},a}(qc),Ee=l(35),Nb=l(39);!function(e){e[e.VIVE=0]="VIVE",e[e.OCULUS=1]="OCULUS",e[e.WINDOWS=2]="WINDOWS",e[e.GEAR_VR=3]="GEAR_VR",e[e.DAYDREAM=4]="DAYDREAM",e[e.GENERIC=5]="GENERIC"}(_b||(_b={}));var Ob,Cc,rc=function(){function e(){}return e.InitiateController=function(a){for(var b=0,c=this._ControllerFactories;b<c.length;b++){var d=c[b];if(d.canCreate(a))return d.create(a)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(a);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},e._ControllerFactories=[],e._DefaultControllerFactory=null,e}(),_c=function(e){function a(b){var c=e.call(this,b.id,b.index,b)||this;return c._deviceRoomPosition=j.x.Zero(),c._deviceRoomRotationQuaternion=new j.q(),c.devicePosition=j.x.Zero(),c.deviceRotationQuaternion=new j.q(),c.deviceScaleFactor=1,c._trackPosition=!0,c._maxRotationDistFromHeadset=Math.PI/5,c._draggedRoomRotation=0,c._leftHandSystemQuaternion=new j.q(),c._deviceToWorld=j.j.Identity(),c._pointingPoseNode=null,c._workingMatrix=j.j.Identity(),c._meshAttachedObservable=new q.c(),c.type=Hb.POSE_ENABLED,c.controllerType=_b.GENERIC,c.position=j.x.Zero(),c.rotationQuaternion=new j.q(),c._calculatedPosition=j.x.Zero(),c._calculatedRotation=new j.q(),j.q.RotationYawPitchRollToRef(Math.PI,0,0,c._leftHandSystemQuaternion),c}return v.d(a,e),a.prototype._disableTrackPosition=function(b){this._trackPosition&&(this._calculatedPosition.copyFrom(b),this._trackPosition=!1)},a.prototype.update=function(){e.prototype.update.call(this),this._updatePoseAndMesh()},a.prototype._updatePoseAndMesh=function(){var b=this.browserGamepad.pose;if((this.updateFromDevice(b),!this._trackPosition&&T.a.LastCreatedScene&&T.a.LastCreatedScene.activeCamera&&T.a.LastCreatedScene.activeCamera.devicePosition)&&((c=T.a.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(c.devicePosition),c.deviceRotationQuaternion)){var c;(c=c)._deviceRoomRotationQuaternion.toEulerAnglesToRef(j.t.Vector3[0]);var d=Math.atan2(Math.sin(j.t.Vector3[0].y-this._draggedRoomRotation),Math.cos(j.t.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(d)>this._maxRotationDistFromHeadset){var f=d-(d<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=f;var h=Math.sin(-f),i=Math.cos(-f);this._calculatedPosition.x=this._calculatedPosition.x*i-this._calculatedPosition.z*h,this._calculatedPosition.z=this._calculatedPosition.x*h+this._calculatedPosition.z*i}}j.x.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),j.q.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))},a.prototype.updateFromDevice=function(b){if(b){this.rawPose=b,b.position&&(this._deviceRoomPosition.copyFromFloats(b.position[0],b.position[1],-b.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var c=this.rawPose;b.orientation&&c.orientation&&(this._deviceRoomRotationQuaternion.copyFromFloats(c.orientation[0],c.orientation[1],-c.orientation[2],-c.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},a.prototype.attachToMesh=function(b){if(this._mesh&&(this._mesh.parent=null),this._mesh=b,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new j.q()),this._updatePoseAndMesh(),this._pointingPoseNode){for(var c=[],d=this._pointingPoseNode;d.parent;)c.push(d.parent),d=d.parent;c.reverse().forEach(function(f){f.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(b)},a.prototype.attachToPoseControlledCamera=function(b){this._poseControlledCamera=b,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},a.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,e.prototype.dispose.call(this)},Object.defineProperty(a.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),a.prototype.getForwardRay=function(b){if(void 0===b&&(b=100),!this.mesh)return new Nb.a(j.x.Zero(),new j.x(0,0,1),b);var c=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),d=c.getTranslation(),f=new j.x(0,0,-1),h=j.x.TransformNormal(f,c),i=j.x.Normalize(h);return new Nb.a(d,i,b)},a.POINTING_POSE="POINTING_POSE",a}(Hb);!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.Start=4]="Start",e[e.Back=5]="Back",e[e.LB=6]="LB",e[e.RB=7]="RB",e[e.LeftStick=8]="LeftStick",e[e.RightStick=9]="RightStick"}(Ob||(Ob={})),function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(Cc||(Cc={}));var jg=function(e){function a(b,c,d,f){void 0===f&&(f=!1);var h=e.call(this,b,c,d,0,1,2,3)||this;return h._leftTrigger=0,h._rightTrigger=0,h.onButtonDownObservable=new q.c(),h.onButtonUpObservable=new q.c(),h.onPadDownObservable=new q.c(),h.onPadUpObservable=new q.c(),h._buttonA=0,h._buttonB=0,h._buttonX=0,h._buttonY=0,h._buttonBack=0,h._buttonStart=0,h._buttonLB=0,h._buttonRB=0,h._buttonLeftStick=0,h._buttonRightStick=0,h._dPadUp=0,h._dPadDown=0,h._dPadLeft=0,h._dPadRight=0,h._isXboxOnePad=!1,h.type=Hb.XBOX,h._isXboxOnePad=f,h}return v.d(a,e),a.prototype.onlefttriggerchanged=function(b){this._onlefttriggerchanged=b},a.prototype.onrighttriggerchanged=function(b){this._onrighttriggerchanged=b},Object.defineProperty(a.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(b){this._onlefttriggerchanged&&this._leftTrigger!==b&&this._onlefttriggerchanged(b),this._leftTrigger=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(b){this._onrighttriggerchanged&&this._rightTrigger!==b&&this._onrighttriggerchanged(b),this._rightTrigger=b},enumerable:!0,configurable:!0}),a.prototype.onbuttondown=function(b){this._onbuttondown=b},a.prototype.onbuttonup=function(b){this._onbuttonup=b},a.prototype.ondpaddown=function(b){this._ondpaddown=b},a.prototype.ondpadup=function(b){this._ondpadup=b},a.prototype._setButtonValue=function(b,c,d){return b!==c&&(1===b&&(this._onbuttondown&&this._onbuttondown(d),this.onButtonDownObservable.notifyObservers(d)),0===b&&(this._onbuttonup&&this._onbuttonup(d),this.onButtonUpObservable.notifyObservers(d))),b},a.prototype._setDPadValue=function(b,c,d){return b!==c&&(1===b&&(this._ondpaddown&&this._ondpaddown(d),this.onPadDownObservable.notifyObservers(d)),0===b&&(this._ondpadup&&this._ondpadup(d),this.onPadUpObservable.notifyObservers(d))),b},Object.defineProperty(a.prototype,"buttonA",{get:function(){return this._buttonA},set:function(b){this._buttonA=this._setButtonValue(b,this._buttonA,Ob.A)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonB",{get:function(){return this._buttonB},set:function(b){this._buttonB=this._setButtonValue(b,this._buttonB,Ob.B)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonX",{get:function(){return this._buttonX},set:function(b){this._buttonX=this._setButtonValue(b,this._buttonX,Ob.X)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonY",{get:function(){return this._buttonY},set:function(b){this._buttonY=this._setButtonValue(b,this._buttonY,Ob.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(b){this._buttonStart=this._setButtonValue(b,this._buttonStart,Ob.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(b){this._buttonBack=this._setButtonValue(b,this._buttonBack,Ob.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(b){this._buttonLB=this._setButtonValue(b,this._buttonLB,Ob.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(b){this._buttonRB=this._setButtonValue(b,this._buttonRB,Ob.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(b){this._buttonLeftStick=this._setButtonValue(b,this._buttonLeftStick,Ob.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(b){this._buttonRightStick=this._setButtonValue(b,this._buttonRightStick,Ob.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(b){this._dPadUp=this._setDPadValue(b,this._dPadUp,Cc.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(b){this._dPadDown=this._setDPadValue(b,this._dPadDown,Cc.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(b){this._dPadLeft=this._setDPadValue(b,this._dPadLeft,Cc.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(b){this._dPadRight=this._setDPadValue(b,this._dPadRight,Cc.Right)},enumerable:!0,configurable:!0}),a.prototype.update=function(){e.prototype.update.call(this),this._isXboxOnePad?(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.axes[2],this.rightTrigger=this.browserGamepad.axes[5],this.buttonBack=this.browserGamepad.buttons[9].value,this.buttonStart=this.browserGamepad.buttons[8].value,this.buttonLeftStick=this.browserGamepad.buttons[6].value,this.buttonRightStick=this.browserGamepad.buttons[7].value,this.dPadUp=this.browserGamepad.buttons[11].value,this.dPadDown=this.browserGamepad.buttons[12].value,this.dPadLeft=this.browserGamepad.buttons[13].value,this.dPadRight=this.browserGamepad.buttons[14].value):(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value)},a.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},a}(Hb),kg=function(){function e(a){var b=this;this._scene=a,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new q.c(),Ee.a.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new q.c(function(c){for(var d in b._babylonGamepads){var f=b._babylonGamepads[d];f&&f._isConnected&&b.onGamepadConnectedObservable.notifyObserver(c,f)}}),this._onGamepadConnectedEvent=function(c){var d,f=c.gamepad;f.index in b._babylonGamepads&&b._babylonGamepads[f.index].isConnected||(b._babylonGamepads[f.index]?((d=b._babylonGamepads[f.index]).browserGamepad=f,d._isConnected=!0):d=b._addNewGamepad(f),b.onGamepadConnectedObservable.notifyObservers(d),b._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(c){var d=c.gamepad;for(var f in b._babylonGamepads)if(b._babylonGamepads[f].index===d.index){var h=b._babylonGamepads[f];h._isConnected=!1,b.onGamepadDisconnectedObservable.notifyObservers(h);break}},this._gamepadSupport&&(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported?(window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1)):this._startMonitoringGamepads())}return Object.defineProperty(e.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),e.prototype.getGamepadByType=function(a){void 0===a&&(a=Hb.XBOX);for(var b=0,c=this._babylonGamepads;b<c.length;b++){var d=c[b];if(d&&d.type===a)return d}return null},e.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(a){a.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},e.prototype._addNewGamepad=function(a){var b;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var c=-1!==a.id.search("Xbox One");return b=c||-1!==a.id.search("Xbox 360")||-1!==a.id.search("xinput")?new jg(a.id,a.index,a,c):a.pose?rc.InitiateController(a):new dg(a.id,a.index,a),this._babylonGamepads[b.index]=b,b},e.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var a=this;for(var b in this._updateGamepadObjects(),this._babylonGamepads){var c=this._babylonGamepads[b];c&&c.isConnected&&c.update()}this._isMonitoring&&!this._scene&&xa.h.QueueNewFrame(function(){a._checkGamepadsStatus()})},e.prototype._updateGamepadObjects=function(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],b=0;b<a.length;b++){var c=a[b];if(c)if(this._babylonGamepads[c.index])this._babylonGamepads[b].browserGamepad=c,this._babylonGamepads[b].isConnected||(this._babylonGamepads[b]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[b]));else{var d=this._addNewGamepad(c);this.onGamepadConnectedObservable.notifyObservers(d)}}},e}();Object.defineProperty(ja.a.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new kg(this);var e=this._getComponent(Pa.a.NAME_GAMEPAD);e||(e=new lg(this),this._addComponent(e))}return this._gamepadManager},enumerable:!0,configurable:!0}),Zc.prototype.addGamepad=function(){return this.add(new Ae()),this},Ad.prototype.addGamepad=function(){return this.add(new me()),this};var lg=function(){function e(a){this.name=Pa.a.NAME_GAMEPAD,this.scene=a}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(Pa.a.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){var a=this.scene._gamepadManager;a&&(a.dispose(),this.scene._gamepadManager=null)},e.prototype._beforeCameraUpdate=function(){var a=this.scene._gamepadManager;a&&a._isMonitoring&&a._checkGamepadsStatus()},e}();s.a.AddNodeConstructor("FreeCamera",function(e,a){return function(){return new Hc(e,j.x.Zero(),a)}});var Hc=function(e){function a(b,c,d){var f=e.call(this,b,c,d)||this;return f.inputs.addGamepad(),f}return v.d(a,e),Object.defineProperty(a.prototype,"gamepadAngularSensibility",{get:function(){var b=this.inputs.attached.gamepad;return b?b.gamepadAngularSensibility:0},set:function(b){var c=this.inputs.attached.gamepad;c&&(c.gamepadAngularSensibility=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"gamepadMoveSensibility",{get:function(){var b=this.inputs.attached.gamepad;return b?b.gamepadMoveSensibility:0},set:function(b){var c=this.inputs.attached.gamepad;c&&(c.gamepadMoveSensibility=b)},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"UniversalCamera"},a}(De);ab.a._createDefaultParsedCamera=function(e,a){return new Hc(e,j.x.Zero(),a)},s.a.AddNodeConstructor("GamepadCamera",function(e,a){return function(){return new Cd(e,j.x.Zero(),a)}});var Cd=function(e){function a(b,c,d){return e.call(this,b,c,d)||this}return v.d(a,e),a.prototype.getClassName=function(){return"GamepadCamera"},a}(Hc),ic=l(28),Ia=l(5),Ki=`
attribute vec2 position;
uniform vec2 scale;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd)*scale;
gl_Position=vec4(position,0.0,1.0);
}`;Ia.a.ShadersStore.postprocessVertexShader=Ki;var Za=function(){function e(a,b,c,d,f,h,i,k,m,B,E,K,P,S){void 0===i&&(i=o.a.TEXTURE_NEAREST_SAMPLINGMODE),void 0===B&&(B=null),void 0===E&&(E=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===K&&(K="postprocess"),void 0===S&&(S=!1),this.name=a,this.width=-1,this.height=-1,this._outputTexture=null,this.autoClear=!0,this.alphaMode=o.a.ALPHA_DISABLE,this.animations=new Array(),this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=o.a.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new ic.a(2),this._currentRenderTextureInd=0,this._scaleRatio=new j.w(1,1),this._texelSize=j.w.Zero(),this.onActivateObservable=new q.c(),this.onSizeChangedObservable=new q.c(),this.onApplyObservable=new q.c(),this.onBeforeRenderObservable=new q.c(),this.onAfterRenderObservable=new q.c(),null!=h?(this._camera=h,this._scene=h.getScene(),h.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):k&&(this._engine=k,this._engine.postProcesses.push(this)),this._options=f,this.renderTargetSamplingMode=i||o.a.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=m||!1,this._textureType=E,this._samplers=d||[],this._samplers.push("textureSampler"),this._fragmentUrl=b,this._vertexUrl=K,this._parameters=c||[],this._parameters.push("scale"),this._indexParameters=P,S||this.updateEffect(B)}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(a){var b=this;this._samples=a,this._textures.forEach(function(c){c.samples!==b._samples&&b._engine.updateRenderTargetTextureSampleCount(c,b._samples)})},enumerable:!0,configurable:!0}),e.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(e.prototype,"onActivate",{set:function(a){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),a&&(this._onActivateObserver=this.onActivateObservable.add(a))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSizeChanged",{set:function(a){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onApply",{set:function(a){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(a){this._forcedOutputTexture=a},enumerable:!0,configurable:!0}),e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcess"},e.prototype.getEngine=function(){return this._engine},e.prototype.getEffect=function(){return this._effect},e.prototype.shareOutputWith=function(a){return this._disposeTextures(),this._shareOutputWithPostProcess=a,this},e.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new ic.a(2)),this._shareOutputWithPostProcess=null},e.prototype.updateEffect=function(a,b,c,d,f,h){void 0===a&&(a=null),void 0===b&&(b=null),void 0===c&&(c=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],b||this._parameters,c||this._samplers,null!==a?a:"",void 0,f,h,d||this._indexParameters)},e.prototype.isReusable=function(){return this._reusable},e.prototype.markTextureDirty=function(){this.width=-1},e.prototype.activate=function(a,b,c){var d=this;void 0===b&&(b=null);var f=(a=a||this._camera).getScene(),h=f.getEngine(),i=h.getCaps().maxTextureSize,k=(b?b.width:this._engine.getRenderWidth(!0))*this._options|0,m=(b?b.height:this._engine.getRenderHeight(!0))*this._options|0,B=a.parent;!B||B.leftCamera!=a&&B.rightCamera!=a||(k/=2);var E,K=this._options.width||k,P=this._options.height||m;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var S=h.currentViewport;S&&(K*=S.width,P*=S.height)}if((this.renderTargetSamplingMode===o.a.TEXTURE_TRILINEAR_SAMPLINGMODE||this.alwaysForcePOT)&&(this._options.width||(K=h.needPOTTextures?xa.h.GetExponentOfTwo(K,i,this.scaleMode):K),this._options.height||(P=h.needPOTTextures?xa.h.GetExponentOfTwo(P,i,this.scaleMode):P)),this.width!==K||this.height!==P){if(this._textures.length>0){for(var U=0;U<this._textures.length;U++)this._engine._releaseTexture(this._textures.data[U]);this._textures.reset()}this.width=K,this.height=P;var _={width:this.width,height:this.height},da={generateMipMaps:!1,generateDepthBuffer:c||0===a._postProcesses.indexOf(this),generateStencilBuffer:(c||0===a._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType};this._textures.push(this._engine.createRenderTargetTexture(_,da)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(_,da)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(fa){fa.samples!==d.samples&&d._engine.updateRenderTargetTextureSampleCount(fa,d.samples)})}return this._shareOutputWithPostProcess?E=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(E=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):E=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(k/K,m/P),this._engine.bindFramebuffer(E,0,k,m,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(E,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(a),this.autoClear&&this.alphaMode===o.a.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:f.clearColor,f._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),E},Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){return this._effect&&this._effect.isReady()},e.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),a=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",a),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var a},e.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var a=0;a<this._textures.length;a++)this._engine._releaseTexture(this._textures.data[a]);this._textures.dispose()}},e.prototype.dispose=function(a){if(a=a||this._camera,this._disposeTextures(),this._scene){var b=this._scene.postProcesses.indexOf(this);-1!==b&&this._scene.postProcesses.splice(b,1)}else{var c=this._engine.postProcesses.indexOf(this);-1!==c&&this._engine.postProcesses.splice(c,1)}if(a){if(a.detachPostProcess(this),0===a._postProcesses.indexOf(this)&&a._postProcesses.length>0){var d=this._camera._getFirstPostProcess();d&&d.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},e}(),Li=`
varying vec2 vUV;
uniform sampler2D textureSampler;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
}`;Ia.a.ShadersStore.passPixelShader=Li;var Mi=`
varying vec2 vUV;
uniform samplerCube textureSampler;
void main(void)
{
vec2 uv=vUV*2.0-1.0;
#ifdef POSITIVEX
gl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));
#endif
#ifdef NEGATIVEX
gl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));
#endif
#ifdef POSITIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));
#endif
#ifdef NEGATIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));
#endif
#ifdef POSITIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,1.001));
#endif
#ifdef NEGATIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));
#endif
}`;Ia.a.ShadersStore.passCubePixelShader=Mi;var sc=function(e){function a(b,c,d,f,h,i,k,m){return void 0===d&&(d=null),void 0===k&&(k=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1),e.call(this,b,"pass",null,null,c,d,f,h,i,void 0,k,void 0,null,m)||this}return v.d(a,e),a}(Za),Ni=function(e){function a(b,c,d,f,h,i,k,m){void 0===d&&(d=null),void 0===k&&(k=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1);var B=e.call(this,b,"passCube",null,null,c,d,f,h,i,"#define POSITIVEX",k,void 0,null,m)||this;return B._face=0,B}return v.d(a,e),Object.defineProperty(a.prototype,"face",{get:function(){return this._face},set:function(b){if(!(b<0||b>5))switch(this._face=b,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!0,configurable:!0}),a}(Za);va.b._RescalePostProcessFactory=function(e){return new sc("rescale",1,null,va.b.TEXTURE_BILINEAR_SAMPLINGMODE,e,!1,va.b.TEXTURETYPE_UNSIGNED_INT)};var Oi=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D leftSampler;
void main(void)
{
vec4 leftFrag=texture2D(leftSampler,vUV);
leftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);
vec4 rightFrag=texture2D(textureSampler,vUV);
rightFrag=vec4(rightFrag.r,1.0,1.0,1.0);
gl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);
}`;Ia.a.ShadersStore.anaglyphPixelShader=Oi;var mg=function(e){function a(b,c,d,f,h,i){var k=e.call(this,b,"anaglyph",null,["leftSampler"],c,d[1],f,h,i)||this;return k._passedProcess=d[0]._rigPostProcess,k.onApplyObservable.add(function(m){m.setTextureFromPostProcess("leftSampler",k._passedProcess)}),k}return v.d(a,e),a}(Za);ab.a._setStereoscopicAnaglyphRigMode=function(e){e._rigCameras[0]._rigPostProcess=new sc(e.name+"_passthru",1,e._rigCameras[0]),e._rigCameras[1]._rigPostProcess=new mg(e.name+"_anaglyph",1,e._rigCameras)},s.a.AddNodeConstructor("AnaglyphArcRotateCamera",function(e,a,b){return function(){return new ng(e,0,0,1,j.x.Zero(),b.interaxial_distance,a)}});var ng=function(e){function a(b,c,d,f,h,i,k){var m=e.call(this,b,c,d,f,h,k)||this;return m.interaxialDistance=i,m.setCameraRigMode(ab.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:i}),m}return v.d(a,e),a.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},a}(Bc);s.a.AddNodeConstructor("AnaglyphFreeCamera",function(e,a,b){return function(){return new og(e,j.x.Zero(),b.interaxial_distance,a)}});var og=function(e){function a(b,c,d,f){var h=e.call(this,b,c,f)||this;return h.interaxialDistance=d,h.setCameraRigMode(ab.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:d}),h}return v.d(a,e),a.prototype.getClassName=function(){return"AnaglyphFreeCamera"},a}(Wb);s.a.AddNodeConstructor("AnaglyphGamepadCamera",function(e,a,b){return function(){return new pg(e,j.x.Zero(),b.interaxial_distance,a)}});var pg=function(e){function a(b,c,d,f){var h=e.call(this,b,c,f)||this;return h.interaxialDistance=d,h.setCameraRigMode(ab.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:d}),h}return v.d(a,e),a.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},a}(Cd);s.a.AddNodeConstructor("AnaglyphUniversalCamera",function(e,a,b){return function(){return new qg(e,j.x.Zero(),b.interaxial_distance,a)}});var qg=function(e){function a(b,c,d,f){var h=e.call(this,b,c,f)||this;return h.interaxialDistance=d,h.setCameraRigMode(ab.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:d}),h}return v.d(a,e),a.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},a}(Hc),Pi=`const vec3 TWO=vec3(2.0,2.0,2.0);
varying vec2 vUV;
uniform sampler2D camASampler;
uniform sampler2D textureSampler;
uniform vec2 stepSize;
void main(void)
{
bool useCamB;
vec2 texCoord1;
vec2 texCoord2;
vec3 frag1;
vec3 frag2;
#ifdef IS_STEREOSCOPIC_HORIZ
useCamB=vUV.x>0.5;
texCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);
texCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);
#else
useCamB=vUV.y>0.5;
texCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);
texCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);
#endif

if (useCamB){
frag1=texture2D(textureSampler,texCoord1).rgb;
frag2=texture2D(textureSampler,texCoord2).rgb;
}else{
frag1=texture2D(camASampler ,texCoord1).rgb;
frag2=texture2D(camASampler ,texCoord2).rgb;
}
gl_FragColor=vec4((frag1+frag2)/TWO,1.0);
}`;Ia.a.ShadersStore.stereoscopicInterlacePixelShader=Pi;var rg=function(e){function a(b,c,d,f,h,i){var k=e.call(this,b,"stereoscopicInterlace",["stepSize"],["camASampler"],1,c[1],f,h,i,d?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return k._passedProcess=c[0]._rigPostProcess,k._stepSize=new j.w(1/k.width,1/k.height),k.onSizeChangedObservable.add(function(){k._stepSize=new j.w(1/k.width,1/k.height)}),k.onApplyObservable.add(function(m){m.setTextureFromPostProcess("camASampler",k._passedProcess),m.setFloat2("stepSize",k._stepSize.x,k._stepSize.y)}),k}return v.d(a,e),a}(Za);ab.a._setStereoscopicRigMode=function(e){var a=e.cameraRigMode===ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||e.cameraRigMode===ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;e._rigCameras[0]._rigPostProcess=new sc(e.name+"_passthru",1,e._rigCameras[0]),e._rigCameras[1]._rigPostProcess=new rg(e.name+"_stereoInterlace",e._rigCameras,a)},s.a.AddNodeConstructor("StereoscopicArcRotateCamera",function(e,a,b){return function(){return new sg(e,0,0,1,j.x.Zero(),b.interaxial_distance,b.isStereoscopicSideBySide,a)}});var sg=function(e){function a(b,c,d,f,h,i,k,m){var B=e.call(this,b,c,d,f,h,m)||this;return B.interaxialDistance=i,B.isStereoscopicSideBySide=k,B.setCameraRigMode(k?ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:ab.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:i}),B}return v.d(a,e),a.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},a}(Bc);s.a.AddNodeConstructor("StereoscopicFreeCamera",function(e,a,b){return function(){return new tg(e,j.x.Zero(),b.interaxial_distance,b.isStereoscopicSideBySide,a)}});var tg=function(e){function a(b,c,d,f,h){var i=e.call(this,b,c,h)||this;return i.interaxialDistance=d,i.isStereoscopicSideBySide=f,i.setCameraRigMode(f?ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:ab.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:d}),i}return v.d(a,e),a.prototype.getClassName=function(){return"StereoscopicFreeCamera"},a}(Wb);s.a.AddNodeConstructor("StereoscopicGamepadCamera",function(e,a,b){return function(){return new ug(e,j.x.Zero(),b.interaxial_distance,b.isStereoscopicSideBySide,a)}});var ug=function(e){function a(b,c,d,f,h){var i=e.call(this,b,c,h)||this;return i.interaxialDistance=d,i.isStereoscopicSideBySide=f,i.setCameraRigMode(f?ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:ab.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:d}),i}return v.d(a,e),a.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},a}(Cd);s.a.AddNodeConstructor("StereoscopicFreeCamera",function(e,a,b){return function(){return new vg(e,j.x.Zero(),b.interaxial_distance,b.isStereoscopicSideBySide,a)}});var vg=function(e){function a(b,c,d,f,h){var i=e.call(this,b,c,h)||this;return i.interaxialDistance=d,i.isStereoscopicSideBySide=f,i.setCameraRigMode(f?ab.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:ab.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:d}),i}return v.d(a,e),a.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},a}(Hc);s.a.AddNodeConstructor("VirtualJoysticksCamera",function(e,a){return function(){return new wg(e,j.x.Zero(),a)}});var wg=function(e){function a(b,c,d){var f=e.call(this,b,c,d)||this;return f.inputs.addVirtualJoystick(),f}return v.d(a,e),a.prototype.getClassName=function(){return"VirtualJoysticksCamera"},a}(Wb),Ic=function(){function e(){this.compensateDistortion=!0,this.multiviewEnabled=!1}return Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftHMatrix",{get:function(){var a=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return j.j.Translation(a,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightHMatrix",{get:function(){var a=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return j.j.Translation(-a,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPreViewMatrix",{get:function(){return j.j.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPreViewMatrix",{get:function(){return j.j.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),e.GetDefault=function(){var a=new e();return a.hResolution=1280,a.vResolution=800,a.hScreenSize=.149759993,a.vScreenSize=.0935999975,a.vScreenCenter=.0467999987,a.eyeToScreenDistance=.0410000011,a.lensSeparationDistance=.063500002,a.interpupillaryDistance=.064000003,a.distortionK=[1,.219999999,.239999995,0],a.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],a.postProcessScaleFactor=1.714605507808412,a.lensCenterOffset=.151976421,a},e}(),Qi=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 LensCenter;
uniform vec2 Scale;
uniform vec2 ScaleIn;
uniform vec4 HmdWarpParam;
vec2 HmdWarp(vec2 in01) {
vec2 theta=(in01-LensCenter)*ScaleIn;
float rSq=theta.x*theta.x+theta.y*theta.y;
vec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);
return LensCenter+Scale*rvector;
}
void main(void)
{
vec2 tc=HmdWarp(vUV);
if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)
gl_FragColor=vec4(0.0,0.0,0.0,0.0);
else{
gl_FragColor=texture2D(textureSampler,tc);
}
}`;Ia.a.ShadersStore.vrDistortionCorrectionPixelShader=Qi;var Fe=function(e){function a(b,c,d,f){var h=e.call(this,b,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,f.postProcessScaleFactor,c,ra.a.BILINEAR_SAMPLINGMODE)||this;return h._isRightEye=d,h._distortionFactors=f.distortionK,h._postProcessScaleFactor=f.postProcessScaleFactor,h._lensCenterOffset=f.lensCenterOffset,h.adaptScaleToCurrentViewport=!0,h.onSizeChangedObservable.add(function(){h._scaleIn=new j.w(2,2/h.aspectRatio),h._scaleFactor=new j.w(1/h._postProcessScaleFactor*.5,1/h._postProcessScaleFactor*.5*h.aspectRatio),h._lensCenter=new j.w(h._isRightEye?.5-.5*h._lensCenterOffset:.5+.5*h._lensCenterOffset,.5)}),h.onApplyObservable.add(function(i){i.setFloat2("LensCenter",h._lensCenter.x,h._lensCenter.y),i.setFloat2("Scale",h._scaleFactor.x,h._scaleFactor.y),i.setFloat2("ScaleIn",h._scaleIn.x,h._scaleIn.y),i.setFloat4("HmdWarpParam",h._distortionFactors[0],h._distortionFactors[1],h._distortionFactors[2],h._distortionFactors[3])}),h}return v.d(a,e),a}(Za),Ri=`#ifdef GL_ES
precision mediump sampler2DArray;
#endif
varying vec2 vUV;
uniform sampler2DArray multiviewSampler;
uniform int imageIndex;
void main(void)
{
gl_FragColor=texture(multiviewSampler,vec3(vUV,imageIndex));
}`;Ia.a.ShadersStore.vrMultiviewToSingleviewPixelShader=Ri;var xg=l(63),yg=l(83),Ge=l(91);va.b.prototype.createRenderTargetCubeTexture=function(e,a){var b=v.a({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:va.b.TEXTURETYPE_UNSIGNED_INT,samplingMode:va.b.TEXTURE_TRILINEAR_SAMPLINGMODE,format:va.b.TEXTUREFORMAT_RGBA},a);b.generateStencilBuffer=b.generateDepthBuffer&&b.generateStencilBuffer,(b.type!==va.b.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(b.type!==va.b.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(b.samplingMode=va.b.TEXTURE_NEAREST_SAMPLINGMODE);var c=this._gl,d=new sb.a(this,sb.a.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,d,!0);var f=this._getSamplingParameters(b.samplingMode,b.generateMipMaps);b.type!==va.b.TEXTURETYPE_FLOAT||this._caps.textureFloat||(b.type=va.b.TEXTURETYPE_UNSIGNED_INT,r.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,f.mag),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,f.min),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);for(var h=0;h<6;h++)c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,this._getRGBABufferInternalSizedFormat(b.type,b.format),e,e,0,this._getInternalFormat(b.format),this._getWebGLTextureType(b.type),null);var i=c.createFramebuffer();return this._bindUnboundFramebuffer(i),d._depthStencilBuffer=this._setupFramebufferDepthAttachments(b.generateStencilBuffer,b.generateDepthBuffer,e,e),b.generateMipMaps&&c.generateMipmap(c.TEXTURE_CUBE_MAP),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null),c.bindRenderbuffer(c.RENDERBUFFER,null),this._bindUnboundFramebuffer(null),d._framebuffer=i,d.width=e,d.height=e,d.isReady=!0,d.isCube=!0,d.samples=1,d.generateMipMaps=b.generateMipMaps,d.samplingMode=b.samplingMode,d.type=b.type,d.format=b.format,d._generateDepthBuffer=b.generateDepthBuffer,d._generateStencilBuffer=b.generateStencilBuffer,this._internalTexturesCache.push(d),d};var Ab=function(e){function a(b,c,d,f,h,i,k,m,B,E,K,P,S){void 0===h&&(h=!0),void 0===i&&(i=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===k&&(k=!1),void 0===m&&(m=ra.a.TRILINEAR_SAMPLINGMODE),void 0===B&&(B=!0),void 0===E&&(E=!1),void 0===K&&(K=!1),void 0===P&&(P=o.a.TEXTUREFORMAT_RGBA),void 0===S&&(S=!1);var U=e.call(this,null,d,!f)||this;return U.isCube=k,U.renderParticles=!0,U.renderSprites=!1,U.coordinatesMode=ra.a.PROJECTION_MODE,U.ignoreCameraViewport=!1,U.onBeforeBindObservable=new q.c(),U.onAfterUnbindObservable=new q.c(),U.onBeforeRenderObservable=new q.c(),U.onAfterRenderObservable=new q.c(),U.onClearObservable=new q.c(),U._currentRefreshId=-1,U._refreshRate=1,U._samples=1,U.boundingBoxPosition=j.x.Zero(),(d=U.getScene())?(U.renderList=new Array(),U._engine=d.getEngine(),U.name=b,U.isRenderTarget=!0,U._initialSizeParameter=c,U._processSizeParameter(c),U._resizeObserver=U.getScene().getEngine().onResizeObservable.add(function(){}),U._generateMipMaps=!!f,U._doNotChangeAspectRatio=h,U._renderingManager=new Ge.b(d),U._renderingManager._useSceneAutoClearSetup=!0,K?U:(U._renderTargetOptions={generateMipMaps:f,type:i,format:P,samplingMode:m,generateDepthBuffer:B,generateStencilBuffer:E},m===ra.a.NEAREST_SAMPLINGMODE&&(U.wrapU=ra.a.CLAMP_ADDRESSMODE,U.wrapV=ra.a.CLAMP_ADDRESSMODE),S||(k?(U._texture=d.getEngine().createRenderTargetCubeTexture(U.getRenderSize(),U._renderTargetOptions),U.coordinatesMode=ra.a.INVCUBIC_MODE,U._textureMatrix=j.j.Identity()):U._texture=d.getEngine().createRenderTargetTexture(U._size,U._renderTargetOptions)),U)):U}return v.d(a,e),Object.defineProperty(a.prototype,"renderList",{get:function(){return this._renderList},set:function(b){this._renderList=b,this._renderList&&this._hookArray(this._renderList)},enumerable:!0,configurable:!0}),a.prototype._hookArray=function(b){var c=this,d=b.push;b.push=function(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];var k=0===b.length,m=d.apply(b,h);return k&&c.getScene().meshes.forEach(function(B){B._markSubMeshesAsLightDirty()}),m};var f=b.splice;b.splice=function(h,i){var k=f.apply(b,[h,i]);return 0===b.length&&c.getScene().meshes.forEach(function(m){m._markSubMeshesAsLightDirty()}),k}},Object.defineProperty(a.prototype,"onAfterUnbind",{set:function(b){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onBeforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onAfterRender",{set:function(b){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onClear",{set:function(b){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),a.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(a.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(b){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(b)){this._boundingBoxSize=b;var c=this.getScene();c&&c.markAllMaterialsAsDirty(o.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),a.prototype.createDepthStencilTexture=function(b,c,d){if(void 0===b&&(b=0),void 0===c&&(c=!0),void 0===d&&(d=!1),this.getScene()){var f=this.getScene().getEngine();this.depthStencilTexture=f.createDepthStencilTexture(this._size,{bilinearFiltering:c,comparisonFunction:b,generateStencil:d,isCube:this.isCube}),f.setFrameBufferDepthStencilTexture(this)}},a.prototype._processSizeParameter=function(b){b.ratio?(this._sizeRatio=b.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=b},Object.defineProperty(a.prototype,"samples",{get:function(){return this._samples},set:function(b){if(this._samples!==b){var c=this.getScene();c&&(this._samples=c.getEngine().updateRenderTargetTextureSampleCount(this._texture,b))}},enumerable:!0,configurable:!0}),a.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(a.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(b){this._refreshRate=b,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),a.prototype.addPostProcess=function(b){if(!this._postProcessManager){var c=this.getScene();if(!c)return;this._postProcessManager=new yg.a(c),this._postProcesses=new Array()}this._postProcesses.push(b),this._postProcesses[0].autoClear=!1},a.prototype.clearPostProcesses=function(b){if(void 0===b&&(b=!1),this._postProcesses){if(b)for(var c=0,d=this._postProcesses;c<d.length;c++)d[c].dispose();this._postProcesses=[]}},a.prototype.removePostProcess=function(b){if(this._postProcesses){var c=this._postProcesses.indexOf(b);-1!==c&&(this._postProcesses.splice(c,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},a.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},a.prototype.getRenderSize=function(){return this.getRenderWidth()},a.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},a.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},Object.defineProperty(a.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),a.prototype.scale=function(b){var c=this.getRenderSize()*b;this.resize(c)},a.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:e.prototype.getReflectionTextureMatrix.call(this)},a.prototype.resize=function(b){var c=this.isCube;this.releaseInternalTexture();var d=this.getScene();d&&(this._processSizeParameter(b),this._texture=c?d.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):d.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions))},a.prototype.render=function(b,c){if(void 0===b&&(b=!1),void 0===c&&(c=!1),m=this.getScene()){var d,f=m.getEngine();if(void 0!==this.useCameraPostProcesses&&(b=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var h=0;h<this._waitingRenderList.length;h++){var i=this._waitingRenderList[h],k=m.getMeshByID(i);k&&this.renderList.push(k)}delete this._waitingRenderList}if(this.renderListPredicate){var m;if(this.renderList?this.renderList.length=0:this.renderList=[],!(m=this.getScene()))return;var B=m.meshes;for(h=0;h<B.length;h++){var E=B[h];this.renderListPredicate(E)&&this.renderList.push(E)}}this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(d=this.activeCamera,f.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==m.activeCamera&&m.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(d=m.activeCamera)&&f.setViewport(d.viewport,this.getRenderWidth(),this.getRenderHeight()),this._renderingManager.reset();for(var K=this.renderList?this.renderList:m.getActiveMeshes().data,P=this.renderList?this.renderList.length:m.getActiveMeshes().length,S=m.getRenderId(),U=0;U<P;U++)if(E=K[U]){if(!E.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}E._preActivateForIntermediateRendering(S);var _;if(_=!(this.renderList||!d)&&0==(E.layerMask&d.layerMask),E.isEnabled()&&E.isVisible&&E.subMeshes&&!_&&E._activate(S,!0)){E.isAnInstance?E=E.sourceMesh:E._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,E._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var da=0;da<E.subMeshes.length;da++){var fa=E.subMeshes[da];m._activeIndices.addCount(fa.indexCount,!1),this._renderingManager.dispatch(fa,E)}}}for(var ga=0;ga<m.particleSystems.length;ga++){var ha=m.particleSystems[ga],ka=ha.emitter;ha.isStarted()&&ka&&ka.position&&ka.isEnabled()&&(K.indexOf(ka)>=0&&this._renderingManager.dispatchParticles(ha))}if(this.isCube)for(var la=0;la<6;la++)this.renderToTarget(la,K,b,c),m.incrementRenderId(),m.resetCachedMaterial();else this.renderToTarget(0,K,b,c);this.onAfterUnbindObservable.notifyObservers(this),m.activeCamera&&(this.activeCamera&&this.activeCamera!==m.activeCamera&&m.setTransformMatrix(m.activeCamera.getViewMatrix(),m.activeCamera.getProjectionMatrix(!0)),f.setViewport(m.activeCamera.viewport)),m.resetCachedMaterial()}},a.prototype._bestReflectionRenderTargetDimension=function(b,c){var d=b*c,f=xa.h.NearestPOT(d+16384/(128+d));return Math.min(xa.h.FloorPOT(b),f)},a.prototype._bindFrameBuffer=function(b){void 0===b&&(b=0);var c=this.getScene();if(c){var d=c.getEngine();this._texture&&d.bindFramebuffer(this._texture,this.isCube?b:void 0,void 0,void 0,this.ignoreCameraViewport,this.depthStencilTexture?this.depthStencilTexture:void 0)}},a.prototype.unbindFrameBuffer=function(b,c){var d=this;this._texture&&b.unBindFramebuffer(this._texture,this.isCube,function(){d.onAfterRenderObservable.notifyObservers(c)})},a.prototype.renderToTarget=function(b,c,d,f){var h=this.getScene();if(h){var i=h.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):d&&h.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(b),this.onBeforeRenderObservable.notifyObservers(b),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(i):i.clear(this.clearColor||h.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||h.updateTransformMatrix(!0);for(var k=0,m=h._beforeRenderTargetDrawStage;k<m.length;k++)m[k].action(this);this._renderingManager.render(this.customRenderFunction,c,this.renderParticles,this.renderSprites);for(var B=0,E=h._afterRenderTargetDrawStage;B<E.length;B++)E[B].action(this);this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,b,this._postProcesses,this.ignoreCameraViewport):d&&h.postProcessManager._finalizeFrame(!1,this._texture,b),this._doNotChangeAspectRatio||h.updateTransformMatrix(!0),f&&xa.h.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),i),this.isCube&&5!==b?this.onAfterRenderObservable.notifyObservers(b):(this.isCube&&5===b&&i.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(i,b))}}},a.prototype.setRenderingOrder=function(b,c,d,f){void 0===c&&(c=null),void 0===d&&(d=null),void 0===f&&(f=null),this._renderingManager.setRenderingOrder(b,c,d,f)},a.prototype.setRenderingAutoClearDepthStencil=function(b,c){this._renderingManager.setRenderingAutoClearDepthStencil(b,c),this._renderingManager._useSceneAutoClearSetup=!1},a.prototype.clone=function(){var b=this.getSize(),c=new a(this.name,b,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return c.hasAlpha=this.hasAlpha,c.level=this.level,c.coordinatesMode=this.coordinatesMode,this.renderList&&(c.renderList=this.renderList.slice(0)),c},a.prototype.serialize=function(){if(!this.name)return null;var b=e.prototype.serialize.call(this);if(b.renderTargetSize=this.getRenderSize(),b.renderList=[],this.renderList)for(var c=0;c<this.renderList.length;c++)b.renderList.push(this.renderList[c].id);return b},a.prototype.disposeFramebufferObjects=function(){var b=this.getInternalTexture(),c=this.getScene();b&&c&&c.getEngine()._releaseFramebufferObjects(b)},a.prototype.dispose=function(){this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var b=this.getScene();if(b){var c=b.customRenderTargets.indexOf(this);c>=0&&b.customRenderTargets.splice(c,1);for(var d=0,f=b.cameras;d<f.length;d++){var h=f[d];(c=h.customRenderTargets.indexOf(this))>=0&&h.customRenderTargets.splice(c,1)}e.prototype.dispose.call(this)}},a.prototype._rebuild=function(){this.refreshRate===a.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=a.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},a.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},a.prototype.getViewCount=function(){return 1},a.REFRESHRATE_RENDER_ONCE=0,a.REFRESHRATE_RENDER_ONEVERYFRAME=1,a.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,a}(ra.a);ra.a._CreateRenderTargetTexture=function(e,a,b,c){return new Ab(e,a,b,c)};var zg=function(e){function a(b,c){void 0===c&&(c=512);var d=e.call(this,"multiview rtt",c,b,!1,!0,sb.a.DATASOURCE_UNKNOWN,!1,void 0,!1,!1,!0,void 0,!0)||this,f=b.getEngine().createMultiviewRenderTargetTexture(d.getRenderWidth(),d.getRenderHeight());return f.isMultiview=!0,d._texture=f,d}return v.d(a,e),a.prototype._bindFrameBuffer=function(b){void 0===b&&(b=0),this._texture&&this.getScene().getEngine().bindMultiviewFramebuffer(this._texture)},a.prototype.getViewCount=function(){return 2},a}(Ab);va.b.prototype.createMultiviewRenderTargetTexture=function(e,a){var b=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";var c=new sb.a(this,sb.a.DATASOURCE_UNKNOWN,!0);return c.width=e,c.height=a,c._framebuffer=b.createFramebuffer(),c._colorTextureArray=b.createTexture(),b.bindTexture(b.TEXTURE_2D_ARRAY,c._colorTextureArray),b.texStorage3D(b.TEXTURE_2D_ARRAY,1,b.RGBA8,e,a,2),c._depthStencilTextureArray=b.createTexture(),b.bindTexture(b.TEXTURE_2D_ARRAY,c._depthStencilTextureArray),b.texStorage3D(b.TEXTURE_2D_ARRAY,1,b.DEPTH32F_STENCIL8,e,a,2),c.isReady=!0,c},va.b.prototype.bindMultiviewFramebuffer=function(e){var a=this._gl,b=this.getCaps().multiview;if(this.bindFramebuffer(e,void 0,void 0,void 0,!0),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,e._framebuffer),!e._colorTextureArray||!e._depthStencilTextureArray)throw"Invalid multiview frame buffer";b.framebufferTextureMultiviewOVR(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,e._colorTextureArray,0,0,2),b.framebufferTextureMultiviewOVR(a.DRAW_FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,e._depthStencilTextureArray,0,0,2)},ab.a.prototype._useMultiviewToSingleView=!1,ab.a.prototype._multiviewTexture=null,ab.a.prototype._resizeOrCreateMultiviewTexture=function(e,a){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==e&&this._multiviewTexture.getRenderHeight()==a||(this._multiviewTexture.dispose(),this._multiviewTexture=new zg(this.getScene(),{width:e,height:a})):this._multiviewTexture=new zg(this.getScene(),{width:e,height:a})},ja.a.prototype._transformMatrixR=j.j.Zero(),ja.a.prototype._multiviewSceneUbo=null,ja.a.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=new xg.a(this.getEngine(),void 0,!0),this._multiviewSceneUbo.addUniform("viewProjection",16),this._multiviewSceneUbo.addUniform("viewProjectionR",16),this._multiviewSceneUbo.addUniform("view",16)},ja.a.prototype._updateMultiviewUbo=function(e,a){e&&a&&e.multiplyToRef(a,this._transformMatrixR),e&&a&&(e.multiplyToRef(a,j.t.Matrix[0]),j.i.GetRightPlaneToRef(j.t.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.update())},ja.a.prototype._renderMultiviewToSingleView=function(e){e._resizeOrCreateMultiviewTexture(e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.width>0?e._rigPostProcess.width/2:this.getEngine().getRenderWidth(!0)/2,e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.height>0?e._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),e.outputRenderTarget=e._multiviewTexture,this._renderForCamera(e),e.outputRenderTarget=null;for(var a=0;a<e._rigCameras.length;a++){var b=this.getEngine();this._activeCamera=e._rigCameras[a],b.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}};var He=function(e){function a(b,c,d){var f=e.call(this,b,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],d,c,ra.a.BILINEAR_SAMPLINGMODE)||this;return f.onSizeChangedObservable.add(function(){}),f.onApplyObservable.add(function(h){c._scene.activeCamera&&c._scene.activeCamera.isLeftCamera?h.setInt("imageIndex",0):h.setInt("imageIndex",1),h.setTexture("multiviewSampler",c._multiviewTexture)}),f}return v.d(a,e),a}(Za);ab.a._setVRRigMode=function(e,a){var b=a.vrCameraMetrics||Ic.GetDefault();e._rigCameras[0]._cameraRigParams.vrMetrics=b,e._rigCameras[0].viewport=new j.z(0,0,.5,1),e._rigCameras[0]._cameraRigParams.vrWorkMatrix=new j.j(),e._rigCameras[0]._cameraRigParams.vrHMatrix=b.leftHMatrix,e._rigCameras[0]._cameraRigParams.vrPreViewMatrix=b.leftPreViewMatrix,e._rigCameras[0].getProjectionMatrix=e._rigCameras[0]._getVRProjectionMatrix,e._rigCameras[1]._cameraRigParams.vrMetrics=b,e._rigCameras[1].viewport=new j.z(.5,0,.5,1),e._rigCameras[1]._cameraRigParams.vrWorkMatrix=new j.j(),e._rigCameras[1]._cameraRigParams.vrHMatrix=b.rightHMatrix,e._rigCameras[1]._cameraRigParams.vrPreViewMatrix=b.rightPreViewMatrix,e._rigCameras[1].getProjectionMatrix=e._rigCameras[1]._getVRProjectionMatrix,b.multiviewEnabled&&(e.getScene().getEngine().getCaps().multiview?(e._useMultiviewToSingleView=!0,e._rigPostProcess=new He("VRMultiviewToSingleview",e,b.postProcessScaleFactor)):(r.a.Warn("Multiview is not supported, falling back to standard rendering"),b.multiviewEnabled=!1)),b.compensateDistortion&&(e._rigCameras[0]._rigPostProcess=new Fe("VR_Distort_Compensation_Left",e._rigCameras[0],!1,b),e._rigCameras[1]._rigPostProcess=new Fe("VR_Distort_Compensation_Right",e._rigCameras[1],!0,b))},s.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(e,a){return function(){return new Ag(e,0,0,1,j.x.Zero(),a)}});var Ag=function(e){function a(b,c,d,f,h,i,k,m){void 0===k&&(k=!0),void 0===m&&(m=Ic.GetDefault());var B=e.call(this,b,c,d,f,h,i)||this;return m.compensateDistortion=k,B.setCameraRigMode(ab.a.RIG_MODE_VR,{vrCameraMetrics:m}),B.inputs.addVRDeviceOrientation(),B}return v.d(a,e),a.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},a}(Bc);s.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(e,a){return function(){return new Dd(e,j.x.Zero(),a)}});var Dd=function(e){function a(b,c,d,f,h){void 0===f&&(f=!0),void 0===h&&(h=Ic.GetDefault());var i=e.call(this,b,c,d)||this;return h.compensateDistortion=f,i.setCameraRigMode(ab.a.RIG_MODE_VR,{vrCameraMetrics:h}),i}return v.d(a,e),a.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},a}(Bd);s.a.AddNodeConstructor("VRDeviceOrientationGamepadCamera",function(e,a){return function(){return new Bg(e,j.x.Zero(),a)}});var Bg=function(e){function a(b,c,d,f,h){void 0===f&&(f=!0),void 0===h&&(h=Ic.GetDefault());var i=e.call(this,b,c,d,f,h)||this;return i.inputs.addGamepad(),i}return v.d(a,e),a.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},a}(Dd),Ed=l(65);ab.a._setWebVRRigMode=function(e,a){if(a.vrDisplay){var b=a.vrDisplay.getEyeParameters("left"),c=a.vrDisplay.getEyeParameters("right");e._rigCameras[0].viewport=new j.z(0,0,.5,1),e._rigCameras[0].setCameraRigParameter("left",!0),e._rigCameras[0].setCameraRigParameter("specs",a.specs),e._rigCameras[0].setCameraRigParameter("eyeParameters",b),e._rigCameras[0].setCameraRigParameter("frameData",a.frameData),e._rigCameras[0].setCameraRigParameter("parentCamera",a.parentCamera),e._rigCameras[0]._cameraRigParams.vrWorkMatrix=new j.j(),e._rigCameras[0].getProjectionMatrix=e._getWebVRProjectionMatrix,e._rigCameras[0].parent=e,e._rigCameras[0]._getViewMatrix=e._getWebVRViewMatrix,e._rigCameras[1].viewport=new j.z(.5,0,.5,1),e._rigCameras[1].setCameraRigParameter("eyeParameters",c),e._rigCameras[1].setCameraRigParameter("specs",a.specs),e._rigCameras[1].setCameraRigParameter("frameData",a.frameData),e._rigCameras[1].setCameraRigParameter("parentCamera",a.parentCamera),e._rigCameras[1]._cameraRigParams.vrWorkMatrix=new j.j(),e._rigCameras[1].getProjectionMatrix=e._getWebVRProjectionMatrix,e._rigCameras[1].parent=e,e._rigCameras[1]._getViewMatrix=e._getWebVRViewMatrix}},Object.defineProperty(va.b.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),va.b.prototype._prepareVRComponent=function(){this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.onVRDisplayChangedObservable=new q.c(),this.onVRRequestPresentComplete=new q.c(),this.onVRRequestPresentStart=new q.c()},va.b.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},va.b.prototype.getVRDevice=function(){return this._vrDisplay},va.b.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},va.b.prototype.initWebVRAsync=function(){var e=this,a=function(){var b={vrDisplay:e._vrDisplay,vrSupported:e._vrSupported};e.onVRDisplayChangedObservable.notifyObservers(b),e._webVRInitPromise=new Promise(function(c){c(b)})};return this._onVrDisplayConnect||(this._onVrDisplayConnect=function(b){e._vrDisplay=b.display,a()},this._onVrDisplayDisconnect=function(){e._vrDisplay.cancelAnimationFrame(e._frameHandler),e._vrDisplay=void 0,e._frameHandler=xa.h.QueueNewFrame(e._bindedRenderFunction),a()},this._onVrDisplayPresentChange=function(){e._vrExclusivePointerMode=e._vrDisplay&&e._vrDisplay.isPresenting},window.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange)),this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(a),this._webVRInitPromise},va.b.prototype._getVRDisplaysAsync=function(){var e=this;return new Promise(function(a){navigator.getVRDisplays?navigator.getVRDisplays().then(function(b){e._vrSupported=!0,e._vrDisplay=b[0],a({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported})}):(e._vrDisplay=void 0,e._vrSupported=!1,a({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported}))})},va.b.prototype.enableVR=function(){var e=this;this._vrDisplay&&!this._vrDisplay.isPresenting&&(this.onVRRequestPresentStart.notifyObservers(this),this._vrDisplay.requestPresent([{source:this.getRenderingCanvas()}]).then(function(){e.onVRRequestPresentComplete.notifyObservers(!0),e._onVRFullScreenTriggered()}).catch(function(){e.onVRRequestPresentComplete.notifyObservers(!1)}))},va.b.prototype._onVRFullScreenTriggered=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting){this._oldSize=new j.r(this.getRenderWidth(),this.getRenderHeight()),this._oldHardwareScaleFactor=this.getHardwareScalingLevel();var e=this._vrDisplay.getEyeParameters("left");this.setHardwareScalingLevel(1),this.setSize(2*e.renderWidth,e.renderHeight)}else this.setHardwareScalingLevel(this._oldHardwareScaleFactor),this.setSize(this._oldSize.width,this._oldSize.height)},va.b.prototype.disableVR=function(){var e=this;this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(function(){return e._onVRFullScreenTriggered()}).catch(function(){return e._onVRFullScreenTriggered()}),Ee.a.IsWindowObjectExist()&&(window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null))},va.b.prototype._connectVREvents=function(e,a){this._onVRDisplayPointerRestricted=function(){e&&e.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){a.exitPointerLock&&a.exitPointerLock()},Ee.a.IsWindowObjectExist()&&(window.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),window.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1))},va.b.prototype._submitVRFrame=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting)try{this._vrDisplay.submitFrame()}catch(e){xa.h.Warn("webVR submitFrame has had an unexpected failure: "+e)}},va.b.prototype.isVRPresenting=function(){return this._vrDisplay&&this._vrDisplay.isPresenting},va.b.prototype._requestVRFrame=function(){this._frameHandler=xa.h.QueueNewFrame(this._bindedRenderFunction,this._vrDisplay)},s.a.AddNodeConstructor("WebVRFreeCamera",function(e,a){return function(){return new Fd(e,j.x.Zero(),a)}}),s.a.AddNodeConstructor("WebVRGamepadCamera",function(e,a){return function(){return new Fd(e,j.x.Zero(),a)}});var Fd=function(e){function a(b,c,d,f){void 0===f&&(f={});var h=e.call(this,b,c,d)||this;h.webVROptions=f,h._vrDevice=null,h.rawPose=null,h._specsVersion="1.1",h._attached=!1,h._descendants=[],h._deviceRoomPosition=j.x.Zero(),h._deviceRoomRotationQuaternion=j.q.Identity(),h._standingMatrix=null,h.devicePosition=j.x.Zero(),h.deviceRotationQuaternion=j.q.Identity(),h.deviceScaleFactor=1,h._deviceToWorld=j.j.Identity(),h._worldToDevice=j.j.Identity(),h.controllers=[],h.onControllersAttachedObservable=new q.c(),h.onControllerMeshLoadedObservable=new q.c(),h.onPoseUpdatedFromDeviceObservable=new q.c(),h._poseSet=!1,h.rigParenting=!0,h._defaultHeight=void 0,h._htmlElementAttached=null,h._detachIfAttached=function(){var k=h.getEngine().getVRDevice();k&&!k.isPresenting&&h._htmlElementAttached&&h.detachControl(h._htmlElementAttached)},h._workingVector=j.x.Zero(),h._oneVector=j.x.One(),h._workingMatrix=j.j.Identity(),h._tmpMatrix=new j.j(),h._cache.position=j.x.Zero(),f.defaultHeight&&(h._defaultHeight=f.defaultHeight,h.position.y=h._defaultHeight),h.minZ=.1,5===arguments.length&&(h.webVROptions=arguments[4]),null==h.webVROptions.trackPosition&&(h.webVROptions.trackPosition=!0),null==h.webVROptions.controllerMeshes&&(h.webVROptions.controllerMeshes=!0),null==h.webVROptions.defaultLightingOnControllers&&(h.webVROptions.defaultLightingOnControllers=!0),h.rotationQuaternion=new j.q(),h.webVROptions&&h.webVROptions.positionScale&&(h.deviceScaleFactor=h.webVROptions.positionScale);var i=h.getEngine();return h._onVREnabled=function(k){k&&h.initControllers()},i.onVRRequestPresentComplete.add(h._onVREnabled),i.initWebVR().add(function(k){k.vrDisplay&&h._vrDevice!==k.vrDisplay&&(h._vrDevice=k.vrDisplay,h.setCameraRigMode(ab.a.RIG_MODE_WEBVR,{parentCamera:h,vrDisplay:h._vrDevice,frameData:h._frameData,specs:h._specsVersion}),h._attached&&h.getEngine().enableVR())}),"undefined"!=typeof VRFrameData&&(h._frameData=new VRFrameData()),f.useMultiview&&(h.getScene().getEngine().getCaps().multiview?(h._useMultiviewToSingleView=!0,h._rigPostProcess=new He("VRMultiviewToSingleview",h,1)):(r.a.Warn("Multiview is not supported, falling back to standard rendering"),h._useMultiviewToSingleView=!1)),d.onBeforeCameraRenderObservable.add(function(k){k.parent===h&&h.rigParenting&&(h._descendants=h.getDescendants(!0,function(m){var B=h.controllers.some(function(K){return K._mesh===m}),E=-1!==h._rigCameras.indexOf(m);return!B&&!E}),h._descendants.forEach(function(m){m.parent=k}))}),d.onAfterCameraRenderObservable.add(function(k){k.parent===h&&h.rigParenting&&h._descendants.forEach(function(m){m.parent=h})}),h}return v.d(a,e),a.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},a.prototype.useStandingMatrix=function(b){var c=this;void 0===b&&(b=function(d){}),this.getEngine().initWebVRAsync().then(function(d){d.vrDisplay&&d.vrDisplay.stageParameters&&d.vrDisplay.stageParameters.sittingToStandingTransform&&c.webVROptions.trackPosition?(c._standingMatrix=new j.j(),j.j.FromFloat32ArrayToRefScaled(d.vrDisplay.stageParameters.sittingToStandingTransform,0,1,c._standingMatrix),c.getScene().useRightHandedSystem||c._standingMatrix&&c._standingMatrix.toggleModelMatrixHandInPlace(),b(!0)):b(!1)})},a.prototype.useStandingMatrixAsync=function(){var b=this;return new Promise(function(c){b.useStandingMatrix(function(d){c(d)})})},a.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),e.prototype.dispose.call(this)},a.prototype.getControllerByName=function(b){for(var c=0,d=this.controllers;c<d.length;c++){var f=d[c];if(f.hand===b)return f}return null},Object.defineProperty(a.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!0,configurable:!0}),a.prototype.getForwardRay=function(b){return void 0===b&&(b=100),this.leftCamera?e.prototype.getForwardRay.call(this,b,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):e.prototype.getForwardRay.call(this,b)},a.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),e.prototype._checkInputs.call(this)},a.prototype.updateFromDevice=function(b){b&&b.orientation&&(this.rawPose=b,this._deviceRoomRotationQuaternion.copyFromFloats(b.orientation[0],b.orientation[1],-b.orientation[2],-b.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},a.prototype.attachControl=function(b,c){e.prototype.attachControl.call(this,b,c),this._attached=!0,this._htmlElementAttached=b,c=!ab.a.ForceAttachControlToAlwaysPreventDefault&&c,this._vrDevice&&this.getEngine().enableVR(),window.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},a.prototype.detachControl=function(b){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),e.prototype.detachControl.call(this,b),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},a.prototype.getClassName=function(){return"WebVRFreeCamera"},a.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},a.prototype._updateRigCameras=function(){var b=this._rigCameras[0],c=this._rigCameras[1];b.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),c.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),b.position.copyFrom(this._deviceRoomPosition),c.position.copyFrom(this._deviceRoomPosition)},a.prototype._correctPositionIfNotTrackPosition=function(b,c){void 0===c&&(c=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(j.j.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),c||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(b,b))},a.prototype._updateCache=function(b){var c=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),j.x.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),j.j.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(d){d._deviceToWorld.copyFrom(c._deviceToWorld),c._correctPositionIfNotTrackPosition(d._deviceToWorld),d.update()})),b||e.prototype._updateCache.call(this),this.updateCacheCalled=!1},a.prototype._computeDevicePosition=function(){j.x.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},a.prototype.update=function(){this._computeDevicePosition(),j.j.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),j.q.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),e.prototype.update.call(this)},a.prototype._getViewMatrix=function(){return j.j.Identity()},a.prototype._getWebVRViewMatrix=function(){var b=this._cameraRigParams.parentCamera;b._updateCache();var c=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return j.j.FromArrayToRef(c,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),j.x.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),1!==b.deviceScaleFactor&&(this._webvrViewMatrix.invert(),b.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,b.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,b.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,b.deviceScaleFactor)),this._webvrViewMatrix.invert()),b._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),b._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||j.j.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(b.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},a.prototype._getWebVRProjectionMatrix=function(){var b=this.parent;b._vrDevice.depthNear=b.minZ,b._vrDevice.depthFar=b.maxZ;var c=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return j.j.FromArrayToRef(c,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},a.prototype.initControllers=function(){var b=this;this.controllers=[];var c=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=c.onGamepadDisconnectedObservable.add(function(d){if(d.type===Hb.POSE_ENABLED){var f=d;f.defaultModel&&f.defaultModel.setEnabled(!1),"right"===f.hand&&(b._rightController=null),"left"===f.hand&&(b._leftController=null);var h=b.controllers.indexOf(f);-1!==h&&b.controllers.splice(h,1)}}),this._onGamepadConnectedObserver=c.onGamepadConnectedObservable.add(function(d){if(d.type===Hb.POSE_ENABLED){var f=d;if(b.webVROptions.trackPosition||(f._disableTrackPosition(new j.x("left"==f.hand?-.15:.15,-.5,.25)),b._updateCacheWhenTrackingDisabledObserver||(b._updateCacheWhenTrackingDisabledObserver=b._scene.onBeforeRenderObservable.add(function(){b._updateCache()}))),f.deviceScaleFactor=b.deviceScaleFactor,f._deviceToWorld.copyFrom(b._deviceToWorld),b._correctPositionIfNotTrackPosition(f._deviceToWorld),b.webVROptions.controllerMeshes&&(f.defaultModel?f.defaultModel.setEnabled(!0):f.initControllerMesh(b.getScene(),function(k){if(k.scaling.scaleInPlace(b.deviceScaleFactor),b.onControllerMeshLoadedObservable.notifyObservers(f),b.webVROptions.defaultLightingOnControllers){b._lightOnControllers||(b._lightOnControllers=new Ed.a("vrControllersLight",new j.x(0,1,0),b.getScene()));var m=function(B,E){var K=B.getChildren();K&&0!==K.length&&K.forEach(function(P){E.includedOnlyMeshes.push(P),m(P,E)})};b._lightOnControllers.includedOnlyMeshes.push(k),m(k,b._lightOnControllers)}})),f.attachToPoseControlledCamera(b),-1===b.controllers.indexOf(f)){b.controllers.push(f);for(var h=!1,i=0;i<b.controllers.length;i++)b.controllers[i].controllerType===_b.VIVE&&(h?b.controllers[i].hand="right":(h=!0,b.controllers[i].hand="left"));b.controllers.length>=2&&b.onControllersAttachedObservable.notifyObservers(b.controllers)}}})},a}(Wb),tc=function(e){function a(b){var c=e.call(this,b)||this;return c.onTriggerStateChangedObservable=new q.c(),c.onMainButtonStateChangedObservable=new q.c(),c.onSecondaryButtonStateChangedObservable=new q.c(),c.onPadStateChangedObservable=new q.c(),c.onPadValuesChangedObservable=new q.c(),c.pad={x:0,y:0},c._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},c._buttons=new Array(b.buttons.length),c.hand=b.hand,c}return v.d(a,e),a.prototype.onButtonStateChange=function(b){this._onButtonStateChange=b},Object.defineProperty(a.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),a.prototype.update=function(){e.prototype.update.call(this);for(var b=0;b<this._buttons.length;b++)this._setButtonValue(this.browserGamepad.buttons[b],this._buttons[b],b);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},a.prototype._setButtonValue=function(b,c,d){b||(b={pressed:!1,touched:!1,value:0}),c?(this._checkChanges(b,c),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,d,b),this._handleButtonChange(d,b,this._changes)),this._buttons[d].pressed=b.pressed,this._buttons[d].touched=b.touched,this._buttons[d].value=b.value<1e-08?0:b.value):this._buttons[d]={pressed:b.pressed,touched:b.touched,value:b.value}},a.prototype._checkChanges=function(b,c){return this._changes.pressChanged=b.pressed!==c.pressed,this._changes.touchChanged=b.touched!==c.touched,this._changes.valueChanged=b.value!==c.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},a.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},a}(_c),Eb=l(31),Pb=l(33),$c=function(e){function a(b,c,d,f,h,i){void 0===d&&(d=null),void 0===h&&(h=o.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===i&&(i=o.a.TEXTUREFORMAT_RGBA);var k=e.call(this,null,d,!f,void 0,h,void 0,void 0,void 0,void 0,i)||this;k.name=b,k._engine=k.getScene().getEngine(),k.wrapU=ra.a.CLAMP_ADDRESSMODE,k.wrapV=ra.a.CLAMP_ADDRESSMODE,k._generateMipMaps=f,c.getContext?(k._canvas=c,k._texture=k._engine.createDynamicTexture(c.width,c.height,f,h)):(k._canvas=document.createElement("canvas"),c.width||0===c.width?k._texture=k._engine.createDynamicTexture(c.width,c.height,f,h):k._texture=k._engine.createDynamicTexture(c,c,f,h));var m=k.getSize();return k._canvas.width=m.width,k._canvas.height=m.height,k._context=k._canvas.getContext("2d"),k}return v.d(a,e),a.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(a.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),a.prototype._recreate=function(b){this._canvas.width=b.width,this._canvas.height=b.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(b.width,b.height,this._generateMipMaps,this.samplingMode)},a.prototype.scale=function(b){var c=this.getSize();c.width*=b,c.height*=b,this._recreate(c)},a.prototype.scaleTo=function(b,c){var d=this.getSize();d.width=b,d.height=c,this._recreate(d)},a.prototype.getContext=function(){return this._context},a.prototype.clear=function(){var b=this.getSize();this._context.fillRect(0,0,b.width,b.height)},a.prototype.update=function(b,c){void 0===c&&(c=!1),this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===b||b,c,this._format||void 0)},a.prototype.drawText=function(b,c,d,f,h,i,k,m){void 0===m&&(m=!0);var B=this.getSize();if(i&&(this._context.fillStyle=i,this._context.fillRect(0,0,B.width,B.height)),this._context.font=f,null==c){var E=this._context.measureText(b);c=(B.width-E.width)/2}if(null==d){var K=parseInt(f.replace(/\D/g,""));d=B.height/2+K/3.65}this._context.fillStyle=h,this._context.fillText(b,c,d),m&&this.update(k)},a.prototype.clone=function(){var b=this.getScene();if(!b)return this;var c=this.getSize(),d=new a(this.name,c,b,this._generateMipMaps);return d.hasAlpha=this.hasAlpha,d.level=this.level,d.wrapU=this.wrapU,d.wrapV=this.wrapV,d},a.prototype.serialize=function(){var b=this.getScene();b&&!b.isReady()&&r.a.Warn("The scene must be ready before serializing the dynamic texture");var c=e.prototype.serialize.call(this);return c.base64String=this._canvas.toDataURL(),c.invertY=this._invertY,c.samplingMode=this.samplingMode,c},a.prototype._rebuild=function(){this.update()},a}(ra.a),Si=(l(86),l(56),l(87),`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main(void)
{
vec4 result=texture2D(textureSampler,vUV);
#ifdef IMAGEPROCESSING
#ifndef FROMLINEARSPACE

result.rgb=toLinearSpace(result.rgb);
#endif
result=applyImageProcessing(result);
#else

#ifdef FROMLINEARSPACE
result=applyImageProcessing(result);
#endif
#endif
gl_FragColor=result;
}`);Ia.a.ShadersStore.imageProcessingPixelShader=Si;var Ie=function(e){function a(b,c,d,f,h,i,k,m){void 0===d&&(d=null),void 0===k&&(k=o.a.TEXTURETYPE_UNSIGNED_INT);var B=e.call(this,b,"imageProcessing",[],[],c,d,f,h,i,null,k,"postprocess",null,!0)||this;return B._fromLinearSpace=!0,B._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},m?(m.applyByPostProcess=!0,B._attachImageProcessingConfiguration(m,!0),B.fromLinearSpace=!1):(B._attachImageProcessingConfiguration(null,!0),B.imageProcessingConfiguration.applyByPostProcess=!0),B.onApply=function(E){B.imageProcessingConfiguration.bind(E,B.aspectRatio)},B}return v.d(a,e),Object.defineProperty(a.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(b){this._attachImageProcessingConfiguration(b)},enumerable:!0,configurable:!0}),a.prototype._attachImageProcessingConfiguration=function(b,c){var d=this;if(void 0===c&&(c=!1),b!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),b)this._imageProcessingConfiguration=b;else{var f=null,h=this.getEngine(),i=this.getCamera();if(i)f=i.getScene();else if(h&&h.scenes){var k=h.scenes;f=k[k.length-1]}else f=T.a.LastCreatedScene;this._imageProcessingConfiguration=f.imageProcessingConfiguration}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){d._updateParameters()})),c||this._updateParameters()}},Object.defineProperty(a.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(b){this.imageProcessingConfiguration.colorCurves=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(b){this.imageProcessingConfiguration.colorCurvesEnabled=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(b){this.imageProcessingConfiguration.colorGradingTexture=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(b){this.imageProcessingConfiguration.colorGradingEnabled=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(b){this.imageProcessingConfiguration.exposure=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(b){this._imageProcessingConfiguration.toneMappingEnabled=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"toneMappingType",{get:function(){return this._imageProcessingConfiguration.toneMappingType},set:function(b){this._imageProcessingConfiguration.toneMappingType=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(b){this.imageProcessingConfiguration.contrast=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(b){this.imageProcessingConfiguration.vignetteStretch=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(b){this.imageProcessingConfiguration.vignetteCentreX=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(b){this.imageProcessingConfiguration.vignetteCentreY=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(b){this.imageProcessingConfiguration.vignetteWeight=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(b){this.imageProcessingConfiguration.vignetteColor=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(b){this.imageProcessingConfiguration.vignetteCameraFov=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(b){this.imageProcessingConfiguration.vignetteBlendMode=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(b){this.imageProcessingConfiguration.vignetteEnabled=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(b){this._fromLinearSpace!==b&&(this._fromLinearSpace=b,this._updateParameters())},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"ImageProcessingPostProcess"},a.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var b="";for(var c in this._defines)this._defines[c]&&(b+="#define "+c+`;\r
`);var d=["textureSampler"],f=["scale"];Eb.a&&(Eb.a.PrepareSamplers(d,this._defines),Eb.a.PrepareUniforms(f,this._defines)),this.updateEffect(b,f,d)},a.prototype.dispose=function(b){e.prototype.dispose.call(this,b),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},v.c([Object(g.c)()],a.prototype,"_fromLinearSpace",void 0),a}(Za),Wa=l(13),na=l(4);Ca.a._GroundMeshParser=function(e,a){return Gd.Parse(e,a)};var Gd=function(e){function a(b,c){var d=e.call(this,b,c)||this;return d.generateOctree=!1,d}return v.d(a,e),a.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(a.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),a.prototype.optimize=function(b,c){void 0===c&&(c=32),this._subdivisionsX=b,this._subdivisionsY=b,this.subdivide(b),this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(c)},a.prototype.getHeightAtCoordinates=function(b,c){var d=this.getWorldMatrix(),f=j.t.Matrix[5];d.invertToRef(f);var h=j.t.Vector3[8];if(j.x.TransformCoordinatesFromFloatsToRef(b,0,c,f,h),b=h.x,c=h.z,b<this._minX||b>this._maxX||c<this._minZ||c>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var i=this._getFacetAt(b,c),k=-(i.x*b+i.z*c+i.w)/i.y;return j.x.TransformCoordinatesFromFloatsToRef(0,k,0,d,h),h.y},a.prototype.getNormalAtCoordinates=function(b,c){var d=new j.x(0,1,0);return this.getNormalAtCoordinatesToRef(b,c,d),d},a.prototype.getNormalAtCoordinatesToRef=function(b,c,d){var f=this.getWorldMatrix(),h=j.t.Matrix[5];f.invertToRef(h);var i=j.t.Vector3[8];if(j.x.TransformCoordinatesFromFloatsToRef(b,0,c,h,i),b=i.x,c=i.z,b<this._minX||b>this._maxX||c<this._minZ||c>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var k=this._getFacetAt(b,c);return j.x.TransformNormalFromFloatsToRef(k.x,k.y,k.z,f,d),this},a.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},a.prototype._getFacetAt=function(b,c){var d=Math.floor((b+this._maxX)*this._subdivisionsX/this._width),f=Math.floor(-(c+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),h=this._heightQuads[f*this._subdivisionsX+d];return c<h.slope.x*b+h.slope.y?h.facet1:h.facet2},a.prototype._initHeightQuads=function(){var b=this._subdivisionsX,c=this._subdivisionsY;this._heightQuads=new Array();for(var d=0;d<c;d++)for(var f=0;f<b;f++){var h={slope:j.w.Zero(),facet1:new j.y(0,0,0,0),facet2:new j.y(0,0,0,0)};this._heightQuads[d*b+f]=h}return this},a.prototype._computeHeightQuads=function(){var b=this.getVerticesData(na.b.PositionKind);if(!b)return this;for(var c=j.t.Vector3[3],d=j.t.Vector3[2],f=j.t.Vector3[1],h=j.t.Vector3[0],i=j.t.Vector3[4],k=j.t.Vector3[5],m=j.t.Vector3[6],B=j.t.Vector3[7],E=j.t.Vector3[8],K=0,P=0,S=0,U=0,_=0,da=0,fa=0,ga=this._subdivisionsX,ha=this._subdivisionsY,ka=0;ka<ha;ka++)for(var la=0;la<ga;la++){K=3*la,P=ka*(ga+1)*3,S=(ka+1)*(ga+1)*3,c.x=b[P+K],c.y=b[P+K+1],c.z=b[P+K+2],d.x=b[P+K+3],d.y=b[P+K+4],d.z=b[P+K+5],f.x=b[S+K],f.y=b[S+K+1],f.z=b[S+K+2],h.x=b[S+K+3],h.y=b[S+K+4],h.z=b[S+K+5],U=(h.z-c.z)/(h.x-c.x),_=c.z-U*c.x,d.subtractToRef(c,i),f.subtractToRef(c,k),h.subtractToRef(c,m),j.x.CrossToRef(m,k,B),j.x.CrossToRef(i,m,E),B.normalize(),E.normalize(),da=-(B.x*c.x+B.y*c.y+B.z*c.z),fa=-(E.x*d.x+E.y*d.y+E.z*d.z);var ma=this._heightQuads[ka*ga+la];ma.slope.copyFromFloats(U,_),ma.facet1.copyFromFloats(B.x,B.y,B.z,da),ma.facet2.copyFromFloats(E.x,E.y,E.z,fa)}return this},a.prototype.serialize=function(b){e.prototype.serialize.call(this,b),b.subdivisionsX=this._subdivisionsX,b.subdivisionsY=this._subdivisionsY,b.minX=this._minX,b.maxX=this._maxX,b.minZ=this._minZ,b.maxZ=this._maxZ,b.width=this._width,b.height=this._height},a.Parse=function(b,c){var d=new a(b.name,c);return d._subdivisionsX=b.subdivisionsX||1,d._subdivisionsY=b.subdivisionsY||1,d._minX=b.minX,d._maxX=b.maxX,d._minZ=b.minZ,d._maxZ=b.maxZ,d._width=b.width,d._height=b.height,d},a}(Ca.a);Wa.a.CreateGround=function(e){var a,b,c=[],d=[],f=[],h=[],i=e.width||1,k=e.height||1,m=e.subdivisionsX||e.subdivisions||1,B=e.subdivisionsY||e.subdivisions||1;for(a=0;a<=B;a++)for(b=0;b<=m;b++){var E=new j.x(b*i/m-i/2,0,(B-a)*k/B-k/2),K=new j.x(0,1,0);d.push(E.x,E.y,E.z),f.push(K.x,K.y,K.z),h.push(b/m,1-a/B)}for(a=0;a<B;a++)for(b=0;b<m;b++)c.push(b+1+(a+1)*(m+1)),c.push(b+1+a*(m+1)),c.push(b+a*(m+1)),c.push(b+(a+1)*(m+1)),c.push(b+1+(a+1)*(m+1)),c.push(b+a*(m+1));var P=new Wa.a();return P.indices=c,P.positions=d,P.normals=f,P.uvs=h,P},Wa.a.CreateTiledGround=function(e){var a,b,c,d,f=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,h=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,i=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,k=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,m=e.subdivisions||{w:1,h:1},B=e.precision||{w:1,h:1},E=new Array(),K=new Array(),P=new Array(),S=new Array();m.h=m.h<1?1:m.h,m.w=m.w<1?1:m.w,B.w=B.w<1?1:B.w,B.h=B.h<1?1:B.h;var U=(i-f)/m.w,_=(k-h)/m.h;function da(ga,ha,ka,la){var ma=K.length/3,ta=B.w+1;for(a=0;a<B.h;a++)for(b=0;b<B.w;b++){var pa=[ma+b+a*ta,ma+(b+1)+a*ta,ma+(b+1)+(a+1)*ta,ma+b+(a+1)*ta];E.push(pa[1]),E.push(pa[2]),E.push(pa[3]),E.push(pa[0]),E.push(pa[1]),E.push(pa[3])}var ua=j.x.Zero(),wa=new j.x(0,1,0);for(a=0;a<=B.h;a++)for(ua.z=a*(la-ha)/B.h+ha,b=0;b<=B.w;b++)ua.x=b*(ka-ga)/B.w+ga,ua.y=0,K.push(ua.x,ua.y,ua.z),P.push(wa.x,wa.y,wa.z),S.push(b/B.w,a/B.h)}for(c=0;c<m.h;c++)for(d=0;d<m.w;d++)da(f+d*U,h+c*_,f+(d+1)*U,h+(c+1)*_);var fa=new Wa.a();return fa.indices=E,fa.positions=K,fa.normals=P,fa.uvs=S,fa},Wa.a.CreateGroundFromHeightMap=function(e){var a,b,c=[],d=[],f=[],h=[],i=e.colorFilter||new j.e(.3,.59,.11),k=e.alphaFilter||0,m=!1;if(e.minHeight>e.maxHeight){m=!0;var B=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=B}for(a=0;a<=e.subdivisions;a++)for(b=0;b<=e.subdivisions;b++){var E=new j.x(b*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-a)*e.height/e.subdivisions-e.height/2),K=4*(((E.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(E.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth),P=e.buffer[K]/255,S=e.buffer[K+1]/255,U=e.buffer[K+2]/255,_=e.buffer[K+3]/255;m&&(P=1-P,S=1-S,U=1-U);var da=P*i.r+S*i.g+U*i.b;E.y=_>=k?e.minHeight+(e.maxHeight-e.minHeight)*da:e.minHeight-j.h,d.push(E.x,E.y,E.z),f.push(0,0,0),h.push(b/e.subdivisions,1-a/e.subdivisions)}for(a=0;a<e.subdivisions;a++)for(b=0;b<e.subdivisions;b++){var fa=b+1+(a+1)*(e.subdivisions+1),ga=b+1+a*(e.subdivisions+1),ha=b+a*(e.subdivisions+1),ka=b+(a+1)*(e.subdivisions+1),la=d[3*fa+1]>=e.minHeight,ma=d[3*ga+1]>=e.minHeight,ta=d[3*ha+1]>=e.minHeight;la&&ma&&ta&&(c.push(fa),c.push(ga),c.push(ha)),d[3*ka+1]>=e.minHeight&&la&&ta&&(c.push(ka),c.push(fa),c.push(ha))}Wa.a.ComputeNormals(d,c,f);var pa=new Wa.a();return pa.indices=c,pa.positions=d,pa.normals=f,pa.uvs=h,pa},Ca.a.CreateGround=function(e,a,b,c,d,f){var h={width:a,height:b,subdivisions:c,updatable:f};return Dc.CreateGround(e,h,d)},Ca.a.CreateTiledGround=function(e,a,b,c,d,f,h,i,k){var m={xmin:a,zmin:b,xmax:c,zmax:d,subdivisions:f,precision:h,updatable:k};return Dc.CreateTiledGround(e,m,i)},Ca.a.CreateGroundFromHeightMap=function(e,a,b,c,d,f,h,i,k,m,B){var E={width:b,height:c,subdivisions:d,minHeight:f,maxHeight:h,updatable:k,onReady:m,alphaFilter:B};return Dc.CreateGroundFromHeightMap(e,a,E,i)};var Dc=function(){function e(){}return e.CreateGround=function(a,b,c){var d=new Gd(a,c);return d._setReady(!1),d._subdivisionsX=b.subdivisionsX||b.subdivisions||1,d._subdivisionsY=b.subdivisionsY||b.subdivisions||1,d._width=b.width||1,d._height=b.height||1,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,Wa.a.CreateGround(b).applyToMesh(d,b.updatable),d._setReady(!0),d},e.CreateTiledGround=function(a,b,c){void 0===c&&(c=null);var d=new Ca.a(a,c);return Wa.a.CreateTiledGround(b).applyToMesh(d,b.updatable),d},e.CreateGroundFromHeightMap=function(a,b,c,d){void 0===d&&(d=null);var f=c.width||10,h=c.height||10,i=c.subdivisions||1,k=c.minHeight||0,m=c.maxHeight||1,B=c.colorFilter||new j.e(.3,.59,.11),E=c.alphaFilter||0,K=c.updatable,P=c.onReady;d=d||T.a.LastCreatedScene;var S=new Gd(a,d);return S._subdivisionsX=i,S._subdivisionsY=i,S._width=f,S._height=h,S._maxX=S._width/2,S._maxZ=S._height/2,S._minX=-S._maxX,S._minZ=-S._maxZ,S._setReady(!1),xa.h.LoadImage(b,function(U){var _=document.createElement("canvas"),da=_.getContext("2d");if(!da)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!d.isDisposed){var fa=U.width,ga=U.height;_.width=fa,_.height=ga,da.drawImage(U,0,0);var ha=da.getImageData(0,0,fa,ga).data;Wa.a.CreateGroundFromHeightMap({width:f,height:h,subdivisions:i,minHeight:k,maxHeight:m,colorFilter:B,buffer:ha,bufferWidth:fa,bufferHeight:ga,alphaFilter:E}).applyToMesh(S,K),P&&P(S),S._setReady(!0)}},function(){},d.offlineProvider),S},e}();Wa.a.CreateTorus=function(e){for(var a=[],b=[],c=[],d=[],f=e.diameter||1,h=e.thickness||.5,i=e.tessellation||16,k=0===e.sideOrientation?0:e.sideOrientation||Wa.a.DEFAULTSIDE,m=i+1,B=0;B<=i;B++)for(var E=B/i,K=B*Math.PI*2/i-Math.PI/2,P=j.j.Translation(f/2,0,0).multiply(j.j.RotationY(K)),S=0;S<=i;S++){var U=1-S/i,_=S*Math.PI*2/i+Math.PI,da=Math.cos(_),fa=Math.sin(_),ga=new j.x(da,fa,0),ha=ga.scale(h/2),ka=new j.w(E,U);ha=j.x.TransformCoordinates(ha,P),ga=j.x.TransformNormal(ga,P),b.push(ha.x,ha.y,ha.z),c.push(ga.x,ga.y,ga.z),d.push(ka.x,ka.y);var la=(B+1)%m,ma=(S+1)%m;a.push(B*m+S),a.push(B*m+ma),a.push(la*m+S),a.push(B*m+ma),a.push(la*m+ma),a.push(la*m+S)}Wa.a._ComputeSides(k,b,a,c,d,e.frontUVs,e.backUVs);var ta=new Wa.a();return ta.indices=a,ta.positions=b,ta.normals=c,ta.uvs=d,ta},Ca.a.CreateTorus=function(e,a,b,c,d,f,h){var i={diameter:a,thickness:b,tessellation:c,sideOrientation:h,updatable:f};return Je.CreateTorus(e,i,d)};var Ub,Je=function(){function e(){}return e.CreateTorus=function(a,b,c){var d=new Ca.a(a,c);return b.sideOrientation=Ca.a._GetDefaultSideOrientation(b.sideOrientation),d._originalBuilderSideOrientation=b.sideOrientation,Wa.a.CreateTorus(b).applyToMesh(d,b.updatable),d},e}(),ad=l(53),Cg=function(){function e(a,b){if(void 0===b&&(b=null),this.scene=a,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=e._idCounter++,b)this._gazeTracker=b.clone("gazeTracker");else{this._gazeTracker=Ca.a.CreateTorus("gazeTracker",.0035,.0025,20,a,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var c=new Pb.a("targetMat",a);c.specularColor=j.e.Black(),c.emissiveColor=new j.e(.7,.7,.7),c.backFaceCulling=!1,this._gazeTracker.material=c}}return e.prototype._getForwardRay=function(a){return new Nb.a(j.x.Zero(),new j.x(0,0,a))},e.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},e.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},e.prototype._activatePointer=function(){this._activePointer=!0},e.prototype._deactivatePointer=function(){this._activePointer=!1},e.prototype._updatePointerDistance=function(a){void 0===a&&(a=100)},e.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},e._idCounter=0,e}(),Ti=function(e){function a(b,c,d){var f=e.call(this,c,d)||this;f.webVRController=b,f._laserPointer=Ca.a.CreateCylinder("laserPointer",1,.004,.0002,20,1,c,!1);var h=new Pb.a("laserPointerMat",c);if(h.emissiveColor=new j.e(.7,.7,.7),h.alpha=.6,f._laserPointer.material=h,f._laserPointer.rotation.x=Math.PI/2,f._laserPointer.position.z=-.5,f._laserPointer.isVisible=!1,f._laserPointer.isPickable=!1,!b.mesh){var i=new Ca.a("preloadControllerMesh",c),k=new Ca.a(_c.POINTING_POSE,c);k.rotation.x=-.7,i.addChild(k),b.attachToMesh(i)}return f._setLaserPointerParent(b.mesh),f._meshAttachedObserver=b._meshAttachedObservable.add(function(m){f._setLaserPointerParent(m)}),f}return v.d(a,e),a.prototype._getForwardRay=function(b){return this.webVRController.getForwardRay(b)},a.prototype._activatePointer=function(){e.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},a.prototype._deactivatePointer=function(){e.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},a.prototype._setLaserPointerColor=function(b){this._laserPointer.material.emissiveColor=b},a.prototype._setLaserPointerParent=function(b){var c=function(i){i.isPickable=!1,i.getChildMeshes().forEach(function(k){c(k)})};c(b);var d=b.getChildren(void 0,!1),f=b;this.webVRController._pointingPoseNode=null;for(var h=0;h<d.length;h++)if(d[h].name&&d[h].name.indexOf(_c.POINTING_POSE)>=0){f=d[h],this.webVRController._pointingPoseNode=f;break}this._laserPointer.parent=f},a.prototype._updatePointerDistance=function(b){void 0===b&&(b=100),this._laserPointer.scaling.y=b,this._laserPointer.position.z=-b/2},a.prototype.dispose=function(){e.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},a}(Cg),Ui=function(e){function a(b,c){var d=e.call(this,c)||this;return d.getCamera=b,d}return v.d(a,e),a.prototype._getForwardRay=function(b){var c=this.getCamera();return c?c.getForwardRay(b):new Nb.a(j.x.Zero(),j.x.Forward())},a}(Cg),Vi=function(){return function(){}}(),Dg=function(){function e(a,b){var c=this;if(void 0===b&&(b={}),this.webVROptions=b,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.onEnteringVRObservable=new q.c(),this.onAfterEnteringVRObservable=new q.c(),this.onExitingVRObservable=new q.c(),this.onControllerMeshLoadedObservable=new q.c(),this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._rotationAllowed=!0,this._teleportBackwardsVector=new j.x(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new j.x(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this.onNewMeshSelected=new q.c(),this.onNewMeshPicked=new q.c(),this.onBeforeCameraTeleport=new q.c(),this.onAfterCameraTeleport=new q.c(),this.onSelectedMeshUnselected=new q.c(),this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.requestPointerLockOnFullScreen=!0,this._onResize=function(){c.moveButtonToBottomRight(),c._fullscreenVRpresenting&&c._webVRready&&c.exitVR()},this._onFullscreenChange=function(){var h=document;void 0!==h.fullscreen?c._fullscreenVRpresenting=document.fullscreen:void 0!==h.mozFullScreen?c._fullscreenVRpresenting=h.mozFullScreen:void 0!==h.webkitIsFullScreen?c._fullscreenVRpresenting=h.webkitIsFullScreen:void 0!==h.msIsFullScreen?c._fullscreenVRpresenting=h.msIsFullScreen:void 0!==document.msFullscreenElement&&(c._fullscreenVRpresenting=document.msFullscreenElement),!c._fullscreenVRpresenting&&c._canvas&&(c.exitVR(),c._useCustomVRButton||(c._btnVR.style.top=c._canvas.offsetTop+c._canvas.offsetHeight-70+"px",c._btnVR.style.left=c._canvas.offsetLeft+c._canvas.offsetWidth-100+"px"))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this.beforeRender=function(){c._leftController&&c._leftController._activePointer&&c._castRayAndSelectObject(c._leftController),c._rightController&&c._rightController._activePointer&&c._castRayAndSelectObject(c._rightController),c._noControllerIsActive?c._castRayAndSelectObject(c._cameraGazer):c._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(h){if(h.type!==Hb.POSE_ENABLED)h.leftStick&&h.onleftstickchanged(function(m){c._teleportationInitialized&&c.teleportationEnabled&&(!c._leftController&&!c._rightController||c._leftController&&!c._leftController._activePointer&&c._rightController&&!c._rightController._activePointer)&&(c._checkTeleportWithRay(m,c._cameraGazer),c._checkTeleportBackwards(m,c._cameraGazer))}),h.rightStick&&h.onrightstickchanged(function(m){c._teleportationInitialized&&c._checkRotate(m,c._cameraGazer)}),h.type===Hb.XBOX&&(h.onbuttondown(function(m){c._interactionsEnabled&&m===Ob.A&&c._cameraGazer._selectionPointerDown()}),h.onbuttonup(function(m){c._interactionsEnabled&&m===Ob.A&&c._cameraGazer._selectionPointerUp()}));else{var i=h,k=new Ti(i,c._scene,c._cameraGazer._gazeTracker);"right"===i.hand||c._leftController&&c._leftController.webVRController!=i?c._rightController=k:c._leftController=k,c._tryEnableInteractionOnController(k)}},this._tryEnableInteractionOnController=function(h){c._interactionsRequested&&!h._interactionsEnabled&&c._enableInteractionOnController(h),c._teleportationRequested&&!h._teleportationEnabled&&c._enableTeleportationOnController(h)},this._onNewGamepadDisconnected=function(h){h instanceof tc&&("left"===h.hand&&null!=c._leftController&&(c._leftController.dispose(),c._leftController=null),"right"===h.hand&&null!=c._rightController&&(c._rightController.dispose(),c._rightController=null))},this._workingVector=j.x.Zero(),this._workingQuaternion=j.q.Identity(),this._workingMatrix=j.j.Identity(),this._scene=a,this._canvas=a.getEngine().getRenderingCanvas(),void 0===b.createFallbackVRDeviceOrientationFreeCamera&&(b.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===b.createDeviceOrientationCamera&&(b.createDeviceOrientationCamera=!0),void 0===b.laserToggle&&(b.laserToggle=!0),void 0===b.defaultHeight&&(b.defaultHeight=1.7),b.useCustomVRButton&&(this._useCustomVRButton=!0,b.customVRButton&&(this._btnVR=b.customVRButton)),b.rayLength&&(this._rayLength=b.rayLength),this._defaultHeight=b.defaultHeight,b.positionScale&&(this._rayLength*=b.positionScale,this._defaultHeight*=b.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new j.x(0,this._defaultHeight,0),b.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new Bd("deviceOrientationVRHelper",this._position.clone(),a),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof qc&&this._scene.activeCamera.rotation)){var d=this._scene.activeCamera;d.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(d.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(j.q.RotationYawPitchRoll(d.rotation.y,d.rotation.x,d.rotation.z)),this._deviceOrientationCamera.rotation=d.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)}else this._existingCamera=this._scene.activeCamera;if(b.createFallbackVRDeviceOrientationFreeCamera&&(b.useMultiview&&(b.vrDeviceOrientationCameraMetrics||(b.vrDeviceOrientationCameraMetrics=Ic.GetDefault()),b.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new Dd("VRDeviceOrientationVRHelper",this._position,this._scene,!0,b.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new Fd("WebVRHelper",this._position,this._scene,b),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new Ui(function(){return c.currentVRCamera},a),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var f=document.createElement("style");f.appendChild(document.createTextNode(".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }.babylonVRicon.vrdisplaypresenting { display: none; }")),document.getElementsByTagName("head")[0].appendChild(f),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){c.isInVRMode?c.exitVR():c.enterVR()}),window.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,b.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(h){h.vrDisplay&&c.displayVRButton()}),this._onKeyDown=function(h){27===h.keyCode&&c.isInVRMode&&c.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(){c.isInVRMode&&(c.exitVR(),c._fullscreenVRpresenting&&c._scene.getEngine().exitFullscreen())},hb.a.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(h){return c.onVRDisplayChanged(h)},this._onVrDisplayPresentChange=function(){return c.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){c._webVRrequesting=!0,c.updateButtonVisibility()},this._onVRRequestPresentComplete=function(){c._webVRrequesting=!1,c.updateButtonVisibility()},a.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),a.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),a.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),a.onDisposeObservable.add(function(){c.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(h){return c._onDefaultMeshLoaded(h)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new Ga(),this._circleEase.setEasingMode(Ka.EASINGMODE_EASEINOUT),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes})}return Object.defineProperty(e.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(a){a&&(a.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(a){a&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=a,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(a){this._displayGaze=a,a||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(a){this._displayLaserPointer=a,a?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||null!==this._leftController&&this._leftController._teleportationRequestInitiated||null!==this._rightController&&this._rightController._teleportationRequestInitiated},enumerable:!0,configurable:!0}),e.prototype._onDefaultMeshLoaded=function(a){this._leftController&&this._leftController.webVRController==a&&a.mesh&&this._leftController._setLaserPointerParent(a.mesh),this._rightController&&this._rightController.webVRController==a&&a.mesh&&this._rightController._setLaserPointerParent(a.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(a)}catch(b){r.a.Warn("Error in your custom logic onControllerMeshLoaded: "+b)}},Object.defineProperty(e.prototype,"isInVRMode",{get:function(){return this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!0,configurable:!0}),e.prototype.onVrDisplayPresentChange=function(){var a=this._scene.getEngine().getVRDevice();if(a){var b=this._webVRpresenting;this._webVRpresenting=a.isPresenting,b&&!this._webVRpresenting&&this.exitVR()}else r.a.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},e.prototype.onVRDisplayChanged=function(a){this._webVRsupported=a.vrSupported,this._webVRready=!!a.vrDisplay,this._webVRpresenting=a.vrDisplay&&a.vrDisplay.isPresenting,this.updateButtonVisibility()},e.prototype.moveButtonToBottomRight=function(){this._canvas&&!this._useCustomVRButton&&(this._btnVR.style.top=this._canvas.offsetTop+this._canvas.offsetHeight-70+"px",this._btnVR.style.left=this._canvas.offsetLeft+this._canvas.offsetWidth-100+"px")},e.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},e.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},e.prototype.enterVR=function(){var a=this;if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(f){r.a.Warn("Error in your custom logic onEnteringVR: "+f)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=j.q.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2000),this.webVRCamera){var b=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,c=j.q.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-b,d=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=j.q.FromEulerAngles(0,d+c,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce(function(f){a.onAfterEnteringVRObservable.notifyObservers({success:f})}),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this.updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce(function(){a.onAfterEnteringVRObservable.notifyObservers({success:!0})})),this._scene.activeCamera&&this._canvas&&this._scene.activeCamera.attachControl(this._canvas),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach(function(f){f&&f._activatePointer()}),this._hasEnteredVR=!0)},e.prototype.exitVR=function(){if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(b){r.a.Warn("Error in your custom logic onExitingVR: "+b)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas),this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach(function(b){b&&b._deactivatePointer()}),this._hasEnteredVR=!1;var a=this._scene.getEngine();a._onVrDisplayPresentChange&&a._onVrDisplayPresentChange()}},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(a){this._position=a,this._scene.activeCamera&&(this._scene.activeCamera.position=a)},enumerable:!0,configurable:!0}),e.prototype.enableInteractions=function(){var a=this;this._interactionsEnabled||(this._interactionsRequested=!0,this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(b){return b.isVisible&&(b.isPickable||b.name===a._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(b){return!!(a._isTeleportationFloor(b)||-1===b.name.indexOf("gazeTracker")&&-1===b.name.indexOf("teleportationTarget")&&-1===b.name.indexOf("torusTeleportation"))&&a.raySelectionPredicate(b)},this._interactionsEnabled=!0)},Object.defineProperty(e.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!0,configurable:!0}),e.prototype._isTeleportationFloor=function(a){for(var b=0;b<this._floorMeshesCollection.length;b++)if(this._floorMeshesCollection[b].id===a.id)return!0;return!(!this._floorMeshName||a.name!==this._floorMeshName)},e.prototype.addFloorMesh=function(a){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(a)>-1||this._floorMeshesCollection.push(a))},e.prototype.removeFloorMesh=function(a){if(this._floorMeshesCollection){var b=this._floorMeshesCollection.indexOf(a);-1!==b&&this._floorMeshesCollection.splice(b,1)}},e.prototype.enableTeleportation=function(a){if(void 0===a&&(a={}),!this._teleportationInitialized){this._teleportationRequested=!0,this.enableInteractions(),a.floorMeshName&&(this._floorMeshName=a.floorMeshName),a.floorMeshes&&(this._floorMeshesCollection=a.floorMeshes),null!=this._leftController&&this._enableTeleportationOnController(this._leftController),null!=this._rightController&&this._enableTeleportationOnController(this._rightController);var b=new Eb.a();b.vignetteColor=new j.f(0,0,0,0),b.vignetteEnabled=!0,this._postProcessMove=new Ie("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,b),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},e.prototype._enableInteractionOnController=function(a){var b=this;a.webVRController.mesh&&(a._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&a._activatePointer(),this.webVROptions.laserToggle&&a.webVRController.onMainButtonStateChangedObservable.add(function(c){b._displayLaserPointer&&1===c.value&&(a._activePointer?a._deactivatePointer():a._activatePointer(),b.displayGaze&&(a._gazeTracker.isVisible=a._activePointer))}),a.webVRController.onTriggerStateChangedObservable.add(function(c){var d=a;b._noControllerIsActive&&(d=b._cameraGazer),d._pointerDownOnMeshAsked?c.value<b._padSensibilityDown&&d._selectionPointerUp():c.value>b._padSensibilityUp&&d._selectionPointerDown()}))},e.prototype._checkTeleportWithRay=function(a,b){this._teleportationRequestInitiated&&!b._teleportationRequestInitiated||(b._teleportationRequestInitiated?Math.sqrt(a.y*a.y+a.x*a.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),b._teleportationRequestInitiated=!1):a.y<-this._padSensibilityUp&&b._dpadPressed&&(b._activatePointer(),b._teleportationRequestInitiated=!0))},e.prototype._checkRotate=function(a,b){b._teleportationRequestInitiated||(b._rotationLeftAsked?a.x>-this._padSensibilityDown&&(b._rotationLeftAsked=!1):a.x<-this._padSensibilityUp&&b._dpadPressed&&(b._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),b._rotationRightAsked?a.x<this._padSensibilityDown&&(b._rotationRightAsked=!1):a.x>this._padSensibilityUp&&b._dpadPressed&&(b._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},e.prototype._checkTeleportBackwards=function(a,b){if(!b._teleportationRequestInitiated)if(a.y>this._padSensibilityUp&&b._dpadPressed){if(!b._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var c=j.q.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),d=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(c=this.currentVRCamera.deviceRotationQuaternion,d=this.currentVRCamera.devicePosition),c.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,j.q.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),j.x.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var f=new Nb.a(d,this._workingVector),h=this._scene.pickWithRay(f,this._raySelectionPredicate);h&&h.pickedPoint&&h.pickedMesh&&this._isTeleportationFloor(h.pickedMesh)&&h.distance<5&&this.teleportCamera(h.pickedPoint),b._teleportationBackRequestInitiated=!0}}else b._teleportationBackRequestInitiated=!1},e.prototype._enableTeleportationOnController=function(a){var b=this;a.webVRController.mesh&&(a._interactionsEnabled||this._enableInteractionOnController(a),a._interactionsEnabled=!0,a._teleportationEnabled=!0,a.webVRController.controllerType===_b.VIVE&&(a._dpadPressed=!1,a.webVRController.onPadStateChangedObservable.add(function(c){a._dpadPressed=c.pressed,a._dpadPressed||(a._rotationLeftAsked=!1,a._rotationRightAsked=!1,a._teleportationBackRequestInitiated=!1)})),a.webVRController.onPadValuesChangedObservable.add(function(c){b.teleportationEnabled&&(b._checkTeleportBackwards(c,a),b._checkTeleportWithRay(c,a)),b._checkRotate(c,a)}))},e.prototype._createTeleportationCircles=function(){this._teleportationTarget=Ca.a.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var a=new $c("DynamicTexture",512,this._scene,!0);a.hasAlpha=!0;var b=a.getContext();b.beginPath(),b.arc(256,256,200,0,2*Math.PI,!1),b.fillStyle=this._teleportationFillColor,b.fill(),b.lineWidth=10,b.strokeStyle=this._teleportationBorderColor,b.stroke(),b.closePath(),a.update();var c=new Pb.a("TextPlaneMaterial",this._scene);c.diffuseTexture=a,this._teleportationTarget.material=c;var d=Ca.a.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);d.isPickable=!1,d.parent=this._teleportationTarget;var f=new C("animationInnerCircle","position.y",30,C.ANIMATIONTYPE_FLOAT,C.ANIMATIONLOOPMODE_CYCLE),h=[];h.push({frame:0,value:0}),h.push({frame:30,value:.4}),h.push({frame:60,value:0}),f.setKeys(h);var i=new Lb();i.setEasingMode(Ka.EASINGMODE_EASEINOUT),f.setEasingFunction(i),d.animations=[],d.animations.push(f),this._scene.beginAnimation(d,0,60,!0),this._hideTeleportationTarget()},e.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},e.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},e.prototype._rotateCamera=function(a){var b=this;if(this.currentVRCamera instanceof Wb){a?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var c=j.q.FromRotationMatrix(j.j.RotationY(Math.PI/4*this._rotationAngle)),d=new C("animationRotation","rotationQuaternion",90,C.ANIMATIONTYPE_QUATERNION,C.ANIMATIONLOOPMODE_CONSTANT),f=[];f.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),f.push({frame:6,value:c}),d.setKeys(f),d.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(d),this._postProcessMove.animations=[];var h=new C("animationPP","vignetteWeight",90,C.ANIMATIONTYPE_FLOAT,C.ANIMATIONLOOPMODE_CONSTANT),i=[];i.push({frame:0,value:0}),i.push({frame:3,value:4}),i.push({frame:6,value:0}),h.setKeys(i),h.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(h);var k=new C("animationPP2","vignetteStretch",90,C.ANIMATIONTYPE_FLOAT,C.ANIMATIONLOOPMODE_CONSTANT),m=[];m.push({frame:0,value:0}),m.push({frame:3,value:10}),m.push({frame:6,value:0}),k.setKeys(m),k.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(k),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){b._webVRCamera.detachPostProcess(b._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},e.prototype._moveTeleportationSelectorTo=function(a,b,c){if(a.pickedPoint){b._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(a.pickedPoint),this._teleportationTarget.position.copyFrom(a.pickedPoint));var d=this._convertNormalToDirectionOfRay(a.getNormal(!0,!1),c);if(d){var f=j.x.Cross(j.c.Y,d),h=j.x.Cross(d,f);j.x.RotationFromAxisToRef(h,d,f,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},e.prototype.teleportCamera=function(a){var b=this;if(this.currentVRCamera instanceof Wb){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),a.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(a),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector),this.currentVRCamera.animations=[];var c=new C("animationCameraTeleportation","position",90,C.ANIMATIONTYPE_VECTOR3,C.ANIMATIONLOOPMODE_CONSTANT),d=[{frame:0,value:this.currentVRCamera.position},{frame:11,value:this._workingVector}];c.setKeys(d),c.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(c),this._postProcessMove.animations=[];var f=new C("animationPP","vignetteWeight",90,C.ANIMATIONTYPE_FLOAT,C.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:0}),h.push({frame:5,value:8}),h.push({frame:11,value:0}),f.setKeys(h),this._postProcessMove.animations.push(f);var i=new C("animationPP2","vignetteStretch",90,C.ANIMATIONTYPE_FLOAT,C.ANIMATIONLOOPMODE_CONSTANT),k=[];k.push({frame:0,value:0}),k.push({frame:5,value:10}),k.push({frame:11,value:0}),i.setKeys(k),this._postProcessMove.animations.push(i),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,11,!1,1,function(){b._webVRCamera.detachPostProcess(b._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,11,!1,1,function(){b.onAfterCameraTeleport.notifyObservers(b._workingVector)}),this._hideTeleportationTarget()}},e.prototype._convertNormalToDirectionOfRay=function(a,b){return a&&(Math.acos(j.x.Dot(a,b.direction))<Math.PI/2&&a.scaleInPlace(-1)),a},e.prototype._castRayAndSelectObject=function(a){if(this.currentVRCamera instanceof Wb){var b=a._getForwardRay(this._rayLength),c=this._scene.pickWithRay(b,this._raySelectionPredicate);if(c&&(a._laserPointer&&(c.originMesh=a._laserPointer.parent),this._scene.simulatePointerMove(c,{pointerId:a._id})),a._currentHit=c,c&&c.pickedPoint){if(this._displayGaze){var d=1;a._gazeTracker.isVisible=!0,a._isActionableMesh&&(d=3),this.updateGazeTrackerScale&&(a._gazeTracker.scaling.x=c.distance*d,a._gazeTracker.scaling.y=c.distance*d,a._gazeTracker.scaling.z=c.distance*d);var f=this._convertNormalToDirectionOfRay(c.getNormal(),b);if(f){var h=j.x.Cross(j.c.Y,f),i=j.x.Cross(f,h);j.x.RotationFromAxisToRef(i,f,h,a._gazeTracker.rotation)}a._gazeTracker.position.copyFrom(c.pickedPoint),a._gazeTracker.position.x<0?a._gazeTracker.position.x+=.002:a._gazeTracker.position.x-=.002,a._gazeTracker.position.y<0?a._gazeTracker.position.y+=.002:a._gazeTracker.position.y-=.002,a._gazeTracker.position.z<0?a._gazeTracker.position.z+=.002:a._gazeTracker.position.z-=.002}a._updatePointerDistance(c.distance)}else a._updatePointerDistance(),a._gazeTracker.isVisible=!1;if(c&&c.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(c.pickedMesh)&&c.pickedPoint)return a._currentMeshSelected&&!this._isTeleportationFloor(a._currentMeshSelected)&&this._notifySelectedMeshUnselected(a._currentMeshSelected),a._currentMeshSelected=null,void(a._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(c,a,b));if(c.pickedMesh!==a._currentMeshSelected)if(this.meshSelectionPredicate(c.pickedMesh)){this.onNewMeshPicked.notifyObservers(c),a._currentMeshSelected=c.pickedMesh,c.pickedMesh.isPickable&&c.pickedMesh.actionManager?(this.changeGazeColor(new j.e(0,0,1)),this.changeLaserColor(new j.e(.2,.2,1)),a._isActionableMesh=!0):(this.changeGazeColor(new j.e(.7,.7,.7)),this.changeLaserColor(new j.e(.7,.7,.7)),a._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(c.pickedMesh)}catch(k){r.a.Warn("Error in your custom logic onNewMeshSelected: "+k)}}else this._notifySelectedMeshUnselected(a._currentMeshSelected),a._currentMeshSelected=null,this.changeGazeColor(new j.e(.7,.7,.7)),this.changeLaserColor(new j.e(.7,.7,.7))}else this._notifySelectedMeshUnselected(a._currentMeshSelected),a._currentMeshSelected=null,this.changeGazeColor(new j.e(.7,.7,.7)),this.changeLaserColor(new j.e(.7,.7,.7))}},e.prototype._notifySelectedMeshUnselected=function(a){a&&this.onSelectedMeshUnselected.notifyObservers(a)},e.prototype.changeLaserColor=function(a){this._leftController&&this._leftController._setLaserPointerColor(a),this._rightController&&this._rightController._setLaserPointerColor(a)},e.prototype.changeGazeColor=function(a){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=a,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=a),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=a))},e.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},e.prototype.getClassName=function(){return"VRExperienceHelper"},e}(),Eg=function(e){function a(b,c){var d=e.call(this,b,j.x.Zero(),c)||this;return d.minZ=0,d.rotationQuaternion=new j.q(),d.cameraRigMode=ab.a.RIG_MODE_CUSTOM,d.updateUpVectorFromRotation=!0,d._updateNumberOfRigCameras(1),d}return v.d(a,e),a.prototype._updateNumberOfRigCameras=function(b){for(void 0===b&&(b=1);this.rigCameras.length<b;){var c=new qc("view: "+this.rigCameras.length,j.x.Zero(),this.getScene());c.minZ=0,c.parent=this,c.rotationQuaternion=new j.q(),c.updateUpVectorFromRotation=!0,this.rigCameras.push(c)}for(;this.rigCameras.length>b;){var d=this.rigCameras.pop();d&&d.dispose()}},a.prototype._updateForDualEyeDebugging=function(b){void 0===b&&(b=.01),this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new j.z(0,0,.5,1),this.rigCameras[0].position.x=-b/2,this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new j.z(.5,0,.5,1),this.rigCameras[1].position.x=b/2,this.rigCameras[1].outputRenderTarget=null},a.prototype.updateFromXRSessionManager=function(b){var c=this;if(!b._currentXRFrame||!b._currentXRFrame.getDevicePose)return!1;var d=b._currentXRFrame.getDevicePose(b._frameOfReference);return!(!d||!d.poseModelMatrix)&&(j.j.FromFloat32ArrayToRefScaled(d.poseModelMatrix,0,1,a._TmpMatrix),this._scene.useRightHandedSystem||a._TmpMatrix.toggleModelMatrixHandInPlace(),a._TmpMatrix.getTranslationToRef(this.position),a._TmpMatrix.getRotationMatrixToRef(a._TmpMatrix),j.q.FromRotationMatrixToRef(a._TmpMatrix,this.rotationQuaternion),this.computeWorldMatrix(),this._updateNumberOfRigCameras(b._currentXRFrame.views.length),b._currentXRFrame.views.forEach(function(f,h){j.j.FromFloat32ArrayToRefScaled(d.getViewMatrix(f),0,1,c.rigCameras[h]._computedViewMatrix),j.j.FromFloat32ArrayToRefScaled(f.projectionMatrix,0,1,c.rigCameras[h]._projectionMatrix),c._scene.useRightHandedSystem||(c.rigCameras[h]._computedViewMatrix.toggleModelMatrixHandInPlace(),c.rigCameras[h]._projectionMatrix.toggleProjectionMatrixHandInPlace());var i=b._xrSession.baseLayer.getViewport(f),k=b._xrSession.baseLayer.framebufferWidth,m=b._xrSession.baseLayer.framebufferHeight;c.rigCameras[h].viewport.width=i.width/k,c.rigCameras[h].viewport.height=i.height/m,c.rigCameras[h].viewport.x=i.x/k,c.rigCameras[h].viewport.y=i.y/m,c.rigCameras[h].outputRenderTarget=b._sessionRenderTargetTexture}),!0)},a._TmpMatrix=new j.j(),a}(Wb),Fg=function(){function e(a){this.scene=a,this.onXRFrameObservable=new q.c(),this.onXRSessionEnded=new q.c(),this._sessionRenderTargetTexture=null,this._tmpMatrix=new j.j()}return e.prototype.initializeAsync=function(){var a=this;return r.a.Warn("The WebXR APIs are still under development and are subject to change in the future."),this._xrNavigator=navigator,this._xrNavigator.xr?this._xrNavigator.xr.requestDevice().then(function(b){return a._xrDevice=b,a.scene.getEngine()._gl.setCompatibleXRDevice(a._xrDevice)}):Promise.reject("webXR not supported by this browser")},e.prototype.enterXRAsync=function(a,b){var c=this;return this._xrDevice.requestSession(a).then(function(d){return c._xrSession=d,c._xrSession.addEventListener("end",function(){c._sessionRenderTargetTexture=null,c.scene.getEngine().restoreDefaultFramebuffer(),c.scene.getEngine().customAnimationFrameRequester=null,c.onXRSessionEnded.notifyObservers(null),c.scene.getEngine()._renderLoop()},{once:!0}),c._xrSession.baseLayer=new XRWebGLLayer(c._xrSession,c.scene.getEngine()._gl),c._xrSession.requestFrameOfReference(b)}).then(function(d){c._frameOfReference=d,c.scene.getEngine().customAnimationFrameRequester={requestAnimationFrame:c._xrSession.requestAnimationFrame.bind(c._xrSession),renderFunction:function(f,h){c._currentXRFrame=h,c.onXRFrameObservable.notifyObservers(null),c.scene.getEngine()._renderLoop()}},c._sessionRenderTargetTexture=e._CreateRenderTargetTextureFromSession(c._xrSession,c.scene),window.cancelAnimationFrame(c.scene.getEngine()._frameHandler),c.scene.getEngine()._renderLoop()})},e.prototype.exitXRAsync=function(){return this._xrSession.end()},e.prototype.environmentPointHitTestAsync=function(a){var b=this;return new Promise(function(c){var d=new Float32Array([a.origin.x,a.origin.y,a.origin.z]),f=new Float32Array([a.direction.x,a.direction.y,a.direction.z]);b.scene.useRightHandedSystem||(d[2]*=-1,f[2]*=-1),b._xrSession.requestHitTest(d,f,b._frameOfReference).then(function(h){if(h.length>0){j.j.FromFloat32ArrayToRefScaled(h[0].hitMatrix,0,1,b._tmpMatrix);var i=b._tmpMatrix.getTranslation();b.scene.useRightHandedSystem||(i.z*=-1),c(i)}else c(null)}).catch(function(){c(null)})})},e.prototype.supportsSessionAsync=function(a){return this._xrDevice.supportsSession(a).then(function(){return!0}).catch(function(){return!1})},e._CreateRenderTargetTextureFromSession=function(a,b){var c=new sb.a(b.getEngine(),sb.a.DATASOURCE_UNKNOWN,!0);c.width=a.baseLayer.framebufferWidth,c.height=a.baseLayer.framebufferHeight,c._framebuffer=a.baseLayer.framebuffer;var d=new Ab("XR renderTargetTexture",{width:c.width,height:c.height},b,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return d._texture=c,d},e.prototype.dispose=function(){this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear()},e}();!function(e){e[e.ENTERING_XR=0]="ENTERING_XR",e[e.EXITING_XR=1]="EXITING_XR",e[e.IN_XR=2]="IN_XR",e[e.NOT_IN_XR=3]="NOT_IN_XR"}(Ub||(Ub={}));var $b,Gg=function(){function e(a){this.scene=a,this.state=Ub.NOT_IN_XR,this.onStateChangedObservable=new q.c(),this._nonVRCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this.camera=new Eg("",a),this._sessionManager=new Fg(a),this.container=new kb.a("",a),this.camera.parent=this.container}return e.prototype._setState=function(a){this.state=a,this.onStateChangedObservable.notifyObservers(this.state)},e.CreateAsync=function(a){var b=new e(a);return b._sessionManager.initializeAsync().then(function(){return b._supported=!0,b}).catch(function(){return b})},e.prototype.exitXRAsync=function(){return this._setState(Ub.EXITING_XR),this._sessionManager.exitXRAsync()},e.prototype.enterXRAsync=function(a,b){var c=this;if(!this._supported)throw"XR session not supported by this browser";return this._setState(Ub.ENTERING_XR),this._sessionManager.enterXRAsync(a,b).then(function(){c._originalSceneAutoClear=c.scene.autoClear,c._nonVRCamera=c.scene.activeCamera,c.scene.autoClear=!1,c.scene.activeCamera=c.camera,c._sessionManager.onXRFrameObservable.add(function(){c.camera.updateFromXRSessionManager(c._sessionManager)}),c._sessionManager.onXRSessionEnded.addOnce(function(){c.camera.rigCameras.forEach(function(d){d.outputRenderTarget=null}),c.scene.autoClear=c._originalSceneAutoClear,c.scene.activeCamera=c._nonVRCamera,c._sessionManager.onXRFrameObservable.clear(),c._setState(Ub.NOT_IN_XR)}),c._setState(Ub.IN_XR)})},e.prototype.environmentPointHitTestAsync=function(a){return this._sessionManager.environmentPointHitTestAsync(a)},e.prototype.setPositionOfCameraUsingContainer=function(a){this.camera.globalPosition.subtractToRef(a,e._TmpVector),this.container.position.subtractInPlace(e._TmpVector)},e.prototype.rotateCameraByQuaternionUsingContainer=function(a){this.container.rotationQuaternion||(this.container.rotationQuaternion=j.q.FromEulerVector(this.container.rotation)),this.container.rotationQuaternion.multiplyInPlace(a),this.container.position.rotateByQuaternionAroundPointToRef(a,this.camera.globalPosition,this.container.position)},e.prototype.supportsSessionAsync=function(a){return this._supported?this._sessionManager.supportsSessionAsync(a):Promise.resolve(!1)},e.prototype.dispose=function(){this.camera.dispose(),this.container.dispose(),this.onStateChangedObservable.clear(),this._sessionManager.dispose()},e._TmpVector=new j.x(),e}(),Ke=function(){function e(a,b){this.element=a,this.initializationOptions=b}return e.prototype.update=function(a){},e}(),Wi=function(){return function(){}}(),Hg=function(){function e(a,b){var c=this;if(this.scene=a,this._buttons=[],this._activeButton=null,this.activeButtonChangedObservable=new q.c(),this._overlay=document.createElement("div"),this._overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;",b.customButtons)this._buttons=b.customButtons;else{var d=document.createElement("button");d.style.cssText="color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-repeat:no-repeat; background-position: center; outline: none;",d.innerText="HMD",this._buttons.push(new Ke(d,{immersive:!0,outputContext:b.outputCanvasContext})),this._buttons[this._buttons.length-1].update=function(i){this.element.style.display=null===i||i===this?"":"none",this.element.innerText=i===this?"EXIT":"HMD"};var f=document.createElement("button");f.style.cssText=d.style.cssText,f.innerText="Window",this._buttons.push(new Ke(f,{immersive:!1,environmentIntegration:!0,outputContext:b.outputCanvasContext})),this._buttons[this._buttons.length-1].update=function(i){this.element.style.display=null===i||i===this?"":"none",this.element.innerText=i===this?"EXIT":"Window"},this._updateButtons(null)}var h=a.getEngine().getRenderingCanvas();h&&h.parentNode&&(h.parentNode.appendChild(this._overlay),a.onDisposeObservable.addOnce(function(){c.dispose()}))}return e.CreateAsync=function(a,b,c){var d=this,f=new e(a,c),h=f._buttons.map(function(i){return b.supportsSessionAsync(i.initializationOptions)});return b.onStateChangedObservable.add(function(i){i==Ub.NOT_IN_XR&&f._updateButtons(null)}),Promise.all(h).then(function(i){return i.forEach(function(k,m){k&&(f._overlay.appendChild(f._buttons[m].element),f._buttons[m].element.onclick=function(){return v.b(d,void 0,void 0,function(){return v.e(this,function(B){switch(B.label){case 0:return b.state!=Ub.IN_XR?[3,2]:(f._updateButtons(null),[4,b.exitXRAsync()]);case 1:return B.sent(),[2];case 2:return b.state!=Ub.NOT_IN_XR?[3,4]:(f._updateButtons(f._buttons[m]),[4,b.enterXRAsync(f._buttons[m].initializationOptions,"eye-level")]);case 3:B.sent(),B.label=4;case 4:return[2]}})})})}),f})},e.prototype._updateButtons=function(a){var b=this;this._activeButton=a,this._buttons.forEach(function(c){c.update(b._activeButton)}),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},e.prototype.dispose=function(){var a=this.scene.getEngine().getRenderingCanvas();a&&a.parentNode&&a.parentNode.contains(this._overlay)&&a.parentNode.removeChild(this._overlay),this.activeButtonChangedObservable.clear()},e}(),Ig=function(){function e(a){this.pointer=new kb.a("controllerPointer",a)}return e.prototype.dispose=function(){this.grip&&this.grip.dispose(),this.pointer.dispose()},e}(),Jg=function(){function e(a){var b=this;this.helper=a,this.controllers=[],this._tmpMatrix=new j.j(),this._frameObserver=a._sessionManager.onXRFrameObservable.add(function(){if(a._sessionManager._currentXRFrame&&a._sessionManager._currentXRFrame.getDevicePose){var c=a._sessionManager._currentXRFrame;a._sessionManager._xrSession.getInputSources().forEach(function(d,f){var h=c.getInputPose(d,a._sessionManager._frameOfReference);if(h){b.controllers.length<=f&&b.controllers.push(new Ig(a.container.getScene()));var i=b.controllers[f];h.gripMatrix&&(i.grip||(i.grip=new kb.a("controllerGrip",a.container.getScene())),j.j.FromFloat32ArrayToRefScaled(h.gripMatrix,0,1,b._tmpMatrix),i.grip.getScene().useRightHandedSystem||b._tmpMatrix.toggleModelMatrixHandInPlace(),i.grip.rotationQuaternion||(i.grip.rotationQuaternion=new j.q()),b._tmpMatrix.decompose(i.grip.scaling,i.grip.rotationQuaternion,i.grip.position)),j.j.FromFloat32ArrayToRefScaled(h.targetRay.transformMatrix,0,1,b._tmpMatrix),i.pointer.getScene().useRightHandedSystem||b._tmpMatrix.toggleModelMatrixHandInPlace(),i.pointer.rotationQuaternion||(i.pointer.rotationQuaternion=new j.q()),b._tmpMatrix.decompose(i.pointer.scaling,i.pointer.rotationQuaternion,i.pointer.position)}})}})}return e.prototype.dispose=function(){this.controllers.forEach(function(a){a.dispose()}),this.helper._sessionManager.onXRFrameObservable.remove(this._frameObserver)},e}(),Kg=function(){function e(a,b){var c=this;this._canvas=null,this.canvasContext=null,b||((b=document.createElement("canvas")).style.cssText="position:absolute; bottom:0px;right:0px;z-index:10;width:100%;height:100%;background-color: #000000;"),this._setManagedOutputCanvas(b),a.onStateChangedObservable.add(function(d){d==Ub.ENTERING_XR?c._addCanvas():a.state==Ub.NOT_IN_XR&&c._removeCanvas()})}return e.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},e.prototype._setManagedOutputCanvas=function(a){this._removeCanvas(),a?(this._canvas=a,this.canvasContext=this._canvas.getContext("xrpresent")):(this._canvas=null,this.canvasContext=null)},e.prototype._addCanvas=function(){this._canvas&&document.body.appendChild(this._canvas)},e.prototype._removeCanvas=function(){this._canvas&&document.body.contains(this._canvas)&&document.body.removeChild(this._canvas)},e}(),Jc=($b={root:0,found:!1},function(e,a,b,c){$b.root=0,$b.found=!1;var d=a*a-4*e*b;if(d<0)return $b;var f=Math.sqrt(d),h=(-a-f)/(2*e),i=(-a+f)/(2*e);if(h>i){var k=i;i=h,h=k}return h>0&&h<c?($b.root=h,$b.found=!0,$b):i>0&&i<c?($b.root=i,$b.found=!0,$b):$b}),Lg=function(){function e(){this._collisionPoint=j.x.Zero(),this._planeIntersectionPoint=j.x.Zero(),this._tempVector=j.x.Zero(),this._tempVector2=j.x.Zero(),this._tempVector3=j.x.Zero(),this._tempVector4=j.x.Zero(),this._edge=j.x.Zero(),this._baseToVertex=j.x.Zero(),this._destinationPoint=j.x.Zero(),this._slidePlaneNormal=j.x.Zero(),this._displacementVector=j.x.Zero(),this._radius=j.x.One(),this._retry=0,this._basePointWorld=j.x.Zero(),this._velocityWorld=j.x.Zero(),this._normalizedVelocity=j.x.Zero(),this._collisionMask=-1}return Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(a){this._collisionMask=isNaN(a)?-1:a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),e.prototype._initialize=function(a,b,c){this._velocity=b,j.x.NormalizeToRef(b,this._normalizedVelocity),this._basePoint=a,a.multiplyToRef(this._radius,this._basePointWorld),b.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=c,this.collisionFound=!1},e.prototype._checkPointInTriangle=function(a,b,c,d,f){b.subtractToRef(a,this._tempVector),c.subtractToRef(a,this._tempVector2),j.x.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var h=j.x.Dot(this._tempVector4,f);return!(h<0)&&(d.subtractToRef(a,this._tempVector3),j.x.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((h=j.x.Dot(this._tempVector4,f))<0)&&(j.x.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(h=j.x.Dot(this._tempVector4,f))>=0))},e.prototype._canDoCollision=function(a,b,c,d){var f=j.x.Distance(this._basePointWorld,a),h=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(f>this._velocityWorldLength+h+b)&&!!function(i,k,m,B){return!(i.x>m.x+B||m.x-B>k.x||i.y>m.y+B||m.y-B>k.y||i.z>m.z+B||m.z-B>k.z)}(c,d,this._basePointWorld,this._velocityWorldLength+h)},e.prototype._testTriangle=function(a,b,c,d,f,h){var i,k=!1;b||(b=[]),b[a]||(b[a]=new j.n(0,0,0,0),b[a].copyFromPoints(c,d,f));var m=b[a];if(h||m.isFrontFacingTo(this._normalizedVelocity,0)){var B=m.signedDistanceTo(this._basePoint),E=j.x.Dot(m.normal,this._velocity);if(0==E){if(Math.abs(B)>=1)return;k=!0,i=0}else{var K=(1-B)/E;if((i=(-1-B)/E)>K){var P=K;K=i,i=P}if(i>1||K<0)return;i<0&&(i=0),i>1&&(i=1)}this._collisionPoint.copyFromFloats(0,0,0);var S=!1,U=1;if(k||(this._basePoint.subtractToRef(m.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(i,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,c,d,f,m.normal)&&(S=!0,U=i,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!S){var _=this._velocity.lengthSquared(),da=_;this._basePoint.subtractToRef(c,this._tempVector);var fa=2*j.x.Dot(this._velocity,this._tempVector),ga=this._tempVector.lengthSquared()-1,ha=Jc(da,fa,ga,U);ha.found&&(U=ha.root,S=!0,this._collisionPoint.copyFrom(c)),this._basePoint.subtractToRef(d,this._tempVector),fa=2*j.x.Dot(this._velocity,this._tempVector),ga=this._tempVector.lengthSquared()-1,(ha=Jc(da,fa,ga,U)).found&&(U=ha.root,S=!0,this._collisionPoint.copyFrom(d)),this._basePoint.subtractToRef(f,this._tempVector),fa=2*j.x.Dot(this._velocity,this._tempVector),ga=this._tempVector.lengthSquared()-1,(ha=Jc(da,fa,ga,U)).found&&(U=ha.root,S=!0,this._collisionPoint.copyFrom(f)),d.subtractToRef(c,this._edge),c.subtractToRef(this._basePoint,this._baseToVertex);var ka=this._edge.lengthSquared(),la=j.x.Dot(this._edge,this._velocity),ma=j.x.Dot(this._edge,this._baseToVertex);if(da=ka*-_+la*la,fa=ka*(2*j.x.Dot(this._velocity,this._baseToVertex))-2*la*ma,ga=ka*(1-this._baseToVertex.lengthSquared())+ma*ma,(ha=Jc(da,fa,ga,U)).found){var ta=(la*ha.root-ma)/ka;ta>=0&&ta<=1&&(U=ha.root,S=!0,this._edge.scaleInPlace(ta),c.addToRef(this._edge,this._collisionPoint))}f.subtractToRef(d,this._edge),d.subtractToRef(this._basePoint,this._baseToVertex),ka=this._edge.lengthSquared(),la=j.x.Dot(this._edge,this._velocity),ma=j.x.Dot(this._edge,this._baseToVertex),da=ka*-_+la*la,fa=ka*(2*j.x.Dot(this._velocity,this._baseToVertex))-2*la*ma,ga=ka*(1-this._baseToVertex.lengthSquared())+ma*ma,(ha=Jc(da,fa,ga,U)).found&&(ta=(la*ha.root-ma)/ka)>=0&&ta<=1&&(U=ha.root,S=!0,this._edge.scaleInPlace(ta),d.addToRef(this._edge,this._collisionPoint)),c.subtractToRef(f,this._edge),f.subtractToRef(this._basePoint,this._baseToVertex),ka=this._edge.lengthSquared(),la=j.x.Dot(this._edge,this._velocity),ma=j.x.Dot(this._edge,this._baseToVertex),da=ka*-_+la*la,fa=ka*(2*j.x.Dot(this._velocity,this._baseToVertex))-2*la*ma,ga=ka*(1-this._baseToVertex.lengthSquared())+ma*ma,(ha=Jc(da,fa,ga,U)).found&&(ta=(la*ha.root-ma)/ka)>=0&&ta<=1&&(U=ha.root,S=!0,this._edge.scaleInPlace(ta),f.addToRef(this._edge,this._collisionPoint))}if(S){var pa=U*this._velocity.length();(!this.collisionFound||pa<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=pa,this.collisionFound=!0)}}},e.prototype._collide=function(a,b,c,d,f,h,i){for(var k=d;k<f;k+=3){var m=b[c[k]-h],B=b[c[k+1]-h],E=b[c[k+2]-h];this._testTriangle(k,a,E,B,m,i)}},e.prototype._getResponse=function(a,b){a.addToRef(b,this._destinationPoint),b.scaleInPlace(this._nearestDistance/b.length()),this._basePoint.addToRef(b,a),a.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),a.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(j.n.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,b)},e}(),Mg=function(){function e(){this._scaledPosition=j.x.Zero(),this._scaledVelocity=j.x.Zero(),this._finalPosition=j.x.Zero()}return e.prototype.getNewPosition=function(a,b,c,d,f,h,i){a.divideToRef(c._radius,this._scaledPosition),b.divideToRef(c._radius,this._scaledVelocity),c.collidedMesh=null,c._retry=0,c._initialVelocity=this._scaledVelocity,c._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,c,d,this._finalPosition,f),this._finalPosition.multiplyInPlace(c._radius),h(i,this._finalPosition,c.collidedMesh)},e.prototype.createCollider=function(){return new Lg()},e.prototype.init=function(a){this._scene=a},e.prototype._collideWithWorld=function(a,b,c,d,f,h){void 0===h&&(h=null);var i=10*va.b.CollisionsEpsilon;if(c._retry>=d)f.copyFrom(a);else{var k=h?h.collisionMask:c.collisionMask;c._initialize(a,b,i);for(var m=0;m<this._scene.meshes.length;m++){var B=this._scene.meshes[m];B.isEnabled()&&B.checkCollisions&&B.subMeshes&&B!==h&&0!=(k&B.collisionGroup)&&B._checkCollision(c)}c.collisionFound?(0===b.x&&0===b.y&&0===b.z||c._getResponse(a,b),b.length()<=i?f.copyFrom(a):(c._retry++,this._collideWithWorld(a,b,c,d,f,h))):a.addToRef(b,f)}},e}();ja.a.CollisionCoordinatorFactory=function(){return new Mg()};var Hd=l(50),Xi=l(81),Yi=l(108),Le=l(77),Kc=l(43),Ng=l(82),Og=function(){function e(a,b,c,d,f,h){this.entries=new Array(),this._boundingVectors=new Array(),this._capacity=c,this._depth=d,this._maxDepth=f,this._creationFunc=h,this._minPoint=a,this._maxPoint=b,this._boundingVectors.push(a.clone()),this._boundingVectors.push(b.clone()),this._boundingVectors.push(a.clone()),this._boundingVectors[2].x=b.x,this._boundingVectors.push(a.clone()),this._boundingVectors[3].y=b.y,this._boundingVectors.push(a.clone()),this._boundingVectors[4].z=b.z,this._boundingVectors.push(b.clone()),this._boundingVectors[5].z=a.z,this._boundingVectors.push(b.clone()),this._boundingVectors[6].x=a.x,this._boundingVectors.push(b.clone()),this._boundingVectors[7].y=a.y}return Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),e.prototype.addEntry=function(a){if(this.blocks)for(var b=0;b<this.blocks.length;b++)this.blocks[b].addEntry(a);else this._creationFunc(a,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},e.prototype.removeEntry=function(a){if(this.blocks)for(var b=0;b<this.blocks.length;b++)this.blocks[b].removeEntry(a);else{var c=this.entries.indexOf(a);c>-1&&this.entries.splice(c,1)}},e.prototype.addEntries=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.addEntry(c)}},e.prototype.select=function(a,b,c){if(Le.a.IsInFrustum(this._boundingVectors,a)){if(this.blocks){for(var d=0;d<this.blocks.length;d++)this.blocks[d].select(a,b,c);return}c?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}},e.prototype.intersects=function(a,b,c,d){if(Le.a.IntersectsSphere(this._minPoint,this._maxPoint,a,b)){if(this.blocks){for(var f=0;f<this.blocks.length;f++)this.blocks[f].intersects(a,b,c,d);return}d?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}},e.prototype.intersectsRay=function(a,b){if(a.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var c=0;c<this.blocks.length;c++)this.blocks[c].intersectsRay(a,b);return}b.concatWithNoDuplicate(this.entries)}},e.prototype.createInnerBlocks=function(){e._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},e._CreateBlocks=function(a,b,c,d,f,h,i,k){i.blocks=new Array();for(var m=new j.x((b.x-a.x)/2,(b.y-a.y)/2,(b.z-a.z)/2),B=0;B<2;B++)for(var E=0;E<2;E++)for(var K=0;K<2;K++){var P=new e(a.add(m.multiplyByFloats(B,E,K)),a.add(m.multiplyByFloats(B+1,E+1,K+1)),d,f+1,h,k);P.addEntries(c),i.blocks.push(P)}},e}(),bd=function(){function e(a,b,c){void 0===c&&(c=2),this.maxDepth=c,this.dynamicContent=new Array(),this._maxBlockCapacity=b||64,this._selectionContent=new ic.b(1024),this._creationFunc=a}return e.prototype.update=function(a,b,c){Og._CreateBlocks(a,b,c,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},e.prototype.addMesh=function(a){for(var b=0;b<this.blocks.length;b++)this.blocks[b].addEntry(a)},e.prototype.removeMesh=function(a){for(var b=0;b<this.blocks.length;b++)this.blocks[b].removeEntry(a)},e.prototype.select=function(a,b){this._selectionContent.reset();for(var c=0;c<this.blocks.length;c++)this.blocks[c].select(a,this._selectionContent,b);return b?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersects=function(a,b,c){this._selectionContent.reset();for(var d=0;d<this.blocks.length;d++)this.blocks[d].intersects(a,b,this._selectionContent,c);return c?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersectsRay=function(a){this._selectionContent.reset();for(var b=0;b<this.blocks.length;b++)this.blocks[b].intersectsRay(a,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.CreationFuncForMeshes=function(a,b){var c=a.getBoundingInfo();!a.isBlocked&&c.boundingBox.intersectsMinMax(b.minPoint,b.maxPoint)&&b.entries.push(a)},e.CreationFuncForSubMeshes=function(a,b){a.getBoundingInfo().boundingBox.intersectsMinMax(b.minPoint,b.maxPoint)&&b.entries.push(a)},e}();ja.a.prototype.createOrUpdateSelectionOctree=function(e,a){void 0===e&&(e=64),void 0===a&&(a=2);var b=this._getComponent(Pa.a.NAME_OCTREE);b||(b=new Me(this),this._addComponent(b)),this._selectionOctree||(this._selectionOctree=new bd(bd.CreationFuncForMeshes,e,a));var c=this.getWorldExtends();return this._selectionOctree.update(c.min,c.max,this.meshes),this._selectionOctree},Object.defineProperty(ja.a.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),kb.a.prototype.createOrUpdateSubmeshesOctree=function(e,a){void 0===e&&(e=64),void 0===a&&(a=2);var b=this.getScene(),c=b._getComponent(Pa.a.NAME_OCTREE);c||(c=new Me(b),b._addComponent(c)),this._submeshesOctree||(this._submeshesOctree=new bd(bd.CreationFuncForSubMeshes,e,a)),this.computeWorldMatrix(!0);var d=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(d.minimumWorld,d.maximumWorld,this.subMeshes),this._submeshesOctree};var Me=function(){function e(a){this.name=Pa.a.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Nb.a(j.x.Zero(),new j.x(1,1,1)),this.scene=a,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return e.prototype.register=function(){var a=this;this.scene.onMeshRemovedObservable.add(function(b){var c=a.scene.selectionOctree;if(null!=c){var d=c.dynamicContent.indexOf(b);-1!==d&&c.dynamicContent.splice(d,1)}}),this.scene.onMeshImportedObservable.add(function(b){var c=a.scene.selectionOctree;null!=c&&c.addMesh(b)})},e.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},e.prototype.getActiveSubMeshCandidates=function(a){return a._submeshesOctree&&a.useOctreeForRenderingSelection?a._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(a)},e.prototype.getIntersectingSubMeshCandidates=function(a,b){return a._submeshesOctree&&a.useOctreeForPicking?(Nb.a.TransformToRef(b,a.getWorldMatrix(),this._tempRay),a._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(a)},e.prototype.getCollidingSubMeshCandidates=function(a,b){if(a._submeshesOctree&&a.useOctreeForCollisions){var c=b._velocityWorldLength+Math.max(b._radius.x,b._radius.y,b._radius.z);return a._submeshesOctree.intersects(b._basePointWorld,c)}return this.scene._getDefaultSubMeshCandidates(a)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e}(),Lc=l(74),Pg=l(128),Qg=function(){return function(){this._timeElapsedQueryEnded=!1}}(),Rg=function(){return function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=kb.a.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=kb.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE}}();va.b.prototype.createQuery=function(){return this._gl.createQuery()},va.b.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this},va.b.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)},va.b.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)},va.b.prototype.beginOcclusionQuery=function(e,a){var b=this._getGlAlgorithmType(e);return this._gl.beginQuery(b,a),this},va.b.prototype.endOcclusionQuery=function(e){var a=this._getGlAlgorithmType(e);return this._gl.endQuery(a),this},va.b.prototype._createTimeQuery=function(){var e=this.getCaps().timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()},va.b.prototype._deleteTimeQuery=function(e){var a=this.getCaps().timerQuery;a.deleteQueryEXT?a.deleteQueryEXT(e):this.deleteQuery(e)},va.b.prototype._getTimeQueryResult=function(e){var a=this.getCaps().timerQuery;return a.getQueryObjectEXT?a.getQueryObjectEXT(e,a.QUERY_RESULT_EXT):this.getQueryResult(e)},va.b.prototype._getTimeQueryAvailability=function(e){var a=this.getCaps().timerQuery;return a.getQueryObjectEXT?a.getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)},va.b.prototype.startTimeQuery=function(){var e=this.getCaps(),a=e.timerQuery;if(!a)return null;var b=new Qg();if(this._gl.getParameter(a.GPU_DISJOINT_EXT),e.canUseTimestampForTimerQuery)b._startTimeQuery=this._createTimeQuery(),a.queryCounterEXT(b._startTimeQuery,a.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;b._timeElapsedQuery=this._createTimeQuery(),a.beginQueryEXT?a.beginQueryEXT(a.TIME_ELAPSED_EXT,b._timeElapsedQuery):this._gl.beginQuery(a.TIME_ELAPSED_EXT,b._timeElapsedQuery),this._currentNonTimestampToken=b}return b},va.b.prototype.endTimeQuery=function(e){var a=this.getCaps(),b=a.timerQuery;if(!b||!e)return-1;if(a.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return-1;e._endTimeQuery||(e._endTimeQuery=this._createTimeQuery(),b.queryCounterEXT(e._endTimeQuery,b.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return-1;b.endQueryEXT?b.endQueryEXT(b.TIME_ELAPSED_EXT):this._gl.endQuery(b.TIME_ELAPSED_EXT),e._timeElapsedQueryEnded=!0}var c=this._gl.getParameter(b.GPU_DISJOINT_EXT),d=!1;if(e._endTimeQuery?d=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(d=this._getTimeQueryAvailability(e._timeElapsedQuery)),d&&!c){var f=0;if(a.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return-1;var h=this._getTimeQueryResult(e._startTimeQuery);f=this._getTimeQueryResult(e._endTimeQuery)-h,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return-1;f=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return f}return-1},va.b.prototype._getGlAlgorithmType=function(e){return e===kb.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(kb.a.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},enumerable:!1,configurable:!0}),Object.defineProperty(kb.a.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new Rg()),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(kb.a.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(e){this._occlusionDataStorage.isOccluded=e},enumerable:!0,configurable:!0}),Object.defineProperty(kb.a.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(e){this._occlusionDataStorage.occlusionQueryAlgorithmType=e},enumerable:!0,configurable:!0}),Object.defineProperty(kb.a.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(e){this._occlusionDataStorage.occlusionType=e},enumerable:!0,configurable:!0}),Object.defineProperty(kb.a.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(e){this._occlusionDataStorage.occlusionRetryCount=e},enumerable:!0,configurable:!0}),kb.a.prototype._checkOcclusionQuery=function(){var e=this._occlusionDataStorage;if(e.occlusionType===kb.a.OCCLUSION_TYPE_NONE)return e.isOccluded=!1,!1;var a=this.getEngine();if(a.webGLVersion<2)return e.isOccluded=!1,!1;if(!a.isQueryResultAvailable)return e.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(a.isQueryResultAvailable(this._occlusionQuery)){var b=a.getQueryResult(this._occlusionQuery);e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=1!==b}else{if(e.occlusionInternalRetryCounter++,!(-1!==e.occlusionRetryCount&&e.occlusionInternalRetryCounter>e.occlusionRetryCount))return!1;e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=e.occlusionType!==kb.a.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded}var c=this.getScene();if(c.getBoundingBoxRenderer){var d=c.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=a.createQuery()),a.beginOcclusionQuery(e.occlusionQueryAlgorithmType,this._occlusionQuery),d.renderOcclusionBoundingBox(this),a.endOcclusionQuery(e.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return e.isOccluded},va.b.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},va.b.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},va.b.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},va.b.prototype.beginTransformFeedback=function(e){void 0===e&&(e=!0),this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},va.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},va.b.prototype.setTranformFeedbackVaryings=function(e,a){this._gl.transformFeedbackVaryings(e,a,this._gl.INTERLEAVED_ATTRIBS)},va.b.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e?e.underlyingResource:null)};var Zi=l(107),Id=function(){function e(){}return e.COPY=1,e.CUT=2,e.PASTE=3,e}(),_i=function(){function e(a,b){this.type=a,this.event=b}return e.GetTypeFromCharacter=function(a){switch(a){case 67:return Id.COPY;case 86:return Id.PASTE;case 88:return Id.CUT;default:return-1}},e}(),Ne=l(59),jc=l(55),Sg=function(){function e(a,b,c){this.lengthComputable=a,this.loaded=b,this.total=c}return e.FromProgressEvent=function(a){return new e(a.lengthComputable,a.loaded,a.total)},e}(),tb=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return jc.a.ForceFullSceneLoadingForIncremental},set:function(a){jc.a.ForceFullSceneLoadingForIncremental=a},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return jc.a.ShowLoadingScreen},set:function(a){jc.a.ShowLoadingScreen=a},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return jc.a.loggingLevel},set:function(a){jc.a.loggingLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return jc.a.CleanBoneMatrixWeights},set:function(a){jc.a.CleanBoneMatrixWeights=a},enumerable:!0,configurable:!0}),e._getDefaultPlugin=function(){return e._registeredPlugins[".babylon"]},e._getPluginForExtension=function(a){var b=e._registeredPlugins[a];return b||(r.a.Warn("Unable to find a plugin to load "+a+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"),e._getDefaultPlugin())},e._getPluginForDirectLoad=function(a){for(var b in e._registeredPlugins){var c=e._registeredPlugins[b].plugin;if(c.canDirectLoad&&c.canDirectLoad(a))return e._registeredPlugins[b]}return e._getDefaultPlugin()},e._getPluginForFilename=function(a){var b=a.indexOf("?");-1!==b&&(a=a.substring(0,b));var c=a.lastIndexOf("."),d=a.substring(c,a.length).toLowerCase();return e._getPluginForExtension(d)},e._getDirectLoad=function(a){return"data:"===a.substr(0,5)?a.substr(5):null},e._loadData=function(a,b,c,d,f,h,i){var k,m=e._getDirectLoad(a.name),B=i?e._getPluginForExtension(i):m?e._getPluginForDirectLoad(a.name):e._getPluginForFilename(a.name);if(!(k=B.plugin.createPlugin?B.plugin.createPlugin():B.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";var E,K=B.isBinary;e.OnPluginActivatedObservable.notifyObservers(k);var P=function(ta,pa){b.isDisposed?f("Scene has been disposed"):(b.offlineProvider=E,c(k,ta,pa))},S=null,U=!1,_=k.onDisposeObservable;_&&_.add(function(){U=!0,S&&(S.abort(),S=null),h()});var da=function(){U||(S=xa.h.LoadFile(a.url,P,d?function(ta){d(Sg.FromProgressEvent(ta))}:void 0,E,K,function(ta,pa){f("Failed to load scene."+(pa?" "+pa.message:""),pa)}))};if(m)return P(m),k;var fa=a.file||Ne.a.FilesToLoad[a.name.toLowerCase()];if(-1===a.rootUrl.indexOf("file:")||-1!==a.rootUrl.indexOf("file:")&&!fa){var ga=b.getEngine(),ha=ga.enableOfflineSupport;if(ha){for(var ka=!1,la=0,ma=b.disableOfflineSupportExceptionRules;la<ma.length;la++)if(ma[la].test(a.url)){ka=!0;break}ha=!ka}ha&&va.b.OfflineProviderFactory?E=va.b.OfflineProviderFactory(a.url,da,ga.disableManifestCheck):da()}else fa?S=xa.h.ReadFile(fa,P,d,K):f("Unable to find file named "+a.name);return k},e._getFileInfo=function(a,b){var c,d,f=null;if(b)if(b.name){var h=b;c=a+h.name,d=h.name,f=h}else{var i=b;if("/"===i.substr(0,1))return xa.h.Error("Wrong sceneFilename parameter"),null;c=a+i,d=i}else c=a,d=xa.h.GetFilename(a),a=xa.h.GetFolderPath(a);return{url:c,rootUrl:a,name:d,file:f}},e.GetPluginForExtension=function(a){return e._getPluginForExtension(a).plugin},e.IsPluginForExtensionAvailable=function(a){return!!e._registeredPlugins[a]},e.RegisterPlugin=function(a){if("string"==typeof a.extensions){var b=a.extensions;e._registeredPlugins[b.toLowerCase()]={plugin:a,isBinary:!1}}else{var c=a.extensions;Object.keys(c).forEach(function(d){e._registeredPlugins[d.toLowerCase()]={plugin:a,isBinary:c[d].isBinary}})}},e.ImportMesh=function(a,b,c,d,f,h,i,k){if(void 0===c&&(c=""),void 0===d&&(d=T.a.LastCreatedScene),void 0===f&&(f=null),void 0===h&&(h=null),void 0===i&&(i=null),void 0===k&&(k=null),!d)return r.a.Error("No scene available to import mesh to"),null;var m=e._getFileInfo(b,c);if(!m)return null;var B={};d._addPendingData(B);var E=function(){d._removePendingData(B)},K=function(U,_){var da="Unable to import meshes from "+m.url+": "+U;i?i(d,da,_):r.a.Error(da),E()},P=h?function(U){try{h(U)}catch(_){K("Error in onProgress callback",_)}}:void 0,S=function(U,_,da,fa){if(d.importedMeshesFiles.push(m.url),f)try{f(U,_,da,fa)}catch(ga){K("Error in onSuccess callback",ga)}d._removePendingData(B)};return e._loadData(m,d,function(U,_,da){if(U.rewriteRootURL&&(m.rootUrl=U.rewriteRootURL(m.rootUrl,da)),U.importMesh){var fa=U,ga=new Array(),ha=new Array(),ka=new Array();if(!fa.importMesh(a,d,_,m.rootUrl,ga,ha,ka,K))return;d.loadingPluginName=U.name,S(ga,ha,ka,[])}else U.importMeshAsync(a,d,_,m.rootUrl,P,m.name).then(function(la){d.loadingPluginName=U.name,S(la.meshes,la.particleSystems,la.skeletons,la.animationGroups)}).catch(function(la){K(la.message,la)})},P,K,E,k)},e.ImportMeshAsync=function(a,b,c,d,f,h){return void 0===c&&(c=""),void 0===d&&(d=T.a.LastCreatedScene),void 0===f&&(f=null),void 0===h&&(h=null),new Promise(function(i,k){e.ImportMesh(a,b,c,d,function(m,B,E,K){i({meshes:m,particleSystems:B,skeletons:E,animationGroups:K})},f,function(m,B,E){k(E||new Error(B))},h)})},e.Load=function(a,b,c,d,f,h,i){return void 0===b&&(b=""),void 0===c&&(c=T.a.LastCreatedEngine),void 0===d&&(d=null),void 0===f&&(f=null),void 0===h&&(h=null),void 0===i&&(i=null),c?e.Append(a,b,new ja.a(c),d,f,h,i):(xa.h.Error("No engine available"),null)},e.LoadAsync=function(a,b,c,d,f){return void 0===b&&(b=""),void 0===c&&(c=T.a.LastCreatedEngine),void 0===d&&(d=null),void 0===f&&(f=null),new Promise(function(h,i){e.Load(a,b,c,function(k){h(k)},d,function(k,m,B){i(B||new Error(m))},f)})},e.Append=function(a,b,c,d,f,h,i){if(void 0===b&&(b=""),void 0===c&&(c=T.a.LastCreatedScene),void 0===d&&(d=null),void 0===f&&(f=null),void 0===h&&(h=null),void 0===i&&(i=null),!c)return r.a.Error("No scene available to append to"),null;var k=e._getFileInfo(a,b);if(!k)return null;e.ShowLoadingScreen&&c.getEngine().displayLoadingUI();var m={};c._addPendingData(m);var B=function(){c._removePendingData(m),c.getEngine().hideLoadingUI()},E=function(S,U){var _="Unable to load from "+k.url+(S?": "+S:"");h?h(c,_,U):r.a.Error(_),B()},K=f?function(S){try{f(S)}catch(U){E("Error in onProgress callback",U)}}:void 0,P=function(){if(d)try{d(c)}catch(S){E("Error in onSuccess callback",S)}c._removePendingData(m)};return e._loadData(k,c,function(S,U){if(S.load){if(!S.load(c,U,k.rootUrl,E))return;c.loadingPluginName=S.name,P()}else S.loadAsync(c,U,k.rootUrl,K,k.name).then(function(){c.loadingPluginName=S.name,P()}).catch(function(_){E(_.message,_)});e.ShowLoadingScreen&&c.executeWhenReady(function(){c.getEngine().hideLoadingUI()})},K,E,B,i)},e.AppendAsync=function(a,b,c,d,f){return void 0===b&&(b=""),void 0===c&&(c=T.a.LastCreatedScene),void 0===d&&(d=null),void 0===f&&(f=null),new Promise(function(h,i){e.Append(a,b,c,function(k){h(k)},d,function(k,m,B){i(B||new Error(m))},f)})},e.LoadAssetContainer=function(a,b,c,d,f,h,i){if(void 0===b&&(b=""),void 0===c&&(c=T.a.LastCreatedScene),void 0===d&&(d=null),void 0===f&&(f=null),void 0===h&&(h=null),void 0===i&&(i=null),!c)return r.a.Error("No scene available to load asset container to"),null;var k=e._getFileInfo(a,b);if(!k)return null;var m={};c._addPendingData(m);var B=function(){c._removePendingData(m)},E=function(S,U){var _="Unable to load assets from "+k.url+(S?": "+S:"");h?h(c,_,U):r.a.Error(_),B()},K=f?function(S){try{f(S)}catch(U){E("Error in onProgress callback",U)}}:void 0,P=function(S){if(d)try{d(S)}catch(U){E("Error in onSuccess callback",U)}c._removePendingData(m)};return e._loadData(k,c,function(S,U){if(S.loadAssetContainer){var _=S.loadAssetContainer(c,U,k.rootUrl,E);if(!_)return;c.loadingPluginName=S.name,P(_)}else S.loadAssetContainerAsync?S.loadAssetContainerAsync(c,U,k.rootUrl,K,k.name).then(function(da){c.loadingPluginName=S.name,P(da)}).catch(function(da){E(da.message,da)}):E("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");e.ShowLoadingScreen&&c.executeWhenReady(function(){c.getEngine().hideLoadingUI()})},K,E,B,i)},e.LoadAssetContainerAsync=function(a,b,c,d,f){return void 0===b&&(b=""),void 0===c&&(c=T.a.LastCreatedScene),void 0===d&&(d=null),void 0===f&&(f=null),new Promise(function(h,i){e.LoadAssetContainer(a,b,c,function(k){h(k)},d,function(k,m,B){i(B||new Error(m))},f)})},e.NO_LOGGING=o.a.SCENELOADER_NO_LOGGING,e.MINIMAL_LOGGING=o.a.SCENELOADER_MINIMAL_LOGGING,e.SUMMARY_LOGGING=o.a.SCENELOADER_SUMMARY_LOGGING,e.DETAILED_LOGGING=o.a.SCENELOADER_DETAILED_LOGGING,e.OnPluginActivatedObservable=new q.c(),e._registeredPlugins={},e}(),Oe=function(e){function a(b){var c=e.call(this,b)||this;return c.controllerType=_b.DAYDREAM,c}return v.d(a,e),a.prototype.initControllerMesh=function(b,c){var d=this;tb.ImportMesh("",a.MODEL_BASE_URL,a.MODEL_FILENAME,b,function(f){d._defaultModel=f[1],d.attachToMesh(d._defaultModel),c&&c(d._defaultModel)})},a.prototype._handleButtonChange=function(b,c,d){if(0===b){var f=this.onTriggerStateChangedObservable;f&&f.notifyObservers(c)}else r.a.Warn("Unrecognized Daydream button index: "+b)},a.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",a.MODEL_FILENAME="generic.babylon",a.GAMEPAD_ID_PREFIX="Daydream",a}(tc);rc._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(Oe.GAMEPAD_ID_PREFIX)},create:function(e){return new Oe(e)}});var Pe=function(e){function a(b){var c=e.call(this,b)||this;return c._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"],c.controllerType=_b.GEAR_VR,c._calculatedPosition=new j.x("left"==c.hand?-.15:.15,-.5,.25),c._disableTrackPosition(c._calculatedPosition),c}return v.d(a,e),a.prototype.initControllerMesh=function(b,c){var d=this;tb.ImportMesh("",a.MODEL_BASE_URL,a.MODEL_FILENAME,b,function(f){var h=new Ca.a("",b);f[1].parent=h,f[1].position.z=-.15,d._defaultModel=h,d.attachToMesh(d._defaultModel),c&&c(d._defaultModel)})},a.prototype._handleButtonChange=function(b,c,d){if(b<this._buttonIndexToObservableNameMap.length){var f=this[this._buttonIndexToObservableNameMap[b]];f&&f.notifyObservers(c)}},a.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",a.MODEL_FILENAME="generic.babylon",a.GAMEPAD_ID_PREFIX="Gear VR",a}(tc);rc._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(Pe.GAMEPAD_ID_PREFIX)||-1!==e.id.indexOf("Oculus Go")},create:function(e){return new Pe(e)}});var Jd=function(e){function a(b){return e.call(this,b)||this}return v.d(a,e),a.prototype.initControllerMesh=function(b,c){var d=this;tb.ImportMesh("",a.MODEL_BASE_URL,a.MODEL_FILENAME,b,function(f){d._defaultModel=f[1],d.attachToMesh(d._defaultModel),c&&c(d._defaultModel)})},a.prototype._handleButtonChange=function(b,c,d){console.log("Button id: "+b+"state: "),console.dir(c)},a.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",a.MODEL_FILENAME="generic.babylon",a}(tc);rc._DefaultControllerFactory=function(e){return new Jd(e)};var Tg=function(e){function a(b){var c=e.call(this,b)||this;return c.onSecondaryTriggerStateChangedObservable=new q.c(),c.onThumbRestChangedObservable=new q.c(),c.controllerType=_b.OCULUS,c}return v.d(a,e),a.prototype.initControllerMesh=function(b,c){var d,f=this;d="left"===this.hand?a.MODEL_LEFT_FILENAME:a.MODEL_RIGHT_FILENAME,tb.ImportMesh("",a.MODEL_BASE_URL,d,b,function(h){f._defaultModel=h[1],f.attachToMesh(f._defaultModel),c&&c(f._defaultModel)})},Object.defineProperty(a.prototype,"onAButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!0,configurable:!0}),a.prototype._handleButtonChange=function(b,c,d){var f=c,h="right"===this.hand?-1:1;switch(b){case 0:return void this.onPadStateChangedObservable.notifyObservers(f);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-f.value,this._defaultModel.getChildren()[3].position.y=.005*-f.value,this._defaultModel.getChildren()[3].position.z=.005*-f.value),void this.onTriggerStateChangedObservable.notifyObservers(f);case 2:return this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=h*f.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(f);case 3:return this._defaultModel&&(f.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(f);case 4:return this._defaultModel&&(f.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(f);case 5:return void this.onThumbRestChangedObservable.notifyObservers(f)}},a.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",a.MODEL_LEFT_FILENAME="left.babylon",a.MODEL_RIGHT_FILENAME="right.babylon",a}(tc);rc._ControllerFactories.push({canCreate:function(e){return-1!==e.id.indexOf("Oculus Touch")},create:function(e){return new Tg(e)}});var Ug=function(e){function a(b){var c=e.call(this,b)||this;return c.controllerType=_b.VIVE,c._invertLeftStickY=!0,c}return v.d(a,e),a.prototype.initControllerMesh=function(b,c){var d=this;tb.ImportMesh("",a.MODEL_BASE_URL,a.MODEL_FILENAME,b,function(f){d._defaultModel=f[1],d.attachToMesh(d._defaultModel),c&&c(d._defaultModel)})},Object.defineProperty(a.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),a.prototype._handleButtonChange=function(b,c,d){var f=c;switch(b){case 0:return void this.onPadStateChangedObservable.notifyObservers(f);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-f.value),void this.onTriggerStateChangedObservable.notifyObservers(f);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(f);case 3:return this._defaultModel&&(f.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(f)}},a.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",a.MODEL_FILENAME="wand.babylon",a}(tc);rc._ControllerFactories.push({canCreate:function(e){return-1!==e.id.toLowerCase().indexOf("openvr")},create:function(e){return new Ug(e)}});var $i=function(){return function(){this.buttonMeshes={},this.axisMeshes={}}}(),Qe=function(e){function a(b){var c=e.call(this,b)||this;return c._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:_c.POINTING_POSE},c.onTrackpadChangedObservable=new q.c(),c.onTrackpadValuesChangedObservable=new q.c(),c.trackpad={x:0,y:0},c.controllerType=_b.WINDOWS,c._loadedMeshInfo=null,c}return v.d(a,e),Object.defineProperty(a.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!0,configurable:!0}),a.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},a.prototype.update=function(){if(e.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var b=0;b<this._mapping.axisMeshNames.length;b++)this._lerpAxisTransform(b,this.browserGamepad.axes[b])},a.prototype._handleButtonChange=function(b,c,d){var f=this._mapping.buttons[b];if(f){this._updateTrackpad();var h=this[this._mapping.buttonObservableNames[f]];h&&h.notifyObservers(c),this._lerpButtonTransform(f,c.value)}},a.prototype._lerpButtonTransform=function(b,c){if(this._loadedMeshInfo){var d=this._loadedMeshInfo.buttonMeshes[b];d.unpressed.rotationQuaternion&&d.pressed.rotationQuaternion&&d.value.rotationQuaternion&&(j.q.SlerpToRef(d.unpressed.rotationQuaternion,d.pressed.rotationQuaternion,c,d.value.rotationQuaternion),j.x.LerpToRef(d.unpressed.position,d.pressed.position,c,d.value.position))}},a.prototype._lerpAxisTransform=function(b,c){if(this._loadedMeshInfo){var d=this._loadedMeshInfo.axisMeshes[b];if(d&&d.min.rotationQuaternion&&d.max.rotationQuaternion&&d.value.rotationQuaternion){var f=.5*c+.5;j.q.SlerpToRef(d.min.rotationQuaternion,d.max.rotationQuaternion,f,d.value.rotationQuaternion),j.x.LerpToRef(d.min.position,d.max.position,f,d.value.position)}}},a.prototype.initControllerMesh=function(b,c,d){var f,h,i=this;if(void 0===d&&(d=!1),tb.IsPluginForExtensionAvailable(".glb")){var k="default";if(this.id&&!d){var m=this.id.match(a.GAMEPAD_ID_PATTERN);k=m&&m[0]||k}h="left"===this.hand?a.MODEL_LEFT_FILENAME:a.MODEL_RIGHT_FILENAME,f=a.MODEL_BASE_URL+k+"/"}else r.a.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),f=Jd.MODEL_BASE_URL,h=Jd.MODEL_FILENAME;tb.ImportMesh("",f,h,b,function(B){i._loadedMeshInfo=i.processModel(b,B),i._loadedMeshInfo&&(i._defaultModel=i._loadedMeshInfo.rootNode,i.attachToMesh(i._defaultModel),c&&c(i._defaultModel))},null,function(B,E){r.a.Log(E),r.a.Warn("Failed to retrieve controller model from the remote server: "+f+h),d||i.initControllerMesh(B,c,!0)})},a.prototype.processModel=function(b,c){for(var d=null,f=new Ca.a(this.id+" "+this.hand,b),h=null,i=0;i<c.length;i++){var k=c[i];if(!k.parent){k.isPickable=!1,h=k;break}}return h?(h.setParent(f),d=this.createMeshInfo(f)):r.a.Warn("Could not find root node in model file."),d},a.prototype.createMeshInfo=function(b){var c,d=new $i();for(d.rootNode=b,d.buttonMeshes={},d.axisMeshes={},c=0;c<this._mapping.buttons.length;c++){var f=this._mapping.buttonMeshNames[this._mapping.buttons[c]];if(f){var h=E(b,f);if(h){var i={index:c,value:K(h,"VALUE"),pressed:K(h,"PRESSED"),unpressed:K(h,"UNPRESSED")};i.value&&i.pressed&&i.unpressed?d.buttonMeshes[this._mapping.buttons[c]]=i:r.a.Warn("Missing button submesh under mesh with name: "+f+"(VALUE: "+!!i.value+", PRESSED: "+!!i.pressed+", UNPRESSED:"+!!i.unpressed+")")}else r.a.Warn("Missing button mesh with name: "+f)}else r.a.Log("Skipping unknown button at index: "+c+" with mapped name: "+this._mapping.buttons[c])}for(c=0;c<this._mapping.axisMeshNames.length;c++){var k=this._mapping.axisMeshNames[c];if(k){var m=E(b,k);if(m){var B={index:c,value:K(m,"VALUE"),min:K(m,"MIN"),max:K(m,"MAX")};B.value&&B.min&&B.max?d.axisMeshes[c]=B:r.a.Warn("Missing axis submesh under mesh with name: "+k+"(VALUE: "+!!B.value+", MIN: "+!!B.min+", MAX:"+!!B.max+")")}else r.a.Warn("Missing axis mesh with name: "+k)}else r.a.Log("Skipping unknown axis at index: "+c)}return d.pointingPoseNode=E(b,this._mapping.pointingPoseMeshName),d.pointingPoseNode?this._pointingPoseNode=d.pointingPoseNode:r.a.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),d;function E(P,S){return P.getChildren(function(U){return U.name===S},!1)[0]}function K(P,S){return P.getChildren(function(U){return U.name==S},!0)[0]}},a.prototype.getForwardRay=function(b){if(void 0===b&&(b=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return e.prototype.getForwardRay.call(this,b);var c=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),d=c.getTranslation(),f=new j.x(0,0,-1),h=j.x.TransformNormal(f,c),i=j.x.Normalize(h);return new Nb.a(d,i,b)},a.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear()},a.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",a.MODEL_LEFT_FILENAME="left.glb",a.MODEL_RIGHT_FILENAME="right.glb",a.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",a.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,a}(tc);rc._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(Qe.GAMEPAD_ID_PREFIX)},create:function(e){return new Qe(e)}});var Kd=l(58),cd=l(52),uc=l(48),kc=l(41),dd=function(e){function a(b,c,d){void 0===c&&(c=j.e.Gray()),void 0===d&&(d=kc.a.DefaultUtilityLayer);var f=e.call(this,d)||this;f._pointerObserver=null,f.snapDistance=0,f.onSnapObservable=new q.c(),f.uniformScaling=!1,f._coloredMaterial=new Pb.a("",d.utilityLayerScene),f._coloredMaterial.diffuseColor=c,f._coloredMaterial.specularColor=c.subtract(new j.e(.1,.1,.1));var h=new Pb.a("",d.utilityLayerScene);h.diffuseColor=c.add(new j.e(.3,.3,.3));var i=new kb.a("",d.utilityLayerScene),k=cd.a.CreateBox("yPosMesh",{size:.4},d.utilityLayerScene),m=ad.a.CreateCylinder("cylinder",{diameterTop:.005,height:.275,diameterBottom:.005,tessellation:96},d.utilityLayerScene);m.material=f._coloredMaterial,i.addChild(k),i.addChild(m),k.scaling.scaleInPlace(.1),k.material=f._coloredMaterial,k.rotation.x=Math.PI/2,k.position.z+=.3,m.position.z+=.1375,m.rotation.x=Math.PI/2,i.lookAt(f._rootMesh.position.add(b)),f._rootMesh.addChild(i),i.scaling.scaleInPlace(1/3),f.dragBehavior=new pc.a({dragAxis:b}),f.dragBehavior.moveAttached=!1,f._rootMesh.addBehavior(f.dragBehavior);var B=0,E=new j.x(),K={snapDistance:0};f.dragBehavior.onDragObservable.add(function(S){if(f.attachedMesh){var U=S.dragDistance*(3*f.scaleRatio/f._rootMesh.scaling.length()),_=!1,da=0;f.uniformScaling?(f.attachedMesh.scaling.normalizeToRef(E),E.y<0&&E.scaleInPlace(-1)):E.copyFrom(b),0==f.snapDistance?E.scaleToRef(U,E):(B+=U,Math.abs(B)>f.snapDistance?(da=Math.floor(Math.abs(B)/f.snapDistance),B<0&&(da*=-1),B%=f.snapDistance,E.scaleToRef(f.snapDistance*da,E),_=!0):E.scaleInPlace(0)),f.attachedMesh.scaling.addInPlace(E),_&&(K.snapDistance=f.snapDistance*da,f.onSnapObservable.notifyObservers(K))}}),f._pointerObserver=d.utilityLayerScene.onPointerObservable.add(function(S){if(!f._customMeshSet){var U=S.pickInfo&&-1!=f._rootMesh.getChildMeshes().indexOf(S.pickInfo.pickedMesh)?h:f._coloredMaterial;f._rootMesh.getChildMeshes().forEach(function(_){_.material=U,_.color&&(_.color=U.diffuseColor)})}});var P=d._getSharedGizmoLight();return P.includedOnlyMeshes=P.includedOnlyMeshes.concat(f._rootMesh.getChildMeshes()),f}return v.d(a,e),a.prototype._attachedMeshChanged=function(b){this.dragBehavior&&(this.dragBehavior.enabled=!!b)},a.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},a.prototype.setCustomMesh=function(b,c){var d=this;void 0===c&&(c=!1),e.prototype.setCustomMesh.call(this,b),c&&(this._rootMesh.getChildMeshes().forEach(function(f){f.material=d._coloredMaterial,f.color&&(f.color=d._coloredMaterial.diffuseColor)}),this._customMeshSet=!1)},a}(uc.a),lc=l(46),Kb=l(40),Vg=function(e){function a(b,c){void 0===b&&(b=j.e.Gray()),void 0===c&&(c=kc.a.DefaultKeepDepthUtilityLayer);var d=e.call(this,c)||this;d._boundingDimensions=new j.x(1,1,1),d._renderObserver=null,d._pointerObserver=null,d._scaleDragSpeed=.2,d._tmpQuaternion=new j.q(),d._tmpVector=new j.x(0,0,0),d._tmpRotationMatrix=new j.j(),d.ignoreChildren=!1,d.includeChildPredicate=null,d.rotationSphereSize=.1,d.scaleBoxSize=.1,d.fixedDragMeshScreenSize=!1,d.fixedDragMeshScreenSizeDistanceFactor=10,d.onDragStartObservable=new q.c(),d.onScaleBoxDragObservable=new q.c(),d.onScaleBoxDragEndObservable=new q.c(),d.onRotationSphereDragObservable=new q.c(),d.onRotationSphereDragEndObservable=new q.c(),d.scalePivot=null,d._existingMeshScale=new j.x(),d._dragMesh=null,d.pointerDragBehavior=new pc.a(),d._updateScale=!1,d._anchorMesh=new kb.a("anchor",c.utilityLayerScene),d.coloredMaterial=new Pb.a("",c.utilityLayerScene),d.coloredMaterial.disableLighting=!0,d.hoverColoredMaterial=new Pb.a("",c.utilityLayerScene),d.hoverColoredMaterial.disableLighting=!0,d._lineBoundingBox=new kb.a("",c.utilityLayerScene),d._lineBoundingBox.rotationQuaternion=new j.q();var f=[];f.push(Kb.a.CreateLines("lines",{points:[new j.x(0,0,0),new j.x(d._boundingDimensions.x,0,0)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(0,0,0),new j.x(0,d._boundingDimensions.y,0)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(0,0,0),new j.x(0,0,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(d._boundingDimensions.x,0,0),new j.x(d._boundingDimensions.x,d._boundingDimensions.y,0)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(d._boundingDimensions.x,0,0),new j.x(d._boundingDimensions.x,0,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(0,d._boundingDimensions.y,0),new j.x(d._boundingDimensions.x,d._boundingDimensions.y,0)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(0,d._boundingDimensions.y,0),new j.x(0,d._boundingDimensions.y,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(0,0,d._boundingDimensions.z),new j.x(d._boundingDimensions.x,0,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(0,0,d._boundingDimensions.z),new j.x(0,d._boundingDimensions.y,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(d._boundingDimensions.x,d._boundingDimensions.y,d._boundingDimensions.z),new j.x(0,d._boundingDimensions.y,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(d._boundingDimensions.x,d._boundingDimensions.y,d._boundingDimensions.z),new j.x(d._boundingDimensions.x,0,d._boundingDimensions.z)]},c.utilityLayerScene)),f.push(Kb.a.CreateLines("lines",{points:[new j.x(d._boundingDimensions.x,d._boundingDimensions.y,d._boundingDimensions.z),new j.x(d._boundingDimensions.x,d._boundingDimensions.y,0)]},c.utilityLayerScene)),f.forEach(function(_){_.color=b,_.position.addInPlace(new j.x(-d._boundingDimensions.x/2,-d._boundingDimensions.y/2,-d._boundingDimensions.z/2)),_.isPickable=!1,d._lineBoundingBox.addChild(_)}),d._rootMesh.addChild(d._lineBoundingBox),d.setColor(b),d._rotateSpheresParent=new kb.a("",c.utilityLayerScene),d._rotateSpheresParent.rotationQuaternion=new j.q();for(var h=function(_){var da=lc.a.CreateSphere("",{diameter:1},c.utilityLayerScene);da.rotationQuaternion=new j.q(),da.material=i.coloredMaterial,(E=new pc.a({})).moveAttached=!1,E.updateDragPlane=!1,da.addBehavior(E);var fa=new j.x(1,0,0),ga=0;E.onDragStartObservable.add(function(){fa.copyFrom(da.forward),ga=0}),E.onDragObservable.add(function(ha){if(d.onRotationSphereDragObservable.notifyObservers({}),d.attachedMesh){var ka=d.attachedMesh.parent;if(ka&&ka.scaling&&ka.scaling.isNonUniformWithinEpsilon(.001))return void r.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Tb.a._RemoveAndStorePivotPoint(d.attachedMesh);var la=fa,ma=ha.dragPlaneNormal.scale(j.x.Dot(ha.dragPlaneNormal,la)),ta=la.subtract(ma).normalizeToNew(),pa=j.x.Dot(ta,ha.delta)<0?Math.abs(ha.delta.length()):-Math.abs(ha.delta.length());pa=pa/d._boundingDimensions.length()*d._anchorMesh.scaling.length(),d.attachedMesh.rotationQuaternion||(d.attachedMesh.rotationQuaternion=j.q.RotationYawPitchRoll(d.attachedMesh.rotation.y,d.attachedMesh.rotation.x,d.attachedMesh.rotation.z)),d._anchorMesh.rotationQuaternion||(d._anchorMesh.rotationQuaternion=j.q.RotationYawPitchRoll(d._anchorMesh.rotation.y,d._anchorMesh.rotation.x,d._anchorMesh.rotation.z)),ga+=pa,Math.abs(ga)<=2*Math.PI&&(_>=8?j.q.RotationYawPitchRollToRef(0,0,pa,d._tmpQuaternion):_>=4?j.q.RotationYawPitchRollToRef(pa,0,0,d._tmpQuaternion):j.q.RotationYawPitchRollToRef(0,pa,0,d._tmpQuaternion),d._anchorMesh.addChild(d.attachedMesh),d._anchorMesh.rotationQuaternion.multiplyToRef(d._tmpQuaternion,d._anchorMesh.rotationQuaternion),d._anchorMesh.removeChild(d.attachedMesh),d.attachedMesh.setParent(ka)),d.updateBoundingBox(),Tb.a._RestorePivotPoint(d.attachedMesh)}d._updateDummy()}),E.onDragStartObservable.add(function(){d.onDragStartObservable.notifyObservers({}),d._selectNode(da)}),E.onDragEndObservable.add(function(){d.onRotationSphereDragEndObservable.notifyObservers({}),d._selectNode(null),d._updateDummy()}),i._rotateSpheresParent.addChild(da)},i=this,k=0;k<12;k++)h(k);d._rootMesh.addChild(d._rotateSpheresParent),d._scaleBoxesParent=new kb.a("",c.utilityLayerScene),d._scaleBoxesParent.rotationQuaternion=new j.q();for(var m=0;m<2;m++)for(var B=0;B<2;B++)for(var E,K=function(){var _=cd.a.CreateBox("",{size:1},c.utilityLayerScene);_.material=P.coloredMaterial;var da=new j.x(0==m?-1:1,0==B?-1:1,0==S?-1:1);(E=new pc.a({dragAxis:da})).moveAttached=!1,_.addBehavior(E),E.onDragObservable.add(function(fa){if(d.onScaleBoxDragObservable.notifyObservers({}),d.attachedMesh){var ga=d.attachedMesh.parent;if(ga&&ga.scaling&&ga.scaling.isNonUniformWithinEpsilon(.001))return void r.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Tb.a._RemoveAndStorePivotPoint(d.attachedMesh);var ha=fa.dragDistance/d._boundingDimensions.length()*d._anchorMesh.scaling.length(),ka=new j.x(ha,ha,ha);ka.scaleInPlace(d._scaleDragSpeed),d.updateBoundingBox(),d.scalePivot?(d.attachedMesh.getWorldMatrix().getRotationMatrixToRef(d._tmpRotationMatrix),d._boundingDimensions.scaleToRef(.5,d._tmpVector),j.x.TransformCoordinatesToRef(d._tmpVector,d._tmpRotationMatrix,d._tmpVector),d._anchorMesh.position.subtractInPlace(d._tmpVector),d._boundingDimensions.multiplyToRef(d.scalePivot,d._tmpVector),j.x.TransformCoordinatesToRef(d._tmpVector,d._tmpRotationMatrix,d._tmpVector),d._anchorMesh.position.addInPlace(d._tmpVector)):(_.absolutePosition.subtractToRef(d._anchorMesh.position,d._tmpVector),d._anchorMesh.position.subtractInPlace(d._tmpVector)),d._anchorMesh.addChild(d.attachedMesh),d._anchorMesh.scaling.addInPlace(ka),(d._anchorMesh.scaling.x<0||d._anchorMesh.scaling.y<0||d._anchorMesh.scaling.z<0)&&d._anchorMesh.scaling.subtractInPlace(ka),d._anchorMesh.removeChild(d.attachedMesh),d.attachedMesh.setParent(ga),Tb.a._RestorePivotPoint(d.attachedMesh)}d._updateDummy()}),E.onDragStartObservable.add(function(){d.onDragStartObservable.notifyObservers({}),d._selectNode(_)}),E.onDragEndObservable.add(function(){d.onScaleBoxDragEndObservable.notifyObservers({}),d._selectNode(null),d._updateDummy()}),P._scaleBoxesParent.addChild(_)},P=this,S=0;S<2;S++)K();d._rootMesh.addChild(d._scaleBoxesParent);var U=new Array();return d._pointerObserver=c.utilityLayerScene.onPointerObservable.add(function(_){U[_.event.pointerId]?_.pickInfo&&_.pickInfo.pickedMesh!=U[_.event.pointerId]&&(U[_.event.pointerId].material=d.coloredMaterial,delete U[_.event.pointerId]):d._rotateSpheresParent.getChildMeshes().concat(d._scaleBoxesParent.getChildMeshes()).forEach(function(da){_.pickInfo&&_.pickInfo.pickedMesh==da&&(U[_.event.pointerId]=da,da.material=d.hoverColoredMaterial)})}),d._renderObserver=d.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){d.attachedMesh&&!d._existingMeshScale.equals(d.attachedMesh.scaling)?d.updateBoundingBox():d.fixedDragMeshScreenSize&&(d._updateRotationSpheres(),d._updateScaleBoxes()),d._dragMesh&&d.attachedMesh&&d.pointerDragBehavior.dragging&&(d._lineBoundingBox.position.rotateByQuaternionToRef(d._rootMesh.rotationQuaternion,d._tmpVector),d.attachedMesh.setAbsolutePosition(d._dragMesh.position.add(d._tmpVector.scale(-1))))}),d.updateBoundingBox(),d}return v.d(a,e),a.prototype.setColor=function(b){this.coloredMaterial.emissiveColor=b,this.hoverColoredMaterial.emissiveColor=b.clone().add(new j.e(.3,.3,.3)),this._lineBoundingBox.getChildren().forEach(function(c){c.color&&(c.color=b)})},a.prototype._attachedMeshChanged=function(b){var c=this;if(b){Tb.a._RemoveAndStorePivotPoint(b);var d=b.parent;this._anchorMesh.addChild(b),this._anchorMesh.removeChild(b),b.setParent(d),Tb.a._RestorePivotPoint(b),this.updateBoundingBox(),b.getChildMeshes(!1).forEach(function(f){f.markAsDirty("scaling")}),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(function(){c._updateDummy()})}},a.prototype._selectNode=function(b){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(c){c.isVisible=!b||c==b})},a.prototype.updateBoundingBox=function(){if(this.attachedMesh){Tb.a._RemoveAndStorePivotPoint(this.attachedMesh);var b=this.attachedMesh.parent;this.attachedMesh.setParent(null);var c=null;this.attachedMesh.skeleton&&(c=this.attachedMesh.skeleton.overrideMesh,this.attachedMesh.skeleton.overrideMesh=null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=j.q.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=j.q.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var d=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);d.max.subtractToRef(d.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((d.max.x+d.min.x)/2,(d.max.y+d.min.y)/2,(d.max.z+d.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(b),this.attachedMesh.skeleton&&(this.attachedMesh.skeleton.overrideMesh=c)}this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),Tb.a._RestorePivotPoint(this.attachedMesh))},a.prototype._updateRotationSpheres=function(){for(var b=this._rotateSpheresParent.getChildMeshes(),c=0;c<3;c++)for(var d=0;d<2;d++)for(var f=0;f<2;f++){var h=4*c+2*d+f;if(0==c&&(b[h].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*d,this._boundingDimensions.z*f),b[h].position.addInPlace(new j.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),b[h].lookAt(j.x.Cross(b[h].position.normalizeToNew(),j.x.Right()).normalizeToNew().add(b[h].position))),1==c&&(b[h].position.set(this._boundingDimensions.x*d,this._boundingDimensions.y/2,this._boundingDimensions.z*f),b[h].position.addInPlace(new j.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),b[h].lookAt(j.x.Cross(b[h].position.normalizeToNew(),j.x.Up()).normalizeToNew().add(b[h].position))),2==c&&(b[h].position.set(this._boundingDimensions.x*d,this._boundingDimensions.y*f,this._boundingDimensions.z/2),b[h].position.addInPlace(new j.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),b[h].lookAt(j.x.Cross(b[h].position.normalizeToNew(),j.x.Forward()).normalizeToNew().add(b[h].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){b[h].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var i=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;b[h].scaling.set(i,i,i)}else b[h].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},a.prototype._updateScaleBoxes=function(){for(var b=this._scaleBoxesParent.getChildMeshes(),c=0;c<2;c++)for(var d=0;d<2;d++)for(var f=0;f<2;f++){var h=4*c+2*d+f;if(b[h])if(b[h].position.set(this._boundingDimensions.x*c,this._boundingDimensions.y*d,this._boundingDimensions.z*f),b[h].position.addInPlace(new j.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){b[h].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var i=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;b[h].scaling.set(i,i,i)}else b[h].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize)}},a.prototype.setEnabledRotationAxis=function(b){this._rotateSpheresParent.getChildMeshes().forEach(function(c,d){d<4?c.setEnabled(-1!=b.indexOf("x")):d<8?c.setEnabled(-1!=b.indexOf("y")):c.setEnabled(-1!=b.indexOf("z"))})},a.prototype.setEnabledScaling=function(b){this._scaleBoxesParent.getChildMeshes().forEach(function(c,d){c.setEnabled(b)})},a.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},a.prototype.enableDragBehavior=function(){this._dragMesh=Ca.a.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new j.q(),this.pointerDragBehavior.useObjectOrienationForDragging=!1,this._dragMesh.addBehavior(this.pointerDragBehavior)},a.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),e.prototype.dispose.call(this)},a.MakeNotPickableAndWrapInBoundingBox=function(b){var c=function(k){k.isPickable=!1,k.getChildMeshes().forEach(function(m){c(m)})};c(b),b.rotationQuaternion||(b.rotationQuaternion=j.q.RotationYawPitchRoll(b.rotation.y,b.rotation.x,b.rotation.z));var d=b.position.clone(),f=b.rotationQuaternion.clone();b.rotationQuaternion.set(0,0,0,1),b.position.set(0,0,0);var h=cd.a.CreateBox("box",{size:1},b.getScene()),i=b.getHierarchyBoundingVectors();return i.max.subtractToRef(i.min,h.scaling),0===h.scaling.y&&(h.scaling.y=j.h),0===h.scaling.x&&(h.scaling.x=j.h),0===h.scaling.z&&(h.scaling.z=j.h),h.position.set((i.max.x+i.min.x)/2,(i.max.y+i.min.y)/2,(i.max.z+i.min.z)/2),b.addChild(h),b.rotationQuaternion.copyFrom(f),b.position.copyFrom(d),b.removeChild(h),h.addChild(b),h.visibility=0,h},a.prototype.setCustomMesh=function(b){r.a.Error("Custom meshes are not supported on this gizmo")},a}(uc.a),Ld=function(e){function a(b,c,d,f){void 0===c&&(c=j.e.Gray()),void 0===d&&(d=kc.a.DefaultUtilityLayer),void 0===f&&(f=32);var h=e.call(this,d)||this;h._pointerObserver=null,h.snapDistance=0,h.onSnapObservable=new q.c();var i=new Pb.a("",d.utilityLayerScene);i.diffuseColor=c,i.specularColor=c.subtract(new j.e(.1,.1,.1));var k=new Pb.a("",d.utilityLayerScene);k.diffuseColor=c.add(new j.e(.3,.3,.3));var m=new kb.a("",d.utilityLayerScene),B=Ca.a.CreateTorus("",.6,.03,f,d.utilityLayerScene);B.visibility=0;var E=Ca.a.CreateTorus("",.6,.005,f,d.utilityLayerScene);E.material=i,E.rotation.x=Math.PI/2,B.rotation.x=Math.PI/2,m.addChild(E),m.addChild(B),m.lookAt(h._rootMesh.position.add(b)),h._rootMesh.addChild(m),m.scaling.scaleInPlace(1/3),h.dragBehavior=new pc.a({dragPlaneNormal:b}),h.dragBehavior.moveAttached=!1,h.dragBehavior.maxDragAngle=9*Math.PI/20,h.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,h._rootMesh.addBehavior(h.dragBehavior);var K=new j.x();h.dragBehavior.onDragStartObservable.add(function(la){h.attachedMesh&&K.copyFrom(la.dragPlanePoint)});var P=new j.j(),S=new j.x(),U=new j.x(),_={snapDistance:0},da=0,fa=new j.j(),ga=new j.x(),ha=new j.q();h.dragBehavior.onDragObservable.add(function(la){if(h.attachedMesh){h.attachedMesh.rotationQuaternion||(h.attachedMesh.rotationQuaternion=j.q.RotationYawPitchRoll(h.attachedMesh.rotation.y,h.attachedMesh.rotation.x,h.attachedMesh.rotation.z));var ma=h.attachedMesh.parent;ma&&h.attachedMesh.setParent(null);var ta=la.dragPlanePoint.subtract(h.attachedMesh.absolutePosition).normalize(),pa=K.subtract(h.attachedMesh.absolutePosition).normalize(),ua=j.x.Cross(ta,pa),wa=j.x.Dot(ta,pa),ya=Math.atan2(ua.length(),wa);if(S.copyFrom(b),U.copyFrom(b),h.updateGizmoRotationToMatchAttachedMesh&&(h.attachedMesh.rotationQuaternion.toRotationMatrix(P),U=j.x.TransformCoordinates(S,P)),d.utilityLayerScene.activeCamera){var Da=d.utilityLayerScene.activeCamera.position.subtract(h.attachedMesh.position);j.x.Dot(Da,U)>0&&(S.scaleInPlace(-1),U.scaleInPlace(-1))}j.x.Dot(U,ua)>0&&(ya=-ya);var Ja=!1;if(0!=h.snapDistance)if(da+=ya,Math.abs(da)>h.snapDistance){var Na=Math.floor(Math.abs(da)/h.snapDistance);da<0&&(Na*=-1),da%=h.snapDistance,ya=h.snapDistance*Na,Ja=!0}else ya=0;fa.reset(),h.attachedMesh.parent&&(h.attachedMesh.parent.computeWorldMatrix().invertToRef(fa),fa.getRotationMatrixToRef(fa),j.x.TransformCoordinatesToRef(S,fa,S));var Ma=Math.sin(ya/2);ha.set(S.x*Ma,S.y*Ma,S.z*Ma,Math.cos(ya/2)),fa.determinant()>0&&(ha.toEulerAnglesToRef(ga),j.q.RotationYawPitchRollToRef(ga.y,-ga.x,-ga.z,ha)),h.updateGizmoRotationToMatchAttachedMesh?h.attachedMesh.rotationQuaternion.multiplyToRef(ha,h.attachedMesh.rotationQuaternion):ha.multiplyToRef(h.attachedMesh.rotationQuaternion,h.attachedMesh.rotationQuaternion),K.copyFrom(la.dragPlanePoint),Ja&&(_.snapDistance=ya,h.onSnapObservable.notifyObservers(_)),ma&&h.attachedMesh.setParent(ma)}}),h._pointerObserver=d.utilityLayerScene.onPointerObservable.add(function(la){if(!h._customMeshSet){var ma=la.pickInfo&&-1!=h._rootMesh.getChildMeshes().indexOf(la.pickInfo.pickedMesh)?k:i;h._rootMesh.getChildMeshes().forEach(function(ta){ta.material=ma,ta.color&&(ta.color=ma.diffuseColor)})}});var ka=d._getSharedGizmoLight();return ka.includedOnlyMeshes=ka.includedOnlyMeshes.concat(h._rootMesh.getChildMeshes(!1)),h}return v.d(a,e),a.prototype._attachedMeshChanged=function(b){this.dragBehavior&&(this.dragBehavior.enabled=!!b)},a.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},a}(uc.a),Wg=function(e){function a(b,c){void 0===b&&(b=kc.a.DefaultUtilityLayer),void 0===c&&(c=32);var d=e.call(this,b)||this;return d.onDragStartObservable=new q.c(),d.onDragEndObservable=new q.c(),d.xGizmo=new Ld(new j.x(1,0,0),j.e.Red().scale(.5),b,c),d.yGizmo=new Ld(new j.x(0,1,0),j.e.Green().scale(.5),b,c),d.zGizmo=new Ld(new j.x(0,0,1),j.e.Blue().scale(.5),b,c),[d.xGizmo,d.yGizmo,d.zGizmo].forEach(function(f){f.dragBehavior.onDragStartObservable.add(function(){d.onDragStartObservable.notifyObservers({})}),f.dragBehavior.onDragEndObservable.add(function(){d.onDragEndObservable.notifyObservers({})})}),d.attachedMesh=null,d}return v.d(a,e),Object.defineProperty(a.prototype,"attachedMesh",{get:function(){return this.xGizmo.attachedMesh},set:function(b){this.xGizmo&&(this.xGizmo.attachedMesh=b,this.yGizmo.attachedMesh=b,this.zGizmo.attachedMesh=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(b){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=b,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=b,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(b){this.xGizmo&&(this.xGizmo.snapDistance=b,this.yGizmo.snapDistance=b,this.zGizmo.snapDistance=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(b){this.xGizmo&&(this.xGizmo.scaleRatio=b,this.yGizmo.scaleRatio=b,this.zGizmo.scaleRatio=b)},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},a.prototype.setCustomMesh=function(b){r.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},a}(uc.a),Xg=function(e){function a(b){void 0===b&&(b=kc.a.DefaultUtilityLayer);var c=e.call(this,b)||this;return c.onDragStartObservable=new q.c(),c.onDragEndObservable=new q.c(),c.xGizmo=new Kd.a(new j.x(1,0,0),j.e.Red().scale(.5),b),c.yGizmo=new Kd.a(new j.x(0,1,0),j.e.Green().scale(.5),b),c.zGizmo=new Kd.a(new j.x(0,0,1),j.e.Blue().scale(.5),b),[c.xGizmo,c.yGizmo,c.zGizmo].forEach(function(d){d.dragBehavior.onDragStartObservable.add(function(){c.onDragStartObservable.notifyObservers({})}),d.dragBehavior.onDragEndObservable.add(function(){c.onDragEndObservable.notifyObservers({})})}),c.attachedMesh=null,c}return v.d(a,e),Object.defineProperty(a.prototype,"attachedMesh",{get:function(){return this.xGizmo.attachedMesh},set:function(b){this.xGizmo&&(this.xGizmo.attachedMesh=b,this.yGizmo.attachedMesh=b,this.zGizmo.attachedMesh=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(b){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=b,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=b,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(b){this.xGizmo&&(this.xGizmo.snapDistance=b,this.yGizmo.snapDistance=b,this.zGizmo.snapDistance=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(b){this.xGizmo&&(this.xGizmo.scaleRatio=b,this.yGizmo.scaleRatio=b,this.zGizmo.scaleRatio=b)},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},a.prototype.setCustomMesh=function(b){r.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},a}(uc.a);Wa.a.CreatePolyhedron=function(e){var a=[];a[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},a[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},a[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},a[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},a[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},a[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},a[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},a[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},a[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},a[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},a[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},a[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},a[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},a[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},a[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var b,c,d,f,h,i,k=e.type&&(e.type<0||e.type>=a.length)?0:e.type||0,m=e.size,B=e.sizeX||m||1,E=e.sizeY||m||1,K=e.sizeZ||m||1,P=e.custom||a[k],S=P.face.length,U=e.faceUV||new Array(S),_=e.faceColors,da=void 0===e.flat||e.flat,fa=0===e.sideOrientation?0:e.sideOrientation||Wa.a.DEFAULTSIDE,ga=new Array(),ha=new Array(),ka=new Array(),la=new Array(),ma=new Array(),ta=0,pa=0,ua=new Array(),wa=0,ya=0;if(da)for(ya=0;ya<S;ya++)_&&void 0===_[ya]&&(_[ya]=new j.f(1,1,1,1)),U&&void 0===U[ya]&&(U[ya]=new j.y(0,0,1,1));if(da)for(ya=0;ya<S;ya++){var Da=P.face[ya].length;for(d=2*Math.PI/Da,f=.5*Math.tan(d/2),h=.5,wa=0;wa<Da;wa++)ga.push(P.vertex[P.face[ya][wa]][0]*B,P.vertex[P.face[ya][wa]][1]*E,P.vertex[P.face[ya][wa]][2]*K),ua.push(ta),ta++,b=U[ya].x+(U[ya].z-U[ya].x)*(.5+f),c=U[ya].y+(U[ya].w-U[ya].y)*(h-.5),la.push(b,c),i=f*Math.cos(d)-h*Math.sin(d),h=f*Math.sin(d)+h*Math.cos(d),f=i,_&&ma.push(_[ya].r,_[ya].g,_[ya].b,_[ya].a);for(wa=0;wa<Da-2;wa++)ha.push(ua[0+pa],ua[wa+2+pa],ua[wa+1+pa]);pa+=Da}else{for(wa=0;wa<P.vertex.length;wa++)ga.push(P.vertex[wa][0]*B,P.vertex[wa][1]*E,P.vertex[wa][2]*K),la.push(0,0);for(ya=0;ya<S;ya++)for(wa=0;wa<P.face[ya].length-2;wa++)ha.push(P.face[ya][0],P.face[ya][wa+2],P.face[ya][wa+1])}Wa.a.ComputeNormals(ga,ha,ka),Wa.a._ComputeSides(fa,ga,ha,ka,la,e.frontUVs,e.backUVs);var Ja=new Wa.a();return Ja.positions=ga,Ja.indices=ha,Ja.normals=ka,Ja.uvs=la,_&&da&&(Ja.colors=ma),Ja},Ca.a.CreatePolyhedron=function(e,a,b){return ed.CreatePolyhedron(e,a,b)};var ed=function(){function e(){}return e.CreatePolyhedron=function(a,b,c){void 0===c&&(c=null);var d=new Ca.a(a,c);return b.sideOrientation=Ca.a._GetDefaultSideOrientation(b.sideOrientation),d._originalBuilderSideOrientation=b.sideOrientation,Wa.a.CreatePolyhedron(b).applyToMesh(d,b.updatable),d},e}(),Yg=function(e){function a(b){void 0===b&&(b=kc.a.DefaultUtilityLayer);var c=e.call(this,b)||this;c.onDragStartObservable=new q.c(),c.onDragEndObservable=new q.c(),c.xGizmo=new dd(new j.x(1,0,0),j.e.Red().scale(.5),b),c.yGizmo=new dd(new j.x(0,1,0),j.e.Green().scale(.5),b),c.zGizmo=new dd(new j.x(0,0,1),j.e.Blue().scale(.5),b),c.uniformScaleGizmo=new dd(new j.x(0,1,0),j.e.Yellow().scale(.5),b),c.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh=!1,c.uniformScaleGizmo.uniformScaling=!0;var d=ed.CreatePolyhedron("",{type:1},c.uniformScaleGizmo.gizmoLayer.utilityLayerScene);d.scaling.scaleInPlace(.02),d.visibility=0;var f=ed.CreatePolyhedron("",{type:1},c.uniformScaleGizmo.gizmoLayer.utilityLayerScene);f.scaling.scaleInPlace(.007),d.addChild(f),c.uniformScaleGizmo.setCustomMesh(d,!0);var h=b._getSharedGizmoLight();return h.includedOnlyMeshes=h.includedOnlyMeshes.concat(f),[c.xGizmo,c.yGizmo,c.zGizmo,c.uniformScaleGizmo].forEach(function(i){i.dragBehavior.onDragStartObservable.add(function(){c.onDragStartObservable.notifyObservers({})}),i.dragBehavior.onDragEndObservable.add(function(){c.onDragEndObservable.notifyObservers({})})}),c.attachedMesh=null,c}return v.d(a,e),Object.defineProperty(a.prototype,"attachedMesh",{get:function(){return this.xGizmo.attachedMesh},set:function(b){this.xGizmo&&(this.xGizmo.attachedMesh=b,this.yGizmo.attachedMesh=b,this.zGizmo.attachedMesh=b,this.uniformScaleGizmo.attachedMesh=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(b){b||r.a.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported."),this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=b,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=b,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(b){this.xGizmo&&(this.xGizmo.snapDistance=b,this.yGizmo.snapDistance=b,this.zGizmo.snapDistance=b,this.uniformScaleGizmo.snapDistance=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(b){this.xGizmo&&(this.xGizmo.scaleRatio=b,this.yGizmo.scaleRatio=b,this.zGizmo.scaleRatio=b,this.uniformScaleGizmo.scaleRatio=b)},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.uniformScaleGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},a}(uc.a),aj=function(){function e(a){var b=this;this.scene=a,this.clearGizmoOnEmptyPointerEvent=!1,this.onAttachedToMeshObservable=new q.c(),this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObserver=null,this._attachedMesh=null,this._boundingBoxColor=j.e.FromHexString("#0984e3"),this.boundingBoxDragBehavior=new cg(),this.attachableMeshes=null,this.usePointerToAttachGizmos=!0,this._defaultKeepDepthUtilityLayer=new kc.a(a),this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._defaultUtilityLayer=kc.a.DefaultUtilityLayer,this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null},this._pointerObserver=a.onPointerObservable.add(function(c){if(b.usePointerToAttachGizmos&&c.type==hb.a.POINTERDOWN)if(c.pickInfo&&c.pickInfo.pickedMesh){var d=c.pickInfo.pickedMesh;if(null==b.attachableMeshes)for(;d&&null!=d.parent;)d=d.parent;else{var f=!1;b.attachableMeshes.forEach(function(h){d&&(d==h||d.isDescendantOf(h))&&(d=h,f=!0)}),f||(d=null)}d instanceof kb.a?b._attachedMesh!=d&&b.attachToMesh(d):b.clearGizmoOnEmptyPointerEvent&&b.attachToMesh(null)}else b.clearGizmoOnEmptyPointerEvent&&b.attachToMesh(null)})}return e.prototype.attachToMesh=function(a){for(var b in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=a,this.gizmos){var c=this.gizmos[b];c&&this._gizmosEnabled[b]&&(c.attachedMesh=a)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(a)},Object.defineProperty(e.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(a){a?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new Xg(this._defaultUtilityLayer)),this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedMesh=null),this._gizmosEnabled.positionGizmo=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(a){a?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new Wg(this._defaultUtilityLayer)),this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedMesh=null),this._gizmosEnabled.rotationGizmo=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(a){a?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new Yg(this._defaultUtilityLayer),this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedMesh=null),this._gizmosEnabled.scaleGizmo=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(a){a?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new Vg(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh,this._attachedMesh&&(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedMesh=null),this._gizmosEnabled.boundingBoxGizmo=a},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var a in this.scene.onPointerObservable.remove(this._pointerObserver),this.gizmos){var b=this.gizmos[a];b&&b.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},e}(),vc=l(38),Md=function(e){function a(){var b=null!==e&&e.apply(this,arguments)||this;return b._needProjectionMatrixCompute=!0,b}return v.d(a,e),a.prototype._setPosition=function(b){this._position=b},Object.defineProperty(a.prototype,"position",{get:function(){return this._position},set:function(b){this._setPosition(b)},enumerable:!0,configurable:!0}),a.prototype._setDirection=function(b){this._direction=b},Object.defineProperty(a.prototype,"direction",{get:function(){return this._direction},set:function(b){this._setDirection(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(b){this._shadowMinZ=b,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(b){this._shadowMaxZ=b,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),a.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=j.x.Zero()),j.x.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=j.x.Zero()),j.x.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},a.prototype.getDepthScale=function(){return 50},a.prototype.getShadowDirection=function(b){return this.transformedDirection?this.transformedDirection:this.direction},a.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},a.prototype.setDirectionToTarget=function(b){return this.direction=j.x.Normalize(b.subtract(this.position)),this.direction},a.prototype.getRotation=function(){this.direction.normalize();var b=j.x.Cross(this.direction,j.c.Y),c=j.x.Cross(b,this.direction);return j.x.RotationFromAxis(b,c,this.direction)},a.prototype.needCube=function(){return!1},a.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},a.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},a.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=j.x.Zero()},a.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},a.prototype.computeWorldMatrix=function(b){return!b&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=j.j.Identity()),j.j.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},a.prototype.getDepthMinZ=function(b){return void 0!==this.shadowMinZ?this.shadowMinZ:b.minZ},a.prototype.getDepthMaxZ=function(b){return void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ},a.prototype.setShadowProjectionMatrix=function(b,c,d){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(c,d,b):this._setDefaultShadowProjectionMatrix(b,c,d),this},v.c([Object(g.o)()],a.prototype,"position",null),v.c([Object(g.o)()],a.prototype,"direction",null),v.c([Object(g.c)()],a.prototype,"shadowMinZ",null),v.c([Object(g.c)()],a.prototype,"shadowMaxZ",null),a}(vc.a);s.a.AddNodeConstructor("Light_Type_1",function(e,a){return function(){return new Re(e,j.x.Zero(),a)}});var Re=function(e){function a(b,c,d){var f=e.call(this,b,d)||this;return f._shadowFrustumSize=0,f._shadowOrthoScale=.1,f.autoUpdateExtends=!0,f._orthoLeft=Number.MAX_VALUE,f._orthoRight=Number.MIN_VALUE,f._orthoTop=Number.MIN_VALUE,f._orthoBottom=Number.MAX_VALUE,f.position=c.scale(-1),f.direction=c,f}return v.d(a,e),Object.defineProperty(a.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(b){this._shadowFrustumSize=b,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(b){this._shadowOrthoScale=b,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"DirectionalLight"},a.prototype.getTypeID=function(){return vc.a.LIGHTTYPEID_DIRECTIONALLIGHT},a.prototype._setDefaultShadowProjectionMatrix=function(b,c,d){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(b):this._setDefaultAutoExtendShadowProjectionMatrix(b,c,d)},a.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(b){var c=this.getScene().activeCamera;c&&j.j.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:c.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,b)},a.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(b,c,d){var f=this.getScene().activeCamera;if(f){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var h=j.x.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var i=0;i<d.length;i++){var k=d[i];if(k)for(var m=k.getBoundingInfo().boundingBox,B=0;B<m.vectorsWorld.length;B++)j.x.TransformCoordinatesToRef(m.vectorsWorld[B],c,h),h.x<this._orthoLeft&&(this._orthoLeft=h.x),h.y<this._orthoBottom&&(this._orthoBottom=h.y),h.x>this._orthoRight&&(this._orthoRight=h.x),h.y>this._orthoTop&&(this._orthoTop=h.y)}}var E=this._orthoRight-this._orthoLeft,K=this._orthoTop-this._orthoBottom;j.j.OrthoOffCenterLHToRef(this._orthoLeft-E*this.shadowOrthoScale,this._orthoRight+E*this.shadowOrthoScale,this._orthoBottom-K*this.shadowOrthoScale,this._orthoTop+K*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:f.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,b)}},a.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},a.prototype.transferToEffect=function(b,c){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,c),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,c),this)},a.prototype.getDepthMinZ=function(b){return 1},a.prototype.getDepthMaxZ=function(b){return 1},a.prototype.prepareLightSpecificDefines=function(b,c){b["DIRLIGHT"+c]=!0},v.c([Object(g.c)()],a.prototype,"shadowFrustumSize",null),v.c([Object(g.c)()],a.prototype,"shadowOrthoScale",null),v.c([Object(g.c)()],a.prototype,"autoUpdateExtends",void 0),a}(Md);Ca.a.CreateHemisphere=function(e,a,b,c){var d={segments:a,diameter:b};return Nd.CreateHemisphere(e,d,c)};var Nd=function(){function e(){}return e.CreateHemisphere=function(a,b,c){b.diameter||(b.diameter=1),b.segments||(b.segments=16);var d=lc.a.CreateSphere("",{slice:.5,diameter:b.diameter,segments:b.segments},c),f=Ca.a.CreateDisc("",b.diameter/2,3*b.segments+(4-b.segments),c);f.rotation.x=-Math.PI/2,f.parent=d;var h=Ca.a.MergeMeshes([f,d],!0);return h.name=a,h},e}();s.a.AddNodeConstructor("Light_Type_2",function(e,a){return function(){return new Se(e,j.x.Zero(),j.x.Zero(),0,0,a)}});var Se=function(e){function a(b,c,d,f,h,i){var k=e.call(this,b,i)||this;return k._innerAngle=0,k._projectionTextureMatrix=j.j.Zero(),k._projectionTextureLightNear=1e-06,k._projectionTextureLightFar=1000,k._projectionTextureUpDirection=j.x.Up(),k._projectionTextureViewLightDirty=!0,k._projectionTextureProjectionLightDirty=!0,k._projectionTextureDirty=!0,k._projectionTextureViewTargetVector=j.x.Zero(),k._projectionTextureViewLightMatrix=j.j.Zero(),k._projectionTextureProjectionLightMatrix=j.j.Zero(),k._projectionTextureScalingMatrix=j.j.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),k.position=c,k.direction=d,k.angle=f,k.exponent=h,k}return v.d(a,e),Object.defineProperty(a.prototype,"angle",{get:function(){return this._angle},set:function(b){this._angle=b,this._cosHalfAngle=Math.cos(.5*b),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(b){this._innerAngle=b,this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(b){this._shadowAngleScale=b,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(b){this._projectionTextureLightNear=b,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(b){this._projectionTextureLightFar=b,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(b){this._projectionTextureUpDirection=b,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(b){var c=this;if(this._projectionTexture!==b&&(this._projectionTexture=b,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady())){var d=this._projectionTexture;d.onLoadObservable&&d.onLoadObservable.addOnce(function(){c._markMeshesAsLightDirty()})}},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"SpotLight"},a.prototype.getTypeID=function(){return vc.a.LIGHTTYPEID_SPOTLIGHT},a.prototype._setDirection=function(b){e.prototype._setDirection.call(this,b),this._projectionTextureViewLightDirty=!0},a.prototype._setPosition=function(b){e.prototype._setPosition.call(this,b),this._projectionTextureViewLightDirty=!0},a.prototype._setDefaultShadowProjectionMatrix=function(b,c,d){var f=this.getScene().activeCamera;if(f){this._shadowAngleScale=this._shadowAngleScale||1;var h=this._shadowAngleScale*this._angle;j.j.PerspectiveFovLHToRef(h,1,this.getDepthMinZ(f),this.getDepthMaxZ(f),b)}},a.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),j.j.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},a.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var b=this.projectionTextureLightFar,c=this.projectionTextureLightNear,d=b/(b-c),f=-d*c,h=1/Math.tan(this._angle/2);j.j.FromValuesToRef(h/1,0,0,0,0,h,0,0,0,0,d,1,0,0,f,0,this._projectionTextureProjectionLightMatrix)},a.prototype._computeProjectionTextureMatrix=function(){this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},a.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},a.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},a.prototype.transferToEffect=function(b,c){var d;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,c),d=j.x.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,c),d=j.x.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",d.x,d.y,d.z,this._cosHalfAngle,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,c),this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),b.setMatrix("textureProjectionMatrix"+c,this._projectionTextureMatrix),b.setTexture("projectionLightSampler"+c,this.projectionTexture)),this},a.prototype.dispose=function(){e.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},a.prototype.prepareLightSpecificDefines=function(b,c){b["SPOTLIGHT"+c]=!0,b["PROJECTEDLIGHTTEXTURE"+c]=!(!this.projectionTexture||!this.projectionTexture.isReady())},v.c([Object(g.c)()],a.prototype,"angle",null),v.c([Object(g.c)()],a.prototype,"innerAngle",null),v.c([Object(g.c)()],a.prototype,"shadowAngleScale",null),v.c([Object(g.c)()],a.prototype,"exponent",void 0),v.c([Object(g.c)()],a.prototype,"projectionTextureLightNear",null),v.c([Object(g.c)()],a.prototype,"projectionTextureLightFar",null),v.c([Object(g.c)()],a.prototype,"projectionTextureUpDirection",null),v.c([Object(g.m)("projectedLightTexture")],a.prototype,"_projectionTexture",void 0),a}(Md),bj=function(e){function a(b){var c=e.call(this,b)||this;return c.cachedPosition=new j.x(),c.cachedForward=new j.x(0,0,1),c._light=null,c.attachedMesh=new kb.a("",c.gizmoLayer.utilityLayerScene),c._material=new Pb.a("light",c.gizmoLayer.originalScene),c._material.diffuseColor=new j.e(.5,.5,.5),c._material.specularColor=new j.e(.1,.1,.1),c}return v.d(a,e),Object.defineProperty(a.prototype,"light",{get:function(){return this._light},set:function(b){var c=this;if(this._light=b,b){this._lightMesh&&this._lightMesh.dispose(),b instanceof Ed.a?this._lightMesh=a._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):this._lightMesh=b instanceof Re?a._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):b instanceof Se?a._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):a._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene),this._lightMesh.getChildMeshes(!1).forEach(function(f){f.material=c._material}),this._lightMesh.parent=this._rootMesh;var d=this.gizmoLayer._getSharedGizmoLight();d.includedOnlyMeshes=d.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1)),this._lightMesh.rotationQuaternion=new j.q(),b.position&&this.attachedMesh.position.copyFrom(b.position),b.direction&&this.attachedMesh.setDirection(b.direction),this._update()}},enumerable:!0,configurable:!0}),a.prototype._update=function(){e.prototype._update.call(this),this._light&&(this._light.position&&(this.attachedMesh.position.equals(this.cachedPosition)?this.attachedMesh.position.copyFrom(this._light.position):(this._light.position.copyFrom(this.attachedMesh.position),this.cachedPosition.copyFrom(this.attachedMesh.position))),this._light.direction&&(j.x.DistanceSquared(this.attachedMesh.forward,this.cachedForward)>.0001?(this._light.direction.copyFrom(this.attachedMesh.forward),this.cachedForward.copyFrom(this.attachedMesh.forward)):j.x.DistanceSquared(this.attachedMesh.forward,this._light.direction)>.0001&&(this.attachedMesh.setDirection(this._light.direction),this.cachedForward.copyFrom(this._lightMesh.forward))),this._light.isEnabled()?this._material.diffuseColor.set(this._light.diffuse.r/3,this._light.diffuse.g/3,this._light.diffuse.b/3):this._material.diffuseColor.set(0,0,0))},a.prototype.dispose=function(){this._material.dispose(),e.prototype.dispose.call(this)},a._CreateHemisphericLightMesh=function(b){var c=new Ca.a("hemisphereLight",b),d=Nd.CreateHemisphere(c.name,{segments:10,diameter:1},b);d.position.z=-.15,d.rotation.x=Math.PI/2,d.parent=c;var f=this._createLightLines(3,b);return f.parent=c,f.position.z,c.scaling.scaleInPlace(a._Scale),c.rotation.x=Math.PI/2,c},a._CreatePointLightMesh=function(b){var c=new Ca.a("pointLight",b),d=lc.a.CreateSphere(c.name,{segments:10,diameter:1},b);return d.rotation.x=Math.PI/2,d.parent=c,this._createLightLines(5,b).parent=c,c.scaling.scaleInPlace(a._Scale),c.rotation.x=Math.PI/2,c},a._CreateSpotLightMesh=function(b){var c=new Ca.a("spotLight",b);lc.a.CreateSphere(c.name,{segments:10,diameter:1},b).parent=c;var d=Nd.CreateHemisphere(c.name,{segments:10,diameter:2},b);return d.parent=c,d.rotation.x=-Math.PI/2,this._createLightLines(2,b).parent=c,c.scaling.scaleInPlace(a._Scale),c.rotation.x=Math.PI/2,c},a._CreateDirectionalLightMesh=function(b){var c=new Ca.a("directionalLight",b),d=new Ca.a(c.name,b);d.parent=c,lc.a.CreateSphere(c.name,{diameter:1.2,segments:10},b).parent=d;var f=Ca.a.CreateCylinder(c.name,6,.3,.3,6,1,b);f.parent=d,(h=f.clone(c.name)).scaling.y=.5,h.position.x+=1.25,(i=f.clone(c.name)).scaling.y=.5,i.position.x+=-1.25;var h,i,k=Ca.a.CreateCylinder(c.name,1,0,.6,6,1,b);return k.position.y+=3,k.parent=d,(h=k.clone(c.name)).position.y=1.5,h.position.x+=1.25,(i=k.clone(c.name)).position.y=1.5,i.position.x+=-1.25,d.scaling.scaleInPlace(a._Scale),d.rotation.z=Math.PI/2,d.rotation.y=Math.PI/2,c},a._Scale=.007,a._createLightLines=function(b,c){var d=new Ca.a("root",c);d.rotation.x=Math.PI/2;var f=new Ca.a("linePivot",c);f.parent=d;var h=Ca.a.CreateCylinder("line",2,.2,.3,6,1,c);if(h.position.y=h.scaling.y/2+1.2,h.parent=f,b<2)return f;for(var i=0;i<4;i++)(k=f.clone("lineParentClone")).rotation.z=Math.PI/4,k.rotation.y=Math.PI/2+Math.PI/2*i,k.getChildMeshes()[0].scaling.y=.5,k.getChildMeshes()[0].scaling.x=k.getChildMeshes()[0].scaling.z=.8,k.getChildMeshes()[0].position.y=k.getChildMeshes()[0].scaling.y/2+1.2;if(b<3)return d;for(i=0;i<4;i++)(k=f.clone("linePivotClone")).rotation.z=Math.PI/2,k.rotation.y=Math.PI/2*i;if(b<4)return d;for(i=0;i<4;i++){var k;(k=f.clone("linePivotClone")).rotation.z=Math.PI+Math.PI/4,k.rotation.y=Math.PI/2+Math.PI/2*i,k.getChildMeshes()[0].scaling.y=.5,k.getChildMeshes()[0].scaling.x=k.getChildMeshes()[0].scaling.z=.8,k.getChildMeshes()[0].position.y=k.getChildMeshes()[0].scaling.y/2+1.2}return b<5?d:((k=f.clone("linePivotClone")).rotation.z=Math.PI,d)},a}(uc.a),ac=l(44);Ia.a.IncludesShadersStore.kernelBlurVaryingDeclaration="varying vec2 sampleCoord{X};";var cj=`#ifdef DOF
factor=sampleCoC(sampleCoord{X});
computedWeight=KERNEL_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;
#endif`;Ia.a.IncludesShadersStore.kernelBlurFragment=cj;var dj=`#ifdef DOF
factor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});
computedWeight=KERNEL_DEP_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_DEP_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;
#endif`;Ia.a.IncludesShadersStore.kernelBlurFragment2=dj;var ej=`
uniform sampler2D textureSampler;
uniform vec2 delta;

varying vec2 sampleCenter;
#ifdef DOF
uniform sampler2D circleOfConfusionSampler;
uniform vec2 cameraMinMaxZ;
float sampleDistance(const in vec2 offset) {
float depth=texture2D(circleOfConfusionSampler,offset).g;
return cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth;
}
float sampleCoC(const in vec2 offset) {
float coc=texture2D(circleOfConfusionSampler,offset).r;
return coc;
}
#endif
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
#ifdef PACKEDFLOAT
vec4 pack(float depth)
{
const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);
const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);
vec4 res=fract(depth*bit_shift);
res-=res.xxyz*bit_mask;
return res;
}
float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}
#endif
void main(void)
{
float computedWeight=0.0;
#ifdef PACKEDFLOAT
float blend=0.;
#else
vec4 blend=vec4(0.);
#endif
#ifdef DOF
float sumOfWeights=CENTER_WEIGHT;
float factor=0.0;

#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;
#else
blend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;
#endif
#endif
#include<kernelBlurFragment>[0..varyingCount]
#include<kernelBlurFragment2>[0..depCount]
#ifdef PACKEDFLOAT
gl_FragColor=pack(blend);
#else
gl_FragColor=blend;
#endif
#ifdef DOF
gl_FragColor/=sumOfWeights;
#endif
}`;Ia.a.ShadersStore.kernelBlurPixelShader=ej,Ia.a.IncludesShadersStore.kernelBlurVertex="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};";var fj=`
attribute vec2 position;

uniform vec2 delta;

varying vec2 sampleCenter;
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
const vec2 madd=vec2(0.5,0.5);
void main(void) {
sampleCenter=(position*madd+madd);
#include<kernelBlurVertex>[0..varyingCount]
gl_Position=vec4(position,0.0,1.0);
}`;Ia.a.ShadersStore.kernelBlurVertexShader=fj;var Ib=function(e){function a(b,c,d,f,h,i,k,m,B,E,K){void 0===i&&(i=ra.a.BILINEAR_SAMPLINGMODE),void 0===B&&(B=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===E&&(E=""),void 0===K&&(K=!1);var P=e.call(this,b,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],f,h,i,k,m,null,B,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return P.direction=c,P.blockCompilation=K,P._packedFloat=!1,P._staticDefines="",P._staticDefines=E,P.onApplyObservable.add(function(S){P._outputTexture?S.setFloat2("delta",1/P._outputTexture.width*P.direction.x,1/P._outputTexture.height*P.direction.y):S.setFloat2("delta",1/P.width*P.direction.x,1/P.height*P.direction.y)}),P.kernel=d,P}return v.d(a,e),Object.defineProperty(a.prototype,"kernel",{get:function(){return this._idealKernel},set:function(b){this._idealKernel!==b&&(b=Math.max(b,1),this._idealKernel=b,this._kernel=this._nearestBestKernel(b),this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(b){this._packedFloat!==b&&(this._packedFloat=b,this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),a.prototype.updateEffect=function(b,c,d,f,h,i){void 0===b&&(b=null),void 0===c&&(c=null),void 0===d&&(d=null),this._updateParameters(h,i)},a.prototype._updateParameters=function(b,c){for(var d=this._kernel,f=(d-1)/2,h=[],i=[],k=0,m=0;m<d;m++){var B=m/(d-1),E=this._gaussianWeight(2*B-1);h[m]=m-f,i[m]=E,k+=E}for(m=0;m<i.length;m++)i[m]/=k;var K=[],P=[],S=[];for(m=0;m<=f;m+=2){var U=Math.min(m+1,Math.floor(f));if(m===U)S.push({o:h[m],w:i[m]});else{var _=U===f,da=i[m]+i[U]*(_?.5:1),fa=h[m]+1/(1+i[m]/i[U]);0===fa?(S.push({o:h[m],w:i[m]}),S.push({o:h[m+1],w:i[m+1]})):(S.push({o:fa,w:da}),S.push({o:-fa,w:da}))}}for(m=0;m<S.length;m++)P[m]=S[m].o,K[m]=S[m].w;h=P,i=K;var ga=this.getEngine().getCaps().maxVaryingVectors,ha=Math.max(ga,0)-1,ka=Math.min(h.length,ha),la="";for(la+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(la+="#define CENTER_WEIGHT "+this._glslFloat(i[ka-1])+`\r
`,ka--),m=0;m<ka;m++)la+="#define KERNEL_OFFSET"+m+" "+this._glslFloat(h[m])+`\r
`,la+="#define KERNEL_WEIGHT"+m+" "+this._glslFloat(i[m])+`\r
`;var ma=0;for(m=ha;m<h.length;m++)la+="#define KERNEL_DEP_OFFSET"+ma+" "+this._glslFloat(h[m])+`\r
`,la+="#define KERNEL_DEP_WEIGHT"+ma+" "+this._glslFloat(i[m])+`\r
`,ma++;this.packedFloat&&(la+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,e.prototype.updateEffect.call(this,la,null,null,{varyingCount:ka,depCount:ma},b,c)},a.prototype._nearestBestKernel=function(b){for(var c=Math.round(b),d=0,f=[c,c-1,c+1,c-2,c+2];d<f.length;d++){var h=f[d];if(h%2!=0&&Math.floor(h/2)%2==0&&h>0)return Math.max(h,3)}return Math.max(c,3)},a.prototype._gaussianWeight=function(b){var c=-b*b/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(c)},a.prototype._glslFloat=function(b,c){return void 0===c&&(c=8),b.toFixed(c).replace(/0+$/,"")},a}(Za),Te=function(e){function a(b,c,d,f,h,i,k){void 0===h&&(h=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===i&&(i=ra.a.BILINEAR_SAMPLINGMODE),void 0===k&&(k=!0);var m=e.call(this,b,c,d,f,!0,h,!1,i,k)||this;return m.scene=d,m.mirrorPlane=new j.n(0,1,0,1),m._transformMatrix=j.j.Zero(),m._mirrorMatrix=j.j.Zero(),m._adaptiveBlurKernel=0,m._blurKernelX=0,m._blurKernelY=0,m._blurRatio=1,m.ignoreCameraViewport=!0,m._updateGammaSpace(),m._imageProcessingConfigChangeObserver=d.imageProcessingConfiguration.onUpdateParameters.add(function(){m._updateGammaSpace}),m.onBeforeRenderObservable.add(function(){j.j.ReflectionToRef(m.mirrorPlane,m._mirrorMatrix),m._savedViewMatrix=d.getViewMatrix(),m._mirrorMatrix.multiplyToRef(m._savedViewMatrix,m._transformMatrix),d.setTransformMatrix(m._transformMatrix,d.getProjectionMatrix()),d.clipPlane=m.mirrorPlane,d.getEngine().cullBackFaces=!1,d._mirroredCameraPosition=j.x.TransformCoordinates(d.activeCamera.globalPosition,m._mirrorMatrix)}),m.onAfterRenderObservable.add(function(){d.setTransformMatrix(m._savedViewMatrix,d.getProjectionMatrix()),d.getEngine().cullBackFaces=!0,d._mirroredCameraPosition=null,d.clipPlane=null}),m}return v.d(a,e),Object.defineProperty(a.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(b){this._blurRatio!==b&&(this._blurRatio=b,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"adaptiveBlurKernel",{set:function(b){this._adaptiveBlurKernel=b,this._autoComputeBlurKernel()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"blurKernel",{set:function(b){this.blurKernelX=b,this.blurKernelY=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(b){this._blurKernelX!==b&&(this._blurKernelX=b,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(b){this._blurKernelY!==b&&(this._blurKernelY=b,this._preparePostProcesses())},enumerable:!0,configurable:!0}),a.prototype._autoComputeBlurKernel=function(){var b=this.getScene().getEngine(),c=this.getRenderWidth()/b.getRenderWidth(),d=this.getRenderHeight()/b.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*c,this.blurKernelY=this._adaptiveBlurKernel*d},a.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},a.prototype._updateGammaSpace=function(){this.gammaSpace=!this.scene.imageProcessingConfiguration.isEnabled||!this.scene.imageProcessingConfiguration.applyByPostProcess},a.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var b=this.getScene().getEngine(),c=b.getCaps().textureFloatRender?o.a.TEXTURETYPE_FLOAT:o.a.TEXTURETYPE_HALF_FLOAT;this._blurX=new Ib("horizontal blur",new j.w(1,0),this._blurKernelX,this._blurRatio,null,ra.a.BILINEAR_SAMPLINGMODE,b,!1,c),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.inputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new Ib("vertical blur",new j.w(0,1),this._blurKernelY,this._blurRatio,null,ra.a.BILINEAR_SAMPLINGMODE,b,!1,c),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},a.prototype.clone=function(){var b=this.getScene();if(!b)return this;var c=this.getSize(),d=new a(this.name,c.width,b,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return d.hasAlpha=this.hasAlpha,d.level=this.level,d.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(d.renderList=this.renderList.slice(0)),d},a.prototype.serialize=function(){if(!this.name)return null;var b=e.prototype.serialize.call(this);return b.mirrorPlane=this.mirrorPlane.asArray(),b},a.prototype.dispose=function(){e.prototype.dispose.call(this),this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)},a}(Ab);ra.a._CreateMirror=function(e,a,b,c){return new Te(e,a,b,c)},va.b.prototype._createDepthStencilCubeTexture=function(e,a){var b=new sb.a(this,sb.a.DATASOURCE_UNKNOWN);if(b.isCube=!0,1===this.webGLVersion)return r.a.Error("Depth cube texture is not supported by WebGL 1."),b;var c=v.a({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},a),d=this._gl;this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,b,!0),this._setupDepthStencilTexture(b,e,c.generateStencil,c.bilinearFiltering,c.comparisonFunction);for(var f=0;f<6;f++)c.generateStencil?d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d.DEPTH24_STENCIL8,e,e,0,d.DEPTH_STENCIL,d.UNSIGNED_INT_24_8,null):d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d.DEPTH_COMPONENT24,e,e,0,d.DEPTH_COMPONENT,d.UNSIGNED_INT,null);return this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null),b},va.b.prototype._partialLoadFile=function(e,a,b,c,d){void 0===d&&(d=null),this._loadFile(e,function(f){b[a]=f,b._internalCount++,6===b._internalCount&&c(b)},void 0,void 0,!0,function(f,h){d&&f&&d(f.status+" "+f.statusText,h)})},va.b.prototype._cascadeLoadFiles=function(e,a,b,c){void 0===c&&(c=null);var d=[];d._internalCount=0;for(var f=0;f<6;f++)this._partialLoadFile(b[f],f,d,a,c)},va.b.prototype._cascadeLoadImgs=function(e,a,b,c){void 0===c&&(c=null);var d=[];d._internalCount=0;for(var f=0;f<6;f++)this._partialLoadImg(b[f],f,d,e,a,c)},va.b.prototype._partialLoadImg=function(e,a,b,c,d,f){var h;void 0===f&&(f=null),h=xa.h.LoadImage(e,function(){b[a]=h,b._internalCount++,c&&c._removePendingData(h),6===b._internalCount&&d(b)},function(i,k){c&&c._removePendingData(h),f&&f(i,k)},c?c.offlineProvider:null),c&&c._addPendingData(h)},va.b.prototype.createCubeTexture=function(e,a,b,c,d,f,h,i,k,m,B,E,K){var P=this;void 0===d&&(d=null),void 0===f&&(f=null),void 0===i&&(i=null),void 0===k&&(k=!1),void 0===m&&(m=0),void 0===B&&(B=0),void 0===E&&(E=null),void 0===K&&(K=[]);var S=this._gl,U=E||new sb.a(this,sb.a.DATASOURCE_CUBE);U.isCube=!0,U.url=e,U.generateMipMaps=!c,U._lodGenerationScale=m,U._lodGenerationOffset=B,this._doNotHandleContextLost||(U._extension=i,U._files=b);for(var _=e.lastIndexOf("."),da=i||(_>-1?e.substring(_).toLowerCase():""),fa=null,ga=0,ha=va.b._TextureLoaders;ga<ha.length;ga++){var ka=ha[ga];if(-1===K.indexOf(ka)&&ka.canLoad(da,this._textureFormatInUse,E,!1,!1)){fa=ka;break}}if(fa){e=fa.transformUrl(e,this._textureFormatInUse);var la=function(ma){P._bindTextureDirectly(S.TEXTURE_CUBE_MAP,U,!0),fa.loadCubeData(ma,U,k,d,f)};b&&6===b.length?fa.supportCascades?this._cascadeLoadFiles(a,la,b,f):f?f("Textures type does not support cascades."):r.a.Warn("Texture loader does not support cascades."):this._loadFile(e,la,void 0,void 0,!0,function(ma,ta){if(fa){var pa=fa.getFallbackTextureUrl(U.url,P._textureFormatInUse);if(r.a.Warn(fa.constructor.name+" failed when trying to load "+U.url+", falling back to the next supported loader"),pa)return K.push(fa),void P.createCubeTexture(pa,a,b,c,d,f,h,da,k,m,B,U,K)}f&&ma&&f(ma.status+" "+ma.statusText,ta)})}else{if(!b)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(a,function(ma){var ta=P.needPOTTextures?xa.h.GetExponentOfTwo(ma[0].width,P._caps.maxCubemapTextureSize):ma[0].width,pa=ta;if(P._prepareWorkingCanvas(),P._workingCanvas&&P._workingContext){P._workingCanvas.width=ta,P._workingCanvas.height=pa;var ua=[S.TEXTURE_CUBE_MAP_POSITIVE_X,S.TEXTURE_CUBE_MAP_POSITIVE_Y,S.TEXTURE_CUBE_MAP_POSITIVE_Z,S.TEXTURE_CUBE_MAP_NEGATIVE_X,S.TEXTURE_CUBE_MAP_NEGATIVE_Y,S.TEXTURE_CUBE_MAP_NEGATIVE_Z];P._bindTextureDirectly(S.TEXTURE_CUBE_MAP,U,!0),P._unpackFlipY(!1);for(var wa=h?P._getInternalFormat(h):P._gl.RGBA,ya=0;ya<ua.length;ya++)ma[ya].width!==ta||ma[ya].height!==pa?(P._workingContext.drawImage(ma[ya],0,0,ma[ya].width,ma[ya].height,0,0,ta,pa),S.texImage2D(ua[ya],0,wa,wa,S.UNSIGNED_BYTE,P._workingCanvas)):S.texImage2D(ua[ya],0,wa,wa,S.UNSIGNED_BYTE,ma[ya]);c||S.generateMipmap(S.TEXTURE_CUBE_MAP),P._setCubeMapTextureParams(!c),U.width=ta,U.height=pa,U.isReady=!0,h&&(U.format=h),U.onLoadedObservable.notifyObservers(U),U.onLoadedObservable.clear(),d&&d()}},b,f)}return this._internalTexturesCache.push(U),U};var bc=function(e){function a(b,c,d,f,h,i,k,m,B,E,K,P,S){void 0===d&&(d=null),void 0===f&&(f=!1),void 0===h&&(h=null),void 0===i&&(i=null),void 0===k&&(k=null),void 0===m&&(m=o.a.TEXTUREFORMAT_RGBA),void 0===B&&(B=!1),void 0===E&&(E=null),void 0===K&&(K=!1),void 0===P&&(P=.8),void 0===S&&(S=0);var U=e.call(this,c)||this;if(U.boundingBoxPosition=j.x.Zero(),U._rotationY=0,U._prefiltered=!1,U.name=b,U.url=b,U._noMipmap=f,U.hasAlpha=!1,U._format=m,U.isCube=!0,U._textureMatrix=j.j.Identity(),U._createPolynomials=K,U.coordinatesMode=ra.a.CUBIC_MODE,!b&&!h)return U;var _=b.lastIndexOf("."),da=E||(_>-1?b.substring(_).toLowerCase():""),fa=".dds"===da,ga=".env"===da;if(ga?(U.gammaSpace=!1,U._prefiltered=!1):(U._prefiltered=B,B&&(U.gammaSpace=!1)),U._texture=U._getFromCache(b,f),!h&&(ga||fa||d||(d=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),h=[],d))for(var ha=0;ha<d.length;ha++)h.push(b+d[ha]);return U._files=h,U._texture?i&&(U._texture.isReady?xa.h.SetImmediate(function(){return i()}):U._texture.onLoadedObservable.add(i)):c.useDelayedTextureLoading?U.delayLoadState=o.a.DELAYLOADSTATE_NOTLOADED:U._texture=B?c.getEngine().createPrefilteredCubeTexture(b,c,P,S,i,k,m,E,U._createPolynomials):c.getEngine().createCubeTexture(b,c,h,f,i,k,U._format,E,!1,P,S),U}return v.d(a,e),Object.defineProperty(a.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(b){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(b)){this._boundingBoxSize=b;var c=this.getScene();c&&c.markAllMaterialsAsDirty(o.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationY",{get:function(){return this._rotationY},set:function(b){this._rotationY=b,this.setReflectionTextureMatrix(j.j.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),a.CreateFromImages=function(b,c,d){var f="";return b.forEach(function(h){return f+=h}),new a(f,c,null,d,b)},a.CreateFromPrefilteredData=function(b,c,d,f){return void 0===d&&(d=null),void 0===f&&(f=!0),new a(b,c,null,!1,null,null,null,void 0,!0,d,f)},Object.defineProperty(a.prototype,"isPrefiltered",{get:function(){return this._prefiltered},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"CubeTexture"},a.prototype.updateURL=function(b,c,d){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(o.a.MATERIAL_TextureDirtyFlag)),this.url=b,this.delayLoadState=o.a.DELAYLOADSTATE_NOTLOADED,this._prefiltered=!1,d&&(this._delayedOnLoad=d),this.delayLoad(c)},a.prototype.delayLoad=function(b){if(this.delayLoadState===o.a.DELAYLOADSTATE_NOTLOADED){var c=this.getScene();c&&(this.delayLoadState=o.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._prefiltered?this._texture=c.getEngine().createPrefilteredCubeTexture(this.url,c,this.lodGenerationScale,this.lodGenerationOffset,this._delayedOnLoad,void 0,this._format,void 0,this._createPolynomials):this._texture=c.getEngine().createCubeTexture(this.url,c,this._files,this._noMipmap,this._delayedOnLoad,null,this._format,b)))}},a.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},a.prototype.setReflectionTextureMatrix=function(b){var c=this;b.updateFlag!==this._textureMatrix.updateFlag&&(b.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(o.a.MATERIAL_TextureDirtyFlag,function(d){return-1!==d.getActiveTextures().indexOf(c)}),this._textureMatrix=b)},a.Parse=function(b,c,d){var f=g.a.Parse(function(){var m=!1;return b.prefiltered&&(m=b.prefiltered),new a(d+b.name,c,b.extensions,!1,null,null,null,void 0,m)},b,c);if(b.boundingBoxPosition&&(f.boundingBoxPosition=j.x.FromArray(b.boundingBoxPosition)),b.boundingBoxSize&&(f.boundingBoxSize=j.x.FromArray(b.boundingBoxSize)),b.animations)for(var h=0;h<b.animations.length;h++){var i=b.animations[h],k=I.a.GetClass("BABYLON.Animation");k&&f.animations.push(k.Parse(i))}return f},a.prototype.clone=function(){var b=this,c=this.getScene(),d=0,f=g.a.Clone(function(){if(!c)return b;var h=new a(b.url,c,b._extensions,b._noMipmap,b._files);return d=h.uniqueId,h},this);return f.uniqueId=d,f},v.c([Object(g.c)("rotationY")],a.prototype,"rotationY",null),v.c([Object(g.j)("textureMatrix")],a.prototype,"_textureMatrix",void 0),a}(ac.a);ra.a._CubeTextureParser=bc.Parse,I.a.RegisteredTypes["BABYLON.CubeTexture"]=bc;var Ta=l(15),Ue=l(64),Ve=l(75),Ra=l(18),gj=` uniform vec4 vPrimaryColor;
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
uniform vec4 vPrimaryColorShadow;
#endif
uniform float shadowLevel;
uniform float alpha;
#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#endif
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif`;Ia.a.IncludesShadersStore.backgroundFragmentDeclaration=gj;var hj=`layout(std140,column_major) uniform;
uniform Material
{
uniform vec4 vPrimaryColor;
uniform vec4 vPrimaryColorShadow;
uniform vec2 vDiffuseInfos;
uniform vec2 vReflectionInfos;
uniform mat4 diffuseMatrix;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
uniform float pointSize;
uniform float shadowLevel;
uniform float alpha;
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};`;Ia.a.IncludesShadersStore.backgroundUboDeclaration=hj,l(113),l(84),l(85),l(120),l(112),l(95),l(98),l(89),l(114),l(99);var ij=`#ifdef TEXTURELODSUPPORT
#extension GL_EXT_shader_texture_lod : enable
#endif
precision highp float;
#include<__decl__backgroundFragment>
#define RECIPROCAL_PI2 0.15915494

uniform vec3 vEyePosition;

varying vec3 vPositionW;
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE;
#endif

#ifndef SHADOWONLY
#define SHADOWONLY;
#endif
#include<imageProcessingDeclaration>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<helperFunctions>
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<imageProcessingFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
#ifdef REFLECTIONFRESNEL
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25
vec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(0.0,1.0,0.0);
#endif

float shadow=1.;
float globalShadow=0.;
float shadowLightCount=0.;
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef SHADOWINUSE
globalShadow/=shadowLightCount;
#else
globalShadow=1.0;
#endif

vec4 reflectionColor=vec4(1.,1.,1.,1.);
#ifdef REFLECTION
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=reflectionVector;
#else
vec2 reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
#ifdef REFLECTIONBLUR
float reflectionLOD=vReflectionInfos.y;
#ifdef TEXTURELODSUPPORT

reflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
reflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#else
float lodReflectionNormalized=saturate(reflectionLOD);
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodReflectionNormalizedDoubled<1.0){
reflectionColor=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
reflectionSpecularMid,
lodReflectionNormalizedDoubled
);
} else {
reflectionColor=mix(
reflectionSpecularMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#else
vec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);
reflectionColor=reflectionSample;
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef GAMMAREFLECTION
reflectionColor.rgb=toLinearSpace(reflectionColor.rgb);
#endif
#ifdef REFLECTIONBGR
reflectionColor.rgb=reflectionColor.bgr;
#endif

reflectionColor.rgb*=vReflectionInfos.x;
#endif

vec3 diffuseColor=vec3(1.,1.,1.);
float finalAlpha=alpha;
#ifdef DIFFUSE
vec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);
#ifdef GAMMADIFFUSE
diffuseMap.rgb=toLinearSpace(diffuseMap.rgb);
#endif

diffuseMap.rgb*=vDiffuseInfos.y;
#ifdef DIFFUSEHASALPHA
finalAlpha*=diffuseMap.a;
#endif
diffuseColor=diffuseMap.rgb;
#endif

#ifdef REFLECTIONFRESNEL
vec3 colorBase=diffuseColor;
#else
vec3 colorBase=reflectionColor.rgb*diffuseColor;
#endif
colorBase=max(colorBase,0.0);

#ifdef USERGBCOLOR
vec3 finalColor=colorBase;
#else
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
vec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);
#else
vec3 mainColor=vPrimaryColor.rgb;
#endif
vec3 finalColor=colorBase*mainColor;
#endif

#ifdef REFLECTIONFRESNEL
vec3 reflectionAmount=vReflectionControl.xxx;
vec3 reflectionReflectance0=vReflectionControl.yyy;
vec3 reflectionReflectance90=vReflectionControl.zzz;
float VdotN=dot(normalize(vEyePosition),normalW);
vec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(saturate(VdotN),reflectionReflectance0,reflectionReflectance90,1.0);
reflectionAmount*=planarReflectionFresnel;
#ifdef REFLECTIONFALLOFF
float reflectionDistanceFalloff=1.0-saturate(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w);
reflectionDistanceFalloff*=reflectionDistanceFalloff;
reflectionAmount*=reflectionDistanceFalloff;
#endif
finalColor=mix(finalColor,reflectionColor.rgb,saturate(reflectionAmount));
#endif
#ifdef OPACITYFRESNEL
float viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));

const float startAngle=0.1;
float fadeFactor=saturate(viewAngleToFloor/startAngle);
finalAlpha*=fadeFactor*fadeFactor;
#endif

#ifdef SHADOWINUSE
finalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);
#endif

vec4 color=vec4(finalColor,finalAlpha);
#include<fogFragment>
#ifdef IMAGEPROCESSINGPOSTPROCESS


color.rgb=clamp(color.rgb,0.,30.0);
#else

color=applyImageProcessing(color);
#endif
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#ifdef NOISE
color.rgb+=dither(vPositionW.xy,0.5);
color=max(color,0.0);
#endif
gl_FragColor=color;
}
`;Ia.a.ShadersStore.backgroundPixelShader=ij;var jj=`uniform mat4 view;
uniform mat4 viewProjection;
uniform float shadowLevel;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif`;Ia.a.IncludesShadersStore.backgroundVertexDeclaration=jj,l(67),l(68),l(96),l(100),l(69),l(70),l(90),l(116),l(117);var kj=`precision highp float;
#include<__decl__backgroundVertex>
#include<helperFunctions>

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
void main(void) {
#ifdef REFLECTIONMAP_SKYBOX
#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED
vPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;
#else
vPositionUVW=position;
#endif
#endif
#include<instancesVertex>
#include<bonesVertex>
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
} else {
gl_Position=viewProjectionR*finalWorld*vec4(position,1.0);
}
#else
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#endif
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normal);
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));
#ifdef EQUIRECTANGULAR_RELFECTION_FOV
mat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));
vec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));
if (fFovMultiplier<=1.0) {
vDirectionW=normalize(segment);
} else {
vDirectionW=normalize(vDirectionW+(vDirectionW-segment));
}
#endif
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uv;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;Ia.a.ShadersStore.backgroundVertexShader=kj;var lj=function(e){function a(){var b=e.call(this)||this;return b.DIFFUSE=!1,b.DIFFUSEDIRECTUV=0,b.GAMMADIFFUSE=!1,b.DIFFUSEHASALPHA=!1,b.OPACITYFRESNEL=!1,b.REFLECTIONBLUR=!1,b.REFLECTIONFRESNEL=!1,b.REFLECTIONFALLOFF=!1,b.TEXTURELODSUPPORT=!1,b.PREMULTIPLYALPHA=!1,b.USERGBCOLOR=!1,b.USEHIGHLIGHTANDSHADOWCOLORS=!1,b.NOISE=!1,b.REFLECTIONBGR=!1,b.IMAGEPROCESSING=!1,b.VIGNETTE=!1,b.VIGNETTEBLENDMODEMULTIPLY=!1,b.VIGNETTEBLENDMODEOPAQUE=!1,b.TONEMAPPING=!1,b.TONEMAPPING_ACES=!1,b.CONTRAST=!1,b.COLORCURVES=!1,b.COLORGRADING=!1,b.COLORGRADING3D=!1,b.SAMPLER3DGREENDEPTH=!1,b.SAMPLER3DBGRMAP=!1,b.IMAGEPROCESSINGPOSTPROCESS=!1,b.EXPOSURE=!1,b.MULTIVIEW=!1,b.REFLECTION=!1,b.REFLECTIONMAP_3D=!1,b.REFLECTIONMAP_SPHERICAL=!1,b.REFLECTIONMAP_PLANAR=!1,b.REFLECTIONMAP_CUBIC=!1,b.REFLECTIONMAP_PROJECTION=!1,b.REFLECTIONMAP_SKYBOX=!1,b.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,b.REFLECTIONMAP_EXPLICIT=!1,b.REFLECTIONMAP_EQUIRECTANGULAR=!1,b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,b.INVERTCUBICMAP=!1,b.REFLECTIONMAP_OPPOSITEZ=!1,b.LODINREFLECTIONALPHA=!1,b.GAMMAREFLECTION=!1,b.RGBDREFLECTION=!1,b.EQUIRECTANGULAR_RELFECTION_FOV=!1,b.MAINUV1=!1,b.MAINUV2=!1,b.UV1=!1,b.UV2=!1,b.CLIPPLANE=!1,b.CLIPPLANE2=!1,b.CLIPPLANE3=!1,b.CLIPPLANE4=!1,b.POINTSIZE=!1,b.FOG=!1,b.NORMAL=!1,b.NUM_BONE_INFLUENCERS=0,b.BonesPerMesh=0,b.INSTANCES=!1,b.SHADOWFLOAT=!1,b.rebuild(),b}return v.d(a,e),a}(Ue.a),Mc=function(e){function a(b,c){var d=e.call(this,b,c)||this;return d.primaryColor=j.e.White(),d._primaryColorShadowLevel=0,d._primaryColorHighlightLevel=0,d.reflectionTexture=null,d.reflectionBlur=0,d.diffuseTexture=null,d._shadowLights=null,d.shadowLights=null,d.shadowLevel=0,d.sceneCenter=j.x.Zero(),d.opacityFresnel=!0,d.reflectionFresnel=!1,d.reflectionFalloffDistance=0,d.reflectionAmount=1,d.reflectionReflectance0=.05,d.reflectionReflectance90=.5,d.useRGBColor=!0,d.enableNoise=!1,d._fovMultiplier=1,d.useEquirectangularFOV=!1,d._maxSimultaneousLights=4,d.maxSimultaneousLights=4,d._imageProcessingObserver=null,d.switchToBGR=!1,d._renderTargets=new ic.a(16),d._reflectionControls=j.y.Zero(),d._white=j.e.White(),d._primaryShadowColor=j.e.Black(),d._primaryHighlightColor=j.e.Black(),d._attachImageProcessingConfiguration(null),d.getRenderTargetTextures=function(){return d._renderTargets.reset(),d._diffuseTexture&&d._diffuseTexture.isRenderTarget&&d._renderTargets.push(d._diffuseTexture),d._reflectionTexture&&d._reflectionTexture.isRenderTarget&&d._renderTargets.push(d._reflectionTexture),d._renderTargets},d}return v.d(a,e),Object.defineProperty(a.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(b){this.__perceptualColor=b,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(b){this._primaryColorShadowLevel=b,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(b){this._primaryColorHighlightLevel=b,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"reflectionStandardFresnelWeight",{set:function(b){var c=b;c<.5?(c*=2,this.reflectionReflectance0=a.StandardReflectance0*c,this.reflectionReflectance90=a.StandardReflectance90*c):(c=2*c-1,this.reflectionReflectance0=a.StandardReflectance0+(1-a.StandardReflectance0)*c,this.reflectionReflectance90=a.StandardReflectance90+(1-a.StandardReflectance90)*c)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(b){isNaN(b)&&(b=1),this._fovMultiplier=Math.max(0,Math.min(2,b))},enumerable:!0,configurable:!0}),a.prototype._attachImageProcessingConfiguration=function(b){var c=this;b!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=b||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){c._computePrimaryColorFromPerceptualColor(),c._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(a.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(b){this._attachImageProcessingConfiguration(b),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(b){this.imageProcessingConfiguration.colorCurvesEnabled=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(b){this.imageProcessingConfiguration.colorGradingEnabled=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(b){this._imageProcessingConfiguration.toneMappingEnabled=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(b){this._imageProcessingConfiguration.exposure=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(b){this._imageProcessingConfiguration.contrast=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(b){this.imageProcessingConfiguration.colorGradingTexture=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(b){this.imageProcessingConfiguration.colorCurves=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasRenderTargetTextures",{get:function(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),a.prototype.needAlphaTesting=function(){return!0},a.prototype.needAlphaBlending=function(){return this.alpha<0||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},a.prototype.isReadyForSubMesh=function(b,c,d){var f=this;if(void 0===d&&(d=!1),c.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;c._materialDefines||(c._materialDefines=new lj());var h=this.getScene(),i=c._materialDefines;if(!this.checkReadyOnEveryCall&&c.effect&&i._renderId===h.getRenderId())return!0;var k=h.getEngine();if(Ta.a.PrepareDefinesForLights(h,b,i,!1,this._maxSimultaneousLights),i._needNormals=!0,Ta.a.PrepareDefinesForMultiview(h,i),i._areTexturesDirty){if(i._needUVs=!1,h.texturesEnabled){if(h.getEngine().getCaps().textureLOD&&(i.TEXTURELODSUPPORT=!0),this._diffuseTexture&&Ra.a.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;Ta.a.PrepareDefinesForMergedUV(this._diffuseTexture,i,"DIFFUSE"),i.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,i.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,i.OPACITYFRESNEL=this._opacityFresnel}else i.DIFFUSE=!1,i.DIFFUSEHASALPHA=!1,i.GAMMADIFFUSE=!1,i.OPACITYFRESNEL=!1;var m=this._reflectionTexture;if(m&&Ra.a.ReflectionTextureEnabled){if(!m.isReadyOrNotBlocking())return!1;switch(i.REFLECTION=!0,i.GAMMAREFLECTION=m.gammaSpace,i.RGBDREFLECTION=m.isRGBD,i.REFLECTIONBLUR=this._reflectionBlur>0,i.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!m.invertZ:m.invertZ,i.LODINREFLECTIONALPHA=m.lodLevelInAlpha,i.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,i.REFLECTIONBGR=this.switchToBGR,m.coordinatesMode===ra.a.INVCUBIC_MODE&&(i.INVERTCUBICMAP=!0),i.REFLECTIONMAP_3D=m.isCube,m.coordinatesMode){case ra.a.EXPLICIT_MODE:i.REFLECTIONMAP_EXPLICIT=!0;break;case ra.a.PLANAR_MODE:i.REFLECTIONMAP_PLANAR=!0;break;case ra.a.PROJECTION_MODE:i.REFLECTIONMAP_PROJECTION=!0;break;case ra.a.SKYBOX_MODE:i.REFLECTIONMAP_SKYBOX=!0,i.REFLECTIONMAP_SKYBOX_TRANSFORMED=!m.getReflectionTextureMatrix().isIdentity();break;case ra.a.SPHERICAL_MODE:i.REFLECTIONMAP_SPHERICAL=!0;break;case ra.a.EQUIRECTANGULAR_MODE:i.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case ra.a.FIXED_EQUIRECTANGULAR_MODE:i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case ra.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case ra.a.CUBIC_MODE:case ra.a.INVCUBIC_MODE:default:i.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(i.REFLECTIONFRESNEL=!0,i.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(i.REFLECTIONFRESNEL=!1,i.REFLECTIONFALLOFF=!1)}else i.REFLECTION=!1,i.REFLECTIONFRESNEL=!1,i.REFLECTIONFALLOFF=!1,i.REFLECTIONBLUR=!1,i.REFLECTIONMAP_3D=!1,i.REFLECTIONMAP_SPHERICAL=!1,i.REFLECTIONMAP_PLANAR=!1,i.REFLECTIONMAP_CUBIC=!1,i.REFLECTIONMAP_PROJECTION=!1,i.REFLECTIONMAP_SKYBOX=!1,i.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,i.REFLECTIONMAP_EXPLICIT=!1,i.REFLECTIONMAP_EQUIRECTANGULAR=!1,i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,i.INVERTCUBICMAP=!1,i.REFLECTIONMAP_OPPOSITEZ=!1,i.LODINREFLECTIONALPHA=!1,i.GAMMAREFLECTION=!1,i.RGBDREFLECTION=!1}i.PREMULTIPLYALPHA=this.alphaMode===o.a.ALPHA_PREMULTIPLIED||this.alphaMode===o.a.ALPHA_PREMULTIPLIED_PORTERDUFF,i.USERGBCOLOR=this._useRGBColor,i.NOISE=this._enableNoise}if(i._areLightsDirty&&(i.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(0!==this._primaryColorShadowLevel||0!==this._primaryColorHighlightLevel)),i._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(i)}if(Ta.a.PrepareDefinesForMisc(b,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(b),i),Ta.a.PrepareDefinesForFrameBoundValues(h,k,i,d),Ta.a.PrepareDefinesForAttributes(b,i,!1,!0,!1)&&b&&(h.getEngine().getCaps().standardDerivatives||b.isVerticesDataPresent(na.b.NormalKind)||(b.createNormals(!0),r.a.Warn("BackgroundMaterial: Normals have been created for the mesh: "+b.name))),i.isDirty){i.markAsProcessed(),h.resetCachedMaterial();var B=new Ia.c();i.FOG&&B.addFallback(0,"FOG"),i.POINTSIZE&&B.addFallback(1,"POINTSIZE"),i.MULTIVIEW&&B.addFallback(0,"MULTIVIEW"),Ta.a.HandleFallbacksForShadows(i,B,this._maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&B.addCPUSkinningFallback(0,b);var E=[na.b.PositionKind];i.NORMAL&&E.push(na.b.NormalKind),i.UV1&&E.push(na.b.UVKind),i.UV2&&E.push(na.b.UV2Kind),Ta.a.PrepareAttributesForBones(E,b,i,B),Ta.a.PrepareAttributesForInstances(E,i);var K=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],P=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],S=["Material","Scene"];Eb.a&&(Eb.a.PrepareUniforms(K,i),Eb.a.PrepareSamplers(P,i)),Ta.a.PrepareUniformsAndSamplersList({uniformsNames:K,uniformBuffersNames:S,samplers:P,defines:i,maxSimultaneousLights:this._maxSimultaneousLights});var U=i.toString();c.setEffect(h.getEngine().createEffect("background",{attributes:E,uniformsNames:K,uniformBuffersNames:S,samplers:P,defines:U,fallbacks:B,onCompiled:function(_){f.onCompiled&&f.onCompiled(_),f.bindSceneUniformBuffer(_,h.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},k),i),this.buildUniformLayout()}return!(!c.effect||!c.effect.isReady())&&(i._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},a.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},a.prototype._computePrimaryColors=function(){0===this._primaryColorShadowLevel&&0===this._primaryColorHighlightLevel||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},a.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},a.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),e.prototype.unbind.call(this)},a.prototype.bindOnlyWorldMatrix=function(b){this._activeEffect.setMatrix("world",b)},a.prototype.bindForSubMesh=function(b,c,d){var f=this.getScene(),h=d._materialDefines;if(h){var i=d.effect;if(i){this._activeEffect=i,this.bindOnlyWorldMatrix(b),Ta.a.BindBonesParameters(c,this._activeEffect);var k=this._mustRebind(f,i,c.visibility);if(k){this._uniformBuffer.bindToEffect(i,"Material"),this.bindViewProjection(i);var m=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(f.texturesEnabled&&(this._diffuseTexture&&Ra.a.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),Ta.a.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),m&&Ra.a.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",m.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",m.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",m.getSize().width,m.lodGenerationScale,m.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),h.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),f.texturesEnabled&&(this._diffuseTexture&&Ra.a.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),m&&Ra.a.ReflectionTextureEnabled&&(h.REFLECTIONBLUR&&h.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",m):h.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",m._lodTextureMid||m),this._uniformBuffer.setTexture("reflectionSamplerLow",m._lodTextureLow||m),this._uniformBuffer.setTexture("reflectionSamplerHigh",m._lodTextureHigh||m)):this._uniformBuffer.setTexture("reflectionSampler",m),h.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),Ta.a.BindClipPlane(this._activeEffect,f),Ta.a.BindEyePosition(i,f)}!k&&this.isFrozen||(f.lightsEnabled&&Ta.a.BindLights(f,c,this._activeEffect,h,this._maxSimultaneousLights,!1),this.bindView(i),Ta.a.BindFogParameters(f,c,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(c,this._activeEffect)}}},a.prototype.dispose=function(b,c){void 0===b&&(b=!1),void 0===c&&(c=!1),c&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,b)},a.prototype.clone=function(b){var c=this;return g.a.Clone(function(){return new a(b,c.getScene())},this)},a.prototype.serialize=function(){var b=g.a.Serialize(this);return b.customType="BABYLON.BackgroundMaterial",b},a.prototype.getClassName=function(){return"BackgroundMaterial"},a.Parse=function(b,c,d){return g.a.Parse(function(){return new a(b.name,c)},b,c,d)},a.StandardReflectance0=.05,a.StandardReflectance90=.5,v.c([Object(g.e)()],a.prototype,"_primaryColor",void 0),v.c([Object(g.b)("_markAllSubMeshesAsLightsDirty")],a.prototype,"primaryColor",void 0),v.c([Object(g.e)()],a.prototype,"__perceptualColor",void 0),v.c([Object(g.c)()],a.prototype,"_primaryColorShadowLevel",void 0),v.c([Object(g.c)()],a.prototype,"_primaryColorHighlightLevel",void 0),v.c([Object(g.b)("_markAllSubMeshesAsLightsDirty")],a.prototype,"primaryColorHighlightLevel",null),v.c([Object(g.m)()],a.prototype,"_reflectionTexture",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionTexture",void 0),v.c([Object(g.c)()],a.prototype,"_reflectionBlur",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionBlur",void 0),v.c([Object(g.m)()],a.prototype,"_diffuseTexture",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"diffuseTexture",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"shadowLights",void 0),v.c([Object(g.c)()],a.prototype,"_shadowLevel",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"shadowLevel",void 0),v.c([Object(g.o)()],a.prototype,"_sceneCenter",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"sceneCenter",void 0),v.c([Object(g.c)()],a.prototype,"_opacityFresnel",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"opacityFresnel",void 0),v.c([Object(g.c)()],a.prototype,"_reflectionFresnel",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionFresnel",void 0),v.c([Object(g.c)()],a.prototype,"_reflectionFalloffDistance",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionFalloffDistance",void 0),v.c([Object(g.c)()],a.prototype,"_reflectionAmount",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionAmount",void 0),v.c([Object(g.c)()],a.prototype,"_reflectionReflectance0",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionReflectance0",void 0),v.c([Object(g.c)()],a.prototype,"_reflectionReflectance90",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionReflectance90",void 0),v.c([Object(g.c)()],a.prototype,"_useRGBColor",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useRGBColor",void 0),v.c([Object(g.c)()],a.prototype,"_enableNoise",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"enableNoise",void 0),v.c([Object(g.c)()],a.prototype,"_maxSimultaneousLights",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"maxSimultaneousLights",void 0),v.c([Object(g.i)()],a.prototype,"_imageProcessingConfiguration",void 0),a}(Ve.a);I.a.RegisteredTypes["BABYLON.BackgroundMaterial"]=Mc;var Zg=l(80),We=function(){function e(a,b){var c=this;this._errorHandler=function(d,f){c.onErrorObservable.notifyObservers({message:d,exception:f})},this._options=v.a({},e._getDefaultOptions(),a),this._scene=b,this.onErrorObservable=new q.c(),this._setupBackground(),this._setupImageProcessing()}return e._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new j.e(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:o.a.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-05,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new j.e(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:j.x.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(e.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skybox",{get:function(){return this._skybox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ground",{get:function(){return this._ground},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!0,configurable:!0}),e.prototype.updateOptions=function(a){var b=v.a({},this._options,a);this._ground&&!b.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!b.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=b.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!b.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!b.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=b.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!b.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=b.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=b,this._setupBackground(),this._setupImageProcessing()},e.prototype.setMainColor=function(a){this.groundMaterial&&(this.groundMaterial.primaryColor=a),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=a),this.groundMirror&&(this.groundMirror.clearColor=new j.f(a.r,a.g,a.b,1))},e.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},e.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof ac.a)this._scene.environmentTexture=this._options.environmentTexture;else{var a=bc.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=a}},e.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new Ca.a("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var a=this._getSceneSize();this._options.createGround&&(this._setupGround(a),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(a),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(a),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=a.rootPosition.x,this._rootMesh.position.z=a.rootPosition.z,this._rootMesh.position.y=a.rootPosition.y},e.prototype._getSceneSize=function(){var a=this,b=this._options.groundSize,c=this._options.skyboxSize,d=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:b,skyboxSize:c,rootPosition:d};var f=this._scene.getWorldExtends(function(k){return k!==a._ground&&k!==a._rootMesh&&k!==a._skybox}),h=f.max.subtract(f.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof Bc&&this._scene.activeCamera.upperRadiusLimit&&(c=b=2*this._scene.activeCamera.upperRadiusLimit);var i=h.length();i>b&&(c=b=2*i),b*=1.1,c*=1.5,(d=f.min.add(h.scale(.5))).y=f.min.y-this._options.groundYBias}return{groundSize:b,skyboxSize:c,rootPosition:d}},e.prototype._setupGround=function(a){var b=this;this._ground&&!this._ground.isDisposed()||(this._ground=Ca.a.CreatePlane("BackgroundPlane",a.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){b._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},e.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new Mc("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=o.a.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},e.prototype._setupGroundDiffuseTexture=function(){if(this._groundMaterial&&!this._groundTexture)if(this._options.groundTexture instanceof ac.a)this._groundMaterial.diffuseTexture=this._options.groundTexture;else{var a=new ra.a(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler);a.gammaSpace=!1,a.hasAlpha=!0,this._groundMaterial.diffuseTexture=a}},e.prototype._setupGroundMirrorTexture=function(a){var b=ra.a.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new Te("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,ra.a.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new j.n(0,-1,0,a.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=b,this._groundMirror.wrapV=b,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var c=0;c<this._scene.meshes.length;c++){var d=this._scene.meshes[c];d!==this._ground&&d!==this._skybox&&d!==this._rootMesh&&this._groundMirror.renderList.push(d)}this._groundMirror.clearColor=new j.f(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},e.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},e.prototype._setupSkybox=function(a){var b=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=Ca.a.CreateBox("BackgroundSkybox",a.skyboxSize,this._scene,void 0,Ca.a.BACKSIDE),this._skybox.onDisposeObservable.add(function(){b._skybox=null})),this._skybox.parent=this._rootMesh},e.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new Mc("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},e.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof ac.a?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new bc(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=ra.a.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},e.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},e._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",e._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",e._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",e}(),Od=l(42),mj=function(e){function a(b,c,d,f,h){void 0===h&&(h=null);var i=e.call(this,b,f)||this;i._useDirectMapping=!1,i.onLoadErrorObservable=new q.c(),b=b||"photoDome",d.resolution=0|Math.abs(d.resolution)||32,d.size=Math.abs(d.size)||(f.activeCamera?.48*f.activeCamera.maxZ:1000),void 0===d.useDirectMapping?i._useDirectMapping=!0:i._useDirectMapping=d.useDirectMapping,void 0===d.faceForward&&(d.faceForward=!0),i._setReady(!1);var k=i._material=new Mc(b+"_material",f);if(i._mesh=Ca.a.CreateSphere(b+"_mesh",d.resolution,d.size,f,!1,Ca.a.BACKSIDE),k.opacityFresnel=!1,k.useEquirectangularFOV=!0,k.fovMultiplier=1,i.photoTexture=new ra.a(c,f,!0,!i._useDirectMapping,void 0,void 0,function(K,P){i.onLoadErrorObservable.notifyObservers(K||"Unknown error occured"),h&&h(K,P)}),i.photoTexture.onLoadObservable.addOnce(function(){i._setReady(!0)}),i._mesh.material=k,i._mesh.parent=i,d.faceForward&&f.activeCamera){var m=f.activeCamera,B=j.x.Forward(),E=j.x.TransformNormal(B,m.getViewMatrix());E.normalize(),i.rotation.y=Math.acos(j.x.Dot(B,E))}return i}return v.d(a,e),Object.defineProperty(a.prototype,"photoTexture",{get:function(){return this._photoTexture},set:function(b){this._photoTexture!==b&&(this._photoTexture=b,this._useDirectMapping?(this._photoTexture.wrapU=ra.a.CLAMP_ADDRESSMODE,this._photoTexture.wrapV=ra.a.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._photoTexture):(this._photoTexture.coordinatesMode=ra.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._photoTexture.wrapV=ra.a.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._photoTexture))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(b){this._material.fovMultiplier=b},enumerable:!0,configurable:!0}),a.prototype.dispose=function(b,c){void 0===c&&(c=!1),this._photoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this.onLoadErrorObservable.clear(),e.prototype.dispose.call(this,b,c)},a}(Od.a),nj=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void)
{
gl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);
}`;Ia.a.ShadersStore.rgbdDecodePixelShader=nj;var _g=function(){function e(){}return e._ExpandDefaultBRDFTexture=function(a){var b=a.getEngine(),c=b.getCaps(),d=!1;if(c.textureHalfFloatRender&&c.textureHalfFloatLinearFiltering?(d=!0,a.type=o.a.TEXTURETYPE_HALF_FLOAT):c.textureFloatRender&&c.textureFloatLinearFiltering&&(d=!0,a.type=o.a.TEXTURETYPE_FLOAT),d){a.isReady=!1;var f=new Za("rgbdDecode","rgbdDecode",null,null,1,null,o.a.TEXTURE_TRILINEAR_SAMPLINGMODE,b,!1,void 0,a.type,void 0,null,!1);a._isRGBD=!1,a.invertY=!1;var h=b.createRenderTargetTexture(a.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:o.a.TEXTURE_BILINEAR_SAMPLINGMODE,type:a.type,format:o.a.TEXTUREFORMAT_RGBA});f.getEffect().executeWhenCompiled(function(){f.onApply=function(i){i._bindTexture("textureSampler",a),i.setFloat2("scale",1,1)},b.scenes[0].postProcessManager.directRender([f],h,!0),b.restoreDefaultFramebuffer(),b._releaseTexture(a),b._releaseFramebufferObjects(h),f&&f.dispose(),h._swapAndDie(a),a.isReady=!0})}},e.GetEnvironmentBRDFTexture=function(a){var b=this;if(!a.environmentBRDFTexture){var c=a.useDelayedTextureLoading;a.useDelayedTextureLoading=!1;var d=ra.a.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture",a,!0,!0,ra.a.BILINEAR_SAMPLINGMODE);d._texture._isRGBD=!0,d.wrapU=ra.a.CLAMP_ADDRESSMODE,d.wrapV=ra.a.CLAMP_ADDRESSMODE,a.environmentBRDFTexture=d,a.useDelayedTextureLoading=c,d.onLoadObservable.addOnce(function(){b._ExpandDefaultBRDFTexture(d._texture)})}return a.environmentBRDFTexture},e._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR4Xuy9Ccx261oW9q5v/r7/33ufgalSbWtiTJsmTZOmSdOkpVKsWhxAxIJFQaCKUkpFiiBFKjKPh3PO7hjb2LmNnYxtjbGtbY21rQGkgCgiIKPMM5x99ruatZ7puq/7up/nWd/3bzzABjb/9675Xeu5hnt41rv8s+evW9fz+ZT+W9N/63o6re3v+nlfvq2CbdZT2hbW7dukDbf/a/9uS3G7E69Ln9PifK50sHSMvD2ur3+XY/E2++dyPelDPoU7Jm9XTm2uab86vJ56gvSd80dzXflA+Zul74PHwGuGv/MXLv+kL4Lfp56r3DM8ef6utE10Xnu97fra7uWi2/etZ8BV/F3F+fdni/8Dn9O4KSvt/cxPMa+HY5Qx024OHF3cM7zHdcsy3uAeuu3wPve3S2OVthHH09v5e9BuCT0HHgPlHsjz+3uxNALYAJ9JgAigALyBmQGPQEcAxwRQgVhIogwcIoAG2HYsM1gR3IokEDD5biMBhMeSoLXkweCoAxsGcDoX3Xi3nkCFACnfiQaPARECgPaVAMZjEuAsNttAjIBZSY8HXHkuFctt4Npj2e8+B/ImFOnwEcg9SPEqcNdyDBSZemwipBkwmvMwocG9Gm6nCDUisHpb+iSRTp+2kQTQAJ9cACt8cwRN/Ss5IJBJ7a2qC0AHYK4gUkpuQE2uoTiJfMPw4epjeqdRXYE5Rhu0me7aGCwIKtfFD0sAmklCgWBmG3utbfCrfdtlBUpK6qUIpwCkkUYDIg4yp4QhAeW9GDBwLR6glgysC8PvZq6o2MJMT3jdhtKqI0WiMfeTCMhs54BqzwNPyLueclxzS/3+XQI0jtSSQrmly4ecv249Z+U/gQOoNj+HBKj+yhGEtn9/2C10qLaWLH5Tz6KykeI3FTb7wM0uRJMWlZtmQwgXFgAr23VwDGRjADoPOgMIQ1pigNdnCrbviaqvFMopuDpvHjB8/RXoeI8ydGp4RAM2x13NzQtr74BkQoFZlceBDQTugIlaixa7kbn5nl3wNgVNpxGKi2OvQxJmjOJ24riNB/sKX0VJPS/zjNfTTgAp9s95AIj9K9DPqPQc22+nS6C0eYAGZJMLyF+sPPwGVggXypcH8HggA5gwbCjHhy9v1Z7yDIY4Gie3nIMGrQHUUNVBVeq14rnyOeiBvWjVl8QgQoZ6NajErESk0n0wx4CLFLuXJ5gOE4J8gtV4cW2RlYbvrO5lVWMk10KU6lpwrHbBr8cHn8+EMdH5YPl2H4gANhCmPEABLTsBp/5k+Y1TwGReWlGTgqiy6WFrxXcEQQTilLw8mUP5AIh1pbJnTgUrOiYIVBZKMAXqW7GISigAyjbYgkWfyyqyTTI5ZckLokEehQNxAs8TYMHF8X3w+3kSrcc1qozPAsAUqbfLX8B5AKgyFGBidOcIiB8JAMdZWV4fGak/nU+Sd0BC266CANbTqdp+zPZHmX9Uf1Txju1HxS6DbeeAZtOtavtKAILAhw9B1aCNjhyJELDZrldlFwRB1YT2nJtUNnVTBPJ41Y+dAQwOE2eD6+EBWZ4FDDRUFmUn7ZiLzjkgGbgOTTTintG1y2QiuKh2ZSKrLoDDVt4RI90jc28CMunnC/AK27iBhEB+FHgme78rtk2w5b+vcguSAKLyH5YCfT6ghAgFeAh+H9PXBxcBPiKICjo4fnEE+ODLk1NJQ7M9PACXK2iqgTa1DTpPHo59FYGgNZuM9T1AoBphFMIPIhXPMzG1Q/jBVYceAobVqCElHYo+uzwBPKvGyXBuY1O9YjZBQzOP312TK4PAVjDw/Hn/p5CEJKI2puq15C/jXFz7kiZB2CPLckzzzIPjlMtbPuT89WtK/rUSoOkFMDV/KvflEp6pCnCtH614yRPU0AAScxjvlwGABFFGlgQ12MJD+QCt7HX88bEE2aRFFnhGOdBO5hWsLDOx/mzZT6meSgAa9cLrYnA6O0yqxSDpbG/uFRAXwDWPYUsG1s2Le91Yp8CJsK5VM6wYUJyMGLLqjESsCcykC80XsddknltlRSC/fL+GBFAdXXw97fDrafnnzl+fG4FyIrAAPggD9nsTNQIhsLfziwqAVX+r5IcqAQKMxZlYUBaSQVUog4jWgXJhCGKah1QlQIUDZlDSQCm804n1+6rfQOAqEALA0SCMcwdeqZyqONKIQBsAVoBWKlcvRKnq6YHSKmAa/LJKUZFBJMf3tEdeJvmGY05cIx1XkXIlH8re8/J0SeK6I3LMvQCSAHQYULL8OhfApT6X2BN2v4YSRxW/Hivf4ALcScuPAx9JxxIHwKY6AXiIfC5+mHBNj63rW2cAwyMiDiQnygJ3AQzEZ+6BG+iCGBQ4BqD1cTHlKFTJUA3kyi0RyHF8EAAVWOg+vBCSqLeMFFnct64jOXAcW6SM8wHbLcgEUNT/3BKA2BJsWnoFAahKgGv79V2Bs5WAWkbkHAAMirgnoA1ajN8REKHay/IesCzkDdrzfMR6/B5moHuLORMu1PtKipbG9wGldsSgQVSpqdkWECRtRcPyn1DQGTVvl+rPh7pYOA2tvKxE8DOBJJuq+4/i7rj0SKpN9zA9QpFQbV9EtBxbZ1uPUcYDuAlDAEn5z83i7yRgld91AXZiftMXkG9oAartCqQKQOgIhOKHMX8elsbWF8mgdRSnm0QfJry4SoCEhAwND9EMjFE+wCXXJlS/o7ZK9RXwDhNDl0jsgJ2r81cpz8a0MpfrkJNA53sQqWsHXI8mCXZdCDImRAHmuvljjiO+Z+0FUG5GCMLy6/YcAAB/B30igdOZ4/2dDRJBIKCNQyggxfheNfn4kh8qsSGKei6v5l7VDyQEcSBzWIEKgDeTtkubWQvKg5StfBsXI4DDd2ky2EBirkt3pw3BXbFnQdjGVqSoj9weBi3fB1QqHyaIe0FEZMmmnigfNqoYwDOge4zg1AovQhcCmflOgjgbX4jrCLavWzpCa8/EOQ5xXds2y687f0ObDchdgC4M2E4wqAQYYsiDcrcRDSjVRRiQlQds/5WzAE3mHSoJlJGfIoeW8jezBDON+R7/URIQE4IyJvcJQT5XSzqCLhHJtOFN9pBVh0iil5U+5BhUnM6qw3G2UOCo4w/hkNUGtDWIa3mOgVC8CsjhtVhSN/c7ALl0J0Aqs6BkUkASUWMFiapFKoLwRCgBBJCUf9wE1MCswoEKdOcSChlQf76y8PlOGkeAeYZCMkwg+SlJ4PfIQal9uQZULKW4sAxVi2N1rr2zMusyXx/cKtZXqtrtFJxQ5C4xKBWeARc7D6F2GlAQLu4j3zoRoEwXPqRTkKMBMJt9pWLWAZbX2mON8gDTyTl4Jgbc7lrFd8HxiPdH3N9tkSGAU24DtmU+7gYsTT8lHGjlPhPz13gZFV01BWUbpWr+tazYyMOoI8TkCKg4ISgUtRIQcDwk9xhQ0u4jIQHL6m0bqDn5xANopvZ/vMZfvpGoYbscRNWbLEITA55VGMhAkZMrsfYAqQa3JBsgBiKJUTKuOg9x3PBa8ZljsjCqZojlqPIy/CFCMg6pfEe6ZvNdA+JbPrSGAG0egO36C8p+KTtYe/ttGZBzBKz+uv5fzotMPQLz/r3YRbhqAYDOgdvnDDzJIPNb4BxK8kX5AnQghqk74cJAubXqB7aWBodSMnU8Qw8MdHPMdv/cwOUEnhvEvnLRxnusgD0n0AM5CgmCMp1T2epj9ffu8XuJQFLwEZH5Z9OIH11FJoACfnohSNDwo63/DBnkyyo5gTDbv329AtpokhAOKtq23shiD21ZxIUW9VBwHACYsdomk5+HEiiTGSQ4uCsggqYg/L547mJyMZ5mNqdKRc0Eq0HDAMNrZyJS5SfaXlpqvEfRwOXjRKrIcxoitWUSI8WcUth8TYY81LPoJQs75+2SSM9F0DUYcHfcRLvFgijzdyAC2DL/rQyIQEdXYGYE1jKgz/Tbkh/Z/5QsqH3jBpQqL4AM3Fmv3QOFEDgoe9l/tZ1RAuEsROLPKo6v0VpVoGx34bBDYBxUD14EMQwciGp+CgGggMeOgq45Lnd13MZR8gjAFfYNDBUcoYturN7MmtMwTolJOoN35Ca6oUS+1uVDz38tVQFKAhBagBvQC1gpHJDgB3vPiUAX00MG38TzXtGl1e/lDdJoM5l9vGH4EF03IA+UMkBRPY0TgAcrcgpISra7TOUDhKswpBN1zen9npIAVANdDjrOHQycROMOr0xy0KrjT4C5FwO3R6nU8RHJwgN5AKPgh8EN/iRKaIJDafeAvmf+uBNAUn07GagP/jLYIkIoNzB2BVb9i8x5R+DsugFj277adAYrzcjzFQIkCkhYssIpYKtOQUkedI4qUlXeoQFmPkloQhPhPIrtVVZQgpsHY5DQi4A1TRiVw/ygNMqnnErPDgsw9TLz7lwHbPhIofsE411geVYtgtDEhFUPXVZUY8o7jMQR62n556sDaM1AUSlw2ASkbH3JI1T1hwRhecBQMTAqraw+EYCNz2dife4baDfHJRyNks3affEAYGCyIk8lEVlRZdKunVcBVA1YNUiniIE7INmhUIwMmmVKcxFIFGGNMvDTYMZcSrnO7BbbRzxae+6ufViQUZR/wX2738WFVoIICgYKW8jvQd8Bt4Xx6Aggeh9AHPejamN23ycF7Qs/mouoFrmC264z+yEYOKPP5ABZ9y64VYJOOYfIFaBSSVeAmWKRA0DlEqpbH2XFePkjHqj9TH65v6gMKfw0lpHPpxS5objAaP5FmjOhQ5PEdnyRhFMEV3cdJe3w/uNZguVpk6AiIPMABGJ1X0ffyZDUCNwgavB9SviJbiMTQGkCyglA1QFI8bypBHAuAOcHRK6g2K1uHK8tvrTx0/kAn2TD47Ux7sOB+shrdn8yhqfKASufBbi2h2FPQX7WXdUPiCPt6hUujXs7aB9VGmTnMhrkADgmPaO+Qez72CafOfdQb6JO1Kl7xgpNhDIq5Y3W1+cXOJiZ9cuH7SEA9gCUeQC5538v2aVLUZWApt4JrOkhROqPDoG2LczZrQBwchCYeBjrk+pB0rFlrGEosLswrD/OFdT7AgqGg5oVy5NLRXZ+vAKoA5C6hBreI3YzNIja9Qg1AdVvY7oRRpQl1wAVDUk9hVXKq4gDvh9/g6LgziGMQExuxwBMuIUeifVast11dZJ9LCYu1IDxh8pf/l4+7PyNtQpgfxUoE0EH/GWAaTdQ1EWECFV1RO8ArwubeoISotjfgFGp8UDRe3G6BK4KKYq5xhgUH6wAJ6s6D6gQpBznsvLwgAqsOEK68YO3s5bMhD09AlACWQQi5VIM0COwiuWjmDx0FjzvgxW/13pcSnnm2dC9jZKl5WGIHhFNACqPkc7lCGCU/TcuwLmCMeiNQzDg7gPa234RHqBysJPAhxG6hbhfwKgpxfkxMAHCgmTUwJtOEiqVrC61/EFg7Ci3AppXF9Atdh+kuFUdFaCFojm3IgECEBeK60kKAHUoZhfuS4B7lAcwKh8kHHUmH0u9nhSqkjviFgRiXI1fXwmA3wWgG39aP0BR1aPqnwY9WGhX/89DsRsKiPZfyAHg4EOlaOAC8jDEAKZOuQJUdraYUtl9vkFZP6tmgyShUB0GD37PSLldTG8SgA0AQ3VXRAT3xrgIJiiy3CoB6UDEJNa+YIYoJeciRxERlrPMMCaCZKLKvxSQmu/vzhkkEtnBgeIj+PHK6nLcNpOkeYZ0rOXX1xCAXgZi2oCx3s+WPq8zbiBfmgE6lP/KhWGcXZfBvji4iBAkmA2ZEIvS8QuBpfthldqqIZUWYdA64OLgRIUS2fUjrgEJLSozuUQmgUu6jXAbqxSOLAJra++HJ1McpC9K8Q8fRyQ9DVgDZ6G+W+WKSgxarVWoJglCnHtEIJVTpkuB9hozAeQkYGc6sCkD7oABN5AHeHUDBVTlC5mWX6X+jRwQmCVcqOUpTtzV4zfrjsAyYQMCV8XonbLfbPa/PT/rYurDDkkBO8/INeQnzOpolZlUipXWKEE9IDQf2az/oQSgIRGtvt0KRUURfiMYpNWJtaGO5SyrblSVKcfu9SWMzl9DEQ3uci09lY2Sn4ZAQDzqZZdzd8qY+OQrwdKxdJiR7tXy68//X2sF3kCArwTLLiCe/PMY9S+jEx2BBYyr2e+DQOQITJ2/Dex54Jfz0r4DV8AAQXWwyq7sPHK6Tc6MrHy8Pg8DVhAR9w5bgyN1V+oULkOw4rXZ5bpa4O/ZSKGZeJ26qnzFvlGrKjk1N+sZZoqgAoLo5R4UuTNpmVKtPgcLVCWC/B2ciwDS3gmgtgLvBJB7Ajrgt/kBTPwBkKlvIJ0zWF8v6A1KBIaVgTYgfaNQ0C8gyMEMD6oy1DME+QPnGsiiIrnU8wDDj9aPzh+pUDsFERYMHv7eJjwZqa5UdgzbiEQiIA2TewFoRCIyJhrhToj8nMqO1rcHA+a9XKslGA9g+508AYr1GCLAd1/+BXAAGwjw58AR6M3ed6x/vhKb5KOcQQXQRE9A7ari+j8QyUR2P3QEMJhVlaGJQL6hLkywKoKgsU7AZs8ZXHbboHKgBgwmKqMBxZliBbyZBKDscAs64jjnkVlGWWG+T45EgOwiwmF9xiYmDUzqeETVVSVRhKgkDiCIgFh0olCQaxl0ZmwSGdbrKTgYrBfHLGQHBFC6AakBCJOBEPcnV065AEwEFqA/QvVVCIBKZ5xE/nLVHnNVARUbB7/L8nMeQrgDAQKfjGykYHQDHEAT+UIsvgUX93XlJgFqoxKiPDSTyFMJNbmfcikiuabAzddpwTtSvn4LrrpWbvIqAx+eLiwSSt9UwOZMRNLNPDNa71UaQatzJ6b7kUBfL1qRNwIer9q4knS1mQC2o9gZgbIfQCT+ynYtUUd5AdMViKQRdAIa1dfJQZkPeArw4cZgXBqWDYGd8VraYhjmLuGo1mUYmAdkE4M8gJAQq2ry/hTj2n3QlSAcGilFaqxUVS/zyuSB0FfPIYmMlLKj6JbwgHxgRgS3RHviCPaTBGG3rcajNolZUnDrAxvfnqQ6vsqptO2W33D+pjVNBW4EMAX+mpgTicCB+isAO1U3vf0+BHCKT0qPA8e4B8wH4OCJYvSIHBhcYP10M0+5IpX4U27DNiXVLfA8Nc4m5arPt8AyyI5z9yHeQ1CR2BmIwa9IyBCmrezX17mRarXsugaNTiBqUnMuw90fIiqZVwDiFm6nKLJ1AUF1xXzXvAfdt6b+9GzpXsq8C7uPzrGJAHJ8nysBhgjodeCqDFjdgAoFirJHGf2q4FAdEACtpcEg9m84toM/zgMwucBwCcOE3ja4DocenKehOQ8FAdD80FgBR+VAsz5oJXXVBGnpo9IgAaHIlEzqiZJm+cYAQgsee96oEUiXtqicWiV0UFkogIzICwEb5DdGuQv3Pei+heszmKOKST2MChGUWBA5VAIwrwI7l5Bgu6HnWoKzbcDQHASKb+P3fqJPdwQWRmTF7FQIuurPwLPHxRIK21NPGn3gcznGOQ8kNBp0DQ8+HuQEEqtMz3HUKzZOJjOQUsIjQBYOQg1Uc71MbF0CadfplLXadOuompaDc+BkKbkNXaf3eZlCVPIc7CzpHI0g8nUJVVbfsQ2T8n2UI6IxI1xCdOzlN9YQoDQDbe8FhERgbt1V4J9OBAbqb/IGBGIdJsCtL+xmQgUcMAeB784/ytzT8XF/UFRHMNW22wHGCSwNavH9m4fQvw6rADeZ9T+UAKyXpgajzrp3yWKkxhVHHhBIvDqRZgmQXZMBemCfdVYfBIJzAJnoXJs2EIUF6YjY7Pdmp9gNIeDaMgHAj4PWXoDtkEFFQM73L3YvhxGh5QeFB9uf8EPqn8MFta5lxicnBWFyUYAVb6AELSaTEECsmAQu88B761JbCoDY21a53rgKqy5tiMCzKYqr5hQAOcnYUtnfIAutEmxqkJprNM+lkV0BZEhITSYLzGCIE1BCQNP5Bq6Bk7+Pdwd4B5Q7EOsFuTwqRNheCZYcQHkbcHshSCnxuV4A/jFQfBlIeYBmYk405dfH+sZyF+UqD2yg9N7Kl+FGg79Ty4+B3x7MlKJTEonBgAPZgjpI/HUdxcgV4MAOSKVnXwXo+ZpN/MrJVACnsqHqWPCNAFeQ0wESa7dGOQEPKHUNVbfrIQJ1LeeVYZK4z4bQ8Vv5a023KfiO+R46sgzcZL09kBeI9l1+4/mbN/mHFuD9F0HbLwTz36jsuQ/AN/6gkkfvA9BqX8Dis/xC6UmJnYpPrEfTZh6A3Nc/JLTqbO8Q+EhubVwASdXxYZOX5vqGMwEVwPuuQCWfZJKQBvMoL1GPaxQX9pIJqpjMKvakSxGACpxJlFTUSTigC7heF88XkgOCiIiGn2fbFfco32eOiKYqAeIat0XLbzp/M5QBs33fQR8QAai8aQTC5aYKgKFBUThUf87Ccx8BgM6oNzkItPjFPTCrKhuP24ZhAgGfVLGr6KyIImRQg9JE0nCMxhNtkDThEoNoYj5AwyjqBAxCvG+gvjFRdNQuOpZQS6da/KzwWkid00ehqJ0SnwPtTBhQgEXuISYARYLBfYfvh3c0x4p57ey+QCYwnoAASuafp/4CKewAwex/+Zxv9nZgUb8vpbum7pFDyF8TcgNVI8sorevK47UEg8ozCgvatqzEVoWdsyiDC9RNq71NJFq34bPMdtAUxwN7KdVUdlTZ9oESm3MH/fXOxaCq9MDZBUd5fm2IF/AmTrAqaIBAoDeupJbP2pgyxz2YpHNkVMVCX3ev7DdFDkFZ77H78rMrrmEngPYyEHgNGAK9/G1e/rkdEsGnGoJoPbkESRZGhZV7sIBI4w4AjAPRxfvgNsR+mA02gEbwUJwW2XxUZSQQHhhORTtq37Xdw1jdKw8PJhfCCHWzRDGX3VfgmU3oKVDX6hESEDXq7gPckJIFKj7rxgXGdxmFtc8Qj6X2IfdBBBiSQyUtrdae/Cw5soBUA6Fe457PtfyL529JIUDOA4zj/5wfcFl+Uv8Cyv1fPyGIXUF9qJzsK/sX8kDgvmjg98Dds/ITNp8HHD4sV/Iz5ASDbdrOm6Nn4dMDdQR6c91RYxERhVbi6v1LvcNodK8jEMm0qLgnlQw643SM56rnLeQQqam7/nwyvhfhtcgkYQ+s+Iw1qfq8g3JGR4ljPVUCaD8NHrgAUv9qz8yEoPIQAPR1fRz/s5NA6yfXdeL9+sghVJBWf+QUCv8juGFwNUs1b/OtW4hLfiOVta7BJv6G+wK5WHgoK56PRqDqkZkFhQU9g3Zs7wfhwahsicXAA0k8b5c7RIJ0NqX0mpyNWpOzKeDvJSoRM7h9OW5EXjsB+IlA7QdCqyPA+B+TfEgARaWd+peBVKgUwoVyXKfwvvMvjUNyFEYto3xAuek+BEBr13IGloVtOFCecgA8zj47V4EwaPfD2Ds+hrBwOEhZyXqOYgz6QtRsOK26uHNWMIrvlwd0e35+WNZB28s/IDDEPZKKPKveKvSiONw5BnZ+AriRy9AvFBXkQLmK8TV4Z9AjjuXDawiQmoF8CHDOoZRN/tX+gEoMj1P/FB5YgnDhgWgSUvuZUEMQAzqBpwMfHoXLFtsEHrNzE1TKUsvqAgEK1NgMF1I4BttItbsJPpOMixVMkgJcL+totbXDRF/sBBQg8I4VUmA6a+cG+w0AlrkHcR+c46lSHt+n0T49wKLzZKW398ITgXcB62n58PNf33MAthcAMv9VcYNqAMf3rgowjv+bwgrVL4MDlLRsL/cbAL8OQgSb+duCMp4S3Oxtcw68Lw675j56au9jcmWjtV1HYnFgm+jbj52EGsyjBKBSsyISFnSPyhlIex+7D3zuSArOEWUAPzpJSC6l3aUeIPF+BC6g7k6iYVzH8XXLb84E0H4dWLgAsP9NnSnpp0KEieRf2P4ryn3KiiuAovo5q6wqA5k0pCsg++1i/4w6va+107gNDzzMitvtKHlH1rer3NyRWAZLHkyjBJ9TjKjSMJNxD5yLUUPlYtQAN66C7g8DePaYBrgBCB05WOAyAbfEnQd4RDwtQekJwycCJ4jDuBrafnspKBIA/zYAv/EnBH+YB4jVv5f1d4pq1L+M3sZ2lRhggCrga/UH1uxYcEM09T6O9oXH7MIEP3XVkQsA1g7J2BU4YglBP1JjbbuVMjoiyYRqwG2A7PMMChBMmH01zQ8lJJrYkdiyYgOJDgM8Idvv+QSlB7JSdj3zD7yuZMbmw/ehPMd2PysBpNh/awkusX6uBvCEIIj504AtMTyDfWYOACblbAKvHtuAAFwHVQKUDe8n7wLwhkk7aEWmiTvTIYBxGp4cTOynLLtLOlUpd4PCVhzsQEG3YYGn+9Hx+yE8HMA7A5hdzWOPo67XLVP19OmQge4VEddjkncezNS7wudQHYyQkORQbVglMC7VuoDlt+whQJkKfLZTgWuv/xYW4Cu8EPTb0Rns21dGQOdbMFEStIm8OKtvjm+ARUAVZTwXItD+VhGA2CoF21jLuwOKRTlMoHp6D2BmrgFl2lmhXJkRtscrMoAR12bXazvMdtcOSriyTqZ8hhQcUYgwpKfATHZRgo3vT7PiFjBehe36CJz6nQMqfKGxY8ihF5rkdRQelXujCHdbtvyW87fWRqBUDoQ3A7vaP0wSUrMAwzxAuTj8t5MczIBM/2SCQZCinQ5i+sO5ASQsJhS8HnYk+bNT3CrO5YECmeVR5MKUolz0EC1h0YCr46UMjo4rgO+hgBCGIK7WPUsKSk1F/wMMcme7a7QD95FaiUys3S3nIQzstT0pDDDXb7+fJwx1T+haypgSzkCRswW5vU/9dWsigNoHkJ1AfSFIN/lX7H++pAN5gJpbQIAXJar/ti/Ssv4wyFG5wFnIUh+WETlhxbF5RCiGBArIyAmoZBiHFHUbfJR9cjAPvVeSU/0DHdAjafE58D5GgxiJqausQGgqrjbLZB+AVso5dRfVisBFSKse2DVzzl4AACAASURBVHG+d6MEnXQYBuiW2I1iK0Ew5ABYKQ+Lehii/MnyW8EBtLn/KRdQau2+5l/WlWQOhwQ2XDBKzgB3YUG5VF8StOEBxFHkCOpgDpJ6VlExD5Fvu0wmwkDq5QmUWyDQtudJqk3TfavOItnhoAnsdQxs0Z+AjSZRqRAVbjAY0UVEg85+L0sdEZAs2RB5wqBHb5IuOyCPACh2//yJvvNjVT0kGHN85VK8Q5gjq57bSOsyAWwjPs8HKEm9Eg5so8kk+loizlcFOO4/lgdw6l3IAQEkljkrLVW8PMzYRbC9MrxqQMiKzQnC4hCs+sgYPSqtuapByaPoARIm9vi62T4LgLSchAKaB5QlHLG+5iLmgcv9ENahoJ62p1R4augyOknCI7F6pOrq/E28OkpPqv441+DJwpNqu2fLbzv/jTYZKHoHwP6EN4IojCqmBHPSrwzgEsO7z+WR6ux/U3FMILJCU4LOOAGt2D5WR863wI6Se2HWP6iHz+QHQhC5EKLdA1ZY7Rj89xvF/3PHVUQEy6AioJyAUbDJON8AonIsEYCZFdghiumuPrp/oduAc1EeIu1iw8WyLCI2v/1YzfWxjIzBhKi0tSGAWgoE1Vf2Pylu3/bXLH0lgDI4JjoDEUhVwRQ4SdXREncU+wiw02EC11CTdnST6/YKEDZDbodXGdWBiprvBI8bwMbWUFYReslGHqwB0PouwcfdTE5IHxYgvKaFaGqf4bJ8z4bbgfriMzEJRoyrxbOIvscbkx8YKD187/A7bCHA5gCO2H9j++nloHZdnAdwTUC9+QAVgOQEjM1v7GrUtpPg06oMLC3zAHo95ibMQOMchCGTHjkUYmvbGEUgxeyp6UhpjUaaQROAOMg7WPUZ9BNUC26/X8uPsmqp+yAciAG7B4iKm8NldC+G+QxwBvOqLr4D5mTYNXTufQG5cnfdEOAj9hAg9QHUMmD9bFXeuYFi+00F4EAeAKoAM6RQkpL1BiPAVL4AW5FZyWViDpR+Yj2/xBETYDiwHNnk5262EdeH3zO00ex08kB0eRFshJnpDyhOgJQECcMM9N51sLrOkoiK1UWi8gg4jboLp9ZTyylnYBwUEVxQTj0GWrzrjSgr/7hQIwoB0vLlI85/s00Gyom/NiMwzwswNf9W/quhANf/XYiQL9pYaVR0tPciJyCBPJcbSLiKLfzICYzW4/HNgxxVCgTAYtLQbsG4jV55sESgFb02HmV7bgc6JTLrSS1ZpgHIce6g6jAJ8BnlDsFJ8fiTEoSkzvI7B0QYq3AP0D4UHIUT2n3g3bGksRMAhgDoAvS7AEQzkLPwg/ZgtX1WwHT/tv9PBIFAzuvH4A6AT6HBKCfg1nPTkJswVAgPIZpvfJR1FwMndBRFUUXyDMHMoIjtfpBzEE7FDjD41MtDRLa23BKqWc8obTsdK5xV3dCxKEcULQuIs+cWIiDy9TyOGHx45kOAdqZuCPCR2QHYtwDTjEByAHPlP1b4WPGLylqlbtvXmwmq2pTZVwIsCJAELCF0bToBshET3PygycfyregzMGpNCpvPa9WlQyiVKAXZwAwBk8jMfvFQwrCQDhJ1B0QGxL1SY+Qc8jWq645UkJ1LlEnnigs7qX4Y0AOWIh+7vSK3uRDAHvuo0kf3YvnI87eBA8DXgQEJgKV3th/yAC1Gty/5aPsE6l5jefE+AFNa65TpyOa3LDUkCKW7gMfvYlNR31dKzfup5J9yDfXUbMkHbkGA0JCOs73aiaiBb1xCvV+s+0CkSCZAXmy1GZyj5GR8be4KTWkLcx+VQ5zDmAPxTOhhibq5EXP9ktRniGFG6Y8Qg72+7ejLbz9/m58LUMuA29uAfMlPZvupFdgTReshwISfU3eXzFOTe1T874EunYABq2jogUFfj+gAzgBosW7XVRS1M0DpE1C6nHiwzIQJrDASjILYlMpE5xsCNmp4AnAitJlyMCQsoBsRmAYnHnkMQnYysVvokcr4PHMu4MhxPNj5/hoCaLG/sv+cDMyXS9n/Rgz5JpdYvgwu+bkdS5MBHkttC+Ymyg2QYvrEnlBgAoTO5ItkWtj7H51DJdkEwVQ5E4m2TCyNu/z+zWx01nFSTrmdXpmKWpm9b2CFFAO6Q3YKJP2kHsIXzh02Hr1IZzCTwDsC6Mcovd3HEn/6tHwUOIBU5qMXgir7X4G8HSQnBct2FWylZbjTDgxlQB3Ti31Nwo2n6qJb8Ouq8whKfO0GCYeh9qm23qvKVOKwALdT17fEg/qjcwus2tH+JibsJRO5dZgSnu58QEbSQYD78XGpt7w8aNm9pPGHA13bZqV+0gkNrj9SanVd6vu/cUpPY8N8D036uwP4qPPfCsqA4oUgNXtvW4Fr8k4QQ+KDTBQYBxelFJbf7IMq1N22uANOqtGXl4lEdhHl0c2FCO1644TeODRo18/AwLgWB7LVNyYEPSA4e26uq7iMKF+BTiOy7k+y+qTYxoHEA1wp2ygHESYIu8DxRL8nDPND8TkD7QLU9U4Rw3LEMVi3FX3fnQBaGZDtP/1GQFX5pu7JNeiQwAI5f20OA5RzYLU1CT6I9SvzdyoBhoCorTdQ9XGIQMnMPGjS5YzDiTqMxACvgyNKJPYqCAjQUd4gg50n3dghawdRS6wqpY4HpwQjXB8Dpw/eHqg6KiiJyV6zVuzHO4oIdMr5jLdFlxMreuQ6zPJKJOtp+R3GAaSOQN//r5KBAejrHAFeT5+F/S9K1xKI+UsL1TbbFgBGlQDTSOStcwGu4feZikAH8F5ZAzdR4u4AEOraWC1kfgJLgNBTkXCvYN7Abs85r7zRfi/C6jfy4cGvVXnG8s9c1xGw9p3IWL29gwgch3mGkdLPEcbyO87fLhyABbyu+2+XyxOCbPkvxWfZ/le16+UEUMlVyY9cBAMQiUKBs4YiwgmYcmO+8dVhRCFCISgcJgAksX+6JxpUbTG4HLbdxjXgMB+dN1DtvJskrIgsHDnOgdCdI7gPeHcUYc0q9VyCsOcCYgDOHLvEBnPEgFsFzmuinDl2EvbYy0efv92XAXcwxMnAAuym1CUkwFJfIgi0xLpKgM6gAC8CehmtCBBSVswTqFhWEREO9GELbz43uo3qQPyA8fE7KRiTVs3Ee5JyuYEpG23bce0w44HmCW2kknZwl2epCO5Y2KBiYh8qtOsdXedTiOTFuwAdxmhio22X2JE1wvGuIDr2TgCuFbh2/gEJkNrLWYHG1mflr0osSAKteRjnA2CgYahl9J9QCSCCqjdJxd8E+C6wjzQCkT2PYvC+zS+E2bPr5BaEk+jF3gZ8naoFq3cIWraxg0qEGsCjXIHdp6fm1i4zqUWqOusCZo93hGimlR7ifeVElt95/tvZAbye1Vr9OCiEBJAI7CYATdyeyQAAzJWDxBOKNMpXpfCALD5P+EkPB50EaIpRXbtN3WoimVdvaAD4ELTC+hp7bNYLUKtrG9h1b/GDMCQ4t3MfnX6AFq8HjijJsZ48BOseA3qkOa16PSdCJJmvcfY4RwDs4/04BBgT0NGQoW2/E4CpAuyqHGT/tynDGaje/mPdv9lkkyfougEIHyIywAlBmYjaw+lVAgY9AZksfPbfDpbqRQSAo9h+FALIfgFM01EfvbTwISHo68d+CAXEkCx6lQkAyxGyGFn9XtmS3UYMlL7CKzDOqLZSVL1MWPLFZggeY9+Z7I4dI+29/EvVAWzgxrhf2P8cX2v7rxOAwzyAidPbMfybg0WugBN3w/gfwgl2EC4bD3kGpdiiStBczAzwMI8xEe/n62U1miOEQO2NwrVr6AHYW/o2uM2A7JBF7zv0VV+rJIO1d42KNOw5tTOZdQFHlH1MPLEjOS1t/BQSj1xVb/lOANUBqOTf5gagGzAp3a7rOWTAfxGkUAFQyj+qEDhiKI+gUx3gpCOBHFVa2fcSNijrrpQ68QKRipnGHAAvE4oE76hKcCRJCDZ96DQOlQbnrHLPjo+sepQLMUCs9/7pCu/A6ADmQ4exNdfPvwdI5SDG5xEhACQLe85g+Zjzd7QqQHUAnYYgWfrLj0V0AjbbvP0FLkFWCHzXYPry+SiDRKGN3wGYrEYMWpGJnwX8Uy3+FDCVA0Fwl7+HuYFAQaOQJo3UTqzuj+fUd7ZSAefqu4Dx9TzdRcw4DSb+Adi7gOzvq92HF57DDmA5nXYCaA4AgS+mA1eHYJXe/IhojadtHkD/GAiCFC23XV5vgEss+gSh3HbGCXB+IcjOK8ArN4Gs/dT1ZshHoUcGKg+WrkuZArdudWWlUlSggRgPdm/dZ7Z9MYQwQxqjfMVRZZ8KATJxvDBnAONk+z7LxxoHwAlAOx/A2X9WfBMWZO2umX3RMhx2A3oyqE4A1FxWDcqgrjb7gBMwHYNlSASdg9RjYBJnXcXWjUAu8abKjgKwsQPR4DFA7XUf1lCD7eX4uAYoHVeCR5oBYJ90WlChLLPdd4Y0bBCy33oRdytg6mX2Pka2fjaRWckmdBZz51s+9vyd5AC4AUi0BocdgPhCD8oTjHoEhpl/DAPIXRSTKpt4fDKvPSBRHTjiBMhZWBXsEAea6lDR2wMsOQl3/IgQzHX5we7IxoEdIPxIAGuw9q+FCSFORs5ZdAb905KDkeX2uQFzno6CI8WUOP1R8T6puiOg3AugHMfyu87f2c0BVNXfS4DzCcBi+f1rvrbLs0RhbXsf6N08Qh34Cjx4XPvQzDU6BwFOoAf4KBk4kdSbDhEq0R0H9egcfQWm+wUDzpNJxyG4ezRDCLGyx4Cm40oQziX1RiQyC1gFdgXI014enFPv2XPbJKA99k4AugrQeSNw+ZWgrhPIQDfKfqAbsJMwNO3FBPpWnYCBaAaeUn3RTVgGOTYvuWUCGIFi1oc6Wt/LPUwpfnM8DOoGpcE2gsx6dr3vTMYhA4PjxVl9/p7tWiwo1DXqMKEuHbTk4r2udp2UWpHuNKg7qq5CEH3c9bT8y+fvSg7gVH4XAC1/8HLQrhPI1p8sf3oUrPzCyqucgVHR3j75lu53oF2HOW/UHciE45pxvAXsWfOwioB2m65TWfM6kCYy/BKIw/2OuwlvzS2wuoSQv7MmJ22z6/GEkvcShzO5gHFYMFLjScU+oOwvxAHMlgE3AtgdwK7qBfD8MpBm/znj75qCMDnGrwwzai0ah0I1t2FBHTzRNGHOJ0jQvwAnAJY8Bi/1LYC9g+xEFiStzDJmh975vgIL4lIW3hHFEeWOlbYHMHvdcyRiieNpIURIENA/z85nTCqaxKaTe9NEcew88vxbGfDjzn9nXdfXoQsQSAAagJK17lQFVJJPqLl8O5DJvqsZhPnyzSD1cwNMVYCPWewzq65JwsFNxWoDgvZgrG9BHoPRgEEkBkcg1/uPY3dJLuh+ZhqERMUgAvc8ITQTPU4GWpWeCyHaPnb7QVKP7k2196S4fMxpa9+6XtKhg2rMvrySBX9/71qicGMnAOsAsAXYVgBUC3CLuVVnIAx/IAP3CrFu1x9CCDPr1hUkXEP4YVTfAs8RRd633SQMM1hl/Dq7BU1PxkYmQyT+4YYuokc6wSBRhFGXdXv6NTDGRBGTTQzgx+zDJHocsGsXrNbNzCt+7GAkiKeqAxFJ9Zbn6ycXExHQ8rt3B1DmARTAp/ZffEloiqMzwNjaiw7AekLeJytzywmg6or8QRAW2ONDzC+Sdq21FwnJ5gkSkellRsUphu9Zf3negf3WwA1A2SEGR0rFAUnCKHdT6fYkIYTXQgQqLG5MLo8JCxjAjyAIysKzo1CZ+lEu4VEO4JFz/1UOwTmAfOzl95y/ew8BUhIQGoHMxKDtkFQVoAqAcQIq2VcdACp1IZV8ea7VV6g8txCze5CEwQNcH7e4CHxYlZ6IHMw2eZ0CXSG6dJmsXrwEr0sfbRrYT1D5GUCOHUH8XTmujo41tv6xRXaADOfFjwlixgU4ktiGucsleGsu95stAwYTguqYA7IPHUAiAHQADejmrUDGAaj3A3AfP7kFGeejXe6QAWTo0xeh/Qag5/DAgpfCg8gJiAYhCUY1r8Ak/goBHggBqOtQEdQ0MZATcI6jEp0Gl3IoCKEeaKN99zM5gHLo5T/3VLdALYqhR4q9r+8o8Gh/vidOgctzmOzkm1J1fLaGfDwZ75turcAfnwmglQGTC6iWv1QGqvLie/62A9vP1tqryT+4T75NGLsPyoBVM9FRuBKeSBASaZjhxMcqzCnBbHMN0i1kQmrnsLbUOYHwtWBKRWlZ2FdQANyGzog4HgPePiHw9Vu1ndl3fE0BUb3QOH/gEiYz949S+x3IHNbosEyTXWfbrQrw8efvyUnA103M30ICSwiVGIAQWvJN5AlkC7BX/gqWiAxEac928E1UBSowvfXmbsCedW8kF6u4sbUHk3i2h2AybBhm4uPwgtWJPZFdfxzEw3DBNbXMnSO67qJuXcfB9viJhKEU3qh2kPQ7Tgo2jGCnosmi4wA+4fw9YQhQ+wJqQnCQCzCkUMy6qA5E3YFSyeHijVJSuZCy/nWvamnxOOVx4Y1R3YDAnmSNDYW4dWxXYeu8bWzZGX75GgYuYaTuQxC6DEVMPD3gKb8xVvH5c3VBX2Pip4UPXTAf6MCbAbez9t24vrk6RXJRuLNNYgpzAJ9w/t71lJOADfA0LbjE/y7bn3MBocqneF3P2ustB4CarP5M7I/QRNUj1Q9sf+gEoklCZM9kiZHUWZPH05W+VR20gipFPEIMx5yCDnscGUwm554aLjhQD6oRI3fRV/y8dqIUN0MS5p5VpxKruj9mxwH83vP3ZgeQQoAW/4uWYOMEMqtEbwdyuYF8U0yMj8oILFXDgLy+FxbMVAWiNl855RbPaZ1CfRCq34A7/Caz/u1h+fPGLsErXA1LkjSYVmh3joCQIqU+ThI+NHrDXAApJitqPwwQdhpCA7bw/tgH9q/PBFR8MnegyCapPeUGOu4kCg2WT8wEYJKAriRY1Do3Can4P4PCdvpZAO+fENxoz3v2fpjwIyu/37HkPurNU/0BJuPPoBFuwwCnM4GI7XTXvmulVKDzcw/I1bxgYB8H/ryVr8AkEPQBOyaWHtHUsTAZj7OSDj8P8gixawiIZPBK7xJkF8KPwwJ4LnSNyyeev0+GAKkJKMX87e8GYKwU+EpApPYtbq+KNZP1f0zsP1MqrByqwV5vm0ziKXIpw88CwcE0aj+WLbhIEMcBnzhWX8+U4otS2GOJ4UW6gIhARtb9kCMY1PGPOoK5F4qQqovkLgI+lU97TqStU6HB8knn7/NJwN0yY9//4M1ATtmz+hq1Dyz+TAmwC2YRJhR7hA6jTtxRIIqO0QBdgOQHEB0Pvo9KzDUo0oN5gkuQbkFYWQ3c46TSAxkfbRr0gdpFZOOPq92BudbBG30soD0QnQM4WDmIHUC79kQSFtBzZcAA6EAQ/P22sy6fdP7+9XTa4n+YDYghQAF3dgNzswHTl4gn/hQyUBN/qjewNh6dggTzZFVAhQczoQJGXEMFR0LxAxO+oZvsYQHUcxk4nOxgnTn+U6sGDpgi/ozU9oUtDxp1elZ9qNod2z0MASrpEhgPHLM91Y6quxBm7AAUqWxjYPnk8/evKf73SUAVAiRQ92YFauD73EAmAaPSqnEIVNhYWdq28KZL0EVNQX1rHVUDjJmOKglRLN5JHlpAWcvecxL9dX7t44DfdwlToUSQXIus/FNIYr7SMKHyT0gKqhg9VHdJEj37bis9NQwwLqdv/3cH8K+cf2BdswOwbwYSFYGw/790DuaLktYf8wc4wDtOga0/5wK4n0A1C0X9AWa5SACa1mW1HuJ9l/H3gGkDWoUM9vhzoD5u3Xvhi/ITI7II1x+w848G+uDlINFxu0nCAxOVlC1nh+AnDXnCGYcFOO0XQgVTATjoAOD57ASQFD2FAV718fXgOE9A2fx4WUsUZl505cB8+9jqT3xm2+w6BDOLy3f/qfxCmW9QQw3KBZgsv4rlrYK76wvj8w6ooYqhzb9ne76KEaD3sxOwFJBKiPFCcwFvVAhx4LjKfjvbf2B+gCYJAOuwGnHAAUw7CEsWy+/bHQC8DkyWAHkmIIQA5Aoa0OfzAL6lF4ZuryegJvvIUQRx/h50ZELBh52ikJZ84Ri6Hr3XN0CM3PbpuYf+ul5Y4GLwHikNuvz0sWJCiYDvyKKj0uqcDMDuNgccQFf1C8kPwehdmlTvQ5UDH+q5Y051HioHIJZRE9GeA/j9579rQ4BcAeg7Aazni94AbLwZhAP14ZQ+AtnYg8ookn0qNFDHiZKHUA7kWrtU7+h8WFY0bRo79bTMQGIcyBT01NsPEu8vZtSf9b/nUoTH6ChpA761uOxnekCsVzOR2IuIwR4frqXTazBFDsWxhSFCrNTOQeyBdxoPikCUa9DLIAQNqxHqusgBbATQQoBtZaoGtLf/2L/r6757zUCiLFicQVVXmdArrgHZlpN44rNRcCYLZd+jun9+KHxt9VEJ0AzJoJ8/iGCoHUqLAUOXguGFAe08OJ2Sc7uzGLz8PZxLCBU7JrhhiHHABWjSyOfuqLYEMJTp3PqDDoD3r9/5UMvvGOiqX2B3AJ9y/sHdAfifB8MfBcXpwZkkAOTqxaBx1r89cL2NTSTWrcNcAADMgTGoAIQVAyKLmbDgsd2BnGcQjiGO9ftgZtcynzOInYQ6Bja2PNUFOIBKx6GV9miooFV/cOzAiuO5p3II1QHokOKwA5CEY1U+Z912aSjOI/27npY/sBNASgKmdwPm7L/rAlRvBAp+LIR6AHqTgcaOIN8o19orYvZIuXuKHrUIy7BA6bW38i5s2HdToGWTzN+p7YUPUe1VHm60zoIkUF0oIb0hLiAP/n78r+lKuoEDJNENPzoW+pADECU4TRAFiHZMmLBgygEooLdjV8DLGYZp3+UPnH/INgLhLwQbMpidD7CRCCbV4B0BrjnIDng5j6Ao5UDd661UDUOmpIeDH+AyY/tFt54Dew0X5qx/ulXBNdVjxTbZAV5kg8FzmatTVQEFTk8GTEz5u3bOHdl5RTT7toNS4gyJtOPMhxn+OjPIDjmAGOD+haQ9EA+IImwDHjmAdj+WP3j+IWgEKra/JPbaewJNDJ+dgv35rwzmcFJQshz1xaIOlLYfwJEIk4or33FogXY+r3ONOwS8qtQRIGH50Dmo3EOfFLT25fsWEIsGsT3PU7fB109PkwHYTc5XcH2cfVUIQpVkPZwHiN1Pc1EFeOzcvGIbhyBbjS0YRyFDPeOjHYAHv52D0NZvfy2fev5hqgLYNwPX9wLugIO3BRd34EDdgF5sa6jspsSHlQXOAzCAEYg6FLCq9xSln1TnQ12BY+s/tvz+GG249gIBGADDmn/vHJ3wZHhcva+06cPZghPqPkhA9sIDQ0YvwOK/OAewnvhYUf4Ax0UNCzKZ7gRgGoGq7Uewi98KQOBXIENJ0PQHgBoai06qbxSYXhiSQwH3wg2p6jb558hgVum7jiGoLqjynzzfUYfQcw/FMj+OFHrE4VxJMP9ehw5WbRzQuk06KmeiQw/vKPx5oxCkqv5kv75VcOEIXD6h5wAemwPwpGfyB9V9ebLHJOB29uVfPf+IqQLYMiDW+LneL5KCWBmISoFH8gBBmNAHNKs9gsL+naKIYrE7tl/afQXIkbKP1h8lBTbP6vMBUiCFi47uQxW95f5tOuo7G07wL+DwN+om+ErJbmomoAIWkM6LcADbzTNk4y17uy+KyGgZ5QFm9y3favm0nQDKZCDMAcDfBbQy9uewAADlmntUeIBAGuUBuH5f8g4dIHeSe0mYRQjBpb0af+P5Rw5gBPbR+qNkwLAkUOaBwlBVYI63EWQCFt2u7ZAC5wcOuAq2s1WRBxUMFd8710L3aLSPstwjiz9yEOb7Bd2Jj7H6qPyFgHYH8K+df1TkAGhOAP5ISDf2D0IA5wx0SLDfnKDcZwYXtwebPEQv+RerfOsALAR2QOEflRCcU2sdzcPSOkh6bqC/rgv4YTw/mSeAee46XCiJt471f2ozEc21Vw7Egss7gmMAb2PRkQk9N2vN273g0GVs9ZWjwGXoIDIB2BxAifdLjd9WBvavxO8GkPmAuPwXNgkpyy9aev2LN9FZlPQZAdk5AU8GjYDIlaADwP6AunxEFu1c6i8cdHq9dwNHEn6szGbgB92CR1xAPR78WKUClwW+AFe2x37fY26iF++XkC/cRsy1j4iC3YghjwDghxwAjS8bOliSsMRgAd+u35LDVmpdPv38Y6IT0DcEpZ8N2y5fTAxSXYGz+YCw979Yc9X6q94F4MODBstCEPPADknmEWQQAXAW7EMXwAMF5xlMOoRpwB/OEwhFd2FDQAZB8xQm/ZSb6OcEWi/+GNiW2F8EwBmMGMIoQnn0snC+ATmAf30nAOwE5CnBQAZF6eGXg6re8otCgmSftfn562OugPfLjTKFueu/+/dIJNHWUQOSAWveKqoaCGDXoRs1F02Qgbm2eq2s+QhxpXad9UMF18dDBXQEFdp+TUXlORibK2PymXAhX+9khSAC8aiRSF4z9vhDHX5MFAiqosxEHvScXEhAY4mz9WX7/d/wtWFW+f05vDNY/tD5x3UOIMf6+AYg/LWgFAqU3wUAu29m/+WuwB4ZOMBj6BDlCvLNFcCMbTzo7UQ4gIFEGyyWsLQNVyDx4QYOQOkQRMzsyUSFHpPJQ2HXvQsYAD6o0fNeKsTZlw2nCw+s/zCxGTuL/c51ZuVZZ3EU4M2eI3mM8gt4TxrgrYNKxDBa5q0+EgqGCzsByBxAfUfAdjJ6EYgDvnhRiCgDGhWnacJ2HcfxPjlonQQO+uwIuiW+/FgmKwDWfSiAeYDPgfWY8ns4DNyCULH5sAM8wjCB1wFqdxrxhPXvZvdji74fWWT1LbDngNqO1aAXxdxo8SX4B2U7vD57Dhvz1+0ciVnws9Ph614+4/wTYQ7AvSLMvAtQ/UKwfVGInDrsGnrgVWFovdC3NQAAIABJREFUg6hL0PfLZyZUcwT2e1WCA8uYypLPVAD6Vt4CWYNsDuyHiaMb44/cCJCZs/1e9brkMcg1xI7HWloFUAUqY8uFks8ouNsmfBfBhAMopeNOjb88W7TzDHj8rvx2JhsWWELwQFfkBt8jX+fyh3cCiHIAXA4E218Ayu3BJiGYKwkl9pUvB6GfFVcEUSyPA3XQF2Be/MHA058r8Lp9AzNWHiEcgV4vlwAzCjhQfJmTIMfy1OMNEniWcqxVLZbbgJfeLYAgMccKCIZtdXzsvKY7yUgBXX2HA85BvjvAX8tY7fW1yVBB5i/QGbTvtHzm+SeDHIAvB6a4f9tZTw22IKIyYK8qwOsoL1CHPcT8ZnBQX0CDoH97kB+gDGrYQuQKZtR9ZptqsDMg+w5Dx/Xdfbox/gSRBDVz5SlcjD9dKfBHm5t41Ak5trF0sPvQqafLbcw5AKPeNKMR80W95Jw7Ro75K9DhuSL4IWDLc/7tuNbbrqflM88/lacD55eClqYfyAGU14DLEmB1AtvD3E4avCLsQCJwP46c/lvOYRU03B6z7oY8MHYcOAKjqvPq3gf0/HHYOjtyCRJhkRLr/ScThzzPYTLTzzC3CUALZksmcRjSTyKqY9Iy2X044QBA0fmXftC9qERduQ9R/oATk5Gtt8fx39WGCqD8IjxZ/o1KAPmHQcorwdyPg/jJQdIRmORf3BlomoGqsyBg8mzB3ChkFN6EFzYZaId1MLlIALylIL07aFfYW9cjGExwjhKKsK1U9FjJPQHpWFtup8qVYUJNeQK4rkBNmaBQwcw6SiLi4Ld/BwlBUX6ThITABqLjkptWaH9upcj7vodyBO1KpdUPypajbZGcls86/3ROAuZfB6r23v5SkP9BEJsErL8VOGgAqgMumApswM2JQEjuWZDmG6VyBKZzz27nCMLNAdDuwEN4e7TsSuygUI5AhgqPCAnmwD4Aarn+x+YIDs0JsAN7/9TtIhTb47sBDjQWuXCFzq3seQN9GzF+u7xO5hi0SuNxvdpbEk2qHtl6f13xtvYYyx/ZCcAmAfEnws1rwrD2X1/80V4Lli4jeGX4IAfgHIFqCFI9AwQ8m/2fcQR2GwtKtupe9RWIY/ud17iy2hPIQyokE1dAT1Phg3Apg8qDV3MinzC/EKh4cSQHKhVswRPJKMfUU+8gPAn6B0YWP3QPzl3pUKSRDth6SvwiUaQwCbfF4yZCWT77/DM5CUjvBDRvB6Y3BO1gFu8LKE0KNd6eJAOX9MuKCkk45Qw80LYlUeIvr4P+QYZFyTuYc3W2l0DPg1uqe6lw0ENjmnHXlRNKSsPlthMWfvpYj+w0LHaX70N0vSZJdtBNGMIJwZm2ksQgGmvapB/lPjRAu4oukneaECy4y9iQtv5Atr84gnYP0nmWzz7/rEgC4lTg9lqwBK4A+KU6UOP5BuI6wCNiMHkDNNg8PRiJQalzAnm6TlZ2pd5+mY3xWZmPOACtwkN3AKw9RQwO7L7DTp0Tj11BMdV9qFR0dE5rUc31TCYSnXUPKg1IJAhIBFJVahHuKOuMym7/bqQy8zNgY4dAyu5afi0Z9cMC3Na6ALyO5XMqAagkYPCWYJfph7IgkkSvG5BLejJ+F6XEzNYyZCCGN+8fhPjp8QrPoFYkhARm7bM6b8kke0CidjLxAE0FtrgSoZy9aH9vrn9uymUcDBsqICfKkpHzYeurANlddpAsyhN0cf6BygEnASX4yZ53HQT1Szirb5KYMF5cCGCJYfmj558TSUCcAGTfEdjyA9uBsB+gNf3YDsB8rB4ZhLE9tgDTkHY9ATzk2YE8zhFYCzsCPDsGBE9SSQW2OFygHEbef257OPfwvJ2E5aGkYL6yg2FDBZxI5ikVD5cF5zXhBWb4RagUtw9b58MkIc8RTCjy+/pj21BFhxyt38EqvM4VJDzwdS6fe/75gABK/I6/FORzAUgI6aJ7cb8nA6OKwgVYpR+FBwrkmRj2757+9hrdW0YgFDkB8x0qSMsxbVCBD79RFjuLNFEFlyovIY81BHtg4feA0PsGPoe24pFDUcSiJ+F4YvQxe70fopQ2dgV0vPDlIH2gN/LJZwzKergduwEFbusQkEhtWFDuk8wJkAuw14Ak0v5e/s1MAOmXgV8HAGNIQD8V7nIBfmbg3hDEyT2cvWfAXrZFsDRQ+r5+VnelzGUw8+C0/QAGvEafLQANcZgsOJ+bv0McBhglJ+Da6+qEFc6S41E7wBwmK01qLT3L6XkHcN7J8p4lu3zPBhWOUby/X8WwD2CsvvgWIAQgg1Y5ExdGoAp3SoazLoEVvYUG7Y7uy4KE4fJ55/dQFYCAL2cF0u8F1sQf/VIQlg1Vpr/zHgADOH6TMCq5nAw0o/QMlAjwipR6roBcSjVdcHwA7TTQcxlLw1t9FwDwNNgBho8oL9qfCnucK1AgMkQZWfhJV6DyDHWZKMfh9YS5AVVFKGosGqgUuPk8cQhgHcG+HVQ+GgG0MYpuwRLGelr+2Pm1DgFsyhxVARDsOgm4X4J7PwDYbfGKcGvRm9I3WMH+BVxhPkCoPyQK5bkUYE3YoMEWA7kX+3uQmOOYcCJyEiLEAPCqMEKGQMPQgex8x3koZWb7Hln+npXf1z3KFYAaDhwJ2/UplXe/GkzqS6Q1EwIY+y5fL6YtfSKAGPwYBu8GaSOA02nrAsS5ALYMmMKD7UthXmA7kX9V+P7Vq7IzMYAyY9mwlu7QtvO2AvjkBDxJsFLj8VmpESp4rp66otNottXuMSIMALBLYtlrUkqYQDEmB0MTQ7AL9Z7qUCQj3214UvmBfuhgyUHnF+oA707o8bZfHdsAlSoAPTfAAIxJJIOYqhQRgA0pgFCxwkfhA4N/I9Pl88/vDQhgAy+WAfnVYNgKjIk/9U4AahvmrsBKAOkNQumGlb+L0+iBOQM7mi1YuwMGJOLUvxBGENdXaz0CuSIX+2Meo1DAQKtj6ZXi8zTcQls4UIwiT4cMlniwb36k8Hy+rmsQquavNx3BWny/rLs+zBd4wrAq7hXXEYprUEIrj47BEtvI0itSSGFB++7FFShiWP6t8+umClB/GKTG/uwGUPlFGbBafpoIlPMB9SIGGX8LCN8PgOvd37IJiN2FJRSvtZG6M3zaoItBnNdU28xn64cCKvnmgQ5LgtKdIgef+e9dCwzOQV1fuRU7MIk8REnOkYhImvF3Qgtf9ne2vpMY9MqOVlsRir0nHmR9cmAiYRKT4B2QCcf56BAsYayn5Y+fz+t6em9S+1wFSMqP9f+SGMQXgkQdgfyeQHgpSK8TUCUJUbkVYbjYXABL7seKDkpvVD0CuwIwDtd8PIjduoClwV/6t9tVeXrCAKYpL1/D8fyAV+5jIYZRWFk1sN9FAXYfpJ3wQbsF4QA6hNGz8AiS9nf+ZoI8LIhRzUfOIYjXZduwdQwF1Og0PFn4fRoppnXLF+wEsM0DwNmAhQAoDDDvCtgOZasB+8FLrsDZ/M7U4GL53ew/tOyYW2jLGxCUDUcVF4ruQgPlCgSwndXMxxY9AOgKujB2MXYnrOjE4+4cE/kBp9aySuFjbkdqjwX8cD9l73W+QJGDXoZAtSodvSwUwWaBR/vn8dFAinbcEomy5Ug6PUfAxFMIAJ0PhhD1XECMy584r+f19PpiCWDrB8i1f3QD9V0BOCdgXA2oIIjmC8gkIDiJMEkYATYCfk/RRwQShAxVqSKiQK2GbUSc3XUJZOsjMkk2O6Ya4QlEA9BEGDBVafCk8fhSYb6mQSsyAkoBFsFhXx2OVn9k+2PyaCDT4YICJ8fxM9so4kiS3sY4g1/ts/yJ19fXT8v5YrP/rRFoAzV3APZyAWKSULX04tXh3B/QqQI4BZ0OBY6qP4OG3EfpAOzG8R0S6BIFhyTYCcjHZCLCh97bFvYbgBePUghFEgfUv5la9+0fWyoUPQ+spp4slUvIy4JJP9rqd5wBKPu+FZUklVprcCty0ATkVP0FzABsxLCeli987/ra6eJ8lQgArH8lgEIG21fmkIBfEhpXA8y8ARUedHIAxuYfJAAkEA+dNGw1bPLyUKnbnjYMgTMGDT9en7lXQJEROIlBqOHASvG0AzgBuZQVI5DNgj1MBO5ohqNMEoWO/W0o4B2AdzPKKhtnEHbrHXMJeL06Zrehw35doiQYqb1yCvacNgfACcDdMHzha+vPL5frjSWA11uNf/8VoOwGaguw7QfYL4SnCZMDaD39oiRYYFh+cciAUij5QRJAE+7BiiTAysvntkqtgRw5CR9CYHZfHgtn8k2GAEWZOKCx35vuyCDmd0RgkpvC5vecwcSsQEVQBkCdY5S7zKDh79CAkvc4UBnAc9i/PaDLeas7gFePK2CzYwitPhAoKroiHU94jRiWL3pt/dnl8nQXhwD4I6FRI5BtFEpfGpN+/ZJgfeBYJaAMPyp5IhxWb0EUJsmHgx72hay/BiEeNzqGWh6QhQkFPFlU4HZU296LfJ4hQcC5ujkChF/eZ6IvQIJ2IgE5VvV23RbcmnhGCT/1k2EIUvu3tuq9mD0RcGzxWbUdQWR3VAiPyUa5l0YAREC1XGhdEB57+aL3rD+zXJ5uT6fzhc4BQDtwdgL7acqvA2GzEMf26heEqtqXGDvIERgXIBKCQYnQEQUafFHi4+2tcto8gIGryQXwXmW/pi5IV96F8HbsFo7kCDyN7UcLymoRmcQxvz2+2W744lJBLtOhAA5ivD+WCKpiypZfJBN/jFllTyDXoLKAtoBk8HtwewehtsHviODXboHDFhsWLF/88+tP7QSwbHkATP6h9S+xP1t/3SKcvmjPAdCUYdoeByWCpS0fEAKAXhOCdwt+aCJkG4A81AnshZjIVkugCWDyddTPZkCX60fnQS7Eba8gnY9zcCZiUTml+jbufzpZRKDEI3PcHOUetDuIQeqBHpBNVW0kGPs3hhwFtF27P905yHG+/WxzD7xuPS1f/HPrT1xcnu5OF+t1IoDcD2BifwQ6hgSqHEgtwjXDD+8CiKoAveWDvMBxoEckAEBy4UEhBVboTAIuOeeBWgaVpY12XOMO4HgxQWEIwJG/3kt1/yngmr3B8cTuQJOMeuOvpYZ2N6zNJ5WddBgMMFRlQxwZuHPlQFTS46GBU+fJZh/lGiJX0F/uwb8nAb/kZ9cf23IAmwvoE4B/S1DL7HtnoJN+yu4zMRTQ0HITz5M6C3LoEcJwXQBkVvEGZrweUuLqCFROQOj9QOnrAB6UFflaG+iZJIJwYxgyRGD3pIODX7kGSShh6c6SwiG1f3Q5MFb2puLevvMbeXu5A23f50MCD352Bo20EkGmzxsB/OjFxel2J4AtD+DKfyUHoNqDtxsTOYIcBuwAoFmBJjwo4ImqA327PwRzQBxuP6P2EVjztXbtPWiMSPjxeROJ2EDHAqK5g1ZXLyTJZMPuJQC3y9Lba2AV5rDHWOlQlSeJ4EBFoecODBEEnYU6BEBw4/2aVPmOVUfAd+0+dZYiQNG9lOXaFSBZ2EQkfm889k4AX/oz6w8vmQBOy3rVCKCUAqEBKOoK7LUI5zcDmRZhsPoWEEwUTVkr0TwhFHDgo0SeU00gDwaf0O5UtAv6Bpx7cOdWpNPKkh5OjRjseZ8SBoz31ZOHYrC70GLY9gsEOjULUDuCbihB8+XZlVg1Va8wo9CkhBKgrAxcrf6oysJBwPFKWFPBDO28fWLga7XOYPnSn15/cFP/zQWcLk43iQD43QA5CVjfCcDNQUnl9y/NVYEM9qZNrPTqF4S1/U/H8I7giAuIgdzIxuhqlySyEstYnQBqEn6ODmzBslOaNPCgrsQ+gVmC8S4jDgX62+rjJlLyispgw+9jtyYioJh55jgFNBwmoN2uahoc36qnBWkP5Eftvtn+ES8Aad+JY31yBpCw3B3Al/3U+gN7DuDidLP9l9qCg1eEj+YFmJ8Vy+BAd1CHuQgJXFlvZP0tcXRJYAbEodozMDKwpxS87wgYzKGrCEuZjarkvmKCUWTn6/7d6oFXW3NekSj0oB7E8J1ZgAg4RRwS2CbcKe8I9C4D933q30wafLxCjk7VSfFnwoa++jdyZutfPi9f9pPr919cphzAaTldLxfrXg7slQTxp8NMIpAcQB0ctR8AlB1mDbZBpPIAbR8P8njdvm2YxS/k1FRfba90mo/J17Q/tEH1oIGtnZ8DAEM7gwlHFVKmz8H4GNNWZUAZtjrr/cu+KqnYA7sHbL5q0QYcJfZiJfeA9jP67BU0d9AUM4rZjy7HqscMGaht6n12Mwu9wiuCQcCzU0HiWb78J9fvLTmAZSOAy9NNIgDIAVA7cCOH7dBifgCrPr/+y7T8stJbd5AufqYikI/zQkEPRAFq6kGftwMw9bdhcBUiAAgFYHZK3w0DWO91so+JDn1FJaZwXgOqjCcNXMLvLVCKvV0xfke9DbgIasiJyGOcAHyEK4C23nLNM4AfhQcR+PvLNTGE5JCvffnyn1i/u1QBdgdwuecB9jAgqgi0Xwr2MwRdVYAbgvacQCYODAnQgqOTMNoVxP8VLOP8gFJfBdZk08gh1GuEYU3bKEcwk0C0DiQmCL6urnMwLshvKYFe7nenXdhCpUG2B3YNan+kLuCDSUMRkfDgZxcSxfdG8YO23h6IkQwUAI8RAFYjJtSfkoNa/dsxl6/48fW7qgNIeYDrrRqQXgQqZge6dmDbJFQV2839L+CkDsGa1Rd2viQUiQQ8CBCoPjdgQOlKc2jD899By7DR6Qm1t8BHZYPrFSVFVuR964HSGyhRHC38Bfy8Sd5zInwwAK/PLS8NHIJNINp7wKpsSILCnmMgt1Bnu+/UGsiOVXZs/9t32vNrcF/aeY9m+/0x05i3x9HHtyRhyYYJZD0tX/Fj63dsnYA1CXhxut5CgfV0XhoBbOFA6f/nBKHN/PccgF+XnIAdoD4k8KraTwByydADSIDeZekD9Q/JgYHQcQ9dEgJdFrG/vVcAmWEfA+q9CgVYjW34gNDVnYR6e00a9lx2+jGtOxASDElioj9gnPW3ScyR5WcF7ib2yOEUQomIZLScySxtjySyEcCPrt+OBJAcwO4CLuPJQQX0pUkoA7mqPvyEmKv50zpZ2hN5AQoRFMjtEM8kMcgJ7A9I2HjlGjwRAZEQAB1QJXEQKKmPIDofxuXKLfBRrWPiUEABl8gA4mxUaT43A1Bu24nZrW73iMCC0MT9gz4DBAWC07kCqB5YIHmV98dB2w6Ae0L7ryKOEcBH6r+tX77yR9ZvUw7gtBFB/akwGw7YFuCcKwCHYJt+GuDrgBBVAQ9oVnml+p0qwKLzARGwJdg6Sj1PHKiB1hXUc1KC0V9LftQy3yBIJHh7kTqu3TsPmW7VwRKItfgxcWgngL7iEYDvJgA7JCGsOpPPY5xAIVpU2VG8zw5BOQoP9IBgSN0j0ihOYDv38lU/vP7NrQRYQoDiAPaegNN5SS/+VAQArcG7jQdlr7G7bRNuIUB2DC7Dz4Duf5YuwIAkIIEXAmxQf3Yn3RxCDGZWzP0M7lpjQtmHhXM8HYIIE36iemBy883f1KM7MDKgvR9ojsF/c84P6LcEz4Mcz6Cs8zQBdBqGGKgj8CtgoxMp1xmRgl3uE4T6WG27RAA/tH7r3glY+wC2XoDTzZYH2MKARgDtRaGt9MevC6eqgJnm65OADcAIVJ0TaEMuIAUJOjrWKGO/r49Ljggu1i6/zqu9qga0HDps3ykBWhXXbzCSx4S2WksqilBilW+uxd4B5QTwWu36jvJT9cESQR/w6nyodhFAUYWTs5u3+W5fUOERATxV/XvEgOTKcX/5nAjgB9dvKY1Aex9AqQSUZOCu5vZ9gb72314ZZhuDIgeAICt/RySgbD4s25XHbtMGQl4+yOonYPpjaAUmYIsuQ+MNOuuNNlMYwNbcaG6Y14jcgW9OYo33kIQzdisEVun5E8fcRmnhO7cBq4mFj+M/434xgBuBWSVEUPDfqKSsqk8jAEzI+Wtm8mIgxxa/3QuzjygRLl/9d9dvIgewlwJrMnDrCajNPr5F2PYE0OvDTD2fHYACPMb5A1fgQC1IgBS9Den8Vz2GIJkDiUHW+hILCg9gGlPZrlt1h6vtkoinivr4O4lH3otTgz4zr4DerhipB49djytr+Lw/gsCebx7wvJ+ezIPgsX+jy5hxAkgkcWzOxPFC7b8oD6rz2dxEuu7lq39g/caeA7AzBEvWv8T8+bPp/MOkH/QI5Gx/+uJcCVCOIG3XBlNT83oMnD+ACm4GvlB2E1fT+l7VYBRCiOahmHSMT/BvQAxdS6TyrU4sCQnupAV/HoqdsMNqq/EiVMLlY+lQgtUeaSByAibTb0qDGYD1mUZOQIcPiljwGmb/ZkC/MPs/VfufcRI2R1Cub/ma71+/YZsMdLF1AEIIAMnA6z0ZmOcHsBtIIBVvDS6Ah4RgetAZcK4SoBW/kgCouSKAemwHUjhusG7fN1D8fbhLwtiuwocYVsUBao8gD2uGmTDaD4A4kjHEGDgE+dITdUYGMak2Ac9ruicMBh1q9pAcnpD5b6roXcIs0Mueve1n1D2NuQLco/a/PScbFlgHpdZte+L1LV/zfevX7WXAy5T44xzATgSnkgzcEoHcIQgNQjgvIFcGsCRokn6mHbjlAbziCxdQv4TNBcgGoO06egnCHjCDEKJCsRv/91qJUaPVnH/WcAA/5Qo0+AWQBVDtvspZcGDwxAai2iXHNCHUWTgSr9YM5PZZKTvaYiTqNyT+ly3Ex0KEXpIPv0sBtfoeaR06BHuvl6/53vWvKgJAB5A6A/07Asx8AaP4AGjpAJoLYMBXh5Dr+MY1uKYhC275rgA4ToORbhJCYGM1wKh6zykU5R0RA4UKXqM9QfS2kU5BTFe27iSdw0Pc1hCsMxq4AXFEa8j9Of1PhU2QAxFJFDYwIPDIrIT9UMCCZr8L+f72yKOAj8GKLiLaRrkIdc0N3EguviSIJIFOaHnH96z/TyOA9Xq5WNJ8gFwFyAnBm6012AJeJATxfQDmBSGo8JT1VwRByTmboYd8gVTofq5gH4JEChVcPcUfWXhJNKTkzol0YG3CDuUICPYyd2GPrz7xFfjXk0U+wZIH+gc8JlIGg50BydAfK769B6iYNmfwhPgfMucI3OhvBdzHEUD7bmzlX5T670nAd3z3+leGDmB/Uch6KRuCavyPCcLtEoPPoOLcB+A/l+NQmS50Bx7cJiyIAC6qAZYUCgjihKKCaB3QM65hMBeh6LKBozyu0vSivN4D9BTeazFexYQbCFqIFUEoAvkFIYAXUPNnRY8qDJFFb9vbZF4E9McTgM81LO/4O+tf3gjgYgP5xem6/Lsrf8oJ7HMDttxAi//FT4nnVuCk1qU6gPmBAmKO98v2ZZBah9BsPdp9BCLkCCJHEGX9DYB61YBRJUHAP0w4kuYOld67CO8bED6aioptxbVqL+cIZPXABx1zZUN/RqvaBUqWsHoWHyktdAA5b8IWeqToCLTob7w2/nvGDURxflTjj8iiHx5wBaB9Xr72u9a/BHMBahKQcwDpdWHr/ivCtTtwSv079r+ShVJ6ArkDNxCFiXftfrbWzknDomh+eRqC/RJhA5OuBoSuYNYRhDkFHTrIpeatu/aKPIytz2AvYeBLOQZj9aE4GIYDlC/QDkBbfHQmFXTTLwZhkrGqOAP6WTKICSBOBvaBHIcFinw4dFDbLF/7nev/ERFAcQAJ/LsL2H9FuE8ATdHrdOL6Ik9Ue5hEVIFW1JxcgJnYw+ssUFsSUQCYKgIG5NNuwB+3W0IEEFv4CVcB/fZ+DkBEJ6iW9h2EZQ9FDHHyr+3FYRAThgItghPV2cLOlqL4jKz4BvDGMSF454CtVP8poMd9+27A229FEB6ko7BgTCaVCMgJbedavvY71r9YQoCS8MNOwLpsOV3ltwa3ZCA6gPIGIQwBTIKPAa/ATstMYq2/rsJDkkUBBoOOqwgE7h4pyKaf4zkCA+uZ6gFPPKo9DAdcgcz9Z1BCmbEXDlhwT+QDqOKAgz8kAPEz6A0gDHhPAArYjyGAXlPPvBvQ6q2s/iH7P3iDcHIUMUks7/zb6/8qHUCO/wsBZAeQJgjV14VlN4C9AbXjrzQHgSMAckg3DtU8/b0vM3Zf5AyicEAtFwm+qvwZcNsZ0uOxVj4tP/tZAuEx81AOLX4jCFbXvr7TWvHrQWp/TwnGxCcq6VQm5ghABRK6QuDDBFgyOZvwRRHASPWjRF4vwddzAyrWRzJCoOo3/4zsv3UKJZTogX93AO/89vUvcBLQxP9pXsDWJHS1hwIXJ/sbgibbjwlAagl28T4qegGeDgssYCnGd2U9jOfFtqIMiMdvQIri/8i6Ry5DQPNoDuBQ30A6nwUvfDowr4CP4Qmhnam3LVIEvxgUr9UnBHX5Ds8aE4IlJs7Aa3eglXKGDBjgngwAoFK1VYgwsvfz66Nk4/LOv7X++cv2SrCWBPQOYCOAXA1YL+qPiJpWYCYA/FwUNi1riouKH+QAyBUY5zCt+lEVQZcOK2xB7SX0Z+r/IekMdN+p87xPaA6j5wPweD4rcIQAmHRGVQFDCrWxxzsUJgX7uZ8DiMhFHQNDkkYqHpRdMoDmoC4BQAjWFHqWALzSWycROwHlOJZ3fdv65zAEqGVAJID29+4AlvzSUFvrL2Cn9wcWglD2v4JHhQmZMIJwwE7hRetOScKOQ9hed+Iy/a6/P1D8EPht+/2vrtprl+EhOw/8/SHTLxVZmOtgQZ2T4Rg6AFHK9Ha/DD90KKzS3lFEBKBdANpkPp+10EwOCHrlDup1POItwUwuWo2Vxe+TQnM1CvRzRLG862+s/9PFVeoDSLX/9Xq5XMq8gNIDsPcD1HkC28tCytuC9vi/5QLs5KCi9hTrLz4hmIYFLBfk0GJ0BrlS97hvoIGylxT0wN+zARLQUbigCEYAMDzmNig6IUcx+wecQuQHpglgMmesYnE4AAAgAElEQVQwRwAWpPiJATln+z3oFbBRCc3flIfo2XpW03FuwAKSHUI7lwJuDPCx+isSgT6Ad33r+mcvLtfbi8tley1YIoDcDmyagbBJCN4WJMHP/QGo/jv4CzCa8pvmoR38CuQR8CfzAlRVaFBMwCbthnx7v1rQlH4EViCEx+QBwpIiqmrfLRwigHqNVqnLGXgpHntEAArQPZCzYs8RgnAE1a1YYHRVHyoY2xE1McTxeEwWihReBAHMHmM9Le/66+uf2QlgdwBpHkBxAzQfwDiAbTvzpqDa/beBYOsU3L52Dgd25aT8gKsAJJC1TkIgCRcGFMvfs/u0jux+ze2HDUY2NxCSwyAUMJTgQD9DGBluA8KYCRv0NgBjOsdcCIBQbOSjYnzW+xmV77kCre7t7Uc+ro9A384ykx/oOYPY7iuC6C/zrmAW2GW7cQixvPtb1v9+I4AN/DUMKOEAtgOXv9u04ev6Q6JV4fPPiYEDSGW9Bn6XACz7ZiA6AqgABUB3l5VBaEnCFvM64cHmPXq5garCojyo7Lo4loa9WDrhEmaAbxWbCUWrOypu8Rc6BzAmAKXe9vg4UNvVNoBb6vAzCDmXYOkHjzMCOKp1/Hds52fUXrXz+mVj8NpzWdAXp2IJyRPI8u5vXv/b/Y1AFycggBwG2EpAmhvQXhySkoEK/MYNMPjt5/1xZ4Iw4HdhgOoPiJzAWYCYty0Oo1j/mBQqNAfE0LaLlD1W/P45WFnb59m/+t2KaNijc4228etHLkCFDHWZKZURAcg2Yq3u7CBeDAG0GFo3CcXKrkAbAbmQ5B5zmIYe9Aap5Bttw26Ft13e/U3rn94IIKt/TQRe5ETgHgbYqcHmpSEpGQjKf4gQGvh9ApDyAFL1rc1vtr6fK0hrAYwm4QiEYGJuDgIYzDZP4M5hOvjw3D0IHwgRuEMwtPP6fAreKl8QuwDb/BMpPPoF+wvD3klYsKrmInYOXjWZAJSqI9D83/ExMQRRuQGlvscJwKv2TGhQCCFyFuV6l3d/4/m/urhachVgvb7Y8gDpZ8JdMrCSAYQI6dXhSAD5rUGm7JfAjDMFfViACg3g7zqBArPYCZSuQgvIsj26AASbdQMWhna7FC6U/43MPS2H3oKxgk+SwBNyBFEQoMIL3tYTAmcOyu8aiuVZ2SKyQACV+xSRAm87H/+3bzRyB0pNLaGo0MCqtyaA4yDv2/92TruddwrLu//a+b+4vFzqK8G2dwPCJKCwMajOF9hfGVbKgBH4ySGYnEAC4YnyBPsD5+2IDLTiN/W3sbxX/BbF23Ws9WnwAYW4xB/rvQBt3sevmQF4sM1EjsCCK1J/XK6A2tbzWukIRKvyk8IBRxRzdh89Ayu0KttFYNYlPkscTDhepZsXQbseATRW7nYmbf1VeKJDiG3p8u5vWP+z1AmY1Z8SgIUQQP3NlOE0UzD/glAmgqT0ojdAJAQl+I3dz25gL9OBM6jHauCs+Yi6La2LlrvEH1KAJ450VBECZCdg6KDjEDTRKJCiYxl7Bt5CKbmGvN1zJiyI3yCk5wNwoKCIQS+z3kOpdSM7TRDxPvM2PyIDDgdmE30vngAi9dcksLz69et/kjoBKwHUMqAMBUpOoBDFnhRMYUCz+Qr8eRlXBEKVL2AvNXr7uSUfM8irwjYHgI1DKgSwjT3gHNzEINybQgCO7QHwqk6gGnv0dthFOOMSZtQ9Jo/Y7mdYiW4/BFyz6DGJNJDoPe36ppga2Lx+liDG5IDqXc7tY2qr6PF2nlxG8bklBQ/c0frR8dGBLK9+3fqnLi72RqAtAdj6AEwFgPIB0BW4v0249ARI5Qcy6ILflwtLCNDgV7Ypys7uAJenEMLsWxXaVxQcQdTGICQUkSDM3YGxmjO8IzDn7WY6DTnh1/k8Un8J3ADsFnIN6HgOdg0YMtjt/NGOKP/j1R4beR4f/7Nys+L3qwOWYhCQNpR4DPjt9/Nhgj3m8upfXf+jWgW4PN1cqARg7hDMJGHbgrfGocvTzbqcL6z157jfuoINnL2koAO/yBskgJPi5/DBx/cFYAxo+kwVAWv3AeZBV6ElkkJICSx+XQZRt1fgMeqf9pkFf5l+yv4g2t9qrT9PHO8r5ecZf33lx7VouyNC6G2DYENA279bgg5B/kYRQE/de3mBBvRRjiDRTdl+efX/Xf9kKwO2MABDgpoUzGpvXhxSl209AQjyQgCvu0agdeklBZsTqIDhBKEBOQBYKv7WE2BB3iJ4sP3UbahDBp45iOqOHoBBaz+360HIaaCH4UFUVoTlEsBB4lCDXWUBFODt3pEjeIwbUMfywO2FAx7ACuwxAeikGlp+Bu0oHPAJwrm43RJAnNhr1xNvU0hgefX/Pv/7rQzY2oA30LuKABBA7RosyzYXANWA6gYMeBMZaOXHHEGGqKsMCHKAZCAnCS3wMRzIeiwSi2zlW55AATzODRjtF1UDooTAxIeewaQbWbmN+j+xUqCgzWTB23ir75U/dgneXzQV7wGdnUSc2GO3gMlBlSj0gG3XocD8YglgjhyKrvsQokMCy+m0vPpXzv9ucQCp+SfF+xd7nO9j/50URA4gdQjmHxItRLBQebACWiQEAewJdDm+r63C6XMDuX2PgLH8wgnU/VwlwBNDcx42AMAJSirmN2ptyn7aEcR5Axs6FID3t1dv91HUoJf17b7dB5XckE2d11+2ZzDrygD6DFb3Y5b/qBMYuQMGn46v58OBPph7Ci/tP/20GB7d5hUUCaRly6v/1/pvp8lAbS4AzAnYSWBvDirZ/0wAygGcLtar2hMgwc8JQV0ZSMoN/+XPFvwFpna7ppmFMJraNwIpwLahAfcVcB6B5xM4fa7EYwHM+1njr6x/FPfTGYOE4XTsPwoXur8cxKTAtNDWe4AzUBthxJY/VngmCaXidhvrDlCxEcz9+r93GLEbsADUYG5nbvE8hx8xkAvgyx7+GLhv+3t59S+v764OAN4JUBN+OSnYEoDrdf07kcHNcpneFbAnA43659LgDmAEf/D3pu8j8LNTyFl46w4A4KY8yKSRt4O+A4799ecGcBvPxyFBrN4zVQL9HoIoQHixBBA5hjjut/DGnAFSQVluXYIKDRjQ6Dp6YG+hgz1qAUc7zljpfQIwcAPwS0KKELxFt0e2yt1b58kgdhAa/NvS5dW/tL5zJ4C9AuDtfwoF0iSgPFW4/r0t253ARgCZDPYwIKu/dAMYBiDY8z7NqlsXwGEBbseVgLatbx6KQoFY7YMQARKLHtzHk4MGzBPtxZ2aAmX/Izfhge2Jw1t4a+61ytuwQIGeKUJVArzizwLfA5v1P123Vc1GSAxS5xDAelv73/a0JNOz/kgT7ZryxZlf8sVl/m/lIGLgl+++vPp/nr/m4nKbC9A6AQvoMRSA2H8H+77NBnpIAu4/MX5RqgE504+hADoB9/cGmrmQAMnAhAW7gyjqjPkCIAKT+LPgdklEU7yzvQOeMND2H3QCtaphgwMP0RjMeMbHOAALWntmdTwLa64MzIIeodqoJUr6WRhbEjnmBBqxWfi1n+zWBNEHOFt7ZfURphFJoAtQ21uXYH1Gs/498LdAYXn1f1+/quYA9nkA2eLnRqCNGPZXhOV6P/67EwEQQCGENDloy/hDEtAAXocACdi2X4BDAvyM4Hfb1ap7dhKUGEQAa/XHDsQcKphZhFHyEMID0y6MPkH/qnEvTNBGfFbd57bTxMFQL+rJVxSBXqm9Bz7uPU4Etq17wPdOIB95J1xW3raMrXtU/x8BXhOAsu4NkBy7z9j6mW20e9hCgL+4fgX3Aeygh0qAj/8TKezgL6HB1f5Ogevl6nS7TxHegZz/k+DH/oDXIfZvLsCqO24D6l6bgXxSUIcCZd8gPDBqTIlEMwcAzxeDviozzQDU8ftkPiDs/JsDuiYTVvG2lXYA3jNwVsAm9LzCe0VXZOHjdwZ2epOUpQ0mEQ9qH8PPxPkRGaDJ96FFpNL9GP9p6s8OQH3eCOB/W78M3gewzwPY7X1xAqD8Tf2zSygOIOUA9jzCXg68OF+mGLW4gALq2BE0sCdiMOBfXjefffxfgNryBiU5Z1wCTCay7oEVHtXdA72XKDRuIoOeHQaercGMHMJEo4+aV2DBfYwQeqGDygbw9r2wQCm8pRBUdeEQzAxDezSV7POE0LH9zg+o/MAR+++3xSVo0zHUYJWeVXZLFHPALyS1vPt/OX/xNh24qT5MCqLEX4n767/FATQiSI7gct3fF2hDAAX+5gJs/A+A38mghQUq/o9CgbIcY3u/bYGjrxD4/YrSi9wBdBIyQXjAxzmC5iXsX4oongL2tK8nCG34tTtoBKCThR706axuOU0fVvD2YcEoDChA8HYfQedDAQvex9l/RQCjZRa4x9X/GPAL2Szv/gvrF17CZKCdCPYuwNwMlBN+JdY3/17lHEAmghoSXJ5ubQiA4PdEwLH/Dvha+wfwQwXBgZtcA69vVty6iwb7AgZcj9N+W+iwLx20DmuXgKCL7T6v0Uofqfsx1edwIHIBfrmmCmPY3VuJmCjsMWLgM2mosEARgl5mCWAmFLB+Ymz3lVtggPJ5ewQQ7VtgjDmE3jJPEsu7//z6Ba0PwKp/6QYsOYC9VHjZ4n8AfM0HXGy5gDo5KLmApOAF1P7vZNcT0JEMjPLzNnVbtP8cKoC6S4LAPAABHCYZVUC6RGIDNNt8b/sR1n0HoEOEo44g2p4hbz/3CQDWyhmDDOhy7Dngo6NgW2913PoIb/e96nOGAD/j/seXj8jBry/2u8HWJwF76xrEHw/86gDe9efOn3+5vRIsx/yl9FfLgpdpTgDY/jRHAGx//Xy1L98JYLk4XzUXsCkmJgWbC2jgx9i/kIFalgEP1QKv9pwLaKpucwJo/znhV8godgE8qWhEAjo0YKBiLkCBWCn8jOrPbFMsOpCC+4XeiDBmw4CYDKyu+2DBx/rKCaiEIFPEnOr3E34I0ZYz8O7A0ouO/4+ovz4DHreAu/2riCKtXd71P58/73J/KWhpBU4u4GLv7kvJvp0M9lLgen1xlbL/hgQgFNjfMLy7gJwHgERgIgGbHEygKUAvJJHj/qra1h342L4pf10nOgY1UQgSEFOKo3wAgr6XHLTvEMJwowAKAWqP5EOAx5IAgpeOUe26tvYJjt498Na9vIC1+O2IHviPt/x4VKX63i2oJRFBIPgUAWi1j+J5u1wBm4GrfEEM7j4ppLXLu/7H9XN3AoAeAGgKSuqPLiCDvZIAgj/b/0ICpgpgQoEE9Jb4KwDOy43dj8BPicE9LodtYeKQJwx0BFllIUSwoFbOoCizTQaOHIGfhmxpwQLdhwwWfk/IATzyBaIzeQCv7wz04jKU4S8kY6nCAlkpvLf8SCHHQK9AjlBt59JW3G57xBH40KCdAVXdVwdY83ukYH3B8q4/u35OygFk5S9lwKL+l+ACWP0t+Hf7X3IAez/A8voFkkBK7rVQAO1/IQN0CW1ZcgnFLVhAc3/AHAlURYeXitjwgKsCCPbob9VbYG38TG4gQYRTgQz4SQKYnA7M2j6bC7Db+TDAq35s7RVoLbTVpxj8WtubXe9XAGwiz+v9yAEw9C0oj6u/phsL/TngY8CxvPPPnD+LQ4BL6PzbYv+LDejl31zm2x3A1ZLmEOTYH/7dw4DTcr5sgH8v5AFsTqARQ7b+Bey1/s/gz58hRHCkALMJnfWn2YWzwPdhAJOEzRdYGOO2ESnY5TpsUCFDXpbbnCPwegMfL5klABsa9JN9EfRV7O+tfE/TZ+J+b8+tlvdtf0QArMYM7Nj+27i/D28mD+8H2AOMPpcjLu/8H9bPvLg43V5yCACx/5b533MBu+LveYDkGK6WDegpJ1Dsf/p3dwKnPQ/w3toQ1KoBrTKArqApfKkeKOUvio9xP6u+cAHO4rcwAGcSHksS6lAgyhcoQvBaD8oeTC8uDkHBdzv3G0sAKhBQNIAQLleqrL2lhb7510D3ZNEDu03t4ZY6VEAnEG0dq72y62P119bfUsa82isyqATwtf/d+hnJAUAIsMX8HALkEmAigaT6xQHsFYGrbP+3f1siME0PXt4LpUAsCxIRbMqf4/9CFsb2jxxBjfuBHKifQCcCmQwKLLHEGKn9yAX08wSVANyPhRxPBJY9tiFbaOSxZKD3Q3g2+uGl4zxArPk+M9CjBIasNvX9UMCnCvswR+AhlL0XiAAbxfCj2N4Tx0jn9Xr8Bss7/pvzp5cQ4HJ/H8B6vYUALfGHmX/4+2qFECD9vdn+Av6Lq9P2YyO3G/j3+H2P/fPfORfQQN5yAwh8QwI1iVjCBPVvBjK0Dtc8Qg4JIgJQLqDvBmy8H6t+QAD0UlGGu53uOxf/c9YAHcJRIogIwGp9OsOYAHRtYOQHGhBHGt9zBlbB8XoTPBqsLJx1jM+WPqIDPnaDooLxGPqWTB4HfHWM5R1/ev20y4v2PgAs+212fyeDZv139b/cY/715rKEADvwKwnc5XBgCwPu1uX1BR3AeSOBnAisAOfPuXFoW28dAeUIcq5AJwuRIFDJRckwIAd8g5DKE+j16B7y37MvHDVvOEajPyIATx8cHjQIquRhZOv1UcbVAEsJI6BHQUDbr6fhDOkZiD8e9Ec0nwMDa+x7cb2H6tMMf6EjTxzLO/7r9VMvLtb9xR4p+ZdBn2v+W24gx/07Eeyfd/ufbX+J/3MIkEOBXf2Xq9Pd6SJVAgrw939LCXBXavhcS4MW+Coc8O4A8wUJ/E3to8qAXm7dgA0HEPS4XbXy+SfNMNvf4IlAbb0AZl/q0beq3q//67pAWzrnAlitPQkcI4Aj8Lehgf7kLbungFnTr91BPwRQsJ6L9DmbgHCc8wAvTvnLkZav+S/Pn9KqACkPsCl8TvLt4C8uYF9ecwA5BChEUJJ/16e7vay4hQA7AZwvE/ghD3BKFQEJfugXSCAuPQMF4HkZTBJqYA+qBSo34FRfkYFqFS75AiCGmdeO8ctF5LsF0jEb5BD+fRdg10Ylwm2YMaDVZ47ibTBxlADQwHPIwFDVbmDGAfSIIYb0nO3XoD9a2Ovp+kjhR+tH1BDtv3z1f77+vpYETC6gZP0vU8a/qn4lgBQS7HH/5fXe9ZeTgEuy/1en7d9CAFc1D1DUvuQFQP1LjgDzAiZHsIO45BIQ6Br0NvZ/ihtoJGDCAAd6jPXt31bhdTlwPgcQ6XwM+jgc6JOBNfJlW7XUqjwDPgK9zR54kI/MfboiG20rQLfjMJBx6yhXYHW6F/Nj1kDF20xD3gFoGL9R4N/OtnzVf3r+pEQAGfw1CZjBX23/9nmL/5dN3W8urlIOoGT/M/B35c9/329/ny7Peykwlfu2f4vlb9b/XAmhdQgmABfXkPoGPDnYnEADPcwlyOofE0LJDwzCAflGIeEGahMPWvxRJSBS+p4DsG5hZP81CYz9wBwJHCEAFRJo9e4X/Y7bfF8AHIGeCcLCegR4Xh+TQl+/31gC+I/Pv/fyMjf0bBOCNsXfSGDr+tvBX4Cfkn+76m9JQEEAF9e76hcSuN+cwOYOdiDvIE8EUMGdKwPJwvtcQMsbtLZhGxY0oCP4PRH08gN2XZuR2EqDXDmwLb24XQHlUx1Ag7PP7D/dATSFHnsDHQwwLfiynrbyVtNHdl85gEjxLVlYrWUHoFRc5/yZIHpuYBzRR0DuAfyp4I9Ip+YAvvJPrR+/JQG3EuBWAUhJv9P1BvIN/JUIdvXPyn+9EcZ6c7H925J/dxdX6+3+K0OJCHYHsFyttwncRf0TGaDCa1fQHEAUFiRwJHLAvxNAo3wAVwG4q3AEfKwolL8R+E35dSIQAwLc1iq6LQPyOv95PgAoxrln/1UiEN3CDAGMlT4igHnlV87BG+1jBBCB3roB9gIMVAXcX2gCmCGP5Sv+w/PHpclAadbfRgAb6Av4S9y/EwISwN4HcLq9vC5xfwZ/jv8vrncCuC8EUElAOQF0AJAsbG6hgJxDBFxeQI/235JAI4lMHKYleFwe1B2DnCjULsDG+FFI4ElgnNzz2YMetHFdL9VX0oVRTcBSgHIADYjNcVjAItARpEr5C+AiMB8BOULZO4ftGjlXUPIMRTd7ZMDbNmdwhBTamfrhQbR2Bvx7DuDL/+T5d+0hwNLAv2f+r5abqwb668vrZP1r7H992j43B7Bl/wH8ORG4EcBdCQHQCdi/W7cguoGm/MkxDBOEUDFQpcPUkMT9AQr4Nh+gm4RY9TG5x87gMZOEElRnQgCv/rxEx/rj6j9TBNKBdQRWzeesvncA5ZjewjNQLeCRWHhfD2ZPALHVH5OBBvws2EdAHa1XBHBkn+XL/oP1Yy63PoBN+bcQIMf/l9c5BNj+zUSwkcCeF7hOwK8EUMDf/t3Vf3MBy+V6l+L/13L8j7mAMkGo5AZagjAGfysncpkwrhog6DFv0EsANmIYKX+rDkRuICKApvhRvd8TwNPtf3MBbOWbVuttojDAK7tWfQVw3DKpr1LzPgE0SPvtFAGoMAGVWqXvijOYA/yLIIAjQPYZiDnnsHzpv3f+6MuLZZ8MtIcAxf5fn26utr8LAVyXrP96k4ng9iK5gBT7b+C/Xva4v9j/i+vTQ3UAmQBqInB5rWb5k9UvxIAJwaL8UDHA0iF2DKL6Q2ehs/01b9CSf3YbjPHjsKCpc8sZ+OQgAzyO+Y8RgCWB+fg/0nxebj83mjhKAB7wiVgKiNjs4/aWCGLrrxW/ncPb9t46G9vHoB/F/KP1Mxb/MQRwdJ/lS/6d9aNKErCAf7f+1zkEqARQlD8TwfVa4/8M+rvLFPdvBPCQHcBOAOdTAftrOQFYwL65ggL45gJ8GNBCAKwWmJDAgF41D2G2nxOEHBaozyr5p2y/Ajluh8ZeZfs56u/BexT/a+tfQOj13tt6Ze0biO0RME7n+N5+5vxAi7uTA4hCALVOEQC7CAYyGnuv6J4g4m0iIP+iIYAvevf5I65yGXC3/0X5r9brqwz+q5sU/yfrvzmAlvzblf/qtIF/+3e3/fm/jQQeLjIBbCTAoUAjBgR/yf7bngEuFba+gig3gD0CbPuf0jGYiMCHBQXYZT2/G8Am/ljxkQqa/VY5AFxb8gR+WbzEqz3rPdr/eQLwYUDLIKh1s2rP2x0DPOcKUOERpBb0niBOp6U6l55LmCWEN8oB8LWNAoHli951/q0XS+rxb4m/BP6dAKoD2EgAwL+TQLL/l2j9r9f7y+vlYXcBWwhweb47Lyn+T3mAkgsoroCVH/MBLQTA3gFdHeBEoSaA8mahca8AOgZfGozmBDRN7vUCMDkUILPa6wwAg3scAign0JbZTIB3AQ3IqPhWxVm5vUvA7Xt/s/Wfs/gYViiQz4JdbZeOt/8iaP2faLsIgLM5gegcIyDPEIo6xvKFX7v+5hQCbHMA1uvN/l9t9j+DP7mAFPdf7nmA0+3lzVb6yyHA9a7+95vSZ+BvDmAH/+X16dnp6nzbgJ8IIOUBGhFwdcDmBHjeAPcQ2H4BmwhMSi+TgyIXUPoHxlODZ8KBkQOwcbzX+pG9n1H/PvBbwo2Dgaa62u57RVexPapv/DeTwQwBRKFAs/ps41vmwW8zcgW/WAjgaPy/fa/lC776/JtSG/CW9MvgL/Z/cwGb/U9uYLf/V1vdP6t/tv07AewkkP7bgP9wcXN6dnF9erZcvn6TwF7Ab11AcwboBF6rk4dUglA3EcVlQqv2SAqqOjCr/Dr5Z5t/Wj4AI38Ldjb/nAPo2/tY/b3Vt0eyII9UfkwAfJwEMEUIzWm0mNoSg1d7tuYe2O1YDcgN7iqeP7rs7wUBHAXz0e2LG1j++Feuv2F3AJdb0q9Z/+QCNsCfbi5vltuNAPbYf6v97wnATfmXDfBIAA+XN7v6P9vU//Lm9Hy9eO9VUv1GApYQwA3UUMGGBVwh0L0Ctp247wSwAuDnDbQXkPas/wwBoMpzDmDkAFDhEeYW2J4A5lS/ALQHcAtka/85qacdwMjqK7W36t4HfLkmb81HRMFWvUcK7+sE8Fjw7w7g87/s/GEbAWwlv80BXN8k+7//d7PlAHbVT+Df/0vWPxHAupf+LnPcv4F/A/6m/pkAXlqX1y4S4N9TXYAjhL37D/MEcV7gMRWC+XbhXva/vIY8mB0oJgFZE68IwJKASgRqhW8gt+t7qu9j+z7AOd73YYEigQKsFl4UR6Cs/hjsvdg+AnkvBxDnAqyT8ATRcgCjDP9svN8D7hFQH9mW8wDLH/uS84duIcBOADvw1+vrDP5EAgn81QEU9b9Z7i+v1ruLm9P91fWSlX99uLxeduXP/72UgF/An/7d3cCu9vY/mxtIpNAmENFEIpxUVLsEsVyIvz3gW4b5NeN2tmBMBOplIT4hiIafy4I2GIh0vtj1eQKYAb8CcTPhSAjNIbBKN9XluB4BaR0Bxt3Wntt9RiGAjd/fJIB2P2aThI4APvcLX/+Qq8uL2633//pmcwA5D7D/u+4EgODfcgCXN9n236TYf4v5i/pf3qzPLm+WlzYCuLhen51PP5+Bnohg3YFv3UDLDxQnwF2D+DlZfTOrsJJBATo2DuH8gWL92farvoCS6OMfIFEOwHb6aa2PC389sM8RgFJ3tuz9zz4HgGRh1RvJoSm+B7aP72fcwBzIE1mp+F8ve1zcj6HF4x1ApNBHlyuQP0X99xDgj37B+Z/ZZgJuan+9xf03hQh24G9hADiA9XYD/9Vm+wv4N9t/c3q4SjF/Uv/b00YALy2Xr9/toN8AvxQnYN2ATw5ymbCBn+cP6O7BXi4gKbt6bwB3A7b2Xp8HKOt0yQ/7ARG+jyWAfkxvXwLOCh+BfmTnrcqzSs8TQM/2Ixn0/44s/S93Angq+HcC+OzPf/2fvry8uN0SgDebA7jNZLA5gE39b5r9v0rKf3dVwb/eX93sln8jgedXxfrfnl66uj29clpeuzovmwNA8AchgUsS2vkDLUegmoZ8+3CL++EVUykAAAroSURBVDkUwLIgZ/zbJKAxAWjVj+DPZT6l7PGyWOHbPrG954SftfqYsUfgq2y+dQUjy+/t/Tzoe0m8Iwm+IyQRJQY5CXg0B3BU6WeBPbtdLzxYPuvzzv/U5gA2639zs+z/7mHAzbolBHcCKMm/jQCutth/j/vX7d+HTADPrm63uH99fnW7vHx1e9r+eyXZ//KfJ4HdGVTg49++aUj1CpQ3BtlwoCi8bwyypBCVAIvi4zyAErdj/d/W+THhZ0OAluizfqAY//ZvWm8V3y+zQI8dgFZ5TQYc51vwzzkAb917BKCAGW3PDuCXAgG8LyQAdwfwhz/n9X/y+uridkv+3dxuJHC6ubrdqwHbsj0EuLpZNtW/u7peGwHs4F835X92dbs8v9pU/2ZX/pev7k6vXFy/nuN/JADrBhIBaBJoCcG4cxAJoLx5WLYM0wtD5roA2fpz7K8IwCb4uJVHE0ADvFfz7RxK/Ru4LUGwQnMI4IFdYmmO171LaLF128cvs1UAuz5ah8vV30cJAMH1S9kBsGN5TCJw+Yw/cv4ntiagHfy3y04A1zc78HfwX+/gT7H/dVb/6xL3327gT9b/6nZ96fpueWVT/qvb01tOl++5bur/cxnojQwa+I/mBLhV2L9dKH5vQNQEZBN+HOPrz9zO44t43MiLYFXlO2XnRxY/EUSk9t6y2+x+ZPObVe+B3TuDPiG8SQAWokdDgzckCfjpn/n6P745gOub8/XtXQoBbm4365/UPxHAHvfvsf/VzXp/fbs829Q/Kf/6/Pou2f7ru9MrV3ent17drq+cTxvoy38YCvx8Sgru/xVHgJWBLWmI5cFSDrTJQPdCkVwJ4NmC/sUgUcZ/3vIfaemJQK+s/XiZBWzbPlJ2julVjK/jcgR++ZsBrAhg1va/kSHALwYH8CJCgBeSA/i0P3T+x7YGoNu7083t7XJzfbvF/nseYI//r28T+K9vlx38V7fLw/Vu+9dn13fLS9cp4ffy9d36yvX98tbru9PblqvX7hL4fzaDfPt7A74lAp8cTETguwYxIahLghgCqAQgZvltzV/N+ceY36f1UNl1lb/E9Sd6y7+N8dneKzvvFR7t/yzwtaIzyBXAjzqAxxDAiAx+KYYA7zME8Ac/7fV/9Ob24vbm9ny9EcDN3XK7hQBIAJv1v7o93V/fnh6ub9eH6xTzP7++O710fXd6+ebu9Jbr7b/709uu79e3J+AXAkguYN0/RwRAvQKibbg1BJWOQZwp2HthCJf+et1+JRTAWL7pfQ/sNr7nuD599m5AJfSsbbcqbxXcO4A5oCt1j9T8TQIoYc2L7QN4nyGAT/nU8z+yxf27A7jL1YDbXflvr2+T/b/ewL9Z/7vl2fXt6dn13en5zQ7+9eWbu2UD/ltv7k9vu3k4vd9y9Z77jQDWnQTKfxgKIBFgGJAbhUTbsJowZDsES6mPXxdWynyo8tFbfjDJx8k8m85TyTyM1ft/FzKYA3oP5M0dPA34PYv/JgH8EieAT/797/21m/Lf3adE4O3mAG53F7Db/5vbZVP+++u79eHmdrHgv1/ecvNweuvt/entG/hv7s9vP59+5tT+804guQAmgVYitKVBnEWIU4jt68PGrw23qt+SegXY0b/JynNZT8X1aOf93x70bZsE3gjoPZC/SQD9rr+ogagk0zj0+IXsA3ifcQCf+MnnX3N3d0oEcJcSgDe7+q+3O/jvNuu/3t/cnZ7d3C278t/cry/fFvA/rG+/fVje/+756YNOFz97fT79NBHARgg2HIhDgdw1OJwjYF8eqgmgB3rM67eIXgO9WHf+19p6SwocpyfrjqBn8EZgfpMAPMij0l4P0DPrflkSwO/5hPf+6vv75ADu7vdqwM3N3cXdzd2m/uvdzd3ycLOp/93p+e39ksD/sLzl9uH0trtnp7ffPjt9wN2z0wdd3b7n5fPpp06JAJgEOBTQYUBT/1IaxAlBJfmH7xDEST6+xIdKz5F8qfKrd/O0WL84gAJg/JeXqdq8An16tdSbBKB7BHp9ALPAf7MKMN8RsHzc7z7/g/cPp5v73QGsexLw9m7J4D/d394vz27u1me3D8tLt/fry3cPy1vunu3gf7+75+sH3L+0/Irbh9c/4Hz6yVMigB4JRKXBEv+rSUL0GnE38Qd7+5Xql7l6GMe3Rt+WnPMKX1Q9+jft6y08gtv//SYBqJzDTKb/KAEcJYJflg7gYz72vb/y4dmm/psLWG5v7k63t3enu9u7Dfynh9v707O7DfwPp5fvHk5vuX++vu3++fL+98/XD3x4efngh5dPv+p8+vFTIgAmAZUP4N6AKP7HdwTYdwNibb/9BFjSdGXum9pbkFulb3G4BbwHuQJ4H/SFJLZ/33cJYFQJeKP6AGbLgL8YCEDF9rPLODcx0vEX0gfw0b/z/MHPn59ubvcQYFP/9fb2frm/vV/v7+5Pz+6fLS/dPZxevn92esv9S6e3Pzw/vf/Dy6e/79nLp7//+VtO/9B68RNXiQCYBEoYsP0bhQB2fkD78RCeAdisPv/mXwx6m7zzoG5ttiU2t/82m95UHoFs/36TAHRD0Wxr8C8VBzAL9veZJOBH/vb3ftBGAPfPLm/v7k63dw+nu7v70/3tw/pw/3B6fv/s9PLDS8tbH146vf3ZS+sHPH/L8sHPX1l/1ctvW37N6fLHb86nHz2dTz8mCGALBdABYGMQTxDCl4Xa2X42wccqz026kcK3hhwEeQTs2eUYy79JAG8SQNSbP0sKf08cwG/7iPMHJAew3jw8XNzd3Z/v7p8tD/fPTs8fXjq9/Oyl5a3PXz693/NX1g986a3Lr3zlbadf/cr7nf7h08WPXJ9PP3w6n34ECOAnIAwoyUDVC8CTgLi5BxW/NOew1iewl/9KLI9Kj0BWoJ4F+psOIIH7zRDAViQUYGfB/j7jAD78w197+7Pny83Ds+X2/tly9/Cw3j97aXn+7KXl5ecvn976/JX1/V552/IrXnnb+g+89f2XX/u2D/z/2zuXnYSBMAqf0YhAW1pKuQVUVDRqCG5MUBN0oRt3bnwMX8c38EmMD+DGxBgX3qKocUc0mk5NkQk/ZWw1bozMgnBpWJ5zvv8yrbfM0QLHIzieiAH4FED7ACL9xS4APQlI7wxM7+4jOvm9pKejObng+1H9K9ErA/jeslDYOrAygH9oADs7PK3piCU1b1wzWEI3mKYZnmFazDZt5KwMypkcqtki6pbzuuTiFhz34HgIGIBIf5r8YtxHEz+I+PLmXb/YP0VOXwK/xW/0e9Rn2XUZzkcRgioBoqlA9QB69ESben+GALa231O67sV0YyRupJA00yMpy2a27aDg5FHJl7xaucKaca1V4LiEi5uuAfgEQPGf1vy0xqcNPXnCy0QcJvZgyn8n9RUBKAKQbQaGj/56kqVPBgqKVzZujBL7nzGAZrOtpczYuGmxhGUzw8myTK6IUmkSi5Uqa05Mt7c4TsFxAY4ruLjr4r8vfj/1hfBF2gu8F3W8OIwzmOJRqR5mDIoABpeJxHz9N++qBKCiHwIDaKy+JWx7LO5kPb1QhDM1g9mFGttYWfP2OY7BcQKOc3Bcd7Df7XT9/VpfHPWlgo8WeVD0UUkvS3tFAIPjyN+Inv5XGcCQGUC9/hwrlQ1tbn602FjH5u7eywHHIVwcgeOsi/v+jN9v6vn1O+AG6vEwUf/kWjDVFQGEpzwdPSoD6J9UfIX2wWWiYS8BPgCAPOYxoDrtqQAAAABJRU5ErkJggg==",e}(),Pd=function(){function e(a){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indiceOfRefraction=e._DefaultIndiceOfRefraction,this.indiceOfRefraction=e._DefaultIndiceOfRefraction,this._texture=null,this.texture=null,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=j.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=a}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(a,b,c,d){if(a._areTexturesDirty&&b.texturesEnabled){if(this._texture&&Ra.a.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(c.getCaps().standardDerivatives&&this._bumpTexture&&Ra.a.ClearCoatBumpTextureEnabled&&!d&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&Ra.a.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0},e.prototype.prepareDefines=function(a,b){this._isEnabled?(a.CLEARCOAT=!0,a._areTexturesDirty&&b.texturesEnabled&&(this._texture&&Ra.a.ClearCoatTextureEnabled?Ta.a.PrepareDefinesForMergedUV(this._texture,a,"CLEARCOAT_TEXTURE"):a.CLEARCOAT_TEXTURE=!1,this._bumpTexture&&Ra.a.ClearCoatBumpTextureEnabled?Ta.a.PrepareDefinesForMergedUV(this._bumpTexture,a,"CLEARCOAT_BUMP"):a.CLEARCOAT_BUMP=!1,a.CLEARCOAT_DEFAULTIOR=this._indiceOfRefraction===e._DefaultIndiceOfRefraction,this._isTintEnabled?(a.CLEARCOAT_TINT=!0,this._tintTexture&&Ra.a.ClearCoatTintTextureEnabled?Ta.a.PrepareDefinesForMergedUV(this._tintTexture,a,"CLEARCOAT_TINT_TEXTURE"):a.CLEARCOAT_TINT_TEXTURE=!1):(a.CLEARCOAT_TINT=!1,a.CLEARCOAT_TINT_TEXTURE=!1))):(a.CLEARCOAT=!1,a.CLEARCOAT_TEXTURE=!1,a.CLEARCOAT_BUMP=!1,a.CLEARCOAT_TINT=!1,a.CLEARCOAT_TINT_TEXTURE=!1)},e.prototype.bindForSubMesh=function(a,b,c,d,f,h,i){if(!a.useUbo||!f||!a.isSync){this._texture&&Ra.a.ClearCoatTextureEnabled&&(a.updateFloat2("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level),Ta.a.BindTextureMatrix(this._texture,a,"clearCoat")),this._bumpTexture&&c.getCaps().standardDerivatives&&Ra.a.ClearCoatTextureEnabled&&!d&&(a.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),Ta.a.BindTextureMatrix(this._bumpTexture,a,"clearCoatBump"),b._mirroredCameraPosition?a.updateFloat2("vClearCoatTangentSpaceParams",h?1:-1,i?1:-1):a.updateFloat2("vClearCoatTangentSpaceParams",h?-1:1,i?-1:1)),this._tintTexture&&Ra.a.ClearCoatTintTextureEnabled&&(a.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),Ta.a.BindTextureMatrix(this._tintTexture,a,"clearCoatTint")),a.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var k=1-this._indiceOfRefraction,m=1+this._indiceOfRefraction,B=Math.pow(-k/m,2),E=1/this._indiceOfRefraction;a.updateFloat4("vClearCoatRefractionParams",B,E,k,m),this._isTintEnabled&&(a.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-05,this.tintThickness)),a.updateFloat("clearCoatColorAtDistance",Math.max(1e-05,this.tintColorAtDistance)))}b.texturesEnabled&&(this._texture&&Ra.a.ClearCoatTextureEnabled&&a.setTexture("clearCoatSampler",this._texture),this._bumpTexture&&c.getCaps().standardDerivatives&&Ra.a.ClearCoatBumpTextureEnabled&&!d&&a.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&Ra.a.ClearCoatTintTextureEnabled&&a.setTexture("clearCoatTintSampler",this._tintTexture))},e.prototype.hasTexture=function(a){return this._texture===a||(this._bumpTexture===a||this._tintTexture===a)},e.prototype.getActiveTextures=function(a){this._texture&&a.push(this._texture),this._bumpTexture&&a.push(this._bumpTexture),this._tintTexture&&a.push(this._tintTexture)},e.prototype.getAnimatables=function(a){this._texture&&this._texture.animations&&this._texture.animations.length>0&&a.push(this._texture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&a.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&a.push(this._tintTexture)},e.prototype.dispose=function(a){a&&(this._texture&&this._texture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._tintTexture&&this._tintTexture.dispose())},e.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},e.AddFallbacks=function(a,b,c){return a.CLEARCOAT_BUMP&&b.addFallback(c++,"CLEARCOAT_BUMP"),a.CLEARCOAT_TINT&&b.addFallback(c++,"CLEARCOAT_TINT"),a.CLEARCOAT&&b.addFallback(c++,"CLEARCOAT"),c},e.AddUniforms=function(a){a.push("vClearCoatTangentSpaceParams","vClearCoatParams","vClearCoatRefractionParams","vClearCoatTintParams","clearCoatColorAtDistance","clearCoatMatrix","clearCoatBumpMatrix","clearCoatTintMatrix","vClearCoatInfos","vClearCoatBumpInfos","vClearCoatTintInfos")},e.AddSamplers=function(a){a.push("clearCoatSampler","clearCoatBumpSampler","clearCoatTintSampler")},e.PrepareUniformBuffer=function(a){a.addUniform("vClearCoatParams",2),a.addUniform("vClearCoatRefractionParams",4),a.addUniform("vClearCoatInfos",2),a.addUniform("clearCoatMatrix",16),a.addUniform("vClearCoatBumpInfos",2),a.addUniform("vClearCoatTangentSpaceParams",2),a.addUniform("clearCoatBumpMatrix",16),a.addUniform("vClearCoatTintParams",4),a.addUniform("clearCoatColorAtDistance",1),a.addUniform("vClearCoatTintInfos",2),a.addUniform("clearCoatTintMatrix",16)},e.prototype.copyTo=function(a){g.a.Clone(function(){return a},this)},e.prototype.serialize=function(){return g.a.Serialize(this)},e.prototype.parse=function(a){var b=this;g.a.Parse(function(){return b},a,null)},e._DefaultIndiceOfRefraction=1.5,v.c([Object(g.c)()],e.prototype,"_isEnabled",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),v.c([Object(g.c)()],e.prototype,"intensity",void 0),v.c([Object(g.c)()],e.prototype,"roughness",void 0),v.c([Object(g.c)()],e.prototype,"_indiceOfRefraction",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"indiceOfRefraction",void 0),v.c([Object(g.m)()],e.prototype,"_texture",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),v.c([Object(g.m)()],e.prototype,"_bumpTexture",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"bumpTexture",void 0),v.c([Object(g.c)()],e.prototype,"_isTintEnabled",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isTintEnabled",void 0),v.c([Object(g.e)()],e.prototype,"tintColor",void 0),v.c([Object(g.c)()],e.prototype,"tintColorAtDistance",void 0),v.c([Object(g.c)()],e.prototype,"tintThickness",void 0),v.c([Object(g.m)()],e.prototype,"_tintTexture",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"tintTexture",void 0),e}(),Nc=function(){function e(a){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new j.w(1,0),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=a}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(a,b){return!(a._areTexturesDirty&&b.texturesEnabled&&this._texture&&Ra.a.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},e.prototype.prepareDefines=function(a,b,c){this._isEnabled?(a.ANISOTROPIC=this._isEnabled,this._isEnabled&&!b.isVerticesDataPresent(na.b.TangentKind)&&(a._needUVs=!0,a.MAINUV1=!0),a._areTexturesDirty&&c.texturesEnabled&&(this._texture&&Ra.a.AnisotropicTextureEnabled?Ta.a.PrepareDefinesForMergedUV(this._texture,a,"ANISOTROPIC_TEXTURE"):a.ANISOTROPIC_TEXTURE=!1)):(a.ANISOTROPIC=!1,a.ANISOTROPIC_TEXTURE=!1)},e.prototype.bindForSubMesh=function(a,b,c){a.useUbo&&c&&a.isSync||(this._texture&&Ra.a.AnisotropicTextureEnabled&&(a.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),Ta.a.BindTextureMatrix(this._texture,a,"anisotropy")),a.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),b.texturesEnabled&&this._texture&&Ra.a.AnisotropicTextureEnabled&&a.setTexture("anisotropySampler",this._texture)},e.prototype.hasTexture=function(a){return this._texture===a},e.prototype.getActiveTextures=function(a){this._texture&&a.push(this._texture)},e.prototype.getAnimatables=function(a){this._texture&&this._texture.animations&&this._texture.animations.length>0&&a.push(this._texture)},e.prototype.dispose=function(a){a&&this._texture&&this._texture.dispose()},e.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},e.AddFallbacks=function(a,b,c){return a.ANISOTROPIC&&b.addFallback(c++,"ANISOTROPIC"),c},e.AddUniforms=function(a){a.push("vAnisotropy","vAnisotropyInfos","anisotropyMatrix")},e.PrepareUniformBuffer=function(a){a.addUniform("vAnisotropy",3),a.addUniform("vAnisotropyInfos",2),a.addUniform("anisotropyMatrix",16)},e.AddSamplers=function(a){a.push("anisotropySampler")},e.prototype.copyTo=function(a){g.a.Clone(function(){return a},this)},e.prototype.serialize=function(){return g.a.Serialize(this)},e.prototype.parse=function(a){var b=this;g.a.Parse(function(){return b},a,null)},v.c([Object(g.c)()],e.prototype,"_isEnabled",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),v.c([Object(g.c)()],e.prototype,"intensity",void 0),v.c([Object(g.n)()],e.prototype,"direction",void 0),v.c([Object(g.m)()],e.prototype,"_texture",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),e}(),oj=function(){function e(a){this._useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this._internalMarkAllSubMeshesAsMiscDirty=a}return e.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},e.prototype.prepareDefines=function(a){a.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,a.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,a.SPHERICAL_HARMONICS=this._useSphericalHarmonics},e.prototype.getClassName=function(){return"PBRBRDFConfiguration"},e.prototype.copyTo=function(a){g.a.Clone(function(){return a},this)},e.prototype.serialize=function(){return g.a.Serialize(this)},e.prototype.parse=function(a){var b=this;g.a.Parse(function(){return b},a,null)},e.DEFAULT_USE_ENERGY_CONSERVATION=!0,e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,e.DEFAULT_USE_SPHERICAL_HARMONICS=!0,v.c([Object(g.c)()],e.prototype,"_useEnergyConservation",void 0),v.c([Object(g.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useEnergyConservation",void 0),v.c([Object(g.c)()],e.prototype,"_useSmithVisibilityHeightCorrelated",void 0),v.c([Object(g.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSmithVisibilityHeightCorrelated",void 0),v.c([Object(g.c)()],e.prototype,"_useSphericalHarmonics",void 0),v.c([Object(g.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSphericalHarmonics",void 0),e}(),fd=function(){function e(a){this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=j.e.White(),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=a}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(a,b){return!(a._areTexturesDirty&&b.texturesEnabled&&this._texture&&Ra.a.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())},e.prototype.prepareDefines=function(a,b){this._isEnabled?(a.SHEEN=this._isEnabled,a.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,a._areTexturesDirty&&b.texturesEnabled&&(this._texture&&Ra.a.SheenTextureEnabled?Ta.a.PrepareDefinesForMergedUV(this._texture,a,"SHEEN_TEXTURE"):a.SHEEN_TEXTURE=!1)):(a.SHEEN=!1,a.SHEEN_TEXTURE=!1,a.SHEEN_LINKWITHALBEDO=!1)},e.prototype.bindForSubMesh=function(a,b,c){a.useUbo&&c&&a.isSync||(this._texture&&Ra.a.SheenTextureEnabled&&(a.updateFloat2("vSheenInfos",this._texture.coordinatesIndex,this._texture.level),Ta.a.BindTextureMatrix(this._texture,a,"sheen")),a.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity)),b.texturesEnabled&&this._texture&&Ra.a.SheenTextureEnabled&&a.setTexture("sheenSampler",this._texture)},e.prototype.hasTexture=function(a){return this._texture===a},e.prototype.getActiveTextures=function(a){this._texture&&a.push(this._texture)},e.prototype.getAnimatables=function(a){this._texture&&this._texture.animations&&this._texture.animations.length>0&&a.push(this._texture)},e.prototype.dispose=function(a){a&&this._texture&&this._texture.dispose()},e.prototype.getClassName=function(){return"PBRSheenConfiguration"},e.AddFallbacks=function(a,b,c){return a.SHEEN&&b.addFallback(c++,"SHEEN"),c},e.AddUniforms=function(a){a.push("vSheenColor","vSheenInfos","sheenMatrix")},e.PrepareUniformBuffer=function(a){a.addUniform("vSheenColor",4),a.addUniform("vSheenInfos",2),a.addUniform("sheenMatrix",16)},e.AddSamplers=function(a){a.push("sheenSampler")},e.prototype.copyTo=function(a){g.a.Clone(function(){return a},this)},e.prototype.serialize=function(){return g.a.Serialize(this)},e.prototype.parse=function(a){var b=this;g.a.Parse(function(){return b},a,null)},v.c([Object(g.c)()],e.prototype,"_isEnabled",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),v.c([Object(g.c)()],e.prototype,"_linkSheenWithAlbedo",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkSheenWithAlbedo",void 0),v.c([Object(g.c)()],e.prototype,"intensity",void 0),v.c([Object(g.e)()],e.prototype,"color",void 0),v.c([Object(g.m)()],e.prototype,"_texture",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),e}(),gd=function(){function e(a){this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isScatteringEnabled=!1,this.refractionIntensity=1,this.translucencyIntensity=1,this.scatteringIntensity=1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1,this.indexOfRefraction=1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.tintColor=j.e.White(),this.tintColorAtDistance=1,this.diffusionDistance=j.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._internalMarkAllSubMeshesAsTexturesDirty=a}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(a,b){if(a._areTexturesDirty&&b.texturesEnabled){if(this._thicknessTexture&&Ra.a.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var c=this._getRefractionTexture(b);if(c&&Ra.a.RefractionTextureEnabled&&!c.isReadyOrNotBlocking())return!1}return!0},e.prototype.prepareDefines=function(a,b){if(a._areTexturesDirty&&(a.SUBSURFACE=!1,a.SS_TRANSLUCENCY=this._isTranslucencyEnabled,a.SS_SCATERRING=this._isScatteringEnabled,a.SS_THICKNESSANDMASK_TEXTURE=!1,a.SS_MASK_FROM_THICKNESS_TEXTURE=!1,a.SS_REFRACTION=!1,a.SS_REFRACTIONMAP_3D=!1,a.SS_GAMMAREFRACTION=!1,a.SS_RGBDREFRACTION=!1,a.SS_REFRACTIONMAP_OPPOSITEZ=!1,a.SS_LODINREFRACTIONALPHA=!1,a.SS_LINKREFRACTIONTOTRANSPARENCY=!1,(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)&&(a.SUBSURFACE=!0,a._areTexturesDirty&&b.texturesEnabled&&this._thicknessTexture&&Ra.a.ThicknessTextureEnabled&&Ta.a.PrepareDefinesForMergedUV(this._thicknessTexture,a,"SS_THICKNESSANDMASK_TEXTURE"),a.SS_MASK_FROM_THICKNESS_TEXTURE=this._useMaskFromThicknessTexture),this._isRefractionEnabled&&b.texturesEnabled)){var c=this._getRefractionTexture(b);c&&Ra.a.RefractionTextureEnabled&&(a.SS_REFRACTION=!0,a.SS_REFRACTIONMAP_3D=c.isCube,a.SS_GAMMAREFRACTION=c.gammaSpace,a.SS_RGBDREFRACTION=c.isRGBD,a.SS_REFRACTIONMAP_OPPOSITEZ=c.invertZ,a.SS_LODINREFRACTIONALPHA=c.lodLevelInAlpha,a.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency)}},e.prototype.bindForSubMesh=function(a,b,c,d,f){var h=this._getRefractionTexture(b);if(!a.useUbo||!d||!a.isSync){if(this._thicknessTexture&&Ra.a.ThicknessTextureEnabled&&(a.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),Ta.a.BindTextureMatrix(this._thicknessTexture,a,"thickness")),a.updateFloat2("vThicknessParam",this.minimumThickness,this.maximumThickness-this.minimumThickness),h&&Ra.a.RefractionTextureEnabled){a.updateMatrix("refractionMatrix",h.getReflectionTextureMatrix());var i=1;h.isCube||h.depth&&(i=h.depth),a.updateFloat4("vRefractionInfos",h.level,1/this._indexOfRefraction,i,this._invertRefractionY?-1:1),a.updateFloat3("vRefractionMicrosurfaceInfos",h.getSize().width,h.lodGenerationScale,h.lodGenerationOffset)}a.updateColor3("vDiffusionDistance",this.diffusionDistance),a.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,this.tintColorAtDistance),a.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,this.scatteringIntensity)}b.texturesEnabled&&(this._thicknessTexture&&Ra.a.ThicknessTextureEnabled&&a.setTexture("thicknessSampler",this._thicknessTexture),h&&Ra.a.RefractionTextureEnabled&&(f?a.setTexture("refractionSampler",h):(a.setTexture("refractionSampler",h._lodTextureMid||h),a.setTexture("refractionSamplerLow",h._lodTextureLow||h),a.setTexture("refractionSamplerHigh",h._lodTextureHigh||h))))},e.prototype.unbind=function(a){return!(!this._refractionTexture||!this._refractionTexture.isRenderTarget)&&(a.setTexture("refractionSampler",null),!0)},e.prototype._getRefractionTexture=function(a){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?a.environmentTexture:null},Object.defineProperty(e.prototype,"disableAlphaBlending",{get:function(){return this.isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!0,configurable:!0}),e.prototype.fillRenderTargetTextures=function(a){Ra.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&a.push(this._refractionTexture)},e.prototype.hasTexture=function(a){return this._thicknessTexture===a||this._refractionTexture===a},e.prototype.hasRenderTargetTextures=function(){return!!(Ra.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},e.prototype.getActiveTextures=function(a){this._thicknessTexture&&a.push(this._thicknessTexture),this._refractionTexture&&a.push(this._refractionTexture)},e.prototype.getAnimatables=function(a){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&a.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&a.push(this._refractionTexture)},e.prototype.dispose=function(a){a&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},e.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},e.AddFallbacks=function(a,b,c){return a.SS_SCATERRING&&b.addFallback(c++,"SS_SCATERRING"),a.SS_TRANSLUCENCY&&b.addFallback(c++,"SS_TRANSLUCENCY"),c},e.AddUniforms=function(a){a.push("vDiffusionDistance","vTintColor","vSubSurfaceIntensity","vRefractionMicrosurfaceInfos","vRefractionInfos","vThicknessInfos","vThicknessParam","refractionMatrix","thicknessMatrix")},e.AddSamplers=function(a){a.push("thicknessSampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},e.PrepareUniformBuffer=function(a){a.addUniform("vRefractionMicrosurfaceInfos",3),a.addUniform("vRefractionInfos",4),a.addUniform("refractionMatrix",16),a.addUniform("vThicknessInfos",2),a.addUniform("thicknessMatrix",16),a.addUniform("vThicknessParam",2),a.addUniform("vDiffusionDistance",3),a.addUniform("vTintColor",4),a.addUniform("vSubSurfaceIntensity",3)},e.prototype.copyTo=function(a){g.a.Clone(function(){return a},this)},e.prototype.serialize=function(){return g.a.Serialize(this)},e.prototype.parse=function(a){var b=this;g.a.Parse(function(){return b},a,null)},v.c([Object(g.c)()],e.prototype,"_isRefractionEnabled",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isRefractionEnabled",void 0),v.c([Object(g.c)()],e.prototype,"_isTranslucencyEnabled",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isTranslucencyEnabled",void 0),v.c([Object(g.c)()],e.prototype,"_isScatteringEnabled",void 0),v.c([Object(g.c)()],e.prototype,"refractionIntensity",void 0),v.c([Object(g.c)()],e.prototype,"translucencyIntensity",void 0),v.c([Object(g.c)()],e.prototype,"scatteringIntensity",void 0),v.c([Object(g.m)()],e.prototype,"_thicknessTexture",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"thicknessTexture",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"refractionTexture",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"indexOfRefraction",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"invertRefractionY",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkRefractionWithTransparency",void 0),v.c([Object(g.c)()],e.prototype,"minimumThickness",void 0),v.c([Object(g.c)()],e.prototype,"maximumThickness",void 0),v.c([Object(g.e)()],e.prototype,"tintColor",void 0),v.c([Object(g.c)()],e.prototype,"tintColorAtDistance",void 0),v.c([Object(g.e)()],e.prototype,"diffusionDistance",void 0),v.c([Object(g.c)()],e.prototype,"_useMaskFromThicknessTexture",void 0),v.c([Object(g.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useMaskFromThicknessTexture",void 0),e}(),pj=`uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;

uniform vec4 vLightingIntensity;
uniform vec4 vReflectivityColor;
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef ALBEDO
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform vec4 vAmbientInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
#endif

#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION)
uniform mat4 view;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif

#ifdef CLEARCOAT
uniform vec2 vClearCoatParams;
uniform vec4 vClearCoatRefractionParams;
#ifdef CLEARCOAT_TEXTURE
uniform vec2 vClearCoatInfos;
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;
uniform vec2 vClearCoatTangentSpaceParams;
uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT
uniform vec4 vClearCoatTintParams;
uniform float clearCoatColorAtDistance;
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
#endif
#endif
#endif

#ifdef ANISOTROPIC
uniform vec3 vAnisotropy;
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
#endif
#endif

#ifdef SHEEN
uniform vec4 vSheenColor;
#ifdef SHEEN_TEXTURE
uniform vec2 vSheenInfos;
uniform mat4 sheenMatrix;
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;;
#endif
uniform vec2 vThicknessParam;
uniform vec3 vDiffusionDistance;
uniform vec4 vTintColor;
uniform vec3 vSubSurfaceIntensity;
#endif`;Ia.a.IncludesShadersStore.pbrFragmentDeclaration=pj;var qj=`layout(std140,column_major) uniform;
uniform Material
{
uniform vec2 vAlbedoInfos;
uniform vec4 vAmbientInfos;
uniform vec2 vOpacityInfos;
uniform vec2 vEmissiveInfos;
uniform vec2 vLightmapInfos;
uniform vec3 vReflectivityInfos;
uniform vec2 vMicroSurfaceSamplerInfos;
uniform vec2 vReflectionInfos;
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
uniform vec3 vBumpInfos;
uniform mat4 albedoMatrix;
uniform mat4 ambientMatrix;
uniform mat4 opacityMatrix;
uniform mat4 emissiveMatrix;
uniform mat4 lightmapMatrix;
uniform mat4 reflectivityMatrix;
uniform mat4 microSurfaceSamplerMatrix;
uniform mat4 bumpMatrix;
uniform vec2 vTangentSpaceParams;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;
uniform vec4 vLightingIntensity;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float pointSize;
uniform vec4 vReflectivityColor;
uniform vec3 vEmissiveColor;
uniform float visibility;
uniform vec2 vClearCoatParams;
uniform vec4 vClearCoatRefractionParams;
uniform vec2 vClearCoatInfos;
uniform mat4 clearCoatMatrix;
uniform vec2 vClearCoatBumpInfos;
uniform vec2 vClearCoatTangentSpaceParams;
uniform mat4 clearCoatBumpMatrix;
uniform vec4 vClearCoatTintParams;
uniform float clearCoatColorAtDistance;
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
uniform vec3 vAnisotropy;
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
uniform vec4 vSheenColor;
uniform vec2 vSheenInfos;
uniform mat4 sheenMatrix;
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
uniform vec2 vThicknessParam;
uniform vec3 vDiffusionDistance;
uniform vec4 vTintColor;
uniform vec3 vSubSurfaceIntensity;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};`;Ia.a.IncludesShadersStore.pbrUboDeclaration=qj;var rj=`uniform vec4 vEyePosition;
uniform vec3 vAmbientColor;
uniform vec4 vCameraInfos;

varying vec3 vPositionW;
#if DEBUGMODE>0
uniform vec2 vDebugMode;
varying vec4 vClipSpacePosition;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif`;Ia.a.IncludesShadersStore.pbrFragmentExtraDeclaration=rj;var sj=`#ifdef ALBEDO
#if ALBEDODIRECTUV == 1
#define vAlbedoUV vMainUV1
#elif ALBEDODIRECTUV == 2
#define vAlbedoUV vMainUV2
#else
varying vec2 vAlbedoUV;
#endif
uniform sampler2D albedoSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFLECTIVITY
#if REFLECTIVITYDIRECTUV == 1
#define vReflectivityUV vMainUV1
#elif REFLECTIVITYDIRECTUV == 2
#define vReflectivityUV vMainUV2
#else
varying vec2 vReflectivityUV;
#endif
uniform sampler2D reflectivitySampler;
#endif
#ifdef MICROSURFACEMAP
#if MICROSURFACEMAPDIRECTUV == 1
#define vMicroSurfaceSamplerUV vMainUV1
#elif MICROSURFACEMAPDIRECTUV == 2
#define vMicroSurfaceSamplerUV vMainUV2
#else
varying vec2 vMicroSurfaceSamplerUV;
#endif
uniform sampler2D microSurfaceSampler;
#endif
#ifdef CLEARCOAT
#ifdef CLEARCOAT_TEXTURE
#if CLEARCOAT_TEXTUREDIRECTUV == 1
#define vClearCoatUV vMainUV1
#elif CLEARCOAT_TEXTUREDIRECTUV == 2
#define vClearCoatUV vMainUV2
#else
varying vec2 vClearCoatUV;
#endif
uniform sampler2D clearCoatSampler;
#endif
#ifdef CLEARCOAT_BUMP
#if CLEARCOAT_BUMPDIRECTUV == 1
#define vClearCoatBumpUV vMainUV1
#elif CLEARCOAT_BUMPDIRECTUV == 2
#define vClearCoatBumpUV vMainUV2
#else
varying vec2 vClearCoatBumpUV;
#endif
uniform sampler2D clearCoatBumpSampler;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
#if CLEARCOAT_TINT_TEXTUREDIRECTUV == 1
#define vClearCoatTintUV vMainUV1
#elif CLEARCOAT_TINT_TEXTUREDIRECTUV == 2
#define vClearCoatTintUV vMainUV2
#else
varying vec2 vClearCoatTintUV;
#endif
uniform sampler2D clearCoatTintSampler;
#endif
#endif
#ifdef SHEEN
#ifdef SHEEN_TEXTURE
#if SHEEN_TEXTUREDIRECTUV == 1
#define vSheenUV vMainUV1
#elif SHEEN_TEXTUREDIRECTUV == 2
#define vSheenUV vMainUV2
#else
varying vec2 vSheenUV;
#endif
uniform sampler2D sheenSampler;
#endif
#endif
#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
#if ANISOTROPIC_TEXTUREDIRECTUV == 1
#define vAnisotropyUV vMainUV1
#elif ANISOTROPIC_TEXTUREDIRECTUV == 2
#define vAnisotropyUV vMainUV2
#else
varying vec2 vAnisotropyUV;
#endif
uniform sampler2D anisotropySampler;
#endif
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#endif
#ifdef ENVIRONMENTBRDF
uniform sampler2D environmentBrdfSampler;
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
#ifdef SS_REFRACTIONMAP_3D
#define sampleRefraction(s,c) textureCube(s,c)
uniform samplerCube refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube refractionSamplerLow;
uniform samplerCube refractionSamplerHigh;
#endif
#else
#define sampleRefraction(s,c) texture2D(s,c)
uniform sampler2D refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube refractionSamplerLow;
uniform samplerCube refractionSamplerHigh;
#endif
#endif
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
#if SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 1
#define vThicknessUV vMainUV1
#elif SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 2
#define vThicknessUV vMainUV2
#else
varying vec2 vThicknessUV;
#endif
uniform sampler2D thicknessSampler;
#endif
#endif`;Ia.a.IncludesShadersStore.pbrFragmentSamplersDeclaration=sj,l(88);var tj=`
#define RECIPROCAL_PI2 0.15915494
#define RECIPROCAL_PI 0.31830988618

#define MINIMUMVARIANCE 0.0005
float convertRoughnessToAverageSlope(float roughness)
{

return square(roughness)+MINIMUMVARIANCE;
}
float fresnelGrazingReflectance(float reflectance0) {


float reflectance90=saturate(reflectance0*25.0);
return reflectance90;
}
vec2 getAARoughnessFactors(vec3 normalVector) {
#ifdef SPECULARAA
vec3 nDfdx=dFdx(normalVector.xyz);
vec3 nDfdy=dFdy(normalVector.xyz);
float slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));

float geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);

float geometricAlphaGFactor=sqrt(slopeSquare);

geometricAlphaGFactor*=0.75;
return vec2(geometricRoughnessFactor,geometricAlphaGFactor);
#else
return vec2(0.);
#endif
}
#ifdef ANISOTROPIC


vec2 getAnisotropicRoughness(float alphaG,float anisotropy) {
float alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);
float alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);
return vec2(alphaT,alphaB);
}


vec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {
vec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;
vec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);
vec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);
vec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));
return anisotropicNormal;

}
#endif
#if defined(CLEARCOAT) || defined(SS_REFRACTION)



vec3 cocaLambert(vec3 alpha,float distance) {
return exp(-alpha*distance);
}

vec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {
return cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));
}

vec3 computeColorAtDistanceInMedia(vec3 color,float distance) {
return -log(color)/distance;
}
vec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {
vec3 clearCoatAbsorption=mix(vec3(1.0),
cocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),
clearCoatIntensity);
return clearCoatAbsorption;
}
#endif




#ifdef MICROSURFACEAUTOMATIC
float computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)
{
const float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;
float reflectivityLuminance=getLuminance(reflectivityColor);
float reflectivityLuma=sqrt(reflectivityLuminance);
microSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;
return microSurface;
}
#endif`;Ia.a.IncludesShadersStore.pbrHelperFunctions=tj;var uj=`#ifdef USESPHERICALFROMREFLECTIONMAP
#ifdef SPHERICAL_HARMONICS
uniform vec3 vSphericalL00;
uniform vec3 vSphericalL1_1;
uniform vec3 vSphericalL10;
uniform vec3 vSphericalL11;
uniform vec3 vSphericalL2_2;
uniform vec3 vSphericalL2_1;
uniform vec3 vSphericalL20;
uniform vec3 vSphericalL21;
uniform vec3 vSphericalL22;







vec3 computeEnvironmentIrradiance(vec3 normal) {
return vSphericalL00
+vSphericalL1_1*(normal.y)
+vSphericalL10*(normal.z)
+vSphericalL11*(normal.x)
+vSphericalL2_2*(normal.y*normal.x)
+vSphericalL2_1*(normal.y*normal.z)
+vSphericalL20*((3.0*normal.z*normal.z)-1.0)
+vSphericalL21*(normal.z*normal.x)
+vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));
}
#else
uniform vec3 vSphericalX;
uniform vec3 vSphericalY;
uniform vec3 vSphericalZ;
uniform vec3 vSphericalXX_ZZ;
uniform vec3 vSphericalYY_ZZ;
uniform vec3 vSphericalZZ;
uniform vec3 vSphericalXY;
uniform vec3 vSphericalYZ;
uniform vec3 vSphericalZX;

vec3 computeEnvironmentIrradiance(vec3 normal) {









float Nx=normal.x;
float Ny=normal.y;
float Nz=normal.z;
vec3 C1=vSphericalZZ.rgb;
vec3 Cx=vSphericalX.rgb;
vec3 Cy=vSphericalY.rgb;
vec3 Cz=vSphericalZ.rgb;
vec3 Cxx_zz=vSphericalXX_ZZ.rgb;
vec3 Cyy_zz=vSphericalYY_ZZ.rgb;
vec3 Cxy=vSphericalXY.rgb;
vec3 Cyz=vSphericalYZ.rgb;
vec3 Czx=vSphericalZX.rgb;
vec3 a1=Cyy_zz*Ny+Cy;
vec3 a2=Cyz*Nz+a1;
vec3 b1=Czx*Nz+Cx;
vec3 b2=Cxy*Ny+b1;
vec3 b3=Cxx_zz*Nx+b2;
vec3 t1=Cz*Nz+C1;
vec3 t2=a2*Ny+t1;
vec3 t3=b3*Nx+t2;
return t3;
}
#endif
#endif`;Ia.a.IncludesShadersStore.harmonicsFunctions=uj;var vj=`
struct preLightingInfo
{

vec3 lightOffset;
float lightDistanceSquared;
float lightDistance;

float attenuation;

vec3 L;
vec3 H;
float NdotV;
float NdotLUnclamped;
float NdotL;
float VdotH;
float roughness;
};
preLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;

result.lightOffset=lightData.xyz-vPositionW;
result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);

result.lightDistance=sqrt(result.lightDistanceSquared);

result.L=normalize(result.lightOffset);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
result.NdotLUnclamped=dot(N,result.L);
result.NdotL=saturateEps(result.NdotLUnclamped);
return result;
}
preLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;

result.lightDistance=length(-lightData.xyz);

result.L=normalize(-lightData.xyz);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
result.NdotLUnclamped=dot(N,result.L);
result.NdotL=saturateEps(result.NdotLUnclamped);
return result;
}
preLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;


result.NdotL=dot(N,lightData.xyz)*0.5+0.5;
result.NdotL=saturateEps(result.NdotL);
result.NdotLUnclamped=result.NdotL;
#ifdef SPECULARTERM
result.L=normalize(lightData.xyz);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
#endif
return result;
}`;Ia.a.IncludesShadersStore.pbrDirectLightingSetupFunctions=vj;var wj=`float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)
{
return max(0.,1.0-length(lightOffset)/range);
}
float computeDistanceLightFalloff_Physical(float lightDistanceSquared)
{
return 1.0/maxEps(lightDistanceSquared);
}
float computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)
{
float lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);
float factor=lightDistanceSquared*inverseSquaredRange;
float attenuation=saturate(1.0-factor*factor);
attenuation*=attenuation;

lightDistanceFalloff*=attenuation;
return lightDistanceFalloff;
}
float computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDistanceLightFalloff_Physical(lightDistanceSquared);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);
#else
return computeDistanceLightFalloff_Standard(lightOffset,range);
#endif
}
float computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)
{
float falloff=0.0;
float cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));
if (cosAngle>=cosHalfAngle)
{
falloff=max(0.,pow(cosAngle,exponent));
}
return falloff;
}
float computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)
{
const float kMinusLog2ConeAngleIntensityRatio=6.64385618977;





float concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);


vec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);
float falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));
return falloff;
}
float computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)
{



float cd=dot(-lightDirection,directionToLightCenterW);
float falloff=saturate(cd*lightAngleScale+lightAngleOffset);

falloff*=falloff;
return falloff;
}
float computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);
#else
return computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);
#endif
}`;Ia.a.IncludesShadersStore.pbrDirectLightingFalloffFunctions=wj;var xj=`
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25




#ifdef MS_BRDF_ENERGY_CONSERVATION


vec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);
}
#endif
#ifdef ENVIRONMENTBRDF
vec3 getBRDFLookup(float NdotV,float perceptualRoughness,sampler2D brdfSampler) {

vec2 UV=vec2(NdotV,perceptualRoughness);

vec4 brdfLookup=texture2D(brdfSampler,UV);
#ifdef ENVIRONMENTBRDF_RGBD
brdfLookup.rgb=fromRGBD(brdfLookup.rgba);
#endif
return brdfLookup.rgb;
}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);
#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;
#endif
return reflectance;
}
#endif
#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)
vec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
#if defined(SHEEN) && defined(REFLECTION)

vec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {
vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;
return sheenEnvironmentReflectance;
}
#endif























vec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
float fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
#ifdef CLEARCOAT





vec3 getR0RemappedForClearCoat(vec3 f0) {
#ifdef CLEARCOAT_DEFAULTIOR
#ifdef MOBILE
return saturate(f0*(f0*0.526868+0.529324)-0.0482256);
#else
return saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);
#endif
#else
vec3 s=sqrt(f0);
vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);
return t*t;
#endif
}
#endif






float normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)
{



float a2=square(alphaG);
float d=NdotH*NdotH*(a2-1.0)+1.0;
return a2/(PI*d*d);
}
#ifdef SHEEN

float normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)
{
float invR=1./alphaG;
float cos2h=NdotH*NdotH;
float sin2h=1.-cos2h;
return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);
}
#endif
#ifdef ANISOTROPIC


float normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {
float a2=alphaTB.x*alphaTB.y;
vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x*BdotH,a2*NdotH);
float v2=dot(v,v);
float w2=a2/v2;
return a2*w2*w2*RECIPROCAL_PI;
}
#endif




#ifdef BRDF_V_HEIGHT_CORRELATED



float smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {
#ifdef MOBILE

float GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);
float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);
return 0.5/(GGXV+GGXL);
#else
float a2=alphaG*alphaG;
float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);
float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);
return 0.5/(GGXV+GGXL);
#endif
}
#else















float smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)
{
#ifdef MOBILE

return 1.0/(dot+alphaG+(1.0-alphaG)*dot ));
#else
float alphaSquared=alphaG*alphaG;
return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));
#endif
}
float smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)
{
float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);

return visibility;
}
#endif
#ifdef ANISOTROPIC


float smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {
float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));
float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));
float v=0.5/(lambdaV+lambdaL);
return v;
}
#endif
#ifdef CLEARCOAT
float visibility_Kelemen(float VdotH) {



return 0.25/(VdotH*VdotH);
}
#endif
#ifdef SHEEN



float visibility_Ashikhmin(float NdotL,float NdotV)
{
return 1./(4.*(NdotL+NdotV-NdotL*NdotV));
}
#endif







float diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {


float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));
float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));
float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;
float fresnel =
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);
return fresnel/PI;
}
#ifdef SS_TRANSLUCENCY


vec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {
vec3 S=1./maxEps(diffusionDistance);
vec3 temp=exp((-0.333333333*thickness)*S);
return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);
}


float computeWrappedDiffuseNdotL(float NdotL,float w) {
float t=1.0+w;
float invt2=1.0/square(t);
return saturate((NdotL+w)*invt2);
}
#endif
`;Ia.a.IncludesShadersStore.pbrBRDFFunctions=xj;var yj=`#define CLEARCOATREFLECTANCE90 1.0

struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef CLEARCOAT


vec4 clearCoat;
#endif
#ifdef SHEEN
vec3 sheen;
#endif
};

float adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {
#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)

float lightRoughness=lightRadius/lightDistance;

float totalRoughness=saturate(lightRoughness+roughness);
return totalRoughness;
#else
return roughness;
#endif
}
vec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {
return mix(groundColor,lightColor,info.NdotL);
}
vec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {
float diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);
return diffuseTerm*info.attenuation*info.NdotL*lightColor;
}
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return toLinearSpace(textureColor);
}
#ifdef SS_TRANSLUCENCY
vec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {
float NdotL=absEps(info.NdotLUnclamped);

float wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);

float trAdapt=step(0.,info.NdotLUnclamped);
vec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);
float diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);
return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;
}
#endif
#ifdef SPECULARTERM
vec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float roughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);
vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);
#ifdef BRDF_V_HEIGHT_CORRELATED
float visibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);
#else
float visibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);
#endif
vec3 specTerm=fresnel*distribution*visibility;
return specTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
#ifdef ANISOTROPIC
vec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float TdotH=dot(T,info.H);
float BdotH=dot(B,info.H);
float TdotV=dot(T,V);
float BdotV=dot(B,V);
float TdotL=dot(T,info.L);
float BdotL=dot(B,info.L);
float alphaG=convertRoughnessToAverageSlope(info.roughness);
vec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);
alphaTB=max(alphaTB,square(geometricRoughnessFactor));
vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
float distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);
float visibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);
vec3 specTerm=fresnel*distribution*visibility;
return specTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
#ifdef CLEARCOAT
vec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {
float NccdotL=saturateEps(dot(Ncc,info.L));
float NccdotH=saturateEps(dot(Ncc,info.H));
float clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
float fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);
fresnel*=clearCoatIntensity;
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);
float visibility=visibility_Kelemen(info.VdotH);
float clearCoatTerm=fresnel*distribution*visibility;
return vec4(
clearCoatTerm*info.attenuation*NccdotL*lightColor,
1.0-fresnel
);
}
vec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {
vec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);
float NdotLRefract=saturateEps(dot(Ncc,LRefract));
vec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);
return absorption;
}
#endif
#ifdef SHEEN
vec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float roughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);


vec3 fresnel=reflectance0;
float distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);
float visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);
vec3 sheenTerm=fresnel*distribution*visibility;
return sheenTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
`;Ia.a.IncludesShadersStore.pbrDirectLightingFunctions=yj;var zj=`#if defined(REFLECTION) || defined(SS_REFRACTION)
float getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {
float microsurfaceAverageSlopeTexels=microsurfaceAverageSlope*cubeMapDimensionPixels;
float lod=log2(microsurfaceAverageSlopeTexels);
return lod;
}
#endif
#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)
float environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {


float temp=NdotVUnclamped+ambientOcclusion;
return saturate(square(temp)-1.0+ambientOcclusion);
}
#endif
#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)
float environmentHorizonOcclusion(vec3 view,vec3 normal) {

vec3 reflection=reflect(view,normal);
float temp=saturate(1.0+1.1*dot(reflection,normal));
return square(temp);
}
#endif




#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)


#define UNPACK_LOD(x) (1.0-x)*255.0
float getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {
float microsurfaceAverageSlope=alphaG;






microsurfaceAverageSlope*=sqrt(abs(NdotV));
return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);
}
#endif`;Ia.a.IncludesShadersStore.pbrIBLFunctions=zj,l(121),l(122),l(123),l(115);var Aj=`#if DEBUGMODE>0
if (vClipSpacePosition.x/vClipSpacePosition.w<vDebugMode.x) {
return;
}

#if DEBUGMODE == 1
gl_FragColor.rgb=vPositionW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 2 && defined(NORMAL)
gl_FragColor.rgb=vNormalW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 3 && (defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC))

gl_FragColor.rgb=TBN[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 4 && (defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC))

gl_FragColor.rgb=TBN[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 5

gl_FragColor.rgb=normalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 6 && defined(MAINUV1)
gl_FragColor.rgb=vec3(vMainUV1,0.0);
#elif DEBUGMODE == 7 && defined(MAINUV2)
gl_FragColor.rgb=vec3(vMainUV2,0.0);
#elif DEBUGMODE == 8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)

gl_FragColor.rgb=TBNClearCoat[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)

gl_FragColor.rgb=TBNClearCoat[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 10 && defined(CLEARCOAT)

gl_FragColor.rgb=clearCoatNormalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 11 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicNormal;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 12 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicTangent;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 13 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicBitangent;
#define DEBUGMODE_NORMALIZE

#elif DEBUGMODE == 20 && defined(ALBEDO)
gl_FragColor.rgb=albedoTexture.rgb;
#elif DEBUGMODE == 21 && defined(AMBIENT)
gl_FragColor.rgb=ambientOcclusionColorMap.rgb;
#elif DEBUGMODE == 22 && defined(OPACITY)
gl_FragColor.rgb=opacityMap.rgb;
#elif DEBUGMODE == 23 && defined(EMISSIVE)
gl_FragColor.rgb=emissiveColorTex.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 24 && defined(LIGHTMAP)
gl_FragColor.rgb=lightmapColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)
gl_FragColor.rgb=surfaceMetallicColorMap.rgb;
#elif DEBUGMODE == 26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)
gl_FragColor.rgb=surfaceReflectivityColorMap.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)
gl_FragColor.rgb=vec3(clearCoatMapData.rg,0.0);
#elif DEBUGMODE == 28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
gl_FragColor.rgb=clearCoatTintMapData.rgb;
#elif DEBUGMODE == 29 && defined(SHEEN) && defined(SHEEN_TEXTURE)
gl_FragColor.rgb=sheenMapData.rgb;
#elif DEBUGMODE == 30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)
gl_FragColor.rgb=anisotropyMapData.rgb;
#elif DEBUGMODE == 31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)
gl_FragColor.rgb=thicknessMap.rgb;

#elif DEBUGMODE == 40 && defined(SS_REFRACTION)

gl_FragColor.rgb=environmentRefraction.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 41 && defined(REFLECTION)
gl_FragColor.rgb=environmentRadiance.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 42 && defined(CLEARCOAT) && defined(REFLECTION)
gl_FragColor.rgb=environmentClearCoatRadiance;
#define DEBUGMODE_GAMMA

#elif DEBUGMODE == 50
gl_FragColor.rgb=diffuseBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 51 && defined(SPECULARTERM)
gl_FragColor.rgb=specularBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 52 && defined(CLEARCOAT)
gl_FragColor.rgb=clearCoatBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 53 && defined(SHEEN)
gl_FragColor.rgb=sheenBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 54 && defined(REFLECTION)
gl_FragColor.rgb=environmentIrradiance.rgb;
#define DEBUGMODE_GAMMA

#elif DEBUGMODE == 60
gl_FragColor.rgb=surfaceAlbedo.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 61
gl_FragColor.rgb=specularEnvironmentR0;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 62
gl_FragColor.rgb=vec3(roughness);
#elif DEBUGMODE == 63
gl_FragColor.rgb=vec3(alphaG);
#elif DEBUGMODE == 64
gl_FragColor.rgb=vec3(NdotV);
#elif DEBUGMODE == 65 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)
gl_FragColor.rgb=clearCoatColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 66 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearCoatRoughness);
#elif DEBUGMODE == 67 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearCoatNdotV);
#elif DEBUGMODE == 68 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)
gl_FragColor.rgb=transmittance;
#elif DEBUGMODE == 69 && defined(SUBSURFACE) && defined(SS_REFRACTION)
gl_FragColor.rgb=refractionTransmittance;

#elif DEBUGMODE == 70 && defined(RADIANCEOCCLUSION)
gl_FragColor.rgb=vec3(seo);
#elif DEBUGMODE == 71 && defined(HORIZONOCCLUSION)
gl_FragColor.rgb=vec3(eho);
#elif DEBUGMODE == 72 && defined(MS_BRDF_ENERGY_CONSERVATION)
gl_FragColor.rgb=vec3(energyConservationFactor);
#elif DEBUGMODE == 73 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=specularEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 74 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=clearCoatEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 75 && defined(SHEEN) && defined(REFLECTION)
gl_FragColor.rgb=sheenEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 76 && defined(ALPHABLEND)
gl_FragColor.rgb=vec3(luminanceOverAlpha);
#elif DEBUGMODE == 77
gl_FragColor.rgb=vec3(alpha);
#endif
gl_FragColor.rgb*=vDebugMode.y;
#ifdef DEBUGMODE_NORMALIZE
gl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;
#endif
#ifdef DEBUGMODE_GAMMA
gl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);
#endif
gl_FragColor.a=1.0;
#endif`;Ia.a.IncludesShadersStore.pbrDebug=Aj;var Bj=`#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#extension GL_OES_standard_derivatives : enable
#endif
#ifdef LODBASEDMICROSFURACE
#extension GL_EXT_shader_texture_lod : enable
#endif
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
precision highp float;

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE;
#endif

#include<__decl__pbrFragment>
#include<pbrFragmentExtraDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<pbrFragmentSamplersDeclaration>
#include<imageProcessingDeclaration>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>

#include<helperFunctions>
#include<pbrHelperFunctions>
#include<imageProcessingFunctions>
#include<shadowsFragmentFunctions>
#include<harmonicsFunctions>
#include<pbrDirectLightingSetupFunctions>
#include<pbrDirectLightingFalloffFunctions>
#include<pbrBRDFFunctions>
#include<pbrDirectLightingFunctions>
#include<pbrIBLFunctions>
#include<bumpFragmentFunctions>
#ifdef REFLECTION
#include<reflectionFunction>
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS

void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>

vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#endif
#ifdef CLEARCOAT

vec3 clearCoatNormalW=normalW;
#endif
#include<bumpFragment>
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
vec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#if defined(TWOSIDEDLIGHTING)
faceNormal=gl_FrontFacing ? faceNormal : -faceNormal;
#endif
normalW*=sign(dot(normalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
normalW=gl_FrontFacing ? normalW : -normalW;
#endif


vec3 surfaceAlbedo=vAlbedoColor.rgb;

float alpha=vAlbedoColor.a;
#ifdef ALBEDO
vec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);
#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)
alpha*=albedoTexture.a;
#endif
surfaceAlbedo*=toLinearSpace(albedoTexture.rgb);
surfaceAlbedo*=vAlbedoInfos.y;
#endif
#ifdef VERTEXCOLOR
surfaceAlbedo*=vColor.rgb;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALBEDO

#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
alpha=getLuminance(opacityMap.rgb);
#else
alpha*=opacityMap.a;
#endif
alpha*=vOpacityInfos.y;
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)
#ifdef ALPHATEST
if (alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
#include<depthPrePass>
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

vec3 ambientOcclusionColor=vec3(1.,1.,1.);
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#ifdef AMBIENTINGRAYSCALE
ambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);
#endif
ambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);
#endif
#ifdef UNLIT
vec3 diffuseBase=vec3(1.,1.,1.);
#else

float microSurface=vReflectivityColor.a;
vec3 surfaceReflectivityColor=vReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec2 metallicRoughness=surfaceReflectivityColor.rg;
#ifdef REFLECTIVITY
vec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);
#ifdef AOSTOREINMETALMAPRED
vec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);
ambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);
#endif
#ifdef METALLNESSSTOREINMETALMAPBLUE
metallicRoughness.r*=surfaceMetallicColorMap.b;
#else
metallicRoughness.r*=surfaceMetallicColorMap.r;
#endif
#ifdef ROUGHNESSSTOREINMETALMAPALPHA
metallicRoughness.g*=surfaceMetallicColorMap.a;
#else
#ifdef ROUGHNESSSTOREINMETALMAPGREEN
metallicRoughness.g*=surfaceMetallicColorMap.g;
#endif
#endif
#endif
#ifdef MICROSURFACEMAP
vec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;
metallicRoughness.g*=microSurfaceTexel.r;
#endif
#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS

microSurface=1.0-metallicRoughness.g;

vec3 baseColor=surfaceAlbedo;
#ifdef REFLECTANCE





surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);

surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);
#else



const vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);

surfaceAlbedo=mix(baseColor.rgb*(1.0-DefaultSpecularReflectanceDielectric.r),vec3(0.,0.,0.),metallicRoughness.r);

surfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallicRoughness.r);
#endif
#else
#ifdef REFLECTIVITY
vec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);
surfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);
surfaceReflectivityColor*=vReflectivityInfos.y;
#ifdef MICROSURFACEFROMREFLECTIVITYMAP
microSurface*=surfaceReflectivityColorMap.a;
microSurface*=vReflectivityInfos.z;
#else
#ifdef MICROSURFACEAUTOMATIC
microSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);
#endif
#ifdef MICROSURFACEMAP
vec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;
microSurface*=microSurfaceTexel.r;
#endif
#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE
#endif
#endif
#endif

microSurface=saturate(microSurface);

float roughness=1.-microSurface;

#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)



float opacityPerceptual=alpha;
#ifdef LINEARALPHAFRESNEL
float opacity0=opacityPerceptual;
#else
float opacity0=opacityPerceptual*opacityPerceptual;
#endif
float opacity90=fresnelGrazingReflectance(opacity0);
vec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);

alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;
#ifdef ALPHATEST
if (alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif
#endif
#endif

float NdotVUnclamped=dot(normalW,viewDirectionW);

float NdotV=absEps(NdotVUnclamped);
float alphaG=convertRoughnessToAverageSlope(roughness);
vec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);
#ifdef SPECULARAA

alphaG+=AARoughnessFactors.y;
#endif
#ifdef ANISOTROPIC
float anisotropy=vAnisotropy.b;
vec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);
#ifdef ANISOTROPIC_TEXTURE
vec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;
anisotropy*=anisotropyMapData.b;
anisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;
#endif
mat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));
vec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);
vec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));
vec3 anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);
#endif

#ifdef SS_REFRACTION
vec4 environmentRefraction=vec4(0.,0.,0.,0.);
#ifdef ANISOTROPIC
vec3 refractionVector=refract(-viewDirectionW,anisotropicNormal,vRefractionInfos.y);
#else
vec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);
#endif
#ifdef SS_REFRACTIONMAP_OPPOSITEZ
refractionVector.z*=-1.0;
#endif

#ifdef SS_REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
vec3 refractionCoords=refractionVector;
refractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
#endif
#ifdef SS_LODINREFRACTIONALPHA
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#else
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE

refractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;
#ifdef SS_LODINREFRACTIONALPHA









float automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);
float requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);
#else
float requestedRefractionLOD=refractionLOD;
#endif
environmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);
#else
float lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));
float lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;
vec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);
if(lodRefractionNormalizedDoubled<1.0){
environmentRefraction=mix(
sampleRefraction(refractionSamplerHigh,refractionCoords),
environmentRefractionMid,
lodRefractionNormalizedDoubled
);
}else{
environmentRefraction=mix(
environmentRefractionMid,
sampleRefraction(refractionSamplerLow,refractionCoords),
lodRefractionNormalizedDoubled-1.0
);
}
#endif
#ifdef SS_RGBDREFRACTION
environmentRefraction.rgb=fromRGBD(environmentRefraction);
#endif
#ifdef SS_GAMMAREFRACTION
environmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);
#endif

environmentRefraction.rgb*=vRefractionInfos.x;
#endif

#ifdef REFLECTION
vec4 environmentRadiance=vec4(0.,0.,0.,0.);
vec3 environmentIrradiance=vec3(0.,0.,0.);
#ifdef ANISOTROPIC
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicNormal);
#else
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=reflectionVector;
#else
vec2 reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#else
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE

reflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
#ifdef LODINREFLECTIONALPHA









float automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);
float requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);
#else
float requestedReflectionLOD=reflectionLOD;
#endif
environmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD);
#else
float lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodReflectionNormalizedDoubled<1.0){
environmentRadiance=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
environmentSpecularMid,
lodReflectionNormalizedDoubled
);
}else{
environmentRadiance=mix(
environmentSpecularMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#ifdef RGBDREFLECTION
environmentRadiance.rgb=fromRGBD(environmentRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);
#endif

#ifdef USESPHERICALFROMREFLECTIONMAP
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
environmentIrradiance=vEnvironmentIrradiance;
#else
#ifdef ANISOTROPIC
vec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicNormal,0)).xyz;
#else
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
environmentIrradiance=computeEnvironmentIrradiance(irradianceVector);
#endif
#endif

environmentRadiance.rgb*=vReflectionInfos.x;
environmentRadiance.rgb*=vReflectionColor.rgb;
environmentIrradiance*=vReflectionColor.rgb;
#endif

float reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);
float reflectance90=fresnelGrazingReflectance(reflectance);
vec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;
vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;

#ifdef SHEEN
float sheenIntensity=vSheenColor.a;
#ifdef SHEEN_TEXTURE
vec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset)*vSheenInfos.y;
sheenIntensity*=sheenMapData.a;
#endif
#ifdef SHEEN_LINKWITHALBEDO
float sheenFactor=pow5(1.0-sheenIntensity);
vec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);
float sheenRoughness=sheenIntensity;

surfaceAlbedo.rgb*=sheenFactor;
#else
vec3 sheenColor=vSheenColor.rgb;
#ifdef SHEEN_TEXTURE
sheenColor.rgb*=toLinearSpace(sheenMapData.rgb);
#endif
float sheenRoughness=roughness;

sheenIntensity*=(1.-reflectance);

sheenColor*=sheenIntensity;
#endif

#if defined(REFLECTION)
float sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);
#ifdef SPECULARAA

sheenAlphaG+=AARoughnessFactors.y;
#endif
vec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);

#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float sheenReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,sheenAlphaG,NdotVUnclamped);
#else
float sheenReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,sheenAlphaG);
#endif
#ifdef LODBASEDMICROSFURACE

sheenReflectionLOD=sheenReflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
environmentSheenRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,sheenReflectionLOD);
#else
float lodSheenReflectionNormalized=saturate(sheenReflectionLOD/log2(vReflectionMicrosurfaceInfos.x));
float lodSheenReflectionNormalizedDoubled=lodSheenReflectionNormalized*2.0;
vec4 environmentSheenMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodSheenReflectionNormalizedDoubled<1.0){
environmentSheenRadiance=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
environmentSheenMid,
lodSheenReflectionNormalizedDoubled
);
}else{
environmentSheenRadiance=mix(
environmentSheenMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodSheenReflectionNormalizedDoubled-1.0
);
}
#endif
#ifdef RGBDREFLECTION
environmentSheenRadiance.rgb=fromRGBD(environmentSheenRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentSheenRadiance.rgb=toLinearSpace(environmentSheenRadiance.rgb);
#endif

environmentSheenRadiance.rgb*=vReflectionInfos.x;
environmentSheenRadiance.rgb*=vReflectionColor.rgb;
#endif
#endif

#ifdef CLEARCOAT

float clearCoatIntensity=vClearCoatParams.x;
float clearCoatRoughness=vClearCoatParams.y;
#ifdef CLEARCOAT_TEXTURE
vec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;
clearCoatIntensity*=clearCoatMapData.x;
clearCoatRoughness*=clearCoatMapData.y;
#endif
#ifdef CLEARCOAT_TINT
vec3 clearCoatColor=vClearCoatTintParams.rgb;
float clearCoatThickness=vClearCoatTintParams.a;
#ifdef CLEARCOAT_TINT_TEXTURE
vec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);
clearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);
clearCoatThickness*=clearCoatTintMapData.a;
#endif
clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);
#endif




vec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);
specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);
#ifdef CLEARCOAT_BUMP
#ifdef NORMALXYSCALE
float clearCoatNormalScale=1.0;
#else
float clearCoatNormalScale=vClearCoatBumpInfos.y;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBNClearCoat=vTBN;
#else
mat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,vClearCoatBumpUV,vClearCoatTangentSpaceParams);
#endif
#ifdef OBJECTSPACE_NORMALMAP
clearCoatNormalW=normalize(texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset).xyz*2.0-1.0);
clearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);
#else
clearCoatNormalW=perturbNormal(TBN,vClearCoatBumpUV+uvOffset,clearCoatBumpSampler,vClearCoatBumpInfos.y);
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
clearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
clearCoatNormalW=gl_FrontFacing ? clearCoatNormalW : -clearCoatNormalW;
#endif

vec2 clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);

float clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);

float clearCoatNdotV=absEps(clearCoatNdotVUnclamped);

#if defined(REFLECTION)
float clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
#ifdef SPECULARAA

clearCoatAlphaG+=clearCoatAARoughnessFactors.y;
#endif
vec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);
vec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
clearCoatReflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 clearCoatReflectionCoords=clearCoatReflectionVector;
#else
vec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
clearCoatReflectionCoords/=clearCoatReflectionVector.z;
#endif
clearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float clearCoatReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,clearCoatAlphaG,clearCoatNdotVUnclamped);
#else
float clearCoatReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,clearCoatAlphaG);
#endif
#ifdef LODBASEDMICROSFURACE

clearCoatReflectionLOD=clearCoatReflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
float requestedClearCoatReflectionLOD=clearCoatReflectionLOD;
environmentClearCoatRadiance=sampleReflectionLod(reflectionSampler,clearCoatReflectionCoords,requestedClearCoatReflectionLOD);
#else
float lodClearCoatReflectionNormalized=saturate(clearCoatReflectionLOD/log2(vReflectionMicrosurfaceInfos.x));
float lodClearCoatReflectionNormalizedDoubled=lodClearCoatReflectionNormalized*2.0;
vec4 environmentClearCoatMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodClearCoatReflectionNormalizedDoubled<1.0){
environmentClearCoatRadiance=mix(
sampleReflection(reflectionSamplerHigh,clearCoatReflectionCoords),
environmentClearCoatMid,
lodClearCoatReflectionNormalizedDoubled
);
}else{
environmentClearCoatRadiance=mix(
environmentClearCoatMid,
sampleReflection(reflectionSamplerLow,clearCoatReflectionCoords),
lodClearCoatReflectionNormalizedDoubled-1.0
);
}
#endif
#ifdef RGBDREFLECTION
environmentClearCoatRadiance.rgb=fromRGBD(environmentClearCoatRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentClearCoatRadiance.rgb=toLinearSpace(environmentClearCoatRadiance.rgb);
#endif
#ifdef CLEARCOAT_TINT

vec3 clearCoatVRefract=-refract(vPositionW,clearCoatNormalW,vClearCoatRefractionParams.y);

float clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));
vec3 absorption=vec3(0.);
#endif

environmentClearCoatRadiance.rgb*=vReflectionInfos.x;
environmentClearCoatRadiance.rgb*=vReflectionColor.rgb;
#endif
#endif

#if defined(ENVIRONMENTBRDF)

vec3 environmentBrdf=getBRDFLookup(NdotV,roughness,environmentBrdfSampler);
#ifdef MS_BRDF_ENERGY_CONSERVATION
vec3 energyConservationFactor=getEnergyConservationFactor(specularEnvironmentR0,environmentBrdf);
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
float refractionIntensity=vSubSurfaceIntensity.x;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
refractionIntensity*=(1.0-alpha);

alpha=1.0;
#endif
#endif
#ifdef SS_TRANSLUCENCY
float translucencyIntensity=vSubSurfaceIntensity.y;
#endif
#ifdef SS_SCATTERING
float scatteringIntensity=vSubSurfaceIntensity.z;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);
float thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;
#ifdef SS_MASK_FROM_THICKNESS_TEXTURE
#ifdef SS_REFRACTION
refractionIntensity*=thicknessMap.g;
#endif
#ifdef SS_TRANSLUCENCY
translucencyIntensity*=thicknessMap.b;
#endif
#ifdef SS_SCATTERING
scatteringIntensity*=thicknessMap.a;
#endif
#endif
#else
float thickness=vThicknessParam.y;
#endif
#ifdef SS_TRANSLUCENCY
thickness=maxEps(thickness);
vec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);
transmittance*=translucencyIntensity;
#endif
#endif


vec3 diffuseBase=vec3(0.,0.,0.);
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#ifdef CLEARCOAT
vec3 clearCoatBase=vec3(0.,0.,0.);
#endif
#ifdef SHEEN
vec3 sheenBase=vec3(0.,0.,0.);
#endif
#ifdef LIGHTMAP
vec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb;
#ifdef GAMMALIGHTMAP
lightmapColor=toLinearSpace(lightmapColor);
#endif
lightmapColor*=vLightmapInfos.y;
#endif

preLightingInfo preInfo;
lightingInfo info;
float shadow=1.;
#include<lightFragment>[0..maxSimultaneousLights]

#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
vec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(specularEnvironmentR0,environmentBrdf);
#ifdef RADIANCEOCCLUSION
#ifdef AMBIENTINGRAYSCALE
float ambientMonochrome=ambientOcclusionColor.r;
#else
float ambientMonochrome=getLuminance(ambientOcclusionColor);
#endif
float seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);
specularEnvironmentReflectance*=seo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float eho=environmentHorizonOcclusion(-viewDirectionW,normalW);
specularEnvironmentReflectance*=eho;
#endif
#endif
#endif
#else

vec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));
#endif

#if defined(SHEEN) && defined(REFLECTION)
vec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentBrdf);
#ifdef RADIANCEOCCLUSION
sheenEnvironmentReflectance*=seo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
sheenEnvironmentReflectance*=eho;
#endif
#endif
#endif
#endif

#ifdef CLEARCOAT
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)

vec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness,environmentBrdfSampler);
vec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);
#ifdef RADIANCEOCCLUSION
float clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);
clearCoatEnvironmentReflectance*=clearCoatSeo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW);
clearCoatEnvironmentReflectance*=clearCoatEho;
#endif
#endif
#endif
#else

vec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));
#endif
clearCoatEnvironmentReflectance*=clearCoatIntensity;
#ifdef CLEARCOAT_TINT

absorption=computeClearCoatAbsorption(clearCoatNdotVRefract,clearCoatNdotVRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);
#ifdef REFLECTION
environmentIrradiance*=absorption;
#endif
#ifdef SHEEN
sheenEnvironmentReflectance*=absorption;
#endif
specularEnvironmentReflectance*=absorption;
#endif

float fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);
fresnelIBLClearCoat*=clearCoatIntensity;
float conservationFactor=(1.-fresnelIBLClearCoat);
#ifdef REFLECTION
environmentIrradiance*=conservationFactor;
#endif
#ifdef SHEEN
sheenEnvironmentReflectance*=(conservationFactor*conservationFactor);
#endif
specularEnvironmentReflectance*=(conservationFactor*conservationFactor);
#endif

#ifdef SS_REFRACTION
vec3 refractionTransmittance=vec3(refractionIntensity);
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);





refractionTransmittance*=cocaLambert(volumeAlbedo,thickness);
#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)

float maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);
vec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);

environmentRefraction.rgb*=volumeAlbedo;
#else

vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);
refractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);
#endif

surfaceAlbedo*=(1.-refractionIntensity);

environmentIrradiance*=(1.-refractionIntensity);

vec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);
specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);

refractionTransmittance*=1.0-specularEnvironmentReflectance;
#endif

#if defined(REFLECTION) && defined(USESPHERICALFROMREFLECTIONMAP) && defined(SS_TRANSLUCENCY)
#if defined(USESPHERICALINVERTEX)
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
#endif
vec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);
refractionIrradiance*=transmittance;
#endif



#ifndef METALLICWORKFLOW
surfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;
#endif

#ifdef REFLECTION
vec3 finalIrradiance=environmentIrradiance;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(SS_TRANSLUCENCY)
finalIrradiance+=refractionIrradiance;
#endif
finalIrradiance*=surfaceAlbedo.rgb;
#endif

#ifdef SPECULARTERM
vec3 finalSpecular=specularBase;
finalSpecular=max(finalSpecular,0.0);

vec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalSpecularScaled*=energyConservationFactor;
#endif
#endif

#ifdef REFLECTION
vec3 finalRadiance=environmentRadiance.rgb;
finalRadiance*=specularEnvironmentReflectance;

vec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalRadianceScaled*=energyConservationFactor;
#endif
#endif

#ifdef SS_REFRACTION
vec3 finalRefraction=environmentRefraction.rgb;
finalRefraction*=refractionTransmittance;
#endif

#ifdef CLEARCOAT
vec3 finalClearCoat=clearCoatBase;
finalClearCoat=max(finalClearCoat,0.0);

vec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalClearCoatScaled*=energyConservationFactor;
#endif

#ifdef REFLECTION
vec3 finalClearCoatRadiance=environmentClearCoatRadiance.rgb;
finalClearCoatRadiance*=clearCoatEnvironmentReflectance;

vec3 finalClearCoatRadianceScaled=finalClearCoatRadiance*vLightingIntensity.z;
#endif
#ifdef SS_REFRACTION
finalRefraction*=(conservationFactor*conservationFactor);
#ifdef CLEARCOAT_TINT
finalRefraction*=absorption;
#endif
#endif
#endif

#ifdef SHEEN
vec3 finalSheen=sheenBase*sheenColor;
finalSheen=max(finalSheen,0.0);
vec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;





#ifdef REFLECTION
vec3 finalSheenRadiance=environmentSheenRadiance.rgb;
finalSheenRadiance*=sheenEnvironmentReflectance;

vec3 finalSheenRadianceScaled=finalSheenRadiance*vLightingIntensity.z;
#endif
#endif

#ifdef ALPHABLEND
float luminanceOverAlpha=0.0;
#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)
luminanceOverAlpha+=getLuminance(finalRadianceScaled);
#if defined(CLEARCOAT)
luminanceOverAlpha+=getLuminance(finalClearCoatRadianceScaled);
#endif
#endif
#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)
luminanceOverAlpha+=getLuminance(finalSpecularScaled);
#endif
#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)
luminanceOverAlpha+=getLuminance(finalClearCoatScaled);
#endif
#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)
alpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);
#endif
#endif
#endif


vec3 finalDiffuse=diffuseBase;
finalDiffuse*=surfaceAlbedo.rgb;
finalDiffuse=max(finalDiffuse,0.0);

vec3 finalAmbient=vAmbientColor;
finalAmbient*=surfaceAlbedo.rgb;

vec3 finalEmissive=vEmissiveColor;
#ifdef EMISSIVE
vec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;
finalEmissive*=toLinearSpace(emissiveColorTex.rgb);
finalEmissive*=vEmissiveInfos.y;
#endif

#ifdef AMBIENT
vec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),ambientOcclusionColor,vAmbientInfos.w);
#else
vec3 ambientOcclusionForDirectDiffuse=ambientOcclusionColor;
#endif



vec4 finalColor=vec4(
finalAmbient*ambientOcclusionColor +
finalDiffuse*ambientOcclusionForDirectDiffuse*vLightingIntensity.x +
#ifndef UNLIT
#ifdef REFLECTION
finalIrradiance*ambientOcclusionColor*vLightingIntensity.z +
#endif
#ifdef SPECULARTERM


finalSpecularScaled +
#endif
#ifdef CLEARCOAT


finalClearCoatScaled +
#endif
#ifdef SHEEN


finalSheenScaled +
#endif
#ifdef REFLECTION


finalRadianceScaled +
#ifdef CLEARCOAT


finalClearCoatRadianceScaled +
#endif
#ifdef SHEEN


finalSheenRadianceScaled +
#endif
#endif
#ifdef SS_REFRACTION
finalRefraction*vLightingIntensity.z +
#endif
#endif
finalEmissive*vLightingIntensity.y,
alpha);

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
finalColor.rgb*=lightmapColor;
#else
finalColor.rgb+=lightmapColor;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG

finalColor=max(finalColor,0.0);
#include<logDepthFragment>
#include<fogFragment>(color,finalColor)
#ifdef IMAGEPROCESSINGPOSTPROCESS


finalColor.rgb=clamp(finalColor.rgb,0.,30.0);
#else

finalColor=applyImageProcessing(finalColor);
#endif
finalColor.a*=visibility;
#ifdef PREMULTIPLYALPHA

finalColor.rgb*=finalColor.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
gl_FragColor=finalColor;
#include<pbrDebug>
}
`;Ia.a.ShadersStore.pbrPixelShader=Bj;var Cj=`uniform mat4 view;
uniform mat4 viewProjection;
#ifdef ALBEDO
uniform mat4 albedoMatrix;
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec4 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
uniform mat4 reflectivityMatrix;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
uniform mat4 microSurfaceSamplerMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
#endif

#ifdef CLEARCOAT
#ifdef CLEARCOAT_TEXTURE
uniform vec2 vClearCoatInfos;
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;
uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
#endif
#endif

#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
#endif
#endif

#ifdef SHEEN
#ifdef SHEEN_TEXTURE
uniform vec2 vSheenInfos;
uniform mat4 sheenMatrix;
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;;
#endif
#endif
`;Ia.a.IncludesShadersStore.pbrVertexDeclaration=Cj,l(124),l(101),l(102),l(103),l(125),l(118);var Dj=`precision highp float;
#include<__decl__pbrVertex>
#define CUSTOM_VERTEX_BEGIN

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
varying vec2 vAlbedoUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
varying vec2 vReflectivityUV;
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
varying vec2 vMicroSurfaceSamplerUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0
varying vec2 vClearCoatUV;
#endif
#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0
varying vec2 vClearCoatBumpUV;
#endif
#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0
varying vec2 vClearCoatTintUV;
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0
varying vec2 vSheenUV;
#endif
#endif
#ifdef ANISOTROPIC
#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0
varying vec2 vAnisotropyUV;
#endif
#endif
#ifdef SUBSURFACE
#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0
varying vec2 vThicknessUV;
#endif
#endif

varying vec3 vPositionW;
#if DEBUGMODE>0
varying vec4 vClipSpacePosition;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#include<harmonicsFunctions>
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED
vPositionUVW=(reflectionMatrix*vec4(positionUpdated,1.0)).xyz;
#else
vPositionUVW=positionUpdated;
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#include<bonesVertex>
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
} else {
gl_Position=viewProjectionR*finalWorld*vec4(positionUpdated,1.0);
}
#else
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#endif
#if DEBUGMODE>0
vClipSpacePosition=gl_Position;
#endif
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
vec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif
vEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);
#endif
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uv;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
if (vAlbedoInfos.x == 0.)
{
vAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));
}
else
{
vAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
if (vReflectivityInfos.x == 0.)
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));
}
else
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
if (vMicroSurfaceSamplerInfos.x == 0.)
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv,1.0,0.0));
}
else
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0
if (vClearCoatInfos.x == 0.)
{
vClearCoatUV=vec2(clearCoatMatrix*vec4(uv,1.0,0.0));
}
else
{
vClearCoatUV=vec2(clearCoatMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0
if (vClearCoatBumpInfos.x == 0.)
{
vClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv,1.0,0.0));
}
else
{
vClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0
if (vClearCoatTintInfos.x == 0.)
{
vClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv,1.0,0.0));
}
else
{
vClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0
if (vSheenInfos.x == 0.)
{
vSheenUV=vec2(sheenMatrix*vec4(uv,1.0,0.0));
}
else
{
vSheenUV=vec2(sheenMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef ANISOTROPIC
#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0
if (vAnisotropyInfos.x == 0.)
{
vAnisotropyUV=vec2(anisotropyMatrix*vec4(uv,1.0,0.0));
}
else
{
vAnisotropyUV=vec2(anisotropyMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef SUBSURFACE
#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0
if (vThicknessInfos.x == 0.)
{
vThicknessUV=vec2(thicknessMatrix*vec4(uv,1.0,0.0));
}
else
{
vThicknessUV=vec2(thicknessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif

#include<bumpVertex>

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif

#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}`;Ia.a.ShadersStore.pbrVertexShader=Dj;var Xe=function(e){function a(){var b=e.call(this)||this;return b.PBR=!0,b.MAINUV1=!1,b.MAINUV2=!1,b.UV1=!1,b.UV2=!1,b.ALBEDO=!1,b.ALBEDODIRECTUV=0,b.VERTEXCOLOR=!1,b.AMBIENT=!1,b.AMBIENTDIRECTUV=0,b.AMBIENTINGRAYSCALE=!1,b.OPACITY=!1,b.VERTEXALPHA=!1,b.OPACITYDIRECTUV=0,b.OPACITYRGB=!1,b.ALPHATEST=!1,b.DEPTHPREPASS=!1,b.ALPHABLEND=!1,b.ALPHAFROMALBEDO=!1,b.ALPHATESTVALUE="0.5",b.SPECULAROVERALPHA=!1,b.RADIANCEOVERALPHA=!1,b.ALPHAFRESNEL=!1,b.LINEARALPHAFRESNEL=!1,b.PREMULTIPLYALPHA=!1,b.EMISSIVE=!1,b.EMISSIVEDIRECTUV=0,b.REFLECTIVITY=!1,b.REFLECTIVITYDIRECTUV=0,b.SPECULARTERM=!1,b.MICROSURFACEFROMREFLECTIVITYMAP=!1,b.MICROSURFACEAUTOMATIC=!1,b.LODBASEDMICROSFURACE=!1,b.MICROSURFACEMAP=!1,b.MICROSURFACEMAPDIRECTUV=0,b.METALLICWORKFLOW=!1,b.ROUGHNESSSTOREINMETALMAPALPHA=!1,b.ROUGHNESSSTOREINMETALMAPGREEN=!1,b.METALLNESSSTOREINMETALMAPBLUE=!1,b.AOSTOREINMETALMAPRED=!1,b.ENVIRONMENTBRDF=!1,b.ENVIRONMENTBRDF_RGBD=!1,b.NORMAL=!1,b.TANGENT=!1,b.BUMP=!1,b.BUMPDIRECTUV=0,b.OBJECTSPACE_NORMALMAP=!1,b.PARALLAX=!1,b.PARALLAXOCCLUSION=!1,b.NORMALXYSCALE=!0,b.LIGHTMAP=!1,b.LIGHTMAPDIRECTUV=0,b.USELIGHTMAPASSHADOWMAP=!1,b.GAMMALIGHTMAP=!1,b.REFLECTION=!1,b.REFLECTIONMAP_3D=!1,b.REFLECTIONMAP_SPHERICAL=!1,b.REFLECTIONMAP_PLANAR=!1,b.REFLECTIONMAP_CUBIC=!1,b.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,b.REFLECTIONMAP_PROJECTION=!1,b.REFLECTIONMAP_SKYBOX=!1,b.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,b.REFLECTIONMAP_EXPLICIT=!1,b.REFLECTIONMAP_EQUIRECTANGULAR=!1,b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,b.INVERTCUBICMAP=!1,b.USESPHERICALFROMREFLECTIONMAP=!1,b.SPHERICAL_HARMONICS=!1,b.USESPHERICALINVERTEX=!1,b.REFLECTIONMAP_OPPOSITEZ=!1,b.LODINREFLECTIONALPHA=!1,b.GAMMAREFLECTION=!1,b.RGBDREFLECTION=!1,b.RADIANCEOCCLUSION=!1,b.HORIZONOCCLUSION=!1,b.INSTANCES=!1,b.NUM_BONE_INFLUENCERS=0,b.BonesPerMesh=0,b.BONETEXTURE=!1,b.NONUNIFORMSCALING=!1,b.MORPHTARGETS=!1,b.MORPHTARGETS_NORMAL=!1,b.MORPHTARGETS_TANGENT=!1,b.NUM_MORPH_INFLUENCERS=0,b.IMAGEPROCESSING=!1,b.VIGNETTE=!1,b.VIGNETTEBLENDMODEMULTIPLY=!1,b.VIGNETTEBLENDMODEOPAQUE=!1,b.TONEMAPPING=!1,b.TONEMAPPING_ACES=!1,b.CONTRAST=!1,b.COLORCURVES=!1,b.COLORGRADING=!1,b.COLORGRADING3D=!1,b.SAMPLER3DGREENDEPTH=!1,b.SAMPLER3DBGRMAP=!1,b.IMAGEPROCESSINGPOSTPROCESS=!1,b.EXPOSURE=!1,b.MULTIVIEW=!1,b.USEPHYSICALLIGHTFALLOFF=!1,b.USEGLTFLIGHTFALLOFF=!1,b.TWOSIDEDLIGHTING=!1,b.SHADOWFLOAT=!1,b.CLIPPLANE=!1,b.CLIPPLANE2=!1,b.CLIPPLANE3=!1,b.CLIPPLANE4=!1,b.POINTSIZE=!1,b.FOG=!1,b.LOGARITHMICDEPTH=!1,b.FORCENORMALFORWARD=!1,b.SPECULARAA=!1,b.CLEARCOAT=!1,b.CLEARCOAT_DEFAULTIOR=!1,b.CLEARCOAT_TEXTURE=!1,b.CLEARCOAT_TEXTUREDIRECTUV=0,b.CLEARCOAT_BUMP=!1,b.CLEARCOAT_BUMPDIRECTUV=0,b.CLEARCOAT_TINT=!1,b.CLEARCOAT_TINT_TEXTURE=!1,b.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,b.ANISOTROPIC=!1,b.ANISOTROPIC_TEXTURE=!1,b.ANISOTROPIC_TEXTUREDIRECTUV=0,b.BRDF_V_HEIGHT_CORRELATED=!1,b.MS_BRDF_ENERGY_CONSERVATION=!1,b.SHEEN=!1,b.SHEEN_TEXTURE=!1,b.SHEEN_TEXTUREDIRECTUV=0,b.SHEEN_LINKWITHALBEDO=!1,b.SUBSURFACE=!1,b.SS_REFRACTION=!1,b.SS_TRANSLUCENCY=!1,b.SS_SCATERRING=!1,b.SS_THICKNESSANDMASK_TEXTURE=!1,b.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,b.SS_REFRACTIONMAP_3D=!1,b.SS_REFRACTIONMAP_OPPOSITEZ=!1,b.SS_LODINREFRACTIONALPHA=!1,b.SS_GAMMAREFRACTION=!1,b.SS_RGBDREFRACTION=!1,b.SS_LINKREFRACTIONTOTRANSPARENCY=!1,b.SS_MASK_FROM_THICKNESS_TEXTURE=!1,b.UNLIT=!1,b.DEBUGMODE=0,b.rebuild(),b}return v.d(a,e),a.prototype.reset=function(){e.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},a}(Ue.a),Qb=function(e){function a(b,c){var d=e.call(this,b,c)||this;return d._directIntensity=1,d._emissiveIntensity=1,d._environmentIntensity=1,d._specularIntensity=1,d._lightingInfos=new j.y(d._directIntensity,d._emissiveIntensity,d._environmentIntensity,d._specularIntensity),d._disableBumpMap=!1,d._albedoTexture=null,d._ambientTexture=null,d._ambientTextureStrength=1,d._ambientTextureImpactOnAnalyticalLights=a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,d._opacityTexture=null,d._reflectionTexture=null,d._emissiveTexture=null,d._reflectivityTexture=null,d._metallicTexture=null,d._metallic=null,d._roughness=null,d._microSurfaceTexture=null,d._bumpTexture=null,d._lightmapTexture=null,d._ambientColor=new j.e(0,0,0),d._albedoColor=new j.e(1,1,1),d._reflectivityColor=new j.e(1,1,1),d._reflectionColor=new j.e(1,1,1),d._emissiveColor=new j.e(0,0,0),d._microSurface=.9,d._useLightmapAsShadowmap=!1,d._useHorizonOcclusion=!0,d._useRadianceOcclusion=!0,d._useAlphaFromAlbedoTexture=!1,d._useSpecularOverAlpha=!0,d._useMicroSurfaceFromReflectivityMapAlpha=!1,d._useRoughnessFromMetallicTextureAlpha=!0,d._useRoughnessFromMetallicTextureGreen=!1,d._useMetallnessFromMetallicTextureBlue=!1,d._useAmbientOcclusionFromMetallicTextureRed=!1,d._useAmbientInGrayScale=!1,d._useAutoMicroSurfaceFromReflectivityMap=!1,d._lightFalloff=a.LIGHTFALLOFF_PHYSICAL,d._useRadianceOverAlpha=!0,d._useObjectSpaceNormalMap=!1,d._useParallax=!1,d._useParallaxOcclusion=!1,d._parallaxScaleBias=.05,d._disableLighting=!1,d._maxSimultaneousLights=4,d._invertNormalMapX=!1,d._invertNormalMapY=!1,d._twoSidedLighting=!1,d._alphaCutOff=.4,d._forceAlphaTest=!1,d._useAlphaFresnel=!1,d._useLinearAlphaFresnel=!1,d._transparencyMode=null,d._environmentBRDFTexture=null,d._forceIrradianceInFragment=!1,d._forceNormalForward=!1,d._enableSpecularAntiAliasing=!1,d._imageProcessingObserver=null,d._renderTargets=new ic.a(16),d._globalAmbientColor=new j.e(0,0,0),d._useLogarithmicDepth=!1,d._unlit=!1,d._debugMode=0,d.debugMode=0,d.debugLimit=-1,d.debugFactor=1,d.clearCoat=new Pd(d._markAllSubMeshesAsTexturesDirty.bind(d)),d.anisotropy=new Nc(d._markAllSubMeshesAsTexturesDirty.bind(d)),d.brdf=new oj(d._markAllSubMeshesAsMiscDirty.bind(d)),d.sheen=new fd(d._markAllSubMeshesAsTexturesDirty.bind(d)),d.subSurface=new gd(d._markAllSubMeshesAsTexturesDirty.bind(d)),d._attachImageProcessingConfiguration(null),d.getRenderTargetTextures=function(){return d._renderTargets.reset(),Ra.a.ReflectionTextureEnabled&&d._reflectionTexture&&d._reflectionTexture.isRenderTarget&&d._renderTargets.push(d._reflectionTexture),d.subSurface.fillRenderTargetTextures(d._renderTargets),d._renderTargets},d._environmentBRDFTexture=_g.GetEnvironmentBRDFTexture(c),d}return v.d(a,e),a.prototype._attachImageProcessingConfiguration=function(b){var c=this;b!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=b||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){c._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(a.prototype,"hasRenderTargetTextures",{get:function(){return!!(Ra.a.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this.subSurface.hasRenderTargetTextures()},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(a.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(b){this._useLogarithmicDepth=b&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(b){this._transparencyMode!==b&&(this._transparencyMode=b,this._forceAlphaTest=b===a.PBRMATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_disableAlphaBlending",{get:function(){return this.subSurface.disableAlphaBlending||this._transparencyMode===a.PBRMATERIAL_OPAQUE||this._transparencyMode===a.PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),a.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},a.prototype.needAlphaBlendingForMesh=function(b){return!(this._disableAlphaBlending&&b.visibility>=1)&&e.prototype.needAlphaBlendingForMesh.call(this,b)},a.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this.subSurface.disableAlphaBlending&&(null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&(null==this._transparencyMode||this._transparencyMode===a.PBRMATERIAL_ALPHATEST))},a.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==a.PBRMATERIAL_OPAQUE},a.prototype.getAlphaTestTexture=function(){return this._albedoTexture},a.prototype.isReadyForSubMesh=function(b,c,d){if(c.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;c._materialDefines||(c._materialDefines=new Xe());var f=c._materialDefines;if(!this.checkReadyOnEveryCall&&c.effect&&f._renderId===this.getScene().getRenderId())return!0;var h=this.getScene(),i=h.getEngine();if(f._areTexturesDirty&&h.texturesEnabled){if(this._albedoTexture&&Ra.a.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&Ra.a.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&Ra.a.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var k=this._getReflectionTexture();if(k&&Ra.a.ReflectionTextureEnabled&&!k.isReadyOrNotBlocking())return!1;if(this._lightmapTexture&&Ra.a.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&Ra.a.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(Ra.a.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(i.getCaps().standardDerivatives&&this._bumpTexture&&Ra.a.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&Ra.a.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(!(this.subSurface.isReadyForSubMesh(f,h)&&this.clearCoat.isReadyForSubMesh(f,h,i,this._disableBumpMap)&&this.sheen.isReadyForSubMesh(f,h)&&this.anisotropy.isReadyForSubMesh(f,h)))return!1;if(f._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;i.getCaps().standardDerivatives||b.isVerticesDataPresent(na.b.NormalKind)||(b.createNormals(!0),r.a.Warn("PBRMaterial: Normals have been created for the mesh: "+b.name));var m=c.effect,B=this._prepareEffect(b,f,this.onCompiled,this.onError,d);return B&&(this.allowShaderHotSwapping&&m&&!B.isReady()?(B=m,f.markAsUnprocessed()):(h.resetCachedMaterial(),c.setEffect(B,f),this.buildUniformLayout())),!(!c.effect||!c.effect.isReady())&&(f._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},a.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},a.prototype._prepareEffect=function(b,c,d,f,h,i){if(void 0===d&&(d=null),void 0===f&&(f=null),void 0===h&&(h=null),void 0===i&&(i=null),this._prepareDefines(b,c,h,i),!c.isDirty)return null;c.markAsProcessed();var k=this.getScene().getEngine(),m=new Ia.c(),B=0;c.USESPHERICALINVERTEX&&m.addFallback(B++,"USESPHERICALINVERTEX"),c.FOG&&m.addFallback(B,"FOG"),c.SPECULARAA&&m.addFallback(B,"SPECULARAA"),c.POINTSIZE&&m.addFallback(B,"POINTSIZE"),c.LOGARITHMICDEPTH&&m.addFallback(B,"LOGARITHMICDEPTH"),c.PARALLAX&&m.addFallback(B,"PARALLAX"),c.PARALLAXOCCLUSION&&m.addFallback(B++,"PARALLAXOCCLUSION"),B=Nc.AddFallbacks(c,m,B),B=Nc.AddFallbacks(c,m,B),B=gd.AddFallbacks(c,m,B),B=fd.AddFallbacks(c,m,B),c.ENVIRONMENTBRDF&&m.addFallback(B++,"ENVIRONMENTBRDF"),c.TANGENT&&m.addFallback(B++,"TANGENT"),c.BUMP&&m.addFallback(B++,"BUMP"),B=Ta.a.HandleFallbacksForShadows(c,m,this._maxSimultaneousLights,B++),c.SPECULARTERM&&m.addFallback(B++,"SPECULARTERM"),c.USESPHERICALFROMREFLECTIONMAP&&m.addFallback(B++,"USESPHERICALFROMREFLECTIONMAP"),c.LIGHTMAP&&m.addFallback(B++,"LIGHTMAP"),c.NORMAL&&m.addFallback(B++,"NORMAL"),c.AMBIENT&&m.addFallback(B++,"AMBIENT"),c.EMISSIVE&&m.addFallback(B++,"EMISSIVE"),c.VERTEXCOLOR&&m.addFallback(B++,"VERTEXCOLOR"),c.NUM_BONE_INFLUENCERS>0&&m.addCPUSkinningFallback(B++,b),c.MORPHTARGETS&&m.addFallback(B++,"MORPHTARGETS"),c.MULTIVIEW&&m.addFallback(0,"MULTIVIEW");var E=[na.b.PositionKind];c.NORMAL&&E.push(na.b.NormalKind),c.TANGENT&&E.push(na.b.TangentKind),c.UV1&&E.push(na.b.UVKind),c.UV2&&E.push(na.b.UV2Kind),c.VERTEXCOLOR&&E.push(na.b.ColorKind),Ta.a.PrepareAttributesForBones(E,b,c,m),Ta.a.PrepareAttributesForInstances(E,c),Ta.a.PrepareAttributesForMorphTargets(E,b,c);var K="pbr",P=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode"],S=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","microSurfaceSampler","environmentBrdfSampler","boneSampler"],U=["Material","Scene"];gd.AddUniforms(P),gd.AddSamplers(S),Pd.AddUniforms(P),Pd.AddSamplers(S),Nc.AddUniforms(P),Nc.AddSamplers(S),fd.AddUniforms(P),fd.AddSamplers(S),Eb.a&&(Eb.a.PrepareUniforms(P,c),Eb.a.PrepareSamplers(S,c)),Ta.a.PrepareUniformsAndSamplersList({uniformsNames:P,uniformBuffersNames:U,samplers:S,defines:c,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(K=this.customShaderNameResolve(K,P,U,S,c));var _=c.toString();return k.createEffect(K,{attributes:E,uniformsNames:P,uniformBuffersNames:U,samplers:S,defines:_,fallbacks:m,onCompiled:d,onError:f,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:c.NUM_MORPH_INFLUENCERS}},k)},a.prototype._prepareDefines=function(b,c,d,f){void 0===d&&(d=null),void 0===f&&(f=null);var h=this.getScene(),i=h.getEngine();if(Ta.a.PrepareDefinesForLights(h,b,c,!0,this._maxSimultaneousLights,this._disableLighting),c._needNormals=!0,Ta.a.PrepareDefinesForMultiview(h,c),c.METALLICWORKFLOW=this.isMetallicWorkflow(),c._areTexturesDirty){if(c._needUVs=!1,h.texturesEnabled){h.getEngine().getCaps().textureLOD&&(c.LODBASEDMICROSFURACE=!0),this._albedoTexture&&Ra.a.DiffuseTextureEnabled?Ta.a.PrepareDefinesForMergedUV(this._albedoTexture,c,"ALBEDO"):c.ALBEDO=!1,this._ambientTexture&&Ra.a.AmbientTextureEnabled?(Ta.a.PrepareDefinesForMergedUV(this._ambientTexture,c,"AMBIENT"),c.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):c.AMBIENT=!1,this._opacityTexture&&Ra.a.OpacityTextureEnabled?(Ta.a.PrepareDefinesForMergedUV(this._opacityTexture,c,"OPACITY"),c.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):c.OPACITY=!1;var k=this._getReflectionTexture();if(k&&Ra.a.ReflectionTextureEnabled){switch(c.REFLECTION=!0,c.GAMMAREFLECTION=k.gammaSpace,c.RGBDREFLECTION=k.isRGBD,c.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!k.invertZ:k.invertZ,c.LODINREFLECTIONALPHA=k.lodLevelInAlpha,k.coordinatesMode===ra.a.INVCUBIC_MODE&&(c.INVERTCUBICMAP=!0),c.REFLECTIONMAP_3D=k.isCube,c.REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,k.coordinatesMode){case ra.a.EXPLICIT_MODE:c.REFLECTIONMAP_EXPLICIT=!0;break;case ra.a.PLANAR_MODE:c.REFLECTIONMAP_PLANAR=!0;break;case ra.a.PROJECTION_MODE:c.REFLECTIONMAP_PROJECTION=!0;break;case ra.a.SKYBOX_MODE:c.REFLECTIONMAP_SKYBOX=!0;break;case ra.a.SPHERICAL_MODE:c.REFLECTIONMAP_SPHERICAL=!0;break;case ra.a.EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case ra.a.FIXED_EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case ra.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case ra.a.CUBIC_MODE:case ra.a.INVCUBIC_MODE:default:c.REFLECTIONMAP_CUBIC=!0,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!!k.boundingBoxSize}k.coordinatesMode!==ra.a.SKYBOX_MODE?k.sphericalPolynomial&&(c.USESPHERICALFROMREFLECTIONMAP=!0,this._forceIrradianceInFragment||h.getEngine().getCaps().maxVaryingVectors<=8?c.USESPHERICALINVERTEX=!1:c.USESPHERICALINVERTEX=!0):c.REFLECTIONMAP_SKYBOX_TRANSFORMED=!k.getReflectionTextureMatrix().isIdentity()}else c.REFLECTION=!1,c.REFLECTIONMAP_3D=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_CUBIC=!1,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,c.INVERTCUBICMAP=!1,c.USESPHERICALFROMREFLECTIONMAP=!1,c.USESPHERICALINVERTEX=!1,c.REFLECTIONMAP_OPPOSITEZ=!1,c.LODINREFLECTIONALPHA=!1,c.GAMMAREFLECTION=!1,c.RGBDREFLECTION=!1;this._lightmapTexture&&Ra.a.LightmapTextureEnabled?(Ta.a.PrepareDefinesForMergedUV(this._lightmapTexture,c,"LIGHTMAP"),c.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,c.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace):c.LIGHTMAP=!1,this._emissiveTexture&&Ra.a.EmissiveTextureEnabled?Ta.a.PrepareDefinesForMergedUV(this._emissiveTexture,c,"EMISSIVE"):c.EMISSIVE=!1,Ra.a.SpecularTextureEnabled?(this._metallicTexture?(Ta.a.PrepareDefinesForMergedUV(this._metallicTexture,c,"REFLECTIVITY"),c.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,c.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,c.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,c.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed):this._reflectivityTexture?(Ta.a.PrepareDefinesForMergedUV(this._reflectivityTexture,c,"REFLECTIVITY"),c.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,c.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):c.REFLECTIVITY=!1,this._microSurfaceTexture?Ta.a.PrepareDefinesForMergedUV(this._microSurfaceTexture,c,"MICROSURFACEMAP"):c.MICROSURFACEMAP=!1):(c.REFLECTIVITY=!1,c.MICROSURFACEMAP=!1),h.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&Ra.a.BumpTextureEnabled&&!this._disableBumpMap?(Ta.a.PrepareDefinesForMergedUV(this._bumpTexture,c,"BUMP"),this._useParallax&&this._albedoTexture&&Ra.a.DiffuseTextureEnabled?(c.PARALLAX=!0,c.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):c.PARALLAX=!1,c.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):c.BUMP=!1,this._environmentBRDFTexture&&Ra.a.ReflectionTextureEnabled?(c.ENVIRONMENTBRDF=!0,c.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(c.ENVIRONMENTBRDF=!1,c.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?c.ALPHAFROMALBEDO=!0:c.ALPHAFROMALBEDO=!1}c.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===a.LIGHTFALLOFF_STANDARD?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===a.LIGHTFALLOFF_GLTF?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!0):(c.USEPHYSICALLIGHTFALLOFF=!0,c.USEGLTFLIGHTFALLOFF=!1),c.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?c.TWOSIDEDLIGHTING=!0:c.TWOSIDEDLIGHTING=!1,c.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),c.PREMULTIPLYALPHA=this.alphaMode===o.a.ALPHA_PREMULTIPLIED||this.alphaMode===o.a.ALPHA_PREMULTIPLIED_PORTERDUFF,c.ALPHABLEND=this.needAlphaBlendingForMesh(b),c.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,c.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel,c.SPECULARAA=h.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}c._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(c),c.FORCENORMALFORWARD=this._forceNormalForward,c.RADIANCEOCCLUSION=this._useRadianceOcclusion,c.HORIZONOCCLUSION=this._useHorizonOcclusion,c._areMiscDirty&&(Ta.a.PrepareDefinesForMisc(b,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(b)||this._forceAlphaTest,c),c.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!b.isVerticesDataPresent(na.b.NormalKind),c.DEBUGMODE=this._debugMode),this.subSurface.prepareDefines(c,h),this.clearCoat.prepareDefines(c,h),this.anisotropy.prepareDefines(c,b,h),this.brdf.prepareDefines(c),this.sheen.prepareDefines(c,h),Ta.a.PrepareDefinesForFrameBoundValues(h,i,c,!!d,f),Ta.a.PrepareDefinesForAttributes(b,c,!0,!0,!0,this._transparencyMode!==a.PBRMATERIAL_OPAQUE)},a.prototype.forceCompilation=function(b,c,d){var f=this,h=v.a({clipPlane:!1},d),i=new Xe(),k=this._prepareEffect(b,i,void 0,void 0,void 0,h.clipPlane);k.isReady()?c&&c(this):k.onCompileObservable.add(function(){c&&c(f)})},a.prototype.buildUniformLayout=function(){var b=this._uniformBuffer;b.addUniform("vAlbedoInfos",2),b.addUniform("vAmbientInfos",4),b.addUniform("vOpacityInfos",2),b.addUniform("vEmissiveInfos",2),b.addUniform("vLightmapInfos",2),b.addUniform("vReflectivityInfos",3),b.addUniform("vMicroSurfaceSamplerInfos",2),b.addUniform("vReflectionInfos",2),b.addUniform("vReflectionPosition",3),b.addUniform("vReflectionSize",3),b.addUniform("vBumpInfos",3),b.addUniform("albedoMatrix",16),b.addUniform("ambientMatrix",16),b.addUniform("opacityMatrix",16),b.addUniform("emissiveMatrix",16),b.addUniform("lightmapMatrix",16),b.addUniform("reflectivityMatrix",16),b.addUniform("microSurfaceSamplerMatrix",16),b.addUniform("bumpMatrix",16),b.addUniform("vTangentSpaceParams",2),b.addUniform("reflectionMatrix",16),b.addUniform("vReflectionColor",3),b.addUniform("vAlbedoColor",4),b.addUniform("vLightingIntensity",4),b.addUniform("vReflectionMicrosurfaceInfos",3),b.addUniform("pointSize",1),b.addUniform("vReflectivityColor",4),b.addUniform("vEmissiveColor",3),b.addUniform("visibility",1),Pd.PrepareUniformBuffer(b),Nc.PrepareUniformBuffer(b),fd.PrepareUniformBuffer(b),gd.PrepareUniformBuffer(b),b.create()},a.prototype.unbind=function(){if(this._activeEffect){var b=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),b=!0),this.subSurface.unbind(this._activeEffect)&&(b=!0),b&&this._markAllSubMeshesAsTexturesDirty()}e.prototype.unbind.call(this)},a.prototype.bindForSubMesh=function(b,c,d){var f=this.getScene(),h=d._materialDefines;if(h){var i=d.effect;if(i){this._activeEffect=i,h.INSTANCES||this.bindOnlyWorldMatrix(b),h.OBJECTSPACE_NORMALMAP&&(b.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var k=this._mustRebind(f,i,c.visibility);Ta.a.BindBonesParameters(c,this._activeEffect);var m=null,B=this._uniformBuffer;if(k){var E=f.getEngine();if(B.bindToEffect(i,"Material"),this.bindViewProjection(i),m=this._getReflectionTexture(),!B.useUbo||!this.isFrozen||!B.isSync){if(f.texturesEnabled){if(this._albedoTexture&&Ra.a.DiffuseTextureEnabled&&(B.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),Ta.a.BindTextureMatrix(this._albedoTexture,B,"albedo")),this._ambientTexture&&Ra.a.AmbientTextureEnabled&&(B.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),Ta.a.BindTextureMatrix(this._ambientTexture,B,"ambient")),this._opacityTexture&&Ra.a.OpacityTextureEnabled&&(B.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),Ta.a.BindTextureMatrix(this._opacityTexture,B,"opacity")),m&&Ra.a.ReflectionTextureEnabled){if(B.updateMatrix("reflectionMatrix",m.getReflectionTextureMatrix()),B.updateFloat2("vReflectionInfos",m.level,0),m.boundingBoxSize){var K=m;B.updateVector3("vReflectionPosition",K.boundingBoxPosition),B.updateVector3("vReflectionSize",K.boundingBoxSize)}var P=m.sphericalPolynomial;if(h.USESPHERICALFROMREFLECTIONMAP&&P)if(h.SPHERICAL_HARMONICS){var S=P.preScaledHarmonics;this._activeEffect.setVector3("vSphericalL00",S.l00),this._activeEffect.setVector3("vSphericalL1_1",S.l1_1),this._activeEffect.setVector3("vSphericalL10",S.l10),this._activeEffect.setVector3("vSphericalL11",S.l11),this._activeEffect.setVector3("vSphericalL2_2",S.l2_2),this._activeEffect.setVector3("vSphericalL2_1",S.l2_1),this._activeEffect.setVector3("vSphericalL20",S.l20),this._activeEffect.setVector3("vSphericalL21",S.l21),this._activeEffect.setVector3("vSphericalL22",S.l22)}else this._activeEffect.setFloat3("vSphericalX",P.x.x,P.x.y,P.x.z),this._activeEffect.setFloat3("vSphericalY",P.y.x,P.y.y,P.y.z),this._activeEffect.setFloat3("vSphericalZ",P.z.x,P.z.y,P.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",P.xx.x-P.zz.x,P.xx.y-P.zz.y,P.xx.z-P.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",P.yy.x-P.zz.x,P.yy.y-P.zz.y,P.yy.z-P.zz.z),this._activeEffect.setFloat3("vSphericalZZ",P.zz.x,P.zz.y,P.zz.z),this._activeEffect.setFloat3("vSphericalXY",P.xy.x,P.xy.y,P.xy.z),this._activeEffect.setFloat3("vSphericalYZ",P.yz.x,P.yz.y,P.yz.z),this._activeEffect.setFloat3("vSphericalZX",P.zx.x,P.zx.y,P.zx.z);B.updateFloat3("vReflectionMicrosurfaceInfos",m.getSize().width,m.lodGenerationScale,m.lodGenerationOffset)}this._emissiveTexture&&Ra.a.EmissiveTextureEnabled&&(B.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),Ta.a.BindTextureMatrix(this._emissiveTexture,B,"emissive")),this._lightmapTexture&&Ra.a.LightmapTextureEnabled&&(B.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),Ta.a.BindTextureMatrix(this._lightmapTexture,B,"lightmap")),Ra.a.SpecularTextureEnabled&&(this._metallicTexture?(B.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),Ta.a.BindTextureMatrix(this._metallicTexture,B,"reflectivity")):this._reflectivityTexture&&(B.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),Ta.a.BindTextureMatrix(this._reflectivityTexture,B,"reflectivity")),this._microSurfaceTexture&&(B.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),Ta.a.BindTextureMatrix(this._microSurfaceTexture,B,"microSurfaceSampler"))),this._bumpTexture&&E.getCaps().standardDerivatives&&Ra.a.BumpTextureEnabled&&!this._disableBumpMap&&(B.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),Ta.a.BindTextureMatrix(this._bumpTexture,B,"bump"),f._mirroredCameraPosition?B.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):B.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}this.pointsCloud&&B.updateFloat("pointSize",this.pointSize),h.METALLICWORKFLOW?(j.t.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,j.t.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,B.updateColor4("vReflectivityColor",j.t.Color3[0],0)):B.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface),B.updateColor3("vEmissiveColor",Ra.a.EmissiveTextureEnabled?this._emissiveColor:j.e.BlackReadOnly),B.updateColor3("vReflectionColor",this._reflectionColor),B.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),B.updateFloat("visibility",c.visibility),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity,this._lightingInfos.w=this._specularIntensity,B.updateVector4("vLightingIntensity",this._lightingInfos)}f.texturesEnabled&&(this._albedoTexture&&Ra.a.DiffuseTextureEnabled&&B.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&Ra.a.AmbientTextureEnabled&&B.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Ra.a.OpacityTextureEnabled&&B.setTexture("opacitySampler",this._opacityTexture),m&&Ra.a.ReflectionTextureEnabled&&(h.LODBASEDMICROSFURACE?B.setTexture("reflectionSampler",m):(B.setTexture("reflectionSampler",m._lodTextureMid||m),B.setTexture("reflectionSamplerLow",m._lodTextureLow||m),B.setTexture("reflectionSamplerHigh",m._lodTextureHigh||m))),h.ENVIRONMENTBRDF&&B.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&Ra.a.EmissiveTextureEnabled&&B.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Ra.a.LightmapTextureEnabled&&B.setTexture("lightmapSampler",this._lightmapTexture),Ra.a.SpecularTextureEnabled&&(this._metallicTexture?B.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&B.setTexture("reflectivitySampler",this._reflectivityTexture),this._microSurfaceTexture&&B.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&E.getCaps().standardDerivatives&&Ra.a.BumpTextureEnabled&&!this._disableBumpMap&&B.setTexture("bumpSampler",this._bumpTexture)),this.subSurface.bindForSubMesh(B,f,E,this.isFrozen,h.LODBASEDMICROSFURACE),this.clearCoat.bindForSubMesh(B,f,E,this._disableBumpMap,this.isFrozen,this._invertNormalMapX,this._invertNormalMapY),this.anisotropy.bindForSubMesh(B,f,this.isFrozen),this.sheen.bindForSubMesh(B,f,this.isFrozen),Ta.a.BindClipPlane(this._activeEffect,f),f.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var U=f._forcedViewPosition?f._forcedViewPosition:f._mirroredCameraPosition?f._mirroredCameraPosition:f.activeCamera.globalPosition,_=f.useRightHandedSystem===(null!=f._mirroredCameraPosition);i.setFloat4("vEyePosition",U.x,U.y,U.z,_?-1:1),i.setColor3("vAmbientColor",this._globalAmbientColor),i.setFloat2("vDebugMode",this.debugLimit,this.debugFactor)}!k&&this.isFrozen||(f.lightsEnabled&&!this._disableLighting&&Ta.a.BindLights(f,c,this._activeEffect,h,this._maxSimultaneousLights,this._lightFalloff!==a.LIGHTFALLOFF_STANDARD),(f.fogEnabled&&c.applyFog&&f.fogMode!==ja.a.FOGMODE_NONE||m)&&this.bindView(i),Ta.a.BindFogParameters(f,c,this._activeEffect,!0),h.NUM_MORPH_INFLUENCERS&&Ta.a.BindMorphTargetParameters(c,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),Ta.a.BindLogDepth(h,this._activeEffect,f)),B.update(),this._afterBind(c,this._activeEffect)}}},a.prototype.getAnimatables=function(){var b=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&b.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&b.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&b.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&b.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&b.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?b.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&b.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&b.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&b.push(this._lightmapTexture),this.subSurface.getAnimatables(b),this.clearCoat.getAnimatables(b),this.sheen.getAnimatables(b),this.anisotropy.getAnimatables(b),b},a.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},a.prototype.getActiveTextures=function(){var b=e.prototype.getActiveTextures.call(this);return this._albedoTexture&&b.push(this._albedoTexture),this._ambientTexture&&b.push(this._ambientTexture),this._opacityTexture&&b.push(this._opacityTexture),this._reflectionTexture&&b.push(this._reflectionTexture),this._emissiveTexture&&b.push(this._emissiveTexture),this._reflectivityTexture&&b.push(this._reflectivityTexture),this._metallicTexture&&b.push(this._metallicTexture),this._microSurfaceTexture&&b.push(this._microSurfaceTexture),this._bumpTexture&&b.push(this._bumpTexture),this._lightmapTexture&&b.push(this._lightmapTexture),this.subSurface.getActiveTextures(b),this.clearCoat.getActiveTextures(b),this.sheen.getActiveTextures(b),this.anisotropy.getActiveTextures(b),b},a.prototype.hasTexture=function(b){return!!e.prototype.hasTexture.call(this,b)||(this._albedoTexture===b||(this._ambientTexture===b||(this._opacityTexture===b||(this._reflectionTexture===b||(this._reflectivityTexture===b||(this._metallicTexture===b||(this._microSurfaceTexture===b||(this._bumpTexture===b||(this._lightmapTexture===b||(this.subSurface.hasTexture(b)||this.clearCoat.hasTexture(b)||this.sheen.hasTexture(b)||this.anisotropy.hasTexture(b)))))))))))},a.prototype.dispose=function(b,c){c&&(this._albedoTexture&&this._albedoTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._metallicTexture&&this._metallicTexture.dispose(),this._reflectivityTexture&&this._reflectivityTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose()),this.subSurface.dispose(c),this.clearCoat.dispose(c),this.sheen.dispose(c),this.anisotropy.dispose(c),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,b,c)},a.PBRMATERIAL_OPAQUE=0,a.PBRMATERIAL_ALPHATEST=1,a.PBRMATERIAL_ALPHABLEND=2,a.PBRMATERIAL_ALPHATESTANDBLEND=3,a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,a.LIGHTFALLOFF_PHYSICAL=0,a.LIGHTFALLOFF_GLTF=1,a.LIGHTFALLOFF_STANDARD=2,v.c([Object(g.i)()],a.prototype,"_imageProcessingConfiguration",void 0),v.c([Object(g.b)("_markAllSubMeshesAsMiscDirty")],a.prototype,"debugMode",void 0),v.c([Object(g.c)()],a.prototype,"useLogarithmicDepth",null),v.c([Object(g.c)()],a.prototype,"transparencyMode",null),a}(Ve.a),Ye=function(e){function a(b,c){var d=e.call(this,b,c)||this;return d.directIntensity=1,d.emissiveIntensity=1,d.environmentIntensity=1,d.specularIntensity=1,d.disableBumpMap=!1,d.ambientTextureStrength=1,d.ambientTextureImpactOnAnalyticalLights=a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,d.ambientColor=new j.e(0,0,0),d.albedoColor=new j.e(1,1,1),d.reflectivityColor=new j.e(1,1,1),d.reflectionColor=new j.e(1,1,1),d.emissiveColor=new j.e(0,0,0),d.microSurface=1,d.useLightmapAsShadowmap=!1,d.useAlphaFromAlbedoTexture=!1,d.forceAlphaTest=!1,d.alphaCutOff=.4,d.useSpecularOverAlpha=!0,d.useMicroSurfaceFromReflectivityMapAlpha=!1,d.useRoughnessFromMetallicTextureAlpha=!0,d.useRoughnessFromMetallicTextureGreen=!1,d.useMetallnessFromMetallicTextureBlue=!1,d.useAmbientOcclusionFromMetallicTextureRed=!1,d.useAmbientInGrayScale=!1,d.useAutoMicroSurfaceFromReflectivityMap=!1,d.useRadianceOverAlpha=!0,d.useObjectSpaceNormalMap=!1,d.useParallax=!1,d.useParallaxOcclusion=!1,d.parallaxScaleBias=.05,d.disableLighting=!1,d.forceIrradianceInFragment=!1,d.maxSimultaneousLights=4,d.invertNormalMapX=!1,d.invertNormalMapY=!1,d.twoSidedLighting=!1,d.useAlphaFresnel=!1,d.useLinearAlphaFresnel=!1,d.environmentBRDFTexture=null,d.forceNormalForward=!1,d.enableSpecularAntiAliasing=!1,d.useHorizonOcclusion=!0,d.useRadianceOcclusion=!0,d.unlit=!1,d._environmentBRDFTexture=_g.GetEnvironmentBRDFTexture(c),d}return v.d(a,e),Object.defineProperty(a.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(b){this.subSurface.refractionTexture=b,b?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"indexOfRefraction",{get:function(){return 1/this.subSurface.indexOfRefraction},set:function(b){this.subSurface.indexOfRefraction=1/b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(b){this.subSurface.invertRefractionY=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(b){this.subSurface.linkRefractionWithTransparency=b,b&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===Qb.LIGHTFALLOFF_PHYSICAL},set:function(b){b!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=b?Qb.LIGHTFALLOFF_PHYSICAL:Qb.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===Qb.LIGHTFALLOFF_GLTF},set:function(b){b!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=b?Qb.LIGHTFALLOFF_GLTF:Qb.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(b){this._attachImageProcessingConfiguration(b),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(b){this.imageProcessingConfiguration.colorCurvesEnabled=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(b){this.imageProcessingConfiguration.colorGradingEnabled=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(b){this._imageProcessingConfiguration.toneMappingEnabled=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(b){this._imageProcessingConfiguration.exposure=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(b){this._imageProcessingConfiguration.contrast=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(b){this._imageProcessingConfiguration.colorGradingTexture=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(b){this._imageProcessingConfiguration.colorCurves=b},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"PBRMaterial"},a.prototype.clone=function(b){var c=this,d=g.a.Clone(function(){return new a(b,c.getScene())},this);return d.id=b,d.name=b,this.clearCoat.copyTo(d.clearCoat),this.anisotropy.copyTo(d.anisotropy),this.brdf.copyTo(d.brdf),this.sheen.copyTo(d.sheen),d},a.prototype.serialize=function(){var b=g.a.Serialize(this);return b.customType="BABYLON.PBRMaterial",b.clearCoat=this.clearCoat.serialize(),b.anisotropy=this.anisotropy.serialize(),b.brdf=this.brdf.serialize(),b.sheen=this.sheen.serialize(),b},a.Parse=function(b,c,d){var f=g.a.Parse(function(){return new a(b.name,c)},b,c,d);return b.clearCoat&&f.clearCoat.parse(b.clearCoat),b.anisotropy&&f.anisotropy.parse(b.anisotropy),b.brdf&&f.brdf.parse(b.brdf),b.sheen&&f.sheen.parse(b.brdf),f},a.PBRMATERIAL_OPAQUE=Qb.PBRMATERIAL_OPAQUE,a.PBRMATERIAL_ALPHATEST=Qb.PBRMATERIAL_ALPHATEST,a.PBRMATERIAL_ALPHABLEND=Qb.PBRMATERIAL_ALPHABLEND,a.PBRMATERIAL_ALPHATESTANDBLEND=Qb.PBRMATERIAL_ALPHATESTANDBLEND,a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=Qb.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"directIntensity",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"emissiveIntensity",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"environmentIntensity",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"specularIntensity",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"disableBumpMap",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"albedoTexture",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"ambientTexture",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"ambientTextureStrength",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],a.prototype,"opacityTexture",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionTexture",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"emissiveTexture",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectivityTexture",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"metallicTexture",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"metallic",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"roughness",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"microSurfaceTexture",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"bumpTexture",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty",null)],a.prototype,"lightmapTexture",void 0),v.c([Object(g.e)("ambient"),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"ambientColor",void 0),v.c([Object(g.e)("albedo"),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"albedoColor",void 0),v.c([Object(g.e)("reflectivity"),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectivityColor",void 0),v.c([Object(g.e)("reflection"),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionColor",void 0),v.c([Object(g.e)("emissive"),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"emissiveColor",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"microSurface",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useLightmapAsShadowmap",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],a.prototype,"useAlphaFromAlbedoTexture",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],a.prototype,"forceAlphaTest",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],a.prototype,"alphaCutOff",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useSpecularOverAlpha",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useRoughnessFromMetallicTextureGreen",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useMetallnessFromMetallicTextureBlue",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useAmbientInGrayScale",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),v.c([Object(g.c)()],a.prototype,"usePhysicalLightFalloff",null),v.c([Object(g.c)()],a.prototype,"useGLTFLightFalloff",null),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useRadianceOverAlpha",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useObjectSpaceNormalMap",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useParallax",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useParallaxOcclusion",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"parallaxScaleBias",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsLightsDirty")],a.prototype,"disableLighting",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"forceIrradianceInFragment",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsLightsDirty")],a.prototype,"maxSimultaneousLights",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"invertNormalMapX",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"invertNormalMapY",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"twoSidedLighting",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useAlphaFresnel",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useLinearAlphaFresnel",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"environmentBRDFTexture",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"forceNormalForward",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"enableSpecularAntiAliasing",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useHorizonOcclusion",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useRadianceOcclusion",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsMiscDirty")],a.prototype,"unlit",void 0),a}(Qb);I.a.RegisteredTypes["BABYLON.PBRMaterial"]=Ye;var hd=l(62),Ze=l(71);function Qd(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var $g=Qd("DXT1"),ah=Qd("DXT3"),bh=Qd("DXT5"),_e=Qd("DX10"),wc=function(){function e(){}return e.GetDDSInfo=function(a){var b=new Int32Array(a,0,31),c=new Int32Array(a,0,35),d=1;131072&b[2]&&(d=Math.max(1,b[7]));var f=b[21],h=f===_e?c[32]:0,i=o.a.TEXTURETYPE_UNSIGNED_INT;switch(f){case 113:i=o.a.TEXTURETYPE_HALF_FLOAT;break;case 116:i=o.a.TEXTURETYPE_FLOAT;break;case _e:if(10===h){i=o.a.TEXTURETYPE_HALF_FLOAT;break}}return{width:b[4],height:b[3],mipmapCount:d,isFourCC:4==(4&b[20]),isRGB:64==(64&b[20]),isLuminance:131072==(131072&b[20]),isCube:512==(512&b[28]),isCompressed:f===$g||f===ah||f===bh,dxgiFormat:h,textureType:i}},e._ToHalfFloat=function(a){e._FloatView||(e._FloatView=new Float32Array(1),e._Int32View=new Int32Array(e._FloatView.buffer)),e._FloatView[0]=a;var b=e._Int32View[0],c=b>>16&32768,d=b>>12&2047,f=b>>23&255;return f<103?c:f>142?(c|=31744,c|=(255==f?0:1)&&8388607&b):f<113?c|=((d|=2048)>>114-f)+(d>>113-f&1):(c|=f-112<<10|d>>1,c+=1&d)},e._FromHalfFloat=function(a){var b=(32768&a)>>15,c=(31744&a)>>10,d=1023&a;return 0===c?(b?-1:1)*Math.pow(2,-14)*(d/Math.pow(2,10)):31==c?d?NaN:1/0*(b?-1:1):(b?-1:1)*Math.pow(2,c-15)*(1+d/Math.pow(2,10))},e._GetHalfFloatAsFloatRGBAArrayBuffer=function(a,b,c,d,f,h){for(var i=new Float32Array(d),k=new Uint16Array(f,c),m=0,B=0;B<b;B++)for(var E=0;E<a;E++){var K=4*(E+B*a);i[m]=e._FromHalfFloat(k[K]),i[m+1]=e._FromHalfFloat(k[K+1]),i[m+2]=e._FromHalfFloat(k[K+2]),e.StoreLODInAlphaChannel?i[m+3]=h:i[m+3]=e._FromHalfFloat(k[K+3]),m+=4}return i},e._GetHalfFloatRGBAArrayBuffer=function(a,b,c,d,f,h){if(e.StoreLODInAlphaChannel){for(var i=new Uint16Array(d),k=new Uint16Array(f,c),m=0,B=0;B<b;B++)for(var E=0;E<a;E++){var K=4*(E+B*a);i[m]=k[K],i[m+1]=k[K+1],i[m+2]=k[K+2],i[m+3]=e._ToHalfFloat(h),m+=4}return i}return new Uint16Array(f,c,d)},e._GetFloatRGBAArrayBuffer=function(a,b,c,d,f,h){if(e.StoreLODInAlphaChannel){for(var i=new Float32Array(d),k=new Float32Array(f,c),m=0,B=0;B<b;B++)for(var E=0;E<a;E++){var K=4*(E+B*a);i[m]=k[K],i[m+1]=k[K+1],i[m+2]=k[K+2],i[m+3]=h,m+=4}return i}return new Float32Array(f,c,d)},e._GetFloatAsUIntRGBAArrayBuffer=function(a,b,c,d,f,h){for(var i=new Uint8Array(d),k=new Float32Array(f,c),m=0,B=0;B<b;B++)for(var E=0;E<a;E++){var K=4*(E+B*a);i[m]=255*p.a.Clamp(k[K]),i[m+1]=255*p.a.Clamp(k[K+1]),i[m+2]=255*p.a.Clamp(k[K+2]),e.StoreLODInAlphaChannel?i[m+3]=h:i[m+3]=255*p.a.Clamp(k[K+3]),m+=4}return i},e._GetHalfFloatAsUIntRGBAArrayBuffer=function(a,b,c,d,f,h){for(var i=new Uint8Array(d),k=new Uint16Array(f,c),m=0,B=0;B<b;B++)for(var E=0;E<a;E++){var K=4*(E+B*a);i[m]=255*p.a.Clamp(e._FromHalfFloat(k[K])),i[m+1]=255*p.a.Clamp(e._FromHalfFloat(k[K+1])),i[m+2]=255*p.a.Clamp(e._FromHalfFloat(k[K+2])),e.StoreLODInAlphaChannel?i[m+3]=h:i[m+3]=255*p.a.Clamp(e._FromHalfFloat(k[K+3])),m+=4}return i},e._GetRGBAArrayBuffer=function(a,b,c,d,f,h,i,k,m){for(var B=new Uint8Array(d),E=new Uint8Array(f,c),K=0,P=0;P<b;P++)for(var S=0;S<a;S++){var U=4*(S+P*a);B[K]=E[U+h],B[K+1]=E[U+i],B[K+2]=E[U+k],B[K+3]=E[U+m],K+=4}return B},e._ExtractLongWordOrder=function(a){return 0===a||255===a||-16777216===a?0:1+e._ExtractLongWordOrder(a>>8)},e._GetRGBArrayBuffer=function(a,b,c,d,f,h,i,k){for(var m=new Uint8Array(d),B=new Uint8Array(f,c),E=0,K=0;K<b;K++)for(var P=0;P<a;P++){var S=3*(P+K*a);m[E]=B[S+h],m[E+1]=B[S+i],m[E+2]=B[S+k],E+=3}return m},e._GetLuminanceArrayBuffer=function(a,b,c,d,f){for(var h=new Uint8Array(d),i=new Uint8Array(f,c),k=0,m=0;m<b;m++)for(var B=0;B<a;B++){var E=B+m*a;h[k]=i[E],k++}return h},e.UploadDDSLevels=function(a,b,c,d,f,h,i,k){void 0===i&&(i=-1);var m=null;d.sphericalPolynomial&&(m=new Array());var B,E,K,P,S,U,_,da=a.getCaps().s3tc,fa=new Int32Array(c,0,31),ga=0,ha=0,ka=1;if(542327876===fa[0])if(d.isFourCC||d.isRGB||d.isLuminance)if(!d.isCompressed||da){var la=fa[22];P=fa[1]+4;var ma,ta=!1;if(d.isFourCC)switch(B=fa[21]){case $g:ka=8,ha=da.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case ah:ka=16,ha=da.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case bh:ka=16,ha=da.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:ta=!0;break;case _e:P+=20;var pa=!1;switch(d.dxgiFormat){case 10:ta=!0,pa=!0;break;case 88:d.isRGB=!0,d.isFourCC=!1,la=32,pa=!0}if(pa)break;default:return void console.error("Unsupported FourCC code:",(ma=B,String.fromCharCode(255&ma,ma>>8&255,ma>>16&255,ma>>24&255)))}var ua=e._ExtractLongWordOrder(fa[23]),wa=e._ExtractLongWordOrder(fa[24]),ya=e._ExtractLongWordOrder(fa[25]),Da=e._ExtractLongWordOrder(fa[26]);ta&&(ha=a._getRGBABufferInternalSizedFormat(d.textureType)),U=1,131072&fa[2]&&!1!==f&&(U=Math.max(1,fa[7]));for(var Ja=k||0;Ja<h;Ja++){for(E=fa[4],K=fa[3],_=0;_<U;++_){if(-1===i||i===_){var Na=-1===i?_:0;if(!d.isCompressed&&d.isFourCC){b.format=o.a.TEXTUREFORMAT_RGBA,ga=E*K*4;var Ma=null;a._badOS||a._badDesktopOS||!a.getCaps().textureHalfFloat&&!a.getCaps().textureFloat?(128===la?(Ma=e._GetFloatAsUIntRGBAArrayBuffer(E,K,P,ga,c,Na),m&&0==Na&&m.push(e._GetFloatRGBAArrayBuffer(E,K,P,ga,c,Na))):64===la&&(Ma=e._GetHalfFloatAsUIntRGBAArrayBuffer(E,K,P,ga,c,Na),m&&0==Na&&m.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(E,K,P,ga,c,Na))),b.type=o.a.TEXTURETYPE_UNSIGNED_INT):128===la?(b.type=o.a.TEXTURETYPE_FLOAT,Ma=e._GetFloatRGBAArrayBuffer(E,K,P,ga,c,Na),m&&0==Na&&m.push(Ma)):64!==la||a.getCaps().textureHalfFloat?(b.type=o.a.TEXTURETYPE_HALF_FLOAT,Ma=e._GetHalfFloatRGBAArrayBuffer(E,K,P,ga,c,Na),m&&0==Na&&m.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(E,K,P,ga,c,Na))):(b.type=o.a.TEXTURETYPE_FLOAT,Ma=e._GetHalfFloatAsFloatRGBAArrayBuffer(E,K,P,ga,c,Na),m&&0==Na&&m.push(Ma)),Ma&&a._uploadDataToTextureDirectly(b,Ma,Ja,Na)}else if(d.isRGB)b.type=o.a.TEXTURETYPE_UNSIGNED_INT,24===la?(b.format=o.a.TEXTUREFORMAT_RGB,ga=E*K*3,S=e._GetRGBArrayBuffer(E,K,P,ga,c,ua,wa,ya),a._uploadDataToTextureDirectly(b,S,Ja,Na)):(b.format=o.a.TEXTUREFORMAT_RGBA,ga=E*K*4,S=e._GetRGBAArrayBuffer(E,K,P,ga,c,ua,wa,ya,Da),a._uploadDataToTextureDirectly(b,S,Ja,Na));else if(d.isLuminance){var Ha=a._getUnpackAlignement(),Qa=E;ga=Math.floor((E+Ha-1)/Ha)*Ha*(K-1)+Qa,S=e._GetLuminanceArrayBuffer(E,K,P,ga,c),b.format=o.a.TEXTUREFORMAT_LUMINANCE,b.type=o.a.TEXTURETYPE_UNSIGNED_INT,a._uploadDataToTextureDirectly(b,S,Ja,Na)}else ga=Math.max(4,E)/4*Math.max(4,K)/4*ka,S=new Uint8Array(c,P,ga),b.type=o.a.TEXTURETYPE_UNSIGNED_INT,a._uploadCompressedDataToTextureDirectly(b,ha,E,K,S,Ja,Na)}P+=la?E*K*(la/8):ga,E*=.5,K*=.5,E=Math.max(1,E),K=Math.max(1,K)}if(void 0!==k)break}m&&m.length>0?d.sphericalPolynomial=Ze.a.ConvertCubeMapToSphericalPolynomial({size:fa[4],right:m[0],left:m[1],up:m[2],down:m[3],front:m[4],back:m[5],format:o.a.TEXTUREFORMAT_RGBA,type:o.a.TEXTURETYPE_FLOAT,gammaSpace:!1}):d.sphericalPolynomial=void 0}else r.a.Error("Compressed textures are not supported on this platform.");else r.a.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else r.a.Error("Invalid magic number in DDS header")},e.StoreLODInAlphaChannel=!1,e}();va.b.prototype.createPrefilteredCubeTexture=function(e,a,b,c,d,f,h,i,k){var m=this;return void 0===d&&(d=null),void 0===f&&(f=null),void 0===i&&(i=null),void 0===k&&(k=!0),this.createCubeTexture(e,a,null,!1,function(B){if(B){var E=B.texture;if(k?B.info.sphericalPolynomial&&(E._sphericalPolynomial=B.info.sphericalPolynomial):E._sphericalPolynomial=new hd.b(),E._dataSource=sb.a.DATASOURCE_CUBEPREFILTERED,m.getCaps().textureLOD)d&&d(E);else{var K=m._gl,P=B.width;if(P){for(var S=[],U=0;U<3;U++){var _=1-U/2,da=c,fa=p.a.Log2(P)*b+c,ga=da+(fa-da)*_,ha=Math.round(Math.min(Math.max(ga,0),fa)),ka=new sb.a(m,sb.a.DATASOURCE_TEMP);if(ka.type=E.type,ka.format=E.format,ka.width=Math.pow(2,Math.max(p.a.Log2(P)-ha,0)),ka.height=ka.width,ka.isCube=!0,m._bindTextureDirectly(K.TEXTURE_CUBE_MAP,ka,!0),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),B.isDDS){var la=B.info,ma=B.data;m._unpackFlipY(la.isCompressed),wc.UploadDDSLevels(m,ka,ma,la,!0,6,ha)}else r.a.Warn("DDS is the only prefiltered cube map supported so far.");m._bindTextureDirectly(K.TEXTURE_CUBE_MAP,null);var ta=new ac.a(a);ta.isCube=!0,ta._texture=ka,ka.isReady=!0,S.push(ta)}E._lodTextureHigh=S[2],E._lodTextureMid=S[1],E._lodTextureLow=S[0],d&&d(E)}}}else d&&d(null)},f,h,i,k,b,c)};var ch=function(){function e(){this.supportCascades=!0}return e.prototype.canLoad=function(a,b,c,d,f){return 0===a.indexOf(".dds")},e.prototype.transformUrl=function(a,b){return a},e.prototype.getFallbackTextureUrl=function(a,b){return null},e.prototype.loadCubeData=function(a,b,c,d,f){var h,i=b.getEngine(),k=!1;if(Array.isArray(a))for(var m=0;m<a.length;m++){var B=a[m];h=wc.GetDDSInfo(B),b.width=h.width,b.height=h.height,k=(h.isRGB||h.isLuminance||h.mipmapCount>1)&&b.generateMipMaps,i._unpackFlipY(h.isCompressed),wc.UploadDDSLevels(i,b,B,h,k,6,-1,m),h.isFourCC||1!==h.mipmapCount||i.generateMipMapsForCubemap(b)}else{var E=a;h=wc.GetDDSInfo(E),b.width=h.width,b.height=h.height,c&&(h.sphericalPolynomial=new hd.b()),k=(h.isRGB||h.isLuminance||h.mipmapCount>1)&&b.generateMipMaps,i._unpackFlipY(h.isCompressed),wc.UploadDDSLevels(i,b,E,h,k,6),h.isFourCC||1!==h.mipmapCount||i.generateMipMapsForCubemap(b)}i._setCubeMapTextureParams(k),b.isReady=!0,d&&d({isDDS:!0,width:b.width,info:h,data:a,texture:b})},e.prototype.loadData=function(a,b,c){var d=wc.GetDDSInfo(a),f=(d.isRGB||d.isLuminance||d.mipmapCount>1)&&b.generateMipMaps&&d.width>>d.mipmapCount-1==1;c(d.width,d.height,f,d.isFourCC,function(){wc.UploadDDSLevels(b.getEngine(),b,a,d,f,1)})},e}();va.b._TextureLoaders.push(new ch());var Ej=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void)
{
gl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);
}`;Ia.a.ShadersStore.rgbdEncodePixelShader=Ej;var Oc=function(){function e(){}return e.GetEnvInfo=function(a){for(var b=new DataView(a),c=0,d=0;d<e._MagicBytes.length;d++)if(b.getUint8(c++)!==e._MagicBytes[d])return r.a.Error("Not a babylon environment map"),null;for(var f="",h=0;h=b.getUint8(c++);)f+=String.fromCharCode(h);var i=JSON.parse(f);return i.specular&&(i.specular.specularDataPosition=c,i.specular.lodGenerationScale=i.specular.lodGenerationScale||.8),i},e.CreateEnvTextureAsync=function(a){var b=this,c=a.getInternalTexture();if(!c)return Promise.reject("The cube texture is invalid.");if(!a._prefiltered)return Promise.reject("The cube texture is invalid (not prefiltered).");var d=c.getEngine();if(d&&d.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(a.textureType===o.a.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var f=d.getRenderingCanvas();if(!f)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var h=o.a.TEXTURETYPE_FLOAT;if(!d.getCaps().textureFloatRender&&(h=o.a.TEXTURETYPE_HALF_FLOAT,!d.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var i=c.width,k=new ja.a(d),m={},B=[],E=p.a.Log2(c.width);E=Math.round(E);for(var K=function(S){for(var U=Math.pow(2,E-S),_=function(fa){var ga=a.readPixels(fa,S),ha=d.createRawTexture(ga,U,U,o.a.TEXTUREFORMAT_RGBA,!1,!1,o.a.TEXTURE_NEAREST_SAMPLINGMODE,null,h),ka=new Promise(function(la,ma){var ta=new Za("rgbdEncode","rgbdEncode",null,null,1,null,o.a.TEXTURE_NEAREST_SAMPLINGMODE,d,!1,void 0,o.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);ta.getEffect().executeWhenCompiled(function(){ta.onApply=function(wa){wa._bindTexture("textureSampler",ha)};var pa=d.getRenderWidth(),ua=d.getRenderHeight();d.setSize(U,U),k.postProcessManager.directRender([ta],null),xa.h.ToBlob(f,function(wa){var ya=new FileReader();ya.onload=function(Da){var Ja=Da.target.result;m[6*S+fa]=Ja,la()},ya.readAsArrayBuffer(wa)}),d.setSize(pa,ua)})});B.push(ka)},da=0;da<6;da++)_(da)},P=0;P<=E;P++)K(P);return Promise.all(B).then(function(){k.dispose();for(var S={version:1,width:i,irradiance:b._CreateEnvTextureIrradiance(a),specular:{mipmaps:[],lodGenerationScale:a.lodGenerationScale}},U=0,_=0;_<=E;_++)for(var da=0;da<6;da++){var fa=m[6*_+da].byteLength;S.specular.mipmaps.push({length:fa,position:U}),U+=fa}for(var ga=JSON.stringify(S),ha=new ArrayBuffer(ga.length+1),ka=new Uint8Array(ha),la=(_=0,ga.length);_<la;_++)ka[_]=ga.charCodeAt(_);ka[ga.length]=0;var ma=e._MagicBytes.length+U+ha.byteLength,ta=new ArrayBuffer(ma),pa=new Uint8Array(ta),ua=new DataView(ta),wa=0;for(_=0;_<e._MagicBytes.length;_++)ua.setUint8(wa++,e._MagicBytes[_]);for(pa.set(new Uint8Array(ha),wa),wa+=ha.byteLength,_=0;_<=E;_++)for(da=0;da<6;da++){var ya=m[6*_+da];pa.set(new Uint8Array(ya),wa),wa+=ya.byteLength}return ta})},e._CreateEnvTextureIrradiance=function(a){var b=a.sphericalPolynomial;return null==b?null:{x:[b.x.x,b.x.y,b.x.z],y:[b.y.x,b.y.y,b.y.z],z:[b.z.x,b.z.y,b.z.z],xx:[b.xx.x,b.xx.y,b.xx.z],yy:[b.yy.x,b.yy.y,b.yy.z],zz:[b.zz.x,b.zz.y,b.zz.z],yz:[b.yz.x,b.yz.y,b.yz.z],zx:[b.zx.x,b.zx.y,b.zx.z],xy:[b.xy.x,b.xy.y,b.xy.z]}},e.UploadEnvLevelsAsync=function(a,b,c){if(1!==c.version)throw new Error('Unsupported babylon environment map version "'+c.version+'"');var d=c.specular;if(!d)return Promise.resolve();var f=p.a.Log2(c.width);if(f=Math.round(f)+1,d.mipmaps.length!==6*f)throw new Error('Unsupported specular mipmaps number "'+d.mipmaps.length+'"');a._lodGenerationScale=d.lodGenerationScale;for(var h=new Array(f),i=0;i<f;i++){h[i]=new Array(6);for(var k=0;k<6;k++){var m=d.mipmaps[6*i+k];h[i][k]=new Uint8Array(b,d.specularDataPosition+m.position,m.length)}}return e.UploadLevelsAsync(a,h)},e.UploadLevelsAsync=function(a,b){if(!xa.h.IsExponentOfTwo(a.width))throw new Error("Texture size must be a power of two");var c=Math.round(p.a.Log2(a.width))+1,d=a.getEngine(),f=!1,h=!1,i=null,k=null,m=null,B=d.getCaps();if(a.format=o.a.TEXTUREFORMAT_RGBA,a.type=o.a.TEXTURETYPE_UNSIGNED_INT,a.generateMipMaps=!0,d.updateTextureSamplingMode(o.a.TEXTURE_TRILINEAR_SAMPLINGMODE,a),B.textureLOD?d.webGLVersion<2?f=!1:B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering?(f=!0,a.type=o.a.TEXTURETYPE_HALF_FLOAT):B.textureFloatRender&&B.textureFloatLinearFiltering&&(f=!0,a.type=o.a.TEXTURETYPE_FLOAT):(f=!1,h=!0,m={}),f)i=new Za("rgbdDecode","rgbdDecode",null,null,1,null,o.a.TEXTURE_TRILINEAR_SAMPLINGMODE,d,!1,void 0,a.type,void 0,null,!1),a._isRGBD=!1,a.invertY=!1,k=d.createRenderTargetCubeTexture(a.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:o.a.TEXTURE_TRILINEAR_SAMPLINGMODE,type:a.type,format:o.a.TEXTUREFORMAT_RGBA});else if(a._isRGBD=!0,a.invertY=!0,h)for(var E=a._lodGenerationScale,K=a._lodGenerationOffset,P=0;P<3;P++){var S=(c-1)*E+K,U=K+(S-K)*(1-P/2),_=Math.round(Math.min(Math.max(U,0),S)),da=new sb.a(d,sb.a.DATASOURCE_TEMP);da.isCube=!0,da.invertY=!0,da.generateMipMaps=!1,d.updateTextureSamplingMode(o.a.TEXTURE_LINEAR_LINEAR,da);var fa=new ac.a(null);switch(fa.isCube=!0,fa._texture=da,m[_]=fa,P){case 0:a._lodTextureLow=fa;break;case 1:a._lodTextureMid=fa;break;case 2:a._lodTextureHigh=fa}}var ga=[],ha=function(pa){for(var ua=function(ya){var Da=b[pa][ya],Ja=new Blob([Da],{type:"image/png"}),Na=URL.createObjectURL(Ja),Ma=new Image();Ma.src=Na;var Ha=new Promise(function(Qa,cb){Ma.onload=function(){if(f){var La=d.createTexture(null,!0,!0,null,o.a.TEXTURE_NEAREST_SAMPLINGMODE,null,function(Ya){cb(Ya)},Ma);i.getEffect().executeWhenCompiled(function(){i.onApply=function(Ya){Ya._bindTexture("textureSampler",La),Ya.setFloat2("scale",1,1)},d.scenes[0].postProcessManager.directRender([i],k,!0,ya,pa),d.restoreDefaultFramebuffer(),La.dispose(),window.URL.revokeObjectURL(Na),Qa()})}else{if(d._uploadImageToTexture(a,Ma,ya,pa),h){var Oa=m[pa];Oa&&d._uploadImageToTexture(Oa._texture,Ma,ya,0)}Qa()}},Ma.onerror=function(La){cb(La)}});ga.push(Ha)},wa=0;wa<6;wa++)ua(wa)};for(P=0;P<b.length;P++)ha(P);if(b.length<c){var ka,la=Math.pow(2,c-1-b.length),ma=la*la*4;switch(a.type){case o.a.TEXTURETYPE_UNSIGNED_INT:ka=new Uint8Array(ma);break;case o.a.TEXTURETYPE_HALF_FLOAT:ka=new Uint16Array(ma);break;case o.a.TEXTURETYPE_FLOAT:ka=new Float32Array(ma)}for(P=b.length;P<c;P++)for(var ta=0;ta<6;ta++)d._uploadArrayBufferViewToTexture(a,ka,ta,P)}return Promise.all(ga).then(function(){k&&(d._releaseFramebufferObjects(k),k._swapAndDie(a)),i&&i.dispose(),h&&(a._lodTextureHigh&&a._lodTextureHigh._texture&&(a._lodTextureHigh._texture.isReady=!0),a._lodTextureMid&&a._lodTextureMid._texture&&(a._lodTextureMid._texture.isReady=!0),a._lodTextureLow&&a._lodTextureLow._texture&&(a._lodTextureLow._texture.isReady=!0))})},e.UploadEnvSpherical=function(a,b){1!==b.version&&r.a.Warn('Unsupported babylon environment map version "'+b.version+'"');var c=b.irradiance;if(c){var d=new hd.b();j.x.FromArrayToRef(c.x,0,d.x),j.x.FromArrayToRef(c.y,0,d.y),j.x.FromArrayToRef(c.z,0,d.z),j.x.FromArrayToRef(c.xx,0,d.xx),j.x.FromArrayToRef(c.yy,0,d.yy),j.x.FromArrayToRef(c.zz,0,d.zz),j.x.FromArrayToRef(c.yz,0,d.yz),j.x.FromArrayToRef(c.zx,0,d.zx),j.x.FromArrayToRef(c.xy,0,d.xy),a._sphericalPolynomial=d}},e._UpdateRGBDAsync=function(a,b,c,d,f){return a._dataSource=sb.a.DATASOURCE_CUBERAW_RGBD,a._bufferViewArrayArray=b,a._lodGenerationScale=d,a._lodGenerationOffset=f,a._sphericalPolynomial=c,e.UploadLevelsAsync(a,b).then(function(){a.isReady=!0})},e._MagicBytes=[134,22,135,150,246,214,150,54],e}();sb.a._UpdateRGBDAsync=Oc._UpdateRGBDAsync;var dh=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(a,b,c,d,f){return 0===a.indexOf(".env")},e.prototype.transformUrl=function(a,b){return a},e.prototype.getFallbackTextureUrl=function(a,b){return null},e.prototype.loadCubeData=function(a,b,c,d,f){if(!Array.isArray(a)){a=a;var h=Oc.GetEnvInfo(a);h?(b.width=h.width,b.height=h.width,Oc.UploadEnvSpherical(b,h),Oc.UploadEnvLevelsAsync(b,a,h).then(function(){b.isReady=!0,d&&d()})):f&&f("Can not parse the environment file",null)}},e.prototype.loadData=function(a,b,c){throw".env not supported in 2d."},e}();va.b._TextureLoaders.push(new dh());var $e=function(){function e(a,b,c,d){this.arrayBuffer=a,this.isInvalid=!1;var f=new Uint8Array(this.arrayBuffer,0,12);if(171!==f[0]||75!==f[1]||84!==f[2]||88!==f[3]||32!==f[4]||49!==f[5]||49!==f[6]||187!==f[7]||13!==f[8]||10!==f[9]||26!==f[10]||10!==f[11])return this.isInvalid=!0,void r.a.Error("texture missing KTX identifier");var h=Uint32Array.BYTES_PER_ELEMENT,i=new DataView(this.arrayBuffer,12,13*h),k=67305985===i.getUint32(0,!0);this.glType=i.getUint32(1*h,k),this.glTypeSize=i.getUint32(2*h,k),this.glFormat=i.getUint32(3*h,k),this.glInternalFormat=i.getUint32(4*h,k),this.glBaseInternalFormat=i.getUint32(5*h,k),this.pixelWidth=i.getUint32(6*h,k),this.pixelHeight=i.getUint32(7*h,k),this.pixelDepth=i.getUint32(8*h,k),this.numberOfArrayElements=i.getUint32(9*h,k),this.numberOfFaces=i.getUint32(10*h,k),this.numberOfMipmapLevels=i.getUint32(11*h,k),this.bytesOfKeyValueData=i.getUint32(12*h,k),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===b?this.loadType=e.COMPRESSED_2D:r.a.Error("number of faces expected"+b+", but found "+this.numberOfFaces):r.a.Error("texture arrays not currently supported"):r.a.Error("only 2D textures currently supported")):r.a.Error("only compressed formats currently supported")}return e.prototype.uploadLevels=function(a,b){switch(this.loadType){case e.COMPRESSED_2D:this._upload2DCompressedLevels(a,b);break;case e.TEX_2D:case e.COMPRESSED_3D:case e.TEX_3D:}},e.prototype._upload2DCompressedLevels=function(a,b){for(var c=e.HEADER_LEN+this.bytesOfKeyValueData,d=this.pixelWidth,f=this.pixelHeight,h=b?this.numberOfMipmapLevels:1,i=0;i<h;i++){var k=new Int32Array(this.arrayBuffer,c,1)[0];c+=4;for(var m=0;m<this.numberOfFaces;m++){var B=new Uint8Array(this.arrayBuffer,c,k);a.getEngine()._uploadCompressedDataToTextureDirectly(a,this.glInternalFormat,d,f,B,m,i),c+=k,c+=3-(k+3)%4}d=Math.max(1,.5*d),f=Math.max(1,.5*f)}},e.HEADER_LEN=64,e.COMPRESSED_2D=0,e.COMPRESSED_3D=1,e.TEX_2D=2,e.TEX_3D=3,e}(),eh=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(a,b,c,d,f){return!(!b||d||c||f)},e.prototype.transformUrl=function(a,b){var c=a.lastIndexOf(".");return-1!=c&&"ktx"==a.substring(c+1)?a:(c>-1?a.substring(0,c):a)+b},e.prototype.getFallbackTextureUrl=function(a,b){var c=new RegExp(b+"$");return a.replace(c,"")},e.prototype.loadCubeData=function(a,b,c,d,f){if(!Array.isArray(a)){b._invertVScale=!b.invertY;var h=b.getEngine(),i=new $e(a,6),k=i.numberOfMipmapLevels>1&&b.generateMipMaps;h._unpackFlipY(!0),i.uploadLevels(b,b.generateMipMaps),b.width=i.pixelWidth,b.height=i.pixelHeight,h._setCubeMapTextureParams(k),b.isReady=!0}},e.prototype.loadData=function(a,b,c){b._invertVScale=!b.invertY;var d=new $e(a,1);c(d.pixelWidth,d.pixelHeight,!1,!0,function(){d.uploadLevels(b,b.generateMipMaps)},d.isInvalid)},e}();va.b._TextureLoaders.unshift(new eh()),ja.a.prototype.createDefaultLight=function(e){if(void 0===e&&(e=!1),e&&this.lights)for(var a=0;a<this.lights.length;a++)this.lights[a].dispose();0===this.lights.length&&new Ed.a("default light",j.x.Up(),this)},ja.a.prototype.createDefaultCamera=function(e,a,b){if(void 0===e&&(e=!1),void 0===a&&(a=!1),void 0===b&&(b=!1),a&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var c,d=this.getWorldExtends(),f=d.max.subtract(d.min),h=d.min.add(f.scale(.5)),i=1.5*f.length();if(isFinite(i)||(i=1,h.copyFromFloats(0,0,0)),e){var k=new Bc("default camera",-Math.PI/2,Math.PI/2,i,h,this);k.lowerRadiusLimit=.01*i,k.wheelPrecision=100/i,c=k}else{var m=new Wb("default camera",new j.x(h.x,h.y,-i),this);m.setTarget(h),c=m}c.minZ=.01*i,c.maxZ=1000*i,c.speed=.2*i,this.activeCamera=c;var B=this.getEngine().getRenderingCanvas();b&&B&&c.attachControl(B)}},ja.a.prototype.createDefaultCameraOrLight=function(e,a,b){void 0===e&&(e=!1),void 0===a&&(a=!1),void 0===b&&(b=!1),this.createDefaultLight(a),this.createDefaultCamera(e,a,b)},ja.a.prototype.createDefaultSkybox=function(e,a,b,c,d){if(void 0===a&&(a=!1),void 0===b&&(b=1000),void 0===c&&(c=0),void 0===d&&(d=!0),!e)return r.a.Warn("Can not create default skybox without environment texture."),null;d&&e&&(this.environmentTexture=e);var f=Ca.a.CreateBox("hdrSkyBox",b,this);if(a){var h=new Ye("skyBox",this);h.backFaceCulling=!1,h.reflectionTexture=e.clone(),h.reflectionTexture&&(h.reflectionTexture.coordinatesMode=ra.a.SKYBOX_MODE),h.microSurface=1-c,h.disableLighting=!0,h.twoSidedLighting=!0,f.infiniteDistance=!0,f.material=h}else{var i=new Pb.a("skyBox",this);i.backFaceCulling=!1,i.reflectionTexture=e.clone(),i.reflectionTexture&&(i.reflectionTexture.coordinatesMode=ra.a.SKYBOX_MODE),i.disableLighting=!0,f.infiniteDistance=!0,f.material=i}return f.isPickable=!1,f},ja.a.prototype.createDefaultEnvironment=function(e){return We?new We(e,this):null},ja.a.prototype.createDefaultVRExperience=function(e){return void 0===e&&(e={}),new Dg(this,e)},ja.a.prototype.createDefaultXRExperienceAsync=function(){var e=this;return Gg.CreateAsync(this).then(function(a){var b=new Kg(a);return Hg.CreateAsync(e,a,{outputCanvasContext:b.canvasContext}).then(function(c){return new Jg(a),a})})};var fh=function(e){function a(b,c,d,f,h,i,k){void 0===f&&(f=!1),void 0===h&&(h=!1),void 0===i&&(i=ra.a.TRILINEAR_SAMPLINGMODE),void 0===k&&(k={autoPlay:!0,loop:!0,autoUpdateTexture:!0});var m=e.call(this,null,d,!f,h)||this;m._onUserActionRequestedObservable=null,m._stillImageCaptured=!1,m._displayingPosterTexture=!1,m._createInternalTexture=function(){if(null!=m._texture){if(!m._displayingPosterTexture)return;m._texture.dispose(),m._displayingPosterTexture=!1}if(!m._engine.needPOTTextures||xa.h.IsExponentOfTwo(m.video.videoWidth)&&xa.h.IsExponentOfTwo(m.video.videoHeight)?(m.wrapU=ra.a.WRAP_ADDRESSMODE,m.wrapV=ra.a.WRAP_ADDRESSMODE):(m.wrapU=ra.a.CLAMP_ADDRESSMODE,m.wrapV=ra.a.CLAMP_ADDRESSMODE,m._generateMipMaps=!1),m._texture=m._engine.createDynamicTexture(m.video.videoWidth,m.video.videoHeight,m._generateMipMaps,m.samplingMode),m.video.autoplay||m._settings.poster)m._texture.isReady=!0,m._updateInternalTexture(),m.onLoadObservable.hasObservers()&&m.onLoadObservable.notifyObservers(m);else{var E=m.video.onplaying,K=!1,P=m.video.muted;m.video.muted=!0,m.video.onplaying=function(){m.video.muted=P,m.video.onplaying=E,m._texture.isReady=!0,m._updateInternalTexture(),K||m.video.pause(),m.onLoadObservable.hasObservers()&&m.onLoadObservable.notifyObservers(m)};var S=m.video.play();S?S.then(function(){}).catch(function(){K=!0,m._onUserActionRequestedObservable&&m._onUserActionRequestedObservable.hasObservers()&&m._onUserActionRequestedObservable.notifyObservers(m)}):(m.video.onplaying=E,m._texture.isReady=!0,m._updateInternalTexture(),m.onLoadObservable.hasObservers()&&m.onLoadObservable.notifyObservers(m))}},m.reset=function(){null!=m._texture&&(m._displayingPosterTexture||(m._texture.dispose(),m._texture=null))},m._updateInternalTexture=function(){null!=m._texture&&m._texture.isReady&&(m.video.readyState<m.video.HAVE_CURRENT_DATA||m._displayingPosterTexture||m._engine.updateVideoTexture(m._texture,m.video,m._invertY))},m._engine=m.getScene().getEngine(),m._generateMipMaps=f,m._initialSamplingMode=i,m.autoUpdateTexture=k.autoUpdateTexture,m.name=b||m._getName(c),m.video=m._getVideo(c),m._settings=k,k.poster&&(m.video.poster=k.poster),void 0!==k.autoPlay&&(m.video.autoplay=k.autoPlay),void 0!==k.loop&&(m.video.loop=k.loop),m.video.setAttribute("playsinline",""),m.video.addEventListener("paused",m._updateInternalTexture),m.video.addEventListener("seeked",m._updateInternalTexture),m.video.addEventListener("emptied",m.reset),m._createInternalTextureOnEvent=k.poster&&!k.autoPlay?"play":"canplay",m.video.addEventListener(m._createInternalTextureOnEvent,m._createInternalTexture);var B=m.video.readyState>=m.video.HAVE_CURRENT_DATA;return!k.poster||k.autoPlay&&B?B&&m._createInternalTexture():(m._texture=m._engine.createTexture(k.poster,!1,!0,d),m._displayingPosterTexture=!0),m}return v.d(a,e),Object.defineProperty(a.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new q.c()),this._onUserActionRequestedObservable},enumerable:!0,configurable:!0}),a.prototype._getName=function(b){return b instanceof HTMLVideoElement?b.currentSrc:"object"==typeof b?b.toString():b},a.prototype._getVideo=function(b){if(b instanceof HTMLVideoElement)return xa.h.SetCorsBehavior(b.currentSrc,b),b;var c=document.createElement("video");return"string"==typeof b?(xa.h.SetCorsBehavior(b,c),c.src=b):(xa.h.SetCorsBehavior(b[0],c),b.forEach(function(d){var f=document.createElement("source");f.src=d,c.appendChild(f)})),c},a.prototype._rebuild=function(){this.update()},a.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},a.prototype.updateTexture=function(b){b&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},a.prototype.updateURL=function(b){this.video.src=b},a.prototype.dispose=function(){e.prototype.dispose.call(this),this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener(this._createInternalTextureOnEvent,this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this.reset),this.video.pause()},a.CreateFromStreamAsync=function(b,c){var d=document.createElement("video");return d.setAttribute("autoplay",""),d.setAttribute("muted","true"),d.setAttribute("playsinline",""),d.muted=!0,void 0!==d.mozSrcObject?d.mozSrcObject=c:"object"==typeof d.srcObject?d.srcObject=c:(window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,d.src=window.URL&&window.URL.createObjectURL(c)),new Promise(function(f){var h=function(){f(new a("video",d,b,!0,!0)),d.removeEventListener("playing",h)};d.addEventListener("playing",h),d.play()})},a.CreateFromWebCamAsync=function(b,c,d){var f,h=this;return void 0===d&&(d=!1),c&&c.deviceId&&(f={exact:c.deviceId}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:c,audio:d}).then(function(i){return h.CreateFromStreamAsync(b,i)}):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:f,width:{min:c&&c.minWidth||256,max:c&&c.maxWidth||640},height:{min:c&&c.minHeight||256,max:c&&c.maxHeight||480}},audio:d},function(i){return h.CreateFromStreamAsync(b,i)},function(i){r.a.Error(i.name)}),Promise.reject("No support for userMedia on this device"))},a.CreateFromWebCam=function(b,c,d,f){void 0===f&&(f=!1),this.CreateFromWebCamAsync(b,d,f).then(function(h){c&&c(h)}).catch(function(h){r.a.Error(h.name)})},a}(ra.a),Fj=function(e){function a(b,c,d,f){var h=e.call(this,b,f)||this;h._useDirectMapping=!1,h._videoMode=a.MODE_MONOSCOPIC,h._onBeforeCameraRenderObserver=null,f=h.getScene(),b=b||"videoDome",d.resolution=0|Math.abs(d.resolution)||32,d.clickToPlay=Boolean(d.clickToPlay),d.autoPlay=void 0===d.autoPlay||Boolean(d.autoPlay),d.loop=void 0===d.loop||Boolean(d.loop),d.size=Math.abs(d.size)||(f.activeCamera?.48*f.activeCamera.maxZ:1000),void 0===d.useDirectMapping?h._useDirectMapping=!0:h._useDirectMapping=d.useDirectMapping,void 0===d.faceForward&&(d.faceForward=!0),h._setReady(!1);var i={loop:d.loop,autoPlay:d.autoPlay,autoUpdateTexture:!0,poster:d.poster},k=h._material=new Mc(b+"_material",f),m=h._videoTexture=new fh(b+"_texture",c,f,!1,h._useDirectMapping,ra.a.TRILINEAR_SAMPLINGMODE,i);if(h._mesh=Ca.a.CreateSphere(b+"_mesh",d.resolution,d.size,f,!1,Ca.a.BACKSIDE),m.onLoadObservable.addOnce(function(){h._setReady(!0)}),k.useEquirectangularFOV=!0,k.fovMultiplier=1,k.opacityFresnel=!1,h._useDirectMapping?(m.wrapU=ra.a.CLAMP_ADDRESSMODE,m.wrapV=ra.a.CLAMP_ADDRESSMODE,k.diffuseTexture=m):(m.coordinatesMode=ra.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,m.wrapV=ra.a.CLAMP_ADDRESSMODE,k.reflectionTexture=m),h._mesh.material=k,h._mesh.parent=h,d.clickToPlay&&(f.onPointerUp=function(){h._videoTexture.video.play()}),d.faceForward&&f.activeCamera){var B=f.activeCamera,E=j.x.Forward(),K=j.x.TransformNormal(E,B.getViewMatrix());K.normalize(),h.rotation.y=Math.acos(j.x.Dot(E,K))}return h}return v.d(a,e),Object.defineProperty(a.prototype,"videoTexture",{get:function(){return this._videoTexture},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(b){this._material.fovMultiplier=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"videoMode",{get:function(){return this._videoMode},set:function(b){this._videoMode!==b&&this._changeVideoMode(b)},enumerable:!0,configurable:!0}),a.prototype._changeVideoMode=function(b){var c=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._videoMode=b,this._videoTexture.uScale=1,this._videoTexture.vScale=1,this._videoTexture.uOffset=0,this._videoTexture.vOffset=0,b){case a.MODE_SIDEBYSIDE:this._videoTexture.uScale=.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(d){c._videoTexture.uOffset=d.isRightCamera?.5:0});break;case a.MODE_TOPBOTTOM:this._videoTexture.vScale=.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(d){c._videoTexture.vOffset=d.isRightCamera?.5:0})}},a.prototype.dispose=function(b,c){void 0===c&&(c=!1),this._videoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),e.prototype.dispose.call(this,b,c)},a.MODE_MONOSCOPIC=0,a.MODE_TOPBOTTOM=1,a.MODE_SIDEBYSIDE=2,a}(Od.a),Gj=function(){function e(a){this.engine=a,this._captureGPUFrameTime=!1,this._gpuFrameTime=new xa.f(),this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new xa.f(),this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(e.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(a){var b=this;a!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=a,a?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){b._gpuFrameTimeToken||(b._gpuFrameTimeToken=b.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(b._gpuFrameTimeToken){var c=b.engine.endTimeQuery(b._gpuFrameTimeToken);c>-1&&(b._gpuFrameTimeToken=null,b._gpuFrameTime.fetchNewFrame(),b._gpuFrameTime.addCount(c,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(a){var b=this;a!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=a,a?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){b._shaderCompilationTime.fetchNewFrame(),b._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){b._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},e}(),Hj=function(){function e(a){var b=this;this.scene=a,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new xa.f(),this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new xa.f(),this._captureFrameTime=!1,this._frameTime=new xa.f(),this._captureRenderTime=!1,this._renderTime=new xa.f(),this._captureInterFrameTime=!1,this._interFrameTime=new xa.f(),this._captureParticlesRenderTime=!1,this._particlesRenderTime=new xa.f(),this._captureSpritesRenderTime=!1,this._spritesRenderTime=new xa.f(),this._capturePhysicsTime=!1,this._physicsTime=new xa.f(),this._captureAnimationsTime=!1,this._animationsTime=new xa.f(),this._captureCameraRenderTime=!1,this._cameraRenderTime=new xa.f(),this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=a.onBeforeAnimationsObservable.add(function(){b._captureActiveMeshesEvaluationTime&&b._activeMeshesEvaluationTime.fetchNewFrame(),b._captureRenderTargetsRenderTime&&b._renderTargetsRenderTime.fetchNewFrame(),b._captureFrameTime&&(xa.h.StartPerformanceCounter("Scene rendering"),b._frameTime.beginMonitoring()),b._captureInterFrameTime&&b._interFrameTime.endMonitoring(),b._captureParticlesRenderTime&&b._particlesRenderTime.fetchNewFrame(),b._captureSpritesRenderTime&&b._spritesRenderTime.fetchNewFrame(),b._captureAnimationsTime&&b._animationsTime.beginMonitoring(),b.scene.getEngine()._drawCalls.fetchNewFrame()}),this._onAfterRenderObserver=a.onAfterRenderObservable.add(function(){b._captureFrameTime&&(xa.h.EndPerformanceCounter("Scene rendering"),b._frameTime.endMonitoring()),b._captureRenderTime&&b._renderTime.endMonitoring(!1),b._captureInterFrameTime&&b._interFrameTime.beginMonitoring()})}return Object.defineProperty(e.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(a){var b=this;a!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=a,a?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){xa.h.StartPerformanceCounter("Active meshes evaluation"),b._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){xa.h.EndPerformanceCounter("Active meshes evaluation"),b._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(a){var b=this;a!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=a,a?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add(function(){xa.h.StartPerformanceCounter("Render targets rendering"),b._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add(function(){xa.h.EndPerformanceCounter("Render targets rendering"),b._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(a){var b=this;a!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=a,a?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){xa.h.StartPerformanceCounter("Particles"),b._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){xa.h.EndPerformanceCounter("Particles"),b._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(a){var b=this;a!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=a,this.scene.spriteManagers&&(a?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){xa.h.StartPerformanceCounter("Sprites"),b._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){xa.h.EndPerformanceCounter("Sprites"),b._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(a){var b=this;a!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=a,a?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){xa.h.StartPerformanceCounter("Physics"),b._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){xa.h.EndPerformanceCounter("Physics"),b._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(a){var b=this;a!==this._captureAnimationsTime&&(this._captureAnimationsTime=a,a?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){b._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(a){this._captureFrameTime=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(a){this._captureInterFrameTime=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(a){var b=this;a!==this._captureRenderTime&&(this._captureRenderTime=a,a?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){b._renderTime.beginMonitoring(),xa.h.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){b._renderTime.endMonitoring(!1),xa.h.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(a){var b=this;a!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=a,a?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add(function(c){b._cameraRenderTime.beginMonitoring(),xa.h.StartPerformanceCounter("Rendering camera "+c.name)}),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add(function(c){b._cameraRenderTime.endMonitoring(!1),xa.h.EndPerformanceCounter("Rendering camera "+c.name)})):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},e}(),rb=l(20),Ij=`#ifdef DIFFUSE
varying vec2 vUVDiffuse;
uniform sampler2D diffuseSampler;
#endif
#ifdef OPACITY
varying vec2 vUVOpacity;
uniform sampler2D opacitySampler;
uniform float opacityIntensity;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform sampler2D emissiveSampler;
#endif
#ifdef VERTEXALPHA
varying vec4 vColor;
#endif
uniform vec4 glowColor;
void main(void)
{
vec4 finalColor=glowColor;

#ifdef DIFFUSE
vec4 albedoTexture=texture2D(diffuseSampler,vUVDiffuse);
finalColor.a*=albedoTexture.a;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vUVOpacity);
#ifdef OPACITYRGB
finalColor.a*=getLuminance(opacityMap.rgb);
#else
finalColor.a*=opacityMap.a;
#endif
finalColor.a*=opacityIntensity;
#endif
#ifdef VERTEXALPHA
finalColor.a*=vColor.a;
#endif
#ifdef ALPHATEST
if (finalColor.a<ALPHATESTVALUE)
discard;
#endif
#ifdef EMISSIVE
gl_FragColor=texture2D(emissiveSampler,vUVEmissive)*finalColor;
#else
gl_FragColor=finalColor;
#endif
}`;Ia.a.ShadersStore.glowMapGenerationPixelShader=Ij;var Jj=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
varying vec4 vPosition;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef DIFFUSE
varying vec2 vUVDiffuse;
uniform mat4 diffuseMatrix;
#endif
#ifdef OPACITY
varying vec2 vUVOpacity;
uniform mat4 opacityMatrix;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform mat4 emissiveMatrix;
#endif
#ifdef VERTEXALPHA
attribute vec4 color;
varying vec4 vColor;
#endif
void main(void)
{
vec3 positionUpdated=position;
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#ifdef CUBEMAP
vPosition=finalWorld*vec4(positionUpdated,1.0);
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#else
vPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
gl_Position=vPosition;
#endif
#ifdef DIFFUSE
#ifdef DIFFUSEUV1
vUVDiffuse=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef DIFFUSEUV2
vUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef OPACITY
#ifdef OPACITYUV1
vUVOpacity=vec2(opacityMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef OPACITYUV2
vUVOpacity=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef EMISSIVE
#ifdef EMISSIVEUV1
vUVEmissive=vec2(emissiveMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef EMISSIVEUV2
vUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef VERTEXALPHA
vColor=color;
#endif
}`;Ia.a.ShadersStore.glowMapGenerationVertexShader=Jj;var id=function(){function e(a,b){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new j.f()},this.neutralColor=new j.f(),this.isEnabled=!0,this.onDisposeObservable=new q.c(),this.onBeforeRenderMainTextureObservable=new q.c(),this.onBeforeComposeObservable=new q.c(),this.onAfterComposeObservable=new q.c(),this.onSizeChangedObservable=new q.c(),this.name=a,this._scene=b||T.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._generateVertexBuffer()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},enumerable:!0,configurable:!0}),e.prototype._init=function(a){this._effectLayerOptions=v.a({mainTextureRatio:.5,alphaBlendingMode:o.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},a),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},e.prototype._generateIndexBuffer=function(){var a=[];a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=this._engine.createIndexBuffer(a)},e.prototype._generateVertexBuffer=function(){var a=[];a.push(1,1),a.push(-1,1),a.push(-1,-1),a.push(1,-1);var b=new na.b(this._engine,a,na.b.PositionKind,!1,!1,2);this._vertexBuffers[na.b.PositionKind]=b},e.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?xa.h.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?xa.h.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},e.prototype._createMainTexture=function(){var a=this;this._mainTexture=new Ab("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,o.a.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=ra.a.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=ra.a.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(ra.a.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(b,c,d,f){var h;a.onBeforeRenderMainTextureObservable.notifyObservers(a);var i=a._scene.getEngine();if(f.length){for(i.setColorWrite(!1),h=0;h<f.length;h++)a._renderSubMesh(f.data[h]);i.setColorWrite(!0)}for(h=0;h<b.length;h++)a._renderSubMesh(b.data[h]);for(h=0;h<c.length;h++)a._renderSubMesh(c.data[h]);var k=i.getAlphaMode();for(h=0;h<d.length;h++)a._renderSubMesh(d.data[h],!0);i.setAlphaMode(k)},this._mainTexture.onClearObservable.add(function(b){b.clear(a.neutralColor,!0,!0,!0)})},e.prototype._addCustomEffectDefines=function(a){},e.prototype._isReady=function(a,b,c){var d=a.getMaterial();if(!d)return!1;if(!d.isReadyForSubMesh(a.getMesh(),a,b))return!1;var f=[],h=[na.b.PositionKind],i=a.getMesh(),k=!1,m=!1;if(d){var B=d.needAlphaTesting(),E=d.getAlphaTestTexture(),K=E&&E.hasAlpha&&(d.useAlphaFromDiffuseTexture||d._useAlphaFromAlbedoTexture);E&&(B||K)&&(f.push("#define DIFFUSE"),i.isVerticesDataPresent(na.b.UV2Kind)&&1===E.coordinatesIndex?(f.push("#define DIFFUSEUV2"),m=!0):i.isVerticesDataPresent(na.b.UVKind)&&(f.push("#define DIFFUSEUV1"),k=!0),B&&(f.push("#define ALPHATEST"),f.push("#define ALPHATESTVALUE 0.4")));var P=d.opacityTexture;P&&(f.push("#define OPACITY"),i.isVerticesDataPresent(na.b.UV2Kind)&&1===P.coordinatesIndex?(f.push("#define OPACITYUV2"),m=!0):i.isVerticesDataPresent(na.b.UVKind)&&(f.push("#define OPACITYUV1"),k=!0))}c&&(f.push("#define EMISSIVE"),i.isVerticesDataPresent(na.b.UV2Kind)&&1===c.coordinatesIndex?(f.push("#define EMISSIVEUV2"),m=!0):i.isVerticesDataPresent(na.b.UVKind)&&(f.push("#define EMISSIVEUV1"),k=!0)),i.isVerticesDataPresent(na.b.ColorKind)&&i.hasVertexAlpha&&(h.push(na.b.ColorKind),f.push("#define VERTEXALPHA")),k&&(h.push(na.b.UVKind),f.push("#define UV1")),m&&(h.push(na.b.UV2Kind),f.push("#define UV2")),i.useBones&&i.computeBonesUsingShaders?(h.push(na.b.MatricesIndicesKind),h.push(na.b.MatricesWeightsKind),i.numBoneInfluencers>4&&(h.push(na.b.MatricesIndicesExtraKind),h.push(na.b.MatricesWeightsExtraKind)),f.push("#define NUM_BONE_INFLUENCERS "+i.numBoneInfluencers),f.push("#define BonesPerMesh "+(i.skeleton?i.skeleton.bones.length+1:0))):f.push("#define NUM_BONE_INFLUENCERS 0");var S=i.morphTargetManager,U=0;S&&S.numInfluencers>0&&(f.push("#define MORPHTARGETS"),U=S.numInfluencers,f.push("#define NUM_MORPH_INFLUENCERS "+U),Ta.a.PrepareAttributesForMorphTargets(h,i,{NUM_MORPH_INFLUENCERS:U})),b&&(f.push("#define INSTANCES"),h.push("world0"),h.push("world1"),h.push("world2"),h.push("world3")),this._addCustomEffectDefines(f);var _=f.join(`
`);return this._cachedDefines!==_&&(this._cachedDefines=_,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",h,["world","mBones","viewProjection","glowColor","morphTargetInfluences","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity"],["diffuseSampler","emissiveSampler","opacitySampler"],_,void 0,void 0,void 0,{maxSimultaneousMorphTargets:U})),this._effectLayerMapGenerationEffect.isReady()},e.prototype.render=function(){var a=this._mergeEffect;if(a.isReady()){for(var b=0;b<this._postProcesses.length;b++)if(!this._postProcesses[b].isReady())return;var c=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),c.enableEffect(a),c.setState(!1),c.bindBuffers(this._vertexBuffers,this._indexBuffer,a);var d=c.getAlphaMode();c.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(a),c.setAlphaMode(d),this.onAfterComposeObservable.notifyObservers(this);var f=this._mainTexture.getSize();this._setMainTextureSize(),f.width===this._mainTextureDesiredSize.width&&f.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},e.prototype.hasMesh=function(a){return-1===this.renderingGroupId||a.renderingGroupId===this.renderingGroupId},e.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},e.prototype._shouldRenderMesh=function(a){return!0},e.prototype._canRenderMesh=function(a,b){return!b.needAlphaBlendingForMesh(a)},e.prototype._shouldRenderEmissiveTextureForMesh=function(){return!0},e.prototype._renderSubMesh=function(a,b){var c=this;if(void 0===b&&(b=!1),this.shouldRender()){var d=a.getMaterial(),f=a.getRenderingMesh(),h=this._scene,i=h.getEngine();if(f._internalAbstractMeshDataInfo._isActiveIntermediate=!1,d&&this._canRenderMesh(f,d)){i.setState(d.backFaceCulling);var k=f._getInstancesRenderList(a._id);if(!k.mustReturn&&this._shouldRenderMesh(f)){var m=k.hardwareInstancedRendering[a._id];if(this._setEmissiveTextureAndColor(f,a,d),this._isReady(a,m,this._emissiveTextureAndColor.texture)){i.enableEffect(this._effectLayerMapGenerationEffect),f._bind(a,this._effectLayerMapGenerationEffect,rb.a.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",h.getTransformMatrix()),this._effectLayerMapGenerationEffect.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a);var B=d.needAlphaTesting(),E=d.getAlphaTestTexture(),K=E&&E.hasAlpha&&(d.useAlphaFromDiffuseTexture||d._useAlphaFromAlbedoTexture);E&&(B||K)&&(this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",E),(P=E.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",P));var P,S=d.opacityTexture;S&&(this._effectLayerMapGenerationEffect.setTexture("opacitySampler",S),this._effectLayerMapGenerationEffect.setFloat("opacityIntensity",S.level),(P=S.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("opacityMatrix",P)),this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),f.useBones&&f.computeBonesUsingShaders&&f.skeleton&&this._effectLayerMapGenerationEffect.setMatrices("mBones",f.skeleton.getTransformMatrices(f)),Ta.a.BindMorphTargetParameters(f,this._effectLayerMapGenerationEffect),b&&i.setAlphaMode(d.alphaMode),f._processRendering(a,this._effectLayerMapGenerationEffect,rb.a.TriangleFillMode,k,m,function(U,_){return c._effectLayerMapGenerationEffect.setMatrix("world",_)})}else this._mainTexture.resetRefreshCounter()}}}},e.prototype._rebuild=function(){var a=this._vertexBuffers[na.b.PositionKind];a&&a._rebuild(),this._generateIndexBuffer()},e.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var a=0;a<this._postProcesses.length;a++)this._postProcesses[a]&&this._postProcesses[a].dispose();for(this._postProcesses=[],a=0;a<this._textures.length;a++)this._textures[a]&&this._textures[a].dispose();this._textures=[]},e.prototype.dispose=function(){var a=this._vertexBuffers[na.b.PositionKind];a&&(a.dispose(),this._vertexBuffers[na.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var b=this._scene.effectLayers.indexOf(this,0);b>-1&&this._scene.effectLayers.splice(b,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},e.prototype.getClassName=function(){return"EffectLayer"},e.Parse=function(a,b,c){return xa.h.Instantiate(a.customType).Parse(a,b,c)},e._SceneComponentInitialization=function(a){throw Zb.a.WarnImport("EffectLayerSceneComponent")},v.c([Object(g.c)()],e.prototype,"name",void 0),v.c([Object(g.f)()],e.prototype,"neutralColor",void 0),v.c([Object(g.c)()],e.prototype,"isEnabled",void 0),v.c([Object(g.d)()],e.prototype,"camera",null),v.c([Object(g.c)()],e.prototype,"renderingGroupId",null),e}();O.a.AddParser(Pa.a.NAME_EFFECTLAYER,function(e,a,b,c){if(e.effectLayers){b.effectLayers||(b.effectLayers=new Array());for(var d=0;d<e.effectLayers.length;d++){var f=id.Parse(e.effectLayers[d],a,c);b.effectLayers.push(f)}}}),O.a.prototype.removeEffectLayer=function(e){var a=this.effectLayers.indexOf(e);return-1!==a&&this.effectLayers.splice(a,1),a},O.a.prototype.addEffectLayer=function(e){this.effectLayers.push(e)};var gh=function(){function e(a){this.name=Pa.a.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=a,this._engine=a.getEngine(),a.effectLayers=new Array()}return e.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(Pa.a.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(Pa.a.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(Pa.a.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(Pa.a.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(Pa.a.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(Pa.a.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},e.prototype.rebuild=function(){for(var a=0,b=this.scene.effectLayers;a<b.length;a++)b[a]._rebuild()},e.prototype.serialize=function(a){a.effectLayers=[];for(var b=0,c=this.scene.effectLayers;b<c.length;b++){var d=c[b];d.serialize&&a.effectLayers.push(d.serialize())}},e.prototype.addFromContainer=function(a){var b=this;a.effectLayers&&a.effectLayers.forEach(function(c){b.scene.addEffectLayer(c)})},e.prototype.removeFromContainer=function(a,b){var c=this;a.effectLayers&&a.effectLayers.forEach(function(d){c.scene.removeEffectLayer(d),b&&d.dispose()})},e.prototype.dispose=function(){for(var a=this.scene.effectLayers;a.length;)a[0].dispose()},e.prototype._isReadyForMesh=function(a,b){for(var c=0,d=this.scene.effectLayers;c<d.length;c++){var f=d[c];if(f.hasMesh(a))for(var h=0,i=a.subMeshes;h<i.length;h++){var k=i[h];if(!f.isReady(k,b))return!1}}return!0},e.prototype._renderMainTexture=function(a){this._renderEffects=!1,this._needStencil=!1;var b=!1,c=this.scene.effectLayers;if(c&&c.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var d=0,f=c;d<f.length;d++){var h=f[d];if(h.shouldRender()&&(!h.camera||h.camera.cameraRigMode===ab.a.RIG_MODE_NONE&&a===h.camera||h.camera.cameraRigMode!==ab.a.RIG_MODE_NONE&&h.camera._rigCameras.indexOf(a)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||h.needStencil();var i=h._mainTexture;i._shouldRender()&&(this.scene.incrementRenderId(),i.render(!1,!1),b=!0)}}this.scene.incrementRenderId()}return b},e.prototype._setStencil=function(){this._needStencil&&this._engine.setStencilBuffer(!0)},e.prototype._setStencilBack=function(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},e.prototype._draw=function(a){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var b=this.scene.effectLayers,c=0;c<b.length;c++){var d=b[c];d.renderingGroupId===a&&d.shouldRender()&&d.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCamera=function(){this._renderEffects&&this._draw(-1)},e.prototype._drawRenderingGroup=function(a){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(a)},e}();id._SceneComponentInitialization=function(e){var a=e._getComponent(Pa.a.NAME_EFFECTLAYER);a||(a=new gh(e),e._addComponent(a))};var Kj=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#ifdef EMISSIVE
uniform sampler2D textureSampler2;
#endif

uniform float offset;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef EMISSIVE
baseColor+=texture2D(textureSampler2,vUV);
baseColor*=offset;
#else
baseColor.a=abs(offset-baseColor.a);
#ifdef STROKE
float alpha=smoothstep(.0,.1,baseColor.a);
baseColor.a=alpha;
baseColor.rgb=baseColor.rgb*alpha;
#endif
#endif
gl_FragColor=baseColor;
}`;Ia.a.ShadersStore.glowMapMergePixelShader=Kj;var Lj=`
attribute vec2 position;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`;Ia.a.ShadersStore.glowMapMergeVertexShader=Lj,O.a.prototype.getGlowLayerByName=function(e){for(var a=0;a<this.effectLayers.length;a++)if(this.effectLayers[a].name===e&&this.effectLayers[a].getEffectName()===Rd.EffectName)return this.effectLayers[a];return null};var Rd=function(e){function a(b,c,d){var f=e.call(this,b,c)||this;return f._intensity=1,f._includedOnlyMeshes=[],f._excludedMeshes=[],f.neutralColor=new j.f(0,0,0,1),f._options=v.a({mainTextureRatio:a.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},d),f._init({alphaBlendingMode:o.a.ALPHA_ADD,camera:f._options.camera,mainTextureFixedSize:f._options.mainTextureFixedSize,mainTextureRatio:f._options.mainTextureRatio,renderingGroupId:f._options.renderingGroupId}),f}return v.d(a,e),Object.defineProperty(a.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(b){this._horizontalBlurPostprocess1.kernel=b,this._verticalBlurPostprocess1.kernel=b,this._horizontalBlurPostprocess2.kernel=b,this._verticalBlurPostprocess2.kernel=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"intensity",{get:function(){return this._intensity},set:function(b){this._intensity=b},enumerable:!0,configurable:!0}),a.prototype.getEffectName=function(){return a.EffectName},a.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[na.b.PositionKind],["offset"],["textureSampler","textureSampler2"],`#define EMISSIVE 
`)},a.prototype._createTextureAndPostProcesses=function(){var b=this,c=this._mainTextureDesiredSize.width,d=this._mainTextureDesiredSize.height;c=this._engine.needPOTTextures?xa.h.GetExponentOfTwo(c,this._maxSize):c,d=this._engine.needPOTTextures?xa.h.GetExponentOfTwo(d,this._maxSize):d;var f=0;f=this._engine.getCaps().textureHalfFloatRender?o.a.TEXTURETYPE_HALF_FLOAT:o.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new Ab("GlowLayerBlurRTT",{width:c,height:d},this._scene,!1,!0,f),this._blurTexture1.wrapU=ra.a.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=ra.a.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(ra.a.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var h=Math.floor(c/2),i=Math.floor(d/2);this._blurTexture2=new Ab("GlowLayerBlurRTT2",{width:h,height:i},this._scene,!1,!0,f),this._blurTexture2.wrapU=ra.a.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=ra.a.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(ra.a.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new Ib("GlowLayerHBP1",new j.w(1,0),this._options.blurKernelSize/2,{width:c,height:d},null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._horizontalBlurPostprocess1.width=c,this._horizontalBlurPostprocess1.height=d,this._horizontalBlurPostprocess1.onApplyObservable.add(function(k){k.setTexture("textureSampler",b._mainTexture)}),this._verticalBlurPostprocess1=new Ib("GlowLayerVBP1",new j.w(0,1),this._options.blurKernelSize/2,{width:c,height:d},null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._horizontalBlurPostprocess2=new Ib("GlowLayerHBP2",new j.w(1,0),this._options.blurKernelSize/2,{width:h,height:i},null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._horizontalBlurPostprocess2.width=h,this._horizontalBlurPostprocess2.height=i,this._horizontalBlurPostprocess2.onApplyObservable.add(function(k){k.setTexture("textureSampler",b._blurTexture1)}),this._verticalBlurPostprocess2=new Ib("GlowLayerVBP2",new j.w(0,1),this._options.blurKernelSize/2,{width:h,height:i},null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add(function(){var k=b._blurTexture1.getInternalTexture();k&&(b._scene.postProcessManager.directRender(b._postProcesses1,k,!0),(k=b._blurTexture2.getInternalTexture())&&b._scene.postProcessManager.directRender(b._postProcesses2,k,!0))}),this._postProcesses.map(function(k){k.autoClear=!1})},a.prototype.isReady=function(b,c){var d=b.getMaterial(),f=b.getRenderingMesh();if(!d||!f)return!1;var h=d.emissiveTexture;return e.prototype._isReady.call(this,b,c,h)},a.prototype.needStencil=function(){return!1},a.prototype._canRenderMesh=function(b,c){return!0},a.prototype._internalRender=function(b){b.setTexture("textureSampler",this._blurTexture1),b.setTexture("textureSampler2",this._blurTexture2),b.setFloat("offset",this._intensity);var c=this._engine,d=c.getStencilBuffer();c.setStencilBuffer(!1),c.drawElementsType(rb.a.TriangleFillMode,0,6),c.setStencilBuffer(d)},a.prototype._setEmissiveTextureAndColor=function(b,c,d){var f=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(b,c,d):d?(this._emissiveTextureAndColor.texture=d.emissiveTexture,this._emissiveTextureAndColor.texture&&(f=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(b,c,d,this._emissiveTextureAndColor.color):d.emissiveColor?this._emissiveTextureAndColor.color.set(d.emissiveColor.r*f,d.emissiveColor.g*f,d.emissiveColor.b*f,d.alpha):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},a.prototype._shouldRenderMesh=function(b){return this.hasMesh(b)},a.prototype._addCustomEffectDefines=function(b){b.push("#define GLOW")},a.prototype.addExcludedMesh=function(b){-1===this._excludedMeshes.indexOf(b.uniqueId)&&this._excludedMeshes.push(b.uniqueId)},a.prototype.removeExcludedMesh=function(b){var c=this._excludedMeshes.indexOf(b.uniqueId);-1!==c&&this._excludedMeshes.splice(c,1)},a.prototype.addIncludedOnlyMesh=function(b){-1===this._includedOnlyMeshes.indexOf(b.uniqueId)&&this._includedOnlyMeshes.push(b.uniqueId)},a.prototype.removeIncludedOnlyMesh=function(b){var c=this._includedOnlyMeshes.indexOf(b.uniqueId);-1!==c&&this._includedOnlyMeshes.splice(c,1)},a.prototype.hasMesh=function(b){return!!e.prototype.hasMesh.call(this,b)&&(this._includedOnlyMeshes.length?-1!==this._includedOnlyMeshes.indexOf(b.uniqueId):!this._excludedMeshes.length||-1===this._excludedMeshes.indexOf(b.uniqueId))},a.prototype._disposeMesh=function(b){this.removeIncludedOnlyMesh(b),this.removeExcludedMesh(b)},a.prototype.getClassName=function(){return"GlowLayer"},a.prototype.serialize=function(){var b,c=g.a.Serialize(this);if(c.customType="BABYLON.GlowLayer",c.includedMeshes=[],this._includedOnlyMeshes.length)for(b=0;b<this._includedOnlyMeshes.length;b++)(d=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[b]))&&c.includedMeshes.push(d.id);if(c.excludedMeshes=[],this._excludedMeshes.length)for(b=0;b<this._excludedMeshes.length;b++){var d;(d=this._scene.getMeshByUniqueID(this._excludedMeshes[b]))&&c.excludedMeshes.push(d.id)}return c},a.Parse=function(b,c,d){var f,h=g.a.Parse(function(){return new a(b.name,c,b.options)},b,c,d);for(f=0;f<b.excludedMeshes.length;f++)(i=c.getMeshByID(b.excludedMeshes[f]))&&h.addExcludedMesh(i);for(f=0;f<b.includedMeshes.length;f++){var i;(i=c.getMeshByID(b.includedMeshes[f]))&&h.addIncludedOnlyMesh(i)}return h},a.EffectName="GlowLayer",a.DefaultBlurKernelSize=32,a.DefaultTextureRatio=.5,v.c([Object(g.c)()],a.prototype,"blurKernelSize",null),v.c([Object(g.c)()],a.prototype,"intensity",null),v.c([Object(g.c)("options")],a.prototype,"_options",void 0),a}(id);I.a.RegisteredTypes["BABYLON.GlowLayer"]=Rd;var Mj=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
uniform vec2 direction;
uniform float blurWidth;

float getLuminance(vec3 color)
{
return dot(color,vec3(0.2126,0.7152,0.0722));
}
void main(void)
{
float weights[7];
weights[0]=0.05;
weights[1]=0.1;
weights[2]=0.2;
weights[3]=0.3;
weights[4]=0.2;
weights[5]=0.1;
weights[6]=0.05;
vec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);
vec2 texelStep=texelSize*direction*blurWidth;
vec2 start=vUV-3.0*texelStep;
vec4 baseColor=vec4(0.,0.,0.,0.);
vec2 texelOffset=vec2(0.,0.);
for (int i=0; i<7; i++)
{

vec4 texel=texture2D(textureSampler,start+texelOffset);
baseColor.a+=texel.a*weights[i];

float luminance=getLuminance(baseColor.rgb);
float luminanceTexel=getLuminance(texel.rgb);
float choice=step(luminanceTexel,luminance);
baseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;
texelOffset+=texelStep;
}
gl_FragColor=baseColor;
}`;Ia.a.ShadersStore.glowBlurPostProcessPixelShader=Mj,O.a.prototype.getHighlightLayerByName=function(e){for(var a=0;a<this.effectLayers.length;a++)if(this.effectLayers[a].name===e&&this.effectLayers[a].getEffectName()===af.EffectName)return this.effectLayers[a];return null};var hh=function(e){function a(b,c,d,f,h,i,k,m){void 0===i&&(i=ra.a.BILINEAR_SAMPLINGMODE);var B=e.call(this,b,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,f,h,i,k,m)||this;return B.direction=c,B.kernel=d,B.onApplyObservable.add(function(E){E.setFloat2("screenSize",B.width,B.height),E.setVector2("direction",B.direction),E.setFloat("blurWidth",B.kernel)}),B}return v.d(a,e),a}(Za),af=function(e){function a(b,c,d){var f=e.call(this,b,c)||this;return f.name=b,f.innerGlow=!0,f.outerGlow=!0,f.onBeforeBlurObservable=new q.c(),f.onAfterBlurObservable=new q.c(),f._instanceGlowingMeshStencilReference=a.GlowingMeshStencilReference++,f._meshes={},f._excludedMeshes={},f.neutralColor=a.NeutralColor,f._engine.isStencilEnable||r.a.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),f._options=v.a({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:o.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},d),f._init({alphaBlendingMode:f._options.alphaBlendingMode,camera:f._options.camera,mainTextureFixedSize:f._options.mainTextureFixedSize,mainTextureRatio:f._options.mainTextureRatio,renderingGroupId:f._options.renderingGroupId}),f._shouldRender=!1,f}return v.d(a,e),Object.defineProperty(a.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(b){this._horizontalBlurPostprocess.kernel=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(b){this._verticalBlurPostprocess.kernel=b},enumerable:!0,configurable:!0}),a.prototype.getEffectName=function(){return a.EffectName},a.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[na.b.PositionKind],["offset"],["textureSampler"],this._options.isStroke?`#define STROKE 
`:void 0)},a.prototype._createTextureAndPostProcesses=function(){var b=this,c=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,d=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;c=this._engine.needPOTTextures?xa.h.GetExponentOfTwo(c,this._maxSize):c,d=this._engine.needPOTTextures?xa.h.GetExponentOfTwo(d,this._maxSize):d;var f=0;f=this._engine.getCaps().textureHalfFloatRender?o.a.TEXTURETYPE_HALF_FLOAT:o.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new Ab("HighlightLayerBlurRTT",{width:c,height:d},this._scene,!1,!0,f),this._blurTexture.wrapU=ra.a.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=ra.a.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(ra.a.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===o.a.ALPHA_COMBINE?(this._downSamplePostprocess=new sc("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(h){h.setTexture("textureSampler",b._mainTexture)}),this._horizontalBlurPostprocess=new hh("HighlightLayerHBP",new j.w(1,0),this._options.blurHorizontalSize,1,null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(h){h.setFloat2("screenSize",c,d)}),this._verticalBlurPostprocess=new hh("HighlightLayerVBP",new j.w(0,1),this._options.blurVerticalSize,1,null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(h){h.setFloat2("screenSize",c,d)}),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new Ib("HighlightLayerHBP",new j.w(1,0),this._options.blurHorizontalSize/2,{width:c,height:d},null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._horizontalBlurPostprocess.width=c,this._horizontalBlurPostprocess.height=d,this._horizontalBlurPostprocess.onApplyObservable.add(function(h){h.setTexture("textureSampler",b._mainTexture)}),this._verticalBlurPostprocess=new Ib("HighlightLayerVBP",new j.w(0,1),this._options.blurVerticalSize/2,{width:c,height:d},null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,f),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add(function(){b.onBeforeBlurObservable.notifyObservers(b);var h=b._blurTexture.getInternalTexture();h&&b._scene.postProcessManager.directRender(b._postProcesses,h,!0),b.onAfterBlurObservable.notifyObservers(b)}),this._postProcesses.map(function(h){h.autoClear=!1})},a.prototype.needStencil=function(){return!0},a.prototype.isReady=function(b,c){var d=b.getMaterial(),f=b.getRenderingMesh();if(!d||!f||!this._meshes)return!1;var h=null,i=this._meshes[f.uniqueId];return i&&i.glowEmissiveOnly&&d&&(h=d.emissiveTexture),e.prototype._isReady.call(this,b,c,h)},a.prototype._internalRender=function(b){b.setTexture("textureSampler",this._blurTexture);var c=this._engine;c.cacheStencilState(),c.setStencilOperationPass(o.a.REPLACE),c.setStencilOperationFail(o.a.KEEP),c.setStencilOperationDepthFail(o.a.KEEP),c.setStencilMask(0),c.setStencilBuffer(!0),c.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(b.setFloat("offset",0),c.setStencilFunction(o.a.NOTEQUAL),c.drawElementsType(rb.a.TriangleFillMode,0,6)),this.innerGlow&&(b.setFloat("offset",1),c.setStencilFunction(o.a.EQUAL),c.drawElementsType(rb.a.TriangleFillMode,0,6)),c.restoreStencilState()},a.prototype.shouldRender=function(){return!!e.prototype.shouldRender.call(this)&&!!this._meshes},a.prototype._shouldRenderMesh=function(b){return(!this._excludedMeshes||!this._excludedMeshes[b.uniqueId])&&!!e.prototype.hasMesh.call(this,b)},a.prototype._setEmissiveTextureAndColor=function(b,c,d){var f=this._meshes[b.uniqueId];f?this._emissiveTextureAndColor.color.set(f.color.r,f.color.g,f.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),f&&f.glowEmissiveOnly&&d?(this._emissiveTextureAndColor.texture=d.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},a.prototype.addExcludedMesh=function(b){this._excludedMeshes&&(this._excludedMeshes[b.uniqueId]||(this._excludedMeshes[b.uniqueId]={mesh:b,beforeBind:b.onBeforeBindObservable.add(function(c){c.getEngine().setStencilBuffer(!1)}),afterRender:b.onAfterRenderObservable.add(function(c){c.getEngine().setStencilBuffer(!0)})}))},a.prototype.removeExcludedMesh=function(b){if(this._excludedMeshes){var c=this._excludedMeshes[b.uniqueId];c&&(c.beforeBind&&b.onBeforeBindObservable.remove(c.beforeBind),c.afterRender&&b.onAfterRenderObservable.remove(c.afterRender)),this._excludedMeshes[b.uniqueId]=null}},a.prototype.hasMesh=function(b){return!!this._meshes&&(!!e.prototype.hasMesh.call(this,b)&&(void 0!==this._meshes[b.uniqueId]&&null!==this._meshes[b.uniqueId]))},a.prototype.addMesh=function(b,c,d){var f=this;if(void 0===d&&(d=!1),this._meshes){var h=this._meshes[b.uniqueId];h?h.color=c:(this._meshes[b.uniqueId]={mesh:b,color:c,observerHighlight:b.onBeforeBindObservable.add(function(i){f._excludedMeshes&&f._excludedMeshes[i.uniqueId]?f._defaultStencilReference(i):i.getScene().getEngine().setStencilFunctionReference(f._instanceGlowingMeshStencilReference)}),observerDefault:b.onAfterRenderObservable.add(this._defaultStencilReference),glowEmissiveOnly:d},b.onDisposeObservable.add(function(){f._disposeMesh(b)})),this._shouldRender=!0}},a.prototype.removeMesh=function(b){if(this._meshes){var c=this._meshes[b.uniqueId];for(var d in c&&(c.observerHighlight&&b.onBeforeBindObservable.remove(c.observerHighlight),c.observerDefault&&b.onAfterRenderObservable.remove(c.observerDefault),delete this._meshes[b.uniqueId]),this._shouldRender=!1,this._meshes)if(this._meshes[d]){this._shouldRender=!0;break}}},a.prototype._defaultStencilReference=function(b){b.getScene().getEngine().setStencilFunctionReference(a.NormalMeshStencilReference)},a.prototype._disposeMesh=function(b){this.removeMesh(b),this.removeExcludedMesh(b)},a.prototype.dispose=function(){if(this._meshes){for(var b in this._meshes)(c=this._meshes[b])&&c.mesh&&(c.observerHighlight&&c.mesh.onBeforeBindObservable.remove(c.observerHighlight),c.observerDefault&&c.mesh.onAfterRenderObservable.remove(c.observerDefault));this._meshes=null}if(this._excludedMeshes){for(var b in this._excludedMeshes){var c;(c=this._excludedMeshes[b])&&(c.beforeBind&&c.mesh.onBeforeBindObservable.remove(c.beforeBind),c.afterRender&&c.mesh.onAfterRenderObservable.remove(c.afterRender))}this._excludedMeshes=null}e.prototype.dispose.call(this)},a.prototype.getClassName=function(){return"HighlightLayer"},a.prototype.serialize=function(){var b=g.a.Serialize(this);if(b.customType="BABYLON.HighlightLayer",b.meshes=[],this._meshes)for(var c in this._meshes){var d=this._meshes[c];d&&b.meshes.push({glowEmissiveOnly:d.glowEmissiveOnly,color:d.color.asArray(),meshId:d.mesh.id})}if(b.excludedMeshes=[],this._excludedMeshes)for(var f in this._excludedMeshes){var h=this._excludedMeshes[f];h&&b.excludedMeshes.push(h.mesh.id)}return b},a.Parse=function(b,c,d){var f,h=g.a.Parse(function(){return new a(b.name,c,b.options)},b,c,d);for(f=0;f<b.excludedMeshes.length;f++)(i=c.getMeshByID(b.excludedMeshes[f]))&&h.addExcludedMesh(i);for(f=0;f<b.meshes.length;f++){var i,k=b.meshes[f];(i=c.getMeshByID(k.meshId))&&h.addMesh(i,j.e.FromArray(k.color),k.glowEmissiveOnly)}return h},a.EffectName="HighlightLayer",a.NeutralColor=new j.f(0,0,0,0),a.GlowingMeshStencilReference=2,a.NormalMeshStencilReference=1,v.c([Object(g.c)()],a.prototype,"innerGlow",void 0),v.c([Object(g.c)()],a.prototype,"outerGlow",void 0),v.c([Object(g.c)()],a.prototype,"blurHorizontalSize",null),v.c([Object(g.c)()],a.prototype,"blurVerticalSize",null),v.c([Object(g.c)("options")],a.prototype,"_options",void 0),a}(id);I.a.RegisteredTypes["BABYLON.HighlightLayer"]=af;var ih=function(){function e(a){this.name=Pa.a.NAME_LAYER,this.scene=a,this._engine=a.getEngine(),a.layers=new Array()}return e.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(Pa.a.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(Pa.a.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(Pa.a.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(Pa.a.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},e.prototype.rebuild=function(){for(var a=0,b=this.scene.layers;a<b.length;a++)b[a]._rebuild()},e.prototype.dispose=function(){for(var a=this.scene.layers;a.length;)a[0].dispose()},e.prototype._draw=function(a){var b=this.scene.layers;if(b.length){this._engine.setDepthBuffer(!1);for(var c=0,d=b;c<d.length;c++){var f=d[c];a(f)&&f.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCameraPredicate=function(a,b,c){return!a.renderOnlyInRenderTargetTextures&&a.isBackground===b&&0!=(a.layerMask&c)},e.prototype._drawCameraBackground=function(a){var b=this;this._draw(function(c){return b._drawCameraPredicate(c,!0,a.layerMask)})},e.prototype._drawCameraForeground=function(a){var b=this;this._draw(function(c){return b._drawCameraPredicate(c,!1,a.layerMask)})},e.prototype._drawRenderTargetPredicate=function(a,b,c,d){return a.renderTargetTextures.length>0&&a.isBackground===b&&a.renderTargetTextures.indexOf(d)>-1&&0!=(a.layerMask&c)},e.prototype._drawRenderTargetBackground=function(a){var b=this;this._draw(function(c){return b._drawRenderTargetPredicate(c,!0,b.scene.activeCamera.layerMask,a)})},e.prototype._drawRenderTargetForeground=function(a){var b=this;this._draw(function(c){return b._drawRenderTargetPredicate(c,!1,b.scene.activeCamera.layerMask,a)})},e}(),Nj=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
gl_FragColor=baseColor*color;
}`;Ia.a.ShadersStore.layerPixelShader=Nj;var Oj=`
attribute vec2 position;

uniform vec2 scale;
uniform vec2 offset;
uniform mat4 textureMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vec2 shiftedPosition=position*scale+offset;
vUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));
gl_Position=vec4(shiftedPosition,0.0,1.0);
}`;Ia.a.ShadersStore.layerVertexShader=Oj;var Pj=function(){function e(a,b,c,d,f){this.name=a,this.scale=new j.w(1,1),this.offset=new j.w(0,0),this.alphaBlendingMode=o.a.ALPHA_COMBINE,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new q.c(),this.onBeforeRenderObservable=new q.c(),this.onAfterRenderObservable=new q.c(),this.texture=b?new ra.a(b,c,!0):null,this.isBackground=void 0===d||d,this.color=void 0===f?new j.f(1,1,1,1):f,this._scene=c||T.a.LastCreatedScene;var h=this._scene._getComponent(Pa.a.NAME_LAYER);h||(h=new ih(this._scene),this._scene._addComponent(h)),this._scene.layers.push(this);var i=this._scene.getEngine(),k=[];k.push(1,1),k.push(-1,1),k.push(-1,-1),k.push(1,-1);var m=new na.b(i,k,na.b.PositionKind,!1,!1,2);this._vertexBuffers[na.b.PositionKind]=m,this._createIndexBuffer(),this._effect=i.createEffect("layer",[na.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],""),this._alphaTestEffect=i.createEffect("layer",[na.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST")}return Object.defineProperty(e.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)},enumerable:!0,configurable:!0}),e.prototype._createIndexBuffer=function(){var a=this._scene.getEngine(),b=[];b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),this._indexBuffer=a.createIndexBuffer(b)},e.prototype._rebuild=function(){var a=this._vertexBuffers[na.b.PositionKind];a&&a._rebuild(),this._createIndexBuffer()},e.prototype.render=function(){var a=this.alphaTest?this._alphaTestEffect:this._effect;if(a.isReady()&&this.texture&&this.texture.isReady()){var b=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),b.enableEffect(a),b.setState(!1),a.setTexture("textureSampler",this.texture),a.setMatrix("textureMatrix",this.texture.getTextureMatrix()),a.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),a.setVector2("offset",this.offset),a.setVector2("scale",this.scale),b.bindBuffers(this._vertexBuffers,this._indexBuffer,a),this.alphaTest?b.drawElementsType(rb.a.TriangleFillMode,0,6):(b.setAlphaMode(this.alphaBlendingMode),b.drawElementsType(rb.a.TriangleFillMode,0,6),b.setAlphaMode(o.a.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this)}},e.prototype.dispose=function(){var a=this._vertexBuffers[na.b.PositionKind];a&&(a.dispose(),this._vertexBuffers[na.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var b=this._scene.layers.indexOf(this);this._scene.layers.splice(b,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},e}(),jh=function(){function e(a,b,c,d,f){this.size=a,this.position=b,this.alphaMode=o.a.ALPHA_ONEONE,this.color=c||new j.e(1,1,1),this.texture=d?new ra.a(d,f.getScene(),!0):null,this._system=f,f.lensFlares.push(this)}return e.AddFlare=function(a,b,c,d,f){return new e(a,b,c,d,f)},e.prototype.dispose=function(){this.texture&&this.texture.dispose();var a=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(a,1)},e}(),Qj=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
gl_FragColor=baseColor*color;
}`;Ia.a.ShadersStore.lensFlarePixelShader=Qj;var Rj=`
attribute vec2 position;

uniform mat4 viewportMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=viewportMatrix*vec4(position,0.0,1.0);
}`;Ia.a.ShadersStore.lensFlareVertexShader=Rj;var bf=function(){function e(a,b,c){this.name=a,this.lensFlares=new Array(),this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=c||T.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._emitter=b,this.id=a,c.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(i){return c.activeCamera&&i.material&&i.isVisible&&i.isEnabled()&&i.isBlocker&&0!=(i.layerMask&c.activeCamera.layerMask)};var d=c.getEngine(),f=[];f.push(1,1),f.push(-1,1),f.push(-1,-1),f.push(1,-1),this._vertexBuffers[na.b.PositionKind]=new na.b(d,f,na.b.PositionKind,!1,!1,2);var h=[];h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),this._indexBuffer=d.createIndexBuffer(h),this._effect=d.createEffect("lensFlare",[na.b.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled=a},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEmitter=function(){return this._emitter},e.prototype.setEmitter=function(a){this._emitter=a},e.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},e.prototype.computeEffectivePosition=function(a){var b=this.getEmitterPosition();return b=j.x.Project(b,j.j.Identity(),this._scene.getTransformMatrix(),a),this._positionX=b.x,this._positionY=b.y,b=j.x.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(a.x-=this.viewportBorder,a.y-=this.viewportBorder,a.width+=2*this.viewportBorder,a.height+=2*this.viewportBorder,b.x+=this.viewportBorder,b.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),b.z>0&&(this._positionX>a.x&&this._positionX<a.x+a.width&&this._positionY>a.y&&(this._positionY,a.y,a.height),!0)},e.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var a=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),b=a.length();a.normalize();var c=new Nb.a(this._scene.activeCamera.globalPosition,a),d=this._scene.pickWithRay(c,this.meshesSelectionPredicate,!0);return!d||!d.hit||d.distance>b},e.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var a,b,c=this._scene.getEngine(),d=this._scene.activeCamera.viewport.toGlobal(c.getRenderWidth(!0),c.getRenderHeight(!0));if(!this.computeEffectivePosition(d))return!1;if(!this._isVisible())return!1;var f=(a=this._positionX<this.borderLimit+d.x?this.borderLimit+d.x-this._positionX:this._positionX>d.x+d.width-this.borderLimit?this._positionX-d.x-d.width+this.borderLimit:0)>(b=this._positionY<this.borderLimit+d.y?this.borderLimit+d.y-this._positionY:this._positionY>d.y+d.height-this.borderLimit?this._positionY-d.y-d.height+this.borderLimit:0)?a:b;(f-=this.viewportBorder)>this.borderLimit&&(f=this.borderLimit);var h=1-p.a.Clamp(f/this.borderLimit,0,1);if(h<0)return!1;h>1&&(h=1),this.viewportBorder>0&&(d.x+=this.viewportBorder,d.y+=this.viewportBorder,d.width-=2*this.viewportBorder,d.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var i=d.x+d.width/2,k=d.y+d.height/2,m=i-this._positionX,B=k-this._positionY;c.enableEffect(this._effect),c.setState(!1),c.setDepthBuffer(!1),c.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var E=0;E<this.lensFlares.length;E++){var K=this.lensFlares[E];c.setAlphaMode(K.alphaMode);var P=i-m*K.position,S=k-B*K.position,U=K.size,_=K.size*c.getAspectRatio(this._scene.activeCamera,!0),da=P/(d.width+2*d.x)*2-1,fa=1-S/(d.height+2*d.y)*2,ga=j.j.FromValues(U/2,0,0,0,0,_/2,0,0,0,0,1,0,da,fa,0,1);this._effect.setMatrix("viewportMatrix",ga),this._effect.setTexture("textureSampler",K.texture),this._effect.setFloat4("color",K.color.r*h,K.color.g*h,K.color.b*h,1),c.drawElementsType(rb.a.TriangleFillMode,0,6)}return c.setDepthBuffer(!0),c.setAlphaMode(o.a.ALPHA_DISABLE),!0},e.prototype.dispose=function(){var a=this._vertexBuffers[na.b.PositionKind];for(a&&(a.dispose(),this._vertexBuffers[na.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var b=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(b,1)},e.Parse=function(a,b,c){var d=b.getLastEntryByID(a.emitterId),f=a.name||"lensFlareSystem#"+a.emitterId,h=new e(f,d,b);h.id=a.id||f,h.borderLimit=a.borderLimit;for(var i=0;i<a.flares.length;i++){var k=a.flares[i];jh.AddFlare(k.size,k.position,j.e.FromArray(k.color),k.textureName?c+k.textureName:"",h)}return h},e.prototype.serialize=function(){var a={};a.id=this.id,a.name=this.name,a.emitterId=this.getEmitter().id,a.borderLimit=this.borderLimit,a.flares=[];for(var b=0;b<this.lensFlares.length;b++){var c=this.lensFlares[b];a.flares.push({size:c.size,position:c.position,color:c.color.asArray(),textureName:xa.h.GetFilename(c.texture?c.texture.name:"")})}return a},e._SceneComponentInitialization=function(a){throw Zb.a.WarnImport("LensFlareSystemSceneComponent")},e}();O.a.AddParser(Pa.a.NAME_LENSFLARESYSTEM,function(e,a,b,c){if(void 0!==e.lensFlareSystems&&null!==e.lensFlareSystems){b.lensFlareSystems||(b.lensFlareSystems=new Array());for(var d=0,f=e.lensFlareSystems.length;d<f;d++){var h=e.lensFlareSystems[d],i=bf.Parse(h,a,c);b.lensFlareSystems.push(i)}}}),O.a.prototype.getLensFlareSystemByName=function(e){for(var a=0;a<this.lensFlareSystems.length;a++)if(this.lensFlareSystems[a].name===e)return this.lensFlareSystems[a];return null},O.a.prototype.getLensFlareSystemByID=function(e){for(var a=0;a<this.lensFlareSystems.length;a++)if(this.lensFlareSystems[a].id===e)return this.lensFlareSystems[a];return null},O.a.prototype.removeLensFlareSystem=function(e){var a=this.lensFlareSystems.indexOf(e);return-1!==a&&this.lensFlareSystems.splice(a,1),a},O.a.prototype.addLensFlareSystem=function(e){this.lensFlareSystems.push(e)};var kh=function(){function e(a){this.name=Pa.a.NAME_LENSFLARESYSTEM,this.scene=a,a.lensFlareSystems=new Array()}return e.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(Pa.a.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},e.prototype.rebuild=function(){},e.prototype.addFromContainer=function(a){var b=this;a.lensFlareSystems&&a.lensFlareSystems.forEach(function(c){b.scene.addLensFlareSystem(c)})},e.prototype.removeFromContainer=function(a,b){var c=this;a.lensFlareSystems&&a.lensFlareSystems.forEach(function(d){c.scene.removeLensFlareSystem(d),b&&d.dispose()})},e.prototype.serialize=function(a){a.lensFlareSystems=[];for(var b=0,c=this.scene.lensFlareSystems;b<c.length;b++){var d=c[b];a.lensFlareSystems.push(d.serialize())}},e.prototype.dispose=function(){for(var a=this.scene.lensFlareSystems;a.length;)a[0].dispose()},e.prototype._draw=function(a){if(this.scene.lensFlaresEnabled){var b=this.scene.lensFlareSystems;xa.h.StartPerformanceCounter("Lens flares",b.length>0);for(var c=0,d=b;c<d.length;c++){var f=d[c];0!=(a.layerMask&f.layerMask)&&f.render()}xa.h.EndPerformanceCounter("Lens flares",b.length>0)}},e}();bf._SceneComponentInitialization=function(e){var a=e._getComponent(Pa.a.NAME_LENSFLARESYSTEM);a||(a=new kh(e),e._addComponent(a))};var Sj=`#ifndef FLOAT
vec4 pack(float depth)
{
const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);
const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);
vec4 res=fract(depth*bit_shift);
res-=res.xxyz*bit_mask;
return res;
}
#endif
varying float vDepthMetric;
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
uniform vec3 biasAndScale;
uniform vec2 depthValues;
void main(void)
{
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
float depth=vDepthMetric;
#ifdef ESM
depth=clamp(exp(-min(87.,biasAndScale.z*depth)),0.,1.);
#endif
#ifdef FLOAT
gl_FragColor=vec4(depth,1.0,1.0,1.0);
#else
gl_FragColor=pack(depth);
#endif
}`;Ia.a.ShadersStore.shadowMapPixelShader=Sj;var Tj=`
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
uniform vec3 lightData;
#endif
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
#include<helperFunctions>
uniform mat4 viewProjection;
uniform vec3 biasAndScale;
uniform vec2 depthValues;
varying float vDepthMetric;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
void main(void)
{
vec3 positionUpdated=position;
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);

#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vec3 worldNor=normalize(normalWorld*normal);
#ifdef DIRECTIONINLIGHTDATA
vec3 worldLightDir=normalize(-lightData.xyz);
#else
vec3 directionToLight=lightData.xyz-worldPos.xyz;
vec3 worldLightDir=normalize(directionToLight);
#endif
float ndl=dot(worldNor,worldLightDir);
float sinNL=sqrt(1.0-ndl*ndl);
float normalBias=biasAndScale.y*sinNL;
worldPos.xyz-=worldNor*normalBias;
#endif

gl_Position=viewProjection*worldPos;
#ifdef DEPTHTEXTURE

gl_Position.z+=biasAndScale.x*gl_Position.w;
#endif

vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}`;Ia.a.ShadersStore.shadowMapVertexShader=Tj;var Uj=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
void main(void)
{
vec4 colorDepth=vec4(0.0);
for (int x=-OFFSET; x<=OFFSET; x++)
for (int y=-OFFSET; y<=OFFSET; y++)
colorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);
gl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));
}`;Ia.a.ShadersStore.depthBoxBlurPixelShader=Uj;var cf=function(){function e(a,b,c){this.onBeforeShadowMapRenderObservable=new q.c(),this.onBeforeShadowMapRenderMeshObservable=new q.c(),this._bias=5e-05,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=e.FILTER_NONE,this._filteringQuality=e.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=j.x.Zero(),this._viewMatrix=j.j.Zero(),this._projectionMatrix=j.j.Zero(),this._transformMatrix=j.j.Zero(),this._cachedPosition=new j.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new j.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=j.j.Identity(),this._mapSize=a,this._light=b,this._scene=b.getScene(),b._shadowGenerator=this,e._SceneComponentInitialization(this._scene);var d=this._scene.getEngine().getCaps();c?d.textureFloatRender&&d.textureFloatLinearFiltering?this._textureType=o.a.TEXTURETYPE_FLOAT:d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?this._textureType=o.a.TEXTURETYPE_HALF_FLOAT:this._textureType=o.a.TEXTURETYPE_UNSIGNED_INT:d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?this._textureType=o.a.TEXTURETYPE_HALF_FLOAT:d.textureFloatRender&&d.textureFloatLinearFiltering?this._textureType=o.a.TEXTURETYPE_FLOAT:this._textureType=o.a.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(a){this._bias=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalBias",{get:function(){return this._normalBias},set:function(a){this._normalBias=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(a){this._blurBoxOffset!==a&&(this._blurBoxOffset=a,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurScale",{get:function(){return this._blurScale},set:function(a){this._blurScale!==a&&(this._blurScale=a,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(a){this._blurKernel!==a&&(this._blurKernel=a,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(a){this._useKernelBlur!==a&&(this._useKernelBlur=a,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(a){this._depthScale=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(a){if(this._light.needCube()){if(a===e.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(a===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(a===e.FILTER_PCF||a===e.FILTER_PCSS)return void(this.usePoissonSampling=!0)}a!==e.FILTER_PCF&&a!==e.FILTER_PCSS||1!==this._scene.getEngine().webGLVersion?this._filter!==a&&(this._filter=a,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){return this.filter===e.FILTER_POISSONSAMPLING},set:function(a){(a||this.filter===e.FILTER_POISSONSAMPLING)&&(this.filter=a?e.FILTER_POISSONSAMPLING:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useExponentialShadowMap",{get:function(){return this.filter===e.FILTER_EXPONENTIALSHADOWMAP},set:function(a){(a||this.filter===e.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=a?e.FILTER_EXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(a){(a||this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=a?e.FILTER_BLUREXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(a){(a||this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=a?e.FILTER_CLOSEEXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(a){(a||this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=a?e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===e.FILTER_PCF},set:function(a){(a||this.filter===e.FILTER_PCF)&&(this.filter=a?e.FILTER_PCF:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(a){this._filteringQuality=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useContactHardeningShadow",{get:function(){return this.filter===e.FILTER_PCSS},set:function(a){(a||this.filter===e.FILTER_PCSS)&&(this.filter=a?e.FILTER_PCSS:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(a){this._contactHardeningLightSizeUVRatio=a},enumerable:!0,configurable:!0}),e.prototype.getDarkness=function(){return this._darkness},e.prototype.setDarkness=function(a){return this._darkness=a>=1?1:a<=0?0:a,this},e.prototype.setTransparencyShadow=function(a){return this._transparencyShadow=a,this},e.prototype.getShadowMap=function(){return this._shadowMap},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},e.prototype.addShadowCaster=function(a,b){var c;return void 0===b&&(b=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(a),b&&(c=this._shadowMap.renderList).push.apply(c,a.getChildMeshes()),this):this},e.prototype.removeShadowCaster=function(a,b){if(void 0===b&&(b=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var c=this._shadowMap.renderList.indexOf(a);if(-1!==c&&this._shadowMap.renderList.splice(c,1),b)for(var d=0,f=a.getChildren();d<f.length;d++){var h=f[d];this.removeShadowCaster(h)}return this},e.prototype.getLight=function(){return this._light},e.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},e.prototype._initializeShadowMap=function(){var a=this,b=this._scene.getEngine();b.webGLVersion>1?(this._shadowMap=new Ab(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(o.a.LESS,!0)):this._shadowMap=new Ab(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.wrapU=ra.a.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=ra.a.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(ra.a.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._shadowMap.onBeforeRenderObservable.add(function(f){a._currentFaceIndex=f,a._filter===e.FILTER_PCF&&b.setColorWrite(!1)}),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.onAfterUnbindObservable.add(function(){if(a._filter===e.FILTER_PCF&&b.setColorWrite(!0),a.useBlurExponentialShadowMap||a.useBlurCloseExponentialShadowMap){var f=a.getShadowMapForRendering();f&&a._scene.postProcessManager.directRender(a._blurPostProcesses,f.getInternalTexture(),!0)}});var c=new j.f(0,0,0,0),d=new j.f(1,1,1,1);this._shadowMap.onClearObservable.add(function(f){a._filter===e.FILTER_PCF?f.clear(d,!1,!0,!1):a.useExponentialShadowMap||a.useBlurExponentialShadowMap?f.clear(c,!0,!0,!1):f.clear(d,!0,!0,!1)})},e.prototype._initializeBlurRTTAndPostProcesses=function(){var a=this,b=this._scene.getEngine(),c=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new Ab(this._light.name+"_shadowMap2",c,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=ra.a.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=ra.a.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(ra.a.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new Ib(this._light.name+"KernelBlurX",new j.w(1,0),this.blurKernel,1,null,ra.a.BILINEAR_SAMPLINGMODE,b,!1,this._textureType),this._kernelBlurXPostprocess.width=c,this._kernelBlurXPostprocess.height=c,this._kernelBlurXPostprocess.onApplyObservable.add(function(d){d.setTexture("textureSampler",a._shadowMap)}),this._kernelBlurYPostprocess=new Ib(this._light.name+"KernelBlurY",new j.w(0,1),this.blurKernel,1,null,ra.a.BILINEAR_SAMPLINGMODE,b,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===o.a.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new Za(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,ra.a.BILINEAR_SAMPLINGMODE,b,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(d){d.setFloat2("screenSize",c,c),d.setTexture("textureSampler",a._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},e.prototype._renderForShadowMap=function(a,b,c,d){var f,h=this._scene.getEngine();if(d.length){for(h.setColorWrite(!1),f=0;f<d.length;f++)this._renderSubMeshForShadowMap(d.data[f]);h.setColorWrite(!0)}for(f=0;f<a.length;f++)this._renderSubMeshForShadowMap(a.data[f]);for(f=0;f<b.length;f++)this._renderSubMeshForShadowMap(b.data[f]);if(this._transparencyShadow)for(f=0;f<c.length;f++)this._renderSubMeshForShadowMap(c.data[f])},e.prototype._renderSubMeshForShadowMap=function(a){var b=this,c=a.getRenderingMesh(),d=this._scene,f=d.getEngine(),h=a.getMaterial();if(c._internalAbstractMeshDataInfo._isActiveIntermediate=!1,h&&0!==a.verticesCount){f.setState(h.backFaceCulling);var i=c._getInstancesRenderList(a._id);if(!i.mustReturn){var k=f.getCaps().instancedArrays&&null!==i.visibleInstances[a._id]&&void 0!==i.visibleInstances[a._id];if(this.isReady(a,k)){if(f.enableEffect(this._effect),c._bind(a,this._effect,rb.a.TriangleFillMode),this._effect.setFloat3("biasAndScale",this.bias,this.normalBias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this.getLight().getTypeID()===vc.a.LIGHTTYPEID_DIRECTIONALLIGHT?this._effect.setVector3("lightData",this._cachedDirection):this._effect.setVector3("lightData",this._cachedPosition),d.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(d.activeCamera),this.getLight().getDepthMinZ(d.activeCamera)+this.getLight().getDepthMaxZ(d.activeCamera)),h&&h.needAlphaTesting()){var m=h.getAlphaTestTexture();m&&(this._effect.setTexture("diffuseSampler",m),this._effect.setMatrix("diffuseMatrix",m.getTextureMatrix()||this._defaultTextureMatrix))}if(c.useBones&&c.computeBonesUsingShaders&&c.skeleton){var B=c.skeleton;if(B.isUsingTextureForMatrices){var E=B.getTransformMatrixTexture();if(!E)return;this._effect.setTexture("boneSampler",E),this._effect.setFloat("boneTextureWidth",4*(B.bones.length+1))}else this._effect.setMatrices("mBones",B.getTransformMatrices(c))}Ta.a.BindMorphTargetParameters(c,this._effect),this.forceBackFacesOnly&&f.setState(!0,0,!1,!0),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(c),this.onBeforeShadowMapRenderObservable.notifyObservers(this._effect),c._processRendering(a,this._effect,rb.a.TriangleFillMode,i,k,function(K,P){return b._effect.setMatrix("world",P)}),this.forceBackFacesOnly&&f.setState(!0,0,!1,!1)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},e.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===e.FILTER_NONE||this.filter===e.FILTER_PCSS?this._shadowMap.updateSamplingMode(ra.a.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(ra.a.BILINEAR_SAMPLINGMODE))},e.prototype.forceCompilation=function(a,b){var c=this,d=v.a({useInstances:!1},b),f=this.getShadowMap();if(f){var h=f.renderList;if(h){for(var i=new Array(),k=0,m=h;k<m.length;k++){var B=m[k];i.push.apply(i,B.subMeshes)}if(0!==i.length){var E=0,K=function(){if(c._scene&&c._scene.getEngine()){for(;c.isReady(i[E],d.useInstances);)if(++E>=i.length)return void(a&&a(c));setTimeout(K,16)}};K()}else a&&a(this)}else a&&a(this)}else a&&a(this)},e.prototype.forceCompilationAsync=function(a){var b=this;return new Promise(function(c){b.forceCompilation(function(){c()},a)})},e.prototype.isReady=function(a,b){var c=[];this._textureType!==o.a.TEXTURETYPE_UNSIGNED_INT&&c.push("#define FLOAT"),this.useExponentialShadowMap||this.useBlurExponentialShadowMap?c.push("#define ESM"):(this.usePercentageCloserFiltering||this.useContactHardeningShadow)&&c.push("#define DEPTHTEXTURE");var d=[na.b.PositionKind],f=a.getMesh(),h=a.getMaterial();if(this.normalBias&&f.isVerticesDataPresent(na.b.NormalKind)&&(d.push(na.b.NormalKind),c.push("#define NORMAL"),f.nonUniformScaling&&c.push("#define NONUNIFORMSCALING"),this.getLight().getTypeID()===vc.a.LIGHTTYPEID_DIRECTIONALLIGHT&&c.push("#define DIRECTIONINLIGHTDATA")),h&&h.needAlphaTesting()){var i=h.getAlphaTestTexture();i&&(c.push("#define ALPHATEST"),f.isVerticesDataPresent(na.b.UVKind)&&(d.push(na.b.UVKind),c.push("#define UV1")),f.isVerticesDataPresent(na.b.UV2Kind)&&1===i.coordinatesIndex&&(d.push(na.b.UV2Kind),c.push("#define UV2")))}if(f.useBones&&f.computeBonesUsingShaders&&f.skeleton){d.push(na.b.MatricesIndicesKind),d.push(na.b.MatricesWeightsKind),f.numBoneInfluencers>4&&(d.push(na.b.MatricesIndicesExtraKind),d.push(na.b.MatricesWeightsExtraKind));var k=f.skeleton;c.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),k.isUsingTextureForMatrices?c.push("#define BONETEXTURE"):c.push("#define BonesPerMesh "+(k.bones.length+1))}else c.push("#define NUM_BONE_INFLUENCERS 0");var m=f.morphTargetManager,B=0;if(m&&m.numInfluencers>0&&(c.push("#define MORPHTARGETS"),B=m.numInfluencers,c.push("#define NUM_MORPH_INFLUENCERS "+B),Ta.a.PrepareAttributesForMorphTargets(d,f,{NUM_MORPH_INFLUENCERS:B})),b&&(c.push("#define INSTANCES"),d.push("world0"),d.push("world1"),d.push("world2"),d.push("world3")),this.customShaderOptions&&this.customShaderOptions.defines)for(var E=0,K=this.customShaderOptions.defines;E<K.length;E++){var P=K[E];-1===c.indexOf(P)&&c.push(P)}var S=c.join(`
`);if(this._cachedDefines!==S){this._cachedDefines=S;var U="shadowMap",_=["world","mBones","viewProjection","diffuseMatrix","lightData","depthValues","biasAndScale","morphTargetInfluences","boneTextureWidth"],da=["diffuseSampler","boneSampler"];if(this.customShaderOptions){if(U=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(var fa=0,ga=this.customShaderOptions.attributes;fa<ga.length;fa++){var ha=ga[fa];-1===d.indexOf(ha)&&d.push(ha)}if(this.customShaderOptions.uniforms)for(var ka=0,la=this.customShaderOptions.uniforms;ka<la.length;ka++){var ma=la[ka];-1===_.indexOf(ma)&&_.push(ma)}if(this.customShaderOptions.samplers)for(var ta=0,pa=this.customShaderOptions.samplers;ta<pa.length;ta++){var ua=pa[ta];-1===da.indexOf(ua)&&da.push(ua)}}this._effect=this._scene.getEngine().createEffect(U,d,_,da,S,void 0,void 0,void 0,{maxSimultaneousMorphTargets:B})}return!!this._effect.isReady()&&((this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&(!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())))},e.prototype.prepareDefines=function(a,b){var c=this._scene,d=this._light;c.shadowsEnabled&&d.shadowEnabled&&(a["SHADOW"+b]=!0,this.useContactHardeningShadow&&(a["SHADOWPCSS"+b]=!0,this._filteringQuality===e.QUALITY_LOW?a["SHADOWLOWQUALITY"+b]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(a["SHADOWMEDIUMQUALITY"+b]=!0)),this.usePercentageCloserFiltering?(a["SHADOWPCF"+b]=!0,this._filteringQuality===e.QUALITY_LOW?a["SHADOWLOWQUALITY"+b]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(a["SHADOWMEDIUMQUALITY"+b]=!0)):this.usePoissonSampling?a["SHADOWPOISSON"+b]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?a["SHADOWESM"+b]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(a["SHADOWCLOSEESM"+b]=!0),d.needCube()&&(a["SHADOWCUBE"+b]=!0))},e.prototype.bindShadowLight=function(a,b){var c=this._light,d=this._scene;if(d.shadowsEnabled&&c.shadowEnabled){var f=d.activeCamera;if(f){var h=this.getShadowMap();h&&(c.needCube()||b.setMatrix("lightMatrix"+a,this.getTransformMatrix()),this._filter===e.FILTER_PCF?(b.setDepthStencilTexture("shadowSampler"+a,this.getShadowMapForRendering()),c._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),h.getSize().width,1/h.getSize().width,this.frustumEdgeFalloff,a)):this._filter===e.FILTER_PCSS?(b.setDepthStencilTexture("shadowSampler"+a,this.getShadowMapForRendering()),b.setTexture("depthSampler"+a,this.getShadowMapForRendering()),c._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/h.getSize().width,this._contactHardeningLightSizeUVRatio*h.getSize().width,this.frustumEdgeFalloff,a)):(b.setTexture("shadowSampler"+a,this.getShadowMapForRendering()),c._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/h.getSize().width,this.depthScale,this.frustumEdgeFalloff,a)),c._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(f),this.getLight().getDepthMinZ(f)+this.getLight().getDepthMaxZ(f),a))}}},e.prototype.getTransformMatrix=function(){var a=this._scene;if(this._currentRenderID===a.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=a.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var b=this._light.position;if(this._light.computeTransformedInformation()&&(b=this._light.transformedPosition),j.x.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(j.x.Dot(this._lightDirection,j.x.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!b.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(b),this._cachedDirection.copyFrom(this._lightDirection),j.j.LookAtLHToRef(b,b.add(this._lightDirection),j.x.Up(),this._viewMatrix);var c=this.getShadowMap();if(c){var d=c.renderList;d&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,d)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},e.prototype.recreateShadowMap=function(){var a=this._shadowMap;if(a){var b=a.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=b}},e.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},e.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},e.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty())},e.prototype.serialize=function(){var a={},b=this.getShadowMap();if(!b)return a;if(a.lightId=this._light.id,a.mapSize=b.getRenderSize(),a.useExponentialShadowMap=this.useExponentialShadowMap,a.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,a.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,a.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,a.usePoissonSampling=this.usePoissonSampling,a.forceBackFacesOnly=this.forceBackFacesOnly,a.depthScale=this.depthScale,a.darkness=this.getDarkness(),a.blurBoxOffset=this.blurBoxOffset,a.blurKernel=this.blurKernel,a.blurScale=this.blurScale,a.useKernelBlur=this.useKernelBlur,a.transparencyShadow=this._transparencyShadow,a.frustumEdgeFalloff=this.frustumEdgeFalloff,a.bias=this.bias,a.normalBias=this.normalBias,a.usePercentageCloserFiltering=this.usePercentageCloserFiltering,a.useContactHardeningShadow=this.useContactHardeningShadow,a.filteringQuality=this.filteringQuality,a.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,a.renderList=[],b.renderList)for(var c=0;c<b.renderList.length;c++){var d=b.renderList[c];a.renderList.push(d.id)}return a},e.Parse=function(a,b){for(var c=b.getLightByID(a.lightId),d=new e(a.mapSize,c),f=d.getShadowMap(),h=0;h<a.renderList.length;h++)b.getMeshesByID(a.renderList[h]).forEach(function(i){f&&(f.renderList||(f.renderList=[]),f.renderList.push(i))});return a.usePoissonSampling?d.usePoissonSampling=!0:a.useExponentialShadowMap?d.useExponentialShadowMap=!0:a.useBlurExponentialShadowMap?d.useBlurExponentialShadowMap=!0:a.useCloseExponentialShadowMap?d.useCloseExponentialShadowMap=!0:a.useBlurCloseExponentialShadowMap?d.useBlurCloseExponentialShadowMap=!0:a.usePercentageCloserFiltering?d.usePercentageCloserFiltering=!0:a.useContactHardeningShadow&&(d.useContactHardeningShadow=!0),a.filteringQuality&&(d.filteringQuality=a.filteringQuality),a.contactHardeningLightSizeUVRatio?d.contactHardeningLightSizeUVRatio=a.contactHardeningLightSizeUVRatio:a.useVarianceShadowMap?d.useExponentialShadowMap=!0:a.useBlurVarianceShadowMap&&(d.useBlurExponentialShadowMap=!0),a.depthScale&&(d.depthScale=a.depthScale),a.blurScale&&(d.blurScale=a.blurScale),a.blurBoxOffset&&(d.blurBoxOffset=a.blurBoxOffset),a.useKernelBlur&&(d.useKernelBlur=a.useKernelBlur),a.blurKernel&&(d.blurKernel=a.blurKernel),void 0!==a.bias&&(d.bias=a.bias),void 0!==a.normalBias&&(d.normalBias=a.normalBias),void 0!==a.frustumEdgeFalloff&&(d.frustumEdgeFalloff=a.frustumEdgeFalloff),a.darkness&&d.setDarkness(a.darkness),a.transparencyShadow&&d.setTransparencyShadow(!0),d.forceBackFacesOnly=a.forceBackFacesOnly,d},e.FILTER_NONE=0,e.FILTER_EXPONENTIALSHADOWMAP=1,e.FILTER_POISSONSAMPLING=2,e.FILTER_BLUREXPONENTIALSHADOWMAP=3,e.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,e.FILTER_PCF=6,e.FILTER_PCSS=7,e.QUALITY_HIGH=0,e.QUALITY_MEDIUM=1,e.QUALITY_LOW=2,e._SceneComponentInitialization=function(a){throw Zb.a.WarnImport("ShadowGeneratorSceneComponent")},e}();O.a.AddParser(Pa.a.NAME_SHADOWGENERATOR,function(e,a){if(void 0!==e.shadowGenerators&&null!==e.shadowGenerators)for(var b=0,c=e.shadowGenerators.length;b<c;b++){var d=e.shadowGenerators[b];cf.Parse(d,a)}});var lh=function(){function e(a){this.name=Pa.a.NAME_SHADOWGENERATOR,this.scene=a}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Pa.a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.serialize=function(a){a.shadowGenerators=[];for(var b=0,c=this.scene.lights;b<c.length;b++){var d=c[b].getShadowGenerator();d&&a.shadowGenerators.push(d.serialize())}},e.prototype.addFromContainer=function(a){},e.prototype.removeFromContainer=function(a,b){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(a){var b=this.scene;if(this.scene.shadowsEnabled)for(var c=0;c<b.lights.length;c++){var d=b.lights[c],f=d.getShadowGenerator();if(d.isEnabled()&&d.shadowEnabled&&f){var h=f.getShadowMap();-1!==b.textures.indexOf(h)&&a.push(h)}}},e}();cf._SceneComponentInitialization=function(e){var a=e._getComponent(Pa.a.NAME_SHADOWGENERATOR);a||(a=new lh(e),e._addComponent(a))},s.a.AddNodeConstructor("Light_Type_0",function(e,a){return function(){return new mh(e,j.x.Zero(),a)}});var mh=function(e){function a(b,c,d){var f=e.call(this,b,d)||this;return f._shadowAngle=Math.PI/2,f.position=c,f}return v.d(a,e),Object.defineProperty(a.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(b){this._shadowAngle=b,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"direction",{get:function(){return this._direction},set:function(b){var c=this.needCube();this._direction=b,this.needCube()!==c&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"PointLight"},a.prototype.getTypeID=function(){return vc.a.LIGHTTYPEID_POINTLIGHT},a.prototype.needCube=function(){return!this.direction},a.prototype.getShadowDirection=function(b){if(this.direction)return e.prototype.getShadowDirection.call(this,b);switch(b){case 0:return new j.x(1,0,0);case 1:return new j.x(-1,0,0);case 2:return new j.x(0,-1,0);case 3:return new j.x(0,1,0);case 4:return new j.x(0,0,1);case 5:return new j.x(0,0,-1)}return j.x.Zero()},a.prototype._setDefaultShadowProjectionMatrix=function(b,c,d){var f=this.getScene().activeCamera;f&&j.j.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(f),this.getDepthMaxZ(f),b)},a.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},a.prototype.transferToEffect=function(b,c){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,c):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,c),this},a.prototype.prepareLightSpecificDefines=function(b,c){b["POINTLIGHT"+c]=!0},v.c([Object(g.c)()],a.prototype,"shadowAngle",null),a}(Md),nh=function(){function e(a,b,c){var d=this;void 0===b&&(b=""),void 0===c&&(c="black"),this._renderingCanvas=a,this._loadingText=b,this._loadingDivBackgroundColor=c,this._resizeLoadingUI=function(){var f=d._renderingCanvas.getBoundingClientRect(),h=window.getComputedStyle(d._renderingCanvas).position;d._loadingDiv&&(d._loadingDiv.style.position="fixed"===h?"fixed":"absolute",d._loadingDiv.style.left=f.left+"px",d._loadingDiv.style.top=f.top+"px",d._loadingDiv.style.width=f.width+"px",d._loadingDiv.style.height=f.height+"px")}}return e.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var a=document.createElement("style");a.type="text/css",a.innerHTML=`@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}
                    100% { -webkit-transform: rotate(360deg);}
                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}
                    100% { transform: rotate(360deg);}
                }`,document.getElementsByTagName("head")[0].appendChild(a);var b=new Image();e.DefaultLogoUrl?b.src=e.DefaultLogoUrl:b.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+",b.style.position="absolute",b.style.left="50%",b.style.top="50%",b.style.width="10vw",b.style.height="10vw",b.style.marginLeft="-5vw",b.style.marginTop="-5vw";var c=new Image();e.DefaultSpinnerUrl?c.src=e.DefaultSpinnerUrl:c.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==",c.style.position="absolute",c.style.left="50%",c.style.top="50%",c.style.width="18vw",c.style.height="18vw",c.style.marginLeft="-9vw",c.style.marginTop="-9vw",c.style.animation="spin1 0.75s infinite linear",c.style.webkitAnimation="spin1 0.75s infinite linear",c.style.transformOrigin="50% 50%",c.style.webkitTransformOrigin="50% 50%",this._loadingDiv.appendChild(b),this._loadingDiv.appendChild(c),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},e.prototype.hideLoadingUI=function(){var a=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){a._loadingDiv&&(a._loadingDiv.parentElement&&a._loadingDiv.parentElement.removeChild(a._loadingDiv),window.removeEventListener("resize",a._resizeLoadingUI),a._loadingDiv=null)}))},Object.defineProperty(e.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(a){this._loadingText=a,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(a){this._loadingDivBackgroundColor=a,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),e.DefaultLogoUrl="",e.DefaultSpinnerUrl="",e}();va.b.DefaultLoadingScreenFactory=function(e){return new nh(e)};var df=l(57),Sd=l(66),ef=function(){function e(){}return e.ConvertPanoramaToCubemap=function(a,b,c,d){if(!a)throw"ConvertPanoramaToCubemap: input cannot be null";if(a.length!=b*c*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(d,this.FACE_FRONT,a,b,c),back:this.CreateCubemapTexture(d,this.FACE_BACK,a,b,c),left:this.CreateCubemapTexture(d,this.FACE_LEFT,a,b,c),right:this.CreateCubemapTexture(d,this.FACE_RIGHT,a,b,c),up:this.CreateCubemapTexture(d,this.FACE_UP,a,b,c),down:this.CreateCubemapTexture(d,this.FACE_DOWN,a,b,c),size:d,type:o.a.TEXTURETYPE_FLOAT,format:o.a.TEXTUREFORMAT_RGB,gammaSpace:!1}},e.CreateCubemapTexture=function(a,b,c,d,f){for(var h=new ArrayBuffer(a*a*4*3),i=new Float32Array(h),k=b[1].subtract(b[0]).scale(1/a),m=b[3].subtract(b[2]).scale(1/a),B=1/a,E=0,K=0;K<a;K++){for(var P=b[0],S=b[2],U=0;U<a;U++){var _=S.subtract(P).scale(E).add(P);_.normalize();var da=this.CalcProjectionSpherical(_,c,d,f);i[K*a*3+3*U+0]=da.r,i[K*a*3+3*U+1]=da.g,i[K*a*3+3*U+2]=da.b,P=P.add(k),S=S.add(m)}E+=B}return i},e.CalcProjectionSpherical=function(a,b,c,d){for(var f=Math.atan2(a.z,a.x),h=Math.acos(a.y);f<-Math.PI;)f+=2*Math.PI;for(;f>Math.PI;)f-=2*Math.PI;var i=f/Math.PI,k=h/Math.PI;i=.5*i+.5;var m=Math.round(i*c);m<0?m=0:m>=c&&(m=c-1);var B=Math.round(k*d);B<0?B=0:B>=d&&(B=d-1);var E=d-B-1;return{r:b[E*c*3+3*m+0],g:b[E*c*3+3*m+1],b:b[E*c*3+3*m+2]}},e.FACE_FRONT=[new j.x(-1,-1,-1),new j.x(1,-1,-1),new j.x(-1,1,-1),new j.x(1,1,-1)],e.FACE_BACK=[new j.x(1,-1,1),new j.x(-1,-1,1),new j.x(1,1,1),new j.x(-1,1,1)],e.FACE_RIGHT=[new j.x(1,-1,-1),new j.x(1,-1,1),new j.x(1,1,-1),new j.x(1,1,1)],e.FACE_LEFT=[new j.x(-1,-1,1),new j.x(-1,-1,-1),new j.x(-1,1,1),new j.x(-1,1,-1)],e.FACE_DOWN=[new j.x(-1,1,-1),new j.x(1,1,-1),new j.x(-1,1,1),new j.x(1,1,1)],e.FACE_UP=[new j.x(-1,-1,1),new j.x(1,-1,1),new j.x(-1,-1,-1),new j.x(1,-1,-1)],e}(),oh=function(){function e(){}return e.Ldexp=function(a,b){return b>1023?a*Math.pow(2,1023)*Math.pow(2,b-1023):b<-1074?a*Math.pow(2,-1074)*Math.pow(2,b+1074):a*Math.pow(2,b)},e.Rgbe2float=function(a,b,c,d,f,h){f>0?(f=this.Ldexp(1,f-136),a[h+0]=b*f,a[h+1]=c*f,a[h+2]=d*f):(a[h+0]=0,a[h+1]=0,a[h+2]=0)},e.readStringLine=function(a,b){for(var c="",d="",f=b;f<a.length-b&&`
`!=(d=String.fromCharCode(a[f]));f++)c+=d;return c},e.RGBE_ReadHeader=function(a){var b,c,d=this.readStringLine(a,0);if("#"!=d[0]||"?"!=d[1])throw"Bad HDR Format.";var f=!1,h=!1,i=0;do i+=d.length+1,"FORMAT=32-bit_rle_rgbe"==(d=this.readStringLine(a,i))?h=!0:0==d.length&&(f=!0);while(!f);if(!h)throw"HDR Bad header format, unsupported FORMAT";i+=d.length+1,d=this.readStringLine(a,i);var k=/^\-Y (.*) \+X (.*)$/g.exec(d);if(!k||k.length<3)throw"HDR Bad header format, no size";if(c=parseInt(k[2]),b=parseInt(k[1]),c<8||c>32767)throw"HDR Bad header format, unsupported size";return{height:b,width:c,dataPosition:i+=d.length+1}},e.GetCubeMapTextureData=function(a,b){var c=new Uint8Array(a),d=this.RGBE_ReadHeader(c),f=this.RGBE_ReadPixels_RLE(c,d);return ef.ConvertPanoramaToCubemap(f,d.width,d.height,b)},e.RGBE_ReadPixels=function(a,b){return this.RGBE_ReadPixels_RLE(a,b)},e.RGBE_ReadPixels_RLE=function(a,b){for(var c,d,f,h,i,k=b.height,m=b.width,B=b.dataPosition,E=0,K=0,P=0,S=new ArrayBuffer(4*m),U=new Uint8Array(S),_=new ArrayBuffer(b.width*b.height*4*3),da=new Float32Array(_);k>0;){if(c=a[B++],d=a[B++],f=a[B++],h=a[B++],2!=c||2!=d||128&f)throw"HDR Bad header format, not RLE";if((f<<8|h)!=m)throw"HDR Bad header format, wrong scan line width";for(E=0,P=0;P<4;P++)for(K=(P+1)*m;E<K;)if(c=a[B++],d=a[B++],c>128){if(0==(i=c-128)||i>K-E)throw"HDR Bad Format, bad scanline data (run)";for(;i-- >0;)U[E++]=d}else{if(0==(i=c)||i>K-E)throw"HDR Bad Format, bad scanline data (non-run)";if(U[E++]=d,--i>0)for(var fa=0;fa<i;fa++)U[E++]=a[B++]}for(P=0;P<m;P++)c=U[P],d=U[P+m],f=U[P+2*m],h=U[P+3*m],this.Rgbe2float(da,c,d,f,h,(b.height-k)*m*3+3*P);k--}return da},e}(),jd=function(e){function a(b,c,d,f,h,i,k,m,B){void 0===f&&(f=!1),void 0===h&&(h=!0),void 0===i&&(i=!1),void 0===k&&(k=!1),void 0===m&&(m=null),void 0===B&&(B=null);var E=e.call(this,c)||this;return E._generateHarmonics=!0,E._onLoad=null,E._onError=null,E.coordinatesMode=ra.a.CUBIC_MODE,E._isBlocking=!0,E._rotationY=0,E.boundingBoxPosition=j.x.Zero(),b?(E.name=b,E.url=b,E.hasAlpha=!1,E.isCube=!0,E._textureMatrix=j.j.Identity(),E._onLoad=m,E._onError=B,E.gammaSpace=i,E._noMipmap=f,E._size=d,E._texture=E._getFromCache(b,E._noMipmap),E._texture?m&&(E._texture.isReady?xa.h.SetImmediate(function(){return m()}):E._texture.onLoadedObservable.add(m)):c.useDelayedTextureLoading?E.delayLoadState=va.b.DELAYLOADSTATE_NOTLOADED:E.loadTexture(),E):E}return v.d(a,e),Object.defineProperty(a.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(b){this._isBlocking=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationY",{get:function(){return this._rotationY},set:function(b){this._rotationY=b,this.setReflectionTextureMatrix(j.j.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(b){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(b)){this._boundingBoxSize=b;var c=this.getScene();c&&c.markAllMaterialsAsDirty(o.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"HDRCubeTexture"},a.prototype.loadTexture=function(){var b=this,c=this.getScene();c&&(this._texture=c.getEngine().createRawCubeTextureFromUrl(this.url,c,this._size,va.b.TEXTUREFORMAT_RGB,c.getEngine().getCaps().textureFloat?va.b.TEXTURETYPE_FLOAT:va.b.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(d){b.lodGenerationOffset=0,b.lodGenerationScale=.8;var f=b.getScene();if(!f)return null;var h=oh.GetCubeMapTextureData(d,b._size);if(b._generateHarmonics){var i=Ze.a.ConvertCubeMapToSphericalPolynomial(h);b.sphericalPolynomial=i}for(var k=[],m=null,B=0;B<6;B++){if(!f.getEngine().getCaps().textureFloat){var E=new ArrayBuffer(b._size*b._size*3);m=new Uint8Array(E)}var K=h[a._facesMapping[B]];if(b.gammaSpace||m){for(var P=0;P<b._size*b._size;P++)if(b.gammaSpace&&(K[3*P+0]=Math.pow(K[3*P+0],j.u),K[3*P+1]=Math.pow(K[3*P+1],j.u),K[3*P+2]=Math.pow(K[3*P+2],j.u)),m){var S=Math.max(255*K[3*P+0],0),U=Math.max(255*K[3*P+1],0),_=Math.max(255*K[3*P+2],0),da=Math.max(Math.max(S,U),_);if(da>255){var fa=255/da;S*=fa,U*=fa,_*=fa}m[3*P+0]=S,m[3*P+1]=U,m[3*P+2]=_}}m?k.push(m):k.push(K)}return k},null,this._onLoad,this._onError))},a.prototype.clone=function(){var b=this.getScene();if(!b)return this;var c=new a(this.url,b,this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return c.level=this.level,c.wrapU=this.wrapU,c.wrapV=this.wrapV,c.coordinatesIndex=this.coordinatesIndex,c.coordinatesMode=this.coordinatesMode,c},a.prototype.delayLoad=function(){this.delayLoadState===va.b.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=va.b.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},a.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},a.prototype.setReflectionTextureMatrix=function(b){var c=this;this._textureMatrix=b,b.updateFlag!==this._textureMatrix.updateFlag&&b.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(o.a.MATERIAL_TextureDirtyFlag,function(d){return-1!==d.getActiveTextures().indexOf(c)})},a.Parse=function(b,c,d){var f=null;return b.name&&!b.isRenderTarget&&((f=new a(d+b.name,c,b.size,b.noMipmap,b.generateHarmonics,b.useInGammaSpace)).name=b.name,f.hasAlpha=b.hasAlpha,f.level=b.level,f.coordinatesMode=b.coordinatesMode,f.isBlocking=b.isBlocking),f&&(b.boundingBoxPosition&&(f.boundingBoxPosition=j.x.FromArray(b.boundingBoxPosition)),b.boundingBoxSize&&(f.boundingBoxSize=j.x.FromArray(b.boundingBoxSize)),b.rotationY&&(f.rotationY=b.rotationY)),f},a.prototype.serialize=function(){if(!this.name)return null;var b={};return b.name=this.name,b.hasAlpha=this.hasAlpha,b.isCube=!0,b.level=this.level,b.size=this._size,b.coordinatesMode=this.coordinatesMode,b.useInGammaSpace=this.gammaSpace,b.generateHarmonics=this._generateHarmonics,b.customType="BABYLON.HDRCubeTexture",b.noMipmap=this._noMipmap,b.isBlocking=this._isBlocking,b.rotationY=this._rotationY,b},a._facesMapping=["right","left","up","down","front","back"],a}(ac.a);I.a.RegisteredTypes["BABYLON.HDRCubeTexture"]=jd;var ph=function(){function e(a,b,c){void 0===b&&(b=0),void 0===c&&(c=null),this.name=a,this.animations=new Array(),this._positions=null,this._normals=null,this._tangents=null,this.onInfluenceChanged=new q.c(),this._onDataLayoutChanged=new q.c(),this._animationPropertiesOverride=null,this._scene=c||T.a.LastCreatedScene,this.influence=b}return Object.defineProperty(e.prototype,"influence",{get:function(){return this._influence},set:function(a){if(this._influence!==a){var b=this._influence;this._influence=a,this.onInfluenceChanged.hasObservers&&this.onInfluenceChanged.notifyObservers(0===b||0===a)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(a){this._animationPropertiesOverride=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!0,configurable:!0}),e.prototype.setPositions=function(a){var b=this.hasPositions;this._positions=a,b!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getPositions=function(){return this._positions},e.prototype.setNormals=function(a){var b=this.hasNormals;this._normals=a,b!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getNormals=function(){return this._normals},e.prototype.setTangents=function(a){var b=this.hasTangents;this._tangents=a,b!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getTangents=function(){return this._tangents},e.prototype.serialize=function(){var a={};return a.name=this.name,a.influence=this.influence,a.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(a.id=this.id),this.hasNormals&&(a.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(a.tangents=Array.prototype.slice.call(this.getTangents())),g.a.AppendSerializedAnimations(this,a),a},e.prototype.getClassName=function(){return"MorphTarget"},e.Parse=function(a){var b=new e(a.name,a.influence);if(b.setPositions(a.positions),null!=a.id&&(b.id=a.id),a.normals&&b.setNormals(a.normals),a.tangents&&b.setTangents(a.tangents),a.animations)for(var c=0;c<a.animations.length;c++){var d=a.animations[c],f=I.a.GetClass("BABYLON.Animation");f&&b.animations.push(f.Parse(d))}return b},e.FromMesh=function(a,b,c){b||(b=a.name);var d=new e(b,c,a.getScene());return d.setPositions(a.getVerticesData(na.b.PositionKind)),a.isVerticesDataPresent(na.b.NormalKind)&&d.setNormals(a.getVerticesData(na.b.NormalKind)),a.isVerticesDataPresent(na.b.TangentKind)&&d.setTangents(a.getVerticesData(na.b.TangentKind)),d},v.c([Object(g.c)()],e.prototype,"id",void 0),e}(),ff=function(){function e(a){void 0===a&&(a=null),this._targets=new Array(),this._targetInfluenceChangedObservers=new Array(),this._targetDataLayoutChangedObservers=new Array(),this._activeTargets=new ic.a(16),this._supportsNormals=!1,this._supportsTangents=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array(),a||(a=T.a.LastCreatedScene),this._scene=a,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsNormals",{get:function(){return this._supportsNormals},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTangents",{get:function(){return this._supportsTangents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"influences",{get:function(){return this._influences},enumerable:!0,configurable:!0}),e.prototype.getActiveTarget=function(a){return this._activeTargets.data[a]},e.prototype.getTarget=function(a){return this._targets[a]},e.prototype.addTarget=function(a){var b=this;this._targets.push(a),this._targetInfluenceChangedObservers.push(a.onInfluenceChanged.add(function(c){b._syncActiveTargets(c)})),this._targetDataLayoutChangedObservers.push(a._onDataLayoutChanged.add(function(){b._syncActiveTargets(!0)})),this._syncActiveTargets(!0)},e.prototype.removeTarget=function(a){var b=this._targets.indexOf(a);b>=0&&(this._targets.splice(b,1),a.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(b,1)[0]),a._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(b,1)[0]),this._syncActiveTargets(!0))},e.prototype.serialize=function(){var a={};a.id=this.uniqueId,a.targets=[];for(var b=0,c=this._targets;b<c.length;b++){var d=c[b];a.targets.push(d.serialize())}return a},e.prototype._syncActiveTargets=function(a){var b=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._vertexCount=0;for(var c=0,d=this._targets;c<d.length;c++){var f=d[c];if(0!==f.influence){this._activeTargets.push(f),this._tempInfluences[b++]=f.influence,this._supportsNormals=this._supportsNormals&&f.hasNormals,this._supportsTangents=this._supportsTangents&&f.hasTangents;var h=f.getPositions();if(h){var i=h.length/3;if(0===this._vertexCount)this._vertexCount=i;else if(this._vertexCount!==i)return void r.a.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===b||(this._influences=new Float32Array(b));for(var k=0;k<b;k++)this._influences[k]=this._tempInfluences[k];a&&this.synchronize()},e.prototype.synchronize=function(){if(this._scene)for(var a=0,b=this._scene.meshes;a<b.length;a++){var c=b[a];c.morphTargetManager===this&&c._syncGeometryWithMorphTargetManager()}},e.Parse=function(a,b){var c=new e(b);c._uniqueId=a.id;for(var d=0,f=a.targets;d<f.length;d++){var h=f[d];c.addTarget(ph.Parse(h))}return c},e}(),pb=l(27),vb=l(37),Pc=function(){function e(a,b){if(void 0===b&&(b=e.DefaultPluginFactory()),this._physicsPlugin=b,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");a=a||new j.x(0,-9.807,0),this.setGravity(a),this.setTimeStep()}return e.DefaultPluginFactory=function(){throw Zb.a.WarnImport("CannonJSPlugin")},e.prototype.setGravity=function(a){this.gravity=a,this._physicsPlugin.setGravity(this.gravity)},e.prototype.setTimeStep=function(a){void 0===a&&(a=1/60),this._physicsPlugin.setTimeStep(a)},e.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},e.prototype.dispose=function(){this._impostors.forEach(function(a){a.dispose()}),this._physicsPlugin.dispose()},e.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},e.prototype.addImpostor=function(a){a.uniqueId=this._impostors.push(a),a.parent||this._physicsPlugin.generatePhysicsBody(a)},e.prototype.removeImpostor=function(a){var b=this._impostors.indexOf(a);b>-1&&(this._impostors.splice(b,1).length&&this.getPhysicsPlugin().removePhysicsBody(a))},e.prototype.addJoint=function(a,b,c){var d={mainImpostor:a,connectedImpostor:b,joint:c};c.physicsPlugin=this._physicsPlugin,this._joints.push(d),this._physicsPlugin.generateJoint(d)},e.prototype.removeJoint=function(a,b,c){var d=this._joints.filter(function(f){return f.connectedImpostor===b&&f.joint===c&&f.mainImpostor===a});d.length&&this._physicsPlugin.removeJoint(d[0])},e.prototype._step=function(a){var b=this;this._impostors.forEach(function(c){c.isBodyInitRequired()&&b._physicsPlugin.generatePhysicsBody(c)}),a>.1?a=.1:a<=0&&(a=1/60),this._physicsPlugin.executeStep(a,this._impostors)},e.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},e.prototype.getImpostors=function(){return this._impostors},e.prototype.getImpostorForPhysicsObject=function(a){for(var b=0;b<this._impostors.length;++b)if(this._impostors[b].object===a)return this._impostors[b];return null},e.prototype.getImpostorWithPhysicsBody=function(a){for(var b=0;b<this._impostors.length;++b)if(this._impostors[b].physicsBody===a)return this._impostors[b];return null},e.prototype.raycast=function(a,b){return this._physicsPlugin.raycast(a,b)},e.Epsilon=.001,e}(),gf=function(){function e(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=j.x.Zero(),this._hitPointWorld=j.x.Zero(),this._rayFromWorld=j.x.Zero(),this._rayToWorld=j.x.Zero()}return Object.defineProperty(e.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!0,configurable:!0}),e.prototype.setHitData=function(a,b){this._hasHit=!0,this._hitNormalWorld=new j.x(a.x,a.y,a.z),this._hitPointWorld=new j.x(b.x,b.y,b.z)},e.prototype.setHitDistance=function(a){this._hitDistance=a},e.prototype.calculateHitDistance=function(){this._hitDistance=j.x.Distance(this._rayFromWorld,this._hitPointWorld)},e.prototype.reset=function(a,b){void 0===a&&(a=j.x.Zero()),void 0===b&&(b=j.x.Zero()),this._rayFromWorld=a,this._rayToWorld=b,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=j.x.Zero(),this._hitPointWorld=j.x.Zero()},e}(),hf=function(){function e(a,b,c){void 0===a&&(a=!0),void 0===b&&(b=10),void 0===c&&(c=CANNON),this._useDeltaForWorldStep=a,this.name="CannonJSPlugin",this._physicsMaterials=new Array(),this._fixedTimeStep=1/60,this._removeAfterStep=new Array(),this._minus90X=new j.q(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new j.q(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=j.x.Zero(),this._tmpDeltaPosition=j.x.Zero(),this._tmpUnityRotation=new j.q(),this.BJSCANNON=c,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World(),this.world.broadphase=new this.BJSCANNON.NaiveBroadphase(),this.world.solver.iterations=b,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult(),this._raycastResult=new gf()):r.a.Error("CannonJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(a){this.world.gravity.copy(a)},e.prototype.setTimeStep=function(a){this._fixedTimeStep=a},e.prototype.getTimeStep=function(){return this._fixedTimeStep},e.prototype.executeStep=function(a){var b=this;this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?a:0,3),this._removeAfterStep.length>0&&(this._removeAfterStep.forEach(function(c){b.world.remove(c.physicsBody)}),this._removeAfterStep=[])},e.prototype.applyImpulse=function(a,b,c){var d=new this.BJSCANNON.Vec3(c.x,c.y,c.z),f=new this.BJSCANNON.Vec3(b.x,b.y,b.z);a.physicsBody.applyImpulse(f,d)},e.prototype.applyForce=function(a,b,c){var d=new this.BJSCANNON.Vec3(c.x,c.y,c.z),f=new this.BJSCANNON.Vec3(b.x,b.y,b.z);a.physicsBody.applyForce(f,d)},e.prototype.generatePhysicsBody=function(a){if(a.parent)a.physicsBody&&(this.removePhysicsBody(a),a.forceUpdate());else{if(a.isBodyInitRequired()){var b=this._createShape(a),c=a.physicsBody;c&&this.removePhysicsBody(a);var d=this._addMaterial("mat-"+a.uniqueId,a.getParam("friction"),a.getParam("restitution")),f={mass:a.getParam("mass"),material:d},h=a.getParam("nativeOptions");for(var i in h)h.hasOwnProperty(i)&&(f[i]=h[i]);a.physicsBody=new this.BJSCANNON.Body(f),a.physicsBody.addEventListener("collide",a.onCollide),this.world.addEventListener("preStep",a.beforeStep),this.world.addEventListener("postStep",a.afterStep),a.physicsBody.addShape(b),this.world.add(a.physicsBody),c&&["force","torque","velocity","angularVelocity"].forEach(function(k){a.physicsBody[k].copy(c[k])}),this._processChildMeshes(a)}this._updatePhysicsBodyTransformation(a)}},e.prototype._processChildMeshes=function(a){var b=this,c=a.object.getChildMeshes?a.object.getChildMeshes(!0):[],d=a.object.rotationQuaternion;if(c.length){var f=function(h,i){if(d&&i.rotationQuaternion){var k=i.getPhysicsImpostor();if(k){if(k.parent!==a){var m=i.getAbsolutePosition().subtract(a.object.getAbsolutePosition()),B=i.rotationQuaternion.multiply(j.q.Inverse(d));k.physicsBody&&(b.removePhysicsBody(k),k.physicsBody=null),k.parent=a,k.resetUpdateFlags(),a.physicsBody.addShape(b._createShape(k),new b.BJSCANNON.Vec3(m.x,m.y,m.z),new b.BJSCANNON.Quaternion(B.x,B.y,B.z,B.w)),a.physicsBody.mass+=k.getParam("mass")}}d.multiplyInPlace(i.rotationQuaternion),i.getChildMeshes(!0).filter(function(E){return!!E.physicsImpostor}).forEach(f.bind(b,i.getAbsolutePosition()))}};c.filter(function(h){return!!h.physicsImpostor}).forEach(f.bind(this,a.object.getAbsolutePosition()))}},e.prototype.removePhysicsBody=function(a){a.physicsBody.removeEventListener("collide",a.onCollide),this.world.removeEventListener("preStep",a.beforeStep),this.world.removeEventListener("postStep",a.afterStep),this._removeAfterStep.push(a)},e.prototype.generateJoint=function(a){var b=a.mainImpostor.physicsBody,c=a.connectedImpostor.physicsBody;if(b&&c){var d,f=a.joint.jointData,h={pivotA:f.mainPivot?new this.BJSCANNON.Vec3().copy(f.mainPivot):null,pivotB:f.connectedPivot?new this.BJSCANNON.Vec3().copy(f.connectedPivot):null,axisA:f.mainAxis?new this.BJSCANNON.Vec3().copy(f.mainAxis):null,axisB:f.connectedAxis?new this.BJSCANNON.Vec3().copy(f.connectedAxis):null,maxForce:f.nativeParams.maxForce,collideConnected:!!f.collision};switch(a.joint.type){case vb.e.HingeJoint:case vb.e.Hinge2Joint:d=new this.BJSCANNON.HingeConstraint(b,c,h);break;case vb.e.DistanceJoint:d=new this.BJSCANNON.DistanceConstraint(b,c,f.maxDistance||2);break;case vb.e.SpringJoint:var i=f;d=new this.BJSCANNON.Spring(b,c,{restLength:i.length,stiffness:i.stiffness,damping:i.damping,localAnchorA:h.pivotA,localAnchorB:h.pivotB});break;case vb.e.LockJoint:d=new this.BJSCANNON.LockConstraint(b,c,h);break;case vb.e.PointToPointJoint:case vb.e.BallAndSocketJoint:default:d=new this.BJSCANNON.PointToPointConstraint(b,h.pivotA,c,h.pivotB,h.maxForce)}d.collideConnected=!!f.collision,a.joint.physicsJoint=d,a.joint.type!==vb.e.SpringJoint?this.world.addConstraint(d):(a.joint.jointData.forceApplicationCallback=a.joint.jointData.forceApplicationCallback||function(){d.applyForce()},a.mainImpostor.registerAfterPhysicsStep(a.joint.jointData.forceApplicationCallback))}},e.prototype.removeJoint=function(a){a.joint.type!==vb.e.SpringJoint?this.world.removeConstraint(a.joint.physicsJoint):a.mainImpostor.unregisterAfterPhysicsStep(a.joint.jointData.forceApplicationCallback)},e.prototype._addMaterial=function(a,b,c){var d,f;for(d=0;d<this._physicsMaterials.length;d++)if((f=this._physicsMaterials[d]).friction===b&&f.restitution===c)return f;var h=new this.BJSCANNON.Material(a);return h.friction=b,h.restitution=c,this._physicsMaterials.push(h),h},e.prototype._checkWithEpsilon=function(a){return a<Pc.Epsilon?Pc.Epsilon:a},e.prototype._createShape=function(a){var b,c=a.object,d=a.getObjectExtendSize();switch(a.type){case pb.a.SphereImpostor:var f=d.x,h=d.y,i=d.z;b=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(f),this._checkWithEpsilon(h),this._checkWithEpsilon(i))/2);break;case pb.a.CylinderImpostor:var k=a.getParam("nativeOptions");k||(k={});var m=void 0!==k.radiusTop?k.radiusTop:this._checkWithEpsilon(d.x)/2,B=void 0!==k.radiusBottom?k.radiusBottom:this._checkWithEpsilon(d.x)/2,E=void 0!==k.height?k.height:this._checkWithEpsilon(d.y),K=void 0!==k.numSegments?k.numSegments:16;b=new this.BJSCANNON.Cylinder(m,B,E,K);var P=new this.BJSCANNON.Quaternion();P.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);var S=new this.BJSCANNON.Vec3(0,0,0);b.transformAllPoints(S,P);break;case pb.a.BoxImpostor:var U=d.scale(.5);b=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(U.x),this._checkWithEpsilon(U.y),this._checkWithEpsilon(U.z)));break;case pb.a.PlaneImpostor:r.a.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),b=new this.BJSCANNON.Plane();break;case pb.a.MeshImpostor:var _=c.getVerticesData?c.getVerticesData(na.b.PositionKind):[],da=c.getIndices?c.getIndices():[];if(!_)return;var fa=c.position.clone(),ga=c.rotation&&c.rotation.clone(),ha=c.rotationQuaternion&&c.rotationQuaternion.clone();c.position.copyFromFloats(0,0,0),c.rotation&&c.rotation.copyFromFloats(0,0,0),c.rotationQuaternion&&c.rotationQuaternion.copyFrom(a.getParentsRotation()),c.rotationQuaternion&&c.parent&&c.rotationQuaternion.conjugateInPlace();var ka,la=c.computeWorldMatrix(!0),ma=new Array();for(ka=0;ka<_.length;ka+=3)j.x.TransformCoordinates(j.x.FromArray(_,ka),la).toArray(ma,ka);r.a.Warn("MeshImpostor only collides against spheres."),b=new this.BJSCANNON.Trimesh(ma,da),c.position.copyFrom(fa),ga&&c.rotation&&c.rotation.copyFrom(ga),ha&&c.rotationQuaternion&&c.rotationQuaternion.copyFrom(ha);break;case pb.a.HeightmapImpostor:var ta=c.position.clone(),pa=c.rotation&&c.rotation.clone(),ua=c.rotationQuaternion&&c.rotationQuaternion.clone();c.position.copyFromFloats(0,0,0),c.rotation&&c.rotation.copyFromFloats(0,0,0),c.rotationQuaternion&&c.rotationQuaternion.copyFrom(a.getParentsRotation()),c.rotationQuaternion&&c.parent&&c.rotationQuaternion.conjugateInPlace(),c.rotationQuaternion&&c.rotationQuaternion.multiplyInPlace(this._minus90X),b=this._createHeightmap(c),c.position.copyFrom(ta),pa&&c.rotation&&c.rotation.copyFrom(pa),ua&&c.rotationQuaternion&&c.rotationQuaternion.copyFrom(ua),c.computeWorldMatrix(!0);break;case pb.a.ParticleImpostor:b=new this.BJSCANNON.Particle();break;case pb.a.NoImpostor:b=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return b},e.prototype._createHeightmap=function(a,b){var c,d=a.getVerticesData(na.b.PositionKind),f=a.computeWorldMatrix(!0),h=new Array();for(c=0;c<d.length;c+=3)j.x.TransformCoordinates(j.x.FromArray(d,c),f).toArray(h,c);d=h;for(var i=new Array(),k=b||~~(Math.sqrt(d.length/3)-1),m=a.getBoundingInfo(),B=Math.min(m.boundingBox.extendSizeWorld.x,m.boundingBox.extendSizeWorld.y),E=m.boundingBox.extendSizeWorld.z,K=2*B/k,P=0;P<d.length;P+=3){var S=Math.round(d[P+0]/K+k/2),U=Math.round(-1*(d[P+1]/K-k/2)),_=-d[P+2]+E;i[S]||(i[S]=[]),i[S][U]||(i[S][U]=_),i[S][U]=Math.max(_,i[S][U])}for(S=0;S<=k;++S){if(!i[S]){for(var da=1;!i[(S+da)%k];)da++;i[S]=i[(S+da)%k].slice()}for(U=0;U<=k;++U)if(!i[S][U]){var fa;for(da=1;void 0===fa;)fa=i[S][(U+da++)%k];i[S][U]=fa}}var ga=new this.BJSCANNON.Heightfield(i,{elementSize:K});return ga.minY=E,ga},e.prototype._updatePhysicsBodyTransformation=function(a){var b=a.object;if(b.computeWorldMatrix&&b.computeWorldMatrix(!0),b.getBoundingInfo()){var c=a.getObjectCenter();this._tmpDeltaPosition.copyFrom(b.getAbsolutePivotPoint().subtract(c)),this._tmpDeltaPosition.divideInPlace(a.object.scaling),this._tmpPosition.copyFrom(c);var d=b.rotationQuaternion;if(d){if(a.type!==pb.a.PlaneImpostor&&a.type!==pb.a.HeightmapImpostor||(d=d.multiply(this._minus90X),a.setDeltaRotation(this._plus90X)),a.type===pb.a.HeightmapImpostor){var f=b,h=f.getBoundingInfo(),i=f.rotationQuaternion;f.rotationQuaternion=this._tmpUnityRotation,f.computeWorldMatrix(!0);var k=c.clone(),m=f.getPivotMatrix();m=m?m.clone():j.j.Identity();var B=j.j.Translation(h.boundingBox.extendSizeWorld.x,0,-h.boundingBox.extendSizeWorld.z);f.setPreTransformMatrix(B),f.computeWorldMatrix(!0);var E=h.boundingBox.centerWorld.subtract(c).subtract(f.position).negate();this._tmpPosition.copyFromFloats(E.x,E.y-h.boundingBox.extendSizeWorld.y,E.z),this._tmpDeltaPosition.copyFrom(h.boundingBox.centerWorld.subtract(k)),this._tmpDeltaPosition.y+=h.boundingBox.extendSizeWorld.y,f.rotationQuaternion=i,f.setPreTransformMatrix(m),f.computeWorldMatrix(!0)}else a.type===pb.a.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);a.setDeltaPosition(this._tmpDeltaPosition),a.physicsBody.position.copy(this._tmpPosition),a.physicsBody.quaternion.copy(d)}}},e.prototype.setTransformationFromPhysicsBody=function(a){a.object.position.copyFrom(a.physicsBody.position),a.object.rotationQuaternion&&a.object.rotationQuaternion.copyFrom(a.physicsBody.quaternion)},e.prototype.setPhysicsBodyTransformation=function(a,b,c){a.physicsBody.position.copy(b),a.physicsBody.quaternion.copy(c)},e.prototype.isSupported=function(){return void 0!==this.BJSCANNON},e.prototype.setLinearVelocity=function(a,b){a.physicsBody.velocity.copy(b)},e.prototype.setAngularVelocity=function(a,b){a.physicsBody.angularVelocity.copy(b)},e.prototype.getLinearVelocity=function(a){var b=a.physicsBody.velocity;return b?new j.x(b.x,b.y,b.z):null},e.prototype.getAngularVelocity=function(a){var b=a.physicsBody.angularVelocity;return b?new j.x(b.x,b.y,b.z):null},e.prototype.setBodyMass=function(a,b){a.physicsBody.mass=b,a.physicsBody.updateMassProperties()},e.prototype.getBodyMass=function(a){return a.physicsBody.mass},e.prototype.getBodyFriction=function(a){return a.physicsBody.material.friction},e.prototype.setBodyFriction=function(a,b){a.physicsBody.material.friction=b},e.prototype.getBodyRestitution=function(a){return a.physicsBody.material.restitution},e.prototype.setBodyRestitution=function(a,b){a.physicsBody.material.restitution=b},e.prototype.sleepBody=function(a){a.physicsBody.sleep()},e.prototype.wakeUpBody=function(a){a.physicsBody.wakeUp()},e.prototype.updateDistanceJoint=function(a,b){a.physicsJoint.distance=b},e.prototype.setMotor=function(a,b,c,d){d||(a.physicsJoint.enableMotor(),a.physicsJoint.setMotorSpeed(b),c&&this.setLimit(a,c))},e.prototype.setLimit=function(a,b,c){a.physicsJoint.motorEquation.maxForce=b,a.physicsJoint.motorEquation.minForce=void 0===c?-b:c},e.prototype.syncMeshWithImpostor=function(a,b){var c=b.physicsBody;a.position.x=c.position.x,a.position.y=c.position.y,a.position.z=c.position.z,a.rotationQuaternion&&(a.rotationQuaternion.x=c.quaternion.x,a.rotationQuaternion.y=c.quaternion.y,a.rotationQuaternion.z=c.quaternion.z,a.rotationQuaternion.w=c.quaternion.w)},e.prototype.getRadius=function(a){return a.physicsBody.shapes[0].boundingSphereRadius},e.prototype.getBoxSizeToRef=function(a,b){var c=a.physicsBody.shapes[0];b.x=2*c.halfExtents.x,b.y=2*c.halfExtents.y,b.z=2*c.halfExtents.z},e.prototype.dispose=function(){},e.prototype._extendNamespace=function(){var a=new this.BJSCANNON.Vec3(),b=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(c,d,f){if(f=f||10,0===(d=d||0))this.internalStep(c),this.time+=c;else{var h=Math.floor((this.time+d)/c)-Math.floor(this.time/c);h=Math.min(h,f)||1;for(var i=performance.now(),k=0;k!==h&&(this.internalStep(c),!(performance.now()-i>1000*c));k++);this.time+=d;for(var m=this.time%c/c,B=a,E=this.bodies,K=0;K!==E.length;K++){var P=E[K];P.type!==b.Body.STATIC&&P.sleepState!==b.Body.SLEEPING?(P.position.vsub(P.previousPosition,B),B.scale(m,B),P.position.vadd(B,P.interpolatedPosition)):(P.interpolatedPosition.copy(P.position),P.interpolatedQuaternion.copy(P.quaternion))}}}},e.prototype.raycast=function(a,b){return this._cannonRaycastResult.reset(),this.world.raycastClosest(a,b,{},this._cannonRaycastResult),this._raycastResult.reset(a,b),this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance)),this._raycastResult},e}();Pc.DefaultPluginFactory=function(){return new hf()};var qh=function(){function e(a,b){void 0===b&&(b=OIMO),this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=j.x.Zero(),this.BJSOIMO=b,this.world=new this.BJSOIMO.World({iterations:a}),this.world.clear(),this._raycastResult=new gf()}return e.prototype.setGravity=function(a){this.world.gravity.copy(a)},e.prototype.setTimeStep=function(a){this.world.timeStep=a},e.prototype.getTimeStep=function(){return this.world.timeStep},e.prototype.executeStep=function(a,b){var c=this;b.forEach(function(i){i.beforeStep()}),this.world.step(),b.forEach(function(i){i.afterStep(),c._tmpImpostorsArray[i.uniqueId]=i});for(var d=this.world.contacts;null!==d;)if(!d.touching||d.body1.sleeping||d.body2.sleeping){var f=this._tmpImpostorsArray[+d.body1.name],h=this._tmpImpostorsArray[+d.body2.name];f&&h?(f.onCollide({body:h.physicsBody}),h.onCollide({body:f.physicsBody}),d=d.next):d=d.next}else d=d.next},e.prototype.applyImpulse=function(a,b,c){var d=a.physicsBody.mass;a.physicsBody.applyImpulse(c.scale(this.world.invScale),b.scale(this.world.invScale*d))},e.prototype.applyForce=function(a,b,c){r.a.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(a,b,c)},e.prototype.generatePhysicsBody=function(a){var b=this;if(a.parent)a.physicsBody&&(this.removePhysicsBody(a),a.forceUpdate());else{if(a.isBodyInitRequired()){var c={name:a.uniqueId,config:[a.getParam("mass")||1,a.getParam("friction"),a.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:0!==a.getParam("mass"),density:a.getParam("mass"),friction:a.getParam("friction"),restitution:a.getParam("restitution"),world:this.world},d=[a];(i=a.object).getChildMeshes&&i.getChildMeshes().forEach(function(k){k.physicsImpostor&&d.push(k.physicsImpostor)});var f=function(k){return Math.max(k,Pc.Epsilon)},h=new j.q();d.forEach(function(k){if(k.object.rotationQuaternion){var m=k.object.rotationQuaternion;h=m.clone();var B=m.toEulerAngles(),E=k.getObjectExtendSize();if(k===a){var K=a.getObjectCenter();a.object.getAbsolutePivotPoint().subtractToRef(K,b._tmpPositionVector),b._tmpPositionVector.divideInPlace(a.object.scaling),c.pos.push(K.x),c.pos.push(K.y),c.pos.push(K.z),c.posShape.push(0,0,0),c.rotShape.push(0,0,0)}else{var P=k.object.getAbsolutePosition().subtract(a.object.getAbsolutePosition());c.posShape.push(P.x),c.posShape.push(P.y),c.posShape.push(P.z),c.pos.push(0,0,0),c.rotShape.push(57.29577951308232*B.x),c.rotShape.push(57.29577951308232*B.y),c.rotShape.push(57.29577951308232*B.z)}switch(k.type){case pb.a.ParticleImpostor:r.a.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case pb.a.SphereImpostor:var S=E.x,U=E.y,_=E.z,da=Math.max(f(S),f(U),f(_))/2;c.type.push("sphere"),c.size.push(da),c.size.push(da),c.size.push(da);break;case pb.a.CylinderImpostor:var fa=f(E.x)/2,ga=f(E.y);c.type.push("cylinder"),c.size.push(fa),c.size.push(ga),c.size.push(ga);break;case pb.a.PlaneImpostor:case pb.a.BoxImpostor:default:fa=f(E.x),ga=f(E.y);var ha=f(E.z);c.type.push("box"),c.size.push(fa),c.size.push(ga),c.size.push(ha)}k.object.rotationQuaternion=m}}),a.physicsBody=this.world.add(c),a.physicsBody.resetQuaternion(h),a.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);var i;a.setDeltaPosition(this._tmpPositionVector)}},e.prototype.removePhysicsBody=function(a){this.world.removeRigidBody(a.physicsBody)},e.prototype.generateJoint=function(a){var b=a.mainImpostor.physicsBody,c=a.connectedImpostor.physicsBody;if(b&&c){var d,f=a.joint.jointData,h=f.nativeParams||{},i={body1:b,body2:c,axe1:h.axe1||(f.mainAxis?f.mainAxis.asArray():null),axe2:h.axe2||(f.connectedAxis?f.connectedAxis.asArray():null),pos1:h.pos1||(f.mainPivot?f.mainPivot.asArray():null),pos2:h.pos2||(f.connectedPivot?f.connectedPivot.asArray():null),min:h.min,max:h.max,collision:h.collision||f.collision,spring:h.spring,world:this.world};switch(a.joint.type){case vb.e.BallAndSocketJoint:d="jointBall";break;case vb.e.SpringJoint:r.a.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var k=f;i.min=k.length||i.min,i.max=Math.max(i.min,i.max);case vb.e.DistanceJoint:d="jointDistance",i.max=f.maxDistance;break;case vb.e.PrismaticJoint:d="jointPrisme";break;case vb.e.SliderJoint:d="jointSlide";break;case vb.e.WheelJoint:d="jointWheel";break;case vb.e.HingeJoint:default:d="jointHinge"}i.type=d,a.joint.physicsJoint=this.world.add(i)}},e.prototype.removeJoint=function(a){try{this.world.removeJoint(a.joint.physicsJoint)}catch(b){r.a.Warn(b)}},e.prototype.isSupported=function(){return void 0!==this.BJSOIMO},e.prototype.setTransformationFromPhysicsBody=function(a){a.physicsBody.sleeping||(a.object.position.copyFrom(a.physicsBody.getPosition()),a.object.rotationQuaternion&&a.object.rotationQuaternion.copyFrom(a.physicsBody.getQuaternion()))},e.prototype.setPhysicsBodyTransformation=function(a,b,c){var d=a.physicsBody;d.position.copy(b),d.orientation.copy(c),d.syncShapes(),d.awake()},e.prototype.setLinearVelocity=function(a,b){a.physicsBody.linearVelocity.copy(b)},e.prototype.setAngularVelocity=function(a,b){a.physicsBody.angularVelocity.copy(b)},e.prototype.getLinearVelocity=function(a){var b=a.physicsBody.linearVelocity;return b?new j.x(b.x,b.y,b.z):null},e.prototype.getAngularVelocity=function(a){var b=a.physicsBody.angularVelocity;return b?new j.x(b.x,b.y,b.z):null},e.prototype.setBodyMass=function(a,b){var c=0===b;a.physicsBody.shapes.density=c?1:b,a.physicsBody.setupMass(c?2:1)},e.prototype.getBodyMass=function(a){return a.physicsBody.shapes.density},e.prototype.getBodyFriction=function(a){return a.physicsBody.shapes.friction},e.prototype.setBodyFriction=function(a,b){a.physicsBody.shapes.friction=b},e.prototype.getBodyRestitution=function(a){return a.physicsBody.shapes.restitution},e.prototype.setBodyRestitution=function(a,b){a.physicsBody.shapes.restitution=b},e.prototype.sleepBody=function(a){a.physicsBody.sleep()},e.prototype.wakeUpBody=function(a){a.physicsBody.awake()},e.prototype.updateDistanceJoint=function(a,b,c){a.physicsJoint.limitMotor.upperLimit=b,void 0!==c&&(a.physicsJoint.limitMotor.lowerLimit=c)},e.prototype.setMotor=function(a,b,c,d){void 0!==c?r.a.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):c=1e06,b*=-1;var f=d?a.physicsJoint.rotationalLimitMotor2:a.physicsJoint.rotationalLimitMotor1||a.physicsJoint.rotationalLimitMotor||a.physicsJoint.limitMotor;f&&f.setMotor(b,c)},e.prototype.setLimit=function(a,b,c,d){var f=d?a.physicsJoint.rotationalLimitMotor2:a.physicsJoint.rotationalLimitMotor1||a.physicsJoint.rotationalLimitMotor||a.physicsJoint.limitMotor;f&&f.setLimit(b,void 0===c?-b:c)},e.prototype.syncMeshWithImpostor=function(a,b){var c=b.physicsBody;a.position.x=c.position.x,a.position.y=c.position.y,a.position.z=c.position.z,a.rotationQuaternion&&(a.rotationQuaternion.x=c.orientation.x,a.rotationQuaternion.y=c.orientation.y,a.rotationQuaternion.z=c.orientation.z,a.rotationQuaternion.w=c.orientation.s)},e.prototype.getRadius=function(a){return a.physicsBody.shapes.radius},e.prototype.getBoxSizeToRef=function(a,b){var c=a.physicsBody.shapes;b.x=2*c.halfWidth,b.y=2*c.halfHeight,b.z=2*c.halfDepth},e.prototype.dispose=function(){this.world.clear()},e.prototype.raycast=function(a,b){return r.a.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(a,b),this._raycastResult},e}();Wa.a.CreateRibbon=function(e){var a=e.pathArray,b=e.closeArray||!1,c=e.closePath||!1,d=e.invertUV||!1,f=Math.floor(a[0].length/2),h=e.offset||f;h=h>f?f:Math.floor(h);var i,k,m,B,E=0===e.sideOrientation?0:e.sideOrientation||Wa.a.DEFAULTSIDE,K=e.uvs,P=e.colors,S=[],U=[],_=[],da=[],fa=[],ga=[],ha=[],ka=[],la=[],ma=[];if(a.length<2){var ta=[],pa=[];for(m=0;m<a[0].length-h;m++)ta.push(a[0][m]),pa.push(a[0][m+h]);a=[ta,pa]}var ua,wa,ya,Da,Ja,Na=0,Ma=c?1:0;for(i=a[0].length,k=0;k<a.length;k++){for(ha[k]=0,fa[k]=[0],i=i<(wa=(ua=a[k]).length)?i:wa,B=0;B<wa;)S.push(ua[B].x,ua[B].y,ua[B].z),B>0&&(ya=ua[B].subtract(ua[B-1]).length()+ha[k],fa[k].push(ya),ha[k]=ya),B++;c&&(B--,S.push(ua[0].x,ua[0].y,ua[0].z),ya=ua[B].subtract(ua[0]).length()+ha[k],fa[k].push(ya),ha[k]=ya),la[k]=wa+Ma,ma[k]=Na,Na+=wa+Ma}var Ha,Qa,cb=null,La=null;for(m=0;m<i+Ma;m++){for(ka[m]=0,ga[m]=[0],k=0;k<a.length-1;k++)Da=a[k],Ja=a[k+1],m===i?(cb=Da[0],La=Ja[0]):(cb=Da[m],La=Ja[m]),ya=La.subtract(cb).length()+ka[m],ga[m].push(ya),ka[m]=ya;b&&La&&cb&&(Da=a[k],Ja=a[0],m===i&&(La=Ja[0]),ya=La.subtract(cb).length()+ka[m],ka[m]=ya)}if(K)for(k=0;k<K.length;k++)da.push(K[k].x,K[k].y);else for(k=0;k<a.length;k++)for(m=0;m<i+Ma;m++)Ha=0!=ha[k]?fa[k][m]/ha[k]:0,Qa=0!=ka[m]?ga[m][k]/ka[m]:0,d?da.push(Qa,Ha):da.push(Ha,Qa);for(var Oa=0,Ya=la[k=0]-1,Ua=la[k+1]-1,_a=Ya<Ua?Ya:Ua,db=ma[1]-ma[0],ub=b?la.length:la.length-1;Oa<=_a&&k<ub;)U.push(Oa,Oa+db,Oa+1),U.push(Oa+db+1,Oa+1,Oa+db),(Oa+=1)===_a&&(++k===la.length-1?(db=ma[0]-ma[k],Ya=la[k]-1,Ua=la[0]-1):(db=ma[k+1]-ma[k],Ya=la[k]-1,Ua=la[k+1]-1),Oa=ma[k],_a=Ya<Ua?Ya+Oa:Ua+Oa);if(Wa.a.ComputeNormals(S,U,_),c){var eb=0,Va=0;for(k=0;k<a.length;k++)eb=3*ma[k],Va=k+1<a.length?3*(ma[k+1]-1):_.length-3,_[eb]=.5*(_[eb]+_[Va]),_[eb+1]=.5*(_[eb+1]+_[Va+1]),_[eb+2]=.5*(_[eb+2]+_[Va+2]),_[Va]=_[eb],_[Va+1]=_[eb+1],_[Va+2]=_[eb+2]}Wa.a._ComputeSides(E,S,U,_,da,e.frontUVs,e.backUVs);var zb=null;if(P){zb=new Float32Array(4*P.length);for(var mb=0;mb<P.length;mb++)zb[4*mb]=P[mb].r,zb[4*mb+1]=P[mb].g,zb[4*mb+2]=P[mb].b,zb[4*mb+3]=P[mb].a}var ib=new Wa.a(),xb=new Float32Array(S),$a=new Float32Array(_),Bb=new Float32Array(da);return ib.indices=U,ib.positions=xb,ib.normals=$a,ib.uvs=Bb,zb&&ib.set(zb,na.b.ColorKind),c&&(ib._idx=ma),ib},Ca.a.CreateRibbon=function(e,a,b,c,d,f,h,i,k){return void 0===b&&(b=!1),void 0===h&&(h=!1),Ec.CreateRibbon(e,{pathArray:a,closeArray:b,closePath:c,offset:d,updatable:h,sideOrientation:i,instance:k},f)};var Ec=function(){function e(){}return e.CreateRibbon=function(a,b,c){void 0===c&&(c=null);var d=b.pathArray,f=b.closeArray,h=b.closePath,i=Ca.a._GetDefaultSideOrientation(b.sideOrientation),k=b.instance,m=b.updatable;if(k){var B=j.t.Vector3[0].setAll(Number.MAX_VALUE),E=j.t.Vector3[1].setAll(-Number.MAX_VALUE),K=k.getVerticesData(na.b.PositionKind);if(function(wa){for(var ya=d[0].length,Da=k,Ja=0,Na=Da._originalBuilderSideOrientation===Ca.a.DOUBLESIDE?2:1,Ma=1;Ma<=Na;++Ma)for(var Ha=0;Ha<d.length;++Ha){var Qa=d[Ha],cb=Qa.length;ya=ya<cb?ya:cb;for(var La=0;La<ya;++La){var Oa=Qa[La];wa[Ja]=Oa.x,wa[Ja+1]=Oa.y,wa[Ja+2]=Oa.z,B.minimizeInPlaceFromFloats(Oa.x,Oa.y,Oa.z),E.maximizeInPlaceFromFloats(Oa.x,Oa.y,Oa.z),Ja+=3}Da._creationDataStorage&&Da._creationDataStorage.closePath&&(Oa=Qa[0],wa[Ja]=Oa.x,wa[Ja+1]=Oa.y,wa[Ja+2]=Oa.z,Ja+=3)}}(K),k._boundingInfo?k._boundingInfo.reConstruct(B,E,k._worldMatrix):k._boundingInfo=new Kc.a(B,E,k._worldMatrix),k.updateVerticesData(na.b.PositionKind,K,!1,!1),b.colors){for(var P=k.getVerticesData(na.b.ColorKind),S=0,U=0;S<b.colors.length;S++,U+=4){var _=b.colors[S];P[U]=_.r,P[U+1]=_.g,P[U+2]=_.b,P[U+3]=_.a}k.updateVerticesData(na.b.ColorKind,P,!1,!1)}if(b.uvs){for(var da=k.getVerticesData(na.b.UVKind),fa=0;fa<b.uvs.length;fa++)da[2*fa]=b.uvs[fa].x,da[2*fa+1]=b.uvs[fa].y;k.updateVerticesData(na.b.UVKind,da,!1,!1)}if(!k.areNormalsFrozen||k.isFacetDataEnabled){var ga=k.getIndices(),ha=k.getVerticesData(na.b.NormalKind),ka=k.isFacetDataEnabled?k.getFacetDataParameters():null;if(Wa.a.ComputeNormals(K,ga,ha,ka),k._creationDataStorage&&k._creationDataStorage.closePath)for(var la=0,ma=0,ta=0;ta<d.length;ta++)la=3*k._creationDataStorage.idx[ta],ma=ta+1<d.length?3*(k._creationDataStorage.idx[ta+1]-1):ha.length-3,ha[la]=.5*(ha[la]+ha[ma]),ha[la+1]=.5*(ha[la+1]+ha[ma+1]),ha[la+2]=.5*(ha[la+2]+ha[ma+2]),ha[ma]=ha[la],ha[ma+1]=ha[la+1],ha[ma+2]=ha[la+2];k.areNormalsFrozen||k.updateVerticesData(na.b.NormalKind,ha,!1,!1)}return k}var pa=new Ca.a(a,c);pa._originalBuilderSideOrientation=i,pa._creationDataStorage=new Ca.b();var ua=Wa.a.CreateRibbon(b);return h&&(pa._creationDataStorage.idx=ua._idx),pa._creationDataStorage.closePath=h,pa._creationDataStorage.closeArray=f,ua.applyToMesh(pa,m),pa},e}();Ca.a.ExtrudeShape=function(e,a,b,c,d,f,h,i,k,m){void 0===h&&(h=null);var B={shape:a,path:b,scale:c,rotation:d,cap:0===f?0:f||Ca.a.NO_CAP,sideOrientation:k,instance:m,updatable:i};return Qc.ExtrudeShape(e,B,h)},Ca.a.ExtrudeShapeCustom=function(e,a,b,c,d,f,h,i,k,m,B,E){var K={shape:a,path:b,scaleFunction:c,rotationFunction:d,ribbonCloseArray:f,ribbonClosePath:h,cap:0===i?0:i||Ca.a.NO_CAP,sideOrientation:B,instance:E,updatable:m};return Qc.ExtrudeShapeCustom(e,K,k)};var Qc=function(){function e(){}return e.ExtrudeShape=function(a,b,c){void 0===c&&(c=null);var d=b.path,f=b.shape,h=b.scale||1,i=b.rotation||0,k=0===b.cap?0:b.cap||Ca.a.NO_CAP,m=b.updatable,B=Ca.a._GetDefaultSideOrientation(b.sideOrientation),E=b.instance||null,K=b.invertUV||!1;return e._ExtrudeShapeGeneric(a,f,d,h,i,null,null,!1,!1,k,!1,c,!!m,B,E,K,b.frontUVs||null,b.backUVs||null)},e.ExtrudeShapeCustom=function(a,b,c){void 0===c&&(c=null);var d=b.path,f=b.shape,h=b.scaleFunction||function(){return 1},i=b.rotationFunction||function(){return 0},k=b.ribbonCloseArray||!1,m=b.ribbonClosePath||!1,B=0===b.cap?0:b.cap||Ca.a.NO_CAP,E=b.updatable,K=Ca.a._GetDefaultSideOrientation(b.sideOrientation),P=b.instance,S=b.invertUV||!1;return e._ExtrudeShapeGeneric(a,f,d,null,null,h,i,k,m,B,!0,c,!!E,K,P||null,S,b.frontUVs||null,b.backUVs||null)},e._ExtrudeShapeGeneric=function(a,b,c,d,f,h,i,k,m,B,E,K,P,S,U,_,da,fa){var ga,ha,ka=function(ta,pa,ua,wa,ya,Da,Ja,Na,Ma,Ha){for(var Qa=ua.getTangents(),cb=ua.getNormals(),La=ua.getBinormals(),Oa=ua.getDistances(),Ya=0,Ua=Ha&&Na?Na:function(){return null!==Da?Da:0},_a=Ha&&Ja?Ja:function(){return null!==ya?ya:1},db=Ma===Ca.a.NO_CAP||Ma===Ca.a.CAP_END?0:2,ub=j.t.Matrix[0],eb=0;eb<pa.length;eb++){for(var Va=new Array(),zb=Ua(eb,Oa[eb]),mb=_a(eb,Oa[eb]),ib=0;ib<ta.length;ib++){j.j.RotationAxisToRef(Qa[eb],Ya,ub);var xb=Qa[eb].scale(ta[ib].z).add(cb[eb].scale(ta[ib].x)).add(La[eb].scale(ta[ib].y)),$a=Va[ib]?Va[ib]:j.x.Zero();j.x.TransformCoordinatesToRef(xb,ub,$a),$a.scaleInPlace(mb).addInPlace(pa[eb]),Va[ib]=$a}wa[db]=Va,Ya+=zb,db++}var Bb=function(Rb){var Fb,Yb=Array(),Sb=j.x.Zero();for(Fb=0;Fb<Rb.length;Fb++)Sb.addInPlace(Rb[Fb]);for(Sb.scaleInPlace(1/Rb.length),Fb=0;Fb<Rb.length;Fb++)Yb.push(Sb);return Yb};switch(Ma){case Ca.a.NO_CAP:break;case Ca.a.CAP_START:wa[0]=Bb(wa[2]),wa[1]=wa[2];break;case Ca.a.CAP_END:wa[db]=wa[db-1],wa[db+1]=Bb(wa[db-1]);break;case Ca.a.CAP_ALL:wa[0]=Bb(wa[2]),wa[1]=wa[2],wa[db]=wa[db-1],wa[db+1]=Bb(wa[db-1])}return wa};if(U){var la=U._creationDataStorage;return ga=la.path3D.update(c),ha=ka(b,c,la.path3D,la.pathArray,d,f,h,i,la.cap,E),U=Ca.a.CreateRibbon("",ha,!1,!1,0,K||void 0,!1,0,U)}ha=ka(b,c,ga=new j.m(c),new Array(),d,f,h,i,B=B<0||B>3?0:B,E);var ma=Ec.CreateRibbon(a,{pathArray:ha,closeArray:k,closePath:m,updatable:P,sideOrientation:S,invertUV:_,frontUVs:da||void 0,backUVs:fa||void 0},K);return ma._creationDataStorage.pathArray=ha,ma._creationDataStorage.path3D=ga,ma._creationDataStorage.cap=B,ma},e}(),rh=function(){function e(a,b){var c=this;void 0===a&&(a=!0),void 0===b&&(b=Ammo),this._useDeltaForWorldStep=a,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new j.q(),this._tmpContactCallbackResult=!1,this._tmpVector=new j.x(),this._tmpMatrix=new j.j(),"function"==typeof b?b(this.bjsAMMO):this.bjsAMMO=b,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration(),this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=new this.bjsAMMO.btDbvtBroadphase(),this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver(),this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver(),this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback(),this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(){c._tmpContactCallbackResult=!0},this._raycastResult=new gf(),this._tmpAmmoTransform=new this.bjsAMMO.btTransform(),this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):r.a.Error("AmmoJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(a){this._tmpAmmoVectorA.setValue(a.x,a.y,a.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)},e.prototype.setTimeStep=function(a){this._timeStep=a},e.prototype.setFixedTimeStep=function(a){this._fixedTimeStep=a},e.prototype.setMaxSteps=function(a){this._maxSteps=a},e.prototype.getTimeStep=function(){return this._timeStep},e.prototype._isImpostorInContact=function(a){return this._tmpContactCallbackResult=!1,this.world.contactTest(a.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},e.prototype._isImpostorPairInContact=function(a,b){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(a.physicsBody,b.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},e.prototype._stepSimulation=function(a,b,c){if(void 0===a&&(a=1/60),void 0===b&&(b=10),void 0===c&&(c=1/60),0==b)this.world.stepSimulation(a,0);else for(;b>0&&a>0;)a-c<c?(this.world.stepSimulation(a,0),a=0):(a-=c,this.world.stepSimulation(c,0)),b--},e.prototype.executeStep=function(a,b){for(var c=0,d=b;c<d.length;c++){var f=d[c];f.soft||f.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?a:this._timeStep,this._maxSteps,this._fixedTimeStep);for(var h=0,i=b;h<i.length;h++){var k=i[h];if(k.soft?this._afterSoftStep(k):k.afterStep(),k._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(k))for(var m=0,B=k._onPhysicsCollideCallbacks;m<B.length;m++)for(var E=0,K=B[m].otherImpostors;E<K.length;E++){var P=K[E];(k.physicsBody.isActive()||P.physicsBody.isActive())&&this._isImpostorPairInContact(k,P)&&(k.onCollide({body:P.physicsBody}),P.onCollide({body:k.physicsBody}))}}},e.prototype._afterSoftStep=function(a){a.type===pb.a.RopeImpostor?this._ropeStep(a):this._softbodyOrClothStep(a)},e.prototype._ropeStep=function(a){for(var b,c,d,f,h=a.physicsBody.get_m_nodes(),i=h.size(),k=new Array(),m=0;m<i;m++)c=(b=h.at(m).get_m_x()).x(),d=b.y(),f=b.z(),k.push(new j.x(c,d,f));var B=a.object,E=a.getParam("shape");a._isFromLine?a.object=Kb.a.CreateLines("lines",{points:k,instance:B}):a.object=Qc.ExtrudeShape("ext",{shape:E,path:k,instance:B})},e.prototype._softbodyOrClothStep=function(a){var b=a.type===pb.a.ClothImpostor?1:-1,c=a.object,d=c.getVerticesData(na.b.PositionKind);d||(d=[]);var f=c.getVerticesData(na.b.NormalKind);f||(f=[]);for(var h,i,k,m,B,E,K,P,S=d.length/3,U=a.physicsBody.get_m_nodes(),_=0;_<S;_++){var da;k=(i=(h=U.at(_)).get_m_x()).x(),m=i.y(),B=i.z()*b,E=(da=h.get_m_n()).x(),K=da.y(),P=da.z()*b,d[3*_]=k,d[3*_+1]=m,d[3*_+2]=B,f[3*_]=E,f[3*_+1]=K,f[3*_+2]=P}var fa=new Wa.a();fa.positions=d,fa.normals=f,fa.uvs=c.getVerticesData(na.b.UVKind),fa.colors=c.getVerticesData(na.b.ColorKind),c&&c.getIndices&&(fa.indices=c.getIndices()),fa.applyToMesh(c)},e.prototype.applyImpulse=function(a,b,c){if(a.soft)r.a.Warn("Cannot be applied to a soft body");else{a.physicsBody.activate();var d=this._tmpAmmoVectorA,f=this._tmpAmmoVectorB;a.object&&a.object.getWorldMatrix&&(a.object.getWorldMatrix().invertToRef(this._tmpMatrix),j.x.TransformCoordinatesToRef(c,this._tmpMatrix,this._tmpVector),c=this._tmpVector),d.setValue(c.x,c.y,c.z),f.setValue(b.x,b.y,b.z),a.physicsBody.applyImpulse(f,d)}},e.prototype.applyForce=function(a,b,c){if(a.soft)r.a.Warn("Cannot be applied to a soft body");else{a.physicsBody.activate();var d=this._tmpAmmoVectorA,f=this._tmpAmmoVectorB;a.object&&a.object.getWorldMatrix&&(a.object.getWorldMatrix().invertToRef(this._tmpMatrix),j.x.TransformCoordinatesToRef(c,this._tmpMatrix,this._tmpVector),c=this._tmpVector),d.setValue(c.x,c.y,c.z),f.setValue(b.x,b.y,b.z),a.physicsBody.applyForce(f,d)}},e.prototype.generatePhysicsBody=function(a){if(a._pluginData.toDispose=[],a.parent)a.physicsBody&&(this.removePhysicsBody(a),a.forceUpdate());else if(a.isBodyInitRequired()){var b=this._createShape(a),c=a.getParam("mass");if(a._pluginData.mass=c,a.soft)b.get_m_cfg().set_collisions(17),b.get_m_cfg().set_kDP(a.getParam("damping")),Ammo.castObject(b,Ammo.btCollisionObject).getCollisionShape().setMargin(a.getParam("margin")),b.setActivationState(e.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(b,1,-1),a.physicsBody=b,a._pluginData.toDispose.push(b),this.setBodyPressure(a,0),a.type===pb.a.SoftbodyImpostor&&this.setBodyPressure(a,a.getParam("pressure")),this.setBodyStiffness(a,a.getParam("stiffness")),this.setBodyVelocityIterations(a,a.getParam("velocityIterations")),this.setBodyPositionIterations(a,a.getParam("positionIterations"));else{var d=new Ammo.btVector3(0,0,0),f=new Ammo.btTransform();f.setIdentity(),0!==c&&b.calculateLocalInertia(c,d),this._tmpAmmoVectorA.setValue(a.object.position.x,a.object.position.y,a.object.position.z),this._tmpAmmoQuaternion.setValue(a.object.rotationQuaternion.x,a.object.rotationQuaternion.y,a.object.rotationQuaternion.z,a.object.rotationQuaternion.w),f.setOrigin(this._tmpAmmoVectorA),f.setRotation(this._tmpAmmoQuaternion);var h=new Ammo.btDefaultMotionState(f),i=new Ammo.btRigidBodyConstructionInfo(c,h,b,d),k=new Ammo.btRigidBody(i);0===c&&(k.setCollisionFlags(k.getCollisionFlags()|e.KINEMATIC_FLAG),k.setActivationState(e.DISABLE_DEACTIVATION_FLAG)),a.type!=pb.a.NoImpostor||b.getChildShape||k.setCollisionFlags(k.getCollisionFlags()|e.DISABLE_COLLISION_FLAG),this.world.addRigidBody(k),a.physicsBody=k,a._pluginData.toDispose=a._pluginData.toDispose.concat([k,i,h,f,d,b])}this.setBodyRestitution(a,a.getParam("restitution")),this.setBodyFriction(a,a.getParam("friction"))}},e.prototype.removePhysicsBody=function(a){var b=this;this.world&&(this.world.removeRigidBody(a.physicsBody),a._pluginData&&a._pluginData.toDispose.forEach(function(c){b.bjsAMMO.destroy(c)}))},e.prototype.generateJoint=function(a){var b=a.mainImpostor.physicsBody,c=a.connectedImpostor.physicsBody;if(b&&c){var d,f=a.joint.jointData;switch(f.mainPivot||(f.mainPivot=new j.x(0,0,0)),f.connectedPivot||(f.connectedPivot=new j.x(0,0,0)),a.joint.type){case vb.e.DistanceJoint:var h=f.maxDistance;h&&(f.mainPivot=new j.x(0,-h/2,0),f.connectedPivot=new j.x(0,h/2,0)),d=new Ammo.btPoint2PointConstraint(b,c,new Ammo.btVector3(f.mainPivot.x,f.mainPivot.y,f.mainPivot.z),new Ammo.btVector3(f.connectedPivot.x,f.connectedPivot.y,f.connectedPivot.z));break;case vb.e.HingeJoint:f.mainAxis||(f.mainAxis=new j.x(0,0,0)),f.connectedAxis||(f.connectedAxis=new j.x(0,0,0));var i=new Ammo.btVector3(f.mainAxis.x,f.mainAxis.y,f.mainAxis.z),k=new Ammo.btVector3(f.connectedAxis.x,f.connectedAxis.y,f.connectedAxis.z);d=new Ammo.btHingeConstraint(b,c,new Ammo.btVector3(f.mainPivot.x,f.mainPivot.y,f.mainPivot.z),new Ammo.btVector3(f.connectedPivot.x,f.connectedPivot.y,f.connectedPivot.z),i,k);break;case vb.e.BallAndSocketJoint:d=new Ammo.btPoint2PointConstraint(b,c,new Ammo.btVector3(f.mainPivot.x,f.mainPivot.y,f.mainPivot.z),new Ammo.btVector3(f.connectedPivot.x,f.connectedPivot.y,f.connectedPivot.z));break;default:r.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),d=new Ammo.btPoint2PointConstraint(b,c,new Ammo.btVector3(f.mainPivot.x,f.mainPivot.y,f.mainPivot.z),new Ammo.btVector3(f.connectedPivot.x,f.connectedPivot.y,f.connectedPivot.z))}this.world.addConstraint(d,!a.joint.jointData.collision),a.joint.physicsJoint=d}},e.prototype.removeJoint=function(a){this.world&&this.world.removeConstraint(a.joint.physicsJoint)},e.prototype._addMeshVerts=function(a,b,c){var d=this,f=0;if(c&&c.getIndices&&c.getWorldMatrix&&c.getChildMeshes){var h=c.getIndices();h||(h=[]);var i=c.getVerticesData(na.b.PositionKind);i||(i=[]),c.computeWorldMatrix(!1);for(var k=h.length/3,m=0;m<k;m++){for(var B=[],E=0;E<3;E++){var K,P=new j.x(i[3*h[3*m+E]+0],i[3*h[3*m+E]+1],i[3*h[3*m+E]+2]);j.j.ScalingToRef(c.scaling.x,c.scaling.y,c.scaling.z,this._tmpMatrix),P=j.x.TransformCoordinates(P,this._tmpMatrix),(K=0==E?this._tmpAmmoVectorA:1==E?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(P.x,P.y,P.z),B.push(K)}a.addTriangle(B[0],B[1],B[2]),f++}c.getChildMeshes().forEach(function(S){f+=d._addMeshVerts(a,b,S)})}return f},e.prototype._softVertexData=function(a){var b=a.object;if(b&&b.getIndices&&b.getWorldMatrix&&b.getChildMeshes){var c=b.getIndices();c||(c=[]);var d=b.getVerticesData(na.b.PositionKind);d||(d=[]);var f=b.getVerticesData(na.b.NormalKind);f||(f=[]),b.computeWorldMatrix(!1);for(var h=[],i=[],k=0;k<d.length;k+=3){var m=new j.x(d[k],d[k+1],d[k+2]),B=new j.x(f[k],f[k+1],f[k+2]);m=j.x.TransformCoordinates(m,b.getWorldMatrix()),B=j.x.TransformNormal(B,b.getWorldMatrix()),h.push(m.x,m.y,m.z),i.push(B.x,B.y,B.z)}var E=new Wa.a();return E.positions=h,E.normals=i,E.uvs=b.getVerticesData(na.b.UVKind),E.colors=b.getVerticesData(na.b.ColorKind),b&&b.getIndices&&(E.indices=b.getIndices()),E.applyToMesh(b),b.position=j.x.Zero(),b.rotationQuaternion=null,b.rotation=j.x.Zero(),b.computeWorldMatrix(!0),E}return Wa.a.ExtractFromMesh(b)},e.prototype._createSoftbody=function(a){var b=a.object;if(b&&b.getIndices){var c=b.getIndices();c||(c=[]);var d=this._softVertexData(a),f=d.positions,h=d.normals;if(null===f||null===h)return new Ammo.btCompoundShape();for(var i=[],k=[],m=0;m<f.length;m+=3){var B=new j.x(f[m],f[m+1],f[m+2]),E=new j.x(h[m],h[m+1],h[m+2]);i.push(B.x,B.y,-B.z),k.push(E.x,E.y,-E.z)}var K=new Ammo.btSoftBodyHelpers().CreateFromTriMesh(this.world.getWorldInfo(),i,b.getIndices(),c.length/3,!0),P=f.length/3,S=K.get_m_nodes();for(m=0;m<P;m++){var U;(U=S.at(m).get_m_n()).setX(k[3*m]),U.setY(k[3*m+1]),U.setZ(k[3*m+2])}return K}},e.prototype._createCloth=function(a){var b=a.object;if(b&&b.getIndices){var c=b.getIndices();c||(c=[]);var d=this._softVertexData(a),f=d.positions,h=d.normals;if(null===f||null===h)return new Ammo.btCompoundShape();var i=f.length,k=Math.sqrt(i/3);a.segments=k;var m=k-1;return this._tmpAmmoVectorA.setValue(f[0],f[1],f[2]),this._tmpAmmoVectorB.setValue(f[3*m],f[3*m+1],f[3*m+2]),this._tmpAmmoVectorD.setValue(f[i-3],f[i-2],f[i-1]),this._tmpAmmoVectorC.setValue(f[i-3-3*m],f[i-2-3*m],f[i-1-3*m]),new Ammo.btSoftBodyHelpers().CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,k,k,a.getParam("fixedPoints"),!0)}},e.prototype._createRope=function(a){var b,c,d=this._softVertexData(a),f=d.positions,h=d.normals;if(null===f||null===h)return new Ammo.btCompoundShape();d.applyToMesh(a.object,!0),a._isFromLine=!0;if(0===h.map(function(B){return B*B}).reduce(function(B,E){return B+E}))c=(b=f.length)/3-1,this._tmpAmmoVectorA.setValue(f[0],f[1],f[2]),this._tmpAmmoVectorB.setValue(f[b-3],f[b-2],f[b-1]);else{a._isFromLine=!1;var i=a.getParam("path");if(null===a.getParam("shape"))return r.a.Warn("No shape available for extruded mesh"),new Ammo.btCompoundShape();if(f.length%(3*i.length)!=0)return r.a.Warn("Path does not match extrusion"),new Ammo.btCompoundShape();c=(b=i.length)-1,this._tmpAmmoVectorA.setValue(i[0].x,i[0].y,i[0].z),this._tmpAmmoVectorB.setValue(i[b-1].x,i[b-1].y,i[b-1].z)}a.segments=c;var k=a.getParam("fixedPoints");k=k>3?3:k;var m=new Ammo.btSoftBodyHelpers().CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,c-1,k);return m.get_m_cfg().set_collisions(17),m},e.prototype._addHullVerts=function(a,b,c){var d=this,f=0;if(c&&c.getIndices&&c.getWorldMatrix&&c.getChildMeshes){var h=c.getIndices();h||(h=[]);var i=c.getVerticesData(na.b.PositionKind);i||(i=[]),c.computeWorldMatrix(!1);for(var k=h.length/3,m=0;m<k;m++){for(var B=[],E=0;E<3;E++){var K,P=new j.x(i[3*h[3*m+E]+0],i[3*h[3*m+E]+1],i[3*h[3*m+E]+2]);j.j.ScalingToRef(c.scaling.x,c.scaling.y,c.scaling.z,this._tmpMatrix),P=j.x.TransformCoordinates(P,this._tmpMatrix),(K=0==E?this._tmpAmmoVectorA:1==E?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(P.x,P.y,P.z),B.push(K)}a.addPoint(B[0],!0),a.addPoint(B[1],!0),a.addPoint(B[2],!0),f++}c.getChildMeshes().forEach(function(S){f+=d._addHullVerts(a,b,S)})}return f},e.prototype._createShape=function(a,b){var c=this;void 0===b&&(b=!1);var d,f=a.object,h=a.getObjectExtendSize();if(!b){var i=a.object.getChildMeshes?a.object.getChildMeshes(!0):[];d=new Ammo.btCompoundShape();var k=0;if(i.forEach(function(P){var S=P.getPhysicsImpostor();if(S){if(S.type==pb.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var U=c._createShape(S),_=P.parent.getWorldMatrix().clone(),da=new j.x();_.decompose(da),c._tmpAmmoTransform.getOrigin().setValue(P.position.x*da.x,P.position.y*da.y,P.position.z*da.z),c._tmpAmmoQuaternion.setValue(P.rotationQuaternion.x,P.rotationQuaternion.y,P.rotationQuaternion.z,P.rotationQuaternion.w),c._tmpAmmoTransform.setRotation(c._tmpAmmoQuaternion),d.addChildShape(c._tmpAmmoTransform,U),S.dispose(),k++}}),k>0){if(a.type!=pb.a.NoImpostor){var m=this._createShape(a,!0);m&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),d.addChildShape(this._tmpAmmoTransform,m))}return d}Ammo.destroy(d),d=null}switch(a.type){case pb.a.SphereImpostor:d=new Ammo.btSphereShape(h.x/2);break;case pb.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(h.x/2,h.y/2,h.z/2),d=new Ammo.btCylinderShape(this._tmpAmmoVectorA);break;case pb.a.PlaneImpostor:case pb.a.BoxImpostor:this._tmpAmmoVectorA.setValue(h.x/2,h.y/2,h.z/2),d=new Ammo.btBoxShape(this._tmpAmmoVectorA);break;case pb.a.MeshImpostor:if(0==a.getParam("mass")){var B=new Ammo.btTriangleMesh();a._pluginData.toDispose.push(B);var E=this._addMeshVerts(B,f,f);d=0==E?new Ammo.btCompoundShape():new Ammo.btBvhTriangleMeshShape(B);break}case pb.a.ConvexHullImpostor:var K=new Ammo.btConvexHullShape();0==(E=this._addHullVerts(K,f,f))?(a._pluginData.toDispose.push(K),d=new Ammo.btCompoundShape()):d=K;break;case pb.a.NoImpostor:d=new Ammo.btSphereShape(h.x/2);break;case pb.a.SoftbodyImpostor:d=this._createSoftbody(a);break;case pb.a.ClothImpostor:d=this._createCloth(a);break;case pb.a.RopeImpostor:d=this._createRope(a);break;default:r.a.Warn("The impostor type is not currently supported by the ammo plugin.")}return d},e.prototype.setTransformationFromPhysicsBody=function(a){a.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),a.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),a.object.rotationQuaternion?a.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):a.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(a.object.rotation))},e.prototype.setPhysicsBodyTransformation=function(a,b,c){var d=a.physicsBody.getWorldTransform();if(d.getOrigin().x()!=b.x||d.getOrigin().y()!=b.y||d.getOrigin().z()!=b.z||d.getRotation().x()!=c.x||d.getRotation().y()!=c.y||d.getRotation().z()!=c.z||d.getRotation().w()!=c.w)if(this._tmpAmmoVectorA.setValue(b.x,b.y,b.z),d.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(c.x,c.y,c.z,c.w),d.setRotation(this._tmpAmmoQuaternion),a.physicsBody.setWorldTransform(d),0==a.mass){var f=a.physicsBody.getMotionState();f&&f.setWorldTransform(d)}else a.physicsBody.activate()},e.prototype.isSupported=function(){return void 0!==this.bjsAMMO},e.prototype.setLinearVelocity=function(a,b){this._tmpAmmoVectorA.setValue(b.x,b.y,b.z),a.soft?a.physicsBody.linearVelocity(this._tmpAmmoVectorA):a.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)},e.prototype.setAngularVelocity=function(a,b){this._tmpAmmoVectorA.setValue(b.x,b.y,b.z),a.soft?a.physicsBody.angularVelocity(this._tmpAmmoVectorA):a.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)},e.prototype.getLinearVelocity=function(a){if(a.soft)var b=a.physicsBody.linearVelocity();else b=a.physicsBody.getLinearVelocity();if(!b)return null;var c=new j.x(b.x(),b.y(),b.z());return Ammo.destroy(b),c},e.prototype.getAngularVelocity=function(a){if(a.soft)var b=a.physicsBody.angularVelocity();else b=a.physicsBody.getAngularVelocity();if(!b)return null;var c=new j.x(b.x(),b.y(),b.z());return Ammo.destroy(b),c},e.prototype.setBodyMass=function(a,b){a.soft?a.physicsBody.setTotalMass(b,!1):a.physicsBody.setMassProps(b),a._pluginData.mass=b},e.prototype.getBodyMass=function(a){return a._pluginData.mass||0},e.prototype.getBodyFriction=function(a){return a._pluginData.friction||0},e.prototype.setBodyFriction=function(a,b){a.soft?a.physicsBody.get_m_cfg().set_kDF(b):a.physicsBody.setFriction(b),a._pluginData.friction=b},e.prototype.getBodyRestitution=function(a){return a._pluginData.restitution||0},e.prototype.setBodyRestitution=function(a,b){a.physicsBody.setRestitution(b),a._pluginData.restitution=b},e.prototype.getBodyPressure=function(a){return a.soft?a._pluginData.pressure||0:(r.a.Warn("Pressure is not a property of a rigid body"),0)},e.prototype.setBodyPressure=function(a,b){a.soft?a.type===pb.a.SoftbodyImpostor?(a.physicsBody.get_m_cfg().set_kPR(b),a._pluginData.pressure=b):(a.physicsBody.get_m_cfg().set_kPR(0),a._pluginData.pressure=0):r.a.Warn("Pressure can only be applied to a softbody")},e.prototype.getBodyStiffness=function(a){return a.soft?a._pluginData.stiffness||0:(r.a.Warn("Stiffness is not a property of a rigid body"),0)},e.prototype.setBodyStiffness=function(a,b){a.soft?(b=(b=b<0?0:b)>1?1:b,a.physicsBody.get_m_materials().at(0).set_m_kLST(b),a._pluginData.stiffness=b):r.a.Warn("Stiffness cannot be applied to a rigid body")},e.prototype.getBodyVelocityIterations=function(a){return a.soft?a._pluginData.velocityIterations||0:(r.a.Warn("Velocity iterations is not a property of a rigid body"),0)},e.prototype.setBodyVelocityIterations=function(a,b){a.soft?(b=b<0?0:b,a.physicsBody.get_m_cfg().set_viterations(b),a._pluginData.velocityIterations=b):r.a.Warn("Velocity iterations cannot be applied to a rigid body")},e.prototype.getBodyPositionIterations=function(a){return a.soft?a._pluginData.positionIterations||0:(r.a.Warn("Position iterations is not a property of a rigid body"),0)},e.prototype.setBodyPositionIterations=function(a,b){a.soft?(b=b<0?0:b,a.physicsBody.get_m_cfg().set_piterations(b),a._pluginData.positionIterations=b):r.a.Warn("Position iterations cannot be applied to a rigid body")},e.prototype.appendAnchor=function(a,b,c,d,f,h){void 0===f&&(f=1),void 0===h&&(h=!1);var i=a.segments,k=Math.round((i-1)*c)+i*(i-1-Math.round((i-1)*d));a.physicsBody.appendAnchor(k,b.physicsBody,h,f)},e.prototype.appendHook=function(a,b,c,d,f){void 0===d&&(d=1),void 0===f&&(f=!1);var h=Math.round(a.segments*c);a.physicsBody.appendAnchor(h,b.physicsBody,f,d)},e.prototype.sleepBody=function(a){r.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")},e.prototype.wakeUpBody=function(a){a.physicsBody.activate()},e.prototype.updateDistanceJoint=function(a,b,c){r.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")},e.prototype.setMotor=function(a,b,c,d){a.physicsJoint.enableAngularMotor(!0,b,c)},e.prototype.setLimit=function(a,b,c){r.a.Warn("setLimit is not currently supported by the Ammo physics plugin")},e.prototype.syncMeshWithImpostor=function(a,b){b.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),a.position.x=this._tmpAmmoTransform.getOrigin().x(),a.position.y=this._tmpAmmoTransform.getOrigin().y(),a.position.z=this._tmpAmmoTransform.getOrigin().z(),a.rotationQuaternion&&(a.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),a.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),a.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),a.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())},e.prototype.getRadius=function(a){return a.getObjectExtendSize().x/2},e.prototype.getBoxSizeToRef=function(a,b){var c=a.getObjectExtendSize();b.x=c.x,b.y=c.y,b.z=c.z},e.prototype.dispose=function(){Ammo.destroy(this.world),Ammo.destroy(this._solver),Ammo.destroy(this._overlappingPairCache),Ammo.destroy(this._dispatcher),Ammo.destroy(this._collisionConfiguration),Ammo.destroy(this._tmpAmmoVectorA),Ammo.destroy(this._tmpAmmoVectorB),Ammo.destroy(this._tmpAmmoVectorC),Ammo.destroy(this._tmpAmmoTransform),Ammo.destroy(this._tmpAmmoQuaternion),Ammo.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null},e.prototype.raycast=function(a,b){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(a.x,a.y,a.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(b.x,b.y,b.z);var c=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,c),this._raycastResult.reset(a,b),c.hasHit()&&(this._raycastResult.setHitData({x:c.get_m_hitNormalWorld().x(),y:c.get_m_hitNormalWorld().y(),z:c.get_m_hitNormalWorld().z()},{x:c.get_m_hitPointWorld().x(),y:c.get_m_hitPointWorld().y(),z:c.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),Ammo.destroy(c),Ammo.destroy(this._tmpAmmoVectorRCA),Ammo.destroy(this._tmpAmmoVectorRCB),this._raycastResult},e.DISABLE_COLLISION_FLAG=4,e.KINEMATIC_FLAG=2,e.DISABLE_DEACTIVATION_FLAG=4,e}();O.a.prototype.removeReflectionProbe=function(e){if(!this.reflectionProbes)return-1;var a=this.reflectionProbes.indexOf(e);return-1!==a&&this.reflectionProbes.splice(a,1),a},O.a.prototype.addReflectionProbe=function(e){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(e)};var sh=function(){function e(a,b,c,d,f){var h=this;void 0===d&&(d=!0),void 0===f&&(f=!1),this.name=a,this._viewMatrix=j.j.Identity(),this._target=j.x.Zero(),this._add=j.x.Zero(),this._invertYAxis=!1,this.position=j.x.Zero(),this._scene=c,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array()),this._scene.reflectionProbes.push(this),this._renderTargetTexture=new Ab(a,b,c,d,!0,f?o.a.TEXTURETYPE_FLOAT:o.a.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(i){switch(i){case 0:h._add.copyFromFloats(1,0,0);break;case 1:h._add.copyFromFloats(-1,0,0);break;case 2:h._add.copyFromFloats(0,h._invertYAxis?1:-1,0);break;case 3:h._add.copyFromFloats(0,h._invertYAxis?-1:1,0);break;case 4:h._add.copyFromFloats(0,0,1);break;case 5:h._add.copyFromFloats(0,0,-1)}h._attachedMesh&&h.position.copyFrom(h._attachedMesh.getAbsolutePosition()),h.position.addToRef(h._add,h._target),j.j.LookAtLHToRef(h.position,h._target,j.x.Up(),h._viewMatrix),c.activeCamera&&(h._projectionMatrix=j.j.PerspectiveFovLH(Math.PI/2,1,c.activeCamera.minZ,c.activeCamera.maxZ),c.setTransformMatrix(h._viewMatrix,h._projectionMatrix)),c._forcedViewPosition=h.position}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){c._forcedViewPosition=null,c.updateTransformMatrix(!0)})}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(a){this._renderTargetTexture.samples=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(a){this._renderTargetTexture.refreshRate=a},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},Object.defineProperty(e.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),e.prototype.attachToMesh=function(a){this._attachedMesh=a},e.prototype.setRenderingAutoClearDepthStencil=function(a,b){this._renderTargetTexture.setRenderingAutoClearDepthStencil(a,b)},e.prototype.dispose=function(){var a=this._scene.reflectionProbes.indexOf(this);-1!==a&&this._scene.reflectionProbes.splice(a,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},e.prototype.toString=function(a){var b="Name: "+this.name;return a&&(b+=", position: "+this.position.toString(),this._attachedMesh&&(b+=", attached mesh: "+this._attachedMesh.name)),b},e.prototype.getClassName=function(){return"ReflectionProbe"},e.prototype.serialize=function(){var a=g.a.Serialize(this,this._renderTargetTexture.serialize());return a.isReflectionProbe=!0,a},e.Parse=function(a,b,c){var d=null;if(b.reflectionProbes)for(var f=0;f<b.reflectionProbes.length;f++){var h=b.reflectionProbes[f];if(h.name===a.name){d=h;break}}return(d=g.a.Parse(function(){return d||new e(a.name,a.renderTargetSize,b,a._generateMipMaps)},a,b,c)).cubeTexture._waitingRenderList=a.renderList,a._attachedMesh&&d.attachToMesh(b.getMeshByID(a._attachedMesh)),d},v.c([Object(g.k)()],e.prototype,"_attachedMesh",void 0),v.c([Object(g.o)()],e.prototype,"position",void 0),e}(),th=function(e,a,b,c){for(var d=0,f=a.materials.length;d<f;d++){var h=a.materials[d];if(h.id===e)return rb.a.Parse(h,b,c)}return null},Vj=function(e,a,b){for(var c in a)if(e.name===a[c])return b.push(e.id),!0;return!(!e.parentId||-1===b.indexOf(e.parentId))&&(b.push(e.id),!0)},Rc=function(e,a){return e+" of "+(a?a.file+" from "+a.name+" version: "+a.version+", exporter version: "+a.exporter_version:"unknown")},uh=function(e,a){var b=a;if(a._waitingData.lods){if(a._waitingData.lods.ids&&a._waitingData.lods.ids.length>0){var c=a._waitingData.lods.ids,d=b.isEnabled(!1);if(a._waitingData.lods.distances){var f=a._waitingData.lods.distances;if(f.length>=c.length){var h=f.length>c.length?f[f.length-1]:0;b.setEnabled(!1);for(var i=0;i<c.length;i++){var k=c[i],m=e.getMeshByID(k);null!=m&&b.addLODLevel(f[i],m)}h>0&&b.addLODLevel(h,null),!0===d&&b.setEnabled(!0)}else xa.h.Warn("Invalid level of detail distances for "+a.name)}}a._waitingData.lods=null}},vh=function(e,a,b,c,d){void 0===d&&(d=!1);var f=new dc(e),h="importScene has failed JSON parse";try{var i=JSON.parse(a);h="";var k,m,B=tb.loggingLevel===tb.DETAILED_LOGGING;if(void 0!==i.environmentTexture&&null!==i.environmentTexture){var E=void 0===i.isPBR||i.isPBR;if(i.environmentTextureType&&"BABYLON.HDRCubeTexture"===i.environmentTextureType){var K=i.environmentTextureSize?i.environmentTextureSize:128,P=new jd((i.environmentTexture.match(/https?:\/\//g)?"":b)+i.environmentTexture,e,K,!0,!E);i.environmentTextureRotationY&&(P.rotationY=i.environmentTextureRotationY),e.environmentTexture=P}else if(xa.h.EndsWith(i.environmentTexture,".env")){var S=new bc((i.environmentTexture.match(/https?:\/\//g)?"":b)+i.environmentTexture,e);i.environmentTextureRotationY&&(S.rotationY=i.environmentTextureRotationY),e.environmentTexture=S}else{var U=bc.CreateFromPrefilteredData((i.environmentTexture.match(/https?:\/\//g)?"":b)+i.environmentTexture,e);i.environmentTextureRotationY&&(U.rotationY=i.environmentTextureRotationY),e.environmentTexture=U}if(!0===i.createDefaultSkybox){var _=void 0!==e.activeCamera&&null!==e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1000,da=i.skyboxBlurLevel||0;e.createDefaultSkybox(e.environmentTexture,E,_,da)}f.environmentTexture=e.environmentTexture}if(void 0!==i.lights&&null!==i.lights)for(k=0,m=i.lights.length;k<m;k++){var fa=i.lights[k],ga=vc.a.Parse(fa,e);ga&&(f.lights.push(ga),h+=0===k?`
	Lights:`:"",h+=`
		`+ga.toString(B))}if(void 0!==i.reflectionProbes&&null!==i.reflectionProbes)for(k=0,m=i.reflectionProbes.length;k<m;k++){var ha=i.reflectionProbes[k],ka=sh.Parse(ha,e,b);ka&&(f.reflectionProbes.push(ka),h+=0===k?`
	Reflection Probes:`:"",h+=`
		`+ka.toString(B))}if(void 0!==i.animations&&null!==i.animations)for(k=0,m=i.animations.length;k<m;k++){var la=i.animations[k],ma=I.a.GetClass("BABYLON.Animation");if(ma){var ta=ma.Parse(la);e.animations.push(ta),f.animations.push(ta),h+=0===k?`
	Animations:`:"",h+=`
		`+ta.toString(B)}}if(void 0!==i.materials&&null!==i.materials)for(k=0,m=i.materials.length;k<m;k++){var pa=i.materials[k],ua=rb.a.Parse(pa,e,b);ua&&(f.materials.push(ua),h+=0===k?`
	Materials:`:"",h+=`
		`+ua.toString(B),ua.getActiveTextures().forEach(function(Gb){-1==f.textures.indexOf(Gb)&&f.textures.push(Gb)}))}if(void 0!==i.multiMaterials&&null!==i.multiMaterials)for(k=0,m=i.multiMaterials.length;k<m;k++){var wa=i.multiMaterials[k],ya=Sd.a.ParseMultiMaterial(wa,e);f.multiMaterials.push(ya),h+=0===k?`
	MultiMaterials:`:"",h+=`
		`+ya.toString(B),ya.getActiveTextures().forEach(function(Gb){-1==f.textures.indexOf(Gb)&&f.textures.push(Gb)})}if(void 0!==i.morphTargetManagers&&null!==i.morphTargetManagers)for(var Da=0,Ja=i.morphTargetManagers;Da<Ja.length;Da++){var Na=Ja[Da];f.morphTargetManagers.push(ff.Parse(Na,e))}if(void 0!==i.skeletons&&null!==i.skeletons)for(k=0,m=i.skeletons.length;k<m;k++){var Ma=i.skeletons[k],Ha=le.Parse(Ma,e);f.skeletons.push(Ha),h+=0===k?`
	Skeletons:`:"",h+=`
		`+Ha.toString(B)}var Qa=i.geometries;if(null!=Qa){var cb=new Array(),La=Qa.vertexData;if(null!=La)for(k=0,m=La.length;k<m;k++){var Oa=La[k];cb.push(df.a.Parse(Oa,e,b))}cb.forEach(function(Gb){Gb&&f.geometries.push(Gb)})}if(void 0!==i.transformNodes&&null!==i.transformNodes)for(k=0,m=i.transformNodes.length;k<m;k++){var Ya=i.transformNodes[k],Ua=Od.a.Parse(Ya,e,b);f.transformNodes.push(Ua)}if(void 0!==i.meshes&&null!==i.meshes)for(k=0,m=i.meshes.length;k<m;k++){var _a=i.meshes[k],db=Ca.a.Parse(_a,e,b);f.meshes.push(db),h+=0===k?`
	Meshes:`:"",h+=`
		`+db.toString(B)}if(void 0!==i.cameras&&null!==i.cameras)for(k=0,m=i.cameras.length;k<m;k++){var ub=i.cameras[k],eb=ab.a.Parse(ub,e);f.cameras.push(eb),h+=0===k?`
	Cameras:`:"",h+=`
		`+eb.toString(B)}if(void 0!==i.animationGroups&&null!==i.animationGroups)for(k=0,m=i.animationGroups.length;k<m;k++){var Va=i.animationGroups[k],zb=Sa.Parse(Va,e);f.animationGroups.push(zb),h+=0===k?`
	AnimationGroups:`:"",h+=`
		`+zb.toString(B)}for(k=0,m=e.cameras.length;k<m;k++)(eb=e.cameras[k])._waitingParentId&&(eb.parent=e.getLastEntryByID(eb._waitingParentId),eb._waitingParentId=null);for(k=0,m=e.lights.length;k<m;k++){var mb=e.lights[k];mb&&mb._waitingParentId&&(mb.parent=e.getLastEntryByID(mb._waitingParentId),mb._waitingParentId=null)}for(k=0,m=e.transformNodes.length;k<m;k++){var ib=e.transformNodes[k];ib._waitingParentId&&(ib.parent=e.getLastEntryByID(ib._waitingParentId),ib._waitingParentId=null)}for(k=0,m=e.meshes.length;k<m;k++)(db=e.meshes[k])._waitingParentId&&(db.parent=e.getLastEntryByID(db._waitingParentId),db._waitingParentId=null),db._waitingData.lods&&uh(e,db);for(k=0,m=e.skeletons.length;k<m;k++)(Ha=e.skeletons[k])._hasWaitingData&&(null!=Ha.bones&&Ha.bones.forEach(function(Gb){if(Gb._waitingTransformNodeId){var sd=e.getLastEntryByID(Gb._waitingTransformNodeId);sd&&Gb.linkTransformNode(sd),Gb._waitingTransformNodeId=null}}),Ha._hasWaitingData=null);for(k=0,m=e.meshes.length;k<m;k++){var xb=e.meshes[k];xb._waitingData.freezeWorldMatrix?(xb.freezeWorldMatrix(),xb._waitingData.freezeWorldMatrix=null):xb.computeWorldMatrix(!0)}for(k=0,m=e.lights.length;k<m;k++){var $a=e.lights[k];if($a._excludedMeshesIds.length>0){for(var Bb=0;Bb<$a._excludedMeshesIds.length;Bb++){var Rb=e.getMeshByID($a._excludedMeshesIds[Bb]);Rb&&$a.excludedMeshes.push(Rb)}$a._excludedMeshesIds=[]}if($a._includedOnlyMeshesIds.length>0){for(var Fb=0;Fb<$a._includedOnlyMeshesIds.length;Fb++){var Yb=e.getMeshByID($a._includedOnlyMeshesIds[Fb]);Yb&&$a.includedOnlyMeshes.push(Yb)}$a._includedOnlyMeshesIds=[]}}for(O.a.Parse(i,e,f,b),k=0,m=e.meshes.length;k<m;k++)(db=e.meshes[k])._waitingData.actions&&(D.Parse(db._waitingData.actions,db,e),db._waitingData.actions=null);void 0!==i.actions&&null!==i.actions&&D.Parse(i.actions,null,e),d||f.removeAllFromScene()}catch(Gb){var Sb=Rc("loadAssets",i?i.producer:"Unknown")+h;if(!c)throw r.a.Log(Sb),Gb;c(Sb,Gb)}finally{null!==h&&tb.loggingLevel!==tb.NO_LOGGING&&r.a.Log(Rc("loadAssets",i?i.producer:"Unknown")+(tb.loggingLevel!==tb.MINIMAL_LOGGING?h:""))}return f};tb.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(e){return-1!==e.indexOf("babylon")},importMesh:function(e,a,b,c,d,f,h,i){var k="importMesh has failed JSON parse";try{var m=JSON.parse(b);k="";var B=tb.loggingLevel===tb.DETAILED_LOGGING;e?Array.isArray(e)||(e=[e]):e=null;var E=new Array();if(void 0!==m.meshes&&null!==m.meshes){var K,P,S,U=[],_=[];for(K=0,P=m.meshes.length;K<P;K++){var da=m.meshes[K];if(null===e||Vj(da,e,E)){if(null!==e&&delete e[e.indexOf(da.name)],void 0!==da.geometryId&&null!==da.geometryId&&void 0!==m.geometries&&null!==m.geometries){var fa=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(Ua){!0!==fa&&m.geometries[Ua]&&Array.isArray(m.geometries[Ua])&&m.geometries[Ua].forEach(function(_a){if(_a.id===da.geometryId){switch(Ua){case"vertexData":df.a.Parse(_a,a,c)}fa=!0}})}),!1===fa&&r.a.Warn("Geometry not found for mesh "+da.id)}if(da.materialId){var ga=-1!==_.indexOf(da.materialId);if(!1===ga&&void 0!==m.multiMaterials&&null!==m.multiMaterials)for(var ha=0,ka=m.multiMaterials.length;ha<ka;ha++){var la=m.multiMaterials[ha];if(la.id===da.materialId){for(var ma=0,ta=la.materials.length;ma<ta;ma++){var pa,ua=la.materials[ma];_.push(ua),(pa=th(ua,m,a,c))&&(k+=`
	Material `+pa.toString(B))}_.push(la.id);var wa=Sd.a.ParseMultiMaterial(la,a);wa&&(ga=!0,k+=`
	Multi-Material `+wa.toString(B));break}}!1===ga&&(_.push(da.materialId),(pa=th(da.materialId,m,a,c))?k+=`
	Material `+pa.toString(B):r.a.Warn("Material not found for mesh "+da.id))}if(da.skeletonId>-1&&void 0!==m.skeletons&&null!==m.skeletons){if(!1===U.indexOf(da.skeletonId)>-1)for(var ya=0,Da=m.skeletons.length;ya<Da;ya++){var Ja=m.skeletons[ya];if(Ja.id===da.skeletonId){var Na=le.Parse(Ja,a);h.push(Na),U.push(Ja.id),k+=`
	Skeleton `+Na.toString(B)}}}if(void 0!==m.morphTargetManagers&&null!==m.morphTargetManagers)for(var Ma=0,Ha=m.morphTargetManagers;Ma<Ha.length;Ma++){var Qa=Ha[Ma];ff.Parse(Qa,a)}var cb=Ca.a.Parse(da,a,c);d.push(cb),k+=`
	Mesh `+cb.toString(B)}}for(K=0,P=a.meshes.length;K<P;K++)(S=a.meshes[K])._waitingParentId&&(S.parent=a.getLastEntryByID(S._waitingParentId),S._waitingParentId=null),S._waitingData.lods&&uh(a,S);for(K=0,P=a.skeletons.length;K<P;K++)(Na=a.skeletons[K])._hasWaitingData&&(null!=Na.bones&&Na.bones.forEach(function(Ua){if(Ua._waitingTransformNodeId){var _a=a.getLastEntryByID(Ua._waitingTransformNodeId);_a&&Ua.linkTransformNode(_a),Ua._waitingTransformNodeId=null}}),Na._hasWaitingData=null);for(K=0,P=a.meshes.length;K<P;K++)(S=a.meshes[K])._waitingData.freezeWorldMatrix?(S.freezeWorldMatrix(),S._waitingData.freezeWorldMatrix=null):S.computeWorldMatrix(!0)}if(void 0!==m.particleSystems&&null!==m.particleSystems){var La=O.a.GetIndividualParser(Pa.a.NAME_PARTICLESYSTEM);if(La)for(K=0,P=m.particleSystems.length;K<P;K++){var Oa=m.particleSystems[K];-1!==E.indexOf(Oa.emitterId)&&f.push(La(Oa,a,c))}}return!0}catch(Ua){var Ya=Rc("importMesh",m?m.producer:"Unknown")+k;if(!i)throw r.a.Log(Ya),Ua;i(Ya,Ua)}finally{null!==k&&tb.loggingLevel!==tb.NO_LOGGING&&r.a.Log(Rc("importMesh",m?m.producer:"Unknown")+(tb.loggingLevel!==tb.MINIMAL_LOGGING?k:""))}return!1},load:function(e,a,b,c){var d="importScene has failed JSON parse";try{var f=JSON.parse(a);if(d="",void 0!==f.useDelayedTextureLoading&&null!==f.useDelayedTextureLoading&&(e.useDelayedTextureLoading=f.useDelayedTextureLoading&&!tb.ForceFullSceneLoadingForIncremental),void 0!==f.autoClear&&null!==f.autoClear&&(e.autoClear=f.autoClear),void 0!==f.clearColor&&null!==f.clearColor&&(e.clearColor=j.f.FromArray(f.clearColor)),void 0!==f.ambientColor&&null!==f.ambientColor&&(e.ambientColor=j.e.FromArray(f.ambientColor)),void 0!==f.gravity&&null!==f.gravity&&(e.gravity=j.x.FromArray(f.gravity)),f.fogMode&&0!==f.fogMode)switch(e.fogMode=f.fogMode,e.fogColor=j.e.FromArray(f.fogColor),e.fogStart=f.fogStart,e.fogEnd=f.fogEnd,e.fogDensity=f.fogDensity,d+="	Fog mode for scene:  ",e.fogMode){case 1:d+=`exp
`;break;case 2:d+=`exp2
`;break;case 3:d+=`linear
`}if(f.physicsEnabled){var h;"cannon"===f.physicsEngine?h=new hf():"oimo"===f.physicsEngine?h=new qh():"ammo"===f.physicsEngine&&(h=new rh()),d="	Physics engine "+(f.physicsEngine?f.physicsEngine:"oimo")+` enabled
`;var i=f.physicsGravity?j.x.FromArray(f.physicsGravity):null;e.enablePhysics(i,h)}if(void 0!==f.metadata&&null!==f.metadata&&(e.metadata=f.metadata),void 0!==f.collisionsEnabled&&null!==f.collisionsEnabled&&(e.collisionsEnabled=f.collisionsEnabled),!vh(e,a,b,c,!0))return!1;if(f.autoAnimate&&e.beginAnimation(e,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1),void 0!==f.activeCameraID&&null!==f.activeCameraID&&e.setActiveCameraByID(f.activeCameraID),void 0!==f.environmentTexture&&null!==f.environmentTexture){var k=void 0===f.isPBR||f.isPBR;if(f.environmentTextureType&&"BABYLON.HDRCubeTexture"===f.environmentTextureType){var m=f.environmentTextureSize?f.environmentTextureSize:128,B=new jd(b+f.environmentTexture,e,m,!0,!k);f.environmentTextureRotationY&&(B.rotationY=f.environmentTextureRotationY),e.environmentTexture=B}else if(xa.h.EndsWith(f.environmentTexture,".env")){var E=new bc(b+f.environmentTexture,e);f.environmentTextureRotationY&&(E.rotationY=f.environmentTextureRotationY),e.environmentTexture=E}else{var K=bc.CreateFromPrefilteredData(b+f.environmentTexture,e);f.environmentTextureRotationY&&(K.rotationY=f.environmentTextureRotationY),e.environmentTexture=K}if(!0===f.createDefaultSkybox){var P=void 0!==e.activeCamera&&null!==e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1000,S=f.skyboxBlurLevel||0;e.createDefaultSkybox(e.environmentTexture,k,P,S)}}return!0}catch(_){var U=Rc("importScene",f?f.producer:"Unknown")+d;if(!c)throw r.a.Log(U),_;c(U,_)}finally{null!==d&&tb.loggingLevel!==tb.NO_LOGGING&&r.a.Log(Rc("importScene",f?f.producer:"Unknown")+(tb.loggingLevel!==tb.MINIMAL_LOGGING?d:""))}return!1},loadAssetContainer:function(e,a,b,c){return vh(e,a,b,c)}});var Wj=l(93),wh=function(){function e(){this._isEnabled=!0,this.leftColor=j.e.White(),this.rightColor=j.e.Black(),this.bias=0,this.power=1}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled!==a&&(this._isEnabled=a,va.b.MarkAllMaterialsAsDirty(o.a.MATERIAL_FresnelDirtyFlag|o.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var a=new e();return V.a.DeepCopy(this,a),a},e.prototype.serialize=function(){var a={};return a.isEnabled=this.isEnabled,a.leftColor=this.leftColor.asArray(),a.rightColor=this.rightColor.asArray(),a.bias=this.bias,a.power=this.power,a},e.Parse=function(a){var b=new e();return b.isEnabled=a.isEnabled,b.leftColor=j.e.FromArray(a.leftColor),b.rightColor=j.e.FromArray(a.rightColor),b.bias=a.bias,b.power=a.power||1,b},e}();g.a._FresnelParametersParser=wh.Parse;var jf=function(e){function a(b,c){var d=e.call(this,b,c)||this;return d.maxSimultaneousLights=4,d.disableLighting=!1,d.invertNormalMapX=!1,d.invertNormalMapY=!1,d.emissiveColor=new j.e(0,0,0),d.occlusionStrength=1,d.useLightmapAsShadowmap=!1,d._useAlphaFromAlbedoTexture=!0,d._useAmbientInGrayScale=!0,d}return v.d(a,e),Object.defineProperty(a.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(b){this._twoSidedLighting!==b&&(this._twoSidedLighting=b,this.backFaceCulling=!b,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsLightsDirty")],a.prototype,"maxSimultaneousLights",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsLightsDirty")],a.prototype,"disableLighting",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],a.prototype,"environmentTexture",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"invertNormalMapX",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"invertNormalMapY",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],a.prototype,"normalTexture",void 0),v.c([Object(g.e)("emissive"),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"emissiveColor",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"emissiveTexture",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],a.prototype,"occlusionStrength",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],a.prototype,"occlusionTexture",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],a.prototype,"alphaCutOff",void 0),v.c([Object(g.c)()],a.prototype,"doubleSided",null),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty",null)],a.prototype,"lightmapTexture",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useLightmapAsShadowmap",void 0),a}(Qb),xh=function(e){function a(b,c){var d=e.call(this,b,c)||this;return d._useRoughnessFromMetallicTextureAlpha=!1,d._useRoughnessFromMetallicTextureGreen=!0,d._useMetallnessFromMetallicTextureBlue=!0,d.metallic=1,d.roughness=1,d}return v.d(a,e),a.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},a.prototype.clone=function(b){var c=this,d=g.a.Clone(function(){return new a(b,c.getScene())},this);return d.id=b,d.name=b,this.clearCoat.copyTo(d.clearCoat),this.anisotropy.copyTo(d.anisotropy),this.brdf.copyTo(d.brdf),this.sheen.copyTo(d.sheen),d},a.prototype.serialize=function(){var b=g.a.Serialize(this);return b.customType="BABYLON.PBRMetallicRoughnessMaterial",b.clearCoat=this.clearCoat.serialize(),b.anisotropy=this.anisotropy.serialize(),b.brdf=this.brdf.serialize(),b.sheen=this.sheen.serialize(),b},a.Parse=function(b,c,d){var f=g.a.Parse(function(){return new a(b.name,c)},b,c,d);return b.clearCoat&&f.clearCoat.parse(b.clearCoat),b.anisotropy&&f.anisotropy.parse(b.anisotropy),b.brdf&&f.brdf.parse(b.brdf),b.sheen&&f.sheen.parse(b.brdf),f},v.c([Object(g.e)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],a.prototype,"baseColor",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],a.prototype,"baseTexture",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"metallic",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"roughness",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],a.prototype,"metallicRoughnessTexture",void 0),a}(jf);I.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessMaterial"]=xh;var yh=function(e){function a(b,c){var d=e.call(this,b,c)||this;return d._useMicroSurfaceFromReflectivityMapAlpha=!0,d}return v.d(a,e),a.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},a.prototype.clone=function(b){var c=this,d=g.a.Clone(function(){return new a(b,c.getScene())},this);return d.id=b,d.name=b,this.clearCoat.copyTo(d.clearCoat),this.anisotropy.copyTo(d.anisotropy),this.brdf.copyTo(d.brdf),this.sheen.copyTo(d.sheen),d},a.prototype.serialize=function(){var b=g.a.Serialize(this);return b.customType="BABYLON.PBRSpecularGlossinessMaterial",b.clearCoat=this.clearCoat.serialize(),b.anisotropy=this.anisotropy.serialize(),b.brdf=this.brdf.serialize(),b.sheen=this.sheen.serialize(),b},a.Parse=function(b,c,d){var f=g.a.Parse(function(){return new a(b.name,c)},b,c,d);return b.clearCoat&&f.clearCoat.parse(b.clearCoat),b.anisotropy&&f.anisotropy.parse(b.anisotropy),b.brdf&&f.brdf.parse(b.brdf),b.sheen&&f.sheen.parse(b.brdf),f},v.c([Object(g.e)("diffuse"),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],a.prototype,"diffuseColor",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],a.prototype,"diffuseTexture",void 0),v.c([Object(g.e)("specular"),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],a.prototype,"specularColor",void 0),v.c([Object(g.c)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_microSurface")],a.prototype,"glossiness",void 0),v.c([Object(g.m)(),Object(g.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],a.prototype,"specularGlossinessTexture",void 0),a}(jf);I.a.RegisteredTypes["BABYLON.PBRSpecularGlossinessMaterial"]=yh;var kf=l(76),zh=function(e){function a(b,c){var d=e.call(this,c)||this;return b?(d._engine=c.getEngine(),d._textureMatrix=j.j.Identity(),d.name=b,d.url=b,d.hasAlpha=!1,d.isCube=!1,d.is3D=d._engine.webGLVersion>1,d.wrapU=o.a.TEXTURE_CLAMP_ADDRESSMODE,d.wrapV=o.a.TEXTURE_CLAMP_ADDRESSMODE,d.wrapR=o.a.TEXTURE_CLAMP_ADDRESSMODE,d.anisotropicFilteringLevel=1,d._texture=d._getFromCache(b,!0),d._texture||(c.useDelayedTextureLoading?d.delayLoadState=o.a.DELAYLOADSTATE_NOTLOADED:d.loadTexture()),d):d}return v.d(a,e),a.prototype.getTextureMatrix=function(){return this._textureMatrix},a.prototype.load3dlTexture=function(){var b,c=this._engine;b=1===c.webGLVersion?c.createRawTexture(null,1,1,o.a.TEXTUREFORMAT_RGBA,!1,!1,o.a.TEXTURE_BILINEAR_SAMPLINGMODE):c.createRawTexture3D(null,1,1,1,o.a.TEXTUREFORMAT_RGBA,!1,!1,o.a.TEXTURE_BILINEAR_SAMPLINGMODE),this._texture=b;var d=function(h){if("string"==typeof h){for(var i,k=null,m=null,B=h.split(`
`),E=0,K=0,P=0,S=0,U=0,_=0;_<B.length;_++)if(i=B[_],a._noneEmptyLineRegex.test(i)&&0!==i.indexOf("#")){var da=i.split(" ");if(0!==E){if(0!=E){var fa=Math.max(parseInt(da[0]),0),ga=Math.max(parseInt(da[1]),0),ha=Math.max(parseInt(da[2]),0);U=Math.max(fa,U),U=Math.max(ga,U),U=Math.max(ha,U);var ka=4*(K+S*E+P*E*E);m&&(m[ka+0]=fa,m[ka+1]=ga,m[ka+2]=ha),++P%E==0&&(P=0,++S%E==0&&(K++,S=0))}}else E=da.length,k=new Uint8Array(E*E*E*4),m=new Float32Array(E*E*E*4)}if(m&&k)for(_=0;_<m.length;_++)if(_>0&&(_+1)%4==0)k[_]=255;else{var la=m[_];k[_]=la/U*255}b.is3D?(b.updateSize(E,E,E),c.updateRawTexture3D(b,k,o.a.TEXTUREFORMAT_RGBA,!1)):(b.updateSize(E*E,E),c.updateRawTexture(b,k,o.a.TEXTUREFORMAT_RGBA,!1))}},f=this.getScene();return f?f._loadFile(this.url,d):this._engine._loadFile(this.url,d),this._texture},a.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},a.prototype.clone=function(){var b=new a(this.url,this.getScene());return b.level=this.level,b},a.prototype.delayLoad=function(){this.delayLoadState===o.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=o.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},a.Parse=function(b,c){var d=null;return b.name&&!b.isRenderTarget&&((d=new a(b.name,c)).name=b.name,d.level=b.level),d},a.prototype.serialize=function(){if(!this.name)return null;var b={};return b.name=this.name,b.level=this.level,b.customType="BABYLON.ColorGradingTexture",b},a._noneEmptyLineRegex=/\S+/,a}(ac.a);I.a.RegisteredTypes["BABYLON.ColorGradingTexture"]=zh;var Ah=function(e){function a(b,c,d,f,h,i,k){void 0===f&&(f=!1),void 0===h&&(h=!0),void 0===i&&(i=null),void 0===k&&(k=null);var m=e.call(this,c)||this;if(m._onLoad=null,m._onError=null,m.coordinatesMode=ra.a.CUBIC_MODE,!b)throw new Error("Image url is not set");return m.name=b,m.url=b,m._size=d,m._noMipmap=f,m.gammaSpace=h,m._onLoad=i,m._onError=k,m.hasAlpha=!1,m.isCube=!0,m._texture=m._getFromCache(b,m._noMipmap),m._texture?i&&(m._texture.isReady?xa.h.SetImmediate(function(){return i()}):m._texture.onLoadedObservable.add(i)):c.useDelayedTextureLoading?m.delayLoadState=va.b.DELAYLOADSTATE_NOTLOADED:m.loadImage(m.loadTexture.bind(m),m._onError),m}return v.d(a,e),a.prototype.loadImage=function(b,c){var d=this,f=document.createElement("canvas"),h=new Image();h.addEventListener("load",function(){d._width=h.width,d._height=h.height,f.width=d._width,f.height=d._height;var i=f.getContext("2d");i.drawImage(h,0,0);var k=i.getImageData(0,0,h.width,h.height);d._buffer=k.data.buffer,f.remove(),b()}),h.addEventListener("error",function(i){c&&c(d.getClassName()+" could not be loaded",i)}),h.src=this.url},a.prototype.loadTexture=function(){var b=this,c=this.getScene();c&&(this._texture=c.getEngine().createRawCubeTextureFromUrl(this.url,c,this._size,va.b.TEXTUREFORMAT_RGB,c.getEngine().getCaps().textureFloat?va.b.TEXTURETYPE_FLOAT:va.b.TEXTURETYPE_UNSIGNED_INTEGER,this._noMipmap,function(){for(var d=b.getFloat32ArrayFromArrayBuffer(b._buffer),f=ef.ConvertPanoramaToCubemap(d,b._width,b._height,b._size),h=[],i=0;i<6;i++){var k=f[a._FacesMapping[i]];h.push(k)}return h},null,this._onLoad,this._onError))},a.prototype.getFloat32ArrayFromArrayBuffer=function(b){for(var c=new DataView(b),d=new Float32Array(3*b.byteLength/4),f=0,h=0;h<b.byteLength;h++)(h+1)%4!=0&&(d[f++]=c.getUint8(h)/255);return d},a.prototype.getClassName=function(){return"EquiRectangularCubeTexture"},a.prototype.clone=function(){var b=this.getScene();if(!b)return this;var c=new a(this.url,b,this._size,this._noMipmap,this.gammaSpace);return c.level=this.level,c.wrapU=this.wrapU,c.wrapV=this.wrapV,c.coordinatesIndex=this.coordinatesIndex,c.coordinatesMode=this.coordinatesMode,c},a._FacesMapping=["right","left","up","down","front","back"],a}(ac.a),Td=function(){function e(){}return e.GetTGAHeader=function(a){var b=0;return{id_length:a[b++],colormap_type:a[b++],image_type:a[b++],colormap_index:a[b++]|a[b++]<<8,colormap_length:a[b++]|a[b++]<<8,colormap_size:a[b++],origin:[a[b++]|a[b++]<<8,a[b++]|a[b++]<<8],width:a[b++]|a[b++]<<8,height:a[b++]|a[b++]<<8,pixel_size:a[b++],flags:a[b++]}},e.UploadContent=function(a,b){if(b.length<19)r.a.Error("Unable to load TGA file - Not enough data to contain header");else{var c=18,d=e.GetTGAHeader(b);if(d.id_length+c>b.length)r.a.Error("Unable to load TGA file - Not enough data");else{c+=d.id_length;var f,h=!1,i=!1,k=!1;switch(d.image_type){case e._TYPE_RLE_INDEXED:h=!0;case e._TYPE_INDEXED:i=!0;break;case e._TYPE_RLE_RGB:h=!0;case e._TYPE_RGB:break;case e._TYPE_RLE_GREY:h=!0;case e._TYPE_GREY:k=!0}var m,B,E,K,P,S,U,_=d.pixel_size>>3,da=d.width*d.height*_;if(i&&(m=b.subarray(c,c+=d.colormap_length*(d.colormap_size>>3))),h){var fa,ga,ha;f=new Uint8Array(da);for(var ka=0,la=new Uint8Array(_);c<da&&ka<da;)if(ga=1+(127&(fa=b[c++])),128&fa){for(ha=0;ha<_;++ha)la[ha]=b[c++];for(ha=0;ha<ga;++ha)f.set(la,ka+ha*_);ka+=_*ga}else{for(ga*=_,ha=0;ha<ga;++ha)f[ka+ha]=b[c++];ka+=ga}}else f=b.subarray(c,c+=i?d.width*d.height:da);switch((d.flags&e._ORIGIN_MASK)>>e._ORIGIN_SHIFT){default:case e._ORIGIN_UL:B=0,K=1,U=d.width,E=0,P=1,S=d.height;break;case e._ORIGIN_BL:B=0,K=1,U=d.width,E=d.height-1,P=-1,S=-1;break;case e._ORIGIN_UR:B=d.width-1,K=-1,U=-1,E=0,P=1,S=d.height;break;case e._ORIGIN_BR:B=d.width-1,K=-1,U=-1,E=d.height-1,P=-1,S=-1}var ma=e["_getImageData"+(k?"Grey":"")+d.pixel_size+"bits"](d,m,f,E,P,S,B,K,U);a.getEngine()._uploadDataToTextureDirectly(a,ma)}}},e._getImageData8bits=function(a,b,c,d,f,h,i,k,m){var B,E,K,P=c,S=b,U=a.width,_=a.height,da=0,fa=new Uint8Array(U*_*4);for(K=d;K!==h;K+=f)for(E=i;E!==m;E+=k,da++)B=P[da],fa[4*(E+U*K)+3]=255,fa[4*(E+U*K)+2]=S[3*B+0],fa[4*(E+U*K)+1]=S[3*B+1],fa[4*(E+U*K)+0]=S[3*B+2];return fa},e._getImageData16bits=function(a,b,c,d,f,h,i,k,m){var B,E,K,P=c,S=a.width,U=a.height,_=0,da=new Uint8Array(S*U*4);for(K=d;K!==h;K+=f)for(E=i;E!==m;E+=k,_+=2){var fa=255*((31744&(B=P[_+0]+(P[_+1]<<8)))>>10)/31|0,ga=255*((992&B)>>5)/31|0,ha=255*(31&B)/31|0;da[4*(E+S*K)+0]=fa,da[4*(E+S*K)+1]=ga,da[4*(E+S*K)+2]=ha,da[4*(E+S*K)+3]=32768&B?0:255}return da},e._getImageData24bits=function(a,b,c,d,f,h,i,k,m){var B,E,K=c,P=a.width,S=a.height,U=0,_=new Uint8Array(P*S*4);for(E=d;E!==h;E+=f)for(B=i;B!==m;B+=k,U+=3)_[4*(B+P*E)+3]=255,_[4*(B+P*E)+2]=K[U+0],_[4*(B+P*E)+1]=K[U+1],_[4*(B+P*E)+0]=K[U+2];return _},e._getImageData32bits=function(a,b,c,d,f,h,i,k,m){var B,E,K=c,P=a.width,S=a.height,U=0,_=new Uint8Array(P*S*4);for(E=d;E!==h;E+=f)for(B=i;B!==m;B+=k,U+=4)_[4*(B+P*E)+2]=K[U+0],_[4*(B+P*E)+1]=K[U+1],_[4*(B+P*E)+0]=K[U+2],_[4*(B+P*E)+3]=K[U+3];return _},e._getImageDataGrey8bits=function(a,b,c,d,f,h,i,k,m){var B,E,K,P=c,S=a.width,U=a.height,_=0,da=new Uint8Array(S*U*4);for(K=d;K!==h;K+=f)for(E=i;E!==m;E+=k,_++)B=P[_],da[4*(E+S*K)+0]=B,da[4*(E+S*K)+1]=B,da[4*(E+S*K)+2]=B,da[4*(E+S*K)+3]=255;return da},e._getImageDataGrey16bits=function(a,b,c,d,f,h,i,k,m){var B,E,K=c,P=a.width,S=a.height,U=0,_=new Uint8Array(P*S*4);for(E=d;E!==h;E+=f)for(B=i;B!==m;B+=k,U+=2)_[4*(B+P*E)+0]=K[U+0],_[4*(B+P*E)+1]=K[U+0],_[4*(B+P*E)+2]=K[U+0],_[4*(B+P*E)+3]=K[U+1];return _},e._TYPE_INDEXED=1,e._TYPE_RGB=2,e._TYPE_GREY=3,e._TYPE_RLE_INDEXED=9,e._TYPE_RLE_RGB=10,e._TYPE_RLE_GREY=11,e._ORIGIN_MASK=48,e._ORIGIN_SHIFT=4,e._ORIGIN_BL=0,e._ORIGIN_BR=1,e._ORIGIN_UL=2,e._ORIGIN_UR=3,e}(),Bh=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(a,b,c,d,f){return 0===a.indexOf(".tga")},e.prototype.transformUrl=function(a,b){return a},e.prototype.getFallbackTextureUrl=function(a,b){return null},e.prototype.loadCubeData=function(a,b,c,d,f){throw".env not supported in Cube."},e.prototype.loadData=function(a,b,c){var d=new Uint8Array(a),f=Td.GetTGAHeader(d);c(f.width,f.height,b.generateMipMaps,!1,function(){Td.UploadContent(b,d)})},e}();va.b._TextureLoaders.push(new Bh()),va.b.prototype.unBindMultiColorAttachmentFramebuffer=function(e,a,b){void 0===a&&(a=!1),this._currentRenderTarget=null;var c=this._gl;if(e[0]._MSAAFramebuffer){c.bindFramebuffer(c.READ_FRAMEBUFFER,e[0]._MSAAFramebuffer),c.bindFramebuffer(c.DRAW_FRAMEBUFFER,e[0]._framebuffer);var d=e[0]._attachments;d||(d=new Array(e.length),e[0]._attachments=d);for(var f=0;f<e.length;f++){for(var h=e[f],i=0;i<d.length;i++)d[i]=c.NONE;d[f]=c[this.webGLVersion>1?"COLOR_ATTACHMENT"+f:"COLOR_ATTACHMENT"+f+"_WEBGL"],c.readBuffer(d[f]),c.drawBuffers(d),c.blitFramebuffer(0,0,h.width,h.height,0,0,h.width,h.height,c.COLOR_BUFFER_BIT,c.NEAREST)}for(f=0;f<d.length;f++)d[f]=c[this.webGLVersion>1?"COLOR_ATTACHMENT"+f:"COLOR_ATTACHMENT"+f+"_WEBGL"];c.drawBuffers(d)}for(f=0;f<e.length;f++)!(h=e[f]).generateMipMaps||a||h.isCube||(this._bindTextureDirectly(c.TEXTURE_2D,h),c.generateMipmap(c.TEXTURE_2D),this._bindTextureDirectly(c.TEXTURE_2D,null));b&&(e[0]._MSAAFramebuffer&&this._bindUnboundFramebuffer(e[0]._framebuffer),b()),this._bindUnboundFramebuffer(null)},va.b.prototype.createMultipleRenderTarget=function(e,a){var b=!1,c=!0,d=!1,f=!1,h=1,i=va.b.TEXTURETYPE_UNSIGNED_INT,k=va.b.TEXTURE_TRILINEAR_SAMPLINGMODE,m=new Array(),B=new Array();void 0!==a&&(b=void 0!==a.generateMipMaps&&a.generateMipMaps,c=void 0===a.generateDepthBuffer||a.generateDepthBuffer,d=void 0!==a.generateStencilBuffer&&a.generateStencilBuffer,f=void 0!==a.generateDepthTexture&&a.generateDepthTexture,h=a.textureCount||1,a.types&&(m=a.types),a.samplingModes&&(B=a.samplingModes));var E=this._gl,K=E.createFramebuffer();this._bindUnboundFramebuffer(K);for(var P=e.width||e,S=e.height||e,U=[],_=[],da=this._setupFramebufferDepthAttachments(d,c,P,S),fa=0;fa<h;fa++){var ga=B[fa]||k,ha=m[fa]||i;(ha!==va.b.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(ha!==va.b.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(ga=va.b.TEXTURE_NEAREST_SAMPLINGMODE);var ka=this._getSamplingParameters(ga,b);ha!==va.b.TEXTURETYPE_FLOAT||this._caps.textureFloat||(ha=va.b.TEXTURETYPE_UNSIGNED_INT,r.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var la=new sb.a(this,sb.a.DATASOURCE_MULTIRENDERTARGET),ma=E[this.webGLVersion>1?"COLOR_ATTACHMENT"+fa:"COLOR_ATTACHMENT"+fa+"_WEBGL"];U.push(la),_.push(ma),E.activeTexture(E["TEXTURE"+fa]),E.bindTexture(E.TEXTURE_2D,la._webGLTexture),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,ka.mag),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,ka.min),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texImage2D(E.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(ha),P,S,0,E.RGBA,this._getWebGLTextureType(ha),null),E.framebufferTexture2D(E.DRAW_FRAMEBUFFER,ma,E.TEXTURE_2D,la._webGLTexture,0),b&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(E.TEXTURE_2D,null),la._framebuffer=K,la._depthStencilBuffer=da,la.baseWidth=P,la.baseHeight=S,la.width=P,la.height=S,la.isReady=!0,la.samples=1,la.generateMipMaps=b,la.samplingMode=ga,la.type=ha,la._generateDepthBuffer=c,la._generateStencilBuffer=d,la._attachments=_,this._internalTexturesCache.push(la)}if(f&&this._caps.depthTextureExtension){var ta=new sb.a(this,sb.a.DATASOURCE_MULTIRENDERTARGET);E.activeTexture(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,ta._webGLTexture),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.NEAREST),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.NEAREST),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texImage2D(E.TEXTURE_2D,0,this.webGLVersion<2?E.DEPTH_COMPONENT:E.DEPTH_COMPONENT16,P,S,0,E.DEPTH_COMPONENT,E.UNSIGNED_SHORT,null),E.framebufferTexture2D(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.TEXTURE_2D,ta._webGLTexture,0),ta._framebuffer=K,ta.baseWidth=P,ta.baseHeight=S,ta.width=P,ta.height=S,ta.isReady=!0,ta.samples=1,ta.generateMipMaps=b,ta.samplingMode=E.NEAREST,ta._generateDepthBuffer=c,ta._generateStencilBuffer=d,U.push(ta),this._internalTexturesCache.push(ta)}return E.drawBuffers(_),E.bindRenderbuffer(E.RENDERBUFFER,null),this._bindUnboundFramebuffer(null),this.resetTextureCache(),U},va.b.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,a){if(this.webGLVersion<2||!e||0==e.length)return 1;if(e[0].samples===a)return a;var b=this._gl;a=Math.min(a,b.getParameter(b.MAX_SAMPLES)),e[0]._depthStencilBuffer&&(b.deleteRenderbuffer(e[0]._depthStencilBuffer),e[0]._depthStencilBuffer=null),e[0]._MSAAFramebuffer&&(b.deleteFramebuffer(e[0]._MSAAFramebuffer),e[0]._MSAAFramebuffer=null);for(var c=0;c<e.length;c++)e[c]._MSAARenderBuffer&&(b.deleteRenderbuffer(e[c]._MSAARenderBuffer),e[c]._MSAARenderBuffer=null);if(a>1){var d=b.createFramebuffer();if(!d)throw new Error("Unable to create multi sampled framebuffer");this._bindUnboundFramebuffer(d);var f=this._setupFramebufferDepthAttachments(e[0]._generateStencilBuffer,e[0]._generateDepthBuffer,e[0].width,e[0].height,a),h=[];for(c=0;c<e.length;c++){var i=e[c],k=b[this.webGLVersion>1?"COLOR_ATTACHMENT"+c:"COLOR_ATTACHMENT"+c+"_WEBGL"],m=b.createRenderbuffer();if(!m)throw new Error("Unable to create multi sampled framebuffer");b.bindRenderbuffer(b.RENDERBUFFER,m),b.renderbufferStorageMultisample(b.RENDERBUFFER,a,this._getRGBAMultiSampleBufferFormat(i.type),i.width,i.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,k,b.RENDERBUFFER,m),i._MSAAFramebuffer=d,i._MSAARenderBuffer=m,i.samples=a,i._depthStencilBuffer=f,b.bindRenderbuffer(b.RENDERBUFFER,null),h.push(k)}b.drawBuffers(h)}else this._bindUnboundFramebuffer(e[0]._framebuffer);return this._bindUnboundFramebuffer(null),a};var Ch=function(e){function a(b,c,d,f,h){var i=this,k=!(!h||!h.generateMipMaps)&&h.generateMipMaps,m=!(!h||!h.generateDepthTexture)&&h.generateDepthTexture,B=!h||void 0===h.doNotChangeAspectRatio||h.doNotChangeAspectRatio;if((i=e.call(this,b,c,f,k,B)||this)._engine=f.getEngine(),i.isSupported){for(var E=[],K=[],P=0;P<d;P++)h&&h.types&&void 0!==h.types[P]?E.push(h.types[P]):E.push(h&&h.defaultType?h.defaultType:o.a.TEXTURETYPE_UNSIGNED_INT),h&&h.samplingModes&&void 0!==h.samplingModes[P]?K.push(h.samplingModes[P]):K.push(ra.a.BILINEAR_SAMPLINGMODE);var S=!h||void 0===h.generateDepthBuffer||h.generateDepthBuffer,U=!(!h||void 0===h.generateStencilBuffer)&&h.generateStencilBuffer;return i._size=c,i._multiRenderTargetOptions={samplingModes:K,generateMipMaps:k,generateDepthBuffer:S,generateStencilBuffer:U,generateDepthTexture:m,types:E,textureCount:d},i._createInternalTextures(),i._createTextures(),i}i.dispose()}return v.d(a,e),Object.defineProperty(a.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._engine.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"wrapU",{set:function(b){if(this._textures)for(var c=0;c<this._textures.length;c++)this._textures[c].wrapU=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"wrapV",{set:function(b){if(this._textures)for(var c=0;c<this._textures.length;c++)this._textures[c].wrapV=b},enumerable:!0,configurable:!0}),a.prototype._rebuild=function(){this.releaseInternalTextures(),this._createInternalTextures();for(var b=0;b<this._internalTextures.length;b++)this._textures[b]._texture=this._internalTextures[b];this._texture=this._internalTextures[0]},a.prototype._createInternalTextures=function(){this._internalTextures=this._engine.createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},a.prototype._createTextures=function(){this._textures=[];for(var b=0;b<this._internalTextures.length;b++){var c=new ra.a(null,this.getScene());c._texture=this._internalTextures[b],this._textures.push(c)}this._texture=this._internalTextures[0]},Object.defineProperty(a.prototype,"samples",{get:function(){return this._samples},set:function(b){this._samples!==b&&(this._samples=this._engine.updateMultipleRenderTargetTextureSampleCount(this._internalTextures,b))},enumerable:!0,configurable:!0}),a.prototype.resize=function(b){this.releaseInternalTextures(),this._internalTextures=this._engine.createMultipleRenderTarget(b,this._multiRenderTargetOptions),this._createInternalTextures()},a.prototype.unbindFrameBuffer=function(b,c){var d=this;b.unBindMultiColorAttachmentFramebuffer(this._internalTextures,this.isCube,function(){d.onAfterRenderObservable.notifyObservers(c)})},a.prototype.dispose=function(){this.releaseInternalTextures(),e.prototype.dispose.call(this)},a.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var b=this._internalTextures.length-1;b>=0;b--)void 0!==this._internalTextures[b]&&(this._internalTextures[b].dispose(),this._internalTextures.splice(b,1))},a}(Ab),Dh=function(){function e(a){this.name=Pa.a.NAME_PROCEDURALTEXTURE,this.scene=a,this.scene.proceduralTextures=new Array(),a.layers=new Array()}return e.prototype.register=function(){this.scene._beforeClearStage.registerStep(Pa.a.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){xa.h.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var a=0;a<this.scene.proceduralTextures.length;a++){var b=this.scene.proceduralTextures[a];b._shouldRender()&&b.render()}xa.h.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},e}(),Xj=`
attribute vec2 position;

varying vec2 vPosition;
varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vPosition=position;
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`;Ia.a.ShadersStore.proceduralVertexShader=Xj;var Ud=function(e){function a(b,c,d,f,h,i,k){void 0===h&&(h=null),void 0===i&&(i=!0),void 0===k&&(k=!1);var m=e.call(this,null,f,!i)||this;m.isCube=k,m.isEnabled=!0,m.autoClear=!0,m.onGeneratedObservable=new q.c(),m._textures={},m._currentRefreshId=-1,m._refreshRate=1,m._vertexBuffers={},m._uniforms=new Array(),m._samplers=new Array(),m._floats={},m._ints={},m._floatsArrays={},m._colors3={},m._colors4={},m._vectors2={},m._vectors3={},m._matrices={},m._fallbackTextureUsed=!1,m._cachedDefines="",m._contentUpdateId=-1;var B=(f=m.getScene())._getComponent(Pa.a.NAME_PROCEDURALTEXTURE);B||(B=new Dh(f),f._addComponent(B)),f.proceduralTextures.push(m),m._engine=f.getEngine(),m.name=b,m.isRenderTarget=!0,m._size=c,m._generateMipMaps=i,m.setFragment(d),m._fallbackTexture=h,k?(m._texture=m._engine.createRenderTargetCubeTexture(c,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1}),m.setFloat("face",0)):m._texture=m._engine.createRenderTargetTexture(c,{generateMipMaps:i,generateDepthBuffer:!1,generateStencilBuffer:!1});var E=[];return E.push(1,1),E.push(-1,1),E.push(-1,-1),E.push(1,-1),m._vertexBuffers[na.b.PositionKind]=new na.b(m._engine,E,na.b.PositionKind,!1,!1,2),m._createIndexBuffer(),m}return v.d(a,e),a.prototype.getEffect=function(){return this._effect},a.prototype.getContent=function(){return this._contentData&&this._currentRefreshId==this._contentUpdateId?this._contentData:(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._currentRefreshId,this._contentData)},a.prototype._createIndexBuffer=function(){var b=this._engine,c=[];c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),this._indexBuffer=b.createIndexBuffer(c)},a.prototype._rebuild=function(){var b=this._vertexBuffers[na.b.PositionKind];b&&b._rebuild(),this._createIndexBuffer(),this.refreshRate===Ab.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=Ab.REFRESHRATE_RENDER_ONCE)},a.prototype.reset=function(){void 0!==this._effect&&this._effect.dispose()},a.prototype._getDefines=function(){return""},a.prototype.isReady=function(){var b,c=this,d=this._engine;if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var f=this._getDefines();return!(!this._effect||f!==this._cachedDefines||!this._effect.isReady())||(b=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines=f,this._effect=d.createEffect(b,[na.b.PositionKind],this._uniforms,this._samplers,f,void 0,void 0,function(){c.releaseInternalTexture(),c._fallbackTexture&&(c._texture=c._fallbackTexture._texture,c._texture&&c._texture.incrementReferences()),c._fallbackTextureUsed=!0}),this._effect.isReady())},a.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},a.prototype.setFragment=function(b){this._fragment=b},Object.defineProperty(a.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(b){this._refreshRate=b,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),a.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)},a.prototype.getRenderSize=function(){return this._size},a.prototype.resize=function(b,c){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._engine.createRenderTargetTexture(b,c),this._size=b,this._generateMipMaps=c)},a.prototype._checkUniform=function(b){-1===this._uniforms.indexOf(b)&&this._uniforms.push(b)},a.prototype.setTexture=function(b,c){return-1===this._samplers.indexOf(b)&&this._samplers.push(b),this._textures[b]=c,this},a.prototype.setFloat=function(b,c){return this._checkUniform(b),this._floats[b]=c,this},a.prototype.setInt=function(b,c){return this._checkUniform(b),this._ints[b]=c,this},a.prototype.setFloats=function(b,c){return this._checkUniform(b),this._floatsArrays[b]=c,this},a.prototype.setColor3=function(b,c){return this._checkUniform(b),this._colors3[b]=c,this},a.prototype.setColor4=function(b,c){return this._checkUniform(b),this._colors4[b]=c,this},a.prototype.setVector2=function(b,c){return this._checkUniform(b),this._vectors2[b]=c,this},a.prototype.setVector3=function(b,c){return this._checkUniform(b),this._vectors3[b]=c,this},a.prototype.setMatrix=function(b,c){return this._checkUniform(b),this._matrices[b]=c,this},a.prototype.render=function(b){var c=this.getScene();if(c){var d=this._engine;for(var f in d.enableEffect(this._effect),d.setState(!1),this._textures)this._effect.setTexture(f,this._textures[f]);for(f in this._ints)this._effect.setInt(f,this._ints[f]);for(f in this._floats)this._effect.setFloat(f,this._floats[f]);for(f in this._floatsArrays)this._effect.setArray(f,this._floatsArrays[f]);for(f in this._colors3)this._effect.setColor3(f,this._colors3[f]);for(f in this._colors4){var h=this._colors4[f];this._effect.setFloat4(f,h.r,h.g,h.b,h.a)}for(f in this._vectors2)this._effect.setVector2(f,this._vectors2[f]);for(f in this._vectors3)this._effect.setVector3(f,this._vectors3[f]);for(f in this._matrices)this._effect.setMatrix(f,this._matrices[f]);if(this._texture){if(this.isCube)for(var i=0;i<6;i++)d.bindFramebuffer(this._texture,i,void 0,void 0,!0),d.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",i),this.autoClear&&d.clear(c.clearColor,!0,!1,!1),d.drawElementsType(rb.a.TriangleFillMode,0,6),5===i&&d.generateMipMapsForCubemap(this._texture);else d.bindFramebuffer(this._texture,0,void 0,void 0,!0),d.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&d.clear(c.clearColor,!0,!1,!1),d.drawElementsType(rb.a.TriangleFillMode,0,6);d.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},a.prototype.clone=function(){var b=this.getSize(),c=new a(this.name,b.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return c.hasAlpha=this.hasAlpha,c.level=this.level,c.coordinatesMode=this.coordinatesMode,c},a.prototype.dispose=function(){var b=this.getScene();if(b){var c=b.proceduralTextures.indexOf(this);c>=0&&b.proceduralTextures.splice(c,1);var d=this._vertexBuffers[na.b.PositionKind];d&&(d.dispose(),this._vertexBuffers[na.b.PositionKind]=null),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),e.prototype.dispose.call(this)}},v.c([Object(g.c)()],a.prototype,"isEnabled",void 0),v.c([Object(g.c)()],a.prototype,"autoClear",void 0),v.c([Object(g.c)()],a.prototype,"_generateMipMaps",void 0),v.c([Object(g.c)()],a.prototype,"_size",void 0),v.c([Object(g.c)()],a.prototype,"refreshRate",null),a}(ra.a),kd=l(60),Yj=function(e){function a(b,c,d,f,h,i){var k=e.call(this,b,d,null,f,h,i)||this;return k._animate=!0,k._time=0,k._texturePath=c,k._loadJson(c),k.refreshRate=1,k}return v.d(a,e),a.prototype._loadJson=function(b){var c=this,d=function(){r.a.Log("No config file found in "+b+" trying to use ShadersStore or DOM element");try{c.setFragment(c._texturePath)}catch(i){r.a.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},f=b+"/config.json",h=new kd.a();h.open("GET",f),h.addEventListener("load",function(){if(200===h.status||h.responseText&&h.responseText.length>0)try{c._config=JSON.parse(h.response),c.updateShaderUniforms(),c.updateTextures(),c.setFragment(c._texturePath+"/custom"),c._animate=c._config.animate,c.refreshRate=c._config.refreshrate}catch(i){d()}else d()},!1),h.addEventListener("error",function(){d()},!1);try{h.send()}catch(i){r.a.Error("CustomProceduralTexture: Error on XHR send request.")}},a.prototype.isReady=function(){if(!e.prototype.isReady.call(this))return!1;for(var b in this._textures)if(!this._textures[b].isReady())return!1;return!0},a.prototype.render=function(b){var c=this.getScene();this._animate&&c&&(this._time+=.03*c.getAnimationRatio(),this.updateShaderUniforms()),e.prototype.render.call(this,b)},a.prototype.updateTextures=function(){for(var b=0;b<this._config.sampler2Ds.length;b++)this.setTexture(this._config.sampler2Ds[b].sample2Dname,new ra.a(this._texturePath+"/"+this._config.sampler2Ds[b].textureRelativeUrl,this.getScene()))},a.prototype.updateShaderUniforms=function(){if(this._config)for(var b=0;b<this._config.uniforms.length;b++){var c=this._config.uniforms[b];switch(c.type){case"float":this.setFloat(c.name,c.value);break;case"color3":this.setColor3(c.name,new j.e(c.r,c.g,c.b));break;case"color4":this.setColor4(c.name,new j.f(c.r,c.g,c.b,c.a));break;case"vector2":this.setVector2(c.name,new j.w(c.x,c.y));break;case"vector3":this.setVector3(c.name,new j.x(c.x,c.y,c.z))}}this.setFloat("time",this._time)},Object.defineProperty(a.prototype,"animate",{get:function(){return this._animate},set:function(b){this._animate=b},enumerable:!0,configurable:!0}),a}(Ud),Zj=`

uniform float brightness;
uniform float persistence;
uniform float timeScale;

varying vec2 vUV;

vec2 hash22(vec2 p)
{
p=p*mat2(127.1,311.7,269.5,183.3);
p=-1.0+2.0*fract(sin(p)*43758.5453123);
return sin(p*6.283+timeScale);
}
float interpolationNoise(vec2 p)
{
vec2 pi=floor(p);
vec2 pf=p-pi;
vec2 w=pf*pf*(3.-2.*pf);
float f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));
float f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));
float f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));
float f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));
float xm1=mix(f00,f10,w.x);
float xm2=mix(f01,f11,w.x);
float ym=mix(xm1,xm2,w.y);
return ym;
}
float perlinNoise2D(float x,float y)
{
float sum=0.0;
float frequency=0.0;
float amplitude=0.0;
for(int i=0; i<OCTAVES; i++)
{
frequency=pow(2.0,float(i));
amplitude=pow(persistence,float(i));
sum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;
}
return sum;
}

void main(void)
{
float x=abs(vUV.x);
float y=abs(vUV.y);
float noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);
gl_FragColor=vec4(noise,noise,noise,1.0);
}
`;Ia.a.ShadersStore.noisePixelShader=Zj;var Eh=function(e){function a(b,c,d,f,h){void 0===c&&(c=256),void 0===d&&(d=T.a.LastCreatedScene);var i=e.call(this,b,c,"noise",d,f,h)||this;return i._time=0,i.brightness=.2,i.octaves=3,i.persistence=.8,i.animationSpeedFactor=1,i.autoClear=!1,i._updateShaderUniforms(),i}return v.d(a,e),a.prototype._updateShaderUniforms=function(){var b=this.getScene();b&&(this._time+=b.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this._time))},a.prototype._getDefines=function(){return"#define OCTAVES "+(0|this.octaves)},a.prototype.render=function(b){this._updateShaderUniforms(),e.prototype.render.call(this,b)},a.prototype.serialize=function(){var b={customType:"BABYLON.NoiseProceduralTexture"};return b.brightness=this.brightness,b.octaves=this.octaves,b.persistence=this.persistence,b.animationSpeedFactor=this.animationSpeedFactor,b.size=this.getSize().width,b.generateMipMaps=this._generateMipMaps,b},a.Parse=function(b,c){var d=new a(b.name,b.size,c,void 0,b.generateMipMaps);return d.brightness=b.brightness,d.octaves=b.octaves,d.persistence=b.persistence,d.animationSpeedFactor=b.animationSpeedFactor,d},a}(Ud);I.a.RegisteredTypes["BABYLON.NoiseProceduralTexture"]=Eh;var _j=function(e){function a(b,c,d,f,h,i,k,m,B){void 0===f&&(f=o.a.TEXTUREFORMAT_RGBA),void 0===h&&(h=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===i&&(i=!1),void 0===k&&(k=!1),void 0===m&&(m=o.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===B&&(B=null);var E=e.call(this,"",b)||this;return E._texture=b.getEngine().createRawCubeTexture(c,d,f,h,i,k,m,B),E}return v.d(a,e),a.prototype.update=function(b,c,d,f,h){void 0===h&&(h=null),this._texture.getEngine().updateRawCubeTexture(this._texture,b,c,d,f,h)},a.prototype.updateRGBDAsync=function(b,c,d,f){return void 0===c&&(c=null),void 0===d&&(d=.8),void 0===f&&(f=0),a._UpdateRGBDAsync(this._texture,b,c,d,f)},a.prototype.clone=function(){var b=this;return g.a.Clone(function(){var c=b.getScene(),d=b._texture,f=new a(c,d._bufferViewArray,d.width,d.format,d.type,d.generateMipMaps,d.invertY,d.samplingMode,d._compression);return d.dataSource===sb.a.DATASOURCE_CUBERAW_RGBD&&f.updateRGBDAsync(d._bufferViewArrayArray,d._sphericalPolynomial,d._lodGenerationScale,d._lodGenerationOffset),f},this)},a._UpdateRGBDAsync=function(b,c,d,f,h){return b._dataSource=sb.a.DATASOURCE_CUBERAW_RGBD,b._bufferViewArrayArray=c,b._lodGenerationScale=f,b._lodGenerationOffset=h,b._sphericalPolynomial=d,Oc.UploadLevelsAsync(b,c).then(function(){b.isReady=!0})},a}(bc),$j=function(e){function a(b,c,d,f,h,i,k,m,B,E){void 0===k&&(k=!0),void 0===m&&(m=!1),void 0===B&&(B=ra.a.TRILINEAR_SAMPLINGMODE),void 0===E&&(E=o.a.TEXTURETYPE_UNSIGNED_INT);var K=e.call(this,null,i,!k,m)||this;return K.format=h,K._engine=i.getEngine(),K._texture=i.getEngine().createRawTexture3D(b,c,d,f,h,k,m,B,void 0,E),K.is3D=!0,K}return v.d(a,e),a.prototype.update=function(b){this._texture&&this._engine.updateRawTexture3D(this._texture,b,this._texture.format,this._texture.invertY,null,this._texture.type)},a}(ra.a),ak=function(e){function a(b,c,d,f){var h=e.call(this,b,c,d,f,!0)||this;return h.refractionPlane=new j.n(0,1,0,1),h.depth=2,h.onBeforeRenderObservable.add(function(){d.clipPlane=h.refractionPlane}),h.onAfterRenderObservable.add(function(){d.clipPlane=null}),h}return v.d(a,e),a.prototype.clone=function(){var b=this.getScene();if(!b)return this;var c=this.getSize(),d=new a(this.name,c.width,b,this._generateMipMaps);return d.hasAlpha=this.hasAlpha,d.level=this.level,d.refractionPlane=this.refractionPlane.clone(),this.renderList&&(d.renderList=this.renderList.slice(0)),d.depth=this.depth,d},a.prototype.serialize=function(){if(!this.name)return null;var b=e.prototype.serialize.call(this);return b.mirrorPlane=this.refractionPlane.asArray(),b.depth=this.depth,b},a}(Ab),bk=function(e){function a(b,c,d){var f=e.call(this,d.scene)||this;return c&&(d.engine||d.scene)?(d=v.a({},a.DefaultOptions,d),f._engine=d.engine||d.scene.getEngine(),f._generateMipMaps=d.generateMipMaps,f._samplingMode=d.samplingMode,f._textureMatrix=j.j.Identity(),f.name=b,f.element=c,f._isVideo=c instanceof HTMLVideoElement,f.anisotropicFilteringLevel=1,f._createInternalTexture(),f):f}return v.d(a,e),a.prototype._createInternalTexture=function(){var b=0,c=0;this._isVideo?(b=this.element.videoWidth,c=this.element.videoHeight):(b=this.element.width,c=this.element.height),this._texture=this._engine.createDynamicTexture(b,c,this._generateMipMaps,this._samplingMode),this.update()},a.prototype.getTextureMatrix=function(){return this._textureMatrix},a.prototype.update=function(b){if(void 0===b&&(b=null),null!=this._texture)if(this._isVideo){var c=this.element;if(c.readyState<c.HAVE_CURRENT_DATA)return;this._engine.updateVideoTexture(this._texture,c,null===b||b)}else{var d=this.element;this._engine.updateDynamicTexture(this._texture,d,null===b||b,!1)}},a.DefaultOptions={generateMipMaps:!1,samplingMode:o.a.TEXTURE_BILINEAR_SAMPLINGMODE,engine:null,scene:null},a}(ac.a),Fh=function(){function e(a){this._pendingActions=new Array(),this._workerInfos=a.map(function(b){return{worker:b,active:!1}})}return e.prototype.dispose=function(){for(var a=0,b=this._workerInfos;a<b.length;a++)b[a].worker.terminate();delete this._workerInfos,delete this._pendingActions},e.prototype.push=function(a){for(var b=0,c=this._workerInfos;b<c.length;b++){var d=c[b];if(!d.active)return void this._execute(d,a)}this._pendingActions.push(a)},e.prototype._execute=function(a,b){var c=this;a.active=!0,b(a.worker,function(){a.active=!1;var d=c._pendingActions.shift();d&&c._execute(a,d)})},e}();function Gh(e){return"function"==typeof importScripts?(importScripts(e),Promise.resolve()):new Promise(function(a,b){xa.h.LoadScript(e,function(){a()},function(c){b(new Error(c))})})}function lf(e,a,b){var c=a&&e||b;if(c)return Gh(c).then(function(){return new Promise(function(d){DracoDecoderModule({wasmBinary:a}).then(function(f){d({module:f})})})})}function mf(e,a,b,c,d){var f=new e.DecoderBuffer();f.Init(a,a.byteLength);var h,i,k=new e.Decoder();try{var m=k.GetEncodedGeometryType(f);switch(m){case e.TRIANGULAR_MESH:h=new e.Mesh(),i=k.DecodeBufferToMesh(f,h);break;case e.POINT_CLOUD:h=new e.PointCloud(),i=k.DecodeBufferToPointCloud(f,h);break;default:throw new Error("Invalid geometry type "+m)}if(!i.ok()||!h.ptr)throw new Error(i.error_msg());var B=h.num_points();if(m===e.TRIANGULAR_MESH){var E=h.num_faces(),K=new e.DracoInt32Array();try{for(var P=new Uint32Array(3*E),S=0;S<E;S++){k.GetFaceFromMesh(h,S,K);var U=3*S;P[U+0]=K.GetValue(0),P[U+1]=K.GetValue(1),P[U+2]=K.GetValue(2)}c(P)}finally{e.destroy(K)}}var _=function(ha,ka){var la=new e.DracoFloat32Array();try{k.GetAttributeFloatForAllPoints(h,ka,la);for(var ma=new Float32Array(B*ka.num_components()),ta=0;ta<ma.length;ta++)ma[ta]=la.GetValue(ta);d(ha,ma)}finally{e.destroy(la)}};if(b)for(var da in b){var fa=b[da];_(da,k.GetAttributeByUniqueId(h,fa))}else{var ga={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var da in ga)-1!==(fa=k.GetAttributeId(h,e[ga[da]]))&&_(da,k.GetAttribute(h,fa))}}finally{h&&e.destroy(h),e.destroy(k),e.destroy(f)}}function nf(e){return"object"!=typeof document||"string"!=typeof e?e:xa.h.GetAbsoluteUrl(e)}var ck=function(){function e(a){void 0===a&&(a=e.DefaultNumWorkers);var b,c=e.Configuration.decoder,d=c.wasmUrl&&c.wasmBinaryUrl&&"object"==typeof WebAssembly?(b=nf(c.wasmBinaryUrl),new Promise(function(f,h){xa.h.LoadFile(b,function(i){f(i)},void 0,void 0,!0,function(i,k){h(k)})})):Promise.resolve(void 0);a&&"function"==typeof Worker?this._workerPoolPromise=d.then(function(f){for(var h=""+Gh+lf+mf+"("+function(){var B;onmessage=function(E){var K=E.data;switch(K.id){case"init":var P=K.decoder;B=lf(P.wasmUrl,P.wasmBinary,P.fallbackUrl),postMessage("done");break;case"decodeMesh":if(!B)throw new Error("Draco decoder module is not available");B.then(function(S){mf(S.module,K.dataView,K.attributes,function(U){postMessage({id:"indices",value:U},[U.buffer])},function(U,_){postMessage({id:U,value:_},[_.buffer])}),postMessage("done")})}}}+")()",i=URL.createObjectURL(new Blob([h],{type:"application/javascript"})),k=new Array(a),m=0;m<k.length;m++)k[m]=new Promise(function(B,E){var K=new Worker(i),P=function(U){K.removeEventListener("error",P),K.removeEventListener("message",S),E(U)},S=function(U){"done"===U.data&&(K.removeEventListener("error",P),K.removeEventListener("message",S),B(K))};K.addEventListener("error",P),K.addEventListener("message",S),K.postMessage({id:"init",decoder:{wasmUrl:nf(c.wasmUrl),wasmBinary:f,fallbackUrl:nf(c.fallbackUrl)}})});return Promise.all(k).then(function(B){return new Fh(B)})}):this._decoderModulePromise=d.then(function(f){return lf(c.wasmUrl,f,c.fallbackUrl)})}return Object.defineProperty(e,"DecoderAvailable",{get:function(){var a=e.Configuration.decoder;return!!(a.wasmUrl&&a.wasmBinaryUrl&&"object"==typeof WebAssembly||a.fallbackUrl)},enumerable:!0,configurable:!0}),e.GetDefaultNumWorkers=function(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(e,"Default",{get:function(){return e._Default||(e._Default=new e()),e._Default},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then(function(a){a.dispose()}),delete this._workerPoolPromise,delete this._decoderModulePromise},e.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then(function(){}):this._decoderModulePromise?this._decoderModulePromise.then(function(){}):Promise.resolve()},e.prototype.decodeMeshAsync=function(a,b){var c=a instanceof ArrayBuffer?new Uint8Array(a):a;if(this._workerPoolPromise)return this._workerPoolPromise.then(function(d){return new Promise(function(f,h){d.push(function(i,k){var m=new Wa.a(),B=function(P){i.removeEventListener("error",B),i.removeEventListener("message",E),h(P),k()},E=function(P){"done"===P.data?(i.removeEventListener("error",B),i.removeEventListener("message",E),f(m),k()):"indices"===P.data.id?m.indices=P.data.value:m.set(P.data.value,P.data.id)};i.addEventListener("error",B),i.addEventListener("message",E);var K=new Uint8Array(c.byteLength);K.set(new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),i.postMessage({id:"decodeMesh",dataView:K,attributes:b},[K.buffer])})})});if(this._decoderModulePromise)return this._decoderModulePromise.then(function(d){var f=new Wa.a();return mf(d.module,c,b,function(h){f.indices=h},function(h,i){f.set(i,h)}),f});throw new Error("Draco decoder module is not available")},e.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},e.DefaultNumWorkers=e.GetDefaultNumWorkers(),e._Default=null,e}(),ld=l(49),Hh=0,dk=function(){function e(a,b,c){this.pos=a,this.normal=b,this.uv=c}return e.prototype.clone=function(){return new e(this.pos.clone(),this.normal.clone(),this.uv.clone())},e.prototype.flip=function(){this.normal=this.normal.scale(-1)},e.prototype.interpolate=function(a,b){return new e(j.x.Lerp(this.pos,a.pos,b),j.x.Lerp(this.normal,a.normal,b),j.w.Lerp(this.uv,a.uv,b))},e}(),ek=function(){function e(a,b){this.normal=a,this.w=b}return e.FromPoints=function(a,b,c){var d=c.subtract(a),f=b.subtract(a);if(0===d.lengthSquared()||0===f.lengthSquared())return null;var h=j.x.Normalize(j.x.Cross(d,f));return new e(h,j.x.Dot(h,a))},e.prototype.clone=function(){return new e(this.normal.clone(),this.w)},e.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},e.prototype.splitPolygon=function(a,b,c,d,f){var h,i,k=0,m=[];for(h=0;h<a.vertices.length;h++){var B=(i=j.x.Dot(this.normal,a.vertices[h].pos)-this.w)<-e.EPSILON?2:i>e.EPSILON?1:0;k|=B,m.push(B)}switch(k){case 0:(j.x.Dot(this.normal,a.plane.normal)>0?b:c).push(a);break;case 1:d.push(a);break;case 2:f.push(a);break;case 3:var E,K=[],P=[];for(h=0;h<a.vertices.length;h++){var S=(h+1)%a.vertices.length,U=m[h],_=m[S],da=a.vertices[h],fa=a.vertices[S];if(2!==U&&K.push(da),1!==U&&P.push(2!==U?da.clone():da),3==(U|_)){i=(this.w-j.x.Dot(this.normal,da.pos))/j.x.Dot(this.normal,fa.pos.subtract(da.pos));var ga=da.interpolate(fa,i);K.push(ga),P.push(ga.clone())}}K.length>=3&&(E=new of(K,a.shared)).plane&&d.push(E),P.length>=3&&(E=new of(P,a.shared)).plane&&f.push(E)}},e.EPSILON=1e-05,e}(),of=function(){function e(a,b){this.vertices=a,this.shared=b,this.plane=ek.FromPoints(a[0].pos,a[1].pos,a[2].pos)}return e.prototype.clone=function(){return new e(this.vertices.map(function(a){return a.clone()}),this.shared)},e.prototype.flip=function(){this.vertices.reverse().map(function(a){a.flip()}),this.plane.flip()},e}(),Xb=function(){function e(a){this.plane=null,this.front=null,this.back=null,this.polygons=new Array(),a&&this.build(a)}return e.prototype.clone=function(){var a=new e();return a.plane=this.plane&&this.plane.clone(),a.front=this.front&&this.front.clone(),a.back=this.back&&this.back.clone(),a.polygons=this.polygons.map(function(b){return b.clone()}),a},e.prototype.invert=function(){for(var a=0;a<this.polygons.length;a++)this.polygons[a].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var b=this.front;this.front=this.back,this.back=b},e.prototype.clipPolygons=function(a){if(!this.plane)return a.slice();for(var b=new Array(),c=new Array(),d=0;d<a.length;d++)this.plane.splitPolygon(a[d],b,c,b,c);return this.front&&(b=this.front.clipPolygons(b)),c=this.back?this.back.clipPolygons(c):[],b.concat(c)},e.prototype.clipTo=function(a){this.polygons=a.clipPolygons(this.polygons),this.front&&this.front.clipTo(a),this.back&&this.back.clipTo(a)},e.prototype.allPolygons=function(){var a=this.polygons.slice();return this.front&&(a=a.concat(this.front.allPolygons())),this.back&&(a=a.concat(this.back.allPolygons())),a},e.prototype.build=function(a){if(a.length){this.plane||(this.plane=a[0].plane.clone());for(var b=new Array(),c=new Array(),d=0;d<a.length;d++)this.plane.splitPolygon(a[d],this.polygons,this.polygons,b,c);b.length&&(this.front||(this.front=new e()),this.front.build(b)),c.length&&(this.back||(this.back=new e()),this.back.build(c))}},e}(),fk=function(){function e(){this.polygons=new Array()}return e.FromMesh=function(a){var b,c,d,f,h,i,k,m,B,E,K=new Array(),P=null;if(!(a instanceof Ca.a))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";a.computeWorldMatrix(!0),k=a.getWorldMatrix(),m=a.position.clone(),B=a.rotation.clone(),a.rotationQuaternion&&(P=a.rotationQuaternion.clone()),E=a.scaling.clone();for(var S=a.getIndices(),U=a.getVerticesData(na.b.PositionKind),_=a.getVerticesData(na.b.NormalKind),da=a.getVerticesData(na.b.UVKind),fa=a.subMeshes,ga=0,ha=fa.length;ga<ha;ga++)for(var ka=fa[ga].indexStart,la=fa[ga].indexCount+fa[ga].indexStart;ka<la;ka+=3){i=[];for(var ma=0;ma<3;ma++){var ta=new j.x(_[3*S[ka+ma]],_[3*S[ka+ma]+1],_[3*S[ka+ma]+2]);d=new j.w(da[2*S[ka+ma]],da[2*S[ka+ma]+1]);var pa=new j.x(U[3*S[ka+ma]],U[3*S[ka+ma]+1],U[3*S[ka+ma]+2]);f=j.x.TransformCoordinates(pa,k),c=j.x.TransformNormal(ta,k),b=new dk(f,c,d),i.push(b)}(h=new of(i,{subMeshId:ga,meshId:Hh,materialIndex:fa[ga].materialIndex})).plane&&K.push(h)}var ua=e.FromPolygons(K);return ua.matrix=k,ua.position=m,ua.rotation=B,ua.scaling=E,ua.rotationQuaternion=P,Hh++,ua},e.FromPolygons=function(a){var b=new e();return b.polygons=a,b},e.prototype.clone=function(){var a=new e();return a.polygons=this.polygons.map(function(b){return b.clone()}),a.copyTransformAttributes(this),a},e.prototype.union=function(a){var b=new Xb(this.clone().polygons),c=new Xb(a.clone().polygons);return b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),e.FromPolygons(b.allPolygons()).copyTransformAttributes(this)},e.prototype.unionInPlace=function(a){var b=new Xb(this.polygons),c=new Xb(a.polygons);b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),this.polygons=b.allPolygons()},e.prototype.subtract=function(a){var b=new Xb(this.clone().polygons),c=new Xb(a.clone().polygons);return b.invert(),b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),b.invert(),e.FromPolygons(b.allPolygons()).copyTransformAttributes(this)},e.prototype.subtractInPlace=function(a){var b=new Xb(this.polygons),c=new Xb(a.polygons);b.invert(),b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),b.invert(),this.polygons=b.allPolygons()},e.prototype.intersect=function(a){var b=new Xb(this.clone().polygons),c=new Xb(a.clone().polygons);return b.invert(),c.clipTo(b),c.invert(),b.clipTo(c),c.clipTo(b),b.build(c.allPolygons()),b.invert(),e.FromPolygons(b.allPolygons()).copyTransformAttributes(this)},e.prototype.intersectInPlace=function(a){var b=new Xb(this.polygons),c=new Xb(a.polygons);b.invert(),c.clipTo(b),c.invert(),b.clipTo(c),c.clipTo(b),b.build(c.allPolygons()),b.invert(),this.polygons=b.allPolygons()},e.prototype.inverse=function(){var a=this.clone();return a.inverseInPlace(),a},e.prototype.inverseInPlace=function(){this.polygons.map(function(a){a.flip()})},e.prototype.copyTransformAttributes=function(a){return this.matrix=a.matrix,this.position=a.position,this.rotation=a.rotation,this.scaling=a.scaling,this.rotationQuaternion=a.rotationQuaternion,this},e.prototype.buildMeshGeometry=function(a,b,c){var d=this.matrix.clone();d.invert();var f,h,i,k=new Ca.a(a,b),m=[],B=[],E=[],K=[],P=j.x.Zero(),S=j.x.Zero(),U=j.w.Zero(),_=this.polygons,da=[0,0,0],fa={},ga=0,ha={};c&&_.sort(function(Ma,Ha){return Ma.shared.meshId===Ha.shared.meshId?Ma.shared.subMeshId-Ha.shared.subMeshId:Ma.shared.meshId-Ha.shared.meshId});for(var ka=0,la=_.length;ka<la;ka++){ha[(f=_[ka]).shared.meshId]||(ha[f.shared.meshId]={}),ha[f.shared.meshId][f.shared.subMeshId]||(ha[f.shared.meshId][f.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:f.shared.materialIndex}),i=ha[f.shared.meshId][f.shared.subMeshId];for(var ma=2,ta=f.vertices.length;ma<ta;ma++){da[0]=0,da[1]=ma-1,da[2]=ma;for(var pa=0;pa<3;pa++){P.copyFrom(f.vertices[da[pa]].pos),S.copyFrom(f.vertices[da[pa]].normal),U.copyFrom(f.vertices[da[pa]].uv);var ua=j.x.TransformCoordinates(P,d),wa=j.x.TransformNormal(S,d);void 0!==(h=fa[ua.x+","+ua.y+","+ua.z])&&E[3*h]===wa.x&&E[3*h+1]===wa.y&&E[3*h+2]===wa.z&&K[2*h]===U.x&&K[2*h+1]===U.y||(m.push(ua.x,ua.y,ua.z),K.push(U.x,U.y),E.push(S.x,S.y,S.z),h=fa[ua.x+","+ua.y+","+ua.z]=m.length/3-1),B.push(h),i.indexStart=Math.min(ga,i.indexStart),i.indexEnd=Math.max(ga,i.indexEnd),ga++}}}if(k.setVerticesData(na.b.PositionKind,m),k.setVerticesData(na.b.NormalKind,E),k.setVerticesData(na.b.UVKind,K),k.setIndices(B,null),c){var ya,Da=0;for(var Ja in k.subMeshes=new Array(),ha){for(var Na in ya=-1,ha[Ja])i=ha[Ja][Na],ld.b.CreateFromIndices(i.materialIndex+Da,i.indexStart,i.indexEnd-i.indexStart+1,k),ya=Math.max(i.materialIndex,ya);Da+=++ya}}return k},e.prototype.toMesh=function(a,b,c,d){var f=this.buildMeshGeometry(a,c,d);return f.material=b,f.position.copyFrom(this.position),f.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(f.rotationQuaternion=this.rotationQuaternion.clone()),f.scaling.copyFrom(this.scaling),f.computeWorldMatrix(!0),f},e}(),gk=function(e){function a(b,c,d,f,h,i){void 0===f&&(f=1),void 0===h&&(h=60),void 0===i&&(i=!0);var k=e.call(this,b,d)||this;k._sectionPolygonPointsCount=4,k._running=!1,k._autoStart=i,k._generator=c,k._diameter=f,k._length=h,k._sectionVectors=[],k._sectionNormalVectors=[];for(var m=0;m<k._sectionPolygonPointsCount;m++)k._sectionVectors[m]=j.x.Zero(),k._sectionNormalVectors[m]=j.x.Zero();return k._createMesh(),k}return v.d(a,e),a.prototype.getClassName=function(){return"TrailMesh"},a.prototype._createMesh=function(){var b=new Wa.a(),c=[],d=[],f=[],h=j.x.Zero();this._generator._boundingInfo&&(h=this._generator._boundingInfo.boundingBox.centerWorld);for(var i=2*Math.PI/this._sectionPolygonPointsCount,k=0;k<this._sectionPolygonPointsCount;k++)c.push(h.x+Math.cos(k*i)*this._diameter,h.y+Math.sin(k*i)*this._diameter,h.z);for(k=1;k<=this._length;k++){for(var m=0;m<this._sectionPolygonPointsCount;m++)c.push(h.x+Math.cos(m*i)*this._diameter,h.y+Math.sin(m*i)*this._diameter,h.z);var B=c.length/3-2*this._sectionPolygonPointsCount;for(m=0;m<this._sectionPolygonPointsCount-1;m++)f.push(B+m,B+m+this._sectionPolygonPointsCount,B+m+this._sectionPolygonPointsCount+1),f.push(B+m,B+m+this._sectionPolygonPointsCount+1,B+m+1);f.push(B+this._sectionPolygonPointsCount-1,B+this._sectionPolygonPointsCount-1+this._sectionPolygonPointsCount,B+this._sectionPolygonPointsCount),f.push(B+this._sectionPolygonPointsCount-1,B+this._sectionPolygonPointsCount,B)}Wa.a.ComputeNormals(c,f,d),b.positions=c,b.normals=d,b.indices=f,b.applyToMesh(this,!0),this._autoStart&&this.start()},a.prototype.start=function(){var b=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add(function(){b.update()}))},a.prototype.stop=function(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))},a.prototype.update=function(){var b=this.getVerticesData(na.b.PositionKind),c=this.getVerticesData(na.b.NormalKind),d=this._generator.getWorldMatrix();if(b&&c){for(var f=3*this._sectionPolygonPointsCount;f<b.length;f++)b[f-3*this._sectionPolygonPointsCount]=b[f]-c[f]/this._length*this._diameter;for(f=3*this._sectionPolygonPointsCount;f<c.length;f++)c[f-3*this._sectionPolygonPointsCount]=c[f];var h=b.length-3*this._sectionPolygonPointsCount,i=2*Math.PI/this._sectionPolygonPointsCount;for(f=0;f<this._sectionPolygonPointsCount;f++)this._sectionVectors[f].copyFromFloats(Math.cos(f*i)*this._diameter,Math.sin(f*i)*this._diameter,0),this._sectionNormalVectors[f].copyFromFloats(Math.cos(f*i),Math.sin(f*i),0),j.x.TransformCoordinatesToRef(this._sectionVectors[f],d,this._sectionVectors[f]),j.x.TransformNormalToRef(this._sectionNormalVectors[f],d,this._sectionNormalVectors[f]);for(f=0;f<this._sectionPolygonPointsCount;f++)b[h+3*f]=this._sectionVectors[f].x,b[h+3*f+1]=this._sectionVectors[f].y,b[h+3*f+2]=this._sectionVectors[f].z,c[h+3*f]=this._sectionNormalVectors[f].x,c[h+3*f+1]=this._sectionNormalVectors[f].y,c[h+3*f+2]=this._sectionNormalVectors[f].z;this.updateVerticesData(na.b.PositionKind,b,!0,!1),this.updateVerticesData(na.b.NormalKind,c,!0,!1)}},a.prototype.clone=function(b,c){return void 0===b&&(b=""),new a(b,void 0===c?this._generator:c,this.getScene(),this._diameter,this._length,this._autoStart)},a.prototype.serialize=function(b){e.prototype.serialize.call(this,b)},a.Parse=function(b,c){return new a(b.name,b._generator,c,b._diameter,b._length,b._autoStart)},a}(Ca.a),hk=l(111),md=l(72);Wa.a.CreateDisc=function(e){var a=new Array(),b=new Array(),c=new Array(),d=new Array(),f=e.radius||.5,h=e.tessellation||64,i=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,k=0===e.sideOrientation?0:e.sideOrientation||Wa.a.DEFAULTSIDE;a.push(0,0,0),d.push(.5,.5);for(var m=2*Math.PI*i,B=m/h,E=0;E<m;E+=B){var K=Math.cos(E),P=Math.sin(E),S=(K+1)/2,U=(1-P)/2;a.push(f*K,f*P,0),d.push(S,U)}1===i&&(a.push(a[3],a[4],a[5]),d.push(d[2],d[3]));for(var _=a.length/3,da=1;da<_-1;da++)b.push(da+1,0,da);Wa.a.ComputeNormals(a,b,c),Wa.a._ComputeSides(k,a,b,c,d,e.frontUVs,e.backUVs);var fa=new Wa.a();return fa.indices=b,fa.positions=a,fa.normals=c,fa.uvs=d,fa},Ca.a.CreateDisc=function(e,a,b,c,d,f){void 0===c&&(c=null);var h={radius:a,tessellation:b,sideOrientation:f,updatable:d};return Vd.CreateDisc(e,h,c)};var Vd=function(){function e(){}return e.CreateDisc=function(a,b,c){void 0===c&&(c=null);var d=new Ca.a(a,c);return b.sideOrientation=Ca.a._GetDefaultSideOrientation(b.sideOrientation),d._originalBuilderSideOrientation=b.sideOrientation,Wa.a.CreateDisc(b).applyToMesh(d,b.updatable),d},e}();Wa.a.CreateTorusKnot=function(e){var a,b,c=new Array(),d=new Array(),f=new Array(),h=new Array(),i=e.radius||2,k=e.tube||.5,m=e.radialSegments||32,B=e.tubularSegments||32,E=e.p||2,K=e.q||3,P=0===e.sideOrientation?0:e.sideOrientation||Wa.a.DEFAULTSIDE,S=function(Ja){var Na=Math.cos(Ja),Ma=Math.sin(Ja),Ha=K/E*Ja,Qa=Math.cos(Ha),cb=i*(2+Qa)*.5*Na,La=i*(2+Qa)*Ma*.5,Oa=i*Math.sin(Ha)*.5;return new j.x(cb,La,Oa)};for(a=0;a<=m;a++){var U=a%m/m*2*E*Math.PI,_=S(U),da=S(U+.01),fa=da.subtract(_),ga=da.add(_),ha=j.x.Cross(fa,ga);for(ga=j.x.Cross(ha,fa),ha.normalize(),ga.normalize(),b=0;b<B;b++){var ka=b%B/B*2*Math.PI,la=-k*Math.cos(ka),ma=k*Math.sin(ka);d.push(_.x+la*ga.x+ma*ha.x),d.push(_.y+la*ga.y+ma*ha.y),d.push(_.z+la*ga.z+ma*ha.z),h.push(a/m),h.push(b/B)}}for(a=0;a<m;a++)for(b=0;b<B;b++){var ta=(b+1)%B,pa=a*B+b,ua=(a+1)*B+b,wa=(a+1)*B+ta,ya=a*B+ta;c.push(ya),c.push(ua),c.push(pa),c.push(ya),c.push(wa),c.push(ua)}Wa.a.ComputeNormals(d,c,f),Wa.a._ComputeSides(P,d,c,f,h,e.frontUVs,e.backUVs);var Da=new Wa.a();return Da.indices=c,Da.positions=d,Da.normals=f,Da.uvs=h,Da},Ca.a.CreateTorusKnot=function(e,a,b,c,d,f,h,i,k,m){var B={radius:a,tube:b,radialSegments:c,tubularSegments:d,p:f,q:h,sideOrientation:m,updatable:k};return pf.CreateTorusKnot(e,B,i)};var pf=function(){function e(){}return e.CreateTorusKnot=function(a,b,c){var d=new Ca.a(a,c);return b.sideOrientation=Ca.a._GetDefaultSideOrientation(b.sideOrientation),d._originalBuilderSideOrientation=b.sideOrientation,Wa.a.CreateTorusKnot(b).applyToMesh(d,b.updatable),d},e}(),ik=function(e){function a(b,c){var d=e.call(this,b.x,b.y)||this;return d.index=c,d}return v.d(a,e),a}(j.w),qf=function(){function e(){this.elements=new Array()}return e.prototype.add=function(a){var b=this,c=new Array();return a.forEach(function(d){if(0===c.length||!d.equalsWithEpsilon(c[0])){var f=new ik(d,b.elements.length);c.push(f),b.elements.push(f)}}),c},e.prototype.computeBounds=function(){var a=new j.w(this.elements[0].x,this.elements[0].y),b=new j.w(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(c){c.x<a.x?a.x=c.x:c.x>b.x&&(b.x=c.x),c.y<a.y?a.y=c.y:c.y>b.y&&(b.y=c.y)}),{min:a,max:b,width:b.x-a.x,height:b.y-a.y}},e}(),jk=function(){function e(){}return e.Rectangle=function(a,b,c,d){return[new j.w(a,b),new j.w(c,b),new j.w(c,d),new j.w(a,d)]},e.Circle=function(a,b,c,d){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=32);for(var f=new Array(),h=0,i=2*Math.PI/d,k=0;k<d;k++)f.push(new j.w(b+Math.cos(h)*a,c+Math.sin(h)*a)),h-=i;return f},e.Parse=function(a){var b,c=a.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(f){return!isNaN(f)}),d=[];for(b=0;b<(2147483646&c.length);b+=2)d.push(new j.w(c[b],c[b+1]));return d},e.StartingAt=function(a,b){return j.l.StartingAt(a,b)},e}(),Ih=function(){function e(a,b,c,d){var f;void 0===d&&(d=earcut),this._points=new qf(),this._outlinepoints=new qf(),this._holes=new Array(),this._epoints=new Array(),this._eholes=new Array(),this.bjsEarcut=d,this._name=a,this._scene=c||va.b.LastCreatedScene,f=b instanceof j.l?b.getPoints():b,this._addToepoint(f),this._points.add(f),this._outlinepoints.add(f),void 0===this.bjsEarcut&&r.a.Warn("Earcut was not found, the polygon will not be built.")}return e.prototype._addToepoint=function(a){for(var b=0,c=a;b<c.length;b++){var d=c[b];this._epoints.push(d.x,d.y)}},e.prototype.addHole=function(a){this._points.add(a);var b=new qf();return b.add(a),this._holes.push(b),this._eholes.push(this._epoints.length/2),this._addToepoint(a),this},e.prototype.build=function(a,b){void 0===a&&(a=!1),void 0===b&&(b=0);var c=new Ca.a(this._name,this._scene),d=this.buildVertexData(b);return c.setVerticesData(na.b.PositionKind,d.positions,a),c.setVerticesData(na.b.NormalKind,d.normals,a),c.setVerticesData(na.b.UVKind,d.uvs,a),c.setIndices(d.indices),c},e.prototype.buildVertexData=function(a){var b=this;void 0===a&&(a=0);var c=new Wa.a(),d=new Array(),f=new Array(),h=new Array(),i=this._points.computeBounds();this._points.elements.forEach(function(_){d.push(0,1,0),f.push(_.x,0,_.y),h.push((_.x-i.min.x)/i.width,(_.y-i.min.y)/i.height)});for(var k=new Array(),m=this.bjsEarcut(this._epoints,this._eholes,2),B=0;B<m.length;B++)k.push(m[B]);if(a>0){var E=f.length/3;this._points.elements.forEach(function(_){d.push(0,-1,0),f.push(_.x,-a,_.y),h.push(1-(_.x-i.min.x)/i.width,1-(_.y-i.min.y)/i.height)});var K=k.length;for(B=0;B<K;B+=3){var P=k[B+0],S=k[B+1],U=k[B+2];k.push(U+E),k.push(S+E),k.push(P+E)}this.addSide(f,d,h,k,i,this._outlinepoints,a,!1),this._holes.forEach(function(_){b.addSide(f,d,h,k,i,_,a,!0)})}return c.indices=k,c.positions=f,c.normals=d,c.uvs=h,c},e.prototype.addSide=function(a,b,c,d,f,h,i,k){for(var m=a.length/3,B=0,E=0;E<h.elements.length;E++){var K,P=h.elements[E];K=E+1>h.elements.length-1?h.elements[0]:h.elements[E+1],a.push(P.x,0,P.y),a.push(P.x,-i,P.y),a.push(K.x,0,K.y),a.push(K.x,-i,K.y);var S=new j.x(P.x,0,P.y),U=new j.x(K.x,0,K.y).subtract(S),_=new j.x(0,1,0),da=j.x.Cross(U,_);da=da.normalize(),c.push(B/f.width,0),c.push(B/f.width,1),B+=U.length(),c.push(B/f.width,0),c.push(B/f.width,1),k?(b.push(da.x,da.y,da.z),b.push(da.x,da.y,da.z),b.push(da.x,da.y,da.z),b.push(da.x,da.y,da.z),d.push(m),d.push(m+2),d.push(m+1),d.push(m+1),d.push(m+2),d.push(m+3)):(b.push(-da.x,-da.y,-da.z),b.push(-da.x,-da.y,-da.z),b.push(-da.x,-da.y,-da.z),b.push(-da.x,-da.y,-da.z),d.push(m),d.push(m+1),d.push(m+2),d.push(m+1),d.push(m+3),d.push(m+2)),m+=4}},e}();Wa.a.CreatePolygon=function(e,a,b,c,d,f){for(var h=b||new Array(3),i=c,k=[],m=0;m<3;m++)void 0===h[m]&&(h[m]=new j.y(0,0,1,1)),i&&void 0===i[m]&&(i[m]=new j.f(1,1,1,1));for(var B=e.getVerticesData(na.b.PositionKind),E=e.getVerticesData(na.b.NormalKind),K=e.getVerticesData(na.b.UVKind),P=e.getIndices(),S=0,U=0,_=0;_<E.length;_+=3)Math.abs(E[_+1])<.001&&(U=1),Math.abs(E[_+1]-1)<.001&&(U=0),Math.abs(E[_+1]+1)<.001&&(U=2),K[2*(S=_/3)]=(1-K[2*S])*h[U].x+K[2*S]*h[U].z,K[2*S+1]=(1-K[2*S+1])*h[U].y+K[2*S+1]*h[U].w,i&&k.push(i[U].r,i[U].g,i[U].b,i[U].a);Wa.a._ComputeSides(a,B,P,E,K,d,f);var da=new Wa.a();if(da.indices=P,da.positions=B,da.normals=E,da.uvs=K,i){var fa=a===Wa.a.DOUBLESIDE?k.concat(k):k;da.colors=fa}return da},Ca.a.CreatePolygon=function(e,a,b,c,d,f,h){void 0===h&&(h=earcut);var i={shape:a,holes:c,updatable:d,sideOrientation:f};return nd.CreatePolygon(e,i,b,h)},Ca.a.ExtrudePolygon=function(e,a,b,c,d,f,h,i){void 0===i&&(i=earcut);var k={shape:a,holes:d,depth:b,updatable:f,sideOrientation:h};return nd.ExtrudePolygon(e,k,c,i)};var nd=function(){function e(){}return e.CreatePolygon=function(a,b,c,d){void 0===c&&(c=null),void 0===d&&(d=earcut),b.sideOrientation=Ca.a._GetDefaultSideOrientation(b.sideOrientation);for(var f=b.shape,h=b.holes||[],i=b.depth||0,k=[],m=[],B=0;B<f.length;B++)k[B]=new j.w(f[B].x,f[B].z);k[0].equalsWithEpsilon(k[k.length-1],1e-08)&&k.pop();for(var E=new Ih(a,k,c||T.a.LastCreatedScene,d),K=0;K<h.length;K++){m=[];for(var P=0;P<h[K].length;P++)m.push(new j.w(h[K][P].x,h[K][P].z));E.addHole(m)}var S=E.build(b.updatable,i);return S._originalBuilderSideOrientation=b.sideOrientation,Wa.a.CreatePolygon(S,b.sideOrientation,b.faceUV,b.faceColors,b.frontUVs,b.backUVs).applyToMesh(S,b.updatable),S},e.ExtrudePolygon=function(a,b,c,d){return void 0===c&&(c=null),void 0===d&&(d=earcut),e.CreatePolygon(a,b,c,d)},e}();Ca.a.CreateLathe=function(e,a,b,c,d,f,h){var i={shape:a,radius:b,tessellation:c,sideOrientation:h,updatable:f};return rf.CreateLathe(e,i,d)};var rf=function(){function e(){}return e.CreateLathe=function(a,b,c){void 0===c&&(c=null);var d,f=b.arc?b.arc<=0||b.arc>1?1:b.arc:1,h=void 0===b.closed||b.closed,i=b.shape,k=b.radius||1,m=b.tessellation||64,B=b.clip||0,E=b.updatable,K=Ca.a._GetDefaultSideOrientation(b.sideOrientation),P=b.cap||Ca.a.NO_CAP,S=2*Math.PI,U=new Array(),_=b.invertUV||!1,da=0,fa=0,ga=S/m*f,ha=new Array();for(da=0;da<=m-B;da++){for(ha=[],P!=Ca.a.CAP_START&&P!=Ca.a.CAP_ALL||(ha.push(new j.x(0,i[0].y,0)),ha.push(new j.x(Math.cos(da*ga)*i[0].x*k,i[0].y,Math.sin(da*ga)*i[0].x*k))),fa=0;fa<i.length;fa++)d=new j.x(Math.cos(da*ga)*i[fa].x*k,i[fa].y,Math.sin(da*ga)*i[fa].x*k),ha.push(d);P!=Ca.a.CAP_END&&P!=Ca.a.CAP_ALL||(ha.push(new j.x(Math.cos(da*ga)*i[i.length-1].x*k,i[i.length-1].y,Math.sin(da*ga)*i[i.length-1].x*k)),ha.push(new j.x(0,i[i.length-1].y,0))),U.push(ha)}return Ec.CreateRibbon(a,{pathArray:U,closeArray:h,sideOrientation:K,updatable:E,invertUV:_,frontUVs:b.frontUVs,backUVs:b.backUVs},c)},e}();Ca.a.CreateTube=function(e,a,b,c,d,f,h,i,k,m){var B={path:a,radius:b,tessellation:c,radiusFunction:d,arc:1,cap:f,updatable:i,sideOrientation:k,instance:m};return sf.CreateTube(e,B,h)};var sf=function(){function e(){}return e.CreateTube=function(a,b,c){void 0===c&&(c=null);var d=b.path,f=b.instance,h=1;void 0!==b.radius?h=b.radius:f&&(h=f._creationDataStorage.radius);var i=b.tessellation||64,k=b.radiusFunction||null,m=b.cap||Ca.a.NO_CAP,B=b.invertUV||!1,E=b.updatable,K=Ca.a._GetDefaultSideOrientation(b.sideOrientation);b.arc=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1;var P,S,U=function(ga,ha,ka,la,ma,ta,pa,ua){for(var wa,ya,Da,Ja,Na=ha.getTangents(),Ma=ha.getNormals(),Ha=ha.getDistances(),Qa=2*Math.PI/ma*ua,cb=ta||function(){return la},La=j.t.Matrix[0],Oa=pa===Ca.a.NO_CAP||pa===Ca.a.CAP_END?0:2,Ya=0;Ya<ga.length;Ya++){ya=cb(Ya,Ha[Ya]),wa=Array(),Da=Ma[Ya];for(var Ua=0;Ua<ma;Ua++)j.j.RotationAxisToRef(Na[Ya],Qa*Ua,La),Ja=wa[Ua]?wa[Ua]:j.x.Zero(),j.x.TransformCoordinatesToRef(Da,La,Ja),Ja.scaleInPlace(ya).addInPlace(ga[Ya]),wa[Ua]=Ja;ka[Oa]=wa,Oa++}var _a=function(db,ub){for(var eb=Array(),Va=0;Va<db;Va++)eb.push(ga[ub]);return eb};switch(pa){case Ca.a.NO_CAP:break;case Ca.a.CAP_START:ka[0]=_a(ma,0),ka[1]=ka[2].slice(0);break;case Ca.a.CAP_END:ka[Oa]=ka[Oa-1].slice(0),ka[Oa+1]=_a(ma,ga.length-1);break;case Ca.a.CAP_ALL:ka[0]=_a(ma,0),ka[1]=ka[2].slice(0),ka[Oa]=ka[Oa-1].slice(0),ka[Oa+1]=_a(ma,ga.length-1)}return ka};if(f){var _=f._creationDataStorage,da=b.arc||_.arc;return S=U(d,P=_.path3D.update(d),_.pathArray,h,_.tessellation,k,_.cap,da),f=Ec.CreateRibbon("",{pathArray:S,instance:f}),_.path3D=P,_.pathArray=S,_.arc=da,_.radius=h,f}S=U(d,P=new j.m(d),new Array(),h,i,k,m=m<0||m>3?0:m,b.arc);var fa=Ec.CreateRibbon(a,{pathArray:S,closePath:!0,closeArray:!1,updatable:E,sideOrientation:K,invertUV:B,frontUVs:b.frontUVs,backUVs:b.backUVs},c);return fa._creationDataStorage.pathArray=S,fa._creationDataStorage.path3D=P,fa._creationDataStorage.tessellation=i,fa._creationDataStorage.cap=m,fa._creationDataStorage.arc=b.arc,fa._creationDataStorage.radius=h,fa},e}();Wa.a.CreateIcoSphere=function(e){var a,b=e.sideOrientation||Wa.a.DEFAULTSIDE,c=e.radius||1,d=void 0===e.flat||e.flat,f=e.subdivisions||4,h=e.radiusX||c,i=e.radiusY||c,k=e.radiusZ||c,m=(1+Math.sqrt(5))/2,B=[-1,m,-0,1,m,0,-1,-m,0,1,-m,0,0,-1,-m,0,1,-m,0,-1,m,0,1,m,m,0,1,m,0,-1,-m,0,1,-m,0,-1],E=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],K=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],P=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],S=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],U=new Array(),_=new Array(),da=new Array(),fa=new Array(),ga=0,ha=new Array(3),ka=new Array(3);for(a=0;a<3;a++)ha[a]=j.x.Zero(),ka[a]=j.w.Zero();for(var la=0;la<20;la++){for(a=0;a<3;a++){var ma=E[3*la+a];ha[a].copyFromFloats(B[3*K[ma]],B[3*K[ma]+1],B[3*K[ma]+2]),ha[a].normalize().scaleInPlace(c),ka[a].copyFromFloats(P[2*ma]*(138/1024)+60/1024+S[la]*(-40/1024),P[2*ma+1]*(239/1024)+26/1024+S[la]*(20/1024))}for(var ta=function(ya,Da,Ja,Na){var Ma,Ha=j.x.Lerp(ha[0],ha[2],Da/f),Qa=j.x.Lerp(ha[1],ha[2],Da/f),cb=f===Da?ha[2]:j.x.Lerp(Ha,Qa,ya/(f-Da));if(cb.normalize(),d){var La=j.x.Lerp(ha[0],ha[2],Na/f),Oa=j.x.Lerp(ha[1],ha[2],Na/f);Ma=j.x.Lerp(La,Oa,Ja/(f-Na))}else Ma=new j.x(cb.x,cb.y,cb.z);Ma.x/=h,Ma.y/=i,Ma.z/=k,Ma.normalize();var Ya=j.w.Lerp(ka[0],ka[2],Da/f),Ua=j.w.Lerp(ka[1],ka[2],Da/f),_a=f===Da?ka[2]:j.w.Lerp(Ya,Ua,ya/(f-Da));_.push(cb.x*h,cb.y*i,cb.z*k),da.push(Ma.x,Ma.y,Ma.z),fa.push(_a.x,_a.y),U.push(ga),ga++},pa=0;pa<f;pa++)for(var ua=0;ua+pa<f;ua++)ta(ua,pa,ua+1/3,pa+1/3),ta(ua+1,pa,ua+1/3,pa+1/3),ta(ua,pa+1,ua+1/3,pa+1/3),ua+pa+1<f&&(ta(ua+1,pa,ua+2/3,pa+2/3),ta(ua+1,pa+1,ua+2/3,pa+2/3),ta(ua,pa+1,ua+2/3,pa+2/3))}Wa.a._ComputeSides(b,_,U,da,fa,e.frontUVs,e.backUVs);var wa=new Wa.a();return wa.indices=U,wa.positions=_,wa.normals=da,wa.uvs=fa,wa},Ca.a.CreateIcoSphere=function(e,a,b){return tf.CreateIcoSphere(e,a,b)};var tf=function(){function e(){}return e.CreateIcoSphere=function(a,b,c){void 0===c&&(c=null);var d=new Ca.a(a,c);return b.sideOrientation=Ca.a._GetDefaultSideOrientation(b.sideOrientation),d._originalBuilderSideOrientation=b.sideOrientation,Wa.a.CreateIcoSphere(b).applyToMesh(d,b.updatable),d},e}();Ca.a.CreateDecal=function(e,a,b,c,d,f){var h={position:b,normal:c,size:d,angle:f};return uf.CreateDecal(e,a,h)};var od,uf=function(){function e(){}return e.CreateDecal=function(a,b,c){var d=b.getIndices(),f=b.getVerticesData(na.b.PositionKind),h=b.getVerticesData(na.b.NormalKind),i=c.position||j.x.Zero(),k=c.normal||j.x.Up(),m=c.size||j.x.One(),B=c.angle||0;if(!k){var E=new j.x(0,0,1),K=b.getScene().activeCamera,P=j.x.TransformCoordinates(E,K.getWorldMatrix());k=K.globalPosition.subtract(P)}var S=-Math.atan2(k.z,k.x)-Math.PI/2,U=Math.sqrt(k.x*k.x+k.z*k.z),_=Math.atan2(k.y,U),da=j.j.RotationYawPitchRoll(S,_,B).multiply(j.j.Translation(i.x,i.y,i.z)),fa=j.j.Invert(da),ga=b.getWorldMatrix().multiply(fa),ha=new Wa.a();ha.indices=[],ha.positions=[],ha.normals=[],ha.uvs=[];for(var ka=0,la=function(Da){var Ja=new j.p();if(!d||!f||!h)return Ja;var Na=d[Da];return Ja.position=new j.x(f[3*Na],f[3*Na+1],f[3*Na+2]),Ja.position=j.x.TransformCoordinates(Ja.position,ga),Ja.normal=new j.x(h[3*Na],h[3*Na+1],h[3*Na+2]),Ja.normal=j.x.TransformNormal(Ja.normal,ga),Ja},ma=function(Da,Ja){if(0===Da.length)return Da;for(var Na=.5*Math.abs(j.x.Dot(m,Ja)),Ma=function(ub,eb){var Va=j.x.GetClipFactor(ub.position,eb.position,Ja,Na);return new j.p(j.x.Lerp(ub.position,eb.position,Va),j.x.Lerp(ub.normal,eb.normal,Va))},Ha=new Array(),Qa=0;Qa<Da.length;Qa+=3){var cb,La,Oa,Ya=null,Ua=null,_a=null,db=null;switch(((cb=j.x.Dot(Da[Qa].position,Ja)-Na>0)?1:0)+((La=j.x.Dot(Da[Qa+1].position,Ja)-Na>0)?1:0)+((Oa=j.x.Dot(Da[Qa+2].position,Ja)-Na>0)?1:0)){case 0:Ha.push(Da[Qa]),Ha.push(Da[Qa+1]),Ha.push(Da[Qa+2]);break;case 1:if(cb&&(Ya=Da[Qa+1],Ua=Da[Qa+2],_a=Ma(Da[Qa],Ya),db=Ma(Da[Qa],Ua)),La){Ya=Da[Qa],Ua=Da[Qa+2],_a=Ma(Da[Qa+1],Ya),db=Ma(Da[Qa+1],Ua),Ha.push(_a),Ha.push(Ua.clone()),Ha.push(Ya.clone()),Ha.push(Ua.clone()),Ha.push(_a.clone()),Ha.push(db);break}Oa&&(Ya=Da[Qa],Ua=Da[Qa+1],_a=Ma(Da[Qa+2],Ya),db=Ma(Da[Qa+2],Ua)),Ya&&Ua&&_a&&db&&(Ha.push(Ya.clone()),Ha.push(Ua.clone()),Ha.push(_a),Ha.push(db),Ha.push(_a.clone()),Ha.push(Ua.clone()));break;case 2:cb||(Ua=Ma(Ya=Da[Qa].clone(),Da[Qa+1]),_a=Ma(Ya,Da[Qa+2]),Ha.push(Ya),Ha.push(Ua),Ha.push(_a)),La||(Ua=Ma(Ya=Da[Qa+1].clone(),Da[Qa+2]),_a=Ma(Ya,Da[Qa]),Ha.push(Ya),Ha.push(Ua),Ha.push(_a)),Oa||(Ua=Ma(Ya=Da[Qa+2].clone(),Da[Qa]),_a=Ma(Ya,Da[Qa+1]),Ha.push(Ya),Ha.push(Ua),Ha.push(_a))}}return Ha},ta=0;ta<d.length;ta+=3){var pa=new Array();if(pa.push(la(ta)),pa.push(la(ta+1)),pa.push(la(ta+2)),pa=ma(pa,new j.x(1,0,0)),pa=ma(pa,new j.x(-1,0,0)),pa=ma(pa,new j.x(0,1,0)),pa=ma(pa,new j.x(0,-1,0)),pa=ma(pa,new j.x(0,0,1)),0!==(pa=ma(pa,new j.x(0,0,-1))).length)for(var ua=0;ua<pa.length;ua++){var wa=pa[ua];ha.indices.push(ka),wa.position.toArray(ha.positions,3*ka),wa.normal.toArray(ha.normals,3*ka),ha.uvs.push(.5+wa.position.x/m.x),ha.uvs.push(.5+wa.position.y/m.y),ka++}}var ya=new Ca.a(a,b.getScene());return ha.applyToMesh(ya),ya.position=i.clone(),ya.rotation=new j.x(_,S,B),ya},e}(),kk=function(){function e(){}return e.CreateBox=function(a,b,c){return void 0===c&&(c=null),cd.a.CreateBox(a,b,c)},e.CreateSphere=function(a,b,c){return void 0===c&&(c=null),lc.a.CreateSphere(a,b,c)},e.CreateDisc=function(a,b,c){return void 0===c&&(c=null),Vd.CreateDisc(a,b,c)},e.CreateIcoSphere=function(a,b,c){return void 0===c&&(c=null),tf.CreateIcoSphere(a,b,c)},e.CreateRibbon=function(a,b,c){return void 0===c&&(c=null),Ec.CreateRibbon(a,b,c)},e.CreateCylinder=function(a,b,c){return void 0===c&&(c=null),ad.a.CreateCylinder(a,b,c)},e.CreateTorus=function(a,b,c){return void 0===c&&(c=null),Je.CreateTorus(a,b,c)},e.CreateTorusKnot=function(a,b,c){return void 0===c&&(c=null),pf.CreateTorusKnot(a,b,c)},e.CreateLineSystem=function(a,b,c){return Kb.a.CreateLineSystem(a,b,c)},e.CreateLines=function(a,b,c){return void 0===c&&(c=null),Kb.a.CreateLines(a,b,c)},e.CreateDashedLines=function(a,b,c){return void 0===c&&(c=null),Kb.a.CreateDashedLines(a,b,c)},e.ExtrudeShape=function(a,b,c){return void 0===c&&(c=null),Qc.ExtrudeShape(a,b,c)},e.ExtrudeShapeCustom=function(a,b,c){return void 0===c&&(c=null),Qc.ExtrudeShapeCustom(a,b,c)},e.CreateLathe=function(a,b,c){return void 0===c&&(c=null),rf.CreateLathe(a,b,c)},e.CreatePlane=function(a,b,c){return void 0===c&&(c=null),Zg.a.CreatePlane(a,b,c)},e.CreateGround=function(a,b,c){return void 0===c&&(c=null),Dc.CreateGround(a,b,c)},e.CreateTiledGround=function(a,b,c){return void 0===c&&(c=null),Dc.CreateTiledGround(a,b,c)},e.CreateGroundFromHeightMap=function(a,b,c,d){return void 0===d&&(d=null),Dc.CreateGroundFromHeightMap(a,b,c,d)},e.CreatePolygon=function(a,b,c,d){return void 0===c&&(c=null),void 0===d&&(d=earcut),nd.CreatePolygon(a,b,c,d)},e.ExtrudePolygon=function(a,b,c,d){return void 0===c&&(c=null),void 0===d&&(d=earcut),nd.ExtrudePolygon(a,b,c,d)},e.CreateTube=function(a,b,c){return void 0===c&&(c=null),sf.CreateTube(a,b,c)},e.CreatePolyhedron=function(a,b,c){return void 0===c&&(c=null),ed.CreatePolyhedron(a,b,c)},e.CreateDecal=function(a,b,c){return uf.CreateDecal(a,b,c)},e}(),lk=function(){return function(e,a,b){this.quality=e,this.distance=a,this.optimizeMesh=b}}(),Jh=function(){function e(){this.running=!1,this._simplificationArray=[]}return e.prototype.addTask=function(a){this._simplificationArray.push(a)},e.prototype.executeNext=function(){var a=this._simplificationArray.pop();a?(this.running=!0,this.runSimplification(a)):this.running=!1},e.prototype.runSimplification=function(a){var b=this;if(a.parallelProcessing)a.settings.forEach(function(d){b.getSimplifier(a).simplify(d,function(f){a.mesh.addLODLevel(d.distance,f),f.isVisible=!0,d.quality===a.settings[a.settings.length-1].quality&&a.successCallback&&a.successCallback(),b.executeNext()})});else{var c=this.getSimplifier(a);xa.a.Run(a.settings.length,function(d){var f,h;f=a.settings[d.index],h=function(){d.executeNext()},c.simplify(f,function(i){a.mesh.addLODLevel(f.distance,i),i.isVisible=!0,h()})},function(){a.successCallback&&a.successCallback(),b.executeNext()})}},e.prototype.getSimplifier=function(a){switch(a.simplificationType){case od.QUADRATIC:default:return new pk(a.mesh)}},e}();!function(e){e[e.QUADRATIC=0]="QUADRATIC"}(od||(od={}));var mk=function(){return function(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}}(),nk=function(){function e(a,b){this.position=a,this.id=b,this.isBorder=!0,this.q=new Kh(),this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(a){this.position.copyFrom(a)},e}(),Kh=function(){function e(a){this.data=new Array(10);for(var b=0;b<10;++b)a&&a[b]?this.data[b]=a[b]:this.data[b]=0}return e.prototype.det=function(a,b,c,d,f,h,i,k,m){return this.data[a]*this.data[f]*this.data[m]+this.data[c]*this.data[d]*this.data[k]+this.data[b]*this.data[h]*this.data[i]-this.data[c]*this.data[f]*this.data[i]-this.data[a]*this.data[h]*this.data[k]-this.data[b]*this.data[d]*this.data[m]},e.prototype.addInPlace=function(a){for(var b=0;b<10;++b)this.data[b]+=a.data[b]},e.prototype.addArrayInPlace=function(a){for(var b=0;b<10;++b)this.data[b]+=a[b]},e.prototype.add=function(a){for(var b=new e(),c=0;c<10;++c)b.data[c]=this.data[c]+a.data[c];return b},e.FromData=function(a,b,c,d){return new e(e.DataFromNumbers(a,b,c,d))},e.DataFromNumbers=function(a,b,c,d){return[a*a,a*b,a*c,a*d,b*b,b*c,b*d,c*c,c*d,d*d]},e}(),ok=function(){return function(e,a){this.vertexId=e,this.triangleId=a}}(),pk=function(){function e(a){this._mesh=a,this.syncIterations=5000,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=j.h}return e.prototype.simplify=function(a,b){var c=this;this.initDecimatedMesh(),xa.a.Run(this._mesh.subMeshes.length,function(d){c.initWithMesh(d.index,function(){c.runDecimation(a,d.index,function(){d.executeNext()})},a.optimizeMesh)},function(){setTimeout(function(){b(c._reconstructedMesh)},0)})},e.prototype.runDecimation=function(a,b,c){var d=this,f=~~(this.triangles.length*a.quality),h=0,i=this.triangles.length;xa.a.Run(this.decimationIterations,function(k){var m,B;i-h<=f?k.breakLoop():(m=k.index,B=function(){k.executeNext()},setTimeout(function(){m%5==0&&d.updateMesh(0===m);for(var E=0;E<d.triangles.length;++E)d.triangles[E].isDirty=!1;var K=1e-09*Math.pow(m+3,d.aggressiveness);xa.a.SyncAsyncForLoop(d.triangles.length,d.syncIterations,function(P){var S=~~((d.triangles.length/2+P)%d.triangles.length),U=d.triangles[S];if(U&&!(U.error[3]>K||U.deleted||U.isDirty)){for(var _=0;_<3;++_)if(U.error[_]<K){var da=[],fa=[],ga=U.vertices[_],ha=U.vertices[(_+1)%3];if(ga.isBorder||ha.isBorder)continue;var ka=j.x.Zero();d.calculateError(ga,ha,ka);var la=new Array();if(d.isFlipped(ga,ha,ka,da,la))continue;if(d.isFlipped(ha,ga,ka,fa,la))continue;if(da.indexOf(!0)<0||fa.indexOf(!0)<0)continue;var ma=new Array();if(la.forEach(function(wa){-1===ma.indexOf(wa)&&(wa.deletePending=!0,ma.push(wa))}),ma.length%2!=0)continue;ga.q=ha.q.add(ga.q),ga.updatePosition(ka);var ta=d.references.length;h=d.updateTriangles(ga,ga,da,h),h=d.updateTriangles(ga,ha,fa,h);var pa=d.references.length-ta;if(pa<=ga.triangleCount){if(pa)for(var ua=0;ua<pa;ua++)d.references[ga.triangleStart+ua]=d.references[ta+ua]}else ga.triangleStart=ta;ga.triangleCount=pa;break}}},B,function(){return i-h<=f})},0))},function(){setTimeout(function(){d.reconstructMesh(b),c()},0)})},e.prototype.initWithMesh=function(a,b,c){var d=this;this.vertices=[],this.triangles=[];var f=this._mesh.getVerticesData(na.b.PositionKind),h=this._mesh.getIndices(),i=this._mesh.subMeshes[a],k=[],m=i.verticesCount;xa.a.SyncAsyncForLoop(m,this.syncIterations/4>>0,function(B){if(f){var E=B+i.verticesStart,K=j.x.FromArray(f,3*E),P=function(S){if(c){for(var U=0;U<d.vertices.length;++U)if(d.vertices[U].position.equals(S))return d.vertices[U]}return null}(K)||new nk(K,d.vertices.length);P.originalOffsets.push(E),P.id===d.vertices.length&&d.vertices.push(P),k.push(P.id)}},function(){xa.a.SyncAsyncForLoop(i.indexCount/3,d.syncIterations,function(B){if(h){var E=3*(i.indexStart/3+B),K=h[E+0],P=h[E+1],S=h[E+2],U=d.vertices[k[K-i.verticesStart]],_=d.vertices[k[P-i.verticesStart]],da=d.vertices[k[S-i.verticesStart]],fa=new mk([U,_,da]);fa.originalOffset=E,d.triangles.push(fa)}},function(){d.init(b)})})},e.prototype.init=function(a){var b=this;xa.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(c){var d=b.triangles[c];d.normal=j.x.Cross(d.vertices[1].position.subtract(d.vertices[0].position),d.vertices[2].position.subtract(d.vertices[0].position)).normalize();for(var f=0;f<3;f++)d.vertices[f].q.addArrayInPlace(Kh.DataFromNumbers(d.normal.x,d.normal.y,d.normal.z,-j.x.Dot(d.normal,d.vertices[0].position)))},function(){xa.a.SyncAsyncForLoop(b.triangles.length,b.syncIterations,function(c){for(var d=b.triangles[c],f=0;f<3;++f)d.error[f]=b.calculateError(d.vertices[f],d.vertices[(f+1)%3]);d.error[3]=Math.min(d.error[0],d.error[1],d.error[2])},function(){a()})})},e.prototype.reconstructMesh=function(a){var b,c,d,f=[];for(b=0;b<this.vertices.length;++b)this.vertices[b].triangleCount=0;for(b=0;b<this.triangles.length;++b)if(!this.triangles[b].deleted){for(c=this.triangles[b],d=0;d<3;++d)c.vertices[d].triangleCount=1;f.push(c)}var h=this._reconstructedMesh.getVerticesData(na.b.PositionKind)||[],i=this._reconstructedMesh.getVerticesData(na.b.NormalKind)||[],k=this._reconstructedMesh.getVerticesData(na.b.UVKind)||[],m=this._reconstructedMesh.getVerticesData(na.b.ColorKind)||[],B=this._mesh.getVerticesData(na.b.NormalKind),E=this._mesh.getVerticesData(na.b.UVKind),K=this._mesh.getVerticesData(na.b.ColorKind),P=0;for(b=0;b<this.vertices.length;++b){var S=this.vertices[b];S.id=P,S.triangleCount&&S.originalOffsets.forEach(function(ka){B&&(h.push(S.position.x),h.push(S.position.y),h.push(S.position.z),i.push(B[3*ka]),i.push(B[3*ka+1]),i.push(B[3*ka+2]),E&&E.length&&(k.push(E[2*ka]),k.push(E[2*ka+1])),K&&K.length&&(m.push(K[4*ka]),m.push(K[4*ka+1]),m.push(K[4*ka+2]),m.push(K[4*ka+3])),++P)})}var U=this._reconstructedMesh.getTotalIndices(),_=this._reconstructedMesh.getTotalVertices(),da=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var fa=this._reconstructedMesh.getIndices(),ga=this._mesh.getIndices();for(b=0;b<f.length;++b)c=f[b],[0,1,2].forEach(function(ka){var la=ga[c.originalOffset+ka],ma=c.vertices[ka].originalOffsets.indexOf(la);ma<0&&(ma=0),fa.push(c.vertices[ka].id+ma+_)});this._reconstructedMesh.setIndices(fa),this._reconstructedMesh.setVerticesData(na.b.PositionKind,h),this._reconstructedMesh.setVerticesData(na.b.NormalKind,i),k.length>0&&this._reconstructedMesh.setVerticesData(na.b.UVKind,k),m.length>0&&this._reconstructedMesh.setVerticesData(na.b.ColorKind,m);var ha=this._mesh.subMeshes[a];a>0&&(this._reconstructedMesh.subMeshes=[],da.forEach(function(ka){ld.b.AddToMesh(ka.materialIndex,ka.verticesStart,ka.verticesCount,ka.indexStart,ka.indexCount,ka.getMesh())}),ld.b.AddToMesh(ha.materialIndex,_,P,U,3*f.length,this._reconstructedMesh))},e.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new Ca.a(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},e.prototype.isFlipped=function(a,b,c,d,f){for(var h=0;h<a.triangleCount;++h){var i=this.triangles[this.references[a.triangleStart+h].triangleId];if(!i.deleted){var k=this.references[a.triangleStart+h].vertexId,m=i.vertices[(k+1)%3],B=i.vertices[(k+2)%3];if(m!==b&&B!==b){var E=m.position.subtract(c);E=E.normalize();var K=B.position.subtract(c);if(K=K.normalize(),Math.abs(j.x.Dot(E,K))>.999)return!0;var P=j.x.Cross(E,K).normalize();if(d[h]=!1,j.x.Dot(P,i.normal)<.2)return!0}else d[h]=!0,f.push(i)}}return!1},e.prototype.updateTriangles=function(a,b,c,d){for(var f=d,h=0;h<b.triangleCount;++h){var i=this.references[b.triangleStart+h],k=this.triangles[i.triangleId];k.deleted||(c[h]&&k.deletePending?(k.deleted=!0,f++):(k.vertices[i.vertexId]=a,k.isDirty=!0,k.error[0]=this.calculateError(k.vertices[0],k.vertices[1])+k.borderFactor/2,k.error[1]=this.calculateError(k.vertices[1],k.vertices[2])+k.borderFactor/2,k.error[2]=this.calculateError(k.vertices[2],k.vertices[0])+k.borderFactor/2,k.error[3]=Math.min(k.error[0],k.error[1],k.error[2]),this.references.push(i)))}return f},e.prototype.identifyBorder=function(){for(var a=0;a<this.vertices.length;++a){var b,c=[],d=[],f=this.vertices[a];for(b=0;b<f.triangleCount;++b)for(var h=this.triangles[this.references[f.triangleStart+b].triangleId],i=0;i<3;i++){for(var k=0,m=h.vertices[i];k<c.length&&d[k]!==m.id;)++k;k===c.length?(c.push(1),d.push(m.id)):c[k]++}for(b=0;b<c.length;++b)1===c[b]?this.vertices[d[b]].isBorder=!0:this.vertices[d[b]].isBorder=!1}},e.prototype.updateMesh=function(a){var b,c,d,f;if(void 0===a&&(a=!1),!a){var h=[];for(b=0;b<this.triangles.length;++b)this.triangles[b].deleted||h.push(this.triangles[b]);this.triangles=h}for(b=0;b<this.vertices.length;++b)this.vertices[b].triangleCount=0,this.vertices[b].triangleStart=0;for(b=0;b<this.triangles.length;++b)for(c=this.triangles[b],d=0;d<3;++d)(f=c.vertices[d]).triangleCount++;var i=0;for(b=0;b<this.vertices.length;++b)this.vertices[b].triangleStart=i,i+=this.vertices[b].triangleCount,this.vertices[b].triangleCount=0;var k=new Array(3*this.triangles.length);for(b=0;b<this.triangles.length;++b)for(c=this.triangles[b],d=0;d<3;++d)k[(f=c.vertices[d]).triangleStart+f.triangleCount]=new ok(d,b),f.triangleCount++;this.references=k,a&&this.identifyBorder()},e.prototype.vertexError=function(a,b){var c=b.x,d=b.y,f=b.z;return a.data[0]*c*c+2*a.data[1]*c*d+2*a.data[2]*c*f+2*a.data[3]*c+a.data[4]*d*d+2*a.data[5]*d*f+2*a.data[6]*d+a.data[7]*f*f+2*a.data[8]*f+a.data[9]},e.prototype.calculateError=function(a,b,c){var d=a.q.add(b.q),f=a.isBorder&&b.isBorder,h=0,i=d.det(0,1,2,1,4,5,2,5,7);if(0===i||f){var k=a.position.add(b.position).divide(new j.x(2,2,2)),m=this.vertexError(d,a.position),B=this.vertexError(d,b.position),E=this.vertexError(d,k);(h=Math.min(m,B,E))===m?c&&c.copyFrom(a.position):h===B?c&&c.copyFrom(b.position):c&&c.copyFrom(k)}else c||(c=j.x.Zero()),c.x=-1/i*d.det(1,2,3,4,5,6,5,7,8),c.y=1/i*d.det(0,2,3,1,5,6,2,7,8),c.z=-1/i*d.det(0,1,3,1,4,6,2,5,8),h=this.vertexError(d,c);return h},e}();Object.defineProperty(ja.a.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new Jh();var e=this._getComponent(Pa.a.NAME_SIMPLIFICATIONQUEUE);e||(e=new Lh(this),this._addComponent(e))}return this._simplificationQueue},set:function(e){this._simplificationQueue=e},enumerable:!0,configurable:!0}),Ca.a.prototype.simplify=function(e,a,b,c){return void 0===a&&(a=!0),void 0===b&&(b=od.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:e,parallelProcessing:a,mesh:this,simplificationType:b,successCallback:c}),this};var Lh=function(){function e(a){this.name=Pa.a.NAME_SIMPLIFICATIONQUEUE,this.scene=a}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(Pa.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},e}(),qk=l(110),rk=l(78),sk=l(73);va.b.OfflineProviderFactory=function(e,a,b){return void 0===b&&(b=!1),new Mh(e,a,b)};var Sc,Mh=function(){function e(a,b,c){var d=this;void 0===c&&(c=!1),this._idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this._callbackManifestChecked=b,this._currentSceneUrl=e._ReturnFullUrlLocation(a),this._db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this._manifestVersionFound=0,this._mustUpdateRessources=!1,this._hasReachedQuota=!1,e.IDBStorageEnabled?c?(this._enableSceneOffline=!0,this._enableTexturesOffline=!0,this._manifestVersionFound=1,xa.h.SetImmediate(function(){d._callbackManifestChecked(!0)})):this._checkManifestFile():this._callbackManifestChecked(!0)}return Object.defineProperty(e.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!0,configurable:!0}),e.prototype._checkManifestFile=function(){var a=this,b=function(){a._enableSceneOffline=!1,a._enableTexturesOffline=!1,a._callbackManifestChecked(!1)},c=!1,d=this._currentSceneUrl+".manifest",f=new kd.a();navigator.onLine&&(c=!0,d=d+(null==d.match(/\?/)?"?":"&")+Date.now()),f.open("GET",d),f.addEventListener("load",function(){if(200===f.status||e._ValidateXHRData(f,1))try{var h=JSON.parse(f.response);a._enableSceneOffline=h.enableSceneOffline,a._enableTexturesOffline=h.enableTexturesOffline&&e.IsUASupportingBlobStorage,h.version&&!isNaN(parseInt(h.version))&&(a._manifestVersionFound=h.version),a._callbackManifestChecked&&a._callbackManifestChecked(!0)}catch(i){b()}else b()},!1),f.addEventListener("error",function(){if(c){c=!1;var h=a._currentSceneUrl+".manifest";f.open("GET",h),f.send()}else b()},!1);try{f.send()}catch(h){r.a.Error("Error on XHR send request."),this._callbackManifestChecked(!1)}},e.prototype.open=function(a,b){var c=this,d=function(){c._isSupported=!1,b&&b()};if(this._idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this._db)a&&a();else{this._hasReachedQuota=!1,this._isSupported=!0;var f=this._idbFactory.open("babylonjs",1);f.onerror=function(){d()},f.onblocked=function(){r.a.Error("IDB request blocked. Please reload the page."),d()},f.onsuccess=function(){c._db=f.result,a()},f.onupgradeneeded=function(h){if(c._db=h.target.result,c._db)try{c._db.createObjectStore("scenes",{keyPath:"sceneUrl"}),c._db.createObjectStore("versions",{keyPath:"sceneUrl"}),c._db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(i){r.a.Error("Error while creating object stores. Exception: "+i.message),d()}}}else this._isSupported=!1,b&&b()},e.prototype.loadImage=function(a,b){var c=this,d=e._ReturnFullUrlLocation(a),f=function(){c._hasReachedQuota||null===c._db?b.src=a:c._saveImageIntoDBAsync(d,b)};this._mustUpdateRessources?f():this._loadImageFromDBAsync(d,b,f)},e.prototype._loadImageFromDBAsync=function(a,b,c){if(this._isSupported&&null!==this._db){var d,f=this._db.transaction(["textures"]);f.onabort=function(){b.src=a},f.oncomplete=function(){var i;if(d){var k=window.URL||window.webkitURL;i=k.createObjectURL(d.data),b.onerror=function(){r.a.Error("Error loading image from blob URL: "+i+" switching back to web url: "+a),b.src=a},b.src=i}else c()};var h=f.objectStore("textures").get(a);h.onsuccess=function(i){d=i.target.result},h.onerror=function(){r.a.Error("Error loading texture "+a+" from DB."),b.src=a}}else r.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b.src=a},e.prototype._saveImageIntoDBAsync=function(a,b){var c=this;if(this._isSupported){var d=function(){var i;if(f){var k=window.URL||window.webkitURL;try{i=k.createObjectURL(f)}catch(m){i=k.createObjectURL(f)}}i&&(b.src=i)};if(e.IsUASupportingBlobStorage){var f,h=new kd.a();h.open("GET",a),h.responseType="blob",h.addEventListener("load",function(){if(200===h.status&&c._db){f=h.response;var i=c._db.transaction(["textures"],"readwrite");i.onabort=function(B){try{var E=(B.srcElement||B.target).error;E&&"QuotaExceededError"===E.name&&(c._hasReachedQuota=!0)}catch(K){}d()},i.oncomplete=function(){d()};var k={textureUrl:a,data:f};try{var m=i.objectStore("textures").put(k);m.onsuccess=function(){},m.onerror=function(){d()}}catch(B){25===B.code&&(e.IsUASupportingBlobStorage=!1,c._enableTexturesOffline=!1),b.src=a}}else b.src=a},!1),h.addEventListener("error",function(){r.a.Error("Error in XHR request in BABYLON.Database."),b.src=a},!1),h.send()}else b.src=a}else r.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b.src=a},e.prototype._checkVersionFromDB=function(a,b){var c=this;this._loadVersionFromDBAsync(a,b,function(){c._saveVersionIntoDBAsync(a,b)})},e.prototype._loadVersionFromDBAsync=function(a,b,c){var d,f=this;if(this._isSupported&&this._db)try{var h=this._db.transaction(["versions"]);h.oncomplete=function(){d?f._manifestVersionFound!==d.data?(f._mustUpdateRessources=!0,c()):b(d.data):(f._mustUpdateRessources=!0,c())},h.onabort=function(){b(-1)};var i=h.objectStore("versions").get(a);i.onsuccess=function(k){d=k.target.result},i.onerror=function(){r.a.Error("Error loading version for scene "+a+" from DB."),b(-1)}}catch(k){r.a.Error("Error while accessing 'versions' object store (READ OP). Exception: "+k.message),b(-1)}else r.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b(-1)},e.prototype._saveVersionIntoDBAsync=function(a,b){var c=this;if(this._isSupported&&!this._hasReachedQuota&&this._db)try{var d=this._db.transaction(["versions"],"readwrite");d.onabort=function(i){try{var k=i.srcElement.error;k&&"QuotaExceededError"===k.name&&(c._hasReachedQuota=!0)}catch(m){}b(-1)},d.oncomplete=function(){b(c._manifestVersionFound)};var f={sceneUrl:a,data:this._manifestVersionFound},h=d.objectStore("versions").put(f);h.onsuccess=function(){},h.onerror=function(){r.a.Error("Error in DB add version request in BABYLON.Database.")}}catch(i){r.a.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+i.message),b(-1)}else b(-1)},e.prototype.loadFile=function(a,b,c,d,f){var h=this,i=e._ReturnFullUrlLocation(a),k=function(){h._saveFileAsync(i,b,c,f,d)};this._checkVersionFromDB(i,function(m){-1!==m?h._mustUpdateRessources?h._saveFileAsync(i,b,c,f,d):h._loadFileAsync(i,b,k):d&&d()})},e.prototype._loadFileAsync=function(a,b,c){if(this._isSupported&&this._db){var d,f;d=-1!==a.indexOf(".babylon")?"scenes":"textures";var h=this._db.transaction([d]);h.oncomplete=function(){f?b(f.data):c()},h.onabort=function(){c()};var i=h.objectStore(d).get(a);i.onsuccess=function(k){f=k.target.result},i.onerror=function(){r.a.Error("Error loading file "+a+" from DB."),c()}}else r.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b()},e.prototype._saveFileAsync=function(a,b,c,d,f){var h=this;if(this._isSupported){var i;i=-1!==a.indexOf(".babylon")?"scenes":"textures";var k,m=new kd.a();m.open("GET",a+"?"+Date.now()),d&&(m.responseType="arraybuffer"),c&&(m.onprogress=c),m.addEventListener("load",function(){if(200===m.status||m.status<400&&e._ValidateXHRData(m,d?6:1))if(k=d?m.response:m.responseText,!h._hasReachedQuota&&h._db){var B,E=h._db.transaction([i],"readwrite");E.onabort=function(P){try{var S=P.srcElement.error;S&&"QuotaExceededError"===S.name&&(h._hasReachedQuota=!0)}catch(U){}b(k)},E.oncomplete=function(){b(k)},B="scenes"===i?{sceneUrl:a,data:k,version:h._manifestVersionFound}:{textureUrl:a,data:k};try{var K=E.objectStore(i).put(B);K.onsuccess=function(){},K.onerror=function(){r.a.Error("Error in DB add file request in BABYLON.Database.")}}catch(P){b(k)}}else b(k);else m.status>=400&&f?f(m):b()},!1),m.addEventListener("error",function(){r.a.Error("error on XHR request."),b()},!1),m.send()}else r.a.Error("Error: IndexedDB not supported by your browser or Babylon.js Database is not open."),b()},e._ValidateXHRData=function(a,b){void 0===b&&(b=7);try{if(1&b){if(a.responseText&&a.responseText.length>0)return!0;if(1===b)return!1}if(2&b){var c=Td.GetTGAHeader(a.response);if(c.width&&c.height&&c.width>0&&c.height>0)return!0;if(2===b)return!1}if(4&b){var d=new Uint8Array(a.response,0,3);return 68===d[0]&&68===d[1]&&83===d[2]}}catch(f){}return!1},e.IsUASupportingBlobStorage=!0,e.IDBStorageEnabled=!1,e._ParseURL=function(a){document.createElement("a").href=a;var b=a.substring(0,a.lastIndexOf("#")),c=a.substring(b.lastIndexOf("/")+1,a.length);return a.substring(0,a.indexOf(c,0))},e._ReturnFullUrlLocation=function(a){return-1===a.indexOf("http:/")&&-1===a.indexOf("https:/")?e._ParseURL(window.location.href)+a:a},e}(),Tc=function(){function e(){this.direction1=new j.x(0,1,0),this.direction2=new j.x(0,1,0),this.minEmitBox=new j.x(-.5,-.5,-.5),this.maxEmitBox=new j.x(.5,.5,.5)}return e.prototype.startDirectionFunction=function(a,b,c){var d=p.a.RandomRange(this.direction1.x,this.direction2.x),f=p.a.RandomRange(this.direction1.y,this.direction2.y),h=p.a.RandomRange(this.direction1.z,this.direction2.z);j.x.TransformNormalFromFloatsToRef(d,f,h,a,b)},e.prototype.startPositionFunction=function(a,b,c){var d=p.a.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),f=p.a.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),h=p.a.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);j.x.TransformCoordinatesFromFloatsToRef(d,f,h,a,b)},e.prototype.clone=function(){var a=new e();return V.a.DeepCopy(this,a),a},e.prototype.applyToShader=function(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2),a.setVector3("minEmitBox",this.minEmitBox),a.setVector3("maxEmitBox",this.maxEmitBox)},e.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},e.prototype.getClassName=function(){return"BoxParticleEmitter"},e.prototype.serialize=function(){var a={};return a.type=this.getClassName(),a.direction1=this.direction1.asArray(),a.direction2=this.direction2.asArray(),a.minEmitBox=this.minEmitBox.asArray(),a.maxEmitBox=this.maxEmitBox.asArray(),a},e.prototype.parse=function(a){j.x.FromArrayToRef(a.direction1,0,this.direction1),j.x.FromArrayToRef(a.direction2,0,this.direction2),j.x.FromArrayToRef(a.minEmitBox,0,this.minEmitBox),j.x.FromArrayToRef(a.maxEmitBox,0,this.maxEmitBox)},e}(),vf=function(){function e(a,b,c){void 0===a&&(a=1),void 0===b&&(b=Math.PI),void 0===c&&(c=0),this.directionRandomizer=c,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=b,this.radius=a}return Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a,this._buildHeight()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(a){this._angle=a,this._buildHeight()},enumerable:!0,configurable:!0}),e.prototype._buildHeight=function(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1},e.prototype.startDirectionFunction=function(a,b,c){if(1===Math.abs(Math.cos(this._angle)))j.x.TransformNormalFromFloatsToRef(0,1,0,a,b);else{var d=c.position.subtract(a.getTranslation()).normalize(),f=p.a.RandomRange(0,this.directionRandomizer),h=p.a.RandomRange(0,this.directionRandomizer),i=p.a.RandomRange(0,this.directionRandomizer);d.x+=f,d.y+=h,d.z+=i,d.normalize(),j.x.TransformNormalFromFloatsToRef(d.x,d.y,d.z,a,b)}},e.prototype.startPositionFunction=function(a,b,c){var d,f=p.a.RandomRange(0,2*Math.PI);d=this.emitFromSpawnPointOnly?.0001:1-(d=p.a.RandomRange(0,this.heightRange))*d;var h=this._radius-p.a.RandomRange(0,this._radius*this.radiusRange),i=(h*=d)*Math.sin(f),k=h*Math.cos(f),m=d*this._height;j.x.TransformCoordinatesFromFloatsToRef(i,m,k,a,b)},e.prototype.clone=function(){var a=new e(this._radius,this._angle,this.directionRandomizer);return V.a.DeepCopy(this,a),a},e.prototype.applyToShader=function(a){a.setFloat2("radius",this._radius,this.radiusRange),a.setFloat("coneAngle",this._angle),a.setFloat2("height",this._height,this.heightRange),a.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){var a="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(a+=`
#define CONEEMITTERSPAWNPOINT`),a},e.prototype.getClassName=function(){return"ConeParticleEmitter"},e.prototype.serialize=function(){var a={};return a.type=this.getClassName(),a.radius=this._radius,a.angle=this._angle,a.directionRandomizer=this.directionRandomizer,a},e.prototype.parse=function(a){this.radius=a.radius,this.angle=a.angle,this.directionRandomizer=a.directionRandomizer},e}(),Wd=function(){function e(a,b,c,d){void 0===a&&(a=1),void 0===b&&(b=1),void 0===c&&(c=1),void 0===d&&(d=0),this.radius=a,this.height=b,this.radiusRange=c,this.directionRandomizer=d}return e.prototype.startDirectionFunction=function(a,b,c){var d=c.position.subtract(a.getTranslation()).normalize(),f=p.a.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),h=Math.atan2(d.x,d.z);h+=p.a.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,d.y=f,d.x=Math.sin(h),d.z=Math.cos(h),d.normalize(),j.x.TransformNormalFromFloatsToRef(d.x,d.y,d.z,a,b)},e.prototype.startPositionFunction=function(a,b,c){var d=p.a.RandomRange(-this.height/2,this.height/2),f=p.a.RandomRange(0,2*Math.PI),h=p.a.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),i=Math.sqrt(h)*this.radius,k=i*Math.cos(f),m=i*Math.sin(f);j.x.TransformCoordinatesFromFloatsToRef(k,d,m,a,b)},e.prototype.clone=function(){var a=new e(this.radius,this.directionRandomizer);return V.a.DeepCopy(this,a),a},e.prototype.applyToShader=function(a){a.setFloat("radius",this.radius),a.setFloat("height",this.height),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},e.prototype.getClassName=function(){return"CylinderParticleEmitter"},e.prototype.serialize=function(){var a={};return a.type=this.getClassName(),a.radius=this.radius,a.height=this.height,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a},e.prototype.parse=function(a){this.radius=a.radius,this.height=a.height,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer},e}(),Nh=function(e){function a(b,c,d,f,h){void 0===b&&(b=1),void 0===c&&(c=1),void 0===d&&(d=1),void 0===f&&(f=new j.x(0,1,0)),void 0===h&&(h=new j.x(0,1,0));var i=e.call(this,b,c,d)||this;return i.direction1=f,i.direction2=h,i}return v.d(a,e),a.prototype.startDirectionFunction=function(b,c,d){var f=p.a.RandomRange(this.direction1.x,this.direction2.x),h=p.a.RandomRange(this.direction1.y,this.direction2.y),i=p.a.RandomRange(this.direction1.z,this.direction2.z);j.x.TransformNormalFromFloatsToRef(f,h,i,b,c)},a.prototype.clone=function(){var b=new a(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return V.a.DeepCopy(this,b),b},a.prototype.applyToShader=function(b){b.setFloat("radius",this.radius),b.setFloat("height",this.height),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)},a.prototype.getEffectDefines=function(){return`#define CYLINDEREMITTER
#define DIRECTEDCYLINDEREMITTER`},a.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},a.prototype.serialize=function(){var b=e.prototype.serialize.call(this);return b.direction1=this.direction1.asArray(),b.direction2=this.direction2.asArray(),b},a.prototype.parse=function(b){e.prototype.parse.call(this,b),this.direction1.copyFrom(b.direction1),this.direction2.copyFrom(b.direction2)},a}(Wd),wf=function(){function e(a,b,c){void 0===a&&(a=1),void 0===b&&(b=1),void 0===c&&(c=0),this.radius=a,this.radiusRange=b,this.directionRandomizer=c}return e.prototype.startDirectionFunction=function(a,b,c){var d=c.position.subtract(a.getTranslation()).normalize(),f=p.a.RandomRange(0,this.directionRandomizer),h=p.a.RandomRange(0,this.directionRandomizer),i=p.a.RandomRange(0,this.directionRandomizer);d.x+=f,d.y+=h,d.z+=i,d.normalize(),j.x.TransformNormalFromFloatsToRef(d.x,d.y,d.z,a,b)},e.prototype.startPositionFunction=function(a,b,c){var d=this.radius-p.a.RandomRange(0,this.radius*this.radiusRange),f=p.a.RandomRange(0,1),h=p.a.RandomRange(0,2*Math.PI),i=Math.acos(2*f-1),k=d*Math.cos(h)*Math.sin(i),m=d*Math.cos(i),B=d*Math.sin(h)*Math.sin(i);j.x.TransformCoordinatesFromFloatsToRef(k,Math.abs(m),B,a,b)},e.prototype.clone=function(){var a=new e(this.radius,this.directionRandomizer);return V.a.DeepCopy(this,a),a},e.prototype.applyToShader=function(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},e.prototype.getClassName=function(){return"HemisphericParticleEmitter"},e.prototype.serialize=function(){var a={};return a.type=this.getClassName(),a.radius=this.radius,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a},e.prototype.parse=function(a){this.radius=a.radius,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer},e}(),Oh=function(){function e(){this.direction1=new j.x(0,1,0),this.direction2=new j.x(0,1,0)}return e.prototype.startDirectionFunction=function(a,b,c){var d=p.a.RandomRange(this.direction1.x,this.direction2.x),f=p.a.RandomRange(this.direction1.y,this.direction2.y),h=p.a.RandomRange(this.direction1.z,this.direction2.z);j.x.TransformNormalFromFloatsToRef(d,f,h,a,b)},e.prototype.startPositionFunction=function(a,b,c){j.x.TransformCoordinatesFromFloatsToRef(0,0,0,a,b)},e.prototype.clone=function(){var a=new e();return V.a.DeepCopy(this,a),a},e.prototype.applyToShader=function(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)},e.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},e.prototype.getClassName=function(){return"PointParticleEmitter"},e.prototype.serialize=function(){var a={};return a.type=this.getClassName(),a.direction1=this.direction1.asArray(),a.direction2=this.direction2.asArray(),a},e.prototype.parse=function(a){j.x.FromArrayToRef(a.direction1,0,this.direction1),j.x.FromArrayToRef(a.direction2,0,this.direction2)},e}(),Xd=function(){function e(a,b,c){void 0===a&&(a=1),void 0===b&&(b=1),void 0===c&&(c=0),this.radius=a,this.radiusRange=b,this.directionRandomizer=c}return e.prototype.startDirectionFunction=function(a,b,c){var d=c.position.subtract(a.getTranslation()).normalize(),f=p.a.RandomRange(0,this.directionRandomizer),h=p.a.RandomRange(0,this.directionRandomizer),i=p.a.RandomRange(0,this.directionRandomizer);d.x+=f,d.y+=h,d.z+=i,d.normalize(),j.x.TransformNormalFromFloatsToRef(d.x,d.y,d.z,a,b)},e.prototype.startPositionFunction=function(a,b,c){var d=this.radius-p.a.RandomRange(0,this.radius*this.radiusRange),f=p.a.RandomRange(0,1),h=p.a.RandomRange(0,2*Math.PI),i=Math.acos(2*f-1),k=d*Math.cos(h)*Math.sin(i),m=d*Math.cos(i),B=d*Math.sin(h)*Math.sin(i);j.x.TransformCoordinatesFromFloatsToRef(k,m,B,a,b)},e.prototype.clone=function(){var a=new e(this.radius,this.directionRandomizer);return V.a.DeepCopy(this,a),a},e.prototype.applyToShader=function(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},e.prototype.getClassName=function(){return"SphereParticleEmitter"},e.prototype.serialize=function(){var a={};return a.type=this.getClassName(),a.radius=this.radius,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a},e.prototype.parse=function(a){this.radius=a.radius,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer},e}(),xf=function(e){function a(b,c,d){void 0===b&&(b=1),void 0===c&&(c=new j.x(0,1,0)),void 0===d&&(d=new j.x(0,1,0));var f=e.call(this,b)||this;return f.direction1=c,f.direction2=d,f}return v.d(a,e),a.prototype.startDirectionFunction=function(b,c,d){var f=p.a.RandomRange(this.direction1.x,this.direction2.x),h=p.a.RandomRange(this.direction1.y,this.direction2.y),i=p.a.RandomRange(this.direction1.z,this.direction2.z);j.x.TransformNormalFromFloatsToRef(f,h,i,b,c)},a.prototype.clone=function(){var b=new a(this.radius,this.direction1,this.direction2);return V.a.DeepCopy(this,b),b},a.prototype.applyToShader=function(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)},a.prototype.getEffectDefines=function(){return`#define SPHEREEMITTER
#define DIRECTEDSPHEREEMITTER`},a.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},a.prototype.serialize=function(){var b=e.prototype.serialize.call(this);return b.direction1=this.direction1.asArray(),b.direction2=this.direction2.asArray(),b},a.prototype.parse=function(b){e.prototype.parse.call(this,b),this.direction1.copyFrom(b.direction1),this.direction2.copyFrom(b.direction2)},a}(Xd),yf=function(){function e(a){this.animations=[],this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new j.x(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new j.w(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new j.x(0,0,0),this.gravity=j.x.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new j.f(1,1,1,1),this.color2=new j.f(1,1,1,1),this.colorDead=new j.f(0,0,0,1),this.textureMask=new j.f(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=o.a.PARTICLES_BILLBOARDMODE_ALL,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Eb.b(),this.id=a,this.name=a}return Object.defineProperty(e.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(a){this._noiseTexture!==a&&(this._noiseTexture=a,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(a){this._isAnimationSheetEnabled!=a&&(this._isAnimationSheetEnabled=a,this._reset())},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},e.prototype.getDragGradients=function(){return this._dragGradients},e.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},e.prototype.getColorGradients=function(){return this._colorGradients},e.prototype.getSizeGradients=function(){return this._sizeGradients},e.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},e.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},e.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},e.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},e.prototype.getVelocityGradients=function(){return this._velocityGradients},e.prototype.getStartSizeGradients=function(){return this._startSizeGradients},e.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(e.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:j.x.Zero()},set:function(a){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:j.x.Zero()},set:function(a){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:j.x.Zero()},set:function(a){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:j.x.Zero()},set:function(a){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(a){this._isBillboardBased!==a&&(this._isBillboardBased=a,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(a){this._attachImageProcessingConfiguration(a)},enumerable:!0,configurable:!0}),e.prototype._attachImageProcessingConfiguration=function(a){a!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration=a||this._scene.imageProcessingConfiguration)},e.prototype._reset=function(){},e.prototype._removeGradientAndTexture=function(a,b,c){if(!b)return this;for(var d=0,f=0,h=b;f<h.length;f++){if(h[f].gradient===a){b.splice(d,1);break}d++}return c&&c.dispose(),this},e.prototype.createPointEmitter=function(a,b){var c=new Oh();return c.direction1=a,c.direction2=b,this.particleEmitterType=c,c},e.prototype.createHemisphericEmitter=function(a,b){void 0===a&&(a=1),void 0===b&&(b=1);var c=new wf(a,b);return this.particleEmitterType=c,c},e.prototype.createSphereEmitter=function(a,b){void 0===a&&(a=1),void 0===b&&(b=1);var c=new Xd(a,b);return this.particleEmitterType=c,c},e.prototype.createDirectedSphereEmitter=function(a,b,c){void 0===a&&(a=1),void 0===b&&(b=new j.x(0,1,0)),void 0===c&&(c=new j.x(0,1,0));var d=new xf(a,b,c);return this.particleEmitterType=d,d},e.prototype.createCylinderEmitter=function(a,b,c,d){void 0===a&&(a=1),void 0===b&&(b=1),void 0===c&&(c=1),void 0===d&&(d=0);var f=new Wd(a,b,c,d);return this.particleEmitterType=f,f},e.prototype.createDirectedCylinderEmitter=function(a,b,c,d,f){void 0===a&&(a=1),void 0===b&&(b=1),void 0===c&&(c=1),void 0===d&&(d=new j.x(0,1,0)),void 0===f&&(f=new j.x(0,1,0));var h=new Nh(a,b,c,d,f);return this.particleEmitterType=h,h},e.prototype.createConeEmitter=function(a,b){void 0===a&&(a=1),void 0===b&&(b=Math.PI/4);var c=new vf(a,b);return this.particleEmitterType=c,c},e.prototype.createBoxEmitter=function(a,b,c,d){var f=new Tc();return this.particleEmitterType=f,this.direction1=a,this.direction2=b,this.minEmitBox=c,this.maxEmitBox=d,f},e.BLENDMODE_ONEONE=0,e.BLENDMODE_STANDARD=1,e.BLENDMODE_ADD=2,e.BLENDMODE_MULTIPLY=3,e.BLENDMODE_MULTIPLYADD=4,e}(),Ph=function(){function e(a){this.particleSystem=a,this.position=j.x.Zero(),this.direction=j.x.Zero(),this.color=new j.f(0,0,0,0),this.colorStep=new j.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new j.w(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new j.f(0,0,0,0),this._currentColor2=new j.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=e._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return e.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},e.prototype.updateCellIndex=function(){var a=this.age,b=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===b?(b=1,a=this._randomCellOffset):a+=this._randomCellOffset);var c=this._initialEndSpriteCellID-this._initialStartSpriteCellID,d=p.a.Clamp(a*b%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+d*c|0},e.prototype._inheritParticleInfoToSubEmitter=function(a){if(a.particleSystem.emitter.position){var b=a.particleSystem.emitter;b.position.copyFrom(this.position),a.inheritDirection&&(b.position.subtractToRef(this.direction,j.t.Vector3[0]),b.lookAt(j.t.Vector3[0],0,Math.PI/2))}else a.particleSystem.emitter.copyFrom(this.position);this.direction.scaleToRef(a.inheritedVelocityAmount/2,j.t.Vector3[0]),a.particleSystem._inheritedVelocityOffset.copyFrom(j.t.Vector3[0])},e.prototype._inheritParticleInfoToSubEmitters=function(){var a=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach(function(b){a._inheritParticleInfoToSubEmitter(b)})},e.prototype._reset=function(){this.age=0,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},e.prototype.copyTo=function(a){a.position.copyFrom(this.position),this._initialDirection?a._initialDirection?a._initialDirection.copyFrom(this._initialDirection):a._initialDirection=this._initialDirection.clone():a._initialDirection=null,a.direction.copyFrom(this.direction),a.color.copyFrom(this.color),a.colorStep.copyFrom(this.colorStep),a.lifeTime=this.lifeTime,a.age=this.age,a._randomCellOffset=this._randomCellOffset,a.size=this.size,a.scale.copyFrom(this.scale),a.angle=this.angle,a.angularSpeed=this.angularSpeed,a.particleSystem=this.particleSystem,a.cellIndex=this.cellIndex,a.id=this.id,a._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(a._currentColorGradient=this._currentColorGradient,a._currentColor1.copyFrom(this._currentColor1),a._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(a._currentSizeGradient=this._currentSizeGradient,a._currentSize1=this._currentSize1,a._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(a._currentAngularSpeedGradient=this._currentAngularSpeedGradient,a._currentAngularSpeed1=this._currentAngularSpeed1,a._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(a._currentVelocityGradient=this._currentVelocityGradient,a._currentVelocity1=this._currentVelocity1,a._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(a._currentLimitVelocityGradient=this._currentLimitVelocityGradient,a._currentLimitVelocity1=this._currentLimitVelocity1,a._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(a._currentDragGradient=this._currentDragGradient,a._currentDrag1=this._currentDrag1,a._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(a._initialStartSpriteCellID=this._initialStartSpriteCellID,a._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&a.remapData.copyFrom(this.remapData),this._randomNoiseCoordinates1&&(a._randomNoiseCoordinates1?(a._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),a._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(a._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),a._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},e._Count=0,e}();!function(e){e[e.ATTACHED=0]="ATTACHED",e[e.END=1]="END"}(Sc||(Sc={}));var pd=function(){function e(a){this.particleSystem=a,this.type=Sc.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,a.emitter&&a.emitter.dispose||(a.emitter=new kb.a("SubemitterSystemEmitter",a.getScene())),a.onDisposeObservable.add(function(){a.emitter&&a.emitter.dispose&&a.emitter.dispose()})}return e.prototype.clone=function(){var a=this.particleSystem.emitter;a?a instanceof j.x?a=a.clone():a instanceof kb.a&&((a=new Ca.a("",a.getScene())).isVisible=!1):a=new j.x();var b=new e(this.particleSystem.clone("",a));return b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem._disposeEmitterOnDispose=!0,b.particleSystem.disposeOnStop=!0,b},e.prototype.serialize=function(){var a={};return a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem=this.particleSystem.serialize(),a},e._ParseParticleSystem=function(a,b,c){throw Zb.a.WarnImport("ParseParticle")},e.Parse=function(a,b,c){var d=a.particleSystem,f=new e(e._ParseParticleSystem(d,b,c));return f.type=a.type,f.inheritDirection=a.inheritDirection,f.inheritedVelocityAmount=a.inheritedVelocityAmount,f.particleSystem._isSubEmitter=!0,f},e.prototype.dispose=function(){this.particleSystem.dispose()},e}(),tk=`
varying vec2 vUV;
varying vec4 vColor;
uniform vec4 textureMask;
uniform sampler2D diffuseSampler;
#include<clipPlaneFragmentDeclaration>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
uniform sampler2D rampSampler;
#endif
void main(void) {
#include<clipPlaneFragment>
vec4 textureColor=texture2D(diffuseSampler,vUV);
vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;
#ifdef RAMPGRADIENT
float alpha=baseColor.a;
float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);
vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));
baseColor.rgb*=rampColor.rgb;

float finalAlpha=baseColor.a;
baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);
#endif
#ifdef BLENDMULTIPLYMODE
float sourceAlpha=vColor.a*textureColor.a;
baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
baseColor.rgb=toLinearSpace(baseColor.rgb);
#else
#ifdef IMAGEPROCESSING
baseColor.rgb=toLinearSpace(baseColor.rgb);
baseColor=applyImageProcessing(baseColor);
#endif
#endif
gl_FragColor=baseColor;
}`;Ia.a.ShadersStore.particlesPixelShader=tk;var uk=`
attribute vec3 position;
attribute vec4 color;
attribute float angle;
attribute vec2 size;
#ifdef ANIMATESHEET
attribute float cellIndex;
#endif
#ifndef BILLBOARD
attribute vec3 direction;
#endif
#ifdef BILLBOARDSTRETCHED
attribute vec3 direction;
#endif
#ifdef RAMPGRADIENT
attribute vec4 remapData;
#endif
attribute vec2 offset;

uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
#ifdef ANIMATESHEET
uniform vec3 particlesInfos;
#endif

varying vec2 vUV;
varying vec4 vColor;
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
#endif
#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration>
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#endif
void main(void) {
vec2 cornerPos;
cornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;
#ifdef BILLBOARD

vec3 rotatedCorner;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=position-eyePosition;
yaxis.y=0.;
vec3 worldPos=rotate(normalize(yaxis),rotatedCorner);
vec3 viewPos=(view*vec4(worldPos,1.0)).xyz;
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=position-eyePosition;
vec3 worldPos=rotateAlign(toCamera,rotatedCorner);
vec3 viewPos=(view*vec4(worldPos,1.0)).xyz;
#else
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;
#endif
#ifdef RAMPGRADIENT
remapRanges=remapData;
#endif

gl_Position=projection*vec4(viewPos,1.0);
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=normalize(direction);
vec3 worldPos=rotate(yaxis,rotatedCorner);
gl_Position=projection*view*vec4(worldPos,1.0);
#endif
vColor=color;
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex/particlesInfos.z);
float columnOffset=cellIndex-rowOffset*particlesInfos.z;
vec2 uvScale=particlesInfos.xy;
vec2 uvOffset=vec2(offset.x ,1.0-offset.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=offset;
#endif

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)
vec4 worldPos=invView*vec4(viewPos,1.0);
#endif
#include<clipPlaneVertex>
}`;Ia.a.ShadersStore.particlesVertexShader=uk;var Jb=function(e){function a(b,c,d,f,h,i){void 0===f&&(f=null),void 0===h&&(h=!1),void 0===i&&(i=.01);var k=e.call(this,b)||this;return k._inheritedVelocityOffset=new j.x(),k.onDisposeObservable=new q.c(),k._particles=new Array(),k._stockParticles=new Array(),k._newPartsExcess=0,k._vertexBuffers={},k._scaledColorStep=new j.f(0,0,0,0),k._colorDiff=new j.f(0,0,0,0),k._scaledDirection=j.x.Zero(),k._scaledGravity=j.x.Zero(),k._currentRenderId=-1,k._useInstancing=!1,k._started=!1,k._stopped=!1,k._actualFrame=0,k._currentEmitRate1=0,k._currentEmitRate2=0,k._currentStartSize1=0,k._currentStartSize2=0,k._rawTextureWidth=256,k._useRampGradients=!1,k._disposeEmitterOnDispose=!1,k.recycleParticle=function(m){var B=k._particles.pop();B!==m&&B.copyTo(m),k._stockParticles.push(B)},k._createParticle=function(){var m;if(0!==k._stockParticles.length?(m=k._stockParticles.pop())._reset():m=new Ph(k),k._subEmitters&&k._subEmitters.length>0){var B=k._subEmitters[Math.floor(Math.random()*k._subEmitters.length)];m._attachedSubEmitters=[],B.forEach(function(E){if(E.type===Sc.ATTACHED){var K=E.clone();m._attachedSubEmitters.push(K),K.particleSystem.start()}})}return m},k._emitFromParticle=function(m){if(k._subEmitters&&0!==k._subEmitters.length){var B=Math.floor(Math.random()*k._subEmitters.length);k._subEmitters[B].forEach(function(E){if(E.type===Sc.END){var K=E.clone();m._inheritParticleInfoToSubEmitter(K),K.particleSystem._rootParticleSystem=k,k.activeSubSystems.push(K.particleSystem),K.particleSystem.start()}})}},k._capacity=c,k._epsilon=i,k._isAnimationSheetEnabled=h,k._scene=d||T.a.LastCreatedScene,k._attachImageProcessingConfiguration(null),k._customEffect=f,k._scene.particleSystems.push(k),k._useInstancing=k._scene.getEngine().getCaps().instancedArrays,k._createIndexBuffer(),k._createVertexBuffers(),k.particleEmitterType=new Tc(),k.updateFunction=function(m){var B=null,E=null;k.noiseTexture&&(B=k.noiseTexture.getSize(),E=k.noiseTexture.getContent());for(var K,P=function(){K=m[S];var U=k._scaledUpdateSpeed,_=K.age;if(K.age+=U,K.age>K.lifeTime){var da=K.age-_;U=(K.lifeTime-_)*U/da,K.age=K.lifeTime}var fa=K.age/K.lifeTime;k._colorGradients&&k._colorGradients.length>0?xa.h.GetCurrentGradient(fa,k._colorGradients,function(pa,ua,wa){pa!==K._currentColorGradient&&(K._currentColor1.copyFrom(K._currentColor2),ua.getColorToRef(K._currentColor2),K._currentColorGradient=pa),j.f.LerpToRef(K._currentColor1,K._currentColor2,wa,K.color)}):(K.colorStep.scaleToRef(U,k._scaledColorStep),K.color.addInPlace(k._scaledColorStep),K.color.a<0&&(K.color.a=0)),k._angularSpeedGradients&&k._angularSpeedGradients.length>0&&xa.h.GetCurrentGradient(fa,k._angularSpeedGradients,function(pa,ua,wa){pa!==K._currentAngularSpeedGradient&&(K._currentAngularSpeed1=K._currentAngularSpeed2,K._currentAngularSpeed2=ua.getFactor(),K._currentAngularSpeedGradient=pa),K.angularSpeed=p.a.Lerp(K._currentAngularSpeed1,K._currentAngularSpeed2,wa)}),K.angle+=K.angularSpeed*U;var ga=U;if(k._velocityGradients&&k._velocityGradients.length>0&&xa.h.GetCurrentGradient(fa,k._velocityGradients,function(pa,ua,wa){pa!==K._currentVelocityGradient&&(K._currentVelocity1=K._currentVelocity2,K._currentVelocity2=ua.getFactor(),K._currentVelocityGradient=pa),ga*=p.a.Lerp(K._currentVelocity1,K._currentVelocity2,wa)}),K.direction.scaleToRef(ga,k._scaledDirection),k._limitVelocityGradients&&k._limitVelocityGradients.length>0&&xa.h.GetCurrentGradient(fa,k._limitVelocityGradients,function(pa,ua,wa){pa!==K._currentLimitVelocityGradient&&(K._currentLimitVelocity1=K._currentLimitVelocity2,K._currentLimitVelocity2=ua.getFactor(),K._currentLimitVelocityGradient=pa);var ya=p.a.Lerp(K._currentLimitVelocity1,K._currentLimitVelocity2,wa);K.direction.length()>ya&&K.direction.scaleInPlace(k.limitVelocityDamping)}),k._dragGradients&&k._dragGradients.length>0&&xa.h.GetCurrentGradient(fa,k._dragGradients,function(pa,ua,wa){pa!==K._currentDragGradient&&(K._currentDrag1=K._currentDrag2,K._currentDrag2=ua.getFactor(),K._currentDragGradient=pa);var ya=p.a.Lerp(K._currentDrag1,K._currentDrag2,wa);k._scaledDirection.scaleInPlace(1-ya)}),K.position.addInPlace(k._scaledDirection),E&&B&&K._randomNoiseCoordinates1){var ha=k._fetchR(K._randomNoiseCoordinates1.x,K._randomNoiseCoordinates1.y,B.width,B.height,E),ka=k._fetchR(K._randomNoiseCoordinates1.z,K._randomNoiseCoordinates2.x,B.width,B.height,E),la=k._fetchR(K._randomNoiseCoordinates2.y,K._randomNoiseCoordinates2.z,B.width,B.height,E),ma=j.t.Vector3[0],ta=j.t.Vector3[1];ma.copyFromFloats((2*ha-1)*k.noiseStrength.x,(2*ka-1)*k.noiseStrength.y,(2*la-1)*k.noiseStrength.z),ma.scaleToRef(U,ta),K.direction.addInPlace(ta)}if(k.gravity.scaleToRef(U,k._scaledGravity),K.direction.addInPlace(k._scaledGravity),k._sizeGradients&&k._sizeGradients.length>0&&xa.h.GetCurrentGradient(fa,k._sizeGradients,function(pa,ua,wa){pa!==K._currentSizeGradient&&(K._currentSize1=K._currentSize2,K._currentSize2=ua.getFactor(),K._currentSizeGradient=pa),K.size=p.a.Lerp(K._currentSize1,K._currentSize2,wa)}),k._useRampGradients&&(k._colorRemapGradients&&k._colorRemapGradients.length>0&&xa.h.GetCurrentGradient(fa,k._colorRemapGradients,function(pa,ua,wa){var ya=p.a.Lerp(pa.factor1,ua.factor1,wa),Da=p.a.Lerp(pa.factor2,ua.factor2,wa);K.remapData.x=ya,K.remapData.y=Da-ya}),k._alphaRemapGradients&&k._alphaRemapGradients.length>0&&xa.h.GetCurrentGradient(fa,k._alphaRemapGradients,function(pa,ua,wa){var ya=p.a.Lerp(pa.factor1,ua.factor1,wa),Da=p.a.Lerp(pa.factor2,ua.factor2,wa);K.remapData.z=ya,K.remapData.w=Da-ya})),k._isAnimationSheetEnabled&&K.updateCellIndex(),K._inheritParticleInfoToSubEmitters(),K.age>=K.lifeTime)return k._emitFromParticle(K),K._attachedSubEmitters&&(K._attachedSubEmitters.forEach(function(pa){pa.particleSystem.disposeOnStop=!0,pa.particleSystem.stop()}),K._attachedSubEmitters=null),k.recycleParticle(K),S--,"continue"},S=0;S<m.length;S++)P()},k}return v.d(a,e),Object.defineProperty(a.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(b){this._useRampGradients!==b&&(this._useRampGradients=b,this._resetEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"particles",{get:function(){return this._particles},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"ParticleSystem"},a.prototype._addFactorGradient=function(b,c,d,f){var h=new xa.d();h.gradient=c,h.factor1=d,h.factor2=f,b.push(h),b.sort(function(i,k){return i.gradient<k.gradient?-1:i.gradient>k.gradient?1:0})},a.prototype._removeFactorGradient=function(b,c){if(b)for(var d=0,f=0,h=b;f<h.length;f++){if(h[f].gradient===c){b.splice(d,1);break}d++}},a.prototype.addLifeTimeGradient=function(b,c,d){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,b,c,d),this},a.prototype.removeLifeTimeGradient=function(b){return this._removeFactorGradient(this._lifeTimeGradients,b),this},a.prototype.addSizeGradient=function(b,c,d){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,b,c,d),this},a.prototype.removeSizeGradient=function(b){return this._removeFactorGradient(this._sizeGradients,b),this},a.prototype.addColorRemapGradient=function(b,c,d){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,b,c,d),this},a.prototype.removeColorRemapGradient=function(b){return this._removeFactorGradient(this._colorRemapGradients,b),this},a.prototype.addAlphaRemapGradient=function(b,c,d){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,b,c,d),this},a.prototype.removeAlphaRemapGradient=function(b){return this._removeFactorGradient(this._alphaRemapGradients,b),this},a.prototype.addAngularSpeedGradient=function(b,c,d){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,b,c,d),this},a.prototype.removeAngularSpeedGradient=function(b){return this._removeFactorGradient(this._angularSpeedGradients,b),this},a.prototype.addVelocityGradient=function(b,c,d){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,b,c,d),this},a.prototype.removeVelocityGradient=function(b){return this._removeFactorGradient(this._velocityGradients,b),this},a.prototype.addLimitVelocityGradient=function(b,c,d){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,b,c,d),this},a.prototype.removeLimitVelocityGradient=function(b){return this._removeFactorGradient(this._limitVelocityGradients,b),this},a.prototype.addDragGradient=function(b,c,d){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,b,c,d),this},a.prototype.removeDragGradient=function(b){return this._removeFactorGradient(this._dragGradients,b),this},a.prototype.addEmitRateGradient=function(b,c,d){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,b,c,d),this},a.prototype.removeEmitRateGradient=function(b){return this._removeFactorGradient(this._emitRateGradients,b),this},a.prototype.addStartSizeGradient=function(b,c,d){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,b,c,d),this},a.prototype.removeStartSizeGradient=function(b){return this._removeFactorGradient(this._emitRateGradients,b),this},a.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture){for(var b=new Uint8Array(4*this._rawTextureWidth),c=j.t.Color3[0],d=0;d<this._rawTextureWidth;d++){var f=d/this._rawTextureWidth;xa.h.GetCurrentGradient(f,this._rampGradients,function(h,i,k){j.e.LerpToRef(h.color,i.color,k,c),b[4*d]=255*c.r,b[4*d+1]=255*c.g,b[4*d+2]=255*c.b,b[4*d+3]=255})}this._rampGradientsTexture=zc.CreateRGBATexture(b,this._rawTextureWidth,1,this._scene,!1,!1,ra.a.NEAREST_SAMPLINGMODE)}},a.prototype.getRampGradients=function(){return this._rampGradients},a.prototype.addRampGradient=function(b,c){this._rampGradients||(this._rampGradients=[]);var d=new xa.b();return d.gradient=b,d.color=c,this._rampGradients.push(d),this._rampGradients.sort(function(f,h){return f.gradient<h.gradient?-1:f.gradient>h.gradient?1:0}),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture(),this},a.prototype.removeRampGradient=function(b){return this._removeGradientAndTexture(b,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},a.prototype.addColorGradient=function(b,c,d){this._colorGradients||(this._colorGradients=[]);var f=new xa.c();return f.gradient=b,f.color1=c,f.color2=d,this._colorGradients.push(f),this._colorGradients.sort(function(h,i){return h.gradient<i.gradient?-1:h.gradient>i.gradient?1:0}),this},a.prototype.removeColorGradient=function(b){if(!this._colorGradients)return this;for(var c=0,d=0,f=this._colorGradients;d<f.length;d++){if(f[d].gradient===b){this._colorGradients.splice(c,1);break}c++}return this},a.prototype._fetchR=function(b,c,d,f,h){return h[4*(((b=.5*Math.abs(b)+.5)*d%d|0)+((c=.5*Math.abs(c)+.5)*f%f|0)*d)]/255},a.prototype._reset=function(){this._resetEffect()},a.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._createVertexBuffers()},a.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==a.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var b=this._scene.getEngine();this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new na.a(b,this._vertexData,!0,this._vertexBufferSize);var c=0,d=this._vertexBuffer.createVertexBuffer(na.b.PositionKind,c,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[na.b.PositionKind]=d,c+=3;var f=this._vertexBuffer.createVertexBuffer(na.b.ColorKind,c,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[na.b.ColorKind]=f,c+=4;var h=this._vertexBuffer.createVertexBuffer("angle",c,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=h,c+=1;var i,k=this._vertexBuffer.createVertexBuffer("size",c,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=k,c+=2,this._isAnimationSheetEnabled){var m=this._vertexBuffer.createVertexBuffer("cellIndex",c,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=m,c+=1}if(!this._isBillboardBased||this.billboardMode===a.BILLBOARDMODE_STRETCHED){var B=this._vertexBuffer.createVertexBuffer("direction",c,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=B,c+=3}if(this._useRampGradients){var E=this._vertexBuffer.createVertexBuffer("remapData",c,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=E,c+=4}if(this._useInstancing){var K=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new na.a(b,K,!1,2),i=this._spriteBuffer.createVertexBuffer("offset",0,2)}else i=this._vertexBuffer.createVertexBuffer("offset",c,2,this._vertexBufferSize,this._useInstancing),c+=2;this._vertexBuffers.offset=i},a.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var b=[],c=0,d=0;d<this._capacity;d++)b.push(c),b.push(c+1),b.push(c+2),b.push(c),b.push(c+2),b.push(c+3),c+=4;this._indexBuffer=this._scene.getEngine().createIndexBuffer(b)}},a.prototype.getCapacity=function(){return this._capacity},a.prototype.isAlive=function(){return this._alive},a.prototype.isStarted=function(){return this._started},a.prototype._prepareSubEmitterInternalArray=function(){var b=this;this._subEmitters=new Array(),this.subEmitters&&this.subEmitters.forEach(function(c){c instanceof a?b._subEmitters.push([new pd(c)]):c instanceof pd?b._subEmitters.push([c]):c instanceof Array&&b._subEmitters.push(c)})},a.prototype.start=function(b){var c=this;if(void 0===b&&(b=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(b)setTimeout(function(){c.start(0)},b);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=new Array()),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){this.emitter instanceof kb.a&&this.emitter.computeWorldMatrix(!0);var d=this.noiseTexture;if(d&&d.onGeneratedObservable)d.onGeneratedObservable.addOnce(function(){setTimeout(function(){for(var h=0;h<c.preWarmCycles;h++)c.animate(!0),d.render()})});else for(var f=0;f<this.preWarmCycles;f++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},a.prototype.stop=function(b){void 0===b&&(b=!0),this._stopped=!0,b&&this._stopSubEmitters()},a.prototype.reset=function(){this._stockParticles=[],this._particles=[]},a.prototype._appendParticleVertex=function(b,c,d,f){var h=b*this._vertexBufferSize;this._vertexData[h++]=c.position.x+this.worldOffset.x,this._vertexData[h++]=c.position.y+this.worldOffset.y,this._vertexData[h++]=c.position.z+this.worldOffset.z,this._vertexData[h++]=c.color.r,this._vertexData[h++]=c.color.g,this._vertexData[h++]=c.color.b,this._vertexData[h++]=c.color.a,this._vertexData[h++]=c.angle,this._vertexData[h++]=c.scale.x*c.size,this._vertexData[h++]=c.scale.y*c.size,this._isAnimationSheetEnabled&&(this._vertexData[h++]=c.cellIndex),this._isBillboardBased?this.billboardMode===a.BILLBOARDMODE_STRETCHED&&(this._vertexData[h++]=c.direction.x,this._vertexData[h++]=c.direction.y,this._vertexData[h++]=c.direction.z):c._initialDirection?(this._vertexData[h++]=c._initialDirection.x,this._vertexData[h++]=c._initialDirection.y,this._vertexData[h++]=c._initialDirection.z):(this._vertexData[h++]=c.direction.x,this._vertexData[h++]=c.direction.y,this._vertexData[h++]=c.direction.z),this._useRampGradients&&(this._vertexData[h++]=c.remapData.x,this._vertexData[h++]=c.remapData.y,this._vertexData[h++]=c.remapData.z,this._vertexData[h++]=c.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===d?d=this._epsilon:1===d&&(d=1-this._epsilon),0===f?f=this._epsilon:1===f&&(f=1-this._epsilon)),this._vertexData[h++]=d,this._vertexData[h++]=f)},a.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach(function(b){b.stop(!0)}),this.activeSubSystems=new Array())},a.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var b=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==b&&this._rootParticleSystem.activeSubSystems.splice(b,1),this._rootParticleSystem=null}},a.prototype._update=function(b){var c,d=this;if(this._alive=this._particles.length>0,this.emitter.position){var f=this.emitter;this._emitterWorldMatrix=f.getWorldMatrix()}else{var h=this.emitter;this._emitterWorldMatrix=j.j.Translation(h.x,h.y,h.z)}this.updateFunction(this._particles);for(var i,k=function(){if(m._particles.length===m._capacity)return"break";c=m._createParticle(),m._particles.push(c);var E=p.a.RandomRange(m.minEmitPower,m.maxEmitPower);if(m.startPositionFunction?m.startPositionFunction(m._emitterWorldMatrix,c.position,c):m.particleEmitterType.startPositionFunction(m._emitterWorldMatrix,c.position,c),m.startDirectionFunction?m.startDirectionFunction(m._emitterWorldMatrix,c.direction,c):m.particleEmitterType.startDirectionFunction(m._emitterWorldMatrix,c.direction,c),0===E?c._initialDirection?c._initialDirection.copyFrom(c.direction):c._initialDirection=c.direction.clone():c._initialDirection=null,c.direction.scaleInPlace(E),m.targetStopDuration&&m._lifeTimeGradients&&m._lifeTimeGradients.length>0){var K=p.a.Clamp(m._actualFrame/m.targetStopDuration);xa.h.GetCurrentGradient(K,m._lifeTimeGradients,function(S,U){var _=S,da=U,fa=_.getFactor(),ga=da.getFactor(),ha=(K-_.gradient)/(da.gradient-_.gradient);c.lifeTime=p.a.Lerp(fa,ga,ha)})}else c.lifeTime=p.a.RandomRange(m.minLifeTime,m.maxLifeTime);if(m._sizeGradients&&0!==m._sizeGradients.length?(c._currentSizeGradient=m._sizeGradients[0],c._currentSize1=c._currentSizeGradient.getFactor(),c.size=c._currentSize1,m._sizeGradients.length>1?c._currentSize2=m._sizeGradients[1].getFactor():c._currentSize2=c._currentSize1):c.size=p.a.RandomRange(m.minSize,m.maxSize),c.scale.copyFromFloats(p.a.RandomRange(m.minScaleX,m.maxScaleX),p.a.RandomRange(m.minScaleY,m.maxScaleY)),m._startSizeGradients&&m._startSizeGradients[0]&&m.targetStopDuration){var P=m._actualFrame/m.targetStopDuration;xa.h.GetCurrentGradient(P,m._startSizeGradients,function(S,U,_){S!==d._currentStartSizeGradient&&(d._currentStartSize1=d._currentStartSize2,d._currentStartSize2=U.getFactor(),d._currentStartSizeGradient=S);var da=p.a.Lerp(d._currentStartSize1,d._currentStartSize2,_);c.scale.scaleInPlace(da)})}m._angularSpeedGradients&&0!==m._angularSpeedGradients.length?(c._currentAngularSpeedGradient=m._angularSpeedGradients[0],c.angularSpeed=c._currentAngularSpeedGradient.getFactor(),c._currentAngularSpeed1=c.angularSpeed,m._angularSpeedGradients.length>1?c._currentAngularSpeed2=m._angularSpeedGradients[1].getFactor():c._currentAngularSpeed2=c._currentAngularSpeed1):c.angularSpeed=p.a.RandomRange(m.minAngularSpeed,m.maxAngularSpeed),c.angle=p.a.RandomRange(m.minInitialRotation,m.maxInitialRotation),m._velocityGradients&&m._velocityGradients.length>0&&(c._currentVelocityGradient=m._velocityGradients[0],c._currentVelocity1=c._currentVelocityGradient.getFactor(),m._velocityGradients.length>1?c._currentVelocity2=m._velocityGradients[1].getFactor():c._currentVelocity2=c._currentVelocity1),m._limitVelocityGradients&&m._limitVelocityGradients.length>0&&(c._currentLimitVelocityGradient=m._limitVelocityGradients[0],c._currentLimitVelocity1=c._currentLimitVelocityGradient.getFactor(),m._limitVelocityGradients.length>1?c._currentLimitVelocity2=m._limitVelocityGradients[1].getFactor():c._currentLimitVelocity2=c._currentLimitVelocity1),m._dragGradients&&m._dragGradients.length>0&&(c._currentDragGradient=m._dragGradients[0],c._currentDrag1=c._currentDragGradient.getFactor(),m._dragGradients.length>1?c._currentDrag2=m._dragGradients[1].getFactor():c._currentDrag2=c._currentDrag1),m._colorGradients&&0!==m._colorGradients.length?(c._currentColorGradient=m._colorGradients[0],c._currentColorGradient.getColorToRef(c.color),c._currentColor1.copyFrom(c.color),m._colorGradients.length>1?m._colorGradients[1].getColorToRef(c._currentColor2):c._currentColor2.copyFrom(c.color)):(i=p.a.RandomRange(0,1),j.f.LerpToRef(m.color1,m.color2,i,c.color),m.colorDead.subtractToRef(c.color,m._colorDiff),m._colorDiff.scaleToRef(1/c.lifeTime,c.colorStep)),m._isAnimationSheetEnabled&&(c._initialStartSpriteCellID=m.startSpriteCellID,c._initialEndSpriteCellID=m.endSpriteCellID),c.direction.addInPlace(m._inheritedVelocityOffset),m._useRampGradients&&(c.remapData=new j.y(0,1,0,1)),m.noiseTexture&&(c._randomNoiseCoordinates1?(c._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),c._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(c._randomNoiseCoordinates1=new j.x(Math.random(),Math.random(),Math.random()),c._randomNoiseCoordinates2=new j.x(Math.random(),Math.random(),Math.random()))),c._inheritParticleInfoToSubEmitters()},m=this,B=0;B<b;B++)if("break"===k())break},a._GetAttributeNamesOrOptions=function(b,c,d){void 0===b&&(b=!1),void 0===c&&(c=!1),void 0===d&&(d=!1);var f=[na.b.PositionKind,na.b.ColorKind,"angle","offset","size"];return b&&f.push("cellIndex"),c||f.push("direction"),d&&f.push("remapData"),f},a._GetEffectCreationOptions=function(b){void 0===b&&(b=!1);var c=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","textureMask","translationPivot","eyePosition"];return b&&c.push("particlesInfos"),c},a.prototype._getEffect=function(b){if(this._customEffect)return this._customEffect;var c=[];if(this._scene.clipPlane&&c.push("#define CLIPPLANE"),this._scene.clipPlane2&&c.push("#define CLIPPLANE2"),this._scene.clipPlane3&&c.push("#define CLIPPLANE3"),this._scene.clipPlane4&&c.push("#define CLIPPLANE4"),this._isAnimationSheetEnabled&&c.push("#define ANIMATESHEET"),b===a.BLENDMODE_MULTIPLY&&c.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&c.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(c.push("#define BILLBOARD"),this.billboardMode){case a.BILLBOARDMODE_Y:c.push("#define BILLBOARDY");break;case a.BILLBOARDMODE_STRETCHED:c.push("#define BILLBOARDSTRETCHED");break;case a.BILLBOARDMODE_ALL:}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),c.push(this._imageProcessingConfigurationDefines.toString()));var d=c.join(`
`);if(this._cachedDefines!==d){this._cachedDefines=d;var f=a._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==a.BILLBOARDMODE_STRETCHED,this._useRampGradients),h=a._GetEffectCreationOptions(this._isAnimationSheetEnabled),i=["diffuseSampler","rampSampler"];Eb.a&&(Eb.a.PrepareUniforms(h,this._imageProcessingConfigurationDefines),Eb.a.PrepareSamplers(i,this._imageProcessingConfigurationDefines)),this._effect=this._scene.getEngine().createEffect("particles",f,h,i,d)}return this._effect},a.prototype.animate=function(b){var c=this;if(void 0===b&&(b=!1),this._started){if(!b){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var d;if(this._scaledUpdateSpeed=this.updateSpeed*(b?this.preWarmStepOffset:this._scene.getAnimationRatio()),this.manualEmitCount>-1)d=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var f=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var h=this._actualFrame/this.targetStopDuration;xa.h.GetCurrentGradient(h,this._emitRateGradients,function(B,E,K){B!==c._currentEmitRateGradient&&(c._currentEmitRate1=c._currentEmitRate2,c._currentEmitRate2=E.getFactor(),c._currentEmitRateGradient=B),f=p.a.Lerp(c._currentEmitRate1,c._currentEmitRate2,K)})}d=f*this._scaledUpdateSpeed>>0,this._newPartsExcess+=f*this._scaledUpdateSpeed-d}if(this._newPartsExcess>1&&(d+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?d=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(d),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene._toBeDisposed.push(this))),!b){for(var i=0,k=0;k<this._particles.length;k++){var m=this._particles[k];this._appendParticleVertices(i,m),i+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}},a.prototype._appendParticleVertices=function(b,c){this._appendParticleVertex(b++,c,0,0),this._useInstancing||(this._appendParticleVertex(b++,c,1,0),this._appendParticleVertex(b++,c,1,1),this._appendParticleVertex(b++,c,0,1))},a.prototype.rebuild=function(){this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild()},a.prototype.isReady=function(){if(!(this.emitter&&this._imageProcessingConfiguration.isReady()&&this.particleTexture&&this.particleTexture.isReady()))return!1;if(this.blendMode!==a.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else{if(!this._getEffect(a.BLENDMODE_MULTIPLY).isReady())return!1;if(!this._getEffect(a.BLENDMODE_ADD).isReady())return!1}return!0},a.prototype._render=function(b){var c=this._getEffect(b),d=this._scene.getEngine();d.enableEffect(c);var f=this._scene.getViewMatrix();if(c.setTexture("diffuseSampler",this.particleTexture),c.setMatrix("view",f),c.setMatrix("projection",this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var h=this.particleTexture.getBaseSize();c.setFloat3("particlesInfos",this.spriteCellWidth/h.width,this.spriteCellHeight/h.height,h.width/this.spriteCellWidth)}if(c.setVector2("translationPivot",this.translationPivot),c.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased){var i=this._scene.activeCamera;c.setVector3("eyePosition",i.globalPosition)}if(this._rampGradientsTexture&&c.setTexture("rampSampler",this._rampGradientsTexture),this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4){var k=f.clone();k.invert(),c.setMatrix("invView",k),Ta.a.BindClipPlane(c,this._scene)}switch(d.bindBuffers(this._vertexBuffers,this._indexBuffer,c),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(c),b){case a.BLENDMODE_ADD:d.setAlphaMode(o.a.ALPHA_ADD);break;case a.BLENDMODE_ONEONE:d.setAlphaMode(o.a.ALPHA_ONEONE);break;case a.BLENDMODE_STANDARD:d.setAlphaMode(o.a.ALPHA_COMBINE);break;case a.BLENDMODE_MULTIPLY:d.setAlphaMode(o.a.ALPHA_MULTIPLY)}return this._useInstancing?d.drawArraysType(rb.a.TriangleFanDrawMode,0,4,this._particles.length):d.drawElementsType(rb.a.TriangleFillMode,0,6*this._particles.length),this._particles.length},a.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var b=this._scene.getEngine();b.setState(!1),this.forceDepthWrite&&b.setDepthWrite(!0);var c=0;return this.blendMode===a.BLENDMODE_MULTIPLYADD&&(c=this._render(a.BLENDMODE_MULTIPLY)+this._render(a.BLENDMODE_ADD)),c=this._render(this.blendMode),b.unbindInstanceAttributes(),b.setAlphaMode(o.a.ALPHA_DISABLE),c},a.prototype.dispose=function(b){if(void 0===b&&(b=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),b&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),b&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var c=0;c<this._subEmitters.length;c++)for(var d=0,f=this._subEmitters[c];d<f.length;d++)f[d].dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),(c=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(c,1),this._scene._activeParticleSystems.dispose(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.reset()},a.prototype.clone=function(b,c){var d=null,f=null;if(null!=this.customShader){var h=(f=this.customShader).shaderOptions.defines.length>0?f.shaderOptions.defines.join(`
`):"";d=this._scene.getEngine().createEffectForParticles(f.shaderPath.fragmentElement,f.shaderOptions.uniforms,f.shaderOptions.samplers,h)}else this._customEffect&&(d=this._customEffect);var i=new a(b,this._capacity,this._scene,d);return i.customShader=f,V.a.DeepCopy(this,i,["particles","customShader","noiseTexture"]),void 0===c&&(c=this.emitter),i.noiseTexture=this.noiseTexture,i.emitter=c,this.particleTexture&&(i.particleTexture=new ra.a(this.particleTexture.url,this._scene)),this._colorGradients&&this._colorGradients.forEach(function(k){i.addColorGradient(k.gradient,k.color1,k.color2)}),this._dragGradients&&this._dragGradients.forEach(function(k){i.addDragGradient(k.gradient,k.factor1,k.factor2)}),this._angularSpeedGradients&&this._angularSpeedGradients.forEach(function(k){i.addAngularSpeedGradient(k.gradient,k.factor1,k.factor2)}),this._emitRateGradients&&this._emitRateGradients.forEach(function(k){i.addEmitRateGradient(k.gradient,k.factor1,k.factor2)}),this._lifeTimeGradients&&this._lifeTimeGradients.forEach(function(k){i.addLifeTimeGradient(k.gradient,k.factor1,k.factor2)}),this._limitVelocityGradients&&this._limitVelocityGradients.forEach(function(k){i.addLimitVelocityGradient(k.gradient,k.factor1,k.factor2)}),this._sizeGradients&&this._sizeGradients.forEach(function(k){i.addSizeGradient(k.gradient,k.factor1,k.factor2)}),this._startSizeGradients&&this._startSizeGradients.forEach(function(k){i.addStartSizeGradient(k.gradient,k.factor1,k.factor2)}),this._velocityGradients&&this._velocityGradients.forEach(function(k){i.addVelocityGradient(k.gradient,k.factor1,k.factor2)}),this._rampGradients&&this._rampGradients.forEach(function(k){i.addRampGradient(k.gradient,k.color)}),this._colorRemapGradients&&this._colorRemapGradients.forEach(function(k){i.addColorRemapGradient(k.gradient,k.factor1,k.factor2)}),this._alphaRemapGradients&&this._alphaRemapGradients.forEach(function(k){i.addAlphaRemapGradient(k.gradient,k.factor1,k.factor2)}),this.preventAutoStart||i.start(),i},a.prototype.serialize=function(){var b={};if(a._Serialize(b,this),b.textureMask=this.textureMask.asArray(),b.customShader=this.customShader,b.preventAutoStart=this.preventAutoStart,this.subEmitters){b.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var c=0,d=this._subEmitters;c<d.length;c++){for(var f=[],h=0,i=d[c];h<i.length;h++){var k=i[h];f.push(k.serialize())}b.subEmitters.push(f)}}return b},a._Serialize=function(b,c){if(b.name=c.name,b.id=c.id,b.capacity=c.getCapacity(),c.emitter.position){var d=c.emitter;b.emitterId=d.id}else{var f=c.emitter;b.emitter=f.asArray()}c.particleEmitterType&&(b.particleEmitterType=c.particleEmitterType.serialize()),c.particleTexture&&(b.textureName=c.particleTexture.name,b.invertY=c.particleTexture._invertY),g.a.AppendSerializedAnimations(c,b),b.beginAnimationOnStart=c.beginAnimationOnStart,b.beginAnimationFrom=c.beginAnimationFrom,b.beginAnimationTo=c.beginAnimationTo,b.beginAnimationLoop=c.beginAnimationLoop,b.startDelay=c.startDelay,b.renderingGroupId=c.renderingGroupId,b.isBillboardBased=c.isBillboardBased,b.billboardMode=c.billboardMode,b.minAngularSpeed=c.minAngularSpeed,b.maxAngularSpeed=c.maxAngularSpeed,b.minSize=c.minSize,b.maxSize=c.maxSize,b.minScaleX=c.minScaleX,b.maxScaleX=c.maxScaleX,b.minScaleY=c.minScaleY,b.maxScaleY=c.maxScaleY,b.minEmitPower=c.minEmitPower,b.maxEmitPower=c.maxEmitPower,b.minLifeTime=c.minLifeTime,b.maxLifeTime=c.maxLifeTime,b.emitRate=c.emitRate,b.gravity=c.gravity.asArray(),b.noiseStrength=c.noiseStrength.asArray(),b.color1=c.color1.asArray(),b.color2=c.color2.asArray(),b.colorDead=c.colorDead.asArray(),b.updateSpeed=c.updateSpeed,b.targetStopDuration=c.targetStopDuration,b.blendMode=c.blendMode,b.preWarmCycles=c.preWarmCycles,b.preWarmStepOffset=c.preWarmStepOffset,b.minInitialRotation=c.minInitialRotation,b.maxInitialRotation=c.maxInitialRotation,b.startSpriteCellID=c.startSpriteCellID,b.endSpriteCellID=c.endSpriteCellID,b.spriteCellChangeSpeed=c.spriteCellChangeSpeed,b.spriteCellWidth=c.spriteCellWidth,b.spriteCellHeight=c.spriteCellHeight,b.spriteRandomStartCell=c.spriteRandomStartCell,b.isAnimationSheetEnabled=c.isAnimationSheetEnabled;var h=c.getColorGradients();if(h){b.colorGradients=[];for(var i=0,k=h;i<k.length;i++){var m=k[i],B={gradient:m.gradient,color1:m.color1.asArray()};m.color2&&(B.color2=m.color2.asArray()),b.colorGradients.push(B)}}var E=c.getRampGradients();if(E){b.rampGradients=[];for(var K=0,P=E;K<P.length;K++){var S=P[K];B={gradient:S.gradient,color:S.color.asArray()},b.rampGradients.push(B)}b.useRampGradients=c.useRampGradients}var U=c.getColorRemapGradients();if(U){b.colorRemapGradients=[];for(var _=0,da=U;_<da.length;_++){var fa=da[_];B={gradient:fa.gradient,factor1:fa.factor1},void 0!==fa.factor2&&(B.factor2=fa.factor2),b.colorRemapGradients.push(B)}}var ga=c.getAlphaRemapGradients();if(ga){b.alphaRemapGradients=[];for(var ha=0,ka=ga;ha<ka.length;ha++){var la=ka[ha];B={gradient:la.gradient,factor1:la.factor1},void 0!==la.factor2&&(B.factor2=la.factor2),b.alphaRemapGradients.push(B)}}var ma=c.getSizeGradients();if(ma){b.sizeGradients=[];for(var ta=0,pa=ma;ta<pa.length;ta++){var ua=pa[ta];B={gradient:ua.gradient,factor1:ua.factor1},void 0!==ua.factor2&&(B.factor2=ua.factor2),b.sizeGradients.push(B)}}var wa=c.getAngularSpeedGradients();if(wa){b.angularSpeedGradients=[];for(var ya=0,Da=wa;ya<Da.length;ya++){var Ja=Da[ya];B={gradient:Ja.gradient,factor1:Ja.factor1},void 0!==Ja.factor2&&(B.factor2=Ja.factor2),b.angularSpeedGradients.push(B)}}var Na=c.getVelocityGradients();if(Na){b.velocityGradients=[];for(var Ma=0,Ha=Na;Ma<Ha.length;Ma++){var Qa=Ha[Ma];B={gradient:Qa.gradient,factor1:Qa.factor1},void 0!==Qa.factor2&&(B.factor2=Qa.factor2),b.velocityGradients.push(B)}}var cb=c.getDragGradients();if(cb){b.dragyGradients=[];for(var La=0,Oa=cb;La<Oa.length;La++){var Ya=Oa[La];B={gradient:Ya.gradient,factor1:Ya.factor1},void 0!==Ya.factor2&&(B.factor2=Ya.factor2),b.dragGradients.push(B)}}var Ua=c.getEmitRateGradients();if(Ua){b.emitRateGradients=[];for(var _a=0,db=Ua;_a<db.length;_a++){var ub=db[_a];B={gradient:ub.gradient,factor1:ub.factor1},void 0!==ub.factor2&&(B.factor2=ub.factor2),b.emitRateGradients.push(B)}}var eb=c.getStartSizeGradients();if(eb){b.startSizeGradients=[];for(var Va=0,zb=eb;Va<zb.length;Va++){var mb=zb[Va];B={gradient:mb.gradient,factor1:mb.factor1},void 0!==mb.factor2&&(B.factor2=mb.factor2),b.startSizeGradients.push(B)}}var ib=c.getLifeTimeGradients();if(ib){b.lifeTimeGradients=[];for(var xb=0,$a=ib;xb<$a.length;xb++){var Bb=$a[xb];B={gradient:Bb.gradient,factor1:Bb.factor1},void 0!==Bb.factor2&&(B.factor2=Bb.factor2),b.lifeTimeGradients.push(B)}}var Rb=c.getLimitVelocityGradients();if(Rb){b.limitVelocityGradients=[];for(var Fb=0,Yb=Rb;Fb<Yb.length;Fb++){var Sb=Yb[Fb];B={gradient:Sb.gradient,factor1:Sb.factor1},void 0!==Sb.factor2&&(B.factor2=Sb.factor2),b.limitVelocityGradients.push(B)}b.limitVelocityDamping=c.limitVelocityDamping}c.noiseTexture&&(b.noiseTexture=c.noiseTexture.serialize())},a._Parse=function(b,c,d,f){if(b.textureName&&(c.particleTexture=new ra.a(f+b.textureName,d,!1,void 0===b.invertY||b.invertY),c.particleTexture.name=b.textureName),b.emitterId||0===b.emitterId||void 0!==b.emitter?b.emitterId?c.emitter=d.getLastMeshByID(b.emitterId):c.emitter=j.x.FromArray(b.emitter):c.emitter=j.x.Zero(),void 0!==b.renderingGroupId&&(c.renderingGroupId=b.renderingGroupId),void 0!==b.isBillboardBased&&(c.isBillboardBased=b.isBillboardBased),void 0!==b.billboardMode&&(c.billboardMode=b.billboardMode),b.animations){for(var h=0;h<b.animations.length;h++){var i=b.animations[h],k=I.a.GetClass("BABYLON.Animation");k&&c.animations.push(k.Parse(i))}c.beginAnimationOnStart=b.beginAnimationOnStart,c.beginAnimationFrom=b.beginAnimationFrom,c.beginAnimationTo=b.beginAnimationTo,c.beginAnimationLoop=b.beginAnimationLoop}if(b.autoAnimate&&d.beginAnimation(c,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),c.startDelay=0|b.startDelay,c.minAngularSpeed=b.minAngularSpeed,c.maxAngularSpeed=b.maxAngularSpeed,c.minSize=b.minSize,c.maxSize=b.maxSize,b.minScaleX&&(c.minScaleX=b.minScaleX,c.maxScaleX=b.maxScaleX,c.minScaleY=b.minScaleY,c.maxScaleY=b.maxScaleY),void 0!==b.preWarmCycles&&(c.preWarmCycles=b.preWarmCycles,c.preWarmStepOffset=b.preWarmStepOffset),void 0!==b.minInitialRotation&&(c.minInitialRotation=b.minInitialRotation,c.maxInitialRotation=b.maxInitialRotation),c.minLifeTime=b.minLifeTime,c.maxLifeTime=b.maxLifeTime,c.minEmitPower=b.minEmitPower,c.maxEmitPower=b.maxEmitPower,c.emitRate=b.emitRate,c.gravity=j.x.FromArray(b.gravity),b.noiseStrength&&(c.noiseStrength=j.x.FromArray(b.noiseStrength)),c.color1=j.f.FromArray(b.color1),c.color2=j.f.FromArray(b.color2),c.colorDead=j.f.FromArray(b.colorDead),c.updateSpeed=b.updateSpeed,c.targetStopDuration=b.targetStopDuration,c.blendMode=b.blendMode,b.colorGradients)for(var m=0,B=b.colorGradients;m<B.length;m++){var E=B[m];c.addColorGradient(E.gradient,j.f.FromArray(E.color1),E.color2?j.f.FromArray(E.color2):void 0)}if(b.rampGradients){for(var K=0,P=b.rampGradients;K<P.length;K++){var S=P[K];c.addRampGradient(S.gradient,j.e.FromArray(S.color))}c.useRampGradients=b.useRampGradients}if(b.colorRemapGradients)for(var U=0,_=b.colorRemapGradients;U<_.length;U++){var da=_[U];c.addColorRemapGradient(da.gradient,void 0!==da.factor1?da.factor1:da.factor,da.factor2)}if(b.alphaRemapGradients)for(var fa=0,ga=b.alphaRemapGradients;fa<ga.length;fa++){var ha=ga[fa];c.addAlphaRemapGradient(ha.gradient,void 0!==ha.factor1?ha.factor1:ha.factor,ha.factor2)}if(b.sizeGradients)for(var ka=0,la=b.sizeGradients;ka<la.length;ka++){var ma=la[ka];c.addSizeGradient(ma.gradient,void 0!==ma.factor1?ma.factor1:ma.factor,ma.factor2)}if(b.sizeGradients)for(var ta=0,pa=b.sizeGradients;ta<pa.length;ta++)ma=pa[ta],c.addSizeGradient(ma.gradient,void 0!==ma.factor1?ma.factor1:ma.factor,ma.factor2);if(b.angularSpeedGradients)for(var ua=0,wa=b.angularSpeedGradients;ua<wa.length;ua++){var ya=wa[ua];c.addAngularSpeedGradient(ya.gradient,void 0!==ya.factor1?ya.factor1:ya.factor,ya.factor2)}if(b.velocityGradients)for(var Da=0,Ja=b.velocityGradients;Da<Ja.length;Da++){var Na=Ja[Da];c.addVelocityGradient(Na.gradient,void 0!==Na.factor1?Na.factor1:Na.factor,Na.factor2)}if(b.dragGradients)for(var Ma=0,Ha=b.dragGradients;Ma<Ha.length;Ma++){var Qa=Ha[Ma];c.addDragGradient(Qa.gradient,void 0!==Qa.factor1?Qa.factor1:Qa.factor,Qa.factor2)}if(b.emitRateGradients)for(var cb=0,La=b.emitRateGradients;cb<La.length;cb++){var Oa=La[cb];c.addEmitRateGradient(Oa.gradient,void 0!==Oa.factor1?Oa.factor1:Oa.factor,Oa.factor2)}if(b.startSizeGradients)for(var Ya=0,Ua=b.startSizeGradients;Ya<Ua.length;Ya++){var _a=Ua[Ya];c.addStartSizeGradient(_a.gradient,void 0!==_a.factor1?_a.factor1:_a.factor,_a.factor2)}if(b.lifeTimeGradients)for(var db=0,ub=b.lifeTimeGradients;db<ub.length;db++){var eb=ub[db];c.addLifeTimeGradient(eb.gradient,void 0!==eb.factor1?eb.factor1:eb.factor,eb.factor2)}if(b.limitVelocityGradients){for(var Va=0,zb=b.limitVelocityGradients;Va<zb.length;Va++){var mb=zb[Va];c.addLimitVelocityGradient(mb.gradient,void 0!==mb.factor1?mb.factor1:mb.factor,mb.factor2)}c.limitVelocityDamping=b.limitVelocityDamping}var ib;if(b.noiseTexture&&(c.noiseTexture=Ud.Parse(b.noiseTexture,d,f)),b.particleEmitterType){switch(b.particleEmitterType.type){case"SphereParticleEmitter":ib=new Xd();break;case"SphereDirectedParticleEmitter":ib=new xf();break;case"ConeEmitter":case"ConeParticleEmitter":ib=new vf();break;case"CylinderParticleEmitter":ib=new Wd();break;case"HemisphericParticleEmitter":ib=new wf();break;case"BoxEmitter":case"BoxParticleEmitter":default:ib=new Tc()}ib.parse(b.particleEmitterType)}else(ib=new Tc()).parse(b);c.particleEmitterType=ib,c.startSpriteCellID=b.startSpriteCellID,c.endSpriteCellID=b.endSpriteCellID,c.spriteCellWidth=b.spriteCellWidth,c.spriteCellHeight=b.spriteCellHeight,c.spriteCellChangeSpeed=b.spriteCellChangeSpeed,c.spriteRandomStartCell=b.spriteRandomStartCell},a.Parse=function(b,c,d,f){void 0===f&&(f=!1);var h=b.name,i=null,k=null;if(b.customShader){var m=(k=b.customShader).shaderOptions.defines.length>0?k.shaderOptions.defines.join(`
`):"";i=c.getEngine().createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,m)}var B=new a(h,b.capacity,c,i,b.isAnimationSheetEnabled);if(B.customShader=k,b.id&&(B.id=b.id),b.subEmitters){B.subEmitters=[];for(var E=0,K=b.subEmitters;E<K.length;E++){for(var P=[],S=0,U=K[E];S<U.length;S++){var _=U[S];P.push(pd.Parse(_,c,d))}B.subEmitters.push(P)}}return a._Parse(b,B,c,d),B.textureMask=j.f.FromArray(b.textureMask),b.preventAutoStart&&(B.preventAutoStart=b.preventAutoStart),f||B.preventAutoStart||B.start(),B},a.BILLBOARDMODE_Y=o.a.PARTICLES_BILLBOARDMODE_Y,a.BILLBOARDMODE_ALL=o.a.PARTICLES_BILLBOARDMODE_ALL,a.BILLBOARDMODE_STRETCHED=o.a.PARTICLES_BILLBOARDMODE_STRETCHED,a}(yf);pd._ParseParticleSystem=Jb.Parse,Ia.a.ShadersStore.gpuUpdateParticlesPixelShader=`#version 300 es
void main() {
discard;
}
`;var vk=`#version 300 es
#define PI 3.14159
uniform float currentCount;
uniform float timeDelta;
uniform float stopFactor;
uniform mat4 emitterWM;
uniform vec2 lifeTime;
uniform vec2 emitPower;
uniform vec2 sizeRange;
uniform vec4 scaleRange;
#ifndef COLORGRADIENTS
uniform vec4 color1;
uniform vec4 color2;
#endif
uniform vec3 gravity;
uniform sampler2D randomSampler;
uniform sampler2D randomSampler2;
uniform vec4 angleRange;
#ifdef BOXEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
uniform vec3 minEmitBox;
uniform vec3 maxEmitBox;
#endif
#ifdef POINTEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#endif
#ifdef HEMISPHERICEMITTER
uniform float radius;
uniform float radiusRange;
uniform float directionRandomizer;
#endif
#ifdef SPHEREEMITTER
uniform float radius;
uniform float radiusRange;
#ifdef DIRECTEDSPHEREEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CYLINDEREMITTER
uniform float radius;
uniform float height;
uniform float radiusRange;
#ifdef DIRECTEDCYLINDEREMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CONEEMITTER
uniform vec2 radius;
uniform float coneAngle;
uniform vec2 height;
uniform float directionRandomizer;
#endif

in vec3 position;
in float age;
in float life;
in vec4 seed;
in vec3 size;
#ifndef COLORGRADIENTS
in vec4 color;
#endif
in vec3 direction;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
in float angle;
#else
in vec2 angle;
#endif
#ifdef ANIMATESHEET
in float cellIndex;
#ifdef ANIMATESHEETRANDOMSTART
in float cellStartOffset;
#endif
#endif
#ifdef NOISE
in vec3 noiseCoordinates1;
in vec3 noiseCoordinates2;
#endif

out vec3 outPosition;
out float outAge;
out float outLife;
out vec4 outSeed;
out vec3 outSize;
#ifndef COLORGRADIENTS
out vec4 outColor;
#endif
out vec3 outDirection;
#ifndef BILLBOARD
out vec3 outInitialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
out float outAngle;
#else
out vec2 outAngle;
#endif
#ifdef ANIMATESHEET
out float outCellIndex;
#ifdef ANIMATESHEETRANDOMSTART
out float outCellStartOffset;
#endif
#endif
#ifdef NOISE
out vec3 outNoiseCoordinates1;
out vec3 outNoiseCoordinates2;
#endif
#ifdef SIZEGRADIENTS
uniform sampler2D sizeGradientSampler;
#endif
#ifdef ANGULARSPEEDGRADIENTS
uniform sampler2D angularSpeedGradientSampler;
#endif
#ifdef VELOCITYGRADIENTS
uniform sampler2D velocityGradientSampler;
#endif
#ifdef LIMITVELOCITYGRADIENTS
uniform sampler2D limitVelocityGradientSampler;
uniform float limitVelocityDamping;
#endif
#ifdef DRAGGRADIENTS
uniform sampler2D dragGradientSampler;
#endif
#ifdef NOISE
uniform vec3 noiseStrength;
uniform sampler2D noiseSampler;
#endif
#ifdef ANIMATESHEET
uniform vec3 cellInfos;
#endif
vec3 getRandomVec3(float offset) {
return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;
}
vec4 getRandomVec4(float offset) {
return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));
}
void main() {
float newAge=age+timeDelta;

if (newAge>=life && stopFactor != 0.) {
vec3 position;
vec3 direction;

vec4 randoms=getRandomVec4(seed.x);

outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;
outAge=mod(newAge,outLife);

outSeed=seed;

#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(0,0)).r;
#else
outSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;
#endif
outSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;
outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a;
#ifndef COLORGRADIENTS

outColor=color1+(color2-color1)*randoms.b;
#endif

#ifndef ANGULARSPEEDGRADIENTS
outAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;
outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#else
outAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#endif

#ifdef POINTEMITTER
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
position=vec3(0,0,0);
direction=direction1+(direction2-direction1)*randoms3;
#elif defined(BOXEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
position=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;
direction=direction1+(direction2-direction1)*randoms3;
#elif defined(HEMISPHERICEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
position=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);
direction=position+directionRandomizer*randoms3;
#elif defined(SPHEREEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
position=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);
#ifdef DIRECTEDSPHEREEMITTER
direction=direction1+(direction2-direction1)*randoms3;
#else

direction=position+directionRandomizer*randoms3;
#endif
#elif defined(CYLINDEREMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float yPos=(randoms2.x-0.5)*height;
float angle=randoms2.y*PI*2.;
float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));
float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));
float xPos=positionRadius*cos(angle);
float zPos=positionRadius*sin(angle);
position=vec3(xPos,yPos,zPos);
#ifdef DIRECTEDCYLINDEREMITTER
direction=direction1+(direction2-direction1)*randoms3;
#else

angle=angle+((randoms3.x-0.5)*PI);
direction=vec3(cos(angle),randoms3.y-0.5,sin(angle));
direction=normalize(direction);
#endif
#elif defined(CONEEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
float s=2.0*PI*randoms2.x;
#ifdef CONEEMITTERSPAWNPOINT
float h=0.00001;
#else
float h=randoms2.y*height.y;

h=1.-h*h;
#endif
float lRadius=radius.x-radius.x*randoms2.z*radius.y;
lRadius=lRadius*h;
float randX=lRadius*sin(s);
float randZ=lRadius*cos(s);
float randY=h*height.x;
position=vec3(randX,randY,randZ);

if (abs(cos(coneAngle)) == 1.0) {
direction=vec3(0.,1.0,0.);
} else {
vec3 randoms3=getRandomVec3(seed.z);
direction=position+directionRandomizer*randoms3;
}
#else

position=vec3(0.,0.,0.);

direction=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));
#endif
float power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;
outPosition=(emitterWM*vec4(position,1.)).xyz;
vec3 initial=(emitterWM*vec4(direction,0.)).xyz;
outDirection=initial*power;
#ifndef BILLBOARD
outInitialDirection=initial;
#endif
#ifdef ANIMATESHEET
outCellIndex=cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=randoms.a*outLife;
#endif
#endif
#ifdef NOISE
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
} else {
float directionScale=timeDelta;
outAge=newAge;
float ageGradient=newAge/life;
#ifdef VELOCITYGRADIENTS
directionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;
#endif
#ifdef DRAGGRADIENTS
directionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;
#endif
outPosition=position+direction*directionScale;
outLife=life;
outSeed=seed;
#ifndef COLORGRADIENTS
outColor=color;
#endif
#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;
outSize.yz=size.yz;
#else
outSize=size;
#endif
#ifndef BILLBOARD
outInitialDirection=initialDirection;
#endif
vec3 updatedDirection=direction+gravity*timeDelta;
#ifdef LIMITVELOCITYGRADIENTS
float limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;
float currentVelocity=length(updatedDirection);
if (currentVelocity>limitVelocity) {
updatedDirection=updatedDirection*limitVelocityDamping;
}
#endif
outDirection=updatedDirection;
#ifdef NOISE
vec3 localPosition=outPosition-emitterWM[3].xyz;
float fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;
float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;
float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;
vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;
outDirection=outDirection+force*timeDelta;
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
#ifdef ANGULARSPEEDGRADIENTS
float angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;
outAngle=angle+angularSpeed*timeDelta;
#else
outAngle=vec2(angle.x+angle.y*timeDelta,angle.y);
#endif
#ifdef ANIMATESHEET
float offsetAge=outAge;
float dist=cellInfos.y-cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=cellStartOffset;
offsetAge+=cellStartOffset;
#endif
float ratio=clamp(mod(offsetAge*cellInfos.z,life)/life,0.,1.0);
outCellIndex=float(int(cellInfos.x+ratio*dist));
#endif
}
}`;Ia.a.ShadersStore.gpuUpdateParticlesVertexShader=vk;var wk=`#ifdef CLIPPLANE
in float fClipDistance;
#endif
#ifdef CLIPPLANE2
in float fClipDistance2;
#endif
#ifdef CLIPPLANE3
in float fClipDistance3;
#endif
#ifdef CLIPPLANE4
in float fClipDistance4;
#endif`;Ia.a.IncludesShadersStore.clipPlaneFragmentDeclaration2=wk;var xk=`#version 300 es
uniform sampler2D textureSampler;
in vec2 vUV;
in vec4 vColor;
out vec4 outFragColor;
#include<clipPlaneFragmentDeclaration2>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main() {
#include<clipPlaneFragment>
vec4 textureColor=texture(textureSampler,vUV);
outFragColor=textureColor*vColor;
#ifdef BLENDMULTIPLYMODE
float alpha=vColor.a*textureColor.a;
outFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
#else
#ifdef IMAGEPROCESSING
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
outFragColor=applyImageProcessing(outFragColor);
#endif
#endif
}
`;Ia.a.ShadersStore.gpuRenderParticlesPixelShader=xk;var yk=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
out float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
out float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
out float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
out float fClipDistance4;
#endif`;Ia.a.IncludesShadersStore.clipPlaneVertexDeclaration2=yk;var zk=`#version 300 es
uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
uniform vec3 worldOffset;

in vec3 position;
in float age;
in float life;
in vec3 size;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef BILLBOARDSTRETCHED
in vec3 direction;
#endif
in float angle;
#ifdef ANIMATESHEET
in float cellIndex;
#endif
in vec2 offset;
in vec2 uv;
out vec2 vUV;
out vec4 vColor;
#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration2>
#ifdef COLORGRADIENTS
uniform sampler2D colorGradientSampler;
#else
uniform vec4 colorDead;
in vec4 color;
#endif
#ifdef ANIMATESHEET
uniform vec3 sheetInfos;
#endif
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return (position+worldOffset)+alignedCorner;
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return (position+worldOffset)+alignedCorner;
}
#endif
void main() {
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex/sheetInfos.z);
float columnOffset=cellIndex-rowOffset*sheetInfos.z;
vec2 uvScale=sheetInfos.xy;
vec2 uvOffset=vec2(uv.x ,1.0-uv.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=uv;
#endif
float ratio=age/life;
#ifdef COLORGRADIENTS
vColor=texture(colorGradientSampler,vec2(ratio,0));
#else
vColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);
#endif
vec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;
#ifdef BILLBOARD
vec4 rotatedCorner;
rotatedCorner.w=0.;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=(position+worldOffset)-eyePosition;
yaxis.y=0.;
vec3 worldPos=rotate(normalize(yaxis),rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(worldPos,1.0));
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=(position+worldOffset)-eyePosition;
vec3 worldPos=rotateAlign(toCamera,rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(worldPos,1.0));
#else

rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

vec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;
#endif
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=0.;
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
vec3 yaxis=normalize(initialDirection);
vec3 worldPos=rotate(yaxis,rotatedCorner);

vec4 viewPosition=view*vec4(worldPos,1.0);
#endif
gl_Position=projection*viewPosition;

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)
vec4 worldPos=invView*viewPosition;
#endif
#include<clipPlaneVertex>
}`;Ia.a.ShadersStore.gpuRenderParticlesVertexShader=zk;var qd=function(e){function a(b,c,d,f){void 0===f&&(f=!1);var h=e.call(this,b)||this;h.layerMask=268435455,h._accumulatedCount=0,h._targetIndex=0,h._currentRenderId=-1,h._started=!1,h._stopped=!1,h._timeDelta=0,h._actualFrame=0,h._rawTextureWidth=256,h.onDisposeObservable=new q.c(),h.forceDepthWrite=!1,h._preWarmDone=!1,h._scene=d||T.a.LastCreatedScene,h._attachImageProcessingConfiguration(null),h._engine=h._scene.getEngine(),c.randomTextureSize||delete c.randomTextureSize;var i=v.a({capacity:50000,randomTextureSize:h._engine.getCaps().maxTextureSize},c),k=c;isFinite(k)&&(i.capacity=k),h._capacity=i.capacity,h._activeCount=i.capacity,h._currentActiveCount=0,h._isAnimationSheetEnabled=f,h._scene.particleSystems.push(h),h._updateEffectOptions={attributes:["position","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]},h.particleEmitterType=new Tc();for(var m=Math.min(h._engine.getCaps().maxTextureSize,i.randomTextureSize),B=[],E=0;E<m;++E)B.push(Math.random()),B.push(Math.random()),B.push(Math.random()),B.push(Math.random());for(h._randomTexture=new zc(new Float32Array(B),m,1,o.a.TEXTUREFORMAT_RGBA,h._scene,!1,!1,o.a.TEXTURE_NEAREST_SAMPLINGMODE,o.a.TEXTURETYPE_FLOAT),h._randomTexture.wrapU=ra.a.WRAP_ADDRESSMODE,h._randomTexture.wrapV=ra.a.WRAP_ADDRESSMODE,B=[],E=0;E<m;++E)B.push(Math.random()),B.push(Math.random()),B.push(Math.random()),B.push(Math.random());return h._randomTexture2=new zc(new Float32Array(B),m,1,o.a.TEXTUREFORMAT_RGBA,h._scene,!1,!1,o.a.TEXTURE_NEAREST_SAMPLINGMODE,o.a.TEXTURETYPE_FLOAT),h._randomTexture2.wrapU=ra.a.WRAP_ADDRESSMODE,h._randomTexture2.wrapV=ra.a.WRAP_ADDRESSMODE,h._randomTextureSize=m,h}return v.d(a,e),Object.defineProperty(a,"IsSupported",{get:function(){return!!T.a.LastCreatedEngine&&T.a.LastCreatedEngine.webGLVersion>1},enumerable:!0,configurable:!0}),a.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(a.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(b){this._activeCount=Math.min(b,this._capacity)},enumerable:!0,configurable:!0}),a.prototype.isReady=function(){return this._updateEffect?!!(this.emitter&&this._updateEffect.isReady()&&this._imageProcessingConfiguration.isReady()&&this._renderEffect.isReady()&&this.particleTexture&&this.particleTexture.isReady()):(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)},a.prototype.isStarted=function(){return this._started},a.prototype.start=function(b){var c=this;if(void 0===b&&(b=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";b?setTimeout(function(){c.start(0)},b):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},a.prototype.stop=function(){this._stopped=!0},a.prototype.reset=function(){this._releaseBuffers(),this._releaseVAOs(),this._currentActiveCount=0,this._targetIndex=0},a.prototype.getClassName=function(){return"GPUParticleSystem"},a.prototype._removeGradientAndTexture=function(b,c,d){return e.prototype._removeGradientAndTexture.call(this,b,c,d),this._releaseBuffers(),this},a.prototype.addColorGradient=function(b,c,d){this._colorGradients||(this._colorGradients=[]);var f=new xa.c();return f.gradient=b,f.color1=c,this._colorGradients.push(f),this._colorGradients.sort(function(h,i){return h.gradient<i.gradient?-1:h.gradient>i.gradient?1:0}),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._releaseBuffers(),this},a.prototype.removeColorGradient=function(b){return this._removeGradientAndTexture(b,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},a.prototype._addFactorGradient=function(b,c,d){var f=new xa.d();f.gradient=c,f.factor1=d,b.push(f),b.sort(function(h,i){return h.gradient<i.gradient?-1:h.gradient>i.gradient?1:0}),this._releaseBuffers()},a.prototype.addSizeGradient=function(b,c){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,b,c),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._releaseBuffers(),this},a.prototype.removeSizeGradient=function(b){return this._removeGradientAndTexture(b,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},a.prototype.addAngularSpeedGradient=function(b,c){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,b,c),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._releaseBuffers(),this},a.prototype.removeAngularSpeedGradient=function(b){return this._removeGradientAndTexture(b,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},a.prototype.addVelocityGradient=function(b,c){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,b,c),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._releaseBuffers(),this},a.prototype.removeVelocityGradient=function(b){return this._removeGradientAndTexture(b,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},a.prototype.addLimitVelocityGradient=function(b,c){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,b,c),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._releaseBuffers(),this},a.prototype.removeLimitVelocityGradient=function(b){return this._removeGradientAndTexture(b,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},a.prototype.addDragGradient=function(b,c){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,b,c),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._releaseBuffers(),this},a.prototype.removeDragGradient=function(b){return this._removeGradientAndTexture(b,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},a.prototype.addEmitRateGradient=function(b,c,d){return this},a.prototype.removeEmitRateGradient=function(b){return this},a.prototype.addStartSizeGradient=function(b,c,d){return this},a.prototype.removeStartSizeGradient=function(b){return this},a.prototype.addColorRemapGradient=function(b,c,d){return this},a.prototype.removeColorRemapGradient=function(){return this},a.prototype.addAlphaRemapGradient=function(b,c,d){return this},a.prototype.removeAlphaRemapGradient=function(){return this},a.prototype.addRampGradient=function(b,c){return this},a.prototype.removeRampGradient=function(){return this},a.prototype.getRampGradients=function(){return null},Object.defineProperty(a.prototype,"useRampGradients",{get:function(){return!1},set:function(b){},enumerable:!0,configurable:!0}),a.prototype.addLifeTimeGradient=function(b,c,d){return this},a.prototype.removeLifeTimeGradient=function(b){return this},a.prototype._reset=function(){this._releaseBuffers()},a.prototype._createUpdateVAO=function(b){var c={};c.position=b.createVertexBuffer("position",0,3),c.age=b.createVertexBuffer("age",3,1),c.life=b.createVertexBuffer("life",4,1),c.seed=b.createVertexBuffer("seed",5,4),c.size=b.createVertexBuffer("size",9,3);var d=12;this._colorGradientsTexture||(c.color=b.createVertexBuffer("color",d,4),d+=4),c.direction=b.createVertexBuffer("direction",d,3),d+=3,this._isBillboardBased||(c.initialDirection=b.createVertexBuffer("initialDirection",d,3),d+=3),this._angularSpeedGradientsTexture?(c.angle=b.createVertexBuffer("angle",d,1),d+=1):(c.angle=b.createVertexBuffer("angle",d,2),d+=2),this._isAnimationSheetEnabled&&(c.cellIndex=b.createVertexBuffer("cellIndex",d,1),d+=1,this.spriteRandomStartCell&&(c.cellStartOffset=b.createVertexBuffer("cellStartOffset",d,1),d+=1)),this.noiseTexture&&(c.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",d,3),d+=3,c.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",d,3),d+=3);var f=this._engine.recordVertexArrayObject(c,null,this._updateEffect);return this._engine.bindArrayBuffer(null),f},a.prototype._createRenderVAO=function(b,c){var d={};d.position=b.createVertexBuffer("position",0,3,this._attributesStrideSize,!0),d.age=b.createVertexBuffer("age",3,1,this._attributesStrideSize,!0),d.life=b.createVertexBuffer("life",4,1,this._attributesStrideSize,!0),d.size=b.createVertexBuffer("size",9,3,this._attributesStrideSize,!0);var f=12;this._colorGradientsTexture||(d.color=b.createVertexBuffer("color",f,4,this._attributesStrideSize,!0),f+=4),this.billboardMode===Jb.BILLBOARDMODE_STRETCHED&&(d.direction=b.createVertexBuffer("direction",f,3,this._attributesStrideSize,!0)),f+=3,this._isBillboardBased||(d.initialDirection=b.createVertexBuffer("initialDirection",f,3,this._attributesStrideSize,!0),f+=3),d.angle=b.createVertexBuffer("angle",f,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?f++:f+=2,this._isAnimationSheetEnabled&&(d.cellIndex=b.createVertexBuffer("cellIndex",f,1,this._attributesStrideSize,!0),f+=1,this.spriteRandomStartCell&&(d.cellStartOffset=b.createVertexBuffer("cellStartOffset",f,1,this._attributesStrideSize,!0),f+=1)),this.noiseTexture&&(d.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",f,3,this._attributesStrideSize,!0),f+=3,d.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",f,3,this._attributesStrideSize,!0),f+=3),d.offset=c.createVertexBuffer("offset",0,2),d.uv=c.createVertexBuffer("uv",2,2);var h=this._engine.recordVertexArrayObject(d,null,this._renderEffect);return this._engine.bindArrayBuffer(null),h},a.prototype._initialize=function(b){if(void 0===b&&(b=!1),!this._buffer0||b){var c=this._scene.getEngine(),d=new Array();this._attributesStrideSize=21,this._targetIndex=0,this.isBillboardBased||(this._attributesStrideSize+=3),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6);for(var f=0;f<this._capacity;f++)d.push(0),d.push(0),d.push(0),d.push(0),d.push(0),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(0),d.push(0),d.push(0),this._colorGradientsTexture||(d.push(0),d.push(0),d.push(0),d.push(0)),d.push(0),d.push(0),d.push(0),this.isBillboardBased||(d.push(0),d.push(0),d.push(0)),d.push(0),this._angularSpeedGradientsTexture||d.push(0),this._isAnimationSheetEnabled&&(d.push(0),this.spriteRandomStartCell&&d.push(0)),this.noiseTexture&&(d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random()));var h=new Float32Array([.5,.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new na.a(c,d,!1,this._attributesStrideSize),this._buffer1=new na.a(c,d,!1,this._attributesStrideSize),this._spriteBuffer=new na.a(c,h,!1,4),this._updateVAO=[],this._updateVAO.push(this._createUpdateVAO(this._buffer0)),this._updateVAO.push(this._createUpdateVAO(this._buffer1)),this._renderVAO=[],this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer)),this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer)),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},a.prototype._recreateUpdateEffect=function(){var b=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(b+=`
#define BILLBOARD`),this._colorGradientsTexture&&(b+=`
#define COLORGRADIENTS`),this._sizeGradientsTexture&&(b+=`
#define SIZEGRADIENTS`),this._angularSpeedGradientsTexture&&(b+=`
#define ANGULARSPEEDGRADIENTS`),this._velocityGradientsTexture&&(b+=`
#define VELOCITYGRADIENTS`),this._limitVelocityGradientsTexture&&(b+=`
#define LIMITVELOCITYGRADIENTS`),this._dragGradientsTexture&&(b+=`
#define DRAGGRADIENTS`),this.isAnimationSheetEnabled&&(b+=`
#define ANIMATESHEET`,this.spriteRandomStartCell&&(b+=`
#define ANIMATESHEETRANDOMSTART`)),this.noiseTexture&&(b+=`
#define NOISE`),this._updateEffect&&this._updateEffectOptions.defines===b||(this._updateEffectOptions.transformFeedbackVaryings=["outPosition","outAge","outLife","outSeed","outSize"],this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.defines=b,this._updateEffect=new Ia.a("gpuUpdateParticles",this._updateEffectOptions,this._scene.getEngine()))},a.prototype._recreateRenderEffect=function(){var b="";if(this._scene.clipPlane&&(b=`
#define CLIPPLANE`),this._scene.clipPlane2&&(b=`
#define CLIPPLANE2`),this._scene.clipPlane3&&(b=`
#define CLIPPLANE3`),this._scene.clipPlane4&&(b=`
#define CLIPPLANE4`),this.blendMode===Jb.BLENDMODE_MULTIPLY&&(b=`
#define BLENDMULTIPLYMODE`),this._isBillboardBased)switch(b+=`
#define BILLBOARD`,this.billboardMode){case Jb.BILLBOARDMODE_Y:b+=`
#define BILLBOARDY`;break;case Jb.BILLBOARDMODE_STRETCHED:b+=`
#define BILLBOARDSTRETCHED`;break;case Jb.BILLBOARDMODE_ALL:}if(this._colorGradientsTexture&&(b+=`
#define COLORGRADIENTS`),this.isAnimationSheetEnabled&&(b+=`
#define ANIMATESHEET`),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),b+=`
`+this._imageProcessingConfigurationDefines.toString()),!this._renderEffect||this._renderEffect.defines!==b){var c=["worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","sheetInfos","translationPivot","eyePosition"],d=["textureSampler","colorGradientSampler"];Eb.a&&(Eb.a.PrepareUniforms(c,this._imageProcessingConfigurationDefines),Eb.a.PrepareSamplers(d,this._imageProcessingConfigurationDefines)),this._renderEffect=new Ia.a("gpuRenderParticles",["position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex"],c,d,this._scene.getEngine(),b)}},a.prototype.animate=function(b){void 0===b&&(b=!1),this._timeDelta=this.updateSpeed*(b?this.preWarmStepOffset:this._scene.getAnimationRatio()),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},a.prototype._createFactorGradientTexture=function(b,c){var d=this[c];if(b&&b.length&&!d){for(var f=new Float32Array(this._rawTextureWidth),h=0;h<this._rawTextureWidth;h++){var i=h/this._rawTextureWidth;xa.h.GetCurrentGradient(i,b,function(k,m,B){f[h]=p.a.Lerp(k.factor1,m.factor1,B)})}this[c]=zc.CreateRTexture(f,this._rawTextureWidth,1,this._scene,!1,!1,ra.a.NEAREST_SAMPLINGMODE)}},a.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},a.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},a.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},a.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},a.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},a.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var b=new Uint8Array(4*this._rawTextureWidth),c=j.t.Color4[0],d=0;d<this._rawTextureWidth;d++){var f=d/this._rawTextureWidth;xa.h.GetCurrentGradient(f,this._colorGradients,function(h,i,k){j.f.LerpToRef(h.color1,i.color1,k,c),b[4*d]=255*c.r,b[4*d+1]=255*c.g,b[4*d+2]=255*c.b,b[4*d+3]=255*c.a})}this._colorGradientsTexture=zc.CreateRGBATexture(b,this._rawTextureWidth,1,this._scene,!1,!1,ra.a.NEAREST_SAMPLINGMODE)}},a.prototype.render=function(b){if(void 0===b&&(b=!1),!this._started)return 0;if(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),this._recreateRenderEffect(),!this.isReady())return 0;if(!b){if(!this._preWarmDone&&this.preWarmCycles){for(var c=0;c<this.preWarmCycles;c++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId())return 0;this._currentRenderId=this._scene.getFrameId()}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var d=0|this._accumulatedCount;this._accumulatedCount-=d,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+d)}if(!this._currentActiveCount)return 0;var f;if(this._engine.enableEffect(this._updateEffect),this._engine.setState(!1),this._updateEffect.setFloat("currentCount",this._currentActiveCount),this._updateEffect.setFloat("timeDelta",this._timeDelta),this._updateEffect.setFloat("stopFactor",this._stopped?0:1),this._updateEffect.setTexture("randomSampler",this._randomTexture),this._updateEffect.setTexture("randomSampler2",this._randomTexture2),this._updateEffect.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2)),this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateEffect.setVector3("gravity",this.gravity),this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture),this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture),this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture),this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping)),this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect),this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed),this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength)),this.emitter.position)f=this.emitter.getWorldMatrix();else{var h=this.emitter;f=j.j.Translation(h.x,h.y,h.z)}if(this._updateEffect.setMatrix("emitterWM",f),this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex],null),this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),this._engine.setRasterizerState(!1),this._engine.beginTransformFeedback(!0),this._engine.drawArraysType(rb.a.PointListDrawMode,0,this._currentActiveCount),this._engine.endTransformFeedback(),this._engine.setRasterizerState(!0),this._engine.bindTransformFeedbackBuffer(null),!b){this._engine.enableEffect(this._renderEffect);var i=this._scene.getViewMatrix();if(this._renderEffect.setMatrix("view",i),this._renderEffect.setMatrix("projection",this._scene.getProjectionMatrix()),this._renderEffect.setTexture("textureSampler",this.particleTexture),this._renderEffect.setVector2("translationPivot",this.translationPivot),this._renderEffect.setVector3("worldOffset",this.worldOffset),this._colorGradientsTexture?this._renderEffect.setTexture("colorGradientSampler",this._colorGradientsTexture):this._renderEffect.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var k=this.particleTexture.getBaseSize();this._renderEffect.setFloat3("sheetInfos",this.spriteCellWidth/k.width,this.spriteCellHeight/k.height,k.width/this.spriteCellWidth)}if(this._isBillboardBased){var m=this._scene.activeCamera;this._renderEffect.setVector3("eyePosition",m.globalPosition)}if(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4){var B=i.clone();B.invert(),this._renderEffect.setMatrix("invView",B),Ta.a.BindClipPlane(this._renderEffect,this._scene)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._renderEffect),this.blendMode){case Jb.BLENDMODE_ADD:this._engine.setAlphaMode(o.a.ALPHA_ADD);break;case Jb.BLENDMODE_ONEONE:this._engine.setAlphaMode(o.a.ALPHA_ONEONE);break;case Jb.BLENDMODE_STANDARD:this._engine.setAlphaMode(o.a.ALPHA_COMBINE);break;case Jb.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(o.a.ALPHA_MULTIPLY)}this.forceDepthWrite&&this._engine.setDepthWrite(!0),this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex],null),this._engine.drawArraysType(rb.a.TriangleFanDrawMode,0,4,this._currentActiveCount),this._engine.setAlphaMode(o.a.ALPHA_DISABLE)}this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);var E=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=E,this._currentActiveCount},a.prototype.rebuild=function(){this._initialize(!0)},a.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)},a.prototype._releaseVAOs=function(){if(this._updateVAO){for(var b=0;b<this._updateVAO.length;b++)this._engine.releaseVertexArrayObject(this._updateVAO[b]);for(this._updateVAO=[],b=0;b<this._renderVAO.length;b++)this._engine.releaseVertexArrayObject(this._renderVAO[b]);this._renderVAO=[]}},a.prototype.dispose=function(b){void 0===b&&(b=!0);var c=this._scene.particleSystems.indexOf(this);c>-1&&this._scene.particleSystems.splice(c,1),this._releaseBuffers(),this._releaseVAOs(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),b&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),b&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},a.prototype.clone=function(b,c){var d=new a(b,{capacity:this._capacity,randomTextureSize:this._randomTextureSize},this._scene);return V.a.DeepCopy(this,d),void 0===c&&(c=this.emitter),d.emitter=c,this.particleTexture&&(d.particleTexture=new ra.a(this.particleTexture.url,this._scene)),d},a.prototype.serialize=function(){var b={};return Jb._Serialize(b,this),b.activeParticleCount=this.activeParticleCount,b},a.Parse=function(b,c,d,f){void 0===f&&(f=!1);var h=new a(b.name,{capacity:b.capacity,randomTextureSize:b.randomTextureSize},c);return b.activeParticleCount&&(h.activeParticleCount=b.activeParticleCount),Jb._Parse(b,h,c,d),b.preventAutoStart&&(h.preventAutoStart=b.preventAutoStart),f||h.preventAutoStart||h.start(),h},a}(yf),zf=(function(){}(),function(){function e(){this.systems=new Array()}return Object.defineProperty(e.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!0,configurable:!0}),e.prototype.setEmitterAsSphere=function(a,b,c){this._emitterNode&&this._emitterNode.dispose(),this._emitterCreationOptions={kind:"Sphere",options:a,renderingGroupId:b};var d=lc.a.CreateSphere("emitterSphere",{diameter:a.diameter,segments:a.segments},c);d.renderingGroupId=b;var f=new Pb.a("emitterSphereMaterial",c);f.emissiveColor=a.color,d.material=f;for(var h=0,i=this.systems;h<i.length;h++)i[h].emitter=d;this._emitterNode=d},e.prototype.start=function(a){for(var b=0,c=this.systems;b<c.length;b++){var d=c[b];a&&(d.emitter=a),d.start()}},e.prototype.dispose=function(){for(var a=0,b=this.systems;a<b.length;a++)b[a].dispose();this.systems=[],this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)},e.prototype.serialize=function(){for(var a={systems:[]},b=0,c=this.systems;b<c.length;b++){var d=c[b];a.systems.push(d.serialize())}return this._emitterNode&&(a.emitter=this._emitterCreationOptions),a},e.Parse=function(a,b,c){void 0===c&&(c=!1);var d=new e(),f=o.a.PARTICLES_BaseAssetsUrl+"/textures/";b=b||T.a.LastCreatedScene;for(var h=0,i=a.systems;h<i.length;h++){var k=i[h];d.systems.push(c?qd.Parse(k,b,f,!0):Jb.Parse(k,b,f,!0))}if(a.emitter){var m=a.emitter.options;switch(a.emitter.kind){case"Sphere":d.setEmitterAsSphere({diameter:m.diameter,segments:m.segments,color:j.e.FromArray(m.color)},a.emitter.renderingGroupId,b)}}return d},e}()),Ak=function(){function e(){}return e.CreateDefault=function(a,b,c,d){var f;return void 0===b&&(b=500),void 0===d&&(d=!1),(f=d?new qd("default system",{capacity:b},c):new Jb("default system",b,c)).emitter=a,f.particleTexture=new ra.a("https://www.babylonjs.com/assets/Flare.png",f.getScene()),f.createConeEmitter(.1,Math.PI/4),f.color1=new j.f(1,1,1,1),f.color2=new j.f(1,1,1,1),f.colorDead=new j.f(1,1,1,0),f.minSize=.1,f.maxSize=.1,f.minEmitPower=2,f.maxEmitPower=2,f.updateSpeed=1/60,f.emitRate=30,f},e.CreateAsync=function(a,b,c){void 0===c&&(c=!1),b||(b=T.a.LastCreatedScene);var d={};return b._addPendingData(d),new Promise(function(f,h){if(c&&!qd.IsSupported)return b._removePendingData(d),h("Particle system with GPU is not supported.");xa.h.LoadFile(e.BaseAssetsUrl+"/systems/"+a+".json",function(i){b._removePendingData(d);var k=JSON.parse(i.toString());return f(zf.Parse(k,b,c))},void 0,void 0,void 0,function(){return b._removePendingData(d),h("An error occured while the creation of your particle system. Check if your type '"+a+"' exists.")})})},e.ExportSet=function(a){for(var b=new zf(),c=0,d=a;c<d.length;c++){var f=d[c];b.systems.push(f)}return b},e.BaseAssetsUrl=o.a.PARTICLES_BaseAssetsUrl,e}();O.a.AddParser(Pa.a.NAME_PARTICLESYSTEM,function(e,a,b,c){var d=O.a.GetIndividualParser(Pa.a.NAME_PARTICLESYSTEM);if(d&&void 0!==e.particleSystems&&null!==e.particleSystems)for(var f=0,h=e.particleSystems.length;f<h;f++){var i=e.particleSystems[f];b.particleSystems.push(d(i,a,c))}}),O.a.AddIndividualParser(Pa.a.NAME_PARTICLESYSTEM,function(e,a,b){return e.activeParticleCount?qd.Parse(e,a,b):Jb.Parse(e,a,b)}),va.b.prototype.createEffectForParticles=function(e,a,b,c,d,f,h){void 0===a&&(a=[]),void 0===b&&(b=[]),void 0===c&&(c="");var i=Jb._GetAttributeNamesOrOptions(),k=Jb._GetEffectCreationOptions();return-1===c.indexOf(" BILLBOARD")&&(c+=`
#define BILLBOARD
`),-1===b.indexOf("diffuseSampler")&&b.push("diffuseSampler"),this.createEffect({vertex:"particles",fragmentElement:e},i,k.concat(a),b,c,d,f,h)},Ca.a.prototype.getEmittedParticleSystems=function(){for(var e=new Array(),a=0;a<this.getScene().particleSystems.length;a++){var b=this.getScene().particleSystems[a];b.emitter===this&&e.push(b)}return e},Ca.a.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array(),a=this.getDescendants();a.push(this);for(var b=0;b<this.getScene().particleSystems.length;b++){var c=this.getScene().particleSystems[b],d=c.emitter;d.position&&-1!==a.indexOf(d)&&e.push(c)}return e};var Af=function(){function e(a,b,c,d,f,h,i,k){void 0===k&&(k=null),this.idx=0,this.color=new j.f(1,1,1,1),this.position=j.x.Zero(),this.rotation=j.x.Zero(),this.scaling=j.x.One(),this.uvs=new j.y(0,0,1,1),this.velocity=j.x.Zero(),this.pivot=j.x.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.cullingStrategy=kb.a.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=j.x.Zero(),this.idx=a,this._pos=b,this._ind=c,this._model=d,this.shapeId=f,this.idxInShape=h,this._sps=i,k&&(this._modelBoundingInfo=k,this._boundingInfo=new Kc.a(k.minimum,k.maximum))}return Object.defineProperty(e.prototype,"scale",{get:function(){return this.scaling},set:function(a){this.scaling=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(a){this.rotationQuaternion=a},enumerable:!0,configurable:!0}),e.prototype.intersectsMesh=function(a){return!(!this._boundingInfo||!a._boundingInfo)&&(this._sps._bSphereOnly?Ng.a.Intersects(this._boundingInfo.boundingSphere,a._boundingInfo.boundingSphere):this._boundingInfo.intersects(a._boundingInfo,!1))},e.prototype.isInFrustum=function(a){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(a,this.cullingStrategy)},e.prototype.getRotationMatrix=function(a){var b;if(this.rotationQuaternion)b=this.rotationQuaternion;else{b=j.t.Quaternion[0];var c=this.rotation;j.q.RotationYawPitchRollToRef(c.y,c.x,c.z,b)}b.toRotationMatrix(a)},e}(),Bf=function(){return function(e,a,b,c,d,f){this._indicesLength=0,this.shapeID=e,this._shape=a,this._indicesLength=b,this._shapeUV=c,this._positionFunction=d,this._vertexFunction=f}}(),Qh=function(){return function(){this.ind=0,this.indicesLength=0,this.sqDistance=0}}(),Bk=function(e,a){return a.sqDistance-e.sqDistance},Ck=function(){function e(a,b,c){this.particles=new Array(),this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!0,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array(),this._indices=new Array(),this._normals=new Array(),this._colors=new Array(),this._uvs=new Array(),this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._shapeCounter=0,this._copy=new Af(0,0,0,null,0,0,this),this._color=new j.f(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this.name=a,this._scene=b||T.a.LastCreatedScene,this._camera=b.activeCamera,this._pickable=!!c&&c.isPickable,this._depthSort=!!c&&c.enableDepthSort,this._particlesIntersect=!!c&&c.particleIntersection,this._bSphereOnly=!!c&&c.boundingSphereOnly,this._bSphereRadiusFactor=c&&c.bSphereRadiusFactor?c.bSphereRadiusFactor:1,c&&void 0!==c.updatable?this._updatable=c.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[]),this._depthSort&&(this.depthSortedParticles=[])}return e.prototype.buildMesh=function(){if(0===this.nbParticles){var a=Vd.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(a,1),a.dispose()}this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),this.recomputeNormals&&Wa.a.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var b=new Wa.a();b.indices=this._depthSort?this._indices:this._indices32,b.set(this._positions32,na.b.PositionKind),b.set(this._normals32,na.b.NormalKind),this._uvs32.length>0&&b.set(this._uvs32,na.b.UVKind),this._colors32.length>0&&b.set(this._colors32,na.b.ColorKind);var c=new Ca.a(this.name,this._scene);return b.applyToMesh(c,this._updatable),this.mesh=c,this.mesh.isPickable=this._pickable,this._depthSort||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),c},e.prototype.digest=function(a,b){var c=b&&b.facetNb||1,d=b&&b.number||0,f=b&&b.delta||0,h=a.getVerticesData(na.b.PositionKind),i=a.getIndices(),k=a.getVerticesData(na.b.UVKind),m=a.getVerticesData(na.b.ColorKind),B=a.getVerticesData(na.b.NormalKind),E=0,K=i.length/3;d?(d=d>K?K:d,c=Math.round(K/d),f=0):c=c>K?K:c;for(var P=[],S=[],U=[],_=[],da=j.x.Zero(),fa=c;E<K;){E>K-(c=fa+Math.floor((1+f)*Math.random()))&&(c=K-E),P.length=0,S.length=0,U.length=0,_.length=0;for(var ga=0,ha=3*E;ha<3*(E+c);ha++){S.push(ga);var ka=i[ha];P.push(h[3*ka],h[3*ka+1],h[3*ka+2]),k&&U.push(k[2*ka],k[2*ka+1]),m&&_.push(m[4*ka],m[4*ka+1],m[4*ka+2],m[4*ka+3]),ga++}var la,ma,ta=this.nbParticles,pa=this._posToShape(P),ua=this._uvsToShapeUV(U);for(la=0;la<pa.length;la++)da.addInPlace(pa[la]);for(da.scaleInPlace(1/pa.length),la=0;la<pa.length;la++)pa[la].subtractInPlace(da);this._particlesIntersect&&(ma=new Kc.a(da,da));var wa=new Bf(this._shapeCounter,pa,3*c,ua,null,null),ya=this._positions.length,Da=this._indices.length;this._meshBuilder(this._index,pa,this._positions,S,this._indices,U,this._uvs,_,this._colors,B,this._normals,ta,0,null),this._addParticle(ta,ya,Da,wa,this._shapeCounter,0,ma),this.particles[this.nbParticles].position.addInPlace(da),this._index+=pa.length,ta++,this.nbParticles++,this._shapeCounter++,E+=c}return this},e.prototype._unrotateFixedNormals=function(){for(var a=0,b=0,c=j.t.Vector3[0],d=j.t.Quaternion[0],f=j.t.Matrix[0],h=0;h<this.particles.length;h++){var i=this.particles[h],k=i._model._shape;if(i.rotationQuaternion)i.rotationQuaternion.conjugateToRef(d);else{var m=i.rotation;j.q.RotationYawPitchRollToRef(m.y,m.x,m.z,d),d.conjugateInPlace()}d.toRotationMatrix(f);for(var B=0;B<k.length;B++)b=a+3*B,j.x.TransformNormalFromFloatsToRef(this._normals32[b],this._normals32[b+1],this._normals32[b+2],f,c),c.toArray(this._fixedNormal32,b);a=b+3}},e.prototype._resetCopy=function(){var a=this._copy;a.position.setAll(0),a.rotation.setAll(0),a.rotationQuaternion=null,a.scaling.setAll(1),a.uvs.copyFromFloats(0,0,1,1),a.color=null,a.translateFromPivot=!1},e.prototype._meshBuilder=function(a,b,c,d,f,h,i,k,m,B,E,K,P,S){var U,_=0,da=0,fa=0;this._resetCopy();var ga=this._copy;S&&S.positionFunction&&(S.positionFunction(ga,K,P),this._mustUnrotateFixedNormals=!0);var ha=j.t.Matrix[0],ka=j.t.Vector3[0],la=j.t.Vector3[1],ma=j.t.Vector3[2],ta=j.t.Vector3[3];for(ga.getRotationMatrix(ha),ga.pivot.multiplyToRef(ga.scaling,ta),ga.translateFromPivot?ma.setAll(0):ma.copyFrom(ta),U=0;U<b.length;U++){if(ka.copyFrom(b[U]),S&&S.vertexFunction&&S.vertexFunction(ga,ka,U),ka.multiplyInPlace(ga.scaling).subtractInPlace(ta),j.x.TransformCoordinatesToRef(ka,ha,la),la.addInPlace(ma).addInPlace(ga.position),c.push(la.x,la.y,la.z),h){var pa=ga.uvs;i.push((pa.z-pa.x)*h[_]+pa.x,(pa.w-pa.y)*h[_+1]+pa.y),_+=2}if(ga.color)this._color=ga.color;else{var ua=this._color;k&&void 0!==k[da]?(ua.r=k[da],ua.g=k[da+1],ua.b=k[da+2],ua.a=k[da+3]):(ua.r=1,ua.g=1,ua.b=1,ua.a=1)}m.push(this._color.r,this._color.g,this._color.b,this._color.a),da+=4,!this.recomputeNormals&&B&&(ka.x=B[fa],ka.y=B[fa+1],ka.z=B[fa+2],j.x.TransformNormalToRef(ka,ha,ka),E.push(ka.x,ka.y,ka.z),fa+=3)}for(U=0;U<d.length;U++){var wa=a+d[U];f.push(wa),wa>65535&&(this._needs32Bits=!0)}if(this._pickable){var ya=d.length/3;for(U=0;U<ya;U++)this.pickedParticles.push({idx:K,faceId:U})}return this._depthSort&&this.depthSortedParticles.push(new Qh()),ga},e.prototype._posToShape=function(a){for(var b=[],c=0;c<a.length;c+=3)b.push(j.x.FromArray(a,c));return b},e.prototype._uvsToShapeUV=function(a){var b=[];if(a)for(var c=0;c<a.length;c++)b.push(a[c]);return b},e.prototype._addParticle=function(a,b,c,d,f,h,i){void 0===i&&(i=null);var k=new Af(a,b,c,d,f,h,this,i);return this.particles.push(k),k},e.prototype.addShape=function(a,b,c){var d,f=a.getVerticesData(na.b.PositionKind),h=a.getIndices(),i=a.getVerticesData(na.b.UVKind),k=a.getVerticesData(na.b.ColorKind),m=a.getVerticesData(na.b.NormalKind);this._particlesIntersect&&(d=a.getBoundingInfo());for(var B,E,K=this._posToShape(f),P=this._uvsToShapeUV(i),S=c?c.positionFunction:null,U=c?c.vertexFunction:null,_=new Bf(this._shapeCounter,K,h.length,P,S,U),da=this.nbParticles,fa=0;fa<b;fa++){var ga=this._positions.length,ha=this._indices.length;E=this._meshBuilder(this._index,K,this._positions,h,this._indices,i,this._uvs,k,this._colors,m,this._normals,da,fa,c),this._updatable&&((B=this._addParticle(da,ga,ha,_,this._shapeCounter,fa,d)).position.copyFrom(E.position),B.rotation.copyFrom(E.rotation),E.rotationQuaternion&&B.rotationQuaternion&&B.rotationQuaternion.copyFrom(E.rotationQuaternion),E.color&&B.color&&B.color.copyFrom(E.color),B.scaling.copyFrom(E.scaling),B.uvs.copyFrom(E.uvs)),this._index+=K.length,da++}return this.nbParticles+=b,this._shapeCounter++,this._shapeCounter-1},e.prototype._rebuildParticle=function(a){this._resetCopy();var b=this._copy;a._model._positionFunction&&a._model._positionFunction(b,a.idx,a.idxInShape);var c=j.t.Matrix[0],d=j.t.Vector3[0],f=j.t.Vector3[1],h=j.t.Vector3[2],i=j.t.Vector3[3];b.getRotationMatrix(c),a.pivot.multiplyToRef(a.scaling,i),b.translateFromPivot?h.copyFromFloats(0,0,0):h.copyFrom(i);for(var k=a._model._shape,m=0;m<k.length;m++)d.copyFrom(k[m]),a._model._vertexFunction&&a._model._vertexFunction(b,d,m),d.multiplyInPlace(b.scaling).subtractInPlace(i),j.x.TransformCoordinatesToRef(d,c,f),f.addInPlace(h).addInPlace(b.position).toArray(this._positions32,a._pos+3*m);a.position.setAll(0),a.rotation.setAll(0),a.rotationQuaternion=null,a.scaling.setAll(1),a.uvs.setAll(0),a.pivot.setAll(0),a.translateFromPivot=!1,a.parentId=null},e.prototype.rebuildMesh=function(){for(var a=0;a<this.particles.length;a++)this._rebuildParticle(this.particles[a]);return this.mesh.updateVerticesData(na.b.PositionKind,this._positions32,!1,!1),this},e.prototype.setParticles=function(a,b,c){if(void 0===a&&(a=0),void 0===b&&(b=this.nbParticles-1),void 0===c&&(c=!0),!this._updatable)return this;this.beforeUpdateParticles(a,b,c);var d=j.t.Matrix[0],f=j.t.Matrix[1],h=this.mesh,i=this._colors32,k=this._positions32,m=this._normals32,B=this._uvs32,E=this._indices32,K=this._indices,P=this._fixedNormal32,S=j.t.Vector3,U=S[5].copyFromFloats(1,0,0),_=S[6].copyFromFloats(0,1,0),da=S[7].copyFromFloats(0,0,1),fa=S[8].setAll(Number.MAX_VALUE),ga=S[9].setAll(-Number.MAX_VALUE),ha=S[10].setAll(0);if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(f)),this.billboard){var ka=S[0];this._camera.getDirectionToRef(j.c.Z,ka),j.x.TransformNormalToRef(ka,f,da),da.normalize();var la=this._camera.getViewMatrix(!0);j.x.TransformNormalFromFloatsToRef(la.m[1],la.m[5],la.m[9],f,_),j.x.CrossToRef(_,da,U),_.normalize(),U.normalize()}this._depthSort&&j.x.TransformCoordinatesToRef(this._camera.globalPosition,f,ha),j.j.IdentityToRef(d);var ma=0,ta=0,pa=0,ua=0,wa=0,ya=0,Da=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),b=b>=this.nbParticles?this.nbParticles-1:b,this._computeBoundingBox&&(0!=a||b!=this.nbParticles-1)){var Ja=this.mesh._boundingInfo;Ja&&(fa.copyFrom(Ja.minimum),ga.copyFrom(Ja.maximum))}var Na=(ta=this.particles[a]._pos)/3|0;ua=4*Na,ya=2*Na;for(var Ma=a;Ma<=b;Ma++){var Ha=this.particles[Ma];this.updateParticle(Ha);var Qa=Ha._model._shape,cb=Ha._model._shapeUV,La=Ha._rotationMatrix,Oa=Ha.position,Ya=Ha.rotation,Ua=Ha.scaling,_a=Ha._globalPosition;if(this._depthSort&&this._depthSortParticles){var db=this.depthSortedParticles[Ma];db.ind=Ha._ind,db.indicesLength=Ha._model._indicesLength,db.sqDistance=j.x.DistanceSquared(Ha.position,ha)}if(!Ha.alive||Ha._stillInvisible&&!Ha.isVisible)ta+=3*(Da=Qa.length),ua+=4*Da,ya+=2*Da;else{if(Ha.isVisible){Ha._stillInvisible=!1;var ub=S[12];if(Ha.pivot.multiplyToRef(Ua,ub),this.billboard&&(Ya.x=0,Ya.y=0),(this._computeParticleRotation||this.billboard)&&Ha.getRotationMatrix(d),null!==Ha.parentId){var eb=this.particles[Ha.parentId],Va=eb._rotationMatrix,zb=eb._globalPosition,mb=Oa.x*Va[1]+Oa.y*Va[4]+Oa.z*Va[7],ib=Oa.x*Va[0]+Oa.y*Va[3]+Oa.z*Va[6],xb=Oa.x*Va[2]+Oa.y*Va[5]+Oa.z*Va[8];if(_a.x=zb.x+ib,_a.y=zb.y+mb,_a.z=zb.z+xb,this._computeParticleRotation||this.billboard){var $a=d.m;La[0]=$a[0]*Va[0]+$a[1]*Va[3]+$a[2]*Va[6],La[1]=$a[0]*Va[1]+$a[1]*Va[4]+$a[2]*Va[7],La[2]=$a[0]*Va[2]+$a[1]*Va[5]+$a[2]*Va[8],La[3]=$a[4]*Va[0]+$a[5]*Va[3]+$a[6]*Va[6],La[4]=$a[4]*Va[1]+$a[5]*Va[4]+$a[6]*Va[7],La[5]=$a[4]*Va[2]+$a[5]*Va[5]+$a[6]*Va[8],La[6]=$a[8]*Va[0]+$a[9]*Va[3]+$a[10]*Va[6],La[7]=$a[8]*Va[1]+$a[9]*Va[4]+$a[10]*Va[7],La[8]=$a[8]*Va[2]+$a[9]*Va[5]+$a[10]*Va[8]}}else(_a.x=Oa.x,_a.y=Oa.y,_a.z=Oa.z,this._computeParticleRotation||this.billboard)&&($a=d.m,La[0]=$a[0],La[1]=$a[1],La[2]=$a[2],La[3]=$a[4],La[4]=$a[5],La[5]=$a[6],La[6]=$a[8],La[7]=$a[9],La[8]=$a[10]);var Bb=S[11];for(Ha.translateFromPivot?Bb.setAll(0):Bb.copyFrom(ub),Da=0;Da<Qa.length;Da++){ma=ta+3*Da,pa=ua+4*Da,wa=ya+2*Da,(ka=S[0]).copyFrom(Qa[Da]),this._computeParticleVertex&&this.updateParticleVertex(Ha,ka,Da);var Rb=ka.x*Ua.x-ub.x,Fb=ka.y*Ua.y-ub.y,Yb=ka.z*Ua.z-ub.z;ib=Rb*La[0]+Fb*La[3]+Yb*La[6],mb=Rb*La[1]+Fb*La[4]+Yb*La[7],xb=Rb*La[2]+Fb*La[5]+Yb*La[8],ib+=Bb.x,mb+=Bb.y,xb+=Bb.z;var Sb=k[ma]=_a.x+U.x*ib+_.x*mb+da.x*xb,Gb=k[ma+1]=_a.y+U.y*ib+_.y*mb+da.y*xb,sd=k[ma+2]=_a.z+U.z*ib+_.z*mb+da.z*xb;if(this._computeBoundingBox&&(fa.minimizeInPlaceFromFloats(Sb,Gb,sd),ga.maximizeInPlaceFromFloats(Sb,Gb,sd)),!this._computeParticleVertex){var Qf=P[ma],Rf=P[ma+1],Sf=P[ma+2],Tf=Qf*La[0]+Rf*La[3]+Sf*La[6],Uf=Qf*La[1]+Rf*La[4]+Sf*La[7],Vf=Qf*La[2]+Rf*La[5]+Sf*La[8];m[ma]=U.x*Tf+_.x*Uf+da.x*Vf,m[ma+1]=U.y*Tf+_.y*Uf+da.y*Vf,m[ma+2]=U.z*Tf+_.z*Uf+da.z*Vf}if(this._computeParticleColor&&Ha.color){var nc=Ha.color,fe=this._colors32;fe[pa]=nc.r,fe[pa+1]=nc.g,fe[pa+2]=nc.b,fe[pa+3]=nc.a}if(this._computeParticleTexture){var Vb=Ha.uvs;B[wa]=cb[2*Da]*(Vb.z-Vb.x)+Vb.x,B[wa+1]=cb[2*Da+1]*(Vb.w-Vb.y)+Vb.y}}}else for(Ha._stillInvisible=!0,Da=0;Da<Qa.length;Da++)(pa=ua+4*Da,wa=ya+2*Da,k[ma=ta+3*Da]=k[ma+1]=k[ma+2]=0,m[ma]=m[ma+1]=m[ma+2]=0,this._computeParticleColor&&Ha.color)&&(nc=Ha.color,i[pa]=nc.r,i[pa+1]=nc.g,i[pa+2]=nc.b,i[pa+3]=nc.a),this._computeParticleTexture&&(Vb=Ha.uvs,B[wa]=cb[2*Da]*(Vb.z-Vb.x)+Vb.x,B[wa+1]=cb[2*Da+1]*(Vb.w-Vb.y)+Vb.y);if(this._particlesIntersect){var vi=Ha._boundingInfo,Rl=vi.boundingBox,Sl=vi.boundingSphere,Wf=Ha._modelBoundingInfo;if(!this._bSphereOnly){var Xf=Wf.boundingBox.vectors,Yf=S[1],Zf=S[2];Yf.setAll(Number.MAX_VALUE),Zf.setAll(-Number.MAX_VALUE);for(var td=0;td<8;td++){var _f=Xf[td].x*Ua.x,$f=Xf[td].y*Ua.y,ag=Xf[td].z*Ua.z,wi=(ib=_f*La[0]+$f*La[3]+ag*La[6],mb=_f*La[1]+$f*La[4]+ag*La[7],xb=_f*La[2]+$f*La[5]+ag*La[8],Oa.x+U.x*ib+_.x*mb+da.x*xb),xi=Oa.y+U.y*ib+_.y*mb+da.y*xb,yi=Oa.z+U.z*ib+_.z*mb+da.z*xb;Yf.minimizeInPlaceFromFloats(wi,xi,yi),Zf.maximizeInPlaceFromFloats(wi,xi,yi)}Rl.reConstruct(Yf,Zf,h._worldMatrix)}var zi=Wf.minimum.multiplyToRef(Ua,S[1]),Ai=Wf.maximum.multiplyToRef(Ua,S[2]),Bi=Ai.addToRef(zi,S[3]).scaleInPlace(.5).addInPlace(_a),Ci=Ai.subtractToRef(zi,S[4]).scaleInPlace(.5*this._bSphereRadiusFactor),Tl=Bi.subtractToRef(Ci,S[1]),Ul=Bi.addToRef(Ci,S[2]);Sl.reConstruct(Tl,Ul,h._worldMatrix)}ta=ma+3,ua=pa+4,ya=wa+2}}if(c){if(this._computeParticleColor&&h.updateVerticesData(na.b.ColorKind,i,!1,!1),this._computeParticleTexture&&h.updateVerticesData(na.b.UVKind,B,!1,!1),h.updateVerticesData(na.b.PositionKind,k,!1,!1),!h.areNormalsFrozen||h.isFacetDataEnabled){if(this._computeParticleVertex||h.isFacetDataEnabled){var Vl=h.isFacetDataEnabled?h.getFacetDataParameters():null;Wa.a.ComputeNormals(k,E,m,Vl);for(var xc=0;xc<m.length;xc++)P[xc]=m[xc]}h.areNormalsFrozen||h.updateVerticesData(na.b.NormalKind,m,!1,!1)}if(this._depthSort&&this._depthSortParticles){var ge=this.depthSortedParticles;ge.sort(Bk);for(var Wl=ge.length,Di=0,he=0;he<Wl;he++){var Xl=ge[he].indicesLength,Yl=ge[he].ind;for(xc=0;xc<Xl;xc++)E[Di]=K[Yl+xc],Di++}h.updateIndices(E)}}return this._computeBoundingBox&&(h._boundingInfo?h._boundingInfo.reConstruct(fa,ga,h._worldMatrix):h._boundingInfo=new Kc.a(fa,ga,h._worldMatrix)),this.afterUpdateParticles(a,b,c),this},e.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},e.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},e.prototype.setVisibilityBox=function(a){var b=a/2;this.mesh._boundingInfo=new Kc.a(new j.x(-b,-b,-b),new j.x(b,b,b))},Object.defineProperty(e.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(a){this._alwaysVisible=a,this.mesh.alwaysSelectAsActiveMesh=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(a){this._isVisibilityBoxLocked=a,this.mesh.getBoundingInfo().isLocked=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(a){this._computeParticleRotation=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(a){this._computeParticleColor=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(a){this._computeParticleTexture=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(a){this._computeParticleVertex=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(a){this._computeBoundingBox=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(a){this._depthSortParticles=a},enumerable:!0,configurable:!0}),e.prototype.initParticles=function(){},e.prototype.recycleParticle=function(a){return a},e.prototype.updateParticle=function(a){return a},e.prototype.updateParticleVertex=function(a,b,c){return b},e.prototype.beforeUpdateParticles=function(a,b,c){},e.prototype.afterUpdateParticles=function(a,b,c){},e}();ja.a.prototype.getPhysicsEngine=function(){return this._physicsEngine},ja.a.prototype.enablePhysics=function(e,a){if(void 0===e&&(e=null),this._physicsEngine)return!0;var b=this._getComponent(Pa.a.NAME_PHYSICSENGINE);b||(b=new Rh(this),this._addComponent(b));try{return this._physicsEngine=new Pc(e,a),!0}catch(c){return r.a.Error(c.message),!1}},ja.a.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},ja.a.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},ja.a.prototype.deleteCompoundImpostor=function(e){var a=e.parts[0].mesh;a.physicsImpostor&&(a.physicsImpostor.dispose(),a.physicsImpostor=null)},ja.a.prototype._advancePhysicsEngineStep=function(e){this._physicsEngine&&(this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1000),this.onAfterPhysicsObservable.notifyObservers(this))},Object.defineProperty(kb.a.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(e){var a=this;this._physicsImpostor!==e&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=e,e&&(this._disposePhysicsObserver=this.onDisposeObservable.add(function(){a.physicsImpostor&&(a.physicsImpostor.dispose(),a.physicsImpostor=null)})))},enumerable:!0,configurable:!0}),kb.a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},kb.a.prototype.applyImpulse=function(e,a){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(e,a),this):this},kb.a.prototype.setPhysicsLinkWith=function(e,a,b,c){return this.physicsImpostor&&e.physicsImpostor?(this.physicsImpostor.createJoint(e.physicsImpostor,vb.e.HingeJoint,{mainPivot:a,connectedPivot:b,nativeParams:c}),this):this};var rd,Uc,Rh=function(){function e(a){var b=this;this.name=Pa.a.NAME_PHYSICSENGINE,this.scene=a,this.scene.onBeforePhysicsObservable=new q.c(),this.scene.onAfterPhysicsObservable=new q.c(),this.scene.getDeterministicFrameTime=function(){return b.scene._physicsEngine?1000*b.scene._physicsEngine.getTimeStep():1000/60}}return e.prototype.register=function(){},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},e}(),Dk=function(){function e(a){this._scene=a,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||r.a.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return e.prototype.applyRadialExplosionImpulse=function(a,b,c,d){if(!this._physicsEngine)return r.a.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var f=this._physicsEngine.getImpostors();if(0===f.length)return null;"number"==typeof b&&((b=new Vc()).radius=b,b.strength=c||b.strength,b.falloff=d||b.falloff);var h=new Sh(this._scene,b),i=Array();return f.forEach(function(k){var m=h.getImpostorHitData(k,a);m&&(k.applyImpulse(m.force,m.contactPoint),i.push({impostor:k,hitData:m}))}),h.triggerAffectedImpostorsCallback(i),h.dispose(!1),h},e.prototype.applyRadialExplosionForce=function(a,b,c,d){if(!this._physicsEngine)return r.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var f=this._physicsEngine.getImpostors();if(0===f.length)return null;"number"==typeof b&&((b=new Vc()).radius=b,b.strength=c||b.strength,b.falloff=d||b.falloff);var h=new Sh(this._scene,b),i=Array();return f.forEach(function(k){var m=h.getImpostorHitData(k,a);m&&(k.applyForce(m.force,m.contactPoint),i.push({impostor:k,hitData:m}))}),h.triggerAffectedImpostorsCallback(i),h.dispose(!1),h},e.prototype.gravitationalField=function(a,b,c,d){if(!this._physicsEngine)return r.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof b&&((b=new Vc()).radius=b,b.strength=c||b.strength,b.falloff=d||b.falloff);var f=new Ek(this,this._scene,a,b);return f.dispose(!1),f},e.prototype.updraft=function(a,b,c,d,f){if(!this._physicsEngine)return r.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof b&&((b=new Cf()).radius=b,b.strength=c||b.strength,b.height=d||b.height,b.updraftMode=f||b.updraftMode);var h=new Fk(this._scene,a,b);return h.dispose(!1),h},e.prototype.vortex=function(a,b,c,d){if(!this._physicsEngine)return r.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof b&&((b=new Df()).radius=b,b.strength=c||b.strength,b.height=d||b.height);var f=new Gk(this._scene,a,b);return f.dispose(!1),f},e}(),Sh=function(){function e(a,b){this._scene=a,this._options=b,this._dataFetched=!1,this._options=v.a({},new Vc(),this._options)}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.getImpostorHitData=function(a,b){if(0===a.mass)return null;if(!this._intersectsWithSphere(a,b,this._options.radius))return null;if("Mesh"!==a.object.getClassName()&&"InstancedMesh"!==a.object.getClassName())return null;var c=a.getObjectCenter().subtract(b),d=new Nb.a(b,c,this._options.radius).intersectsMesh(a.object).pickedPoint;if(!d)return null;var f=j.x.Distance(b,d);if(f>this._options.radius)return null;var h=this._options.falloff===rd.Constant?this._options.strength:this._options.strength*(1-f/this._options.radius);return{force:c.multiplyByFloats(h,h,h),contactPoint:d,distanceFromOrigin:f}},e.prototype.triggerAffectedImpostorsCallback=function(a){this._options.affectedImpostorsCallback&&this._options.affectedImpostorsCallback(a)},e.prototype.dispose=function(a){var b=this;void 0===a&&(a=!0),a?this._sphere.dispose():setTimeout(function(){b._dataFetched||b._sphere.dispose()},0)},e.prototype._prepareSphere=function(){this._sphere||(this._sphere=lc.a.CreateSphere("radialExplosionEventSphere",this._options.sphere,this._scene),this._sphere.isVisible=!1)},e.prototype._intersectsWithSphere=function(a,b,c){var d=a.object;return this._prepareSphere(),this._sphere.position=b,this._sphere.scaling=new j.x(2*c,2*c,2*c),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(d,!0)},e}(),Ek=function(){function e(a,b,c,d){this._physicsHelper=a,this._scene=b,this._origin=c,this._options=d,this._dataFetched=!1,this._options=v.a({},new Vc(),this._options),this._tickCallback=this._tick.bind(this),this._options.strength=-1*this._options.strength}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(a){var b=this;void 0===a&&(a=!0),a?this._sphere.dispose():setTimeout(function(){b._dataFetched||b._sphere.dispose()},0)},e.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);else{var a=this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);a&&(this._sphere=a.getData().sphere.clone("radialExplosionEventSphereClone"))}},e}(),Fk=function(){function e(a,b,c){this._scene=a,this._origin=b,this._options=c,this._originTop=j.x.Zero(),this._originDirection=j.x.Zero(),this._cylinderPosition=j.x.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=v.a({},new Cf(),this._options),this._origin.addToRef(new j.x(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new j.x(0,this._options.height,0),this._originTop),this._options.updraftMode===Uc.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(a){var b=this;void 0===a&&(a=!0),this._cylinder&&(a?this._cylinder.dispose():setTimeout(function(){b._dataFetched||b._cylinder.dispose()},0))},e.prototype.getImpostorHitData=function(a){if(0===a.mass)return null;if(!this._intersectsWithCylinder(a))return null;var b=a.getObjectCenter();if(this._options.updraftMode===Uc.Perpendicular)var c=this._originDirection;else c=b.subtract(this._originTop);var d=j.x.Distance(this._origin,b),f=-1*this._options.strength;return{force:c.multiplyByFloats(f,f,f),contactPoint:b,distanceFromOrigin:d}},e.prototype._tick=function(){var a=this;this._physicsEngine.getImpostors().forEach(function(b){var c=a.getImpostorHitData(b);c&&b.applyForce(c.force,c.contactPoint)})},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=ad.a.CreateCylinder("updraftEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(a){var b=a.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(b,!0)},e}(),Gk=function(){function e(a,b,c){this._scene=a,this._origin=b,this._options=c,this._originTop=j.x.Zero(),this._cylinderPosition=j.x.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=v.a({},new Df(),this._options),this._origin.addToRef(new j.x(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new j.x(0,this._options.height,0),this._originTop),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(a){var b=this;void 0===a&&(a=!0),a?this._cylinder.dispose():setTimeout(function(){b._dataFetched||b._cylinder.dispose()},0)},e.prototype.getImpostorHitData=function(a){if(0===a.mass)return null;if(!this._intersectsWithCylinder(a))return null;if("Mesh"!==a.object.getClassName()&&"InstancedMesh"!==a.object.getClassName())return null;var b=a.getObjectCenter(),c=new j.x(this._origin.x,b.y,this._origin.z),d=b.subtract(c),f=new Nb.a(c,d,this._options.radius).intersectsMesh(a.object),h=f.pickedPoint;if(!h)return null;var i=f.distance/this._options.radius,k=h.normalize();if(i>this._options.centripetalForceThreshold&&(k=k.negate()),i>this._options.centripetalForceThreshold)var m=k.x*this._options.centripetalForceMultiplier,B=k.y*this._options.updraftForceMultiplier,E=k.z*this._options.centripetalForceMultiplier;else{var K=j.x.Cross(c,b).normalize();m=(K.x+k.x)*this._options.centrifugalForceMultiplier,B=this._originTop.y*this._options.updraftForceMultiplier,E=(K.z+k.z)*this._options.centrifugalForceMultiplier}var P=new j.x(m,B,E);return{force:P=P.multiplyByFloats(this._options.strength,this._options.strength,this._options.strength),contactPoint:b,distanceFromOrigin:i}},e.prototype._tick=function(){var a=this;this._physicsEngine.getImpostors().forEach(function(b){var c=a.getImpostorHitData(b);c&&b.applyForce(c.force,c.contactPoint)})},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=ad.a.CreateCylinder("vortexEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(a){var b=a.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(b,!0)},e}(),Vc=function(){return function(){this.radius=5,this.strength=10,this.falloff=rd.Constant,this.sphere={segments:32,diameter:1}}}(),Cf=function(){return function(){this.radius=5,this.strength=10,this.height=10,this.updraftMode=Uc.Center}}(),Df=function(){return function(){this.radius=5,this.strength=10,this.height=10,this.centripetalForceThreshold=.7,this.centripetalForceMultiplier=5,this.centrifugalForceMultiplier=.5,this.updraftForceMultiplier=.02}}();!function(e){e[e.Constant=0]="Constant",e[e.Linear=1]="Linear"}(rd||(rd={})),function(e){e[e.Center=0]="Center",e[e.Perpendicular=1]="Perpendicular"}(Uc||(Uc={}));var Hk=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float degree;
void main(void)
{
vec3 color=texture2D(textureSampler,vUV).rgb;
float luminance=dot(color,vec3(0.3,0.59,0.11));
vec3 blackAndWhite=vec3(luminance,luminance,luminance);
gl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);
}`;Ia.a.ShadersStore.blackAndWhitePixelShader=Hk;var Ik=function(e){function a(b,c,d,f,h,i){var k=e.call(this,b,"blackAndWhite",["degree"],null,c,d,f,h,i)||this;return k.degree=1,k.onApplyObservable.add(function(m){m.setFloat("degree",k.degree)}),k}return v.d(a,e),a}(Za),lb=function(){function e(a,b,c,d){this._name=b,this._singleInstance=d||!0,this._getPostProcesses=c,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var a in this._postProcesses)if(this._postProcesses.hasOwnProperty(a)){for(var b=this._postProcesses[a],c=0;c<b.length;c++)if(!b[c].isSupported)return!1}return!0},enumerable:!0,configurable:!0}),e.prototype._update=function(){},e.prototype._attachCameras=function(a){var b,c=this,d=xa.h.MakeArray(a||this._cameras);if(d)for(var f=0;f<d.length;f++){var h=d[f],i=h.name;if(b=this._singleInstance?0:i,!this._postProcesses[b]){var k=this._getPostProcesses();k&&(this._postProcesses[b]=Array.isArray(k)?k:[k])}this._indicesForCamera[i]||(this._indicesForCamera[i]=[]),this._postProcesses[b].forEach(function(m){var B=h.attachPostProcess(m);c._indicesForCamera[i].push(B)}),this._cameras[i]||(this._cameras[i]=h)}},e.prototype._detachCameras=function(a){var b=xa.h.MakeArray(a||this._cameras);if(b)for(var c=0;c<b.length;c++){var d=b[c],f=d.name,h=this._postProcesses[this._singleInstance?0:f];h&&h.forEach(function(i){d.detachPostProcess(i)}),this._cameras[f]&&(this._cameras[f]=null)}},e.prototype._enable=function(a){var b=this,c=xa.h.MakeArray(a||this._cameras);if(c)for(var d=0;d<c.length;d++)for(var f=c[d],h=f.name,i=0;i<this._indicesForCamera[h].length;i++)void 0!==f._postProcesses[this._indicesForCamera[h][i]]&&null!==f._postProcesses[this._indicesForCamera[h][i]]||this._postProcesses[this._singleInstance?0:h].forEach(function(k){c[d].attachPostProcess(k,b._indicesForCamera[h][i])})},e.prototype._disable=function(a){var b=xa.h.MakeArray(a||this._cameras);if(b)for(var c=0;c<b.length;c++){var d=b[c],f=d.name;this._postProcesses[this._singleInstance?0:f].forEach(function(h){d.detachPostProcess(h)})}},e.prototype.getPostProcesses=function(a){return this._singleInstance?this._postProcesses[0]:a?this._postProcesses[a.name]:null},e}(),Jk=`#include<helperFunctions>

varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float threshold;
uniform float exposure;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
float luma=getLuminance(gl_FragColor.rgb*exposure);
gl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;
}`;Ia.a.ShadersStore.extractHighlightsPixelShader=Jk;var Th=function(e){function a(b,c,d,f,h,i,k,m){void 0===k&&(k=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1);var B=e.call(this,b,"extractHighlights",["threshold","exposure"],null,c,d,f,h,i,null,k,void 0,null,m)||this;return B.threshold=.9,B._exposure=1,B._inputPostProcess=null,B.onApplyObservable.add(function(E){B._inputPostProcess&&E.setTextureFromPostProcess("textureSampler",B._inputPostProcess),E.setFloat("threshold",Math.pow(B.threshold,j.u)),E.setFloat("exposure",B._exposure)}),B}return v.d(a,e),a}(Za),Kk=`uniform sampler2D textureSampler;
uniform sampler2D bloomBlur;
varying vec2 vUV;
uniform float bloomWeight;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec3 blurred=texture2D(bloomBlur,vUV).rgb;
gl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight);
}
`;Ia.a.ShadersStore.bloomMergePixelShader=Kk;var Uh=function(e){function a(b,c,d,f,h,i,k,m,B,E,K){void 0===E&&(E=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===K&&(K=!1);var P=e.call(this,b,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],h,i,k,m,B,null,E,void 0,null,!0)||this;return P.weight=f,P.onApplyObservable.add(function(S){S.setTextureFromPostProcess("textureSampler",c),S.setTextureFromPostProcessOutput("bloomBlur",d),S.setFloat("bloomWeight",P.weight)}),K||P.updateEffect(),P}return v.d(a,e),a}(Za),Ef=function(e){function a(b,c,d,f,h,i){void 0===h&&(h=0),void 0===i&&(i=!1);var k=e.call(this,b.getEngine(),"bloom",function(){return k._effects},!0)||this;return k.bloomScale=c,k._effects=[],k._downscale=new Th("highlights",1,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,h,i),k._blurX=new Ib("horizontal blur",new j.w(1,0),10,c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,h,void 0,i),k._blurX.alwaysForcePOT=!0,k._blurX.autoClear=!1,k._blurY=new Ib("vertical blur",new j.w(0,1),10,c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,h,void 0,i),k._blurY.alwaysForcePOT=!0,k._blurY.autoClear=!1,k.kernel=f,k._effects=[k._downscale,k._blurX,k._blurY],k._merge=new Uh("bloomMerge",k._downscale,k._blurY,d,c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,h,i),k._merge.autoClear=!1,k._effects.push(k._merge),k}return v.d(a,e),Object.defineProperty(a.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(b){this._downscale.threshold=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"weight",{get:function(){return this._merge.weight},set:function(b){this._merge.weight=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(b){this._blurX.kernel=b*this.bloomScale,this._blurY.kernel=b*this.bloomScale},enumerable:!0,configurable:!0}),a.prototype.disposeEffects=function(b){for(var c=0;c<this._effects.length;c++)this._effects[c].dispose(b)},a.prototype._updateEffects=function(){for(var b=0;b<this._effects.length;b++)this._effects[b].updateEffect()},a.prototype._isReady=function(){for(var b=0;b<this._effects.length;b++)if(!this._effects[b].isReady())return!1;return!0},a}(lb),Lk=`
uniform sampler2D textureSampler;

uniform float chromatic_aberration;
uniform float radialIntensity;
uniform vec2 direction;
uniform vec2 centerPosition;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;
void main(void)
{
vec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);
vec2 directionOfEffect=direction;
if(directionOfEffect.x == 0. && directionOfEffect.y == 0.){
directionOfEffect=normalize(centered_screen_pos);
}
float radius2=centered_screen_pos.x*centered_screen_pos.x
+centered_screen_pos.y*centered_screen_pos.y;
float radius=sqrt(radius2);
vec4 original=texture2D(textureSampler,vUV);

vec3 ref_indices=vec3(-0.3,0.0,0.3);
float ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;
float ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;

vec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);
vec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);
vec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);
original.r=texture2D(textureSampler,ref_coords_r).r;
original.g=texture2D(textureSampler,ref_coords_g).g;
original.b=texture2D(textureSampler,ref_coords_b).b;
original.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);
gl_FragColor=original;
}`;Ia.a.ShadersStore.chromaticAberrationPixelShader=Lk;var Vh=function(e){function a(b,c,d,f,h,i,k,m,B,E){void 0===B&&(B=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===E&&(E=!1);var K=e.call(this,b,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],f,h,i,k,m,null,B,void 0,null,E)||this;return K.aberrationAmount=30,K.radialIntensity=0,K.direction=new j.w(.707,.707),K.centerPosition=new j.w(.5,.5),K.onApplyObservable.add(function(P){P.setFloat("chromatic_aberration",K.aberrationAmount),P.setFloat("screen_width",c),P.setFloat("screen_height",d),P.setFloat("radialIntensity",K.radialIntensity),P.setFloat2("direction",K.direction.x,K.direction.y),P.setFloat2("centerPosition",K.centerPosition.x,K.centerPosition.y)}),K}return v.d(a,e),a}(Za),Mk=`
uniform sampler2D depthSampler;

varying vec2 vUV;

uniform vec2 cameraMinMaxZ;

uniform float focusDistance;
uniform float cocPrecalculation;
void main(void)
{
float depth=texture2D(depthSampler,vUV).r;
float pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0;
float coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));
coc=clamp(coc,0.0,1.0);
gl_FragColor=vec4(coc,depth,coc,1.0);
}
`;Ia.a.ShadersStore.circleOfConfusionPixelShader=Mk;var Wh=function(e){function a(b,c,d,f,h,i,k,m,B){void 0===m&&(m=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===B&&(B=!1);var E=e.call(this,b,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],d,f,h,i,k,null,m,void 0,null,B)||this;return E.lensSize=50,E.fStop=1.4,E.focusDistance=2000,E.focalLength=50,E._depthTexture=null,E._depthTexture=c,E.onApplyObservable.add(function(K){if(E._depthTexture){K.setTexture("depthSampler",E._depthTexture);var P=E.lensSize/E.fStop*E.focalLength/(E.focusDistance-E.focalLength);K.setFloat("focusDistance",E.focusDistance),K.setFloat("cocPrecalculation",P),K.setFloat2("cameraMinMaxZ",E._depthTexture.activeCamera.minZ,E._depthTexture.activeCamera.maxZ)}else r.a.Warn("No depth texture set on CircleOfConfusionPostProcess")}),E}return v.d(a,e),Object.defineProperty(a.prototype,"depthTexture",{set:function(b){this._depthTexture=b},enumerable:!0,configurable:!0}),a}(Za),Nk=`
uniform sampler2D textureSampler;
uniform sampler2D colorTable;

varying vec2 vUV;

const float SLICE_COUNT=16.0;

vec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {
float sliceSize=1.0/width;
float slicePixelSize=sliceSize/width;
float sliceInnerSize=slicePixelSize*(width-1.0);
float zSlice0=min(floor(uv.z*width),width-1.0);
float zSlice1=min(zSlice0+1.0,width-1.0);
float xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;
float s0=xOffset+(zSlice0*sliceSize);
float s1=xOffset+(zSlice1*sliceSize);
vec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));
vec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));
float zOffset=mod(uv.z*width,1.0);
vec4 result=mix(slice0Color,slice1Color,zOffset);
return result;
}
void main(void)
{
vec4 screen_color=texture2D(textureSampler,vUV);
gl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);
}`;Ia.a.ShadersStore.colorCorrectionPixelShader=Nk;var Ok=function(e){function a(b,c,d,f,h,i,k){var m=e.call(this,b,"colorCorrection",null,["colorTable"],d,f,h,i,k)||this;return m._colorTableTexture=new ra.a(c,f.getScene(),!0,!1,ra.a.TRILINEAR_SAMPLINGMODE),m._colorTableTexture.anisotropicFilteringLevel=1,m._colorTableTexture.wrapU=ra.a.CLAMP_ADDRESSMODE,m._colorTableTexture.wrapV=ra.a.CLAMP_ADDRESSMODE,m.onApply=function(B){B.setTexture("colorTable",m._colorTableTexture)},m}return v.d(a,e),a}(Za),Pk=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform float kernel[9];
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 colorSum =
texture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +
texture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +
texture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +
texture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +
texture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +
texture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +
texture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];
float kernelWeight =
kernel[0] +
kernel[1] +
kernel[2] +
kernel[3] +
kernel[4] +
kernel[5] +
kernel[6] +
kernel[7] +
kernel[8];
if (kernelWeight<=0.0) {
kernelWeight=1.0;
}
gl_FragColor=vec4((colorSum/kernelWeight).rgb,1);
}`;Ia.a.ShadersStore.convolutionPixelShader=Pk;var Qk=function(e){function a(b,c,d,f,h,i,k,m){void 0===m&&(m=o.a.TEXTURETYPE_UNSIGNED_INT);var B=e.call(this,b,"convolution",["kernel","screenSize"],null,d,f,h,i,k,null,m)||this;return B.kernel=c,B.onApply=function(E){E.setFloat2("screenSize",B.width,B.height),E.setArray("kernel",B.kernel)},B}return v.d(a,e),a.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],a.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],a.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],a.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],a.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],a.GaussianKernel=[0,1,0,1,1,1,0,1,0],a}(Za),Ff=function(e){function a(b,c,d,f,h,i,k,m,B,E,K,P,S){void 0===m&&(m=null),void 0===B&&(B=ra.a.BILINEAR_SAMPLINGMODE),void 0===P&&(P=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===S&&(S=!1);var U=e.call(this,b,d,f,h,i,B=o.a.TEXTURE_BILINEAR_SAMPLINGMODE,E,K,P=o.a.TEXTURETYPE_UNSIGNED_INT,`#define DOF 1\r
`,S)||this;return U.direction=d,U.onApplyObservable.add(function(_){null!=m&&_.setTextureFromPostProcess("textureSampler",m),_.setTextureFromPostProcessOutput("circleOfConfusionSampler",k),c.activeCamera&&_.setFloat2("cameraMinMaxZ",c.activeCamera.minZ,c.activeCamera.maxZ)}),U}return v.d(a,e),a}(Ib),Rk=`uniform sampler2D textureSampler;
varying vec2 vUV;
uniform sampler2D circleOfConfusionSampler;
uniform sampler2D blurStep0;
#if BLUR_LEVEL>0
uniform sampler2D blurStep1;
#endif
#if BLUR_LEVEL>1
uniform sampler2D blurStep2;
#endif
void main(void)
{
float coc=texture2D(circleOfConfusionSampler,vUV).r;
#if BLUR_LEVEL == 0
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred0=texture2D(blurStep0,vUV);
gl_FragColor=mix(original,blurred0,coc);
#endif
#if BLUR_LEVEL == 1
if(coc<0.5){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(original,blurred1,coc/0.5);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);
}
#endif
#if BLUR_LEVEL == 2
if(coc<0.33){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(original,blurred2,coc/0.33);
}else if(coc<0.66){
vec4 blurred1=texture2D(blurStep1,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);
}
#endif
}
`;Ia.a.ShadersStore.depthOfFieldMergePixelShader=Rk;var Fc,Sk=function(){return function(){}}(),Xh=function(e){function a(b,c,d,f,h,i,k,m,B,E,K){void 0===E&&(E=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===K&&(K=!1);var P=e.call(this,b,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],h,i,k,m,B,null,E,void 0,null,!0)||this;return P.blurSteps=f,P.onApplyObservable.add(function(S){S.setTextureFromPostProcess("textureSampler",c),S.setTextureFromPostProcessOutput("circleOfConfusionSampler",d),f.forEach(function(U,_){S.setTextureFromPostProcessOutput("blurStep"+(f.length-_-1),U)})}),K||P.updateEffect(),P}return v.d(a,e),a.prototype.updateEffect=function(b,c,d,f,h,i){void 0===b&&(b=null),void 0===c&&(c=null),void 0===d&&(d=null),b||(b="",b+="#define BLUR_LEVEL "+(this.blurSteps.length-1)+`
`),e.prototype.updateEffect.call(this,b,c,d,f,h,i)},a}(Za);!function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(Fc||(Fc={}));var Gf=function(e){function a(b,c,d,f,h){void 0===d&&(d=Fc.Low),void 0===f&&(f=0),void 0===h&&(h=!1);var i=e.call(this,b.getEngine(),"depth of field",function(){return i._effects},!0)||this;i._effects=[],i._circleOfConfusion=new Wh("circleOfConfusion",c,1,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,f,h),i._depthOfFieldBlurY=[],i._depthOfFieldBlurX=[];var k=1,m=15;switch(d){case Fc.High:k=3,m=51;break;case Fc.Medium:k=2,m=31;break;default:m=15,k=1}for(var B=m/Math.pow(2,k-1),E=1,K=0;K<k;K++){var P=new Ff("verticle blur",b,new j.w(0,1),B,E,null,i._circleOfConfusion,0==K?i._circleOfConfusion:null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,f,h);P.autoClear=!1,E=.75/Math.pow(2,K);var S=new Ff("horizontal blur",b,new j.w(1,0),B,E,null,i._circleOfConfusion,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,f,h);S.autoClear=!1,i._depthOfFieldBlurY.push(P),i._depthOfFieldBlurX.push(S)}for(i._effects=[i._circleOfConfusion],K=0;K<i._depthOfFieldBlurX.length;K++)i._effects.push(i._depthOfFieldBlurY[K]),i._effects.push(i._depthOfFieldBlurX[K]);return i._dofMerge=new Xh("dofMerge",i._circleOfConfusion,i._circleOfConfusion,i._depthOfFieldBlurX,E,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,f,h),i._dofMerge.autoClear=!1,i._effects.push(i._dofMerge),i}return v.d(a,e),Object.defineProperty(a.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(b){this._circleOfConfusion.focalLength=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(b){this._circleOfConfusion.fStop=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(b){this._circleOfConfusion.focusDistance=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(b){this._circleOfConfusion.lensSize=b},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"DepthOfFieldEffect"},Object.defineProperty(a.prototype,"depthTexture",{set:function(b){this._circleOfConfusion.depthTexture=b},enumerable:!0,configurable:!0}),a.prototype.disposeEffects=function(b){for(var c=0;c<this._effects.length;c++)this._effects[c].dispose(b)},a.prototype._updateEffects=function(){for(var b=0;b<this._effects.length;b++)this._effects[b].updateEffect()},a.prototype._isReady=function(){for(var b=0;b<this._effects.length;b++)if(!this._effects[b].isReady())return!1;return!0},a}(lb),Tk=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D passSampler;
void main(void)
{
gl_FragColor=texture2D(passSampler,vUV);
}`;Ia.a.ShadersStore.displayPassPixelShader=Tk;var Uk=function(e){function a(b,c,d,f,h,i){return e.call(this,b,"displayPass",["passSampler"],["passSampler"],c,d,f,h,i)||this}return v.d(a,e),a}(Za),Vk=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform mat4 kernelMatrix;
void main(void)
{
vec3 baseColor=texture2D(textureSampler,vUV).rgb;
vec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;
gl_FragColor=vec4(updatedColor,1.0);
}`;Ia.a.ShadersStore.filterPixelShader=Vk;var Wk=function(e){function a(b,c,d,f,h,i,k){var m=e.call(this,b,"filter",["kernelMatrix"],null,d,f,h,i,k)||this;return m.kernelMatrix=c,m.onApply=function(B){B.setMatrix("kernelMatrix",m.kernelMatrix)},m}return v.d(a,e),a}(Za),Xk=`uniform sampler2D textureSampler;
uniform vec2 texelSize;
varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const float fxaaQualitySubpix=1.0;
const float fxaaQualityEdgeThreshold=0.166;
const float fxaaQualityEdgeThresholdMin=0.0833;
const vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);
#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)
void main(){
vec2 posM;
posM.x=vUV.x;
posM.y=vUV.y;
vec4 rgbyM=texture2D(textureSampler,vUV,0.0);
float lumaM=FxaaLuma(rgbyM);
float lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));
float lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));
float lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));
float lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));
float maxSM=max(lumaS,lumaM);
float minSM=min(lumaS,lumaM);
float maxESM=max(lumaE,maxSM);
float minESM=min(lumaE,minSM);
float maxWN=max(lumaN,lumaW);
float minWN=min(lumaN,lumaW);
float rangeMax=max(maxWN,maxESM);
float rangeMin=min(minWN,minESM);
float rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;
float range=rangeMax-rangeMin;
float rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);
#ifndef MALI
if(range<rangeMaxClamped)
{
gl_FragColor=rgbyM;
return;
}
#endif
float lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));
float lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));
float lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));
float lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));
float lumaNS=lumaN+lumaS;
float lumaWE=lumaW+lumaE;
float subpixRcpRange=1.0/range;
float subpixNSWE=lumaNS+lumaWE;
float edgeHorz1=(-2.0*lumaM)+lumaNS;
float edgeVert1=(-2.0*lumaM)+lumaWE;
float lumaNESE=lumaNE+lumaSE;
float lumaNWNE=lumaNW+lumaNE;
float edgeHorz2=(-2.0*lumaE)+lumaNESE;
float edgeVert2=(-2.0*lumaN)+lumaNWNE;
float lumaNWSW=lumaNW+lumaSW;
float lumaSWSE=lumaSW+lumaSE;
float edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);
float edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);
float edgeHorz3=(-2.0*lumaW)+lumaNWSW;
float edgeVert3=(-2.0*lumaS)+lumaSWSE;
float edgeHorz=abs(edgeHorz3)+edgeHorz4;
float edgeVert=abs(edgeVert3)+edgeVert4;
float subpixNWSWNESE=lumaNWSW+lumaNESE;
float lengthSign=texelSize.x;
bool horzSpan=edgeHorz>=edgeVert;
float subpixA=subpixNSWE*2.0+subpixNWSWNESE;
if (!horzSpan)
{
lumaN=lumaW;
}
if (!horzSpan)
{
lumaS=lumaE;
}
if (horzSpan)
{
lengthSign=texelSize.y;
}
float subpixB=(subpixA*(1.0/12.0))-lumaM;
float gradientN=lumaN-lumaM;
float gradientS=lumaS-lumaM;
float lumaNN=lumaN+lumaM;
float lumaSS=lumaS+lumaM;
bool pairN=abs(gradientN)>=abs(gradientS);
float gradient=max(abs(gradientN),abs(gradientS));
if (pairN)
{
lengthSign=-lengthSign;
}
float subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);
vec2 posB;
posB.x=posM.x;
posB.y=posM.y;
vec2 offNP;
offNP.x=(!horzSpan) ? 0.0 : texelSize.x;
offNP.y=(horzSpan) ? 0.0 : texelSize.y;
if (!horzSpan)
{
posB.x+=lengthSign*0.5;
}
if (horzSpan)
{
posB.y+=lengthSign*0.5;
}
vec2 posN;
posN.x=posB.x-offNP.x*1.5;
posN.y=posB.y-offNP.y*1.5;
vec2 posP;
posP.x=posB.x+offNP.x*1.5;
posP.y=posB.y+offNP.y*1.5;
float subpixD=((-2.0)*subpixC)+3.0;
float lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));
float subpixE=subpixC*subpixC;
float lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));
if (!pairN)
{
lumaNN=lumaSS;
}
float gradientScaled=gradient*1.0/4.0;
float lumaMM=lumaM-lumaNN*0.5;
float subpixF=subpixD*subpixE;
bool lumaMLTZero=lumaMM<0.0;
lumaEndN-=lumaNN*0.5;
lumaEndP-=lumaNN*0.5;
bool doneN=abs(lumaEndN)>=gradientScaled;
bool doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)
{
posN.x-=offNP.x*3.0;
}
if (!doneN)
{
posN.y-=offNP.y*3.0;
}
bool doneNP=(!doneN) || (!doneP);
if (!doneP)
{
posP.x+=offNP.x*3.0;
}
if (!doneP)
{
posP.y+=offNP.y*3.0;
}
if (doneNP)
{
if (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));
if (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));
if (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN) posN.x-=offNP.x*12.0;
if (!doneN) posN.y-=offNP.y*12.0;
doneNP=(!doneN) || (!doneP);
if (!doneP) posP.x+=offNP.x*12.0;
if (!doneP) posP.y+=offNP.y*12.0;
}
float dstN=posM.x-posN.x;
float dstP=posP.x-posM.x;
if (!horzSpan)
{
dstN=posM.y-posN.y;
}
if (!horzSpan)
{
dstP=posP.y-posM.y;
}
bool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;
float spanLength=(dstP+dstN);
bool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;
float spanLengthRcp=1.0/spanLength;
bool directionN=dstN<dstP;
float dst=min(dstN,dstP);
bool goodSpan=directionN ? goodSpanN : goodSpanP;
float subpixG=subpixF*subpixF;
float pixelOffset=(dst*(-spanLengthRcp))+0.5;
float subpixH=subpixG*fxaaQualitySubpix;
float pixelOffsetGood=goodSpan ? pixelOffset : 0.0;
float pixelOffsetSubpix=max(pixelOffsetGood,subpixH);
if (!horzSpan)
{
posM.x+=pixelOffsetSubpix*lengthSign;
}
if (horzSpan)
{
posM.y+=pixelOffsetSubpix*lengthSign;
}
#ifdef MALI
if(range<rangeMaxClamped)
{
gl_FragColor=rgbyM;
}
else
{
gl_FragColor=texture2D(textureSampler,posM,0.0);
}
#else
gl_FragColor=texture2D(textureSampler,posM,0.0);
#endif
}`;Ia.a.ShadersStore.fxaaPixelShader=Xk;var Yk=`
attribute vec2 position;
uniform vec2 texelSize;

varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd);
sampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;
sampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;
sampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;
sampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;
sampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;
sampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;
sampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;
sampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;
gl_Position=vec4(position,0.0,1.0);
}`;Ia.a.ShadersStore.fxaaVertexShader=Yk;var Yd=function(e){function a(b,c,d,f,h,i,k){void 0===d&&(d=null),void 0===k&&(k=o.a.TEXTURETYPE_UNSIGNED_INT);var m=e.call(this,b,"fxaa",["texelSize"],null,c,d,f||ra.a.BILINEAR_SAMPLINGMODE,h,i,null,k,"fxaa",void 0,!0)||this,B=m._getDefines();return m.updateEffect(B),m.onApplyObservable.add(function(E){var K=m.texelSize;E.setFloat2("texelSize",K.x,K.y)}),m}return v.d(a,e),a.prototype._getDefines=function(){var b=this.getEngine();if(!b)return null;var c=b.getGlInfo();return c&&c.renderer&&c.renderer.toLowerCase().indexOf("mali")>-1?`#define MALI 1
`:null},a}(Za),Zk=`#include<helperFunctions>

uniform sampler2D textureSampler;

uniform float intensity;
uniform float animatedSeed;

varying vec2 vUV;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec2 seed=vUV*(animatedSeed);
float grain=dither(seed,intensity);

float lum=getLuminance(gl_FragColor.rgb);
float grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;
gl_FragColor.rgb+=grain*grainAmount;
gl_FragColor.rgb=max(gl_FragColor.rgb,0.0);
}`;Ia.a.ShadersStore.grainPixelShader=Zk;var Yh=function(e){function a(b,c,d,f,h,i,k,m){void 0===k&&(k=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1);var B=e.call(this,b,"grain",["intensity","animatedSeed"],[],c,d,f,h,i,null,k,void 0,null,m)||this;return B.intensity=30,B.animated=!1,B.onApplyObservable.add(function(E){E.setFloat("intensity",B.intensity),E.setFloat("animatedSeed",B.animated?Math.random()+1:1)}),B}return v.d(a,e),a}(Za),_k=`
varying vec2 vUV;
uniform sampler2D textureSampler;
const vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);
void main(void)
{
vec4 tex=texture2D(textureSampler,vUV);
vec3 c=tex.rgb;
float luma=dot(c.rgb,RGBLuminanceCoefficients);


gl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a);
}`;Ia.a.ShadersStore.highlightsPixelShader=_k;var $k=function(e){function a(b,c,d,f,h,i,k){return void 0===k&&(k=o.a.TEXTURETYPE_UNSIGNED_INT),e.call(this,b,"highlights",null,null,c,d,f,h,i,null,k)||this}return v.d(a,e),a}(Za);Ia.a.IncludesShadersStore.mrtFragmentDeclaration=`#if __VERSION__>=200
layout(location=0) out vec4 glFragData[{X}];
#endif
`;var al=`#extension GL_EXT_draw_buffers : require
precision highp float;
precision highp int;
varying vec3 vNormalV;
varying vec4 vViewPos;
#ifdef POSITION
varying vec3 vPosition;
#endif
#ifdef VELOCITY
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#include<mrtFragmentDeclaration>[RENDER_TARGET_COUNT]
void main() {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
gl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);

gl_FragData[1]=vec4(normalize(vNormalV),1.0);

#ifdef POSITION
gl_FragData[POSITION_INDEX]=vec4(vPosition,1.0);
#endif
#ifdef VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
}`;Ia.a.ShadersStore.geometryPixelShader=al;var bl=`precision highp float;
precision highp int;
#include<bonesDeclaration>
#include<instancesDeclaration>
attribute vec3 position;
attribute vec3 normal;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif

uniform mat4 viewProjection;
uniform mat4 view;
varying vec3 vNormalV;
varying vec4 vViewPos;
#ifdef POSITION
varying vec3 vPosition;
#endif
#ifdef VELOCITY
uniform mat4 previousWorld;
uniform mat4 previousViewProjection;
#ifdef BONES_VELOCITY_ENABLED
#if NUM_BONE_INFLUENCERS>0
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#endif
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
void main(void)
{
#include<instancesVertex>
#if defined(VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(position,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(position,1.0);
#endif
#include<bonesVertex>
vec4 pos=vec4(finalWorld*vec4(position,1.0));
vNormalV=normalize(vec3((view*finalWorld)*vec4(normal,0.0)));
vViewPos=view*pos;
#if defined(VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*finalWorld*vec4(position,1.0);
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;
previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(position,1.0);
#else
vPreviousPosition=previousViewProjection*previousWorld*vec4(position,1.0);
#endif
#endif
#ifdef POSITION
vPosition=pos.xyz/pos.w;
#endif
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}`;Ia.a.ShadersStore.geometryVertexShader=bl;var Zd=function(){function e(a,b){void 0===b&&(b=1),this._previousTransformationMatrices={},this._previousBonesTransformationMatrices={},this.excludedSkinnedMeshesFromVelocity=[],this._enablePosition=!1,this._enableVelocity=!1,this._positionIndex=-1,this._velocityIndex=-1,this._scene=a,this._ratio=b,e._SceneComponentInitialization(this._scene),this._createRenderTargets()}return Object.defineProperty(e.prototype,"renderList",{set:function(a){this._multiRenderTarget.renderList=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!0,configurable:!0}),e.prototype.getTextureIndex=function(a){switch(a){case e.POSITION_TEXTURE_TYPE:return this._positionIndex;case e.VELOCITY_TEXTURE_TYPE:return this._velocityIndex;default:return-1}},Object.defineProperty(e.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(a){this._enablePosition=a,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableVelocity",{get:function(){return this._enableVelocity},set:function(a){this._enableVelocity=a,a||(this._previousTransformationMatrices={}),this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ratio",{get:function(){return this._ratio},enumerable:!0,configurable:!0}),e.prototype.isReady=function(a,b){var c=a.getMaterial();if(c&&c.disableDepthWrite)return!1;var d=[],f=[na.b.PositionKind,na.b.NormalKind],h=a.getMesh();c&&c.needAlphaTesting()&&(d.push("#define ALPHATEST"),h.isVerticesDataPresent(na.b.UVKind)&&(f.push(na.b.UVKind),d.push("#define UV1")),h.isVerticesDataPresent(na.b.UV2Kind)&&(f.push(na.b.UV2Kind),d.push("#define UV2"))),this._enablePosition&&(d.push("#define POSITION"),d.push("#define POSITION_INDEX "+this._positionIndex)),this._enableVelocity&&(d.push("#define VELOCITY"),d.push("#define VELOCITY_INDEX "+this._velocityIndex),-1===this.excludedSkinnedMeshesFromVelocity.indexOf(h)&&d.push("#define BONES_VELOCITY_ENABLED")),h.useBones&&h.computeBonesUsingShaders?(f.push(na.b.MatricesIndicesKind),f.push(na.b.MatricesWeightsKind),h.numBoneInfluencers>4&&(f.push(na.b.MatricesIndicesExtraKind),f.push(na.b.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+h.numBoneInfluencers),d.push("#define BonesPerMesh "+(h.skeleton?h.skeleton.bones.length+1:0))):d.push("#define NUM_BONE_INFLUENCERS 0"),b&&(d.push("#define INSTANCES"),f.push("world0"),f.push("world1"),f.push("world2"),f.push("world3")),d.push("#define RENDER_TARGET_COUNT "+this._multiRenderTarget.textures.length);var i=d.join(`
`);return this._cachedDefines!==i&&(this._cachedDefines=i,this._effect=this._scene.getEngine().createEffect("geometry",f,["world","mBones","viewProjection","diffuseMatrix","view","previousWorld","previousViewProjection","mPreviousBones"],["diffuseSampler"],i,void 0,void 0,void 0,{buffersCount:this._enablePosition?3:2})),this._effect.isReady()},e.prototype.getGBuffer=function(){return this._multiRenderTarget},Object.defineProperty(e.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(a){this._multiRenderTarget.samples=a},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.getGBuffer().dispose()},e.prototype._createRenderTargets=function(){var a=this,b=this._scene.getEngine(),c=2;if(this._enablePosition&&(this._positionIndex=c,c++),this._enableVelocity&&(this._velocityIndex=c,c++),this._multiRenderTarget=new Ch("gBuffer",{width:b.getRenderWidth()*this._ratio,height:b.getRenderHeight()*this._ratio},c,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:o.a.TEXTURETYPE_FLOAT}),this.isSupported){this._multiRenderTarget.wrapU=ra.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=ra.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add(function(f){f.clear(new j.f(0,0,0,1),!0,!0,!0)});var d=function(f){var h=f.getRenderingMesh(),i=a._scene,k=i.getEngine(),m=f.getMaterial();if(m){if(a._enableVelocity&&!a._previousTransformationMatrices[h.uniqueId]&&(a._previousTransformationMatrices[h.uniqueId]={world:j.j.Identity(),viewProjection:i.getTransformMatrix()},h.skeleton)){var B=h.skeleton.getTransformMatrices(h);a._previousBonesTransformationMatrices[h.uniqueId]=a._copyBonesTransformationMatrices(B,new Float32Array(B.length))}k.setState(m.backFaceCulling,0,!1,i.useRightHandedSystem);var E=h._getInstancesRenderList(f._id);if(!E.mustReturn){var K=k.getCaps().instancedArrays&&null!==E.visibleInstances[f._id];if(a.isReady(f,K)){if(k.enableEffect(a._effect),h._bind(f,a._effect,rb.a.TriangleFillMode),a._effect.setMatrix("viewProjection",i.getTransformMatrix()),a._effect.setMatrix("view",i.getViewMatrix()),m&&m.needAlphaTesting()){var P=m.getAlphaTestTexture();P&&(a._effect.setTexture("diffuseSampler",P),a._effect.setMatrix("diffuseMatrix",P.getTextureMatrix()))}h.useBones&&h.computeBonesUsingShaders&&h.skeleton&&(a._effect.setMatrices("mBones",h.skeleton.getTransformMatrices(h)),a._enableVelocity&&a._effect.setMatrices("mPreviousBones",a._previousBonesTransformationMatrices[h.uniqueId])),a._enableVelocity&&(a._effect.setMatrix("previousWorld",a._previousTransformationMatrices[h.uniqueId].world),a._effect.setMatrix("previousViewProjection",a._previousTransformationMatrices[h.uniqueId].viewProjection)),h._processRendering(f,a._effect,rb.a.TriangleFillMode,E,K,function(S,U){return a._effect.setMatrix("world",U)})}a._enableVelocity&&(a._previousTransformationMatrices[h.uniqueId].world=h.getWorldMatrix().clone(),a._previousTransformationMatrices[h.uniqueId].viewProjection=a._scene.getTransformMatrix().clone(),h.skeleton&&a._copyBonesTransformationMatrices(h.skeleton.getTransformMatrices(h),a._previousBonesTransformationMatrices[h.uniqueId]))}}};this._multiRenderTarget.customRenderFunction=function(f,h,i,k){var m;if(k.length){for(b.setColorWrite(!1),m=0;m<k.length;m++)d(k.data[m]);b.setColorWrite(!0)}for(m=0;m<f.length;m++)d(f.data[m]);for(m=0;m<h.length;m++)d(h.data[m])}}},e.prototype._copyBonesTransformationMatrices=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b},e.POSITION_TEXTURE_TYPE=1,e.VELOCITY_TEXTURE_TYPE=2,e._SceneComponentInitialization=function(a){throw Zb.a.WarnImport("GeometryBufferRendererSceneComponent")},e}();Object.defineProperty(ja.a.prototype,"geometryBufferRenderer",{get:function(){this._geometryBufferRenderer},set:function(e){e&&e.isSupported&&(this._geometryBufferRenderer=e)},enumerable:!0,configurable:!0}),ja.a.prototype.enableGeometryBufferRenderer=function(e){return void 0===e&&(e=1),this._geometryBufferRenderer?this._geometryBufferRenderer:(this._geometryBufferRenderer=new Zd(this,e),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null),this._geometryBufferRenderer)},ja.a.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var Zh=function(){function e(a){this.name=Pa.a.NAME_GEOMETRYBUFFERRENDERER,this.scene=a}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Pa.a.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(a){this.scene._geometryBufferRenderer&&a.push(this.scene._geometryBufferRenderer.getGBuffer())},e}();Zd._SceneComponentInitialization=function(e){var a=e._getComponent(Pa.a.NAME_GEOMETRYBUFFERRENDERER);a||(a=new Zh(e),e._addComponent(a))};var cl=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D velocitySampler;
uniform float motionStrength;
uniform float motionScale;
uniform vec2 screenSize;
void main(void)
{
#ifdef GEOMETRY_SUPPORTED
vec2 texelSize=1.0/screenSize;
vec2 velocityColor=texture2D(velocitySampler,vUV).rg*2.0-1.0;
vec2 velocity=vec2(pow(velocityColor.r,3.0),pow(velocityColor.g,3.0));
velocity*=motionScale*motionStrength;
float speed=length(velocity/texelSize);
int samplesCount=int(clamp(speed,1.0,SAMPLES));
velocity=normalize(velocity)*texelSize;
float hlim=float(-samplesCount)*0.5+0.5;
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(SAMPLES); ++i)
{
if (i>=samplesCount)
break;
vec2 offset=vUV+velocity*(hlim+float(i));
result+=texture2D(textureSampler,offset);
}
gl_FragColor=result/float(samplesCount);
gl_FragColor.a=1.0;
#else
gl_FragColor=texture2D(textureSampler,vUV);
#endif
}
`;Ia.a.ShadersStore.motionBlurPixelShader=cl;var dl=function(e){function a(b,c,d,f,h,i,k,m,B){void 0===m&&(m=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===B&&(B=!1);var E=e.call(this,b,"motionBlur",["motionStrength","motionScale","screenSize"],["velocitySampler"],d,f,h,i,k,`#define GEOMETRY_SUPPORTED
#define SAMPLES 64.0`,m,void 0,null,B)||this;return E.motionStrength=1,E._motionBlurSamples=32,E._geometryBufferRenderer=c.enableGeometryBufferRenderer(),E._geometryBufferRenderer?(E._geometryBufferRenderer.enableVelocity=!0,E.onApply=function(K){if(K.setVector2("screenSize",new j.w(E.width,E.height)),K.setFloat("motionScale",c.getAnimationRatio()),K.setFloat("motionStrength",E.motionStrength),E._geometryBufferRenderer){var P=E._geometryBufferRenderer.getTextureIndex(Zd.VELOCITY_TEXTURE_TYPE);K.setTexture("velocitySampler",E._geometryBufferRenderer.getGBuffer().textures[P])}}):(r.a.Warn("Multiple Render Target support needed to compute object based motion blur"),E.updateEffect()),E}return v.d(a,e),Object.defineProperty(a.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(b){this._motionBlurSamples=b,this._geometryBufferRenderer&&this.updateEffect(`#define GEOMETRY_SUPPORTED
#define SAMPLES `+b.toFixed(1))},enumerable:!0,configurable:!0}),a.prototype.excludeSkinnedMesh=function(b){this._geometryBufferRenderer&&b.skeleton&&this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.push(b)},a.prototype.removeExcludedSkinnedMesh=function(b){if(this._geometryBufferRenderer&&b.skeleton){var c=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.indexOf(b);-1!==c&&this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.splice(c,1)}},a.prototype.dispose=function(b){this._geometryBufferRenderer&&(this._geometryBufferRenderer._previousTransformationMatrices={},this._geometryBufferRenderer._previousBonesTransformationMatrices={},this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity=[]),e.prototype.dispose.call(this,b)},a}(Za),el=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D refractionSampler;

uniform vec3 baseColor;
uniform float depth;
uniform float colorLevel;
void main() {
float ref=1.0-texture2D(refractionSampler,vUV).r;
vec2 uv=vUV-vec2(0.5);
vec2 offset=uv*depth*ref;
vec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;
gl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);
}`;Ia.a.ShadersStore.refractionPixelShader=el;var fl=function(e){function a(b,c,d,f,h,i,k,m,B,E){var K=e.call(this,b,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],i,k,m,B,E)||this;return K.color=d,K.depth=f,K.colorLevel=h,K._ownRefractionTexture=!0,K.onActivateObservable.add(function(P){K._refTexture=K._refTexture||new ra.a(c,P.getScene())}),K.onApplyObservable.add(function(P){P.setColor3("baseColor",K.color),P.setFloat("depth",K.depth),P.setFloat("colorLevel",K.colorLevel),P.setTexture("refractionSampler",K._refTexture)}),K}return v.d(a,e),Object.defineProperty(a.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(b){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=b,this._ownRefractionTexture=!1},enumerable:!0,configurable:!0}),a.prototype.dispose=function(b){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),e.prototype.dispose.call(this,b)},a}(Za),gl=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform vec2 sharpnessAmounts;
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 color=texture2D(textureSampler,vUV);
vec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(0,1)) -
color*4.0;
gl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);
}`;Ia.a.ShadersStore.sharpenPixelShader=gl;var _h=function(e){function a(b,c,d,f,h,i,k,m){void 0===k&&(k=o.a.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1);var B=e.call(this,b,"sharpen",["sharpnessAmounts","screenSize"],null,c,d,f,h,i,null,k,void 0,null,m)||this;return B.colorAmount=1,B.edgeAmount=.3,B.onApply=function(E){E.setFloat2("screenSize",B.width,B.height),E.setFloat2("sharpnessAmounts",B.edgeAmount,B.colorAmount)},B}return v.d(a,e),a}(Za),Wc=function(){function e(a,b){this.engine=a,this._name=b,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array(),this._cameras=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var a in this._renderEffects)if(this._renderEffects.hasOwnProperty(a)&&!this._renderEffects[a].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype.addEffect=function(a){this._renderEffects[a._name]=a},e.prototype._rebuild=function(){},e.prototype._enableEffect=function(a,b){var c=this._renderEffects[a];c&&c._enable(xa.h.MakeArray(b||this._cameras))},e.prototype._disableEffect=function(a,b){var c=this._renderEffects[a];c&&c._disable(xa.h.MakeArray(b||this._cameras))},e.prototype._attachCameras=function(a,b){var c=xa.h.MakeArray(a||this._cameras);if(c){var d,f=[];for(d=0;d<c.length;d++){var h=c[d],i=h.name;-1===this._cameras.indexOf(h)?this._cameras[i]=h:b&&f.push(d)}for(d=0;d<f.length;d++)a.splice(f[d],1);for(var k in this._renderEffects)this._renderEffects.hasOwnProperty(k)&&this._renderEffects[k]._attachCameras(c)}},e.prototype._detachCameras=function(a){var b=xa.h.MakeArray(a||this._cameras);if(b){for(var c in this._renderEffects)this._renderEffects.hasOwnProperty(c)&&this._renderEffects[c]._detachCameras(b);for(var d=0;d<b.length;d++)this._cameras.splice(this._cameras.indexOf(b[d]),1)}},e.prototype._update=function(){for(var a in this._renderEffects)this._renderEffects.hasOwnProperty(a)&&this._renderEffects[a]._update();for(var b=0;b<this._cameras.length;b++){var c=this._cameras[b].name;this._renderEffectsForIsolatedPass[c]&&this._renderEffectsForIsolatedPass[c]._update()}},e.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array()},e.prototype._enableMSAAOnFirstPostProcess=function(a){var b=Object.keys(this._renderEffects);if(1===this.engine.webGLVersion)return!1;if(b.length>0){var c=this._renderEffects[b[0]].getPostProcesses();c&&(c[0].samples=a)}return!0},e.prototype.dispose=function(){},v.c([Object(g.c)()],e.prototype,"_name",void 0),e}(),$h=function(){function e(){this._renderPipelines={}}return Object.defineProperty(e.prototype,"supportedPipelines",{get:function(){var a=[];for(var b in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(b)){var c=this._renderPipelines[b];c.isSupported&&a.push(c)}return a},enumerable:!0,configurable:!0}),e.prototype.addPipeline=function(a){this._renderPipelines[a._name]=a},e.prototype.attachCamerasToRenderPipeline=function(a,b,c){void 0===c&&(c=!1);var d=this._renderPipelines[a];d&&d._attachCameras(b,c)},e.prototype.detachCamerasFromRenderPipeline=function(a,b){var c=this._renderPipelines[a];c&&c._detachCameras(b)},e.prototype.enableEffectInPipeline=function(a,b,c){var d=this._renderPipelines[a];d&&d._enableEffect(b,c)},e.prototype.disableEffectInPipeline=function(a,b,c){var d=this._renderPipelines[a];d&&d._disableEffect(b,c)},e.prototype.update=function(){for(var a in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(a)){var b=this._renderPipelines[a];b.isSupported?b._update():(b.dispose(),delete this._renderPipelines[a])}},e.prototype._rebuild=function(){for(var a in this._renderPipelines)this._renderPipelines.hasOwnProperty(a)&&this._renderPipelines[a]._rebuild()},e.prototype.dispose=function(){for(var a in this._renderPipelines)this._renderPipelines.hasOwnProperty(a)&&this._renderPipelines[a].dispose()},e}();Object.defineProperty(ja.a.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var e=this._getComponent(Pa.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER);e||(e=new ai(this),this._addComponent(e)),this._postProcessRenderPipelineManager=new $h()}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var ai=function(){function e(a){this.name=Pa.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=a}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Pa.a.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},e.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},e.prototype._gatherRenderTargets=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},e}(),bi=function(e){function a(b,c,d,f,h){void 0===b&&(b=""),void 0===c&&(c=!0),void 0===d&&(d=T.a.LastCreatedScene),void 0===h&&(h=!0);var i=e.call(this,d.getEngine(),b)||this;i._camerasToBeAttached=[],i.SharpenPostProcessId="SharpenPostProcessEffect",i.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",i.FxaaPostProcessId="FxaaPostProcessEffect",i.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",i.GrainPostProcessId="GrainPostProcessEffect",i._glowLayer=null,i.animations=[],i._imageProcessingConfigurationObserver=null,i._sharpenEnabled=!1,i._bloomEnabled=!1,i._depthOfFieldEnabled=!1,i._depthOfFieldBlurLevel=Fc.Low,i._fxaaEnabled=!1,i._imageProcessingEnabled=!0,i._bloomScale=.5,i._chromaticAberrationEnabled=!1,i._grainEnabled=!1,i._buildAllowed=!0,i._resizeObserver=null,i._hardwareScaleLevel=1,i._bloomKernel=64,i._bloomWeight=.15,i._bloomThreshold=.9,i._samples=1,i._hasCleared=!1,i._prevPostProcess=null,i._prevPrevPostProcess=null,i._depthOfFieldSceneObserver=null,i._cameras=f||d.cameras,i._cameras=i._cameras.slice(),i._camerasToBeAttached=i._cameras.slice(),i._buildAllowed=h,i._scene=d;var k=i._scene.getEngine().getCaps();i._hdr=c&&(k.textureHalfFloatRender||k.textureFloatRender),i._hdr?k.textureHalfFloatRender?i._defaultPipelineTextureType=o.a.TEXTURETYPE_HALF_FLOAT:k.textureFloatRender&&(i._defaultPipelineTextureType=o.a.TEXTURETYPE_FLOAT):i._defaultPipelineTextureType=o.a.TEXTURETYPE_UNSIGNED_INT,d.postProcessRenderPipelineManager.addPipeline(i);var m=i._scene.getEngine();return i.sharpen=new _h("sharpen",1,null,ra.a.BILINEAR_SAMPLINGMODE,m,!1,i._defaultPipelineTextureType,!0),i._sharpenEffect=new lb(m,i.SharpenPostProcessId,function(){return i.sharpen},!0),i.depthOfField=new Gf(i._scene,null,i._depthOfFieldBlurLevel,i._defaultPipelineTextureType,!0),i.bloom=new Ef(i._scene,i._bloomScale,i._bloomWeight,i.bloomKernel,i._defaultPipelineTextureType,!0),i.chromaticAberration=new Vh("ChromaticAberration",m.getRenderWidth(),m.getRenderHeight(),1,null,ra.a.BILINEAR_SAMPLINGMODE,m,!1,i._defaultPipelineTextureType,!0),i._chromaticAberrationEffect=new lb(m,i.ChromaticAberrationPostProcessId,function(){return i.chromaticAberration},!0),i.grain=new Yh("Grain",1,null,ra.a.BILINEAR_SAMPLINGMODE,m,!1,i._defaultPipelineTextureType,!0),i._grainEffect=new lb(m,i.GrainPostProcessId,function(){return i.grain},!0),i._resizeObserver=m.onResizeObservable.add(function(){i._hardwareScaleLevel=m.getHardwareScalingLevel(),i.bloomKernel=i.bloomKernel}),i._imageProcessingConfigurationObserver=i._scene.imageProcessingConfiguration.onUpdateParameters.add(function(){i.bloom._downscale._exposure=i._scene.imageProcessingConfiguration.exposure}),i._buildPipeline(),i}return v.d(a,e),Object.defineProperty(a.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(b){this._sharpenEnabled!==b&&(this._sharpenEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(b){this._bloomKernel=b,this.bloom.kernel=b/this._hardwareScaleLevel},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(b){this._bloomWeight!==b&&(this.bloom.weight=b,this._bloomWeight=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(b){this._bloomThreshold!==b&&(this.bloom.threshold=b,this._bloomThreshold=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(b){this._bloomScale!==b&&(this._bloomScale=b,this._rebuildBloom(),this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(b){this._bloomEnabled!==b&&(this._bloomEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),a.prototype._rebuildBloom=function(){var b=this.bloom;this.bloom=new Ef(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=b.threshold;for(var c=0;c<this._cameras.length;c++)b.disposeEffects(this._cameras[c])},Object.defineProperty(a.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(b){this._depthOfFieldEnabled!==b&&(this._depthOfFieldEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(b){if(this._depthOfFieldBlurLevel!==b){this._depthOfFieldBlurLevel=b;var c=this.depthOfField;this.depthOfField=new Gf(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=c.focalLength,this.depthOfField.focusDistance=c.focusDistance,this.depthOfField.fStop=c.fStop,this.depthOfField.lensSize=c.lensSize;for(var d=0;d<this._cameras.length;d++)c.disposeEffects(this._cameras[d]);this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(b){this._fxaaEnabled!==b&&(this._fxaaEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"samples",{get:function(){return this._samples},set:function(b){this._samples!==b&&(this._samples=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(b){this._imageProcessingEnabled!==b&&(this._imageProcessingEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"glowLayerEnabled",{get:function(){return null!=this._glowLayer},set:function(b){b&&!this._glowLayer?this._glowLayer=new Rd("",this._scene):!b&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"glowLayer",{get:function(){return this._glowLayer},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(b){this._chromaticAberrationEnabled!==b&&(this._chromaticAberrationEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(b){this._grainEnabled!==b&&(this._grainEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"DefaultRenderingPipeline"},a.prototype.prepare=function(){var b=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=b},a.prototype._setAutoClearAndTextureSharing=function(b,c){void 0===c&&(c=!1),this._hasCleared?b.autoClear=!1:(b.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),c||(this._prevPrevPostProcess?b.shareOutputWith(this._prevPrevPostProcess):b.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=b)},a.prototype._buildPipeline=function(){var b=this;if(this._buildAllowed){this._scene.autoClear=!0;var c=this._scene.getEngine();if(this._disposePostProcesses(),null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var d=0,f=this._cameras;d<f.length;d++){var h=f[d];(i=this._scene.enableDepthRenderer(h)).useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add(function(k){b._cameras.indexOf(k.activeCamera)>-1&&(b.depthOfField.depthTexture=k.enableDepthRenderer(k.activeCamera).getDepthMap())})}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var i=this._scene.enableDepthRenderer(this._cameras[0]);this.depthOfField.depthTexture=i.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new Ie("imageProcessing",1,null,ra.a.BILINEAR_SAMPLINGMODE,c,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new lb(c,this.ImageProcessingPostProcessId,function(){return b.imageProcessing},!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new Yd("fxaa",1,null,ra.a.BILINEAR_SAMPLINGMODE,c,!1,this._defaultPipelineTextureType),this.addEffect(new lb(c,this.FxaaPostProcessId,function(){return b.fxaa},!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&r.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")}},a.prototype._disposePostProcesses=function(b){void 0===b&&(b=!1);for(var c=0;c<this._cameras.length;c++){var d=this._cameras[c];this.imageProcessing&&this.imageProcessing.dispose(d),this.fxaa&&this.fxaa.dispose(d),b&&(this.sharpen&&this.sharpen.dispose(d),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(d)),this.bloom&&this.bloom.disposeEffects(d),this.chromaticAberration&&this.chromaticAberration.dispose(d),this.grain&&this.grain.dispose(d),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,b&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},a.prototype.addCamera=function(b){this._camerasToBeAttached.push(b),this._buildPipeline()},a.prototype.removeCamera=function(b){var c=this._camerasToBeAttached.indexOf(b);this._camerasToBeAttached.splice(c,1),this._buildPipeline()},a.prototype.dispose=function(){this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),e.prototype.dispose.call(this)},a.prototype.serialize=function(){var b=g.a.Serialize(this);return b.customType="DefaultRenderingPipeline",b},a.Parse=function(b,c,d){return g.a.Parse(function(){return new a(b._name,b._name._hdr,c)},b,c,d)},v.c([Object(g.c)()],a.prototype,"sharpenEnabled",null),v.c([Object(g.c)()],a.prototype,"bloomKernel",null),v.c([Object(g.c)()],a.prototype,"_bloomWeight",void 0),v.c([Object(g.c)()],a.prototype,"_bloomThreshold",void 0),v.c([Object(g.c)()],a.prototype,"_hdr",void 0),v.c([Object(g.c)()],a.prototype,"bloomWeight",null),v.c([Object(g.c)()],a.prototype,"bloomThreshold",null),v.c([Object(g.c)()],a.prototype,"bloomScale",null),v.c([Object(g.c)()],a.prototype,"bloomEnabled",null),v.c([Object(g.c)()],a.prototype,"depthOfFieldEnabled",null),v.c([Object(g.c)()],a.prototype,"depthOfFieldBlurLevel",null),v.c([Object(g.c)()],a.prototype,"fxaaEnabled",null),v.c([Object(g.c)()],a.prototype,"samples",null),v.c([Object(g.c)()],a.prototype,"imageProcessingEnabled",null),v.c([Object(g.c)()],a.prototype,"glowLayerEnabled",null),v.c([Object(g.c)()],a.prototype,"chromaticAberrationEnabled",null),v.c([Object(g.c)()],a.prototype,"grainEnabled",null),a}(Wc);I.a.RegisteredTypes["BABYLON.DefaultRenderingPipeline"]=bi;var hl=`
uniform sampler2D textureSampler;

uniform float gain;
uniform float threshold;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;

vec4 highlightColor(vec4 color) {
vec4 highlight=color;
float luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));
float lum_threshold;
if (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }
else { lum_threshold=0.5+0.44*threshold; }
luminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);
highlight*=luminance*gain;
highlight.a=1.0;
return highlight;
}
void main(void)
{
vec4 original=texture2D(textureSampler,vUV);

if (gain == -1.0) {
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
return;
}
float w=2.0/screen_width;
float h=2.0/screen_height;
float weight=1.0;

vec4 blurred=vec4(0.0,0.0,0.0,0.0);
#ifdef PENTAGON
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));
#else
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));
#endif
blurred/=39.0;
gl_FragColor=blurred;

}`;Ia.a.ShadersStore.lensHighlightsPixelShader=hl;var il=`




uniform sampler2D textureSampler;
uniform sampler2D highlightsSampler;
uniform sampler2D depthSampler;
uniform sampler2D grainSampler;

uniform float grain_amount;
uniform bool blur_noise;
uniform float screen_width;
uniform float screen_height;
uniform float distortion;
uniform bool dof_enabled;

uniform float screen_distance;
uniform float aperture;
uniform float darken;
uniform float edge_blur;
uniform bool highlights;

uniform float near;
uniform float far;

varying vec2 vUV;

#define PI 3.14159265
#define TWOPI 6.28318530
#define inverse_focal_length 0.1

vec2 centered_screen_pos;
vec2 distorted_coords;
float radius2;
float radius;

vec2 rand(vec2 co)
{
float noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));
float noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));
return clamp(vec2(noise1,noise2),0.0,1.0);
}

vec2 getDistortedCoords(vec2 coords) {
if (distortion == 0.0) { return coords; }
vec2 direction=1.0*normalize(centered_screen_pos);
vec2 dist_coords=vec2(0.5,0.5);
dist_coords.x=0.5+direction.x*radius2*1.0;
dist_coords.y=0.5+direction.y*radius2*1.0;
float dist_amount=clamp(distortion*0.23,0.0,1.0);
dist_coords=mix(coords,dist_coords,dist_amount);
return dist_coords;
}

float sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {

vec2 coords=distorted_coords;
float angle=rand(coords*100.0).x*TWOPI;
coords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));
color+=texture2D(textureSampler,coords)*weight;
return weight;
}

float getBlurLevel(float size) {
return min(3.0,ceil(size/1.0));
}

vec4 getBlurColor(float size) {
vec4 col=texture2D(textureSampler,distorted_coords);
if (size == 0.0) { return col; }


float blur_level=getBlurLevel(size);
float w=(size/screen_width);
float h=(size/screen_height);
float total_weight=1.0;
vec2 sample_coords;
total_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);
total_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);
total_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);
total_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);
total_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);
total_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);
total_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);
total_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);
total_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);
total_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);
if (blur_level>1.0) {
total_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);
total_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);
total_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);
total_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);
total_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);
total_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);
total_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);
total_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);
total_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);
total_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);
}
if (blur_level>2.0) {
total_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);
total_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);
total_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);
total_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);
total_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);
total_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);
total_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);
total_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);
total_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);
}
col/=total_weight;

if (darken>0.0) {
col.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);
}




return col;
}
void main(void)
{

centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);
radius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;
radius=sqrt(radius2);
distorted_coords=getDistortedCoords(vUV);
vec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height);
float depth=texture2D(depthSampler,distorted_coords).r;
float distance=near+(far-near)*depth;
vec4 color=texture2D(textureSampler,vUV);


float coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));

if (dof_enabled == false || coc<0.07) { coc=0.0; }

float edge_blur_amount=0.0;
if (edge_blur>0.0) {
edge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;
}

float blur_amount=max(edge_blur_amount,coc);

if (blur_amount == 0.0) {
gl_FragColor=texture2D(textureSampler,distorted_coords);
}
else {

gl_FragColor=getBlurColor(blur_amount*1.7);

if (highlights) {
gl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;
}
if (blur_noise) {

vec2 noise=rand(distorted_coords)*0.01*blur_amount;
vec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);
gl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;
}
}

if (grain_amount>0.0) {
vec4 grain_color=texture2D(grainSampler,texels_coords*0.003);
gl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;
}
}
`;Ia.a.ShadersStore.depthOfFieldPixelShader=il;var jl=function(e){function a(b,c,d,f,h){void 0===f&&(f=1);var i=e.call(this,d.getEngine(),b)||this;return i.LensChromaticAberrationEffect="LensChromaticAberrationEffect",i.HighlightsEnhancingEffect="HighlightsEnhancingEffect",i.LensDepthOfFieldEffect="LensDepthOfFieldEffect",i._pentagonBokehIsEnabled=!1,i._scene=d,i._depthTexture=d.enableDepthRenderer().getDepthMap(),c.grain_texture?i._grainTexture=c.grain_texture:i._createGrainTexture(),i._edgeBlur=c.edge_blur?c.edge_blur:0,i._grainAmount=c.grain_amount?c.grain_amount:0,i._chromaticAberration=c.chromatic_aberration?c.chromatic_aberration:0,i._distortion=c.distortion?c.distortion:0,i._highlightsGain=void 0!==c.dof_gain?c.dof_gain:-1,i._highlightsThreshold=c.dof_threshold?c.dof_threshold:1,i._dofDistance=void 0!==c.dof_focus_distance?c.dof_focus_distance:-1,i._dofAperture=c.dof_aperture?c.dof_aperture:1,i._dofDarken=c.dof_darken?c.dof_darken:0,i._dofPentagon=void 0===c.dof_pentagon||c.dof_pentagon,i._blurNoise=void 0===c.blur_noise||c.blur_noise,i._createChromaticAberrationPostProcess(f),i._createHighlightsPostProcess(f),i._createDepthOfFieldPostProcess(f/4),i.addEffect(new lb(d.getEngine(),i.LensChromaticAberrationEffect,function(){return i._chromaticAberrationPostProcess},!0)),i.addEffect(new lb(d.getEngine(),i.HighlightsEnhancingEffect,function(){return i._highlightsPostProcess},!0)),i.addEffect(new lb(d.getEngine(),i.LensDepthOfFieldEffect,function(){return i._depthOfFieldPostProcess},!0)),-1===i._highlightsGain&&i._disableEffect(i.HighlightsEnhancingEffect,null),d.postProcessRenderPipelineManager.addPipeline(i),h&&d.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(b,h),i}return v.d(a,e),a.prototype.getClassName=function(){return"LensRenderingPipeline"},Object.defineProperty(a.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"edgeBlur",{get:function(){return this._edgeBlur},set:function(b){this.setEdgeBlur(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"grainAmount",{get:function(){return this._grainAmount},set:function(b){this.setGrainAmount(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"chromaticAberration",{get:function(){return this._chromaticAberration},set:function(b){this.setChromaticAberration(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dofAperture",{get:function(){return this._dofAperture},set:function(b){this.setAperture(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"edgeDistortion",{get:function(){return this._distortion},set:function(b){this.setEdgeDistortion(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dofDistortion",{get:function(){return this._dofDistance},set:function(b){this.setFocusDistance(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"darkenOutOfFocus",{get:function(){return this._dofDarken},set:function(b){this.setDarkenOutOfFocus(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"blurNoise",{get:function(){return this._blurNoise},set:function(b){this._blurNoise=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pentagonBokeh",{get:function(){return this._pentagonBokehIsEnabled},set:function(b){b?this.enablePentagonBokeh():this.disablePentagonBokeh()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"highlightsGain",{get:function(){return this._highlightsGain},set:function(b){this.setHighlightsGain(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"highlightsThreshold",{get:function(){return this._highlightsThreshold},set:function(b){this.setHighlightsThreshold(b)},enumerable:!0,configurable:!0}),a.prototype.setEdgeBlur=function(b){this._edgeBlur=b},a.prototype.disableEdgeBlur=function(){this._edgeBlur=0},a.prototype.setGrainAmount=function(b){this._grainAmount=b},a.prototype.disableGrain=function(){this._grainAmount=0},a.prototype.setChromaticAberration=function(b){this._chromaticAberration=b},a.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},a.prototype.setEdgeDistortion=function(b){this._distortion=b},a.prototype.disableEdgeDistortion=function(){this._distortion=0},a.prototype.setFocusDistance=function(b){this._dofDistance=b},a.prototype.disableDepthOfField=function(){this._dofDistance=-1},a.prototype.setAperture=function(b){this._dofAperture=b},a.prototype.setDarkenOutOfFocus=function(b){this._dofDarken=b},a.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect(`#define PENTAGON
`),this._pentagonBokehIsEnabled=!0},a.prototype.disablePentagonBokeh=function(){this._pentagonBokehIsEnabled=!1,this._highlightsPostProcess.updateEffect()},a.prototype.enableNoiseBlur=function(){this._blurNoise=!0},a.prototype.disableNoiseBlur=function(){this._blurNoise=!1},a.prototype.setHighlightsGain=function(b){this._highlightsGain=b},a.prototype.setHighlightsThreshold=function(b){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=b},a.prototype.disableHighlights=function(){this._highlightsGain=-1},a.prototype.dispose=function(b){void 0===b&&(b=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),b&&this._scene.disableDepthRenderer()},a.prototype._createChromaticAberrationPostProcess=function(b){var c=this;this._chromaticAberrationPostProcess=new Za("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],b,null,ra.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(d){d.setFloat("chromatic_aberration",c._chromaticAberration),d.setFloat("screen_width",c._scene.getEngine().getRenderWidth()),d.setFloat("screen_height",c._scene.getEngine().getRenderHeight()),d.setFloat("radialIntensity",1),d.setFloat2("direction",17,17),d.setFloat2("centerPosition",.5,.5)}},a.prototype._createHighlightsPostProcess=function(b){var c=this;this._highlightsPostProcess=new Za("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],b,null,ra.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?`#define PENTAGON
`:""),this._highlightsPostProcess.onApply=function(d){d.setFloat("gain",c._highlightsGain),d.setFloat("threshold",c._highlightsThreshold),d.setTextureFromPostProcess("textureSampler",c._chromaticAberrationPostProcess),d.setFloat("screen_width",c._scene.getEngine().getRenderWidth()),d.setFloat("screen_height",c._scene.getEngine().getRenderHeight())}},a.prototype._createDepthOfFieldPostProcess=function(b){var c=this;this._depthOfFieldPostProcess=new Za("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],b,null,ra.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(d){d.setTexture("depthSampler",c._depthTexture),d.setTexture("grainSampler",c._grainTexture),d.setTextureFromPostProcess("textureSampler",c._highlightsPostProcess),d.setTextureFromPostProcess("highlightsSampler",c._depthOfFieldPostProcess),d.setFloat("grain_amount",c._grainAmount),d.setBool("blur_noise",c._blurNoise),d.setFloat("screen_width",c._scene.getEngine().getRenderWidth()),d.setFloat("screen_height",c._scene.getEngine().getRenderHeight()),d.setFloat("distortion",c._distortion),d.setBool("dof_enabled",-1!==c._dofDistance),d.setFloat("screen_distance",1/(.1-1/c._dofDistance)),d.setFloat("aperture",c._dofAperture),d.setFloat("darken",c._dofDarken),d.setFloat("edge_blur",c._edgeBlur),d.setBool("highlights",-1!==c._highlightsGain),c._scene.activeCamera&&(d.setFloat("near",c._scene.activeCamera.minZ),d.setFloat("far",c._scene.activeCamera.maxZ))}},a.prototype._createGrainTexture=function(){this._grainTexture=new $c("LensNoiseTexture",512,this._scene,!1,ra.a.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=ra.a.WRAP_ADDRESSMODE,this._grainTexture.wrapV=ra.a.WRAP_ADDRESSMODE;for(var b,c,d,f=this._grainTexture.getContext(),h=0;h<512;h++)for(var i=0;i<512;i++)b=Math.floor(255*(c=.42,d=.58,Math.random()*(d-c)+c)),f.fillStyle="rgb("+b+", "+b+", "+b+")",f.fillRect(h,i,1,1);this._grainTexture.update(!1)},a}(Wc),kl=`
precision highp float;
uniform sampler2D textureSampler;
uniform float near;
uniform float far;
uniform float radius;
float scales[16]=float[16](
0.1,
0.11406250000000001,
0.131640625,
0.15625,
0.187890625,
0.2265625,
0.272265625,
0.325,
0.384765625,
0.4515625,
0.525390625,
0.60625,
0.694140625,
0.7890625,
0.891015625,
1.0
);
varying vec2 vUV;
float perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {
return ( near*far )/( ( far-near )*invClipZ-far );
}
float viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {
return ( near*far/viewZ+far)/( far-near );
}
float viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {
return ( viewZ+near )/( near-far );
}
#ifdef SSAO
uniform sampler2D randomSampler;
uniform sampler2D normalSampler;
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float base;
uniform float xViewport;
uniform float yViewport;
uniform float maxZ;
uniform float minZAspect;
uniform vec2 texelSize;
uniform mat4 projection;
void main()
{
vec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;
float depth=texture2D(textureSampler,vUV).r;
float depthSign=depth/abs(depth);
depth=depth*depthSign;
vec3 normal=texture2D(normalSampler,vUV).rgb;
float occlusion=0.0;
float correctedRadius=min(radius,minZAspect*depth/near);
vec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);
vec3 origin=vViewRay*depth;
vec3 rvec=random*2.0-1.0;
rvec.z=0.0;

float dotProduct=dot(rvec,normal);
rvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);
vec3 tangent=normalize(rvec-normal*dot(rvec,normal));
vec3 bitangent=cross(normal,tangent);
mat3 tbn=mat3(tangent,bitangent,normal);
float difference;
for (int i=0; i<SAMPLES; ++i) {

vec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];
samplePosition=samplePosition*correctedRadius+origin;

vec4 offset=vec4(samplePosition,1.0);
offset=projection*offset;
offset.xyz/=offset.w;
offset.xy=offset.xy*0.5+0.5;
if (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {
continue;
}

float sampleDepth=abs(texture2D(textureSampler,offset.xy).r);

difference=depthSign*samplePosition.z-sampleDepth;
float rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);
occlusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;
}
occlusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor=vec4(vec3(result),1.0);
}
#endif
#ifdef BILATERAL_BLUR
uniform sampler2D depthSampler;
uniform float outSize;
uniform float samplerOffsets[SAMPLES];
vec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.3846153846)*direction;
vec2 off2=vec2(3.2307692308)*direction;
color+=texture2D(image,uv)*0.2270270270;
color+=texture2D(image,uv+(off1/resolution))*0.3162162162;
color+=texture2D(image,uv-(off1/resolution))*0.3162162162;
color+=texture2D(image,uv+(off2/resolution))*0.0702702703;
color+=texture2D(image,uv-(off2/resolution))*0.0702702703;
return color;
}
vec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
color+=texture2D(image,uv)*0.1964825501511404;
color+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;
color+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;
return color;
}
vec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
float compareDepth=abs(texture2D(depthSampler,uv).r);
float sampleDepth;
float weight;
float weightSum=30.0;
color+=texture2D(image,uv)*30.0;
sampleDepth=abs(texture2D(depthSampler,uv+(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv-(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv+(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv-(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv+(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off3/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv-(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off3/resolution))*weight;
return color/weightSum;
}
void main()
{
#if EXPENSIVE
float compareDepth=abs(texture2D(depthSampler,vUV).r);
float texelsize=1.0/outSize;
float result=0.0;
float weightSum=0.0;
for (int i=0; i<SAMPLES; ++i)
{
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
vec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);
#else
vec2 direction=vec2(0.0,1.0);
vec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);
#endif
vec2 samplePos=vUV+sampleOffset;
float sampleDepth=abs(texture2D(depthSampler,samplePos).r);
float weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);
result+=texture2D(textureSampler,samplePos).r*weight;
weightSum+=weight;
}
result/=weightSum;
gl_FragColor.rgb=vec3(result);
gl_FragColor.a=1.0;
#else
vec4 color;
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#else
vec2 direction=vec2(0.0,1.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#endif
gl_FragColor.rgb=vec3(color.r);
gl_FragColor.a=1.0;
#endif
}
#endif
`;Ia.a.ShadersStore.ssao2PixelShader=kl;var ll=`uniform sampler2D textureSampler;
uniform sampler2D originalColor;
uniform vec4 viewport;
varying vec2 vUV;
void main(void) {
vec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);
vec4 sceneColor=texture2D(originalColor,vUV);
gl_FragColor=sceneColor*ssaoColor;
}
`;Ia.a.ShadersStore.ssaoCombinePixelShader=ll;var ci=function(e){function a(b,c,d,f){var h=e.call(this,c.getEngine(),b)||this;if(h.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",h.SSAORenderEffect="SSAORenderEffect",h.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",h.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",h.SSAOCombineRenderEffect="SSAOCombineRenderEffect",h.totalStrength=1,h.maxZ=100,h.minZAspect=.2,h._samples=8,h._textureSamples=1,h._expensiveBlur=!0,h.radius=2,h.base=0,h._firstUpdate=!0,h._bits=new Uint32Array(1),h._scene=c,h._ratio=d,!h.isSupported)return r.a.Error("SSAO 2 needs WebGL 2 support."),h;var i=h._ratio.ssaoRatio||d,k=h._ratio.blurRatio||d,m=c.enableGeometryBufferRenderer();return h._createRandomTexture(),h._depthTexture=m.getGBuffer().textures[0],h._normalTexture=m.getGBuffer().textures[1],h._originalColorPostProcess=new sc("SSAOOriginalSceneColor",1,null,ra.a.BILINEAR_SAMPLINGMODE,c.getEngine(),!1),h._originalColorPostProcess.samples=h.textureSamples,h._createSSAOPostProcess(1),h._createBlurPostProcess(i,k),h._createSSAOCombinePostProcess(k),h.addEffect(new lb(c.getEngine(),h.SSAOOriginalSceneColorEffect,function(){return h._originalColorPostProcess},!0)),h.addEffect(new lb(c.getEngine(),h.SSAORenderEffect,function(){return h._ssaoPostProcess},!0)),h.addEffect(new lb(c.getEngine(),h.SSAOBlurHRenderEffect,function(){return h._blurHPostProcess},!0)),h.addEffect(new lb(c.getEngine(),h.SSAOBlurVRenderEffect,function(){return h._blurVPostProcess},!0)),h.addEffect(new lb(c.getEngine(),h.SSAOCombineRenderEffect,function(){return h._ssaoCombinePostProcess},!0)),c.postProcessRenderPipelineManager.addPipeline(h),f&&c.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(b,f),h}return v.d(a,e),Object.defineProperty(a.prototype,"samples",{get:function(){return this._samples},set:function(b){this._ssaoPostProcess.updateEffect("#define SAMPLES "+b+`
#define SSAO`),this._samples=b,this._sampleSphere=this._generateHemisphere(),this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(b){this._textureSamples=b,this._originalColorPostProcess.samples=b,this._blurHPostProcess.samples=b,this._blurVPostProcess.samples=b,this._ssaoPostProcess.samples=b,this._ssaoCombinePostProcess.samples=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(b){this._blurHPostProcess.updateEffect(`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(b?"1":"0")+`
`,null,["textureSampler","depthSampler"]),this._blurVPostProcess.updateEffect(`#define BILATERAL_BLUR
#define SAMPLES 16
#define EXPENSIVE `+(b?"1":"0")+`
`,null,["textureSampler","depthSampler"]),this._expensiveBlur=b,this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a,"IsSupported",{get:function(){var b=T.a.LastCreatedEngine;return!!b&&b.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"SSAO2RenderingPipeline"},a.prototype.dispose=function(b){void 0===b&&(b=!1);for(var c=0;c<this._scene.cameras.length;c++){var d=this._scene.cameras[c];this._originalColorPostProcess.dispose(d),this._ssaoPostProcess.dispose(d),this._blurHPostProcess.dispose(d),this._blurVPostProcess.dispose(d),this._ssaoCombinePostProcess.dispose(d)}this._randomTexture.dispose(),b&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),e.prototype.dispose.call(this)},a.prototype._createBlurPostProcess=function(b,c){var d=this;this._samplerOffsets=[];for(var f=this.expensiveBlur,h=-8;h<8;h++)this._samplerOffsets.push(2*h+.5);this._blurHPostProcess=new Za("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],b,null,ra.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(f?"1":"0")+`
`),this._blurHPostProcess.onApply=function(i){d._scene.activeCamera&&(i.setFloat("outSize",d._ssaoCombinePostProcess.width>0?d._ssaoCombinePostProcess.width:d._originalColorPostProcess.width),i.setFloat("near",d._scene.activeCamera.minZ),i.setFloat("far",d._scene.activeCamera.maxZ),i.setFloat("radius",d.radius),i.setTexture("depthSampler",d._depthTexture),d._firstUpdate&&i.setArray("samplerOffsets",d._samplerOffsets))},this._blurVPostProcess=new Za("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],c,null,ra.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_V
#define SAMPLES 16
#define EXPENSIVE `+(f?"1":"0")+`
`),this._blurVPostProcess.onApply=function(i){d._scene.activeCamera&&(i.setFloat("outSize",d._ssaoCombinePostProcess.height>0?d._ssaoCombinePostProcess.height:d._originalColorPostProcess.height),i.setFloat("near",d._scene.activeCamera.minZ),i.setFloat("far",d._scene.activeCamera.maxZ),i.setFloat("radius",d.radius),i.setTexture("depthSampler",d._depthTexture),d._firstUpdate&&(i.setArray("samplerOffsets",d._samplerOffsets),d._firstUpdate=!1))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},a.prototype._rebuild=function(){this._firstUpdate=!0,e.prototype._rebuild.call(this)},a.prototype._radicalInverse_VdC=function(b){return this._bits[0]=b,this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0,this._bits[0]=(1431655765&this._bits[0])<<1|(2863311530&this._bits[0])>>>1>>>0,this._bits[0]=(858993459&this._bits[0])<<2|(3435973836&this._bits[0])>>>2>>>0,this._bits[0]=(252645135&this._bits[0])<<4|(4042322160&this._bits[0])>>>4>>>0,this._bits[0]=(16711935&this._bits[0])<<8|(4278255360&this._bits[0])>>>8>>>0,2.3283064365386963e-10*this._bits[0]},a.prototype._hammersley=function(b,c){return[b/c,this._radicalInverse_VdC(b)]},a.prototype._hemisphereSample_uniform=function(b,c){var d=2*c*Math.PI,f=1-(.85*b+.15),h=Math.sqrt(1-f*f);return new j.x(Math.cos(d)*h,Math.sin(d)*h,f)},a.prototype._generateHemisphere=function(){for(var b,c=this.samples,d=[],f=0;f<c;){if(c<16)b=this._hemisphereSample_uniform(Math.random(),Math.random());else{var h=this._hammersley(f,c);b=this._hemisphereSample_uniform(h[0],h[1])}d.push(b.x,b.y,b.z),f++}return d},a.prototype._createSSAOPostProcess=function(b){var c=this,d=this.samples;this._sampleSphere=this._generateHemisphere(),this._ssaoPostProcess=new Za("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],["randomSampler","normalSampler"],b,null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+d+`
#define SSAO`),this._ssaoPostProcess.onApply=function(f){c._firstUpdate&&(f.setArray3("sampleSphere",c._sampleSphere),f.setFloat("randTextureTiles",32)),c._scene.activeCamera&&(f.setFloat("samplesFactor",1/c.samples),f.setFloat("totalStrength",c.totalStrength),f.setFloat2("texelSize",1/c._ssaoPostProcess.width,1/c._ssaoPostProcess.height),f.setFloat("radius",c.radius),f.setFloat("maxZ",c.maxZ),f.setFloat("minZAspect",c.minZAspect),f.setFloat("base",c.base),f.setFloat("near",c._scene.activeCamera.minZ),f.setFloat("far",c._scene.activeCamera.maxZ),f.setFloat("xViewport",Math.tan(c._scene.activeCamera.fov/2)*c._scene.getEngine().getAspectRatio(c._scene.activeCamera,!0)),f.setFloat("yViewport",Math.tan(c._scene.activeCamera.fov/2)),f.setMatrix("projection",c._scene.getProjectionMatrix()),f.setTexture("textureSampler",c._depthTexture),f.setTexture("normalSampler",c._normalTexture),f.setTexture("randomSampler",c._randomTexture))},this._ssaoPostProcess.samples=this.textureSamples},a.prototype._createSSAOCombinePostProcess=function(b){var c=this;this._ssaoCombinePostProcess=new Za("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],b,null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(d){var f=c._scene.activeCamera.viewport;d.setVector4("viewport",j.t.Vector4[0].copyFromFloats(f.x,f.y,f.width,f.height)),d.setTextureFromPostProcess("originalColor",c._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples},a.prototype._createRandomTexture=function(){this._randomTexture=new $c("SSAORandomTexture",128,this._scene,!1,ra.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=ra.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=ra.a.WRAP_ADDRESSMODE;for(var b=this._randomTexture.getContext(),c=function(i,k){return Math.random()*(k-i)+i},d=j.x.Zero(),f=0;f<128;f++)for(var h=0;h<128;h++)d.x=c(0,1),d.y=c(0,1),d.z=0,d.normalize(),d.scaleInPlace(255),d.x=Math.floor(d.x),d.y=Math.floor(d.y),b.fillStyle="rgb("+d.x+", "+d.y+", "+d.z+")",b.fillRect(f,h,1,1);this._randomTexture.update(!1)},a.prototype.serialize=function(){var b=g.a.Serialize(this);return b.customType="SSAO2RenderingPipeline",b},a.Parse=function(b,c,d){return g.a.Parse(function(){return new a(b._name,c,b._ratio)},b,c,d)},v.c([Object(g.c)()],a.prototype,"totalStrength",void 0),v.c([Object(g.c)()],a.prototype,"maxZ",void 0),v.c([Object(g.c)()],a.prototype,"minZAspect",void 0),v.c([Object(g.c)("samples")],a.prototype,"_samples",void 0),v.c([Object(g.c)("textureSamples")],a.prototype,"_textureSamples",void 0),v.c([Object(g.c)()],a.prototype,"_ratio",void 0),v.c([Object(g.c)("expensiveBlur")],a.prototype,"_expensiveBlur",void 0),v.c([Object(g.c)()],a.prototype,"radius",void 0),v.c([Object(g.c)()],a.prototype,"base",void 0),a}(Wc);I.a.RegisteredTypes["BABYLON.SSAO2RenderingPipeline"]=ci;var ml=`
uniform sampler2D textureSampler;
varying vec2 vUV;
#ifdef SSAO
uniform sampler2D randomSampler;
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float radius;
uniform float area;
uniform float fallOff;
uniform float base;
vec3 normalFromDepth(float depth,vec2 coords)
{
vec2 offset1=vec2(0.0,radius);
vec2 offset2=vec2(radius,0.0);
float depth1=texture2D(textureSampler,coords+offset1).r;
float depth2=texture2D(textureSampler,coords+offset2).r;
vec3 p1=vec3(offset1,depth1-depth);
vec3 p2=vec3(offset2,depth2-depth);
vec3 normal=cross(p1,p2);
normal.z=-normal.z;
return normalize(normal);
}
void main()
{
vec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);
float depth=texture2D(textureSampler,vUV).r;
vec3 position=vec3(vUV,depth);
vec3 normal=normalFromDepth(depth,vUV);
float radiusDepth=radius/depth;
float occlusion=0.0;
vec3 ray;
vec3 hemiRay;
float occlusionDepth;
float difference;
for (int i=0; i<SAMPLES; i++)
{
ray=radiusDepth*reflect(sampleSphere[i],random);
hemiRay=position+sign(dot(ray,normal))*ray;
occlusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;
difference=depth-occlusionDepth;
occlusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));
}
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor.r=result;
gl_FragColor.g=result;
gl_FragColor.b=result;
gl_FragColor.a=1.0;
}
#endif
`;Ia.a.ShadersStore.ssaoPixelShader=ml;var nl=function(e){function a(b,c,d,f){var h=e.call(this,c.getEngine(),b)||this;h.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",h.SSAORenderEffect="SSAORenderEffect",h.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",h.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",h.SSAOCombineRenderEffect="SSAOCombineRenderEffect",h.totalStrength=1,h.radius=.0001,h.area=.0075,h.fallOff=1e-06,h.base=.5,h._firstUpdate=!0,h._scene=c,h._createRandomTexture(),h._depthTexture=c.enableDepthRenderer().getDepthMap();var i=d.ssaoRatio||d,k=d.combineRatio||d;return h._originalColorPostProcess=new sc("SSAOOriginalSceneColor",k,null,ra.a.BILINEAR_SAMPLINGMODE,c.getEngine(),!1),h._createSSAOPostProcess(i),h._createBlurPostProcess(i),h._createSSAOCombinePostProcess(k),h.addEffect(new lb(c.getEngine(),h.SSAOOriginalSceneColorEffect,function(){return h._originalColorPostProcess},!0)),h.addEffect(new lb(c.getEngine(),h.SSAORenderEffect,function(){return h._ssaoPostProcess},!0)),h.addEffect(new lb(c.getEngine(),h.SSAOBlurHRenderEffect,function(){return h._blurHPostProcess},!0)),h.addEffect(new lb(c.getEngine(),h.SSAOBlurVRenderEffect,function(){return h._blurVPostProcess},!0)),h.addEffect(new lb(c.getEngine(),h.SSAOCombineRenderEffect,function(){return h._ssaoCombinePostProcess},!0)),c.postProcessRenderPipelineManager.addPipeline(h),f&&c.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(b,f),h}return v.d(a,e),Object.defineProperty(a.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"SSAORenderingPipeline"},a.prototype.dispose=function(b){void 0===b&&(b=!1);for(var c=0;c<this._scene.cameras.length;c++){var d=this._scene.cameras[c];this._originalColorPostProcess.dispose(d),this._ssaoPostProcess.dispose(d),this._blurHPostProcess.dispose(d),this._blurVPostProcess.dispose(d),this._ssaoCombinePostProcess.dispose(d)}this._randomTexture.dispose(),b&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),e.prototype.dispose.call(this)},a.prototype._createBlurPostProcess=function(b){var c=this;this._blurHPostProcess=new Ib("BlurH",new j.w(1,0),16,b,null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o.a.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new Ib("BlurV",new j.w(0,1),16,b,null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o.a.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add(function(){var d=c._blurHPostProcess.width/c._scene.getEngine().getRenderWidth();c._blurHPostProcess.kernel=16*d}),this._blurVPostProcess.onActivateObservable.add(function(){var d=c._blurVPostProcess.height/c._scene.getEngine().getRenderHeight();c._blurVPostProcess.kernel=16*d})},a.prototype._rebuild=function(){this._firstUpdate=!0,e.prototype._rebuild.call(this)},a.prototype._createSSAOPostProcess=function(b){var c=this,d=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new Za("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],b,null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define SAMPLES 16
#define SSAO`),this._ssaoPostProcess.onApply=function(f){c._firstUpdate&&(f.setArray3("sampleSphere",d),f.setFloat("samplesFactor",1/16),f.setFloat("randTextureTiles",4)),f.setFloat("totalStrength",c.totalStrength),f.setFloat("radius",c.radius),f.setFloat("area",c.area),f.setFloat("fallOff",c.fallOff),f.setFloat("base",c.base),f.setTexture("textureSampler",c._depthTexture),f.setTexture("randomSampler",c._randomTexture)}},a.prototype._createSSAOCombinePostProcess=function(b){var c=this;this._ssaoCombinePostProcess=new Za("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],b,null,ra.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(d){d.setVector4("viewport",j.t.Vector4[0].copyFromFloats(0,0,1,1)),d.setTextureFromPostProcess("originalColor",c._originalColorPostProcess)}},a.prototype._createRandomTexture=function(){this._randomTexture=new $c("SSAORandomTexture",512,this._scene,!1,ra.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=ra.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=ra.a.WRAP_ADDRESSMODE;for(var b=this._randomTexture.getContext(),c=function(i,k){return Math.random()*(k-i)+i},d=j.x.Zero(),f=0;f<512;f++)for(var h=0;h<512;h++)d.x=Math.floor(255*c(-1,1)),d.y=Math.floor(255*c(-1,1)),d.z=Math.floor(255*c(-1,1)),b.fillStyle="rgb("+d.x+", "+d.y+", "+d.z+")",b.fillRect(f,h,1,1);this._randomTexture.update(!1)},v.c([Object(g.c)()],a.prototype,"totalStrength",void 0),v.c([Object(g.c)()],a.prototype,"radius",void 0),v.c([Object(g.c)()],a.prototype,"area",void 0),v.c([Object(g.c)()],a.prototype,"fallOff",void 0),v.c([Object(g.c)()],a.prototype,"base",void 0),a}(Wc),ol=`uniform sampler2D textureSampler;
varying vec2 vUV;
#if defined(PASS_POST_PROCESS)
void main(void)
{
vec4 color=texture2D(textureSampler,vUV);
gl_FragColor=color;
}
#endif
#if defined(DOWN_SAMPLE_X4)
uniform vec2 dsOffsets[16];
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+dsOffsets[0]);
average+=texture2D(textureSampler,vUV+dsOffsets[1]);
average+=texture2D(textureSampler,vUV+dsOffsets[2]);
average+=texture2D(textureSampler,vUV+dsOffsets[3]);
average+=texture2D(textureSampler,vUV+dsOffsets[4]);
average+=texture2D(textureSampler,vUV+dsOffsets[5]);
average+=texture2D(textureSampler,vUV+dsOffsets[6]);
average+=texture2D(textureSampler,vUV+dsOffsets[7]);
average+=texture2D(textureSampler,vUV+dsOffsets[8]);
average+=texture2D(textureSampler,vUV+dsOffsets[9]);
average+=texture2D(textureSampler,vUV+dsOffsets[10]);
average+=texture2D(textureSampler,vUV+dsOffsets[11]);
average+=texture2D(textureSampler,vUV+dsOffsets[12]);
average+=texture2D(textureSampler,vUV+dsOffsets[13]);
average+=texture2D(textureSampler,vUV+dsOffsets[14]);
average+=texture2D(textureSampler,vUV+dsOffsets[15]);
average/=16.0;
gl_FragColor=average;
}
#endif
#if defined(BRIGHT_PASS)
uniform vec2 dsOffsets[4];
uniform float brightThreshold;
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));
average*=0.25;
float luminance=length(average.rgb);
if (luminance<brightThreshold) {
average=vec4(0.0,0.0,0.0,1.0);
}
gl_FragColor=average;
}
#endif
#if defined(TEXTURE_ADDER)
uniform sampler2D otherSampler;
uniform sampler2D lensSampler;
uniform float exposure;
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
colour*=exposure;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
colour+=colour*texture2D(lensSampler,vUV).rgb;
vec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);
gl_FragColor=finalColor;
}
#endif
#if defined(VLS)
#define PI 3.1415926535897932384626433832795
uniform mat4 shadowViewProjection;
uniform mat4 lightWorld;
uniform vec3 cameraPosition;
uniform vec3 sunDirection;
uniform vec3 sunColor;
uniform vec2 depthValues;
uniform float scatteringCoefficient;
uniform float scatteringPower;
uniform sampler2D shadowMapSampler;
uniform sampler2D positionSampler;
float computeScattering(float lightDotView)
{
float result=1.0-scatteringCoefficient*scatteringCoefficient;
result/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));
return result;
}
void main(void)
{

vec3 worldPos=texture2D(positionSampler,vUV).rgb;
vec3 startPosition=cameraPosition;
vec3 rayVector=worldPos-startPosition;
float rayLength=length(rayVector);
vec3 rayDirection=rayVector/rayLength;
float stepLength=rayLength/NB_STEPS;
vec3 stepL=rayDirection*stepLength;
vec3 currentPosition=startPosition;
vec3 accumFog=vec3(0.0);
for (int i=0; i<int(NB_STEPS); i++)
{
vec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);
float depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depthMetric,0.0,1.0);
worldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;
worldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);
float shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;
if (shadowMapValue>shadowPixelDepth)
accumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));
currentPosition+=stepL;
}
accumFog/=NB_STEPS;
vec3 color=accumFog*scatteringPower;
gl_FragColor=vec4(color*exp(color) ,1.0);
}
#endif
#if defined(VLSMERGE)
uniform sampler2D originalSampler;
void main(void)
{
gl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);
}
#endif
#if defined(LUMINANCE)
uniform vec2 lumOffsets[4];
void main()
{
float average=0.0;
vec4 color=vec4(0.0);
float maximum=-1e20;
vec3 weight=vec3(0.299,0.587,0.114);
for (int i=0; i<4; i++)
{
color=texture2D(textureSampler,vUV+ lumOffsets[i]);

float GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));

#ifdef WEIGHTED_AVERAGE
float GreyValue=dot(color.rgb,weight);
#endif
#ifdef BRIGHTNESS
float GreyValue=max(color.r,max(color.g,color.b));
#endif
#ifdef HSL_COMPONENT
float GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));
#endif
#ifdef MAGNITUDE
float GreyValue=length(color.rgb);
#endif
maximum=max(maximum,GreyValue);
average+=(0.25*log(1e-5+GreyValue));
}
average=exp(average);
gl_FragColor=vec4(average,maximum,0.0,1.0);
}
#endif
#if defined(LUMINANCE_DOWN_SAMPLE)
uniform vec2 dsOffsets[9];
uniform float halfDestPixelSize;
#ifdef FINAL_DOWN_SAMPLER
vec4 pack(float value) {
const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);
const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);
vec4 res=fract(value*bit_shift);
res-=res.xxyz*bit_mask;
return res;
}
#endif
void main()
{
vec4 color=vec4(0.0);
float average=0.0;
for (int i=0; i<9; i++)
{
color=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);
average+=color.r;
}
average/=9.0;
#ifdef FINAL_DOWN_SAMPLER
gl_FragColor=pack(average);
#else
gl_FragColor=vec4(average,average,0.0,1.0);
#endif
}
#endif
#if defined(HDR)
uniform sampler2D textureAdderSampler;
uniform float averageLuminance;
void main()
{
vec4 color=texture2D(textureAdderSampler,vUV);
#ifndef AUTO_EXPOSURE
vec4 adjustedColor=color/averageLuminance;
color=adjustedColor;
color.a=1.0;
#endif
gl_FragColor=color;
}
#endif
#if defined(LENS_FLARE)
#define GHOSTS 3
uniform sampler2D lensColorSampler;
uniform float strength;
uniform float ghostDispersal;
uniform float haloWidth;
uniform vec2 resolution;
uniform float distortionStrength;
float hash(vec2 p)
{
float h=dot(p,vec2(127.1,311.7));
return -1.0+2.0*fract(sin(h)*43758.5453123);
}
float noise(in vec2 p)
{
vec2 i=floor(p);
vec2 f=fract(p);
vec2 u=f*f*(3.0-2.0*f);
return mix(mix(hash(i+vec2(0.0,0.0)),
hash(i+vec2(1.0,0.0)),u.x),
mix(hash(i+vec2(0.0,1.0)),
hash(i+vec2(1.0,1.0)),u.x),u.y);
}
float fbm(vec2 p)
{
float f=0.0;
f+=0.5000*noise(p); p*=2.02;
f+=0.2500*noise(p); p*=2.03;
f+=0.1250*noise(p); p*=2.01;
f+=0.0625*noise(p); p*=2.04;
f/=0.9375;
return f;
}
vec3 pattern(vec2 uv)
{
vec2 p=-1.0+2.0*uv;
float p2=dot(p,p);
float f=fbm(vec2(15.0*p2))/2.0;
float r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));
float g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));
float b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));
return (1.0-f)*vec3(r,g,b);
}
float luminance(vec3 color)
{
return dot(color.rgb,vec3(0.2126,0.7152,0.0722));
}
vec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)
{
return vec4(
texture2D(tex,texcoord+direction*distortion.r).r,
texture2D(tex,texcoord+direction*distortion.g).g,
texture2D(tex,texcoord+direction*distortion.b).b,
1.0
);
}
void main(void)
{
vec2 uv=-vUV+vec2(1.0);
vec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;
vec2 texelSize=1.0/resolution;
vec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);
vec4 result=vec4(0.0);
float ghostIndice=1.0;
for (int i=0; i<GHOSTS; ++i)
{
vec2 offset=fract(uv+ghostDir*ghostIndice);
float weight=length(vec2(0.5)-offset)/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;
ghostIndice+=1.0;
}
vec2 haloVec=normalize(ghostDir)*haloWidth;
float weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;
result*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));
gl_FragColor=result;
}
#endif
#if defined(LENS_FLARE_COMPOSE)
uniform sampler2D otherSampler;
uniform sampler2D lensDirtSampler;
uniform sampler2D lensStarSampler;
uniform mat4 lensStarMatrix;
void main(void)
{
vec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;
vec4 lensMod=texture2D(lensDirtSampler,vUV);
lensMod+=texture2D(lensStarSampler,vUV);
vec4 result=texture2D(textureSampler,vUV)*lensMod;
gl_FragColor=texture2D(otherSampler,vUV)+result;
}
#endif
#if defined(DEPTH_OF_FIELD)
uniform sampler2D otherSampler;
uniform sampler2D depthSampler;
uniform float distance;
void main(void)
{
vec4 sharp=texture2D(otherSampler,vUV);
vec4 blur=texture2D(textureSampler,vUV);
float dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);
float factor=0.0;
if (dist<0.05)
factor=1.0;
else if (dist<0.1)
factor=20.0*(0.1-dist);
else if (dist<0.5)
factor=0.0;
else
factor=2.0*(dist-0.5);
factor=clamp(factor,0.0,0.90);
gl_FragColor=mix(sharp,blur,factor);
}
#endif
#if defined(MOTION_BLUR)
uniform mat4 inverseViewProjection;
uniform mat4 prevViewProjection;
uniform vec2 screenSize;
uniform float motionScale;
uniform float motionStrength;
uniform sampler2D depthSampler;
void main(void)
{
vec2 texelSize=1.0/screenSize;
float depth=texture2D(depthSampler,vUV).r;
vec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);
cpos=cpos*inverseViewProjection;
vec4 ppos=cpos*prevViewProjection;
ppos.xyz/=ppos.w;
ppos.xy=ppos.xy*0.5+0.5;
vec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;
float speed=length(velocity/texelSize);
int nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {
if (i>=nSamples)
break;
vec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);
result+=texture2D(textureSampler,offset1);
}
gl_FragColor=result/float(nSamples);
}
#endif
`;Ia.a.ShadersStore.standardPixelShader=ol;var di=function(e){function a(b,c,d,f,h){void 0===f&&(f=null);var i=e.call(this,c.getEngine(),b)||this;return i.downSampleX4PostProcess=null,i.brightPassPostProcess=null,i.blurHPostProcesses=[],i.blurVPostProcesses=[],i.textureAdderPostProcess=null,i.volumetricLightPostProcess=null,i.volumetricLightSmoothXPostProcess=null,i.volumetricLightSmoothYPostProcess=null,i.volumetricLightMergePostProces=null,i.volumetricLightFinalPostProcess=null,i.luminancePostProcess=null,i.luminanceDownSamplePostProcesses=[],i.hdrPostProcess=null,i.textureAdderFinalPostProcess=null,i.lensFlareFinalPostProcess=null,i.hdrFinalPostProcess=null,i.lensFlarePostProcess=null,i.lensFlareComposePostProcess=null,i.motionBlurPostProcess=null,i.depthOfFieldPostProcess=null,i.fxaaPostProcess=null,i.brightThreshold=1,i.blurWidth=512,i.horizontalBlur=!1,i.lensTexture=null,i.volumetricLightCoefficient=.2,i.volumetricLightPower=4,i.volumetricLightBlurScale=64,i.sourceLight=null,i.hdrMinimumLuminance=1,i.hdrDecreaseRate=.5,i.hdrIncreaseRate=.5,i.lensColorTexture=null,i.lensFlareStrength=20,i.lensFlareGhostDispersal=1.4,i.lensFlareHaloWidth=.7,i.lensFlareDistortionStrength=16,i.lensStarTexture=null,i.lensFlareDirtTexture=null,i.depthOfFieldDistance=10,i.depthOfFieldBlurWidth=64,i.motionStrength=1,i.animations=[],i._currentDepthOfFieldSource=null,i._fixedExposure=1,i._currentExposure=1,i._hdrAutoExposure=!1,i._hdrCurrentLuminance=1,i._bloomEnabled=!1,i._depthOfFieldEnabled=!1,i._vlsEnabled=!1,i._lensFlareEnabled=!1,i._hdrEnabled=!1,i._motionBlurEnabled=!1,i._fxaaEnabled=!1,i._motionBlurSamples=64,i._volumetricLightStepsCount=50,i._samples=1,i._cameras=h||[],i._scene=c,i._basePostProcess=f,i._ratio=d,i._floatTextureType=c.getEngine().getCaps().textureFloatRender?o.a.TEXTURETYPE_FLOAT:o.a.TEXTURETYPE_HALF_FLOAT,c.postProcessRenderPipelineManager.addPipeline(i),i._buildPipeline(),i}return v.d(a,e),Object.defineProperty(a.prototype,"exposure",{get:function(){return this._fixedExposure},set:function(b){this._fixedExposure=b,this._currentExposure=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hdrAutoExposure",{get:function(){return this._hdrAutoExposure},set:function(b){if(this._hdrAutoExposure=b,this.hdrPostProcess){var c=["#define HDR"];b&&c.push("#define AUTO_EXPOSURE"),this.hdrPostProcess.updateEffect(c.join(`
`))}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(b){this._bloomEnabled!==b&&(this._bloomEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(b){this._depthOfFieldEnabled!==b&&(this._depthOfFieldEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(b){this._lensFlareEnabled!==b&&(this._lensFlareEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(b){this._hdrEnabled!==b&&(this._hdrEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(b){if(this._vlsEnabled!==b){if(b){if(!this._scene.enableGeometryBufferRenderer())return void r.a.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline")}this._vlsEnabled=b,this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(b){this._motionBlurEnabled!==b&&(this._motionBlurEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(b){this._fxaaEnabled!==b&&(this._fxaaEnabled=b,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(b){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect(`#define VLS
#define NB_STEPS `+b.toFixed(1)),this._volumetricLightStepsCount=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(b){this.motionBlurPostProcess&&this.motionBlurPostProcess.updateEffect(`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+b.toFixed(1)),this._motionBlurSamples=b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"samples",{get:function(){return this._samples},set:function(b){this._samples!==b&&(this._samples=b,this._buildPipeline())},enumerable:!0,configurable:!0}),a.prototype._buildPipeline=function(){var b=this,c=this._ratio,d=this._scene;this._disposePostProcesses(),this._reset(),this._basePostProcess?this.originalPostProcess=this._basePostProcess:(this.originalPostProcess=new Za("HDRPass","standard",[],[],c,null,o.a.TEXTURE_BILINEAR_SAMPLINGMODE,d.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.onApply=function(){b._currentDepthOfFieldSource=b.originalPostProcess}),(this._bloomEnabled||this._vlsEnabled||this._lensFlareEnabled||this._depthOfFieldEnabled||this._motionBlurEnabled)&&this.addEffect(new lb(d.getEngine(),"HDRPassPostProcess",function(){return b.originalPostProcess},!0)),this._currentDepthOfFieldSource=this.originalPostProcess,this._bloomEnabled&&(this._createDownSampleX4PostProcess(d,c/2),this._createBrightPassPostProcess(d,c/2),this._createBlurPostProcesses(d,c/4,1),this._createTextureAdderPostProcess(d,c),this.textureAdderFinalPostProcess=new Za("HDRDepthOfFieldSource","standard",[],[],c,null,ra.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,"#define PASS_POST_PROCESS",o.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new lb(d.getEngine(),"HDRBaseDepthOfFieldSource",function(){return b.textureAdderFinalPostProcess},!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(d,c),this.volumetricLightFinalPostProcess=new Za("HDRVLSFinal","standard",[],[],c,null,ra.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,"#define PASS_POST_PROCESS",o.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new lb(d.getEngine(),"HDRVLSFinal",function(){return b.volumetricLightFinalPostProcess},!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(d,c),this.lensFlareFinalPostProcess=new Za("HDRPostLensFlareDepthOfFieldSource","standard",[],[],c,null,ra.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,"#define PASS_POST_PROCESS",o.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new lb(d.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return b.lensFlareFinalPostProcess},!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(d,this._floatTextureType),this._createHdrPostProcess(d,c),this.hdrFinalPostProcess=new Za("HDRPostHDReDepthOfFieldSource","standard",[],[],c,null,ra.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,"#define PASS_POST_PROCESS",o.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new lb(d.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return b.hdrFinalPostProcess},!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(d,c/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(d,c)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(d,c),this._fxaaEnabled&&(this.fxaaPostProcess=new Yd("fxaa",1,null,ra.a.BILINEAR_SAMPLINGMODE,d.getEngine(),!1,o.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new lb(d.getEngine(),"HDRFxaa",function(){return b.fxaaPostProcess},!0))),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&r.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},a.prototype._createDownSampleX4PostProcess=function(b,c){var d=this,f=new Array(32);this.downSampleX4PostProcess=new Za("HDRDownSampleX4","standard",["dsOffsets"],[],c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define DOWN_SAMPLE_X4",o.a.TEXTURETYPE_UNSIGNED_INT),this.downSampleX4PostProcess.onApply=function(h){for(var i=0,k=d.downSampleX4PostProcess.width,m=d.downSampleX4PostProcess.height,B=-2;B<2;B++)for(var E=-2;E<2;E++)f[i]=(B+.5)*(1/k),f[i+1]=(E+.5)*(1/m),i+=2;h.setArray2("dsOffsets",f)},this.addEffect(new lb(b.getEngine(),"HDRDownSampleX4",function(){return d.downSampleX4PostProcess},!0))},a.prototype._createBrightPassPostProcess=function(b,c){var d=this,f=new Array(8);this.brightPassPostProcess=new Za("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define BRIGHT_PASS",o.a.TEXTURETYPE_UNSIGNED_INT),this.brightPassPostProcess.onApply=function(h){var i=1/d.brightPassPostProcess.width,k=1/d.brightPassPostProcess.height;f[0]=-.5*i,f[1]=.5*k,f[2]=.5*i,f[3]=.5*k,f[4]=-.5*i,f[5]=-.5*k,f[6]=.5*i,f[7]=-.5*k,h.setArray2("dsOffsets",f),h.setFloat("brightThreshold",d.brightThreshold)},this.addEffect(new lb(b.getEngine(),"HDRBrightPass",function(){return d.brightPassPostProcess},!0))},a.prototype._createBlurPostProcesses=function(b,c,d,f){var h=this;void 0===f&&(f="blurWidth");var i=b.getEngine(),k=new Ib("HDRBlurH_"+d,new j.w(1,0),this[f],c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,o.a.TEXTURETYPE_UNSIGNED_INT),m=new Ib("HDRBlurV_"+d,new j.w(0,1),this[f],c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,o.a.TEXTURETYPE_UNSIGNED_INT);k.onActivateObservable.add(function(){var B=k.width/i.getRenderWidth();k.kernel=h[f]*B}),m.onActivateObservable.add(function(){var B=m.height/i.getRenderHeight();m.kernel=h.horizontalBlur?64*B:h[f]*B}),this.addEffect(new lb(b.getEngine(),"HDRBlurH"+d,function(){return k},!0)),this.addEffect(new lb(b.getEngine(),"HDRBlurV"+d,function(){return m},!0)),this.blurHPostProcesses.push(k),this.blurVPostProcesses.push(m)},a.prototype._createTextureAdderPostProcess=function(b,c){var d=this;this.textureAdderPostProcess=new Za("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define TEXTURE_ADDER",o.a.TEXTURETYPE_UNSIGNED_INT),this.textureAdderPostProcess.onApply=function(f){f.setTextureFromPostProcess("otherSampler",d._vlsEnabled?d._currentDepthOfFieldSource:d.originalPostProcess),f.setTexture("lensSampler",d.lensTexture),f.setFloat("exposure",d._currentExposure),d._currentDepthOfFieldSource=d.textureAdderFinalPostProcess},this.addEffect(new lb(b.getEngine(),"HDRTextureAdder",function(){return d.textureAdderPostProcess},!0))},a.prototype._createVolumetricLightPostProcess=function(b,c){var d=this,f=b.enableGeometryBufferRenderer();f.enablePosition=!0;var h=f.getGBuffer();this.volumetricLightPostProcess=new Za("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],c/8,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,`#define VLS
#define NB_STEPS `+this._volumetricLightStepsCount.toFixed(1));var i=j.w.Zero();this.volumetricLightPostProcess.onApply=function(k){if(d.sourceLight&&d.sourceLight.getShadowGenerator()&&d._scene.activeCamera){var m=d.sourceLight.getShadowGenerator();k.setTexture("shadowMapSampler",m.getShadowMap()),k.setTexture("positionSampler",h.textures[2]),k.setColor3("sunColor",d.sourceLight.diffuse),k.setVector3("sunDirection",d.sourceLight.getShadowDirection()),k.setVector3("cameraPosition",d._scene.activeCamera.globalPosition),k.setMatrix("shadowViewProjection",m.getTransformMatrix()),k.setFloat("scatteringCoefficient",d.volumetricLightCoefficient),k.setFloat("scatteringPower",d.volumetricLightPower),i.x=d.sourceLight.getDepthMinZ(d._scene.activeCamera),i.y=d.sourceLight.getDepthMaxZ(d._scene.activeCamera),k.setVector2("depthValues",i)}},this.addEffect(new lb(b.getEngine(),"HDRVLS",function(){return d.volumetricLightPostProcess},!0)),this._createBlurPostProcesses(b,c/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new Za("HDRVLSMerge","standard",[],["originalSampler"],c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(k){k.setTextureFromPostProcess("originalSampler",d._bloomEnabled?d.textureAdderFinalPostProcess:d.originalPostProcess),d._currentDepthOfFieldSource=d.volumetricLightFinalPostProcess},this.addEffect(new lb(b.getEngine(),"HDRVLSMerge",function(){return d.volumetricLightMergePostProces},!0))},a.prototype._createLuminancePostProcesses=function(b,c){var d=this,f=Math.pow(3,a.LuminanceSteps);this.luminancePostProcess=new Za("HDRLuminance","standard",["lumOffsets"],[],{width:f,height:f},null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define LUMINANCE",c);var h=[];this.luminancePostProcess.onApply=function(E){var K=1/d.luminancePostProcess.width,P=1/d.luminancePostProcess.height;h[0]=-.5*K,h[1]=.5*P,h[2]=.5*K,h[3]=.5*P,h[4]=-.5*K,h[5]=-.5*P,h[6]=.5*K,h[7]=-.5*P,E.setArray2("lumOffsets",h)},this.addEffect(new lb(b.getEngine(),"HDRLuminance",function(){return d.luminancePostProcess},!0));for(var i=a.LuminanceSteps-1;i>=0;i--){f=Math.pow(3,i);var k=`#define LUMINANCE_DOWN_SAMPLE
`;0===i&&(k+="#define FINAL_DOWN_SAMPLER");var m=new Za("HDRLuminanceDownSample"+i,"standard",["dsOffsets","halfDestPixelSize"],[],{width:f,height:f},null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,k,c);this.luminanceDownSamplePostProcesses.push(m)}var B=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(E,K){var P=new Array(18);E.onApply=function(S){if(B){for(var U=0,_=-1;_<2;_++)for(var da=-1;da<2;da++)P[U]=_/B.width,P[U+1]=da/B.height,U+=2;S.setArray2("dsOffsets",P),S.setFloat("halfDestPixelSize",.5/B.width),B=K===d.luminanceDownSamplePostProcesses.length-1?d.luminancePostProcess:E}},K===d.luminanceDownSamplePostProcesses.length-1&&(E.onAfterRender=function(){var S=b.getEngine().readPixels(0,0,1,1),U=new j.y(1/16581375,1/65025,1/255,1);d._hdrCurrentLuminance=(S[0]*U.x+S[1]*U.y+S[2]*U.z+S[3]*U.w)/100}),d.addEffect(new lb(b.getEngine(),"HDRLuminanceDownSample"+K,function(){return E},!0))})},a.prototype._createHdrPostProcess=function(b,c){var d=this,f=["#define HDR"];this._hdrAutoExposure&&f.push("#define AUTO_EXPOSURE"),this.hdrPostProcess=new Za("HDR","standard",["averageLuminance"],["textureAdderSampler"],c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,f.join(`
`),o.a.TEXTURETYPE_UNSIGNED_INT);var h=1,i=0,k=0;this.hdrPostProcess.onApply=function(m){if(m.setTextureFromPostProcess("textureAdderSampler",d._currentDepthOfFieldSource),i+=b.getEngine().getDeltaTime(),h<0)h=d._hdrCurrentLuminance;else{var B=(k-i)/1000;d._hdrCurrentLuminance<h+d.hdrDecreaseRate*B?h+=d.hdrDecreaseRate*B:d._hdrCurrentLuminance>h-d.hdrIncreaseRate*B?h-=d.hdrIncreaseRate*B:h=d._hdrCurrentLuminance}d.hdrAutoExposure?d._currentExposure=d._fixedExposure/h:(h=p.a.Clamp(h,d.hdrMinimumLuminance,1e20),m.setFloat("averageLuminance",h)),k=i,d._currentDepthOfFieldSource=d.hdrFinalPostProcess},this.addEffect(new lb(b.getEngine(),"HDR",function(){return d.hdrPostProcess},!0))},a.prototype._createLensFlarePostProcess=function(b,c){var d=this;this.lensFlarePostProcess=new Za("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],c/2,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define LENS_FLARE",o.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new lb(b.getEngine(),"HDRLensFlare",function(){return d.lensFlarePostProcess},!0)),this._createBlurPostProcesses(b,c/4,2),this.lensFlareComposePostProcess=new Za("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define LENS_FLARE_COMPOSE",o.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new lb(b.getEngine(),"HDRLensFlareCompose",function(){return d.lensFlareComposePostProcess},!0));var f=new j.w(0,0);this.lensFlarePostProcess.onApply=function(k){k.setTextureFromPostProcess("textureSampler",d._bloomEnabled?d.blurHPostProcesses[0]:d.originalPostProcess),k.setTexture("lensColorSampler",d.lensColorTexture),k.setFloat("strength",d.lensFlareStrength),k.setFloat("ghostDispersal",d.lensFlareGhostDispersal),k.setFloat("haloWidth",d.lensFlareHaloWidth),f.x=d.lensFlarePostProcess.width,f.y=d.lensFlarePostProcess.height,k.setVector2("resolution",f),k.setFloat("distortionStrength",d.lensFlareDistortionStrength)};var h=j.j.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),i=j.j.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(k){if(d._scene.activeCamera){k.setTextureFromPostProcess("otherSampler",d._currentDepthOfFieldSource),k.setTexture("lensDirtSampler",d.lensFlareDirtTexture),k.setTexture("lensStarSampler",d.lensStarTexture);var m=d._scene.activeCamera.getViewMatrix().getRow(0),B=d._scene.activeCamera.getViewMatrix().getRow(2),E=j.x.Dot(m.toVector3(),new j.x(1,0,0))+j.x.Dot(B.toVector3(),new j.x(0,0,1));E*=4;var K=j.j.FromValues(.5*Math.cos(E),-Math.sin(E),0,0,Math.sin(E),.5*Math.cos(E),0,0,0,0,1,0,0,0,0,1),P=i.multiply(K).multiply(h);k.setMatrix("lensStarMatrix",P),d._currentDepthOfFieldSource=d.lensFlareFinalPostProcess}}},a.prototype._createDepthOfFieldPostProcess=function(b,c){var d=this;this.depthOfFieldPostProcess=new Za("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define DEPTH_OF_FIELD",o.a.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(f){f.setTextureFromPostProcess("otherSampler",d._currentDepthOfFieldSource),f.setTexture("depthSampler",d._getDepthTexture()),f.setFloat("distance",d.depthOfFieldDistance)},this.addEffect(new lb(b.getEngine(),"HDRDepthOfField",function(){return d.depthOfFieldPostProcess},!0))},a.prototype._createMotionBlurPostProcess=function(b,c){var d=this;this.motionBlurPostProcess=new Za("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],c,null,ra.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+this.motionBlurSamples.toFixed(1),o.a.TEXTURETYPE_UNSIGNED_INT);var f=0,h=j.j.Identity(),i=j.j.Identity(),k=j.j.Identity(),m=j.w.Zero();this.motionBlurPostProcess.onApply=function(B){(k=b.getProjectionMatrix().multiply(b.getViewMatrix())).invertToRef(i),B.setMatrix("inverseViewProjection",i),B.setMatrix("prevViewProjection",h),h=k,m.x=d.motionBlurPostProcess.width,m.y=d.motionBlurPostProcess.height,B.setVector2("screenSize",m),f=b.getEngine().getFps()/60,B.setFloat("motionScale",f),B.setFloat("motionStrength",d.motionStrength),B.setTexture("depthSampler",d._getDepthTexture())},this.addEffect(new lb(b.getEngine(),"HDRMotionBlur",function(){return d.motionBlurPostProcess},!0))},a.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()},a.prototype._disposePostProcesses=function(){for(var b=0;b<this._cameras.length;b++){var c=this._cameras[b];this.originalPostProcess&&this.originalPostProcess.dispose(c),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(c),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(c),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(c),this.textureAdderFinalPostProcess&&this.textureAdderFinalPostProcess.dispose(c),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(c),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(c),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(c),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(c),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(c),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(c),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(c);for(var d=0;d<this.luminanceDownSamplePostProcesses.length;d++)this.luminanceDownSamplePostProcesses[d].dispose(c);for(this.luminancePostProcess&&this.luminancePostProcess.dispose(c),this.hdrPostProcess&&this.hdrPostProcess.dispose(c),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(c),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(c),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(c),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(c),d=0;d<this.blurHPostProcesses.length;d++)this.blurHPostProcesses[d].dispose(c);for(d=0;d<this.blurVPostProcesses.length;d++)this.blurVPostProcesses[d].dispose(c)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},a.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),e.prototype.dispose.call(this)},a.prototype.serialize=function(){var b=g.a.Serialize(this);return this.sourceLight&&(b.sourceLightId=this.sourceLight.id),b.customType="StandardRenderingPipeline",b},a.Parse=function(b,c,d){var f=g.a.Parse(function(){return new a(b._name,c,b._ratio)},b,c,d);return b.sourceLightId&&(f.sourceLight=c.getLightByID(b.sourceLightId)),f},a.LuminanceSteps=6,v.c([Object(g.c)()],a.prototype,"brightThreshold",void 0),v.c([Object(g.c)()],a.prototype,"blurWidth",void 0),v.c([Object(g.c)()],a.prototype,"horizontalBlur",void 0),v.c([Object(g.c)()],a.prototype,"exposure",null),v.c([Object(g.m)("lensTexture")],a.prototype,"lensTexture",void 0),v.c([Object(g.c)()],a.prototype,"volumetricLightCoefficient",void 0),v.c([Object(g.c)()],a.prototype,"volumetricLightPower",void 0),v.c([Object(g.c)()],a.prototype,"volumetricLightBlurScale",void 0),v.c([Object(g.c)()],a.prototype,"hdrMinimumLuminance",void 0),v.c([Object(g.c)()],a.prototype,"hdrDecreaseRate",void 0),v.c([Object(g.c)()],a.prototype,"hdrIncreaseRate",void 0),v.c([Object(g.c)()],a.prototype,"hdrAutoExposure",null),v.c([Object(g.m)("lensColorTexture")],a.prototype,"lensColorTexture",void 0),v.c([Object(g.c)()],a.prototype,"lensFlareStrength",void 0),v.c([Object(g.c)()],a.prototype,"lensFlareGhostDispersal",void 0),v.c([Object(g.c)()],a.prototype,"lensFlareHaloWidth",void 0),v.c([Object(g.c)()],a.prototype,"lensFlareDistortionStrength",void 0),v.c([Object(g.m)("lensStarTexture")],a.prototype,"lensStarTexture",void 0),v.c([Object(g.m)("lensFlareDirtTexture")],a.prototype,"lensFlareDirtTexture",void 0),v.c([Object(g.c)()],a.prototype,"depthOfFieldDistance",void 0),v.c([Object(g.c)()],a.prototype,"depthOfFieldBlurWidth",void 0),v.c([Object(g.c)()],a.prototype,"motionStrength",void 0),v.c([Object(g.c)()],a.prototype,"_ratio",void 0),v.c([Object(g.c)()],a.prototype,"BloomEnabled",null),v.c([Object(g.c)()],a.prototype,"DepthOfFieldEnabled",null),v.c([Object(g.c)()],a.prototype,"LensFlareEnabled",null),v.c([Object(g.c)()],a.prototype,"HDREnabled",null),v.c([Object(g.c)()],a.prototype,"VLSEnabled",null),v.c([Object(g.c)()],a.prototype,"MotionBlurEnabled",null),v.c([Object(g.c)()],a.prototype,"fxaaEnabled",null),v.c([Object(g.c)()],a.prototype,"volumetricLightStepsCount",null),v.c([Object(g.c)()],a.prototype,"motionBlurSamples",null),v.c([Object(g.c)()],a.prototype,"samples",null),a}(Wc);I.a.RegisteredTypes["BABYLON.StandardRenderingPipeline"]=di;var pl=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform float _ExposureAdjustment;
#if defined(HABLE_TONEMAPPING)
const float A=0.15;
const float B=0.50;
const float C=0.10;
const float D=0.20;
const float E=0.02;
const float F=0.30;
const float W=11.2;
#endif
float Luminance(vec3 c)
{
return dot(c,vec3(0.22,0.707,0.071));
}
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
#if defined(REINHARD_TONEMAPPING)
float lum=Luminance(colour.rgb);
float lumTm=lum*_ExposureAdjustment;
float scale=lumTm/(1.0+lumTm);
colour*=scale/lum;
#elif defined(HABLE_TONEMAPPING)
colour*=_ExposureAdjustment;
const float ExposureBias=2.0;
vec3 x=ExposureBias*colour;
vec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;
x=vec3(W,W,W);
vec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);
colour=curr*whiteScale;
#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)
colour*=_ExposureAdjustment;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
#elif defined(PHOTOGRAPHIC_TONEMAPPING)
colour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);
#endif
gl_FragColor=vec4(colour.rgb,1.0);
}`;Ia.a.ShadersStore.tonemapPixelShader=pl;var Gc;!function(e){e[e.Hable=0]="Hable",e[e.Reinhard=1]="Reinhard",e[e.HejiDawson=2]="HejiDawson",e[e.Photographic=3]="Photographic"}(Gc||(Gc={}));var ql=function(e){function a(b,c,d,f,h,i,k){void 0===h&&(h=o.a.TEXTURE_BILINEAR_SAMPLINGMODE),void 0===k&&(k=o.a.TEXTURETYPE_UNSIGNED_INT);var m=e.call(this,b,"tonemap",["_ExposureAdjustment"],null,1,f,h,i,!0,null,k)||this;m._operator=c,m.exposureAdjustment=d;var B="#define ";return m._operator===Gc.Hable?B+="HABLE_TONEMAPPING":m._operator===Gc.Reinhard?B+="REINHARD_TONEMAPPING":m._operator===Gc.HejiDawson?B+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":m._operator===Gc.Photographic&&(B+="PHOTOGRAPHIC_TONEMAPPING"),m.updateEffect(B),m.onApply=function(E){E.setFloat("_ExposureAdjustment",m.exposureAdjustment)},m}return v.d(a,e),a}(Za),rl=`
attribute vec3 position;
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 viewProjection;
uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
varying float vDepthMetric;
void main(void)
{
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}`;Ia.a.ShadersStore.depthVertexShader=rl;var sl=`uniform sampler2D textureSampler;
uniform sampler2D lightScatteringSampler;
uniform float decay;
uniform float exposure;
uniform float weight;
uniform float density;
uniform vec2 meshPositionOnScreen;
varying vec2 vUV;
void main(void) {
vec2 tc=vUV;
vec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);
deltaTexCoord*=1.0/float(NUM_SAMPLES)*density;
float illuminationDecay=1.0;
vec4 color=texture2D(lightScatteringSampler,tc)*0.4;
for(int i=0; i<NUM_SAMPLES; i++) {
tc-=deltaTexCoord;
vec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;
dataSample*=illuminationDecay*weight;
color+=dataSample;
illuminationDecay*=decay;
}
vec4 realColor=texture2D(textureSampler,vUV);
gl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));
}
`;Ia.a.ShadersStore.volumetricLightScatteringPixelShader=sl;var tl=`#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
#endif
#if defined(ALPHATEST)
uniform sampler2D diffuseSampler;
#endif
void main(void)
{
#if defined(ALPHATEST)
vec4 diffuseColor=texture2D(diffuseSampler,vUV);
if (diffuseColor.a<0.4)
discard;
#endif
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
}
`;Ia.a.ShadersStore.volumetricLightScatteringPassPixelShader=tl;var ul=function(e){function a(b,c,d,f,h,i,k,m,B){void 0===h&&(h=100),void 0===i&&(i=ra.a.BILINEAR_SAMPLINGMODE);var E=e.call(this,b,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],c.postProcessRatio||c,d,i,k,m,"#define NUM_SAMPLES "+h)||this;return E._screenCoordinates=j.w.Zero(),E.customMeshPosition=j.x.Zero(),E.useCustomMeshPosition=!1,E.invert=!0,E.excludedMeshes=new Array(),E.exposure=.3,E.decay=.96815,E.weight=.58767,E.density=.926,k=(B=null===d?B:d.getScene()).getEngine(),E._viewPort=new j.z(0,0,1,1).toGlobal(k.getRenderWidth(),k.getRenderHeight()),E.mesh=null!==f?f:a.CreateDefaultMesh("VolumetricLightScatteringMesh",B),E._createPass(B,c.passRatio||c),E.onActivate=function(K){E.isSupported||E.dispose(K),E.onActivate=null},E.onApplyObservable.add(function(K){E._updateMeshScreenCoordinates(B),K.setTexture("lightScatteringSampler",E._volumetricLightScatteringRTT),K.setFloat("exposure",E.exposure),K.setFloat("decay",E.decay),K.setFloat("weight",E.weight),K.setFloat("density",E.density),K.setVector2("meshPositionOnScreen",E._screenCoordinates)}),E}return v.d(a,e),Object.defineProperty(a.prototype,"useDiffuseColor",{get:function(){return r.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(b){r.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},a.prototype._isReady=function(b,c){var d=b.getMesh();if(d===this.mesh&&d.material)return d.material.isReady(d);var f=[],h=[na.b.PositionKind],i=b.getMaterial();i&&(i.needAlphaTesting()&&f.push("#define ALPHATEST"),d.isVerticesDataPresent(na.b.UVKind)&&(h.push(na.b.UVKind),f.push("#define UV1")),d.isVerticesDataPresent(na.b.UV2Kind)&&(h.push(na.b.UV2Kind),f.push("#define UV2"))),d.useBones&&d.computeBonesUsingShaders?(h.push(na.b.MatricesIndicesKind),h.push(na.b.MatricesWeightsKind),f.push("#define NUM_BONE_INFLUENCERS "+d.numBoneInfluencers),f.push("#define BonesPerMesh "+(d.skeleton?d.skeleton.bones.length+1:0))):f.push("#define NUM_BONE_INFLUENCERS 0"),c&&(f.push("#define INSTANCES"),h.push("world0"),h.push("world1"),h.push("world2"),h.push("world3"));var k=f.join(`
`);return this._cachedDefines!==k&&(this._cachedDefines=k,this._volumetricLightScatteringPass=d.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},h,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],k)),this._volumetricLightScatteringPass.isReady()},a.prototype.setCustomMeshPosition=function(b){this.customMeshPosition=b},a.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},a.prototype.dispose=function(b){var c=b.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==c&&b.getScene().customRenderTargets.splice(c,1),this._volumetricLightScatteringRTT.dispose(),e.prototype.dispose.call(this,b)},a.prototype.getPass=function(){return this._volumetricLightScatteringRTT},a.prototype._meshExcluded=function(b){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(b)},a.prototype._createPass=function(b,c){var d=this,f=b.getEngine();this._volumetricLightScatteringRTT=new Ab("volumetricLightScatteringMap",{width:f.getRenderWidth()*c,height:f.getRenderHeight()*c},b,!1,!0,o.a.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=ra.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=ra.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var h=this.getCamera();h?h.customRenderTargets.push(this._volumetricLightScatteringRTT):b.customRenderTargets.push(this._volumetricLightScatteringRTT);var i,k=function(B){var E=B.getRenderingMesh();if(!d._meshExcluded(E)){var K=B.getMaterial();if(K){var P=E.getScene(),S=P.getEngine();S.setState(K.backFaceCulling);var U=E._getInstancesRenderList(B._id);if(!U.mustReturn){var _=S.getCaps().instancedArrays&&null!==U.visibleInstances[B._id];if(d._isReady(B,_)){var da=d._volumetricLightScatteringPass;if(E===d.mesh&&(da=B.effect?B.effect:K.getEffect()),S.enableEffect(da),E._bind(B,da,rb.a.TriangleFillMode),E===d.mesh)K.bind(E.getWorldMatrix(),E);else{if(d._volumetricLightScatteringPass.setMatrix("viewProjection",P.getTransformMatrix()),K&&K.needAlphaTesting()){var fa=K.getAlphaTestTexture();d._volumetricLightScatteringPass.setTexture("diffuseSampler",fa),fa&&d._volumetricLightScatteringPass.setMatrix("diffuseMatrix",fa.getTextureMatrix())}E.useBones&&E.computeBonesUsingShaders&&E.skeleton&&d._volumetricLightScatteringPass.setMatrices("mBones",E.skeleton.getTransformMatrices(E))}E._processRendering(B,d._volumetricLightScatteringPass,rb.a.TriangleFillMode,U,_,function(ga,ha){return da.setMatrix("world",ha)})}}}}},m=new j.f(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){i=b.clearColor,b.clearColor=m}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){b.clearColor=i}),this._volumetricLightScatteringRTT.customRenderFunction=function(B,E,K,P){var S,U=b.getEngine();if(P.length){for(U.setColorWrite(!1),S=0;S<P.length;S++)k(P.data[S]);U.setColorWrite(!0)}for(S=0;S<B.length;S++)k(B.data[S]);for(S=0;S<E.length;S++)k(E.data[S]);if(K.length){for(S=0;S<K.length;S++){var _=K.data[S],da=_.getBoundingInfo();da&&b.activeCamera&&(_._alphaIndex=_.getMesh().alphaIndex,_._distanceToCamera=da.boundingSphere.centerWorld.subtract(b.activeCamera.position).length())}var fa=K.data.slice(0,K.length);for(fa.sort(function(ga,ha){return ga._alphaIndex>ha._alphaIndex?1:ga._alphaIndex<ha._alphaIndex?-1:ga._distanceToCamera<ha._distanceToCamera?1:ga._distanceToCamera>ha._distanceToCamera?-1:0}),U.setAlphaMode(o.a.ALPHA_COMBINE),S=0;S<fa.length;S++)k(fa[S]);U.setAlphaMode(o.a.ALPHA_DISABLE)}}},a.prototype._updateMeshScreenCoordinates=function(b){var c,d=b.getTransformMatrix();c=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var f=j.x.Project(c,j.j.Identity(),d,this._viewPort);this._screenCoordinates.x=f.x/this._viewPort.width,this._screenCoordinates.y=f.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},a.CreateDefaultMesh=function(b,c){var d=Ca.a.CreatePlane(b,1,c);d.billboardMode=kb.a.BILLBOARDMODE_ALL;var f=new Pb.a(b+"Material",c);return f.emissiveColor=new j.e(1,1,1),d.material=f,d},v.c([Object(g.o)()],a.prototype,"customMeshPosition",void 0),v.c([Object(g.c)()],a.prototype,"useCustomMeshPosition",void 0),v.c([Object(g.c)()],a.prototype,"invert",void 0),v.c([Object(g.k)()],a.prototype,"mesh",void 0),v.c([Object(g.c)()],a.prototype,"excludedMeshes",void 0),v.c([Object(g.c)()],a.prototype,"exposure",void 0),v.c([Object(g.c)()],a.prototype,"decay",void 0),v.c([Object(g.c)()],a.prototype,"weight",void 0),v.c([Object(g.c)()],a.prototype,"density",void 0),a}(Za);l(126),l(127),Object.defineProperty(ja.a.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(e){this._forceShowBoundingBoxes=e,e&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),ja.a.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new ei(this)),this._boundingBoxRenderer},Object.defineProperty(kb.a.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(e){this._showBoundingBox=e,e&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var ei=function(){function e(a){this.name=Pa.a.NAME_BOUNDINGBOXRENDERER,this.frontColor=new j.e(1,1,1),this.backColor=new j.e(.1,.1,.1),this.showBackLines=!0,this.renderList=new ic.a(32),this._vertexBuffers={},this.scene=a,a._addComponent(this)}return e.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(Pa.a.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._activeMeshStage.registerStep(Pa.a.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER,this,this._activeMesh),this.scene._evaluateSubMeshStage.registerStep(Pa.a.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(Pa.a.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)},e.prototype._evaluateSubMesh=function(a,b){if(a.showSubMeshesBoundingBox){var c=b.getBoundingInfo();null!=c&&(c.boundingBox._tag=a.renderingGroupId,this.renderList.push(c.boundingBox))}},e.prototype._activeMesh=function(a,b){if(a.showBoundingBox||this.scene.forceShowBoundingBoxes){var c=a.getBoundingInfo();c.boundingBox._tag=b.renderingGroupId,this.renderList.push(c.boundingBox)}},e.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new kf.a("colorShader",this.scene,"color",{attributes:[na.b.PositionKind],uniforms:["world","viewProjection","color"]});var a=this.scene.getEngine(),b=Wa.a.CreateBox({size:1});this._vertexBuffers[na.b.PositionKind]=new na.b(a,b.positions,na.b.PositionKind,!1),this._createIndexBuffer()}},e.prototype._createIndexBuffer=function(){var a=this.scene.getEngine();this._indexBuffer=a.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},e.prototype.rebuild=function(){var a=this._vertexBuffers[na.b.PositionKind];a&&a._rebuild(),this._createIndexBuffer()},e.prototype.reset=function(){this.renderList.reset()},e.prototype.render=function(a){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var b=this.scene.getEngine();b.setDepthWrite(!1),this._colorShader._preBind();for(var c=0;c<this.renderList.length;c++){var d=this.renderList.data[c];if(d._tag===a){var f=d.minimum,h=d.maximum.subtract(f),i=f.add(h.scale(.5)),k=j.j.Scaling(h.x,h.y,h.z).multiply(j.j.Translation(i.x,i.y,i.z)).multiply(d.getWorldMatrix());b.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(b.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(k),b.drawElementsType(rb.a.LineListDrawMode,0,24)),b.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(k),b.drawElementsType(rb.a.LineListDrawMode,0,24)}}this._colorShader.unbind(),b.setDepthFunctionToLessOrEqual(),b.setDepthWrite(!0)}},e.prototype.renderOcclusionBoundingBox=function(a){if(this._prepareRessources(),this._colorShader.isReady()&&a._boundingInfo){var b=this.scene.getEngine();b.setDepthWrite(!1),b.setColorWrite(!1),this._colorShader._preBind();var c=a._boundingInfo.boundingBox,d=c.minimum,f=c.maximum.subtract(d),h=d.add(f.scale(.5)),i=j.j.Scaling(f.x,f.y,f.z).multiply(j.j.Translation(h.x,h.y,h.z)).multiply(c.getWorldMatrix());b.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),b.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.bind(i),b.drawElementsType(rb.a.LineListDrawMode,0,24),this._colorShader.unbind(),b.setDepthFunctionToLessOrEqual(),b.setDepthWrite(!0),b.setColorWrite(!0)}},e.prototype.dispose=function(){if(this._colorShader){this.renderList.dispose(),this._colorShader.dispose();var a=this._vertexBuffers[na.b.PositionKind];a&&(a.dispose(),this._vertexBuffers[na.b.PositionKind]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer)}},e}(),vl=`#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
varying float vDepthMetric;
void main(void)
{
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
gl_FragColor=vec4(vDepthMetric,vDepthMetric*vDepthMetric,0.0,1.0);
}`;Ia.a.ShadersStore.depthPixelShader=vl;var Hf=function(){function e(a,b,c){var d=this;void 0===b&&(b=o.a.TEXTURETYPE_FLOAT),void 0===c&&(c=null),this.useOnlyInActiveCamera=!1,this._scene=a,e._SceneComponentInitialization(this._scene),this._camera=c;var f=a.getEngine();this._depthMap=new Ab("depthMap",{width:f.getRenderWidth(),height:f.getRenderHeight()},this._scene,!1,!0,b),this._depthMap.wrapU=ra.a.CLAMP_ADDRESSMODE,this._depthMap.wrapV=ra.a.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add(function(i){i.clear(new j.f(1,1,1,1),!0,!0,!0)});var h=function(i){var k=i.getRenderingMesh(),m=d._scene,B=m.getEngine(),E=i.getMaterial();if(E){B.setState(E.backFaceCulling,0,!1,m.useRightHandedSystem);var K=k._getInstancesRenderList(i._id);if(!K.mustReturn){var P=B.getCaps().instancedArrays&&null!==K.visibleInstances[i._id],S=d._camera||m.activeCamera;if(d.isReady(i,P)&&S){if(B.enableEffect(d._effect),k._bind(i,d._effect,rb.a.TriangleFillMode),d._effect.setMatrix("viewProjection",m.getTransformMatrix()),d._effect.setFloat2("depthValues",S.minZ,S.minZ+S.maxZ),E&&E.needAlphaTesting()){var U=E.getAlphaTestTexture();U&&(d._effect.setTexture("diffuseSampler",U),d._effect.setMatrix("diffuseMatrix",U.getTextureMatrix()))}k.useBones&&k.computeBonesUsingShaders&&k.skeleton&&d._effect.setMatrices("mBones",k.skeleton.getTransformMatrices(k)),k._processRendering(i,d._effect,rb.a.TriangleFillMode,K,P,function(_,da){return d._effect.setMatrix("world",da)})}}}};this._depthMap.customRenderFunction=function(i,k,m,B){var E;if(B.length){for(f.setColorWrite(!1),E=0;E<B.length;E++)h(B.data[E]);f.setColorWrite(!0)}for(E=0;E<i.length;E++)h(i.data[E]);for(E=0;E<k.length;E++)h(k.data[E])}}return e.prototype.isReady=function(a,b){var c=a.getMaterial();if(c.disableDepthWrite)return!1;var d=[],f=[na.b.PositionKind],h=a.getMesh();c&&c.needAlphaTesting()&&c.getAlphaTestTexture()&&(d.push("#define ALPHATEST"),h.isVerticesDataPresent(na.b.UVKind)&&(f.push(na.b.UVKind),d.push("#define UV1")),h.isVerticesDataPresent(na.b.UV2Kind)&&(f.push(na.b.UV2Kind),d.push("#define UV2"))),h.useBones&&h.computeBonesUsingShaders?(f.push(na.b.MatricesIndicesKind),f.push(na.b.MatricesWeightsKind),h.numBoneInfluencers>4&&(f.push(na.b.MatricesIndicesExtraKind),f.push(na.b.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+h.numBoneInfluencers),d.push("#define BonesPerMesh "+(h.skeleton?h.skeleton.bones.length+1:0))):d.push("#define NUM_BONE_INFLUENCERS 0"),b&&(d.push("#define INSTANCES"),f.push("world0"),f.push("world1"),f.push("world2"),f.push("world3"));var i=d.join(`
`);return this._cachedDefines!==i&&(this._cachedDefines=i,this._effect=this._scene.getEngine().createEffect("depth",f,["world","mBones","viewProjection","diffuseMatrix","depthValues"],["diffuseSampler"],i)),this._effect.isReady()},e.prototype.getDepthMap=function(){return this._depthMap},e.prototype.dispose=function(){this._depthMap.dispose()},e._SceneComponentInitialization=function(a){throw Zb.a.WarnImport("DepthRendererSceneComponent")},e}();ja.a.prototype.enableDepthRenderer=function(e){if(!(e=e||this.activeCamera))throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[e.id]){var a=0;if(this.getEngine().getCaps().textureHalfFloatRender)a=o.a.TEXTURETYPE_HALF_FLOAT;else{if(!this.getEngine().getCaps().textureFloatRender)throw"Depth renderer does not support int texture type";a=o.a.TEXTURETYPE_FLOAT}this._depthRenderer[e.id]=new Hf(this,a,e)}return this._depthRenderer[e.id]},ja.a.prototype.disableDepthRenderer=function(e){(e=e||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[e.id]&&(this._depthRenderer[e.id].dispose(),delete this._depthRenderer[e.id])};var fi=function(){function e(a){this.name=Pa.a.NAME_DEPTHRENDERER,this.scene=a}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Pa.a.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(Pa.a.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){for(var a in this.scene._depthRenderer)this.scene._depthRenderer[a].dispose()},e.prototype._gatherRenderTargets=function(a){if(this.scene._depthRenderer)for(var b in this.scene._depthRenderer){var c=this.scene._depthRenderer[b];c.useOnlyInActiveCamera||a.push(c.getDepthMap())}},e.prototype._gatherActiveCameraRenderTargets=function(a){if(this.scene._depthRenderer)for(var b in this.scene._depthRenderer){var c=this.scene._depthRenderer[b];c.useOnlyInActiveCamera&&this.scene.activeCamera.id===b&&a.push(c.getDepthMap())}},e}();Hf._SceneComponentInitialization=function(e){var a=e._getComponent(Pa.a.NAME_DEPTHRENDERER);a||(a=new fi(e),e._addComponent(a))};var wl=`uniform vec4 color;
void main(void) {
gl_FragColor=color;
}`;Ia.a.ShadersStore.linePixelShader=wl;var xl=`
attribute vec3 position;
attribute vec4 normal;

uniform mat4 worldViewProjection;
uniform float width;
uniform float aspectRatio;
void main(void) {
vec4 viewPosition=worldViewProjection*vec4(position,1.0);
vec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);
vec2 currentScreen=viewPosition.xy/viewPosition.w;
vec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;
currentScreen.x*=aspectRatio;
nextScreen.x*=aspectRatio;
vec2 dir=normalize(nextScreen-currentScreen);
vec2 normalDir=vec2(-dir.y,dir.x);
normalDir*=width/2.0;
normalDir.x/=aspectRatio;
vec4 offset=vec4(normalDir*normal.w,0.0,0.0);
gl_Position=viewPosition+offset;
}`;Ia.a.ShadersStore.lineVertexShader=xl,kb.a.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},kb.a.prototype.enableEdgesRendering=function(e,a){return void 0===e&&(e=.95),void 0===a&&(a=!1),this.disableEdgesRendering(),this._edgesRenderer=new If(this,e,a),this},Object.defineProperty(kb.a.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),md.b.prototype.enableEdgesRendering=function(e,a){return void 0===e&&(e=.95),void 0===a&&(a=!1),this.disableEdgesRendering(),this._edgesRenderer=new gi(this,e,a),this},md.a.prototype.enableEdgesRendering=function(e,a){return void 0===e&&(e=.95),void 0===a&&(a=!1),md.b.prototype.enableEdgesRendering.apply(this,arguments),this};var yl=function(){return function(){this.edges=new Array(),this.edgesConnectedCount=0}}(),If=function(){function e(a,b,c,d){var f=this;void 0===b&&(b=.95),void 0===c&&(c=!1),void 0===d&&(d=!0),this.edgesWidthScalerForOrthographic=1000,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array(),this._linesNormals=new Array(),this._linesIndices=new Array(),this._buffers={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this._source=a,this._checkVerticesInsteadOfIndices=c,this._epsilon=b,this._prepareRessources(),d&&this._generateEdgesLines(),this._meshRebuildObserver=this._source.onRebuildObservable.add(function(){f._rebuild()}),this._meshDisposeObserver=this._source.onDisposeObservable.add(function(){f.dispose()})}return e.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new kf.a("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},e.prototype._rebuild=function(){var a=this._buffers[na.b.PositionKind];a&&a._rebuild(),(a=this._buffers[na.b.NormalKind])&&a._rebuild();var b=this._source.getScene().getEngine();this._ib=b.createIndexBuffer(this._linesIndices)},e.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);var a=this._buffers[na.b.PositionKind];a&&(a.dispose(),this._buffers[na.b.PositionKind]=null),(a=this._buffers[na.b.NormalKind])&&(a.dispose(),this._buffers[na.b.NormalKind]=null),this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},e.prototype._processEdgeForAdjacencies=function(a,b,c,d,f){return a===c&&b===d||a===d&&b===c?0:a===d&&b===f||a===f&&b===d?1:a===f&&b===c||a===c&&b===f?2:-1},e.prototype._processEdgeForAdjacenciesWithVertices=function(a,b,c,d,f){return a.equalsWithEpsilon(c)&&b.equalsWithEpsilon(d)||a.equalsWithEpsilon(d)&&b.equalsWithEpsilon(c)?0:a.equalsWithEpsilon(d)&&b.equalsWithEpsilon(f)||a.equalsWithEpsilon(f)&&b.equalsWithEpsilon(d)?1:a.equalsWithEpsilon(f)&&b.equalsWithEpsilon(c)||a.equalsWithEpsilon(c)&&b.equalsWithEpsilon(f)?2:-1},e.prototype._checkEdge=function(a,b,c,d,f){var h;void 0===b?h=!0:h=j.x.Dot(c[a],c[b])<this._epsilon,h&&this.createLine(d,f,this._linesPositions.length/3)},e.prototype.createLine=function(a,b,c){this._linesPositions.push(a.x,a.y,a.z,a.x,a.y,a.z,b.x,b.y,b.z,b.x,b.y,b.z),this._linesNormals.push(b.x,b.y,b.z,-1,b.x,b.y,b.z,1,a.x,a.y,a.z,-1,a.x,a.y,a.z,1),this._linesIndices.push(c,c+1,c+2,c,c+2,c+3)},e.prototype._generateEdgesLines=function(){var a=this._source.getVerticesData(na.b.PositionKind),b=this._source.getIndices();if(b&&a){var c,d,f=new Array(),h=new Array();for(c=0;c<b.length;c+=3){d=new yl();var i=b[c],k=b[c+1],m=b[c+2];d.p0=new j.x(a[3*i],a[3*i+1],a[3*i+2]),d.p1=new j.x(a[3*k],a[3*k+1],a[3*k+2]),d.p2=new j.x(a[3*m],a[3*m+1],a[3*m+2]);var B=j.x.Cross(d.p1.subtract(d.p0),d.p2.subtract(d.p1));B.normalize(),h.push(B),f.push(d)}for(c=0;c<f.length;c++){d=f[c];for(var E=c+1;E<f.length;E++){var K=f[E];if(3===d.edgesConnectedCount)break;if(3!==K.edgesConnectedCount)for(var P=b[3*E],S=b[3*E+1],U=b[3*E+2],_=0;_<3;_++){var da=0;if(void 0===d.edges[_]){switch(_){case 0:da=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p0,d.p1,K.p0,K.p1,K.p2):this._processEdgeForAdjacencies(b[3*c],b[3*c+1],P,S,U);break;case 1:da=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p1,d.p2,K.p0,K.p1,K.p2):this._processEdgeForAdjacencies(b[3*c+1],b[3*c+2],P,S,U);break;case 2:da=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p2,d.p0,K.p0,K.p1,K.p2):this._processEdgeForAdjacencies(b[3*c+2],b[3*c],P,S,U)}if(-1!==da&&(d.edges[_]=E,K.edges[da]=c,d.edgesConnectedCount++,K.edgesConnectedCount++,3===d.edgesConnectedCount))break}}}}for(c=0;c<f.length;c++){var fa=f[c];this._checkEdge(c,fa.edges[0],h,fa.p0,fa.p1),this._checkEdge(c,fa.edges[1],h,fa.p1,fa.p2),this._checkEdge(c,fa.edges[2],h,fa.p2,fa.p0)}var ga=this._source.getScene().getEngine();this._buffers[na.b.PositionKind]=new na.b(ga,this._linesPositions,na.b.PositionKind,!1),this._buffers[na.b.NormalKind]=new na.b(ga,this._linesNormals,na.b.NormalKind,!1,!1,4),this._ib=ga.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},e.prototype.isReady=function(){return this._lineShader.isReady()},e.prototype.render=function(){var a=this._source.getScene();if(this.isReady()&&a.activeCamera){var b=a.getEngine();this._lineShader._preBind(),1!==this._source.edgesColor.a?b.setAlphaMode(o.a.ALPHA_COMBINE):b.setAlphaMode(o.a.ALPHA_DISABLE),b.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),a.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),a.activeCamera.mode===ab.a.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",b.getAspectRatio(a.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),b.drawElementsType(rb.a.TriangleFillMode,0,this._indicesCount),this._lineShader.unbind()}},e}(),gi=function(e){function a(b,c,d){void 0===c&&(c=.95),void 0===d&&(d=!1);var f=e.call(this,b,c,d,!1)||this;return f._generateEdgesLines(),f}return v.d(a,e),a.prototype._generateEdgesLines=function(){var b=this._source.getVerticesData(na.b.PositionKind),c=this._source.getIndices();if(c&&b){for(var d=j.t.Vector3[0],f=j.t.Vector3[1],h=c.length-1,i=0,k=0;i<h;i+=2,k+=4)j.x.FromArrayToRef(b,3*c[i],d),j.x.FromArrayToRef(b,3*c[i+1],f),this.createLine(d,f,k);var m=this._source.getScene().getEngine();this._buffers[na.b.PositionKind]=new na.b(m,this._linesPositions,na.b.PositionKind,!1),this._buffers[na.b.NormalKind]=new na.b(m,this._linesNormals,na.b.NormalKind,!1,!1,4),this._ib=m.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},a}(If),zl=`#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
uniform vec4 color;
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#include<logDepthDeclaration>
void main(void) {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#include<logDepthFragment>
gl_FragColor=color;
}`;Ia.a.ShadersStore.outlinePixelShader=zl;var Al=`
attribute vec3 position;
attribute vec3 normal;
#include<bonesDeclaration>

uniform float offset;
#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#include<logDepthDeclaration>
void main(void)
{
vec3 offsetPosition=position+normal*offset;
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<logDepthVertex>
}
`;Ia.a.ShadersStore.outlineVertexShader=Al,ja.a.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new hi(this)),this._outlineRenderer},Object.defineProperty(kb.a.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOutline=e},enumerable:!0,configurable:!0}),Object.defineProperty(kb.a.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOverlay=e},enumerable:!0,configurable:!0});var hi=function(){function e(a){this.name=Pa.a.NAME_OUTLINERENDERER,this.zOffset=1,this.scene=a,this._engine=a.getEngine(),this.scene._addComponent(this)}return e.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(Pa.a.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(Pa.a.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype.render=function(a,b,c){var d=this;void 0===c&&(c=!1);var f=this.scene,h=f.getEngine(),i=h.getCaps().instancedArrays&&null!==b.visibleInstances[a._id]&&void 0!==b.visibleInstances[a._id];if(this.isReady(a,i)){var k=a.getRenderingMesh(),m=a.getMaterial();if(m&&f.activeCamera){if(h.enableEffect(this._effect),m.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(f.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",c?0:k.outlineWidth),this._effect.setColor4("color",c?k.overlayColor:k.outlineColor,c?k.overlayAlpha:m.alpha),this._effect.setMatrix("viewProjection",f.getTransformMatrix()),k.useBones&&k.computeBonesUsingShaders&&k.skeleton&&this._effect.setMatrices("mBones",k.skeleton.getTransformMatrices(k)),k._bind(a,this._effect,rb.a.TriangleFillMode),m&&m.needAlphaTesting()){var B=m.getAlphaTestTexture();B&&(this._effect.setTexture("diffuseSampler",B),this._effect.setMatrix("diffuseMatrix",B.getTextureMatrix()))}h.setZOffset(-this.zOffset),k._processRendering(a,this._effect,rb.a.TriangleFillMode,b,i,function(E,K){d._effect.setMatrix("world",K)}),h.setZOffset(0)}}},e.prototype.isReady=function(a,b){var c=[],d=[na.b.PositionKind,na.b.NormalKind],f=a.getMesh(),h=a.getMaterial();h&&(h.needAlphaTesting()&&(c.push("#define ALPHATEST"),f.isVerticesDataPresent(na.b.UVKind)&&(d.push(na.b.UVKind),c.push("#define UV1")),f.isVerticesDataPresent(na.b.UV2Kind)&&(d.push(na.b.UV2Kind),c.push("#define UV2"))),h.useLogarithmicDepth&&c.push("#define LOGARITHMICDEPTH")),f.useBones&&f.computeBonesUsingShaders?(d.push(na.b.MatricesIndicesKind),d.push(na.b.MatricesWeightsKind),f.numBoneInfluencers>4&&(d.push(na.b.MatricesIndicesExtraKind),d.push(na.b.MatricesWeightsExtraKind)),c.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),c.push("#define BonesPerMesh "+(f.skeleton?f.skeleton.bones.length+1:0))):c.push("#define NUM_BONE_INFLUENCERS 0"),b&&(c.push("#define INSTANCES"),d.push("world0"),d.push("world1"),d.push("world2"),d.push("world3"));var i=c.join(`
`);return this._cachedDefines!==i&&(this._cachedDefines=i,this._effect=this.scene.getEngine().createEffect("outline",d,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant"],["diffuseSampler"],i)),this._effect.isReady()},e.prototype._beforeRenderingMesh=function(a,b,c){if(this._savedDepthWrite=this._engine.getDepthWrite(),a.renderOutline){var d=b.getMaterial();d&&d.needAlphaBlending&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(o.a.REPLACE),this._engine.setStencilFunction(o.a.ALWAYS),this._engine.setStencilMask(e._StencilReference),this._engine.setStencilFunctionReference(e._StencilReference),this.render(b,c,!0),this._engine.setColorWrite(!0),this._engine.setStencilFunction(o.a.NOTEQUAL)),this._engine.setDepthWrite(!1),this.render(b,c),this._engine.setDepthWrite(this._savedDepthWrite),d&&d.needAlphaBlending&&this._engine.restoreStencilState()}},e.prototype._afterRenderingMesh=function(a,b,c){if(a.renderOverlay){var d=this._engine.getAlphaMode();this._engine.setAlphaMode(o.a.ALPHA_COMBINE),this.render(b,c,!0),this._engine.setAlphaMode(d)}a.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(b,c),this._engine.setColorWrite(!0))},e._StencilReference=4,e}(),Bl=l(109),Cl=function(){function e(a,b){this.name=a,this.color=new j.f(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array(),this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this.isVisible=!0,this._manager=b,this._manager.sprites.push(this),this.position=j.x.Zero()}return Object.defineProperty(e.prototype,"size",{get:function(){return this.width},set:function(a){this.width=a,this.height=a},enumerable:!0,configurable:!0}),e.prototype.playAnimation=function(a,b,c,d,f){this._fromIndex=a,this._toIndex=b,this._loopAnimation=c,this._delay=d,this._animationStarted=!0,a<b?this._direction=1:(this._direction=-1,this._toIndex=a,this._fromIndex=b),this.cellIndex=a,this._time=0,this._onAnimationEnd=f},e.prototype.stopAnimation=function(){this._animationStarted=!1},e.prototype._animate=function(a){this._animationStarted&&(this._time+=a,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()))))},e.prototype.dispose=function(){for(var a=0;a<this._manager.sprites.length;a++)this._manager.sprites[a]==this&&this._manager.sprites.splice(a,1)},e}();ja.a.prototype._internalPickSprites=function(e,a,b,c){if(!Hd.a)return null;var d=null;if(!c){if(!this.activeCamera)return null;c=this.activeCamera}if(this.spriteManagers.length>0)for(var f=0;f<this.spriteManagers.length;f++){var h=this.spriteManagers[f];if(h.isPickable){var i=h.intersects(e,c,a,b);if(i&&i.hit&&(b||null==d||!(i.distance>=d.distance))&&(d=i,b))break}}return d||new Hd.a()},ja.a.prototype.pickSprite=function(e,a,b,c,d){return this.createPickingRayInCameraSpaceToRef(e,a,this._tempSpritePickingRay,d),this._internalPickSprites(this._tempSpritePickingRay,b,c,d)},ja.a.prototype.pickSpriteWithRay=function(e,a,b,c){if(!this._tempSpritePickingRay)return null;if(!c){if(!this.activeCamera)return null;c=this.activeCamera}return Nb.a.TransformToRef(e,c.getViewMatrix(),this._tempSpritePickingRay),this._internalPickSprites(this._tempSpritePickingRay,a,b,c)},ja.a.prototype.setPointerOverSprite=function(e){this._pointerOverSprite!==e&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(o.a.ACTION_OnPointerOutTrigger,A.a.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=e,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(o.a.ACTION_OnPointerOverTrigger,A.a.CreateNewFromSprite(this._pointerOverSprite,this)))},ja.a.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var ii=function(){function e(a){this.name=Pa.a.NAME_SPRITE,this.scene=a,this.scene.spriteManagers=new Array(),this.scene._tempSpritePickingRay=Nb.a?Nb.a.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new q.c(),this.scene.onAfterSpritesRenderingObservable=new q.c(),this._spritePredicate=function(b){return!!b.actionManager&&(b.isPickable&&b.actionManager.hasPointerTriggers)}}return e.prototype.register=function(){this.scene._pointerMoveStage.registerStep(Pa.a.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(Pa.a.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(Pa.a.STEP_POINTERUP_SPRITE,this,this._pointerUp)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();for(var a=this.scene.spriteManagers;a.length;)a[0].dispose()},e.prototype._pickSpriteButKeepRay=function(a,b,c,d,f){var h=this.scene.pickSprite(b,c,this._spritePredicate,d,f);return h&&(h.ray=a?a.ray:null),h},e.prototype._pointerMove=function(a,b,c,d,f){var h=this.scene;return d?h.setPointerOverSprite(null):(c=this._pickSpriteButKeepRay(c,a,b,!1,h.cameraToUseForPointers||void 0))&&c.hit&&c.pickedSprite?(h.setPointerOverSprite(c.pickedSprite),h._pointerOverSprite&&h._pointerOverSprite.actionManager&&h._pointerOverSprite.actionManager.hoverCursor?f.style.cursor=h._pointerOverSprite.actionManager.hoverCursor:f.style.cursor=h.hoverCursor):h.setPointerOverSprite(null),c},e.prototype._pointerDown=function(a,b,c,d){var f=this.scene;if(f._pickedDownSprite=null,f.spriteManagers.length>0&&(c=f.pickSprite(a,b,this._spritePredicate,!1,f.cameraToUseForPointers||void 0))&&c.hit&&c.pickedSprite&&c.pickedSprite.actionManager){switch(f._pickedDownSprite=c.pickedSprite,d.button){case 0:c.pickedSprite.actionManager.processTrigger(o.a.ACTION_OnLeftPickTrigger,A.a.CreateNewFromSprite(c.pickedSprite,f,d));break;case 1:c.pickedSprite.actionManager.processTrigger(o.a.ACTION_OnCenterPickTrigger,A.a.CreateNewFromSprite(c.pickedSprite,f,d));break;case 2:c.pickedSprite.actionManager.processTrigger(o.a.ACTION_OnRightPickTrigger,A.a.CreateNewFromSprite(c.pickedSprite,f,d))}c.pickedSprite.actionManager&&c.pickedSprite.actionManager.processTrigger(o.a.ACTION_OnPickDownTrigger,A.a.CreateNewFromSprite(c.pickedSprite,f,d))}return c},e.prototype._pointerUp=function(a,b,c,d){var f=this.scene;if(f.spriteManagers.length>0){var h=f.pickSprite(a,b,this._spritePredicate,!1,f.cameraToUseForPointers||void 0);h&&(h.hit&&h.pickedSprite&&h.pickedSprite.actionManager&&(h.pickedSprite.actionManager.processTrigger(o.a.ACTION_OnPickUpTrigger,A.a.CreateNewFromSprite(h.pickedSprite,f,d)),h.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||h.pickedSprite.actionManager.processTrigger(o.a.ACTION_OnPickTrigger,A.a.CreateNewFromSprite(h.pickedSprite,f,d)))),f._pickedDownSprite&&f._pickedDownSprite.actionManager&&f._pickedDownSprite!==h.pickedSprite&&f._pickedDownSprite.actionManager.processTrigger(o.a.ACTION_OnPickOutTrigger,A.a.CreateNewFromSprite(f._pickedDownSprite,f,d)))}return c},e}(),Dl=`uniform bool alphaTest;
varying vec4 vColor;

varying vec2 vUV;
uniform sampler2D diffuseSampler;

#include<fogFragmentDeclaration>
void main(void) {
vec4 color=texture2D(diffuseSampler,vUV);
if (alphaTest)
{
if (color.a<0.95)
discard;
}
color*=vColor;
#include<fogFragment>
gl_FragColor=color;
}`;Ia.a.ShadersStore.spritesPixelShader=Dl;var El=`
attribute vec4 position;
attribute vec4 options;
attribute vec4 cellInfo;
attribute vec4 color;

uniform vec2 textureInfos;
uniform mat4 view;
uniform mat4 projection;

varying vec2 vUV;
varying vec4 vColor;
#include<fogVertexDeclaration>
void main(void) {
vec3 viewPos=(view*vec4(position.xyz,1.0)).xyz;
vec2 cornerPos;
float angle=position.w;
vec2 size=vec2(options.x,options.y);
vec2 offset=options.zw;
vec2 uvScale=textureInfos.xy;
cornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

viewPos+=rotatedCorner;
gl_Position=projection*vec4(viewPos,1.0);

vColor=color;

vec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));
vUV=(uvOffset+cellInfo.zw)*uvScale;

#ifdef FOG
vFogDistance=viewPos;
#endif
}`;Ia.a.ShadersStore.spritesVertexShader=El;var ec,Fl=function(){function e(a,b,c,d,f,h,i){if(void 0===h&&(h=.01),void 0===i&&(i=ra.a.TRILINEAR_SAMPLINGMODE),this.name=a,this.sprites=new Array(),this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this.onDisposeObservable=new q.c(),this._vertexBuffers={},f._getComponent(Pa.a.NAME_SPRITE)||f._addComponent(new ii(f)),this._capacity=c,this._spriteTexture=new ra.a(b,f,!0,!1,i),this._spriteTexture.wrapU=ra.a.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=ra.a.CLAMP_ADDRESSMODE,d.width&&d.height)this.cellWidth=d.width,this.cellHeight=d.height;else{if(void 0===d)return;this.cellWidth=d,this.cellHeight=d}this._epsilon=h,this._scene=f,this._scene.spriteManagers.push(this);for(var k=[],m=0,B=0;B<c;B++)k.push(m),k.push(m+1),k.push(m+2),k.push(m),k.push(m+2),k.push(m+3),m+=4;this._indexBuffer=f.getEngine().createIndexBuffer(k),this._vertexData=new Float32Array(16*c*4),this._buffer=new na.a(f.getEngine(),this._vertexData,!0,16);var E=this._buffer.createVertexBuffer(na.b.PositionKind,0,4),K=this._buffer.createVertexBuffer("options",4,4),P=this._buffer.createVertexBuffer("cellInfo",8,4),S=this._buffer.createVertexBuffer(na.b.ColorKind,12,4);this._vertexBuffers[na.b.PositionKind]=E,this._vertexBuffers.options=K,this._vertexBuffers.cellInfo=P,this._vertexBuffers[na.b.ColorKind]=S,this._effectBase=this._scene.getEngine().createEffect("sprites",[na.b.PositionKind,"options","cellInfo",na.b.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[na.b.PositionKind,"options","cellInfo",na.b.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return Object.defineProperty(e.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._spriteTexture},set:function(a){this._spriteTexture=a},enumerable:!0,configurable:!0}),e.prototype._appendSpriteVertex=function(a,b,c,d,f){var h=16*a;0===c?c=this._epsilon:1===c&&(c=1-this._epsilon),0===d?d=this._epsilon:1===d&&(d=1-this._epsilon),this._vertexData[h]=b.position.x,this._vertexData[h+1]=b.position.y,this._vertexData[h+2]=b.position.z,this._vertexData[h+3]=b.angle,this._vertexData[h+4]=b.width,this._vertexData[h+5]=b.height,this._vertexData[h+6]=c,this._vertexData[h+7]=d,this._vertexData[h+8]=b.invertU?1:0,this._vertexData[h+9]=b.invertV?1:0;var i=b.cellIndex/f>>0;this._vertexData[h+10]=b.cellIndex-i*f,this._vertexData[h+11]=i,this._vertexData[h+12]=b.color.r,this._vertexData[h+13]=b.color.g,this._vertexData[h+14]=b.color.b,this._vertexData[h+15]=b.color.a},e.prototype.intersects=function(a,b,c,d){for(var f=Math.min(this._capacity,this.sprites.length),h=j.x.Zero(),i=j.x.Zero(),k=Number.MAX_VALUE,m=null,B=j.x.Zero(),E=j.x.Zero(),K=b.getViewMatrix(),P=0;P<f;P++){var S=this.sprites[P];if(S){if(c){if(!c(S))continue}else if(!S.isPickable)continue;if(j.x.TransformCoordinatesToRef(S.position,K,E),h.copyFromFloats(E.x-S.width/2,E.y-S.height/2,E.z),i.copyFromFloats(E.x+S.width/2,E.y+S.height/2,E.z),a.intersectsBoxMinMax(h,i)){var U=j.x.Distance(E,a.origin);if(k>U&&(k=U,m=S,d))break}}}if(m){var _=new Hd.a();K.invertToRef(j.t.Matrix[0]),_.hit=!0,_.pickedSprite=m,_.distance=k;var da=j.t.Vector3[0];return da.copyFrom(a.direction),da.normalize(),da.scaleInPlace(k),a.origin.addToRef(da,B),_.pickedPoint=j.x.TransformCoordinates(B,j.t.Matrix[0]),_}return null},e.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()&&this.sprites.length){for(var a=this._scene.getEngine(),b=this._spriteTexture.getBaseSize(),c=a.getDeltaTime(),d=Math.min(this._capacity,this.sprites.length),f=b.width/this.cellWidth,h=0,i=!0,k=0;k<d;k++){var m=this.sprites[k];m&&m.isVisible&&(i=!1,m._animate(c),this._appendSpriteVertex(h++,m,0,0,f),this._appendSpriteVertex(h++,m,1,0,f),this._appendSpriteVertex(h++,m,1,1,f),this._appendSpriteVertex(h++,m,0,1,f))}if(!i){this._buffer.update(this._vertexData);var B=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==ja.a.FOGMODE_NONE&&this.fogEnabled&&(B=this._effectFog),a.enableEffect(B);var E=this._scene.getViewMatrix();B.setTexture("diffuseSampler",this._spriteTexture),B.setMatrix("view",E),B.setMatrix("projection",this._scene.getProjectionMatrix()),B.setFloat2("textureInfos",this.cellWidth/b.width,this.cellHeight/b.height),this._scene.fogEnabled&&this._scene.fogMode!==ja.a.FOGMODE_NONE&&this.fogEnabled&&(B.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),B.setColor3("vFogColor",this._scene.fogColor)),a.bindBuffers(this._vertexBuffers,this._indexBuffer,B),a.setDepthFunctionToLessOrEqual(),B.setBool("alphaTest",!0),a.setColorWrite(!1),a.drawElementsType(rb.a.TriangleFillMode,0,h/4*6),a.setColorWrite(!0),B.setBool("alphaTest",!1),a.setAlphaMode(o.a.ALPHA_COMBINE),a.drawElementsType(rb.a.TriangleFillMode,0,h/4*6),a.setAlphaMode(o.a.ALPHA_DISABLE)}}},e.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var a=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(a,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e}(),Jf=l(94),Gl=l(104);!function(e){e[e.INIT=0]="INIT",e[e.RUNNING=1]="RUNNING",e[e.DONE=2]="DONE",e[e.ERROR=3]="ERROR"}(ec||(ec={}));var Kf,mc=function(){function e(a){this.name=a,this._isCompleted=!1,this._taskState=ec.INIT}return Object.defineProperty(e.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"taskState",{get:function(){return this._taskState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!0,configurable:!0}),e.prototype._setErrorObject=function(a,b){this._errorObject||(this._errorObject={message:a,exception:b})},e.prototype.run=function(a,b,c){var d=this;this._taskState=ec.RUNNING,this.runTask(a,function(){d.onDoneCallback(b,c)},function(f,h){d.onErrorCallback(c,f,h)})},e.prototype.runTask=function(a,b,c){throw new Error("runTask is not implemented")},e.prototype.reset=function(){this._taskState=ec.INIT},e.prototype.onErrorCallback=function(a,b,c){this._taskState=ec.ERROR,this._errorObject={message:b,exception:c},this.onError&&this.onError(this,b,c),a()},e.prototype.onDoneCallback=function(a,b){try{this._taskState=ec.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),a()}catch(c){this.onErrorCallback(b,"Task is done, error executing success callback(s)",c)}},e}(),ji=function(){return function(e,a,b){this.remainingCount=e,this.totalCount=a,this.task=b}}(),ki=function(e){function a(b,c,d,f){var h=e.call(this,b)||this;return h.name=b,h.meshesNames=c,h.rootUrl=d,h.sceneFilename=f,h}return v.d(a,e),a.prototype.runTask=function(b,c,d){var f=this;tb.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,b,function(h,i,k,m){f.loadedMeshes=h,f.loadedParticleSystems=i,f.loadedSkeletons=k,f.loadedAnimationGroups=m,c()},null,function(h,i,k){d(i,k)})},a}(mc),li=function(e){function a(b,c){var d=e.call(this,b)||this;return d.name=b,d.url=c,d}return v.d(a,e),a.prototype.runTask=function(b,c,d){var f=this;b._loadFile(this.url,function(h){f.text=h,c()},void 0,!1,!1,function(h,i){h&&d(h.status+" "+h.statusText,i)})},a}(mc),mi=function(e){function a(b,c){var d=e.call(this,b)||this;return d.name=b,d.url=c,d}return v.d(a,e),a.prototype.runTask=function(b,c,d){var f=this;b._loadFile(this.url,function(h){f.data=h,c()},void 0,!0,!0,function(h,i){h&&d(h.status+" "+h.statusText,i)})},a}(mc),ni=function(e){function a(b,c){var d=e.call(this,b)||this;return d.name=b,d.url=c,d}return v.d(a,e),a.prototype.runTask=function(b,c,d){var f=this,h=new Image();xa.h.SetCorsBehavior(this.url,h),h.onload=function(){f.image=h,c()},h.onerror=function(i){d("Error loading image",i)},h.src=this.url},a}(mc),oi=function(e){function a(b,c,d,f,h){void 0===h&&(h=ra.a.TRILINEAR_SAMPLINGMODE);var i=e.call(this,b)||this;return i.name=b,i.url=c,i.noMipmap=d,i.invertY=f,i.samplingMode=h,i}return v.d(a,e),a.prototype.runTask=function(b,c,d){this.texture=new ra.a(this.url,b,this.noMipmap,this.invertY,this.samplingMode,function(){c()},function(f,h){d(f,h)})},a}(mc),pi=function(e){function a(b,c,d,f,h){var i=e.call(this,b)||this;return i.name=b,i.url=c,i.extensions=d,i.noMipmap=f,i.files=h,i}return v.d(a,e),a.prototype.runTask=function(b,c,d){this.texture=new bc(this.url,b,this.extensions,this.noMipmap,this.files,function(){c()},function(f,h){d(f,h)})},a}(mc),qi=function(e){function a(b,c,d,f,h,i,k){void 0===f&&(f=!1),void 0===h&&(h=!0),void 0===i&&(i=!1),void 0===k&&(k=!1);var m=e.call(this,b)||this;return m.name=b,m.url=c,m.size=d,m.noMipmap=f,m.generateHarmonics=h,m.gammaSpace=i,m.reserved=k,m}return v.d(a,e),a.prototype.runTask=function(b,c,d){this.texture=new jd(this.url,b,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,function(){c()},function(f,h){d(f,h)})},a}(mc),ri=function(e){function a(b,c,d,f,h){void 0===f&&(f=!1),void 0===h&&(h=!0);var i=e.call(this,b)||this;return i.name=b,i.url=c,i.size=d,i.noMipmap=f,i.gammaSpace=h,i}return v.d(a,e),a.prototype.runTask=function(b,c,d){this.texture=new Ah(this.url,b,this.size,this.noMipmap,this.gammaSpace,function(){c()},function(f,h){d(f,h)})},a}(mc),Hl=function(){function e(a){this._isLoading=!1,this._tasks=new Array(),this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new q.c(),this.onTaskErrorObservable=new q.c(),this.onTasksDoneObservable=new q.c(),this.onProgressObservable=new q.c(),this.useDefaultLoadingScreen=!0,this._scene=a}return e.prototype.addMeshTask=function(a,b,c,d){var f=new ki(a,b,c,d);return this._tasks.push(f),f},e.prototype.addTextFileTask=function(a,b){var c=new li(a,b);return this._tasks.push(c),c},e.prototype.addBinaryFileTask=function(a,b){var c=new mi(a,b);return this._tasks.push(c),c},e.prototype.addImageTask=function(a,b){var c=new ni(a,b);return this._tasks.push(c),c},e.prototype.addTextureTask=function(a,b,c,d,f){void 0===f&&(f=ra.a.TRILINEAR_SAMPLINGMODE);var h=new oi(a,b,c,d,f);return this._tasks.push(h),h},e.prototype.addCubeTextureTask=function(a,b,c,d,f){var h=new pi(a,b,c,d,f);return this._tasks.push(h),h},e.prototype.addHDRCubeTextureTask=function(a,b,c,d,f,h,i){void 0===d&&(d=!1),void 0===f&&(f=!0),void 0===h&&(h=!1),void 0===i&&(i=!1);var k=new qi(a,b,c,d,f,h,i);return this._tasks.push(k),k},e.prototype.addEquiRectangularCubeTextureAssetTask=function(a,b,c,d,f){void 0===d&&(d=!1),void 0===f&&(f=!0);var h=new ri(a,b,c,d,f);return this._tasks.push(h),h},e.prototype.removeTask=function(a){var b=this._tasks.indexOf(a);b>-1&&this._tasks.splice(b,1)},e.prototype._decreaseWaitingTasksCount=function(a){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,a),this.onProgressObservable.notifyObservers(new ji(this._waitingTasksCount,this._totalTasksCount,a))}catch(h){r.a.Error("Error running progress callbacks."),console.log(h)}if(0===this._waitingTasksCount){try{this.onFinish&&this.onFinish(this._tasks);for(var b=this._tasks.slice(),c=0,d=b;c<d.length;c++)if((a=d[c]).taskState===ec.DONE){var f=this._tasks.indexOf(a);f>-1&&this._tasks.splice(f,1)}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(h){r.a.Error("Error running tasks-done callbacks."),console.log(h)}this._isLoading=!1,this._scene.getEngine().hideLoadingUI()}},e.prototype._runTask=function(a){var b=this,c=function(d,f){a._setErrorObject(d,f),b.onTaskError&&b.onTaskError(a),b.onTaskErrorObservable.notifyObservers(a),b._decreaseWaitingTasksCount(a)};a.run(this._scene,function(){try{b.onTaskSuccess&&b.onTaskSuccess(a),b.onTaskSuccessObservable.notifyObservers(a),b._decreaseWaitingTasksCount(a)}catch(d){c("Error executing task success callbacks",d)}},c)},e.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array(),this},e.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,0===this._waitingTasksCount)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var a=0;a<this._tasks.length;a++){var b=this._tasks[a];b.taskState===ec.INIT&&this._runTask(b)}return this},e.prototype.loadAsync=function(){var a=this;return new Promise(function(b,c){a.onTasksDoneObservable.addOnce(function(d){d&&d.length?c(d):b()})})},e}(),Il=function(){function e(){var a=this;this.promise=new Promise(function(b,c){a._resolve=b,a._reject=c})}return Object.defineProperty(e.prototype,"resolve",{get:function(){return this._resolve},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){return this._reject},enumerable:!0,configurable:!0}),e}(),Jl=function(){function e(a,b){this._meshesOrigins=[],this._toCenterVectors=[],this._scaledDirection=j.x.Zero(),this._newPosition=j.x.Zero(),this._centerPosition=j.x.Zero(),this._meshes=a.slice(),b?this._centerMesh=b:this._setCenterMesh();var c=this._meshes.indexOf(this._centerMesh);c>=0&&this._meshes.splice(c,1),this._centerPosition=this._centerMesh.getAbsolutePosition().clone();for(var d=0;d<this._meshes.length;d++)if(this._meshes[d]){var f=this._meshes[d];this._meshesOrigins[d]=f.getAbsolutePosition().clone(),this._toCenterVectors[d]=j.x.Zero(),f._boundingInfo&&this._centerMesh._boundingInfo&&f._boundingInfo.boundingBox.centerWorld.subtractToRef(this._centerMesh._boundingInfo.boundingBox.centerWorld,this._toCenterVectors[d])}}return e.prototype._setCenterMesh=function(){for(var a=j.x.Zero(),b=j.x.Zero(),c=Number.MAX_VALUE,d=0;d<this._meshes.length;d++)this._meshes[d]&&((h=(f=this._meshes[d]).getBoundingInfo())&&b.addInPlace(h.boundingBox.centerWorld));for(a=b.scale(1/this._meshes.length),d=0;d<this._meshes.length;d++){var f,h;if(this._meshes[d]){if(h=(f=this._meshes[d]).getBoundingInfo()){var i=h.boundingBox.centerWorld.subtract(a).lengthSquared();i<c&&(this._centerMesh=f,c=i)}}}},e.prototype.getClassName=function(){return"MeshExploder"},e.prototype.getMeshes=function(){var a=this._meshes.slice();return a.unshift(this._centerMesh),a},e.prototype.explode=function(a){void 0===a&&(a=1);for(var b=0;b<this._meshes.length;b++)this._meshes[b]&&this._meshesOrigins[b]&&this._toCenterVectors[b]&&(this._toCenterVectors[b].scaleToRef(a,this._scaledDirection),this._meshesOrigins[b].addToRef(this._scaledDirection,this._newPosition),this._meshes[b].setAbsolutePosition(this._newPosition));this._centerMesh.setAbsolutePosition(this._centerPosition)},e}(),Kl=function(){function e(a,b,c,d,f,h,i,k,m){this.onProcessFileCallback=function(){return!0},this._engine=a,this._currentScene=b,this._sceneLoadedCallback=c,this._progressCallback=d,this._additionalRenderLoopLogicCallback=f,this._textureLoadingCallback=h,this._startingProcessingFilesCallback=i,this._onReloadCallback=k,this._errorCallback=m}return Object.defineProperty(e,"FilesToLoad",{get:function(){return Ne.a.FilesToLoad},enumerable:!0,configurable:!0}),e.prototype.monitorElementForDragNDrop=function(a){var b=this;a&&(this._elementToMonitor=a,this._dragEnterHandler=function(c){b.drag(c)},this._dragOverHandler=function(c){b.drag(c)},this._dropHandler=function(c){b.drop(c)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},e.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},e.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var a=this._currentScene.getWaitingItemsCount();a>0&&this._textureLoadingCallback(a)}this._currentScene.render()}},e.prototype.drag=function(a){a.stopPropagation(),a.preventDefault()},e.prototype.drop=function(a){a.stopPropagation(),a.preventDefault(),this.loadFiles(a)},e.prototype._traverseFolder=function(a,b,c,d){var f=this,h=a.createReader(),i=a.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");h.readEntries(function(k){c.count+=k.length;for(var m=0,B=k;m<B.length;m++){var E=B[m];E.isFile?E.file(function(K){K.correctName=i+K.name,b.push(K),0==--c.count&&d()}):E.isDirectory&&f._traverseFolder(E,b,c,d)}--c.count&&d()})},e.prototype._processFiles=function(a){for(var b=0;b<a.length;b++){var c=a[b].correctName.toLowerCase(),d=c.split(".").pop();this.onProcessFileCallback(a[b],c,d)&&("babylon"!==d&&"stl"!==d&&"obj"!==d&&"gltf"!==d&&"glb"!==d||-1!==c.indexOf(".binary.babylon")||-1!==c.indexOf(".incremental.babylon")||(this._sceneFileToLoad=a[b]),e.FilesToLoad[c]=a[b])}},e.prototype.loadFiles=function(a){var b=this;if(a&&a.dataTransfer&&a.dataTransfer.files&&(this._filesToLoad=a.dataTransfer.files),a&&a.target&&a.target.files&&(this._filesToLoad=a.target.files),this._filesToLoad&&0!==this._filesToLoad.length&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var c=new Array(),d=[],f=a.dataTransfer?a.dataTransfer.items:null,h=0;h<this._filesToLoad.length;h++){var i=this._filesToLoad[h],k=i.name.toLowerCase(),m;if(i.correctName=k,f){var B=f[h];B.getAsEntry?m=B.getAsEntry():B.webkitGetAsEntry&&(m=B.webkitGetAsEntry())}m&&m.isDirectory?d.push(m):c.push(i)}if(0===d.length)this._processFiles(c),this._processReload();else for(var E={count:d.length},K=0,P=d;K<P.length;K++){var S=P[K];this._traverseFolder(S,c,E,function(){b._processFiles(c),0===E.count&&b._processReload()})}}},e.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},e.prototype.reload=function(){var a=this;this._sceneFileToLoad?(this._currentScene&&(r.a.errorsCount>0&&r.a.ClearLogCache(),this._engine.stopRenderLoop()),tb.LoadAsync("file:",this._sceneFileToLoad,this._engine,function(b){a._progressCallback&&a._progressCallback(b)}).then(function(b){a._currentScene&&a._currentScene.dispose(),a._currentScene=b,a._sceneLoadedCallback&&a._sceneLoadedCallback(a._sceneFileToLoad,a._currentScene),a._currentScene.executeWhenReady(function(){a._engine.runRenderLoop(function(){a.renderFunction()})})}).catch(function(b){a._errorCallback&&a._errorCallback(a._sceneFileToLoad,a._currentScene,b.message)})):r.a.Error("Please provide a valid .babylon file.")},e}(),si=l(105),Ll=l(106),fc=function(){function e(a){void 0===a&&(a=0),this.priority=a}return e.prototype.getDescription=function(){return""},e.prototype.apply=function(a,b){return!0},e}(),_d=function(e){function a(b,c,d){void 0===b&&(b=0),void 0===c&&(c=1024),void 0===d&&(d=.5);var f=e.call(this,b)||this;return f.priority=b,f.maximumSize=c,f.step=d,f}return v.d(a,e),a.prototype.getDescription=function(){return"Reducing render target texture size to "+this.maximumSize},a.prototype.apply=function(b,c){for(var d=!0,f=0;f<b.textures.length;f++){var h=b.textures[f];if(h.canRescale&&!h.getContext){var i=h.getSize();Math.max(i.width,i.height)>this.maximumSize&&(h.scale(this.step),d=!1)}}return d},a}(fc),Lf=function(e){function a(b,c,d){void 0===b&&(b=0),void 0===c&&(c=2),void 0===d&&(d=.25);var f=e.call(this,b)||this;return f.priority=b,f.maximumScale=c,f.step=d,f._currentScale=-1,f._directionOffset=1,f}return v.d(a,e),a.prototype.getDescription=function(){return"Setting hardware scaling level to "+this._currentScale},a.prototype.apply=function(b,c){return-1===this._currentScale&&(this._currentScale=b.getEngine().getHardwareScalingLevel(),this._currentScale>this.maximumScale&&(this._directionOffset=-1)),this._currentScale+=this._directionOffset*this.step,b.getEngine().setHardwareScalingLevel(this._currentScale),1===this._directionOffset?this._currentScale>=this.maximumScale:this._currentScale<=this.maximumScale},a}(fc),$d=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.getDescription=function(){return"Turning shadows on/off"},a.prototype.apply=function(b,c){return b.shadowsEnabled=c.isInImprovementMode,!0},a}(fc),ae=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.getDescription=function(){return"Turning post-processes on/off"},a.prototype.apply=function(b,c){return b.postProcessesEnabled=c.isInImprovementMode,!0},a}(fc),be=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.getDescription=function(){return"Turning lens flares on/off"},a.prototype.apply=function(b,c){return b.lensFlaresEnabled=c.isInImprovementMode,!0},a}(fc),ti=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.getDescription=function(){return this.onGetDescription?this.onGetDescription():"Running user defined callback"},a.prototype.apply=function(b,c){return!this.onApply||this.onApply(b,c)},a}(fc),ce=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.getDescription=function(){return"Turning particles on/off"},a.prototype.apply=function(b,c){return b.particlesEnabled=c.isInImprovementMode,!0},a}(fc),Mf=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return v.d(a,e),a.prototype.getDescription=function(){return"Turning render targets off"},a.prototype.apply=function(b,c){return b.renderTargetsEnabled=c.isInImprovementMode,!0},a}(fc),de=function(e){function a(){var b=null!==e&&e.apply(this,arguments)||this;return b._canBeMerged=function(c){if(!(c instanceof Ca.a))return!1;var d=c;return!d.isDisposed()&&(!(!d.isVisible||!d.isEnabled())&&(!(d.instances.length>0)&&(!d.skeleton&&!d.hasLODLevels)))},b}return v.d(a,e),Object.defineProperty(a,"UpdateSelectionTree",{get:function(){return a._UpdateSelectionTree},set:function(b){a._UpdateSelectionTree=b},enumerable:!0,configurable:!0}),a.prototype.getDescription=function(){return"Merging similar meshes together"},a.prototype.apply=function(b,c,d){for(var f=b.meshes.slice(0),h=f.length,i=0;i<h;i++){var k=new Array(),m=f[i];if(this._canBeMerged(m)){k.push(m);for(var B=i+1;B<h;B++){var E=f[B];this._canBeMerged(E)&&(E.material===m.material&&E.checkCollisions===m.checkCollisions&&(k.push(E),h--,f.splice(B,1),B--))}k.length<2||Ca.a.MergeMeshes(k,void 0,!0)}}var K=b;return K.createOrUpdateSelectionOctree&&(null!=d?d&&K.createOrUpdateSelectionOctree():a.UpdateSelectionTree&&K.createOrUpdateSelectionOctree()),!0},a._UpdateSelectionTree=!1,a}(fc),Nf=function(){function e(a,b){void 0===a&&(a=60),void 0===b&&(b=2000),this.targetFrameRate=a,this.trackerDuration=b,this.optimizations=new Array()}return e.prototype.addOptimization=function(a){return this.optimizations.push(a),this},e.prototype.addCustomOptimization=function(a,b,c){void 0===c&&(c=0);var d=new ti(c);return d.onApply=a,d.onGetDescription=b,this.optimizations.push(d),this},e.LowDegradationAllowed=function(a){var b=new e(a),c=0;return b.addOptimization(new de(c)),b.addOptimization(new $d(c)),b.addOptimization(new be(c)),c++,b.addOptimization(new ae(c)),b.addOptimization(new ce(c)),c++,b.addOptimization(new _d(c,1024)),b},e.ModerateDegradationAllowed=function(a){var b=new e(a),c=0;return b.addOptimization(new de(c)),b.addOptimization(new $d(c)),b.addOptimization(new be(c)),c++,b.addOptimization(new ae(c)),b.addOptimization(new ce(c)),c++,b.addOptimization(new _d(c,512)),c++,b.addOptimization(new Mf(c)),c++,b.addOptimization(new Lf(c,2)),b},e.HighDegradationAllowed=function(a){var b=new e(a),c=0;return b.addOptimization(new de(c)),b.addOptimization(new $d(c)),b.addOptimization(new be(c)),c++,b.addOptimization(new ae(c)),b.addOptimization(new ce(c)),c++,b.addOptimization(new _d(c,256)),c++,b.addOptimization(new Mf(c)),c++,b.addOptimization(new Lf(c,4)),b},e}(),Ml=function(){function e(a,b,c,d){var f=this;if(void 0===c&&(c=!0),void 0===d&&(d=!1),this._isRunning=!1,this._currentPriorityLevel=0,this._targetFrameRate=60,this._trackerDuration=2000,this._currentFrameRate=0,this._improvementMode=!1,this.onSuccessObservable=new q.c(),this.onNewOptimizationAppliedObservable=new q.c(),this.onFailureObservable=new q.c(),this._options=b||new Nf(),this._options.targetFrameRate&&(this._targetFrameRate=this._options.targetFrameRate),this._options.trackerDuration&&(this._trackerDuration=this._options.trackerDuration),c)for(var h=0,i=0,k=this._options.optimizations;i<k.length;i++)k[i].priority=h++;this._improvementMode=d,this._scene=a||T.a.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(function(){f._sceneDisposeObserver=null,f.dispose()})}return Object.defineProperty(e.prototype,"isInImprovementMode",{get:function(){return this._improvementMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPriorityLevel",{get:function(){return this._currentPriorityLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrameRate",{get:function(){return this._currentFrameRate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetFrameRate",{get:function(){return this._targetFrameRate},set:function(a){this._targetFrameRate=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trackerDuration",{get:function(){return this._trackerDuration},set:function(a){this._trackerDuration=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizations",{get:function(){return this._options.optimizations},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this._isRunning=!1},e.prototype.reset=function(){this._currentPriorityLevel=0},e.prototype.start=function(){var a=this;this._isRunning||(this._isRunning=!0,this._scene.executeWhenReady(function(){setTimeout(function(){a._checkCurrentState()},a._trackerDuration)}))},e.prototype._checkCurrentState=function(){var a=this;if(this._isRunning){var b=this._scene,c=this._options;if(this._currentFrameRate=Math.round(b.getEngine().getFps()),this._improvementMode&&this._currentFrameRate<=this._targetFrameRate||!this._improvementMode&&this._currentFrameRate>=this._targetFrameRate)return this._isRunning=!1,void this.onSuccessObservable.notifyObservers(this);for(var d=!0,f=!0,h=0;h<c.optimizations.length;h++){var i=c.optimizations[h];i.priority===this._currentPriorityLevel&&(f=!1,d=d&&i.apply(b,this),this.onNewOptimizationAppliedObservable.notifyObservers(i))}if(f)return this._isRunning=!1,void this.onFailureObservable.notifyObservers(this);d&&this._currentPriorityLevel++,b.executeWhenReady(function(){setTimeout(function(){a._checkCurrentState()},a._trackerDuration)})}},e.prototype.dispose=function(){this.stop(),this.onSuccessObservable.clear(),this.onFailureObservable.clear(),this.onNewOptimizationAppliedObservable.clear(),this._sceneDisposeObserver&&this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)},e.OptimizeAsync=function(a,b,c,d){var f=new e(a,b||Nf.ModerateDegradationAllowed(),!1);return c&&f.onSuccessObservable.add(function(){c()}),d&&f.onFailureObservable.add(function(){d()}),f.start(),f},e}(),ee=[],Of=function(e,a){ee[e.id]||e.doNotSerialize||(a.vertexData.push(e.serializeVerticeData()),ee[e.id]=!0)},ui=function(e,a){var b={},c=e._geometry;return c&&(e.getScene().getGeometryByID(c.id)||Of(c,a.geometries)),e.serialize&&e.serialize(b),b},Nl=function(){function e(){}return e.ClearCache=function(){ee=[]},e.Serialize=function(a){var b,c,d,f={};if(e.ClearCache(),f.useDelayedTextureLoading=a.useDelayedTextureLoading,f.autoClear=a.autoClear,f.clearColor=a.clearColor.asArray(),f.ambientColor=a.ambientColor.asArray(),f.gravity=a.gravity.asArray(),f.collisionsEnabled=a.collisionsEnabled,a.fogMode&&0!==a.fogMode&&(f.fogMode=a.fogMode,f.fogColor=a.fogColor.asArray(),f.fogStart=a.fogStart,f.fogEnd=a.fogEnd,f.fogDensity=a.fogDensity),a.isPhysicsEnabled()){var h=a.getPhysicsEngine();h&&(f.physicsEnabled=!0,f.physicsGravity=h.gravity.asArray(),f.physicsEngine=h.getPhysicsPluginName())}a.metadata&&(f.metadata=a.metadata),f.morphTargetManagers=[];for(var i=0,k=a.meshes;i<k.length;i++){var m=(_=k[i]).morphTargetManager;m&&f.morphTargetManagers.push(m.serialize())}for(f.lights=[],b=0;b<a.lights.length;b++)(c=a.lights[b]).doNotSerialize||f.lights.push(c.serialize());for(f.cameras=[],b=0;b<a.cameras.length;b++){var B=a.cameras[b];B.doNotSerialize||f.cameras.push(B.serialize())}if(a.activeCamera&&(f.activeCameraID=a.activeCamera.id),g.a.AppendSerializedAnimations(a,f),a.reflectionProbes&&a.reflectionProbes.length>0)for(f.reflectionProbes=[],b=0;b<a.reflectionProbes.length;b++){var E=a.reflectionProbes[b];f.reflectionProbes.push(E.serialize())}for(f.materials=[],f.multiMaterials=[],b=0;b<a.materials.length;b++)(d=a.materials[b]).doNotSerialize||f.materials.push(d.serialize());for(f.multiMaterials=[],b=0;b<a.multiMaterials.length;b++){var K=a.multiMaterials[b];f.multiMaterials.push(K.serialize())}for(a.environmentTexture&&(f.environmentTexture=a.environmentTexture.name),f.skeletons=[],b=0;b<a.skeletons.length;b++){var P=a.skeletons[b];P.doNotSerialize||f.skeletons.push(P.serialize())}for(f.transformNodes=[],b=0;b<a.transformNodes.length;b++)f.transformNodes.push(a.transformNodes[b].serialize());f.geometries={},f.geometries.boxes=[],f.geometries.spheres=[],f.geometries.cylinders=[],f.geometries.toruses=[],f.geometries.grounds=[],f.geometries.planes=[],f.geometries.torusKnots=[],f.geometries.vertexData=[],ee=[];var S=a.getGeometries();for(b=0;b<S.length;b++){var U=S[b];U.isReady()&&Of(U,f.geometries)}for(f.meshes=[],b=0;b<a.meshes.length;b++){var _;if((_=a.meshes[b])instanceof Ca.a){var da=_;da.doNotSerialize||da.delayLoadState!==o.a.DELAYLOADSTATE_LOADED&&da.delayLoadState!==o.a.DELAYLOADSTATE_NONE||f.meshes.push(ui(da,f))}}for(f.particleSystems=[],b=0;b<a.particleSystems.length;b++)f.particleSystems.push(a.particleSystems[b].serialize());a.actionManager&&(f.actions=a.actionManager.serialize("scene"));for(var fa=0,ga=a._serializableComponents;fa<ga.length;fa++)ga[fa].serialize(f);return f},e.SerializeMesh=function(a,b,c){void 0===b&&(b=!1),void 0===c&&(c=!1);var d={};if(e.ClearCache(),a=a instanceof Array?a:[a],b||c)for(var f=0;f<a.length;++f)c&&a[f].getDescendants().forEach(function(h){h instanceof Ca.a&&a.indexOf(h)<0&&a.push(h)}),b&&a[f].parent&&a.indexOf(a[f].parent)<0&&a.push(a[f].parent);return a.forEach(function(h){!function(i,k){if(i.delayLoadState===o.a.DELAYLOADSTATE_LOADED||i.delayLoadState===o.a.DELAYLOADSTATE_NONE){if(i.material)if(i.material instanceof Sd.a){if(k.multiMaterials=k.multiMaterials||[],k.materials=k.materials||[],!k.multiMaterials.some(function(P){return P.id===i.material.id})){k.multiMaterials.push(i.material.serialize());for(var m=function(P){P&&(k.materials.some(function(S){return S.id===P.id})||k.materials.push(P.serialize()))},B=0,E=i.material.subMaterials;B<E.length;B++)m(E[B])}}else k.materials=k.materials||[],k.materials.some(function(P){return P.id===i.material.id})||k.materials.push(i.material.serialize());var K=i._geometry;K&&(k.geometries||(k.geometries={},k.geometries.boxes=[],k.geometries.spheres=[],k.geometries.cylinders=[],k.geometries.toruses=[],k.geometries.grounds=[],k.geometries.planes=[],k.geometries.torusKnots=[],k.geometries.vertexData=[]),Of(K,k.geometries)),i.skeleton&&(k.skeletons=k.skeletons||[],k.skeletons.push(i.skeleton.serialize())),k.meshes=k.meshes||[],k.meshes.push(ui(i,k))}}(h,d)}),d},e}(),Ol=l(29),Pl=function(){function e(){}return e.CreateResizedCopy=function(a,b,c,d){void 0===d&&(d=!0);var f=a.getScene(),h=f.getEngine(),i=new Ab("resized"+a.name,{width:b,height:c},f,!a.noMipmap,!0,a._texture.type,!1,a.samplingMode,!1);i.wrapU=a.wrapU,i.wrapV=a.wrapV,i.uOffset=a.uOffset,i.vOffset=a.vOffset,i.uScale=a.uScale,i.vScale=a.vScale,i.uAng=a.uAng,i.vAng=a.vAng,i.wAng=a.wAng,i.coordinatesIndex=a.coordinatesIndex,i.level=a.level,i.anisotropicFilteringLevel=a.anisotropicFilteringLevel,i._texture.isReady=!1,a.wrapU=ra.a.CLAMP_ADDRESSMODE,a.wrapV=ra.a.CLAMP_ADDRESSMODE;var k=new sc("pass",1,null,d?ra.a.BILINEAR_SAMPLINGMODE:ra.a.NEAREST_SAMPLINGMODE,h,!1,o.a.TEXTURETYPE_UNSIGNED_INT);return k.getEffect().executeWhenCompiled(function(){k.onApply=function(B){B.setTexture("textureSampler",a)};var m=i.getInternalTexture();m&&(f.postProcessManager.directRender([k],m),h.unBindFramebuffer(m),i.disposeFramebufferObjects(),k.dispose(),m.isReady=!0)}),i},e}(),Ql=function(){function e(a,b){if(void 0===b&&(b=null),!e.IsSupported(a))throw"Your browser does not support recording so far.";var c=a.getRenderingCanvas();if(!c)throw"The babylon engine must have a canvas to be recorded";this._canvas=c,this._canvas.isRecording=!1,this._options=v.a({},e._defaultOptions,b);var d=this._canvas.captureStream(this._options.fps);if(this._options.audioTracks)for(var f=0,h=this._options.audioTracks;f<h.length;f++){var i=h[f];d.addTrack(i)}this._mediaRecorder=new MediaRecorder(d,{mimeType:this._options.mimeType}),this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this._mediaRecorder.onerror=this._handleError.bind(this),this._mediaRecorder.onstop=this._handleStop.bind(this)}return e.IsSupported=function(a){var b=a.getRenderingCanvas();return!!b&&"function"==typeof b.captureStream},Object.defineProperty(e.prototype,"isRecording",{get:function(){return!!this._canvas&&this._canvas.isRecording},enumerable:!0,configurable:!0}),e.prototype.stopRecording=function(){this._canvas&&this._mediaRecorder&&this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())},e.prototype.startRecording=function(a,b){var c=this;if(void 0===a&&(a="babylonjs.webm"),void 0===b&&(b=7),!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";return b>0&&setTimeout(function(){c.stopRecording()},1000*b),this._fileName=a,this._recordedChunks=[],this._resolve=null,this._reject=null,this._canvas.isRecording=!0,this._mediaRecorder.start(this._options.recordChunckSize),new Promise(function(d,f){c._resolve=d,c._reject=f})},e.prototype.dispose=function(){this._canvas=null,this._mediaRecorder=null,this._recordedChunks=[],this._fileName=null,this._resolve=null,this._reject=null},e.prototype._handleDataAvailable=function(a){a.data.size>0&&this._recordedChunks.push(a.data)},e.prototype._handleError=function(a){if(this.stopRecording(),!this._reject)throw new a.error();this._reject(a.error)},e.prototype._handleStop=function(){this.stopRecording();var a=new Blob(this._recordedChunks);this._resolve&&this._resolve(a),window.URL.createObjectURL(a),this._fileName&&xa.h.Download(a,this._fileName)},e._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3000},e}(),Pf=function(){function e(){}return e.CreateScreenshot=function(a,b,c,d,f){var h,i;if(void 0===f&&(f="image/png"),c.precision)h=Math.round(a.getRenderWidth()*c.precision),i=Math.round(h/a.getAspectRatio(b));else if(c.width&&c.height)h=c.width,i=c.height;else if(c.width&&!c.height)h=c.width,i=Math.round(h/a.getAspectRatio(b));else if(c.height&&!c.width)i=c.height,h=Math.round(i*a.getAspectRatio(b));else{if(isNaN(c))return void r.a.Error("Invalid 'size' parameter !");i=c,h=c}xa.h._ScreenshotCanvas||(xa.h._ScreenshotCanvas=document.createElement("canvas")),xa.h._ScreenshotCanvas.width=h,xa.h._ScreenshotCanvas.height=i;var k=xa.h._ScreenshotCanvas.getContext("2d"),m=a.getRenderWidth()/a.getRenderHeight(),B=h,E=B/m;E>i&&(B=(E=i)*m);var K=Math.max(0,h-B)/2,P=Math.max(0,i-E)/2,S=a.getRenderingCanvas();k&&S&&k.drawImage(S,K,P,B,E),xa.h.EncodeScreenshotCanvasData(d,f)},e.CreateScreenshotUsingRenderTarget=function(a,b,c,d,f,h,i,k){var m,B;if(void 0===f&&(f="image/png"),void 0===h&&(h=1),void 0===i&&(i=!1),c.precision)m=Math.round(a.getRenderWidth()*c.precision),B=Math.round(m/a.getAspectRatio(b)),c={width:m,height:B};else if(c.width&&c.height)m=c.width,B=c.height;else if(c.width&&!c.height)m=c.width,B=Math.round(m/a.getAspectRatio(b)),c={width:m,height:B};else if(c.height&&!c.width)B=c.height,c={width:m=Math.round(B*a.getAspectRatio(b)),height:B};else{if(isNaN(c))return void r.a.Error("Invalid 'size' parameter !");B=c,m=c}var E=b.getScene(),K=null;E.activeCamera!==b&&(K=E.activeCamera,E.activeCamera=b);var P=a.getRenderingCanvas();if(P){var S={width:P.width,height:P.height};a.setSize(m,B),E.render();var U=new Ab("screenShot",c,E,!1,!1,o.a.TEXTURETYPE_UNSIGNED_INT,!1,ra.a.NEAREST_SAMPLINGMODE);U.renderList=null,U.samples=h,i&&U.addPostProcess(new Yd("antialiasing",1,E.activeCamera)),U.onAfterRenderObservable.add(function(){xa.h.DumpFramebuffer(m,B,a,d,f,k)}),E.incrementRenderId(),E.resetCachedMaterial(),U.render(!0),U.dispose(),K&&(E.activeCamera=K),a.setSize(S.width,S.height),b.getProjectionMatrix(!0)}else r.a.Error("No rendering canvas found !")},e}();xa.h.CreateScreenshot=Pf.CreateScreenshot,xa.h.CreateScreenshotUsingRenderTarget=Pf.CreateScreenshotUsingRenderTarget,function(e){e[e.Checkbox=0]="Checkbox",e[e.Slider=1]="Slider",e[e.Vector3=2]="Vector3",e[e.Quaternion=3]="Quaternion",e[e.Color3=4]="Color3"}(Kf||(Kf={})),l.d(x,"AbstractScene",function(){return O.a}),l.d(x,"Action",function(){return H}),l.d(x,"ActionEvent",function(){return A.a}),l.d(x,"ActionManager",function(){return D}),l.d(x,"Condition",function(){return z}),l.d(x,"ValueCondition",function(){return u}),l.d(x,"PredicateCondition",function(){return w}),l.d(x,"StateCondition",function(){return y}),l.d(x,"SwitchBooleanAction",function(){return G}),l.d(x,"SetStateAction",function(){return M}),l.d(x,"SetValueAction",function(){return R}),l.d(x,"IncrementValueAction",function(){return W}),l.d(x,"PlayAnimationAction",function(){return Y}),l.d(x,"StopAnimationAction",function(){return X}),l.d(x,"DoNothingAction",function(){return ea}),l.d(x,"CombineAction",function(){return ca}),l.d(x,"ExecuteCodeAction",function(){return oa}),l.d(x,"SetParentAction",function(){return Z}),l.d(x,"PlaySoundAction",function(){return F}),l.d(x,"StopSoundAction",function(){return L}),l.d(x,"InterpolateValueAction",function(){return J}),l.d(x,"Animatable",function(){return Ea}),l.d(x,"_IAnimationState",function(){return t}),l.d(x,"Animation",function(){return C}),l.d(x,"TargetedAnimation",function(){return Ba}),l.d(x,"AnimationGroup",function(){return Sa}),l.d(x,"AnimationPropertiesOverride",function(){return Xa}),l.d(x,"EasingFunction",function(){return Ka}),l.d(x,"CircleEase",function(){return Ga}),l.d(x,"BackEase",function(){return nb}),l.d(x,"BounceEase",function(){return jb}),l.d(x,"CubicEase",function(){return bb}),l.d(x,"ElasticEase",function(){return fb}),l.d(x,"ExponentialEase",function(){return ob}),l.d(x,"PowerEase",function(){return Cb}),l.d(x,"QuadraticEase",function(){return gb}),l.d(x,"QuarticEase",function(){return qb}),l.d(x,"QuinticEase",function(){return yb}),l.d(x,"SineEase",function(){return Lb}),l.d(x,"BezierCurveEase",function(){return Mb}),l.d(x,"RuntimeAnimation",function(){return qa}),l.d(x,"AnimationEvent",function(){return gc}),l.d(x,"AnimationKeyInterpolation",function(){return N}),l.d(x,"AnimationRange",function(){return n}),l.d(x,"KeepAssets",function(){return cc}),l.d(x,"AssetContainer",function(){return dc}),l.d(x,"Analyser",function(){return vd}),l.d(x,"AudioEngine",function(){return Xc}),l.d(x,"AudioSceneComponent",function(){return hc}),l.d(x,"Sound",function(){return yc}),l.d(x,"SoundTrack",function(){return wd}),l.d(x,"WeightedSound",function(){return ie}),l.d(x,"AutoRotationBehavior",function(){return xd}),l.d(x,"BouncingBehavior",function(){return yd}),l.d(x,"FramingBehavior",function(){return zd}),l.d(x,"AttachToBoxBehavior",function(){return je}),l.d(x,"FadeInOutBehavior",function(){return ke}),l.d(x,"MultiPointerScaleBehavior",function(){return Ei}),l.d(x,"PointerDragBehavior",function(){return pc.a}),l.d(x,"SixDofDragBehavior",function(){return cg}),l.d(x,"Bone",function(){return Fa}),l.d(x,"BoneIKController",function(){return Fi}),l.d(x,"BoneLookController",function(){return Gi}),l.d(x,"Skeleton",function(){return le}),l.d(x,"CameraInputTypes",function(){return Db}),l.d(x,"CameraInputsManager",function(){return Yc}),l.d(x,"Camera",function(){return ab.a}),l.d(x,"TargetCamera",function(){return qc}),l.d(x,"FreeCamera",function(){return Wb}),l.d(x,"FreeCameraInputsManager",function(){return Zc}),l.d(x,"TouchCamera",function(){return De}),l.d(x,"ArcRotateCamera",function(){return Bc}),l.d(x,"ArcRotateCameraInputsManager",function(){return Ad}),l.d(x,"DeviceOrientationCamera",function(){return Bd}),l.d(x,"FlyCamera",function(){return Ii}),l.d(x,"FlyCameraInputsManager",function(){return gg}),l.d(x,"FollowCamera",function(){return hg}),l.d(x,"ArcFollowCamera",function(){return ig}),l.d(x,"GamepadCamera",function(){return Cd}),l.d(x,"UniversalCamera",function(){return Hc}),l.d(x,"VirtualJoysticksCamera",function(){return wg}),l.d(x,"ArcRotateCameraGamepadInput",function(){return me}),l.d(x,"ArcRotateCameraKeyboardMoveInput",function(){return ne}),l.d(x,"ArcRotateCameraMouseWheelInput",function(){return oe}),l.d(x,"ArcRotateCameraPointersInput",function(){return pe}),l.d(x,"ArcRotateCameraVRDeviceOrientationInput",function(){return qe}),l.d(x,"FlyCameraKeyboardInput",function(){return re}),l.d(x,"FlyCameraMouseInput",function(){return se}),l.d(x,"FollowCameraKeyboardMoveInput",function(){return te}),l.d(x,"FollowCameraMouseWheelInput",function(){return ue}),l.d(x,"FollowCameraPointersInput",function(){return ve}),l.d(x,"FreeCameraDeviceOrientationInput",function(){return ze}),l.d(x,"FreeCameraGamepadInput",function(){return Ae}),l.d(x,"FreeCameraKeyboardMoveInput",function(){return we}),l.d(x,"FreeCameraMouseInput",function(){return xe}),l.d(x,"FreeCameraTouchInput",function(){return ye}),l.d(x,"FreeCameraVirtualJoystickInput",function(){return Ce}),l.d(x,"AnaglyphArcRotateCamera",function(){return ng}),l.d(x,"AnaglyphFreeCamera",function(){return og}),l.d(x,"AnaglyphGamepadCamera",function(){return pg}),l.d(x,"AnaglyphUniversalCamera",function(){return qg}),l.d(x,"StereoscopicArcRotateCamera",function(){return sg}),l.d(x,"StereoscopicFreeCamera",function(){return tg}),l.d(x,"StereoscopicGamepadCamera",function(){return ug}),l.d(x,"StereoscopicUniversalCamera",function(){return vg}),l.d(x,"VRCameraMetrics",function(){return Ic}),l.d(x,"VRDeviceOrientationArcRotateCamera",function(){return Ag}),l.d(x,"VRDeviceOrientationFreeCamera",function(){return Dd}),l.d(x,"VRDeviceOrientationGamepadCamera",function(){return Bg}),l.d(x,"OnAfterEnteringVRObservableEvent",function(){return Vi}),l.d(x,"VRExperienceHelper",function(){return Dg}),l.d(x,"WebVRFreeCamera",function(){return Fd}),l.d(x,"WebXRCamera",function(){return Eg}),l.d(x,"WebXREnterExitUIButton",function(){return Ke}),l.d(x,"WebXREnterExitUIOptions",function(){return Wi}),l.d(x,"WebXREnterExitUI",function(){return Hg}),l.d(x,"WebXRState",function(){return Ub}),l.d(x,"WebXRExperienceHelper",function(){return Gg}),l.d(x,"WebXRController",function(){return Ig}),l.d(x,"WebXRInput",function(){return Jg}),l.d(x,"WebXRManagedOutputCanvas",function(){return Kg}),l.d(x,"WebXRSessionManager",function(){return Fg}),l.d(x,"Collider",function(){return Lg}),l.d(x,"DefaultCollisionCoordinator",function(){return Mg}),l.d(x,"PickingInfo",function(){return Hd.a}),l.d(x,"IntersectionInfo",function(){return Xi.a}),l.d(x,"_MeshCollisionData",function(){return Yi.a}),l.d(x,"BoundingBox",function(){return Le.a}),l.d(x,"BoundingInfo",function(){return Kc.a}),l.d(x,"BoundingSphere",function(){return Ng.a}),l.d(x,"Ray",function(){return Nb.a}),l.d(x,"Octree",function(){return bd}),l.d(x,"OctreeBlock",function(){return Og}),l.d(x,"OctreeSceneComponent",function(){return Me}),l.d(x,"AxesViewer",function(){return Lc.AxesViewer}),l.d(x,"BoneAxesViewer",function(){return Lc.BoneAxesViewer}),l.d(x,"DebugLayer",function(){return Lc.DebugLayer}),l.d(x,"PhysicsViewer",function(){return Lc.PhysicsViewer}),l.d(x,"RayHelper",function(){return Lc.RayHelper}),l.d(x,"SkeletonViewer",function(){return Lc.SkeletonViewer}),l.d(x,"Constants",function(){return o.a}),l.d(x,"InstancingAttributeInfo",function(){return va.d}),l.d(x,"DepthTextureCreationOptions",function(){return va.a}),l.d(x,"EngineCapabilities",function(){return va.c}),l.d(x,"Engine",function(){return va.b}),l.d(x,"EngineStore",function(){return T.a}),l.d(x,"NullEngineOptions",function(){return Pg.b}),l.d(x,"NullEngine",function(){return Pg.a}),l.d(x,"WebGLPipelineContext",function(){return Zi.a}),l.d(x,"_OcclusionDataStorage",function(){return Rg}),l.d(x,"_forceTransformFeedbackToBundle",function(){return!0}),l.d(x,"KeyboardEventTypes",function(){return Ac.a}),l.d(x,"KeyboardInfo",function(){return Ac.b}),l.d(x,"KeyboardInfoPre",function(){return Ac.c}),l.d(x,"PointerEventTypes",function(){return hb.a}),l.d(x,"PointerInfoBase",function(){return hb.c}),l.d(x,"PointerInfoPre",function(){return hb.d}),l.d(x,"PointerInfo",function(){return hb.b}),l.d(x,"ClipboardEventTypes",function(){return Id}),l.d(x,"ClipboardInfo",function(){return _i}),l.d(x,"DaydreamController",function(){return Oe}),l.d(x,"GearVRController",function(){return Pe}),l.d(x,"GenericController",function(){return Jd}),l.d(x,"OculusTouchController",function(){return Tg}),l.d(x,"PoseEnabledControllerType",function(){return _b}),l.d(x,"PoseEnabledControllerHelper",function(){return rc}),l.d(x,"PoseEnabledController",function(){return _c}),l.d(x,"ViveController",function(){return Ug}),l.d(x,"WebVRController",function(){return tc}),l.d(x,"WindowsMotionController",function(){return Qe}),l.d(x,"StickValues",function(){return Hi}),l.d(x,"Gamepad",function(){return Hb}),l.d(x,"GenericPad",function(){return dg}),l.d(x,"GamepadManager",function(){return kg}),l.d(x,"GamepadSystemSceneComponent",function(){return lg}),l.d(x,"Xbox360Button",function(){return Ob}),l.d(x,"Xbox360Dpad",function(){return Cc}),l.d(x,"Xbox360Pad",function(){return jg}),l.d(x,"AxisDragGizmo",function(){return Kd.a}),l.d(x,"AxisScaleGizmo",function(){return dd}),l.d(x,"BoundingBoxGizmo",function(){return Vg}),l.d(x,"Gizmo",function(){return uc.a}),l.d(x,"GizmoManager",function(){return aj}),l.d(x,"PlaneRotationGizmo",function(){return Ld}),l.d(x,"PositionGizmo",function(){return Xg}),l.d(x,"RotationGizmo",function(){return Wg}),l.d(x,"ScaleGizmo",function(){return Yg}),l.d(x,"LightGizmo",function(){return bj}),l.d(x,"EnvironmentHelper",function(){return We}),l.d(x,"PhotoDome",function(){return mj}),l.d(x,"_forceSceneHelpersToBundle",function(){return!0}),l.d(x,"VideoDome",function(){return Fj}),l.d(x,"EngineInstrumentation",function(){return Gj}),l.d(x,"SceneInstrumentation",function(){return Hj}),l.d(x,"_TimeToken",function(){return Qg}),l.d(x,"EffectLayer",function(){return id}),l.d(x,"EffectLayerSceneComponent",function(){return gh}),l.d(x,"GlowLayer",function(){return Rd}),l.d(x,"HighlightLayer",function(){return af}),l.d(x,"Layer",function(){return Pj}),l.d(x,"LayerSceneComponent",function(){return ih}),l.d(x,"LensFlare",function(){return jh}),l.d(x,"LensFlareSystem",function(){return bf}),l.d(x,"LensFlareSystemSceneComponent",function(){return kh}),l.d(x,"Light",function(){return vc.a}),l.d(x,"ShadowLight",function(){return Md}),l.d(x,"DirectionalLight",function(){return Re}),l.d(x,"HemisphericLight",function(){return Ed.a}),l.d(x,"PointLight",function(){return mh}),l.d(x,"SpotLight",function(){return Se}),l.d(x,"ShadowGenerator",function(){return cf}),l.d(x,"ShadowGeneratorSceneComponent",function(){return lh}),l.d(x,"DefaultLoadingScreen",function(){return nh}),l.d(x,"SceneLoaderProgressEvent",function(){return Sg}),l.d(x,"SceneLoader",function(){return tb}),l.d(x,"SceneLoaderFlags",function(){return jc.a}),l.d(x,"_BabylonLoaderRegistered",function(){return!0}),l.d(x,"ColorCurves",function(){return Wj.a}),l.d(x,"EffectFallbacks",function(){return Ia.c}),l.d(x,"EffectCreationOptions",function(){return Ia.b}),l.d(x,"Effect",function(){return Ia.a}),l.d(x,"FresnelParameters",function(){return wh}),l.d(x,"ImageProcessingConfigurationDefines",function(){return Eb.b}),l.d(x,"ImageProcessingConfiguration",function(){return Eb.a}),l.d(x,"Material",function(){return rb.a}),l.d(x,"MaterialDefines",function(){return Ue.a}),l.d(x,"MaterialHelper",function(){return Ta.a}),l.d(x,"MultiMaterial",function(){return Sd.a}),l.d(x,"PushMaterial",function(){return Ve.a}),l.d(x,"ShaderMaterial",function(){return kf.a}),l.d(x,"StandardMaterialDefines",function(){return Pb.b}),l.d(x,"StandardMaterial",function(){return Pb.a}),l.d(x,"BaseTexture",function(){return ac.a}),l.d(x,"CubeTexture",function(){return bc}),l.d(x,"EquiRectangularCubeTexture",function(){return Ah}),l.d(x,"HDRCubeTexture",function(){return jd}),l.d(x,"InternalTexture",function(){return sb.a}),l.d(x,"MirrorTexture",function(){return Te}),l.d(x,"MultiRenderTarget",function(){return Ch}),l.d(x,"RenderTargetTexture",function(){return Ab}),l.d(x,"Texture",function(){return ra.a}),l.d(x,"UniformBuffer",function(){return xg.a}),l.d(x,"MaterialFlags",function(){return Ra.a}),l.d(x,"BackgroundMaterial",function(){return Mc}),l.d(x,"PBRMaterialDefines",function(){return Xe}),l.d(x,"PBRBaseMaterial",function(){return Qb}),l.d(x,"PBRBaseSimpleMaterial",function(){return jf}),l.d(x,"PBRMaterial",function(){return Ye}),l.d(x,"PBRMetallicRoughnessMaterial",function(){return xh}),l.d(x,"PBRSpecularGlossinessMaterial",function(){return yh}),l.d(x,"ColorGradingTexture",function(){return zh}),l.d(x,"DynamicTexture",function(){return $c}),l.d(x,"ProceduralTexture",function(){return Ud}),l.d(x,"RawCubeTexture",function(){return _j}),l.d(x,"RawTexture",function(){return zc}),l.d(x,"RawTexture3D",function(){return $j}),l.d(x,"RefractionTexture",function(){return ak}),l.d(x,"VideoTexture",function(){return fh}),l.d(x,"HtmlElementTexture",function(){return bk}),l.d(x,"_DDSTextureLoader",function(){return ch}),l.d(x,"_ENVTextureLoader",function(){return dh}),l.d(x,"_KTXTextureLoader",function(){return eh}),l.d(x,"_TGATextureLoader",function(){return Bh}),l.d(x,"CustomProceduralTexture",function(){return Yj}),l.d(x,"NoiseProceduralTexture",function(){return Eh}),l.d(x,"ProceduralTextureSceneComponent",function(){return Dh}),l.d(x,"Scalar",function(){return p.a}),l.d(x,"ToGammaSpace",function(){return j.u}),l.d(x,"ToLinearSpace",function(){return j.v}),l.d(x,"Epsilon",function(){return j.h}),l.d(x,"Color3",function(){return j.e}),l.d(x,"Color4",function(){return j.f}),l.d(x,"Vector2",function(){return j.w}),l.d(x,"Vector3",function(){return j.x}),l.d(x,"Vector4",function(){return j.y}),l.d(x,"Size",function(){return j.r}),l.d(x,"Quaternion",function(){return j.q}),l.d(x,"Matrix",function(){return j.j}),l.d(x,"Plane",function(){return j.n}),l.d(x,"Viewport",function(){return j.z}),l.d(x,"Frustum",function(){return j.i}),l.d(x,"Space",function(){return j.s}),l.d(x,"Axis",function(){return j.c}),l.d(x,"BezierCurve",function(){return j.d}),l.d(x,"Orientation",function(){return j.k}),l.d(x,"Angle",function(){return j.a}),l.d(x,"Arc2",function(){return j.b}),l.d(x,"Path2",function(){return j.l}),l.d(x,"Path3D",function(){return j.m}),l.d(x,"Curve3",function(){return j.g}),l.d(x,"PositionNormalVertex",function(){return j.p}),l.d(x,"PositionNormalTextureVertex",function(){return j.o}),l.d(x,"Tmp",function(){return j.t}),l.d(x,"SphericalHarmonics",function(){return hd.a}),l.d(x,"SphericalPolynomial",function(){return hd.b}),l.d(x,"AbstractMesh",function(){return kb.a}),l.d(x,"Buffer",function(){return na.a}),l.d(x,"VertexBuffer",function(){return na.b}),l.d(x,"CSG",function(){return fk}),l.d(x,"Geometry",function(){return df.a}),l.d(x,"GroundMesh",function(){return Gd}),l.d(x,"TrailMesh",function(){return gk}),l.d(x,"InstancedMesh",function(){return hk.a}),l.d(x,"LinesMesh",function(){return md.b}),l.d(x,"InstancedLinesMesh",function(){return md.a}),l.d(x,"_CreationDataStorage",function(){return Ca.b}),l.d(x,"_InstancesBatch",function(){return Ca.c}),l.d(x,"Mesh",function(){return Ca.a}),l.d(x,"VertexData",function(){return Wa.a}),l.d(x,"MeshBuilder",function(){return kk}),l.d(x,"SimplificationSettings",function(){return lk}),l.d(x,"SimplificationQueue",function(){return Jh}),l.d(x,"SimplificationType",function(){return od}),l.d(x,"SimplicationQueueSceneComponent",function(){return Lh}),l.d(x,"Polygon",function(){return jk}),l.d(x,"PolygonMeshBuilder",function(){return Ih}),l.d(x,"BaseSubMesh",function(){return ld.a}),l.d(x,"SubMesh",function(){return ld.b}),l.d(x,"MeshLODLevel",function(){return qk.a}),l.d(x,"TransformNode",function(){return Od.a}),l.d(x,"BoxBuilder",function(){return cd.a}),l.d(x,"SphereBuilder",function(){return lc.a}),l.d(x,"CylinderBuilder",function(){return ad.a}),l.d(x,"LinesBuilder",function(){return Kb.a}),l.d(x,"PlaneBuilder",function(){return Zg.a}),l.d(x,"DataBuffer",function(){return rk.a}),l.d(x,"WebGLDataBuffer",function(){return sk.a}),l.d(x,"DracoCompression",function(){return ck}),l.d(x,"DiscBuilder",function(){return Vd}),l.d(x,"RibbonBuilder",function(){return Ec}),l.d(x,"HemisphereBuilder",function(){return Nd}),l.d(x,"TorusBuilder",function(){return Je}),l.d(x,"TorusKnotBuilder",function(){return pf}),l.d(x,"PolygonBuilder",function(){return nd}),l.d(x,"ShapeBuilder",function(){return Qc}),l.d(x,"LatheBuilder",function(){return rf}),l.d(x,"GroundBuilder",function(){return Dc}),l.d(x,"TubeBuilder",function(){return sf}),l.d(x,"PolyhedronBuilder",function(){return ed}),l.d(x,"IcoSphereBuilder",function(){return tf}),l.d(x,"DecalBuilder",function(){return uf}),l.d(x,"MorphTarget",function(){return ph}),l.d(x,"MorphTargetManager",function(){return ff}),l.d(x,"Node",function(){return s.a}),l.d(x,"Database",function(){return Mh}),l.d(x,"BaseParticleSystem",function(){return yf}),l.d(x,"GPUParticleSystem",function(){return qd}),l.d(x,"Particle",function(){return Ph}),l.d(x,"ParticleHelper",function(){return Ak}),l.d(x,"ParticleSystem",function(){return Jb}),l.d(x,"_IDoNeedToBeInTheBuild",function(){return 42}),l.d(x,"ParticleSystemSet",function(){return zf}),l.d(x,"SolidParticle",function(){return Af}),l.d(x,"ModelShape",function(){return Bf}),l.d(x,"DepthSortedParticle",function(){return Qh}),l.d(x,"SolidParticleSystem",function(){return Ck}),l.d(x,"SubEmitterType",function(){return Sc}),l.d(x,"SubEmitter",function(){return pd}),l.d(x,"BoxParticleEmitter",function(){return Tc}),l.d(x,"ConeParticleEmitter",function(){return vf}),l.d(x,"CylinderParticleEmitter",function(){return Wd}),l.d(x,"CylinderDirectedParticleEmitter",function(){return Nh}),l.d(x,"HemisphericParticleEmitter",function(){return wf}),l.d(x,"PointParticleEmitter",function(){return Oh}),l.d(x,"SphereParticleEmitter",function(){return Xd}),l.d(x,"SphereDirectedParticleEmitter",function(){return xf}),l.d(x,"PhysicsEngine",function(){return Pc}),l.d(x,"PhysicsEngineSceneComponent",function(){return Rh}),l.d(x,"PhysicsHelper",function(){return Dk}),l.d(x,"PhysicsRadialExplosionEventOptions",function(){return Vc}),l.d(x,"PhysicsUpdraftEventOptions",function(){return Cf}),l.d(x,"PhysicsVortexEventOptions",function(){return Df}),l.d(x,"PhysicsRadialImpulseFalloff",function(){return rd}),l.d(x,"PhysicsUpdraftMode",function(){return Uc}),l.d(x,"PhysicsImpostor",function(){return pb.a}),l.d(x,"PhysicsJoint",function(){return vb.e}),l.d(x,"DistanceJoint",function(){return vb.a}),l.d(x,"MotorEnabledJoint",function(){return vb.d}),l.d(x,"HingeJoint",function(){return vb.c}),l.d(x,"Hinge2Joint",function(){return vb.b}),l.d(x,"CannonJSPlugin",function(){return hf}),l.d(x,"AmmoJSPlugin",function(){return rh}),l.d(x,"OimoJSPlugin",function(){return qh}),l.d(x,"AnaglyphPostProcess",function(){return mg}),l.d(x,"BlackAndWhitePostProcess",function(){return Ik}),l.d(x,"BloomEffect",function(){return Ef}),l.d(x,"BloomMergePostProcess",function(){return Uh}),l.d(x,"BlurPostProcess",function(){return Ib}),l.d(x,"ChromaticAberrationPostProcess",function(){return Vh}),l.d(x,"CircleOfConfusionPostProcess",function(){return Wh}),l.d(x,"ColorCorrectionPostProcess",function(){return Ok}),l.d(x,"ConvolutionPostProcess",function(){return Qk}),l.d(x,"DepthOfFieldBlurPostProcess",function(){return Ff}),l.d(x,"DepthOfFieldEffectBlurLevel",function(){return Fc}),l.d(x,"DepthOfFieldEffect",function(){return Gf}),l.d(x,"DepthOfFieldMergePostProcessOptions",function(){return Sk}),l.d(x,"DepthOfFieldMergePostProcess",function(){return Xh}),l.d(x,"DisplayPassPostProcess",function(){return Uk}),l.d(x,"ExtractHighlightsPostProcess",function(){return Th}),l.d(x,"FilterPostProcess",function(){return Wk}),l.d(x,"FxaaPostProcess",function(){return Yd}),l.d(x,"GrainPostProcess",function(){return Yh}),l.d(x,"HighlightsPostProcess",function(){return $k}),l.d(x,"ImageProcessingPostProcess",function(){return Ie}),l.d(x,"MotionBlurPostProcess",function(){return dl}),l.d(x,"PassPostProcess",function(){return sc}),l.d(x,"PassCubePostProcess",function(){return Ni}),l.d(x,"PostProcess",function(){return Za}),l.d(x,"PostProcessManager",function(){return yg.a}),l.d(x,"RefractionPostProcess",function(){return fl}),l.d(x,"SharpenPostProcess",function(){return _h}),l.d(x,"StereoscopicInterlacePostProcess",function(){return rg}),l.d(x,"TonemappingOperator",function(){return Gc}),l.d(x,"TonemapPostProcess",function(){return ql}),l.d(x,"VolumetricLightScatteringPostProcess",function(){return ul}),l.d(x,"VRDistortionCorrectionPostProcess",function(){return Fe}),l.d(x,"VRMultiviewToSingleviewPostProcess",function(){return He}),l.d(x,"PostProcessRenderEffect",function(){return lb}),l.d(x,"PostProcessRenderPipeline",function(){return Wc}),l.d(x,"PostProcessRenderPipelineManager",function(){return $h}),l.d(x,"PostProcessRenderPipelineManagerSceneComponent",function(){return ai}),l.d(x,"DefaultRenderingPipeline",function(){return bi}),l.d(x,"LensRenderingPipeline",function(){return jl}),l.d(x,"SSAO2RenderingPipeline",function(){return ci}),l.d(x,"SSAORenderingPipeline",function(){return nl}),l.d(x,"StandardRenderingPipeline",function(){return di}),l.d(x,"ReflectionProbe",function(){return sh}),l.d(x,"BoundingBoxRenderer",function(){return ei}),l.d(x,"DepthRenderer",function(){return Hf}),l.d(x,"DepthRendererSceneComponent",function(){return fi}),l.d(x,"EdgesRenderer",function(){return If}),l.d(x,"LineEdgesRenderer",function(){return gi}),l.d(x,"GeometryBufferRenderer",function(){return Zd}),l.d(x,"GeometryBufferRendererSceneComponent",function(){return Zh}),l.d(x,"OutlineRenderer",function(){return hi}),l.d(x,"RenderingGroup",function(){return Bl.a}),l.d(x,"RenderingGroupInfo",function(){return Ge.a}),l.d(x,"RenderingManager",function(){return Ge.b}),l.d(x,"UtilityLayerRenderer",function(){return kc.a}),l.d(x,"Scene",function(){return ja.a}),l.d(x,"SceneComponentConstants",function(){return Pa.a}),l.d(x,"Stage",function(){return Pa.b}),l.d(x,"Sprite",function(){return Cl}),l.d(x,"SpriteManager",function(){return Fl}),l.d(x,"SpriteSceneComponent",function(){return ii}),l.d(x,"_AlphaState",function(){return Jf.a}),l.d(x,"_DepthCullingState",function(){return Jf.b}),l.d(x,"_StencilState",function(){return Jf.c}),l.d(x,"AndOrNotEvaluator",function(){return Gl.a}),l.d(x,"AssetTaskState",function(){return ec}),l.d(x,"AbstractAssetTask",function(){return mc}),l.d(x,"AssetsProgressEvent",function(){return ji}),l.d(x,"MeshAssetTask",function(){return ki}),l.d(x,"TextFileAssetTask",function(){return li}),l.d(x,"BinaryFileAssetTask",function(){return mi}),l.d(x,"ImageAssetTask",function(){return ni}),l.d(x,"TextureAssetTask",function(){return oi}),l.d(x,"CubeTextureAssetTask",function(){return pi}),l.d(x,"HDRCubeTextureAssetTask",function(){return qi}),l.d(x,"EquiRectangularCubeTextureAssetTask",function(){return ri}),l.d(x,"AssetsManager",function(){return Hl}),l.d(x,"DDSTools",function(){return wc}),l.d(x,"expandToProperty",function(){return g.b}),l.d(x,"serialize",function(){return g.c}),l.d(x,"serializeAsTexture",function(){return g.m}),l.d(x,"serializeAsColor3",function(){return g.e}),l.d(x,"serializeAsFresnelParameters",function(){return g.h}),l.d(x,"serializeAsVector2",function(){return g.n}),l.d(x,"serializeAsVector3",function(){return g.o}),l.d(x,"serializeAsMeshReference",function(){return g.k}),l.d(x,"serializeAsColorCurves",function(){return g.g}),l.d(x,"serializeAsColor4",function(){return g.f}),l.d(x,"serializeAsImageProcessingConfiguration",function(){return g.i}),l.d(x,"serializeAsQuaternion",function(){return g.l}),l.d(x,"serializeAsMatrix",function(){return g.j}),l.d(x,"serializeAsCameraReference",function(){return g.d}),l.d(x,"SerializationHelper",function(){return g.a}),l.d(x,"Deferred",function(){return Il}),l.d(x,"EnvironmentTextureTools",function(){return Oc}),l.d(x,"MeshExploder",function(){return Jl}),l.d(x,"FilesInput",function(){return Kl}),l.d(x,"KhronosTextureContainer",function(){return $e}),l.d(x,"EventState",function(){return q.a}),l.d(x,"Observer",function(){return q.d}),l.d(x,"MultiObserver",function(){return q.b}),l.d(x,"Observable",function(){return q.c}),l.d(x,"PerformanceMonitor",function(){return si.a}),l.d(x,"RollingAverage",function(){return si.b}),l.d(x,"PromisePolyfill",function(){return Ll.a}),l.d(x,"SceneOptimization",function(){return fc}),l.d(x,"TextureOptimization",function(){return _d}),l.d(x,"HardwareScalingOptimization",function(){return Lf}),l.d(x,"ShadowsOptimization",function(){return $d}),l.d(x,"PostProcessesOptimization",function(){return ae}),l.d(x,"LensFlaresOptimization",function(){return be}),l.d(x,"CustomOptimization",function(){return ti}),l.d(x,"ParticlesOptimization",function(){return ce}),l.d(x,"RenderTargetsOptimization",function(){return Mf}),l.d(x,"MergeMeshesOptimization",function(){return de}),l.d(x,"SceneOptimizerOptions",function(){return Nf}),l.d(x,"SceneOptimizer",function(){return Ml}),l.d(x,"SceneSerializer",function(){return Nl}),l.d(x,"SmartArray",function(){return ic.a}),l.d(x,"SmartArrayNoDuplicate",function(){return ic.b}),l.d(x,"StringDictionary",function(){return fg.a}),l.d(x,"Tags",function(){return Ol.a}),l.d(x,"TextureTools",function(){return Pl}),l.d(x,"TGATools",function(){return Td}),l.d(x,"ColorGradient",function(){return xa.c}),l.d(x,"Color3Gradient",function(){return xa.b}),l.d(x,"FactorGradient",function(){return xa.d}),l.d(x,"LoadFileError",function(){return xa.e}),l.d(x,"RetryStrategy",function(){return xa.g}),l.d(x,"Tools",function(){return xa.h}),l.d(x,"PerfCounter",function(){return xa.f}),l.d(x,"className",function(){return xa.i}),l.d(x,"AsyncLoop",function(){return xa.a}),l.d(x,"VideoRecorder",function(){return Ql}),l.d(x,"JoystickAxis",function(){return wb}),l.d(x,"VirtualJoystick",function(){return Be}),l.d(x,"WorkerPool",function(){return Fh}),l.d(x,"Logger",function(){return r.a}),l.d(x,"_TypeStore",function(){return I.a}),l.d(x,"FilesInputStore",function(){return Ne.a}),l.d(x,"DeepCopier",function(){return V.a}),l.d(x,"PivotTools",function(){return Tb.a}),l.d(x,"PrecisionDate",function(){return sa.a}),l.d(x,"ScreenshotTools",function(){return Pf}),l.d(x,"WebRequest",function(){return kd.a}),l.d(x,"InspectableType",function(){return Kf}),l.d(x,"CubeMapToSphericalPolynomialTools",function(){return Ze.a}),l.d(x,"HDRTools",function(){return oh}),l.d(x,"PanoramaToCubeMapTools",function(){return ef})},function(Aa,x,l){"use strict";var O="fogFragmentDeclaration",q=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;
uniform vec3 vFogColor;
varying vec3 vFogDistance;
float CalcFogFactor()
{
float fogCoeff=1.0;
float fogStart=vFogInfos.y;
float fogEnd=vFogInfos.z;
float fogDensity=vFogInfos.w;
float fogDistance=length(vFogDistance);
if (FOGMODE_LINEAR == vFogInfos.x)
{
fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);
}
else if (FOGMODE_EXP == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDensity);
}
else if (FOGMODE_EXP2 == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);
}
return clamp(fogCoeff,0.0,1.0);
}
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O=`#ifdef FOG
float fog=CalcFogFactor();
color.rgb=fog*color.rgb+(1.0-fog)*vFogColor;
#endif`;l(5).a.IncludesShadersStore.fogFragment=O},function(Aa,x,l){"use strict";var O="fogVertexDeclaration",q=`#ifdef FOG
varying vec3 vFogDistance;
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="morphTargetsVertexGlobalDeclaration",q=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="morphTargetsVertexDeclaration",q=`#ifdef MORPHTARGETS
attribute vec3 position{X};
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="morphTargetsVertex",q=`#ifdef MORPHTARGETS
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return q.Eval=function(j,I){return"true"===(j=j.match(/\([^\(\)]*\)/g)?j.replace(/\([^\(\)]*\)/g,function(H){return H=H.slice(1,H.length-1),q._HandleParenthesisContent(H,I)}):q._HandleParenthesisContent(j,I))||"false"!==j&&q.Eval(j,I)},q._HandleParenthesisContent=function(j,I){var H;I=I||function(r){return"true"===r};var A=j.split("||");for(var v in A)if(A.hasOwnProperty(v)){var z=q._SimplifyNegation(A[v].trim()),u=z.split("&&");if(u.length>1)for(var w=0;w<u.length;++w){var y=q._SimplifyNegation(u[w].trim());if(!(H="true"!==y&&"false"!==y?"!"===y[0]?!I(y.substring(1)):I(y):"true"===y)){z="false";break}}if(H||"true"===z){H=!0;break}H="true"!==z&&"false"!==z?"!"===z[0]?!I(z.substring(1)):I(z):"true"===z}return H?"true":"false"},q._SimplifyNegation=function(j){return"!true"===(j=(j=j.replace(/^[\s!]+/,function(I){return(I=I.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?j="false":"!false"===j&&(j="true"),j},q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q}),l.d(x,"b",function(){return j});var O=l(47),q=function(){function I(H){void 0===H&&(H=30),this._enabled=!0,this._rollingFrameTime=new j(H)}return I.prototype.sampleFrame=function(H){if(void 0===H&&(H=O.a.Now),this._enabled){if(null!=this._lastFrameTimeMs){var A=H-this._lastFrameTimeMs;this._rollingFrameTime.add(A)}this._lastFrameTimeMs=H}},Object.defineProperty(I.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"averageFPS",{get:function(){return 1000/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"instantaneousFPS",{get:function(){var H=this._rollingFrameTime.history(0);return 0===H?0:1000/H},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),I.prototype.enable=function(){this._enabled=!0},I.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(I.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),I.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},I}(),j=function(){function I(H){this._samples=new Array(H),this.reset()}return I.prototype.add=function(H){var A;if(this.isSaturated()){var v=this._samples[this._pos];A=v-this.average,this.average-=A/(this._sampleCount-1),this._m2-=A*(v-this.average)}else this._sampleCount++;A=H-this.average,this.average+=A/this._sampleCount,this._m2+=A*(H-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=H,this._pos++,this._pos%=this._samples.length},I.prototype.history=function(H){if(H>=this._sampleCount||H>=this._samples.length)return 0;var A=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(A-H)]},I.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},I.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},I.prototype._wrapPosition=function(H){var A=this._samples.length;return(H%A+A)%A},I}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return H});var O,q=l(9);!function(A){A[A.Pending=0]="Pending",A[A.Fulfilled=1]="Fulfilled",A[A.Rejected=2]="Rejected"}(O||(O={}));var j=function(){return function(){this.count=0,this.target=0,this.results=[]}}(),I=function(){function A(v){var z=this;if(this._state=O.Pending,this._children=new Array(),this._rejectWasConsumed=!1,v)try{v(function(u){z._resolve(u)},function(u){z._reject(u)})}catch(u){this._reject(u)}}return Object.defineProperty(A.prototype,"_result",{get:function(){return this._resultValue},set:function(v){this._resultValue=v,this._parent&&void 0===this._parent._result&&(this._parent._result=v)},enumerable:!0,configurable:!0}),A.prototype.catch=function(v){return this.then(void 0,v)},A.prototype.then=function(v,z){var u=this,w=new A();return w._onFulfilled=v,w._onRejected=z,this._children.push(w),w._parent=this,this._state!==O.Pending&&q.h.SetImmediate(function(){if(u._state===O.Fulfilled||u._rejectWasConsumed){var y=w._resolve(u._result);if(null!=y)if(void 0!==y._state){var r=y;w._children.push(r),r._parent=w,w=r}else w._result=y}else w._reject(u._reason)}),w},A.prototype._moveChildren=function(v){var z,u=this;if((z=this._children).push.apply(z,v.splice(0,v.length)),this._children.forEach(function(G){G._parent=u}),this._state===O.Fulfilled)for(var w=0,y=this._children;w<y.length;w++)y[w]._resolve(this._result);else if(this._state===O.Rejected)for(var r=0,o=this._children;r<o.length;r++)o[r]._reject(this._reason)},A.prototype._resolve=function(v){try{this._state=O.Fulfilled;var z=null;if(this._onFulfilled&&(z=this._onFulfilled(v)),null!=z)if(void 0!==z._state){var u=z;u._parent=this,u._moveChildren(this._children),v=u._result}else v=z;this._result=v;for(var w=0,y=this._children;w<y.length;w++)y[w]._resolve(v);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(r){this._reject(r,!0)}},A.prototype._reject=function(v,z){if(void 0===z&&(z=!1),this._state=O.Rejected,this._reason=v,this._onRejected&&!z)try{this._onRejected(v),this._rejectWasConsumed=!0}catch(r){v=r}for(var u=0,w=this._children;u<w.length;u++){var y=w[u];this._rejectWasConsumed?y._resolve(null):y._reject(v)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},A.resolve=function(v){var z=new A();return z._resolve(v),z},A._RegisterForFulfillment=function(v,z,u){v.then(function(w){return z.results[u]=w,z.count++,z.count===z.target&&z.rootPromise._resolve(z.results),null},function(w){z.rootPromise._state!==O.Rejected&&z.rootPromise._reject(w)})},A.all=function(v){var z=new A(),u=new j();if(u.target=v.length,u.rootPromise=z,v.length)for(var w=0;w<v.length;w++)A._RegisterForFulfillment(v[w],u,w);else z._resolve([]);return z},A.race=function(v){var z=new A();if(v.length)for(var u=0,w=v;u<w.length;u++)w[u].then(function(y){return z&&(z._resolve(y),z=null),null},function(y){z&&(z._reject(y),z=null)});return z},A}(),H=function(){function A(){}return A.Apply=function(v){(void 0===v&&(v=!1),v||"undefined"==typeof Promise)&&(window.Promise=I)},A}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){function q(){}return Object.defineProperty(q.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!0,configurable:!0}),q.prototype._handlesSpectorRebuildCallback=function(j){j&&this.program&&j(this.program)},q}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return q});var O=l(0),q=function(){return function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._collider=null,this._oldPositionForCollisions=new O.x(0,0,0),this._diffPositionForCollisions=new O.x(0,0,0)}}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return I});var O=l(28),q=l(0),j=l(3),I=function(){function H(A,v,z,u,w){void 0===z&&(z=null),void 0===u&&(u=null),void 0===w&&(w=null),this.index=A,this._opaqueSubMeshes=new O.a(256),this._transparentSubMeshes=new O.a(256),this._alphaTestSubMeshes=new O.a(256),this._depthOnlySubMeshes=new O.a(256),this._particleSystems=new O.a(256),this._spriteManagers=new O.a(256),this._edgesRenderers=new O.a(16),this._scene=v,this.opaqueSortCompareFn=z,this.alphaTestSortCompareFn=u,this.transparentSortCompareFn=w}return Object.defineProperty(H.prototype,"opaqueSortCompareFn",{set:function(A){this._opaqueSortCompareFn=A,this._renderOpaque=A?this.renderOpaqueSorted:H.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"alphaTestSortCompareFn",{set:function(A){this._alphaTestSortCompareFn=A,this._renderAlphaTest=A?this.renderAlphaTestSorted:H.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"transparentSortCompareFn",{set:function(A){this._transparentSortCompareFn=A||H.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),H.prototype.render=function(A,v,z,u){if(A)A(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var w=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(w.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),w.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var y=w.getStencilBuffer();if(w.setStencilBuffer(!1),v&&this._renderSprites(),z&&this._renderParticles(u),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),w.setAlphaMode(j.a.ALPHA_DISABLE)),w.setStencilBuffer(!1),this._edgesRenderers.length){for(var r=0;r<this._edgesRenderers.length;r++)this._edgesRenderers.data[r].render();w.setAlphaMode(j.a.ALPHA_DISABLE)}w.setStencilBuffer(y)}},H.prototype.renderOpaqueSorted=function(A){return H.renderSorted(A,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},H.prototype.renderAlphaTestSorted=function(A){return H.renderSorted(A,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},H.prototype.renderTransparentSorted=function(A){return H.renderSorted(A,this._transparentSortCompareFn,this._scene.activeCamera,!0)},H.renderSorted=function(A,v,z,u){for(var w,y=0,r=z?z.globalPosition:q.x.Zero();y<A.length;y++)(w=A.data[y])._alphaIndex=w.getMesh().alphaIndex,w._distanceToCamera=w.getBoundingInfo().boundingSphere.centerWorld.subtract(r).length();var o=A.data.slice(0,A.length);for(v&&o.sort(v),y=0;y<o.length;y++){if(w=o[y],u){var G=w.getMaterial();if(G&&G.needDepthPrePass){var M=G.getScene().getEngine();M.setColorWrite(!1),M.setAlphaMode(j.a.ALPHA_DISABLE),w.render(!1),M.setColorWrite(!0)}}w.render(u)}},H.renderUnsorted=function(A){for(var v=0;v<A.length;v++)A.data[v].render(!1)},H.defaultTransparentSortCompare=function(A,v){return A._alphaIndex>v._alphaIndex?1:A._alphaIndex<v._alphaIndex?-1:H.backToFrontSortCompare(A,v)},H.backToFrontSortCompare=function(A,v){return A._distanceToCamera<v._distanceToCamera?1:A._distanceToCamera>v._distanceToCamera?-1:0},H.frontToBackSortCompare=function(A,v){return A._distanceToCamera<v._distanceToCamera?-1:A._distanceToCamera>v._distanceToCamera?1:0},H.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},H.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},H.prototype.dispatch=function(A,v,z){void 0===v&&(v=A.getMesh()),void 0===z&&(z=A.getMaterial()),null!=z&&(z.needAlphaBlendingForMesh(v)?this._transparentSubMeshes.push(A):z.needAlphaTesting()?(z.needDepthPrePass&&this._depthOnlySubMeshes.push(A),this._alphaTestSubMeshes.push(A)):(z.needDepthPrePass&&this._depthOnlySubMeshes.push(A),this._opaqueSubMeshes.push(A)),v._renderingGroup=this,v._edgesRenderer&&v._edgesRenderer.isEnabled&&this._edgesRenderers.push(v._edgesRenderer))},H.prototype.dispatchSprites=function(A){this._spriteManagers.push(A)},H.prototype.dispatchParticles=function(A){this._particleSystems.push(A)},H.prototype._renderParticles=function(A){if(0!==this._particleSystems.length){var v=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var z=0;z<this._particleSystems.length;z++){var u=this._particleSystems.data[z];if(0!==(v&&v.layerMask&u.layerMask)){var w=u.emitter;w.position&&A&&-1===A.indexOf(w)||this._scene._activeParticles.addCount(u.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},H.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var A=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var v=0;v<this._spriteManagers.length;v++){var z=this._spriteManagers.data[v];0!==(A&&A.layerMask&z.layerMask)&&z.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},H}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return O});var O=function(){return function(q,j){this.distance=q,this.mesh=j}}()},function(Aa,x,l){"use strict";l.d(x,"a",function(){return z});var O=l(1),q=l(0),j=l(6),I=l(24),H=l(11),A=l(32),v=l(42);H.a._instancedMeshFactory=function(u,w){return new z(u,w)};var z=function(u){function w(y,r){var o=u.call(this,y,r.getScene())||this;return o._indexInSourceMeshInstanceArray=-1,r.addInstance(o),o._sourceMesh=r,o.position.copyFrom(r.position),o.rotation.copyFrom(r.rotation),o.scaling.copyFrom(r.scaling),r.rotationQuaternion&&(o.rotationQuaternion=r.rotationQuaternion.clone()),o.infiniteDistance=r.infiniteDistance,o.setPivotMatrix(r.getPivotMatrix()),o.refreshBoundingInfo(),o._syncSubMeshes(),o}return O.d(w,u),w.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(w.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!0,configurable:!0}),w.prototype._resyncLightSources=function(){},w.prototype._resyncLighSource=function(y){},w.prototype._removeLightSource=function(y){},Object.defineProperty(w.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(y){this._sourceMesh&&y!==this._sourceMesh.renderingGroupId&&j.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),w.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},w.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(w.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),w.prototype.isReady=function(y){return void 0===y&&(y=!1),this._sourceMesh.isReady(y,!0)},w.prototype.getVerticesData=function(y,r){return this._sourceMesh.getVerticesData(y,r)},w.prototype.setVerticesData=function(y,r,o,G){return this.sourceMesh&&this.sourceMesh.setVerticesData(y,r,o,G),this.sourceMesh},w.prototype.updateVerticesData=function(y,r,o,G){return this.sourceMesh&&this.sourceMesh.updateVerticesData(y,r,o,G),this.sourceMesh},w.prototype.setIndices=function(y,r){return void 0===r&&(r=null),this.sourceMesh&&this.sourceMesh.setIndices(y,r),this.sourceMesh},w.prototype.isVerticesDataPresent=function(y){return this._sourceMesh.isVerticesDataPresent(y)},w.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(w.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),w.prototype.refreshBoundingInfo=function(y){if(void 0===y&&(y=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var r=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(y),r),this},w.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},w.prototype._activate=function(y,r){if(this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,y),r){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0;return!1},w.prototype._postActivate=function(){this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},w.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==v.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var y=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,q.t.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD._masterMesh=y,q.t.Matrix[0]}return u.prototype.getWorldMatrix.call(this)},Object.defineProperty(w.prototype,"isAnInstance",{get:function(){return!0},enumerable:!0,configurable:!0}),w.prototype.getLOD=function(y){if(!y)return this;var r=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(y,r.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},w.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var y=0;y<this._sourceMesh.subMeshes.length;y++)this._sourceMesh.subMeshes[y].clone(this,this._sourceMesh);return this},w.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},w.prototype.clone=function(y,r,o){var G=this._sourceMesh.createInstance(y);if(A.a.DeepCopy(this,G,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),r&&(G.parent=r),!o)for(var M=0;M<this.getScene().meshes.length;M++){var R=this.getScene().meshes[M];R.parent===this&&R.clone(R.name,G)}return G.computeWorldMatrix(!0),G},w.prototype.dispose=function(y,r){void 0===r&&(r=!1),this._sourceMesh.removeInstance(this),u.prototype.dispose.call(this,y,r)},w}(I.a)},function(Aa,x,l){"use strict";var O="shadowsFragmentFunctions",q=`#ifdef SHADOWS
#ifndef SHADOWFLOAT
float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}
#endif
float computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)
{
float mask=smoothstep(1.0-frustumEdgeFalloff,1.0,clamp(dot(clipSpace,clipSpace),0.,1.));
return mix(value,1.0,mask);
}
float computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadow=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadow=textureCube(shadowSampler,directionToLight).x;
#endif
if (depth>shadow)
{
return darkness;
}
return 1.0;
}
float computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
float visibility=1.;
vec3 poissonDisk[4];
poissonDisk[0]=vec3(-1.0,1.0,-1.0);
poissonDisk[1]=vec3(1.0,-1.0,-1.0);
poissonDisk[2]=vec3(-1.0,-1.0,-1.0);
poissonDisk[3]=vec3(1.0,-1.0,1.0);

#ifndef SHADOWFLOAT
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;
#else
if (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;
#endif
return min(1.0,visibility+darkness);
}
float computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return esm;
}
float computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return esm;
}
float computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uv));
#else
float shadow=texture2D(shadowSampler,uv).x;
#endif
if (shadowPixelDepth>shadow)
{
return computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);
}
return 1.;
}
float computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
float visibility=1.;
vec2 poissonDisk[4];
poissonDisk[0]=vec2(-0.94201624,-0.39906216);
poissonDisk[1]=vec2(0.94558609,-0.76890725);
poissonDisk[2]=vec2(-0.094184101,-0.92938870);
poissonDisk[3]=vec2(0.34495938,0.29387760);

#ifndef SHADOWFLOAT
if (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;
#else
if (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;
#endif
return computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);
}
float computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
float computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
#ifdef WEBGL2

float computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float shadow=texture2D(shadowSampler,uvDepth);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



float computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



float computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
const vec3 PoissonSamplers32[64]=vec3[64](
vec3(0.06407013,0.05409927,0.),
vec3(0.7366577,0.5789394,0.),
vec3(-0.6270542,-0.5320278,0.),
vec3(-0.4096107,0.8411095,0.),
vec3(0.6849564,-0.4990818,0.),
vec3(-0.874181,-0.04579735,0.),
vec3(0.9989998,0.0009880066,0.),
vec3(-0.004920578,-0.9151649,0.),
vec3(0.1805763,0.9747483,0.),
vec3(-0.2138451,0.2635818,0.),
vec3(0.109845,0.3884785,0.),
vec3(0.06876755,-0.3581074,0.),
vec3(0.374073,-0.7661266,0.),
vec3(0.3079132,-0.1216763,0.),
vec3(-0.3794335,-0.8271583,0.),
vec3(-0.203878,-0.07715034,0.),
vec3(0.5912697,0.1469799,0.),
vec3(-0.88069,0.3031784,0.),
vec3(0.5040108,0.8283722,0.),
vec3(-0.5844124,0.5494877,0.),
vec3(0.6017799,-0.1726654,0.),
vec3(-0.5554981,0.1559997,0.),
vec3(-0.3016369,-0.3900928,0.),
vec3(-0.5550632,-0.1723762,0.),
vec3(0.925029,0.2995041,0.),
vec3(-0.2473137,0.5538505,0.),
vec3(0.9183037,-0.2862392,0.),
vec3(0.2469421,0.6718712,0.),
vec3(0.3916397,-0.4328209,0.),
vec3(-0.03576927,-0.6220032,0.),
vec3(-0.04661255,0.7995201,0.),
vec3(0.4402924,0.3640312,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.)
);
const vec3 PoissonSamplers64[64]=vec3[64](
vec3(-0.613392,0.617481,0.),
vec3(0.170019,-0.040254,0.),
vec3(-0.299417,0.791925,0.),
vec3(0.645680,0.493210,0.),
vec3(-0.651784,0.717887,0.),
vec3(0.421003,0.027070,0.),
vec3(-0.817194,-0.271096,0.),
vec3(-0.705374,-0.668203,0.),
vec3(0.977050,-0.108615,0.),
vec3(0.063326,0.142369,0.),
vec3(0.203528,0.214331,0.),
vec3(-0.667531,0.326090,0.),
vec3(-0.098422,-0.295755,0.),
vec3(-0.885922,0.215369,0.),
vec3(0.566637,0.605213,0.),
vec3(0.039766,-0.396100,0.),
vec3(0.751946,0.453352,0.),
vec3(0.078707,-0.715323,0.),
vec3(-0.075838,-0.529344,0.),
vec3(0.724479,-0.580798,0.),
vec3(0.222999,-0.215125,0.),
vec3(-0.467574,-0.405438,0.),
vec3(-0.248268,-0.814753,0.),
vec3(0.354411,-0.887570,0.),
vec3(0.175817,0.382366,0.),
vec3(0.487472,-0.063082,0.),
vec3(-0.084078,0.898312,0.),
vec3(0.488876,-0.783441,0.),
vec3(0.470016,0.217933,0.),
vec3(-0.696890,-0.549791,0.),
vec3(-0.149693,0.605762,0.),
vec3(0.034211,0.979980,0.),
vec3(0.503098,-0.308878,0.),
vec3(-0.016205,-0.872921,0.),
vec3(0.385784,-0.393902,0.),
vec3(-0.146886,-0.859249,0.),
vec3(0.643361,0.164098,0.),
vec3(0.634388,-0.049471,0.),
vec3(-0.688894,0.007843,0.),
vec3(0.464034,-0.188818,0.),
vec3(-0.440840,0.137486,0.),
vec3(0.364483,0.511704,0.),
vec3(0.034028,0.325968,0.),
vec3(0.099094,-0.308023,0.),
vec3(0.693960,-0.366253,0.),
vec3(0.678884,-0.204688,0.),
vec3(0.001801,0.780328,0.),
vec3(0.145177,-0.898984,0.),
vec3(0.062655,-0.611866,0.),
vec3(0.315226,-0.604297,0.),
vec3(-0.780145,0.486251,0.),
vec3(-0.371868,0.882138,0.),
vec3(0.200476,0.494430,0.),
vec3(-0.494552,-0.711051,0.),
vec3(0.612476,0.705252,0.),
vec3(-0.578845,-0.768792,0.),
vec3(-0.772454,-0.090976,0.),
vec3(0.504440,0.372295,0.),
vec3(0.155736,0.065157,0.),
vec3(0.391522,0.849605,0.),
vec3(-0.620106,-0.328104,0.),
vec3(0.789239,-0.419965,0.),
vec3(-0.545396,0.538133,0.),
vec3(-0.178564,-0.596057,0.)
);





float computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);
float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec3 offset=poissonSamplers[i];

offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);
shadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
float computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);
}
float computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);
}
float computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);
}
#endif
#endif
`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="reflectionFunction",q=`#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {

vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;
vec3 halfSize=cubeSize*0.5;
vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;
vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;

vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);

float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);

vec3 intersectPositionWS=vertexPos+origVec*distance;

return intersectPositionWS-cubePos;
}
#endif
vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)
{
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vec3 direction=normalize(vDirectionW);
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED
return vec3(1.0-s,t,0);
#else
return vec3(s,t,0);
#endif
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR
vec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition.xyz);
vec3 r=normalize(reflect(cameraToVertex,worldNormal));
r=vec3(reflectionMatrix*vec4(r,0));
float lon=atan(r.z,r.x);
float lat=acos(r.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
#endif
#ifdef REFLECTIONMAP_SPHERICAL
vec3 viewDir=normalize(vec3(view*worldPos));
vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));
vec3 r=reflect(viewDir,viewNormal);
r=vec3(reflectionMatrix*vec4(r,0));
r.z=r.z-1.0;
float m=2.0*length(r);
return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);
#endif
#ifdef REFLECTIONMAP_PLANAR
vec3 viewDir=worldPos.xyz-vEyePosition.xyz;
vec3 coords=normalize(reflect(viewDir,worldNormal));
return vec3(reflectionMatrix*vec4(coords,1));
#endif
#ifdef REFLECTIONMAP_CUBIC
vec3 viewDir=normalize(worldPos.xyz-vEyePosition.xyz);

vec3 coords=reflect(viewDir,worldNormal);
#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
coords=parallaxCorrectNormal(worldPos.xyz,coords,vReflectionSize,vReflectionPosition);
#endif
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
#endif
#ifdef REFLECTIONMAP_PROJECTION
return vec3(reflectionMatrix*(view*worldPos));
#endif
#ifdef REFLECTIONMAP_SKYBOX
return vec3(reflectionMatrix*vec4(vPositionUVW,0));
#endif
#ifdef REFLECTIONMAP_EXPLICIT
return vec3(0,0,0);
#endif
}`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="lightFragment",q=`#ifdef LIGHT{X}
#if defined(SHADOWONLY) || (defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X}))

#else
#ifdef PBR

#ifdef SPOTLIGHT{X}
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(POINTLIGHT{X})
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(HEMILIGHT{X})
preInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(DIRLIGHT{X})
preInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#endif
preInfo.NdotV=NdotV;

#ifdef SPOTLIGHT{X}
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#endif
#elif defined(POINTLIGHT{X})
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
#endif
#else
preInfo.attenuation=1.0;
#endif


#ifdef HEMILIGHT{X}
preInfo.roughness=roughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightDiffuse.a,preInfo.lightDistance);
#endif

#ifdef HEMILIGHT{X}
info.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);
#elif defined(SS_TRANSLUCENCY)
info.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,transmittance);
#else
info.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);
#endif

#ifdef SPECULARTERM
#ifdef ANISOTROPIC
info.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicTangent,anisotropicBitangent,anisotropy,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#else
info.specular=computeSpecularLighting(preInfo,normalW,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif
#endif

#ifdef SHEEN
#ifdef SHEEN_LINKWITHALBEDO

preInfo.roughness=sheenIntensity;
#endif
info.sheen=computeSheenLighting(preInfo,normalW,sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif

#ifdef CLEARCOAT

#ifdef HEMILIGHT{X}
preInfo.roughness=clearCoatRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(clearCoatRoughness,light{X}.vLightDiffuse.a,preInfo.lightDistance);
#endif
info.clearCoat=computeClearCoatLighting(preInfo,clearCoatNormalW,clearCoatAARoughnessFactors.x,clearCoatIntensity,light{X}.vLightDiffuse.rgb);
#ifdef CLEARCOAT_TINT

absorption=computeClearCoatLightingAbsorption(clearCoatNdotVRefract,preInfo.L,clearCoatNormalW,clearCoatColor,clearCoatThickness,clearCoatIntensity);
info.diffuse*=absorption;
#ifdef SPECULARTERM
info.specular*=absorption;
#endif
#endif

info.diffuse*=info.clearCoat.w;
#ifdef SPECULARTERM
info.specular*=info.clearCoat.w*info.clearCoat.w;
#endif
#ifdef SHEEN
info.sheen*=info.clearCoat.w*info.clearCoat.w;
#endif
#endif
#else
#ifdef SPOTLIGHT{X}
info=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,glossiness);
#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})
info=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);
#endif
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
info.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});
#endif
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCLOSEESM{X}
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPOISSON{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#else
#if defined(SHADOWCUBE{X})
shadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#endif
#ifdef SHADOWONLY
#ifndef SHADOWINUSE
#define SHADOWINUSE
#endif
globalShadow+=shadow;
shadowLightCount+=1.0;
#endif
#else
shadow=1.;
#endif
#ifndef SHADOWONLY
#ifdef CUSTOMUSERLIGHTING
diffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);
#ifdef SPECULARTERM
specularBase+=computeCustomSpecularLighting(info,specularBase,shadow);
#endif
#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})
diffuseBase+=lightmapColor*shadow;
#ifdef SPECULARTERM
#ifndef LIGHTMAPNOSPECULAR{X}
specularBase+=info.specular*shadow*lightmapColor;
#endif
#endif
#ifdef CLEARCOAT
#ifndef LIGHTMAPNOSPECULAR{X}
clearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor;
#endif
#endif
#ifdef SHEEN
#ifndef LIGHTMAPNOSPECULAR{X}
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#else
diffuseBase+=info.diffuse*shadow;
#ifdef SPECULARTERM
specularBase+=info.specular*shadow;
#endif
#ifdef CLEARCOAT
clearCoatBase+=info.clearCoat.rgb*shadow;
#endif
#ifdef SHEEN
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#endif
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="logDepthFragment",q=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif`;l(5).a.IncludesShadersStore.fogVertex=O},function(Aa,x,l){"use strict";var O="shadowsVertex",q=`#ifdef SHADOWS
#if defined(SHADOW{X}) && !defined(SHADOWCUBE{X})
vPositionFromLight{X}=lightMatrix{X}*worldPos;
vDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));
#endif
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="logDepthVertex",q=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;
gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x){var l;l=function(){return this}();try{l=l||new Function("return this")()}catch(O){"object"==typeof window&&(l=window)}Aa.exports=l},function(Aa,x,l){"use strict";var O="lightsFragmentFunctions",q=`
struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef NDOTL
float ndl;
#endif
};
lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 lightVectorW;
float attenuation=1.0;
if (lightData.w == 0.)
{
vec3 direction=lightData.xyz-vPositionW;
attenuation=max(0.,1.0-length(direction)/range);
lightVectorW=normalize(direction);
}
else
{
lightVectorW=normalize(-lightData.xyz);
}

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
lightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 direction=lightData.xyz-vPositionW;
vec3 lightVectorW=normalize(direction);
float attenuation=max(0.,1.0-length(direction)/range);

float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));
if (cosAngle>=lightDirection.w)
{
cosAngle=max(0.,pow(cosAngle,lightData.w));
attenuation*=cosAngle;

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
result.diffuse=vec3(0.);
#ifdef SPECULARTERM
result.specular=vec3(0.);
#endif
#ifdef NDOTL
result.ndl=0.;
#endif
return result;
}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {
lightingInfo result;

float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=mix(groundColor,diffuseColor,ndl);
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightData.xyz);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor;
#endif
return result;
}
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return textureColor;
}`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O="bumpFragmentFunctions",q=`#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat4 normalMatrix;
#endif
vec3 perturbNormal(mat3 cotangentFrame,vec2 uv,sampler2D textureSampler,float scale)
{
vec3 map=texture2D(textureSampler,uv).xyz;
map=map*2.0-1.0;
#ifdef NORMALXYSCALE
map=normalize(map*vec3(scale,scale,1.0));
#endif
return normalize(cotangentFrame*map);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)
{

uv=gl_FrontFacing ? uv : -uv;

vec3 dp1=dFdx(p);
vec3 dp2=dFdy(p);
vec2 duv1=dFdx(uv);
vec2 duv2=dFdy(uv);

vec3 dp2perp=cross(dp2,normal);
vec3 dp1perp=cross(normal,dp1);
vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;
vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;

tangent*=tangentSpaceParams.x;
bitangent*=tangentSpaceParams.y;

float invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));
return mat3(tangent*invmax,bitangent*invmax,normal);
}
#endif
#ifdef BUMP
#if BUMPDIRECTUV == 1
#define vBumpUV vMainUV1
#elif BUMPDIRECTUV == 2
#define vBumpUV vMainUV2
#else
varying vec2 vBumpUV;
#endif
uniform sampler2D bumpSampler;
vec3 perturbNormal(mat3 cotangentFrame,vec2 uv)
{
return perturbNormal(cotangentFrame,uv,bumpSampler,vBumpInfos.y);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{
return cotangent_frame(normal,p,uv,vTangentSpaceParams);
}
#endif
#if defined(BUMP) && defined(PARALLAX)
const float minSamples=4.;
const float maxSamples=15.;
const int iMaxSamples=15;

vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {
float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;
parallaxLimit*=parallaxScale;
vec2 vOffsetDir=normalize(vViewDirCoT.xy);
vec2 vMaxOffset=vOffsetDir*parallaxLimit;
float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));
float stepSize=1.0/numSamples;

float currRayHeight=1.0;
vec2 vCurrOffset=vec2(0,0);
vec2 vLastOffset=vec2(0,0);
float lastSampledHeight=1.0;
float currSampledHeight=1.0;
for (int i=0; i<iMaxSamples; i++)
{
currSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;

if (currSampledHeight>currRayHeight)
{
float delta1=currSampledHeight-currRayHeight;
float delta2=(currRayHeight+stepSize)-lastSampledHeight;
float ratio=delta1/(delta1+delta2);
vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;

break;
}
else
{
currRayHeight-=stepSize;
vLastOffset=vCurrOffset;
vCurrOffset+=stepSize*vMaxOffset;
lastSampledHeight=currSampledHeight;
}
}
return vCurrOffset;
}
vec2 parallaxOffset(vec3 viewDir,float heightScale)
{

float height=texture2D(bumpSampler,vBumpUV).w;
vec2 texCoordOffset=heightScale*viewDir.xy*height;
return -texCoordOffset;
}
#endif`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O=`vec2 uvOffset=vec2(0.0,0.0);
#if defined(BUMP) || defined(PARALLAX)
#ifdef NORMALXYSCALE
float normalScale=1.0;
#else
float normalScale=vBumpInfos.y;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);
#endif
#elif defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
mat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));
#endif
#endif
#ifdef PARALLAX
mat3 invTBN=transposeMat3(TBN);
#ifdef PARALLAXOCCLUSION
uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);
#else
uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);
#endif
#endif
#ifdef BUMP
#ifdef OBJECTSPACE_NORMALMAP
normalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);
normalW=normalize(mat3(normalMatrix)*normalW);
#else
normalW=perturbNormal(TBN,vBumpUV+uvOffset);
#endif
#endif`;l(5).a.IncludesShadersStore.bumpFragment=O},function(Aa,x,l){"use strict";var O=`#ifdef DEPTHPREPASS
gl_FragColor=vec4(0.,0.,0.,1.0);
return;
#endif`;l(5).a.IncludesShadersStore.depthPrePass=O},function(Aa,x,l){"use strict";var O="bumpVertexDeclaration",q=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#endif
`;l(5).a.IncludesShadersStore[O]=q},function(Aa,x,l){"use strict";var O=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)
#if defined(TANGENT) && defined(NORMAL)
vec3 tbnNormal=normalize(normalUpdated);
vec3 tbnTangent=normalize(tangentUpdated.xyz);
vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;
vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);
#endif
#endif`;l(5).a.IncludesShadersStore.bumpVertex=O},function(Aa,x,l){"use strict";var O=l(5),q=(l(95),l(89),"colorPixelShader"),j=`#ifdef VERTEXCOLOR
varying vec4 vColor;
#else
uniform vec4 color;
#endif
#include<clipPlaneFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
#ifdef VERTEXCOLOR
gl_FragColor=vColor;
#else
gl_FragColor=color;
#endif
}`;O.a.ShadersStore[q]=j},function(Aa,x,l){"use strict";var O=l(5),q=(l(67),l(96),l(68),l(69),l(70),l(90),"colorVertexShader"),j=`
attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<clipPlaneVertexDeclaration>

#include<instancesDeclaration>
uniform mat4 viewProjection;

#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
gl_Position=viewProjection*worldPos;
#include<clipPlaneVertex>
#ifdef VERTEXCOLOR

vColor=color;
#endif
}`;O.a.ShadersStore[q]=j},function(Aa,x,l){"use strict";(function(O){l.d(x,"b",function(){return u}),l.d(x,"a",function(){return w});var q=l(1),j=l(6),I=l(10),H=l(92),A=l(26),v=l(3),z=l(78),u=function(){return function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4}}(),w=function(y){function r(o){void 0===o&&(o=new u());var G=y.call(this,null)||this;void 0===o.deterministicLockstep&&(o.deterministicLockstep=!1),void 0===o.lockstepMaxSteps&&(o.lockstepMaxSteps=4),G._options=o,G._caps=new I.c(),G._caps.maxTexturesImageUnits=16,G._caps.maxVertexTextureImageUnits=16,G._caps.maxTextureSize=512,G._caps.maxCubemapTextureSize=512,G._caps.maxRenderTextureSize=512,G._caps.maxVertexAttribs=16,G._caps.maxVaryingVectors=16,G._caps.maxFragmentUniformVectors=16,G._caps.maxVertexUniformVectors=16,G._caps.standardDerivatives=!1,G._caps.astc=null,G._caps.s3tc=null,G._caps.pvrtc=null,G._caps.etc1=null,G._caps.etc2=null,G._caps.textureAnisotropicFilterExtension=null,G._caps.maxAnisotropy=0,G._caps.uintIndices=!1,G._caps.fragmentDepthSupported=!1,G._caps.highPrecisionShaderSupported=!0,G._caps.colorBufferFloat=!1,G._caps.textureFloat=!1,G._caps.textureFloatLinearFiltering=!1,G._caps.textureFloatRender=!1,G._caps.textureHalfFloat=!1,G._caps.textureHalfFloatLinearFiltering=!1,G._caps.textureHalfFloatRender=!1,G._caps.textureLOD=!1,G._caps.drawBuffersExtension=!1,G._caps.depthTextureExtension=!1,G._caps.vertexArrayObject=!1,G._caps.instancedArrays=!1,j.a.Log("Babylon.js v"+I.b.Version+" - Null engine");var M="undefined"!=typeof self?self:void 0!==O?O:window;return"undefined"==typeof URL&&(M.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(M.Blob=function(){}),G}return q.d(r,y),r.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},r.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},r.prototype.getHardwareScalingLevel=function(){return 1},r.prototype.createVertexBuffer=function(o){var G=new z.a();return G.references=1,G},r.prototype.createIndexBuffer=function(o){var G=new z.a();return G.references=1,G},r.prototype.clear=function(o,G,M,R){void 0===R&&(R=!1)},r.prototype.getRenderWidth=function(o){return void 0===o&&(o=!1),!o&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},r.prototype.getRenderHeight=function(o){return void 0===o&&(o=!1),!o&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},r.prototype.setViewport=function(o,G,M){this._cachedViewport=o},r.prototype.createShaderProgram=function(o,G,M,R,W){return{__SPECTOR_rebuildProgram:null}},r.prototype.getUniforms=function(o,G){return[]},r.prototype.getAttributes=function(o,G){return[]},r.prototype.bindSamplers=function(o){this._currentEffect=null},r.prototype.enableEffect=function(o){this._currentEffect=o,o.onBind&&o.onBind(o),o._onBindObservable&&o._onBindObservable.notifyObservers(o)},r.prototype.setState=function(o,G,M,R){void 0===G&&(G=0),void 0===R&&(R=!1)},r.prototype.setIntArray=function(o,G){},r.prototype.setIntArray2=function(o,G){},r.prototype.setIntArray3=function(o,G){},r.prototype.setIntArray4=function(o,G){},r.prototype.setFloatArray=function(o,G){},r.prototype.setFloatArray2=function(o,G){},r.prototype.setFloatArray3=function(o,G){},r.prototype.setFloatArray4=function(o,G){},r.prototype.setArray=function(o,G){},r.prototype.setArray2=function(o,G){},r.prototype.setArray3=function(o,G){},r.prototype.setArray4=function(o,G){},r.prototype.setMatrices=function(o,G){},r.prototype.setMatrix=function(o,G){},r.prototype.setMatrix3x3=function(o,G){},r.prototype.setMatrix2x2=function(o,G){},r.prototype.setFloat=function(o,G){},r.prototype.setFloat2=function(o,G,M){},r.prototype.setFloat3=function(o,G,M,R){},r.prototype.setBool=function(o,G){},r.prototype.setFloat4=function(o,G,M,R,W){},r.prototype.setColor3=function(o,G){},r.prototype.setColor4=function(o,G,M){},r.prototype.setAlphaMode=function(o,G){void 0===G&&(G=!1),this._alphaMode!==o&&(this._alphaState.alphaBlend=o!==v.a.ALPHA_DISABLE,G||this.setDepthWrite(o===v.a.ALPHA_DISABLE),this._alphaMode=o)},r.prototype.bindBuffers=function(o,G,M){},r.prototype.wipeCaches=function(o){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,o&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},r.prototype.draw=function(o,G,M,R){},r.prototype.drawElementsType=function(o,G,M,R){},r.prototype.drawArraysType=function(o,G,M,R){},r.prototype._createTexture=function(){return{}},r.prototype._releaseTexture=function(o){},r.prototype.createTexture=function(o,G,M,R,W,Y,X,ea,ca,oa){void 0===W&&(W=v.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===Y&&(Y=null),void 0===X&&(X=null),void 0===ea&&(ea=null);var Z=new A.a(this,A.a.DATASOURCE_URL),T=String(o);return Z.url=T,Z.generateMipMaps=!G,Z.samplingMode=W,Z.invertY=M,Z.baseWidth=this._options.textureSize,Z.baseHeight=this._options.textureSize,Z.width=this._options.textureSize,Z.height=this._options.textureSize,oa&&(Z.format=oa),Z.isReady=!0,Y&&Y(),this._internalTexturesCache.push(Z),Z},r.prototype.createRenderTargetTexture=function(o,G){var M=new H.a();void 0!==G&&"object"==typeof G?(M.generateMipMaps=G.generateMipMaps,M.generateDepthBuffer=void 0===G.generateDepthBuffer||G.generateDepthBuffer,M.generateStencilBuffer=M.generateDepthBuffer&&G.generateStencilBuffer,M.type=void 0===G.type?v.a.TEXTURETYPE_UNSIGNED_INT:G.type,M.samplingMode=void 0===G.samplingMode?v.a.TEXTURE_TRILINEAR_SAMPLINGMODE:G.samplingMode):(M.generateMipMaps=G,M.generateDepthBuffer=!0,M.generateStencilBuffer=!1,M.type=v.a.TEXTURETYPE_UNSIGNED_INT,M.samplingMode=v.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var R=new A.a(this,A.a.DATASOURCE_RENDERTARGET),W=o.width||o,Y=o.height||o;return R._depthStencilBuffer={},R._framebuffer={},R.baseWidth=W,R.baseHeight=Y,R.width=W,R.height=Y,R.isReady=!0,R.samples=1,R.generateMipMaps=!!M.generateMipMaps,R.samplingMode=M.samplingMode,R.type=M.type,R._generateDepthBuffer=M.generateDepthBuffer,R._generateStencilBuffer=!!M.generateStencilBuffer,this._internalTexturesCache.push(R),R},r.prototype.updateTextureSamplingMode=function(o,G){G.samplingMode=o},r.prototype.bindFramebuffer=function(o,G,M,R,W){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=o,this._currentFramebuffer=o._MSAAFramebuffer?o._MSAAFramebuffer:o._framebuffer,this._cachedViewport&&!W&&this.setViewport(this._cachedViewport,M,R)},r.prototype.unBindFramebuffer=function(o,G,M){void 0===G&&(G=!1),this._currentRenderTarget=null,M&&(o._MSAAFramebuffer&&(this._currentFramebuffer=o._framebuffer),M()),this._currentFramebuffer=null},r.prototype.createDynamicVertexBuffer=function(o){var G=new z.a();return G.references=1,G.capacity=1,G},r.prototype.updateDynamicTexture=function(o,G,M,R,W){void 0===R&&(R=!1)},r.prototype.areAllEffectsReady=function(){return!0},r.prototype.getError=function(){return 0},r.prototype._getUnpackAlignement=function(){return 1},r.prototype._unpackFlipY=function(o){},r.prototype.updateDynamicIndexBuffer=function(o,G,M){void 0===M&&(M=0)},r.prototype.updateDynamicVertexBuffer=function(o,G,M,R){},r.prototype._bindTextureDirectly=function(o,G){return this._boundTexturesCache[this._activeChannel]!==G&&(this._boundTexturesCache[this._activeChannel]=G,!0)},r.prototype._bindTexture=function(o,G){o<0||this._bindTextureDirectly(0,G)},r.prototype._releaseBuffer=function(o){return o.references--,0===o.references},r.prototype.releaseEffects=function(){},r.prototype.displayLoadingUI=function(){},r.prototype.hideLoadingUI=function(){},r.prototype._uploadCompressedDataToTextureDirectly=function(o,G,M,R,W,Y,X){void 0===Y&&(Y=0),void 0===X&&(X=0)},r.prototype._uploadDataToTextureDirectly=function(o,G,M,R){void 0===M&&(M=0),void 0===R&&(R=0)},r.prototype._uploadArrayBufferViewToTexture=function(o,G,M,R){void 0===M&&(M=0),void 0===R&&(R=0)},r.prototype._uploadImageToTexture=function(o,G,M,R){void 0===M&&(M=0),void 0===R&&(R=0)},r}(I.b)}).call(this,l(119))},function(Aa,x,l){"use strict";l.r(x),function(O){l.d(x,"Debug",function(){return z});var q=l(97),j=l(74);l.d(x,"AbstractScene",function(){return q.AbstractScene}),l.d(x,"KeepAssets",function(){return q.KeepAssets}),l.d(x,"AssetContainer",function(){return q.AssetContainer}),l.d(x,"Node",function(){return q.Node}),l.d(x,"Scene",function(){return q.Scene}),l.d(x,"SceneComponentConstants",function(){return q.SceneComponentConstants}),l.d(x,"Stage",function(){return q.Stage}),l.d(x,"Action",function(){return q.Action}),l.d(x,"ActionEvent",function(){return q.ActionEvent}),l.d(x,"ActionManager",function(){return q.ActionManager}),l.d(x,"Condition",function(){return q.Condition}),l.d(x,"ValueCondition",function(){return q.ValueCondition}),l.d(x,"PredicateCondition",function(){return q.PredicateCondition}),l.d(x,"StateCondition",function(){return q.StateCondition}),l.d(x,"SwitchBooleanAction",function(){return q.SwitchBooleanAction}),l.d(x,"SetStateAction",function(){return q.SetStateAction}),l.d(x,"SetValueAction",function(){return q.SetValueAction}),l.d(x,"IncrementValueAction",function(){return q.IncrementValueAction}),l.d(x,"PlayAnimationAction",function(){return q.PlayAnimationAction}),l.d(x,"StopAnimationAction",function(){return q.StopAnimationAction}),l.d(x,"DoNothingAction",function(){return q.DoNothingAction}),l.d(x,"CombineAction",function(){return q.CombineAction}),l.d(x,"ExecuteCodeAction",function(){return q.ExecuteCodeAction}),l.d(x,"SetParentAction",function(){return q.SetParentAction}),l.d(x,"PlaySoundAction",function(){return q.PlaySoundAction}),l.d(x,"StopSoundAction",function(){return q.StopSoundAction}),l.d(x,"InterpolateValueAction",function(){return q.InterpolateValueAction}),l.d(x,"Animatable",function(){return q.Animatable}),l.d(x,"_IAnimationState",function(){return q._IAnimationState}),l.d(x,"Animation",function(){return q.Animation}),l.d(x,"TargetedAnimation",function(){return q.TargetedAnimation}),l.d(x,"AnimationGroup",function(){return q.AnimationGroup}),l.d(x,"AnimationPropertiesOverride",function(){return q.AnimationPropertiesOverride}),l.d(x,"EasingFunction",function(){return q.EasingFunction}),l.d(x,"CircleEase",function(){return q.CircleEase}),l.d(x,"BackEase",function(){return q.BackEase}),l.d(x,"BounceEase",function(){return q.BounceEase}),l.d(x,"CubicEase",function(){return q.CubicEase}),l.d(x,"ElasticEase",function(){return q.ElasticEase}),l.d(x,"ExponentialEase",function(){return q.ExponentialEase}),l.d(x,"PowerEase",function(){return q.PowerEase}),l.d(x,"QuadraticEase",function(){return q.QuadraticEase}),l.d(x,"QuarticEase",function(){return q.QuarticEase}),l.d(x,"QuinticEase",function(){return q.QuinticEase}),l.d(x,"SineEase",function(){return q.SineEase}),l.d(x,"BezierCurveEase",function(){return q.BezierCurveEase}),l.d(x,"RuntimeAnimation",function(){return q.RuntimeAnimation}),l.d(x,"AnimationEvent",function(){return q.AnimationEvent}),l.d(x,"AnimationKeyInterpolation",function(){return q.AnimationKeyInterpolation}),l.d(x,"AnimationRange",function(){return q.AnimationRange}),l.d(x,"Analyser",function(){return q.Analyser}),l.d(x,"AudioEngine",function(){return q.AudioEngine}),l.d(x,"AudioSceneComponent",function(){return q.AudioSceneComponent}),l.d(x,"Sound",function(){return q.Sound}),l.d(x,"SoundTrack",function(){return q.SoundTrack}),l.d(x,"WeightedSound",function(){return q.WeightedSound}),l.d(x,"Bone",function(){return q.Bone}),l.d(x,"BoneIKController",function(){return q.BoneIKController}),l.d(x,"BoneLookController",function(){return q.BoneLookController}),l.d(x,"Skeleton",function(){return q.Skeleton}),l.d(x,"CameraInputTypes",function(){return q.CameraInputTypes}),l.d(x,"CameraInputsManager",function(){return q.CameraInputsManager}),l.d(x,"Camera",function(){return q.Camera}),l.d(x,"TargetCamera",function(){return q.TargetCamera}),l.d(x,"FreeCamera",function(){return q.FreeCamera}),l.d(x,"FreeCameraInputsManager",function(){return q.FreeCameraInputsManager}),l.d(x,"TouchCamera",function(){return q.TouchCamera}),l.d(x,"ArcRotateCamera",function(){return q.ArcRotateCamera}),l.d(x,"ArcRotateCameraInputsManager",function(){return q.ArcRotateCameraInputsManager}),l.d(x,"DeviceOrientationCamera",function(){return q.DeviceOrientationCamera}),l.d(x,"FlyCamera",function(){return q.FlyCamera}),l.d(x,"FlyCameraInputsManager",function(){return q.FlyCameraInputsManager}),l.d(x,"FollowCamera",function(){return q.FollowCamera}),l.d(x,"ArcFollowCamera",function(){return q.ArcFollowCamera}),l.d(x,"GamepadCamera",function(){return q.GamepadCamera}),l.d(x,"UniversalCamera",function(){return q.UniversalCamera}),l.d(x,"VirtualJoysticksCamera",function(){return q.VirtualJoysticksCamera}),l.d(x,"Collider",function(){return q.Collider}),l.d(x,"DefaultCollisionCoordinator",function(){return q.DefaultCollisionCoordinator}),l.d(x,"PickingInfo",function(){return q.PickingInfo}),l.d(x,"IntersectionInfo",function(){return q.IntersectionInfo}),l.d(x,"_MeshCollisionData",function(){return q._MeshCollisionData}),l.d(x,"BoundingBox",function(){return q.BoundingBox}),l.d(x,"BoundingInfo",function(){return q.BoundingInfo}),l.d(x,"BoundingSphere",function(){return q.BoundingSphere}),l.d(x,"Ray",function(){return q.Ray}),l.d(x,"AxesViewer",function(){return q.AxesViewer}),l.d(x,"BoneAxesViewer",function(){return q.BoneAxesViewer}),l.d(x,"DebugLayer",function(){return q.DebugLayer}),l.d(x,"PhysicsViewer",function(){return q.PhysicsViewer}),l.d(x,"RayHelper",function(){return q.RayHelper}),l.d(x,"SkeletonViewer",function(){return q.SkeletonViewer}),l.d(x,"Constants",function(){return q.Constants}),l.d(x,"InstancingAttributeInfo",function(){return q.InstancingAttributeInfo}),l.d(x,"DepthTextureCreationOptions",function(){return q.DepthTextureCreationOptions}),l.d(x,"EngineCapabilities",function(){return q.EngineCapabilities}),l.d(x,"Engine",function(){return q.Engine}),l.d(x,"EngineStore",function(){return q.EngineStore}),l.d(x,"NullEngineOptions",function(){return q.NullEngineOptions}),l.d(x,"NullEngine",function(){return q.NullEngine}),l.d(x,"WebGLPipelineContext",function(){return q.WebGLPipelineContext}),l.d(x,"KeyboardEventTypes",function(){return q.KeyboardEventTypes}),l.d(x,"KeyboardInfo",function(){return q.KeyboardInfo}),l.d(x,"KeyboardInfoPre",function(){return q.KeyboardInfoPre}),l.d(x,"PointerEventTypes",function(){return q.PointerEventTypes}),l.d(x,"PointerInfoBase",function(){return q.PointerInfoBase}),l.d(x,"PointerInfoPre",function(){return q.PointerInfoPre}),l.d(x,"PointerInfo",function(){return q.PointerInfo}),l.d(x,"ClipboardEventTypes",function(){return q.ClipboardEventTypes}),l.d(x,"ClipboardInfo",function(){return q.ClipboardInfo}),l.d(x,"DaydreamController",function(){return q.DaydreamController}),l.d(x,"GearVRController",function(){return q.GearVRController}),l.d(x,"GenericController",function(){return q.GenericController}),l.d(x,"OculusTouchController",function(){return q.OculusTouchController}),l.d(x,"PoseEnabledControllerType",function(){return q.PoseEnabledControllerType}),l.d(x,"PoseEnabledControllerHelper",function(){return q.PoseEnabledControllerHelper}),l.d(x,"PoseEnabledController",function(){return q.PoseEnabledController}),l.d(x,"ViveController",function(){return q.ViveController}),l.d(x,"WebVRController",function(){return q.WebVRController}),l.d(x,"WindowsMotionController",function(){return q.WindowsMotionController}),l.d(x,"StickValues",function(){return q.StickValues}),l.d(x,"Gamepad",function(){return q.Gamepad}),l.d(x,"GenericPad",function(){return q.GenericPad}),l.d(x,"GamepadManager",function(){return q.GamepadManager}),l.d(x,"GamepadSystemSceneComponent",function(){return q.GamepadSystemSceneComponent}),l.d(x,"Xbox360Button",function(){return q.Xbox360Button}),l.d(x,"Xbox360Dpad",function(){return q.Xbox360Dpad}),l.d(x,"Xbox360Pad",function(){return q.Xbox360Pad}),l.d(x,"AxisDragGizmo",function(){return q.AxisDragGizmo}),l.d(x,"AxisScaleGizmo",function(){return q.AxisScaleGizmo}),l.d(x,"BoundingBoxGizmo",function(){return q.BoundingBoxGizmo}),l.d(x,"Gizmo",function(){return q.Gizmo}),l.d(x,"GizmoManager",function(){return q.GizmoManager}),l.d(x,"PlaneRotationGizmo",function(){return q.PlaneRotationGizmo}),l.d(x,"PositionGizmo",function(){return q.PositionGizmo}),l.d(x,"RotationGizmo",function(){return q.RotationGizmo}),l.d(x,"ScaleGizmo",function(){return q.ScaleGizmo}),l.d(x,"LightGizmo",function(){return q.LightGizmo}),l.d(x,"EnvironmentHelper",function(){return q.EnvironmentHelper}),l.d(x,"PhotoDome",function(){return q.PhotoDome}),l.d(x,"_forceSceneHelpersToBundle",function(){return q._forceSceneHelpersToBundle}),l.d(x,"VideoDome",function(){return q.VideoDome}),l.d(x,"EngineInstrumentation",function(){return q.EngineInstrumentation}),l.d(x,"SceneInstrumentation",function(){return q.SceneInstrumentation}),l.d(x,"_TimeToken",function(){return q._TimeToken}),l.d(x,"EffectLayer",function(){return q.EffectLayer}),l.d(x,"EffectLayerSceneComponent",function(){return q.EffectLayerSceneComponent}),l.d(x,"GlowLayer",function(){return q.GlowLayer}),l.d(x,"HighlightLayer",function(){return q.HighlightLayer}),l.d(x,"Layer",function(){return q.Layer}),l.d(x,"LayerSceneComponent",function(){return q.LayerSceneComponent}),l.d(x,"LensFlare",function(){return q.LensFlare}),l.d(x,"LensFlareSystem",function(){return q.LensFlareSystem}),l.d(x,"LensFlareSystemSceneComponent",function(){return q.LensFlareSystemSceneComponent}),l.d(x,"Light",function(){return q.Light}),l.d(x,"ShadowLight",function(){return q.ShadowLight}),l.d(x,"DirectionalLight",function(){return q.DirectionalLight}),l.d(x,"HemisphericLight",function(){return q.HemisphericLight}),l.d(x,"PointLight",function(){return q.PointLight}),l.d(x,"SpotLight",function(){return q.SpotLight}),l.d(x,"DefaultLoadingScreen",function(){return q.DefaultLoadingScreen}),l.d(x,"SceneLoaderProgressEvent",function(){return q.SceneLoaderProgressEvent}),l.d(x,"SceneLoader",function(){return q.SceneLoader}),l.d(x,"SceneLoaderFlags",function(){return q.SceneLoaderFlags}),l.d(x,"ColorCurves",function(){return q.ColorCurves}),l.d(x,"EffectFallbacks",function(){return q.EffectFallbacks}),l.d(x,"EffectCreationOptions",function(){return q.EffectCreationOptions}),l.d(x,"Effect",function(){return q.Effect}),l.d(x,"FresnelParameters",function(){return q.FresnelParameters}),l.d(x,"ImageProcessingConfigurationDefines",function(){return q.ImageProcessingConfigurationDefines}),l.d(x,"ImageProcessingConfiguration",function(){return q.ImageProcessingConfiguration}),l.d(x,"Material",function(){return q.Material}),l.d(x,"MaterialDefines",function(){return q.MaterialDefines}),l.d(x,"MaterialHelper",function(){return q.MaterialHelper}),l.d(x,"MultiMaterial",function(){return q.MultiMaterial}),l.d(x,"PushMaterial",function(){return q.PushMaterial}),l.d(x,"ShaderMaterial",function(){return q.ShaderMaterial}),l.d(x,"StandardMaterialDefines",function(){return q.StandardMaterialDefines}),l.d(x,"StandardMaterial",function(){return q.StandardMaterial}),l.d(x,"BaseTexture",function(){return q.BaseTexture}),l.d(x,"CubeTexture",function(){return q.CubeTexture}),l.d(x,"EquiRectangularCubeTexture",function(){return q.EquiRectangularCubeTexture}),l.d(x,"HDRCubeTexture",function(){return q.HDRCubeTexture}),l.d(x,"InternalTexture",function(){return q.InternalTexture}),l.d(x,"MirrorTexture",function(){return q.MirrorTexture}),l.d(x,"MultiRenderTarget",function(){return q.MultiRenderTarget}),l.d(x,"RenderTargetTexture",function(){return q.RenderTargetTexture}),l.d(x,"Texture",function(){return q.Texture}),l.d(x,"UniformBuffer",function(){return q.UniformBuffer}),l.d(x,"MaterialFlags",function(){return q.MaterialFlags}),l.d(x,"Scalar",function(){return q.Scalar}),l.d(x,"ToGammaSpace",function(){return q.ToGammaSpace}),l.d(x,"ToLinearSpace",function(){return q.ToLinearSpace}),l.d(x,"Epsilon",function(){return q.Epsilon}),l.d(x,"Color3",function(){return q.Color3}),l.d(x,"Color4",function(){return q.Color4}),l.d(x,"Vector2",function(){return q.Vector2}),l.d(x,"Vector3",function(){return q.Vector3}),l.d(x,"Vector4",function(){return q.Vector4}),l.d(x,"Size",function(){return q.Size}),l.d(x,"Quaternion",function(){return q.Quaternion}),l.d(x,"Matrix",function(){return q.Matrix}),l.d(x,"Plane",function(){return q.Plane}),l.d(x,"Viewport",function(){return q.Viewport}),l.d(x,"Frustum",function(){return q.Frustum}),l.d(x,"Space",function(){return q.Space}),l.d(x,"Axis",function(){return q.Axis}),l.d(x,"BezierCurve",function(){return q.BezierCurve}),l.d(x,"Orientation",function(){return q.Orientation}),l.d(x,"Angle",function(){return q.Angle}),l.d(x,"Arc2",function(){return q.Arc2}),l.d(x,"Path2",function(){return q.Path2}),l.d(x,"Path3D",function(){return q.Path3D}),l.d(x,"Curve3",function(){return q.Curve3}),l.d(x,"PositionNormalVertex",function(){return q.PositionNormalVertex}),l.d(x,"PositionNormalTextureVertex",function(){return q.PositionNormalTextureVertex}),l.d(x,"Tmp",function(){return q.Tmp}),l.d(x,"SphericalHarmonics",function(){return q.SphericalHarmonics}),l.d(x,"SphericalPolynomial",function(){return q.SphericalPolynomial}),l.d(x,"AbstractMesh",function(){return q.AbstractMesh}),l.d(x,"Buffer",function(){return q.Buffer}),l.d(x,"VertexBuffer",function(){return q.VertexBuffer}),l.d(x,"CSG",function(){return q.CSG}),l.d(x,"Geometry",function(){return q.Geometry}),l.d(x,"GroundMesh",function(){return q.GroundMesh}),l.d(x,"TrailMesh",function(){return q.TrailMesh}),l.d(x,"InstancedMesh",function(){return q.InstancedMesh}),l.d(x,"LinesMesh",function(){return q.LinesMesh}),l.d(x,"InstancedLinesMesh",function(){return q.InstancedLinesMesh}),l.d(x,"_CreationDataStorage",function(){return q._CreationDataStorage}),l.d(x,"_InstancesBatch",function(){return q._InstancesBatch}),l.d(x,"Mesh",function(){return q.Mesh}),l.d(x,"VertexData",function(){return q.VertexData}),l.d(x,"MeshBuilder",function(){return q.MeshBuilder}),l.d(x,"SimplificationSettings",function(){return q.SimplificationSettings}),l.d(x,"SimplificationQueue",function(){return q.SimplificationQueue}),l.d(x,"SimplificationType",function(){return q.SimplificationType}),l.d(x,"SimplicationQueueSceneComponent",function(){return q.SimplicationQueueSceneComponent}),l.d(x,"Polygon",function(){return q.Polygon}),l.d(x,"PolygonMeshBuilder",function(){return q.PolygonMeshBuilder}),l.d(x,"BaseSubMesh",function(){return q.BaseSubMesh}),l.d(x,"SubMesh",function(){return q.SubMesh}),l.d(x,"MeshLODLevel",function(){return q.MeshLODLevel}),l.d(x,"TransformNode",function(){return q.TransformNode}),l.d(x,"BoxBuilder",function(){return q.BoxBuilder}),l.d(x,"SphereBuilder",function(){return q.SphereBuilder}),l.d(x,"CylinderBuilder",function(){return q.CylinderBuilder}),l.d(x,"LinesBuilder",function(){return q.LinesBuilder}),l.d(x,"PlaneBuilder",function(){return q.PlaneBuilder}),l.d(x,"DataBuffer",function(){return q.DataBuffer}),l.d(x,"WebGLDataBuffer",function(){return q.WebGLDataBuffer}),l.d(x,"MorphTarget",function(){return q.MorphTarget}),l.d(x,"MorphTargetManager",function(){return q.MorphTargetManager}),l.d(x,"Database",function(){return q.Database}),l.d(x,"BaseParticleSystem",function(){return q.BaseParticleSystem}),l.d(x,"GPUParticleSystem",function(){return q.GPUParticleSystem}),l.d(x,"Particle",function(){return q.Particle}),l.d(x,"ParticleHelper",function(){return q.ParticleHelper}),l.d(x,"ParticleSystem",function(){return q.ParticleSystem}),l.d(x,"_IDoNeedToBeInTheBuild",function(){return q._IDoNeedToBeInTheBuild}),l.d(x,"ParticleSystemSet",function(){return q.ParticleSystemSet}),l.d(x,"SolidParticle",function(){return q.SolidParticle}),l.d(x,"ModelShape",function(){return q.ModelShape}),l.d(x,"DepthSortedParticle",function(){return q.DepthSortedParticle}),l.d(x,"SolidParticleSystem",function(){return q.SolidParticleSystem}),l.d(x,"SubEmitterType",function(){return q.SubEmitterType}),l.d(x,"SubEmitter",function(){return q.SubEmitter}),l.d(x,"PhysicsEngine",function(){return q.PhysicsEngine}),l.d(x,"PhysicsEngineSceneComponent",function(){return q.PhysicsEngineSceneComponent}),l.d(x,"PhysicsHelper",function(){return q.PhysicsHelper}),l.d(x,"PhysicsRadialExplosionEventOptions",function(){return q.PhysicsRadialExplosionEventOptions}),l.d(x,"PhysicsUpdraftEventOptions",function(){return q.PhysicsUpdraftEventOptions}),l.d(x,"PhysicsVortexEventOptions",function(){return q.PhysicsVortexEventOptions}),l.d(x,"PhysicsRadialImpulseFalloff",function(){return q.PhysicsRadialImpulseFalloff}),l.d(x,"PhysicsUpdraftMode",function(){return q.PhysicsUpdraftMode}),l.d(x,"PhysicsImpostor",function(){return q.PhysicsImpostor}),l.d(x,"PhysicsJoint",function(){return q.PhysicsJoint}),l.d(x,"DistanceJoint",function(){return q.DistanceJoint}),l.d(x,"MotorEnabledJoint",function(){return q.MotorEnabledJoint}),l.d(x,"HingeJoint",function(){return q.HingeJoint}),l.d(x,"Hinge2Joint",function(){return q.Hinge2Joint}),l.d(x,"AnaglyphPostProcess",function(){return q.AnaglyphPostProcess}),l.d(x,"BlackAndWhitePostProcess",function(){return q.BlackAndWhitePostProcess}),l.d(x,"BloomEffect",function(){return q.BloomEffect}),l.d(x,"BloomMergePostProcess",function(){return q.BloomMergePostProcess}),l.d(x,"BlurPostProcess",function(){return q.BlurPostProcess}),l.d(x,"ChromaticAberrationPostProcess",function(){return q.ChromaticAberrationPostProcess}),l.d(x,"CircleOfConfusionPostProcess",function(){return q.CircleOfConfusionPostProcess}),l.d(x,"ColorCorrectionPostProcess",function(){return q.ColorCorrectionPostProcess}),l.d(x,"ConvolutionPostProcess",function(){return q.ConvolutionPostProcess}),l.d(x,"DepthOfFieldBlurPostProcess",function(){return q.DepthOfFieldBlurPostProcess}),l.d(x,"DepthOfFieldEffectBlurLevel",function(){return q.DepthOfFieldEffectBlurLevel}),l.d(x,"DepthOfFieldEffect",function(){return q.DepthOfFieldEffect}),l.d(x,"DepthOfFieldMergePostProcessOptions",function(){return q.DepthOfFieldMergePostProcessOptions}),l.d(x,"DepthOfFieldMergePostProcess",function(){return q.DepthOfFieldMergePostProcess}),l.d(x,"DisplayPassPostProcess",function(){return q.DisplayPassPostProcess}),l.d(x,"ExtractHighlightsPostProcess",function(){return q.ExtractHighlightsPostProcess}),l.d(x,"FilterPostProcess",function(){return q.FilterPostProcess}),l.d(x,"FxaaPostProcess",function(){return q.FxaaPostProcess}),l.d(x,"GrainPostProcess",function(){return q.GrainPostProcess}),l.d(x,"HighlightsPostProcess",function(){return q.HighlightsPostProcess}),l.d(x,"ImageProcessingPostProcess",function(){return q.ImageProcessingPostProcess}),l.d(x,"MotionBlurPostProcess",function(){return q.MotionBlurPostProcess}),l.d(x,"PassPostProcess",function(){return q.PassPostProcess}),l.d(x,"PassCubePostProcess",function(){return q.PassCubePostProcess}),l.d(x,"PostProcess",function(){return q.PostProcess}),l.d(x,"PostProcessManager",function(){return q.PostProcessManager}),l.d(x,"RefractionPostProcess",function(){return q.RefractionPostProcess}),l.d(x,"SharpenPostProcess",function(){return q.SharpenPostProcess}),l.d(x,"StereoscopicInterlacePostProcess",function(){return q.StereoscopicInterlacePostProcess}),l.d(x,"TonemappingOperator",function(){return q.TonemappingOperator}),l.d(x,"TonemapPostProcess",function(){return q.TonemapPostProcess}),l.d(x,"VolumetricLightScatteringPostProcess",function(){return q.VolumetricLightScatteringPostProcess}),l.d(x,"VRDistortionCorrectionPostProcess",function(){return q.VRDistortionCorrectionPostProcess}),l.d(x,"VRMultiviewToSingleviewPostProcess",function(){return q.VRMultiviewToSingleviewPostProcess}),l.d(x,"ReflectionProbe",function(){return q.ReflectionProbe}),l.d(x,"BoundingBoxRenderer",function(){return q.BoundingBoxRenderer}),l.d(x,"DepthRenderer",function(){return q.DepthRenderer}),l.d(x,"DepthRendererSceneComponent",function(){return q.DepthRendererSceneComponent}),l.d(x,"EdgesRenderer",function(){return q.EdgesRenderer}),l.d(x,"LineEdgesRenderer",function(){return q.LineEdgesRenderer}),l.d(x,"GeometryBufferRenderer",function(){return q.GeometryBufferRenderer}),l.d(x,"GeometryBufferRendererSceneComponent",function(){return q.GeometryBufferRendererSceneComponent}),l.d(x,"OutlineRenderer",function(){return q.OutlineRenderer}),l.d(x,"RenderingGroup",function(){return q.RenderingGroup}),l.d(x,"RenderingGroupInfo",function(){return q.RenderingGroupInfo}),l.d(x,"RenderingManager",function(){return q.RenderingManager}),l.d(x,"UtilityLayerRenderer",function(){return q.UtilityLayerRenderer}),l.d(x,"Sprite",function(){return q.Sprite}),l.d(x,"SpriteManager",function(){return q.SpriteManager}),l.d(x,"SpriteSceneComponent",function(){return q.SpriteSceneComponent}),l.d(x,"_AlphaState",function(){return q._AlphaState}),l.d(x,"_DepthCullingState",function(){return q._DepthCullingState}),l.d(x,"_StencilState",function(){return q._StencilState}),l.d(x,"AndOrNotEvaluator",function(){return q.AndOrNotEvaluator}),l.d(x,"AssetTaskState",function(){return q.AssetTaskState}),l.d(x,"AbstractAssetTask",function(){return q.AbstractAssetTask}),l.d(x,"AssetsProgressEvent",function(){return q.AssetsProgressEvent}),l.d(x,"MeshAssetTask",function(){return q.MeshAssetTask}),l.d(x,"TextFileAssetTask",function(){return q.TextFileAssetTask}),l.d(x,"BinaryFileAssetTask",function(){return q.BinaryFileAssetTask}),l.d(x,"ImageAssetTask",function(){return q.ImageAssetTask}),l.d(x,"TextureAssetTask",function(){return q.TextureAssetTask}),l.d(x,"CubeTextureAssetTask",function(){return q.CubeTextureAssetTask}),l.d(x,"HDRCubeTextureAssetTask",function(){return q.HDRCubeTextureAssetTask}),l.d(x,"EquiRectangularCubeTextureAssetTask",function(){return q.EquiRectangularCubeTextureAssetTask}),l.d(x,"AssetsManager",function(){return q.AssetsManager}),l.d(x,"DDSTools",function(){return q.DDSTools}),l.d(x,"expandToProperty",function(){return q.expandToProperty}),l.d(x,"serialize",function(){return q.serialize}),l.d(x,"serializeAsTexture",function(){return q.serializeAsTexture}),l.d(x,"serializeAsColor3",function(){return q.serializeAsColor3}),l.d(x,"serializeAsFresnelParameters",function(){return q.serializeAsFresnelParameters}),l.d(x,"serializeAsVector2",function(){return q.serializeAsVector2}),l.d(x,"serializeAsVector3",function(){return q.serializeAsVector3}),l.d(x,"serializeAsMeshReference",function(){return q.serializeAsMeshReference}),l.d(x,"serializeAsColorCurves",function(){return q.serializeAsColorCurves}),l.d(x,"serializeAsColor4",function(){return q.serializeAsColor4}),l.d(x,"serializeAsImageProcessingConfiguration",function(){return q.serializeAsImageProcessingConfiguration}),l.d(x,"serializeAsQuaternion",function(){return q.serializeAsQuaternion}),l.d(x,"serializeAsMatrix",function(){return q.serializeAsMatrix}),l.d(x,"serializeAsCameraReference",function(){return q.serializeAsCameraReference}),l.d(x,"SerializationHelper",function(){return q.SerializationHelper}),l.d(x,"Deferred",function(){return q.Deferred}),l.d(x,"EnvironmentTextureTools",function(){return q.EnvironmentTextureTools}),l.d(x,"MeshExploder",function(){return q.MeshExploder}),l.d(x,"FilesInput",function(){return q.FilesInput}),l.d(x,"KhronosTextureContainer",function(){return q.KhronosTextureContainer}),l.d(x,"EventState",function(){return q.EventState}),l.d(x,"Observer",function(){return q.Observer}),l.d(x,"MultiObserver",function(){return q.MultiObserver}),l.d(x,"Observable",function(){return q.Observable}),l.d(x,"PerformanceMonitor",function(){return q.PerformanceMonitor}),l.d(x,"RollingAverage",function(){return q.RollingAverage}),l.d(x,"PromisePolyfill",function(){return q.PromisePolyfill}),l.d(x,"SceneOptimization",function(){return q.SceneOptimization}),l.d(x,"TextureOptimization",function(){return q.TextureOptimization}),l.d(x,"HardwareScalingOptimization",function(){return q.HardwareScalingOptimization}),l.d(x,"ShadowsOptimization",function(){return q.ShadowsOptimization}),l.d(x,"PostProcessesOptimization",function(){return q.PostProcessesOptimization}),l.d(x,"LensFlaresOptimization",function(){return q.LensFlaresOptimization}),l.d(x,"CustomOptimization",function(){return q.CustomOptimization}),l.d(x,"ParticlesOptimization",function(){return q.ParticlesOptimization}),l.d(x,"RenderTargetsOptimization",function(){return q.RenderTargetsOptimization}),l.d(x,"MergeMeshesOptimization",function(){return q.MergeMeshesOptimization}),l.d(x,"SceneOptimizerOptions",function(){return q.SceneOptimizerOptions}),l.d(x,"SceneOptimizer",function(){return q.SceneOptimizer}),l.d(x,"SceneSerializer",function(){return q.SceneSerializer}),l.d(x,"SmartArray",function(){return q.SmartArray}),l.d(x,"SmartArrayNoDuplicate",function(){return q.SmartArrayNoDuplicate}),l.d(x,"StringDictionary",function(){return q.StringDictionary}),l.d(x,"Tags",function(){return q.Tags}),l.d(x,"TextureTools",function(){return q.TextureTools}),l.d(x,"TGATools",function(){return q.TGATools}),l.d(x,"ColorGradient",function(){return q.ColorGradient}),l.d(x,"Color3Gradient",function(){return q.Color3Gradient}),l.d(x,"FactorGradient",function(){return q.FactorGradient}),l.d(x,"LoadFileError",function(){return q.LoadFileError}),l.d(x,"RetryStrategy",function(){return q.RetryStrategy}),l.d(x,"Tools",function(){return q.Tools}),l.d(x,"PerfCounter",function(){return q.PerfCounter}),l.d(x,"className",function(){return q.className}),l.d(x,"AsyncLoop",function(){return q.AsyncLoop}),l.d(x,"VideoRecorder",function(){return q.VideoRecorder}),l.d(x,"JoystickAxis",function(){return q.JoystickAxis}),l.d(x,"VirtualJoystick",function(){return q.VirtualJoystick}),l.d(x,"WorkerPool",function(){return q.WorkerPool}),l.d(x,"Logger",function(){return q.Logger}),l.d(x,"_TypeStore",function(){return q._TypeStore}),l.d(x,"FilesInputStore",function(){return q.FilesInputStore}),l.d(x,"DeepCopier",function(){return q.DeepCopier}),l.d(x,"PivotTools",function(){return q.PivotTools}),l.d(x,"PrecisionDate",function(){return q.PrecisionDate}),l.d(x,"ScreenshotTools",function(){return q.ScreenshotTools}),l.d(x,"WebRequest",function(){return q.WebRequest}),l.d(x,"InspectableType",function(){return q.InspectableType}),l.d(x,"AutoRotationBehavior",function(){return q.AutoRotationBehavior}),l.d(x,"BouncingBehavior",function(){return q.BouncingBehavior}),l.d(x,"FramingBehavior",function(){return q.FramingBehavior}),l.d(x,"AttachToBoxBehavior",function(){return q.AttachToBoxBehavior}),l.d(x,"FadeInOutBehavior",function(){return q.FadeInOutBehavior}),l.d(x,"MultiPointerScaleBehavior",function(){return q.MultiPointerScaleBehavior}),l.d(x,"PointerDragBehavior",function(){return q.PointerDragBehavior}),l.d(x,"SixDofDragBehavior",function(){return q.SixDofDragBehavior}),l.d(x,"ArcRotateCameraGamepadInput",function(){return q.ArcRotateCameraGamepadInput}),l.d(x,"ArcRotateCameraKeyboardMoveInput",function(){return q.ArcRotateCameraKeyboardMoveInput}),l.d(x,"ArcRotateCameraMouseWheelInput",function(){return q.ArcRotateCameraMouseWheelInput}),l.d(x,"ArcRotateCameraPointersInput",function(){return q.ArcRotateCameraPointersInput}),l.d(x,"ArcRotateCameraVRDeviceOrientationInput",function(){return q.ArcRotateCameraVRDeviceOrientationInput}),l.d(x,"FlyCameraKeyboardInput",function(){return q.FlyCameraKeyboardInput}),l.d(x,"FlyCameraMouseInput",function(){return q.FlyCameraMouseInput}),l.d(x,"FollowCameraKeyboardMoveInput",function(){return q.FollowCameraKeyboardMoveInput}),l.d(x,"FollowCameraMouseWheelInput",function(){return q.FollowCameraMouseWheelInput}),l.d(x,"FollowCameraPointersInput",function(){return q.FollowCameraPointersInput}),l.d(x,"FreeCameraDeviceOrientationInput",function(){return q.FreeCameraDeviceOrientationInput}),l.d(x,"FreeCameraGamepadInput",function(){return q.FreeCameraGamepadInput}),l.d(x,"FreeCameraKeyboardMoveInput",function(){return q.FreeCameraKeyboardMoveInput}),l.d(x,"FreeCameraMouseInput",function(){return q.FreeCameraMouseInput}),l.d(x,"FreeCameraTouchInput",function(){return q.FreeCameraTouchInput}),l.d(x,"FreeCameraVirtualJoystickInput",function(){return q.FreeCameraVirtualJoystickInput}),l.d(x,"AnaglyphArcRotateCamera",function(){return q.AnaglyphArcRotateCamera}),l.d(x,"AnaglyphFreeCamera",function(){return q.AnaglyphFreeCamera}),l.d(x,"AnaglyphGamepadCamera",function(){return q.AnaglyphGamepadCamera}),l.d(x,"AnaglyphUniversalCamera",function(){return q.AnaglyphUniversalCamera}),l.d(x,"StereoscopicArcRotateCamera",function(){return q.StereoscopicArcRotateCamera}),l.d(x,"StereoscopicFreeCamera",function(){return q.StereoscopicFreeCamera}),l.d(x,"StereoscopicGamepadCamera",function(){return q.StereoscopicGamepadCamera}),l.d(x,"StereoscopicUniversalCamera",function(){return q.StereoscopicUniversalCamera}),l.d(x,"VRCameraMetrics",function(){return q.VRCameraMetrics}),l.d(x,"VRDeviceOrientationArcRotateCamera",function(){return q.VRDeviceOrientationArcRotateCamera}),l.d(x,"VRDeviceOrientationFreeCamera",function(){return q.VRDeviceOrientationFreeCamera}),l.d(x,"VRDeviceOrientationGamepadCamera",function(){return q.VRDeviceOrientationGamepadCamera}),l.d(x,"OnAfterEnteringVRObservableEvent",function(){return q.OnAfterEnteringVRObservableEvent}),l.d(x,"VRExperienceHelper",function(){return q.VRExperienceHelper}),l.d(x,"WebVRFreeCamera",function(){return q.WebVRFreeCamera}),l.d(x,"WebXRCamera",function(){return q.WebXRCamera}),l.d(x,"WebXREnterExitUIButton",function(){return q.WebXREnterExitUIButton}),l.d(x,"WebXREnterExitUIOptions",function(){return q.WebXREnterExitUIOptions}),l.d(x,"WebXREnterExitUI",function(){return q.WebXREnterExitUI}),l.d(x,"WebXRState",function(){return q.WebXRState}),l.d(x,"WebXRExperienceHelper",function(){return q.WebXRExperienceHelper}),l.d(x,"WebXRController",function(){return q.WebXRController}),l.d(x,"WebXRInput",function(){return q.WebXRInput}),l.d(x,"WebXRManagedOutputCanvas",function(){return q.WebXRManagedOutputCanvas}),l.d(x,"WebXRSessionManager",function(){return q.WebXRSessionManager}),l.d(x,"Octree",function(){return q.Octree}),l.d(x,"OctreeBlock",function(){return q.OctreeBlock}),l.d(x,"OctreeSceneComponent",function(){return q.OctreeSceneComponent}),l.d(x,"_OcclusionDataStorage",function(){return q._OcclusionDataStorage}),l.d(x,"_forceTransformFeedbackToBundle",function(){return q._forceTransformFeedbackToBundle}),l.d(x,"ShadowGenerator",function(){return q.ShadowGenerator}),l.d(x,"ShadowGeneratorSceneComponent",function(){return q.ShadowGeneratorSceneComponent}),l.d(x,"_BabylonLoaderRegistered",function(){return q._BabylonLoaderRegistered}),l.d(x,"BackgroundMaterial",function(){return q.BackgroundMaterial}),l.d(x,"PBRMaterialDefines",function(){return q.PBRMaterialDefines}),l.d(x,"PBRBaseMaterial",function(){return q.PBRBaseMaterial}),l.d(x,"PBRBaseSimpleMaterial",function(){return q.PBRBaseSimpleMaterial}),l.d(x,"PBRMaterial",function(){return q.PBRMaterial}),l.d(x,"PBRMetallicRoughnessMaterial",function(){return q.PBRMetallicRoughnessMaterial}),l.d(x,"PBRSpecularGlossinessMaterial",function(){return q.PBRSpecularGlossinessMaterial}),l.d(x,"ColorGradingTexture",function(){return q.ColorGradingTexture}),l.d(x,"DynamicTexture",function(){return q.DynamicTexture}),l.d(x,"ProceduralTexture",function(){return q.ProceduralTexture}),l.d(x,"RawCubeTexture",function(){return q.RawCubeTexture}),l.d(x,"RawTexture",function(){return q.RawTexture}),l.d(x,"RawTexture3D",function(){return q.RawTexture3D}),l.d(x,"RefractionTexture",function(){return q.RefractionTexture}),l.d(x,"VideoTexture",function(){return q.VideoTexture}),l.d(x,"HtmlElementTexture",function(){return q.HtmlElementTexture}),l.d(x,"DracoCompression",function(){return q.DracoCompression}),l.d(x,"DiscBuilder",function(){return q.DiscBuilder}),l.d(x,"RibbonBuilder",function(){return q.RibbonBuilder}),l.d(x,"HemisphereBuilder",function(){return q.HemisphereBuilder}),l.d(x,"TorusBuilder",function(){return q.TorusBuilder}),l.d(x,"TorusKnotBuilder",function(){return q.TorusKnotBuilder}),l.d(x,"PolygonBuilder",function(){return q.PolygonBuilder}),l.d(x,"ShapeBuilder",function(){return q.ShapeBuilder}),l.d(x,"LatheBuilder",function(){return q.LatheBuilder}),l.d(x,"GroundBuilder",function(){return q.GroundBuilder}),l.d(x,"TubeBuilder",function(){return q.TubeBuilder}),l.d(x,"PolyhedronBuilder",function(){return q.PolyhedronBuilder}),l.d(x,"IcoSphereBuilder",function(){return q.IcoSphereBuilder}),l.d(x,"DecalBuilder",function(){return q.DecalBuilder}),l.d(x,"BoxParticleEmitter",function(){return q.BoxParticleEmitter}),l.d(x,"ConeParticleEmitter",function(){return q.ConeParticleEmitter}),l.d(x,"CylinderParticleEmitter",function(){return q.CylinderParticleEmitter}),l.d(x,"CylinderDirectedParticleEmitter",function(){return q.CylinderDirectedParticleEmitter}),l.d(x,"HemisphericParticleEmitter",function(){return q.HemisphericParticleEmitter}),l.d(x,"PointParticleEmitter",function(){return q.PointParticleEmitter}),l.d(x,"SphereParticleEmitter",function(){return q.SphereParticleEmitter}),l.d(x,"SphereDirectedParticleEmitter",function(){return q.SphereDirectedParticleEmitter}),l.d(x,"CannonJSPlugin",function(){return q.CannonJSPlugin}),l.d(x,"AmmoJSPlugin",function(){return q.AmmoJSPlugin}),l.d(x,"OimoJSPlugin",function(){return q.OimoJSPlugin}),l.d(x,"PostProcessRenderEffect",function(){return q.PostProcessRenderEffect}),l.d(x,"PostProcessRenderPipeline",function(){return q.PostProcessRenderPipeline}),l.d(x,"PostProcessRenderPipelineManager",function(){return q.PostProcessRenderPipelineManager}),l.d(x,"PostProcessRenderPipelineManagerSceneComponent",function(){return q.PostProcessRenderPipelineManagerSceneComponent}),l.d(x,"CubeMapToSphericalPolynomialTools",function(){return q.CubeMapToSphericalPolynomialTools}),l.d(x,"HDRTools",function(){return q.HDRTools}),l.d(x,"PanoramaToCubeMapTools",function(){return q.PanoramaToCubeMapTools}),l.d(x,"_DDSTextureLoader",function(){return q._DDSTextureLoader}),l.d(x,"_ENVTextureLoader",function(){return q._ENVTextureLoader}),l.d(x,"_KTXTextureLoader",function(){return q._KTXTextureLoader}),l.d(x,"_TGATextureLoader",function(){return q._TGATextureLoader}),l.d(x,"CustomProceduralTexture",function(){return q.CustomProceduralTexture}),l.d(x,"NoiseProceduralTexture",function(){return q.NoiseProceduralTexture}),l.d(x,"ProceduralTextureSceneComponent",function(){return q.ProceduralTextureSceneComponent}),l.d(x,"DefaultRenderingPipeline",function(){return q.DefaultRenderingPipeline}),l.d(x,"LensRenderingPipeline",function(){return q.LensRenderingPipeline}),l.d(x,"SSAO2RenderingPipeline",function(){return q.SSAO2RenderingPipeline}),l.d(x,"SSAORenderingPipeline",function(){return q.SSAORenderingPipeline}),l.d(x,"StandardRenderingPipeline",function(){return q.StandardRenderingPipeline});var I=void 0!==O?O:"undefined"!=typeof window?window:void 0;if(void 0!==I){I.BABYLON=H,I.BABYLON=I.BABYLON||{};var H=I.BABYLON;H.Debug=H.Debug||{};var A=[];for(var v in j)H.Debug[v]=j[v],A.push(v);for(var v in q)H[v]=q[v]}var z={AxesViewer:j.AxesViewer,BoneAxesViewer:j.BoneAxesViewer,PhysicsViewer:j.PhysicsViewer,SkeletonViewer:j.SkeletonViewer}}.call(this,l(119))}])})},33(za,Ca){!function(Aa,la){"object"==typeof za&&"object"==typeof Ca?Ca.exports=la(k$(35)):"function"==typeof define&&define.amd?define("babylonjs-loaders",["babylonjs"],la):"object"==typeof za?za["babylonjs-loaders"]=la(k$(35)):Aa.LOADERS=la(Aa.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:za,function(Aa){return function(la){var G={};function q(h){if(G[h])return G[h].exports;var y=G[h]={i:h,l:!1,exports:{}};return la[h].call(y.exports,y,y.exports,q),y.l=!0,y.exports}return q.m=la,q.c=G,q.d=function(h,y,D){q.o(h,y)||Object.defineProperty(h,y,{enumerable:!0,get:D})},q.r=function(h){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})},q.t=function(h,y){if(1&y&&(h=q(h)),8&y)return h;if(4&y&&"object"==typeof h&&h&&h.__esModule)return h;var D=Object.create(null);if(q.r(D),Object.defineProperty(D,"default",{enumerable:!0,value:h}),2&y&&"string"!=typeof h)for(var A in h)q.d(D,A,function(l){return h[l]}.bind(null,A));return D},q.n=function(h){var y=h&&h.__esModule?function(){return h.default}:function(){return h};return q.d(y,"a",y),y},q.o=function(h,y){return Object.prototype.hasOwnProperty.call(h,y)},q.p="",q(q.s=18)}([function(la,G){la.exports=Aa},function(la,G,q){"use strict";q.d(G,"a",function(){return D}),q.d(G,"b",function(){return A});var h=q(0),y=q(2),D=function(){function l(){}return l.Get=function(c,a,b){if(!a||null==b||!a[b])throw new Error(c+": Failed to find index ("+b+")");return a[b]},l.Assign=function(c){if(c)for(var a=0;a<c.length;a++)c[a].index=a},l}(),A=function(){function l(c){this._completePromises=new Array(),this._disposed=!1,this._state=null,this._extensions={},this._defaultBabylonMaterialData={},this._requests=new Array(),this._parent=c}return l.RegisterExtension=function(c,a){l.UnregisterExtension(c)&&h.Tools.Warn("Extension with the name '"+c+"' already exists"),l._ExtensionFactories[c]=a,l._ExtensionNames.push(c)},l.UnregisterExtension=function(c){if(!l._ExtensionFactories[c])return!1;delete l._ExtensionFactories[c];var a=l._ExtensionNames.indexOf(c);return-1!==a&&l._ExtensionNames.splice(a,1),!0},Object.defineProperty(l.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"gltf",{get:function(){return this._gltf},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"babylonScene",{get:function(){return this._babylonScene},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!0,configurable:!0}),l.prototype.dispose=function(){if(!this._disposed){this._disposed=!0;for(var c=0,a=this._requests;c<a.length;c++)a[c].abort();for(var b in this._requests.length=0,this._completePromises.length=0,this._extensions)this._extensions[b].dispose&&this._extensions[b].dispose();this._extensions={},delete this._gltf,delete this._babylonScene,delete this._rootBabylonMesh,delete this._progressCallback,this._parent._clear()}},l.prototype.importMeshAsync=function(c,a,b,e,i,j){var f=this;return Promise.resolve().then(function(){f._babylonScene=a,f._rootUrl=e,f._fileName=j||"scene",f._progressCallback=i,f._loadData(b);var o=null;if(c){var u={};if(f._gltf.nodes)for(var r=0,B=f._gltf.nodes;r<B.length;r++){var M=B[r];M.name&&(u[M.name]=M.index)}o=(c instanceof Array?c:[c]).map(function(R){var Z=u[R];if(void 0===Z)throw new Error("Failed to find node '"+R+"'");return Z})}return f._loadAsync(o,function(){return{meshes:f._getMeshes(),particleSystems:[],skeletons:f._getSkeletons(),animationGroups:f._getAnimationGroups()}})})},l.prototype.loadAsync=function(c,a,b,e,i){var j=this;return Promise.resolve().then(function(){return j._babylonScene=c,j._rootUrl=b,j._fileName=i||"scene",j._progressCallback=e,j._loadData(a),j._loadAsync(null,function(){})})},l.prototype._loadAsync=function(c,a){var b=this;return Promise.resolve().then(function(){b._uniqueRootUrl=-1===b._rootUrl.indexOf("file:")&&b._fileName?b._rootUrl:""+b._rootUrl+Date.now()+"/",b._loadExtensions(),b._checkExtensions();var e=y.GLTFLoaderState[y.GLTFLoaderState.LOADING]+" => "+y.GLTFLoaderState[y.GLTFLoaderState.READY],i=y.GLTFLoaderState[y.GLTFLoaderState.LOADING]+" => "+y.GLTFLoaderState[y.GLTFLoaderState.COMPLETE];b._parent._startPerformanceCounter(e),b._parent._startPerformanceCounter(i),b._setState(y.GLTFLoaderState.LOADING),b._extensionsOnLoading();var j=new Array(),f=b._babylonScene.blockMaterialDirtyMechanism;if(b._babylonScene.blockMaterialDirtyMechanism=!0,c)j.push(b.loadSceneAsync("/nodes",{nodes:c,index:-1}));else if(null!=b._gltf.scene||b._gltf.scenes&&b._gltf.scenes[0]){var o=D.Get("/scene",b._gltf.scenes,b._gltf.scene||0);j.push(b.loadSceneAsync("/scenes/"+o.index,o))}b._babylonScene.blockMaterialDirtyMechanism=f,b._parent.compileMaterials&&j.push(b._compileMaterialsAsync()),b._parent.compileShadowGenerators&&j.push(b._compileShadowGeneratorsAsync());var u=Promise.all(j).then(function(){return b._rootBabylonMesh&&b._rootBabylonMesh.setEnabled(!0),b._setState(y.GLTFLoaderState.READY),b._extensionsOnReady(),b._startAnimations(),a()});return u.then(function(){b._parent._endPerformanceCounter(e),h.Tools.SetImmediate(function(){b._disposed||Promise.all(b._completePromises).then(function(){b._parent._endPerformanceCounter(i),b._setState(y.GLTFLoaderState.COMPLETE),b._parent.onCompleteObservable.notifyObservers(void 0),b._parent.onCompleteObservable.clear(),b.dispose()},function(r){b._parent.onErrorObservable.notifyObservers(r),b._parent.onErrorObservable.clear(),b.dispose()})})}),u},function(e){throw b._disposed||(b._parent.onErrorObservable.notifyObservers(e),b._parent.onErrorObservable.clear(),b.dispose()),e})},l.prototype._loadData=function(c){if(this._gltf=c.json,this._setupData(),c.bin){var a=this._gltf.buffers;if(a&&a[0]&&!a[0].uri){var b=a[0];(b.byteLength<c.bin.byteLength-3||b.byteLength>c.bin.byteLength)&&h.Tools.Warn("Binary buffer length ("+b.byteLength+") from JSON does not match chunk length ("+c.bin.byteLength+")"),b._data=Promise.resolve(c.bin)}else h.Tools.Warn("Unexpected BIN chunk")}},l.prototype._setupData=function(){if(D.Assign(this._gltf.accessors),D.Assign(this._gltf.animations),D.Assign(this._gltf.buffers),D.Assign(this._gltf.bufferViews),D.Assign(this._gltf.cameras),D.Assign(this._gltf.images),D.Assign(this._gltf.materials),D.Assign(this._gltf.meshes),D.Assign(this._gltf.nodes),D.Assign(this._gltf.samplers),D.Assign(this._gltf.scenes),D.Assign(this._gltf.skins),D.Assign(this._gltf.textures),this._gltf.nodes){for(var c={},a=0,b=this._gltf.nodes;a<b.length;a++)if((u=b[a]).children)for(var e=0,i=u.children;e<i.length;e++)c[i[e]]=u.index;for(var j=this._createRootNode(),f=0,o=this._gltf.nodes;f<o.length;f++){var u,r=c[(u=o[f]).index];u.parent=void 0===r?j:this._gltf.nodes[r]}}},l.prototype._loadExtensions=function(){for(var c=0,a=l._ExtensionNames;c<a.length;c++){var b=a[c],e=l._ExtensionFactories[b](this);this._extensions[b]=e,this._parent.onExtensionLoadedObservable.notifyObservers(e)}this._parent.onExtensionLoadedObservable.clear()},l.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var c=0,a=this._gltf.extensionsRequired;c<a.length;c++){var b=a[c],e=this._extensions[b];if(!e||!e.enabled)throw new Error("Require extension "+b+" is not available")}},l.prototype._setState=function(c){this._state=c,this.log(y.GLTFLoaderState[this._state])},l.prototype._createRootNode=function(){this._rootBabylonMesh=new h.Mesh("__root__",this._babylonScene),this._rootBabylonMesh.setEnabled(!1);var c={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case y.GLTFLoaderCoordinateSystemMode.AUTO:this._babylonScene.useRightHandedSystem||(c.rotation=[0,1,0,0],c.scale=[1,1,-1],l._LoadTransform(c,this._rootBabylonMesh));break;case y.GLTFLoaderCoordinateSystemMode.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")")}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),c},l.prototype.loadSceneAsync=function(c,a){var b=this,e=this._extensionsLoadSceneAsync(c,a);if(e)return e;var i=new Array();if(this.logOpen(c+" "+(a.name||"")),a.nodes)for(var j=0,f=a.nodes;j<f.length;j++){var o=f[j],u=D.Get(c+"/nodes/"+o,this._gltf.nodes,o);i.push(this.loadNodeAsync("/nodes/"+u.index,u,function(Z){Z.parent=b._rootBabylonMesh}))}if(this._gltf.nodes){for(var r=0,B=this._gltf.nodes;r<B.length;r++)if((u=B[r])._babylonTransformNode&&u._babylonBones)for(var M=0,R=u._babylonBones;M<R.length;M++)R[M].linkTransformNode(u._babylonTransformNode)}return i.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(i).then(function(){})},l.prototype._forEachPrimitive=function(c,a){if(c._primitiveBabylonMeshes)for(var b=0,e=c._primitiveBabylonMeshes;b<e.length;b++)a(e[b])},l.prototype._getMeshes=function(){var c=new Array();c.push(this._rootBabylonMesh);var a=this._gltf.nodes;if(a)for(var b=0,e=a;b<e.length;b++){var i=e[b];this._forEachPrimitive(i,function(j){c.push(j)})}return c},l.prototype._getSkeletons=function(){var c=new Array(),a=this._gltf.skins;if(a)for(var b=0,e=a;b<e.length;b++){var i=e[b];i._data&&c.push(i._data.babylonSkeleton)}return c},l.prototype._getAnimationGroups=function(){var c=new Array(),a=this._gltf.animations;if(a)for(var b=0,e=a;b<e.length;b++){var i=e[b];i._babylonAnimationGroup&&c.push(i._babylonAnimationGroup)}return c},l.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case y.GLTFLoaderAnimationStartMode.NONE:break;case y.GLTFLoaderAnimationStartMode.FIRST:0!==(c=this._getAnimationGroups()).length&&c[0].start(!0);break;case y.GLTFLoaderAnimationStartMode.ALL:for(var c,a=0,b=c=this._getAnimationGroups();a<b.length;a++)b[a].start(!0);break;default:return void h.Tools.Error("Invalid animation start mode ("+this._parent.animationStartMode+")")}},l.prototype.loadNodeAsync=function(c,a,b){var e=this;void 0===b&&(b=function(){});var i=this._extensionsLoadNodeAsync(c,a,b);if(i)return i;if(a._babylonTransformNode)throw new Error(c+": Invalid recursive node hierarchy");var j=new Array();this.logOpen(c+" "+(a.name||""));var f=function(r){if(l.AddPointerMetadata(r,c),l._LoadTransform(a,r),null!=a.camera){var B=D.Get(c+"/camera",e._gltf.cameras,a.camera);j.push(e.loadCameraAsync("/cameras/"+B.index,B,function(ja){ja.parent=r}))}if(a.children)for(var M=0,R=a.children;M<R.length;M++){var Z=R[M],_=D.Get(c+"/children/"+Z,e._gltf.nodes,Z);j.push(e.loadNodeAsync("/nodes/"+_.index,_,function(ja){ja.parent=r}))}b(r)};if(null==a.mesh){var o=a.name||"node"+a.index;a._babylonTransformNode=new h.TransformNode(o,this._babylonScene),f(a._babylonTransformNode)}else{var u=D.Get(c+"/mesh",this._gltf.meshes,a.mesh);j.push(this._loadMeshAsync("/meshes/"+u.index,a,u,f))}return this.logClose(),Promise.all(j).then(function(){return e._forEachPrimitive(a,function(r){r.refreshBoundingInfo(!0)}),a._babylonTransformNode})},l.prototype._loadMeshAsync=function(c,a,b,e){var i=b.primitives;if(!i||!i.length)throw new Error(c+": Primitives are missing");null==i[0].index&&D.Assign(i);var j=new Array();this.logOpen(c+" "+(b.name||""));var f=a.name||"node"+a.index;if(1===i.length){var o=b.primitives[0];j.push(this._loadMeshPrimitiveAsync(c+"/primitives/"+o.index,f,a,b,o,function(M){a._babylonTransformNode=M,a._primitiveBabylonMeshes=[M]}))}else{a._babylonTransformNode=new h.TransformNode(f,this._babylonScene),a._primitiveBabylonMeshes=[];for(var u=0,r=i;u<r.length;u++)o=r[u],j.push(this._loadMeshPrimitiveAsync(c+"/primitives/"+o.index,f+"_primitive"+o.index,a,b,o,function(M){M.parent=a._babylonTransformNode,a._primitiveBabylonMeshes.push(M)}))}if(null!=a.skin){var B=D.Get(c+"/skin",this._gltf.skins,a.skin);j.push(this._loadSkinAsync("/skins/"+B.index,a,B))}return e(a._babylonTransformNode),this.logClose(),Promise.all(j).then(function(){return a._babylonTransformNode})},l.prototype._loadMeshPrimitiveAsync=function(c,a,b,e,i,j){var f=this,o=this._extensionsLoadMeshPrimitiveAsync(c,a,b,e,i,j);if(o)return o;this.logOpen(""+c);var u,r,B=null==b.skin&&!e.primitives[0].targets,M=i._instanceData;if(B&&M)u=M.babylonSourceMesh.createInstance(a),r=M.promise;else{var R=new Array(),Z=new h.Mesh(a,this._babylonScene);this._createMorphTargets(c,b,e,i,Z),R.push(this._loadVertexDataAsync(c,i,Z).then(function(oa){return f._loadMorphTargetsAsync(c,i,Z,oa).then(function(){oa.applyToMesh(Z)})}));var _=l._GetDrawMode(c,i.mode);if(null==i.material){var ja=this._defaultBabylonMaterialData[_];ja||(ja=this._createDefaultMaterial("__GLTFLoader._default",_),this._parent.onMaterialLoadedObservable.notifyObservers(ja),this._defaultBabylonMaterialData[_]=ja),Z.material=ja}else{var ra=D.Get(c+"/material",this._gltf.materials,i.material);R.push(this._loadMaterialAsync("/materials/"+ra.index,ra,Z,_,function(oa){Z.material=oa}))}r=Promise.all(R),B&&(i._instanceData={babylonSourceMesh:Z,promise:r}),u=Z}return l.AddPointerMetadata(u,c),this._parent.onMeshLoadedObservable.notifyObservers(u),j(u),this.logClose(),r.then(function(){return u})},l.prototype._loadVertexDataAsync=function(c,a,b){var e=this,i=this._extensionsLoadVertexDataAsync(c,a,b);if(i)return i;var j=a.attributes;if(!j)throw new Error(c+": Attributes are missing");var f=new Array(),o=new h.Geometry(b.name,this._babylonScene);if(null==a.indices)b.isUnIndexed=!0;else{var u=D.Get(c+"/indices",this._gltf.accessors,a.indices);f.push(this._loadIndicesAccessorAsync("/accessors/"+u.index,u).then(function(B){o.setIndices(B)}))}var r=function(B,M,R){if(null!=j[B]){b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(M)&&b._delayInfo.push(M);var Z=D.Get(c+"/attributes/"+B,e._gltf.accessors,j[B]);f.push(e._loadVertexAccessorAsync("/accessors/"+Z.index,Z,M).then(function(_){o.setVerticesBuffer(_,Z.count)})),R&&R(Z)}};return r("POSITION",h.VertexBuffer.PositionKind),r("NORMAL",h.VertexBuffer.NormalKind),r("TANGENT",h.VertexBuffer.TangentKind),r("TEXCOORD_0",h.VertexBuffer.UVKind),r("TEXCOORD_1",h.VertexBuffer.UV2Kind),r("JOINTS_0",h.VertexBuffer.MatricesIndicesKind),r("WEIGHTS_0",h.VertexBuffer.MatricesWeightsKind),r("COLOR_0",h.VertexBuffer.ColorKind,function(B){"VEC4"===B.type&&(b.hasVertexAlpha=!0)}),Promise.all(f).then(function(){return o})},l.prototype._createMorphTargets=function(c,a,b,e,i){if(e.targets){if(null==a._numMorphTargets)a._numMorphTargets=e.targets.length;else if(e.targets.length!==a._numMorphTargets)throw new Error(c+": Primitives do not have the same number of targets");i.morphTargetManager=new h.MorphTargetManager();for(var j=0;j<e.targets.length;j++){var f=a.weights?a.weights[j]:b.weights?b.weights[j]:0;i.morphTargetManager.addTarget(new h.MorphTarget("morphTarget"+j,f))}}},l.prototype._loadMorphTargetsAsync=function(c,a,b,e){if(!a.targets)return Promise.resolve();for(var i=new Array(),j=b.morphTargetManager,f=0;f<j.numTargets;f++){var o=j.getTarget(f);i.push(this._loadMorphTargetVertexDataAsync(c+"/targets/"+f,e,a.targets[f],o))}return Promise.all(i).then(function(){})},l.prototype._loadMorphTargetVertexDataAsync=function(c,a,b,e){var i=this,j=new Array(),f=function(o,u,r){if(null!=b[o]){var B=a.getVertexBuffer(u);if(B){var M=D.Get(c+"/"+o,i._gltf.accessors,b[o]);j.push(i._loadFloatAccessorAsync("/accessors/"+M.index,M).then(function(R){r(B,R)}))}}};return f("POSITION",h.VertexBuffer.PositionKind,function(o,u){o.forEach(u.length,function(r,B){u[B]+=r}),e.setPositions(u)}),f("NORMAL",h.VertexBuffer.NormalKind,function(o,u){o.forEach(u.length,function(r,B){u[B]+=r}),e.setNormals(u)}),f("TANGENT",h.VertexBuffer.TangentKind,function(o,u){var r=0;o.forEach(u.length/3*4,function(B,M){(M+1)%4!=0&&(u[r++]+=B)}),e.setTangents(u)}),Promise.all(j).then(function(){})},l._LoadTransform=function(c,a){if(null==c.skin){var b=h.Vector3.Zero(),e=h.Quaternion.Identity(),i=h.Vector3.One();c.matrix?h.Matrix.FromArray(c.matrix).decompose(i,e,b):(c.translation&&(b=h.Vector3.FromArray(c.translation)),c.rotation&&(e=h.Quaternion.FromArray(c.rotation)),c.scale&&(i=h.Vector3.FromArray(c.scale))),a.position=b,a.rotationQuaternion=e,a.scaling=i}},l.prototype._loadSkinAsync=function(c,a,b){var e=this,i=this._extensionsLoadSkinAsync(c,a,b);if(i)return i;var j=function(r){e._forEachPrimitive(a,function(B){B.skeleton=r})};if(b._data)return j(b._data.babylonSkeleton),b._data.promise;var f="skeleton"+b.index,o=new h.Skeleton(b.name||f,f,this._babylonScene);o.overrideMesh=this._rootBabylonMesh,this._loadBones(c,b,o),j(o);var u=this._loadSkinInverseBindMatricesDataAsync(c,b).then(function(r){e._updateBoneMatrices(o,r)});return b._data={babylonSkeleton:o,promise:u},u},l.prototype._loadBones=function(c,a,b){for(var e={},i=0,j=a.joints;i<j.length;i++){var f=j[i],o=D.Get(c+"/joints/"+f,this._gltf.nodes,f);this._loadBone(o,a,b,e)}},l.prototype._loadBone=function(c,a,b,e){var i=e[c.index];if(i)return i;var j=null;c.parent&&c.parent._babylonTransformNode!==this._rootBabylonMesh&&(j=this._loadBone(c.parent,a,b,e));var f=a.joints.indexOf(c.index);return i=new h.Bone(c.name||"joint"+c.index,b,j,this._getNodeMatrix(c),null,null,f),e[c.index]=i,c._babylonBones=c._babylonBones||[],c._babylonBones.push(i),i},l.prototype._loadSkinInverseBindMatricesDataAsync=function(c,a){if(null==a.inverseBindMatrices)return Promise.resolve(null);var b=D.Get(c+"/inverseBindMatrices",this._gltf.accessors,a.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/"+b.index,b)},l.prototype._updateBoneMatrices=function(c,a){for(var b=0,e=c.bones;b<e.length;b++){var i=e[b],j=h.Matrix.Identity(),f=i._index;a&&-1!==f&&(h.Matrix.FromArrayToRef(a,16*f,j),j.invertToRef(j));var o=i.getParent();o&&j.multiplyToRef(o.getInvertedAbsoluteTransform(),j),i.updateMatrix(j,!1,!1),i._updateDifferenceMatrix(void 0,!1)}},l.prototype._getNodeMatrix=function(c){return c.matrix?h.Matrix.FromArray(c.matrix):h.Matrix.Compose(c.scale?h.Vector3.FromArray(c.scale):h.Vector3.One(),c.rotation?h.Quaternion.FromArray(c.rotation):h.Quaternion.Identity(),c.translation?h.Vector3.FromArray(c.translation):h.Vector3.Zero())},l.prototype.loadCameraAsync=function(c,a,b){void 0===b&&(b=function(){});var e=this._extensionsLoadCameraAsync(c,a,b);if(e)return e;var i=new Array();this.logOpen(c+" "+(a.name||""));var j=new h.FreeCamera(a.name||"camera"+a.index,h.Vector3.Zero(),this._babylonScene,!1);switch(j.rotation=new h.Vector3(0,Math.PI,0),a.type){case"perspective":var f=a.perspective;if(!f)throw new Error(c+": Camera perspective properties are missing");j.fov=f.yfov,j.minZ=f.znear,j.maxZ=f.zfar||Number.MAX_VALUE;break;case"orthographic":if(!a.orthographic)throw new Error(c+": Camera orthographic properties are missing");j.mode=h.Camera.ORTHOGRAPHIC_CAMERA,j.orthoLeft=-a.orthographic.xmag,j.orthoRight=a.orthographic.xmag,j.orthoBottom=-a.orthographic.ymag,j.orthoTop=a.orthographic.ymag,j.minZ=a.orthographic.znear,j.maxZ=a.orthographic.zfar;break;default:throw new Error(c+": Invalid camera type ("+a.type+")")}return l.AddPointerMetadata(j,c),this._parent.onCameraLoadedObservable.notifyObservers(j),b(j),Promise.all(i).then(function(){return j})},l.prototype._loadAnimationsAsync=function(){var c=this._gltf.animations;if(!c)return Promise.resolve();for(var a=new Array(),b=0;b<c.length;b++){var e=c[b];a.push(this.loadAnimationAsync("/animations/"+e.index,e))}return Promise.all(a).then(function(){})},l.prototype.loadAnimationAsync=function(c,a){var b=this._extensionsLoadAnimationAsync(c,a);if(b)return b;var e=new h.AnimationGroup(a.name||"animation"+a.index,this._babylonScene);a._babylonAnimationGroup=e;var i=new Array();D.Assign(a.channels),D.Assign(a.samplers);for(var j=0,f=a.channels;j<f.length;j++){var o=f[j];i.push(this._loadAnimationChannelAsync(c+"/channels/"+o.index,c,a,o,e))}return Promise.all(i).then(function(){return e.normalize(0),e})},l.prototype._loadAnimationChannelAsync=function(c,a,b,e,i,j){var f=this;if(void 0===j&&(j=null),null==e.target.node)return Promise.resolve();var o=D.Get(c+"/target/node",this._gltf.nodes,e.target.node);if("weights"===e.target.path&&!o._numMorphTargets||"weights"!==e.target.path&&!o._babylonTransformNode)return Promise.resolve();var u=D.Get(c+"/sampler",b.samplers,e.sampler);return this._loadAnimationSamplerAsync(a+"/samplers/"+e.sampler,u).then(function(r){var B,M;switch(e.target.path){case"translation":B="position",M=h.Animation.ANIMATIONTYPE_VECTOR3;break;case"rotation":B="rotationQuaternion",M=h.Animation.ANIMATIONTYPE_QUATERNION;break;case"scale":B="scaling",M=h.Animation.ANIMATIONTYPE_VECTOR3;break;case"weights":B="influence",M=h.Animation.ANIMATIONTYPE_FLOAT;break;default:throw new Error(c+"/target/path: Invalid value ("+e.target.path+")")}var R,Z,_=0;switch(B){case"position":R=function(){var x=h.Vector3.FromArray(r.output,_);return _+=3,x};break;case"rotationQuaternion":R=function(){var x=h.Quaternion.FromArray(r.output,_);return _+=4,x};break;case"scaling":R=function(){var x=h.Vector3.FromArray(r.output,_);return _+=3,x};break;case"influence":R=function(){for(var x=new Array(o._numMorphTargets),v=0;v<o._numMorphTargets;v++)x[v]=r.output[_++];return x}}switch(r.interpolation){case"STEP":Z=function(x){return{frame:r.input[x],value:R(),interpolation:h.AnimationKeyInterpolation.STEP}};break;case"LINEAR":Z=function(x){return{frame:r.input[x],value:R()}};break;case"CUBICSPLINE":Z=function(x){return{frame:r.input[x],inTangent:R(),value:R(),outTangent:R()}}}for(var ja=new Array(r.input.length),ra=0;ra<r.input.length;ra++)ja[ra]=Z(ra);if("influence"===B)for(var oa=function(x){var v=i.name+"_channel"+i.targetedAnimations.length,H=new h.Animation(v,B,1,M);H.setKeys(ja.map(function(E){return{frame:E.frame,inTangent:E.inTangent?E.inTangent[x]:void 0,value:E.value[x],outTangent:E.outTangent?E.outTangent[x]:void 0}})),f._forEachPrimitive(o,function(E){var I=E.morphTargetManager.getTarget(x),P=H.clone();I.animations.push(P),i.addTargetedAnimation(P,I)})},F=0;F<o._numMorphTargets;F++)oa(F);else{var z=i.name+"_channel"+i.targetedAnimations.length,p=new h.Animation(z,B,1,M);p.setKeys(ja),null!=j&&null!=j.animations?(j.animations.push(p),i.addTargetedAnimation(p,j)):(o._babylonTransformNode.animations.push(p),i.addTargetedAnimation(p,o._babylonTransformNode))}})},l.prototype._loadAnimationSamplerAsync=function(c,a){if(a._data)return a._data;var b=a.interpolation||"LINEAR";switch(b){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(c+"/interpolation: Invalid value ("+a.interpolation+")")}var e=D.Get(c+"/input",this._gltf.accessors,a.input),i=D.Get(c+"/output",this._gltf.accessors,a.output);return a._data=Promise.all([this._loadFloatAccessorAsync("/accessors/"+e.index,e),this._loadFloatAccessorAsync("/accessors/"+i.index,i)]).then(function(j){var f=j[0],o=j[1];return{input:f,interpolation:b,output:o}}),a._data},l.prototype._loadBufferAsync=function(c,a){if(a._data)return a._data;if(!a.uri)throw new Error(c+"/uri: Value is missing");return a._data=this.loadUriAsync(c+"/uri",a,a.uri),a._data},l.prototype.loadBufferViewAsync=function(c,a){if(a._data)return a._data;var b=D.Get(c+"/buffer",this._gltf.buffers,a.buffer);return a._data=this._loadBufferAsync("/buffers/"+b.index,b).then(function(e){try{return new Uint8Array(e.buffer,e.byteOffset+(a.byteOffset||0),a.byteLength)}catch(i){throw new Error(c+": "+i.message)}}),a._data},l.prototype._loadIndicesAccessorAsync=function(c,a){if("SCALAR"!==a.type)throw new Error(c+"/type: Invalid value "+a.type);if(5121!==a.componentType&&5123!==a.componentType&&5125!==a.componentType)throw new Error(c+"/componentType: Invalid value "+a.componentType);if(a._data)return a._data;var b=D.Get(c+"/bufferView",this._gltf.bufferViews,a.bufferView);return a._data=this.loadBufferViewAsync("/bufferViews/"+b.index,b).then(function(e){return l._GetTypedArray(c,a.componentType,e,a.byteOffset,a.count)}),a._data},l.prototype._loadFloatAccessorAsync=function(c,a){var b=this;if(5126!==a.componentType)throw new Error("Invalid component type "+a.componentType);if(a._data)return a._data;var e=l._GetNumComponents(c,a.type),i=e*a.count;if(null==a.bufferView)a._data=Promise.resolve(new Float32Array(i));else{var j=D.Get(c+"/bufferView",this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync("/bufferViews/"+j.index,j).then(function(o){return l._GetTypedArray(c,a.componentType,o,a.byteOffset,i)})}if(a.sparse){var f=a.sparse;a._data=a._data.then(function(o){var u=o,r=D.Get(c+"/sparse/indices/bufferView",b._gltf.bufferViews,f.indices.bufferView),B=D.Get(c+"/sparse/values/bufferView",b._gltf.bufferViews,f.values.bufferView);return Promise.all([b.loadBufferViewAsync("/bufferViews/"+r.index,r),b.loadBufferViewAsync("/bufferViews/"+B.index,B)]).then(function(M){for(var R=M[0],Z=M[1],_=l._GetTypedArray(c+"/sparse/indices",f.indices.componentType,R,f.indices.byteOffset,f.count),ja=l._GetTypedArray(c+"/sparse/values",a.componentType,Z,f.values.byteOffset,e*f.count),ra=0,oa=0;oa<_.length;oa++)for(var F=_[oa]*e,z=0;z<e;z++)u[F++]=ja[ra++];return u})})}return a._data},l.prototype._loadVertexBufferViewAsync=function(c,a){var b=this;return c._babylonBuffer?c._babylonBuffer:(c._babylonBuffer=this.loadBufferViewAsync("/bufferViews/"+c.index,c).then(function(e){return new h.Buffer(b._babylonScene.getEngine(),e,!1)}),c._babylonBuffer)},l.prototype._loadVertexAccessorAsync=function(c,a,b){var e=this;if(a._babylonVertexBuffer)return a._babylonVertexBuffer;if(a.sparse)a._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+a.index,a).then(function(j){return new h.VertexBuffer(e._babylonScene.getEngine(),j,b,!1)});else if(a.byteOffset&&a.byteOffset%h.VertexBuffer.GetTypeByteLength(a.componentType)!=0)h.Tools.Warn("Accessor byte offset is not a multiple of component type byte length"),a._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+a.index,a).then(function(j){return new h.VertexBuffer(e._babylonScene.getEngine(),j,b,!1)});else{var i=D.Get(c+"/bufferView",this._gltf.bufferViews,a.bufferView);a._babylonVertexBuffer=this._loadVertexBufferViewAsync(i,b).then(function(j){var f=l._GetNumComponents(c,a.type);return new h.VertexBuffer(e._babylonScene.getEngine(),j,b,!1,!1,i.byteStride,!1,a.byteOffset,f,a.componentType,a.normalized,!0)})}return a._babylonVertexBuffer},l.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(c,a,b){if(!(b instanceof h.PBRMaterial))throw new Error(c+": Material type not supported");var e=new Array();return a&&(a.baseColorFactor?(b.albedoColor=h.Color3.FromArray(a.baseColorFactor),b.alpha=a.baseColorFactor[3]):b.albedoColor=h.Color3.White(),b.metallic=null==a.metallicFactor?1:a.metallicFactor,b.roughness=null==a.roughnessFactor?1:a.roughnessFactor,a.baseColorTexture&&e.push(this.loadTextureInfoAsync(c+"/baseColorTexture",a.baseColorTexture,function(i){i.name=b.name+" (Base Color)",b.albedoTexture=i})),a.metallicRoughnessTexture&&(e.push(this.loadTextureInfoAsync(c+"/metallicRoughnessTexture",a.metallicRoughnessTexture,function(i){i.name=b.name+" (Metallic Roughness)",b.metallicTexture=i})),b.useMetallnessFromMetallicTextureBlue=!0,b.useRoughnessFromMetallicTextureGreen=!0,b.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(e).then(function(){})},l.prototype._loadMaterialAsync=function(c,a,b,e,i){void 0===i&&(i=function(){});var j=this._extensionsLoadMaterialAsync(c,a,b,e,i);if(j)return j;a._data=a._data||{};var f=a._data[e];if(!f){this.logOpen(c+" "+(a.name||""));var o=this.createMaterial(c,a,e);f={babylonMaterial:o,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(c,a,o)},a._data[e]=f,l.AddPointerMetadata(o,c),this._parent.onMaterialLoadedObservable.notifyObservers(o),this.logClose()}return f.babylonMeshes.push(b),b.onDisposeObservable.addOnce(function(){var u=f.babylonMeshes.indexOf(b);-1!==u&&f.babylonMeshes.splice(u,1)}),i(f.babylonMaterial),f.promise.then(function(){return f.babylonMaterial})},l.prototype._createDefaultMaterial=function(c,a){var b=new h.PBRMaterial(c,this._babylonScene);return b.sideOrientation=this._babylonScene.useRightHandedSystem?h.Material.CounterClockWiseSideOrientation:h.Material.ClockWiseSideOrientation,b.fillMode=a,b.enableSpecularAntiAliasing=!0,b.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,b.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,b.transparencyMode=h.PBRMaterial.PBRMATERIAL_OPAQUE,b.metallic=1,b.roughness=1,b},l.prototype.createMaterial=function(c,a,b){var e=this._extensionsCreateMaterial(c,a,b);if(e)return e;var i=a.name||"material"+a.index;return this._createDefaultMaterial(i,b)},l.prototype.loadMaterialPropertiesAsync=function(c,a,b){var e=this._extensionsLoadMaterialPropertiesAsync(c,a,b);if(e)return e;var i=new Array();return i.push(this.loadMaterialBasePropertiesAsync(c,a,b)),a.pbrMetallicRoughness&&i.push(this._loadMaterialMetallicRoughnessPropertiesAsync(c+"/pbrMetallicRoughness",a.pbrMetallicRoughness,b)),this.loadMaterialAlphaProperties(c,a,b),Promise.all(i).then(function(){})},l.prototype.loadMaterialBasePropertiesAsync=function(c,a,b){if(!(b instanceof h.PBRMaterial))throw new Error(c+": Material type not supported");var e=new Array();return b.emissiveColor=a.emissiveFactor?h.Color3.FromArray(a.emissiveFactor):new h.Color3(0,0,0),a.doubleSided&&(b.backFaceCulling=!1,b.twoSidedLighting=!0),a.normalTexture&&(e.push(this.loadTextureInfoAsync(c+"/normalTexture",a.normalTexture,function(i){i.name=b.name+" (Normal)",b.bumpTexture=i})),b.invertNormalMapX=!this._babylonScene.useRightHandedSystem,b.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=a.normalTexture.scale&&(b.bumpTexture.level=a.normalTexture.scale),b.forceIrradianceInFragment=!0),a.occlusionTexture&&(e.push(this.loadTextureInfoAsync(c+"/occlusionTexture",a.occlusionTexture,function(i){i.name=b.name+" (Occlusion)",b.ambientTexture=i})),b.useAmbientInGrayScale=!0,null!=a.occlusionTexture.strength&&(b.ambientTextureStrength=a.occlusionTexture.strength)),a.emissiveTexture&&e.push(this.loadTextureInfoAsync(c+"/emissiveTexture",a.emissiveTexture,function(i){i.name=b.name+" (Emissive)",b.emissiveTexture=i})),Promise.all(e).then(function(){})},l.prototype.loadMaterialAlphaProperties=function(c,a,b){if(!(b instanceof h.PBRMaterial))throw new Error(c+": Material type not supported");switch(a.alphaMode||"OPAQUE"){case"OPAQUE":b.transparencyMode=h.PBRMaterial.PBRMATERIAL_OPAQUE;break;case"MASK":b.transparencyMode=h.PBRMaterial.PBRMATERIAL_ALPHATEST,b.alphaCutOff=null==a.alphaCutoff?.5:a.alphaCutoff,b.albedoTexture&&(b.albedoTexture.hasAlpha=!0);break;case"BLEND":b.transparencyMode=h.PBRMaterial.PBRMATERIAL_ALPHABLEND,b.albedoTexture&&(b.albedoTexture.hasAlpha=!0,b.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(c+"/alphaMode: Invalid value ("+a.alphaMode+")")}},l.prototype.loadTextureInfoAsync=function(c,a,b){var e=this;void 0===b&&(b=function(){});var i=this._extensionsLoadTextureInfoAsync(c,a,b);if(i)return i;this.logOpen(""+c);var j=D.Get(c+"/index",this._gltf.textures,a.index),f=this._loadTextureAsync("/textures/"+a.index,j,function(o){o.coordinatesIndex=a.texCoord||0,l.AddPointerMetadata(o,c),e._parent.onTextureLoadedObservable.notifyObservers(o),b(o)});return this.logClose(),f},l.prototype._loadTextureAsync=function(c,a,b){var e=this;void 0===b&&(b=function(){});var i=new Array();this.logOpen(c+" "+(a.name||""));var j=null==a.sampler?l._DefaultSampler:D.Get(c+"/sampler",this._gltf.samplers,a.sampler),f=this._loadSampler("/samplers/"+j.index,j),o=D.Get(c+"/source",this._gltf.images,a.source),u=null;o.uri&&(h.Tools.IsBase64(o.uri)?u=o.uri:this._babylonScene.getEngine().textureFormatInUse&&(u=this._rootUrl+o.uri));var r=new h.Deferred(),B=new h.Texture(u,this._babylonScene,f.noMipMaps,!1,f.samplingMode,function(){e._disposed||r.resolve()},function(M,R){e._disposed||r.reject(new Error(c+": "+(R&&R.message?R.message:M||"Failed to load texture")))});return i.push(r.promise),u||i.push(this.loadImageAsync("/images/"+o.index,o).then(function(M){var R=o.uri||e._fileName+"#image"+o.index,Z="data:"+e._uniqueRootUrl+R;B.updateURL(Z,new Blob([M],{type:o.mimeType}))})),B.wrapU=f.wrapU,B.wrapV=f.wrapV,b(B),this.logClose(),Promise.all(i).then(function(){return B})},l.prototype._loadSampler=function(c,a){return a._data||(a._data={noMipMaps:9728===a.minFilter||9729===a.minFilter,samplingMode:l._GetTextureSamplingMode(c,a),wrapU:l._GetTextureWrapMode(c+"/wrapS",a.wrapS),wrapV:l._GetTextureWrapMode(c+"/wrapT",a.wrapT)}),a._data},l.prototype.loadImageAsync=function(c,a){if(!a._data){if(this.logOpen(c+" "+(a.name||"")),a.uri)a._data=this.loadUriAsync(c+"/uri",a,a.uri);else{var b=D.Get(c+"/bufferView",this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync("/bufferViews/"+b.index,b)}this.logClose()}return a._data},l.prototype.loadUriAsync=function(c,a,b){var e=this,i=this._extensionsLoadUriAsync(c,a,b);if(i)return i;if(!l._ValidateUri(b))throw new Error(c+": '"+b+"' is invalid");if(h.Tools.IsBase64(b)){var j=new Uint8Array(h.Tools.DecodeBase64(b));return this.log("Decoded "+b.substr(0,64)+"... ("+j.length+" bytes)"),Promise.resolve(j)}return this.log("Loading "+b),this._parent.preprocessUrlAsync(this._rootUrl+b).then(function(f){return new Promise(function(o,u){if(!e._disposed){var r=h.Tools.LoadFile(f,function(B){if(!e._disposed){var M=new Uint8Array(B);e.log("Loaded "+b+" ("+M.length+" bytes)"),o(M)}},function(B){if(!e._disposed&&(r&&(r._lengthComputable=B.lengthComputable,r._loaded=B.loaded,r._total=B.total),e._state===y.GLTFLoaderState.LOADING))try{e._onProgress()}catch(M){u(M)}},e._babylonScene.offlineProvider,!0,function(B,M){e._disposed||u(new h.LoadFileError(c+": Failed to load '"+b+"'"+(B?": "+B.status+" "+B.statusText:""),B))});e._requests.push(r)}})})},l.prototype._onProgress=function(){if(this._progressCallback){for(var c=!0,a=0,b=0,e=0,i=this._requests;e<i.length;e++){var j=i[e];if(void 0===j._lengthComputable||void 0===j._loaded||void 0===j._total)return;c=c&&j._lengthComputable,a+=j._loaded,b+=j._total}this._progressCallback(new h.SceneLoaderProgressEvent(c,a,c?b:0))}},l.AddPointerMetadata=function(c,a){var b=c.metadata=c.metadata||{},e=b.gltf=b.gltf||{};(e.pointers=e.pointers||[]).push(a)},l._GetTextureWrapMode=function(c,a){switch(a=null==a?10497:a){case 33071:return h.Texture.CLAMP_ADDRESSMODE;case 33648:return h.Texture.MIRROR_ADDRESSMODE;case 10497:return h.Texture.WRAP_ADDRESSMODE;default:return h.Tools.Warn(c+": Invalid value ("+a+")"),h.Texture.WRAP_ADDRESSMODE}},l._GetTextureSamplingMode=function(c,a){var b=null==a.magFilter?9729:a.magFilter,e=null==a.minFilter?9987:a.minFilter;if(9729===b)switch(e){case 9728:return h.Texture.LINEAR_NEAREST;case 9729:return h.Texture.LINEAR_LINEAR;case 9984:return h.Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return h.Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return h.Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return h.Texture.LINEAR_LINEAR_MIPLINEAR;default:return h.Tools.Warn(c+"/minFilter: Invalid value ("+e+")"),h.Texture.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==b&&h.Tools.Warn(c+"/magFilter: Invalid value ("+b+")"),e){case 9728:return h.Texture.NEAREST_NEAREST;case 9729:return h.Texture.NEAREST_LINEAR;case 9984:return h.Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return h.Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return h.Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return h.Texture.NEAREST_LINEAR_MIPLINEAR;default:return h.Tools.Warn(c+"/minFilter: Invalid value ("+e+")"),h.Texture.NEAREST_NEAREST_MIPNEAREST}},l._GetTypedArray=function(c,a,b,e,i){var j=b.buffer;e=b.byteOffset+(e||0);try{switch(a){case 5120:return new Int8Array(j,e,i);case 5121:return new Uint8Array(j,e,i);case 5122:return new Int16Array(j,e,i);case 5123:return new Uint16Array(j,e,i);case 5125:return new Uint32Array(j,e,i);case 5126:return new Float32Array(j,e,i);default:throw new Error("Invalid component type "+a)}}catch(f){throw new Error(c+": "+f)}},l._GetNumComponents=function(c,a){switch(a){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(c+": Invalid type ("+a+")")},l._ValidateUri=function(c){return h.Tools.IsBase64(c)||-1===c.indexOf("..")},l._GetDrawMode=function(c,a){switch(null==a&&(a=4),a){case 0:return h.Material.PointListDrawMode;case 1:return h.Material.LineListDrawMode;case 2:return h.Material.LineLoopDrawMode;case 3:return h.Material.LineStripDrawMode;case 4:return h.Material.TriangleFillMode;case 5:return h.Material.TriangleStripDrawMode;case 6:return h.Material.TriangleFanDrawMode}throw new Error(c+": Invalid mesh primitive mode ("+a+")")},l.prototype._compileMaterialsAsync=function(){var c=this;this._parent._startPerformanceCounter("Compile materials");var a=new Array();if(this._gltf.materials)for(var b=0,e=this._gltf.materials;b<e.length;b++){var i=e[b];if(i._data)for(var j in i._data)for(var f=i._data[j],o=0,u=f.babylonMeshes;o<u.length;o++){var r=u[o];r.computeWorldMatrix(!0);var B=f.babylonMaterial;a.push(B.forceCompilationAsync(r)),this._parent.useClipPlane&&a.push(B.forceCompilationAsync(r,{clipPlane:!0}))}}return Promise.all(a).then(function(){c._parent._endPerformanceCounter("Compile materials")})},l.prototype._compileShadowGeneratorsAsync=function(){var c=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var a=new Array(),b=0,e=this._babylonScene.lights;b<e.length;b++){var i=e[b].getShadowGenerator();i&&a.push(i.forceCompilationAsync())}return Promise.all(a).then(function(){c._parent._endPerformanceCounter("Compile shadow generators")})},l.prototype._forEachExtensions=function(c){for(var a=0,b=l._ExtensionNames;a<b.length;a++){var e=b[a],i=this._extensions[e];i.enabled&&c(i)}},l.prototype._applyExtensions=function(c,a,b){for(var e=0,i=l._ExtensionNames;e<i.length;e++){var j=i[e],f=this._extensions[j];if(f.enabled){var o=j+"."+a,u=c;u._activeLoaderExtensionFunctions=u._activeLoaderExtensionFunctions||{};var r=u._activeLoaderExtensionFunctions;if(!r[o]){r[o]=!0;try{var B=b(f);if(B)return B}finally{delete r[o]}}}}return null},l.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(c){return c.onLoading&&c.onLoading()})},l.prototype._extensionsOnReady=function(){this._forEachExtensions(function(c){return c.onReady&&c.onReady()})},l.prototype._extensionsLoadSceneAsync=function(c,a){return this._applyExtensions(a,"loadScene",function(b){return b.loadSceneAsync&&b.loadSceneAsync(c,a)})},l.prototype._extensionsLoadNodeAsync=function(c,a,b){return this._applyExtensions(a,"loadNode",function(e){return e.loadNodeAsync&&e.loadNodeAsync(c,a,b)})},l.prototype._extensionsLoadCameraAsync=function(c,a,b){return this._applyExtensions(a,"loadCamera",function(e){return e.loadCameraAsync&&e.loadCameraAsync(c,a,b)})},l.prototype._extensionsLoadVertexDataAsync=function(c,a,b){return this._applyExtensions(a,"loadVertexData",function(e){return e._loadVertexDataAsync&&e._loadVertexDataAsync(c,a,b)})},l.prototype._extensionsLoadMeshPrimitiveAsync=function(c,a,b,e,i,j){return this._applyExtensions(i,"loadMeshPrimitive",function(f){return f._loadMeshPrimitiveAsync&&f._loadMeshPrimitiveAsync(c,a,b,e,i,j)})},l.prototype._extensionsLoadMaterialAsync=function(c,a,b,e,i){return this._applyExtensions(a,"loadMaterial",function(j){return j._loadMaterialAsync&&j._loadMaterialAsync(c,a,b,e,i)})},l.prototype._extensionsCreateMaterial=function(c,a,b){return this._applyExtensions(a,"createMaterial",function(e){return e.createMaterial&&e.createMaterial(c,a,b)})},l.prototype._extensionsLoadMaterialPropertiesAsync=function(c,a,b){return this._applyExtensions(a,"loadMaterialProperties",function(e){return e.loadMaterialPropertiesAsync&&e.loadMaterialPropertiesAsync(c,a,b)})},l.prototype._extensionsLoadTextureInfoAsync=function(c,a,b){return this._applyExtensions(a,"loadTextureInfo",function(e){return e.loadTextureInfoAsync&&e.loadTextureInfoAsync(c,a,b)})},l.prototype._extensionsLoadAnimationAsync=function(c,a){return this._applyExtensions(a,"loadAnimation",function(b){return b.loadAnimationAsync&&b.loadAnimationAsync(c,a)})},l.prototype._extensionsLoadSkinAsync=function(c,a,b){return this._applyExtensions(b,"loadSkin",function(e){return e._loadSkinAsync&&e._loadSkinAsync(c,a,b)})},l.prototype._extensionsLoadUriAsync=function(c,a,b){return this._applyExtensions(a,"loadUri",function(e){return e._loadUriAsync&&e._loadUriAsync(c,a,b)})},l.LoadExtensionAsync=function(c,a,b,e){if(!a.extensions)return null;var i=a.extensions[b];return i?e(c+"/extensions/"+b,i):null},l.LoadExtraAsync=function(c,a,b,e){if(!a.extras)return null;var i=a.extras[b];return i?e(c+"/extras/"+b,i):null},l.prototype.logOpen=function(c){this._parent._logOpen(c)},l.prototype.logClose=function(){this._parent._logClose()},l.prototype.log=function(c){this._parent._log(c)},l.prototype.startPerformanceCounter=function(c){this._parent._startPerformanceCounter(c)},l.prototype.endPerformanceCounter=function(c){this._parent._endPerformanceCounter(c)},l._DefaultSampler={index:-1},l._ExtensionNames=new Array(),l._ExtensionFactories={},l}();y.GLTFFileLoader._CreateGLTF2Loader=function(l){return new A(l)}},function(la,G,q){"use strict";q.r(G),q.d(G,"GLTFLoaderCoordinateSystemMode",function(){return h}),q.d(G,"GLTFLoaderAnimationStartMode",function(){return y}),q.d(G,"GLTFLoaderState",function(){return D}),q.d(G,"GLTFFileLoader",function(){return l});var h,y,D,A=q(0);!function(a){a[a.AUTO=0]="AUTO",a[a.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(h||(h={})),function(a){a[a.NONE=0]="NONE",a[a.FIRST=1]="FIRST",a[a.ALL=2]="ALL"}(y||(y={})),function(a){a[a.LOADING=0]="LOADING",a[a.READY=1]="READY",a[a.COMPLETE=2]="COMPLETE"}(D||(D={}));var l=function(){function a(){this.onParsedObservable=new A.Observable(),this.coordinateSystemMode=h.AUTO,this.animationStartMode=y.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.preprocessUrlAsync=function(b){return Promise.resolve(b)},this.onMeshLoadedObservable=new A.Observable(),this.onTextureLoadedObservable=new A.Observable(),this.onMaterialLoadedObservable=new A.Observable(),this.onCameraLoadedObservable=new A.Observable(),this.onCompleteObservable=new A.Observable(),this.onErrorObservable=new A.Observable(),this.onDisposeObservable=new A.Observable(),this.onExtensionLoadedObservable=new A.Observable(),this.validate=!1,this.onValidatedObservable=new A.Observable(),this._loader=null,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(a.prototype,"onParsed",{set:function(b){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onMeshLoaded",{set:function(b){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onTextureLoaded",{set:function(b){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onMaterialLoaded",{set:function(b){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onCameraLoaded",{set:function(b){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onComplete",{set:function(b){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onError",{set:function(b){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onExtensionLoaded",{set:function(b){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(b){this._loggingEnabled!==b&&(this._loggingEnabled=b,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(b){this._capturePerformanceCounters!==b&&(this._capturePerformanceCounters=b,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onValidated",{set:function(b){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(b)},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null),this._clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},a.prototype._clear=function(){this.preprocessUrlAsync=function(b){return Promise.resolve(b)},this.onMeshLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear()},a.prototype.importMeshAsync=function(b,e,i,j,f,o){var u=this;return this._parseAsync(e,i,j,o).then(function(r){return u._log("Loading "+(o||"")),u._loader=u._getLoader(r),u._loader.importMeshAsync(b,e,r,j,f,o)})},a.prototype.loadAsync=function(b,e,i,j,f){var o=this;return this._parseAsync(b,e,i,f).then(function(u){return o._log("Loading "+(f||"")),o._loader=o._getLoader(u),o._loader.loadAsync(b,u,i,j,f)})},a.prototype.loadAssetContainerAsync=function(b,e,i,j,f){var o=this;return this._parseAsync(b,e,i,f).then(function(u){o._log("Loading "+(f||"")),o._loader=o._getLoader(u);var r=[];o.onMaterialLoadedObservable.add(function(M){r.push(M)});var B=[];return o.onTextureLoadedObservable.add(function(M){B.push(M)}),o._loader.importMeshAsync(null,b,u,i,j,f).then(function(M){var R=new A.AssetContainer(b);return Array.prototype.push.apply(R.meshes,M.meshes),Array.prototype.push.apply(R.particleSystems,M.particleSystems),Array.prototype.push.apply(R.skeletons,M.skeletons),Array.prototype.push.apply(R.animationGroups,M.animationGroups),Array.prototype.push.apply(R.materials,r),Array.prototype.push.apply(R.textures,B),R.removeAllFromScene(),R})})},a.prototype.canDirectLoad=function(b){return-1!==b.indexOf("scene")&&-1!==b.indexOf("node")},a.prototype.createPlugin=function(){return new a()},Object.defineProperty(a.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!0,configurable:!0}),a.prototype.whenCompleteAsync=function(){var b=this;return new Promise(function(e,i){b.onCompleteObservable.addOnce(function(){e()}),b.onErrorObservable.addOnce(function(j){i(j)})})},a.prototype._parseAsync=function(b,e,i,j){var f=this;return Promise.resolve().then(function(){return f._validateAsync(b,e,i,j).then(function(){var o=e instanceof ArrayBuffer?f._unpackBinary(e):{json:e,bin:null};f._startPerformanceCounter("Parse JSON"),f._log("JSON length: "+o.json.length);var u={json:JSON.parse(o.json),bin:o.bin};return f._endPerformanceCounter("Parse JSON"),f.onParsedObservable.notifyObservers(u),f.onParsedObservable.clear(),u})})},a.prototype._validateAsync=function(b,e,i,j){var f=this;if(!this.validate||"undefined"==typeof GLTFValidator)return Promise.resolve();this._startPerformanceCounter("Validate JSON");var o={externalResourceFunction:function(u){return f.preprocessUrlAsync(i+u).then(function(r){return b._loadFileAsync(r,!0,!0)}).then(function(r){return new Uint8Array(r)})}};return j&&"data:"!==j.substr(0,5)&&(o.uri="file:"===i?j:""+i+j),(e instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(e),o):GLTFValidator.validateString(e,o)).then(function(u){f._endPerformanceCounter("Validate JSON"),f.onValidatedObservable.notifyObservers(u),f.onValidatedObservable.clear()},function(u){f._endPerformanceCounter("Validate JSON"),A.Tools.Warn("Failed to validate: "+u),f.onValidatedObservable.clear()})},a.prototype._getLoader=function(b){var e=b.json.asset||{};this._log("Asset version: "+e.version),e.minVersion&&this._log("Asset minimum version: "+e.minVersion),e.generator&&this._log("Asset generator: "+e.generator);var i=a._parseVersion(e.version);if(!i)throw new Error("Invalid version: "+e.version);if(void 0!==e.minVersion){var j=a._parseVersion(e.minVersion);if(!j)throw new Error("Invalid minimum version: "+e.minVersion);if(a._compareVersion(j,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+e.minVersion)}var f={1:a._CreateGLTF1Loader,2:a._CreateGLTF2Loader}[i.major];if(!f)throw new Error("Unsupported version: "+e.version);return f(this)},a.prototype._unpackBinary=function(b){this._startPerformanceCounter("Unpack binary"),this._log("Binary length: "+b.byteLength);var e=new c(b),i=e.readUint32();if(1179937895!==i)throw new Error("Unexpected magic: "+i);var j,f=e.readUint32();switch(this.loggingEnabled&&this._log("Binary version: "+f),f){case 1:j=this._unpackBinaryV1(e);break;case 2:j=this._unpackBinaryV2(e);break;default:throw new Error("Unsupported version: "+f)}return this._endPerformanceCounter("Unpack binary"),j},a.prototype._unpackBinaryV1=function(b){var e=b.readUint32();if(e!=b.getLength())throw new Error("Length in header does not match actual data length: "+e+" != "+b.getLength());var i,j=b.readUint32(),f=b.readUint32();switch(f){case 0:i=a._decodeBufferToText(b.readUint8Array(j));break;default:throw new Error("Unexpected content format: "+f)}var o=b.getLength()-b.getPosition();return{json:i,bin:b.readUint8Array(o)}},a.prototype._unpackBinaryV2=function(b){var e=1313821514,i=5130562,j=b.readUint32();if(j!==b.getLength())throw new Error("Length in header does not match actual data length: "+j+" != "+b.getLength());var f=b.readUint32();if(b.readUint32()!==e)throw new Error("First chunk format is not JSON");for(var o=a._decodeBufferToText(b.readUint8Array(f)),u=null;b.getPosition()<b.getLength();){var r=b.readUint32();switch(b.readUint32()){case e:throw new Error("Unexpected JSON chunk");case i:u=b.readUint8Array(r);break;default:b.skipBytes(r)}}return{json:o,bin:u}},a._parseVersion=function(b){if("1.0"===b||"1.0.1"===b)return{major:1,minor:0};var e=(b+"").match(/^(\d+)\.(\d+)/);return e?{major:parseInt(e[1]),minor:parseInt(e[2])}:null},a._compareVersion=function(b,e){return b.major>e.major?1:b.major<e.major?-1:b.minor>e.minor?1:b.minor<e.minor?-1:0},a._decodeBufferToText=function(b){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(b);for(var e="",i=b.byteLength,j=0;j<i;j++)e+=String.fromCharCode(b[j]);return e},a.prototype._logOpen=function(b){this._log(b),this._logIndentLevel++},a.prototype._logClose=function(){--this._logIndentLevel},a.prototype._logEnabled=function(b){var e=a._logSpaces.substr(0,2*this._logIndentLevel);A.Tools.Log(""+e+b)},a.prototype._logDisabled=function(b){},a.prototype._startPerformanceCounterEnabled=function(b){A.Tools.StartPerformanceCounter(b)},a.prototype._startPerformanceCounterDisabled=function(b){},a.prototype._endPerformanceCounterEnabled=function(b){A.Tools.EndPerformanceCounter(b)},a.prototype._endPerformanceCounterDisabled=function(b){},a.IncrementalLoading=!0,a.HomogeneousCoordinates=!1,a._logSpaces="                                ",a}(),c=function(){function a(b){this._arrayBuffer=b,this._dataView=new DataView(b),this._byteOffset=0}return a.prototype.getPosition=function(){return this._byteOffset},a.prototype.getLength=function(){return this._arrayBuffer.byteLength},a.prototype.readUint32=function(){var b=this._dataView.getUint32(this._byteOffset,!0);return this._byteOffset+=4,b},a.prototype.readUint8Array=function(b){var e=new Uint8Array(this._arrayBuffer,this._byteOffset,b);return this._byteOffset+=b,e},a.prototype.skipBytes=function(b){this._byteOffset+=b},a}();A.SceneLoader&&A.SceneLoader.RegisterPlugin(new l())},function(la,G){var q;q=function(){return this}();try{q=q||new Function("return this")()}catch(h){"object"==typeof window&&(q=window)}la.exports=q},function(la,G,q){"use strict";q.r(G);var h=q(0),y=q(1),D="EXT_lights_image_based",A=function(){function F(z){this.name=D,this.enabled=!0,this._loader=z}return F.prototype.dispose=function(){delete this._loader,delete this._lights},F.prototype.onLoading=function(){var z=this._loader.gltf.extensions;if(z&&z[this.name]){var p=z[this.name];this._lights=p.lights}},F.prototype.loadSceneAsync=function(z,p){var x=this;return y.b.LoadExtensionAsync(z,p,this.name,function(v,H){var E=new Array();E.push(x._loader.loadSceneAsync(z,p)),x._loader.logOpen(""+v);var I=y.a.Get(v+"/light",x._lights,H.light);return E.push(x._loadLightAsync("#/extensions/"+x.name+"/lights/"+H.light,I).then(function(P){x._loader.babylonScene.environmentTexture=P})),x._loader.logClose(),Promise.all(E).then(function(){})})},F.prototype._loadLightAsync=function(z,p){var x=this;if(!p._loaded){var v=new Array();this._loader.logOpen(""+z);for(var H=new Array(p.specularImages.length),E=function(T){var Y=p.specularImages[T];H[T]=new Array(Y.length);for(var W=function(X){var ma=z+"/specularImages/"+T+"/"+X;I._loader.logOpen(""+ma);var fa=Y[X],sa=y.a.Get(ma,I._loader.gltf.images,fa);v.push(I._loader.loadImageAsync("#/images/"+fa,sa).then(function(va){H[T][X]=va})),I._loader.logClose()},ca=0;ca<Y.length;ca++)W(ca)},I=this,P=0;P<p.specularImages.length;P++)E(P);this._loader.logClose(),p._loaded=Promise.all(v).then(function(){var T=new h.RawCubeTexture(x._loader.babylonScene,null,p.specularImageSize);if(p._babylonTexture=T,null!=p.intensity&&(T.level=p.intensity),p.rotation){var Y=h.Quaternion.FromArray(p.rotation);x._loader.babylonScene.useRightHandedSystem||(Y=h.Quaternion.Inverse(Y)),h.Matrix.FromQuaternionToRef(Y,T.getReflectionTextureMatrix())}var W=h.SphericalHarmonics.FromArray(p.irradianceCoefficients);W.scaleInPlace(p.intensity),W.convertIrradianceToLambertianRadiance();var ca=h.SphericalPolynomial.FromHarmonics(W),X=(H.length-1)/h.Scalar.Log2(p.specularImageSize);return T.updateRGBDAsync(H,ca,X)})}return p._loaded.then(function(){return p._babylonTexture})},F}();y.b.RegisterExtension(D,function(F){return new A(F)});var l="KHR_draco_mesh_compression",c=function(){function F(z){this.name=l,this.enabled=h.DracoCompression.DecoderAvailable,this._loader=z}return F.prototype.dispose=function(){delete this.dracoCompression,delete this._loader},F.prototype._loadVertexDataAsync=function(z,p,x){var v=this;return y.b.LoadExtensionAsync(z,p,this.name,function(H,E){if(null!=p.mode){if(5!==p.mode&&4!==p.mode)throw new Error(z+": Unsupported mode "+p.mode);if(5===p.mode)throw new Error(z+": Mode "+p.mode+" is not currently supported")}var I={},P=function(Y,W){var ca=E.attributes[Y];null!=ca&&(x._delayInfo=x._delayInfo||[],-1===x._delayInfo.indexOf(W)&&x._delayInfo.push(W),I[W]=ca)};P("POSITION",h.VertexBuffer.PositionKind),P("NORMAL",h.VertexBuffer.NormalKind),P("TANGENT",h.VertexBuffer.TangentKind),P("TEXCOORD_0",h.VertexBuffer.UVKind),P("TEXCOORD_1",h.VertexBuffer.UV2Kind),P("JOINTS_0",h.VertexBuffer.MatricesIndicesKind),P("WEIGHTS_0",h.VertexBuffer.MatricesWeightsKind),P("COLOR_0",h.VertexBuffer.ColorKind);var T=y.a.Get(H,v._loader.gltf.bufferViews,E.bufferView);return T._dracoBabylonGeometry||(T._dracoBabylonGeometry=v._loader.loadBufferViewAsync("#/bufferViews/"+T.index,T).then(function(Y){return(v.dracoCompression||h.DracoCompression.Default).decodeMeshAsync(Y,I).then(function(W){var ca=new h.Geometry(x.name,v._loader.babylonScene);return W.applyToGeometry(ca),ca}).catch(function(W){throw new Error(z+": "+W.message)})})),T._dracoBabylonGeometry})},F}();y.b.RegisterExtension(l,function(F){return new c(F)});var a,b="KHR_lights_punctual";!function(F){F.DIRECTIONAL="directional",F.POINT="point",F.SPOT="spot"}(a||(a={}));var e=function(){function F(z){this.name=b,this.enabled=!0,this._loader=z}return F.prototype.dispose=function(){delete this._loader,delete this._lights},F.prototype.onLoading=function(){var z=this._loader.gltf.extensions;if(z&&z[this.name]){var p=z[this.name];this._lights=p.lights}},F.prototype.loadNodeAsync=function(z,p,x){var v=this;return y.b.LoadExtensionAsync(z,p,this.name,function(H,E){return v._loader.loadNodeAsync(z,p,function(I){var P,T=y.a.Get(H,v._lights,E.light),Y=T.name||I.name;switch(T.type){case a.DIRECTIONAL:P=new h.DirectionalLight(Y,h.Vector3.Backward(),v._loader.babylonScene);break;case a.POINT:P=new h.PointLight(Y,h.Vector3.Zero(),v._loader.babylonScene);break;case a.SPOT:var W=new h.SpotLight(Y,h.Vector3.Zero(),h.Vector3.Backward(),0,1,v._loader.babylonScene);W.angle=2*(T.spot&&T.spot.outerConeAngle||Math.PI/4),W.innerAngle=2*(T.spot&&T.spot.innerConeAngle||0),P=W;break;default:throw new Error(H+": Invalid light type ("+T.type+")")}P.falloffType=h.Light.FALLOFF_GLTF,P.diffuse=T.color?h.Color3.FromArray(T.color):h.Color3.White(),P.intensity=null==T.intensity?1:T.intensity,P.range=null==T.range?Number.MAX_VALUE:T.range,P.parent=I,y.b.AddPointerMetadata(P,H),x(I)})})},F}();y.b.RegisterExtension(b,function(F){return new e(F)});var i="KHR_materials_pbrSpecularGlossiness",j=function(){function F(z){this.name=i,this.enabled=!0,this._loader=z}return F.prototype.dispose=function(){delete this._loader},F.prototype.loadMaterialPropertiesAsync=function(z,p,x){var v=this;return y.b.LoadExtensionAsync(z,p,this.name,function(H,E){var I=new Array();return I.push(v._loader.loadMaterialBasePropertiesAsync(z,p,x)),I.push(v._loadSpecularGlossinessPropertiesAsync(H,p,E,x)),v._loader.loadMaterialAlphaProperties(z,p,x),Promise.all(I).then(function(){})})},F.prototype._loadSpecularGlossinessPropertiesAsync=function(z,p,x,v){if(!(v instanceof h.PBRMaterial))throw new Error(z+": Material type not supported");var H=new Array();return v.metallic=null,v.roughness=null,x.diffuseFactor?(v.albedoColor=h.Color3.FromArray(x.diffuseFactor),v.alpha=x.diffuseFactor[3]):v.albedoColor=h.Color3.White(),v.reflectivityColor=x.specularFactor?h.Color3.FromArray(x.specularFactor):h.Color3.White(),v.microSurface=null==x.glossinessFactor?1:x.glossinessFactor,x.diffuseTexture&&H.push(this._loader.loadTextureInfoAsync(z+"/diffuseTexture",x.diffuseTexture,function(E){E.name=v.name+" (Diffuse)",v.albedoTexture=E})),x.specularGlossinessTexture&&(H.push(this._loader.loadTextureInfoAsync(z+"/specularGlossinessTexture",x.specularGlossinessTexture,function(E){E.name=v.name+" (Specular Glossiness)",v.reflectivityTexture=E})),v.reflectivityTexture.hasAlpha=!0,v.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(H).then(function(){})},F}();y.b.RegisterExtension(i,function(F){return new j(F)});var f="KHR_materials_unlit",o=function(){function F(z){this.name=f,this.enabled=!0,this._loader=z}return F.prototype.dispose=function(){delete this._loader},F.prototype.loadMaterialPropertiesAsync=function(z,p,x){var v=this;return y.b.LoadExtensionAsync(z,p,this.name,function(){return v._loadUnlitPropertiesAsync(z,p,x)})},F.prototype._loadUnlitPropertiesAsync=function(z,p,x){if(!(x instanceof h.PBRMaterial))throw new Error(z+": Material type not supported");var v=new Array();x.unlit=!0;var H=p.pbrMetallicRoughness;return H&&(H.baseColorFactor?(x.albedoColor=h.Color3.FromArray(H.baseColorFactor),x.alpha=H.baseColorFactor[3]):x.albedoColor=h.Color3.White(),H.baseColorTexture&&v.push(this._loader.loadTextureInfoAsync(z+"/baseColorTexture",H.baseColorTexture,function(E){E.name=x.name+" (Base Color)",x.albedoTexture=E}))),p.doubleSided&&(x.backFaceCulling=!1,x.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(z,p,x),Promise.all(v).then(function(){})},F}();y.b.RegisterExtension(f,function(F){return new o(F)});var u="KHR_texture_transform",r=function(){function F(z){this.name=u,this.enabled=!0,this._loader=z}return F.prototype.dispose=function(){delete this._loader},F.prototype.loadTextureInfoAsync=function(z,p,x){var v=this;return y.b.LoadExtensionAsync(z,p,this.name,function(H,E){return v._loader.loadTextureInfoAsync(z,p,function(I){if(!(I instanceof h.Texture))throw new Error(H+": Texture type not supported");E.offset&&(I.uOffset=E.offset[0],I.vOffset=E.offset[1]),I.uRotationCenter=0,I.vRotationCenter=0,E.rotation&&(I.wAng=-E.rotation),E.scale&&(I.uScale=E.scale[0],I.vScale=E.scale[1]),null!=E.texCoord&&(I.coordinatesIndex=E.texCoord),x(I)})})},F}();y.b.RegisterExtension(u,function(F){return new r(F)});var B="MSFT_audio_emitter",M=function(){function F(z){this.name=B,this.enabled=!0,this._loader=z}return F.prototype.dispose=function(){delete this._loader,delete this._clips,delete this._emitters},F.prototype.onLoading=function(){var z=this._loader.gltf.extensions;if(z&&z[this.name]){var p=z[this.name];this._clips=p.clips,this._emitters=p.emitters,y.a.Assign(this._clips),y.a.Assign(this._emitters)}},F.prototype.loadSceneAsync=function(z,p){var x=this;return y.b.LoadExtensionAsync(z,p,this.name,function(v,H){var E=new Array();E.push(x._loader.loadSceneAsync(z,p));for(var I=0,P=H.emitters;I<P.length;I++){var T=P[I],Y=y.a.Get(v+"/emitters",x._emitters,T);if(null!=Y.refDistance||null!=Y.maxDistance||null!=Y.rolloffFactor||null!=Y.distanceModel||null!=Y.innerAngle||null!=Y.outerAngle)throw new Error(v+": Direction or Distance properties are not allowed on emitters attached to a scene");E.push(x._loadEmitterAsync(v+"/emitters/"+Y.index,Y))}return Promise.all(E).then(function(){})})},F.prototype.loadNodeAsync=function(z,p,x){var v=this;return y.b.LoadExtensionAsync(z,p,this.name,function(H,E){var I=new Array();return v._loader.loadNodeAsync(H,p,function(P){for(var T=function(ca){var X=y.a.Get(H+"/emitters",v._emitters,ca);I.push(v._loadEmitterAsync(H+"/emitters/"+X.index,X).then(function(){for(var ma=0,fa=X._babylonSounds;ma<fa.length;ma++){var sa=fa[ma];sa.attachToMesh(P),null==X.innerAngle&&null==X.outerAngle||(sa.setLocalDirectionToMesh(h.Vector3.Forward()),sa.setDirectionalCone(2*h.Tools.ToDegrees(null==X.innerAngle?Math.PI:X.innerAngle),2*h.Tools.ToDegrees(null==X.outerAngle?Math.PI:X.outerAngle),0))}}))},Y=0,W=E.emitters;Y<W.length;Y++)T(W[Y]);x(P)}).then(function(P){return Promise.all(I).then(function(){return P})})})},F.prototype.loadAnimationAsync=function(z,p){var x=this;return y.b.LoadExtensionAsync(z,p,this.name,function(v,H){return x._loader.loadAnimationAsync(z,p).then(function(E){var I=new Array();y.a.Assign(H.events);for(var P=0,T=H.events;P<T.length;P++){var Y=T[P];I.push(x._loadAnimationEventAsync(v+"/events/"+Y.index,z,p,Y,E))}return Promise.all(I).then(function(){return E})})})},F.prototype._loadClipAsync=function(z,p){if(p._objectURL)return p._objectURL;var x;if(p.uri)x=this._loader.loadUriAsync(z,p,p.uri);else{var v=y.a.Get(z+"/bufferView",this._loader.gltf.bufferViews,p.bufferView);x=this._loader.loadBufferViewAsync("#/bufferViews/"+v.index,v)}return p._objectURL=x.then(function(H){return URL.createObjectURL(new Blob([H],{type:p.mimeType}))}),p._objectURL},F.prototype._loadEmitterAsync=function(z,p){var x=this;if(p._babylonSounds=p._babylonSounds||[],!p._babylonData){for(var v=new Array(),H=p.name||"emitter"+p.index,E={loop:!1,autoplay:!1,volume:null==p.volume?1:p.volume},I=function(W){var ca="#/extensions/"+P.name+"/clips",X=y.a.Get(ca,P._clips,p.clips[W].clip);v.push(P._loadClipAsync(ca+"/"+p.clips[W].clip,X).then(function(ma){var fa=p._babylonSounds[W]=new h.Sound(H,ma,x._loader.babylonScene,null,E);fa.refDistance=p.refDistance||1,fa.maxDistance=p.maxDistance||256,fa.rolloffFactor=p.rolloffFactor||1,fa.distanceModel=p.distanceModel||"exponential",fa._positionInEmitterSpace=!0}))},P=this,T=0;T<p.clips.length;T++)I(T);var Y=Promise.all(v).then(function(){var W=p.clips.map(function(X){return X.weight||1}),ca=new h.WeightedSound(p.loop||!1,p._babylonSounds,W);p.innerAngle&&(ca.directionalConeInnerAngle=2*h.Tools.ToDegrees(p.innerAngle)),p.outerAngle&&(ca.directionalConeOuterAngle=2*h.Tools.ToDegrees(p.outerAngle)),p.volume&&(ca.volume=p.volume),p._babylonData.sound=ca});p._babylonData={loaded:Y}}return p._babylonData.loaded},F.prototype._getEventAction=function(z,p,x,v,H){switch(x){case"play":return function(E){var I=(H||0)+(E-v);p.play(I)};case"stop":return function(E){p.stop()};case"pause":return function(E){p.pause()};default:throw new Error(z+": Unsupported action "+x)}},F.prototype._loadAnimationEventAsync=function(z,p,x,v,H){var E=this;if(0==H.targetedAnimations.length)return Promise.resolve();var I=H.targetedAnimations[0],P=v.emitter,T=y.a.Get("#/extensions/"+this.name+"/emitters",this._emitters,P);return this._loadEmitterAsync(z,T).then(function(){var Y=T._babylonData.sound;if(Y){var W=new h.AnimationEvent(v.time,E._getEventAction(z,Y,v.action,v.time,v.startOffset));I.animation.addEvent(W),H.onAnimationGroupEndObservable.add(function(){Y.stop()}),H.onAnimationGroupPauseObservable.add(function(){Y.pause()})}})},F}();y.b.RegisterExtension(B,function(F){return new M(F)});var R="MSFT_lod",Z=function(){function F(z){this.name=R,this.enabled=!0,this.maxLODsToLoad=Number.MAX_VALUE,this.onNodeLODsLoadedObservable=new h.Observable(),this.onMaterialLODsLoadedObservable=new h.Observable(),this._nodeIndexLOD=null,this._nodeSignalLODs=new Array(),this._nodePromiseLODs=new Array(),this._materialIndexLOD=null,this._materialSignalLODs=new Array(),this._materialPromiseLODs=new Array(),this._loader=z}return F.prototype.dispose=function(){delete this._loader,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},F.prototype.onReady=function(){for(var z=this,p=function(I){var P=Promise.all(x._nodePromiseLODs[I]).then(function(){0!==I&&z._loader.endPerformanceCounter("Node LOD "+I),z._loader.log("Loaded node LOD "+I),z.onNodeLODsLoadedObservable.notifyObservers(I),I!==z._nodePromiseLODs.length-1&&(z._loader.startPerformanceCounter("Node LOD "+(I+1)),z._nodeSignalLODs[I]&&z._nodeSignalLODs[I].resolve())});x._loader._completePromises.push(P)},x=this,v=0;v<this._nodePromiseLODs.length;v++)p(v);var H=function(I){var P=Promise.all(E._materialPromiseLODs[I]).then(function(){0!==I&&z._loader.endPerformanceCounter("Material LOD "+I),z._loader.log("Loaded material LOD "+I),z.onMaterialLODsLoadedObservable.notifyObservers(I),I!==z._materialPromiseLODs.length-1&&(z._loader.startPerformanceCounter("Material LOD "+(I+1)),z._materialSignalLODs[I]&&z._materialSignalLODs[I].resolve())});E._loader._completePromises.push(P)},E=this;for(v=0;v<this._materialPromiseLODs.length;v++)H(v)},F.prototype.loadNodeAsync=function(z,p,x){var v=this;return y.b.LoadExtensionAsync(z,p,this.name,function(H,E){var I,P=v._getLODs(H,p,v._loader.gltf.nodes,E.ids);v._loader.logOpen(""+H);for(var T=function(W){var ca=P[W];0!==W&&(v._nodeIndexLOD=W,v._nodeSignalLODs[W]=v._nodeSignalLODs[W]||new h.Deferred());var X=v._loader.loadNodeAsync("#/nodes/"+ca.index,ca,function(ma){ma.setEnabled(!1)}).then(function(ma){if(0!==W){var fa=P[W-1];fa._babylonTransformNode&&(fa._babylonTransformNode.dispose(),delete fa._babylonTransformNode,v._disposeUnusedMaterials())}return ma.setEnabled(!0),ma});0===W?I=X:v._nodeIndexLOD=null,v._nodePromiseLODs[W]=v._nodePromiseLODs[W]||[],v._nodePromiseLODs[W].push(X)},Y=0;Y<P.length;Y++)T(Y);return v._loader.logClose(),I})},F.prototype._loadMaterialAsync=function(z,p,x,v,H){var E=this;return this._nodeIndexLOD?null:y.b.LoadExtensionAsync(z,p,this.name,function(I,P){var T,Y=E._getLODs(I,p,E._loader.gltf.materials,P.ids);E._loader.logOpen(""+I);for(var W=function(X){var ma=Y[X];0!==X&&(E._materialIndexLOD=X);var fa=E._loader._loadMaterialAsync("#/materials/"+ma.index,ma,x,v,function(sa){0===X&&H(sa)}).then(function(sa){if(0!==X){H(sa);var va=Y[X-1]._data;va[v]&&(va[v].babylonMaterial.dispose(),delete va[v])}return sa});0===X?T=fa:E._materialIndexLOD=null,E._materialPromiseLODs[X]=E._materialPromiseLODs[X]||[],E._materialPromiseLODs[X].push(fa)},ca=0;ca<Y.length;ca++)W(ca);return E._loader.logClose(),T})},F.prototype._loadUriAsync=function(z,p,x){var v=this;if(null!==this._materialIndexLOD){this._loader.log("deferred");var H=this._materialIndexLOD-1;return this._materialSignalLODs[H]=this._materialSignalLODs[H]||new h.Deferred(),this._materialSignalLODs[H].promise.then(function(){return v._loader.loadUriAsync(z,p,x)})}return null!==this._nodeIndexLOD?(this._loader.log("deferred"),H=this._nodeIndexLOD-1,this._nodeSignalLODs[H]=this._nodeSignalLODs[H]||new h.Deferred(),this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return v._loader.loadUriAsync(z,p,x)})):null},F.prototype._getLODs=function(z,p,x,v){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var H=new Array(),E=v.length-1;E>=0;E--)if(H.push(y.a.Get(z+"/ids/"+v[E],x,v[E])),H.length===this.maxLODsToLoad)return H;return H.push(p),H},F.prototype._disposeUnusedMaterials=function(){var z=this._loader.gltf.materials;if(z)for(var p=0,x=z;p<x.length;p++){var v=x[p];if(v._data)for(var H in v._data){var E=v._data[H];0===E.babylonMeshes.length&&(E.babylonMaterial.dispose(!1,!0),delete v._data[H])}}},F}();y.b.RegisterExtension(R,function(F){return new Z(F)});var _="MSFT_minecraftMesh",ja=function(){function F(z){this.name=_,this.enabled=!0,this._loader=z}return F.prototype.dispose=function(){delete this._loader},F.prototype.loadMaterialPropertiesAsync=function(z,p,x){var v=this;return y.b.LoadExtraAsync(z,p,this.name,function(H,E){if(E){if(!(x instanceof h.PBRMaterial))throw new Error(H+": Material type not supported");var I=v._loader.loadMaterialPropertiesAsync(z,p,x);return x.needAlphaBlending()&&(x.forceDepthWrite=!0,x.separateCullingPass=!0),x.backFaceCulling=x.forceDepthWrite,x.twoSidedLighting=!0,I}return null})},F}();y.b.RegisterExtension(_,function(F){return new ja(F)});var ra="MSFT_sRGBFactors",oa=function(){function F(z){this.name=ra,this.enabled=!0,this._loader=z}return F.prototype.dispose=function(){delete this._loader},F.prototype.loadMaterialPropertiesAsync=function(z,p,x){var v=this;return y.b.LoadExtraAsync(z,p,this.name,function(H,E){if(E){if(!(x instanceof h.PBRMaterial))throw new Error(H+": Material type not supported");var I=v._loader.loadMaterialPropertiesAsync(z,p,x);return x.albedoTexture||x.albedoColor.toLinearSpaceToRef(x.albedoColor),x.reflectivityTexture||x.reflectivityColor.toLinearSpaceToRef(x.reflectivityColor),I}return null})},F}();y.b.RegisterExtension(ra,function(F){return new oa(F)}),q.d(G,"EXT_lights_image_based",function(){return A}),q.d(G,"KHR_draco_mesh_compression",function(){return c}),q.d(G,"KHR_lights",function(){return e}),q.d(G,"KHR_materials_pbrSpecularGlossiness",function(){return j}),q.d(G,"KHR_materials_unlit",function(){return o}),q.d(G,"KHR_texture_transform",function(){return r}),q.d(G,"MSFT_audio_emitter",function(){return M}),q.d(G,"MSFT_lod",function(){return Z}),q.d(G,"MSFT_minecraftMesh",function(){return ja}),q.d(G,"MSFT_sRGBFactors",function(){return oa})},function(la,G,q){"use strict";q.r(G);var h=q(1);q.d(G,"ArrayItem",function(){return h.a}),q.d(G,"GLTFLoader",function(){return h.b});var y=q(4);q.d(G,"EXT_lights_image_based",function(){return y.EXT_lights_image_based}),q.d(G,"KHR_draco_mesh_compression",function(){return y.KHR_draco_mesh_compression}),q.d(G,"KHR_lights",function(){return y.KHR_lights}),q.d(G,"KHR_materials_pbrSpecularGlossiness",function(){return y.KHR_materials_pbrSpecularGlossiness}),q.d(G,"KHR_materials_unlit",function(){return y.KHR_materials_unlit}),q.d(G,"KHR_texture_transform",function(){return y.KHR_texture_transform}),q.d(G,"MSFT_audio_emitter",function(){return y.MSFT_audio_emitter}),q.d(G,"MSFT_lod",function(){return y.MSFT_lod}),q.d(G,"MSFT_minecraftMesh",function(){return y.MSFT_minecraftMesh}),q.d(G,"MSFT_sRGBFactors",function(){return y.MSFT_sRGBFactors})},function(la,G,q){"use strict";q.r(G);var h=function(d,g){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,n){m.__proto__=n}||function(m,n){for(var k in n)n.hasOwnProperty(k)&&(m[k]=n[k])})(d,g)};function y(d,g){function m(){this.constructor=d}h(d,g),d.prototype=null===g?Object.create(g):(m.prototype=g.prototype,new m())}var D,A,l,c,a,b,e,i;!function(d){d[d.BYTE=5120]="BYTE",d[d.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",d[d.SHORT=5122]="SHORT",d[d.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",d[d.FLOAT=5126]="FLOAT"}(D||(D={})),function(d){d[d.FRAGMENT=35632]="FRAGMENT",d[d.VERTEX=35633]="VERTEX"}(A||(A={})),function(d){d[d.BYTE=5120]="BYTE",d[d.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",d[d.SHORT=5122]="SHORT",d[d.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",d[d.INT=5124]="INT",d[d.UNSIGNED_INT=5125]="UNSIGNED_INT",d[d.FLOAT=5126]="FLOAT",d[d.FLOAT_VEC2=35664]="FLOAT_VEC2",d[d.FLOAT_VEC3=35665]="FLOAT_VEC3",d[d.FLOAT_VEC4=35666]="FLOAT_VEC4",d[d.INT_VEC2=35667]="INT_VEC2",d[d.INT_VEC3=35668]="INT_VEC3",d[d.INT_VEC4=35669]="INT_VEC4",d[d.BOOL=35670]="BOOL",d[d.BOOL_VEC2=35671]="BOOL_VEC2",d[d.BOOL_VEC3=35672]="BOOL_VEC3",d[d.BOOL_VEC4=35673]="BOOL_VEC4",d[d.FLOAT_MAT2=35674]="FLOAT_MAT2",d[d.FLOAT_MAT3=35675]="FLOAT_MAT3",d[d.FLOAT_MAT4=35676]="FLOAT_MAT4",d[d.SAMPLER_2D=35678]="SAMPLER_2D"}(l||(l={})),function(d){d[d.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",d[d.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",d[d.REPEAT=10497]="REPEAT"}(c||(c={})),function(d){d[d.NEAREST=9728]="NEAREST",d[d.LINEAR=9728]="LINEAR",d[d.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",d[d.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",d[d.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",d[d.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(a||(a={})),function(d){d[d.ALPHA=6406]="ALPHA",d[d.RGB=6407]="RGB",d[d.RGBA=6408]="RGBA",d[d.LUMINANCE=6409]="LUMINANCE",d[d.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(b||(b={})),function(d){d[d.FRONT=1028]="FRONT",d[d.BACK=1029]="BACK",d[d.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(e||(e={})),function(d){d[d.ZERO=0]="ZERO",d[d.ONE=1]="ONE",d[d.SRC_COLOR=768]="SRC_COLOR",d[d.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",d[d.DST_COLOR=774]="DST_COLOR",d[d.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",d[d.SRC_ALPHA=770]="SRC_ALPHA",d[d.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",d[d.DST_ALPHA=772]="DST_ALPHA",d[d.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",d[d.CONSTANT_COLOR=32769]="CONSTANT_COLOR",d[d.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",d[d.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",d[d.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",d[d.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(i||(i={}));var j,f=q(0),o=function(){function d(){}return d.SetMatrix=function(g,m,n,k,s){var w=null;if("MODEL"===n.semantic?w=m.getWorldMatrix():"PROJECTION"===n.semantic?w=g.getProjectionMatrix():"VIEW"===n.semantic?w=g.getViewMatrix():"MODELVIEWINVERSETRANSPOSE"===n.semantic?w=f.Matrix.Transpose(m.getWorldMatrix().multiply(g.getViewMatrix()).invert()):"MODELVIEW"===n.semantic?w=m.getWorldMatrix().multiply(g.getViewMatrix()):"MODELVIEWPROJECTION"===n.semantic?w=m.getWorldMatrix().multiply(g.getTransformMatrix()):"MODELINVERSE"===n.semantic?w=m.getWorldMatrix().invert():"VIEWINVERSE"===n.semantic?w=g.getViewMatrix().invert():"PROJECTIONINVERSE"===n.semantic?w=g.getProjectionMatrix().invert():"MODELVIEWINVERSE"===n.semantic?w=m.getWorldMatrix().multiply(g.getViewMatrix()).invert():"MODELVIEWPROJECTIONINVERSE"===n.semantic?w=m.getWorldMatrix().multiply(g.getTransformMatrix()).invert():"MODELINVERSETRANSPOSE"===n.semantic&&(w=f.Matrix.Transpose(m.getWorldMatrix().invert())),w)switch(n.type){case l.FLOAT_MAT2:s.setMatrix2x2(k,f.Matrix.GetAsMatrix2x2(w));break;case l.FLOAT_MAT3:s.setMatrix3x3(k,f.Matrix.GetAsMatrix3x3(w));break;case l.FLOAT_MAT4:s.setMatrix(k,w)}},d.SetUniform=function(g,m,n,k){switch(k){case l.FLOAT:return g.setFloat(m,n),!0;case l.FLOAT_VEC2:return g.setVector2(m,f.Vector2.FromArray(n)),!0;case l.FLOAT_VEC3:return g.setVector3(m,f.Vector3.FromArray(n)),!0;case l.FLOAT_VEC4:return g.setVector4(m,f.Vector4.FromArray(n)),!0;default:return!1}},d.GetWrapMode=function(g){switch(g){case c.CLAMP_TO_EDGE:return f.Texture.CLAMP_ADDRESSMODE;case c.MIRRORED_REPEAT:return f.Texture.MIRROR_ADDRESSMODE;case c.REPEAT:default:return f.Texture.WRAP_ADDRESSMODE}},d.GetByteStrideFromType=function(g){switch(g.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},d.GetTextureFilterMode=function(g){switch(g){case a.LINEAR:case a.LINEAR_MIPMAP_NEAREST:case a.LINEAR_MIPMAP_LINEAR:return f.Texture.TRILINEAR_SAMPLINGMODE;case a.NEAREST:case a.NEAREST_MIPMAP_NEAREST:return f.Texture.NEAREST_SAMPLINGMODE;default:return f.Texture.BILINEAR_SAMPLINGMODE}},d.GetBufferFromBufferView=function(g,m,n,k,s){n=m.byteOffset+n;var w=g.loadedBufferViews[m.buffer];if(n+k>w.byteLength)throw new Error("Buffer access is out of range");var t=w.buffer;switch(n+=w.byteOffset,s){case D.BYTE:return new Int8Array(t,n,k);case D.UNSIGNED_BYTE:return new Uint8Array(t,n,k);case D.SHORT:return new Int16Array(t,n,k);case D.UNSIGNED_SHORT:return new Uint16Array(t,n,k);default:return new Float32Array(t,n,k)}},d.GetBufferFromAccessor=function(g,m){var n=g.bufferViews[m.bufferView],k=m.count*d.GetByteStrideFromType(m);return d.GetBufferFromBufferView(g,n,m.byteOffset,k,m.componentType)},d.DecodeBufferToText=function(g){for(var m="",n=g.byteLength,k=0;k<n;++k)m+=String.fromCharCode(g[k]);return m},d.GetDefaultMaterial=function(g){if(!d._DefaultMaterial){f.Effect.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join(`
`),f.Effect.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join(`
`);var m={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array(),needAlphaBlending:!1};d._DefaultMaterial=new f.ShaderMaterial("GLTFDefaultMaterial",g,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},m),d._DefaultMaterial.setColor4("u_emission",new f.Color4(.5,.5,.5,1))}return d._DefaultMaterial},d._DefaultMaterial=null,d}(),u=q(2);!function(d){d[d.IDENTIFIER=1]="IDENTIFIER",d[d.UNKNOWN=2]="UNKNOWN",d[d.END_OF_INPUT=3]="END_OF_INPUT"}(j||(j={}));var r=function(){function d(g){this._pos=0,this.currentToken=j.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=g,this._maxPos=g.length}return d.prototype.getNextToken=function(){if(this.isEnd())return j.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=j.UNKNOWN,"_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=j.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken},d.prototype.peek=function(){return this._toParse[this._pos]},d.prototype.read=function(){return this._toParse[this._pos++]},d.prototype.forward=function(){this._pos++},d.prototype.isEnd=function(){return this._pos>=this._maxPos},d}(),B=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],M=["world","view","projection","worldView","worldViewProjection","mBones"],R=["translation","rotation","scale"],Z=["position","rotationQuaternion","scaling"],_=function(d,g,m){for(var n in d){var k=d[n];m[g][n]=k}},ja=function(d){if(d)for(var g=0;g<d.length/2;g++)d[2*g+1]=1-d[2*g+1]},ra=function(d){if("NORMAL"===d.semantic)return"normal";if("POSITION"===d.semantic)return"position";if("JOINT"===d.semantic)return"matricesIndices";if("WEIGHT"===d.semantic)return"matricesWeights";if("COLOR"===d.semantic)return"color";if(d.semantic&&-1!==d.semantic.indexOf("TEXCOORD_")){var g=Number(d.semantic.split("_")[1]);return"uv"+(0===g?"":g+1)}return null},oa=function(d){var g=null;if(d.translation||d.rotation||d.scale){var m=f.Vector3.FromArray(d.scale||[1,1,1]),n=f.Quaternion.FromArray(d.rotation||[0,0,0,1]),k=f.Vector3.FromArray(d.translation||[0,0,0]);g=f.Matrix.Compose(m,n,k)}else g=f.Matrix.FromArray(d.matrix);return g},F=function(d,g,m,n){for(var k=0;k<n.bones.length;k++)if(n.bones[k].name===m)return n.bones[k];var s=d.nodes;for(var w in s){var t=s[w];if(t.jointName){var C=t.children;for(k=0;k<C.length;k++){var K=d.nodes[C[k]];if(K.jointName&&K.jointName===m){var V=oa(t),Q=new f.Bone(t.name||"",n,F(d,g,t.jointName,n),V);return Q.id=w,Q}}}}return null},z=function(d,g){for(var m=0;m<d.length;m++)for(var n=d[m],k=0;k<n.node.children.length;k++)if(n.node.children[k]===g)return n.bone;return null},p=function(d,g){var m=d.nodes,n=m[g];if(n)return{node:n,id:g};for(var k in m)if((n=m[k]).jointName===g)return{node:n,id:k};return null},x=function(d,g){for(var m=0;m<d.jointNames.length;m++)if(d.jointNames[m]===g)return!0;return!1},v=function(d,g,m,n,k){if(n||(n=new f.Skeleton(g.name||"","",d.scene)),!g.babylonSkeleton)return n;var s=[],w=[];!function(aa,ea,da,ha){for(var ga in aa.nodes){var ka=aa.nodes[ga],ta=ga;if(ka.jointName&&!x(da,ka.jointName)){var na=oa(ka),pa=new f.Bone(ka.name||"",ea,null,na);pa.id=ta,ha.push({bone:pa,node:ka,id:ta})}}for(var ua=0;ua<ha.length;ua++)for(var xa=ha[ua],qa=xa.node.children,wa=0;wa<qa.length;wa++){for(var ia=null,ya=0;ya<ha.length;ya++)if(ha[ya].id===qa[wa]){ia=ha[ya];break}ia&&(ia.bone._parent=xa.bone,xa.bone.children.push(ia.bone))}}(d,n,g,s),n.bones=[];for(var t=0;t<g.jointNames.length;t++)if(O=p(d,g.jointNames[t])){var C=O.node;if(C){k=O.id;var K=d.scene.getBoneByID(k);if(K)n.bones.push(K);else{for(var V=!1,Q=null,$=0;$<t;$++){var ba=p(d,g.jointNames[$]);if(ba){var L=ba.node;if(L){var J=L.children;if(J){V=!1;for(var S=0;S<J.length;S++)if(J[S]===k){Q=F(d,g,g.jointNames[$],n),V=!0;break}if(V)break}}else f.Tools.Warn("Joint named "+g.jointNames[$]+" does not exist when looking for parent")}}var N=oa(C);!Q&&s.length>0&&(Q=z(s,k))&&-1===w.indexOf(Q)&&w.push(Q),new f.Bone(C.jointName||"",n,Q,N).id=k}}else f.Tools.Warn("Joint named "+g.jointNames[t]+" does not exist")}var U=n.bones;for(n.bones=[],t=0;t<g.jointNames.length;t++){var O;if(O=p(d,g.jointNames[t])){for($=0;$<U.length;$++)if(U[$].id===O.id){n.bones.push(U[$]);break}}}for(n.prepare(),t=0;t<w.length;t++)n.bones.push(w[t]);return n},H=function(d,g,m,n,k){if(k||((k=new f.Mesh(g.name||"",d.scene)).id=n),!g.babylonNode)return k;for(var s,w=[],t=null,C=new Array(),K=new Array(),V=new Array(),Q=new Array(),$=0;$<m.length;$++){var ba=m[$];if(pa=d.meshes[ba])for(var L=0;L<pa.primitives.length;L++){var J=new f.VertexData(),S=pa.primitives[L];S.mode;var N=S.attributes,U=null,O=null;for(var aa in N)if(U=d.accessors[N[aa]],O=o.GetBufferFromAccessor(d,U),"NORMAL"===aa)J.normals=new Float32Array(O.length),J.normals.set(O);else if("POSITION"===aa){if(u.GLTFFileLoader.HomogeneousCoordinates){J.positions=new Float32Array(O.length-O.length/4);for(var ea=0;ea<O.length;ea+=4)J.positions[ea]=O[ea],J.positions[ea+1]=O[ea+1],J.positions[ea+2]=O[ea+2]}else J.positions=new Float32Array(O.length),J.positions.set(O);K.push(J.positions.length)}else if(-1!==aa.indexOf("TEXCOORD_")){var da=Number(aa.split("_")[1]),ha=f.VertexBuffer.UVKind+(0===da?"":da+1),ga=new Float32Array(O.length);ga.set(O),ja(ga),J.set(ga,ha)}else"JOINT"===aa?(J.matricesIndices=new Float32Array(O.length),J.matricesIndices.set(O)):"WEIGHT"===aa?(J.matricesWeights=new Float32Array(O.length),J.matricesWeights.set(O)):"COLOR"===aa&&(J.colors=new Float32Array(O.length),J.colors.set(O));if(U=d.accessors[S.indices])O=o.GetBufferFromAccessor(d,U),J.indices=new Int32Array(O.length),J.indices.set(O),Q.push(J.indices.length);else{var ka=[];for(ea=0;ea<J.positions.length/3;ea++)ka.push(ea);J.indices=new Int32Array(ka),Q.push(J.indices.length)}t?t.merge(J):t=J;var ta=d.scene.getMaterialByID(S.material);w.push(null===ta?o.GetDefaultMaterial(d.scene):ta),C.push(0===C.length?0:C[C.length-1]+K[K.length-2]),V.push(0===V.length?0:V[V.length-1]+Q[Q.length-2])}}w.length>1?(s=new f.MultiMaterial("multimat"+n,d.scene)).subMaterials=w:s=new f.StandardMaterial("multimat"+n,d.scene),1===w.length&&(s=w[0]),k.material||(k.material=s),new f.Geometry(n,d.scene,t,!1,k),k.computeWorldMatrix(!0),k.subMeshes=[];var na=0;for($=0;$<m.length;$++){var pa;ba=m[$];if(pa=d.meshes[ba])for(L=0;L<pa.primitives.length;L++)pa.primitives[L].mode,f.SubMesh.AddToMesh(na,C[na],K[na],V[na],Q[na],k,k,!0),na++}return k},E=function(d,g,m,n){d.position&&(d.position=g),(d.rotationQuaternion||d.rotation)&&(d.rotationQuaternion=m),d.scaling&&(d.scaling=n)},I=function(d,g,m,n){var k=null;if(d.importOnlyMeshes&&(g.skin||g.meshes)&&d.importMeshesNames&&d.importMeshesNames.length>0&&-1===d.importMeshesNames.indexOf(g.name||""))return null;if(g.skin){if(g.meshes){var s=d.skins[g.skin];(w=H(d,g,g.meshes,m,g.babylonNode)).skeleton=d.scene.getLastSkeletonByID(g.skin),null===w.skeleton&&(w.skeleton=v(d,s,0,s.babylonSkeleton,g.skin),s.babylonSkeleton||(s.babylonSkeleton=w.skeleton)),k=w}}else if(g.meshes){var w;k=w=H(d,g,g.mesh?[g.mesh]:g.meshes,m,g.babylonNode)}else if(!g.light||g.babylonNode||d.importOnlyMeshes){if(g.camera&&!g.babylonNode&&!d.importOnlyMeshes){var t=d.cameras[g.camera];if(t){if("orthographic"===t.type){var C=new f.FreeCamera(g.camera,f.Vector3.Zero(),d.scene,!1);C.name=g.name||"",C.mode=f.Camera.ORTHOGRAPHIC_CAMERA,C.attachControl(d.scene.getEngine().getRenderingCanvas()),k=C}else if("perspective"===t.type){var K=t[t.type],V=new f.FreeCamera(g.camera,f.Vector3.Zero(),d.scene,!1);V.name=g.name||"",V.attachControl(d.scene.getEngine().getRenderingCanvas()),K.aspectRatio||(K.aspectRatio=d.scene.getEngine().getRenderWidth()/d.scene.getEngine().getRenderHeight()),K.znear&&K.zfar&&(V.maxZ=K.zfar,V.minZ=K.znear),k=V}}}}else{var Q=d.lights[g.light];if(Q){if("ambient"===Q.type){var $=Q[Q.type],ba=new f.HemisphericLight(g.light,f.Vector3.Zero(),d.scene);ba.name=g.name||"",$.color&&(ba.diffuse=f.Color3.FromArray($.color)),k=ba}else if("directional"===Q.type){var L=Q[Q.type],J=new f.DirectionalLight(g.light,f.Vector3.Zero(),d.scene);J.name=g.name||"",L.color&&(J.diffuse=f.Color3.FromArray(L.color)),k=J}else if("point"===Q.type){var S=Q[Q.type],N=new f.PointLight(g.light,f.Vector3.Zero(),d.scene);N.name=g.name||"",S.color&&(N.diffuse=f.Color3.FromArray(S.color)),k=N}else if("spot"===Q.type){var U=Q[Q.type],O=new f.SpotLight(g.light,f.Vector3.Zero(),f.Vector3.Zero(),0,0,d.scene);O.name=g.name||"",U.color&&(O.diffuse=f.Color3.FromArray(U.color)),U.fallOfAngle&&(O.angle=U.fallOfAngle),U.fallOffExponent&&(O.exponent=U.fallOffExponent),k=O}}}if(!g.jointName){if(g.babylonNode)return g.babylonNode;if(null===k){var aa=new f.Mesh(g.name||"",d.scene);g.babylonNode=aa,k=aa}}if(null!==k){if(g.matrix&&k instanceof f.Mesh)!function(ga,ka,ta){if(ka.matrix){var na=new f.Vector3(0,0,0),pa=new f.Quaternion(),ua=new f.Vector3(0,0,0);f.Matrix.FromArray(ka.matrix).decompose(ua,pa,na),E(ga,na,pa,ua)}else ka.translation&&ka.rotation&&ka.scale&&E(ga,f.Vector3.FromArray(ka.translation),f.Quaternion.FromArray(ka.rotation),f.Vector3.FromArray(ka.scale));ga.computeWorldMatrix(!0)}(k,g);else{var ea=g.translation||[0,0,0],da=g.rotation||[0,0,0,1],ha=g.scale||[1,1,1];E(k,f.Vector3.FromArray(ea),f.Quaternion.FromArray(da),f.Vector3.FromArray(ha))}k.updateCache(!0),g.babylonNode=k}return k},P=function(d,g,m,n){void 0===n&&(n=!1);var k=d.nodes[g],s=null;if(n=!(d.importOnlyMeshes&&!n&&d.importMeshesNames)||(-1!==d.importMeshesNames.indexOf(k.name||"")||0===d.importMeshesNames.length),!k.jointName&&n&&null!==(s=I(d,k,g))&&(s.id=g,s.parent=m),k.children)for(var w=0;w<k.children.length;w++)P(d,k.children[w],s,n)},T=function(d){var g=d.currentScene;if(g)for(var m=0;m<g.nodes.length;m++)P(d,g.nodes[m],null);else for(var n in d.scenes)for(g=d.scenes[n],m=0;m<g.nodes.length;m++)P(d,g.nodes[m],null);for(!function(s){for(var w in s.animations){var t=s.animations[w];if(t.channels&&t.samplers)for(var C=null,K=0;K<t.channels.length;K++){var V=t.channels[K],Q=t.samplers[V.sampler];if(Q){var $=null,ba=null;t.parameters?($=t.parameters[Q.input],ba=t.parameters[Q.output]):($=Q.input,ba=Q.output);var L=o.GetBufferFromAccessor(s,s.accessors[$]),J=o.GetBufferFromAccessor(s,s.accessors[ba]),S=V.target.id,N=s.scene.getNodeByID(S);if(null===N&&(N=s.scene.getNodeByName(S)),null!==N){var U=N instanceof f.Bone,O=V.target.path,aa=R.indexOf(O);-1!==aa&&(O=Z[aa]);var ea=f.Animation.ANIMATIONTYPE_MATRIX;U||("rotationQuaternion"===O?(ea=f.Animation.ANIMATIONTYPE_QUATERNION,N.rotationQuaternion=new f.Quaternion()):ea=f.Animation.ANIMATIONTYPE_VECTOR3);var da=null,ha=[],ga=0,ka=!1;U&&C&&C.getKeys().length===L.length&&(da=C,ka=!0),ka||(da=new f.Animation(w,U?"_matrix":O,1,ea,f.Animation.ANIMATIONLOOPMODE_CYCLE));for(var ta=0;ta<L.length;ta++){var na=null;if("rotationQuaternion"===O?(na=f.Quaternion.FromArray([J[ga],J[ga+1],J[ga+2],J[ga+3]]),ga+=4):(na=f.Vector3.FromArray([J[ga],J[ga+1],J[ga+2]]),ga+=3),U){var pa=N,ua=f.Vector3.Zero(),xa=new f.Quaternion(),qa=f.Vector3.Zero(),wa=pa.getBaseMatrix();ka&&C&&(wa=C.getKeys()[ta].value),wa.decompose(qa,xa,ua),"position"===O?ua=na:"rotationQuaternion"===O?xa=na:qa=na,na=f.Matrix.Compose(qa,xa,ua)}ka?C&&(C.getKeys()[ta].value=na):ha.push({frame:L[ta],value:na})}!ka&&da&&(da.setKeys(ha),N.animations.push(da)),C=da,s.scene.stopAnimation(N),s.scene.beginAnimation(N,0,L[L.length-1],!0,1)}else f.Tools.Warn("Creating animation named "+w+". But cannot find node named "+S+" to attach to")}}}}(d),m=0;m<d.scene.skeletons.length;m++){var k=d.scene.skeletons[m];d.scene.beginAnimation(k,0,Number.MAX_VALUE,!0,1)}},Y=function(d,g,m,n,k,s){return function(w){!function(t,C,K,V,Q){var $=V.values||K.parameters,ba=K.uniforms;for(var L in Q){var J=Q[L],S=J.type,N=$[ba[L]];if(void 0===N&&(N=J.value),N){var U=function(O){return function(aa){J.value&&O&&(C.setTexture(O,aa),delete Q[O])}};S===l.SAMPLER_2D?fa.LoadTextureAsync(t,V.values?N:J.value,U(L),function(){return U(null)}):J.value&&o.SetUniform(C,L,V.values?N:J.value,S)&&delete Q[L]}}}(d,g,m,n,k),g.onBind=function(t){!function(C,K,V,Q,$,ba,L){var J=ba.values||$.parameters;for(var S in V){var N=V[S],U=N.type;if(U===l.FLOAT_MAT2||U===l.FLOAT_MAT3||U===l.FLOAT_MAT4)if(!N.semantic||N.source||N.node){if(N.semantic&&(N.source||N.node)){var O=K.scene.getNodeByName(N.source||N.node||"");if(null===O&&(O=K.scene.getNodeByID(N.source||N.node||"")),null===O)continue;o.SetMatrix(K.scene,O,N,S,Q.getEffect())}}else o.SetMatrix(K.scene,C,N,S,Q.getEffect());else{var aa=J[$.uniforms[S]];if(!aa)continue;if(U===l.SAMPLER_2D){var ea=K.textures[ba.values?aa:N.value].babylonTexture;if(null==ea)continue;Q.getEffect().setTexture(S,ea)}else o.SetUniform(Q.getEffect(),S,aa,U)}}L(Q)}(t,d,k,g,m,n,s)}}},W=function(d,g,m){for(var n in g.uniforms){var k=g.uniforms[n],s=g.parameters[k];if(d.currentIdentifier===n&&s.semantic&&!s.source&&!s.node){var w=B.indexOf(s.semantic);if(-1!==w)return delete m[n],M[w]}}return d.currentIdentifier},ca=function(d){for(var g in d.materials)fa.LoadMaterialAsync(d,g,function(m){},function(){})},X=function(){function d(){}return d.CreateRuntime=function(g,m,n){var k={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:m,rootUrl:n,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[]};return g.extensions&&_(g.extensions,"extensions",k),g.extensionsUsed&&_(g.extensionsUsed,"extensionsUsed",k),g.buffers&&function(s,w){for(var t in s){var C=s[t];w.buffers[t]=C,w.buffersCount++}}(g.buffers,k),g.bufferViews&&_(g.bufferViews,"bufferViews",k),g.accessors&&_(g.accessors,"accessors",k),g.meshes&&_(g.meshes,"meshes",k),g.lights&&_(g.lights,"lights",k),g.cameras&&_(g.cameras,"cameras",k),g.nodes&&_(g.nodes,"nodes",k),g.images&&_(g.images,"images",k),g.textures&&_(g.textures,"textures",k),g.shaders&&function(s,w){for(var t in s){var C=s[t];w.shaders[t]=C,w.shaderscount++}}(g.shaders,k),g.programs&&_(g.programs,"programs",k),g.samplers&&_(g.samplers,"samplers",k),g.techniques&&_(g.techniques,"techniques",k),g.materials&&_(g.materials,"materials",k),g.animations&&_(g.animations,"animations",k),g.skins&&_(g.skins,"skins",k),g.scenes&&(k.scenes=g.scenes),g.scene&&g.scenes&&(k.currentScene=g.scenes[g.scene]),k},d.LoadBufferAsync=function(g,m,n,k,s){var w=g.buffers[m];f.Tools.IsBase64(w.uri)?setTimeout(function(){return n(new Uint8Array(f.Tools.DecodeBase64(w.uri)))}):f.Tools.LoadFile(g.rootUrl+w.uri,function(t){return n(new Uint8Array(t))},s,void 0,!0,function(t){t&&k(t.status+" "+t.statusText)})},d.LoadTextureBufferAsync=function(g,m,n,k){var s=g.textures[m];if(s&&s.source)if(s.babylonTexture)n(null);else{var w=g.images[s.source];f.Tools.IsBase64(w.uri)?setTimeout(function(){return n(new Uint8Array(f.Tools.DecodeBase64(w.uri)))}):f.Tools.LoadFile(g.rootUrl+w.uri,function(t){return n(new Uint8Array(t))},void 0,void 0,!0,function(t){t&&k(t.status+" "+t.statusText)})}else k("")},d.CreateTextureAsync=function(g,m,n,k,s){var w=g.textures[m];if(w.babylonTexture)k(w.babylonTexture);else{var t=g.samplers[w.sampler],C=t.minFilter===a.NEAREST_MIPMAP_NEAREST||t.minFilter===a.NEAREST_MIPMAP_LINEAR||t.minFilter===a.LINEAR_MIPMAP_NEAREST||t.minFilter===a.LINEAR_MIPMAP_LINEAR,K=f.Texture.BILINEAR_SAMPLINGMODE,V=null==n?new Blob():new Blob([n]),Q=URL.createObjectURL(V),$=function(){return URL.revokeObjectURL(Q)},ba=new f.Texture(Q,g.scene,!C,!0,K,$,$);void 0!==t.wrapS&&(ba.wrapU=o.GetWrapMode(t.wrapS)),void 0!==t.wrapT&&(ba.wrapV=o.GetWrapMode(t.wrapT)),ba.name=m,w.babylonTexture=ba,k(ba)}},d.LoadShaderStringAsync=function(g,m,n,k){var s=g.shaders[m];if(f.Tools.IsBase64(s.uri)){var w=atob(s.uri.split(",")[1]);n&&n(w)}else f.Tools.LoadFile(g.rootUrl+s.uri,n,void 0,void 0,!1,function(t){t&&k&&k(t.status+" "+t.statusText)})},d.LoadMaterialAsync=function(g,m,n,k){var s=g.materials[m];if(s.technique){var w=g.techniques[s.technique];if(!w){var t=new f.StandardMaterial(m,g.scene);return t.diffuseColor=new f.Color3(.5,.5,.5),t.sideOrientation=f.Material.CounterClockWiseSideOrientation,void n(t)}var C=g.programs[w.program],K=w.states,V=f.Effect.ShadersStore[C.vertexShader+"VertexShader"],Q=f.Effect.ShadersStore[C.fragmentShader+"PixelShader"],$="",ba="",L=new r(V),J=new r(Q),S={},N=[],U=[],O=[];for(var aa in w.uniforms){var ea=w.uniforms[aa],da=w.parameters[ea];if(S[aa]=da,!da.semantic||da.node||da.source)da.type===l.SAMPLER_2D?O.push(aa):N.push(aa);else{var ha=B.indexOf(da.semantic);-1!==ha?(N.push(M[ha]),delete S[aa]):N.push(aa)}}for(var ga in w.attributes){var ka=w.attributes[ga];if((pa=w.parameters[ka]).semantic){var ta=ra(pa);ta&&U.push(ta)}}for(;!L.isEnd()&&L.getNextToken();)if(L.currentToken===j.IDENTIFIER){var na=!1;for(var ga in w.attributes){ka=w.attributes[ga];var pa=w.parameters[ka];if(L.currentIdentifier===ga&&pa.semantic){$+=ra(pa),na=!0;break}}na||($+=W(L,w,S))}else $+=L.currentString;for(;!J.isEnd()&&J.getNextToken();)J.currentToken===j.IDENTIFIER?ba+=W(J,w,S):ba+=J.currentString;var ua={vertex:C.vertexShader+m,fragment:C.fragmentShader+m},xa={attributes:U,uniforms:N,samplers:O,needAlphaBlending:K&&K.enable&&-1!==K.enable.indexOf(3042)};f.Effect.ShadersStore[C.vertexShader+m+"VertexShader"]=$,f.Effect.ShadersStore[C.fragmentShader+m+"PixelShader"]=ba;var qa=new f.ShaderMaterial(m,g.scene,ua,xa);if(qa.onError=function(ya,Da,Ea){return function(Ga,Fa){Da.dispose(!0),Ea("Cannot compile program named "+ya.name+". Error: "+Fa+". Default material will be applied")}}(C,qa,k),qa.onCompiled=Y(g,qa,w,s,S,n),qa.sideOrientation=f.Material.CounterClockWiseSideOrientation,K&&K.functions){var wa=K.functions;wa.cullFace&&wa.cullFace[0]!==e.BACK&&(qa.backFaceCulling=!1);var ia=wa.blendFuncSeparate;ia&&(ia[0]===i.SRC_ALPHA&&ia[1]===i.ONE_MINUS_SRC_ALPHA&&ia[2]===i.ONE&&ia[3]===i.ONE?qa.alphaMode=f.Engine.ALPHA_COMBINE:ia[0]===i.ONE&&ia[1]===i.ONE&&ia[2]===i.ZERO&&ia[3]===i.ONE?qa.alphaMode=f.Engine.ALPHA_ONEONE:ia[0]===i.SRC_ALPHA&&ia[1]===i.ONE&&ia[2]===i.ZERO&&ia[3]===i.ONE?qa.alphaMode=f.Engine.ALPHA_ADD:ia[0]===i.ZERO&&ia[1]===i.ONE_MINUS_SRC_COLOR&&ia[2]===i.ONE&&ia[3]===i.ONE?qa.alphaMode=f.Engine.ALPHA_SUBTRACT:ia[0]===i.DST_COLOR&&ia[1]===i.ZERO&&ia[2]===i.ONE&&ia[3]===i.ONE?qa.alphaMode=f.Engine.ALPHA_MULTIPLY:ia[0]===i.SRC_ALPHA&&ia[1]===i.ONE_MINUS_SRC_COLOR&&ia[2]===i.ONE&&ia[3]===i.ONE&&(qa.alphaMode=f.Engine.ALPHA_MAXIMIZED))}}else k&&k("No technique found.")},d}(),ma=function(){function d(){this.state=null}return d.RegisterExtension=function(g){d.Extensions[g.name]?f.Tools.Error('Tool with the same name "'+g.name+'" already exists'):d.Extensions[g.name]=g},d.prototype.dispose=function(){},d.prototype._importMeshAsync=function(g,m,n,k,s,w,t){var C=this;return m.useRightHandedSystem=!0,fa.LoadRuntimeAsync(m,n,k,function(K){K.importOnlyMeshes=!0,""===g?K.importMeshesNames=[]:"string"==typeof g?K.importMeshesNames=[g]:!g||g instanceof Array?(K.importMeshesNames=[],f.Tools.Warn("Argument meshesNames must be of type string or string[]")):K.importMeshesNames=[g],C._createNodes(K);var V=new Array(),Q=new Array();for(var $ in K.nodes){var ba=K.nodes[$];ba.babylonNode instanceof f.AbstractMesh&&V.push(ba.babylonNode)}for(var L in K.skins){var J=K.skins[L];J.babylonSkeleton instanceof f.Skeleton&&Q.push(J.babylonSkeleton)}C._loadBuffersAsync(K,function(){C._loadShadersAsync(K,function(){ca(K),T(K),!u.GLTFFileLoader.IncrementalLoading&&s&&s(V,Q)})},w),u.GLTFFileLoader.IncrementalLoading&&s&&s(V,Q)},t),!0},d.prototype.importMeshAsync=function(g,m,n,k,s){var w=this;return new Promise(function(t,C){w._importMeshAsync(g,m,n,k,function(K,V){t({meshes:K,particleSystems:[],skeletons:V,animationGroups:[]})},s,function(K){C(new Error(K))})})},d.prototype._loadAsync=function(g,m,n,k,s,w){var t=this;g.useRightHandedSystem=!0,fa.LoadRuntimeAsync(g,m,n,function(C){fa.LoadRuntimeExtensionsAsync(C,function(){t._createNodes(C),t._loadBuffersAsync(C,function(){t._loadShadersAsync(C,function(){ca(C),T(C),u.GLTFFileLoader.IncrementalLoading||k()})}),u.GLTFFileLoader.IncrementalLoading&&k()},w)},w)},d.prototype.loadAsync=function(g,m,n,k){var s=this;return new Promise(function(w,t){s._loadAsync(g,m,n,function(){w()},k,function(C){t(new Error(C))})})},d.prototype._loadShadersAsync=function(g,m){var n=!1,k=function(t,C){fa.LoadShaderStringAsync(g,t,function(K){K instanceof ArrayBuffer||(g.loadedShaderCount++,K&&(f.Effect.ShadersStore[t+(C.type===A.VERTEX?"VertexShader":"PixelShader")]=K),g.loadedShaderCount===g.shaderscount&&m())},function(){f.Tools.Error("Error when loading shader program named "+t+" located at "+C.uri)})};for(var s in g.shaders){n=!0;var w=g.shaders[s];w?k.bind(this,s,w)():f.Tools.Error("No shader named: "+s)}n||m()},d.prototype._loadBuffersAsync=function(g,m,n){var k=!1,s=function(C,K){fa.LoadBufferAsync(g,C,function(V){g.loadedBufferCount++,V&&(V.byteLength!=g.buffers[C].byteLength&&f.Tools.Error("Buffer named "+C+" is length "+V.byteLength+". Expected: "+K.byteLength),g.loadedBufferViews[C]=V),g.loadedBufferCount===g.buffersCount&&m()},function(){f.Tools.Error("Error when loading buffer named "+C+" located at "+K.uri)})};for(var w in g.buffers){k=!0;var t=g.buffers[w];t?s.bind(this,w,t)():f.Tools.Error("No buffer named: "+w)}k||m()},d.prototype._createNodes=function(g){var m=g.currentScene;if(m)for(var n=0;n<m.nodes.length;n++)P(g,m.nodes[n],null);else for(var k in g.scenes)for(m=g.scenes[k],n=0;n<m.nodes.length;n++)P(g,m.nodes[n],null)},d.Extensions={},d}(),fa=function(){function d(g){this._name=g}return Object.defineProperty(d.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),d.prototype.loadRuntimeAsync=function(g,m,n,k,s){return!1},d.prototype.loadRuntimeExtensionsAsync=function(g,m,n){return!1},d.prototype.loadBufferAsync=function(g,m,n,k,s){return!1},d.prototype.loadTextureBufferAsync=function(g,m,n,k){return!1},d.prototype.createTextureAsync=function(g,m,n,k,s){return!1},d.prototype.loadShaderStringAsync=function(g,m,n,k){return!1},d.prototype.loadMaterialAsync=function(g,m,n,k){return!1},d.LoadRuntimeAsync=function(g,m,n,k,s){d.ApplyExtensions(function(w){return w.loadRuntimeAsync(g,m,n,k,s)},function(){setTimeout(function(){k&&k(X.CreateRuntime(m.json,g,n))})})},d.LoadRuntimeExtensionsAsync=function(g,m,n){d.ApplyExtensions(function(k){return k.loadRuntimeExtensionsAsync(g,m,n)},function(){setTimeout(function(){m()})})},d.LoadBufferAsync=function(g,m,n,k,s){d.ApplyExtensions(function(w){return w.loadBufferAsync(g,m,n,k,s)},function(){X.LoadBufferAsync(g,m,n,k,s)})},d.LoadTextureAsync=function(g,m,n,k){d.LoadTextureBufferAsync(g,m,function(s){s&&d.CreateTextureAsync(g,m,s,n,k)},k)},d.LoadShaderStringAsync=function(g,m,n,k){d.ApplyExtensions(function(s){return s.loadShaderStringAsync(g,m,n,k)},function(){X.LoadShaderStringAsync(g,m,n,k)})},d.LoadMaterialAsync=function(g,m,n,k){d.ApplyExtensions(function(s){return s.loadMaterialAsync(g,m,n,k)},function(){X.LoadMaterialAsync(g,m,n,k)})},d.LoadTextureBufferAsync=function(g,m,n,k){d.ApplyExtensions(function(s){return s.loadTextureBufferAsync(g,m,n,k)},function(){X.LoadTextureBufferAsync(g,m,n,k)})},d.CreateTextureAsync=function(g,m,n,k,s){d.ApplyExtensions(function(w){return w.createTextureAsync(g,m,n,k,s)},function(){X.CreateTextureAsync(g,m,n,k,s)})},d.ApplyExtensions=function(g,m){for(var n in ma.Extensions)if(g(ma.Extensions[n]))return;m()},d}();u.GLTFFileLoader._CreateGLTF1Loader=function(){return new ma()};var sa=function(d){function g(){return d.call(this,"KHR_binary_glTF")||this}return y(g,d),g.prototype.loadRuntimeAsync=function(m,n,k,s,w){var t=n.json.extensionsUsed;return!(!t||-1===t.indexOf(this.name)||!n.bin)&&(this._bin=n.bin,s(X.CreateRuntime(n.json,m,k)),!0)},g.prototype.loadBufferAsync=function(m,n,k,s){return-1!==m.extensionsUsed.indexOf(this.name)&&("binary_glTF"===n&&(k(this._bin),!0))},g.prototype.loadTextureBufferAsync=function(m,n,k,s){var w=m.textures[n],t=m.images[w.source];if(!(t.extensions&&this.name in t.extensions))return!1;var C=t.extensions[this.name],K=m.bufferViews[C.bufferView];return k(o.GetBufferFromBufferView(m,K,0,K.byteLength,D.UNSIGNED_BYTE)),!0},g.prototype.loadShaderStringAsync=function(m,n,k,s){var w=m.shaders[n];if(!(w.extensions&&this.name in w.extensions))return!1;var t=w.extensions[this.name],C=m.bufferViews[t.bufferView],K=o.GetBufferFromBufferView(m,C,0,C.byteLength,D.UNSIGNED_BYTE);return setTimeout(function(){var V=o.DecodeBufferToText(K);k(V)}),!0},g}(fa);ma.RegisterExtension(new sa());var va=function(d){function g(){return d.call(this,"KHR_materials_common")||this}return y(g,d),g.prototype.loadRuntimeExtensionsAsync=function(m,n,k){if(!m.extensions)return!1;var s=m.extensions[this.name];if(!s)return!1;var w=s.lights;if(w)for(var t in w){var C=w[t];switch(C.type){case"ambient":var K=new f.HemisphericLight(C.name,new f.Vector3(0,1,0),m.scene),V=C.ambient;V&&(K.diffuse=f.Color3.FromArray(V.color||[1,1,1]));break;case"point":var Q=new f.PointLight(C.name,new f.Vector3(10,10,10),m.scene),$=C.point;$&&(Q.diffuse=f.Color3.FromArray($.color||[1,1,1]));break;case"directional":var ba=new f.DirectionalLight(C.name,new f.Vector3(0,-1,0),m.scene),L=C.directional;L&&(ba.diffuse=f.Color3.FromArray(L.color||[1,1,1]));break;case"spot":var J=C.spot;J&&(new f.SpotLight(C.name,new f.Vector3(0,10,0),new f.Vector3(0,-1,0),J.fallOffAngle||Math.PI,J.fallOffExponent||0,m.scene).diffuse=f.Color3.FromArray(J.color||[1,1,1]));break;default:f.Tools.Warn('GLTF Material Common extension: light type "'+C.type+"â not supported")}}return!1},g.prototype.loadMaterialAsync=function(m,n,k,s){var w=m.materials[n];if(!w||!w.extensions)return!1;var t=w.extensions[this.name];if(!t)return!1;var C=new f.StandardMaterial(n,m.scene);return C.sideOrientation=f.Material.CounterClockWiseSideOrientation,"CONSTANT"===t.technique&&(C.disableLighting=!0),C.backFaceCulling=void 0!==t.doubleSided&&!t.doubleSided,C.alpha=void 0===t.values.transparency?1:t.values.transparency,C.specularPower=void 0===t.values.shininess?0:t.values.shininess,"string"==typeof t.values.ambient?this._loadTexture(m,t.values.ambient,C,"ambientTexture",s):C.ambientColor=f.Color3.FromArray(t.values.ambient||[0,0,0]),"string"==typeof t.values.diffuse?this._loadTexture(m,t.values.diffuse,C,"diffuseTexture",s):C.diffuseColor=f.Color3.FromArray(t.values.diffuse||[0,0,0]),"string"==typeof t.values.emission?this._loadTexture(m,t.values.emission,C,"emissiveTexture",s):C.emissiveColor=f.Color3.FromArray(t.values.emission||[0,0,0]),"string"==typeof t.values.specular?this._loadTexture(m,t.values.specular,C,"specularTexture",s):C.specularColor=f.Color3.FromArray(t.values.specular||[0,0,0]),!0},g.prototype._loadTexture=function(m,n,k,s,w){X.LoadTextureBufferAsync(m,n,function(t){X.CreateTextureAsync(m,n,t,function(C){return k[s]=C},w)},w)},g}(fa);ma.RegisterExtension(new va()),q.d(G,"GLTFBinaryExtension",function(){return sa}),q.d(G,"GLTFLoaderBase",function(){return X}),q.d(G,"GLTFLoader",function(){return ma}),q.d(G,"GLTFLoaderExtension",function(){return fa}),q.d(G,"EComponentType",function(){return D}),q.d(G,"EShaderType",function(){return A}),q.d(G,"EParameterType",function(){return l}),q.d(G,"ETextureWrapMode",function(){return c}),q.d(G,"ETextureFilterType",function(){return a}),q.d(G,"ETextureFormat",function(){return b}),q.d(G,"ECullingType",function(){return e}),q.d(G,"EBlendingFunction",function(){return i}),q.d(G,"GLTFUtils",function(){return o}),q.d(G,"GLTFMaterialsCommonExtension",function(){return va})},function(la,G,q){"use strict";q.r(G);var h=q(0),y=function(){function A(){this.materials=[]}return A.prototype.parseMTL=function(l,c,a){if(!(c instanceof ArrayBuffer)){for(var b,e=c.split(`
`),i=/\s+/,j=null,f=0;f<e.length;f++){var o=e[f].trim();if(0!==o.length&&"#"!==o.charAt(0)){var u=o.indexOf(" "),r=u>=0?o.substring(0,u):o;r=r.toLowerCase();var B=u>=0?o.substring(u+1).trim():"";"newmtl"===r?(j&&this.materials.push(j),j=new h.StandardMaterial(B,l)):"kd"===r&&j?(b=B.split(i,3).map(parseFloat),j.diffuseColor=h.Color3.FromArray(b)):"ka"===r&&j?(b=B.split(i,3).map(parseFloat),j.ambientColor=h.Color3.FromArray(b)):"ks"===r&&j?(b=B.split(i,3).map(parseFloat),j.specularColor=h.Color3.FromArray(b)):"ke"===r&&j?(b=B.split(i,3).map(parseFloat),j.emissiveColor=h.Color3.FromArray(b)):"ns"===r&&j?j.specularPower=parseFloat(B):"d"===r&&j?j.alpha=parseFloat(B):"map_ka"===r&&j?j.ambientTexture=A._getTexture(a,B,l):"map_kd"===r&&j?j.diffuseTexture=A._getTexture(a,B,l):"map_ks"===r&&j?j.specularTexture=A._getTexture(a,B,l):"map_ns"===r||("map_bump"===r&&j?j.bumpTexture=A._getTexture(a,B,l):"map_d"===r&&j&&(j.opacityTexture=A._getTexture(a,B,l)))}}j&&this.materials.push(j)}},A._getTexture=function(l,c,a){if(!c)return null;var b=l;if("file:"===l){var e=c.lastIndexOf("\\");-1===e&&(e=c.lastIndexOf("/")),b+=e>-1?c.substr(e+1):c}else b+=c;return new h.Texture(b,a,!1,D.INVERT_TEXTURE_Y)},A}(),D=function(){function A(l){this.name="obj",this.extensions=".obj",this.obj=/^o/,this.group=/^g/,this.mtllib=/^mtllib /,this.usemtl=/^usemtl /,this.smooth=/^s /,this.vertexPattern=/v( +[\d|\.|\+|\-|e|E]+){3,7}/,this.normalPattern=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.uvPattern=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.facePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,this.facePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,this.facePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,this._meshLoadOptions=l||A.currentMeshLoadOptions}return Object.defineProperty(A,"currentMeshLoadOptions",{get:function(){return{ComputeNormals:A.COMPUTE_NORMALS,ImportVertexColors:A.IMPORT_VERTEX_COLORS,InvertY:A.INVERT_Y,InvertTextureY:A.INVERT_TEXTURE_Y,UVScaling:A.UV_SCALING,MaterialLoadingFailsSilently:A.MATERIAL_LOADING_FAILS_SILENTLY,OptimizeWithUV:A.OPTIMIZE_WITH_UV,SkipMaterials:A.SKIP_MATERIALS}},enumerable:!0,configurable:!0}),A.prototype._loadMTL=function(l,c,a,b){var e=h.Tools.BaseUrl+c+l;h.Tools.LoadFile(e,a,void 0,void 0,!1,function(i,j){b(e,j)})},A.prototype.createPlugin=function(){return new A(A.currentMeshLoadOptions)},A.prototype.canDirectLoad=function(l){return!1},A.prototype.importMeshAsync=function(l,c,a,b,e,i){return this._parseSolid(l,c,a,b).then(function(j){return{meshes:j,particleSystems:[],skeletons:[],animationGroups:[]}})},A.prototype.loadAsync=function(l,c,a,b,e){return this.importMeshAsync(null,l,c,a,b).then(function(){})},A.prototype.loadAssetContainerAsync=function(l,c,a,b,e){return this.importMeshAsync(null,l,c,a).then(function(i){var j=new h.AssetContainer(l);return i.meshes.forEach(function(f){return j.meshes.push(f)}),i.meshes.forEach(function(f){var o=f.material;o&&(-1==j.materials.indexOf(o)&&(j.materials.push(o),o.getActiveTextures().forEach(function(u){-1==j.textures.indexOf(u)&&j.textures.push(u)})))}),j.removeAllFromScene(),j})},A.prototype._parseSolid=function(l,c,a,b){for(var e,i=this,j=[],f=[],o=[],u=[],r=[],B=[],M=[],R=[],Z=[],_=[],ja=[],ra=0,oa=!1,F=[],z=[],p=[],x=[],v=[],H="",E="",I=new y(),P=1,T=!0,Y=new h.Color4(.5,.5,.5,1),W=function(L,J,S,N,U,O,aa){var ea;-1===(ea=i._meshLoadOptions.OptimizeWithUV?function(da,ha){da[ha[0]]||(da[ha[0]]={normals:[],idx:[],uv:[]});var ga=da[ha[0]].normals.indexOf(ha[1]);return 1!=ga&&ha[2]===da[ha[0]].uv[ga]?da[ha[0]].idx[ga]:-1}(ja,[L,S,J]):function(da,ha){da[ha[0]]||(da[ha[0]]={normals:[],idx:[]});var ga=da[ha[0]].normals.indexOf(ha[1]);return-1===ga?-1:da[ha[0]].idx[ga]}(ja,[L,S]))?(B.push(M.length),M.push(N),R.push(U),_.push(O),void 0!==aa&&Z.push(aa),ja[L].normals.push(S),ja[L].idx.push(ra++),i._meshLoadOptions.OptimizeWithUV&&ja[L].uv.push(J)):B.push(ea)},ca=function(){for(var L=0;L<M.length;L++)F.push(M[L].x,M[L].y,M[L].z),p.push(_[L].x,_[L].y,_[L].z),x.push(R[L].x,R[L].y);!0===i._meshLoadOptions.ImportVertexColors&&z.push(Z[L].r,Z[L].g,Z[L].b,Z[L].a),M=[],_=[],R=[],Z=[],ja=[],ra=0},X=function(L,J){J+1<L.length&&(v.push(L[0],L[J],L[J+1]),X(L,J+=1))},ma=function(L,J){X(L,J);for(var S=0;S<v.length;S++){var N=parseInt(v[S])-1;W(N,0,0,j[N],h.Vector2.Zero(),h.Vector3.Up(),!0===i._meshLoadOptions.ImportVertexColors?u[N]:void 0)}v=[]},fa=function(L,J){X(L,J);for(var S=0;S<v.length;S++){var N=v[S].split("/"),U=parseInt(N[0])-1,O=parseInt(N[1])-1;W(U,O,0,j[U],o[O],h.Vector3.Up(),!0===i._meshLoadOptions.ImportVertexColors?u[U]:void 0)}v=[]},sa=function(L,J){X(L,J);for(var S=0;S<v.length;S++){var N=v[S].split("/"),U=parseInt(N[0])-1,O=parseInt(N[1])-1,aa=parseInt(N[2])-1;W(U,O,aa,j[U],o[O],f[aa])}v=[]},va=function(L,J){X(L,J);for(var S=0;S<v.length;S++){var N=v[S].split("//"),U=parseInt(N[0])-1,O=parseInt(N[1])-1;W(U,1,O,j[U],h.Vector2.Zero(),f[O],!0===i._meshLoadOptions.ImportVertexColors?u[U]:void 0)}v=[]},d=function(L,J){X(L,J);for(var S=0;S<v.length;S++){var N=v[S].split("/"),U=j.length+parseInt(N[0]),O=o.length+parseInt(N[1]),aa=f.length+parseInt(N[2]);W(U,O,aa,j[U],o[O],f[aa],!0===i._meshLoadOptions.ImportVertexColors?u[U]:void 0)}v=[]},g=function(){r.length>0&&(e=r[r.length-1],ca(),B.reverse(),e.indices=B.slice(),e.positions=F.slice(),e.normals=p.slice(),e.uvs=x.slice(),!0===i._meshLoadOptions.ImportVertexColors&&(e.colors=z.slice()),B=[],F=[],z=[],p=[],x=[])},m=a.split(`
`),n=0;n<m.length;n++){var k,s=m[n].trim();if(0!==s.length&&"#"!==s.charAt(0))if(this.vertexPattern.test(s))k=s.match(/[^ ]+/g),j.push(new h.Vector3(parseFloat(k[1]),parseFloat(k[2]),parseFloat(k[3]))),!0===this._meshLoadOptions.ImportVertexColors&&(k.length>=7?u.push(new h.Color4(parseFloat(k[4]),parseFloat(k[5]),parseFloat(k[6]),7===k.length||void 0===k[7]?1:parseFloat(k[7]))):u.push(Y));else if(null!==(k=this.normalPattern.exec(s)))f.push(new h.Vector3(parseFloat(k[1]),parseFloat(k[2]),parseFloat(k[3])));else if(null!==(k=this.uvPattern.exec(s)))o.push(new h.Vector2(parseFloat(k[1])*A.UV_SCALING.x,parseFloat(k[2])*A.UV_SCALING.y));else if(null!==(k=this.facePattern3.exec(s)))sa(k[1].trim().split(" "),1);else if(null!==(k=this.facePattern4.exec(s)))va(k[1].trim().split(" "),1);else if(null!==(k=this.facePattern5.exec(s)))d(k[1].trim().split(" "),1);else if(null!==(k=this.facePattern2.exec(s)))fa(k[1].trim().split(" "),1);else if(null!==(k=this.facePattern1.exec(s)))ma(k[1].trim().split(" "),1);else if(this.group.test(s)||this.obj.test(s)){var w={name:s.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:""};g(),r.push(w),oa=!0,T=!0,P=1}else this.usemtl.test(s)?((H=s.substring(7).trim(),!T)&&(g(),w={name:"_mm"+P.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:H},P++,r.push(w)),oa&&T&&(r[r.length-1].materialName=H,T=!1)):this.mtllib.test(s)?E=s.substring(7).trim():this.smooth.test(s)||console.log("Unhandled expression at line : "+s)}oa&&(e=r[r.length-1],B.reverse(),ca(),e.indices=B,e.positions=F,e.normals=p,e.uvs=x,!0===this._meshLoadOptions.ImportVertexColors&&(e.colors=z)),oa||(B.reverse(),ca(),r.push({name:h.Geometry.RandomId(),indices:B,positions:F,colors:z,normals:p,uvs:x,materialName:H}));for(var t=[],C=new Array(),K=0;K<r.length;K++){if(l&&r[K].name){if(l instanceof Array){if(-1===l.indexOf(r[K].name))continue}else if(r[K].name!==l)continue}e=r[K];var V=new h.Mesh(r[K].name,c);C.push(r[K].materialName);var Q=new h.VertexData();if(Q.uvs=e.uvs,Q.indices=e.indices,Q.positions=e.positions,!0===this._meshLoadOptions.ComputeNormals){var $=new Array();h.VertexData.ComputeNormals(e.positions,e.indices,$),Q.normals=$}else Q.normals=e.normals;!0===this._meshLoadOptions.ImportVertexColors&&(Q.colors=e.colors),Q.applyToMesh(V),this._meshLoadOptions.InvertY&&(V.scaling.y*=-1),t.push(V)}var ba=[];return""!==E&&!1===this._meshLoadOptions.SkipMaterials&&ba.push(new Promise(function(L,J){i._loadMTL(E,b,function(S){try{I.parseMTL(c,S,b);for(var N=0;N<I.materials.length;N++){for(var U,O=0,aa=[];(U=C.indexOf(I.materials[N].name,O))>-1;)aa.push(U),O=U+1;if(-1===U&&0===aa.length)I.materials[N].dispose();else for(var ea=0;ea<aa.length;ea++)t[aa[ea]].material=I.materials[N]}L()}catch(da){h.Tools.Warn("Error processing MTL file: '"+E+"'"),i._meshLoadOptions.MaterialLoadingFailsSilently?L():J(da)}},function(S,N){h.Tools.Warn("Error downloading MTL file: '"+E+"'"),i._meshLoadOptions.MaterialLoadingFailsSilently?L():J(N)})})),Promise.all(ba).then(function(){return t})},A.OPTIMIZE_WITH_UV=!1,A.INVERT_Y=!1,A.INVERT_TEXTURE_Y=!0,A.IMPORT_VERTEX_COLORS=!1,A.COMPUTE_NORMALS=!1,A.UV_SCALING=new h.Vector2(1,1),A.SKIP_MATERIALS=!1,A.MATERIAL_LOADING_FAILS_SILENTLY=!0,A}();h.SceneLoader&&h.SceneLoader.RegisterPlugin(new D()),q.d(G,"MTLFileLoader",function(){return y}),q.d(G,"OBJFileLoader",function(){return D})},function(la,G,q){"use strict";q.r(G);var h=q(0),y=function(){function D(){this.solidPattern=/solid (\S*)([\S\s]*)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.name="stl",this.extensions={".stl":{isBinary:!0}}}return D.prototype.importMesh=function(A,l,c,a,b,e,i){var j;if("string"!=typeof c){if(this._isBinary(c)){var f=new h.Mesh("stlmesh",l);return this._parseBinary(f,c),b&&b.push(f),!0}for(var o=new Uint8Array(c),u="",r=0;r<c.byteLength;r++)u+=String.fromCharCode(o[r]);c=u}for(;j=this.solidPattern.exec(c);){var B=j[1];if(B!=j[3])return h.Tools.Error("Error in STL, solid name != endsolid name"),!1;if(A&&B){if(A instanceof Array){if(!A.indexOf(B))continue}else if(B!==A)continue}B=B||"stlmesh",f=new h.Mesh(B,l),this._parseASCII(f,j[2]),b&&b.push(f)}return!0},D.prototype.load=function(A,l,c){var a=this.importMesh(null,A,l,c,null,null,null);return a&&(A.createDefaultLight(),A.createDefaultCameraOrLight()),a},D.prototype.loadAssetContainer=function(A,l,c,a){var b=new h.AssetContainer(A);return this.importMesh(null,A,l,c,b.meshes,null,null),b.removeAllFromScene(),b},D.prototype._isBinary=function(A){var l;if(50,84+50*(l=new DataView(A)).getUint32(80,!0)===l.byteLength)return!0;for(var c=l.byteLength,a=0;a<c;a++)if(l.getUint8(a)>127)return!0;return!1},D.prototype._parseBinary=function(A,l){for(var c=new DataView(l),a=c.getUint32(80,!0),b=0,e=new Float32Array(3*a*3),i=new Float32Array(3*a*3),j=new Uint32Array(3*a),f=0,o=0;o<a;o++){for(var u=84+50*o,r=c.getFloat32(u,!0),B=c.getFloat32(u+4,!0),M=c.getFloat32(u+8,!0),R=1;R<=3;R++){var Z=u+12*R;e[b]=c.getFloat32(Z,!0),e[b+2]=c.getFloat32(Z+4,!0),e[b+1]=c.getFloat32(Z+8,!0),i[b]=r,i[b+2]=B,i[b+1]=M,b+=3}j[f]=f++,j[f]=f++,j[f]=f++}A.setVerticesData(h.VertexBuffer.PositionKind,e),A.setVerticesData(h.VertexBuffer.NormalKind,i),A.setIndices(j),A.computeWorldMatrix(!0)},D.prototype._parseASCII=function(A,l){for(var c,a=[],b=[],e=[],i=0;c=this.facetsPattern.exec(l);){var j=c[1],f=this.normalPattern.exec(j);if(this.normalPattern.lastIndex=0,f){for(var o,u=[Number(f[1]),Number(f[5]),Number(f[3])];o=this.vertexPattern.exec(j);)a.push(Number(o[1]),Number(o[5]),Number(o[3])),b.push(u[0],u[1],u[2]);e.push(i++,i++,i++),this.vertexPattern.lastIndex=0}}this.facetsPattern.lastIndex=0,A.setVerticesData(h.VertexBuffer.PositionKind,a),A.setVerticesData(h.VertexBuffer.NormalKind,b),A.setIndices(e),A.computeWorldMatrix(!0)},D}();h.SceneLoader&&h.SceneLoader.RegisterPlugin(new y()),q.d(G,"STLFileLoader",function(){return y})},function(la,G,q){"use strict";(function(h){var y=q(2);q.d(G,"a",function(){return y.GLTFFileLoader}),q.d(G,"b",function(){return y.GLTFLoaderAnimationStartMode}),q.d(G,"c",function(){return y.GLTFLoaderCoordinateSystemMode}),q.d(G,"d",function(){return y.GLTFLoaderState});var D=void 0!==h?h:"undefined"!=typeof window?window:void 0;if(void 0!==D)for(var A in D.BABYLON=D.BABYLON||{},y)D.BABYLON[A]=y[A]}).call(this,q(3))},function(la,G){},function(la,G,q){"use strict";(function(h){var y=q(6);q.d(G,"a",function(){return y});var D=void 0!==h?h:"undefined"!=typeof window?window:void 0;if(void 0!==D)for(var A in D.BABYLON=D.BABYLON||{},D.BABYLON.GLTF1=D.BABYLON.GLTF1||{},y)D.BABYLON.GLTF1[A]=y[A]}).call(this,q(3))},function(la,G,q){"use strict";(function(h){var y=q(4),D=q(10),A=q(5);q.d(G,"a",function(){return A});var l=void 0!==h?h:"undefined"!=typeof window?window:void 0;if(void 0!==l){l.BABYLON=l.BABYLON||{};var c=l.BABYLON;c.GLTF2=c.GLTF2||{},c.GLTF2.Loader=c.GLTF2.Loader||{},c.GLTF2.Loader.Extensions=c.GLTF2.Loader.Extensions||{};var a=[];for(var b in y)c.GLTF2.Loader.Extensions[b]=y[b],a.push(b);for(var b in D)c.GLTF2.Loader[b]=D[b],a.push(b);for(var b in A)a.indexOf(b)>-1||(c.GLTF2[b]=A[b])}}).call(this,q(3))},function(la,G,q){"use strict";q.r(G),function(h){var y=q(7);q.d(G,"MTLFileLoader",function(){return y.MTLFileLoader}),q.d(G,"OBJFileLoader",function(){return y.OBJFileLoader});var D=void 0!==h?h:"undefined"!=typeof window?window:void 0;if(void 0!==D)for(var A in y)D.BABYLON[A]=y[A]}.call(this,q(3))},function(la,G,q){"use strict";q.r(G),function(h){var y=q(8);q.d(G,"STLFileLoader",function(){return y.STLFileLoader});var D=void 0!==h?h:"undefined"!=typeof window?window:void 0;if(void 0!==D)for(var A in y)D.BABYLON[A]=y[A]}.call(this,q(3))},,,,function(la,G,q){"use strict";q.r(G),q(2),q(6),q(5),q(7),q(8);var h=q(9),y=q(11),D=q(12),A=q(13),l=q(14);q.d(G,"GLTFLoaderCoordinateSystemMode",function(){return h.c}),q.d(G,"GLTFLoaderAnimationStartMode",function(){return h.b}),q.d(G,"GLTFLoaderState",function(){return h.d}),q.d(G,"GLTFFileLoader",function(){return h.a}),q.d(G,"GLTF1",function(){return y.a}),q.d(G,"GLTF2",function(){return D.a}),q.d(G,"MTLFileLoader",function(){return A.MTLFileLoader}),q.d(G,"OBJFileLoader",function(){return A.OBJFileLoader}),q.d(G,"STLFileLoader",function(){return l.STLFileLoader})}])})},34(A,D){!function(B,w){"object"==typeof A&&"object"==typeof D?D.exports=w(k$(35)):"function"==typeof define&&define.amd?define("babylonjs-materials",["babylonjs"],w):"object"==typeof A?A["babylonjs-materials"]=w(k$(35)):B.MATERIALS=w(B.BABYLON)}("undefined"!=typeof self?self:"undefined"!=typeof global?global:A,function(B){return function(w){var m={};function i(g){if(m[g])return m[g].exports;var b=m[g]={i:g,l:!1,exports:{}};return w[g].call(b.exports,b,b.exports,i),b.l=!0,b.exports}return i.m=w,i.c=m,i.d=function(g,b,t){i.o(g,b)||Object.defineProperty(g,b,{enumerable:!0,get:t})},i.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},i.t=function(g,b){if(1&b&&(g=i(g)),8&b)return g;if(4&b&&"object"==typeof g&&g&&g.__esModule)return g;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:g}),2&b&&"string"!=typeof g)for(var p in g)i.d(t,p,function(q){return g[q]}.bind(null,p));return t},i.n=function(g){var b=g&&g.__esModule?function(){return g.default}:function(){return g};return i.d(b,"a",b),b},i.o=function(g,b){return Object.prototype.hasOwnProperty.call(g,b)},i.p="",i(i.s=19)}([function(w,m){w.exports=B},function(w,m,i){"use strict";i.d(m,"b",function(){return b}),i.d(m,"a",function(){return t});var g=function(p,q){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,j){o.__proto__=j}||function(o,j){for(var d in j)j.hasOwnProperty(d)&&(o[d]=j[d])})(p,q)};function b(p,q){function o(){this.constructor=p}g(p,q),p.prototype=null===q?Object.create(q):(o.prototype=q.prototype,new o())}function t(p,q,o,j){var d,a=arguments.length,e=a<3?q:null===j?j=Object.getOwnPropertyDescriptor(q,o):j;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)e=Reflect.decorate(p,q,o,j);else for(var f=p.length-1;f>=0;f--)(d=p[f])&&(e=(a<3?d(e):a>3?d(q,o,e):d(q,o))||e);return a>3&&e&&Object.defineProperty(q,o,e),e}},function(w,m){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(g){"object"==typeof window&&(i=window)}w.exports=i},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef BUMP
varying vec2 vNormalUV;
varying vec2 vNormalUV2;
uniform sampler2D normalSampler;
uniform vec2 vNormalInfos;
#endif
uniform sampler2D refractionSampler;
uniform sampler2D reflectionSampler;

const float LOG2=1.442695;
uniform vec3 cameraPosition;
uniform vec4 waterColor;
uniform float colorBlendFactor;
uniform vec4 waterColor2;
uniform float colorBlendFactor2;
uniform float bumpHeight;
uniform float time;

varying vec3 vRefractionMapTexCoord;
varying vec3 vReflectionMapTexCoord;
varying vec3 vPosition;
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>

#include<fogFragmentDeclaration>
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef BUMP
#ifdef BUMPSUPERIMPOSE
baseColor=0.6*texture2D(normalSampler,vNormalUV)+0.4*texture2D(normalSampler,vec2(vNormalUV2.x,vNormalUV2.y));
#else
baseColor=texture2D(normalSampler,vNormalUV);
#endif
vec3 bumpColor=baseColor.rgb;
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
baseColor.rgb*=vNormalInfos.y;
#else
vec3 bumpColor=vec3(1.0);
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec2 perturbation=bumpHeight*(baseColor.rg-0.5);
#ifdef BUMPAFFECTSREFLECTION
vec3 normalW=normalize(vNormalW+vec3(perturbation.x*8.0,0.0,perturbation.y*8.0));
if (normalW.y<0.0) {
normalW.y=-normalW.y;
}
#else
vec3 normalW=normalize(vNormalW);
#endif
#else
vec3 normalW=vec3(1.0,1.0,1.0);
vec2 perturbation=bumpHeight*(vec2(1.0,1.0)-0.5);
#endif
#ifdef FRESNELSEPARATE
#ifdef REFLECTION

vec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation*0.5,0.0,1.0);
vec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);
vec2 projectedReflectionTexCoords=clamp(vec2(
vReflectionMapTexCoord.x/vReflectionMapTexCoord.z+perturbation.x*0.3,
vReflectionMapTexCoord.y/vReflectionMapTexCoord.z+perturbation.y
),0.0,1.0);
vec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);
vec3 upVector=vec3(0.0,1.0,0.0);
float fresnelTerm=clamp(abs(pow(dot(viewDirectionW,upVector),3.0)),0.05,0.65);
float IfresnelTerm=1.0-fresnelTerm;
refractiveColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*refractiveColor;
reflectiveColor=IfresnelTerm*colorBlendFactor2*waterColor+(1.0-colorBlendFactor2*IfresnelTerm)*reflectiveColor;
vec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*IfresnelTerm;
baseColor=combinedColor;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularBase=vec3(0.,0.,0.);
vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
#include<lightFragment>[0..maxSimultaneousLights]
vec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
#else
#ifdef REFLECTION

vec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation,0.0,1.0);
vec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);
vec2 projectedReflectionTexCoords=clamp(vReflectionMapTexCoord.xy/vReflectionMapTexCoord.z+perturbation,0.0,1.0);
vec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);
vec3 upVector=vec3(0.0,1.0,0.0);
float fresnelTerm=max(dot(viewDirectionW,upVector),0.0);
vec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*(1.0-fresnelTerm);
baseColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*combinedColor;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularBase=vec3(0.,0.,0.);
vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
#include<lightFragment>[0..maxSimultaneousLights]
vec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
#endif

vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<logDepthFragment>
#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.waterPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef BUMP
varying vec2 vNormalUV;
#ifdef BUMPSUPERIMPOSE
varying vec2 vNormalUV2;
#endif
uniform mat4 normalMatrix;
uniform vec2 vNormalInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<logDepthDeclaration>

uniform mat4 worldReflectionViewProjection;
uniform vec2 windDirection;
uniform float waveLength;
uniform float time;
uniform float windForce;
uniform float waveHeight;
uniform float waveSpeed;

varying vec3 vPosition;
varying vec3 vRefractionMapTexCoord;
varying vec3 vReflectionMapTexCoord;
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef BUMP
if (vNormalInfos.x == 0.)
{
vNormalUV=vec2(normalMatrix*vec4((uv*1.0)/waveLength+time*windForce*windDirection,1.0,0.0));
#ifdef BUMPSUPERIMPOSE
vNormalUV2=vec2(normalMatrix*vec4((uv*0.721)/waveLength+time*1.2*windForce*windDirection,1.0,0.0));
#endif
}
else
{
vNormalUV=vec2(normalMatrix*vec4((uv2*1.0)/waveLength+time*windForce*windDirection ,1.0,0.0));
#ifdef BUMPSUPERIMPOSE
vNormalUV2=vec2(normalMatrix*vec4((uv2*0.721)/waveLength+time*1.2*windForce*windDirection ,1.0,0.0));
#endif
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
vec3 p=position;
float newY=(sin(((p.x/0.05)+time*waveSpeed))*waveHeight*windDirection.x*5.0)
+(cos(((p.z/0.05)+time*waveSpeed))*waveHeight*windDirection.y*5.0);
p.y+=abs(newY);
gl_Position=viewProjection*finalWorld*vec4(p,1.0);
#ifdef REFLECTION
worldPos=viewProjection*finalWorld*vec4(p,1.0);

vPosition=position;
vRefractionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);
vRefractionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);
vRefractionMapTexCoord.z=worldPos.w;
worldPos=worldReflectionViewProjection*vec4(position,1.0);
vReflectionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);
vReflectionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);
vReflectionMapTexCoord.z=worldPos.w;
#endif
#include<logDepthVertex>
}
`;b.Effect.ShadersStore.waterVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.BUMP=!1,a.REFLECTION=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.SPECULARTERM=!1,a.LOGARITHMICDEPTH=!1,a.FRESNELSEPARATE=!1,a.BUMPSUPERIMPOSE=!1,a.BUMPAFFECTSREFLECTION=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e,f){void 0===f&&(f=new b.Vector2(512,512));var c=j.call(this,a,e)||this;return c.renderTargetSize=f,c.diffuseColor=new b.Color3(1,1,1),c.specularColor=new b.Color3(0,0,0),c.specularPower=64,c._disableLighting=!1,c._maxSimultaneousLights=4,c.windForce=6,c.windDirection=new b.Vector2(0,1),c.waveHeight=.4,c.bumpHeight=.4,c._bumpSuperimpose=!1,c._fresnelSeparate=!1,c._bumpAffectsReflection=!1,c.waterColor=new b.Color3(.1,.1,.6),c.colorBlendFactor=.2,c.waterColor2=new b.Color3(.1,.1,.6),c.colorBlendFactor2=.2,c.waveLength=.1,c.waveSpeed=1,c._renderTargets=new b.SmartArray(16),c._mesh=null,c._reflectionTransform=b.Matrix.Zero(),c._lastTime=0,c._lastDeltaTime=0,c._createRenderTargets(e,f),c.getRenderTargetTextures=function(){return c._renderTargets.reset(),c._renderTargets.push(c._reflectionRTT),c._renderTargets.push(c._refractionRTT),c._renderTargets},c}return g.b(d,j),Object.defineProperty(d.prototype,"hasRenderTargetTextures",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(a){this._useLogarithmicDepth=a&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"refractionTexture",{get:function(){return this._refractionRTT},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"reflectionTexture",{get:function(){return this._reflectionRTT},enumerable:!0,configurable:!0}),d.prototype.addToRenderList=function(a){this._refractionRTT&&this._refractionRTT.renderList&&this._refractionRTT.renderList.push(a),this._reflectionRTT&&this._reflectionRTT.renderList&&this._reflectionRTT.renderList.push(a)},d.prototype.enableRenderTargets=function(a){var e=a?1:0;this._refractionRTT&&(this._refractionRTT.refreshRate=e),this._reflectionRTT&&(this._reflectionRTT.refreshRate=e)},d.prototype.getRenderList=function(){return this._refractionRTT?this._refractionRTT.renderList:[]},Object.defineProperty(d.prototype,"renderTargetsEnabled",{get:function(){return!(this._refractionRTT&&0===this._refractionRTT.refreshRate)},enumerable:!0,configurable:!0}),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled)){if(this.bumpTexture&&b.MaterialFlags.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;c._needUVs=!0,c.BUMP=!0}b.MaterialFlags.ReflectionTextureEnabled&&(c.REFLECTION=!0)}if(b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForMisc(a,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._areMiscDirty&&(this._fresnelSeparate&&(c.FRESNELSEPARATE=!0),this._bumpSuperimpose&&(c.BUMPSUPERIMPOSE=!0),this._bumpAffectsReflection&&(c.BUMPAFFECTSREFLECTION=!0)),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!0,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),this._mesh=a,this._waitingRenderList){for(var n=0;n<this._waitingRenderList.length;n++)this.addToRenderList(h.getNodeByID(this._waitingRenderList[n]));this._waitingRenderList=null}if(c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var l=new b.EffectFallbacks();c.FOG&&l.addFallback(1,"FOG"),c.LOGARITHMICDEPTH&&l.addFallback(0,"LOGARITHMICDEPTH"),b.MaterialHelper.HandleFallbacksForShadows(c,l,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,a);var r=[b.VertexBuffer.PositionKind];c.NORMAL&&r.push(b.VertexBuffer.NormalKind),c.UV1&&r.push(b.VertexBuffer.UVKind),c.UV2&&r.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&r.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(r,a,c,l),b.MaterialHelper.PrepareAttributesForInstances(r,c);var u=c.toString(),s=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vNormalInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","normalMatrix","logarithmicDepthConstant","worldReflectionViewProjection","windDirection","waveLength","time","windForce","cameraPosition","bumpHeight","waveHeight","waterColor","waterColor2","colorBlendFactor","colorBlendFactor2","waveSpeed"],v=["normalSampler","refractionSampler","reflectionSampler"],x=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:s,uniformBuffersNames:x,samplers:v,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("water",{attributes:r,uniformsNames:s,uniformBuffersNames:x,samplers:v,defines:u,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;if(k&&this._mesh){this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this.bumpTexture&&b.MaterialFlags.BumpTextureEnabled&&(this._activeEffect.setTexture("normalSampler",this.bumpTexture),this._activeEffect.setFloat2("vNormalInfos",this.bumpTexture.coordinatesIndex,this.bumpTexture.level),this._activeEffect.setMatrix("normalMatrix",this.bumpTexture.getTextureMatrix())),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),h.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),b.MaterialHelper.BindLogDepth(h,this._activeEffect,c),b.MaterialFlags.ReflectionTextureEnabled&&(this._activeEffect.setTexture("refractionSampler",this._refractionRTT),this._activeEffect.setTexture("reflectionSampler",this._reflectionRTT));var n=this._mesh.getWorldMatrix().multiply(this._reflectionTransform).multiply(c.getProjectionMatrix()),l=c.getEngine().getDeltaTime();l!==this._lastDeltaTime&&(this._lastDeltaTime=l,this._lastTime+=this._lastDeltaTime),this._activeEffect.setMatrix("worldReflectionViewProjection",n),this._activeEffect.setVector2("windDirection",this.windDirection),this._activeEffect.setFloat("waveLength",this.waveLength),this._activeEffect.setFloat("time",this._lastTime/100000),this._activeEffect.setFloat("windForce",this.windForce),this._activeEffect.setFloat("waveHeight",this.waveHeight),this._activeEffect.setFloat("bumpHeight",this.bumpHeight),this._activeEffect.setColor4("waterColor",this.waterColor,1),this._activeEffect.setFloat("colorBlendFactor",this.colorBlendFactor),this._activeEffect.setColor4("waterColor2",this.waterColor2,1),this._activeEffect.setFloat("colorBlendFactor2",this.colorBlendFactor2),this._activeEffect.setFloat("waveSpeed",this.waveSpeed),this._afterBind(e,this._activeEffect)}}},d.prototype._createRenderTargets=function(a,e){var f,c=this;this._refractionRTT=new b.RenderTargetTexture(name+"_refraction",{width:e.x,height:e.y},a,!1,!0),this._refractionRTT.wrapU=b.Constants.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.wrapV=b.Constants.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.ignoreCameraViewport=!0,this._reflectionRTT=new b.RenderTargetTexture(name+"_reflection",{width:e.x,height:e.y},a,!1,!0),this._reflectionRTT.wrapU=b.Constants.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.wrapV=b.Constants.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.ignoreCameraViewport=!0;var h,k=null,n=b.Matrix.Zero();this._refractionRTT.onBeforeRender=function(){c._mesh&&(f=c._mesh.isVisible,c._mesh.isVisible=!1),k=a.clipPlane;var l=c._mesh?c._mesh.position.y:0;a.clipPlane=b.Plane.FromPositionAndNormal(new b.Vector3(0,l+.05,0),new b.Vector3(0,1,0))},this._refractionRTT.onAfterRender=function(){c._mesh&&(c._mesh.isVisible=f),a.clipPlane=k},this._reflectionRTT.onBeforeRender=function(){c._mesh&&(f=c._mesh.isVisible,c._mesh.isVisible=!1),k=a.clipPlane;var l=c._mesh?c._mesh.position.y:0;a.clipPlane=b.Plane.FromPositionAndNormal(new b.Vector3(0,l-.05,0),new b.Vector3(0,-1,0)),b.Matrix.ReflectionToRef(a.clipPlane,n),h=a.getViewMatrix(),n.multiplyToRef(h,c._reflectionTransform),a.setTransformMatrix(c._reflectionTransform,a.getProjectionMatrix()),a.getEngine().cullBackFaces=!1,a._mirroredCameraPosition=b.Vector3.TransformCoordinates(a.activeCamera.position,n)},this._reflectionRTT.onAfterRender=function(){c._mesh&&(c._mesh.isVisible=f),a.clipPlane=k,a.setTransformMatrix(h,a.getProjectionMatrix()),a.getEngine().cullBackFaces=!0,a._mirroredCameraPosition=null}},d.prototype.getAnimatables=function(){var a=[];return this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&a.push(this.bumpTexture),this._reflectionRTT&&this._reflectionRTT.animations&&this._reflectionRTT.animations.length>0&&a.push(this._reflectionRTT),this._refractionRTT&&this._refractionRTT.animations&&this._refractionRTT.animations.length>0&&a.push(this._refractionRTT),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._bumpTexture&&a.push(this._bumpTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||this._bumpTexture===a},d.prototype.dispose=function(a){this.bumpTexture&&this.bumpTexture.dispose();var e=this.getScene().customRenderTargets.indexOf(this._refractionRTT);-1!=e&&this.getScene().customRenderTargets.splice(e,1),e=-1,-1!=(e=this.getScene().customRenderTargets.indexOf(this._reflectionRTT))&&this.getScene().customRenderTargets.splice(e,1),this._reflectionRTT&&this._reflectionRTT.dispose(),this._refractionRTT&&this._refractionRTT.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);if(a.customType="BABYLON.WaterMaterial",a.renderList=[],this._refractionRTT&&this._refractionRTT.renderList)for(var e=0;e<this._refractionRTT.renderList.length;e++)a.renderList.push(this._refractionRTT.renderList[e].id);return a},d.prototype.getClassName=function(){return"WaterMaterial"},d.Parse=function(a,e,f){var c=b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f);return c._waitingRenderList=a.renderList,c},d.CreateDefaultMesh=function(a,e){return b.Mesh.CreateGround(a,512,512,32,e,!1)},g.a([Object(b.serializeAsTexture)("bumpTexture")],d.prototype,"_bumpTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"specularColor",void 0),g.a([Object(b.serialize)()],d.prototype,"specularPower",void 0),g.a([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),g.a([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),g.a([Object(b.serialize)()],d.prototype,"windForce",void 0),g.a([Object(b.serializeAsVector2)()],d.prototype,"windDirection",void 0),g.a([Object(b.serialize)()],d.prototype,"waveHeight",void 0),g.a([Object(b.serialize)()],d.prototype,"bumpHeight",void 0),g.a([Object(b.serialize)("bumpSuperimpose")],d.prototype,"_bumpSuperimpose",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsMiscDirty")],d.prototype,"bumpSuperimpose",void 0),g.a([Object(b.serialize)("fresnelSeparate")],d.prototype,"_fresnelSeparate",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsMiscDirty")],d.prototype,"fresnelSeparate",void 0),g.a([Object(b.serialize)("bumpAffectsReflection")],d.prototype,"_bumpAffectsReflection",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsMiscDirty")],d.prototype,"bumpAffectsReflection",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"waterColor",void 0),g.a([Object(b.serialize)()],d.prototype,"colorBlendFactor",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"waterColor2",void 0),g.a([Object(b.serialize)()],d.prototype,"colorBlendFactor2",void 0),g.a([Object(b.serialize)()],d.prototype,"waveLength",void 0),g.a([Object(b.serialize)()],d.prototype,"waveSpeed",void 0),g.a([Object(b.serialize)()],d.prototype,"useLogarithmicDepth",null),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.WaterMaterial"]=o,i.d(m,"WaterMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneFragmentDeclaration>

uniform vec3 cameraPosition;
uniform vec3 cameraOffset;
uniform float luminance;
uniform float turbidity;
uniform float rayleigh;
uniform float mieCoefficient;
uniform float mieDirectionalG;
uniform vec3 sunPosition;

#include<fogFragmentDeclaration>

const float e=2.71828182845904523536028747135266249775724709369995957;
const float pi=3.141592653589793238462643383279502884197169;
const float n=1.0003;
const float N=2.545E25;
const float pn=0.035;
const vec3 lambda=vec3(680E-9,550E-9,450E-9);
const vec3 K=vec3(0.686,0.678,0.666);
const float v=4.0;
const float rayleighZenithLength=8.4E3;
const float mieZenithLength=1.25E3;
const vec3 up=vec3(0.0,1.0,0.0);
const float EE=1000.0;
const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;
const float cutoffAngle=pi/1.95;
const float steepness=1.5;
vec3 totalRayleigh(vec3 lambda)
{
return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));
}
vec3 simplifiedRayleigh()
{
return 0.0005/vec3(94,40,18);
}
float rayleighPhase(float cosTheta)
{
return (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));
}
vec3 totalMie(vec3 lambda,vec3 K,float T)
{
float c=(0.2*T )*10E-18;
return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;
}
float hgPhase(float cosTheta,float g)
{
return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));
}
float sunIntensity(float zenithAngleCos)
{
return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));
}
float A=0.15;
float B=0.50;
float C=0.10;
float D=0.20;
float EEE=0.02;
float F=0.30;
float W=1000.0;
vec3 Uncharted2Tonemap(vec3 x)
{
return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;
}
void main(void) {

#include<clipPlaneFragment>

float sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);
float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));
vec3 sunDirection=normalize(sunPosition);
float sunE=sunIntensity(dot(sunDirection,up));
vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;
vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;
float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));
float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));
float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));
vec3 Fex=exp(-(betaR*sR+betaM*sM));
float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);
float rPhase=rayleighPhase(cosTheta*0.5+0.5);
vec3 betaRTheta=betaR*rPhase;
float mPhase=hgPhase(cosTheta,mieDirectionalG);
vec3 betaMTheta=betaM*mPhase;
vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));
Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));
vec3 direction=normalize(vPositionW-cameraPosition);
float theta=acos(direction.y);
float phi=atan(direction.z,direction.x);
vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);
vec3 L0=vec3(0.1)*Fex;
float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);
L0+=(sunE*19000.0*Fex)*sundisk;
vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));
vec3 texColor=(Lin+L0);
texColor*=0.04 ;
texColor+=vec3(0.0,0.001,0.0025)*0.3;
float g_fMaxLuminance=1.0;
float fLumScaled=0.1/luminance;
float fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled);
float ExposureBias=fLumCompressed;
vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);



vec3 retColor=curr*whiteScale;


float alpha=1.0;
#ifdef VERTEXCOLOR
retColor.rgb*=vColor.rgb;
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif

vec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);

#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.skyPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif

uniform mat4 world;
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
void main(void) {
gl_Position=viewProjection*world*vec4(position,1.0);
vec4 worldPos=world*vec4(position,1.0);
vPositionW=vec3(worldPos);

#include<clipPlaneVertex>

#include<fogVertex>

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.skyVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.POINTSIZE=!1,a.FOG=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.luminance=1,f.turbidity=10,f.rayleigh=2,f.mieCoefficient=.005,f.mieDirectionalG=.8,f.distance=500,f.inclination=.49,f.azimuth=.25,f.sunPosition=new b.Vector3(0,100,0),f.useSunPosition=!1,f.cameraOffset=b.Vector3.Zero(),f._cameraPosition=b.Vector3.Zero(),f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,!1,c),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!1),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var k=new b.EffectFallbacks();c.FOG&&k.addFallback(1,"FOG");var n=[b.VertexBuffer.PositionKind];c.VERTEXCOLOR&&n.push(b.VertexBuffer.ColorKind);var l=c.toString();e.setEffect(h.getEngine().createEffect("sky",n,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset"],[],l,k,this.onCompiled,this.onError),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene();if(f._materialDefines){var h=f.effect;if(h){this._activeEffect=h,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),this._mustRebind(c,h)&&(b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect);var k=c.activeCamera;if(k){var n=k.getWorldMatrix();this._cameraPosition.x=n.m[12],this._cameraPosition.y=n.m[13],this._cameraPosition.z=n.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){var l=Math.PI*(this.inclination-.5),r=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(r),this.sunPosition.y=this.distance*Math.sin(r)*Math.sin(l),this.sunPosition.z=this.distance*Math.sin(r)*Math.cos(l)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(e,this._activeEffect)}}},d.prototype.getAnimatables=function(){return[]},d.prototype.dispose=function(a){j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.SkyMaterial",a},d.prototype.getClassName=function(){return"SkyMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},g.a([Object(b.serialize)()],d.prototype,"luminance",void 0),g.a([Object(b.serialize)()],d.prototype,"turbidity",void 0),g.a([Object(b.serialize)()],d.prototype,"rayleigh",void 0),g.a([Object(b.serialize)()],d.prototype,"mieCoefficient",void 0),g.a([Object(b.serialize)()],d.prototype,"mieDirectionalG",void 0),g.a([Object(b.serialize)()],d.prototype,"distance",void 0),g.a([Object(b.serialize)()],d.prototype,"inclination",void 0),g.a([Object(b.serialize)()],d.prototype,"azimuth",void 0),g.a([Object(b.serializeAsVector3)()],d.prototype,"sunPosition",void 0),g.a([Object(b.serialize)()],d.prototype,"useSunPosition",void 0),g.a([Object(b.serialize)()],d.prototype,"cameraOffset",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.SkyMaterial"]=o,i.d(m,"SkyMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;

varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif

uniform sampler2D distortionSampler;
uniform sampler2D opacitySampler;
#ifdef DIFFUSE
varying vec2 vDistortionCoords1;
varying vec2 vDistortionCoords2;
varying vec2 vDistortionCoords3;
#endif
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
vec4 bx2(vec4 x)
{
return vec4(2.0)*x-vec4(1.0);
}
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);

float alpha=1.0;
#ifdef DIFFUSE

const float distortionAmount0=0.092;
const float distortionAmount1=0.092;
const float distortionAmount2=0.092;
vec2 heightAttenuation=vec2(0.3,0.39);
vec4 noise0=texture2D(distortionSampler,vDistortionCoords1);
vec4 noise1=texture2D(distortionSampler,vDistortionCoords2);
vec4 noise2=texture2D(distortionSampler,vDistortionCoords3);
vec4 noiseSum=bx2(noise0)*distortionAmount0+bx2(noise1)*distortionAmount1+bx2(noise2)*distortionAmount2;
vec4 perturbedBaseCoords=vec4(vDiffuseUV,0.0,1.0)+noiseSum*(vDiffuseUV.y*heightAttenuation.x+heightAttenuation.y);
vec4 opacityColor=texture2D(opacitySampler,perturbedBaseCoords.xy);
#ifdef ALPHATEST
if (opacityColor.r<0.1)
discard;
#endif
#include<depthPrePass>
baseColor=texture2D(diffuseSampler,perturbedBaseCoords.xy)*2.0;
baseColor*=opacityColor;
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

vec3 diffuseBase=vec3(1.0,1.0,1.0);
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif

vec4 color=vec4(baseColor.rgb,alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.firePixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>

uniform float time;
uniform float speed;
#ifdef DIFFUSE
varying vec2 vDistortionCoords1;
varying vec2 vDistortionCoords2;
varying vec2 vDistortionCoords3;
#endif
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);

#ifdef DIFFUSE
vDiffuseUV=uv;
vDiffuseUV.y-=0.2;
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
#ifdef DIFFUSE

vec3 layerSpeed=vec3(-0.2,-0.52,-0.1)*speed;
vDistortionCoords1.x=uv.x;
vDistortionCoords1.y=uv.y+layerSpeed.x*time/1000.0;
vDistortionCoords2.x=uv.x;
vDistortionCoords2.y=uv.y+layerSpeed.y*time/1000.0;
vDistortionCoords3.x=uv.x;
vDistortionCoords3.y=uv.y+layerSpeed.z*time/1000.0;
#endif
}
`;b.Effect.ShadersStore.fireVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.UV1=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.BonesPerMesh=0,a.NUM_BONE_INFLUENCERS=0,a.INSTANCES=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f.speed=1,f._scaledDiffuse=new b.Color3(),f._lastTime=0,f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return!1},d.prototype.needAlphaTesting=function(){return!0},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(c.ALPHATEST=!!this._opacityTexture,c._areMiscDirty&&(c.POINTSIZE=this.pointsCloud||h.forcePointsCloud,c.FOG=h.fogEnabled&&a.applyFog&&h.fogMode!==b.Scene.FOGMODE_NONE&&this.fogEnabled),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!1,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.UV1&&l.push(b.VertexBuffer.UVKind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString();e.setEffect(h.getEngine().createEffect("fire",{attributes:l,uniformsNames:["world","view","viewProjection","vEyePosition","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix","time","speed"],uniformBuffersNames:[],samplers:["diffuseSampler","distortionSampler","opacitySampler"],defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:null,maxSimultaneousLights:4,transformFeedbackVaryings:null},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene();if(f._materialDefines){var h=f.effect;h&&(this._activeEffect=h,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,h)&&(this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix()),this._activeEffect.setTexture("distortionSampler",this._distortionTexture),this._activeEffect.setTexture("opacitySampler",this._opacityTexture)),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(h,c)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*e.visibility),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._lastTime+=c.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime),this._activeEffect.setFloat("speed",this.speed),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&a.push(this._diffuseTexture),this._distortionTexture&&this._distortionTexture.animations&&this._distortionTexture.animations.length>0&&a.push(this._distortionTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&a.push(this._opacityTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),this._distortionTexture&&a.push(this._distortionTexture),this._opacityTexture&&a.push(this._opacityTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||(this._diffuseTexture===a||(this._distortionTexture===a||this._opacityTexture===a))},d.prototype.getClassName=function(){return"FireMaterial"},d.prototype.dispose=function(a){this._diffuseTexture&&this._diffuseTexture.dispose(),this._distortionTexture&&this._distortionTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=j.prototype.serialize.call(this);return a.customType="BABYLON.FireMaterial",a.diffuseColor=this.diffuseColor.asArray(),a.speed=this.speed,this._diffuseTexture&&(a._diffuseTexture=this._diffuseTexture.serialize()),this._distortionTexture&&(a._distortionTexture=this._distortionTexture.serialize()),this._opacityTexture&&(a._opacityTexture=this._opacityTexture.serialize()),a},d.Parse=function(a,e,f){var c=new d(a.name,e);return c.diffuseColor=b.Color3.FromArray(a.diffuseColor),c.speed=a.speed,c.alpha=a.alpha,c.id=a.id,b.Tags.AddTagsTo(c,a.tags),c.backFaceCulling=a.backFaceCulling,c.wireframe=a.wireframe,a._diffuseTexture&&(c._diffuseTexture=b.Texture.Parse(a._diffuseTexture,e,f)),a._distortionTexture&&(c._distortionTexture=b.Texture.Parse(a._distortionTexture,e,f)),a._opacityTexture&&(c._opacityTexture=b.Texture.Parse(a._opacityTexture,e,f)),a.checkReadyOnlyOnce&&(c.checkReadyOnlyOnce=a.checkReadyOnlyOnce),c},g.a([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),g.a([Object(b.serializeAsTexture)("distortionTexture")],d.prototype,"_distortionTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"distortionTexture",void 0),g.a([Object(b.serializeAsTexture)("opacityTexture")],d.prototype,"_opacityTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"opacityTexture",void 0),g.a([Object(b.serializeAsColor3)("diffuse")],d.prototype,"diffuseColor",void 0),g.a([Object(b.serialize)()],d.prototype,"speed",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.FireMaterial"]=o,i.d(m,"FireMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif

varying vec3 vPositionW;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]

#ifdef DIFFUSEX
varying vec2 vTextureUVX;
uniform sampler2D diffuseSamplerX;
#ifdef BUMPX
uniform sampler2D normalSamplerX;
#endif
#endif
#ifdef DIFFUSEY
varying vec2 vTextureUVY;
uniform sampler2D diffuseSamplerY;
#ifdef BUMPY
uniform sampler2D normalSamplerY;
#endif
#endif
#ifdef DIFFUSEZ
varying vec2 vTextureUVZ;
uniform sampler2D diffuseSamplerZ;
#ifdef BUMPZ
uniform sampler2D normalSamplerZ;
#endif
#endif
#ifdef NORMAL
varying mat3 tangentSpace;
#endif
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<fogFragmentDeclaration>
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(0.,0.,0.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=tangentSpace[2];
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
vec4 baseNormal=vec4(0.0,0.0,0.0,1.0);
normalW*=normalW;
#ifdef DIFFUSEX
baseColor+=texture2D(diffuseSamplerX,vTextureUVX)*normalW.x;
#ifdef BUMPX
baseNormal+=texture2D(normalSamplerX,vTextureUVX)*normalW.x;
#endif
#endif
#ifdef DIFFUSEY
baseColor+=texture2D(diffuseSamplerY,vTextureUVY)*normalW.y;
#ifdef BUMPY
baseNormal+=texture2D(normalSamplerY,vTextureUVY)*normalW.y;
#endif
#endif
#ifdef DIFFUSEZ
baseColor+=texture2D(diffuseSamplerZ,vTextureUVZ)*normalW.z;
#ifdef BUMPZ
baseNormal+=texture2D(normalSamplerZ,vTextureUVZ)*normalW.z;
#endif
#endif
#ifdef NORMAL
normalW=normalize((2.0*baseNormal.xyz-1.0)*tangentSpace);
#endif
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularBase=vec3(0.,0.,0.);
vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;

vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.triplanarPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSEX
varying vec2 vTextureUVX;
#endif
#ifdef DIFFUSEY
varying vec2 vTextureUVY;
#endif
#ifdef DIFFUSEZ
varying vec2 vTextureUVZ;
#endif
uniform float tileSize;
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying mat3 tangentSpace;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void)
{
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef DIFFUSEX
vTextureUVX=worldPos.zy/tileSize;
#endif
#ifdef DIFFUSEY
vTextureUVY=worldPos.xz/tileSize;
#endif
#ifdef DIFFUSEZ
vTextureUVZ=worldPos.xy/tileSize;
#endif
#ifdef NORMAL

vec3 xtan=vec3(0,0,1);
vec3 xbin=vec3(0,1,0);
vec3 ytan=vec3(1,0,0);
vec3 ybin=vec3(0,0,1);
vec3 ztan=vec3(1,0,0);
vec3 zbin=vec3(0,1,0);
vec3 normalizedNormal=normalize(normal);
normalizedNormal*=normalizedNormal;
vec3 worldBinormal=normalize(xbin*normalizedNormal.x+ybin*normalizedNormal.y+zbin*normalizedNormal.z);
vec3 worldTangent=normalize(xtan*normalizedNormal.x+ytan*normalizedNormal.y+ztan*normalizedNormal.z);
worldTangent=(world*vec4(worldTangent,1.0)).xyz;
worldBinormal=(world*vec4(worldBinormal,1.0)).xyz;
vec3 worldNormal=normalize(cross(worldTangent,worldBinormal));
tangentSpace[0]=worldTangent;
tangentSpace[1]=worldBinormal;
tangentSpace[2]=worldNormal;
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.triplanarVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSEX=!1,a.DIFFUSEY=!1,a.DIFFUSEZ=!1,a.BUMPX=!1,a.BUMPY=!1,a.BUMPZ=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.SPECULARTERM=!1,a.NORMAL=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.tileSize=1,f.diffuseColor=new b.Color3(1,1,1),f.specularColor=new b.Color3(.2,.2,.2),f.specularPower=64,f._disableLighting=!1,f._maxSimultaneousLights=4,f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&h.texturesEnabled){if(b.MaterialFlags.DiffuseTextureEnabled){for(var n=[this.diffuseTextureX,this.diffuseTextureY,this.diffuseTextureZ],l=["DIFFUSEX","DIFFUSEY","DIFFUSEZ"],r=0;r<n.length;r++)if(n[r]){if(!n[r].isReady())return!1;c[l[r]]=!0}}if(b.MaterialFlags.BumpTextureEnabled){for(n=[this.normalTextureX,this.normalTextureY,this.normalTextureZ],l=["BUMPX","BUMPY","BUMPZ"],r=0;r<n.length;r++)if(n[r]){if(!n[r].isReady())return!1;c[l[r]]=!0}}}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var u=new b.EffectFallbacks();c.FOG&&u.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,u,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&u.addCPUSkinningFallback(0,a);var s=[b.VertexBuffer.PositionKind];c.NORMAL&&s.push(b.VertexBuffer.NormalKind),c.VERTEXCOLOR&&s.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(s,a,c,u),b.MaterialHelper.PrepareAttributesForInstances(s,c);var v=c.toString(),x=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","tileSize"],y=["diffuseSamplerX","diffuseSamplerY","diffuseSamplerZ","normalSamplerX","normalSamplerY","normalSamplerZ"],z=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:x,uniformBuffersNames:z,samplers:y,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("triplanar",{attributes:s,uniformsNames:x,uniformBuffersNames:z,samplers:y,defines:v,fallbacks:u,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._activeEffect.setFloat("tileSize",this.tileSize),c.getCachedMaterial()!==this&&(this.diffuseTextureX&&this._activeEffect.setTexture("diffuseSamplerX",this.diffuseTextureX),this.diffuseTextureY&&this._activeEffect.setTexture("diffuseSamplerY",this.diffuseTextureY),this.diffuseTextureZ&&this._activeEffect.setTexture("diffuseSamplerZ",this.diffuseTextureZ),this.normalTextureX&&this._activeEffect.setTexture("normalSamplerX",this.normalTextureX),this.normalTextureY&&this._activeEffect.setTexture("normalSamplerY",this.normalTextureY),this.normalTextureZ&&this._activeEffect.setTexture("normalSamplerZ",this.normalTextureZ),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),h.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&a.push(this.mixTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTextureX&&a.push(this._diffuseTextureX),this._diffuseTextureY&&a.push(this._diffuseTextureY),this._diffuseTextureZ&&a.push(this._diffuseTextureZ),this._normalTextureX&&a.push(this._normalTextureX),this._normalTextureY&&a.push(this._normalTextureY),this._normalTextureZ&&a.push(this._normalTextureZ),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||(this._diffuseTextureX===a||(this._diffuseTextureY===a||(this._diffuseTextureZ===a||(this._normalTextureX===a||(this._normalTextureY===a||this._normalTextureZ===a)))))},d.prototype.dispose=function(a){this.mixTexture&&this.mixTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.TriPlanarMaterial",a},d.prototype.getClassName=function(){return"TriPlanarMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},g.a([Object(b.serializeAsTexture)()],d.prototype,"mixTexture",void 0),g.a([Object(b.serializeAsTexture)("diffuseTextureX")],d.prototype,"_diffuseTextureX",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTextureX",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexturY")],d.prototype,"_diffuseTextureY",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTextureY",void 0),g.a([Object(b.serializeAsTexture)("diffuseTextureZ")],d.prototype,"_diffuseTextureZ",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTextureZ",void 0),g.a([Object(b.serializeAsTexture)("normalTextureX")],d.prototype,"_normalTextureX",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"normalTextureX",void 0),g.a([Object(b.serializeAsTexture)("normalTextureY")],d.prototype,"_normalTextureY",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"normalTextureY",void 0),g.a([Object(b.serializeAsTexture)("normalTextureZ")],d.prototype,"_normalTextureZ",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"normalTextureZ",void 0),g.a([Object(b.serialize)()],d.prototype,"tileSize",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"specularColor",void 0),g.a([Object(b.serialize)()],d.prototype,"specularPower",void 0),g.a([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),g.a([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.TriPlanarMaterial"]=o,i.d(m,"TriPlanarMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;

uniform vec4 furColor;
uniform float furLength;
varying vec3 vPositionW;
varying float vfur_length;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif

#ifdef HIGHLEVEL
uniform float furOffset;
uniform float furOcclusion;
uniform sampler2D furTexture;
varying vec2 vFurUV;
#endif
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<fogFragmentDeclaration>
#include<clipPlaneFragmentDeclaration>
float Rand(vec3 rv) {
float x=dot(rv,vec3(12.9898,78.233,24.65487));
return fract(sin(x)*43758.5453);
}
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=furColor;
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor*=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef HIGHLEVEL

vec4 furTextureColor=texture2D(furTexture,vec2(vFurUV.x,vFurUV.y));
if (furTextureColor.a<=0.0 || furTextureColor.g<furOffset) {
discard;
}
float occlusion=mix(0.0,furTextureColor.b*1.2,furOffset);
baseColor=vec4(baseColor.xyz*max(occlusion,furOcclusion),1.1-furOffset);
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase.rgb*baseColor.rgb,0.0,1.0);

#ifdef HIGHLEVEL
vec4 color=vec4(finalDiffuse,alpha);
#else
float r=vfur_length/furLength*0.5;
vec4 color=vec4(finalDiffuse*(0.5+r),alpha);
#endif
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.furPixelShader=t;var p=`precision highp float;

attribute vec3 position;
attribute vec3 normal;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

uniform float furLength;
uniform float furAngle;
#ifdef HIGHLEVEL
uniform float furOffset;
uniform vec3 furGravity;
uniform float furTime;
uniform float furSpacing;
uniform float furDensity;
#endif
#ifdef HEIGHTMAP
uniform sampler2D heightTexture;
#endif
#ifdef HIGHLEVEL
varying vec2 vFurUV;
#endif
#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
varying float vfur_length;
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
float Rand(vec3 rv) {
float x=dot(rv,vec3(12.9898,78.233,24.65487));
return fract(sin(x)*43758.5453);
}
void main(void) {
#include<instancesVertex>
#include<bonesVertex>

float r=Rand(position);
#ifdef HEIGHTMAP
#if __VERSION__>100
vfur_length=furLength*texture(heightTexture,uv).x;
#else
vfur_length=furLength*texture2D(heightTexture,uv).r;
#endif
#else
vfur_length=(furLength*r);
#endif
vec3 tangent1=vec3(normal.y,-normal.x,0);
vec3 tangent2=vec3(-normal.z,0,normal.x);
r=Rand(tangent1*r);
float J=(2.0+4.0*r);
r=Rand(tangent2*r);
float K=(2.0+2.0*r);
tangent1=tangent1*J+tangent2*K;
tangent1=normalize(tangent1);
vec3 newPosition=position+normal*vfur_length*cos(furAngle)+tangent1*vfur_length*sin(furAngle);
#ifdef HIGHLEVEL

vec3 forceDirection=vec3(0.0,0.0,0.0);
forceDirection.x=sin(furTime+position.x*0.05)*0.2;
forceDirection.y=cos(furTime*0.7+position.y*0.04)*0.2;
forceDirection.z=sin(furTime*0.7+position.z*0.04)*0.2;
vec3 displacement=vec3(0.0,0.0,0.0);
displacement=furGravity+forceDirection;
float displacementFactor=pow(furOffset,3.0);
vec3 aNormal=normal;
aNormal.xyz+=displacement*displacementFactor;
newPosition=vec3(newPosition.x,newPosition.y,newPosition.z)+(normalize(aNormal)*furOffset*furSpacing);
#endif
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

gl_Position=viewProjection*finalWorld*vec4(newPosition,1.0);
vec4 worldPos=finalWorld*vec4(newPosition,1.0);
vPositionW=vec3(worldPos);

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#ifdef HIGHLEVEL
vFurUV=vDiffuseUV*furDensity;
#endif
#else
#ifdef HIGHLEVEL
vFurUV=uv*furDensity;
#endif
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.furVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.HEIGHTMAP=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.HIGHLEVEL=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f.furLength=1,f.furAngle=0,f.furColor=new b.Color3(.44,.21,.02),f.furOffset=0,f.furSpacing=12,f.furGravity=new b.Vector3(0,0,0),f.furSpeed=100,f.furDensity=20,f.furOcclusion=0,f._disableLighting=!1,f._maxSimultaneousLights=4,f.highLevelFur=!0,f._furTime=0,f}return g.b(d,j),Object.defineProperty(d.prototype,"furTime",{get:function(){return this._furTime},set:function(a){this._furTime=a},enumerable:!0,configurable:!0}),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.updateFur=function(){for(var a=1;a<this._meshes.length;a++){var e=this._meshes[a].material;e.furLength=this.furLength,e.furAngle=this.furAngle,e.furGravity=this.furGravity,e.furSpacing=this.furSpacing,e.furSpeed=this.furSpeed,e.furColor=this.furColor,e.diffuseTexture=this.diffuseTexture,e.furTexture=this.furTexture,e.highLevelFur=this.highLevelFur,e.furTime=this.furTime,e.furDensity=this.furDensity}},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&h.texturesEnabled){if(this.diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(this.heightTexture&&k.getCaps().maxVertexTextureImageUnits){if(!this.heightTexture.isReady())return!1;c._needUVs=!0,c.HEIGHTMAP=!0}}if(this.highLevelFur!==c.HIGHLEVEL&&(c.HIGHLEVEL=!0,c.markAsUnprocessed()),b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix","furLength","furAngle","furColor","furOffset","furGravity","furTime","furSpacing","furDensity","furOcclusion"],s=["diffuseSampler","heightTexture","furTexture"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("fur",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),c.getCachedMaterial()!==this&&(this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),this._heightTexture&&this._activeEffect.setTexture("heightTexture",this._heightTexture),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._activeEffect.setFloat("furLength",this.furLength),this._activeEffect.setFloat("furAngle",this.furAngle),this._activeEffect.setColor4("furColor",this.furColor,1),this.highLevelFur&&(this._activeEffect.setVector3("furGravity",this.furGravity),this._activeEffect.setFloat("furOffset",this.furOffset),this._activeEffect.setFloat("furSpacing",this.furSpacing),this._activeEffect.setFloat("furDensity",this.furDensity),this._activeEffect.setFloat("furOcclusion",this.furOcclusion),this._furTime+=this.getScene().getEngine().getDeltaTime()/this.furSpeed,this._activeEffect.setFloat("furTime",this._furTime),this._activeEffect.setTexture("furTexture",this.furTexture)),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&a.push(this.diffuseTexture),this.heightTexture&&this.heightTexture.animations&&this.heightTexture.animations.length>0&&a.push(this.heightTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),this._heightTexture&&a.push(this._heightTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||(this.diffuseTexture===a||this._heightTexture===a)},d.prototype.dispose=function(a){if(this.diffuseTexture&&this.diffuseTexture.dispose(),this._meshes)for(var e=1;e<this._meshes.length;e++){var f=this._meshes[e].material;f&&f.dispose(a),this._meshes[e].dispose()}j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.FurMaterial",this._meshes&&(a.sourceMeshName=this._meshes[0].name,a.quality=this._meshes.length),a},d.prototype.getClassName=function(){return"FurMaterial"},d.Parse=function(a,e,f){var c=b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f);return a.sourceMeshName&&c.highLevelFur&&e.executeWhenReady(function(){var h=e.getMeshByName(a.sourceMeshName);if(h){var k=d.GenerateTexture("Fur Texture",e);c.furTexture=k,d.FurifyMesh(h,a.quality)}}),c},d.GenerateTexture=function(a,e){for(var f=new b.DynamicTexture("FurTexture "+a,256,e,!0),c=f.getContext(),h=0;h<20000;++h)c.fillStyle="rgba(255, "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", 1)",c.fillRect(Math.random()*f.getSize().width,Math.random()*f.getSize().height,2,2);return f.update(!1),f.wrapU=b.Texture.WRAP_ADDRESSMODE,f.wrapV=b.Texture.WRAP_ADDRESSMODE,f},d.FurifyMesh=function(a,e){var f,c=[a],h=a.material;if(!(h instanceof d))throw"The material of the source mesh must be a Fur Material";for(f=1;f<e;f++){var k=new d(h.name+f,a.getScene());a.getScene().materials.pop(),b.Tags.EnableFor(k),b.Tags.AddTagsTo(k,"furShellMaterial"),k.furLength=h.furLength,k.furAngle=h.furAngle,k.furGravity=h.furGravity,k.furSpacing=h.furSpacing,k.furSpeed=h.furSpeed,k.furColor=h.furColor,k.diffuseTexture=h.diffuseTexture,k.furOffset=f/e,k.furTexture=h.furTexture,k.highLevelFur=h.highLevelFur,k.furTime=h.furTime,k.furDensity=h.furDensity;var n=a.clone(a.name+f);n.material=k,n.skeleton=a.skeleton,n.position=b.Vector3.Zero(),c.push(n)}for(f=1;f<c.length;f++)c[f].parent=a;return a.material._meshes=c,c},g.a([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),g.a([Object(b.serializeAsTexture)("heightTexture")],d.prototype,"_heightTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"heightTexture",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),g.a([Object(b.serialize)()],d.prototype,"furLength",void 0),g.a([Object(b.serialize)()],d.prototype,"furAngle",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"furColor",void 0),g.a([Object(b.serialize)()],d.prototype,"furOffset",void 0),g.a([Object(b.serialize)()],d.prototype,"furSpacing",void 0),g.a([Object(b.serializeAsVector3)()],d.prototype,"furGravity",void 0),g.a([Object(b.serialize)()],d.prototype,"furSpeed",void 0),g.a([Object(b.serialize)()],d.prototype,"furDensity",void 0),g.a([Object(b.serialize)()],d.prototype,"furOcclusion",void 0),g.a([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),g.a([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),g.a([Object(b.serialize)()],d.prototype,"highLevelFur",void 0),g.a([Object(b.serialize)()],d.prototype,"furTime",null),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.FurMaterial"]=o,i.d(m,"FurMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]

#ifdef DIFFUSE
varying vec2 vTextureUV;
uniform sampler2D textureSampler;
uniform vec2 vTextureInfos;
uniform sampler2D diffuse1Sampler;
uniform sampler2D diffuse2Sampler;
uniform sampler2D diffuse3Sampler;
uniform vec2 diffuse1Infos;
uniform vec2 diffuse2Infos;
uniform vec2 diffuse3Infos;
#endif
#ifdef BUMP
uniform sampler2D bump1Sampler;
uniform sampler2D bump2Sampler;
uniform sampler2D bump3Sampler;
#endif

#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>

#ifdef BUMP
#extension GL_OES_standard_derivatives : enable

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{

vec3 dp1=dFdx(p);
vec3 dp2=dFdy(p);
vec2 duv1=dFdx(uv);
vec2 duv2=dFdy(uv);

vec3 dp2perp=cross(dp2,normal);
vec3 dp1perp=cross(normal,dp1);
vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;
vec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;

float invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));
return mat3(tangent*invmax,binormal*invmax,normal);
}
vec3 perturbNormal(vec3 viewDir,vec3 mixColor)
{
vec3 bump1Color=texture2D(bump1Sampler,vTextureUV*diffuse1Infos).xyz;
vec3 bump2Color=texture2D(bump2Sampler,vTextureUV*diffuse2Infos).xyz;
vec3 bump3Color=texture2D(bump3Sampler,vTextureUV*diffuse3Infos).xyz;
bump1Color.rgb*=mixColor.r;
bump2Color.rgb=mix(bump1Color.rgb,bump2Color.rgb,mixColor.g);
vec3 map=mix(bump2Color.rgb,bump3Color.rgb,mixColor.b);
map=map*255./127.-128./127.;
mat3 TBN=cotangent_frame(vNormalW*vTextureInfos.y,-viewDir,vTextureUV);
return normalize(TBN*map);
}
#endif
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef DIFFUSE
baseColor=texture2D(textureSampler,vTextureUV);
#if defined(BUMP) && defined(DIFFUSE)
normalW=perturbNormal(viewDirectionW,baseColor.rgb);
#endif
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vTextureInfos.y;
vec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);
vec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);
vec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);
diffuse1Color.rgb*=baseColor.r;
diffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,baseColor.g);
baseColor.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,baseColor.b);
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor*baseColor.rgb,0.0,1.0);

vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.terrainPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vTextureUV;
uniform mat4 textureMatrix;
uniform vec2 vTextureInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vTextureInfos.x == 0.)
{
vTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));
}
else
{
vTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.terrainVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.BUMP=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.SPECULARTERM=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f.specularColor=new b.Color3(0,0,0),f.specularPower=64,f._disableLighting=!1,f._maxSimultaneousLights=4,f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(h.texturesEnabled){if(!this.mixTexture||!this.mixTexture.isReady())return!1;if(c._needUVs=!0,b.MaterialFlags.DiffuseTextureEnabled){if(!this.diffuseTexture1||!this.diffuseTexture1.isReady())return!1;if(!this.diffuseTexture2||!this.diffuseTexture2.isReady())return!1;if(!this.diffuseTexture3||!this.diffuseTexture3.isReady())return!1;c.DIFFUSE=!0}if(this.bumpTexture1&&this.bumpTexture2&&this.bumpTexture3&&b.MaterialFlags.BumpTextureEnabled){if(!this.bumpTexture1.isReady())return!1;if(!this.bumpTexture2.isReady())return!1;if(!this.bumpTexture3.isReady())return!1;c._needNormals=!0,c.BUMP=!0}}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos"],s=["textureSampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","bump1Sampler","bump2Sampler","bump3Sampler"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("terrain",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this.mixTexture&&(this._activeEffect.setTexture("textureSampler",this._mixTexture),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture.coordinatesIndex,this._mixTexture.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture.getTextureMatrix()),b.MaterialFlags.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale))),b.MaterialFlags.BumpTextureEnabled&&c.getEngine().getCaps().standardDerivatives&&(this._bumpTexture1&&this._activeEffect.setTexture("bump1Sampler",this._bumpTexture1),this._bumpTexture2&&this._activeEffect.setTexture("bump2Sampler",this._bumpTexture2),this._bumpTexture3&&this._activeEffect.setTexture("bump3Sampler",this._bumpTexture3))),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),h.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&a.push(this.mixTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._mixTexture&&a.push(this._mixTexture),this._diffuseTexture1&&a.push(this._diffuseTexture1),this._diffuseTexture2&&a.push(this._diffuseTexture2),this._diffuseTexture3&&a.push(this._diffuseTexture3),this._bumpTexture1&&a.push(this._bumpTexture1),this._bumpTexture2&&a.push(this._bumpTexture2),this._bumpTexture3&&a.push(this._bumpTexture3),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||(this._mixTexture===a||(this._diffuseTexture1===a||(this._diffuseTexture2===a||(this._diffuseTexture3===a||(this._bumpTexture1===a||(this._bumpTexture2===a||this._bumpTexture3===a))))))},d.prototype.dispose=function(a){this.mixTexture&&this.mixTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.TerrainMaterial",a},d.prototype.getClassName=function(){return"TerrainMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},g.a([Object(b.serializeAsTexture)("mixTexture")],d.prototype,"_mixTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"mixTexture",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture1")],d.prototype,"_diffuseTexture1",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture1",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture2")],d.prototype,"_diffuseTexture2",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture2",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture3")],d.prototype,"_diffuseTexture3",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture3",void 0),g.a([Object(b.serializeAsTexture)("bumpTexture1")],d.prototype,"_bumpTexture1",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture1",void 0),g.a([Object(b.serializeAsTexture)("bumpTexture2")],d.prototype,"_bumpTexture2",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture2",void 0),g.a([Object(b.serializeAsTexture)("bumpTexture3")],d.prototype,"_bumpTexture3",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture3",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"specularColor",void 0),g.a([Object(b.serialize)()],d.prototype,"specularPower",void 0),g.a([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),g.a([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.TerrainMaterial"]=o,i.d(m,"TerrainMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;

uniform vec4 topColor;
uniform vec4 bottomColor;
uniform float offset;
uniform float scale;
uniform float smoothness;

varying vec3 vPositionW;
varying vec3 vPosition;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0]
#include<__decl__lightFragment>[1]
#include<__decl__lightFragment>[2]
#include<__decl__lightFragment>[3]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);
float h=vPosition.y*scale+offset;
float mysmoothness=clamp(smoothness,0.01,max(smoothness,10.));
vec4 baseColor=mix(bottomColor,topColor,max(pow(max(h,0.0),mysmoothness),0.0));

vec3 diffuseColor=baseColor.rgb;

float alpha=baseColor.a;
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif

#ifdef EMISSIVE
vec3 diffuseBase=baseColor.rgb;
#else
vec3 diffuseBase=vec3(0.,0.,0.);
#endif
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;

vec4 color=vec4(finalDiffuse,alpha);
#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.gradientPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
varying vec3 vPosition;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
vPosition=position;
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.gradientVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.EMISSIVE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f._maxSimultaneousLights=4,f.topColor=new b.Color3(1,0,0),f.topColorAlpha=1,f.bottomColor=new b.Color3(0,0,1),f.bottomColorAlpha=1,f.offset=0,f.scale=1,f.smoothness=1,f._disableLighting=!1,f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1||this.topColorAlpha<1||this.bottomColorAlpha<1},d.prototype.needAlphaTesting=function(){return!0},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),c.EMISSIVE=this._disableLighting,b.MaterialHelper.PrepareDefinesForAttributes(a,c,!1,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","topColor","bottomColor","offset","smoothness","scale"],s=[],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:4}),e.setEffect(h.getEngine().createEffect("gradient",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,k),this._mustRebind(c,k)&&(b.MaterialHelper.BindClipPlane(k,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._activeEffect.setColor4("topColor",this.topColor,this.topColorAlpha),this._activeEffect.setColor4("bottomColor",this.bottomColor,this.bottomColorAlpha),this._activeEffect.setFloat("offset",this.offset),this._activeEffect.setFloat("scale",this.scale),this._activeEffect.setFloat("smoothness",this.smoothness),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){return[]},d.prototype.dispose=function(a){j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.GradientMaterial",a},d.prototype.getClassName=function(){return"GradientMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},g.a([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"topColor",void 0),g.a([Object(b.serialize)()],d.prototype,"topColorAlpha",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"bottomColor",void 0),g.a([Object(b.serialize)()],d.prototype,"bottomColorAlpha",void 0),g.a([Object(b.serialize)()],d.prototype,"offset",void 0),g.a([Object(b.serialize)()],d.prototype,"scale",void 0),g.a([Object(b.serialize)()],d.prototype,"smoothness",void 0),g.a([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.GradientMaterial"]=o,i.d(m,"GradientMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>

vec3 computeCustomDiffuseLighting(lightingInfo info,vec3 diffuseBase,float shadow)
{
diffuseBase=info.diffuse*shadow;
#ifdef CELLBASIC
float level=1.0;
if (info.ndl<0.5)
level=0.5;
diffuseBase.rgb*vec3(level,level,level);
#else
float ToonThresholds[4];
ToonThresholds[0]=0.95;
ToonThresholds[1]=0.5;
ToonThresholds[2]=0.2;
ToonThresholds[3]=0.03;
float ToonBrightnessLevels[5];
ToonBrightnessLevels[0]=1.0;
ToonBrightnessLevels[1]=0.8;
ToonBrightnessLevels[2]=0.6;
ToonBrightnessLevels[3]=0.35;
ToonBrightnessLevels[4]=0.2;
if (info.ndl>ToonThresholds[0])
{
diffuseBase.rgb*=ToonBrightnessLevels[0];
}
else if (info.ndl>ToonThresholds[1])
{
diffuseBase.rgb*=ToonBrightnessLevels[1];
}
else if (info.ndl>ToonThresholds[2])
{
diffuseBase.rgb*=ToonBrightnessLevels[2];
}
else if (info.ndl>ToonThresholds[3])
{
diffuseBase.rgb*=ToonBrightnessLevels[3];
}
else
{
diffuseBase.rgb*=ToonBrightnessLevels[4];
}
#endif
return max(diffuseBase,vec3(0.2));
}
void main(void)
{
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif

lightingInfo info;
vec3 diffuseBase=vec3(0.,0.,0.);
float shadow=1.;
float glossiness=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;

vec4 color=vec4(finalDiffuse,alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.cellPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.cellVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.NDOTL=!0,a.CUSTOMUSERLIGHTING=!0,a.CELLBASIC=!0,a.DEPTHPREPASS=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f._computeHighLevel=!1,f._disableLighting=!1,f._maxSimultaneousLights=4,f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled&&this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(c.CELLBASIC=!this.computeHighLevel,b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix"],s=["diffuseSampler"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("cell",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights-1}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this._maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&a.push(this._diffuseTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||this._diffuseTexture===a},d.prototype.dispose=function(a){this._diffuseTexture&&this._diffuseTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.getClassName=function(){return"CellMaterial"},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.CellMaterial",a},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},g.a([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),g.a([Object(b.serializeAsColor3)("diffuse")],d.prototype,"diffuseColor",void 0),g.a([Object(b.serialize)("computeHighLevel")],d.prototype,"_computeHighLevel",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"computeHighLevel",void 0),g.a([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),g.a([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.CellMaterial"]=o,i.d(m,"CellMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`#extension GL_OES_standard_derivatives : enable
#define SQRT2 1.41421356
#define PI 3.14159
precision highp float;
uniform vec3 mainColor;
uniform vec3 lineColor;
uniform vec4 gridControl;
uniform vec3 gridOffset;

varying vec3 vPosition;
varying vec3 vNormal;
#include<fogFragmentDeclaration>

#ifdef OPACITY
varying vec2 vOpacityUV;
uniform sampler2D opacitySampler;
uniform vec2 vOpacityInfos;
#endif
float getVisibility(float position) {

float majorGridFrequency=gridControl.y;
if (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)
{
return 1.0;
}
return gridControl.z;
}
float getAnisotropicAttenuation(float differentialLength) {
const float maxNumberOfLines=10.0;
return clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);
}
float isPointOnLine(float position,float differentialLength) {
float fractionPartOfPosition=position-floor(position+0.5);
fractionPartOfPosition/=differentialLength;
fractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);
float result=0.5+0.5*cos(fractionPartOfPosition*PI);
return result;
}
float contributionOnAxis(float position) {
float differentialLength=length(vec2(dFdx(position),dFdy(position)));
differentialLength*=SQRT2;

float result=isPointOnLine(position,differentialLength);

float visibility=getVisibility(position);
result*=visibility;

float anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);
result*=anisotropicAttenuation;
return result;
}
float normalImpactOnAxis(float x) {
float normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);
return normalImpact;
}
void main(void) {

float gridRatio=gridControl.x;
vec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;

float x=contributionOnAxis(gridPos.x);
float y=contributionOnAxis(gridPos.y);
float z=contributionOnAxis(gridPos.z);

vec3 normal=normalize(vNormal);
x*=normalImpactOnAxis(normal.x);
y*=normalImpactOnAxis(normal.y);
z*=normalImpactOnAxis(normal.z);

float grid=clamp(x+y+z,0.,1.);

vec3 color=mix(mainColor,lineColor,grid);
#ifdef FOG
#include<fogFragment>
#endif
float opacity=1.0;
#ifdef TRANSPARENT
opacity=clamp(grid,0.08,gridControl.w*grid);
#endif
#ifdef OPACITY
opacity*=texture2D(opacitySampler,vOpacityUV).a;
#endif

gl_FragColor=vec4(color.rgb,opacity);
#ifdef TRANSPARENT
#ifdef PREMULTIPLYALPHA
gl_FragColor.rgb*=opacity;
#endif
#else
#endif
}`;b.Effect.ShadersStore.gridPixelShader=t;var p=`precision highp float;

attribute vec3 position;
attribute vec3 normal;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif

uniform mat4 projection;
uniform mat4 world;
uniform mat4 view;
uniform mat4 worldView;

varying vec3 vPosition;
varying vec3 vNormal;
#include<fogVertexDeclaration>
#ifdef OPACITY
varying vec2 vOpacityUV;
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
void main(void) {
#ifdef FOG
vec4 worldPos=world*vec4(position,1.0);
#endif
#include<fogVertex>
vec4 cameraSpacePosition=worldView*vec4(position,1.0);
gl_Position=projection*cameraSpacePosition;
#ifdef OPACITY
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
vPosition=position;
vNormal=normal;
}`;b.Effect.ShadersStore.gridVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.OPACITY=!1,a.TRANSPARENT=!1,a.FOG=!1,a.PREMULTIPLYALPHA=!1,a.UV1=!1,a.UV2=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.mainColor=b.Color3.Black(),f.lineColor=b.Color3.Teal(),f.gridRatio=1,f.gridOffset=b.Vector3.Zero(),f.majorUnitFrequency=10,f.minorUnitVisibility=.33,f.opacity=1,f.preMultiplyAlpha=!1,f._gridControl=new b.Vector4(f.gridRatio,f.majorUnitFrequency,f.minorUnitVisibility,f.opacity),f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return this.opacity<1||this._opacityTexture&&this._opacityTexture.isReady()},d.prototype.needAlphaBlendingForMesh=function(a){return this.needAlphaBlending()},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;if(c.TRANSPARENT!==this.opacity<1&&(c.TRANSPARENT=!c.TRANSPARENT,c.markAsUnprocessed()),c.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(c.PREMULTIPLYALPHA=!c.PREMULTIPLYALPHA,c.markAsUnprocessed()),c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled&&this._opacityTexture&&b.MaterialFlags.OpacityTextureEnabled)){if(!this._opacityTexture.isReady())return!1;c._needUVs=!0,c.OPACITY=!0}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,!1,this.fogEnabled,!1,c),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial(),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!1,!1);var k=[b.VertexBuffer.PositionKind,b.VertexBuffer.NormalKind];c.UV1&&k.push(b.VertexBuffer.UVKind),c.UV2&&k.push(b.VertexBuffer.UV2Kind);var n=c.toString();e.setEffect(h.getEngine().createEffect("grid",k,["projection","worldView","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view","opacityMatrix","vOpacityInfos"],["opacitySampler"],n,void 0,this.onCompiled,this.onError),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene();if(f._materialDefines){var h=f.effect;h&&(this._activeEffect=h,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("worldView",a.multiply(c.getViewMatrix())),this._activeEffect.setMatrix("view",c.getViewMatrix()),this._activeEffect.setMatrix("projection",c.getProjectionMatrix()),this._mustRebind(c,h)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl),this._opacityTexture&&b.MaterialFlags.OpacityTextureEnabled&&(this._activeEffect.setTexture("opacitySampler",this._opacityTexture),this._activeEffect.setFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._activeEffect.setMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix()))),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.dispose=function(a){j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.GridMaterial",a},d.prototype.getClassName=function(){return"GridMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},g.a([Object(b.serializeAsColor3)()],d.prototype,"mainColor",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"lineColor",void 0),g.a([Object(b.serialize)()],d.prototype,"gridRatio",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"gridOffset",void 0),g.a([Object(b.serialize)()],d.prototype,"majorUnitFrequency",void 0),g.a([Object(b.serialize)()],d.prototype,"minorUnitVisibility",void 0),g.a([Object(b.serialize)()],d.prototype,"opacity",void 0),g.a([Object(b.serialize)()],d.prototype,"preMultiplyAlpha",void 0),g.a([Object(b.serializeAsTexture)("opacityTexture")],d.prototype,"_opacityTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"opacityTexture",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.GridMaterial"]=o,i.d(m,"GridMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;

vec4 color=vec4(finalDiffuse,alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.simplePixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.simpleVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f._disableLighting=!1,f._maxSimultaneousLights=4,f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled&&this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix"],s=["diffuseSampler"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("simple",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights-1}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&a.push(this._diffuseTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||this.diffuseTexture===a},d.prototype.dispose=function(a){this._diffuseTexture&&this._diffuseTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.SimpleMaterial",a},d.prototype.getClassName=function(){return"SimpleMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},g.a([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),g.a([Object(b.serializeAsColor3)("diffuse")],d.prototype,"diffuseColor",void 0),g.a([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),g.a([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.SimpleMaterial"]=o,i.d(m,"SimpleMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;

varying vec3 vPositionW;

uniform float time;
uniform float speed;
uniform float movingSpeed;
uniform vec3 fogColor;
uniform sampler2D noiseTexture;
uniform float fogDensity;

varying float noise;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0]
#include<__decl__lightFragment>[1]
#include<__decl__lightFragment>[2]
#include<__decl__lightFragment>[3]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
float random( vec3 scale,float seed ){
return fract( sin( dot( gl_FragCoord.xyz+seed,scale ) )*43758.5453+seed ) ;
}
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef DIFFUSE

vec4 noiseTex=texture2D( noiseTexture,vDiffuseUV );
vec2 T1=vDiffuseUV+vec2( 1.5,-1.5 )*time*0.02;
vec2 T2=vDiffuseUV+vec2( -0.5,2.0 )*time*0.01*speed;
T1.x+=noiseTex.x*2.0;
T1.y+=noiseTex.y*2.0;
T2.x-=noiseTex.y*0.2+time*0.001*movingSpeed;
T2.y+=noiseTex.z*0.2+time*0.002*movingSpeed;
float p=texture2D( noiseTexture,T1*3.0 ).a;
vec4 lavaColor=texture2D( diffuseSampler,T2*4.0);
vec4 temp=lavaColor*( vec4( p,p,p,p )*2. )+( lavaColor*lavaColor-0.1 );
baseColor=temp;
float depth=gl_FragCoord.z*4.0;
const float LOG2=1.442695;
float fogFactor=exp2(-fogDensity*fogDensity*depth*depth*LOG2 );
fogFactor=1.0-clamp( fogFactor,0.0,1.0 );
baseColor=mix( baseColor,vec4( fogColor,baseColor.w ),fogFactor );
diffuseColor=baseColor.rgb;


#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef UNLIT
vec3 diffuseBase=vec3(1.,1.,1.);
#else

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#include<lightFragment>[0]
#include<lightFragment>[1]
#include<lightFragment>[2]
#include<lightFragment>[3]
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;

vec4 color=vec4(finalDiffuse,alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.lavaPixelShader=t;var p=`precision highp float;

uniform float time;
uniform float lowFrequencySpeed;

varying float noise;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]



vec3 mod289(vec3 x)
{
return x-floor(x*(1.0/289.0))*289.0;
}
vec4 mod289(vec4 x)
{
return x-floor(x*(1.0/289.0))*289.0;
}
vec4 permute(vec4 x)
{
return mod289(((x*34.0)+1.0)*x);
}
vec4 taylorInvSqrt(vec4 r)
{
return 1.79284291400159-0.85373472095314*r;
}
vec3 fade(vec3 t) {
return t*t*t*(t*(t*6.0-15.0)+10.0);
}

float pnoise(vec3 P,vec3 rep)
{
vec3 Pi0=mod(floor(P),rep);
vec3 Pi1=mod(Pi0+vec3(1.0),rep);
Pi0=mod289(Pi0);
Pi1=mod289(Pi1);
vec3 Pf0=fract(P);
vec3 Pf1=Pf0-vec3(1.0);
vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);
vec4 iy=vec4(Pi0.yy,Pi1.yy);
vec4 iz0=Pi0.zzzz;
vec4 iz1=Pi1.zzzz;
vec4 ixy=permute(permute(ix)+iy);
vec4 ixy0=permute(ixy+iz0);
vec4 ixy1=permute(ixy+iz1);
vec4 gx0=ixy0*(1.0/7.0);
vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;
gx0=fract(gx0);
vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);
vec4 sz0=step(gz0,vec4(0.0));
gx0-=sz0*(step(0.0,gx0)-0.5);
gy0-=sz0*(step(0.0,gy0)-0.5);
vec4 gx1=ixy1*(1.0/7.0);
vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;
gx1=fract(gx1);
vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);
vec4 sz1=step(gz1,vec4(0.0));
gx1-=sz1*(step(0.0,gx1)-0.5);
gy1-=sz1*(step(0.0,gy1)-0.5);
vec3 g000=vec3(gx0.x,gy0.x,gz0.x);
vec3 g100=vec3(gx0.y,gy0.y,gz0.y);
vec3 g010=vec3(gx0.z,gy0.z,gz0.z);
vec3 g110=vec3(gx0.w,gy0.w,gz0.w);
vec3 g001=vec3(gx1.x,gy1.x,gz1.x);
vec3 g101=vec3(gx1.y,gy1.y,gz1.y);
vec3 g011=vec3(gx1.z,gy1.z,gz1.z);
vec3 g111=vec3(gx1.w,gy1.w,gz1.w);
vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));
g000*=norm0.x;
g010*=norm0.y;
g100*=norm0.z;
g110*=norm0.w;
vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));
g001*=norm1.x;
g011*=norm1.y;
g101*=norm1.z;
g111*=norm1.w;
float n000=dot(g000,Pf0);
float n100=dot(g100,vec3(Pf1.x,Pf0.yz));
float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));
float n110=dot(g110,vec3(Pf1.xy,Pf0.z));
float n001=dot(g001,vec3(Pf0.xy,Pf1.z));
float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));
float n011=dot(g011,vec3(Pf0.x,Pf1.yz));
float n111=dot(g111,Pf1);
vec3 fade_xyz=fade(Pf0);
vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);
vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);
float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);
return 2.2*n_xyz;
}

float turbulence( vec3 p ) {
float w=100.0;
float t=-.5;
for (float f=1.0 ; f<=10.0 ; f++ ){
float power=pow( 2.0,f );
t+=abs( pnoise( vec3( power*p ),vec3( 10.0,10.0,10.0 ) )/power );
}
return t;
}
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
#ifdef NORMAL

noise=10.0*-.10*turbulence( .5*normal+time*1.15 );

float b=lowFrequencySpeed*5.0*pnoise( 0.05*position +vec3(time*1.025),vec3( 100.0 ) );

float displacement =-1.5*noise+b;

vec3 newPosition=position+normal*displacement;
gl_Position=viewProjection*finalWorld*vec4( newPosition,1.0 );
vec4 worldPos=finalWorld*vec4(newPosition,1.0);
vPositionW=vec3(worldPos);
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}`;b.Effect.ShadersStore.lavaVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.LIGHT0=!1,a.LIGHT1=!1,a.LIGHT2=!1,a.LIGHT3=!1,a.SPOTLIGHT0=!1,a.SPOTLIGHT1=!1,a.SPOTLIGHT2=!1,a.SPOTLIGHT3=!1,a.HEMILIGHT0=!1,a.HEMILIGHT1=!1,a.HEMILIGHT2=!1,a.HEMILIGHT3=!1,a.DIRLIGHT0=!1,a.DIRLIGHT1=!1,a.DIRLIGHT2=!1,a.DIRLIGHT3=!1,a.POINTLIGHT0=!1,a.POINTLIGHT1=!1,a.POINTLIGHT2=!1,a.POINTLIGHT3=!1,a.SHADOW0=!1,a.SHADOW1=!1,a.SHADOW2=!1,a.SHADOW3=!1,a.SHADOWS=!1,a.SHADOWESM0=!1,a.SHADOWESM1=!1,a.SHADOWESM2=!1,a.SHADOWESM3=!1,a.SHADOWPOISSON0=!1,a.SHADOWPOISSON1=!1,a.SHADOWPOISSON2=!1,a.SHADOWPOISSON3=!1,a.SHADOWPCF0=!1,a.SHADOWPCF1=!1,a.SHADOWPCF2=!1,a.SHADOWPCF3=!1,a.SHADOWPCSS0=!1,a.SHADOWPCSS1=!1,a.SHADOWPCSS2=!1,a.SHADOWPCSS3=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.UNLIT=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.speed=1,f.movingSpeed=1,f.lowFrequencySpeed=1,f.fogDensity=.15,f._lastTime=0,f.diffuseColor=new b.Color3(1,1,1),f._disableLighting=!1,f._unlit=!1,f._maxSimultaneousLights=4,f._scaledDiffuse=new b.Color3(),f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled&&this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=!0,b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix","time","speed","movingSpeed","fogColor","fogDensity","lowFrequencySpeed"],s=["diffuseSampler","noiseTexture"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("lava",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,h.UNLIT=this._unlit,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this.diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.noiseTexture&&this._activeEffect.setTexture("noiseTexture",this.noiseTexture),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*e.visibility),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._lastTime+=c.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime*this.speed/1000),this.fogColor||(this.fogColor=b.Color3.Black()),this._activeEffect.setColor3("fogColor",this.fogColor),this._activeEffect.setFloat("fogDensity",this.fogDensity),this._activeEffect.setFloat("lowFrequencySpeed",this.lowFrequencySpeed),this._activeEffect.setFloat("movingSpeed",this.movingSpeed),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&a.push(this.diffuseTexture),this.noiseTexture&&this.noiseTexture.animations&&this.noiseTexture.animations.length>0&&a.push(this.noiseTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||this.diffuseTexture===a},d.prototype.dispose=function(a){this.diffuseTexture&&this.diffuseTexture.dispose(),this.noiseTexture&&this.noiseTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.LavaMaterial",a},d.prototype.getClassName=function(){return"LavaMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},g.a([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),g.a([Object(b.serializeAsTexture)()],d.prototype,"noiseTexture",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"fogColor",void 0),g.a([Object(b.serialize)()],d.prototype,"speed",void 0),g.a([Object(b.serialize)()],d.prototype,"movingSpeed",void 0),g.a([Object(b.serialize)()],d.prototype,"lowFrequencySpeed",void 0),g.a([Object(b.serialize)()],d.prototype,"fogDensity",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),g.a([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),g.a([Object(b.serialize)("unlit")],d.prototype,"_unlit",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"unlit",void 0),g.a([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.LavaMaterial"]=o,i.d(m,"LavaMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform float alpha;
uniform vec3 shadowColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#include<lightFragment>[0..1]

vec4 color=vec4(shadowColor,(1.0-clamp(shadow,0.,1.))*alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.shadowOnlyPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.shadowOnlyVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.shadowColor=b.Color3.Black(),f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return!0},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},Object.defineProperty(d.prototype,"activeLight",{get:function(){return this._activeLight},set:function(a){this._activeLight=a},enumerable:!0,configurable:!0}),d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(this._activeLight)for(var n=0,l=a.lightSources;n<l.length;n++){var r=l[n];if(r.shadowEnabled){if(this._activeLight===r)break;var u=a.lightSources.indexOf(this._activeLight);-1!==u&&(a.lightSources.splice(u,1),a.lightSources.splice(0,0,this._activeLight));break}}if(b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,1),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!1,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var s=new b.EffectFallbacks();c.FOG&&s.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,s,1),c.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,a);var v=[b.VertexBuffer.PositionKind];c.NORMAL&&v.push(b.VertexBuffer.NormalKind),b.MaterialHelper.PrepareAttributesForBones(v,a,c,s),b.MaterialHelper.PrepareAttributesForInstances(v,c);var x=c.toString(),y=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","alpha","shadowColor","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4"],z=new Array(),E=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:y,uniformBuffersNames:E,samplers:z,defines:c,maxSimultaneousLights:1}),e.setEffect(h.getEngine().createEffect("shadowOnly",{attributes:v,uniformsNames:y,uniformBuffersNames:E,samplers:z,defines:x,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:1}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._activeEffect.setFloat("alpha",this.alpha),this._activeEffect.setColor3("shadowColor",this.shadowColor),b.MaterialHelper.BindEyePosition(k,c)),c.lightsEnabled&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,1),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.ShadowOnlyMaterial",a},d.prototype.getClassName=function(){return"ShadowOnlyMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.ShadowOnlyMaterial"]=o,i.d(m,"ShadowOnlyMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]

#ifdef DIFFUSE
varying vec2 vTextureUV;
uniform sampler2D mixMap1Sampler;
uniform vec2 vTextureInfos;
#ifdef MIXMAP2
uniform sampler2D mixMap2Sampler;
#endif
uniform sampler2D diffuse1Sampler;
uniform sampler2D diffuse2Sampler;
uniform sampler2D diffuse3Sampler;
uniform sampler2D diffuse4Sampler;
uniform vec2 diffuse1Infos;
uniform vec2 diffuse2Infos;
uniform vec2 diffuse3Infos;
uniform vec2 diffuse4Infos;
#ifdef MIXMAP2
uniform sampler2D diffuse5Sampler;
uniform sampler2D diffuse6Sampler;
uniform sampler2D diffuse7Sampler;
uniform sampler2D diffuse8Sampler;
uniform vec2 diffuse5Infos;
uniform vec2 diffuse6Infos;
uniform vec2 diffuse7Infos;
uniform vec2 diffuse8Infos;
#endif
#endif

#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
void main(void) {

#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 finalMixColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;
#ifdef MIXMAP2
vec4 mixColor2=vec4(1.,1.,1.,1.);
#endif
#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#else
float glossiness=0.;
#endif

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif
#ifdef DIFFUSE
vec4 mixColor=texture2D(mixMap1Sampler,vTextureUV);
#include<depthPrePass>
mixColor.rgb*=vTextureInfos.y;
vec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);
vec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);
vec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);
vec4 diffuse4Color=texture2D(diffuse4Sampler,vTextureUV*diffuse4Infos);
diffuse1Color.rgb*=mixColor.r;
diffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,mixColor.g);
diffuse3Color.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,mixColor.b);
finalMixColor.rgb=mix(diffuse3Color.rgb,diffuse4Color.rgb,1.0-mixColor.a);
#ifdef MIXMAP2
mixColor=texture2D(mixMap2Sampler,vTextureUV);
mixColor.rgb*=vTextureInfos.y;
vec4 diffuse5Color=texture2D(diffuse5Sampler,vTextureUV*diffuse5Infos);
vec4 diffuse6Color=texture2D(diffuse6Sampler,vTextureUV*diffuse6Infos);
vec4 diffuse7Color=texture2D(diffuse7Sampler,vTextureUV*diffuse7Infos);
vec4 diffuse8Color=texture2D(diffuse8Sampler,vTextureUV*diffuse8Infos);
diffuse5Color.rgb=mix(finalMixColor.rgb,diffuse5Color.rgb,mixColor.r);
diffuse6Color.rgb=mix(diffuse5Color.rgb,diffuse6Color.rgb,mixColor.g);
diffuse7Color.rgb=mix(diffuse6Color.rgb,diffuse7Color.rgb,mixColor.b);
finalMixColor.rgb=mix(diffuse7Color.rgb,diffuse8Color.rgb,1.0-mixColor.a);
#endif
#endif
#ifdef VERTEXCOLOR
finalMixColor.rgb*=vColor.rgb;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#else
vec3 finalSpecular=vec3(0.0);
#endif
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor*finalMixColor.rgb,0.0,1.0);

vec4 color=vec4(finalDiffuse+finalSpecular,alpha);
#include<fogFragment>
gl_FragColor=color;
}
`;b.Effect.ShadersStore.mixPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vTextureUV;
uniform mat4 textureMatrix;
uniform vec2 vTextureInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vTextureInfos.x == 0.)
{
vTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));
}
else
{
vTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.mixVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.SPECULARTERM=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.MIXMAP2=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f.specularColor=new b.Color3(0,0,0),f.specularPower=64,f._disableLighting=!1,f._maxSimultaneousLights=4,f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(h.texturesEnabled){if(!this._mixTexture1||!this._mixTexture1.isReady())return!1;if(c._needUVs=!0,b.MaterialFlags.DiffuseTextureEnabled){if(!this._diffuseTexture1||!this._diffuseTexture1.isReady())return!1;if(c.DIFFUSE=!0,!this._diffuseTexture2||!this._diffuseTexture2.isReady())return!1;if(!this._diffuseTexture3||!this._diffuseTexture3.isReady())return!1;if(!this._diffuseTexture4||!this._diffuseTexture4.isReady())return!1;if(this._mixTexture2){if(!this._mixTexture2.isReady())return!1;if(c.MIXMAP2=!0,!this._diffuseTexture5||!this._diffuseTexture5.isReady())return!1;if(!this._diffuseTexture6||!this._diffuseTexture6.isReady())return!1;if(!this._diffuseTexture7||!this._diffuseTexture7.isReady())return!1;if(!this._diffuseTexture8||!this._diffuseTexture8.isReady())return!1}}}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n,this.maxSimultaneousLights),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),c.VERTEXCOLOR&&l.push(b.VertexBuffer.ColorKind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos","diffuse4Infos","diffuse5Infos","diffuse6Infos","diffuse7Infos","diffuse8Infos"],s=["mixMap1Sampler","mixMap2Sampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","diffuse4Sampler","diffuse5Sampler","diffuse6Sampler","diffuse7Sampler","diffuse8Sampler"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:this.maxSimultaneousLights}),e.setEffect(h.getEngine().createEffect("mix",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this._mixTexture1&&(this._activeEffect.setTexture("mixMap1Sampler",this._mixTexture1),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture1.coordinatesIndex,this._mixTexture1.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture1.getTextureMatrix()),b.MaterialFlags.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale)),this._diffuseTexture4&&(this._activeEffect.setTexture("diffuse4Sampler",this._diffuseTexture4),this._activeEffect.setFloat2("diffuse4Infos",this._diffuseTexture4.uScale,this._diffuseTexture4.vScale)))),this._mixTexture2&&(this._activeEffect.setTexture("mixMap2Sampler",this._mixTexture2),b.MaterialFlags.DiffuseTextureEnabled&&(this._diffuseTexture5&&(this._activeEffect.setTexture("diffuse5Sampler",this._diffuseTexture5),this._activeEffect.setFloat2("diffuse5Infos",this._diffuseTexture5.uScale,this._diffuseTexture5.vScale)),this._diffuseTexture6&&(this._activeEffect.setTexture("diffuse6Sampler",this._diffuseTexture6),this._activeEffect.setFloat2("diffuse6Infos",this._diffuseTexture6.uScale,this._diffuseTexture6.vScale)),this._diffuseTexture7&&(this._activeEffect.setTexture("diffuse7Sampler",this._diffuseTexture7),this._activeEffect.setFloat2("diffuse7Infos",this._diffuseTexture7.uScale,this._diffuseTexture7.vScale)),this._diffuseTexture8&&(this._activeEffect.setTexture("diffuse8Sampler",this._diffuseTexture8),this._activeEffect.setFloat2("diffuse8Infos",this._diffuseTexture8.uScale,this._diffuseTexture8.vScale)))),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),h.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h,this.maxSimultaneousLights),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this._mixTexture1&&this._mixTexture1.animations&&this._mixTexture1.animations.length>0&&a.push(this._mixTexture1),this._mixTexture2&&this._mixTexture2.animations&&this._mixTexture2.animations.length>0&&a.push(this._mixTexture2),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._mixTexture1&&a.push(this._mixTexture1),this._diffuseTexture1&&a.push(this._diffuseTexture1),this._diffuseTexture2&&a.push(this._diffuseTexture2),this._diffuseTexture3&&a.push(this._diffuseTexture3),this._diffuseTexture4&&a.push(this._diffuseTexture4),this._mixTexture2&&a.push(this._mixTexture2),this._diffuseTexture5&&a.push(this._diffuseTexture5),this._diffuseTexture6&&a.push(this._diffuseTexture6),this._diffuseTexture7&&a.push(this._diffuseTexture7),this._diffuseTexture8&&a.push(this._diffuseTexture8),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||(this._mixTexture1===a||(this._diffuseTexture1===a||(this._diffuseTexture2===a||(this._diffuseTexture3===a||(this._diffuseTexture4===a||(this._mixTexture2===a||(this._diffuseTexture5===a||(this._diffuseTexture6===a||(this._diffuseTexture7===a||this._diffuseTexture8===a)))))))))},d.prototype.dispose=function(a){this._mixTexture1&&this._mixTexture1.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.MixMaterial",a},d.prototype.getClassName=function(){return"MixMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},g.a([Object(b.serializeAsTexture)("mixTexture1")],d.prototype,"_mixTexture1",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"mixTexture1",void 0),g.a([Object(b.serializeAsTexture)("mixTexture2")],d.prototype,"_mixTexture2",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"mixTexture2",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture1")],d.prototype,"_diffuseTexture1",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture1",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture2")],d.prototype,"_diffuseTexture2",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture2",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture3")],d.prototype,"_diffuseTexture3",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture3",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture4")],d.prototype,"_diffuseTexture4",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture4",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture1")],d.prototype,"_diffuseTexture5",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture5",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture2")],d.prototype,"_diffuseTexture6",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture6",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture3")],d.prototype,"_diffuseTexture7",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture7",void 0),g.a([Object(b.serializeAsTexture)("diffuseTexture4")],d.prototype,"_diffuseTexture8",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture8",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"specularColor",void 0),g.a([Object(b.serialize)()],d.prototype,"specularPower",void 0),g.a([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),g.a([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.MixMaterial"]=o,i.d(m,"MixMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=`precision highp float;

uniform vec3 vEyePosition;
uniform vec4 vDiffuseColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef LIGHTING

#include<helperFunctions>

#include<__decl__lightFragment>[0]
#include<__decl__lightFragment>[1]
#include<__decl__lightFragment>[2]
#include<__decl__lightFragment>[3]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#endif

#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform sampler2D diffuseSampler;
uniform vec2 vDiffuseInfos;
#endif
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
#include<depthPrePass>
baseColor.rgb*=vDiffuseInfos.y;
#endif
#ifdef NORMAL
baseColor=mix(baseColor,vec4(vNormalW,1.0),0.5);
#endif

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(1.0,1.0,1.0);
#endif

#ifdef LIGHTING
vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
float shadow=1.;
float glossiness=0.;
#include<lightFragment>[0]
#include<lightFragment>[1]
#include<lightFragment>[2]
#include<lightFragment>[3]
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=baseColor.rgb;
#endif

vec4 color=vec4(finalDiffuse,alpha);
#include<fogFragment>
gl_FragColor=color;
}`;b.Effect.ShadersStore.normalPixelShader=t;var p=`precision highp float;

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 view;
uniform mat4 viewProjection;
#ifdef DIFFUSE
varying vec2 vDiffuseUV;
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef DIFFUSE
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;b.Effect.ShadersStore.normalVertexShader=p;var q=function(j){function d(){var a=j.call(this)||this;return a.DIFFUSE=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.POINTSIZE=!1,a.FOG=!1,a.LIGHT0=!1,a.LIGHT1=!1,a.LIGHT2=!1,a.LIGHT3=!1,a.SPOTLIGHT0=!1,a.SPOTLIGHT1=!1,a.SPOTLIGHT2=!1,a.SPOTLIGHT3=!1,a.HEMILIGHT0=!1,a.HEMILIGHT1=!1,a.HEMILIGHT2=!1,a.HEMILIGHT3=!1,a.DIRLIGHT0=!1,a.DIRLIGHT1=!1,a.DIRLIGHT2=!1,a.DIRLIGHT3=!1,a.POINTLIGHT0=!1,a.POINTLIGHT1=!1,a.POINTLIGHT2=!1,a.POINTLIGHT3=!1,a.SHADOW0=!1,a.SHADOW1=!1,a.SHADOW2=!1,a.SHADOW3=!1,a.SHADOWS=!1,a.SHADOWESM0=!1,a.SHADOWESM1=!1,a.SHADOWESM2=!1,a.SHADOWESM3=!1,a.SHADOWPOISSON0=!1,a.SHADOWPOISSON1=!1,a.SHADOWPOISSON2=!1,a.SHADOWPOISSON3=!1,a.SHADOWPCF0=!1,a.SHADOWPCF1=!1,a.SHADOWPCF2=!1,a.SHADOWPCF3=!1,a.SHADOWPCSS0=!1,a.SHADOWPCSS1=!1,a.SHADOWPCSS2=!1,a.SHADOWPCSS3=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.LIGHTING=!1,a.rebuild(),a}return g.b(d,j),d}(b.MaterialDefines),o=function(j){function d(a,e){var f=j.call(this,a,e)||this;return f.diffuseColor=new b.Color3(1,1,1),f._disableLighting=!1,f._maxSimultaneousLights=4,f}return g.b(d,j),d.prototype.needAlphaBlending=function(){return this.alpha<1},d.prototype.needAlphaBlendingForMesh=function(a){return this.needAlphaBlending()||a.visibility<1},d.prototype.needAlphaTesting=function(){return!1},d.prototype.getAlphaTestTexture=function(){return null},d.prototype.isReadyForSubMesh=function(a,e,f){if(this.isFrozen&&this._wasPreviouslyReady&&e.effect)return!0;e._materialDefines||(e._materialDefines=new q());var c=e._materialDefines,h=this.getScene();if(!this.checkReadyOnEveryCall&&e.effect&&this._renderId===h.getRenderId())return!0;var k=h.getEngine();if(c._areTexturesDirty&&(c._needUVs=!1,h.texturesEnabled&&this._diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;c._needUVs=!0,c.DIFFUSE=!0}if(b.MaterialHelper.PrepareDefinesForMisc(a,h,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),c),c._needNormals=!0,b.MaterialHelper.PrepareDefinesForLights(h,a,c,!1,this._maxSimultaneousLights,this._disableLighting),b.MaterialHelper.PrepareDefinesForFrameBoundValues(h,k,c,!!f),c.LIGHTING=!this._disableLighting,b.MaterialHelper.PrepareDefinesForAttributes(a,c,!0,!0),c.isDirty){c.markAsProcessed(),h.resetCachedMaterial();var n=new b.EffectFallbacks();c.FOG&&n.addFallback(1,"FOG"),b.MaterialHelper.HandleFallbacksForShadows(c,n),c.NUM_BONE_INFLUENCERS>0&&n.addCPUSkinningFallback(0,a);var l=[b.VertexBuffer.PositionKind];c.NORMAL&&l.push(b.VertexBuffer.NormalKind),c.UV1&&l.push(b.VertexBuffer.UVKind),c.UV2&&l.push(b.VertexBuffer.UV2Kind),b.MaterialHelper.PrepareAttributesForBones(l,a,c,n),b.MaterialHelper.PrepareAttributesForInstances(l,c);var r=c.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix"],s=["diffuseSampler"],v=new Array();b.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:c,maxSimultaneousLights:4}),e.setEffect(h.getEngine().createEffect("normal",{attributes:l,uniformsNames:u,uniformBuffersNames:v,samplers:s,defines:r,fallbacks:n,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},k),c)}return!(!e.effect||!e.effect.isReady())&&(this._renderId=h.getRenderId(),this._wasPreviouslyReady=!0,!0)},d.prototype.bindForSubMesh=function(a,e,f){var c=this.getScene(),h=f._materialDefines;if(h){var k=f.effect;k&&(this._activeEffect=k,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",c.getTransformMatrix()),b.MaterialHelper.BindBonesParameters(e,this._activeEffect),this._mustRebind(c,k)&&(this.diffuseTexture&&b.MaterialFlags.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),b.MaterialHelper.BindClipPlane(this._activeEffect,c),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),b.MaterialHelper.BindEyePosition(k,c)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),c.lightsEnabled&&!this.disableLighting&&b.MaterialHelper.BindLights(c,e,this._activeEffect,h),c.fogEnabled&&e.applyFog&&c.fogMode!==b.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",c.getViewMatrix()),b.MaterialHelper.BindFogParameters(c,e,this._activeEffect),this._afterBind(e,this._activeEffect))}},d.prototype.getAnimatables=function(){var a=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&a.push(this.diffuseTexture),a},d.prototype.getActiveTextures=function(){var a=j.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),a},d.prototype.hasTexture=function(a){return!!j.prototype.hasTexture.call(this,a)||this.diffuseTexture===a},d.prototype.dispose=function(a){this.diffuseTexture&&this.diffuseTexture.dispose(),j.prototype.dispose.call(this,a)},d.prototype.clone=function(a){var e=this;return b.SerializationHelper.Clone(function(){return new d(a,e.getScene())},this)},d.prototype.serialize=function(){var a=b.SerializationHelper.Serialize(this);return a.customType="BABYLON.NormalMaterial",a},d.prototype.getClassName=function(){return"NormalMaterial"},d.Parse=function(a,e,f){return b.SerializationHelper.Parse(function(){return new d(a.name,e)},a,e,f)},g.a([Object(b.serializeAsTexture)("diffuseTexture")],d.prototype,"_diffuseTexture",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"diffuseTexture",void 0),g.a([Object(b.serializeAsColor3)()],d.prototype,"diffuseColor",void 0),g.a([Object(b.serialize)("disableLighting")],d.prototype,"_disableLighting",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),g.a([Object(b.serialize)("maxSimultaneousLights")],d.prototype,"_maxSimultaneousLights",void 0),g.a([Object(b.expandToProperty)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),d}(b.PushMaterial);b._TypeStore.RegisteredTypes["BABYLON.NormalMaterial"]=o,i.d(m,"NormalMaterial",function(){return o})},function(w,m,i){"use strict";i.r(m);var g=i(1),b=i(0),t=function(){return function(){}}(),p=function(){return function(){}}(),q=function(d){function a(e,f){var c=d.call(this,e,f)||this;return c.CustomParts=new p(),c.customShaderNameResolve=c.Builder,c.FragmentShader=b.Effect.ShadersStore.defaultPixelShader,c.VertexShader=b.Effect.ShadersStore.defaultVertexShader,c}return g.b(a,d),a.prototype.AttachAfterBind=function(e,f){for(var c in this._newUniformInstances)"vec2"==(h=c.toString().split("-"))[0]?f.setVector2(h[1],this._newUniformInstances[c]):"vec3"==h[0]?f.setVector3(h[1],this._newUniformInstances[c]):"vec4"==h[0]?f.setVector4(h[1],this._newUniformInstances[c]):"mat4"==h[0]?f.setMatrix(h[1],this._newUniformInstances[c]):"float"==h[0]&&f.setFloat(h[1],this._newUniformInstances[c]);for(var c in this._newSamplerInstances){var h;"sampler2D"==(h=c.toString().split("-"))[0]&&this._newSamplerInstances[c].isReady&&this._newSamplerInstances[c].isReady()&&f.setTexture(h[1],this._newSamplerInstances[c])}},a.prototype.ReviewUniform=function(e,f){if("uniform"==e)for(var c in this._newUniforms)-1==this._customUniform[c].indexOf("sampler")&&f.push(this._newUniforms[c]);if("sampler"==e)for(var c in this._newUniforms)-1!=this._customUniform[c].indexOf("sampler")&&f.push(this._newUniforms[c]);return f},a.prototype.Builder=function(e,f,c,h,k){var n=this;if(this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,a.ShaderIndexer++;var l="custom_"+a.ShaderIndexer;this.ReviewUniform("uniform",f),this.ReviewUniform("sampler",h);var r=this._afterBind.bind(this);return this._afterBind=function(u,s){if(s){n.AttachAfterBind(u,s);try{r(u,s)}catch(v){}}},b.Effect.ShadersStore[l+"VertexShader"]=this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",(this._customUniform?this._customUniform.join(`
`):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.CustomParts.Vertex_MainEnd?this.CustomParts.Vertex_MainEnd:""),b.Effect.ShadersStore[l+"PixelShader"]=this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",(this._customUniform?this._customUniform.join(`
`):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE",this.CustomParts.Fragment_Custom_Diffuse?this.CustomParts.Fragment_Custom_Diffuse:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.CustomParts.Fragment_Before_Lights?this.CustomParts.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.CustomParts.Fragment_Before_Fog?this.CustomParts.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:""),this._isCreatedShader=!0,this._createdShaderName=l,l},a.prototype.AddUniform=function(e,f,c){return this._customUniform||(this._customUniform=new Array(),this._newUniforms=new Array(),this._newSamplerInstances=new Array(),this._newUniformInstances=new Array()),c&&(f.indexOf("sampler"),this._newUniformInstances[f+"-"+e]=c),this._customUniform.push("uniform "+f+" "+e+";"),this._newUniforms.push(e),this},a.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},a.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},a.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},a.prototype.Fragment_Custom_Diffuse=function(e){return this.CustomParts.Fragment_Custom_Diffuse=e.replace("result","diffuseColor"),this},a.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},a.prototype.Fragment_Before_Lights=function(e){return this.CustomParts.Fragment_Before_Lights=e,this},a.prototype.Fragment_Before_Fog=function(e){return this.CustomParts.Fragment_Before_Fog=e,this},a.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},a.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},a.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},a.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},a.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},a.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},a.prototype.Vertex_MainEnd=function(e){return this.CustomParts.Vertex_MainEnd=e,this},a.ShaderIndexer=1,a}(b.StandardMaterial);b._TypeStore.RegisteredTypes["BABYLON.CustomMaterial"]=q;var o=function(){return function(){}}(),j=function(d){function a(e,f){var c=d.call(this,e,f)||this;return c.CustomParts=new o(),c.customShaderNameResolve=c.Builder,c.FragmentShader=b.Effect.ShadersStore.pbrPixelShader,c.VertexShader=b.Effect.ShadersStore.pbrVertexShader,c}return g.b(a,d),a.prototype.AttachAfterBind=function(e,f){for(var c in this._newUniformInstances)"vec2"==(h=c.toString().split("-"))[0]?f.setVector2(h[1],this._newUniformInstances[c]):"vec3"==h[0]?f.setVector3(h[1],this._newUniformInstances[c]):"vec4"==h[0]?f.setVector4(h[1],this._newUniformInstances[c]):"mat4"==h[0]?f.setMatrix(h[1],this._newUniformInstances[c]):"float"==h[0]&&f.setFloat(h[1],this._newUniformInstances[c]);for(var c in this._newSamplerInstances){var h;"sampler2D"==(h=c.toString().split("-"))[0]&&this._newSamplerInstances[c].isReady&&this._newSamplerInstances[c].isReady()&&f.setTexture(h[1],this._newSamplerInstances[c])}},a.prototype.ReviewUniform=function(e,f){if("uniform"==e)for(var c in this._newUniforms)-1==this._customUniform[c].indexOf("sampler")&&f.push(this._newUniforms[c]);if("sampler"==e)for(var c in this._newUniforms)-1!=this._customUniform[c].indexOf("sampler")&&f.push(this._newUniforms[c]);return f},a.prototype.Builder=function(e,f,c,h,k){var n=this;if(this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,a.ShaderIndexer++;var l="custom_"+a.ShaderIndexer;this.ReviewUniform("uniform",f),this.ReviewUniform("sampler",h);var r=this._afterBind.bind(this);return this._afterBind=function(u,s){if(s){n.AttachAfterBind(u,s);try{r(u,s)}catch(v){}}},b.Effect.ShadersStore[l+"VertexShader"]=this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",(this._customUniform?this._customUniform.join(`
`):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.CustomParts.Vertex_MainEnd?this.CustomParts.Vertex_MainEnd:""),b.Effect.ShadersStore[l+"PixelShader"]=this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",(this._customUniform?this._customUniform.join(`
`):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.CustomParts.Fragment_Custom_Albedo?this.CustomParts.Fragment_Custom_Albedo:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.CustomParts.Fragment_Before_Lights?this.CustomParts.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.CustomParts.Fragment_Custom_MetallicRoughness?this.CustomParts.Fragment_Custom_MetallicRoughness:"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.CustomParts.Fragment_Custom_MicroSurface?this.CustomParts.Fragment_Custom_MicroSurface:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.CustomParts.Fragment_Before_Fog?this.CustomParts.Fragment_Before_Fog:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:""),this._isCreatedShader=!0,this._createdShaderName=l,l},a.prototype.AddUniform=function(e,f,c){return this._customUniform||(this._customUniform=new Array(),this._newUniforms=new Array(),this._newSamplerInstances=new Array(),this._newUniformInstances=new Array()),c&&(f.indexOf("sampler"),this._newUniformInstances[f+"-"+e]=c),this._customUniform.push("uniform "+f+" "+e+";"),this._newUniforms.push(e),this},a.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},a.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},a.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},a.prototype.Fragment_Custom_Albedo=function(e){return this.CustomParts.Fragment_Custom_Albedo=e.replace("result","surfaceAlbedo"),this},a.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},a.prototype.Fragment_Before_Lights=function(e){return this.CustomParts.Fragment_Before_Lights=e,this},a.prototype.Fragment_Custom_MetallicRoughness=function(e){return this.CustomParts.Fragment_Custom_MetallicRoughness=e,this},a.prototype.Fragment_Custom_MicroSurface=function(e){return this.CustomParts.Fragment_Custom_MicroSurface=e,this},a.prototype.Fragment_Before_Fog=function(e){return this.CustomParts.Fragment_Before_Fog=e,this},a.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},a.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},a.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},a.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},a.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},a.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},a.prototype.Vertex_MainEnd=function(e){return this.CustomParts.Vertex_MainEnd=e,this},a.ShaderIndexer=1,a}(b.PBRMaterial);b._TypeStore.RegisteredTypes["BABYLON.PBRCustomMaterial"]=j,i.d(m,"CustomShaderStructure",function(){return t}),i.d(m,"ShaderSpecialParts",function(){return p}),i.d(m,"CustomMaterial",function(){return q}),i.d(m,"ShaderAlebdoParts",function(){return o}),i.d(m,"PBRCustomMaterial",function(){return j})},function(w,m,i){"use strict";i.r(m);var g=i(10);i.d(m,"CellMaterial",function(){return g.CellMaterial});var b=i(17);i.d(m,"CustomShaderStructure",function(){return b.CustomShaderStructure}),i.d(m,"ShaderSpecialParts",function(){return b.ShaderSpecialParts}),i.d(m,"CustomMaterial",function(){return b.CustomMaterial}),i.d(m,"ShaderAlebdoParts",function(){return b.ShaderAlebdoParts}),i.d(m,"PBRCustomMaterial",function(){return b.PBRCustomMaterial});var t=i(5);i.d(m,"FireMaterial",function(){return t.FireMaterial});var p=i(7);i.d(m,"FurMaterial",function(){return p.FurMaterial});var q=i(9);i.d(m,"GradientMaterial",function(){return q.GradientMaterial});var o=i(11);i.d(m,"GridMaterial",function(){return o.GridMaterial});var j=i(13);i.d(m,"LavaMaterial",function(){return j.LavaMaterial});var d=i(15);i.d(m,"MixMaterial",function(){return d.MixMaterial});var a=i(16);i.d(m,"NormalMaterial",function(){return a.NormalMaterial});var e=i(14);i.d(m,"ShadowOnlyMaterial",function(){return e.ShadowOnlyMaterial});var f=i(12);i.d(m,"SimpleMaterial",function(){return f.SimpleMaterial});var c=i(4);i.d(m,"SkyMaterial",function(){return c.SkyMaterial});var h=i(8);i.d(m,"TerrainMaterial",function(){return h.TerrainMaterial});var k=i(6);i.d(m,"TriPlanarMaterial",function(){return k.TriPlanarMaterial});var n=i(3);i.d(m,"WaterMaterial",function(){return n.WaterMaterial})},function(w,m,i){"use strict";i.r(m),function(g){var b=i(18);i.d(m,"CellMaterial",function(){return b.CellMaterial}),i.d(m,"CustomShaderStructure",function(){return b.CustomShaderStructure}),i.d(m,"ShaderSpecialParts",function(){return b.ShaderSpecialParts}),i.d(m,"CustomMaterial",function(){return b.CustomMaterial}),i.d(m,"ShaderAlebdoParts",function(){return b.ShaderAlebdoParts}),i.d(m,"PBRCustomMaterial",function(){return b.PBRCustomMaterial}),i.d(m,"FireMaterial",function(){return b.FireMaterial}),i.d(m,"FurMaterial",function(){return b.FurMaterial}),i.d(m,"GradientMaterial",function(){return b.GradientMaterial}),i.d(m,"GridMaterial",function(){return b.GridMaterial}),i.d(m,"LavaMaterial",function(){return b.LavaMaterial}),i.d(m,"MixMaterial",function(){return b.MixMaterial}),i.d(m,"NormalMaterial",function(){return b.NormalMaterial}),i.d(m,"ShadowOnlyMaterial",function(){return b.ShadowOnlyMaterial}),i.d(m,"SimpleMaterial",function(){return b.SimpleMaterial}),i.d(m,"SkyMaterial",function(){return b.SkyMaterial}),i.d(m,"TerrainMaterial",function(){return b.TerrainMaterial}),i.d(m,"TriPlanarMaterial",function(){return b.TriPlanarMaterial}),i.d(m,"WaterMaterial",function(){return b.WaterMaterial});var t=void 0!==g?g:"undefined"!=typeof window?window:void 0;if(void 0!==t)for(var p in t.BABYLON=t.BABYLON||{},b)t.BABYLON[p]=b[p]}.call(this,i(2))}])})}};return k$(5)})();
